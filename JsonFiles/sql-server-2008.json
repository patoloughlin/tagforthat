{"total":21073,"page":1,"pagesize":100,"questions":[{"tags":["sql-server","sql-server-2008","management-studio"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":1871128,"title":"When creating a new table how do I change the default column definition in SQL Server 2008?","body":"<p>Good day,</p>\n\n<p>When creating a new table in SSMS - right click on the \"Tables\" node, choose \"New Table...\" - the default definition for a new column is nchar(10). </p>\n\n<p>Can I change that? Let's say I would like the default column definition to be varchar(5) whenever someone creates a new table.</p>\n\n<p>I can't find any sort of option to change that, I'm thinking maybe it's a registry setting?</p>\n\n<p>Thanks all.</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13295969,"title":"Function SQL Server 2008","body":"<p>I created the following function yesterday, and now I am facing an error:</p>\n\n<blockquote>\n  <p><em>Invalid length parameter passed to the left or substring function</em></p>\n</blockquote>\n\n<p>Could you guys have a look at my function?I really appreciate it.</p>\n\n<pre><code>Create function nowFunctionNewadd\n      (@fladd varchar(255))\nreturns  @tbl table(addr varchar(100), city varchar(100),\n                    state varchar(100), Zip varchar(5)) \nas\nbegin\n   declare @str varchar(100)\n      ,@i int\n      ,@j int\n      ,@str2 varchar(100)\n      ,@address varchar(100)\n      ,@city varchar(100)\n      ,@lastcomma int\n      ,@lastPart varchar(100)\n      ,@zipstart int\n      ,@zip varchar(5) = ''\n\n   select @str=rtrim(ltrim(@fladd))\n\n   set @i = charindex(',', @str)\n   set @str2=rtrim(ltrim(substring(@str, @i+1, 999)))\n   set @j=CHARINDEX(',',@str2)\n\n   set @lastcomma = len(@str) - charindex(',', reverse(@str)+',')\n   set @lastPart = substring(@str, @lastcomma+2, 100)\n   set @address = REPLACE(rtrim(ltrim(substring(@str,1,@i-1))),',','')\n   set @zipstart = patindex('%[0-9]%', @lastpart)\n   set @city=LTRIM(RTRIM(substring(@str, @i+1, @j-1)))\n\n   If @zipstart &gt; 0 \n      select @zip = substring(@lastpart, @zipstart, 5), \n             @lastPart = rtrim(substring(@lastpart, 1, @zipstart-1))\n\n   insert into @tbl(addr, city, state, Zip)\n   values(@address, @city, @lastpart, @zip)\n\n   return\nend\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":12,"score":2,"question_id":13298196,"title":"Configure SQL server to store UTC date Time","body":"<p>Is There some way to configure sql server to store UTC time in the database if passed local date time values??</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13296400,"title":"MSSQL select single row with all references counted","body":"<p>I am attempting to do something using MSSQL that I believe is possible (easily) but I do not know how to vocalize the correct search string. I have the situation below.</p>\n\n<pre><code>Table A\nUID  | Value....\n1    | a\n2    | b\n3    | c\n\n\nTable B\nPartTypes_uid_fk   | Value....\n1           | a\n1           | b\n1           | c\n1           | d\n1           | e\n3           | 67\n3           | 1354\n</code></pre>\n\n<p>I am attempting to get the following result, query Table A for all results {TableA.*} and on the same row result show the number of table b references {count TableB.tableA_fk}\nWhat I have so far is the following.</p>\n\n<p><code>SELECT DISTINCT t1.uid, CONVERT(varchar(MAX), t1.Name) AS Name, CONVERT(varchar(MAX), t1.Description) AS Description, \nCount(t2.Items_uid_fk) OVER (Partition By t2.PartTypes_uid_fk) as Count \nFROM [Table1] as t1 left outer join Table2 as t2 on t2.PartTypes_uid_fk=t1.uid;</code></p>\n\n<p>This works for all of Table A records with an associated record in Table B but if there are 0 entries in Table B it won't work. The conversion of the varchars was required due to the fact they are ntext format and it was distinct.</p>\n\n<p>Thank you for all your help in advance.\nStephen</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13297530,"title":"Retrieve a column from a table then insert it to a new table","body":"<p>I just created a table in SQL 2008. This table has two columns.</p>\n\n<pre><code>CREATE TABLE [dbo].[MyTable]\n(\n[pkey] [bigint] not null,\n[Number] [int]  not null\n)\n</code></pre>\n\n<p>Now I want to insert values into it. The first column can be obtained from another table <code>dbo.OldTable</code>. It has many records and I don't want to manually insert the data. The second column <code>Number</code> can be a <code>0</code> in each row. What is the best way to do this?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13294468,"title":"Alter column in SQL Server","body":"<p>What is correct syntax for an <code>ALTER</code> statement to add a default value to an existing column?</p>\n\n<p>I can add new column with no errors:</p>\n\n<pre><code>ALTER TABLE tb_TableName ADD Record_Status varchar(20)\n</code></pre>\n\n<p>But If I try to alter existing column to apply default value by using the following statement:</p>\n\n<pre><code>ALTER TABLE tb_TableName \nALTER COLUMN Record_Status VARCHAR(20) NOT NULL DEFAULT ''\n</code></pre>\n\n<p>or</p>\n\n<pre><code>ALTER TABLE tb_TableName \nALTER Record_Status VARCHAR(20) NOT NULL DEFAULT ''\n</code></pre>\n\n<p>I have get an error: </p>\n\n<blockquote>\n  <p>Incorrect syntax near 'Record_Status'.</p>\n</blockquote>\n"},{"tags":["c#","sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13296412,"title":"The update statement works in SSMS but not in code","body":"<p>I've been beating my head against the wall for 2 days now.  This update statement works when run in ssms</p>\n\n<pre><code>update dbo.DEMOGRAPHICS \nset ETHNICITY = (select distinct(ethnicity) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = 'P000084716' and ACADEMIC_SESSION != '')\n, GENDER = (select distinct(GENDER) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = 'P000084716' and ACADEMIC_SESSION != '')\n, MARITAL_STATUS = (select distinct(MARITAL_STATUS) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = 'P000084716' and ACADEMIC_SESSION != '')\n, RELIGION = (select distinct(RELIGION) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = 'P000084716' and ACADEMIC_SESSION != '')\n, VETERAN = (select distinct(VETERAN) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID =  'P000084716' and ACADEMIC_SESSION != '')\n, CITIZENSHIP = (select distinct(CITIZENSHIP) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = 'P000084716'and ACADEMIC_SESSION != '')\n,RETIRED = (select distinct(RETIRED) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = '000084716' and ACADEMIC_SESSION != '')\n, LEGAL_RESIDENCE = (select distinct(LEGAL_RESIDENCE) from dbo.DEMOGRAPHICS where   PEOPLE_CODE_ID = 'P000084716' and ACADEMIC_SESSION != '')\nwhere PEOPLE_CODE_ID = 'P000084716'  and ACADEMIC_SESSION = ''\n</code></pre>\n\n<p>but doing the update in the code doesn't</p>\n\n<pre><code>string updDemoRecords = @\"update dbo.DEMOGRAPHICS \nset ETHNICITY = (select distinct(ethnicity) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = '{0}' and ACADEMIC_SESSION != '')\n, GENDER = (select distinct(GENDER) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = '{0}' and ACADEMIC_SESSION != '')\n, MARITAL_STATUS = (select distinct(MARITAL_STATUS) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = '{0}' and ACADEMIC_SESSION != '')\n, RELIGION = (select distinct(RELIGION) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = '{0}' and ACADEMIC_SESSION != '')\n, VETERAN = (select distinct(VETERAN) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = '{0}' and ACADEMIC_SESSION != '')\n, CITIZENSHIP = (select distinct(CITIZENSHIP) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = '{0}'and ACADEMIC_SESSION != '')\n,RETIRED = (select distinct(RETIRED) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = '{0}' and ACADEMIC_SESSION != '')\n, LEGAL_RESIDENCE = (select distinct(LEGAL_RESIDENCE) from dbo.DEMOGRAPHICS where PEOPLE_CODE_ID = '{0}' and ACADEMIC_SESSION != '')\nwhere PEOPLE_CODE_ID = '{0}'  and ACADEMIC_SESSION = ''\";\nupdDemoRecords = string.Format(updDemoRecords, peopleOrgCodeID);\npcCon = new SqlConnection(pcConnString);\nSqlCommand doUpdDemoRecords = new SqlCommand(updDemoRecords, pcCon);\npcCon.Open();\ndoUpdDemoRecords.ExecuteNonQuery();\npcCon.Close();\n</code></pre>\n\n<p>Tried it from a stored proc also and it doesn't update the relevant rows either.  It is sql server 2008 and c#.net</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3738,"score":1,"question_id":10914576,"title":"Tsql split string","body":"<p>I have a sql server 2008 r2 column containing a string which I need to split by a comma. I have seen many answers on stackoverflow but none of them work in R2. I have made sure I have select permissions on any split function examples. Any help greatly appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":29,"score":0,"question_id":13295521,"title":"I'd like to create a series of tables on which I'll loop to do some scenario analysis","body":"<p>Planning to use cursors (simply preference) to do the looping and wondering if there's a better way of setting something like this up than creating dummy tables to house the variables (eg, create table, then populate via INSERT INTO/VALUES() calls) and then selecting from those created tables into the cursors to do the looping.  </p>\n\n<p>I estimate I'll have three sets of parameters, so in setting this up I'll have three nested cursors.  </p>\n\n<p>My big question is in getting my parameters into the cursors for looping, something like this seems sloppy and I'm wondering if there's a better way (simply selecting 10,20,30 within the cursor declaration results in them being housed as columns rather than rows):</p>\n\n<pre><code>CREATE TABLE #countTable (\ncnt SMALLINT )\n\nINSERT INTO #countTable\nVALUES (10,20,30) \n</code></pre>\n\n<p>Any more efficient approaches for this type of scenario analysis?</p>\n\n<p>EDIT:  Related to the set-based comments...I'm trying to create distinct portfolios of securities with different characteristics (as described in my comment below:  X total securities, Y max single security portfolio weight, and Z sector allocation).  From what I've just read on set-based approaches, set-based logic aims to effectively borrow parts of processing for subsequent 'scenarios' (ie, if I pull the top 50 securities, I can, from the resulting set, also pull the top 40 securities rather than querying the original data set again, as the top 40 is a subset of the top 50).  </p>\n\n<p>It seems to me this would be possible for the example laid out above (ie, top 40 from top 50), but NOT for the other examples (max security allocation or sector allocation), as different scenarios aren't subsets of others as they are for the number of securities (eg, a 10% max security weight scenarios isn't either a sub- or superset of a 5% max weight scenario).  Does this sound accurate or is there something I'm missing?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13295748,"title":"sql how to insert into a column like it was an identity column","body":"<p>I have a table with three columns</p>\n\n<pre>KeyID   | nvarchar(10)  \nColumnA | nvarchar(max)  \nColumnB | Nvarchar(max)</pre>\n\n<p>What i'm trying to do is a select insert, however with keyID i need to treat it like an indentity column.</p>\n\n<p>For example if I had 3 rows I wanted to insert it would be :</p>\n\n<pre>1001 | Apple     | Pear  \n1002 | Pear      | Mango  \n1003 | Pineapple | Pine\n</pre>\n\n<p>But i'm trying to do this with an insert select, for example:</p>\n\n<pre><code>insert into myTable(KeyId,ColumnA,ColumnB) select 'x',OrigColA,OrigColB from myTableB\n</code></pre>\n\n<p>obviously 'x' is where i'm having the issue.</p>\n\n<p>Thanks in advance!</p>\n\n<p>This is no KeyId located in myTableB</p>\n"},{"tags":["c#","sql-server-2008","microsoft-sync-framework"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":6,"score":0,"question_id":13295971,"title":"SQL Server built-in Change Tracking vs Sync Framework's C#/VB libraries","body":"<p>I went into a problem where using the following code did not change the scope_id value in the replica key map and scope_info table of Sync Framework 2.1 elements in my database, on a restored database on Windows XP 32-bit / SQL Server Express 2008 (x86). It DOES work on my other client that is Windows 7 64-bit / SQL Server Express 2008 (x86) :</p>\n\n<p>SqlSyncStoreRestore databaseRestore = new SqlSyncStoreRestore(clientConn);\n                            databaseRestore.PerformPostRestoreFixup();</p>\n\n<p>SUB QUESTION 1:\nIt does not work but does not throw any exception either, which makes it much harder to troubleshoot. It is executed from a small console application (target x86) I built on my x64 computer (using Visual Studio x86). I wonder if the 32/64 bit thing is the culprit. Any clue?? But then, this made me wonder:</p>\n\n<p>SUB QUESTION 2:\n\"Is there an SQL query equivalent to using PerformPostRestoreFixup() of Sync Framework's C#?\"</p>\n\n<p>I am fairly new to Sync Framework and I do not yet entirely see the whole picture of synchronization of Microsoft SQL Server databases. It came to my attention that the SyncOrchestrator/SqlSyncProvider combo does not use built-in SQL Change Tracking stuff. Incredibly surprising to me! It now made me haunted by an even more tormenting question:</p>\n\n<p>SUB QUESTION 3:\n Is the built-in SQL Server Change Tracking and Sync Framework two totally independent platform on which to build our synchronization scheme? I hope I am using the right words in English. In other words, is each of them completely unaware of the other??</p>\n\n<p>Thanks in advance for your help! I am soooo lost LOL!</p>\n\n<p>Kind Regards,</p>\n\n<p>Zyxy</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":13293975,"title":"Month year back (SQL)","body":"<p>I m trying to dig more in the SQL query , I'm with it.</p>\n\n<pre><code>Yearmo      Back_1_month\n-------     ------------\n 201202      201201            Where 201202 is Feb 2012 , 201201 is Jan 2012\n 201201      201112            \n 201204      201203            \n 201212      201211\n</code></pre>\n\n<p>I m confused , how can make it for 201201.</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures","parameters","table-valued-parameters"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":10,"score":2,"question_id":13295050,"title":"How to organize or avoid temporary User Defined Table Type when passing Table-Valued Parameters","body":"<p>As it was discussed here: <a href=\"http://stackoverflow.com/questions/209686/passing-list-to-sql-stored-procedure\">Passing List&lt;&gt; to SQL Stored Procedure</a> and in many other places, one way to pass table as parameter is to use SqlParameter.</p>\n\n<p>The problem with this is that it requires to specify User Defined Table Type in TypeName property.</p>\n\n<p>I need to load data from an Excel file and pass it as parameter to SQL Statement which will join this data with other database tables to get the result.</p>\n\n<p>In order to do that I would need to create User Defined Table Type for each possible variation of Excel file. I don't want to pollute SQL types with those types that are used just to pass data from each Excel file. How do I achieve that ?</p>\n\n<p>You may ask how can I join something that I don't know type of - the answer is - I know names and types of some fields, but not all. Also if I want to return joined data using select * it would work with any list of fields without me hardcoding all of them inside type.</p>\n\n<p>I can't use OPENROWSET to join this file directly from SQL because I have 64 bit SQL Server and it does not work giving me strange error.</p>\n\n<p>There is concept of temporary tables in SQL Server, but there is no concept of temporary types, how do I simulate temporary type or avoid using it when passing table ?</p>\n\n<p>I could pass data as XML, but it seems less efficient if data size is large enough plus data size is limited to 2Gb.</p>\n\n<p>One way to organize it is to create type, then execute statement, then drop type after or use TRY..CATCH and drop type inside catch.</p>\n\n<p>Another is make special schema, generate unique type names into that schema and clean it from time to time using garbage collection SQL job. And it can be used in combination with first way just to clean leftovers.</p>\n\n<p>Any other suggestions ?</p>\n"},{"tags":["sql-server-2008","schema"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":209,"score":0,"question_id":5539247,"title":"How to compare schemas in SQL Server 2008","body":"<p>Can someone guide me on how can I compare schemas in SQL Server 2008.</p>\n\n<p>I want to do so to check if sql objects already exists and if they exists is there any change between the existing and the new one.</p>\n"},{"tags":["sql-server-2008","magento"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":18,"score":-3,"question_id":13294012,"title":"Magento with SQL Server","body":"<p>I have SQL Server databases and I need to install a Magento and run it against a SQL Server 2008.</p>\n\n<p>Can I do it or Magento only runs with MySQL?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13276923,"title":"local report server not showing Content and Property tab","body":"<p>I have a serious issue with my report server. </p>\n\n<p>I cannot see the Content,Properties at the Home Page. And if I click on a report, I cannot see the View, Properties, History and Subscriptions tabs.</p>\n\n<p>Below is what I see on the Home page.</p>\n\n<p>Tuesday, November 06, 2012 5:25 PM         Data Sources</p>\n\n<p>Tuesday, November 06, 2012 5:25 PM         Reports\nDoes someone know how I can get the tabs back?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","query-optimization"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13290797,"title":"Is there any potential probelm removing this ISNULL statement?","body":"<p>So recently we uncovered a long running proc and one of my colleagues pointed out that that dropping the ISNULL in the where clause sped things up for reasons pointed out in this post <a href=\"http://stackoverflow.com/questions/8924913/is-there-is-any-performance-issue-while-using-isnull-in-sql-server\">Is there is any Performance issue while using ISNULL() in SQL Server?</a>. I did some Google searching but couldn't find out for sure if there was any danger in missing data. I know if you say something like this </p>\n\n<pre><code>WHERE ID NOT IN (SELECT MemberID FROM Person WHERE MemberId IS NOT Null)\n</code></pre>\n\n<p>and MemberId is nullable you won't get any matches if you don't include the \"IS NOT NULL\" but I think that is a different issue? Maybe not? </p>\n\n<p>Here is the change my coworker is proposing. </p>\n\n<pre><code>where ISNULL(ct.DisabilityBenefitsConnectAuthorized,0) = 1\n</code></pre>\n\n<p>Would become</p>\n\n<pre><code>where ct.DisabilityBenefitsConnectAuthorized = 1\n</code></pre>\n\n<p>It doesn't seem to be effecting results however I am not 100% sure that it couldn't and we just don't know it. </p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":5564,"score":0,"question_id":7430560,"title":"How to check if cursor exists (open status)","body":"<p>How do I check if a cursor is open or not? Because many times I am encountering the error 'Cursor already exists'. Please let me know how can I check whether a cursor is already in open status.</p>\n\n<p>In fact I have closed as well as Deallocated it at the end (CLOSE ppm_cursor; DEALLOCATE ppm_cursor;) But Still i am getting the same error what could be the reason.</p>\n"},{"tags":["sql-server-2008","tsql","sql-server-2008-r2"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13291710,"title":"How to wait for a query to return results?","body":"<p>Is it possible to have a query wait until it has results instead of returning immediately with an empty result set. For example:</p>\n\n<pre><code>SELECT Column1 FROM Table1\n</code></pre>\n\n<p>If <code>Table1</code> is empty, the query would return with an empty result set. However, I want it to not return, but wait until at least one row is available, preferably with a timeout of some sort. I would prefer to do this without involving Service Broker into the equation, if possible.</p>\n\n<p><strong>Clarification:</strong></p>\n\n<p>CLR is enabled on the server, but the call is coming from a platform independent C++ program via SQLAPI++/ODBC. So, no C#/.NET tricks are possible. The goal is to make a call into a stored procedure, specify a timeout and not return until data is available (and returned by the stored proc) or the specified timeout expires.</p>\n\n<p>For example:</p>\n\n<pre><code>EXEC GetData @Timeout=2000 -- Wait for upto 5000 milliseconds for a result set to be \n                           -- available\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","formatting","sql-update"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13291207,"title":"how to format date in sql server","body":"<p>I am trying to update a date field in my table but would to convert the date format into dd/mm/yy.\n    i have tried this method but it is still showing like this yyyy-mm-dd</p>\n\n<pre><code> UPDATE MyTable \n        SET MyField = convert (varchar,GETDATE(), 101)\n       where ID = '221'\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","azure","named-instance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13279378,"title":"Cannot connect to a SQL Server 2008 named instance hosted in a azure virtual machine","body":"<p>When I try to connect to a named instance in a SQL Server hosted in a Azure VM, I get this message: </p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: SQL\n  Network Interfaces, error: 26 - Error Locating Server/Instance\n  Specified) (Microsoft SQL Server, Error: -1)</em></p>\n</blockquote>\n\n<p>The problem is the SQL Server browser is not working properly, when I start the browser service it closes after a few seconds and the event log says </p>\n\n<blockquote>\n  <p><em>There are no instances of SQL Server or SQL Server Analysis Services.</em></p>\n</blockquote>\n\n<p>But I do have a named instance, I can connect locally to this instance.</p>\n\n<p>I've re-installed SQL Server browser and the instance but ii does not work.</p>\n\n<p>The host is an Azure virtual machine Windows Server 2008 datacenter.</p>\n\n<p>Please help.</p>\n\n<p>Thank you</p>\n\n<p>UPDATE 11/08/2012\nIn fact I can connect to the default instance remotely, but I cannot do it with the named instance, by example, I connect remotely with the dns: , but if I try with \\UAT, I cannot connect.</p>\n\n<p>UPDATE\nWell, it seems the problem is when someone tries to connect to a named instance the port 1434 for the SQL Browser must be open, so that means we need to create that endpoint in the azure management portal, the problem is the sql browser looks for the named instance and answer with a dynamic port. At the end I thought it was a lot of trouble to configure all that and anyways my sql browser was not detecting my named instance so I decided to create a new endpoint to listen for the named instance and assign an static port to that instance, now I can connect with the IP/Port. I'm still curious how can I configure the Azure VM, SQL Browser, SQL Sever and firewall to be able to connect with the dns/instance using the SQL Browser. </p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13292632,"title":"Removing the rows from the select after processing","body":"<p>I have to a table like this</p>\n\n<pre><code>Year Month\n2012  8\n2012  7\n2012  4\n2012  3\n2011  7\n2011  3\n2011  1\n2010  10\n2010  9\n2010  8\n</code></pre>\n\n<p>This tables show which month and year is remaning, now let say I have completed 2012, 7 month. Now I want to have list like </p>\n\n<pre><code>Year Month\n    2012  8\n    2012  4\n    2012  3\n    2011  7\n    2011  3\n    2011  1\n    2010  10\n    2010  9\n    2010  8\n</code></pre>\n\n<p>I am using below query but this is not giving me the correct records</p>\n\n<pre><code>SELECT YEAR, MONTH from tablex\nWHERE Year NOT IN (SELECT DISTINCT YEAR from OTHER_TABLE INNER JOIN Some_Other_Table)\nAND  MONTH NOT IN (SELECT DISTINCT MONTH FROM OTHER_TABLE INNER JOIN Some_Other_Table)\n</code></pre>\n\n<p>When OTHER_TABLE is null then I am getting the currect count, but when Other table has year 2012 and month 7 I am getting no results.</p>\n\n<p><strong>P.S.: There is no joining columns available for tablex and OTHER_TABLE and Som_Other_Table</strong></p>\n"},{"tags":["sql","sql-server-2008","sql-server-express"],"answer_count":3,"favorite_count":3,"up_vote_count":0,"down_vote_count":0,"view_count":2695,"score":0,"question_id":7313103,"title":"create table permission denied in database 'master'","body":"<p>I have installed the free version of sql server 2008 (sql server management studio express edition) on my PC. After installation I get the following error</p>\n\n<pre><code>create table permission denied in database 'master'\n</code></pre>\n\n<p>I tried reinstalling several times, but I keep getting the same error. When i checked </p>\n\n<pre><code>select user_account();\n</code></pre>\n\n<p>It showed that I was logged in as guest. How do I solve this? since I am not permitted to create a new login. </p>\n"},{"tags":["sql","sql-server-2008","telerik","telerik-grid"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13292090,"title":"sql date difference issue","body":"<p>I am working on a telerik gridview and I supposed to display a warning on certain conditions and 1 of them is that:</p>\n\n<p>if the due date is bigger than today's date and also the warning days are 3, then it will show all the records who's due date is bigger than today but only if they come with in warning period then it supposed to show.</p>\n\n<p>so if today's date is  22-12-2012 and due date is 25-12-2012 and warn days are 3 then it should select that record</p>\n\n<p>what I tried so far:</p>\n\n<pre><code> DateTime dtTodayDate = DateTime.Today;\n   string strTodayDate = dtTodayDate.ToString(\"yyyy/MM/dd 00:00:00\");\n    strFilter += @\"OR ( [DueDate] &gt;= #\" + strTodayDate + @\"# AND [Warn_Days] &gt; 0 AND [DueDate] - [Warn_Days] =#\" + strTodayDate + @\"# )\";\n</code></pre>\n\n<p>Cannot perform '-' operation on System.DateTime and System.Int32. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1159,"score":1,"question_id":7700216,"title":"get the date and time for today at midnight and add to it","body":"<p>Is there a sql command to get today's date at midnight and be able to add a number of minutes to it?</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008"],"answer_count":6,"favorite_count":3,"up_vote_count":13,"down_vote_count":0,"view_count":17167,"score":13,"question_id":545316,"title":"Is it possible to restore Sql Server 2008 backup in sql server 2005","body":"<p>Is it possible to restore a backup of a SQL Server 2008 database onto an instance of SQL Server 2005?</p>\n\n<p>I need to work on an sample application for which database backup is in sql server 2008.\nBut I'll not be able to install 2008. So is it possible to restore that back up in 2005?</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13289214,"title":"consecutive dates and appointments in sql","body":"<p>I've got a sql table that holds engineer, appt_date and appt_slot. </p>\n\n<pre><code>engineer_id, visit_date, visit_slot\n\n1,           20/10/12,   All Day\n1,           21/10/12,   AM\n2,           20/10/12,   All Day\n2,           21/10/12,   All Day\n2,           22/10/12,   All Day\n3,           20/10/12,   PM\n3,           21/10/12,   All Day\n3,           22/10/12,   PM\n</code></pre>\n\n<p>What I'd like to show is</p>\n\n<pre><code>Engineer_id, start_visit,      end_visit\n\n1,           20/10/12 All Day, 21/10/12 AM\n2,           20/10/12 All Day, 22/10/12 All Day\n3,           20/10/12 PM,      21/10/12 All Day\n3,           22/10/12 PM,      22/10/12 PM\n</code></pre>\n\n<p>I'm struggling with the sql to show the breaks in the bookings, any help would be greatly appreciated.\nThanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13290325,"title":"Output parameter in stored procedure is null","body":"<p>I can't seem to get the output parameter right, it's empty where I'm exepecting 'TEMPTABLE'?</p>\n\n<pre><code>create table TEMPTABLE\n(\n  Id int identity primary key,\n  Name nvarchar(50) not null,\n);\nGO\n\ninsert into TEMPTABLE(Name) values('Name 1');\nGO\n\nDECLARE @PARMOUTP nvarchar(50)\nDECLARE @ParameterDefinition AS NVARCHAR(2000)\nDECLARE @DestTable VARCHAR(50)\ndeclare @sql nvarchar(max)\n\n    set @sql = 'SELECT   OBJECT_NAME(OBJECT_ID) AS TABLENAME \n                FROM     SYS.IDENTITY_COLUMNS  \n                WHERE OBJECT_NAME(OBJECT_ID) = @DestTable'\n\nset @DestTable = 'TEMPTABLE'\n\nset @ParameterDefinition = '@DestTable VARCHAR(50), @PARMOUTP VARCHAR(50) OUTPUT'\n\n\nEXECUTE sp_executesql @sql,\n                  @ParameterDefinition,\n                  @DestTable,\n                  @PARMOUTP OUTPUT\n\nprint @PARMOUTP;\nprint isnull(@PARMOUTP, 'PARMOUTP is null!');\n</code></pre>\n\n<p>What am I doing wrong here?</p>\n\n<p>Regards,</p>\n\n<p>Mike</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13290889,"title":"SQL Server -- Efficient String Contains Over Very Large Tables","body":"<p>I have a table that currently contains 10 million records.</p>\n\n<p>One of the columns is <code>SourceText</code> of type <code>nvarchar(4000)</code>.</p>\n\n<p>I need a <em>very</em> efficient way to search the SourceText to see if it contains another string. </p>\n\n<p>I have extreme flexibility will the table structures--I can modify the insert procedure and use other, better indexed tables to track things.  One thought was to  tokenize the SourceText by word and store the words in an indexed table, then use a mapping table to map to the main table.  The problem is that the <code>SourceText</code> column can be any language, and there are always rules re:parantheses, etc.  For example, in english if I tokenize using ' ' as the delimiter, I will still get things like <code>(Where</code> instead of <code>Where</code>, which is problematic.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13289446,"title":"database email with attachement(excel file / pdf file)?","body":"<p>I've to send a mail from database to my mail-id with attachment.</p>\n\n<pre><code>EXEC msdb.dbo.sp_send_dbmail\n    @profile_name = 'Adventure Works Administrator',\n    @recipients = 'danw@Adventure-Works.com',\n    @query = 'SELECT COUNT(*) FROM AdventureWorks2012.Production.WorkOrder\n                  WHERE DueDate &gt; ''2004-04-30''\n                  AND  DATEDIFF(dd, ''2004-04-30'', DueDate) &lt; 2' ,\n    @subject = 'Work Order Count',\n    @attach_query_result_as_file = 1 ;\n</code></pre>\n\n<p>from this code i'm getting result in txt file. but <strong>i want to get query result in pdf file or excel file</strong></p>\n\n<p>anybody known means please share with me.</p>\n\n<p>advance thanks !!! :)</p>\n"},{"tags":["sql-server-2008","tsql","select"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13288608,"title":"sql return data from select statement and insert to table variable at the same time","body":"<pre><code>declare @RelevantMachines Table (MachineId int)\n\nSelect MachineId, ClusterId, MachineGuid, MachineName, RegisteredDate, MachineDetail, LastServiceCall, MachineType as MachineTypeId, ProductSetId\nFrom PatchHub.Machine\nWhere ClusterId = @ClusterId\n</code></pre>\n\n<p>I would like to be able to return the select statement as a result set whilst at the same time populating the table variable with all of the returned rows MachineId values, this is in sql server 2008. How could you achieve this without running the select statement twice?</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":143,"score":0,"question_id":9482640,"title":"SQL Server - stored procedure","body":"<p>I am trying to create a stored procedure in SQL Server 2008. According to the parser, the syntax is OK. However, when I try to execute the stored procedure and pass actual values, the following error comes up:</p>\n\n<blockquote>\n  <p>Msg 201, Level 16, State 4, Procedure\n  SaveOneTimeDonation, Line 0<br>\n  Procedure or function 'SaveOneTimeDonation' expects parameter '@donation', which was not\n  supplied.</p>\n</blockquote>\n\n<p>Strange enough, the data is actually inserted into the table so I don't know why it is displaying this error.</p>\n\n<p>How can I solve this problem please?  Here is the code:</p>\n\n<pre><code>SET ANSI_NULLS ON\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROC [dbo].[SaveOneTimeDonation]\n  @donation float,\n  @date nvarchar\nAS\n   INSERT INTO OneTime_Trans(Donation, Trans_Date) VALUES (@donation, @date)\n\n   exec SaveOneTimeDonation\n</code></pre>\n"},{"tags":["sql-server-2008","sql-update","rownumber"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":574,"score":0,"question_id":11116757,"title":"how to set column value equal to row no?","body":"<p>How can i set value of column that has been added after altering table equal to row no in sql server 2008. That is i want value of the column equal to no. of row. I also want this field to allow NULL values. So it is like auto increment but allowing null values that's why don't want to use identity or primary key column with auto increment. So how can it be set to row no? Any help will be appreciated.</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2008","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13287694,"title":"Getting row right after insert returns no result","body":"<p>I am running unit tests and when I try to insert data in the database and getting it right after, I don't get anything (I have tried with <code>DataAdapter</code> and <code>DataReader</code>).</p>\n\n<p>However when I put a 3 seconds sleep (even with 1 second it doesn't work...) between the insert and the select I get the result.</p>\n\n<p>In SQL Server Profiler I can see the execution, the insert is well done and is completed about 10 miliseconds before the select begins.</p>\n\n<p>I can't find out where this comes </p>\n\n<p>The code looks like this :\nInsert method</p>\n\n<pre><code>SqlCommand command = new SqlCommand(sqlTemplate);\ncommand.Parameters.Add(Sql4oConstants.Sql4oIdParameterName, SqlDbType.UniqueIdentifier).Value = id;\ncommand.Parameters.Add(Sql4oConstants.Sql4oTimestampParamterName, SqlDbType.DateTime).Value = DateTime.Now;\n\ncommand.CommandTimeout = dataSourceDescription.CommandTimeout;\nDatabaseManager.ExecuteNonQuery(dataSourceDescription.ConnectionString, command);\n</code></pre>\n\n<p>Get method</p>\n\n<pre><code>public static void Fill(string connectionString, DataTable table, SqlCommand command)\n    {\n        try\n        {\n            LogStorageWriter.WriteLogEntry(log, EStorageLevelLog.Debug, string.Format(\"Execute query: {0}\", command.CommandText));\n\n            using (SqlConnection conn = new SqlConnection(connectionString))\n            {\n                command.Connection = conn;\n                using (SqlDataAdapter adapter = new SqlDataAdapter(command))\n                {\n                    adapter.Fill(table);\n                }\n            }\n        }\n        catch (InvalidOperationException e)\n        {\n            LogStorageWriter.WriteLogEntry(log, EStorageLevelLog.Error, string.Format(\"Exception : {0}\", e.ToString()));\n        }\n    }\n</code></pre>\n"},{"tags":["sql","sql-server-2008","sql-agent"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1519,"score":0,"question_id":5748526,"title":"SQL Agent -- Mail Error 5.7.1 Client does not have permissions to send as this sender","body":"<p>So I have recently configured an entire lab environment with the following servers:</p>\n\n<p>Domain: mytekkilab.com</p>\n\n<p>Server 1: DC-08-01\nServer 2: SQL-03-01\nServer 3: MAIL-08-01\nServer 4: TS-08-01\nServer 5: WS-08-01</p>\n\n<p>My terminal server (TS-08-01) has Microsoft Office installed with outlook configured on user sqlagent@mytekkilab.com. Sends and receives e-mail fine from the exchange server (2007 SP3 -- MAIL-08-01). The problem lies within the SQL Agent Database Mail. When configuring the profile and the account using sqlagent. I try to send a test e-mail and get the following line wihtin my mail log of the sql server:</p>\n\n<blockquote>\n  <p>04/21/2011 11:22:05,,Error,23,The mail\n  could not be sent to the recipients\n  because of the mail server failure.\n  (Sending Mail using Account 2\n  (2011-04-21T11:22:05). Exception\n  Message: Cannot send mails to mail\n  server. (Mailbox unavailable. The\n  server response was: 5.7.1 Client does\n  not have permissions to send as this\n  sender). ),256,10,,4/21/2011 11:22:05\n  AM,sa</p>\n</blockquote>\n\n<p>I have been researching for the last 2.5 hours and cannot seem to find a solution to this issue. If you can please let me know when you think. Again smtp works for this user everywhere. OWA, Outlook, command smtp etc...</p>\n\n<p>Thanks for your help in advance!\n-Mike D</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":871,"score":0,"question_id":3260392,"title":"SQL Server Difference (opposite of intersect)","body":"<p>Looking for the easist/most scalable way to do a set \"difference\" in SQL Server see below.\n<img src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Venn0110.svg/384px-Venn0110.svg.png\" alt=\"alt text\"></p>\n\n<p>If you can't tell from the picture i am looking for everything that is not in the intersection.  </p>\n\n<p>I have seen one way to do it:</p>\n\n<pre><code>select * from (      \n    (select 'test1' as a, 1 as b)\n union all\n  (select 'test2' as a , 2 as b union all select 'test1' as a , 1 as b )\n)un group by a,b  having count(1)=1\n</code></pre>\n\n<p>But i fear what would happen if i used two large sets (i will not be querying from select '' constant statements, my queries will be pulling from real tables.)</p>\n\n<p><em>EDIT:</em></p>\n\n<p>Possible solution...</p>\n\n<pre><code>drop table #temp_a;\ndrop table #temp_b;\n\n go\n\n\n  select * into #temp_a from (\n   select 1 as num, 'String' as two, 'int'as three, 'purple' as four union all\n   select 2 as num, 'dog' as two, 'int'as three, 'purple' as four union all\n   select 3 as num, 'dog' as two, 'int'as three, 'cat' as four ) a \n\nselect * into #temp_b from (\n  select 1 as num, 'String' as two, 'decimal'as three, 'purple' as four union all\n  select 2 as num, 'dog' as two, 'int'as three, 'purple' as four union all\n  select 3 as num, 'dog' as two, 'int'as three, 'dog' as four ) b \n\n\n\n\n\n   SELECT IsNull(a.num, b.num) A,IsNull(a.two, b.two) B, IsNull(a.three, b.three) C,                  \n      IsNull(a.four, b.four) D \n     FROM #temp_a a \n   FULL OUTER JOIN #temp_b b ON (a.num=b.num AND a.two=b.two and a.three=b.three and a.four=b.four)\n    WHERE   (a.num is null or b.num is null  )\n</code></pre>\n\n<p>RESULTS:  </p>\n\n<blockquote>\n  <p>1 String  int purple </p>\n  \n  <p>3 dog int cat</p>\n  \n  <p>1 String  dec purple</p>\n  \n  <p>3 dog int dog</p>\n</blockquote>\n"},{"tags":["sql-server-2008"],"answer_count":7,"favorite_count":4,"up_vote_count":35,"down_vote_count":0,"view_count":24521,"score":35,"question_id":2962927,"title":"A transport-level error has occurred when receiving results from the server","body":"<p>I'm getting a SQL Server error:</p>\n\n<blockquote>\n  <p>A transport-level error has occurred\n  when receiving results from the\n  server. (provider: Shared Memory\n  Provider, error: 0 - The handle is\n  invalid.)</p>\n</blockquote>\n\n<p>I'm running Sql Server 2008 SP1, Windows 2008 Standard 64 bit.</p>\n\n<p>It's a .net 4.0 web application. It happens when a request is made the server. It's intermittent. It happens every couple times. </p>\n\n<p>Any idea's?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13284650,"title":"to display all records from one table and sum of rows from another table","body":"<p>I have two tables HouseKeeping with fields RoomNo,FloorNo,StockItem,Requirement and Stock table with fields Item ,Available.I want to select all rows from HouseKeeping table and sum of requirement from stock table.I have used this query to get sum of requirement from stock table</p>\n\n<p><code>SELECT SUM(Requirement) AS Requirement, StockItem\nFROM  HouseKeeping\nGROUP BY StockItem</code></p>\n\n<p>in addition to this i also want all records(select * from Stock).How to do it? please reply as soon as possible.Thanks</p>\n"},{"tags":["sql-server-2008","wireshark","packet","sql-management-studio","tds"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13284419,"title":"Missing values of rowguid and ModifiedData in packets between SQL Server and clients","body":"<p>I captured packets, which are sent between SQL Server and clients, with Wireshark.</p>\n\n<p>I found all field names and field values according to TDS protocol.</p>\n\n<p>But I couldn't find column data of <code>rowguid</code> and <code>ModifiedData</code> in those packets even though values of <code>rowguid</code> and <code>ModifiedData</code> seen in my clinet application based on SMO (Server Management Object).</p>\n\n<p>Why?</p>\n\n<p>How can I see column data of <code>rowguid</code> and <code>ModifiedData</code> in packets?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13284293,"title":"How to store array or record in SQL Server 2008","body":"<p>Anyone please tell me how to store n x n matrix data into SQL Server 2008?</p>\n\n<p>I want to store thousand of pieces of data into SQL Server at the same time from my ASP.NET page so if I pass an array of row and column then how can I store at the same time in SQL Server</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13274556,"title":"SQL Conversion Error","body":"<p>I really need a second pair of eyes on this... I have a Stored Procedure with a variable:</p>\n\n<pre><code>DECLARE @date_period_end int \n\nIF @date_period_end = '' or @date_period_end is null  \nBEGIN \n    SET @date_period_end = 'DATEDIFF(dd, ''1/1/1753'', CONVERT(datetime,getdate())) + 639906 ' \nEND\n</code></pre>\n\n<p>Here is the error SQL returning when I execute:</p>\n\n<blockquote>\n  <p>Conversion failed when converting the varchar value 'DATEDIFF(dd, '1/1/1753', CONVERT(datetime,getdate())) + 639906 ' to data type int.</p>\n</blockquote>\n\n<p>I'm pretty certain I'm missing or have added an incorrect amount of quotes somewhere.  Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13282785,"title":"One table with redundant data in one column vs Multiple tables","body":"<p>I have a scenario wherein I have users uploading their custom preferences to the conversion being done by our utility. So, the problem we are facing is </p>\n\n<blockquote>\n  <p>should we keep these custom mappings in one table with an extra column of UID or maybe GUID\n  , </p>\n</blockquote>\n\n<p>or </p>\n\n<blockquote>\n  <p>should we create tables on the fly for every user that registers with us and provide him/her a separate table for their custom mappings altogether? </p>\n</blockquote>\n\n<p>We're more inclined to having just an extra column and one table for the custom mappings, but does the redundant data in that one column have any effect on performance? On the other hand, logic dictates us to normalize our tables and have separate tables. I'm rather confused as to what to do.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13283410,"title":"SQL Server : each group by expression must contain at least one column that is not an outer reference -On Turk colition","body":"<p>I get this error </p>\n\n<blockquote>\n  <p><em>each group by expression must contain at least one column that is not an outer reference</em></p>\n</blockquote>\n\n<p>I am inserting date into a temp table, and error is at the following group by query(only on some collation)</p>\n\n<pre><code>insert into @Temp(Name, ID)\n   select \n      USR.Name,\n      ISNULL((SELECT SUM(BCR.QUANTITY) \n              FROM Rate BCR            \n              WHERE BCR.RateID = USR.RateID \n              GROUP BY USR.RateID), 0) AS TotalQuantity\n   from \n      dbo.User as USR\n   where \n      USR.Status = 1\n</code></pre>\n"},{"tags":["c#","sql-server-2008","asp.net-mvc-2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":15,"score":-1,"question_id":13283661,"title":"Populating an empty list with values from a linq query in mvc2 ASP.NET","body":"<p>I have 3 tables. One named 'Participant' , the other named 'Employee' and the last one as 'Attendance Track'. I want to display participants who are not in the Attendance Track table during updation. The viewing needs to be done in a dropdownlist.</p>\n\n<p>Can anyone please tell me how can i do it? I am new to MVC.</p>\n"},{"tags":["sql-server-2008","table","backup"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13283359,"title":"how to create backup file of table with data but not script of file in sql server 2008?","body":"<p>i am trying to create a backup file of table with data in sql server 2008.\ni don't want to create script of table . is there any way to create log file of table so that we can take backup of table's data ? \nPlease help me out asap.\nThanks in advance </p>\n"},{"tags":["visual-studio-2010","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13281434,"title":"SQL Server Management Studio server name only hostname","body":"<p>What is the problem of my SQL Server Management Studio 2008 when there are no other items appears in the <code>Server Name</code> selection box? The item only available to select is the host name (e.g. <code>JED-PC</code>)</p>\n\n<p>It supposed to show server as name like the image below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/803XT.jpg\" alt=\"enter image description here\"></p>\n\n<p>I installed SQL Server 2008 Express. When I try to to re-intall SQL Server Express it only suggest to install SQL Server instance. </p>\n\n<p>I need this to solve this so that I can connect the connection string of my VS project setup to the <code>.\\sqlexpress</code> instance.</p>\n\n<p>There is no problem when I login using the server name. I can attach a database to it. But I can't connect because the instance needed in connection string is for SQL Server Express. </p>\n\n<p>How can I fix this? When i run the application the computer it says cannot access network instance, error - 26.</p>\n"},{"tags":["c#","winforms","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":20,"score":-1,"question_id":13283079,"title":"Use grid values from one page to another page function window application","body":"<p>  How i can use grid values from one page to another page function definition.  </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":38,"score":0,"question_id":13269638,"title":"Custom Group By and place some records in one group","body":"<p>please consider data:</p>\n\n<pre><code> Id          Group            Value\n -----------------------------------\n 1            1                10\n 2            1                12\n 3            1                10\n 4            2                90\n 5            2                10\n 6            3                30\n 7            4                12\n 8            4                11\n 9            5                10\n 10           5                11\n</code></pre>\n\n<p>I want to do <code>Group By</code> on this data as <code>1,2,3</code> place in one group and <code>4,5</code> place in another group. How I can do this with <code>SQL Server</code>?</p>\n\n<p>thanks</p>\n\n<hr>\n\n<p><strong>Edit 1)</strong></p>\n\n<p>I want this result:</p>\n\n<pre><code>Groups                              Count\n-----------------------------------------\nGroup for 1,2,3                       6\nGroup for 4,5                         4\n</code></pre>\n"},{"tags":["c#","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13278669,"title":"Creating Images from SQL Server BLOBs is painfully slow","body":"<p>Has anyone had any issues when converting a BLOB (jpg) from SQL Server 2008 to a file on your file system?  It's taking upward of 5-8 seconds for the blob to be retrieved then file created</p>\n\n<p>ultimately I'm gonna store the filepaths and do quick lookups like that but for the initial hit per jpeg, it takes a long time to create the file and I have to assume there's a way to make it faster or I'm just doing it wrong or in an inefficient way in C#.  </p>\n\n<p>Here's how I'm getting it from the DB:</p>\n\n<pre><code>memberPhoto.PhotoBinary = (byte[])reader.GetValue(ordinals[(int)Enums.MemberPhotoColumn.PhotoBinary])\n</code></pre>\n\n<p>Here's how I'm creating the file off that:</p>\n\n<pre><code>        using (FileStream file = File.Create(photoPhysicalFilepath))\n        {\n            BinaryWriter writer = new BinaryWriter(file);\n            writer.Write(photoBinary);\n            writer.Flush();\n        }\n\n        return relativePhotoFilePath;\n</code></pre>\n\n<p>photoBinary is the byte[] value I got from the datareader.</p>\n\n<p>Not sure if this is efficient.  I've seen people go this route but don't understand if this is an old way to do it and I've found a more syntactically elegant way of doing it or if my way is just a more elegant way I've found:</p>\n\n<pre><code>                 fs = new FileStream(FilePath, FileMode.Create);\n\n                    fs.Write(imageData, 0, imageData.Length);\n                    fs.Close();\n\n                    MimeType = image.MIMEType;\n\nwhere imageData is again a byte[]\n</code></pre>\n\n<p>So I'm wondering if anyone has done it my way or do you typically go with the second syntax...has there been any performance gains from the second vs. first on a large scaled website that anyone has encountered?</p>\n\n<p>ultimately just trying to figure out why it's taking so long for the blob to file creation.</p>\n"},{"tags":["visual-studio","sql-server-2008","visual-studio-2012","sql-server-2012","downgrade"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13280859,"title":"Cannot open database.mdf after opening in Visual Studio 2012","body":"<p>Ive been working on some stuff with Visual Studio 2008, and SQL 2008 aswell..\nThen i opened the project on another computer with 2012 version.</p>\n\n<p>And now when im trying to work with the files in 2008 again, i cant open my database.mdf, becouse the 2012 sql has upgraded my database file...</p>\n\n<p>Anything i can do to save it?\n(Btw. the data aint that important, but more the whole table setup and relations)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","hierarchical-data"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13280265,"title":"Flattening a SQL hierarchical data structure in SQL without cursors","body":"<p>Let's say I have the following table</p>\n\n<pre><code>SectionID ParentIDSection DatumID\n   1           NULL         1\n   2            1           2\n   3            1           3\n   4            2           4\n</code></pre>\n\n<p>Now, let's  pretend I want to select all DatumIDs under SectionID = 1, even if it is part of its descendants children so that I would get</p>\n\n<pre><code>SectionID DatumID\n  1         1\n  1         2\n  1         3\n  1         4\n</code></pre>\n\n<p>Is it possible to this without explicitly iterating over the first table recursively with a cursor?</p>\n"},{"tags":["php","sql-server","sql-server-2008","doctrine2","freetds"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13280717,"title":"SELECT problems with Doctrine and MS SQL 2008","body":"<p>We have written an application using Doctrine2, which works great when used with a MySQL or Postgres database.</p>\n\n<p>We now connected the application with a SQL Server 2008 database using <a href=\"http://de3.php.net/manual/en/ref.pdo-dblib.php\" rel=\"nofollow\">PDO Driver DBLib</a> which uses the <code>FreeTDS</code> implementation for the Tabular DataStream protocol, which is shared by SQL Server and Sybase.</p>\n\n<p>The initial schema creation, transactions and <code>INSERT</code>s into the tables work fine .. after some tweaking of the Doctrine <code>SQLServerPlatform</code> and our MSSQL Driver package. </p>\n\n<p>But when selecting data, we face the following error:</p>\n\n<pre><code>General error: 20019 Attempt to initiate a new Adaptive Server operation with results pending\n</code></pre>\n\n<p>After plenty of googling I found <a href=\"http://www.freetds.org/faq.html#pending\" rel=\"nofollow\">this detail in the FAQ of FreeTDS</a>:</p>\n\n<blockquote>\n  <p>If you are accustomed to programming with other database servers, you may be surprised when you first encounter this aspect of the TDS protocol.  [...]<br><br>The server requires the client either to read all the results from a query, or to indicate that no further rows are desired i.e., to issue a cancellation. Until one of those two things happens, the server will not accept new queries on that connection. It will complain about \"pending results\".</p>\n</blockquote>\n\n<p>So the cause for the error message is that for some reason, Doctrine (DBAL->PDO->FreeTDS) did not read all the result rows from the connection buffer, and the server / library doesn't allow the application to issue a new <code>exec()</code>/<code>execute()</code> until all rows are read.</p>\n\n<ul>\n<li>Is my understanding right that <code>$doctrinequery-&gt;getResults()</code> fetches all results before it returns?</li>\n<li>Is my understanding right that <code>$entity-&gt;getLinkedEntity()</code> (i.e. <code>$user-&gt;getGroupNames()</code>) fetches all results before it returns?</li>\n<li>How would you tackle down where exactly the problem is? <br>The stacktraces are not helping me and the codebase is already grown.</li>\n<li>Did anybody else already have this problem and can share some insights?</li>\n<li>Is there an alternative we can use to connect Doctrine to MSSQL which does not suffer this problem?</li>\n</ul>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13279770,"title":"Silently corrupted table after power-related shutdowns, records missing, scrambled?","body":"<p>Have a ssvr 2008 db, about 10gb.  About 50 tables, 5 or so are frequent read/write, the rest are weekly write (append only), occasional read.</p>\n\n<p>The server came up and down a couple times over the past week due to Sandy (gracefully, from what I can tell, it's on a UPS).  Today, it was noticed a lot of records in a single table (one of the weekly write ones) were missing (everything from september forward to the first write after the last power issue).  The newest records added after the last restart are fine.  The surviving records before september are mostly correct, except the data in two columns (nvarchar(50) and nvarchar(100)) has been uniformly replaced with dates (YYYY-MM-DD) and bytes (ranging from 0 to 192).  The dates and bytes don't have any particular relation I can see to the data that should be there or the other columns in that table.</p>\n\n<p>I'm fetching backups for before and after each outage so I should be able to recover, but I'm a bit disturbed - how'd this happen without any events in the log or CHECKDB errors?  What could cause this?</p>\n"},{"tags":["sql-server","sql-server-2008","case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13278148,"title":"case statement to select multiple rows at once","body":"<p>I am looking to pull the same columns from two different tables, based on a conditional argument.</p>\n\n<p>So i have stumbled upon the CASE statement which I have not used much before. I have found this will work for me in this mannor, but I would like it if I could do one CASE statement and then select the columns i need, rather then doing it per column.</p>\n\n<p>Here is an example of what I have and working, just seems a little redundant.</p>\n\n<pre><code>SELECT TOP(10)\n    u1.userid as userid,\n    version = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN 3\n        ELSE 4\n    END,\n    nameOrg = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN CONVERT(NVARCHAR, u1.title)\n        ELSE CONVERT(NVARCHAR, u2.title)\n    END,\n    nameContact = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN CONVERT(NVARCHAR, u1.contact)\n        ELSE CONVERT(NVARCHAR, u2.contact)\n    END,\n    pltName = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN p1.name\n        ELSE p2.name\n    END\nFROM\n    usr1 u1\nLEFT OUTER JOIN\n    usr2 u2\n    ON u1.userid = u2.userid\nLEFT OUTER JOIN\n    plt2 p2\n    ON u2.pltid = p2.pltid\nLEFT OUTER JOIN\n    plt1 p1\n    ON u1.pltid = p1.pltid\n</code></pre>\n\n<p>Any advise?</p>\n\n<ul>\n<li>Edit mov 7, 5:22: added join to plt table and pltName case, to add to required functionality.</li>\n</ul>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":14,"score":-1,"question_id":13273869,"title":"Update sql column by adding two fields together","body":"<p>I have a table with several columns.  I need to add data from one column(money) to another column(money) and then update then table row by row. </p>\n\n<p>I have tried select this creates a tempory column but no data gets saved into database</p>\n\n<p>I have tried insert but I need the new total to update into the field that is calculating</p>\n\n<p>I think my solution is an update but so far this is not working for me.</p>\n\n<p>Before update;</p>\n\n<pre><code>ID  ColumnNameCurrent   ColumnNameYTD\nA               20.20                       89.60 \nb               55.00                       147.38\nc               60.98                       258.46\nd               38.43                     7,894.32\n</code></pre>\n\n<p>After Update (what I hope for)</p>\n\n<pre><code>ID  ColumnNameCurrent   ColumnNameYTD\nA    20.20                    109.80 \nb    55.00                    202.38 \nc    60.98                    319.44 \nd    38.43                   7,932.75 \n</code></pre>\n\n<p>What I think the code should be;</p>\n\n<pre><code>UPDATE TableName\nSET ColumnNameYTD = ColoumNameYTD + ColumnNameCurrent\n</code></pre>\n\n<p>Can you please explain to me what I can change in the above to get the desired results.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13278147,"title":"Iterate through sql script using different values","body":"<p>Here is part of my script:</p>\n\n<pre><code>DECLARE @dataId int = 123               \n\n-- Here I run more SQL scripts using @dataId\n\nSelect from table A where id = @dataId \n\n-- So on it goes in other tables and delete and update other tables\n</code></pre>\n\n<p>My question is there a way I can enter 100 values in <code>@dataId</code> and it will iterate through the script in an order? Is there a simpler way to do this in SQL Server 2008 rather then manually entering <code>@dataId</code> each time?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":1,"view_count":23,"score":1,"question_id":13277056,"title":"How to check SQL Server Performance Tuning for Stored Procedures","body":"<p>I'm creating a stored procedures for an application that will generate some business logic in <a href=\"/questions/tagged/sql-server\" class=\"post-tag\" title=\"show questions tagged 'sql-server'\" rel=\"tag\">sql-server</a>.  How can I check performance of stored procedures like speed,accuracy etc. \nAny ideas or direction will be much appreciated</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13275431,"title":"Finding the total amount for my query","body":"<p>I have a query that allows me to retrieve customer orders.</p>\n\n<pre><code>Select ID, OrderID, Item, Price from customerOrders\nWhere Order = 1\n</code></pre>\n\n<p>is there a way of totalling up the final amount to pay and have it visible below, but still be able to view all details needed in the sql query, for example</p>\n\n<pre><code>ID    |  OrderID |  Item  | Price\n1     |   1      |  Book  | 9.99\n2     |   1      |  DVD   | 12.99\n\n                    total = 22.98\n</code></pre>\n\n<p>Many thanks in advance</p>\n"},{"tags":["sql","sql-server-2008","database-design","denormalization"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":58,"score":-1,"question_id":13255736,"title":"Does table size have an effect on a denormalized database?","body":"<p>I am designing a duplicate of an existing database, and moving all the old data to it for reporting purposes. I have to denormalize the tables to improve the reporting performance, so I am trying to figure out which tables to join.</p>\n\n<p>I have examined the table relationships and have made a list of parent/child tables respectively, but I have also found that some of the tables have around 30 columns each. </p>\n\n<p>Will this have a negative effect on the performance if I join these tables in a denormalized database?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13267949,"title":"Update field in Source table with Identity after insert target with merge statement","body":"<p>I have a table Items which should have a corresponding record in the table LanguageText. The ID (Identity) of LanguageText is registered in the Items.LanguageTextId field in my Items table.</p>\n\n<p>What I want to accomplish is a merge between LanguageText and Items for all records with null in Items.LanguageTextId and insert the itemname / text of these Item records in LanguageText plus update the LanguageTextId with the ID value from the newly inserted LanguageText record (SCOPE_IDENTITY()?)</p>\n\n<p>The insert works fine:</p>\n\n<pre><code>MERGE [dbo].[LanguageText] AS target\nUSING (SELECT [Items].* from [dbo].Items ) AS source \nON (TARGET.Id = SOURCE.LanguageTextId) \nWHEN NOT MATCHED By Target THEN \n    INSERT   \n       ([Text])\n VALUES\n       (source.[ItemName]);\n</code></pre>\n\n<p>end</p>\n\n<p>But I don't know how to update my items.Languagetextid, can I do something with:\nOUTPUT $action, INSERTED.ID ?\nOr is there a better way to have this done??</p>\n\n<p>Thanks in advance,</p>\n\n<p>Mike</p>\n"},{"tags":["sql","sql-server","sql-server-2008","version-control"],"answer_count":3,"favorite_count":3,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13274498,"title":"Add version control to existing SQL Server database","body":"<p>I am part of a development team currently working with a database that does not have any kind of source control. We work with SQL Server 2008 R2 and have always managed the DB directly with SSMS. It now has ~340 tables and ~1600 stored procedures, plus a few triggers and views, so it is not a small DB.</p>\n\n<p>My goal is to have the DB under version control, so I have been reading articles, like <a href=\"http://bitly.com/9cJmGR\" rel=\"nofollow\">Scott Allen's series</a> and many old SO related questions. But I am still unable to decide on how to proceed.</p>\n\n<p>What I'm thinking of is to script the database schema in one file, then procedures, triggers and views in one file each. Then keep everything versioned under Mercurial. But of course, every member of the team can access SSMS and directly change the schema and procedures, with the possibility that any of us can forget to replicate those changes in the versioned files.</p>\n\n<p>What better options are there? And, did I forget any element worth having source control of? My biggest concern is that most of the literature I found explains how to do version control when creating a new database, but not when it is already old and relatively big.</p>\n"},{"tags":["sql-server-2008","cursor","identity-column"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13272108,"title":"Can I use IDENTITY_INSERT in a cursor on SQL Server 2008?","body":"<p>I have the following code: </p>\n\n<pre><code> declare c cursor for\n            select\n                id_user_V3\n                ,device_type\n                ,4\n                ,notfication_mode\n                ,t1.device_token\n                ,registration_date\n                ,rank\n                ,1\n            from audiv2.dbo.mya_webservice_device_token t1\n                join migr.asoc_V2_glb_user t2 on t1.user_id = t2.id_user_V2\n\n        open c\n        fetch next from c into @id_user_v3,@type,@application_id,@notiffication,@device_tooken,@creation_date,@rang,@status\n        while @@FETCH_STATUS=0\n            begin\n\n                set @device_id = (ISNULL((SELECT MAX(id_device) FROM usr_device)+1,1))\n\n                SET IDENTITY_INSERT usr_device ON\n\n                insert into usr_device values\n                (\n                    @device_id\n                    ,@id_user_v3\n                    ,@type\n                    ,@application_id\n                    ,@notiffication\n                    ,@device_tooken\n                    ,@creation_date\n                    ,@rang\n                    ,@status\n                )\n                SET IDENTITY_INSERT usr_device OFF\n\n                fetch next from c into @id_user_v3,@type,@application_id,@notiffication,@device_tooken,@creation_date,@rang,@status\n            end\n\n        close c\n        deallocate c \n</code></pre>\n\n<p>The error I get is :</p>\n\n<blockquote>\n  <p>An explicit value for the identity column in table 'usr_device' can only be specified when a column list is used and IDENTITY_INSERT is ON.</p>\n</blockquote>\n\n<p>How can I solve this?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13274296,"title":"Auto Increment feature of SQL Server","body":"<p>I have created a table named as ABC. It has three columns which are as follows:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/3sx3t.png\" alt=\"enter image description here\">              </p>\n\n<p>The column <code>number_pk</code> <code>(int)</code> is the <strong>primary key</strong> of my table in which I have made the <code>auto increment</code> feature on for that column.</p>\n\n<p>Now I have deleted two rows from that table say <code>Number_pk= 5</code> and <code>Number_pk =6</code>.</p>\n\n<p>The table which I get now is like this:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/bTpbm.png\" alt=\"enter image description here\"></p>\n\n<p>Now if I again enter two new rows in this table with the same value I get the two new <code>Number_pk starting from 7 and 8</code> i.e,</p>\n\n<p><img src=\"http://i.stack.imgur.com/Y3fLv.png\" alt=\"enter image description here\"></p>\n\n<p>My question is that what is the logic behind this since I have deleted the two rows from the table. I know that a simple answer is because I have set the auto increment on for the primary key of my table. But I want to know is there any way that I can insert the two new entries starting from the last Number_pk without changing the design of my table?</p>\n\n<p>And how the <strong><em>SQL Server manage this record since I have deleted the rows from the database??</em></strong></p>\n"},{"tags":["sql","sql-server-2008","udf"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13273350,"title":"Splitting long strings in SQL","body":"<p>The inline solution suggested here: <a href=\"http://stackoverflow.com/questions/2647/split-string-in-sql\">Split string in SQL</a> by vzczc only works for strings containing less than 100 elements because of the limit of recursion depth (and you can't change the limit inside a UDF).</p>\n\n<p>Any other ways of splitting long strings with good performance? The UDF I've been using (not inline) has been very slow:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[fn_ParseDelimitedStrings](@String nvarchar(MAX), @Delimiter char(1))\nRETURNS @Values TABLE\n(\n RowId int Not Null IDENTITY(1,1) PRIMARY KEY\n,Value nvarchar(255) Not Null\n)\nAS\nBEGIN\n    DECLARE  @startPos smallint\n        ,@endPos smallint\n\n    IF (@String = '')\n    RETURN\n\n    IF (RIGHT(@String, 1) != @Delimiter)\n        SET @String = @String + @Delimiter\n    SET @startPos = 1\n    SET @endPos = CharIndex(@Delimiter, @String)\n    WHILE @endPos &gt; 0\n    BEGIN\n        INSERT @Values(Value)\n        SELECT LTRIM(RTRIM(SUBSTRING(@String, @startPos, @endPos - @startPos)))\n        -- remove the delimiter just used\n        SET @String = STUFF(@String, @endPos, 1, '')\n        -- move string pointer to next delimiter\n        SET @startPos = @endPos\n        SET @endPos = CHARINDEX(@Delimiter, @String)\n    END\n    RETURN\nEND\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13273885,"title":"How do I fetch only records created in the past year from a table within SSIS package?","body":"<p>I have a column <strong>CT_DT</strong> in a  table. I have to process only transactions created within the past <code>365 days</code>.</p>\n\n<p>For example, suppose the current date is <strong>Nov 7, 2012</strong>, I have to process only those transaction that were created since <strong>Nov 7, 2011</strong>. I am using conditional filter within the SSIS package.</p>\n"},{"tags":["sql","sql-server-2008","query","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13273705,"title":"SQL to bring back material names","body":"<p>The below code is a result of a query i have created, it all works fine apart from one thing.  I have Material ID's for material names:</p>\n\n<pre><code>1 = bath\n2 = sink\n3 = toilet\n</code></pre>\n\n<p>The below works but displays sink for every material</p>\n\n<pre><code>Select cu.FName + '  ' + cu.SName as 'Name', \ncu.Address1 + ', ' + cu.Address2 + ', ' + cu.Address3 as 'Dispatch Address', \ncu.PostCode, \nco.DateOrdered,\nco.Material1,\nma.MaterialName,\nco.material2, \nma.MaterialName, \nma.Price as 'Item Price' \nfrom Customers cu \nleft join CustomerOrder co on co.CustomerID = cu.CustomerID\nleft join ItemOrder it on it.OrderID = co.OrderID \nleft join Materials ma on ma.MaterialID = co.Material1 \nor co.material2 = ma.MaterialItemID or co.material3 = ma.MaterialItemID\n</code></pre>\n\n<p>it displays as follows (just the materials are listed to stop confusion)</p>\n\n<pre><code>Material1 | MaterialName | Material2 | Material2Name | Material3 | Material3Name\n    1          Sink            2           Sink           3             Sink\n</code></pre>\n\n<p>Can anybody help with this?</p>\n"},{"tags":["sql-server-2008","ssis","ssas","data-warehouse"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13240245,"title":"How do I handle this scenario related to degenerate/fact dimension in SSAS cube?","body":"<p>I have an SQL Server 2008 SSIS/SSAS Datawarehouse cube that I am publishing, in this cube I have the following:</p>\n\n<pre><code>Dimensions\n----------\nCompany\nProduct\nSales Person\nShipped Date (time dimension)\n\nFacts\n-----  \nTotal Income\nTotal Revenue \nGross\n</code></pre>\n\n<p>For the above, I have setup primary (PK) / surrogate (SK) keys for the dimension/fact data referencing.</p>\n\n<p>What I would also like to include is things such as <code>Order Number</code> or <code>Transaction Number</code> which in my mind would fit in a fact table as the order number is different for every record. If I were to create a order number dimension it does not make much sense as I would have as many order numbers as I would facts.</p>\n\n<p>Right now, when I load my fact data I do multiple Lookups on the dimensions to get the surrogate keys, I then pass in the fact data and <strong>also</strong> include these Order Number and Transaction Number <code>varchar</code> columns when I load my fact data but they cannot be used as they are not something you can aggregate on so they don't show up in my SSAS, only columns of numeric data type do for the fact table (total income, total revenue, etc).</p>\n\n<p>Is there something I can do to make these available for anyone using the Cube to filter on?</p>\n"},{"tags":["oracle","sql-server-2008","replication"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":157,"score":1,"question_id":7671474,"title":"publishing(replicating) Oracle to Sql2008r2","body":"<p>Trying to establish transactional replication from oracle server to Sql2008 R2 instance.\nI am able to set up 'Oracle publication' through Replication,New Oracle publication  wizard;every thing seems go fine up to adding articles (oracle table) and able to Map datatypes.\nbut when I choose Transactional Replication, it tells me that the oracle source table I choose do not have a Primary Key. Which is not true.</p>\n\n<p>If choose a snapshot, it goes on a infinite loop.</p>\n\n<p>I noticed that the linked server(to oracle) is using msdaOra provider, Is there a way to force Publication Wizard to use OraOLEDB.Oracle provider when it sets up associated linked server.</p>\n\n<p>any help appreciated</p>\n"},{"tags":["c#","sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2113,"score":1,"question_id":6824188,"title":"SqlDataSourceEnumerator.Instance.GetDataSources() does not locate local SQL server 2008 instance","body":"<p>I use the following code to list all the remote and local SQL Server instances:</p>\n\n<pre><code>public static void LocateSqlInstances()\n  {\n     using( DataTable sqlSources = SqlDataSourceEnumerator.Instance.GetDataSources())\n     {\n        foreach(DataRow source in sqlSources.Rows )\n        {\n           string instanceName = source[\"InstanceName\"].ToString();\n\n           if (!string.IsNullOrEmpty(instanceName))\n           {\n              Console.WriteLine(\" Server Name:{0}\", source[\"ServerName\"]);\n              Console.WriteLine(\"   Instance Name:{0}\", source[\"InstanceName\"]);\n              Console.WriteLine(\"   Version:{0}\", source[\"Version\"]);\n              Console.WriteLine();\n           }\n        }\n        Console.ReadKey();\n     }\n  }\n</code></pre>\n\n<p>running the code on my local machine. The code can find and list a SQL server express instance (version 9.0.5000) installed but failed to list the other SQL server instance (version 10.0.1600).</p>\n\n<p>I've done a lot of research on the Internet and made sure that 1-the Sql Broswer is runing and 2 - the UDP port 1434 is open.</p>\n\n<p>Anybody knows why? Thanks.</p>\n"},{"tags":["asp.net","windows","sql-server-2008","load","bandwidth"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13272585,"title":"Does this website load senario make sense?","body":"<p>I recently build an asp.net website that saw a drastic increase in traffic. Here are the specs for the server it was on:\nWindows 2008 R2 with SQL Server Web Edition 2008\n64 Bit Quad Core AMD Opteron Processor 2374 HE 2.32 GHz\n8GB of RAM\n320GB Hard Drive</p>\n\n<p>I was seeing all 4 processors running around 80-99%, memory around 3-4GB. And the website was taking between 10-30 seconds to pull up. \nThe site was getting approximately 35-200 pageviews a minute with an average page weight of of 600kb.\nThe website code used asp.net 3.5 and hit the database with a linq call for the sitemap to build the navigation, and there were two internal pages where the user could query the database that used an optimized stored procedure. These queries usually returned in .5 seconds.  </p>\n\n<p>I ran Red Gate's asp.net performance profiler and memory profiler and nothing significant was found.  </p>\n\n<p>So overall would you expect this type of load on the server from this configuration and volume of traffic?  In the end I added another server and a load balancer and site returned to responding in 3-5 seconds.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13210454,"title":"sql cte if statement","body":"<p>This might be a bad idea but just wondering?</p>\n\n<pre><code>;with Products\nAS\n(\n/* can you have an if statement in here? */\nselect * from products\n\n/* or */\n\nselect * from products \nwhere condition\n\n)\n</code></pre>\n\n<p>what i'm thinking is what if sometimes you have a search string or not. How do you make that a consideration in cte?</p>\n\n<p>Or maybe it would be a better idea to have 2 cte in one procedure?</p>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13270332,"title":"Report Builder/SSRS and RDLs - HTML <img> support?","body":"<p>I'm completely new to SSRS so apologies if this is a silly question. I have an RDL with a HTML placeholder however if I pass an <code>&lt;img&gt;</code> tag in the dataset this does not render.</p>\n\n<p>I see on <a href=\"http://technet.microsoft.com/en-us/library/ff519562.aspx\" rel=\"nofollow\">this Technet</a> article that there is a list of supported tags, which unfortunately doesn't include <code>&lt;img&gt;</code>. I've been able to add an image with an external source based on an expression which uses a dataset field so it seems a little strange that you can't use images in HTML placeholders. Is there a workaround for this at all?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13271685,"title":"SQL Login notification","body":"<p>I want to be notified of SQL Server logins that has a particular value for the <code>Application Name</code> property of the connection string. Can someone help me to get these type of notifications by email or by any other recommended method?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13255746,"title":"Can Execute Procedure But Job That Runs Procedure Errors?","body":"<p>I have a procedure that pulls data from my database and uses MSDB.DBO.sp_send_dbmail to send out e-mails.  The procedure itself runs without a hitch when I use 'EXEC myprocedure'.  But when I set up a job for the procedure, the job fails with the following error </p>\n\n<blockquote>\n  <p>'Error formating query, probably invalid parameters [SQLState\n  42000](Error 22050).  The step failed'</p>\n</blockquote>\n\n<p>There is one step in the job with the TSQL statement 'EXEC myprocedure', using the database that my procedure is stored on.  Does anyone know what could be causing this error?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I've narrowed the problem down. It's something with the Exchange server I use. I was using a domain address (ie. mail.mycompany.com) as the 'Server name' under Database Mail's account configuration wizard. I was unable to send e-mails to listservs and external users using this domain address. I talked to our Exchange guy and he recommended using the actual IP address of one of the mail servers (ie. 10.123.53.53). That fixed the problem with listservs and external users, but now I am unable to send e-mails when I run my procedure using a job (the procedure itself executes properly when I manually run it). Does anyone know what criteria on our Exchange server I will need to change to fix this? </p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":34,"score":-3,"question_id":13271591,"title":"tsql : Delete query","body":"<pre><code>DELETE abc \nFROM abc INNER JOIN xyz ON \nabc.RECORD_TYPE = xyz.RECORD_TYPE AND \nabc.IN = xyz.IN \nOPTION (MERGE JOIN, LOOP JOIN)\n</code></pre>\n\n<p>can anyone tell me what exactly the query doing ? </p>\n"},{"tags":["sql-server-2008","tsql","if-statement","null"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":30,"score":1,"question_id":13271477,"title":"TSQL parameter with NULL value does not enter IF condition","body":"<p>I have a query that looks like this:</p>\n\n<pre><code>use [dbName]\n\nDECLARE @profile_id int\nSET @profile_id = 18\nDECLARE @test int\n\nSET @test = (SELECT user_profile_id FROM tbl_profiles WHERE id = @profile_id)\n\nSELECT @test as test\n\nif @test = NULL\n    SELECT 1\n\nelse \n    SELECT 2\n</code></pre>\n\n<p>I know that the value in the table is null, and I can see that @test is correctly being set to that value because the first SELECT shows:</p>\n\n<pre><code> |test\n1|NULL\n</code></pre>\n\n<p>However, in the IF condition the variable is not being treated as NULL because only the third SELECT is returned, showing:</p>\n\n<pre><code> |(no column name)\n1| 2\n</code></pre>\n\n<p>Why is that?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13240037,"title":"How to return only a single resultset in a stored procedure","body":"<p>Consider the following stored procedure :</p>\n\n<pre><code>create procedure [dbo].[MyTest] ( @p_SqlStatement nvarchar(max) )\nas\nbegin\n\n    exec sp_executesql @p_SqlStatement\n\n    if @@ROWCOUNT = 1\n    begin\n      select 1;\n    end\n    else if @@ROWCOUNT &lt;&gt; 1\n    begin\n      select 0;\n    end\n\nend\n</code></pre>\n\n<p>This stored procedure currently returns 2 datasets, one with the <code>exec sp_executesql @p_SqlStatement</code> data, and the other one would be either 1 or 0. Is there a way to suppress the first dataset? I mean, would it be possible that this stored procedure returns only 1 or 0 ?</p>\n\n<p>I tried adding a <code>RAISERROR( 'MyError', 18, 1 )</code> right after the <code>exec sp_executesql @p_SqlStatement</code> and then in the catch block select something else, but the first result set is always returned to my stored procedure caller...</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13267862,"title":"Where I can check user-define table type in SQL Server 2008 in SSMS? and how can I insert new column into it?","body":"<p>I need to add some more columns into my current <code>user-define table type in SQL Server 2008</code></p>\n\n<p>But I didn't see any table type in particular database under <code>Tables</code> .</p>\n\n<p>Where exactly I need to check and how can I modify the design of existing <code>user-define table type in SQL Server 2008</code></p>\n\n<p>I'm using <code>SQL SERVER 2008</code> and <code>SSMS</code></p>\n\n<p>Where I can find that table in <code>SSMS</code> , </p>\n\n<p>so that I can go and modify table type.</p>\n\n<p>thanks</p>\n\n<p>for previous question answer </p>\n\n<p>Please can any one help to sql <code>alter type table</code> syntax <code>add column</code> ?\nhow can I insert any new column ... as ALTER is not working.. it is disable </p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":110,"score":-2,"question_id":11665119,"title":"DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()), 0) Can someone explain me this","body":"<pre><code>DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()), 0)\n</code></pre>\n\n<p>Can someone explain me this.</p>\n"},{"tags":["sql","database","sql-server-2008","query"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13263023,"title":"Need advice to re-create history of a table based on audit tables","body":"<p>OK folks, I have an urgent need. I am tasked with re-creating an accurate history of changes to  multiple fields of an active table retroactively based on individual audit tables for each field.  I have a SQL Server Agent job that does this currently on a daily basis starting 10/16/2012, but need to immediately add records to retrofit the history back to 1/1/2012.</p>\n\n<p>To compound my issue, I need to reflect daily changes to the full hierarchy from the top down based on these audit records.</p>\n\n<p>Here's what I have:</p>\n\n<p>Active Table:</p>\n\n<pre><code>empId varchar(20),\nfirst_name varchar(50),\nlast_name varchar(50),\ncost_center varchar(20), -- need to re-create history\nmgr_empId varchar(20), -- need to re-create history\nstart_dt date, -- starting date range of active record\nend_dt date, -- end of active record - default value of 12/31/2999 = active record\nhierarchy_empId varchar (200), --derived field from a nasty self-referencing function (12x)\nhierarchy_name varchar(1000) -- derived from the same functino as the field above.\n</code></pre>\n\n<p>Example:</p>\n\n<p>Employee A1000, Tim Lee enters the org on 3/1/2012 with manager Bill A with emp Id B1000 into cost center 01552.</p>\n\n<pre>\nA1000  Tim Lee  01552   B1000   3/1/2012   12/31/2999   B1000>A1000   Bill A>Tim Lee\nB1000  Bill A   01552   NULL    1/1/2011   12/31/2999   B1000         Bill A\n</pre>\n\n<p>On 5/1/2012 the nightly job picks up a delta for Tim, and Tim's cost center changes to  31550.  So his current record is updated with an end date of yesterday, and a new \"current\" record is entered, reflected below:</p>\n\n<pre>\nA1000  Tim Lee  01552   B1000   3/1/2012   4/30/2012   B1000>A1000   Bill A>Tim Lee\nB1000  Bill A   01552   NULL    1/1/2011   12/31/2999  B1000         Bill A\nA1000  Tim Lee  31550   B1000   5/1/2012   12/31/2999  B1000>A1000   Bill A>Tim Lee\n</pre>\n\n<p>On 6/15/2012, a new manager Ben C, emp Id C1000, was hired underneath Tim's manager:</p>\n\n<pre>\nA1000  Tim Lee  01552   B1000   3/1/2012    4/30/2012   B1000>A1000         Bill A>Tim Lee\nB1000  Bill A   01552   NULL    1/1/2011    12/31/2999  B1000               Bill A\nA1000  Tim Lee  31550   B1000   5/1/2012    6/14/2012   B1000>A1000         Bill A>Tim Lee\nC1000  Ben C    31550   A1000   6/15/2012   12/31/2999  A1000>C1000         Bill A>Ben C\nA1000  Tim Lee  31550   B1000   6/15/2012   12/31/2999  B1000>C1000>A1000   Bill A>Ben C>Tim Lee\n</pre>\n\n<p>These updates must trickle down the hierarchy.  So, if something changes above Tim, it also must be reflected in his record.   </p>\n\n<p>On 7/15, Tim's original manager Bill A gets a new manager, Mark S, emp Id X3000.</p>\n\n<pre>\nA1000  Tim Lee  01552   B1000   3/1/2012    4/30/2012   B1000>A1000               Bill A>Tim Lee\nB1000  Bill A   01552   NULL    1/1/2011    7/14/2012   B1000                     Bill A\nA1000  Tim Lee  31550   B1000   5/1/2012    6/14/2012   B1000>A1000               Bill A>Tim Lee\nC1000  Ben C    31550   A1000   6/15/2012   7/14/2012   A1000>C1000               Bill A>Ben C\nA1000  Tim Lee  31550   C1000   6/15/2012   7/14/2012   B1000>C1000>A1000         Bill A>Ben C>Tim Lee\nX3000  Mark S   01000   NULL    7/15/2012   12/31/2999  X3000                     Mark S\nA1000  Tim Lee  31550   C1000   7/15/2012   12/31/2999  X3000>B1000>C1000>A1000   Mark S>Bill A>Ben C>Tim Lee\nB1000  Bill A   01552   X3000   7/15/2012   12/31/2999  X3000>B1000               Mark S>Bill A\nC1000  Ben C    31550   B1000   7/15/2012   12/31/2999  X3000>B1000>C1000              Mark S>Bill A>Ben C\n\n</pre>\n\n<p>I have these audit tables:</p>\n\n<p><strong>tblManagerAudit</strong></p>\n\n<pre><code>empId varchar(20),\nchgTimestamp datetime,\noldMgr varchar(20),\nnewMgr varchar(20)\n</code></pre>\n\n<p><strong>tblCostCenterAudit</strong></p>\n\n<pre><code>empId varchar(20),\nchgTimnestamp datetime,\noldCostCenter varchar(20),\nnewCostCenter varchar(20)\n</code></pre>\n\n<p>I have struggled with how to combine the audit records for a very long time and appreciate any input.</p>\n"},{"tags":["php","sql-server-2008","svg"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":7,"score":1,"question_id":13270185,"title":"Connecting SQL Server 2008 Spatial with PHP for SVG Maps on website","body":"<p>I know GIS but I am new to SQL Server 2008 Spatial, SVG or PHP: I am planing to display an SVG map online embedded with 2 other online applications developed using JAVA and other one with .NET. </p>\n\n<p>Beside the map there are other attribute information stored in SQL Server in a different table based on Zipcode, I want to connect those attributes also with each Zipcode based polygon in my SVG Map.</p>\n\n<p>I do not know how to connect SQL Server using PHP/ASP/Java/Java Script or any server side scripting.</p>\n\n<p>I am not a programmer but I have basic idea about JavaScript and little bit of PHP. I am looking for mouse-over, Zoom in Zoom Out, PAN functions.\nAny help about SQL Server 2008 connection, rendering SVG.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13269586,"title":"SQL adding additional columns to a query","body":"<p>I'm trying to create a query that allows me to see all of the customers orders and to add an additional column using sql to view the total amount that the customer owes.</p>\n\n<p>the following code retrieves the correct data:</p>\n\n<pre><code>SELECT\n    cu.FName + '  ' + cu.SName as 'Name', \n    cu.Address1 + ', ' + cu.Address2 + ', ' + cu.Address3 as 'Dispatch Address', \n    cu.PostCode, \n    co.DateOrdered, co.DateDispatched, \n    ma.MaterialName, \n    it.Quantity, \n    ma.Price as 'Total' \nFROM\n    Customers cu \nLEFT JOIN \n    CustomerOrder co ON co.CustomerID = cu.CustomerID \nLEFT JOIN\n    ItemOrder it ON it.OrderID = co.OrderID \nLEFT JOIN \n    Materials ma ON ma.MaterialID = it.MaterialID \n</code></pre>\n\n<p>I now need to add additional code to the above to add a column to show the total amount the customer owes, but I'm stuck, can anybody help?</p>\n\n<pre><code>Date Order   |    Dispatch Date | Item  | QTY  |   Price | TOTAL AMOUNT FOR BOTH ROWS\n2012-10-30   |    2012-11-25    | Bath  | 1    |   49.99 |  \n2012-10-30   |    2012-11-25    | Sink  | 1    |   55.99 |\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","code-reuse"],"answer_count":3,"favorite_count":3,"up_vote_count":17,"down_vote_count":0,"view_count":9764,"score":17,"question_id":3795263,"title":"Errors: \"INSERT EXEC statement cannot be nested.\" and \"Cannot use the ROLLBACK statement within an INSERT-EXEC statement.\" How to solve this?","body":"<p>I have three stored procedures <code>Sp1</code>, <code>Sp2</code> and <code>Sp3</code>.</p>\n\n<p>The first one (<code>Sp1</code>) will execute the second one (<code>Sp2</code>) and save returned data into <code>@tempTB1</code> and the second one will execute the third one (<code>Sp3</code>) and save data into <code>@tempTB2</code>.</p>\n\n<p>If I execute the <code>Sp2</code> it will work and it will return me all my data from the <code>Sp3</code>, but the problem is in the <code>Sp1</code>, when I execute it it will display this error:</p>\n\n<blockquote>\n  <p>INSERT EXEC statement cannot be nested</p>\n</blockquote>\n\n<p>I tried to change the place of <code>execute Sp2</code> and it display me another error:</p>\n\n<blockquote>\n  <p>Cannot use the ROLLBACK statement\n  within an INSERT-EXEC statement.</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13269038,"title":"Mixing update/insert records in a single invocation of \"Instead of insert, update\" - Is that possible?","body":"<p>I would like to know whether an \"instead of insert, update\" trigger can be called to both \"UPDATE\" A records in the table while \"INSERTING\" B records in a <strong>single invocation</strong>?</p>\n\n<p>Actually, I'm just curious to know whether SQL Server could call the mentioned trigger for updating and inserting records, at once? or it just calls the trigger once for updating some records, and once for inserting some others?</p>\n\n<p>Consider this, for example:</p>\n\n<pre><code>ALTER TRIGGER [dbo].[MyTable_DoWhatever] \n   ON  [dbo].[MyTable] \n   INSTEAD OF INSERT, UPDATE\nAS \nBEGIN\n    SET NOCOUNT ON;\n\n    DECLARE @Updating BIT = 0;\n    IF EXISTS(SELECT * FROM INSERTED i INNER JOIN DELETED d ON i.Id = d.Id) SET @Updating = 1\n\nEND\n</code></pre>\n\n<p>Does the above @Updating flag valid to determine whether the trigger is called for \"INSTEAD OF INSERTED\" or \"INSTEAD OF UPDATE\"?</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net","sql","sql-server","sql-server-2005","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":479,"score":0,"question_id":6120957,"title":"SQL Query Problem in Inline Query in Asp.net","body":"<p>My sql table structure is this</p>\n\n<pre><code>ID  DataName\n1   Lipsum lorem \n3   lipsum's lorem\n</code></pre>\n\n<p>My inline query in asp.net is that</p>\n\n<pre><code>select * from table where DataName like 'lipsum's lorem'\n</code></pre>\n\n<p>It gives the following errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 1\nIncorrect syntax near 's'.\nMsg 105, Level 15, State 1, Line 1\nUnclosed quotation mark after the character string ''.\n</code></pre>\n\n<p>I don't want to create a stored procedure to prevent this, I want a solution to this using inline queries.</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":3505,"score":0,"question_id":10110615,"title":"An insert exec statement cannot be nested","body":"<p>Hello I have a proc called <code>Test_ProcA</code> and I want to call <code>Test_ProcB</code>. I created a temp table called <code>#temp</code> with matching names and data types returned by <code>Test_ProcB</code>.</p>\n\n<p>How do I insert the result set returned by <code>Test_ProcB</code> into <code>#temp</code>. When I try doing that I keep getting this error:</p>\n\n<blockquote>\n  <p>An <code>INSERT EXEC</code> statement cannot be nested.</p>\n</blockquote>\n\n<p>Any ideas and suggestions on what needs to be done.</p>\n"},{"tags":["sql-server","sql-server-2008","csv","bulkinsert"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4046,"score":1,"question_id":3756560,"title":"How to Bulk Insert csv with double quotes around all values?","body":"<p>I am trying to insert a .csv file into SQL Server 2008 R2.</p>\n\n<p>The .csv is 300+MB from <a href=\"http://ipinfodb.com/ip_database.php\" rel=\"nofollow\">http://ipinfodb.com/ip_database.php</a> Complete\n(City), 4.0M records.</p>\n\n<p>Here're the top 5 lines, with 1st line = column headers:</p>\n\n<pre><code>\"ip_start\";\"country_code\";\"country_name\";\"region_code\";\"region_name\";\"city\";\"zipcode\";\"latitude\";\"longitude\";\"metrocode\"\n\"0\";\"RD\";\"Reserved\";;;;;\"0\";\"0\";\n\"16777216\";\"AU\";\"Australia\";;;;;\"-27\";\"133\";\n\"17367040\";\"MY\";\"Malaysia\";;;;;\"2.5\";\"112.5\";\n\"17435136\";\"AU\";\"Australia\";;;;;\"-27\";\"133\";\n</code></pre>\n\n<p>I tried Import and Export Data, and BULK INSERT, but haven't been able to import them correctly yet.</p>\n\n<p>Shall I resort to use bcp? can it handle stripping the <code>\"\"</code>? how?</p>\n\n<p>Thank you very much.</p>\n"},{"tags":["sql-server-2008","encryption","certificate","windows-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13117172,"title":"SQL server 2008 encrypted connection","body":"<p>I've created and installed a self-signed certificate <code>test</code> on my Windows 2008 Server. I've set <code>Force Encryption</code> to <code>Yes</code> and set the certificate to <code>test</code>. </p>\n\n<p>I've exported and sent the <code>test</code> certificate to clients. They've installed it to the Trusted Authority store. They've tried to connect to the SQL server through the SQL Management Studio Express, with the <code>Encrypt connection</code> set. They get the following error: </p>\n\n<p><strong>A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: TCP Provider, error: 0 - No such host is known.) (Microsoft SQL Server, Error: 11001)</strong></p>\n\n<p>Note that they can connect to the server just fine through unencrypted connection and settings.</p>\n\n<p>I've tried most solutions thrown out by google about this error, but I don't think any of them dealt with encryption. </p>\n\n<p>I've also tried <a href=\"http://www.sqlservercentral.com/Forums/Topic611829-146-1.aspx\" rel=\"nofollow\">this</a> method, but I still get the same error.</p>\n\n<p>I don't have the <code>Primary DNS Suffix</code> set, if that has any affect on certificates?</p>\n\n<p>EDIT: My goal is to somehow have an encrypted connection from remote computers to my databse, because my clients demand it. We were considering VPN, but there is no need for it, if this can be done on SQL server.</p>\n\n<p>EDIT 2: The certificate \"Issued\" fields are set to local domain name (that's not resolvable by remote computers). Could this be an issue? Can I somehow set the certificate to an external IP address, if that'll fix the issue?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":189,"score":0,"question_id":8731229,"title":"SQL Server string getting truncated","body":"<p>I have a column (<code>col1</code>) with <code>nvarchar(max)</code>.</p>\n\n<p>I am trying to do </p>\n\n<pre><code>DECLARE @my_string NVARCHAR(max)\nset @my_string = N'test'\n\nUPDATE dbo.tab1 \nSET col1 = @my_string + ISNULL(col1, N'')\n</code></pre>\n\n<p>no  luck , I have no idea why it is happening. @marc_s</p>\n\n<p>The string value in <code>col1</code> getting truncated after 250 characters. This happening in both SQL Server 2005 and 2008.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","merge","case"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13268170,"title":"Merge Statement: Don't update blank field","body":"<p>I'm performing a MERGE statement from a temp table <code>t</code> into the main table <code>ts</code>, matching on an ID field. It contains the following:</p>\n\n<pre><code>WHEN MATCHED THEN UPDATE\n   SET ts.username = t.username, ts.password = t.password, ts.title = t.title, ts.firstname = t.firstname, ts.surname = t.surname, ts.email = t.email\n</code></pre>\n\n<p>If the username and password is blank in the temp table <code>t</code>, I don't want to update the main table <code>ts</code>. How can I do this?</p>\n\n<p>EDIT: Seems like a <code>CASE</code> statement or using <code>COALESCE(NULLIF(t.username, ''), ts.username)</code> will work. Which is best?</p>\n"},{"tags":["sql","sql-server","vb.net","sql-server-2008"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3372,"score":1,"question_id":1513438,"title":"How do I return a value to a sqldatareader if value is null?","body":"<p>I am currently using a sql data reader (in vb.net) to extract an article object via a stored proc from a SQL Server 2008 database. Part of this object includes the two properties shown below:</p>\n\n<pre><code>theArticle.Truthfulness = ((myReader.GetInt32(myReader.GetOrdinal(\"Truthfulness\"))))\ntheArticle.Relevance = ((myReader.GetInt32(myReader.GetOrdinal(\"Relevance\"))))\n</code></pre>\n\n<p>My problem is that the Truthfulness and Relevance may return a null value and this is causing the function to fall over.</p>\n\n<p>I think I understand why. I am asking for an integer value (getin32) and because null is returned it fails.</p>\n\n<p>How do I accommodate the null value from the database so it does not fall over?</p>\n"},{"tags":["java","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13267909,"title":"Restore .bak on MS SQL server","body":"<p>We have restore command which we can execute from command line.\nI want to restore backup from Java class.\nHow should I do it?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13266772,"title":"How can I select the latest event for a given user in Microsoft SQL Server 2008?","body":"<p>I have a database in Microsoft SQL Server 2008</p>\n\n<p>I have a table <code>[eventlog].[dbo].[USER_OPERATION]</code> with columns <code>[userID], [event_description], [event_date], [event_type], [eventID]</code></p>\n\n<p><code>eventID</code> is unique for, well, every given event that can happen.</p>\n\n<p>A given <code>UserID</code> is, of course, not unique for events (every user may have a lot of events associated with him) but is associated with a single individual user</p>\n\n<p>What I want is to create a query that would give me a list which only has the <em>latest</em> event for every user (that is to say, every <code>UserID</code>) and its associated info (the <code>event_type</code>, <code>eventID</code> and <code>event_description</code> of a given specific event).</p>\n\n<p>To illustrate:</p>\n\n<p>When performing</p>\n\n<pre><code>SELECT * \nFROM [eventlog].[dbo].[USER_OPERATION] \nORDER BY userID ASC\n</code></pre>\n\n<p>I get something along the lines of </p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   391     |    2     |  USER 2 filed a complaint       |  30.04.10    |  COMPLAINT |\n|   392     |    2     |  USER 2 has bought beer         |  31.10.09    |  PURCHASE  |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   691     |    4     |  USER 4 has bought beer         |  01.12.10    |  PURCHASE  |\n|   81      |    4     |  USER 4 updated personal data   |  17.07.11    |  PDAT_UPD  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   142     |    5     |  USER 5 broke something         |  16.08.11    |   CRASH    |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>As you can see, some users have multiple events with different dates associated with them.</p>\n\n<p>What I want is a query that will show me a list of users and what was the most recent date users had an event on (the output would, essentially, be a table which lists each users once, and shows the most recent event associated with each user, and associated event_description, event_date and event_type info). </p>\n\n<p>Let's call such a query result \"Recent Event Table\".</p>\n\n<p><b>Do note the \"unusual condition\" of User 5 (UserID 5) who broke something and bought beer at the same date. </p>\n\n<p>In such cases, I don't care WHICH of the two same-day events would go into the \"Recent Event Table\"</b>, it can be picked by random or whatever (though I would still would need the associated event_description and event_type info).</p>\n\n<p><b>Ideally</b>, the result would look like this (for same set of users as above):</p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>If there is no way to just <i>\"pick any one of the two randomly or per some rule\"</i> for such \"date-dupes\" as User 5, having two entries in the \"Recent Event Table\" would be acceptable for such special cases, since they are very rare and I can handle them manually.</p>\n\n<p>In such (a little bit less fortunate) case the \"Recent Event Table\" would look like </p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   142     |    5     |  USER 5 broke something         |  16.08.11    |   CRASH    |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>Which is also acceptable (but would need a bit additional pruning later).</p>\n\n<p>So, to summarize my question, is it possible to construct such a Microsoft SQL query that would give me a Recent Event Table along the lines of what was described above ?</p>\n\n<p>Thank you very much for your help in advance </p>\n"},{"tags":["sql-server-2008","ssms"],"answer_count":3,"favorite_count":5,"up_vote_count":19,"down_vote_count":0,"view_count":29519,"score":19,"question_id":3359170,"title":"Auto-increment primary key in SQL tables","body":"<p>Using Sql Express Management Studio 2008 GUI (not with coding), how can I make a primary key auto-incremented?</p>\n\n<p>Let me explain: there is a table which has a column named \"id\" and the items of this column are set to be primary keys. I want to make this column auto-incremented, but how?</p>\n\n<p>Cheers</p>\n"},{"tags":["sql","database","sql-server-2008","query","database-design"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":26,"score":-2,"question_id":13261087,"title":"How to generate the mapping table in a many to many insert","body":"<p>I have a table of trades for Companys in an exchange. So for a given day I can have many trades for a company. I now want to take these trades and group them into positions.</p>\n\n<p>A trade can below to many positions depending on its attributes like country, type etc\na position can be made up of many trades.</p>\n\n<p>So I have the following tables</p>\n\n<p><strong>Table Trades</strong><br/></p>\n\n<pre><code>Id   Date      Company   Trade  Type\n1 2012-11-01     IBM     1000    A\n2 2012-11-01     IBM     3000    B\n3 2012-11-01     Dell    1000    A\n4 2012-11-01     HP      5000    A\n5 2012-11-01     HP      6000    A\n6 2012-11-01     HP      7000    B\n</code></pre>\n\n<p><strong>Table TradePositionMapping</strong><br/></p>\n\n<pre><code>PK     TableTradeID      PositionID\n1          1                100      --IBM 1000\n2          1                101      --IBM 1000\n3          2                101      --IBM 3000\n4          3                102      --Dell 1000\n5          4                103      --HP 5000\n6          5                103      --HP 6000\n7          4                104      --Hp 5000\n7          5                104      --Hp 6000\n7          6                104      --Hp 7000\n</code></pre>\n\n<p><strong>Table Position</strong><br/></p>\n\n<pre><code>PK   Company Position\n100   IBM      1000\n101   IBM      4000\n102   Dell     1000\n103   Hp      11000\n104   Hp      18000\n</code></pre>\n\n<p>So in the Positions above the IBM Trade ID 1 went to 2 Positions 100 and 101. Trade Id 2 also went to Position 101 giving a total of 4000</p>\n\n<p>Ok so the idea being that a trade can make up 1 or more positions and a position can have many trades. The business logic will determine what positions the trades flow to, so I have used A and B as flags for now just as an example.</p>\n\n<p>So to the question which is..</p>\n\n<p>When I select and aggregate from the Trades Table, I insert all the new positions that are made up from the various trades into the Positions table. Now what is the best way to create the mapping table.</p>\n\n<p>What I do at the moment is that I store the newly created Position Ids in a tempory table and then repeat the select that I would do to generate the postions in the first place.. and join to the tempory table. THis seems like a lot of duplication of code and I would like to know what the best practice is out there to do such a thing.</p>\n\n<p>best regards Mick</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":10,"score":1,"question_id":13266767,"title":"ALter view after insert by trigger sql server","body":"<p>I create a - view in sql server.\nI want to alter the view every time that a - row is added to my table .\nI create trigger for it :</p>\n\n<pre><code>CREATE TRIGGER Trigger1\nON dbo.Table1\nAFTER INSERT\nAS \nBEGIN\nALTER VIEW VIEW1 as\nSELECT *\nFrom Table1\nEND\n</code></pre>\n\n<p>But I get the error : 'ALTER VIEW' must be the only statement in the batch.</p>\n\n<p>What should I do to correct it error ?</p>\n"},{"tags":["sql-server-2008","dateadd"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13266130,"title":"How to select last one week data from today's date","body":"<p>How to select week data (more precisely, last 7 days data) from the current date in the fastest way as I have millions or rows in the table. I have a time stamp of created_date in sql table. </p>\n\n<p>I have tried this </p>\n\n<pre><code>SELECT Created_Date\nFROM Table_Name\nWHERE Created_Date &gt;= DATEADD(day,-7, GETDATE())\n</code></pre>\n\n<p>I have two question:</p>\n\n<ol>\n<li>Is this query is correct?</li>\n<li>Is this is the fastest way to get the last seven day data from a table having millions of rows ?</li>\n</ol>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":54,"score":1,"question_id":13254052,"title":"Reorder list by column","body":"<p>I have a column \"SortIndex\" in a table, and I would like to add a \"case update\" to reorder that table by passing in ID and the new position of the chosen one.</p>\n\n<p><a href=\"http://sqlfiddle.com/#!3/d41d8/5831\" rel=\"nofollow\">SQL Fiddle</a></p>\n\n<pre><code>DECLARE @T TABLE\n(\n    ID int,\n    Name char(1),\n    SortIndex int\n)\n\nINSERT @T \nSELECT 21, 'A', 1 UNION ALL\nSELECT 23, 'B', 2 UNION ALL\nSELECT 35, 'C', 3 UNION ALL\nSELECT 45, 'D', 4 UNION ALL\nSELECT 55, 'E', 5\n\nSELECT * FROM @T    \n\nDECLARE @SortIndex int\n\n/* MOVE A -&gt; 4 */\n\nSET @SortIndex = (SELECT SortIndex FROM @T WHERE ID = 23)\n\n/*\nUPDATE @T\n    SET \n        SortIndex = CASE ... ??\n*/      \n\n/* MOVE D -&gt; 2 */\n\nSELECT * FROM @T\n</code></pre>\n\n<p>Is this possible to solve this by only using the case statement to rebuild the sortindex'es?</p>\n\n<p><em>UPDATE</em></p>\n\n<p>Desired results</p>\n\n<pre><code>A -&gt; 4\n\n    Name SortIndex\n    B     1 \n    C     2\n    D     3\n    A     4\n    E     5\n\n    D -&gt; 2\n\n    A     1 \n    D     2\n    B     3\n    C     4\n    E     5\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":17590,"score":5,"question_id":5136013,"title":"How to change column datatype in SQL Server database without losing data","body":"<p>I have SQL Server database and I just realized that I can change the type from one of the columns from <code>int</code> to <code>bool</code>. How can I do that without losing the data that is already entered into that table? </p>\n\n<p>PS. I am using SQL Server Server 2008.</p>\n"},{"tags":["sql-server-2008","query","table","select","subquery"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13263699,"title":"Is there any way to send a column value from outer query to inner sub query?","body":"<p>'Discussions' table schema</p>\n\n<pre><code>title      description    desid    replyto    upvote    downvote   views\nbrowser    used           a1        none        1          1       12\n-          bad topic      b2        a1          2          3       14\nsql        database       a3        none        4          5       34\n-          crome          b4        a3          3          4       12\n</code></pre>\n\n<p>The above table has two types of content types Main Topics and Comments. Unique content identifier 'desid' used to identify that its a main topic or a comment. 'desid' starts with 'a' for Main Topic and for comment 'desid' starts with 'b'. For comment 'replyto' is the 'desid' of main topic to which this comment is associated. </p>\n\n<p>I like to find out the list of the top main topics that are arranged on the basis of (upvote+downvote+visits+number of comments to it) addition. The following query gives top topics list in order of  (upvote+downvote+visits)</p>\n\n<p><code>select *</code> with highest number of <code>upvote+downvote+views</code> by query </p>\n\n<pre><code>select * \nfrom [DB_user1212].[dbo].[discussions] \nwhere desid like 'a%'\norder by (upvote+downvote+visited) desc\n</code></pre>\n\n<p>For (comments+upvote+downvote+views ) i tried </p>\n\n<pre><code>select *\nfrom [DB_user1212].[dbo].[discussions]\nwhere desid like 'a%'\norder by (select count(*)\n           from [DB_user1212].[dbo].[discussions]\n           where replyto = desid )+upvote+downvote+visited) desc \n</code></pre>\n\n<p>but it didn't work . Because its not possible to send desid from outer query to innner subquery. Please tell me how to solve this. Please note that I want solution in query language only.</p>\n"}]}
{"total":21073,"page":2,"pagesize":100,"questions":[{"tags":["sql","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13258755,"title":"How to load image into varbinary column","body":"<p>I have table like this</p>\n\n<pre><code>CREATE TABLE [dbo].[Product](\n    [Id] [int] IDENTITY(1,1) NOT NULL,\n    [Name] [nvarchar](100) NOT NULL,\n    [Description] [nvarchar](max) NOT NULL,\n    [Price] [decimal](16, 3) NOT NULL,\n    [SmallPhoto] [varbinary](max) NULL);\n</code></pre>\n\n<p>I want load image into [SmallPhoto] field</p>\n\n<p>Main script looks like this</p>\n\n<pre><code>declare @filePath varchar(max)\ndeclare @productId int\n\nset @filePath = 'D:\\myfile.png'\nset @productId = 1\n\nupdate Product\nset SmallPhoto = -- some actions\nwhere Id = @productId\n</code></pre>\n\n<p>Expected result</p>\n\n<p>Command(s) completed successfully. :)</p>\n\n<p>UPD:</p>\n\n<p>1) My database located in other machine</p>\n\n<p>2) I do not have opportunity to copy file to remote machine</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":7,"view_count":32,"score":-7,"question_id":13265225,"title":"\"Enumeration yielded no results\" in sqldatareader","body":"<p>I getting this error in my application \n\"Enumeration yielded no results\". I don't know how to solve. can any one please help me</p>\n"},{"tags":["sql-server","sql-server-2008","datetime","truncate"],"answer_count":13,"favorite_count":30,"up_vote_count":61,"down_vote_count":0,"view_count":81980,"score":61,"question_id":923295,"title":"How can I truncate a datetime in SQL Server?","body":"<p>What's the best way to truncate a datetime value (as to remove hours minutes and seconds) in SQL Server 2008?</p>\n\n<p>For example:</p>\n\n<pre><code>declare @SomeDate datetime = '2009-05-28 16:30:22'\nselect trunc_date(@SomeDate)\n\n-----------------------\n2009-05-28 00:00:00.000\n</code></pre>\n"},{"tags":["vb.net","sql-server-2008","import"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":14,"score":1,"question_id":13265042,"title":"How to import data from one sql server database to another using VB.NET","body":"<p>I have been developing application using VB.NET and SQL Server 2008. There is one software is already been developed and in running mode, now I have to develop facility that user can add one record on that software and same record will add into my database table also. For that I have to write some code for when I will open particular screen / page in my application it will check the database table on that software and found if any new entry/record than it will apperier in my application screen also.</p>\n\n<p>In short I have to import record from database table from one database to another database using VB.NET code.</p>\n\n<p>Please advice.</p>\n"},{"tags":["c#","winforms","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13264150,"title":"How do I change color of cell which have greater than zero value in datagrid","body":"<p><code>enter code here</code><p> i have two cell in grid i want to chage one cell color and value by zero when i entered in other cell greater then zero value </p></p>\n\n<pre><code>    private void grdDetail_CellBeginEdit(object sender, DataGridViewCellCancelEventArgs e)\n        { \n            if (this.IsLoadComplete) \n              { \n                UpdateValueofQtyCell(e.ColumnIndex); \n              } \n       }\n  private void UpdateValueofQtyCell(int index)\n        {\n            int cur_row = grdDetail.CurrentRow.Index;\n\n            if (index == 1)\n            {\n                grdDetail[1, cur_row].Style.BackColor = Color.White;\n                grdDetail[2, cur_row].Style.BackColor = Color.FromArgb(224, 224, 224);\n                grdDetail[2, cur_row].Value = 0;\n            }\n           else  if (index == 1)\n            {\n                grdDetail[2, cur_row].Style.BackColor = Color.White;\n                grdDetail[1 cur_row].Style.BackColor = Color.FromArgb(224, 224, 224);\n                grdDetail[1, cur_row].Value = 0;\n             }\n        }\n</code></pre>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13258850,"title":"table name of column from view","body":"<p>I have a view which returns 30 columns. The view is created by inner join of three tables. I wish to find out which column was taken from which table using a query rather than going through the view line by line.\nIs there a way to do that in sql server 2008?\nthanks in advance </p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":13263497,"title":"SQL compare strings having version as value","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6855588/split-a-string-and-return-greatest-in-mssql\">Split a string and return greatest in mssql</a>  </p>\n</blockquote>\n\n\n\n<p>I need to compare strings which have version value, for example:\nstring1 = 2.3.4\nstring2 = 2.5.6\nNow in the above case i need to check which string version is greater?</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13256597,"title":"Trigger to Only Allow a Single Null Value Per Item ID","body":"<p>I am working on a database for equipment management, where users can sign in and out equipment. I have a table called TBL_Usage which keeps track of this. When an item is signed out, a new record is created in this table with the sign out date, and when it is signed back in, a sign in date is entered in the same record.</p>\n\n<p>For the purposes of this question, the table looks like this:\nTBL_Usage(Date_Out, Date_In, Equipment_ID)</p>\n\n<p>Now an item can't be signed out twice at the same time, therefore for each Equipment_ID, there can only be a maximum of one record where Date_In is null. I want to create a trigger/constraint to deal with this and am not quite sure how to set it up.</p>\n"},{"tags":["sql","sql-server-2008","tsql","subquery","cross-join"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13263856,"title":"SQL Server subquery in cross join returns error","body":"<p>I have tables <code>A</code>, <code>B</code> and <code>C</code>. Now table <code>A</code> as column <code>A1</code>(Primary Key), table <code>B</code> has column <code>B1</code>(Primary Key) and table <code>C</code> has columns <code>A1</code>(Foreign Key to Table <code>A.A1</code>), <code>B1</code>(Foreign Key to Table <code>B.B1</code>).</p>\n\n<p>Now I'm writing a query which list all rows from <code>A</code> and <code>B</code> and a bit column which will be set to to 1 if a row is found matching in table <code>C</code> otherwise 0.</p>\n\n<pre><code>SELECT \n     ISNULL((SELECT CAST(1 AS BIT) \n             FROM C \n             WHERE C.A1 = A.A1 AND C.B1 = B.B1),0) AS [TAG],\n     A.A1,\n     B.B1\nFROM A CROSS JOIN B\n</code></pre>\n\n<p>This query is producing an <code>Subquery returned more than 1 value.</code> error even though the query has no duplicate rows after combining the <code>A1</code> and <code>B1</code> columns.</p>\n"},{"tags":["asp.net","sql-server-2008","datatable","insertion"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13252070,"title":"Getting error while inserting table in database?","body":"<p>i am inserting table in database using table datatype with the following code:</p>\n\n<pre><code>CREATE TYPE BackUpDoctorLocationAreaRoom AS TABLE (\n[RoomId] bigint,\n[AreaId] bigint,\n[LocationId] bigint\n);\n\nAlter proc proc_tblBackUpDoctorInsert \n(\n@Id uniqueidentifier='',\n@BackUpDoctorId uniqueidentifier='1323e1f4-7a93-4b45-9a9b-3840c32fd6d8',  \n@StartDate datetime='11/08/2012',  \n@EndDate datetime='11/09/2012',  \n@StartTime datetime='22:22:22',  \n@EndTime datetime='01:11:11',  \n@CreatedBy uniqueidentifier='acf7961c-4111-49ad-a66a-ce7f9ce131bd',  \n@ModifiedBy uniqueidentifier='acf7961c-4111-49ad-a66a-ce7f9ce131bd',  \n@createdDate datetime='11/6/12 3:09:58 AM',  \n@ModifiedDate datetime='11/6/12 3:09:58 AM',\n@tblBackUpDoctorsForRooms BackUpDoctorLocationAreaRoom READONLY\n)    \nas    \nset xact_abort on\ndeclare @newId uniqueidentifier;    \nset @newId = newid(); \ninsert into tblBackUpDoctor (Id,BackUpDoctorId,StartDate,EndDate,StartTime,EndTime,CreatedBy,ModifiedBy,\ncreatedDate,ModifiedDate,IsActive,isdeleted) values \n(@newId,    \n@BackUpDoctorId,    \n@StartDate,    \n@EndDate,    \n@StartTime,    \n@EndTime,    \n@CreatedBy,    \n@ModifiedBy,    \n@createdDate,    \n@ModifiedDate,    \n1,0)    \ndeclare @IdFortblBackUpDoctorsForRooms uniqueidentifier;    \nset @IdFortblBackUpDoctorsForRooms = newid();    \ndelete from tblBackUpDoctorsForRooms where BackUpRecordId=@id and Roomid in (Select roomid from @tblBackUpDoctorsForRooms)\ndelete from tblbackupdoctor where id=@id\ninsert into tblBackUpDoctorsForRooms (BackUpRecordId,Roomid,Araeid,locationid)    \nSelect  @newId,roomid,areaid,locationid from @tblBackUpDoctorsForRooms\nselect @newId\n</code></pre>\n\n<p>This is the sp in which i am using that table.</p>\n\n<p>My class file's code is :</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public string InsertBackUpDoctor(ClsBackUpDoctorProp objProp, DataTable dtLocAreaRoom)\n{\n    String ConnectionString = CCMMUtility.GetCacheForWholeApplication();\n    String backUpRecordId = \"\";\n    SqlParameter[] param = new SqlParameter[12];\n    param[0] = new SqlParameter(\"@Id\", objProp.Id);\n    param[1] = new SqlParameter(\"@BackUpDoctorId\", objProp.BackUpDoctorId);\n    param[2] = new SqlParameter(\"@StartDate\", objProp.StartDate);\n    param[3] = new SqlParameter(\"@EndDate\", objProp.EndDate);\n    param[4] = new SqlParameter(\"@StartTime\", objProp.StartTime);\n    param[5] = new SqlParameter(\"@EndTime\", objProp.EndTime);\n    param[6] = new SqlParameter(\"@CreatedBy\", objProp.CreatedBy);\n    param[7] = new SqlParameter(\"@ModifiedBy\", objProp.ModifiedBy);\n    param[8] = new SqlParameter(\"@createdDate\", CCMMUtility.GetCurrentDateTimeByTimeZone(\"US Mountain Standard Time\"));\n    param[9] = new SqlParameter(\"@ModifiedDate\", CCMMUtility.GetCurrentDateTimeByTimeZone(\"US Mountain Standard Time\"));\n    param[10] = new SqlParameter(\"@CurrentDate\", objProp.CurrentDate);\n    param[11] = new SqlParameter(\"@tblBackUpDoctorsForRooms \", dtLocAreaRoom);\n\n\n    backUpRecordId = SqlHelper.ExecuteScalar(ConnectionString, \"proc_tblbackupdoctorInsertBackUpDoctors\", param).ToString();\n    return backUpRecordId;\n}\n</code></pre>\n\n<p>and here is the error which is coming when i tries to insert :</p>\n\n<p><strong>The incoming tabular data stream (TDS) remote procedure call (RPC) protocol stream is incorrect. Table-valued parameter 12 (\"@tblBackUpDoctorsForRooms\"), row 0, column 0: Data type 0xF3 (user-defined table type) has a non-zero length database name specified.  Database name is not allowed with a table-valued parameter, only schema name and type name are valid.</strong>\nI dont know why this coming please help me..</p>\n"},{"tags":["sql-server-2008","asp-classic","whitespace","recordset"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13249950,"title":"how to get the value of a column in recordset with space in the name?","body":"<p>we have change the server of our client, i'm trying to get rid of all the errors i got in the new server, i've got this situation:</p>\n\n<p>yesterday, on the old server this works fine:</p>\n\n<pre><code>sql = \"SELECT * FROM tableName INNER JOIN tableName2 ON tableName.Code = tableName2.[Global dimension 1 code] WHERE [No_]=\"&amp;request(\"aNumber\")\nset rs = conn.execute(sql)\n\nif not rs.EOF then\nsubCat = rs(\"Global dimension 1 code\")\nelse\nsubCat = 0\nend if\n</code></pre>\n\n<p>today, on the new server with IIS6 and same sql server 2008 as the oldone, i get the variable \"subCat\" empty, BUT if i write:</p>\n\n<pre><code>subCat = rs(\"code\")\n</code></pre>\n\n<p>it goes good. Also:</p>\n\n<pre><code>do until rs.EOF\n  for each x in rs.Fields\n    Response.Write(x.name)\n    Response.Write(\" = \")\n    Response.Write(x.value &amp; \"&lt;br&gt;\")\n  next\n  Response.Write(\"&lt;br&gt;\")\n  rs.MoveNext\n  loop\n</code></pre>\n\n<p>gives all the columns, also those with spaces, and things like:</p>\n\n<pre><code>subCat = rs(\"[Global dimension 1 code]\")\nsubCat = rs(\"'Global dimension 1 code'\")\nsubCat = rs(\"[tableName].[Global dimension 1 code]\")\n</code></pre>\n\n<p>rise a 500 server error.</p>\n\n<p>anyone has a hint to point a column in recordset with spaces? i'm usign ASP classic.\nthanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":30,"score":-1,"question_id":13261497,"title":"incorrect syntax near in creating stored procedure on a remote db","body":"<p>I am trying to recreate a stored procedure on a database which is hosted on a remote server.\nWhen creating the same SP locally I don't get any errors but when I am trying to create the SP on the remote server I am getting this errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Procedure MySP, Line 26\nIncorrect syntax near 'MERGE'.\nMsg 102, Level 15, State 1, Procedure MySP, Line 27\nIncorrect syntax near 'S'.\n</code></pre>\n\n<p>Those errors are repeating in multiple SP and I didn't get them when I created the SP's on my local server.\nAny idea what can that be?\nHere is a sample SP:</p>\n\n<pre><code>USE [MyDatabase]\nGO\n/****** Object:  StoredProcedure [dbo].[InsertContractorInfo]    Script Date: 11/07/2012 01:08:31 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n-- Author:      &lt;Author,,Name&gt;\n-- Create date: &lt;Create Date,,&gt;\n-- Description: &lt;Description,,&gt;\n-- =============================================\n--exec [dbo].[InsertContractorInfo] \nCREATE PROCEDURE [dbo].[InsertContractorInfo]\n(@CompanyName nvarchar(50), \n @LicenseNumber nvarchar(50),\n @MailingAddress1 nvarchar(200),\n @MailingAddress2 nvarchar(200),\n @Phone nvarchar(10),\n @Fax nvarchar(10),\n @Mobile nvarchar(10),\n @Email nvarchar(200),\n @PercentCommercial int,\n @PercentResidental int,\n @TotalEmployees int,\n @AnnualSales decimal(18,2),\n @InsuranceCompanyContact nvarchar(100)=null,\n @InsuranceCompanyContactEmail nvarchar(100)=null,\n @InsuranceCompanyContactPhone nvarchar(100)=null,\n @ContractorID uniqueidentifier)\nAS\nBEGIN\nMERGE dbo.Contractor con\nUSING(SELECT 1 S) S\nON con.Oid = @ContractorID\nWHEN MATCHED THEN UPDATE \n   SET       \n      [CompanyName] = @CompanyName      \n      ,[LicenseNumber] = @LicenseNumber\n      ,[MailingAddress1] = @MailingAddress1\n      ,[MailingAddress2] = @MailingAddress2\n      ,[Phone] = @Phone\n      ,[Fax] = @Fax\n      ,[EMail] =@Email\n      ,[Mobile] =@Mobile      \n      ,[PercentCommercial] = @PercentCommercial\n      ,[PercentResidental] = @PercentResidental\n      ,[TotalEmployees] = @TotalEmployees\n      ,[ApproximateAnnualSales] = @AnnualSales      \n      ,[InsuranceCompanyContact] = @InsuranceCompanyContact\n      ,[InsuranceCompanyContactPhone] = @InsuranceCompanyContactPhone\n      ,[InsuranceCompanyContactEmail] = @InsuranceCompanyContactEmail      \nWHEN NOT MATCHED THEN\nINSERT \n           ([Oid]       \n           ,[CompanyName]           \n           ,[LicenseNumber]\n           ,[MailingAddress1]\n           ,[MailingAddress2]\n           ,[Phone]\n           ,[Fax]\n           ,[EMail]\n           ,[Mobile]                      \n           ,[PercentCommercial]\n           ,[PercentResidental]\n           ,[TotalEmployees]\n           ,[ApproximateAnnualSales]                      \n           ,[InsuranceCompanyContact]\n           ,[InsuranceCompanyContactPhone]\n           ,[InsuranceCompanyContactEmail])\n     VALUES\n           (@ContractorId           \n           ,@CompanyName           \n           ,@LicenseNumber\n           ,@MailingAddress1\n           ,@MailingAddress2\n           ,@Phone\n           ,@Fax\n           ,@EMail\n           ,@Mobile\n           ,@PercentCommercial\n           ,@PercentResidental\n           ,@TotalEmployees\n           ,@AnnualSales                     \n           ,@InsuranceCompanyContact\n           ,@InsuranceCompanyContactPhone\n           ,@InsuranceCompanyContactEmail\n           );\nEND\nGO\n</code></pre>\n\n<p>Thanks, Laziale</p>\n"},{"tags":["sql","sql-server-2008","query","stored-procedures","triggers"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13193745,"title":"update column1 based on another column2 from same table without using trigger","body":"<p>scenario is :\nThere are many columns in my table like Col1 Col2 Col3 Col4.\nI want to set data of Col4 if VALUE of Col1 is changed. On firing update query value of Col1 may or may not change.</p>\n\n<p>I have implemented it through trigger.</p>\n\n<pre><code>Select @ISTDNotPossibleI = I.ISTDNotPossible From inserted i\nSelect @IsTDCompletedD = D.IsTDCompleted from deleted d\n\nIf (\n  (@IsTDCompletedD != @IsTDCompletedI) Or\n  (@ISTDNotPossibleD != @ISTDNotPossibleI) Or\n  (@IsTDDirectD != @IsTDDirectI) Or (\n    @IsTDCompletedD Is Null And\n    @IsTDCompletedI Is Not Null\n  ) Or (\n    @ISTDNotPossibleD Is Null And\n    @ISTDNotPossibleI Is Not Null\n  ) OR (\n    @IsTDDirectD Is Null And\n    @IsTDDirectI Is Not Null\n  )\n)\nBegin\n  Update \n    CRM_CarTDLog \n  Set\n    TDCompletedEventBy = @UpdatedBy,\n    TDCompletedEventOn = GetDate() \n  Where\n    Id = @UpdateID \nEnd\n</code></pre>\n\n<p>Problem is : this field is not likely to be updated regularly. But Col2 and Col3 are likely to be updated frequently. And since update query is being fired on this table frequently the trigger will be  fired frequently too. And it is increasing the overhead without serving any purpose.</p>\n\n<p>I want to solve this without using trigger. Please help me.</p>\n"},{"tags":[".net","mysql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":11840161,"title":"Efficient way to calculate value mathematical functions on DB data","body":"<p>In .net application, either window or web application, </p>\n\n<p>To perform different mathematical functions like sqrt, maximum,minimum,avg,count on larger amount of data. \nUsing stored procedures or normal program logic using iteration. which is the best way for doing this?</p>\n"},{"tags":["sql","sql-server-2008","locking"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":6745120,"title":"Creation time of a lock in SQL Server 2008","body":"<p>So I'm trying to monitor the longest living lock in my database. The idea is that if a lock has been held for a certain amount of time, I will receive a warning in my application.</p>\n\n<p>But for the life of I can't find the creation time of the locks.</p>\n\n<p>I have used:</p>\n\n<pre><code>exec msdb..sp_lock\nexec msdb..sp_who2\nSELECT * FROM sys.dm_tran_locks\nselect * from sys.syslockinfo\nselect cmd, * from sys.sysprocesses where blocked &gt; 0\n</code></pre>\n\n<p>But none of these seem to have the information I need.</p>\n\n<p>Any ideas?</p>\n\n<p>G</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13259850,"title":"Dynamic SQL and stored procedure optimization","body":"<p>I've read that using Dynamic SQL in a stored procedure can hurt performance of your stored procedures. I guess the theory is that the store procedure won't store an execution plan for SQL executed via EXEC or sp_executesql.</p>\n\n<p>I want to know if this is true. If it is true, do I have the same problem with multiple nested IF blocks, each one with a different \"version\" of my SQL statement?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13260367,"title":"TRIGGER INSERT last row into one of the chosen tables if WHERE conditions are true","body":"<p>I am currentlty using triggers in a table to copy the last row into a designated table based on a WHERE condition and ORDER BY. Using one trigger works fine and copies to the respective table. but both triggers are running causing duplicates of a previous row to appear in the table I dont want inserted. (SQL2008 Management Studio). I have specific tables to send this row too based on the partnumber. Here is the Structure:</p>\n\n<pre><code>ALTER TRIGGER NewT3650 ON JD_Passdata\nFOR INSERT \nAS\nINSERT T3_650_TestData (SerialNumber, Partnumber, etc)\nSELECT TOP 1 SerialNumber, Partnumber, etc\nFROM JD_Passdata\nWHERE partnumber = 'T3_650'\nORDER BY passdata_ndx DESC\n\nALTER TRIGGER NewT4450 ON JD_Passdata\nFOR INSERT \nAS\nINSERT T4_450_TestData (SerialNumber, Partnumber, etc)\nSELECT TOP 1 SerialNumber, Partnumber, etc\nFROM JD_Passdata\nWHERE partnumber = 'T4_450'\nORDER BY passdata_ndx DESC\n</code></pre>\n\n<p>Original PassData Table:</p>\n\n<pre><code>201244999, T4_450\n201245001, T3_650\n201245002, T3_650\n201245003, T3_650\n</code></pre>\n\n<p>Returns Results for table 1</p>\n\n<pre><code>201245001, T3_650\n201245002, T3_650\n201245003, T3_650\n</code></pre>\n\n<p>Returns Results for table 2</p>\n\n<pre><code>201244999, T4_450\n201244999, T4_450\n201244999, T4_450\n</code></pre>\n\n<p>I would like this to be an OR condition or a UNION that only takes the last row and enters it into the correct table and remove the additional trigger if possible. Otherwise a check for duplicate and update may do it too. Also the database is going to get quite large to do a DESC every entry may get slow. A method to remove the order by would be a consideration as well.</p>\n\n<p>Any sugesstions would be greatly appreciated...THX</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":13259913,"title":"Using Sum() with multiple where clauses","body":"<p>I'm pretty new to this, so forgive if this has been posted (I had no idea what to even search on).</p>\n\n<p>I have 2 tables, Accounts and Usage</p>\n\n<pre><code>AccountID  AccountStartDate  AccountEndDate\n-------------------------------------------\n1          12/1/2012         12/1/2013\n2          1/1/2013          1/1/2014\n\n\nUsageId   AccountID EstimatedUsage  StartDate  EndDate\n------------------------------------------------------\n1         1         10              1/1        1/31\n2         1         11              2/1        2/29\n3         1         23              3/1        3/31\n4         1         23              4/1        4/30\n5         1         15              5/1        5/31\n6         1         20              6/1        6/30\n7         1         15              7/1        7/31\n8         1         12              8/1        8/31\n9         1         14              9/1        9/30\n10        1         21             10/1        10/31\n11        1         27             11/1        11/30\n12        1         34             12/1        12/31\n13        2         13              1/1        1/31\n14        2         13              2/1        2/29\n15        2         28              3/1        3/31\n16        2         29              4/1        4/30\n17        2         31              5/1        5/31\n18        2         26              6/1        6/30\n19        2         43              7/1        7/31\n20        2         32              8/1        8/31\n21        2         18              9/1        9/30\n22        2         20             10/1        10/31\n23        2         47             11/1        11/30\n24        2         33             12/1        12/31\n</code></pre>\n\n<p>I'd like to write one query that gives me estimated usage for each month (starting now until the last month that we serve an account) for all accounts being served during that month.</p>\n\n<p>The results would be as follows:</p>\n\n<pre><code>Month-Year     Total Est Usage\n------------------------------\nOct-12            0  (none being served)\nNov-12            0  (none being served)\nDec-12           34  (only accountid 1 being served)\nJan-13           23  (accountid 1 &amp; 2 being served)\nFeb-13           24  (accountid 1 &amp; 2 being served)\nMar-13           51  (accountid 1 &amp; 2 being served)\n...\nDec-13           33  (only accountid 2 being served)\nJan-14           0   (none being served)\nFeb-14           0   (none being served)\n</code></pre>\n\n<p>I'm assuming I need to sum and then do a Group By...but not really sure logically how I'd lay this out.  </p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13252072,"title":"i need an sp to select or update my tables and for that i have to enter multiple values for single variable how can i do that?","body":"<p>desperately need an sp to pass mutiple values for the single variable like <code>@list</code> is a variable and the values I'm putting for it are '<code>1,3,4,5,66</code>' and I need information from the table realated to these id's:</p>\n\n<pre><code>SELECT T.C.value('.', 'NVARCHAR(100)') AS [id]\n    INTO #tblPersons\n    FROM (SELECT CAST ('&lt;Name&gt;' + REPLACE(@empid, ',', '&lt;/Name&gt;&lt;Name&gt;') + '&lt;/Name&gt;' AS XML) AS [Names]) AS A\n    cross APPLY Names.nodes('/Name') as T(C) \n</code></pre>\n\n<p>I'm using this in my sp but I'm getting difficulty for passing this for the mutiple values.</p>\n"},{"tags":["sql","database","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13259028,"title":"SQL Server bulk insert - \"Bulk load data conversion error\"","body":"<pre><code>bulk insert dbo.A\nFROM 'd:\\AData.csv'\nWITH \n(\nFIELDTERMINATOR = ',',\nROWTERMINATOR = '\\n'\n)\n</code></pre>\n\n<p>Inserting bulk data into a database, I approached an unexplainable error after review of the suspect data:</p>\n\n<blockquote>\n  <p><em>Msg 4867, Level 16, State 1, Line 6</em><br>\n  <em>Bulk load data conversion error (overflow) for row 1, column 42 (FES).</em></p>\n</blockquote>\n\n<p>Column FES was <code>tinyint</code>, now <code>smallint</code>. <code>d:\\AData.csv</code> contains a <code>2</code> in row 1, column 42. Are there any other sources for this type of error?</p>\n\n<p>---APPEND---</p>\n\n<p>I'm not sure how to properly post this. </p>\n\n<p>Create Table Script </p>\n\n<pre><code>create table AcsBy320082010Hus(\nserialnoId bigint,\nRT char,\nDIVISION tinyint,\nPUMA int,\nREGION tinyint,\nST tinyint,\nADJHSG int,\nADJINC int,\nWGTP int,\nNP tinyint,\nTYPE tinyint,\nACR tinyint,\nAGS tinyint,\nBDS tinyint,\nBLD tinyint,\nBUS tinyint,\nCONP smallint,\nELEP smallint,\nFS smallint,\nFULP int,\nGASP int,\nHFL tinyint,\nINSP varchar(6),\nKIT tinyint,\nMHP int,\nMRGI tinyint,\nMRGP int,\nMRGT tinyint,\nMRGX tinyint,\nPLM tinyint,\nRMS tinyint,\nRNTM tinyint,\nRNTP int,\nSMP int,\nTEL tinyint,\nTEN tinyint,\nVACS tinyint,\nVAL tinyint,\nVEH tinyint,\nWATP int,\nYBL tinyint,\nFES tinyint,\nFINCP int,\nFPARC tinyint,\nGRNTP int,\nGRPIP tinyint,\nHHL tinyint,\nHHT tinyint,\nHINCP int,\nHUGCL bit,\nHUPAC tinyint,\nHUPAOC tinyint,\nHUPARC tinyint,\nLNGI tinyint,\nMV tinyint,\nNOC tinyint,\nNPF tinyint,\nNPP bit,\nNR bit,\nNRC tinyint,\nOCPIP tinyint,\nPARTNER tinyint,\nPSF bit,\nR18 bit,\nR60 tinyint,\nR65 tinyint,\nRESMODE tinyint,\nSMOCP int,\nSMX tinyint,\nSRNT bit,\nSVAL bit,\nTAXP tinyint,\nWIF tinyint,\nWKEXREL tinyint,\nWORKSTAT tinyint,\nFACRP bit,\nFAGSP bit,\nFBDSP bit,\nFBLDP bit,\nFBUSP bit,\nFCONP bit,\nFELEP bit,\nFFSP bit,\nFFULP bit,\nFGASP bit,\nFHFLP bit,\nFINSP bit,\nFKITP bit,\nFMHP bit,\nFMRGIP bit,\nFMRGP bit,\nFMRGTP bit,\nFMRGXP bit,\nFMVYP bit,\nFPLMP bit,\nFRMSP bit,\nFRNTMP bit,\nFRNTP bit,\nFSMP bit,\nFSMXHP bit,\nFSMXSP bit,\nFTAXP bit,\nFTELP bit,\nFTENP bit,\nFVACSP bit,\nFVALP bit,\nFVEHP bit,\nFWATP bit,\nFYBLP bit,\nWGTP1 int,\nWGTP2 int,\nWGTP3 int,\nWGTP4 int,\nWGTP5 int,\nWGTP6 int,\nWGTP7 int,\nWGTP8 int,\nWGTP9 int,\nWGTP10 int,\nWGTP11 int,\nWGTP12 int,\nWGTP13 int,\nWGTP14 int,\nWGTP15 int,\nWGTP16 int,\nWGTP17 int,\nWGTP18 int,\nWGTP19 int,\nWGTP20 int,\nWGTP21 int,\nWGTP22 int,\nWGTP23 int,\nWGTP24 int,\nWGTP25 int,\nWGTP26 int,\nWGTP27 int,\nWGTP28 int,\nWGTP29 int,\nWGTP30 int,\nWGTP31 int,\nWGTP32 int,\nWGTP33 int,\nWGTP34 int,\nWGTP35 int,\nWGTP36 int,\nWGTP37 int,\nWGTP38 int,\nWGTP39 int,\nWGTP40 int,\nWGTP41 int,\nWGTP42 int,\nWGTP43 int,\nWGTP44 int,\nWGTP45 int,\nWGTP46 int,\nWGTP47 int,\nWGTP48 int,\nWGTP49 int,\nWGTP50 int,\nWGTP51 int,\nWGTP52 int,\nWGTP53 int,\nWGTP54 int,\nWGTP55 int,\nWGTP56 int,\nWGTP57 int,\nWGTP58 int,\nWGTP59 int,\nWGTP60 int,\nWGTP61 int,\nWGTP62 int,\nWGTP63 int,\nWGTP64 int,\nWGTP65 int,\nWGTP66 int,\nWGTP67 int,\nWGTP68 int,\nWGTP69 int,\nWGTP70 int,\nWGTP71 int,\nWGTP72 int,\nWGTP73 int,\nWGTP74 int,\nWGTP75 int,\nWGTP76 int,\nWGTP77 int,\nWGTP78 int,\nWGTP79 int,\nWGTP80 int)\n</code></pre>\n\n<p>Headers row </p>\n\n<blockquote>\n  <p>serialno,RT,DIVISION,PUMA,REGION,ST,ADJHSG,ADJINC,WGTP,NP,TYPE,ACR,AGS,BATH,BDSP,BLD,BUS,CONP,ELEP,FS,FULP,GASP,HFL,INSP,MHP,MRGI,MRGP,MRGT,MRGX,REFR,RMSP,RNTM,RNTP,RWAT,SINK,SMP,STOV,TEL,TEN,TOIL,VACS,VALP,VEH,WATP,YBL,FES,FINCP,FPARC,GRNTP,GRPIP,HHL,HHT,HINCP,HUGCL,HUPAC,HUPAOC,HUPARC,KIT,LNGI,MULTG,MV,NOC,NPF,NPP,NR,NRC,OCPIP,PARTNER,PLM,PSF,R18,R60,R65,RESMODE,SMOCP,SMX,SRNT,SVAL,TAXP,WIF,WKEXREL,WORKSTAT,FACRP,FAGSP,FBATHP,FBDSP,FBLDP,FBUSP,FCONP,FELEP,FFSP,FFULP,FGASP,FHFLP,FINSP,FKITP,FMHP,FMRGIP,FMRGP,FMRGTP,FMRGXP,FMVP,FPLMP,FREFRP,FRMSP,FRNTMP,FRNTP,FRWATP,FSINKP,FSMP,FSMXHP,FSMXSP,FSTOVP,FTAXP,FTELP,FTENP,FTOILP,FVACSP,FVALP,FVEHP,FWATP,FYBLP,WGTP1,WGTP2,WGTP3,WGTP4,WGTP5,WGTP6,WGTP7,WGTP8,WGTP9,WGTP10,WGTP11,WGTP12,WGTP13,WGTP14,WGTP15,WGTP16,WGTP17,WGTP18,WGTP19,WGTP20,WGTP21,WGTP22,WGTP23,WGTP24,WGTP25,WGTP26,WGTP27,WGTP28,WGTP29,WGTP30,WGTP31,WGTP32,WGTP33,WGTP34,WGTP35,WGTP36,WGTP37,WGTP38,WGTP39,WGTP40,WGTP41,WGTP42,WGTP43,WGTP44,WGTP45,WGTP46,WGTP47,WGTP48,WGTP49,WGTP50,WGTP51,WGTP52,WGTP53,WGTP54,WGTP55,WGTP56,WGTP57,WGTP58,WGTP59,WGTP60,WGTP61,WGTP62,WGTP63,WGTP64,WGTP65,WGTP66,WGTP67,WGTP68,WGTP69,WGTP70,WGTP71,WGTP72,WGTP73,WGTP74,WGTP75,WGTP76,WGTP77,WGTP78,WGTP79,WGTP80</p>\n</blockquote>\n\n<p>Row 1</p>\n\n<blockquote>\n  <p>2008000000023,H,6,01300,3,01,1012650,1031272,00043,04,1,1,,1,02,02,2,0000,150,2,0002,020,3,00150,,2,00980,1,1,1,03,,,1,1,,1,1,1,1,,0210000,2,0080,09,2,000058100,2,,,4,1,000058100,0,3,3,3,1,1,1,3,02,04,0,0,02,024,0,1,0,1,0,0,1,01170,3,0,1,19,1,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,00112,00045,00068,00017,00044,00091,00071,00032,00036,00042,00048,00041,00013,00031,00063,00013,00037,00017,00063,00098,00026,00036,00017,00065,00036,00020,00014,00035,00037,00046,00047,00048,00080,00034,00012,00061,00031,00069,00043,00060,00011,00050,00016,00057,00050,00013,00016,00068,00056,00039,00042,00049,00081,00041,00012,00092,00050,00055,00049,00016,00062,00041,00103,00012,00048,00060,00073,00052,00063,00038,00047,00040,00017,00040,00059,00020,00042,00010,00038,00018</p>\n</blockquote>\n\n<p><a href=\"http://www.census.gov/acs/www/Downloads/data_documentation/pums/DataDict/PUMS_Data_Dictionary_2008-2010.pdf\" rel=\"nofollow\">Link to ACS 2008-2010 Data Dictionary</a></p>\n"},{"tags":["sql-server-2008","user"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13258737,"title":"New SQL Server user failed to login","body":"<p>I've created new user in SQL Server Management Studio (SQL Server 2008 Express) in security tab. </p>\n\n<p>Specified the login name, SQL Server authentication, entered a password, assigned server role <code>sysadmin</code>, mapped to my database and there specify it as <code>db_owner</code>. Also in database security is specified in tab Schemas owned by this user is <code>db_owner</code>. </p>\n\n<p>I've checked a lot of tutorials but all of them do the same as me but when I try to login to SQL server (even manually) error message is thrown: </p>\n\n<blockquote>\n  <p><em>Login failed for 'MyUser' (Microsoft SQL Server, Error: 18456)</em></p>\n</blockquote>\n\n<p>Any idea what's wrong?</p>\n\n<p>Thanks a lot.</p>\n\n<p>Peter</p>\n"},{"tags":["c#","sql-server-2008","iis","iis7","iis-7.5"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13154836,"title":"One application pool keeps hanging IIS 7","body":"<p>For some reason my application pool keeps crashing once in a couple of days. The biggest problem is that there are no logs about errors or warnings in my administrative events about this pool. (there are several warnings in other pools, but it is only this pool that keeps crashing). Changes I make can only be tested if they worked if I wait a couple of days.</p>\n\n<p>I tried to bring my code back to the stage where the problems did not occur, but this does not seem to help.</p>\n\n<p>Most crashes happen when the site is not very busy, although not that inactive that IIS shuts it down for inactivity.</p>\n\n<p>Windows server 2008 R2 (SP 1),\nIIS Build 7.5.76,\nUmbraco,\nSql server 2008</p>\n\n<p>IIS logs: only showing some recycling of the pool (once every 3 hours)\nRapid fail detection: disabled</p>\n\n<p>Where should I start with solving this problem?</p>\n"},{"tags":["vb.net","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":13259152,"title":"SQL Update with where clause with variables from VS2010 Winforms","body":"<p>I am trying to do an update query from a winform with two variables without using a dataset.\nI assign both of my variable and then run the query but it keeps giving the error that zcomp is not a valid column name.  Which of course is true but I tell it which column before I say = zcomp.  Below is my code that is running the query.</p>\n\n<pre><code>Dim zamnt As Integer = WopartsDataGridView.Rows(e.RowIndex).Cells(e.ColumnIndex).Value\nDim zcomp As Integer = gridRow.Cells(0).Value\n\nDim con As New SqlConnection\nDim cmd As New SqlCommand\nTry\n  con.ConnectionString = \"Data Source=MNT-MGR-2\\SQLEX;Initial Catalog=MT;Integrated Security=True\"\n  con.Open()\n  cmd.Connection = con\n  cmd.CommandText = \"UPDATE dbo.sparts SET [dbo.sparts.QtyonHand] = [dbo.sparts.QtyonHand] - zamnt WHERE [ComponentID] = zcomp\"\n  cmd.ExecuteNonQuery()\nCatch ex As Exception\n  MessageBox.Show(\"Error while updating record on table...\" &amp; ex.Message, \"Update Records\")\nFinally\n  con.Close()\n  gridRow.Cells(4).Value = \"Yes\"\nEnd Try\n</code></pre>\n\n<p>I have tried it several different ways.  It works just fine if I take out the zamnt and zcomp and put the actual number values that are in the variables.  Please help I've been searching all day for a way to use the variables with this update query.\nThanks,\nStacy</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","geospatial","spatial"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13259215,"title":"STintersects() to find the Intersection point","body":"<p>I have two geometry which I am using to check if they intersect and if they do I need the intersection point.</p>\n\n<p>Currently I can get only Boolean output where if it intersects = 1 and if it does not intersect it will give =0 . Is there any way I can find the intersection of two shapes in geometry?</p>\n\n<p>Cheers,</p>\n"},{"tags":["asp.net","sql","sql-server-2008","compression","sharpziplib"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13202578,"title":"Most Space-Efficient Way to Store a Byte Array in a Database Table - ASP.NET","body":"<p>Right now we have a database table (SQL Server 2008 R2) that stores an uploaded file (PDF, DOC, TXT, etc.) in an image type column. A user uploads this file from an ASP.NET application. My project is to get a handle on the size at which this table is growing, and I've come up with a couple of questions along the way.</p>\n\n<ol>\n<li><p>On the database side, I've discovered the image column type is supposedly somewhat depreciated? Will I gain any benefits to switching over to varbinary(max), or should I say varbinary(5767168) because that is my file size cap, or might as well I just let it stay as an image type as far as space-efficiency is concerned?</p></li>\n<li><p>On the application side, I want to compress the byte array. Microsoft's built in GZip sometimes made the file bigger instead of smaller. I switched over to SharpZipLib, which is much better, but I still occasionally run into the same problem. Is there a way to find out the average file compression savings before I implement it on a wide scale? I'm having a hard time finding out what the underlying algorithm is that they use.</p></li>\n<li><p>Would it be worth writing a Huffman code algorithm of my own, or will that present the same problem where there is occasionally a larger compressed file than original file?</p></li>\n</ol>\n\n<p>For reference, in case it matters, here's the code in my app:</p>\n\n<pre><code>    using ICSharpCode.SharpZipLib.GZip;\n\n    private static byte[] Compress(byte[] data)\n    {\n        MemoryStream output = new MemoryStream();\n\n        using (GZipOutputStream gzip = new GZipOutputStream(output))\n        {\n            gzip.IsStreamOwner = false;\n            gzip.Write(data, 0, data.Length);\n            gzip.Close();\n        }\n        return output.ToArray();\n    }\n\n    private static byte[] Decompress(byte[] data)\n    {\n        MemoryStream output = new MemoryStream();\n        MemoryStream input = new MemoryStream();\n        input.Write(data, 0, data.Length);\n        input.Position = 0;\n\n        using (GZipInputStream gzip = new GZipInputStream(input))\n        {\n            byte[] buff = new byte[64];\n            int read = gzip.Read(buff, 0, buff.Length);\n\n            while (read &gt; 0)\n            {\n                output.Write(buff, 0, read);\n                read = gzip.Read(buff, 0, buff.Length);\n            }\n\n            gzip.Close();\n        }\n        return output.ToArray();\n    }\n</code></pre>\n\n<p>Thanks in advance for any help. :)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":8,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1603,"score":5,"question_id":9740256,"title":"How to compare if two strings contain the same words in T-SQL for SQL Server 2008?","body":"<p>When I compare two strings in SQL Server, there are couple of simple ways with <code>=</code> or <code>LIKE</code>.</p>\n\n<p>I want to redefine equality as:  </p>\n\n<p><em>If two strings contain the same words - no matter in what order - they are equal, otherwise they are not.</em></p>\n\n<p>For example:  </p>\n\n<ul>\n<li><code>'my word'</code> and <code>'word my'</code> are equal</li>\n<li><code>'my word'</code> and <code>'aaamy word'</code> are not</li>\n</ul>\n\n<p>What's the best simple solution for this problem?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13256877,"title":"SQL Server Customize Templates beyond Grid","body":"<p>How can I add custom sql commands to the default templates(used for <code>Script Table as...</code>)?</p>\n\n<p>Instead of:</p>\n\n<pre><code>UPDATE DB.dbo.table SET col1 = 'test'\n</code></pre>\n\n<p>I would like to have:</p>\n\n<pre><code>BEGIN TRANSACTION\n    UPDATE DB.dbo.table SET col1 = 'test'\nROLLBACK TRANSACTION\n</code></pre>\n\n<p>Or any custom code really. </p>\n\n<p>I did look at the <a href=\"http://stackoverflow.com/questions/1681645/change-default-template-in-sql-server-management-studio\">Change default template in SQL Server Management Studio</a> question, but it didn't allow for custom sql. It allowed you to set predefined properties.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13256336,"title":"fill empty column with sequence","body":"<p>Is there any way to fill an empty column with a ascending sequence of numbers starting from 1, without using identity?</p>\n\n<p>I tried the following cursor but it is filling the same value (450) for all rows in the column:</p>\n\n<pre><code>declare cur3 cursor for\nselect new_id from sheet1$\ndeclare @no int\ndeclare @no1 int\nset @no1 = 1\nopen cur3\nfetch next from cur3 into @no\nwhile(@@FETCH_STATUS = 0)\nbegin\nupdate sheet1$ set new_id = @no1\nset @no1 = @no1 + 1\nfetch next from cur3 into @no\nend\nclose cur3\ndeallocate cur3\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":13207075,"title":"Format a number with commas but without decimals in SQL Server 2008 R2?","body":"<p>I am using the following to create a comma formatted number in T-SQL. How can I get rid of the decimal point and the digits after decimal. So if I get 1,112.00 after formatting, how would I get only 1,112?</p>\n\n<pre><code>SELECT CONVERT(varchar, CAST(1112 AS money), 1)\n</code></pre>\n"},{"tags":["mysql","sql-server","sql-server-2008","sql-server-2008-r2","mysql-workbench"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":291,"score":0,"question_id":11619177,"title":"SQL Server 2008 R2 to MySQL Migration","body":"<p>Is there a GUI tool out there that will allow me to migrate entire SQL Server 2008 R2 databases to MySQL?  I have MySQL Workbench installed, but it looks like there isn't a feature in it like SSIS to copy and paste entire databases from SQL Server.  I downloaded the MySQL Migration Toolkit, but it is no longer supported and I get a Java error when running it.</p>\n"},{"tags":["sql-server-2008","asp.net-web-api"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13253579,"title":"Connecting Web API to SQL server 2008","body":"<p>I am fairly new to .net MVC 4 and WEB API. I need to connect my web API to SQL server 2008 but I'm not sure how exactly. I'll I have seen is examples using the local DB and I can't seem to find my solution. </p>\n"},{"tags":["sql","xml","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13225424,"title":"Insert elements/values into specific child element of XML column in t-sql","body":"<p>In SQL Server 2008, I would like to insert some elements and values into a specific child element of an xml column based on the value of another of that element's children (ID in this case). The xml currently looks like this: </p>\n\n<pre><code>&lt;Profile&gt;\n  &lt;ID&gt;16&lt;/ID&gt;\n  &lt;User&gt;\n    &lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;\n    &lt;Name&gt;test&lt;/Name&gt;\n    &lt;Activities /&gt;\n  &lt;/User&gt;\n&lt;/Profile&gt;\n</code></pre>\n\n<p>However, there could potentially be multiple <code>&lt;User&gt;</code> elements within the xml, and I need to insert only into the <code>&lt;User&gt;</code> of a specific <code>&lt;ID&gt;</code> value. How can I achieve this in MS SQL Server 2008/ t-sql? Thanks in advance.</p>\n\n<p><strong>Edit:</strong>\nTo simplify, I am grabbing the xml from that column and setting it to a variable:</p>\n\n<pre><code>DECLARE @profiles_xml xml\nDECLARE @profile_id int\nSET @profile_id = 16\nSET @profiles_xml = (SELECT profiles from tbl_applied_profiles WHERE\nprofiles.value('(Profile/ID)[1]','int')= @profile_id)\n</code></pre>\n\n<p>The resulting xml value of @profiles_xml looks like what I have above.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":13237477,"title":"How do I retrieve decimals when rounding an average in SQL","body":"<p>Here is my SQL statement</p>\n\n<pre><code>SELECT ROUND(AVG(column_name), 100) \nFROM [database].[dbo].[table]\n</code></pre>\n\n<p>The answer I retrieve is <code>3</code> with a possible range of numbers between <code>1 - 5</code> in 908 rows.</p>\n\n<p>I need it to say <code>3.0</code> or <code>3.09</code>. Is this possible?</p>\n"},{"tags":["c#","sql-server-2008","loginview"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13254969,"title":"LoginView Password Recovery in Razor View Engine","body":"<p>I have a website I built in MVC4 in razor view engine.  I moved the database tables that were doing the encryption from the local database to our production database and changed the web.config file to adjust for this change.  It now works fine, but I need to recover passwords.  SO I end up having hashed passwords.  Is there any way to translate it to recover the password?</p>\n"},{"tags":["c#","sql-server-2008","paging"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13240121,"title":"What is the equivalent of this code in c# to pass the start and limit variable to query for paging","body":"<pre><code>$result=mysql_query (\"SELECT * FROM strawhats ORDER BY id LIMIT \".$_POST['start'].\", \".$_POST['limit'].\"\") or die (mysql_error ());\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/13235286/how-to-page-data-according-to-pagingtoolbars-request\">This is my original post</a>... basically I am trying to make my pagingtoolbar work in extjs... but can't get it right... please help</p>\n\n<p>this is where I am trying to incorporate that code into c#</p>\n\n<pre><code>string sqlquery = \"SELECT Q1, Q2, Q3, Q4, Improvements, Comments FROM ITable\";\nconn.Open();\nSqlDataAdapter cmd = new SqlDataAdapter(sqlquery, conn);\nSqlCommand comd = new SqlCommand(sqlquery, conn);\nDataSet myData = new DataSet();\ncmd.Fill(myData, \"myTable\");\n\ncomd.CommandText = \"SELECT COUNT(*) FROM ITable\";\nInt32 count = (Int32)comd.ExecuteScalar();\n\ncomd.ExecuteNonQuery();\nconn.Close();\n\n\nvar results = (new\n\n{\n\n    TotalNumber = count,\n\n    myTable = myData\n\n});\n\nreturn JsonConvert.SerializeObject(new { count=count, myTable = myData.Tables[0] }, Formatting.Indented,\n                new JsonSerializerSettings\n                {\n                    ReferenceLoopHandling = ReferenceLoopHandling.Ignore\n                });\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":11110775,"title":"How to generate table name by datetime?","body":"<p>I realize this is syntactically bad but I figure it somewhat explains what I'm trying to do. Essentially, I have a batch job that is going to run each morning on a small table and as a part of the spec I need to create a backup prior to each load that can be accessed by a report.</p>\n\n<p>What I have so far is:</p>\n\n<pre><code>select  *\ninto    report_temp.MSK_Traffic_Backup_ + getdate()\nfrom    property.door_traffic\n</code></pre>\n\n<p>How can I make this function or should I consider doing this a better way?</p>\n"},{"tags":["sql-server-2008","dts"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13237352,"title":"Check and transfer data between two databases in same server using complex conditions","body":"<p>Source DB1.TB1 [<code>ID, EAN, ASIN, NAME, CONDITION</code>]</p>\n\n<pre><code> 1,1001,20001,ps2,COD2,new\n 2,1002,20002,xbox,HOLA,new\n 3,1003,20003,xbox,Spider Man,used\n</code></pre>\n\n<p>and DB1.TB2 [<code>ID, PRICE</code>] </p>\n\n<pre><code> 1,50 \n 2,51\n 3,61\n</code></pre>\n\n<p>Destination DB2.TB1 [<code>ID2, KID, EAN, GROUP, NAME, CONDITION, PRICE, DATE</code>]</p>\n\n<pre><code>         1,0013,10001,ps2,COD2,new\n         2,0015,10002,xbox,HOLA,new\n         3,0016,10003,xbox,Spider Man,used\n</code></pre>\n\n<p>Now I need to transfer the data from source table to destination table with some conditions:</p>\n\n<ul>\n<li><p><code>ID</code>is same for DB1 for both the tables, <code>KID</code> is the actual \"ID\" we refer to in the organization. \neach item without this ID should be updated with <code>kID_max + 1</code>.</p></li>\n<li><p>The shipping price of each item depends upon its <code>KID</code> name. So the products must be \ncategorised according to this as well which are dependent upon the name index such as ps2 or xbox. </p></li>\n</ul>\n\n<p>As a beginner,it seems too complex, I would like to know some information on how shall I approach to solve this issue.</p>\n\n<p>Note: The tables in DB1 are regularly updated so the DB2 table must also be updated accordingly on regular basis.  </p>\n"},{"tags":["asp.net","visual-studio-2010","sql-server-2008","vb.net-2010"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13253952,"title":"Visual Studio 2010 TextBox with TextMode set to 'MultiLine'","body":"<p>I have a series of <code>TextBox</code> controls on a web form that have the <code>TextMode</code> property set to <code>MultiLine</code>.</p>\n\n<p>Within these boxes the users could write a number of paragraphs seperated by line spaces.  </p>\n\n<p>In my database (SQL 2008) this is added to the system as <code>varchar(max)</code> and in turn this adds the data entered as one line of data without the paragraphs separated by line spaces.</p>\n\n<p>The webform also enables the user to send the data from the web page as an email to a number of users.  As the data is stored in SQL as one line of data, this is displayed in the email as one line of data and not separate paragraphs.</p>\n\n<p>Is there something I need to change in VS2010 or in SQL to get the email notification to have separate paragraphs of data instead of just one line of data?</p>\n\n<p>Any help much appreciated.</p>\n"},{"tags":["sql-server-2008","transaction-log","transactional-replication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":6,"score":1,"question_id":13253240,"title":"Log Reader Agent in transactional replication scanning large transaction log during recurring job causing latency","body":"<p>We just implemented a new job on a medium traffic database involved in transactional replication, that will process inputs from an Excel spreadsheet and call a stored procedure to create records within various tables in that DB.  </p>\n\n<p>One of the fields involved is a text data type that can range from 10k-30k characters. Within the job, a custom SQL server function parses out a URL from the large HTML body and writes it to a table.  </p>\n\n<p>Due to the intensive nature, or what seems to be that of the process, we only process 35 records or rows from the spreadsheet per job execution every half hour. What we are seeing is that the transaction log is growing at an alarming rate and is thus causing considerable latency from the publisher to the subscriber because the log reader agent scans the entire transaction log and finds 0 records for replication.  </p>\n\n<p>To put it into perspective, the log sits around 30GB in size, and cannot be much smaller because running the job 5-6 times will grow it past that size. We are doing frequent backups of the distribution database (every 5 minutes) and the transaction log every 15.  </p>\n\n<p>We are in dire need of a solution where we can decrease the latency, or decrease the amount of reading (I/O) from the log. I realize that there could be work that needs to be done on the app/job side, but is there anything within the replication configuration that can be done to help with this latency and wasted scanning from the log?  </p>\n\n<p>Any help would be much appreciated.  Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13252987,"title":"Inner Join two table-Valued Parameters doesn't work","body":"<p>I am trying to 'inner join' two table values parameters but when i execute the query it takes for ever and i have to stop debug in ms sql server management studio 2008.</p>\n\n<p>The query:</p>\n\n<pre><code>    @allClients [dbo].[ImportedClients] READONLY,\n    @NewClients [dbo].[ImportedClients] READONLY\n\n--Update Clients table in db with new clients\n\n    UPDATE [dbo].[Clients]\n        SET \n\n            Email = ISNULL(ct.Email, x.Email), \n            FirstName = ISNULL(ct.FirstName, x.FirstName), \n            LastName = ISNULL(ct.LastName, x.LastName), \n            Telephone = ISNULL(ct.Telephone, x.Telephone), \n            Cellphone = ISNULL(ct.Cellphone, x.Cellphone), \n\n\n\n        FROM @NewClients ct\n        inner join @allClients x \n        ON (x.Email = ct.Email)     \n\n        WHERE ct.Status &gt; -1 \n</code></pre>\n\n<p>What i am trying to do is: Update all the clients information for rows that exist in both @NewClients and @allClients so i used inner join. \nIs it possible to JOIN two  table-Valued Parameters?\nThis query doesn't (query doesn't complete without an error) work even with a few rows.</p>\n\n<p>any suggestions?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13253259,"title":"SQL Server Replace Command with WIldcard","body":"<p>I am in need of some help. Thanks to fellow user davids, I was able to get certain things working within SQL Server and am in need of some more help. Here is what I am trying to do:</p>\n\n<pre><code>UPDATE Table1 SET keyfield=(REPLACE(REPLACE(Column1,'http://*/folder/',''),'.avi',''))\nUPDATE Table2 SET keyfield=(REPLACE(REPLACE(Column2,'http://server2/folder/',''),'.mpg',''))\n</code></pre>\n\n<p>Can anyone help me out or point me in the right direction to get the wildcard to work? This particular column, the * is an IP Address and it will change all the time. Granted I will know the IP's ahead of time and can probably do it one by one, but I would prefer to have it automatically replace. Thanks in advance!</p>\n"},{"tags":["sql","sql-server-2008","csv"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13252580,"title":"Importing a CSV into SQL when there is a \",\" in the field","body":"<p>I need to import a CSV into a SQL 2008 database.  One of the fields is a directory, and apparently there are over 1600 rows that have a \",\" in the field name.  This field is now broken out incorrectly in my database.  There are over 100000 rows total.</p>\n\n<p>How can I avoid this and modify my statement?</p>\n\n<p>Here is the creation of the table:</p>\n\n<pre><code>create table tablename\n(\nDirectory       varchar(1000),\nName            varchar(1000),\nSize            varchar(50),\nCreationTime    varchar(100),\nLastAccessTime  varchar(100),\nLastWriteTime   varchar(100)\n)\n</code></pre>\n\n<p>Below is the code I used to import it:</p>\n\n<pre><code>BULK\nINSERT tablename\nFROM 'c:\\EmailCSVs\\myfile.csv'\nWITH\n(\nFIRSTROW = 2,\nFIELDTERMINATOR = ',',\nROWTERMINATOR = '\\n'\n)\nGO\n</code></pre>\n\n<p>An example in the directory field looks like this:</p>\n\n<pre><code>\\\\drive\\share\\nightly.175\\savemail\\user\\(Monday, January 10, 2011, 500 PM)\n</code></pre>\n\n<p>And here is an example row in the CSV:</p>\n\n<pre><code>\"\\\\drive\\share\\nightly.175\\savemail\\user\\(Monday, January 10, 2011, 500 PM)\",\"Archive #1.1.pst\",\"271360\",\"1/14/2011 8:37:05 AM\",\"6/1/2011 12:00:38 AM\",\"1/14/2011 2:45:27 PM\"\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","truncate","transaction-log"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13252899,"title":"Is there a congruent command to truncate for re-filling a table?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6266450/minimally-logged-insert-into\">Minimally Logged Insert Into</a>  </p>\n</blockquote>\n\n\n\n<p>I have a staging table that I'm going to truncate because a truncate isn't logged. Is there a flag that I can apply to the insert statement (or an alternate statement) so that refilling it will also not be logged in MS SQL Server?</p>\n"},{"tags":["asp.net-mvc","sql-server-2008","entity-framework","entity-framework-4","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13252472,"title":"Entity Framework import and use stored procedure which returns different result sets depending on input","body":"<p>I am working on a migration project, where I am migrating an web forms app to a ASP.NET MVC 4 app.</p>\n\n<p>I have come across this one scenario with which I need a little help.</p>\n\n<p>In the old web form project I have stored proc like...</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[TestMultipleResultSet]\n    @input VARCHAR\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    IF NOT EXISTS\n    (\n        SELECT * FROM Electronics\n        WHERE name = @input\n    )\n    BEGIN\n        SELECT 101 AS errorcode\n        RETURN\n    END\n\n    SELECT * FROM Electronics \n    WHERE name = @input\nEND\n</code></pre>\n\n<p>like the above <code>if not exist</code> check, there are many other checks with gives different <code>select * from</code> as resultset.</p>\n\n<p>Now I want to use Entity framework to execute this stored procedure, so I imported the function and created a complex type using the <code>Get Column Information</code> + <code>Create Complex Type</code> option which EF provides.</p>\n\n<p>Now it runs when I enter a valid @input which executes <code>SELECT * FROM Electronics WHERE name = @input</code> but when I enter an input which is not present instead of returning me a 101 error code it gives me an error. An exception is thrown.</p>\n\n<p>Exception details</p>\n\n<blockquote>\n  <p>The data reader is incompatible with the specified 'testEFModel.GetTestResults_Result1'. A member of the type, 'id', does not have a corresponding column in the data reader with the same name.</p>\n</blockquote>\n\n<p>How should I solve this ?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":2,"view_count":33,"score":1,"question_id":13251309,"title":"I need a detailed step by step method to build a cursor in SQL Server","body":"<p>This is a cursor I am using, but I'd like to understand it and write my own.</p>\n\n<pre><code>ALTER FUNCTION [dbo].[ConvertToTable1] (@list nvarchar(MAX))\n   RETURNS @tbl TABLE (number varchar(1024) NOT NULL) AS\nBEGIN\n   DECLARE @pos        int,\n           @nextpos    int,\n           @valuelen   int\n\n   SELECT @pos = 0, @nextpos = 1\n\n   WHILE @nextpos &gt; 0\n   BEGIN\n      SELECT @nextpos = charindex('.', @list, @pos + 1)\n      SELECT @valuelen = CASE WHEN @nextpos &gt; 0\n                              THEN @nextpos\n                              ELSE len(@list) + 1\n                         END - @pos - 1\n      INSERT @tbl (number)\n         VALUES (convert(int, substring(@list, @pos + 1, @valuelen)))\n      SELECT @pos = @nextpos\n   END\n   return\nend \n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13250660,"title":"query the second table with the result of first","body":"<p>I need to bind two tables into a dataset. I have three table named, Students, StudentMarks.</p>\n\n<p>Here if I know the studentId I can query the student table like</p>\n\n<pre><code>DataSet ds=new DataSet();\n\nSqlCommand cmd=new SqlCommand(\"\nSELECT * \nFROM STUDENTS\nWHERE STUDENTID=1; \nSELECT *\nFROM STUDENTS\nWHERE STUDENTID=1\");\n\nSqlDataAdapter da=new SqlDataAdapter(cmd);\nda.Fill(ds);\n</code></pre>\n\n<p>like this. So that I can access these two tables like ds.Table[0] and ds.Table[1].</p>\n\n<p>But my question is, if I dont know the studentid and if I want to query all the students as well as their marks and I've to get these details in two different tables how can I get?</p>\n\n<p>If I join these two tables, the result will be in a single table, I dunno how to do this, can anyone help me out here? thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","guid","entropy"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":23,"score":-1,"question_id":13251251,"title":"SQL Server 2008 GUID generation","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3242287/how-are-guids-generated-in-sql-server\">how are GUIDs generated in SQL Server?</a>  </p>\n</blockquote>\n\n\n\n<p>I wonder how SQL Server 2008 GUIDs are generated? Entropy bits</p>\n"},{"tags":["sql","sql-server","sql-server-2008","join","duplicate-removal"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":13250247,"title":"Join Tables SQL Server with duplicates","body":"<p>I have a table </p>\n\n<pre><code>col1\n\n1\n2\n</code></pre>\n\n<p>and other table </p>\n\n<pre><code>col1    col2    col3\n\n1          1    data value one                                    \n1          2    data value one                                    \n2          3    data value two   \n</code></pre>\n\n<p>and I want to join both tables to obtain the following result</p>\n\n<pre><code>col1  col2  col3\n\n1       1    data value one\n2       3    data value two\n</code></pre>\n\n<p>The second table have duplicates but I need to join only one (randomly). I've tried with Inner Join, Left Join, Right Join and always returns all rows. Actually I use <code>SQL Server 2008</code>.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13249936,"title":"Add a column to a table with a default value equal to the value of an existing column","body":"<p>How to add a column to a SQL Server table with a default value that is equal to value of an existing column?</p>\n\n<p>I tried this but its giving an error </p>\n\n<blockquote>\n  <p><em>The name \"oldcolumn\" is not permitted in this context. Valid\n  expressions are constants, constant expressions, and (in some\n  contexts) variables. Column names are not permitted.</em></p>\n</blockquote>\n\n<p>T-SQL statement:</p>\n\n<pre><code>ALTER TABLE tablename \nADD newcolumn type NOT NULL DEFAULT (oldcolumn) \n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":13248659,"title":"Round the third decimal place up into the second decimal place (e.g. $0.033 becomes $0.04)","body":"<p>When we increased the price with 10%, some products (the ones that have 3 decimal points), got an unwanted price change. For example, an item that had a price of <code>0.03</code> changed to <code>0.033</code>. </p>\n\n<p>Our client doesn't want a three decimal point in the pricing. </p>\n\n<p>We want to round the third decimal place up into the second decimal place (e.g. <code>$0.033</code> becomes <code>$0.04</code>).</p>\n\n<p>If my value is <code>0.033</code>, I want result to be <code>0.04</code>.</p>\n\n<p>Please help me</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["c#","sql-server-2008","excel"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13249804,"title":"import the updated excel value to database","body":"<p>I have a large amount of data in a excel sheet which has about 2000 rows. I have imported the table in sql server with no error. \nI have to modify the excel now and update the same changes in the database also. \nI cant delete the table and import again since i have large amount of data and have extra columns added to it. </p>\n\n<p>So Please help me how to update the new values along with the existing values. I use C#.Net. </p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","c#-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13248143,"title":"C# how to insert null value for foreign key into SQL","body":"<p>I have one table Documentation that has foreign keys to 3 other tables. This table, Documentation, should contain documents for different subjects (glass, aircraft and project). I didn't wan't to create 3 tables (table for documents for glass, another table for aircraft documents etc) so I created just one table that will have a reference(foreign keys) to other tables (Glass, Aircraft and Project tables). First of all, I'm not sure if this is a good solution...</p>\n\n<p>Anyway, problem is the following: I want to insert document that refers to glass. This means that foreign keys for Aircraft and Project will be null. Database columns accept null values.\nIf I try to insert null values for those foreign keys (AircraftFK and ProjectFK) it does not allow me to do that. It's asking me to insert appropriate value for foreign key that already exists as primary key in tabel Aircraft and Project.</p>\n\n<p>These foreign keys (AircraftfK and ProjectFK) HAVE TO BE NULL because the document that I'm inserting has nothing to do with aircraft and project.</p>\n\n<p>I'm programming in c# and using Sql Server 2008.</p>\n\n<p>How can I solve this?</p>\n\n<p>Thank you all</p>\n\n<p>Here are some more info:</p>\n\n<p>this is my sql command:</p>\n\n<pre><code>komanda = new SqlCommand(\"insert into Documentation (GlassFK, FaiFK, ProjectOrderFK, OrderNumberFK, DocPath, DocName, DocSize, DocType, DocumentFile) values (@GlassFK, @FaiFK, @ProjectOrderFK, @OrderNumberFK, @DocPath, @DocName, @DocSize, @DocType, @DocumentFile)\", konekcija);\n\n        for (int i = 0; i &lt; listaDokumenata.Count; i++)\n        {\n            komanda.Parameters.Clear();\n            komanda.Parameters.AddWithValue(\"@GlassFK\", listaDokumenata[i].GlassFK);\n            komanda.Parameters.AddWithValue(\"@FaiFK\", listaDokumenata[i].FaiFK);\n            komanda.Parameters.AddWithValue(\"@ProjectOrderFK\", listaDokumenata[i].ProjectOrderFK);\n            komanda.Parameters.AddWithValue(\"@OrderNumberFK\", listaDokumenata[i].OrderNumberFK);\n            komanda.Parameters.AddWithValue(\"@DocPath\", listaDokumenata[i].PutanjaFajla);\n            komanda.Parameters.AddWithValue(\"@DocName\", listaDokumenata[i].ImeFajla);\n            komanda.Parameters.AddWithValue(\"@DocSize\", listaDokumenata[i].VelicinaFajla);\n            komanda.Parameters.AddWithValue(\"@DocType\", listaDokumenata[i].Ekstenzija);\n            komanda.Parameters.AddWithValue(\"@DocumentFile\", listaDokumenata[i].Fajl);\n</code></pre>\n\n<p>and here is c# code for creating document object:</p>\n\n<pre><code>Document sf = new Document();\n                    sf.PutanjaFajla = putanjaFajla;\n                    sf.ImeFajla = imeFajla;\n                    sf.Ekstenzija = ekstenzija;\n                    sf.VelicinaFajla = velicinaFajla;\n                    sf.Fajl = wordFile;\n                    sf.FaiFK = 5;\n                    sf.GlassFK = 0;\n                    sf.ProjectFK = null;\n                    sf.ProjectOrderFK = 0;\n</code></pre>\n\n<p>This means that this document will refer to Glass. All other foreign keys has to be 0 or null (depends on a attribute type in sql)</p>\n\n<p>So, here is the error that I get:</p>\n\n<p>The parameterized query '(@GlassFK int,@FaiFK int,@ProjectOrderFK int,@OrderNumberFK nvar' expects the parameter '@OrderNumberFK', which was not supplied.</p>\n\n<p>OrderNumberID is the primary key of table Project. Its foreign keys is OrderNumberFK</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13246561,"title":"select data vice versa","body":"<p>I have two table in my database.</p>\n\n<pre><code>1) User Table\n\nid  username    password    logo    email\n1   admin        admin      NULL    1   \n2   support     support     NULL    NULL    \n3   test        test        NULL    NULL    \n\n\n2) Link Account Table\n\nID  AccountID   LinkAccountID\n1       1           2\n</code></pre>\n\n<p>Now if i select username with accountid 1 then it will return me Admin and Support\n    same way if i select username with accountid 2 then also it will return admin and support\n    and if i select username with accountid 3 then it will return only test</p>\n\n<p>something like vice versa if in link account table account id is 1 or linkaccountid is 1 that will return both id</p>\n\n<p>Thanks in advance</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["sql-server-2008","asp.net-mvc-4","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13245335,"title":"Entity Framework type case generic in predicate","body":"<p>I am working on updating to a more manageable repository pattern in my MVC 4 project that uses Entity Framework code first. I've integrated a generic base repository class that will do basic CRUD operations so I don't have to implement these in each repository I create. I have ran into an issue where my All method needs to filter there query by a deleted flag if the entity is a type of TrackableEntity. Since the Entity is generic in the base repository I am attempting to cast is to a type of TrackableEntity in the where which just results in the following error message.</p>\n\n<blockquote>\n  <p>The 'TypeAs' expression with an input of type 'NameSpace.Models.ClientFormField' and a check of type 'NameSpace.Models.TrackableEntity' is not supported. Only entity types and complex types are supported in LINQ to Entities queries.</p>\n</blockquote>\n\n<p>This error makes complete since and I understand why the code I have is not working but I am trying to find a way to filter out deleted items without having to override this method in all of my repositories. The code I have for my All method is below.</p>\n\n<pre><code>public virtual IEnumerable&lt;T&gt; All()\n{\n    if (typeof(T).IsSubclassOf(typeof(TrackableEntity)))\n        return dbSet.Where(e =&gt; !(e as TrackableEntity).IsDeleted).ToList();\n\n    return dbSet.ToList();\n}\n</code></pre>\n\n<p>I know that I can do the following</p>\n\n<pre><code>public virtual IEnumerable&lt;T&gt; All(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null)\n{\n    if (predicate != null)\n        return dbSet.Where(predicate).IsDeleted).ToList();\n\n    return dbSet.ToList();\n}\n</code></pre>\n\n<p>And then add this to all of my repositories</p>\n\n<pre><code>public override IEnumerable&lt;CaseType&gt; All(Expression&lt;Func&lt;CaseType,bool&gt;&gt; predicate = null)\n{\n    if (predicate == null)\n        predicate = e =&gt; !e.IsDeleted;\n    return base.All(predicate);\n}\n</code></pre>\n\n<p>The problem I have with this is that I am duplicating code, this is basically a copy and paste into all of my repositories which defeats the purpose of changing to this new repository pattern. I made the switch to end duplicated code in my repositories.</p>\n\n<p>Here is an example of one of my entities.</p>\n\n<pre><code>public class CaseType : TrackableEntity, IValidatableObject\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n\n    public bool InUse { get; set; }\n\n    public bool IsValid { get { return !this.Validate(null).Any(); } }\n\n    public IEnumerable&lt;ValidationResult&gt; Validate(ValidationContext validationContext)\n    {\n        if (String.IsNullOrEmpty(Name))\n            yield return new ValidationResult(\"Case Type name cannot be blank\", new[] { \"Name\" });\n\n        //Finish Validation Rules\n    }\n}\n</code></pre>\n\n<p>And the TrackableEntity</p>\n\n<pre><code>public abstract class TrackableEntity\n{\n    public bool Active { get; set; }\n    public bool IsDeleted { get; set; }\n    public virtual User CreatedBy { get; set; }\n    public virtual User ModifiedBy { get; set; }\n    public DateTime DateCreated { get; set; }\n    public DateTime DateModified { get; set; }\n}\n</code></pre>\n\n<p>Any help on this would be much appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13245044,"title":"corelated query","body":"<p>I have a table where I have some records as follows <br/></p>\n\n<pre><code>Model            Make            Color\n==================================================\nMaruti 800       2008            Black\nMaruti 800       2009            White\nMaruti Esteem    2000            Yelow\nMaruti Esteem    2010            Red\n</code></pre>\n\n<p>Now I want the Model, Make and Color which has maximum make in the list.<br/>\nI have tried writing query like this<br/></p>\n\n<pre><code>SELECT \n     Model,\n     MAX(Model),\n     Color\nfrom \n     tableName\nGROUP BY \n     Model,\n     Color\n</code></pre>\n\n<p>But the result are not coming which I would like<br/>\nIt should be like</p>\n\n<pre><code>Model            Make            Color\n===================================================\nMaruti 800       2009            White    \nMaruti Esteem    2010            Red\n</code></pre>\n\n<p>But the result is the whole table.</p>\n\n<p>I need only those record which has max Make Model Wise.<br/>\nI have also tried inner Query (co-related query) But in that also it is asking for group by.</p>\n"},{"tags":["sql-server-2008","migration","sql-server-2000"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":7535,"score":2,"question_id":5620269,"title":"Migrate from sql server 2000 to 2008 r2 - how to","body":"<p>I have a database working on SQL Server 2000. We are now migrating to a new server with SQL Server 2008 r2. Can anyone please point me to some resource or howto?\nI'm not really finding my way around SQL 2000.</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","transactions","rollback"],"answer_count":0,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13246038,"title":"which is better approach for roll back transaction in sql server?","body":"<p>I came to know we can go for roll back transaction using \"<strong>set xact_abort on</strong>\"\ni want to know which is the better way for roll back transaction: use \"set xact_abort on\" or simple the following code</p>\n\n<pre><code>begin try\nbegin tran\n-- statements \ncommit tran\nend try\nbegin catch\nrollback tran\nend catch\n</code></pre>\n\n<p>Please help me to choose which is better approach while inserting number of records one time.</p>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005","c#-4.0","asp.net-webforms"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13245321,"title":"DataTableMapping using adapter.FillSchema method applied on a Stored Procedure","body":"<p>this is a method i was reading about  @MSDN , \nmy question is if for an example i would like to use it on a stored procedure \nwith the fact that the query of that stored procedure is already specifying columns to select from the table like following :</p>\n\n<pre><code>SELECT Columnsome, columnother, , , , ...FROM thisSQLdbTable\n</code></pre>\n\n<p>though i would like to implement the approach of that specific method , it seems very advanced from a little research i have made on \n <strong>\"the best way\"</strong> available to extract data from SQL Server into Asp.net DataTable.</p>\n\n<pre><code>public static DataTable GetCustomerData(string dataSetName,\nstring connectionString)\n{\nDataTable table = new DataTable(dataSetName);\n\nusing (SqlConnection connection = new SqlConnection(connectionString))\n{\n    SqlDataAdapter adapter = new SqlDataAdapter(\n        \"SELECT CustomerID, CompanyName, ContactName FROM dbo.Customers\", connection);\n\n    DataTableMapping mapping = adapter.TableMappings.Add(\"Table\", \"Customers\");\n    mapping.ColumnMappings.Add(\"CompanyName\", \"Name\");\n    mapping.ColumnMappings.Add(\"ContactName\", \"Contact\");\n\n    connection.Open();\n\n    adapter.FillSchema(table, SchemaType.Mapped);\n    adapter.Fill(table);\n    return table;\n}\n</code></pre>\n\n<p>}</p>\n\n<p>or is it not the method to use if i am querying via <code>SP</code> that specifies the selected column</p>\n\n<p>i could actually drop that stored procedure if it is not requiered to select /specify columns </p>\n\n<p>the stored procedure is doing a specific calculation and updates the table with results of calculation then i am switching it's \"MODE\" to select results from the table that was updated.</p>\n\n<p>what i did is recyceling (; giving it a parameter (bit type) \nstored procedure then asks for the value of supplied <code>bool</code> / <code>bit</code> Parameter, \nif its is status true it updates (doing its original task it was made for)</p>\n\n<p>if its false its doing a select oporation so i am using it as i would with 2 separated commands </p>\n\n<p><strong>but now</strong> that i have search for a better way to extract data from db into a Data table </p>\n\n<p>i give up on the two way SP and i will make a selection via the exaple above if they're not intended to be used thogether as with my current SP that does preselection when servs the <code>GetCustomersData()</code> above.</p>\n\n<p>So the question is do i need to let the function to make the selection or can i serve it with my sp ready made selection to implemet it with GetCustomersData() in the way that it will only do rest of task and only mapp the columns that was preselected </p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13245451,"title":"Execute the value of a varchar returned from a \"OUTPUT DELETED.[ColumnName]\" statement","body":"<p>I am trying to use a table as a <a href=\"http://rusanu.com/2010/03/26/using-tables-as-queues/\" rel=\"nofollow\">heap queue</a>. However I am having a little trouble figuring out how to take the text that is generated in the dequeue function and perform a execute on it.</p>\n\n<p>Here is the table storing the queue and the dequeue method.</p>\n\n<pre><code>CREATE TABLE [dbo].[Merge_Queued_Work](Sql_Text varchar(2000) NOT NULL)\nGO\n\ncreate procedure usp_dequeueWork\nas\n  set nocount on;\n  delete top(1) from [Merge_Queued_Work] with (rowlock, readpast)\n      output deleted.[Sql_Text];      \ngo\n</code></pre>\n\n<p>How do I get the varchar from <code>deleted.[Sql_Text]</code> to a <code>execute</code> statement?</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":10,"score":1,"question_id":13244007,"title":"Need to throw exception while joining with two table when there is no data in one table","body":"<p>I have two tables test1 and test2 .</p>\n\n<p>I have selected both the table values by joining the two table.</p>\n\n<p>My requirement is that when I join the two table ,suppose if table test1 have data in it and if there is no corresponding data in the test2 table ,then the query should throw exception.</p>\n\n<p>For this what can i do.Did anyone have any idea.</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":543,"score":3,"question_id":7937581,"title":"Issue with bulk insert","body":"<p>I am trying to insert the data from this link to my SQL server \n<a href=\"https://www.ian.com/affiliatecenter/include/V2/CityCoordinatesList.zip\" rel=\"nofollow\">https://www.ian.com/affiliatecenter/include/V2/CityCoordinatesList.zip</a></p>\n\n<p>I created the table </p>\n\n<pre><code>CREATE TABLE [dbo].[tblCityCoordinatesList](\n[RegionID] [int] NOT NULL,\n[RegionName] [nvarchar](255) NULL,\n[Coordinates] [nvarchar](4000) NULL\n</code></pre>\n\n<p>) ON [PRIMARY]</p>\n\n<p>And I am running the following script to do the bulk insert</p>\n\n<pre><code>BULK INSERT tblCityCoordinatesList\nFROM 'C:\\data\\CityCoordinatesList.txt' \nWITH \n( \n    FIRSTROW = 2, \n    MAXERRORS = 0, \n    FIELDTERMINATOR = '|', \n    ROWTERMINATOR = '\\n'\n)\n</code></pre>\n\n<p>But the bulk insert fails with following error</p>\n\n<pre><code>Cannot obtain the required interface (\"IID_IColumnsInfo\") from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>When I google, I found several articles which says the issue may be with RowTerminator, but I tried everything like /n/r, /n etc, but nothing is working. </p>\n\n<p>Could anyone please help me to insert this data into my database?</p>\n\n<p>Thank you so much for your help.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13239530,"title":"Using Excel to create a CSV file with special characters and then Importing it into a db using SSIS","body":"<p>Take this XLS file </p>\n\n<p><img src=\"http://i.stack.imgur.com/JT3Wf.jpg\" alt=\"enter image description here\"></p>\n\n<p>I then save this XLS file as CSV and then open it up with a text editor. This is what I see:</p>\n\n<pre><code>Col1,Col2,Col3,Col4,Col5,Col6,Col7\n1,ABC,\"AB\"\"C\",\"D,E\",F,03,\"3,2\"\n</code></pre>\n\n<p>I see that the double quote character in column C was stored as <code>AB\"\"C</code>, the column value was enclosed with quotations and the double quote character in the data was replaced with 2 double quote characters to indicate that the quote is occurring within the data and not terminating the column value. I also see that the value for column G, <code>3,2</code>, is enclosed in quotes so that it is clear that the comma occurs within the data rather than indicating a new column. So far, so good.</p>\n\n<p>I am a little surprised that all of the column values are not enclosed by quotes but even this seems reasonable OK when I assume that EXCEL only specifies column delimieters when special characters like a commad or a dbl quote character exists in the data.</p>\n\n<p>Now I try to use SQL Server to import the csv file. Note that I specify a double quote character as the Text Qualifier character.</p>\n\n<p><img src=\"http://i.stack.imgur.com/dyYxr.jpg\" alt=\"Insert figure 2\"></p>\n\n<p>And a command char as the Column delimiter character. However, note that SSIS imports column 3 incorrectly,eg, not translating the two consecutive double quote characters as a single occurence of a double quote character.</p>\n\n<p><img src=\"http://i.stack.imgur.com/anU00.jpg\" alt=\"enter image description here\"></p>\n\n<p>What do I have to do to get Excel and SSIS to get along? </p>\n\n<p>Generally people avoid the issue by using column delimiter chactacters that are LESS LIKELY to occur in the data but this is not a real solution. </p>\n\n<p>I find that if I modify the file from this</p>\n\n<pre><code>Col1,Col2,Col3,Col4,Col5,Col6,Col7\n1,ABC,\"AB\"\"C\",\"D,E\",F,03,\"3,2\"\n</code></pre>\n\n<p>...to this:</p>\n\n<pre><code>Col1,Col2,Col3,Col4,Col5,Col6,Col7\n1,ABC,\"AB\"C\",\"D,E\",F,03,\"3,2\"\n</code></pre>\n\n<p>i.e, removing the two consecutive quotes in column C's value, that the data is loaded properly, however, this is a little confusing to me. First of all, how does SSIS determine that the double quote between the B and the C is not terminating that column value? Is it because the following characters are not a comma column delimiter or a row delimiter (CRLF)? And why does Excel export it this way?</p>\n\n<p>According to <a href=\"http://tools.ietf.org/html/rfc4180#page-2\" rel=\"nofollow\">Wikipedia</a>, here are a couple of traits of a CSV file:</p>\n\n<ol>\n<li><p>Fields containing line breaks (CRLF), double quotes, and commas\n   should be enclosed in double-quotes.  For example:</p>\n\n<p>\"aaa\",\"b CRLF\n   bb\",\"ccc\" CRLF\n   zzz,yyy,xxx</p></li>\n<li><p>If double-quotes are used to enclose fields, then a double-quote\n   appearing inside a field must be escaped by preceding it with\n   another double quote.  For example:</p>\n\n<p>\"aaa\",\"b\"\"bb\",\"ccc\"</p></li>\n</ol>\n\n<p>However, it looks like SSIS doesn't like it that way when importing. What can be done to get Excel to create a CSV file that could contain ANY special characters used as column delimiters, text delimiters or row delimiters in the data?  There's no reason that it can't work using the approach specified in Wikipedia,. which is what I thought the old MS DTS packages used to do...</p>\n\n<p><strong>Update:</strong></p>\n\n<p>If I use Notepad change the input file to </p>\n\n<pre><code>Col1,Col2,Col3,Col4,Col5,Col6,Col7,Col8\n\"1\",\"ABC\",\"AB\"\"C\",\"D,E\",\"F\",\"03\",\"3,2\",\"AB\"\"C\"\n</code></pre>\n\n<p>Excel reads it just fine </p>\n\n<p><img src=\"http://i.stack.imgur.com/Jw16G.jpg\" alt=\"enter image description here\"></p>\n\n<p>but SSIS returns</p>\n\n<pre><code>The preview sample contains embedded text qualifiers (\"). The flat file parser does not support embedding text qualifiers in data. Parsing columns that contain data with text qualifiers will fail at run time.\n</code></pre>\n"},{"tags":["c#","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":13165719,"title":"Reliably drop a database on SQL Server 2008 via C#","body":"<p>I am currently trying to drop a database via the following code</p>\n\n<pre><code>using Microsoft.SqlServer.Management.Smo;\n\nvar server = new Server(Server);\nserver.KillAllProcesses(\"Db\");\nserver.KillDatabase(\"Db\");\n</code></pre>\n\n<p>Sometimes it works, but others I get the following exception:</p>\n\n<blockquote>\n  <p>Microsoft.SqlServer.Management.Smo.FailedOperationException: Kill database failed for Server 'Host1'.<br>---> Microsoft.SqlServer.Management.Common.ExecutionFailureException: An exception occurred while executing a Transact-SQL statement or batch. <br>---> System.Data.SqlClient.SqlException: Changes to the state or options of database 'Db' cannot be made at this time. The database is in single-user mode, and a user is currently connected to it.</p>\n</blockquote>\n\n<p>Any ideas of how to reliably drop the database via code?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13242261,"title":"sql server query on condition","body":"<p>There is a table:</p>\n\n<pre><code>ID   Name   Rank\n1    X       Professor\n2    X       Principal\n3    X       Term Prof\n4    X       assistant\n</code></pre>\n\n<p>What I want is want to write the stored procedure to select the last professor rank or assistant rank depending on the input. Here is the format of the stored proc:</p>\n\n<pre><code>create procedure proc_name(@includeassistant varchar(3))\n\nend\n</code></pre>\n\n<p>if includeassistant is \"yes\" then assistant then the last row must be displayed if include assistant is no then Term prof row must be given.\n</p>\n"},{"tags":["sql","sql-server","xml","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13242295,"title":"Add elements and attributes to XML column based on criteria?","body":"<p>With the following, I'd like to add <code>../attrdomv/udom/'some text'</code> within each <code>attr</code> node, of which there are many. However, based on the value of <code>attrlab</code>, 'some text' will be different for each element. I hope that makes sense. I initially considered reconstructing the entire xml column, but <code>'many nodes and elements'</code> contains attributes that are specific to a row, and not easy to reproduce prorgammatically. <code>../attrdomv/udom/'some text'</code> will be the same across each row. Here is a snippet of an existing column:</p>\n\n<pre><code>&lt;metadata xml:lang=\"en\"&gt;\n&lt;many nodes and elements&gt;\n  &lt;eainfo&gt;\n    &lt;detailed Name=\"fire.DBO.labels\"&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;OBJECTID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;OBJECTID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;OID&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdef Sync=\"TRUE\"&gt;Internal feature number.&lt;/attrdef&gt;\n        &lt;attrdefs Sync=\"TRUE\"&gt;Esri&lt;/attrdefs&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique whole numbers that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;FeatureID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;FeatureID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;ZOrder&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;ZOrder&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;SymbolID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;SymbolID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n    &lt;/detailed&gt;\n  &lt;/eainfo&gt;\n&lt;/metadata&gt;\n</code></pre>\n\n<p>...and here is my desired result:</p>\n\n<pre><code>&lt;metadata xml:lang=\"en\"&gt;\n&lt;many nodes and elements&gt;\n  &lt;eainfo&gt;\n    &lt;detailed Name=\"fire.DBO.labels\"&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;OBJECTID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;OBJECTID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;OID&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdef Sync=\"TRUE\"&gt;Internal feature number.&lt;/attrdef&gt;\n        &lt;attrdefs Sync=\"TRUE\"&gt;Esri&lt;/attrdefs&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique whole numbers that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;FeatureID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;FeatureID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique GUID's that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;ZOrder&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;ZOrder&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Order of the Z&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;SymbolID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;SymbolID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Symbol Identifier GUID &lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n    &lt;/detailed&gt;\n  &lt;/eainfo&gt;\n&lt;/metadata&gt;\n</code></pre>\n"},{"tags":["sql","asp.net-mvc","sql-server-2008","asp.net-mvc-4","getdate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13239675,"title":"Executing table-less SQL in MVC4","body":"<p>What is the best practice for executing a generic, table-less SQL query within an MVC architecture?</p>\n\n<p>I'm trying to use commands such as these:</p>\n\n<pre><code>SELECT getdate();\nSELECT user;\n</code></pre>\n\n<p><strong>Update:</strong>\nThis is actually for part of another project that co-exists alongside the MVC project. All of my tables so far are mapped using edmx from an existing database.</p>\n\n<p>I'd like to use the date from the database in some internal calculations, rather than using the date from the server where the application/site are installed. My formulas go down to the milliseconds, and the time difference between the two servers involved throws off the math.</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13238726,"title":"Time Breaking in SQL Server","body":"<p>I have a fun challenge with some time data in my application. I have a table of start and end times; and need to subtract out shift times keeping the difference to get multiple rows. Im trying to do this on my SQL Server 2008 box at the moment.</p>\n\n<p>The idea is if i have a time row like</p>\n\n<pre><code>Start 09:00 End 19:12\n</code></pre>\n\n<p>And the shift says 09:00 -> 17:00 I need to split / break the data into two rows</p>\n\n<pre><code>Start 09:00 End 17:00\nStart 17:00 End 19:12\n</code></pre>\n\n<p>This needs to work over midnight too; created some scratch data as I have been playing around with some ideas but am wondering if there is a way out of case statement heck.</p>\n\n<pre><code>Create Table dbo.tblClockEvents\n(\nDayOfWeek Int,\nClockOn Time,\nClockOff Time\n)\n\nCreate Table dbo.tblShiftPattern\n(\nDayOfWeek Int,\nStartTime Time,\nEndTime Time\n)\n\ninsert into dbo.tblShiftPattern\nselect 1, '07:30', '17:00'\nunion select 2, '09:30', '18:00'\nunion select 3, '09:30', '18:00'\nunion select 4, '09:30', '18:00'\nunion select 5, '20:30', '04:00'\n\n\ninsert into dbo.tblClockEvents\nselect 1, '07:30', '17:00'\nunion select 2, '09:22', '18:14'\nunion select 3, '09:12', '18:01'\nunion select 4, '09:22', '18:14'\nunion select 5, '20:22', '04:14'\n\nSelect * \nfrom dbo.tblClockEvents aa\ninner join tblShiftPattern bb\non  aa.DayOfWeek = bb.DayOfWeek\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","table-valued-parameters"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13240720,"title":"Doing an existance check using a subquery with 'LIKE' on a table valued parameter","body":"<p>I am doing an import from excel into the database. I am passing a table valued parameter with a bunch of values, one of them being a foreign key. The catch is that in the database the key value is an <code>nvarchar</code> that always will have 2 or 3 zeroes in front of it, however the people that send the excel files did not properly format the column and those leading zeroes are cut off.</p>\n\n<p>The first thing I need to do in the procedure is to check that all these values exist in a parent table using <code>LIKE</code> (since the leading zeroes are missing). If any of the values don't exist in the parent table then the transaction does not proceed.</p>\n\n<p>I need some help with the MS SQL syntax for this.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":52,"score":0,"question_id":13240298,"title":"Remove numbers from string sql server","body":"<p>I have a large database in which I want to do a part string search. The user will enter characters: <code>JoeBloggs.</code></p>\n\n<p>For arguments sake if I had a name <code>Joe 23 Blo Ggs 4</code> in the database. I want to remove everything in the name other than A-Z. </p>\n\n<p>I have the <code>REPLACE(Name, ' ','')</code> function to remove spaces and the <code>UPPER()</code> function to capitalize the name.</p>\n\n<p>Is there a more efficient fast way maybe by terms of regex to replace anything other than A-Z. I cannot change the values in the database.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2008","user-permissions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2522,"score":0,"question_id":5362206,"title":"SQL Server 2008 user permissions","body":"<p>I am using SQL Server 2008 with SQL authentication... I wanna know permissions given to a particular users.... it should list all the permissions given to a particular user for a particular databases... plz reply fast...</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13239041,"title":"sql server 2008, altering the table layout","body":"<p>Please find the blow table.  </p>\n\n<p><strong>TABLE</strong>  </p>\n\n<pre><code>ClientID    Balance1    Balance2    Balance3    Balance4    Balance5    Balance6    Balance7    Balance8    Balance9\nA           NULL        NULL        NULL        3           Null        Null        Null        Null        Null\nB           10          null        Null        Null        20          Null        Null        Null        NULL\nC           Null        8           Null        10          Null        Null        1           Null        NULL\nD           Null        19          Null        Null        Null        Null        Null        Null        NULL\nE           Null        Null        50          Null        Null        Null        Null        Null        NULL\nF           NULL        NULL        NULL        30          NULL        NULL        NULL        NULL        NULL    \nG           NULL        NULL        NULL        NULL        80          NULL        NULL        NULL        NULL      \n</code></pre>\n\n<p>How can I modify the above table into as shown below by using query, Please help!    </p>\n\n<pre><code>ClientID    Balance1    Balance2    Balance3    Balance4    Balance5    Balance6    Balance7    Balance8    Balance9\nA           NULL        NULL        NULL        3           3           3           3           3           3   \nB           10          10          10          10          20          20          20          20          20\nC           Null        8           8           10          10          10          1           1           1\nD           Null        19          19          19          19          19          19          19          19\nE           Null        Null        50          50          50          50          50          50          50          \nF           NULL        NULL        NULL        30          30          30          30          30          30          \nG           NULL        NULL        NULL        NULL        80          80          80          80          80          \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13238668,"title":"Select into a view","body":"<p>I have a simple CTE <code>x</code> and I wish to select its contents into a view.  Can you select into a view using the same type of syntax that you can for a table? i.e.</p>\n\n<pre><code>SELECT * \nINTO newTable\nFROM OldTable\n</code></pre>\n\n<p>Can new views be created dynamically like this?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":13237736,"title":"How Can we use ISNULL to all Column Names in SQL Server 2008?","body":"<p>I have a question </p>\n\n<p>I tried to <code>google</code> it but looks like they don't like <code>*</code> </p>\n\n<p>I'm using SQL Server 2008.</p>\n\n<p>I have the following database table: </p>\n\n<pre><code> P_Id   ProductName UnitPrice   UnitsInStock    UnitsOnOrder\n------------------------------------------------------------------------\n   1    Jarlsberg   10.45                 16    15\n   2    Mascarpone  Null                  23    NULL \n   3    Gorgonzola  15.67                  9    20\n</code></pre>\n\n<p>If I need to replace the <code>null</code> with a string I know I do :</p>\n\n<pre><code> SELECT ISNULL(UnitsOnOrder,'No Data') FROM tbl\n</code></pre>\n\n<p><strong>Questions</strong> </p>\n\n<ul>\n<li>How can I use <code>ISNULL()</code> with multi column names ?</li>\n<li>is it possible to use it with <code>*</code> </li>\n</ul>\n\n<p><em>Like</em></p>\n\n<pre><code>SELECT ISNULL(* , 'NO data') FROM tbl \n</code></pre>\n\n<p>I think this will be tricky because of the datatype, you can't pass string to <code>INT</code> datatype  so how can I fix this too </p>\n\n<p><strong>Update</strong> </p>\n\n<p>Okay if i use <code>ISNULL(</code>) with a datatype of <code>int</code> it will return <code>0</code> \nwhich will be a value to me , how can i pass empty string instead ? </p>\n\n<p>Thanks </p>\n"},{"tags":["c#","sql-server-2008","entity-framework","entity-framework-4.1","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":394,"score":0,"question_id":10153872,"title":"Tables with mapping not being created at the database","body":"<p>I've been trying to implement the Repository pattern using EntityFramework5. I already got the basics to work. My repositories are being loaded only when necessary and the data is being inserted/updated/retrieved in the database as it should.\nThe problem is: I can't get the tables with mapping to be correctly created, or even created at all.\nI've been reading some articles online, even here, talking about ways to work with mapped tables and create them in the database, but I haven't succeed. Hands my question here.</p>\n\n<p>How do I get it to work in my scenario?</p>\n\n<p>I'll explain what I'm doing so far:</p>\n\n<p>This method below is overriden to, supposedly, create the mappings and tables.</p>\n\n<p>PS: <code>Generics.InvokeGenericMethod</code> is a method I created and it's working. It does what it says :)</p>\n\n<pre><code>    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        foreach (Type entityType in Repositories.Keys)\n        {\n            //Invokes the Entity method from DbModelBuilder injecting the class type.\n            Generics.InvokeGenericMethod(modelBuilder, typeof(DbModelBuilder), entityType, \"Entity\", null);\n        }\n\n        foreach (GaiaEntityConfiguration config in EntityConfigurations)\n        {\n            //Defines each mapping existing in the context\n            config.SetConfiguration(modelBuilder);\n        }\n    }\n</code></pre>\n\n<p>The part that is not working is where I use SetConfiguration. SetConfiguration is a method I created for each class added to the context that has mapping, have that mapping mirrored to the database.</p>\n\n<p>Here's one example (in this case a recipient has many messages and messages have many recipients / many-to-many association):</p>\n\n<p>PS: I left the commented code so you can see one other approach I tried.</p>\n\n<pre><code>    public RecipientEntityConfiguration()\n    {\n        this.LeftKey = \"RecipientId\";\n        this.RightKey = \"MessageId\";\n        this.Schema = \"Hermes\";\n        this.TableName = \"RecipientMessage\";\n    }\n\n    public override void SetConfiguration(DbModelBuilder modelBuilder)\n    {\n        //EntityTypeConfiguration&lt;Recipient&gt; entityTypeConfiguration = new EntityTypeConfiguration&lt;Recipient&gt;();\n\n        //entityTypeConfiguration\n        //    .HasMany&lt;Message&gt;(r =&gt; r.Messages)\n        //    .WithMany(m =&gt; m.Recipients)\n        //    .Map(mr =&gt;\n        //    {\n        //        mr.MapLeftKey(this.LeftKey);\n        //        mr.MapRightKey(this.RightKey);\n        //        mr.ToTable(this.TableName, this.Schema);\n        //    });\n        modelBuilder.Entity&lt;Recipient&gt;()\n            .HasMany&lt;Message&gt;(r =&gt; r.Messages)\n            .WithMany(m =&gt; m.Recipients)\n            .Map(mr =&gt;\n            {\n                mr.MapLeftKey(this.LeftKey);\n                mr.MapRightKey(this.RightKey);\n                mr.ToTable(this.TableName, this.Schema);\n            });\n        //modelBuilder.Configurations.Add&lt;Recipient&gt;(entityTypeConfiguration);\n    }\n</code></pre>\n\n<p>When <code>this.Database.Initialize(false);</code> is called I get this error:</p>\n\n<pre><code>Value cannot be null.\nParameter name: key\n</code></pre>\n\n<p>StackTrace:</p>\n\n<pre><code>   at System.Collections.Generic.Dictionary`2.FindEntry(TKey key)\n   at System.Collections.Generic.Dictionary`2.TryGetValue(TKey key, TValue&amp; value)\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.SortedEntityTypeIndex.Add(EdmEntitySet entitySet, EdmEntityType entityType)\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.EntityMappingService.Analyze()\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.EntityMappingService.Configure()\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.ConfigureEntityTypes(DbDatabaseMapping databaseMapping, DbProviderManifest providerManifest)\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.Configure(DbDatabaseMapping databaseMapping, DbProviderManifest providerManifest)\n   at System.Data.Entity.DbModelBuilder.Build(DbProviderManifest providerManifest, DbProviderInfo providerInfo)\n   at System.Data.Entity.DbModelBuilder.Build(DbConnection providerConnection)\n   at System.Data.Entity.Internal.LazyInternalContext.CreateModel(LazyInternalContext internalContext)\n   at System.Data.Entity.Internal.RetryLazy`2.GetValue(TInput input)\n   at System.Data.Entity.Internal.LazyInternalContext.InitializeContext()\n   at System.Data.Entity.Internal.InternalContext.Initialize()\n   at System.Data.Entity.Database.Initialize(Boolean force)\n   at Gaia.Repository.GaiaContext..ctor(GaiaContextConfiguration config) in E:\\Gaia\\Gaia.Repository\\GaiaContext.cs:line 37\n   at Hermes.HMail.SendMessage(Int64 sender, Int64[] toUsers, String subject, String content, FileStream attachment) in G:\\Gaia\\Hermes\\HMail.cs:line 78\n   at Gaia.Controllers.ApplicationController.Test() in G:\\Gaia\\Gaia\\Controllers\\ApplicationController.cs:line 18\n   at lambda_method(Closure , ControllerBase , Object[] )\n   at System.Web.Mvc.ActionMethodDispatcher.&lt;&gt;c__DisplayClass1.&lt;WrapVoidAction&gt;b__0(ControllerBase controller, Object[] parameters)\n   at System.Web.Mvc.ActionMethodDispatcher.Execute(ControllerBase controller, Object[] parameters)\n   at System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters)\n   at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters)\n   at System.Web.Mvc.ControllerActionInvoker.&lt;&gt;c__DisplayClass15.&lt;InvokeActionMethodWithFilters&gt;b__12()\n   at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter(IActionFilter filter, ActionExecutingContext preContext, Func`1 continuation)\n</code></pre>\n\n<p>Any ideas?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13237830,"title":"SQL Server 2008 query to fill the null values","body":"<p>I need a query on below table</p>\n\n<p>TABLE     </p>\n\n<pre><code>ClienName   Bal0    Bal1    Bal2        Bal3        Bal4        Bal5        Bal6    \n--------------------------------------------------------------------------------\nA           600     600     NULL        NULL        NULL        NULL        NULL    \nB           Null    100     NULL        NULL        NULL        NULL        NULL    \nC           NULL    NULL    200          NULL       NULL        NULL        NULL        \nD           NULL    NULL    NULL        NULL        NULL        130         130     \nE           510     510     NULL        510         510         NULL        NULL    \nF           170     170     NULL        170         170         NULL        170 \nG           210     210     NULL        210         210         210         210     \nH           20      20      NULL        20          NULL        NULL        NULL    \n</code></pre>\n\n<p><strong>Result:  I would like to see the above TABLE as below, which query can do it? please help</strong>  </p>\n\n<pre><code>ClienName   Bal0    Bal1    Bal2        Bal3        Bal4        Bal5        Bal6    \n--------------------------------------------------------------------------------\nA           600     600     600         600         600         600         600     \nB           100     100     100         100         100         100         100     \nC           200     200     200         200         200         200         200     \nD           130     130     130         130         130         130         130         \nE           510     510     510         510         510         510         510     \nF           170     170     170         170         170         170         170 \nG           210     210     210         210         210         210         210     \nH           20      20      20          20          20          20          20\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13237853,"title":"SQL Server Procedure Bad Cache Planning","body":"<p>I have some SQL code that uses PetaPoco that executes using sp_executesql. The query has 3 parameters: 2 dates and one string (as varchar(5)).</p>\n\n<p>The query takes 3 minutes to run - from the app or SSMS. If I run the same code in SSMS without sp_executesql (or parameters) it runs in 10 seconds and if I add the OPTION (OPTIMIZE FOR UNKNOWN) hint to the original code (using the sp) it runs in 3 seconds. I have cleared the cache using </p>\n\n<pre><code>  CHECKPOINT;\n  GO\n  DBCC DROPCLEANBUFFERS;\n  GO\n  DBCC FREEPROCCACHE;\n  GO\n</code></pre>\n\n<p>And I still can't get it to run as expected. It seems that adding the option to every query is a hack. Am I missing something?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":38,"score":-2,"question_id":13237623,"title":"Copy data into another table","body":"<p>How to copy (append) data from one table into another table with same schema in SQL Server?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>I mean to say there is query </p>\n\n<pre><code>select * \ninto table1 \nfrom table2 \nwhere 1=1 \n</code></pre>\n\n<p>which creates <code>table2</code> with the same structure as <code>table1</code>. </p>\n\n<p>So is there any short query like this to only copy entire data only into an already existing table?</p>\n"},{"tags":["sql-server-2008","excel-vba"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":41,"score":3,"question_id":13229003,"title":"Connecting VBA to SQL server using ADO - object closed","body":"<p>I have created the object and from which I can tell I have just preformed a query on it, can anyone tell me where my error is?</p>\n\n<p>The error statement is</p>\n\n<pre><code>“Run time error ‘3704’ operation is not allowed when the object is closed” \n</code></pre>\n\n<p>and it occurs on this line</p>\n\n<pre><code>ActiveWorkbook.Worksheets(\"SQL\").Range(\"A1\").CopyFromRecordset rspubs\n</code></pre>\n\n<p>MY CODE IS</p>\n\n<pre><code>Sub sqlTest()\n\nDim Sqlquery As String\nDim cnpubs As ADODB.Connection\nDim rspubs As ADODB.Recordset\n\n' Create a connection object.\nSet cnpubs = New ADODB.Connection\n' Create a recordset object.\nSet rspubs = New ADODB.Recordset\n' Provide the connection string.\nDim strConn As String\n\n\n'Construct query\nSqlquery = \" sql query;”\n\n'Use the SQL Server OLE DB Provider.\n\nstrConn = \"Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security Info=True;Data Source=XXXX;Use Procedure for Prepare=1;Auto Translate=True;Packet Size=4096;Workstation ID=XXXX;Use Encryption for Data=False;Tag with column collation when possible=False;Initial Catalog=Prospects\" \n\n'Now open the connection.\ncnpubs.Open strConn\n\nWith rspubs\n' Assign the Connection object.\n.ActiveConnection = cnpubs\n' Extract the required records.\n'.Source = Sqlquery\n.Open Sqlquery\n' Copy the records into cell A1 on Required Sheet\nActiveWorkbook.Worksheets(\"SQL\").Range(\"A1\").CopyFromRecordset rspubs\nEnd With\n\n' Tidy Up\ncnpubs.Close\nrspubs.Close\n\nSet cnpubs = Nothing\n\nSet rspubs = Nothing\n\n\nEnd Sub\n</code></pre>\n"},{"tags":["sql","database","sql-server-2008","query","insert"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13235606,"title":"SQL query :Copy one table to another from different servers","body":"<p>What's wrong with my query, I want to copy three columns to another server\\table if one of the column (ID_DIRCT) is not null :</p>\n\n<pre><code>INSERT INTO  System\\Syst3.Server1.dbo.TABLE_RESRC (NO_EMPLY,PR,NM_FAML,CO_DIRCT)\nSELECT NO_EMPLY, PR_EMPLY, NM_EMPLY, ID_DIRCT \nFROM System\\Syst3.Server2.dbo.RESRC\nWHERE System\\Syst3.Server2.dbo.RESRC.ID_DIRCT IS NOT NULL\n</code></pre>\n\n<p>Using SQL Server 2008 R2.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":135,"score":10,"question_id":13235382,"title":"Double IN Statements in SQL","body":"<p>Just curious about the IN statement in SQL.\nI know I can search multiple columns with one value by doing</p>\n\n<pre><code>'val1' IN (col1,col2)\n</code></pre>\n\n<p>And can search a column for multiple values</p>\n\n<pre><code>col1 IN ('val1','val2')   \n</code></pre>\n\n<p>But is there a way to do both of these simultaneously, without restorting to an repeating AND / OR in the SQl? I am looking to do this in the most scalable way, so independent of how many vals / cols i need to search in.\nSo essentially:</p>\n\n<pre><code>('val1','val2') IN (col1,col2)\n</code></pre>\n\n<p>but valid.</p>\n"},{"tags":["sql","sql-server-2008","where-clause"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":13234075,"title":"Filtering data from 3 tables on 2 columns not giving good result","body":"<p>so i have 3 tables 1 table is used to get all the good numbers from \nthe second table will contain the date thats needs to be between 2 dates \nand the third table has the information numbers i whant so i tryd something like this but getting wrong results.</p>\n\n<pre><code> select columns,\n   (\n     select \n       SUM(column) \n     from \n       table3 \n     where \n       (column is null or column &lt;&gt; 4) \n         and table3nrcolumn = table1nrcolumn \n         and othercolumnnr from table3 in\n           (\n             select \n               column \n             from \n               table2 \n             where \n               (column is null or column &lt;&gt; 4) \n               and (column_datum between '2012-10-29' and '2012-11-04'))) \n                  as result\nfrom \n  table1\n</code></pre>\n\n<p>but i am getting wrong results i think because of the date between but i cant figure out wy hope someone can help</p>\n\n<p>Sorry for the late reaction but i whas working on on something else and Tanx for the fast reaction il try to make it a bit more clear</p>\n\n<p>select id, naam, prijs,\n(select SUM(aantal) from TABLE2 where (nr is null or nr &lt;> 4) and id_TABLE2 = id_TABLE1 and other_nr_TABLE2 in\n(select other_nr from TABLE3 where (nr is null or nr &lt;> 4) and (datum >= '2012-10-29' and datum &lt;= '2012-11-04'))) as resultset\nfrom TABLE1</p>\n\n<p>Table 1 contains writing material Contains All posible rows \nTable 2 contains writing material thats packed togetor under other_nr Can Contain more ROWS\nTable 3 contains packed name under other_nr with a date Contains 1 row</p>\n\n<p>so i need the material from a date range out table 2 that has a connection with table 3 under other_nr And i need to select a date range from table 3 and get the Materials from table 2</p>\n\n<p>hope its a bit more clear now\nVerry srry but i still dont get the tags needed for code</p>\n"},{"tags":["c#","sql-server-2008","gridview","paging","extjs4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13235286,"title":"How to page data according to pagingtoolbar's request","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13240121/what-is-the-equivalent-of-this-code-in-c-sharp-to-pass-the-start-and-limit-varia\">What is the equivalent of this code in c# to pass the start and limit variable to query for paging</a>  </p>\n</blockquote>\n\n\n\n<p><a href=\"http://stackoverflow.com/questions/13202893/extjs-paging-toolbar-in-grid-does-not-work/13202973#13202973\">This question follows from this thread...</a>I am trying to change server code to account for the start and limit http parameters to use pagingtoolbar in extjs...</p>\n\n<p>right now my server code... gets all the data in json and throws everything in my gridview in first page... below is my code... what changes would I need to make... please help...</p>\n\n<pre><code> string sqlquery = \"SELECT Q1, Q2, Q3, Q4, Improvements, Comments FROM ITable\";\n    conn.Open();\n    SqlDataAdapter cmd = new SqlDataAdapter(sqlquery, conn);\n    SqlCommand comd = new SqlCommand(sqlquery, conn);\n    DataSet myData = new DataSet();\n    cmd.Fill(myData, \"myTable\");\n\n    comd.CommandText = \"SELECT COUNT(*) FROM ITable\";\n    Int32 count = (Int32)comd.ExecuteScalar();\n\n    comd.ExecuteNonQuery();\n    conn.Close();\n\n\n    var results = (new\n\n    {\n\n        TotalNumber = count,\n\n        myTable = myData\n\n    });\n\n    return JsonConvert.SerializeObject(new { count=count, myTable = myData.Tables[0] }, Formatting.Indented,\n                    new JsonSerializerSettings\n                    {\n                        ReferenceLoopHandling = ReferenceLoopHandling.Ignore\n                    });\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":46,"score":3,"question_id":13235048,"title":"Multiple Rows in INSERTED table","body":"<p>On a table in MS SQL Server I need to run a CLR Stored Procedure on new rows if those rows meet certain criteria.  I thought that would be more or less straightforward:</p>\n\n<pre><code>if ((SELECT Cabinet FROM INSERTED) = 1 OR (SELECT Cabinet FROM INSERTED) = 3) AND (SELECT Result_02 FROM INSERTED) = 'N'\nBEGIN\n    DECLARE @id int\n    SET @id = (SELECT ID FROM INSERTED)\n    exec PrintLabel\n        @id,\n        N'LP 2844 LGE'\nEND;\n</code></pre>\n\n<p>However, this recently started throwing errors about a subquery returning multiple rows. I learned that INSERT triggers run once for each statement, not necessarily on individual rows. So, that IF statement can be working on multiple rows, and thus the error.</p>\n\n<p>My question is: how can I iterate over each new row if the rows are added in a batch (in this case via a MERGE statement). </p>\n"},{"tags":["html","sql","xml","sql-server-2008","import"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13234725,"title":"Importing XML into SQL Server 2008 including html tags","body":"<p>I need to import an XML file into a SQL Server 2008 table. One of the XML tags contains valid HTML tags which I want also want imported. Below is one of my elements, as you can see the descriptor tag contains HTML tags which I would like included in the import.</p>\n\n<pre><code>&lt;criterionlist&gt;\n    &lt;element&gt;\n         &lt;subjectname&gt;Humanities&lt;/subjectname&gt;\n         &lt;criterion&gt;A&lt;/criterion&gt;\n         &lt;phase&gt;1&lt;/phase&gt;\n         &lt;level&gt;1&lt;/level&gt;\n         &lt;descriptor&gt;The student: &lt;li&gt; makes &lt;b&gt;a limited attempt&lt;/b&gt; to use &lt;b&gt;some&lt;/b&gt; relevant terminology &lt;/li&gt;\n        &lt;li&gt; demonstrates &lt;b&gt;basic&lt;/b&gt; knowledge and understanding of content and concepts through &lt;b&gt;some&lt;/b&gt; descriptions and/or examples.&lt;/li&gt; &lt;/descriptor&gt;\n    &lt;/element&gt;\n</code></pre>\n\n<p>Is this possible? I managed to import the file into a table using <code>OPENROWSET</code>, but it ignores the HTML tags..</p>\n\n<p>Many thanks,\nDave.</p>\n"},{"tags":["c#","sql-server-2008","permissions","database-connection","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":13233715,"title":"Connect to SQL Server 2008 Database via C#","body":"<p>I am attempting to connect to a database I created in SQL Server 2008 on my computer.\nI have a Windows Authentication login which looks like this:</p>\n\n<pre><code>try\n{\n  string sCon = @\"Data Source=David-PC\\SQLEXPRESS; Initial Catalog=ZarTrackDB; Integrated Security = true\";\n   SqlConnection dbConn;\n   dbConn = new SqlConnection(sCon);\n   dbConn.Open();\n}\ncatch (Exception ex)\n{\n    MessageBox.Show(this, \"An error occurd while attemtpting to connect to DB.\\n\" + ex.Message, \"DB Connection Error\", MessageBoxButtons.OK, MessageBoxIcon.Error);\n     return;\n}\n</code></pre>\n\n<p>however it keeps throwing an exception:</p>\n\n<blockquote>\n  <p>Login failed for user David-PC\\David</p>\n</blockquote>\n\n<p>I am able to connect to the Master DB though:</p>\n\n<pre><code> string sCon = @\"Data Source=David-PC\\SQLEXPRESS; Initial Catalog=Master; Integrated Security = true\";\n</code></pre>\n\n<p>So i guess the probelm might be I do not have permissions? How do I go about giving myslef permissions to access this DB though when I login via SQL Server Management Studio I can insert create query etc on the ZarTrackDB perfectly.</p>\n\n<p>I truly dont know what to do anymore please help!</p>\n\n<p>EDIT:</p>\n\n<p>here is a screen shot of my user mappings for the account I am trying to log in with:</p>\n\n<p><strong>User Mappings:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/pyVC7.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Server Roles</strong>:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Ua5NL.png\" alt=\"enter image description here\"></p>\n\n<p>UPDATE:</p>\n\n<p>If I login to master and attempt to access ZarTrack :</p>\n\n<pre><code>   string sCon = @\"Data Source=David-PC\\SQLEXPRESS; Initial Catalog=Master; Integrated Security = true\";\n                SqlConnection dbConn;\n                dbConn = new SqlConnection(sCon);\n                dbConn.Open();\n\n                string sql = \"USE ZarTrackDB \"+\n\"CREATE TABLE Customers (\"+\n\n\"CustomerID int IDENTITY PRIMARY KEY NOT NULL,\" +\n\"CompanyName varchar(30) NOT NULL,\"+\n\"CompanyAddress varchar(40) NOT NULL,\"+\n\"Email varchar(40) NOT NULL,\"+\n\"PhoneNumber varchar(15) NOT NULL\"+\n\");\";\n                SqlCommand dbCmd = new SqlCommand();\n                dbCmd.CommandText = sql;\n                dbCmd.Connection = dbConn;\n\n                dbCmd.ExecuteNonQuery();\n</code></pre>\n\n<p>I get Exception:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Rxlgn.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","xml","sql-server-2008","tsql","xquery"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13234175,"title":"Use of xml.modify to insert parameters into specific element of an xml column","body":"<p>I would like to use a stored procedure to insert some values passed in as parameters into elements in the xml of a column. I have this so far\nThe following parameters:</p>\n\n<pre><code>@profile_id int,\n@user_id nvarchar(50),\n@activity_name nvarchar(50),\n@display_name nvarchar(50)\n</code></pre>\n\n<p>Retrieve the desired xml:</p>\n\n<pre><code>DECLARE @profiles_xml xml\nSET @profiles_xml = (SELECT profiles from tbl_applied_profiles WHERE profiles.value('(Profile/ID)[1]','int')= @profile_id)\n</code></pre>\n\n<p>The xml from the column inside the @profiles_xml looks like this:</p>\n\n<pre><code>&lt;Profile&gt;\n  &lt;ID&gt;20&lt;/ID&gt;\n  &lt;User&gt;\n    &lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;\n    &lt;Name&gt;somename&lt;/Name&gt;\n    &lt;Activities&gt;\n      &lt;Activity&gt;\n         &lt;Name&gt;activity1&lt;/Name&gt;\n      &lt;/Activity&gt;\n    &lt;/Activities&gt;\n  &lt;/User&gt;\n&lt;/Profile&gt;\n</code></pre>\n\n<p>Attempt to Insert into User with specific ID the activity name and display name:</p>\n\n<pre><code>SET @profiles_xml.modify('\n    insert\n    if(/Profile/User/ID=sql:variable(\"@user_id\"))\n    then Activity[Name=sql:variable(\"@activity_name\")][DisplayName=sql:variable(\"@display_name\")]\n    else()\n    as first\n    into (/Profile/User/Activities)[1]')\n</code></pre>\n\n<p>I have also tried this with no success:</p>\n\n<pre><code> SET @devices_xml.modify('\n    insert /Profile/User[ID=sql:variable(\"@user_id\")]/Activity[Name=sql:variable(\"@activity_name\")][DisplayName=sql:variable(\"@display_name\")]\n    into (/Profile/User/Activities)[1]')\n</code></pre>\n\n<p>And this:</p>\n\n<pre><code> SET @devices_xml.modify('\ninsert\n /Profile/User[ID=sql:variable(\"@user_id\")]/Activities/Activity[Name=sql:variable(\"@activity_name\")][DisplayName=sql:variable(\"@display_name\")]\n    into (/Profile/User/Activities)[1]')\n</code></pre>\n\n<p>What is the correct way to do this?</p>\n"},{"tags":["sql-server-2008","visual-studio-2012","connection-string","localdb"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":13002250,"title":"Running ASP.NET app with VS2012 debugger uses LocalDB despite connection string in web.config","body":"<p>I want to use SQL 2008 R2 on the server where I run VS 2012, so I created the \"membership\" database (using  Aspnet_regsql tool) and configured it to work with IIS7). Then I created ASP.NET Application and modified the web.config so that connection string points to this database.</p>\n\n<p>Running this app with VS 2012 debugger results with my app creating the LocalDB  ASPNETDB.MDF instance in app_data folder. VS ASP.NET Configuration tool when invoked from VS Tools menu shows the LocalDB based data and the running application access this database instead of SQL Server 2008 R2 server - which runs on the same server.</p>\n\n<p>I believe that this is some side-effect of the VS generated web.config file, but despite looking hard, I found nothing suspicious.</p>\n\n<p>Note: this same scenario works just fine with Visual Studio 2010 if I am using it's own generated web.config file.</p>\n\n<p>I would hate to dismiss VS 2012 for this as I am pretty sure that I did something wrong.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13232177,"title":"Getting all related rows that a value is included in, in a mapping table","body":"<p>I don't even know how to start my search on this one.</p>\n\n<p>Let me explain what I'm trying to do :</p>\n\n<p>I have a variable - value mapping table.\n<strong>Several values can be assigned to a variable, and the same value can be assigned to many variables</strong>.</p>\n\n<p>The user is able to delete variables/values.\nHowever, <strong>a value should not be allowed to be deleted if there are any variables that only have this specific value assigned to them</strong>. Otherwise the variables would remain undeleted, but with 0 values assigned, which is wrong.</p>\n\n<p>Now, at the point where the user tries to delete a value from a specific variable, I want to check :</p>\n\n<p><strong>IF for the selected valueID there are any variableIDs that only have one valueID assigned to them, and that valueID is the one the user is trying to delete.</strong>\nIf so, then abort. Otherwise proceed.</p>\n\n<p>Is this possible in any way?</p>\n\n<p>Table Names : </p>\n\n<pre><code>Variable\nValue\nVariable_Value ( mapping table )\n</code></pre>\n\n<p>Field Names ( in all tables ) :</p>\n\n<pre><code>Variable_ID\nValue_ID\n</code></pre>\n\n<p>Example below :</p>\n\n<pre><code>For example Variable_ID 5 only has Value_ID 10 assigned to it. \nIf a user selects a Variable_ID, he sees all assigned Value_IDs \nand is able to select one and try to delete it. So, a user could click \non Variable_ID 3 and try to delete Value_ID 10. That shouldn't \nbe possible if that specific Value_ID is the only assigned \nvalue to any other Variable, because that would leave that \nvariable with no Value_IDs.\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/9ezry.jpg\" alt=\"\"></p>\n"},{"tags":["sql","xml","sql-server-2008","tsql","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13233034,"title":"Use of logical and for an xquery delete in tsql","body":"<p>Is it possible to use a logical and operator with an xquery statement inside a stored procedure to delete an element only if its parent element has a specific value AND it has a specific value? Such as:</p>\n\n<pre><code>SET @profiles_xml = (SELECT profiles from tbl_applied_profiles WHERE profiles.value('(Profile/ID)[1]','int')= @profile_id)\n    SET @profiles_xml.modify('\n    delete\n    if(/Profile/User/ID=sql:variable(\"@user_id\")) and (/Profile/User/Activities/Activity/Name = sql:variable(\"@activity_name\"))\n    then (/Profile/User/Activities/Activity)\n    else()\n    ')\n</code></pre>\n\n<p>I would like to delete the Activity only if the User ID element and Activity Name element match the given parameters.\nThe xml in profiles_xml looks like this:</p>\n\n<pre><code>&lt;Profile&gt;\n  &lt;ID&gt;20&lt;/ID&gt;\n  &lt;User&gt;\n    &lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;\n    &lt;Name&gt;somename&lt;/Name&gt;\n    &lt;Activities&gt;\n      &lt;Activity&gt;\n         &lt;Name&gt;activity1&lt;/Name&gt;\n      &lt;/Activity&gt;\n    &lt;/Activities&gt;\n  &lt;/User&gt;\n&lt;/Profile&gt;\n</code></pre>\n\n<p>But in the future there will potentially be multiple  elements in each  and Multiple  elements as children of the  element.</p>\n"},{"tags":["asp.net","visual-studio","sql-server-2008","visual-studio-2012"],"answer_count":2,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":12782404,"title":"Visual Studio 2012 - Database Publishing Wizard Discontinued?","body":"<p>I'm using VS 2012 and SQL Server 2008 and have just noticed that the \"Publish to Provider\" option is missing in Server Explorer. According to this, Database Publishing Wizard has been discontinued?</p>\n\n<p><a href=\"http://forums.asp.net/post/5122271.aspx\" rel=\"nofollow\">http://forums.asp.net/post/5122271.aspx</a></p>\n\n<p>How can I publish my database to my server now? Is generating scripts the only option instead of doing this from within the VS IDE and if so, can someone provide the steps to generate the DB with stored procedures included?</p>\n\n<p><strong>UPDATE:</strong> </p>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/11538254/how-to-publish-database-to-provider-in-visual-studio-2012-rc\">Similar question</a> but unsatisfactory answer.</li>\n<li><a href=\"http://connect.microsoft.com/VisualStudio/feedback/details/729467/database-publishing\" rel=\"nofollow\">Confirmation</a> that the wizard has indeed been discontinued.</li>\n</ul>\n"},{"tags":["sql-server-2008","certificate","windows-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13231751,"title":"SQL server 2008 encrypted connection confusion","body":"<p>So I've set up a domain name for my server and have created a self-signed cert via IIS. Then I've opened the SQL server configuration manager and have set the the MSSQLSERVER's properties as follows:</p>\n\n<ul>\n<li>Force Encryption = Yes</li>\n<li>Hide Instance = Yes</li>\n<li>Certificate = (set to the just-created self-signed cert)</li>\n</ul>\n\n<p>Then I've created an SQL login and tried to connect (using SQL management studio) via a different computer to the server. And it worked! The following query said <code>TRUE</code>:</p>\n\n<pre><code>SELECT encrypt_option \nFROM sys.dm_exec_connections \nWHERE session_id = @@SPID\n</code></pre>\n\n<p>But the thing is that I haven't installed the cert with the public key on the remote computer yet! So how come that the server allowed and encrypted the connection without the public key cert installed?</p>\n"},{"tags":["visual-studio-2010","sql-server-2008","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13231314,"title":"Show chart data based on a string in a dataset","body":"<p>I am trying to add a sparkline to show a trend based on 4 years data, this would be the datasource, it is just a single line.</p>\n\n<p>The problem I have is that the years in my dataset are actually column names for a different set of data and I don't have any room to changed this. So in my dataset I have the y1,y2,y3,y4 but they have many rows for each containing separate data.</p>\n\n<p>My idea was to do a sum on each year column, then create a string of the 4 values as a new calculated field and then base the spark line on this somehow.</p>\n\n<p>I am not sure if this is the best way or if there is another method that I am not thinking of, any tips would be appreciated.</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13230813,"title":"Transaction context in use by another session","body":"<p>I have a trigger in my one of the table(tblCustomerContact) like as given below</p>\n\n<pre><code>ALTER TRIGGER [dbo].[tr_UpdateVIEmailFlag]\n    ON  [dbo].[tblCustomerContact]\n   AFTER INSERT , UPDATE , DELETE\nAS \nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    -- Insert statements for trigger here\n\n    DECLARE @isLinkedWithVI varchar(2)\n    DECLARE @pkCustomer int\n    DECLARE @customerCode varchar(8)\n    DECLARE @siteCode varchar(2)\n    DECLARE @sql varchar(200)\n\n    DECLARE @VIConnection varchar(100)\n     DECLARE @serverName varchar(100)\n    DECLARE @dbName varchar(100)\n\n    SET @isLinkedWithVI =  (SELECT ConstantValue From systblBaccusConstants WHERE ConstantName = 'IsLinkedWithVisionInvoicing' )\n    SET  @VIConnection = (SELECT  ConstantValue From systblBaccusConstants WHERE ConstantName = 'VisionInvoicingConnectionString' )\n\n    IF LEN( RTRIM(LTRIM(@VIConnection)) ) &gt; 0\n    BEGIN\n        SET @serverName = REPLACE(REPLACE(SUBSTRING( @VIConnection , 0 , Charindex( ';', @VIConnection,0)) , 'Data Source' , '') , '=','')\n        SET @dbName =  REPLACE( REPLACE(  SUBSTRING( SUBSTRING( @VIConnection , Charindex( ';', @VIConnection,0)+1 ,LEN (@VIConnection) ) ,\n        0 , CHARINDEX(';' , SUBSTRING( @VIConnection , Charindex( ';', @VIConnection,0)+1 ,LEN (@VIConnection) ) , 0))\n        ,'Initial catalog' ,'') , '=','')       \n    END \n\n    IF @isLinkedWithVI = '1'\n    BEGIN\n\n        SELECT \n            @pkCustomer = FKCustomer\n        FROM INSERTED \n\n        IF @pkCustomer IS NULL\n        BEGIN\n            SELECT \n                @pkCustomer = FKCustomer\n                FROM DELETED\n        END     \n\n\n        SELECT     @customerCode = tblCustomer.CustomerCode, \n                    @sitecode = tblSite.SiteCode            \n        FROM    tblCustomer                         \n                        INNER JOIN  tblSite ON tblCustomer.FKSite = tblSite.PKSite\n        WHERE       PKCustomer = @pkCustomer    \n\n\n            IF ( SELECT COUNT(FKCustomer)  \n                    FROM         tblCustomerContact\n                    WHERE FKCustomer =  @pkCustomer \n                    GROUP BY FKCustomer\n                    HAVING  \n                    (MAX(CAST(EmailGoodsInInvoices AS int)) = 1 )\n                    AND (MAX(CAST(EmailGoodsOutInvoices AS int)) = 1) \n                    AND (MAX(CAST(EmailStockStorageInvoices AS int))= 1) \n                    AND (MAX(CAST(EmailTransportInvoices AS int)) = 1)\n                ) &gt; 0\n            BEGIN\n                -- UPDATE VI\n                SET @sql  = 'UPDATE c\n                SET  Email = 1,\n                IsPrint = 0\n                FROM [' + @serverName + '].' + @dbName + '.dbo.tblCustomerReportPrintOption c \n                WHERE CustomerCode =  ' + '''' +  @CustomerCode + '''' + ' AND SiteCode = ' + '''' + @siteCode + ''''   \n\n                EXEC(@sql)\n\n            END \n            ELSE\n            BEGIN\n                -- UPDATE VI\n                SET @sql  = 'UPDATE c\n                SET  Email = 0,\n                IsPrint = 1\n                FROM [' + @serverName + '].' + @dbName + '.dbo.tblCustomerReportPrintOption c \n                WHERE CustomerCode =  ' + '''' +  @CustomerCode + '''' + ' AND SiteCode = ' + '''' + @siteCode + ''''   \n\n                EXEC(@sql)\n            END\n    END\n\n\nEND\n</code></pre>\n\n<p>When I try to update one of the table value using an update query </p>\n\n<p>update tblCustomerContact set lastname='test3'</p>\n\n<p>where PKCustomerContact=3473</p>\n\n<p>I am getting the below error in </p>\n\n<p>Transaction context in use by another session.</p>\n\n<p>Can anyone help me please?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13229558,"title":"An expression of non-boolean type specified in a context where a condition is expected, near ','","body":"<p>I've reviewed other similar questions on this however I do not have a <code>Where</code> clause in my query which leaves me a little confused as to how to resolve it.</p>\n\n<pre><code>INSERT INTO #tmpCombined  \nSELECT A.Region  \n    , 'MyLocation' AS 'Location'  \n    , c.Id AS 'CompID'  \n    , c.Name AS 'CompName'  \n    , 'Cash' AS 'Context'  \n    , isnull( sum( CASE WHEN T.TranAge &gt;= 0 and CASE WHEN T.TranAge &lt; 1 THEN 1 ELSE 0 END,0 )) AS 'ZeroDays0'  \n    , isnull( sum( CASE WHEN T.TranAge &gt;= 1 and CASE WHEN T.TranAge &lt; 8 THEN 1 ELSE 0 END ), 0 ) AS '1to7Days'  \n    , isnull( sum( CASE WHEN T.TranAge &gt;=  8 and CASE WHEN T.TranAge &lt; 16 THEN 1 ELSE 0 END ), 0 ) AS '8to15Days'  \n    , isnull( sum( CASE WHEN T.TranAge &gt;=  16 and CASE WHEN T.TranAge &lt; 20 THEN 1 ELSE 0 END ), 0 ) AS '16to20Days'  \n    , isnull( sum( CASE WHEN T.TranAge &gt;=  20 THEN 1 ELSE 0 END ), 0 ) AS '20DaysPlus'  \n    , COUNT(1) AS 'Total'  \n    , A.Level as 'Level'  \n    , sum(T.USDDifference) AS 'USDRevaluation'  \n    from MyLocation.dbo.Company C  \n    inner join #tmpCashTBResults T on T.CompanyId = C.Id  \n    inner join #tmpCashAccounts A on T.CompanyId = A.CompanyId  \n    group by A.Region, C.Id, C.Name, A.Level  \n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13229808,"title":"Can we realy on DMV Data?","body":"<p>Hi i am using SQL SERVER 2008 R2. i have to capture the details of backend process or execution is going on in sql server. and wanted to figure out the total number of time it got exectuted , cpu utilization, read, writes. To get the exact data from DMV do we really need to flush DMV or not ? </p>\n"},{"tags":["mysql","sql-server-2008","drupal-6","windows-server-2008","database-connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13221245,"title":"Sync SQL Server 2008 with database of a Drupal website","body":"<p>I have a client who's using some custom built progam which uses SQL server 2008 DB and is running on Windows Server 2008.\n On the other hand, the same client has a Drupal 6 website  with a mySQL DB.\nEach DB is stored on a different server, and the DB's have <b> some </b> tables in common but not all of them.\nThat client wants a 2 way synchronization between these DB's, which means the following: <br> <br>\n1. Those tables which are similar in both DB's have to contain the same data. <br>\n2. The client can make changes in both website and the program and the changes in one DB will be mirrored on to the second.<br> <br></p>\n\n<p>How would you approach such problem? <br><br>\nThanks for your time and trouble , any (well, almost any) piece of advice will be appreciated.<br>\nJimbo.</p>\n"},{"tags":["c#","sql-server","database","sql-server-2008","database-administration"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13227146,"title":"Want an idea in writing a code section","body":"<p>Scenario :\nI am creating a admin tool in C# which will restore a full sql server backup in a server and apply the transaction logs. After db come up. I have run a few scripts shown below. </p>\n\n<pre><code>use master\nEXEC sp_addlogin '&lt;destsid&gt;', '&lt;sidadmpass&gt;','&lt;dbname&gt;'\nuse &lt;dbname&gt;\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nEXEC sp_change_users_login 'Update_One','&lt;destsid&gt;','&lt;destsid&gt;'\nuse master\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse msdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC     sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse model\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse tempdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\ngrant all on xp_cmdshell to &lt;destsid&gt;\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'serveradmin'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'dbcreator'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'bulkadmin'\nuse &lt;dbname&gt;\nif object_id('sp_change_sapuser') is not null\n    drop procedure sp_change_sapuser \ncreate procedure sp_change_sapuser @oldid sysname, @newid sysname\nas begin\ndeclare @oldid_uid  smallint\ndeclare @newid_uid  smallint    \ndeclare @object     sysname\ndeclare @object_full    nvarchar(999)\nset @oldid_uid = user_id(@oldid)\nset @newid_uid = user_id(@newid)\nif @oldid_uid is not null and @newid_uid is not null\nbegin\ndeclare object_cursor cursor local for \nselect name from sysobjects where((xtype='U' and name &lt;&gt; 'dtproperties') or (xtype='V' and name not in ('syssegments','sysconstraints')) or (xtype='P' and name not like 'dt_%') or (xtype='D' and name not like 'DF__dtpropert%') or (xtype in ('FN','TF','IF'))) and @oldid_uid = uid\nopen object_cursor\nfetch next from object_cursor into @object\nwhile @@fetch_status=0\nbegin\nset @object_full = user_name(@oldid_uid) + '.' + @object\nexec sp_changeobjectowner @object_full, @newid\nfetch next from object_cursor into @object\nend\nend\nelse\nif @oldid_uid is null\nbegin\nprint '*** old database user does not exist ***'\nend\nif @newid_uid is null\nbegin\nprint '*** new database user does not exist ***'\nend\nend\nexec sp_change_sapuser '&lt;sourcesid&gt;', '&lt;destsid&gt;'\nuse master\nEXEC sp_grantlogin   'AMR\\&lt;destsid&gt;adm'\nEXEC sp_grantlogin   'AMR\\SAPService&lt;dbname&gt;'\nEXEC sp_defaultdb    'AMR\\&lt;destsid&gt;adm','&lt;dbname&gt;'\nEXEC sp_defaultdb    'AMR\\SAPService&lt;dbname&gt;','&lt;dbname&gt;'\nEXEC sp_addsrvrolemember 'AMR\\&lt;destsid&gt;adm',     'sysadmin'\nEXEC sp_addsrvrolemember 'AMR\\SAPService&lt;dbname&gt;', 'sysadmin'\nEXEC xp_sqlagent_proxy_account 'SET', '&lt;servername&gt;', 'SAPMssXPUser',N'&lt;sidadmpass&gt;'\nuse master\nEXEC sp_addlogin '&lt;destsid&gt;', '&lt;sidadmpass&gt;', &lt;dbname&gt;\nuse &lt;dbname&gt;\nEXEC sp_change_users_login 'Update_One','&lt;destsid&gt;','&lt;destsid&gt;'\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse msdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse model\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse tempdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\ngrant all on xp_cmdshell to &lt;destsid&gt;\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'serveradmin'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'dbcreator'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'bulkadmin'\n--EXEC xp_sqlagent_proxy_account 'SET', '&lt;servername&gt;', 'SAPMssXPUser', N'&lt;sidadmpass&gt;'\nEXEC sp_grantlogin   '&lt;destsid&gt;adm'\nEXEC sp_grantlogin   'SAPService&lt;dbname&gt;'\nEXEC sp_defaultdb    '&lt;destsid&gt;adm','&lt;dbname&gt;'\nEXEC sp_defaultdb    'SAPService&lt;dbname&gt;','&lt;dbname&gt;'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;adm',     'sysadmin'\nEXEC sp_addsrvrolemember 'SAPService&lt;dbname&gt;', 'sysadmin'\n</code></pre>\n\n<p>Note : values given  will be replaced with actual values.</p>\n\n<p>While running these scripts few may throw exceptions. But i want to continue even though some scripts throws error. And also i have removed GO(batch terminator) because i cannot add separate dll into server. Please suggest some idea to get this problem solved. </p>\n\n<p>Details :\nProgramming lang : C#\nDb - Sql Server 2005,08</p>\n"},{"tags":["xml","sql-server-2008","asp-classic"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13221383,"title":"How to ignore \"The process cannot access the file because it is being used by another proces\"","body":"<p>The setup is this:</p>\n\n<p>Whenever an error occurs on my website, an error-site is being displayed while an e-mail is being sent to the administrator.</p>\n\n<p>The website show a lot of live statistics automaticly updated every 15 second via AJAX and XML. But the statistics are only calculated once every 15 second, no matter how many users there is.\nThis is done by a timestamp hidden ind the MSSQL database:</p>\n\n<ul>\n<li>The website check if the timestamp is older than 14 seconds</li>\n<li>If it is, then it updates the timestamp and runs the calculation of the stats and saved them to XML</li>\n<li>At last the XML are being looped through and showing the requested stats to the users</li>\n</ul>\n\n<p>IF the timestamp is NOT older than 15 seconds, the second step is being skipped.</p>\n\n<p>Now my problem is, that if 2 users makes the timestamp request at the same time then the system doesn't have the time to update the timestamp before both of the users tries to update the XML document, causing one of them to fail with the error message:</p>\n\n<blockquote>\n<pre><code>msxml3.dll (0x80070020)\nThe process cannot access the file because it is being used by another process.\n/file.asp, line 310\n</code></pre>\n</blockquote>\n\n<p>Is it possible to check if the process is being used BEFORE trying to save the XML document? Or maybe ignoring this explicit kind of error?</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13226450,"title":"Get latest updated records","body":"<p>I have an \"Observation\" table in SQL Server 2008. This table has a locationId column for a bunch of geographic locations, a few columns for observation details and a column for latest updated date.</p>\n\n<p>Every week, a new observation record for each location is appended. So a location has many occurrences in the table.</p>\n\n<p>What I want to achieve is to be able to get the most recent observation record for each location.</p>\n\n<p>Can anyone help with any idea?</p>\n\n<p>Thanks in advance.</p>\n\n<p>Cheers,\nAlex</p>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0","stored-procedures","dataset"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13210110,"title":"Store Procedure Return Data in MS Managment Studio .Not return Any Data When Call Using C#","body":"<p>==========================STORE PROCEDURE===============================</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROC [dbo].[SerachTickets]\n    @StoreID varchar(70),\n    @StatusID varchar(70),\n     @CustomerName varchar(400),\n         @TicketNo varchar(70),\n         @StratDate varchar(100),\n         @ESTDate varchar(100),\n         @StaffID varchar(100),\n         @ServiceItemID varchar(100)\nAS \n    SET NOCOUNT ON \n    SET XACT_ABORT ON  \n    declare @sql nvarchar(MAX)\n\n    Set @sql='SELECT   Ticket.TicketID,Ticket.StaffID,ServiceItemInfo.ServiceItemID,\n    ISNULL(TicketWorkLog.WorkLogDesc,'''') WorkLogDesc,\n     Ticket.SerialNo, Convert(varchar(50),Ticket.CreationDate,101) CreationDate,\nAdmin_ServiceItem.ServiceItem,Convert(varchar(50),Ticket.CompletionDate,101) CompletionDate, Ticket.IsPickedUp, \nTicket.IsPaid, Ticket.IsVoid, Ticket.IsReadyForPayment, ISNULL(Ticket.TicketDetail,'''') TicketDetail,\nAdmin_Staff.StaffFirstName + '' ''+ Admin_Staff.StaffLastName As StaffFullName\nFROM   Ticket \nLEFT JOIN   Admin_Staff ON Ticket.StaffID = Admin_Staff.StaffID \nLEFT JOIN   TicketWorkLog ON Ticket.TicketID = TicketWorkLog.TicketID\nLEFT JOIN   ServiceItemInfo On Ticket.TicketID = ServiceItemInfo.TicketID\nLEFT JOIN   Admin_ServiceItem On ServiceItemInfo.ServiceItemID = Admin_ServiceItem.ServiceItemID  \nLEFT JOIN   Customer On Ticket.CustomerID = Customer.CustomerID\n       WHERE Ticket.StoreID='+@StoreID\n\n       if @StatusID &lt;&gt; '' \n        BEGIN\n        Set @sql =@sql + ' AND TicketWorkLog.StoreWorkLogID = '+@StatusID\n        END \n\n       if @CustomerName &lt;&gt; ''\n        BEGIN\n        Set @sql =@sql + ' AND (Customer.FirstName Like(''%'+@CustomerName+'%'')'\n        END\n\n        if @CustomerName &lt;&gt; ''\n        BEGIN\n        Set @sql =@sql + ' OR Customer.LastName Like(''%'+@CustomerName+'%''))'\n        END\n\n       if @TicketNo &lt;&gt; ''\n        BEGIN\n        Set @sql =@sql + ' AND Ticket.SerialNo Like(''%'+@TicketNo+'%'')'       \n        END\n\n       if @StratDate &lt;&gt; '1900-01-01 00:00:00'\n        BEGIN\n        Set @sql =@sql + ' AND Ticket.CreationDate Between ''' +Convert(varchar(100),Convert(DateTime,@StratDate),101)+ ''' AND '''+Convert(varchar(100),Convert(DateTime,@StratDate),101)+''''     \n        END\n\n       if @ESTDate &lt;&gt; '1900-01-01 00:00:00'\n        BEGIN\n        Set @sql =@sql + ' AND Ticket.CompletionDate Between ''' +Convert(varchar(100),Convert(DateTime,@ESTDate),101)+ ''' AND '''+Convert(varchar(100),Convert(DateTime,@ESTDate),101)+''''       \n        END\n       if @StaffID &lt;&gt; '0'\n        BEGIN\n        Set @sql =@sql + ' AND Ticket.StaffID ='+@StaffID       \n        END\n\n       if @ServiceItemID &lt;&gt; ''\n       BEGIN\n        Set @sql =@sql + ' AND ServiceItemInfo.ServiceItemID ='+@ServiceItemID      \n        END\n\n--print @sql;\n--exec SerachTickets 1,'','','','1900-01-01 00:00:00','1900-01-01 00:00:00',0,''  \nExec (@sql)\n</code></pre>\n\n<p>==============================C# CODE==================================</p>\n\n<pre><code>try\n            {\n                using (SqlConnection sqlCon = new SqlConnection(ConfigurationManager.ConnectionStrings[\"SqlServer\"].ToString()))\n                {\n                    DateTime? dtStart = Convert.ToDateTime(\"01/01/1900\");\n                    DateTime? dtEst = Convert.ToDateTime(\"01/01/1900\");\n                    int intAssign = 0;\n\n                    if (!string.IsNullOrEmpty(Request.QueryString[\"sdate\"]))\n                    {\n                        dtStart = Convert.ToDateTime(Request.QueryString[\"sdate\"]);\n                    }\n\n                    if (!string.IsNullOrEmpty(Request.QueryString[\"estdate\"]))\n                    {\n                        dtEst = Convert.ToDateTime(Request.QueryString[\"estdate\"]);\n                    }\n\n                    if (!string.IsNullOrEmpty(Request.QueryString[\"assign\"]))\n                    {\n                        intAssign = Convert.ToInt32(Request.QueryString[\"assign\"]);\n                    }\n\n\n                    using (SqlCommand cmd =sqlCon.CreateCommand())\n                    {\n                        DataSet dataset = new DataSet();\n\n                        sqlCon.Open();\n\n                        cmd.CommandType = CommandType.StoredProcedure;\n                        cmd.CommandText = \"SerachTickets\";\n\n                        cmd.Parameters.AddWithValue(\"@StoreID\", Session[\"StoreID\"]);\n                        cmd.Parameters.AddWithValue(\"@StatusID\", Request.QueryString[\"sid\"]);\n                        cmd.Parameters.AddWithValue(\"@CustomerName\", Request.QueryString[\"cname\"]);\n                        cmd.Parameters.AddWithValue(\"@TicketNo\", Request.QueryString[\"tno\"]);\n                        cmd.Parameters.AddWithValue(\"@StratDate\", dtStart);\n                        cmd.Parameters.AddWithValue(\"@ESTDate\", dtEst);\n                        cmd.Parameters.AddWithValue(\"@StaffID\", intAssign);\n                        cmd.Parameters.AddWithValue(\"@ServiceItemID\", Request.QueryString[\"itemid\"]);\n                        using (SqlDataAdapter da = new SqlDataAdapter(cmd))\n                        {\n\n                            da.Fill(dataset);\n                            cmd.Connection.Close();\n                            grdTickets.DataSource = dataset.Tables[0];\n                            grdTickets.DataBind();\n\n                        }\n                    }\n                }\n\n            }\n            catch (Exception ee)\n            {\n            }\n</code></pre>\n\n<p>==============================================================================</p>\n\n<p>I have checked using SQL PROILER What Values C# Sending To The SQL Server..</p>\n\n<p>exec SerachTickets @StoreID=1,@StatusID=N'',@CustomerName=N'',@TicketNo=N'',@StratDate='1900-01-01 00:00:00',@ESTDate='1900-01-01 00:00:00',@StaffID=0,@ServiceItemID=N''</p>\n\n<p>When run this query in MS Managment Studio It return the desired result but in C# No Dara return..</p>\n"}]}
{"total":21073,"page":3,"pagesize":100,"questions":[{"tags":["sql","xml","sql-server-2008","tsql","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13225619,"title":"Error when using modify and insert on XML data retreived from table: Must be single node","body":"<p>I am attempting to insert into some xml I am retreiving from a column in a table. I retrieve it as follows:</p>\n\n<pre><code>DECLARE @profiles_xml xml\nDECLARE @profile_id int\nSET @profile_id = 16\nSET @profiles_xml = (SELECT profiles from tbl_applied_profiles WHERE\nprofiles.value('(Profile/ID)[1]','int')= @profile_id)\n</code></pre>\n\n<p>The resulting xml looks like this:</p>\n\n<pre><code>&lt;Profile&gt;\n  &lt;ID&gt;16&lt;/ID&gt;\n  &lt;User&gt;\n    &lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;\n    &lt;Name&gt;test&lt;/Name&gt;\n    &lt;Activities /&gt;\n  &lt;/User&gt;\n&lt;/Profile&gt;\n</code></pre>\n\n<p>However when I try and insert an element into it like this:</p>\n\n<pre><code>SET @devices_xml.modify('insert &lt;Activity&gt;&lt;Name&gt;testname&lt;/Name&gt;&lt;/Activity&gt;\n as first into (Profiles/User/Activities[1])')\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>XQuery [modify()]: The target of 'insert' must be a single node, found 'element(Activities,xdt:untyped) *'\n</code></pre>\n\n<p>I don't understand why there is an error, as there is only one Activities element currently. Thanks in advance.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13226276,"title":"How to use result of an SQL select statement in dbo.fnSplit function as input","body":"<p>I have a requirement to use a comma seperated string (which is a value in a table column) \nin 'IN' clause of an SQL statement(SQL server 2008)\nFor this I am using below split function to make the string in a tabular format and use it in the 'IN' clause of an SQL query.</p>\n\n<pre><code>ALTER FUNCTION dbo.fnSplit(\n@sInputList VARCHAR(8000) -- List of delimited items\n , @sDelimiter VARCHAR(8000) = ',' -- delimiter that separates items\n ) RETURNS @List TABLE (item VARCHAR(8000))\n\nBEGIN\n DECLARE @sItem VARCHAR(8000)\n WHILE CHARINDEX(@sDelimiter,@sInputList,0) &lt;&gt; 0\n  BEGIN\n    SELECT\n     @sItem=RTRIM(LTRIM(SUBSTRING(@sInputList,1,CHARINDEX\n      (@sDelimiter,@sInputList,0)-1))),  @sInputList=RTRIM(LTRIM(SUBSTRING(@sInputList,CHARINDEX\n      (@sDelimiter,@sInputList,0)+LEN(@sDelimiter),LEN(@sInputList))))\n\n  IF LEN(@sItem) &gt; 0\n    INSERT INTO @List SELECT @sItem\n  END\n\n IF LEN(@sInputList) &gt; 0\n     INSERT INTO @List SELECT @sInputList -- Put the last item in\n     RETURN\n  END\nGO\n\nselect * from dbo.fnSplit('aaa,bbb,ccc', ',')\n</code></pre>\n\n<p>Above select statement gives result as:</p>\n\n<pre><code>Item\naaa\nbbb\nccc\n</code></pre>\n\n<p>Now I need to use my SQL statement which returns the string aaa,bbb,ccc  in the fnSplit function as below</p>\n\n<pre><code>  select * from dbo.fnSplit((SELECT Prefix2Include FROM dbo.vw_PrefixToInclude), ',')\n</code></pre>\n\n<p><strong>Note:</strong> <code>SELECT Prefix2Include FROM dbo.vw_PrefixToInclude returns aaa,bbb,ccc</code></p>\n\n<p>But this gives me some syntax error as below:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 4\n  Incorrect syntax near '('.\n  Msg 102, Level 15, State 1, Line 4\n  Incorrect syntax near ',\n</code></pre>\n\n<p>Please guide me on this.</p>\n\n<p>Thanks,\nSoumya</p>\n"},{"tags":["sql","xml","sql-server-2008","tsql","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13226336,"title":"Use varchar stored procedure parameter in If condition of xquery insert","body":"<p>Is it possible to use a nvarchar type sproc variable in an xquery insert statement within the stored procedure?\nWhat I mean is something like this, in which an element is inserted only if a child element with the sought for value is present:</p>\n\n<pre><code>DECLARE @profiles_xml xml\nDECLARE @profile_id int\nDECLARE @user_id nvarchar(50)\nSET @profile_id = 20\nSET @user_id ='BC4A18CA-AFB5-4268-BDA9-C990DAFE7783'\nSET @profiles_xml = (SELECT profiles from tbl_applied_profiles WHERE profiles.value('(Profile/ID)[1]','int')= @profile_id)\nSET @profiles_xml.modify('\ninsert\nif(/Profile/User/ID=\"user_id\")\nthen &lt;Activity&gt;activity_name5&lt;/Activity&gt;\nelse()\nas first\ninto (/Profile/User/Activities)[1]')\n</code></pre>\n\n<p>The xml which @profiles_xml contains looks like this:</p>\n\n<pre><code>&lt;Profile&gt;\n  &lt;ID&gt;20&lt;/ID&gt;\n  &lt;User&gt;\n    &lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;\n    &lt;Name&gt;somename&lt;/Name&gt;\n    &lt;Activities&gt;\n      &lt;Activity&gt;activity_name2&lt;/Activity&gt;\n    &lt;/Activities&gt;\n  &lt;/User&gt;\n&lt;/Profile&gt;\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":42,"score":-2,"question_id":13225652,"title":"How to tamper proof file so restrictedly so that even user could not replace it with an initial captured version of the file","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2151222/how-to-make-a-file-tamper-proof\">How to make a file tamper proof?</a>  </p>\n</blockquote>\n\n\n\n<p>The scenario is,In a Asp.net Web application, I have to create a config file which is surly encrypted because I don’t want users to change or view the content. \nThe problem is the file is going to change periodically with different data each time.\nWe need it to be so tamper proof so that user could not capture the file (when it is in initial state) and restore it back For instance let’s say the information of the file is “how many times left for the app to run until it expires” in this case if users captures the initial state of the file and restore it all the time, the app will run for ever </p>\n\n<p>Rules:</p>\n\n<ul>\n<li>we don’t wanted to have a hash of the file somewhere else because user could find that file and capture that one as well</li>\n<li>we could not rely on internet connection because the user may not\nhave one</li>\n<li>Don't need to worry about the system date time being changed by user(the application is time based so the data they can report will not be accurate if they change the system date time. So they wont)</li>\n</ul>\n\n<p>I'm also happy to put this data in a database if there is any tamper proofing method that,  needs my data to be stored on a SQL database</p>\n\n<p>Thanks </p>\n"},{"tags":["sql","sql-server-2008","ssis","ssis-data-transformations","collate"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13180214,"title":"How can I convert \"SQL_Latin1_ General\" Collate Using an SSIS Package?","body":"<p>We've just noticed 2 of our servers have been set up using <strong>SQL_Latin1_General_CP1_CI_AS</strong> and <strong>Latin1_General_CI_AS</strong>. </p>\n\n<p>I've created a script which compares two sources of data again each other (as it's a simple SELECT statement I haven't included it, it uses the same columns but from different sources) when I tried to union them together I received the collate error.</p>\n\n<blockquote>\n  <p>Msg 468, Level 16, State 9, Line 2\n      Cannot resolve the collation conflict between \n      \"<strong>SQL_Latin1_General_CP1_CI_AS</strong>\" and \"<strong>Latin1_General_CI_AS</strong>\" in the UNION operation.</p>\n</blockquote>\n\n<p>One of the sources is a table which is being populated by an <strong>SSIS</strong> package, is there a way of adapting the SSIS project to convert the \"SQL_Latin1_General_CP1_CI_AS\" format to \"Latin1_General_CI_AS\" before it's sent to the destination table?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13224886,"title":"Why does a left join return differently to a NOT IN?","body":"<p>The following query is behaving somewhat strangely:</p>\n\n<pre><code>SELECT #batches.OutTo, PO_Number, CONVERT(varbinary, #batches.OutTo) , convert     (varbinary, PO_Number), \n    CASE WHEN convert(varbinary, #batches.OutTo) NOT IN (SELECT convert(varbinary,    PO_Number) FROM #pos) \n         THEN 'NOT IN' ELSE 'IN' END\nFROM #batches LEFT JOIN #pos ON \n    convert(varbinary, #batches.OutTo) = CONVERT(varbinary, PO_Number)\nWHERE #batches.OutTo IS NOT NULL\nGROUP BY #batches.OutTo, #pos.PO_Number\n\n\nOutTo       PO_Number   (No column name)    (No column name)    (No column name)\n311117      NULL        0x333131313137      NULL                    IN\n311130      311130      0x333131313330      0x333131313330          IN\n311259      NULL        0x333131323539      NULL                    IN\nL001934     L001934     0x4C303031393334    0x4C303031393334        IN\nL001988     NULL        0x4C303031393838    NULL                    IN\nL002002     NULL        0x4C303032303032    NULL                    IN\n</code></pre>\n\n<p>As you can see, the left join behaves correctly, but the NOT IN does not, returning IN for values that should be NOT IN. Why is this? Is it a bug, or a feature of SQL I don't know about?</p>\n"},{"tags":["sql","xml","sql-server-2008","tsql","insert"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13223781,"title":"XML parsing error: 'A string literal was expected' when inserting values into table","body":"<p>In Microsoft SQL Server 2008 I am attempting to insert values into an sql table with the columns <strong>type_id of datatype int</strong> and <strong>xml_info of datatype XML</strong>. I am using the following query:</p>\n\n<pre><code>INSERT INTO tbl_applied_devices ([type_id],[xml_info])\nVALUES (1,'&lt;Profile ID=99&gt;&lt;Server&gt;&lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;  &lt;Name&gt;localhost&lt;/Name&gt;&lt;Services&gt;&lt;/Services&gt;&lt;/Server&gt;&lt;/Profile&gt;')\n</code></pre>\n\n<p>But I keep getting this error:</p>\n\n<blockquote>\n  <p>Msg 9413, Level 16, State 1, Line 4<br>\n  XML parsing: line 1, character 13, A string literal was expected  </p>\n</blockquote>\n\n<p>What am I doing incorrectly?</p>\n\n<p><strong>EDIT:</strong>\nI found that the source of the error is the xml element's ID attribute, <code>&lt;Profile ID=99&gt;</code> seems to be what is causing the error. How can I correctly insert xml with an attribute ? Do I need to somehow escape one of the characters?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13217122,"title":"Comma-separated string in IN clause of SQL query","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4462415/how-to-pass-a-variable-in-where-in-clause-of-oracle-sql\">how to pass a variable in WHERE IN clause of oracle sql?</a>  </p>\n</blockquote>\n\n\n\n<p>I have a column <code>Prefix</code> in my table <code>Tbl_Prefix</code> with value as string separated by comma like this:</p>\n\n<pre><code>'aaa','bbb','ccc'\n</code></pre>\n\n<p>I have an employee table <code>Tbl_Employee</code> like this:</p>\n\n<pre><code>Empno Prefix\n------------\n1000  aaa\n2000  eee\n3000  ccc\n4000  aaa\n5000  ddd\n</code></pre>\n\n<p>I need to use this prefix in the <code>IN</code> portion of my <code>WHERE</code> clause in this query:</p>\n\n<pre><code>Select * \nfrom Tbl_Employee  \nwhere Tbl_Employee.Prefix  in (select  Tbl_Prefix.prefix \n                               from Tbl_Prefix \n                               where Tbl_Prefix.flag = 'y') \n</code></pre>\n\n<p>The inner select query <code>select Tbl_Prefix.prefix from Tbl_Prefix where Tbl_Prefix.flag='y'</code> has the result <code>'aaa','bbb','ccc'</code></p>\n\n<p>How to use this string in the 'IN' clause so that I will get a proper result?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13156617,"title":"SQL query caching","body":"<p>The first run of following query takes about 45 seconds and all the next ones only 1 second. Can you please explain what is the reason and how is it possible to make query run faster on the first execute too?</p>\n\n<pre><code>OPEN SYMMETRIC KEY TEST_KEY DECRYPTION BY PASSWORD='password'\n\nSELECT this.ID FROM SeparationFiles this\nINNER JOIN BarcodeValues b ON this.FIRST_BARCODE_ID = b.ID\nWHERE DecryptByKey(b.ENCRYPTED_VALUE, 0) = 'Peter'\n</code></pre>\n\n<p>Here is execution plan: </p>\n\n<p><img src=\"http://i.stack.imgur.com/u6dJt.png\" alt=\"Execution plan\"></p>\n"},{"tags":["sql","sql-server-2008","datetime"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13221690,"title":"Can I calculate there's how many weekend days between two dates in SQL Server?","body":"<p>I'm calculating income of hiring equipments for a report. In that, hiring cost in weekend days will be plus 10% more if compare with normal days. So how can I calculate there's how many weekend days between two dates. And in report query, I can't use DECLARE also. Can someone help me to do this. Thank you so much</p>\n"},{"tags":["sql","vb.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2101,"score":0,"question_id":9784301,"title":"Inserting data from a DataGridView to a database","body":"<p>I have a small DataGridView which lets the user enter data.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SljPE.png\" alt=\"Ths is the grid\"></p>\n\n<p>And I'm trying this code to enter the data in the DataGridView to the database.</p>\n\n<pre><code>    strQry = \"INSERT INTO Emp_Fam_Details (empID, famName, famAge, famRelation, famOccup)\" _\n            &amp; \"VALUES (@ID, @Name, @Age, @Rel, @Occ)\"\n    Dim adapFam As New SqlDataAdapter\n    adapFam.InsertCommand = New SqlCommand(strQry, sqlcon)\n\n    For i As Integer = 0 To grdFamily.Rows.Count - 1\n        adapFam.InsertCommand.Parameters.AddWithValue(\"@ID\", txtEmpID.Text.Trim)\n        adapFam.InsertCommand.Parameters.AddWithValue(\"@Name\", grdFamily.Columns(0))\n        adapFam.InsertCommand.Parameters.AddWithValue(\"@Age\", grdFamily.Columns(1))\n        adapFam.InsertCommand.Parameters.AddWithValue(\"@Rel\", grdFamily.Columns(2))\n        adapFam.InsertCommand.Parameters.AddWithValue(\"@Occ\", grdFamily.Columns(3))\n\n        result2 = adapFam.InsertCommand.ExecuteNonQuery()\n    Next\n</code></pre>\n\n<p>When I run this, I come across this error.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Nf1X4.png\" alt=\"This is the error\"> </p>\n\n<p>I found <a href=\"http://stackoverflow.com/a/9391411/1077789\">this</a> solution here on SO but since I'm using Parameters not appended values, I'm having a hard time understanding how to do it with parameters. </p>\n\n<p>Can anyone please show me how to do this? </p>\n\n<p>Thank you all. </p>\n"},{"tags":["sql-server-2008","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12691504,"title":"Compare data against sql column","body":"<p>I have collection of numbers like: 11111, 12345, 12346 stored in a list in c# code. I need to compare this list against sql database column of numbers similar to this and find out if matching numbers exist. Below is what i am doing:</p>\n\n<pre><code>foreach (number in numbers)\n{\n    //get column data through sql reader and iterate through it:\n    foreach(column in columnData)\n    {\n       if(number == column)\n       {\n         // do something\n       }\n}\n</code></pre>\n\n<p>my question is this right approach? Or is there a better way to do this? As it looks like this requires lots of processing.</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":63,"score":0,"question_id":13216924,"title":"How can i update another tables after adding record to a table in sql server 2008","body":"<p>I have two same tables created in SQL Server 2008.</p>\n\n<p>What I need is:</p>\n\n<p><strong>Add the newest data inserted in <code>table1</code> into <code>table2</code>.</strong></p>\n\n<p>Is that possible? </p>\n\n<p>Something like services or triggers or stored procedures?</p>\n\n<p>I think that I have to use triggers, but I don't know how.</p>\n\n<p>I have these two tables:</p>\n\n<pre><code>table1  ( field1,field2,field3 )\ntable2  ( field1,field2,field3 )\n</code></pre>\n\n<p>when i insert into table1 i need table2 to be updated as the procedure below:    </p>\n\n<pre><code>&gt; IF NotExist(field1=value) in table2 THEN INSERT Into table2 ELSE UPDATE table2\n&gt; with new field1 value.\n</code></pre>\n"},{"tags":["visual-studio","sql-server-2008","database-connection","webhost"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3683,"score":1,"question_id":2965994,"title":"Connecting to database on web host in Visual Studio or Sql Server Management Studio","body":"<p>I have a web site developed locally with a local Sql Server database. I also have a web host that provides one Sql Server database for my site. Now I want to deploy the application, and I would like to be able to manage the remote database from the Server Explorer in Visual Studio. I have the connection string used in the application, which works fine for adding, say, a datasource to a control etc. But I don't know if there's any way to use it to connect the database inside the Server Explorer so that I can add tables etc. I have read that you're supposed to be able to this instead of using the Sql Server Management Studio, but I have'nt read anything about how to connect to the remote database in it.</p>\n\n<p>What I have tried so far is this: I have selected Add database in Server Explorer. This brings up first a dialog where I choose Sql Server. And then I get a dialog where I can set Server name (which I tried using the ip address in the connection string below), and Authentication (where I chose Sql Server Authentication, with the user id and password from below). But when I test the connection it fails.</p>\n\n<p>Here's the connection string, which works fine when used for datasources in the application (obviously with different user name and password): </p>\n\n<p></p>\n\n<p>Any help appreciated!</p>\n\n<p>EDIT:</p>\n\n<p>Well, I've done everything suggested by lewiguez below now, but it doesn't make any difference. I can't believe this should be so hard... I keep getting this error message in Sql Server Management Studio:</p>\n\n<p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server) (Microsoft SQL Server, Error: 53)</p>\n\n<p>What is wrong? Please help...!</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":13219260,"title":"Determine values that are present in only one of two tables, or in both of them","body":"<p>I have two tables in a SQL Server 2008 database in which I want to find:</p>\n\n<ul>\n<li>values present in both tables (with all columns present in both tables)</li>\n<li>values present in first table but not in second table</li>\n<li>values present in second table but not in first table</li>\n</ul>\n\n<p>Code:</p>\n\n<pre><code>CREATE TABLE #_temp\n(ATM INT, Fault INT)\n\nCREATE TABLE #_temp1\n(ATM INT, Fault INT)\n\nINSERT INTO #_temp  VALUES (10,101), (11,101), (12,101), (12,101), (10,105), (13,101)\nINSERT INTO #_temp1 VALUES (10,102), (11,101), (12,103), (12,100), (10,105), (13,101)\n\n/* My Try\n\nSELECT * FROM #_temp t RIGHT JOIN #_temp1 t1 ON t.ATM=t1.ATM AND t.Fault=t.Fault AND t.ATM IS NULL AND t.Fault IS NULL\n\nSELECT * FROM #_temp t JOIN #_temp1 t1 ON t.ATM=t1.ATM AND t.Fault=t.Fault\n\n*/\n\nDROP Table #_temp\nDROP Table #_temp1 \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":13218892,"title":"SQL Server: +(unary) operator on non-numeric Strings","body":"<p>I am surprised! This statement below is valid in <code>SQL SERVER</code>:</p>\n\n<pre><code>SELECT  +'ABCDEF'\n</code></pre>\n\n<p>Has <code>SQL Server</code> defined <code>+</code> as a <code>Unary</code> operator for string types?</p>\n"},{"tags":["sql-server-2008","iis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13209120,"title":"IIS occasionally no response","body":"<p>I'm facing a problem with a 3-tier application. It uses IIS and SQL Server. And the problem is that sometimes (longer requests cause higher probability) client does not receive response from IIS. It hangs when there is no activity ON SQL Server, and when even when I kill an SQL Process I get no response with an exception. When I examine data after these hangs I find that my SQL requests have succeeded, so the problem appears to be on IIS. Unfotunately I don't have much control over the place where the application is hosted and I cannot reproduce the problem. There can be many answers to this question, but at least I need a hint in what direction I should investigate. <br/>\n<strong>UPDATE</strong>: I also have an app running on the same server that does a small job: it inserts around a 100 lines line-by-line into a database. Artificially I made it run for about 10 minutes (by putting xlock on the table). After removing the xlock the process on IIS continued running and successfully inserted those 100 lines. However, control never returned to the client thereafter, it just waited indefinitely. It looks like this is a problem when returning a response to the client after a long running process.<br/>\nBTW, this is not a website, but a WinForms app that uses Remoting.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","full-text-search"],"answer_count":4,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":9953,"score":10,"question_id":6003240,"title":"Cannot use a CONTAINS or FREETEXT predicate on table or indexed view because it is not full-text indexed","body":"<p>I am getting following error in my SQL server 2008 R2 database:</p>\n\n<blockquote>\n  <p>Cannot use a <code>CONTAINS</code> or <code>FREETEXT</code> predicate on table or indexed view 'tblArmy' because it is not full-text indexed.</p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2008","oracle10g","data-migration"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1983,"score":0,"question_id":3482067,"title":"How to migrate database from Oracle to SQL Server?","body":"<p>I have a database on <strong>Oracle 9i</strong>. Now I want to work on <strong>SQL Server 2008</strong>. I want  to migrate the Oracle database to SQL Server, but how do I do that? Give me some syntax? Thanks for the help.</p>\n"},{"tags":["sql-server-2008","service-broker"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":336,"score":0,"question_id":2815528,"title":"Monolog conversations in SQL Service Broker 2008","body":"<p>I have a scenario in which I need to process(in SQL Server) messages being delivered as .xml files in a folder in real time.</p>\n\n<p>I started investigating SQL Service Broker for my queuing needs.  Basically, I want the Service Broker to pick up my .xml files and place them in a queue as they arrive in the folder.  But, SQL Service Broker does not support \"Monolog\" conversations, at least not in the current version.  It supports only a dialog between an initiator and a target service.</p>\n\n<p>I can use MSMQ but then I will have two things to maintain - the .Net Code for file processing in MSMQ and the SQL Server T-SQL stored procs.  What options do I have left? </p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":13192145,"title":"SQL return both table rows separately","body":"<p>I have two tables and want to return both table's rows. Both tables do not have any relation.</p>\n\n<p><code>Table 1</code> has columns <code>userid, name</code>, and other columns... and <code>Table 2</code> has only two columns <code>id, name</code>.</p>\n\n<p>I want both table results in one query result set.</p>\n\n<p>Table results:</p>\n\n<pre><code>userid name and other columns from Table 1.\nid     name and NULL, NULL should show as Table 2 do not have extra columns.\n</code></pre>\n"},{"tags":["sql","sql-server-2008","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2580,"score":2,"question_id":1596069,"title":"OnTaskFailed event handler in SSIS","body":"<p>If I use <strong>OnError</strong> event handler in my SSIS package, there are variables <strong>System::ErrorCode</strong> and <strong>System::ErrorDescription</strong> from which I can get the error information if any things fails while execution.</p>\n\n<p>But I cant the find the same for <strong>OnTaskFailed</strong> event handler, i.e. How to get the <strong>ErrorCode</strong> and <strong>ErrorDescription</strong> from the OnTaskFailed event handler when any things fails while execution in case we want to only implement OnTaskFailed event handler for our package?</p>\n"},{"tags":["sql-server-2008","xml-dml"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":779,"score":2,"question_id":3553869,"title":"SQL Server 2008: Rename an element using XML DML?","body":"<p>Is it possible to use an XML DML statement to rename an element in an untyped XML column?</p>\n\n<p>I am in the process of updating an XML Schema Collection on an XML column and need to patch the existing XML instances by renaming one element before I can apply the latest schema.</p>\n\n<p>As far as I can tell from the docs you can only insert / delete nodes or replace their value.</p>\n"},{"tags":["sql","sql-server-2008","database-design","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13211739,"title":"Bug Tracking How to design Project Access in Sql Database schema","body":"<p>I am working on a small open-source project on Bug Tracking.</p>\n\n<p>I am a little confused on something which I need help with.</p>\n\n<p>I have two tables, one is Users and other is Projects.</p>\n\n<p><strong>Users</strong></p>\n\n<ul>\n<li>UserId</li>\n<li>Username</li>\n</ul>\n\n<p><strong>Project</strong></p>\n\n<ul>\n<li>ProjectId</li>\n<li>ProjectName</li>\n<li>ProjectDescription</li>\n</ul>\n\n<p>I have more fields, but I have abstracted them now, to make this question small.</p>\n\n<p><strong>I wanted to know how to create a relationship between Projects and Users ?</strong></p>\n\n<p>Should I have one more table that stores User-Project relationships something like</p>\n\n<p><strong>ProjectAccess</strong></p>\n\n<ul>\n<li>Id</li>\n<li>ProjectId</li>\n<li>UserId</li>\n<li>AccessType (Admin/User)</li>\n</ul>\n\n<p>I am a little new to Database schema designing, so I am not very sure. So I'm here to have a second opinion on this.</p>\n\n<p>Also I would like to know how to provide the option for an admin to add a user and how to handle this at back end.</p>\n\n<p>Any thought, comment or answers will be highly appreciated. Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13211268,"title":"returning total records in cte","body":"<p>With help from <a href=\"http://pratchev.blogspot.com/2008/11/paging-with-ranking-functions.html?m=1\" rel=\"nofollow\">article here</a> and recent answers from SO experts I have arrived with the following which will help me efficiently page through a set of records.</p>\n\n<p>I think my last couple of questions are </p>\n\n<ol>\n<li>See how I include the <code>Total Number of Records</code> in the payload at the end\nof SQL CTE called 'Total'. Is that how you would do this? </li>\n<li>Any other suggestions? Potential areas for being more concise or improvements? <code>Return Total Number of Pages</code></li>\n</ol>\n\n<hr>\n\n<pre><code>DECLARE @page_size INT = 5;\nDECLARE @page_nbr INT = 4;\nDECLARE @search NVARCHAR(MAX) = '';\nDECLARE @sort_order INT = 2;\n\nWITH AllProducts\nAS\n(\nSELECT *, \nCASE @sort_order\n    WHEN 1 THEN ROW_NUMBER() OVER ( ORDER BY ProductID )\n    WHEN 2 THEN ROW_NUMBER() OVER ( ORDER BY ProductName )\nEND AS 'Seq'    \nFROM Products\n),\nFiltered\nAS\n(\nSELECT * FROM AllProducts\nWHERE ProductName like '%'+@search+'%'\nOR\n@search is null\n)\nSELECT (select COUNT(*) from Filtered) as 'Total', * FROM Filtered\nWHERE seq &gt; (@page_nbr - 1) * @page_size\n  AND seq &lt;= @page_nbr * @page_size\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13210915,"title":"dynamic order by conversion error","body":"<p>I'm trying to do a dynamic order by on pubs database and getting the following error\nwhen I try to use <code>@sort_order = 2</code></p>\n\n<p>Msg 245, Level 16, State 1, Line 6\nConversion failed when converting the nvarchar value 'Pavlova' to data type int.</p>\n\n<p><a href=\"http://www.sqlteam.com/article/dynamic-order-by\" rel=\"nofollow\">This is the article</a></p>\n\n<pre><code>SELECT * FROM Paging\nWHERE seq &gt; (@page_nbr - 1) * @page_size\n  AND seq &lt;= @page_nbr * @page_size\nORDER BY CASE\n    WHEN @sort_order = 1 THEN ProductID\n    WHEN @sort_order = 2 THEN ProductName\n    ELSE CategoryID\nEND\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13162663,"title":"Application vs SQL server 2008 accounts issue","body":"<p>Good day all,</p>\n\n<p>I am studing the following case:</p>\n\n<p><strong>Scenario:</strong> An application connects to the production database(SQL server 2008) using  a generic \"SA\" user instead of the domain user. This is making traces\\logs\\organization harder, because everything is flagged as done by SA user!</p>\n\n<p>NOTE: In the application the domain user/password is used, the generic account is only regarding to the database.</p>\n\n<p><strong>Questions:</strong> What would be the best pratice in this case? every user should have an account to log in the database? (sql using windows authentication) there are +- 500 users is that an issue regarding to database performance? or a generic account is indicated?</p>\n\n<p>Many thanks!</p>\n"},{"tags":["sql","sql-server","performance","sql-server-2008","query"],"answer_count":4,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":35270,"score":7,"question_id":4193705,"title":"SQL Server SELECT LAST N Rows","body":"<p>This is a known question but the best solution I've found is something like:</p>\n\n<pre><code>SELECT TOP N *\nFROM MyTable\nORDER BY Id DESC\n</code></pre>\n\n<p>I've a table with lots of rows. It is not a posibility to use that query because it takes lot of time. So how can I do to select last N rows without using ORDER BY?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Sorry duplicated question of <a href=\"http://stackoverflow.com/questions/311054/how-do-i-select-last-5-rows-in-a-table-without-sorting\">this one</a></p>\n"},{"tags":["sql-server","windows","sql-server-2008","cluster-computing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13209412,"title":"SQL Server 2008 cluster cannot add possible owner to SQL Server/SQL Server Agent Resources","body":"<p>Setting up SQL Server 2008 failover cluster on Windows Server 2008 R2</p>\n\n<p>Created cluster (added 2 nodes <code>Node1</code>, <code>Node2</code>). Installed SQL Server 2008 on <code>Node 1</code>. It installed successfully and service came up. I am able to connect through management tool using virtual IP.</p>\n\n<p>Now when I want to add <code>Node 2</code>, instance name is not displayed during installation.</p>\n\n<p>When I further analyzed, I could see possible owners for both resources SQL Server, SQL Server Agent are just Node 1. Whereas other resources have both Node 1 and Node 2.</p>\n\n<p>I tried the thing below.</p>\n\n<pre><code>C:\\Users\\administrator.GENNEYS&gt;cluster.exe res \"SQL Server\" /addowner:GEN-C7-181\n\nAdding 'GEN-C7-181' to possible owners of 'SQL Server'...\n</code></pre>\n\n<blockquote>\n  <p><em>System error 5079 has occurred (0x000013d7). The specified node does\n  not support a resource of this type. This may be due to version\n  inconsistencies or due to the absence of the resource DLL on this\n  node.</em></p>\n</blockquote>\n\n<p>How should I add another Node to possible owners of SQL Server?</p>\n\n<p>Thanks.</p>\n"},{"tags":["django","sql-server-2008","django-mssql","django-pyodbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13210013,"title":"How can I connect to SQL Server 2008 R2 with django-mssql (or anything else)?","body":"<p>I've been trying walk through the django tutorial for the last few days (I'd really like to learn django), but I cannot get django to connect with sql server 2008 r2. I have administrative privileges on our server and on sql server. I initially tried with a linux box via pyodbc (but could not even connect with SQLAlchemy, which I can use on my personal computer), but now I have constructed a virtual windows box with windows server 2008 sp2 because I thought I might have more luck with django-mssql. I've tried both django-pyodbc and django-mssql on the windows box but have not yet succeeded. Here are my db settings:</p>\n\n<pre><code>DATABASES = {\n    'default': {\n        'ENGINE': 'sqlserver_ado',  # Have also tried sql_server.pyodbc\n        'NAME': 'TMSEPLAY',                      \n        'USER': '***', # Omitted for post\n        'PASSWORD': '*******', # Omitted for post\n        'HOST': '172.16.1.14',                      \n        'PORT': '1434',                   \n        'OPTIONS': {\n            'provider': 'SQLCLI10', # Have also tried 'SQLCLI11' and 'SQLOLEDB'\n            'extra_params': 'DataTypeCompatibility=80'\n            }\n    }\n}\n</code></pre>\n\n<p>The error I get:</p>\n\n<pre><code>C:\\Python27\\CourseData\\mysite&gt;manage.py syncdb\nTraceback (most recent call last):\n  File \"C:\\Python27\\CourseData\\mysite\\manage.py\", line 10, in &lt;module&gt;\n    execute_from_command_line(sys.argv)\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\__init__.py\", line\n443, in execute_from_command_line\n    utility.execute()\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\__init__.py\", line\n382, in execute\n    self.fetch_command(subcommand).run_from_argv(self.argv)\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\base.py\", line 196,\n in run_from_argv\n    self.execute(*args, **options.__dict__)\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\base.py\", line 232,\n in execute\n    output = self.handle(*args, **options)\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\base.py\", line 371,\n in handle\n    return self.handle_noargs(**options)\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\commands\\syncdb.py\"\n, line 57, in handle_noargs\n    cursor = connection.cursor()\n  File \"C:\\Python27\\lib\\site-packages\\django\\db\\backends\\__init__.py\", line 306,\n in cursor\n    cursor = self.make_debug_cursor(self._cursor())\n  File \"C:\\Python27\\lib\\site-packages\\sqlserver_ado\\base.py\", line 193, in _curs\nor\n    self.__connect()\n  File \"C:\\Python27\\lib\\site-packages\\sqlserver_ado\\base.py\", line 168, in __con\nnect\n    use_transactions=self.use_transactions,\n  File \"C:\\Python27\\lib\\site-packages\\sqlserver_ado\\dbapi.py\", line 151, in conn\nect\n    raise OperationalError(e, \"Error opening connection: \" + connection_string)\nsqlserver_ado.dbapi.OperationalError: (com_error(-2147352567, 'Exception occurre\nd.', (0, u'ADODB.Connection', u'Provider cannot be found. It may not be properly\n installed.', u'C:\\\\Windows\\\\HELP\\\\ADO270.CHM', 1240655, -2146824582), None), 'E\nrror opening connection: DATA SOURCE=172.16.1.14,1434;Network Library=DBMSSOCN;I\nnitial Catalog=TMSEPLAY;UID=***;PWD=********;PROVIDER=SQLCLI10;MARS Connection=Tr\nue;DataTypeCompatibility=80;MARS Connection=True')\n</code></pre>\n\n<p>I'd appreciate any insight at all! I feel like I've searched the web twice over!</p>\n\n<p>Thanks so much!</p>\n"},{"tags":["sql-server-2008","jdbc","sonar","sonar-runner"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13208124,"title":"Sonar + MS SQL database","body":"<p>I'm attempting to initialize sonar with mssql server database, but I can't. With Microsoft SQL Server Management Studio I created the user with username \"sonar\" and password \"sonar\" and granted all the correct privileges to \"sonar\" database, also created. Also configured \"Server Authentication\" to \"SQL Server and Windows Authentication mode\".It works perfectly, but I can't have connection to the database with sonar. Thanks,</p>\n\n<p>sonar.properties;</p>\n\n<pre><code>#----- Credentials\n# Permissions to create tables and indexes must be granted to JDBC user.\n# The schema must be created first.\nsonar.jdbc.username:                       sonar\nsonar.jdbc.password:                       sonar\n\n#----- Microsoft SQLServer\n# The Jtds open source driver is available in extensions/jdbc-driver/mssql. More details on     http://jtds.sourceforge.net\nsonar.jdbc.url:jdbc:sqlserver://localhost:1433;databaseName=SONAR;instanceName=r2;selectMethod=cursor\nsonar.jdbc.driverClassName: com.microsoft.sqlserver.jdbc.SQLServerDriver\nsonar.jdbc.validationQuery: select 1\nsonar.jdbc.dialect: mssql\n\n# Optional properties\n#sonar.jdbc.driverClassName:                net.sourceforge.jtds.jdbc.Driver\n\n#----- Connection pool settings\nsonar.jdbc.maxActive:                      20\nsonar.jdbc.maxIdle:                        5\nsonar.jdbc.minIdle:                        2\nsonar.jdbc.maxWait:                        5000\nsonar.jdbc.minEvictableIdleTimeMillis:     600000\nsonar.jdbc.timeBetweenEvictionRunsMillis:  30000\n...\n</code></pre>\n\n<p>Logs;</p>\n\n<pre><code>INFO   | jvm 1    | 2012/11/02 15:45:31 | JRuby limited openssl loaded. http://jruby.org/openssl\nINFO   | jvm 1    | 2012/11/02 15:45:31 | gem install jruby-openssl for full support.\nINFO   | jvm 1    | 2012/11/02 15:46:31 | 2012-11-02 15:46:31.368:WARN:/:unable to create shared     application instance\nINFO   | jvm 1    | 2012/11/02 15:46:31 | org.jruby.rack.RackInitializationException: no connection available|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-    INF/vendor/gems/activerecord-jdbc-adapter-1.1.3/lib/arjdbc/jdbc/connection.rb:61:in `initialize'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/gems/activerecord-jdbc-adapter-1.1.3/lib/arjdbc/jdbc/adapter.rb:31:in `initialize'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/gems/activerecord-jdbc-adapter-1.1.3/lib/arjdbc/jdbc/connection_methods.rb:6:in `jdbc_connection'|?from org/jruby/RubyKernel.java:2056:in `send'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:223:in `new_connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:245:in `checkout_new_connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:188:in `checkout'|?from org/jruby/RubyKernel.java:1418:in `loop'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:184:in `checkout'|?from file:/C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/lib/jruby-complete-1.6.1.jar!/META-INF/jruby.home/lib/ruby/1.8/monitor.rb:191:in `mon_synchronize'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:183:in `checkout'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:98:in `connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:326:in `retrieve_connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_specification.rb:123:in `retrieve_connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_specification.rb:115:in `connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/migration.rb:435:in `initialize'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/migration.rb:400:in `up'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/migration.rb:383:in `migrate'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/config/../lib/database_version.rb:63:in `upgrade_and_start'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/config/../lib/database_version.rb:75:in `automatic_setup'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/config/environment.rb:131:in `(root)'|?from org/jruby/RubyKernel.java:1063:in `load'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/config/environment.rb:53:in `load_environment'|?from file:/C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/lib/jruby-rack-1.0.0.1.jar!/jruby/rack/rails.rb:46:in `to_app'|?from file:/C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/lib/jruby-rack-1.0.0.1.jar!/jruby/rack/rails.rb:191:in `new'|?from &lt;script&gt;:2:in `(root)'|?from org/jruby/RubyKernel.java:2021:in `instance_eval'|?from file:/C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/lib/jruby-rack-1.0.0.1.jar!/vendor/rack-1.2.1/rack/builder.rb:46:in `initialize'|?from &lt;script&gt;:2:in `(root)'|\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.DefaultRackApplicationFactory$4.init(DefaultRackApplicationFactory.java:184)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.DefaultRackApplicationFactory.getApplication(DefaultRackApplicationFactory.java:59)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.SharedRackApplicationFactory.init(SharedRackApplicationFactory.java:27)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.RackServletContextListener.contextInitialized(RackServletContextListener.java:40)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.ContextHandler.startContext(ContextHandler.java:548)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.servlet.Context.startContext(Context.java:136)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1272)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:517)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:489)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.HandlerWrapper.doStart(HandlerWrapper.java:130)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.Server.doStart(Server.java:224)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.sonar.application.JettyEmbedder.start(JettyEmbedder.java:72)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.sonar.application.StartServer.main(StartServer.java:48)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at java.lang.reflect.Method.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.tanukisoftware.wrapper.WrapperSimpleApp.run    (WrapperSimpleApp.java:240)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at java.lang.Thread.run(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 | 2012-11-02 15:46:31.381:WARN:/:Error: application initialization failed\nINFO   | jvm 1    | 2012/11/02 15:46:31 | org.jruby.rack.RackInitializationException: unable to create shared application instance\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.SharedRackApplicationFactory.init(SharedRackApplicationFactory.java:39)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.RackServletContextListener.contextInitialized(RackServletContextListener.java:40)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.ContextHandler.startContext(ContextHandler.java:548)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.servlet.Context.startContext(Context.java:136)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1272)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:517)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:489)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.HandlerWrapper.doStart(HandlerWrapper.java:130)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.Server.doStart(Server.java:224)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.sonar.application.JettyEmbedder.start(JettyEmbedder.java:72)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.sonar.application.StartServer.main(StartServer.java:48)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at java.lang.reflect.Method.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.tanukisoftware.wrapper.WrapperSimpleApp.run(WrapperSimpleApp.java:240)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at java.lang.Thread.run(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 | 2012-11-02 15:46:31.434:INFO::Started     SelectChannelConnector@127.0.0.1:9000\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13208411,"title":"Adding Column While Selecting Table in SQl","body":"<p>My First Table is ProjectCustomFields</p>\n\n<pre><code>CustomFieldId   ProjectId   CustomFieldName CustomFieldRequired CustomFieldDataType\n69  1   User Name   1   0\n72  1   City    1   0\n74  1   Email   0   0\n82  1   Salary  1   2\n</code></pre>\n\n<p>My Second Table is ProjectCustomFieldValues</p>\n\n<pre><code>CustomFieldValueId  ProjectId   CustomFieldId   CustomFieldValue    RecordId\n35  1   69  kaliya  1\n36  1   72  Bangalore   1\n37  1   74  mm@gmail.com    1\n41  1   69  Yohesh  2\n42  1   72  Delhi   2\n43  1   74      2\n50  1   69  sss 3\n51  1   72  Delhi   3\n52  1   74  sss@icsportal.in    3\n57  1   69  Sunil   4\n58  1   72  Mumbai  4\n59  1   74  sunil@icsportal.in  4\n60  1   82  20000   4\n</code></pre>\n\n<p>I tried Below Query </p>\n\n<pre><code>Select M.CustomFieldName\n,      N.CustomFieldValue\n,      N.RecordId \nFrom\n(\n    Select G.CustomFieldName\n    ,      H.RecordId \n    From\n    (\n        Select CustomFieldName \n        From ProjectCustomFields \n        Where ProjectId = 1\n    ) G \n    Cross Join\n    (\n        Select Distinct RecordId \n        From ProjectCustomFieldValues\n    ) H\n) M\nLeft Join \n(\n    Select CustFiled.CustomFieldName\n    ,      CustValue.CustomFieldValue\n    ,      CustValue.RecordId \n    From ProjectCustomFieldValues CustValue \n    Left Join ProjectCustomFields CustFiled  \n        On CustValue.CustomFieldId = CustFiled.CustomFieldId \n    Where CustValue.AuctionId = 1\n) N \n    On M.CustomFieldName = N.CustomFieldName \n    And M.RecordId       = N.RecordId\n</code></pre>\n\n<p>But I got the result below</p>\n\n<pre><code>#CustomFieldName#   CustomFieldValue    RecordId\nUser Name   kaliya  1\nCity    Bangalore   1\nEmail   mm@gmail.com    1\nSalary  NULL    **NULL**\nUser Name   Yohesh  2\nCity    Delhi   2\nEmail       2\nSalary  NULL    **NULL**\nUser Name   sss 3\nCity    Delhi   3\nEmail   sss@icsportal.in    3\nSalary  NULL    **NULL**\nUser Name   NULL    **NULL**\nCity    NULL    **NULL**\nEmail   NULL    **NULL**\nSalary  NULL    **NULL**\nUser Name   Sunil   4\nCity    Mumbai  4\nEmail   sunil@icsportal.in  4\nSalary  20000   4\n</code></pre>\n\n<p>But Expected Result is</p>\n\n<pre><code>CustomFieldName CustomFieldValue    RecordId\nUser Name   kaliya  1\nCity    Bangalore   1\nEmail   mm@gmail.com    1\nSalary  NULL    **1**\nUser Name   Yohesh  2\nCity    Delhi   2\nEmail       2\nSalary  NULL    **2**\nUser Name   sss 3\nCity    Delhi   3\nEmail   sss@icsportal.in    3\nSalary  NULL    **3**\nUser Name   Sunil   4\nCity    Mumbai  4\nEmail   sunil@icsportal.in  4\nSalary  20000   4\n</code></pre>\n\n<p>Please guide me some one,I tried so much but i got null value in recordId,So I need same recordId above one..</p>\n"},{"tags":["sql-server","sql-server-2008","visual-studio-2012","constraints","database-project"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13162538,"title":"Include default constraint names in generation of update script","body":"<p>I'm using a <strong>SQL Server Database Project</strong> with Visual Studio 2012 and have the following problem when comparing and generating an update script:</p>\n\n<p>In Visual Studio, I add a column with a default constraint, for example:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>[NewColumn] NVARCHAR(50) CONSTRAINT [DF_ExistingTable_NewColumn] NOT NULL DEFAULT N''\n</code></pre>\n\n<p>Unfortunately, the name of the default constraint does not appear when:</p>\n\n<ul>\n<li>Comparing (<em>Schema Compare</em>) my project with the actual database</li>\n<li>Generating an update script (from within the <em>Schema Compare</em>)</li>\n</ul>\n\n<p>The created update script contains the following script (no constraint name):</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>ALTER TABLE [dbo].[ExistingTable]\n    ADD [NewColumn] NVARCHAR (50) DEFAULT N'' NOT NULL;\n</code></pre>\n\n<p>This seems like a major oversight, so I'm wondering where to find the magic switch to include the names of default constraints in all database operations.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":28,"score":2,"question_id":13207935,"title":"SQL Merge Statement","body":"<p>I am trying to use the new \"MERGE\" statement in SQL Server 2008. The statement will get records from a temporarty table and update the same in some other table.The statement is as following:</p>\n\n<pre><code>create table #TempTable(ProcPOAmdDel_ProcessAmendmentId bigint,ProcPOAmdDel_SemiFinProdId bigint,ProcPOAmdDel_ChallanQty int)\n\nMERGE PurProcessPOAmendmentDelivery AS pod\nUSING (SELECT ProcPOAmdDel_ProcessAmendmentId,\n       ProcPOAmdDel_SemiFinProdId FROM #TempTable ) AS temp\nON pod.ProcPOAmdDel_ProcessAmendmentId = temp.ProcPOAmdDel_ProcessAmendmentId AND \n   pod.ProcPOAmdDel_SemiFinProdId=temp.ProcPOAmdDel_SemiFinProdId \nWHEN MATCHED THEN UPDATE \n  SET pod.ProcPOAmdDel_ChallanQty = temp.ProcPOAmdDel_ChallanQty;\n</code></pre>\n\n<p>While running the state I encountered an error Invalid column    name'ProcPOAmdDel_ChallanQty'.  </p>\n\n<p>Could anybody help me in resolving the issue?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13207914,"title":"how to delete previously entered records while bulk insert in sql server","body":"<p>i have n number of records in a table named tblUserDiet, this table is having the following columns userid,DietSessionId,CreatedDate</p>\n\n<p>now user will insert some records from page.so now i want to do bulk insert.but before to this i want to delete the existing records.</p>\n\n<p>so my stored procedure query looks like below</p>\n\n<pre><code>DELETE FROM tblUserDiet WHERE UserId = @UserId AND DietSessionId=@DietSessionId \nAND DATEADD(dd, 0, DATEDIFF(dd, 0,))=DATEADD(dd,0,DATEDIFF(dd,0,GETDATE())) \nAND DATEDIFF(S,CreatedDate,GETDATE())&gt;=30 \n</code></pre>\n\n<p>but it seems to be incorrect.</p>\n\n<p>can any one suggest the best answer</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#",".net","sql-server-2008","ado.net","vsts2008"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":1728,"score":1,"question_id":1587036,"title":"SQL Server communication protocol issue","body":"<p>I am using VSTS 2008 + C# + ADO.Net + SQL Server 2008. My questions about what kinds of communication protocols SQL Server 2008 will be using, more details of my questions,</p>\n\n<ol>\n<li><p>If the connection string looks like this, whether Named Pipe or TCP/IP is used? Will different communication protocol being used dependent on whether client and SQL Server on the same machine?</p>\n\n<p>Data Source=labtest1;Initial Catalog=CustomerDB;Trusted_Connection=true;Asynchronous</p></li>\n<li><p>In SQL Server Configuration Manager, there are items called \"SQL Server Network Configuration\" and \"SQL Native Client 10.0 Configuration\". I find both of them has configuration options (for communication protocols) of Named Pipe or TCP/IP, what are the differences between \"SQL Server Network Configuration\" and \"SQL Native Client 10.0 Configuration\"?</p></li>\n</ol>\n\n<p>thanks in advance,\nGeorge</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","error-handling"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13205827,"title":"Msg 203, Level 16, State 2, is not a valid identifier","body":"<p>I'm getting the following error:</p>\n\n<blockquote>\n  <p><em>Msg 203, Level 16, State 2, Procedure getQuestion, Line 18</em><br>\n  The name 'select top(1) * from tlb_Question inner join tlb_options on tlb_options.qID=tlb_Question.id and tlb_Question.qNumber=1 and tlb_Question.id not in (0,1)' is not a valid identifier</p>\n</blockquote>\n\n<p>from the following stored procedure:</p>\n\n<pre><code>ALTER proc getQuestion\n    @qNo bigint,\n    @total bigint,\n    @next nvarchar(max)\nas\nbegin \n    declare @hisa bigint\n    set @hisa=@total/3\n\n    if(@qNo&lt;=@total/3)\n    begin\n    declare @query nvarchar(max)\n    set @query=('select top(1) * from tlb_Question \n        inner join tlb_options on tlb_options.qID=tlb_Question.id and tlb_Question.qNumber=1 and tlb_Question.id not in ('+cast(@next as varchar)+')')\n    print @query\n    execute @query\n    end\nend\n</code></pre>\n"},{"tags":["sql-server-2008","backup"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13206531,"title":"script to automate the creation of email profile and alert in SQL Server","body":"<p>I have implemented the <a href=\"http://ola.hallengren.com/\" rel=\"nofollow\">http://ola.hallengren.com/</a> backup plan, which is working great.  I'm also setting up an email profile and alert to send when the backup is successful and when it is not.  Since we have multiple servers, I was hoping to create a script that would create the email profile, and the alert, and automatic the creation, so all i have to do is run the script on each machine, and the whole backup process (with email alerts) is created.  Unfortunately when I go into SSMS there's no \"Script Job As -> Create To\" when I right click on \"Database Mail\".  Is there a script out there, or a way to have SSMS create the script to create the email profile and Operator?</p>\n"},{"tags":["sql-server-2008","database-deadlocks"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13200471,"title":"deadlock transaction - communication buffer resources","body":"<p>I would like to get a suggestion on improving my setup that is causing the sql server to return the deadlock message. I have multiple threading application that actually uses the TaskParallel library and each task will use a stored procedure to select an id from a table to use in its processing. I immediately delete that id from the table in the same statement and I think that is what is causing the deadlocks. The table consists of one column of uniques ids with no indexes. I thought of doing a batch delete periodically but that means keeping a tally of used ids across multiple servers.</p>\n\n<p>here is my sql stored procedure:</p>\n\n<pre><code>   CREATE PROCEDURE [dbo].[get_Ids]\n   @id nvarchar(20) OUTPUT\n\n    AS\n\n    BEGIN\n-- SET NOCOUNT ON added to prevent extra result sets from\n-- interfering with SELECT statements.\n   SET NOCOUNT ON;\n\n       Select top 1 @id = siteid from siteids \n       delete siteids where siteid = @id\n\n\n\n   END\n</code></pre>\n\n<p>Is there any better way to do this? My processes work very fast and I used to request this id from a webrequest service but this took 3 seconds.</p>\n"},{"tags":["sql-server-2008","tsql","cursor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13195431,"title":"Update using cursor in SQL Server","body":"<p>I have two tables <code>department</code> and <code>employee</code>. </p>\n\n<p>In the <code>department</code> table I have three columsn: <code>DEP_ID, NAME, HIKEINPERCENT</code></p>\n\n<p>In the <code>employee</code> table I have four columns: <code>EMP_ID, DEP_ID, EMP_NAME, SALARY</code></p>\n\n<p>Now if I update the <code>HIKEINPERCENT</code> in the <code>department</code> table, it should update the <code>SALARY</code> of the employees in the <code>employee</code> table by using CURSOR in SQL Server.</p>\n\n<p>PLS GUIDE WITH EXPLANATION..</p>\n"},{"tags":["sql","sql-server-2008","search"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13205487,"title":"Match \"word\"s or \"word\"(s)","body":"<p>I am query a data set using <code>field like '%search%'</code> in MS-SQL.  My data often times will contain values like <code>words</code> and <code>word(s)</code>.  I would like to be able to allow users to search for either of those values and get both of them back.  So searching for <code>words</code> would return both results containing <code>words</code> and <code>word(s)</code>, and visa-versa.</p>\n\n<p>Is there a good way of doing this?  Or do I just need to detect in code that the search ends in an <code>s</code> or <code>(s)</code> and update the search accordingly?</p>\n"},{"tags":["sql-server-2008","c#-4.0","emgucv"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":15,"score":-1,"question_id":13204974,"title":"C# EmguCV-How to load image from SQL Server into imagebox?","body":"<p>C# EmguCV-How to load image from SQL Server into <strong>imagebox</strong>?</p>\n"},{"tags":["sql-server-2008","ms-office","ssas"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":130,"score":0,"question_id":9948525,"title":"Analysis Services 2008 configuration for OWC 10","body":"<p>We're upgrading a data warehouse from SQL Server 2000 to 2008 R2. A favorite user reporting tool is a web site using OWC 10 (Office Web Components) -- it's basically ASPX pages connected to the Analysis Services 2000 database via the OWC object.</p>\n\n<p>We migrated the warehouse SQL tables and Analysis Services database into 2008. I'm trying to get the OWC10 web site to connect to the 2008 R2 Analysis Services. I changed the ASPX connection definitions to the new server, and can see them in debug messages. However the web page gives me the error \"Cannot connect to the server 'blahblah.blah.com' The server is either not started or too busy.\"</p>\n\n<p>I suspect there are permissions or security setups required to open up Analysis Services 2008 for OWC10 queries. Has anyone done this or similar? Any ideas where to look?</p>\n\n<p>Thanks.</p>\n"},{"tags":["vb.net","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13198932,"title":"What is the proper procedure to rename columns in an MSSQL Database via VB.NET?","body":"<p>I am having an issue with renaming columns. My code is as follows:</p>\n\n<pre><code>Using m_cnInterval\n    Using m_CMDInterval = New SqlCommand()\n        m_CMDInterval.Connection = m_cnInterval\n        m_CMDInterval.CommandText = \"EXEC sp_rename '[\" &amp; strClassColumnName(intClassArrayPosition) &amp; \"]', '[\" &amp; strRenameClassColumn(intClassArrayPosition) &amp; \"]', 'COLUMN'\"\n        m_CMDInterval.CommandType = CommandType.Text\n        m_CMDInterval.ExecuteNonQuery()\n    End Using\nEnd Using\n</code></pre>\n\n<p>I am getting an error message as follows:</p>\n\n<p>\"Either the parameter @objname is ambiguous or the claimed @objtype (column) is wrong\"</p>\n\n<p>I think this error is related to the way I am using my single quotes and brackets. Is there another syntax when using variables for column names?</p>\n\n<p>Thanks</p>\n"},{"tags":[".net","sql-server-2008","ssms","sql-scripts"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":14,"score":1,"question_id":13203420,"title":"executing script in code and management studio different results","body":"<p>I am using the Microsoft Application Block to execute the create db script below. When I execute the script, you can see at the end I also create a schema called sync in this new database(or try to).</p>\n\n<p>My issue is whenever I execute the code, the schema [sync] always gets created in master and <strong>NOT in the newly created database</strong>. However, if I execute the same script in the query editor of management studio the schema [sync] is created under the correct database [4177be6c-d7b4-459b-a87f-912fddfd4cc1].</p>\n\n<p>This is leading to table insertion issues into the new db where the schema [sync] does not exist. </p>\n\n<p><em>note I've removed most of the script for readability</em></p>\n\n<pre><code>USE [master]\nGO\n/****** Object:  Database [4177be6c-d7b4-459b-a87f-912fddfd4cc1]    Script Date:           01/19/2007 14:17:21 ******/\nCREATE DATABASE [4177be6c-d7b4-459b-a87f-912fddfd4cc1] \n//lots of other mumbojumbo\nGO\nUSE [4177be6c-d7b4-459b-a87f-912fddfd4cc1]\nGO\nCREATE SCHEMA [sync] AUTHORIZATION [dbo]\nGO\n</code></pre>\n\n<p>The problem is probably trivial, but I cannot see it.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13201826,"title":"SP_SEND_DBMAIL @QUERY Inserts Line Breaks Into E-mail","body":"<p>I use the @query perimeter in sp_send_dbmail to send out an e-mail with a list of warnings (the warnings are returned by the @query perimeter).  The @query perimeter is listed as text in the e-mail.  All of the records returned from the @query perimeter and displayed in the e-mail has a line break between them.  ie. If I have 4 records, I would have 8 lines because of line breaks.</p>\n\n<p>How do I turn the line breaks off?  I read the the msdn article for sp_send_dbmail, but it didn't mention any attributes that could be changed that would affect the line breaks.</p>\n\n<p>Code:</p>\n\n<pre><code>    BEGIN\n    EXEC MSDB.DBO.sp_send_dbmail \n        @PROFILE_NAME = 'Alerts',\n        @RECIPIENTS = @MAIL,\n        @SUBJECT = @NEWSUBJECT,\n        @BODY = @NEWBODY,\n        @QUERY =\n            'SET NOCOUNT ON\n            DECLARE @HEXSTRING AS VARCHAR(100)\n            SET @HEXSTRING = (SELECT HEXADECIMAL_STRING FROM mydb.dbo.statusupdates\n                WHERE MACHINE_ID = ''1111'' AND DATEDIFF(MI, TIME_DATE_RECEIVED, GETDATE()) &lt;= 60)\n            SELECT [Warning_Description] FROM mydb.DBO.BINARYTOTABLE(mydb.DBO.HEXTOBINARY(@HEXSTRING)) AS ABB1\n            JOIN mydb.DBO.WarningMessages  ON mydb.DBO.WarningMessages.[Bit_Offset] = ABB1.BITPLACE\n            WHERE BITVALUE = 1 AND ALERT_LEVEL = ''WARNING''',\n        @QUERY_RESULT_HEADER = 0,\n        @ATTACH_QUERY_RESULT_AS_FILE = 0;\n    END\n</code></pre>\n"},{"tags":["sql-server-2008","ms-access-2007","data-migration"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13200445,"title":"Reversing Yes/No field during Select in Access","body":"<p>Is there a way to reverse a Yes/No field during a select statement in Access?  I know how to do so during SQL but that does not fly in Access.</p>\n\n<p>Here is the scenario:</p>\n\n<p>I'm migrating data from an Access DB to an SQL DB.  A Yes/No field in said data in Access is obsolete_flag.  In SQL correspondingly, I have IsActive.  The value needs reversed for SQL since IsActive implies it to be true whereas obsolete_flag would show it is false.</p>\n\n<p>Any suggestions would be appreciated.  Thanks.</p>\n\n<p>Kindest Regards,\nChad Johnson</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13203108,"title":"Conditionally setting variable with case statment","body":"<p>I have the following query. I am trying to only add the values, if the value is not null so the whole variable doesnt end up as a null. Obviously this query below is erroring out, but I do not want to use an ISNULL check on the test column because it puts a comma at the end of the variable text. How would I do this without having the comma at the end of the variable text. Sometimes there will be nulls in the test column, and sometimes there will not be.</p>\n\n<pre><code>DECLARE @Test TABLE\n(\n    test varchar(20)\n)\n\nINSERT INTO @Test\nSELECT 'adfasdfasd'\nUNION ALL\nSELECT NULL\n\n\nDECLARE @DocID varchar(max)\n\nSELECT CASE WHEN test IS NOT NULL THEN @DocID = COALESCE(@DocID + ',' ,'')  + test END\nFROM @Test\n\nSELECT @DocID\n</code></pre>\n"},{"tags":["sql-server-2008","tsql","group-by","nvarchar"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13202691,"title":"group by nvarchar","body":"<p>First of all, sorry for my English I will try to explain in the best way.</p>\n\n<p>Is there a way to group by a column of type <code>nvarchar</code> in SQL Server 2008? </p>\n\n<p>I am going to explain it better: (at least I try)</p>\n\n<p>If I have a table like this:</p>\n\n<pre><code>ID  Quantity   City   Code   WebSiteLink\n__  ________   ____   ____   __________\n1      10      Milan   R2    home/images/1.jpg\n2      20      Milan   R2    home/images/2.jpg\n3      30      Rome    R2    home/images/3.jpg\n4      55      Rome    R2    home/images/4.jpg\n5      4       Naple   R2    home/images/5.jpg\n6      1       London  R2    home/images/6.jpg\n7      30      London  R2    home/images/7.jpg\n8      40      London  R2    home/images/8.jpg\n</code></pre>\n\n<p>I am able to group all columns except <code>WebSitelink</code> because it is an <code>nvarchar</code> type.</p>\n\n<p>My need is to get a random img link, is that possible to do it with a query?</p>\n\n<p>I don't want to use a stored procedure.</p>\n"},{"tags":["c#","sql-server-2008","azure","windows-azure-storage"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13192788,"title":"Storing blobs in windows azure store additional data such as content type in DB","body":"<p>We have a fairly large solution which stores a lot of images, videos, documents in Sql Server 2008 using FileStream.  We have begin migration to using windows azure blob storage to take advantage of geo-replication and what not, this will mean changing the varbinary(max) columns to a relative url we will append with our custome subdomain we have pointing to our storage account.</p>\n\n<p>This all works fine and we are happy in testing however we currently store with the varbinary data the Filename, extension and contentType.  </p>\n\n<p>My question is if we are just going to a relative url which will have the file extension on if needed do we need to store this additional data?  We are debating in the office and the consensus seems to be to keep it simple and just store the Url.</p>\n\n<p>What do most people do in this scenario?  What are the uses/benefits of storing this addiotnal data?</p>\n\n<p>Many thanks for your thoughts on this, an external opinion is probably all that will settle this.</p>\n"},{"tags":["sql-server-2008","sqlprofiler"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13198870,"title":"A couple of basic Sql Profiler questions","body":"<p>(Sorry for the longish question, I'll try to be concise.)</p>\n\n<p>I'm running SQL Server Profiler and I'm chasing down some performance issues. I'm relatively new to what the profiler does and I've exported the traces into a table so I can run queries against the data. </p>\n\n<p>One thing I've been running up against is some seemingly odd behavior doing select queries against the TextData field of the table generated by the trace export. It may have to do with the field's data type (ntext, null). I'm selecting for particular values, but getting unexpected results. For example, if I do this:</p>\n\n<pre><code>select * from [TraceAnalyzer].dbo.TraceTable\n</code></pre>\n\n<p>and I'm interested in values like this:</p>\n\n<pre><code>exec [Sproc_of_interest] @parm1=992\n</code></pre>\n\n<p>I'd do a query like this:</p>\n\n<pre><code>select * from [TraceAnalyzer].dbo.TraceTable\nwhere TextData like '%exec [Sproc_of_interest] @parm1=%'\n</code></pre>\n\n<p>but the return result is empty.</p>\n\n<p>Also, if I do a query like:</p>\n\n<pre><code>select * from [TraceAnalyzer].dbo.TraceTable\nwhere TextData like '%exec [Sproc_of_interest]%'\n</code></pre>\n\n<p>I get unexpected TextData values like <code>exec sp_reset_connection</code></p>\n\n<p>Would the square brackets in the criteria be messing things up? I've tried omitting them, but that just excludes everything. I'm not aware of escape characters in SQL select queries, but when I copy/paste the value from one of the offending records, the pasted value does not appear to contain anything that would meet the original query's criteria.</p>\n\n<p>Any insights would be greatly appreciated. Thanks.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13201715,"title":"Convert only the year part of the datetime in SQL server","body":"<p>Any other easier way to bring the year part of a datetime to current year? If not, which one is better performance wise?</p>\n\n<p>Attempt #1:</p>\n\n<pre><code>CAST(DATEPART(MONTH, mydate) AS VARCHAR) + '/' + \nCAST(DATEPART(DAY, mydate) AS VARCHAR) + '/' +\nCAST(YEAR(GETDATE()) AS VARCHAR) AS DATETIME \n</code></pre>\n\n<p>Attempt #2:</p>\n\n<pre><code>DATEADD(YEAR, DATEDIFF(YEAR,  mydate, GETDATE()), mydate)\n</code></pre>\n"},{"tags":["sql-server-2008","tsql","stored-procedures"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13201516,"title":"Correct syntax for calling a stored procedure with parameters from within another stored procedure","body":"<p>I am having difficulty establishing the correct syntax for calling a stored procedure within a stored procedure. I thought this syntax was correct:</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROCEDURE [dbo].[newProc](\n    @param1 varchar(50),\n    @param2 nvarchar(2000),\n    @param3 int,\n    @param4 int,\n    @param5 int,\n    @param6 int\n)\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    EXEC [dbo].[externProc1] @param1, @param2;\n    GO\n\n    EXEC [dbo].[externProc2] @param3, @param4;\n    GO\n\n    EXEC [dbo].[insertProc3] @param5, @param6;\n    GO\n\nEND\nGO\n</code></pre>\n\n<p>But when I try this, I keep getting \n\"Incorrect syntax near ';'  Must declare the scalar variable @param3.\nMust declare the scalar variable @param5.\"</p>\n\n<p>What is the correct syntax for calling a stored procedure with parameters from within another stored procedure?</p>\n"},{"tags":["visual-studio-2010","sql-server-2008","windows-authentication","virtual-machine","intranet"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13185478,"title":"How do I authenticate to a SQL Server database on a domain from a virtual machine off the domain?","body":"<p>I am supporting a .NET 4.0 (Visual Studio 2010) web application that authenticates to a SQL Server 2008 database which resides on my work intranet. The application authenticates to the database using windows authentication. Thats all fine and dandy if Im developing on my host, but I am developing on a virtual machine that is not on the work domain. Thus when the project build and runs, it throws a SqlClient.SqlException</p>\n\n<blockquote>\n  <p>\"Login failed. The login is from an untrusted domain and cannot be used with Windows authentication.\"</p>\n</blockquote>\n\n<p>Short of developing on my host and abandoning the VM, what can I do to avoid this error and successfully authenticate to the database so I can build/run the web app? I am willing to store my credentials somewhere locally, though preferably not somewhere that would be under TFS source control (like the web.config) because I couldnt keep the file checked out since there are other developers on the project. </p>\n\n<p>I have tried running Visual Studio as a different user (as the user on my work domain) but I get a \"unknown user name or bad password\" error.</p>\n\n<p>Note, adding the Virtual Machine to the domain (or connecting to it via VPN) are not options. The VM must remain off the domain.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":120,"score":2,"question_id":11858827,"title":"MS SQL Server 2008 script generation creates invalid scripts when using constraints","body":"<p>On an MS SQL Server 2008 (10.50.2811.0) Developer Edition (64-bit), running under Windows 2008 Server 2008 R2 Standard the script generation from within SQL Server Management Studio creates scripts where the same constraint is dropped multiple times. </p>\n\n<p>A simple example includes two tables, tParent and tChild, where tChild's ParentID references tParent's ID. The script (Database context menu => Tasks => Generate Scripts...) being generated (for DROP AND CREATE) looks like this:</p>\n\n<pre><code>USE [TestDb]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\nDROP TABLE [dbo].[tChild]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nDROP TABLE [dbo].[tParent]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tParent](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tParent] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tChild](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[ParentID] [int] NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tChild] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] WITH CHECK ADD CONSTRAINT [FK_tChild_tParent] FOREIGN KEY([ParentID])\nREFERENCES [dbo].[tParent] ([ID])\nGO\nALTER TABLE [dbo].[tChild] CHECK CONSTRAINT [FK_tChild_tParent]\nGO\n</code></pre>\n\n<p>Why are there two identical lines that both try to drop the FK_tChild_tParent constraint? And why is the comment for both lines different?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13199683,"title":"Save Files to SQL Server Database","body":"<p>i have the table \"tblTransDocs\" with these fields (DocId(pk),TransId(pk),rev,...and for each row of this table i can have file. now my question is i have to make another table with these fields (fileId(int),file name (varchar) , content type (varchar) ,data (var binary) and adding Fileid as a foreign key to \"tblTransDocs\" or i can add columns to \"tblTransDocs\" for saving files to the database like (file name (varchar) , content type (varchar) ,data (var binary) .</p>\n\n<p>which way is correct?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13199290,"title":"Find 2 Business Days","body":"<p>I have a Calendar table. I would like get 2 business before Today's Date while skipping Holidays and weekeends.</p>\n\n<p>For example:</p>\n\n<p>Example 1: New years 2013 falls on a Tuesday. If it was Thursday (1/3), then my starting date would be Monday (12/31).</p>\n\n<p>Example 2: If it was Monday (12/31), then my starting date would be Thursday (12/27).</p>\n\n<p>My Clandar table as been prepopulated with 30 years worth of dates and have flags to determine which ones are weekend and hollidays. The table has these fields:</p>\n\n<p>dt: Date and time for 30 years\nY: year\nD: Day\nM: Month\nIsholiday: (Is a holiday are not, flagged with 0 for \"no\"  and 1 for \"Yes\")\nIsWeekday: (Is a weekday? Flagged with 0 for \"no\"  and 1 for \"Yes\"\nHolidayDescritption: Holiday Names</p>\n\n<p>Please help.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13200627,"title":"sql server external tools logging errorlog","body":"<p>In SQL Server 2008 I installed some external tools and then removed them.  Somehow I am getting this error in the error logs.  How can I remove this queue?</p>\n\n<pre><code>The activated proc '[LakeSideLockLogger].[_LakeSide_DbTools_LockMonitorEvents]' running on queue 'msdb.LakeSideLockLogger._LakeSide_DbTools_LockQueue' output the following:  'Could not find stored procedure 'LakeSideLockLogger._LakeSide_DbTools_LockMonitorEvents'.'\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2000"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13200024,"title":"SQL Server 2008 upgrade advisor tool","body":"<p>We upgraded to SQL Server 2008 from SQL Server 2000. But due to some legacy scripts/queries in our health care application, that run only in 2000, we had to run 2008 version on backwards compatibility mode. </p>\n\n<p>My question is what do I need to be aware of if I have to turn it on to full compatibility mode in terms of potential conflicts/issues etc. Is the Upgrade Advisor tool still useful in my case as we already upgraded but running in backwards compatibility mode. Is there value in running that tool? </p>\n\n<p>Any other information any one can share , will be useful. </p>\n"},{"tags":["sql-server","sql-server-2008","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2747,"score":4,"question_id":8917315,"title":"How to get Enterprise Manager installed in SQL Server 2008 Express?","body":"<p>I've installed Microsoft SQL Server 2008 Express twice now, and all the services work and I can create databases from Visual Studio 2010, but I don't have the <strong><em>Enterprise Manager</em></strong> (I learned it is now called <strong><em>Management Studio</em></strong>) available in the SQL Server 2008 program menu-- I do have other menu items like configuration manager, etc. but nothing for <em>Management Studio / Enterprise Manager</em>.</p>\n\n<p>Is there a checkbox I've missed during installation?<br>\nI ran a search for all exes in the SQL Server root folder and nothing jumped out as belonging to the Enterprise Manager, but I'm not 100% sure what the executable would be named.</p>\n\n<p>Primary question:<br>\n&nbsp; &nbsp; What is the procedure required to install the Management Studio client [for/with SQL 2008 Express] ?<br>\nSecondary question:<br>\n&nbsp; &nbsp; What is the name of this client's executable file ?</p>\n"},{"tags":["sql","sql-server-2008","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13200511,"title":"How to Generate Scripts For All Triggers in Database Using Microsoft SQL Server Management Studio","body":"<p>I'd like to generate an SQL Script that contains the SQL to create all of the triggers that exist in our database.  The triggers were added directly via the SSMS query pane so, there is currently no source other than the trigger on the database itself.  </p>\n\n<p>I have already tried the method where you right-click the database, select <code>Tasks-&gt;Generate Scripts</code> and used the \"Script Entire Database and All Objects\" option.  While this does create a SQL script for the tables and constraints, it does not generate SQL for the triggers.  </p>\n\n<p>I also understand that I can right click on each trigger in the database and select the Generate SQL Script option but, there is currently 46 tables under audit (For Insert, Update, and Delete).  </p>\n\n<p>Rather manually generate an insert, update, and delete trigger script for each of the 46 tables, is there an easier way to do this?  Or, should I start clicking, copying, and pasting?</p>\n"},{"tags":["sql-server-2008","jobs","xcopy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13200565,"title":"Copying files between servers SQL Job","body":"<p>I have a SQL job that I would like to copy files in a directory out to a directory on another server. Here is the CMD that I am running</p>\n\n<p>xcopy \\DB1\\TEST*.* \\DB2\\foo /S /Y</p>\n\n<p>And I get this error\nExecuted as user: DOMAIN\\SA$. File not found - <em>.</em>  0 File(s) copied.  Process Exit Code 0.  The step succeeded.</p>\n\n<p>I have also tried the copying to the same server with same results as well as just trying to grab one file and copying</p>\n\n<p>I have added the DOMAIN\\SA account as an admin on the servers and still getting this. Is this just a bug or am I missing some permissions setting?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13199828,"title":"What collation to use for a column that will have both English and Japanese text?","body":"<p>I am using Sql Server 2008 and one of our requirements is to provide multi-lingual support. The main languages are English, German, French and Japanese. </p>\n\n<p>I have a table which has its COLLATION as Latin1_General_CI_AS. The column that will store the text data has this COLLATION 'Japanese_CI_AS'</p>\n\n<p>When I run the following SQL in SQL Server Management Studio (SSMS)</p>\n\n<pre><code>DECLARE @translation nvarchar(max)\nSET @translation = 'クッキー(Cookie)を許可してください'\n\nPRINT @translation\n\nUPDATE [ResourceTranslations]\nSET Translation = @translation  \nWHERE Id = 4\n</code></pre>\n\n<p>The value inserted is '????(Cookie)?????????', which is also the value that is printed out.</p>\n\n<p>Is there any chance that SSMS is having problems with the Japanese characters? It seems that the print statement is telling me that the value is being altered to '????(Cookie)?????????'  before it gets inserted in the table.</p>\n\n<p>Any help or advice gratefully accepted.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13199425,"title":"Multiple conditions on select query","body":"<p>I have a select statement and I wish to calculate the cubic volume based on other values within the table. However I want to check that neither pr.Length_mm or pr.Width_mm or pr.Height_mm are NULL prior. I've looked at CASE statements, however it only seems to evaluate one column at a time.</p>\n\n<pre><code>SELECT \n      sa.OrderName,\n      sa.OrderType,\n      pr.Volume_UOM\n ,pr.Length_mm*pr.Width_mm*pr.Height_mm AS Volume_Cubic\n ,pr.Length_mm*pr.Width_mm AS Volume_Floor\n ,pr.Length_mm\n ,pr.Height_mm\n ,pr.Width_mm\nFROM CostToServe_MCB.staging.Sale sa\nLEFT JOIN staging.Product pr\nON sa.ID = pr.ID\n</code></pre>\n"},{"tags":["vb.net","visual-studio-2010","visual-studio","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":13093991,"title":"VB Application connects to server fine on my computer but not on any other computer","body":"<p>I am at my wits end. The application I built works perfectly on my system but not on anyone elses. It is very simple, on load it queries the user for a Batch number and then filters the data to show only items with that batch number in the datagridview. </p>\n\n<p>Here's the code I wrote:</p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>'*******************************************************************************************************************************\n' When the form loads, the following code opens a inputbox that asks the user for a batch number. This number then gets used\n' to filter the data before populating the DataGridView\n'*******************************************************************************************************************************\nPrivate Sub frmAQFilter_Load(sender As System.Object, e As System.EventArgs) Handles MyBase.Load\n    Me.DataTable1TableAdapter.Fill(Me.ElementDataset.qryAQFilterData)\n\n    Dim blnX As Boolean = True\n    Dim msg As Integer\n\n    Do While blnX\n        strBatch = \"\"\n        strBatch = InputBox(\"Batch Number: \")\n\n        If Len(strBatch) &gt; 0 Then\n            DataTable1BindingSource.Filter = String.Format(\"Batch = '\" &amp; strBatch &amp; \"'\")\n            If Not DataTable1BindingSource.Count &gt; 0 Then\n                msg = MsgBox(\"No records found with the batch number: \" + strBatch + Chr(13) _\n                             + \"Do you wish to enter a different batch number\", MsgBoxStyle.YesNo)\n                If msg = vbNo Then\n                    Me.Close()\n                    blnX = False\n                End If\n            Else\n                blnX = False\n            End If\n        Else\n            Me.Close()\n            blnX = False\n        End If\n    Loop\n    Me.WindowState = FormWindowState.Normal\nEnd Sub\n</code></pre>\n\n<p>I don't get any errors, it just doesn't populate the dataset. My first thought was that the connection string was bad. No problems there. Any advice would be greatly appreciated.</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":12,"down_vote_count":0,"view_count":1988,"score":12,"question_id":6376866,"title":"TSQL - How to use GO inside of a BEGIN .. END block?","body":"<p>I am generating a script for automatically migrating changes from multiple development databases to staging/production.  Basically, it takes a bunch of change-scripts, and merges them into a single script, wrapping each script in a <code>IF whatever BEGIN ... END</code> statement.</p>\n\n<p>However, some of the scripts require a <code>GO</code> statement so that, for instance, the SQL parser knows about a new column after it's created.</p>\n\n<pre><code>ALTER TABLE dbo.EMPLOYEE \nADD COLUMN EMP_IS_ADMIN BIT NOT NULL\nGO -- Necessary, or next line will generate \"Unknown column:  EMP_IS_ADMIN\"\nUPDATE dbo.EMPLOYEE SET EMP_IS_ADMIN = whatever\n</code></pre>\n\n<p>However, once I wrap that in an <code>IF</code> block:</p>\n\n<pre><code>IF whatever\nBEGIN\n    ALTER TABLE dbo.EMPLOYEE ADD COLUMN EMP_IS_ADMIN BIT NOT NULL\n    GO\n    UPDATE dbo.EMPLOYEE SET EMP_IS_ADMIN = whatever\nEND\n</code></pre>\n\n<p>It fails because I am sending a <code>BEGIN</code> with no matching <code>END</code>.  However, if I remove the <code>GO</code> it complains again about an unknown column.</p>\n\n<p><strong>Is there any way to create and update the same column within a single <code>IF</code> block?</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13198571,"title":"Restore Backup Fails - File 'Db' cannot be restored to '{...}.mdf'. Use WITH MOVE to identify a valid location for the file","body":"<p>I am getting the following errors trying to do a restore using the restore command on a backup file I recieved from a customer.</p>\n\n<p>RESTORE DATABASE SFDB FROM DISK = N'C:\\Backup\\Backup.bak' </p>\n\n<p>Any thoughts on what I can do to correct this?  It's looking for the mdf, so can I assume that the backup file I have is an incremental backup and not the full backup and that's why it's looking for the mdf?  </p>\n\n<p>I am not sure if 1) they have given all the data (the entire db) or 2) I have the right data - and I can do the restore with the right T-SQL commands - I just don't know how.</p>\n\n<p>Help is appreciated.</p>\n\n<pre><code>Msg 5133, Level 16, State 1, Line 2\nDirectory lookup for the file \"D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf\" failed with the operating system error 21(failed to retrieve text for this error. Reason: 15105).\nMsg 3156, Level 16, State 3, Line 2\nFile 'Db' cannot be restored to 'D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf'. Use WITH MOVE to identify a valid location for the file.\nMsg 5133, Level 16, State 1, Line 2\nDirectory lookup for the file \"D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF\" failed with the operating system error 21(failed to retrieve text for this error. Reason: 15105).\nMsg 3156, Level 16, State 3, Line 2\nFile 'DbDev_log' cannot be restored to 'D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF'. Use WITH MOVE to identify a valid location for the file.\nMsg 3634, Level 16, State 1, Line 2\nThe operating system returned the error '21(failed to retrieve text for this error. Reason: 15105)' while attempting 'GetVolumeInformation' on 'D:\\'.\nMsg 3013, Level 16, State 1, Line 2\nRESTORE DATABASE is terminating abnormally.\n</code></pre>\n\n<p>RESTORE FileListOnly FROM DISK = N'C:\\Backup\\Backup.bak' shows me the following...</p>\n\n<pre><code>LogicalName PhysicalName    Type    FileGroupName   Size    MaxSize FileId  CreateLSN   DropLSN UniqueId    ReadOnlyLSN ReadWriteLSN    BackupSizeInBytes   SourceBlockSize FileGroupId LogGroupGUID    DifferentialBaseLSN DifferentialBaseGUID    IsReadOnly  IsPresent   TDEThumbprint\nDb  D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf  D   PRIMARY 29622272    35184372080640  1   0   0   02925462-83CC-4222-8966-53229FA25B1C    0   0   29032448    512 1   NULL    269000000146900238  735C7F0E-F63D-4AA1-AC48-505A084AC00B    0   1   NULL\nDb_log  D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF  L   NULL    40239104    2199023255552   2   0   0   71038B04-CBC9-4E4A-93AD-4E1268859CB2    0   0   0   512 0   NULL    0   00000000-0000-0000-0000-000000000000    0   1   NULL\nDbDev_filestream    D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db  S   PRIMARY_FILESTREAM  4691012 0   65537   18000000011800001   0   627C9AAA-97BD-4991-9C8C-90C400226A9F    0   0   4784128 512 2   NULL    269000000146900238  735C7F0E-F63D-4AA1-AC48-505A084AC00B    0   1   NULL\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13198805,"title":"Remove duplicate batches of data","body":"<p>Due to a bug in my application a table that was built to carry daily records of each delivery period, was populated many times.</p>\n\n<p>Lets say I have a delivery from 1st of June to 5 of June. My table should be populated with 5 records, one for each day. Now, I have havoc because I have many \"batches\" of the same content.</p>\n\n<p>The table layout is as:</p>\n\n<pre><code>dummy_id       -- identity column\ndelivery_id    -- id of the delivery\non_date        -- the day\ncharge         -- the daily cost\n</code></pre>\n\n<p>Is there an elegant way to keep only the first batch of records and delete the batches that were inserted by mistake for all the deliveries?</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13198384,"title":"What does &gt; 0 mean in SQL?","body":"<p>I have the following SQL statement. Please tell me if my translation of it is accurate. I'm using MS SQL Server 2008. Thanks</p>\n\n<pre><code>(bld_sqft &amp;gt; 0 OR bld_area &amp;gt; 0)\n</code></pre>\n\n<p>My translation</p>\n\n<pre><code>bld_sqft &gt; 0 OR bld_area &gt; 0\n</code></pre>\n"},{"tags":["sql-server-2008","port","ssms"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13198148,"title":"Connecting to SQL Server instance without giving port","body":"<p>I have recently added another SQL Server 2008 instance to a server and want to be able to connect to without having to specify the new port number in SSMS. Is this possible?</p>\n\n<p>I can connect if I use <code>MyServer, 2434\\Staging</code></p>\n\n<p>but fails when I use <code>MyServer\\Staging</code></p>\n\n<p>Is there a setting that I need to change or alias to setup?</p>\n\n<p>Thanks for the help</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13197526,"title":"Loop through all records in my SQL Server database","body":"<p>I have the following SQL script. As you can see I manually set the <code>@listingid</code> value to 30653.</p>\n\n<p>But this script should be executed for all records in the <code>[listings]</code> table where <code>@listingid</code> is assigned the value of the <code>[listings].id</code> column.</p>\n\n<pre><code>DECLARE @profname nvarchar(150)\nDECLARE @furl nvarchar(250)\nDECLARE @city nvarchar(250)\nDECLARE @listingid int\n\nset @listingid=30653\n--select the top 1 professionname\nSELECT TOP 1 @profname=REPLACE(LOWER(pn.title),' ','-'),@furl=l.friendlyurl,@city=REPLACE(REPLACE(LOWER(l.city),'''',''),' ','-') FROM healthprof_professionnames hpn\nINNER JOIN professionname pn ON pn.id=hpn.professionnameid\nINNER JOIN listings l on l.id=hpn.healthprofid\nWHERE l.id=@listingid ORDER BY pn.title\n\n--check if current friendlyurl already contains profession\nIF NOT CHARINDEX(@profname,@furl)&gt;0\n    SET @furl = @furl + '-' + @profname\n\nIF NOT CHARINDEX(@city,@furl)&gt;0\nSET @furl = @furl + '-' + @city\n\nSET @furl = @furl + '-3'\n\nUPDATE listings set friendlyurl=@furl WHERE id=@listingid\n</code></pre>\n"},{"tags":["sql","sql-server-2008","ssas","mdx","business-intelligence"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13184139,"title":"SQL Server MDX query parameter","body":"<p>I am very new to MDX query. I am trying to pass a parameter through my query. It is giving me this SQL error:</p>\n\n<blockquote>\n  <p><em>Query preparation failed.</em><br>\n  <em>The function expects a tuple expression for the 5 argument.</em><br>\n  <em>A tuple set expression was used.</em></p>\n</blockquote>\n\n<p>The query is:</p>\n\n<pre><code>SELECT \n{\n[Measures].[DENOMINATOR]\n,[Measures].[NUMERATOR]\n,[Measures].[Goal]\n}\nON COLUMNS,\nNON EMPTY\n(\n [Dim Indicator].[Indicator Set].[Indicator Set].ALLMEMBERS\n ,[Dim Indicator].[Indicator Group].[Indicator Group].ALLMEMBERS\n ,[Dim Indicator].[Indicator Name].[Indicator Name].ALLMEMBERS\n)\nON ROWS\nFROM [Dummy-Dashboard]\n\n--Parameter Queries goes here \n\nWHERE \n(\n    strtoset(@DimGenderGenderID)\n )\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13181245,"title":"What is the default user mapping for a server role in SQL Server 2008","body":"<p>I am learning the relations among authentication-user-role-schema. In my application I am using my Windows authentication which is assigned as sysadmin(as well as public) server role. </p>\n\n<p>After that, when I am executing <code>SELECT CURRENT_USER</code>, I get <code>dbo</code>. However, I can't find the mapping from the server role to the database user. I also tested by creating a login which has the server role as public. Using this login, I got guest when I executed <code>SELECT CURRENT_USER</code>. </p>\n\n<p>So where does this mapping get defined?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":9,"score":1,"question_id":13197035,"title":"reporting services 2005 on sql server 2008","body":"<p>Is it possible to install RS 2005 component alone and then install sql server 2008 R2 engine \nwithout RS option? Is there anything I need  to consider? or Can I upgrade from 2005 to 2008 R2 and leave RS \n2005?</p>\n\n<p>OR reporting services 2005 on sql server 2008?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","tsqlt"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":13196802,"title":"SQL - Foreign Key Constraint Error with Update Statement","body":"<p>I am Trying to update my table (product) columns - ProductID(FK) and ProductType(FK). These two column has relation with MProduct table's column MProductID(PK) and MProductType(PK).</p>\n\n<p>I am trying to update </p>\n\n<pre><code>ProductID       ProductType\n9999            11\n9999            12\n</code></pre>\n\n<p>But I got the following error </p>\n\n<pre><code>The UPDATE statement conflicted with the FOREIGN KEY constraint \"FKHCR_MProduct\".\nThe conflict occurred in database \"XXXX\", table \"dbo.MProduct\".\n</code></pre>\n\n<p>I checked with MProduct table, It has all the valid records for look up. I can not change my Table Structure.</p>\n\n<p>I tried this Query too</p>\n\n<pre><code>Select ProductID,ProductType\nfrom dbo.Product P\nLeft Join dbo.MProduct M on M.ProductID = P.ProductID\n   and M.ProductType = P.ProductType\nwhere M.ProductType is null\n   and M.ProductID is null\n</code></pre>\n\n<p>and there is No Output, means there is No Null Data Inside the Look up table.</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":480,"score":2,"question_id":11307435,"title":"Getting error while running 50 MB script on SQL Server 2008 R2","body":"<p>I am using SQL Server 2008 R2, I have a script to update the DB, that script is approx\n50 MB in size and contains some about 800,000 lines.</p>\n\n<p>Error: </p>\n\n<blockquote>\n  <p>TITLE: Microsoft SQL Server Management Studio</p>\n  \n  <p>Cannot execute script.</p>\n  \n  <p>ADDITIONAL INFORMATION:</p>\n  \n  <p>Insufficient memory to continue the execution of the program.\n  (mscorlib)</p>\n</blockquote>\n\n<p>Can somebody please help me to run this script without getting this error?</p>\n"},{"tags":["xml","sql-server-2008","tsql","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13195922,"title":"How to query xml column in tsql","body":"<p>I have a table, T1, with a XML column, EventXML, on SQL Server 2008. I want to query all the rows where certain node contains a particular value. Better, I'd like to retrieve the value in a different node. The table T1:</p>\n\n<pre><code>T1:\n   EventID, int\n   EventTime, datetime\n   EventXML, XML\n</code></pre>\n\n<p>Here is an example XML hierarchy:</p>\n\n<pre><code>&lt;Event&gt;\n   &lt;Indicator&gt;\n      &lt;Name&gt;GDP&lt;/Name&gt;\n   &lt;/Indicator&gt;\n   &lt;Announcement&gt;\n      &lt;Value&gt;2.0&lt;/Value&gt;\n      &lt;Date&gt;2012-01-01&lt;/Date&gt;\n   &lt;/Announcement&gt;\n&lt;/Event&gt;\n</code></pre>\n\n<ol>\n<li>How to find all the rows related to \"GDP\" Indicator;</li>\n<li>How to get all values for \"GDP\" Indicator;</li>\n</ol>\n"},{"tags":["sql-server-2008","jdbc","mule"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1005,"score":2,"question_id":10689827,"title":"Mule 3 JDBC endpoint exception with sql server","body":"<p>I am trying to insert a String into a SQL Server database using Mule JDBC outbound endpoint. The query is:</p>\n\n<pre><code>INSERT INTO ife VALUES (#[payload:java.lang.String], 0)\n</code></pre>\n\n<p>The query works when the payload is in a where clause of a select statement and when I hardcode values in place of the payload expression.  However, it fails miserably with insert statements like the one listed above.  I have included the exception below as well as the flow xml configuration.  Any suggestions/help would be greatly appreciated!</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ERROR 2012-05-21 11:37:00,122 [[ife].IFE_InboundFlow1.stage1.02]     org.mule.exception.DefaultMessagingExceptionStrategy: \n********************************************************************************\nMessage               : Failed to route event via endpoint:     DefaultOutboundEndpoint{endpointUri=jdbc://insert, connector=JdbcConnector\n{\n  name=Database__JDBC_\n  lifecycle=start\n  this=11e5f\n  numberOfConcurrentTransactedReceivers=4\n  createMultipleTransactedReceivers=false\n  connected=true\n  supportedProtocols=[jdbc]\n  serviceOverrides=&lt;none&gt;\n}\n,  name='endpoint.jdbc.insert', mep=ONE_WAY, properties={queryTimeout=-1,     queries=merged: {insert=INSERT INTO ife VALUES (#[payload:java.lang.String], 0)}},     transactionConfig=Transaction{factory=null, action=INDIFFERENT, timeout=0},     deleteUnacceptedMessages=false, initialState=started, responseTimeout=10000,     endpointEncoding=UTF-8, disableTransportTransformer=false}. Message payload is of type:     String\nCode                  : MULE_ERROR-42999\n--------------------------------------------------------------------------------\nException stack is:\n1. com.microsoft.sqlserver.jdbc.SQLServerException: Incorrect syntax near '?'.(SQL     Code: 0, SQL State: + null) (com.microsoft.sqlserver.jdbc.SQLServerException)\n  com.microsoft.sqlserver.jdbc.SQLServerException:190 (null)\n2. com.microsoft.sqlserver.jdbc.SQLServerException: Incorrect syntax near '?'. Query:     INSERT INTO ife VALUES (?, 0) Parameters: [30076](SQL Code: 0, SQL State: +     null) (java.sql.SQLException)\n  org.apache.commons.dbutils.QueryRunner:540 (null)\n3. Failed to route event via endpoint:     DefaultOutboundEndpoint{endpointUri=jdbc://insert, connector=JdbcConnector\n{\n  name=Database__JDBC_\n  lifecycle=start\n  this=11e5f\n  numberOfConcurrentTransactedReceivers=4\n  createMultipleTransactedReceivers=false\n  connected=true\n  supportedProtocols=[jdbc]\n  serviceOverrides=&lt;none&gt;\n}\n,  name='endpoint.jdbc.insert', mep=ONE_WAY, properties={queryTimeout=-1, queries=merged: {insert=INSERT INTO ife VALUES (#[payload:java.lang.String], 0)}}, transactionConfig=Transaction{factory=null, action=INDIFFERENT, timeout=0}, deleteUnacceptedMessages=false, initialState=started, responseTimeout=10000, endpointEncoding=UTF-8, disableTransportTransformer=false}. Message payload is of type: String (org.mule.api.transport.DispatchException)\n  org.mule.transport.AbstractMessageDispatcher:107 (http://www.mulesoft.org/docs/site/current3/apidocs/org/mule/api/transport/DispatchException.html)\n--------------------------------------------------------------------------------\nRoot Exception stack trace:\ncom.microsoft.sqlserver.jdbc.SQLServerException: com.microsoft.sqlserver.jdbc.SQLServerException: Incorrect syntax near '?'.\nat com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDriverError(SQLServerException.java:190)\nat com.microsoft.sqlserver.jdbc.SQLServerParameterMetaData.&lt;init&gt;(SQLServerParameterMetaData.java:426)\nat com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.getParameterMetaData(SQLServerPreparedStatement.java:1532)\n+ 3 more (set debug level logging or '-Dmule.verbose.exceptions=true' for everything)\n</code></pre>\n\n<p>Here's the configuration xml:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;spring:beans&gt;\n        &lt;spring:bean id=\"Bean\" name=\"Bean\" class=\"org.enhydra.jdbc.standard.StandardDataSource\" doc:name=\"Bean\"&gt;\n            &lt;spring:property name=\"driverName\" value=\"com.microsoft.sqlserver.jdbc.SQLServerDriver\"/&gt;\n            &lt;spring:property name=\"url\" value=\"jdbc:sqlserver://localhost:1433;instanceName=SQLEXPRESS;databaseName=test;user=test;password=test;\"/&gt;\n        &lt;/spring:bean&gt;\n    &lt;/spring:beans&gt;\n&lt;jdbc:connector name=\"Database__JDBC_\" dataSource-ref=\"Bean\" validateConnections=\"true\" queryTimeout=\"-1\" pollingFrequency=\"0\" doc:name=\"Database (JDBC)\"/&gt;\n&lt;flow name=\"test\"&gt;\n    &lt;jdbc:outbound-endpoint exchange-pattern=\"one-way\" queryKey=\"insert\" responseTimeout=\"10000\" mimeType=\"text/plain\" queryTimeout=\"-1\" connector-ref=\"Database__JDBC_\" doc:name=\"Database (JDBC)\"&gt;\n                                &lt;jdbc:query key=\"insert\" value=\"INSERT INTO ife VALUES (#[payload:java.lang.String], 0)\"/&gt;\n                            &lt;/jdbc:outbound-endpoint&gt;\n&lt;/flow&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":29,"score":0,"question_id":13192667,"title":"Is there a Performance difference when we SET Encryption on Database ON and OFF?","body":"<p>I am just wondering to whether is there any performance difference in sprocs and inline queries when DB encryption is set to ON and OFF?</p>\n\n<p>If yes,could you please explain me in detail when the performance is good and when its bad?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","rollback"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13188621,"title":"roll back SQL query executed by mistake","body":"<p>I think the question says it all,\nthe following update query has been executed - by mistake - in SQL Server management studio</p>\n\n<pre><code>update kms_students set student_campus='4' where student_campus='KL'\n</code></pre>\n\n<p>The effected rows are more than 1000, and i can't identify it since that table is already have the <code>student_campus='4'</code> for many previous rows.</p>\n\n<p>Is it possible to roll back?</p>\n"},{"tags":["sql-server-2008","full-text-search"],"answer_count":1,"favorite_count":3,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13193914,"title":"Full Text Search with blank spaces in SQL Server 2008","body":"<p>There is a problem occurs when I search data using full-text search with SQL Server 2008.</p>\n\n<p>When I search data with no blank space it works but when I enter data with blank spaces it gives an error.</p>\n\n<p>Like if I search <code>'amit'</code> it works but if data is <code>'amit is working'</code> it gives error.</p>\n\n<p>I am using ASP.NET MVC 4.0 with SQL Server 2008.</p>\n\n<p>Thanks Amit.</p>\n\n<pre><code>Create PROC [usp_Feedback_Search]\n@Word nvarchar(500) ,   \n@CompanyId UNIQUEIDENTIFIER     \n\nAs\nIF ISNULL(@Word,'') = ''\n BEGIN\n Select          \n  [Id] ,\n[Content] ,    \n[UserId],    \n [VoteCount] ,\n [IsOpen],\n [Deleted],\n [RowVersion],    \n [CreatedBy],     \n [CreatedOn],    \n [UpdatedOn],    \n [UpdatedBy],       \n [CompanyId], \n [DisplayId],\n  [Status]\n FROM Feedback         \n  WHERE CompanyId=@CompanyId\n  END\n ELSE\n  BEGIN   \n\nDECLARE @formatedWord varchar(500)='\"'+@word+'\\+\"'\n\n  Select          \n  [Id] ,\n[Content] ,    \n[UserId],    \n [VoteCount],\n [IsOpen],\n [Deleted],\n [RowVersion],    \n [CreatedBy],     \n [CreatedOn],    \n [UpdatedOn],    \n [UpdatedBy],       \n [CompanyId], \n [DisplayId],\n  [Status]    \n  FROM Feedback            \n  Where CONTAINS(*,@Word)     \n  and CompanyId=@CompanyId\n  END\n GO\n</code></pre>\n"},{"tags":["sql","sql-server-2008","insert","numeric","column"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":92,"score":4,"question_id":13189688,"title":"Insert empty string into INT column for SQL Server","body":"<p>A <code>SAMPLE</code> table has only one column <code>ID</code> of type <code>int</code>, default null.</p>\n\n<p>In Oracle when I do:</p>\n\n<pre><code>  insert into SAMPLE (ID) values ('');\n</code></pre>\n\n<p>the new record is added with blank value. But in SQL Server 2008, when I run the same <code>insert</code> statement, the new record has the value of 0. </p>\n\n<p>Is there a way to force SQL Server 2008 to default blank string to NULL instead of 0 (for numerical type of columns)?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13193627,"title":"SQL - Update causing deadlock error","body":"<p>I'm trying to update a row in a table upon someone viewing the page (it increments the viewed count), however now and then I get a deadlock error, I'm guessing this is due to two or more people trying to update the same row?</p>\n\n<p>The error is:</p>\n\n<pre><code>Transaction (Process ID 60) was deadlocked on lock | communication buffer resources with another process and has been chosen as the deadlock victim. Rerun the transaction.\n</code></pre>\n\n<p>And my SQL is:</p>\n\n<pre><code>UPDATE [ProductDescription] \nSET [ViewCount] = ([ViewCount] + 1) \nWHERE ProductCode = @prodCode \n    AND ApplicationID = @AppID\n</code></pre>\n\n<p>I believe I may need a WITH(NOLOCK)?</p>\n"},{"tags":["sql-server-2008","powershell","smo","database-restore"],"answer_count":3,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":903,"score":1,"question_id":4627325,"title":"SMO restore of SQL database doesn't overwrite","body":"<p>I'm trying to restore a database from a backup file using SMO. If the database does not already exist then it works fine. However, if the database already exists then I get no errors, but the database is not overwritten.</p>\n\n<p>The \"restore\" process still takes just as long, so it looks like it's working and doing a restore, but in the end the database has not changed.</p>\n\n<p>I'm doing this in Powershell using SMO. The code is a bit long, but I've included it below. You'll notice that I do set <code>$restore.ReplaceDatabase = $true</code>. Also, I use a try-catch block and report on any errors (I hope), but none are returned.</p>\n\n<p>Any obvious mistakes? Is it possible that I'm not reporting some error and it's being hidden from me?</p>\n\n<p>Thanks for any help or advice that you can give!</p>\n\n<pre><code>function Invoke-SqlRestore {\n    param(\n        [string]$backup_file_name,\n        [string]$server_name,\n        [string]$database_name,\n        [switch]$norecovery=$false\n    )\n\n    # Get a new connection to the server\n    [Microsoft.SqlServer.Management.Smo.Server]$server = New-SMOconnection -server_name $server_name\n    Write-Host \"Starting restore to $database_name on $server_name.\"\n\n    Try {\n        $backup_device = New-Object(\"Microsoft.SqlServer.Management.Smo.BackupDeviceItem\") ($backup_file_name, \"File\")\n\n        # Get local paths to the Database and Log file locations\n        If ($server.Settings.DefaultFile.Length -eq 0) {$database_path = $server.Information.MasterDBPath }\n        Else { $database_path = $server.Settings.DefaultFile}\n        If ($server.Settings.DefaultLog.Length -eq 0 ) {$database_log_path = $server.Information.MasterDBLogPath }\n        Else { $database_log_path = $server.Settings.DefaultLog}\n\n        # Load up the Restore object settings\n        $restore = New-Object Microsoft.SqlServer.Management.Smo.Restore\n        $restore.Action = 'Database'\n        $restore.Database = $database_name\n        $restore.ReplaceDatabase = $true\n\n        if ($norecovery.IsPresent) { $restore.NoRecovery = $true }\n        Else { $restore.Norecovery = $false }\n\n        $restore.Devices.Add($backup_device)\n\n        # Get information from the backup file\n        $restore_details = $restore.ReadBackupHeader($server)\n        $data_files = $restore.ReadFileList($server)\n\n        # Restore all backup files\n        ForEach ($data_row in $data_files) {\n            $logical_name = $data_row.LogicalName\n            $physical_name = Get-FileName -path $data_row.PhysicalName\n\n            $restore_data = New-Object(\"Microsoft.SqlServer.Management.Smo.RelocateFile\")\n            $restore_data.LogicalFileName = $logical_name\n\n            if ($data_row.Type -eq \"D\") {\n                # Restore Data file\n                $restore_data.PhysicalFileName = $database_path + \"\\\" + $physical_name\n            }\n            Else {\n                # Restore Log file\n                $restore_data.PhysicalFileName = $database_log_path + \"\\\" + $physical_name\n            }\n            [Void]$restore.RelocateFiles.Add($restore_data)\n        }\n\n        $restore.SqlRestore($server)\n\n        # If there are two files, assume the next is a Log\n        if ($restore_details.Rows.Count -gt 1) {\n            $restore.Action = [Microsoft.SqlServer.Management.Smo.RestoreActionType]::Log\n            $restore.FileNumber = 2\n            $restore.SqlRestore($server)\n        }\n    }\n    Catch {\n        $ex = $_.Exception\n        Write-Output $ex.message\n        $ex = $ex.InnerException\n        while ($ex.InnerException) {\n            Write-Output $ex.InnerException.message\n            $ex = $ex.InnerException\n        }\n        Throw $ex\n    }\n    Finally {\n        $server.ConnectionContext.Disconnect()\n    }\n    Write-Host \"Restore ended without any errors.\"\n}\n</code></pre>\n"},{"tags":["sql-server-2008","c#-4.0","xml-parsing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13192852,"title":"How to upload text file data into sqlserver database using c#?","body":"<p>my text file like this.</p>\n\n<pre><code>name :Settings, id :1, preference :Mail\nname:test ,id:2,preference :testMail\n</code></pre>\n\n<p>I need to read that textfile and placed that as records in sqlserver database.</p>\n\n<pre><code>name         id   preference\n settings     1      Mail\n test         2      testMail\n</code></pre>\n\n<p>How to parse that textfile like as above .please tell me </p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13190772,"title":"I want to write a sql query to join between two tables using group by clause with following output","body":"<p>In my database there are two table for orders and orderDetails.</p>\n\n<p>I want to show the column : Custom_Field_CustomerType ,ProductCode,Product Name,order_count,Quantity</p>\n\n<p>I need the \"Total\" quantity summarized for each productcode by Custom_Field_CustomerType</p>\n\n<p>The report will be used to determine the total quantity of each product sold to each custom_field_customertype. Therefore the report will have to add up all the individual quantities sold on each orderid for each individual productid.</p>\n\n<p>I have written following query but not getting proper output    </p>\n\n<pre><code>  SELECT  OrderDetails.productcode,\nOrderDetails.productname,\nSUM(OrderDetails.quantity) as Quantity, \nOrders.Custom_Field_CustomerType ,\nSum (Orders.OrderDetails_Count) as  OrderCount \nFROM \n\nOrderDetails INNER JOIN Orders on OrderDetails.OrderID=Orders.OrderID  \n WHERE Orders.OrderStatus = 'Shipped' AND \n DATEDIFF(dd, Orders.OrderDate, '09/01/2012') &lt;= 0 AND \n DATEDIFF(dd, Orders.OrderDate, '11/01/2012') &gt;= 0  \n  Group by Orders.Custom_Field_CustomerType,OrderDetails.productcode ,\n  OrderDetails.productname\n     ORDER BY Orders.Custom_Field_CustomerType DESC    \n</code></pre>\n"},{"tags":["sql-server-2008","database-backups"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":4160,"score":3,"question_id":2181827,"title":"SQL Server 2008 backup best practices","body":"<p>Without not reason, I lose all my data in my database. Fortunately this is was just test data, but this made me to think what will happen if this was done with a production db. </p>\n\n<p>Ultimately, every developer got a db problem and wan to role-bake the db. We don't do things to protect the db, as we think its a DBA work, but then we got trouble...</p>\n\n<p>What is your backup best practices?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13189760,"title":"Does Sql have any attribute which encrypt while inserting and descrypt while getting data from one column?","body":"<p>I want to know is there any attribute or any way where i want to encrypt one column of my table so whenever i am inserting or updating any row in table the columns encrypt that data automatically and while selecting it decrypt and data and get the value in that column.</p>\n"},{"tags":["sql","sql-server","performance","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":11724333,"title":"SQL Server - joining 4 fast queries gives me one slow query","body":"<p>I have 4 views in my MS Sql Server Database which are all quite fast (less than 2 seconds) and return all less than 50 rows.</p>\n\n<p>BUT when I create a query where I join those 4 views (left outer joins) I get a query which takes almost one minute to finish.</p>\n\n<p>I think the query optimizer is doing a bad job here, is there any way to speed this up. I am tempted to copy each of the 4 views into a table and join them together but this seems like too much of a workaround to me.</p>\n\n<p>(Sidenote: I can't set any indexes on any tables because the views come from a different database and I am not allowed to change anything there, so this is not an option)</p>\n\n<p><strong>EDIT:</strong> I am sorry, but I don't think posting the sql queries will help. They are quite complex and use around 50 different tables. I cannot post an execution plan either because I don't have enought access rights to generate an execution plan on some of the databases.</p>\n\n<p>I guess my best solution right now is to generate temporary tables to store the results of each query.</p>\n"},{"tags":["c#","asp.net","sql-server-2008","ms-word","vsto"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":687,"score":3,"question_id":9875134,"title":"Edit Saved Microsoft Word Document in C#/Asp.net","body":"<p>I am not sure if this is possible and every where I have searched, I cannot find a clear answer.  I am saving a Microsoft Word document to a SQL Server 2008 table.  Basically just converting the file to a <code>Byte[]</code> and writing that to the table.  This word document is a \"template\" file.  The file is a form that the user needs to fill out.  What I am wondering, is after reading that file from SQL Server and before opening it up for the user, is there a way to autopopulate some fields in the form for the user?  For example, if I know the address of the user already, can I autopopulate the address field in the template for them?</p>\n\n<p>I know that using <code>Microsoft.Office.Interop.Word</code>, I can search the document for bookmarks and insert data at the bookmark.  However, as far as I know, you cannot use <code>Microsoft.Office.Interop.Word</code> to open a <code>Byte[].</code></p>\n\n<p>Is there anyway to complete what I was looking for?</p>\n"},{"tags":["database","sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13188121,"title":"Creating a local database SQL Server 2008 R2","body":"<p>I would like to create a local database in SQL Server 2008 R2.</p>\n\n<p>I tried entering in the server name <code>myComputerName\\SQLEXPRESS</code> and also <code>(local)\\SQLEXPRESS</code> (windows authentication) but I keep getting an error that the server is not found.</p>\n\n<p>What is the problem?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13189706,"title":"SQL Server, how to display (square) ^2 as in column heading?","body":"<p>Please guide me how to display m2 (m with 2 as square small on top of m) in column heading ?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008","index","normalization","database-performance"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13189237,"title":"Normalize a database - optimization","body":"<p>I have some kind of project in the university, about sql server.</p>\n\n<p>We need to normalize a database, migrating all data.</p>\n\n<p>The original db is a \"master\" table, with about 39 fields. We need to create all tables, and then scanning this master table (about 700.000 rows) inserting the data where it belongs.</p>\n\n<p>I have a problem of performance. In new machines, it runs fast, but in my case (having ubuntu, using a vm of windows xp, so I have lower recurses than the machines of my team partners) runs much slower.</p>\n\n<p>So, we want to improve performance, because we don't know in which machines will be tested.</p>\n\n<p>We think on indexing master table, but the problem is that almost all fields are nvarchar(255) or numeric(18,2).</p>\n\n<p>Is good to index that fields? We must do inserts in almost 15 tables, so each insert is scanning all master table, getting the information.</p>\n\n<p>Is there any other thing useful instead of index ? We thought also in create different views, for optimize the selects.</p>\n\n<p>it's homework, but the tag says \"Do not use\".</p>\n\n<p>Any orientation will be apreciated</p>\n\n<p><strong>Update 1</strong></p>\n\n<p>this is one of the querys.\nBefore you hate me, I DIDN'T DO THIS, with the old-syntax style. (was one of my parters)</p>\n\n<pre><code>insert into LITTLE_BOBBY_TABLES.Proveedor\nSELECT DISTINCT U.idUsuario, C.idCiudad,R.idRubro, M.Provee_RS,M.Provee_CUIT, '', M.Provee_Telefono, M.Provee_Dom, REPLACE(REPLACE(REPLACE(M.Provee_RS, 'N°',''), '.R.L.', ''), ' ', ''), ''   \nFROM gd_esquema.Maestra M, LITTLE_BOBBY_TABLES.Usuario U, LITTLE_BOBBY_TABLES.CIUDAD C, LITTLE_BOBBY_TABLES.Rubro R\nWHERE U.Username=REPLACE(REPLACE(REPLACE(M.Provee_RS, 'N°',''), '.R.L.', ''), ' ', '')\nAND C.Nombre=M.Provee_Ciudad\nAND R.Nombre=M.Provee_Rubro;\n</code></pre>\n\n<p>Maestra is the master Table. The another are the tables where it inserts. Inserts the U.idUsuario(created for each person previously), some more id's joined, and  the replace are because we need to create an user Name replacing some strings in the Field Provee_RS. The username is generated before.</p>\n\n<p>I run the Execution plan, the %85 was in the scanning of Master Table</p>\n\n<p><img src=\"http://i.stack.imgur.com/WjO5p.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Update 2</strong></p>\n\n<p>in this query, scanning gd_Esquema.Maestra takes %97 according execution plan.</p>\n\n<pre><code>insert into LITTLE_BOBBY_TABLES.CuponFactura\nselect m.Factura_Nro, cc.IdCompraCupon\nfrom LITTLE_BOBBY_TABLES.CompraCupon cc\njoin LITTLE_BOBBY_TABLES.Cliente c on c.idUsuario = cc.IdCliente\njoin LITTLE_BOBBY_TABLES.Promocion p on p.IdPromocion = cc.IdPromocion\njoin gd_esquema.Maestra m on \n                m.Cli_Nombre = c.Nombre and\n                m.Cli_Apellido = c.Apellido and\n                m.Groupon_Codigo = p.CodigoPromocion and\n                m.Groupon_Fecha_Compra = cc.Fecha and\n                m.Factura_Fecha is not null\n</code></pre>\n\n<p>so, how efficiently could be create index in this type of fields ? Are there any other technique for better optimization that I'm missing?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13186879,"title":"Querying data groups with total row before starting next group?","body":"<p>I need to query some data in the below format in SQL Server:</p>\n\n<ul>\n<li>Id   Group   Price </li>\n<li>1    A   10</li>\n<li>2    A   20 </li>\n<li><p><strong>Sum    30</strong> </p></li>\n<li><p>1    B   6</p></li>\n<li>2    B   4 </li>\n<li><p><strong>Sum    10</strong> </p></li>\n<li><p>1    C   100</p></li>\n<li>2    C   200 </li>\n<li><strong>Sum    300</strong> </li>\n</ul>\n\n<p>I was thinking to do it in the follwoing steps:</p>\n\n<ol>\n<li>Query one group</li>\n<li>In other query do sum</li>\n<li>Use Union operator to combine this result set</li>\n<li>Do step 1-3 for all groups and finally return all sub sets of data using union.</li>\n</ol>\n\n<p>Is there a better way to do this ? May be using some out of box feature ? Please advise.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>As per suggestions and code sample I tried this code:</p>\n\n<pre><code>Select \nCase \nwhen id is null then 'SUM' \nelse CAST(id as Varchar(10)) end as ID,\n\nCase when [group] is null then 'ALL' else CAST([group] as Varchar(50)) end as [group]\n,Price from\n(\nSELECT Id,  [Group],BGAApplicationID,Section, SUM(PrimaryTotalArea) AS price   \nFROM vwFacilityDetails\nwhere bgaapplicationid=1102\nGROUP BY Id,  [Group],BGAApplicationID,Section  WITH ROLLUP\n) a\n</code></pre>\n\n<p>And Even this code as well:</p>\n\n<pre><code>Select Id,  [Group],BGAApplicationID,Section, SUM(PrimaryTotalArea) AS price           \nFrom   vwFacilityDetails\nWhere  Not ([group] Is Null And id Is Null And BGAApplicationId is null and section is null) and BGAApplicationId=1102\nGroup By Id,  [Group],BGAApplicationID,Section \n    With Rollup\n</code></pre>\n\n<p>In results it groups up the data but for every record it shows it 3 times (in both above codes) like:</p>\n\n<ul>\n<li>2879 Existing Facilities Whole School    25.00</li>\n<li>2879 Existing Facilities Whole School    25.00 </li>\n<li>2879 Existing Facilities    Whole School 25.00 </li>\n<li>2879 ALL 25.00</li>\n</ul>\n\n<p>I guess there is some issue in my query, please guide me here as well.\nThanks</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":27,"score":-1,"question_id":13187026,"title":"How can I prevent user from updating a Sql server table","body":"<p>Just encountered an issue today and need urgent help! (sorry about that)\nwe have a table in our database that we dont want user to be able to update its data manually or by running a script, not even an SA user</p>\n\n<p>Is there anyway I can have a specific user that is able to edit the table data but SA users cannot?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","azure","sql-azure","context-info"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":11722846,"title":"Replacement of Context_Info SQL Azure","body":"<p>I am currently using the CONTEXT_INFO property of the Master database for storing the logged in username to use it later in Table Triggers for auditing.</p>\n\n<p>While migrating to SQL Azure, the issue of Cross-Database connections popped and I couldn't find direct solutions to this issue.</p>\n\n<p>Following are the Issue Details:</p>\n\n<ol>\n<li>I call Stored Procedure XXX from Data Access Layer and pass the Username as Parameter</li>\n<li>The username is used to set the CONTEXT_INFO value in XXX</li>\n<li>The CONTEXT_INFO value is then used in Tables Insert/Update/Delete Triggers to Store Username for Application Auditing</li>\n</ol>\n\n<p>Solutions that I found so far:</p>\n\n<ol>\n<li>Create Table In Database to work as CONTEXT_INFO</li>\n<li>Use 2 Connection Strings in Data Access Layer, one for Master Database (to set CONTEXT_INFO) and the other is for the application and execute the SET CONTEXT_INFO each time before opening the connection to my application</li>\n</ol>\n\n<p>But I find both solutions risky, specially when expanding the Database over multiple SQL Azure Databases in the future.</p>\n\n<p>Appreciate your support.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","jobs"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":175,"score":2,"question_id":12249056,"title":"Executing SQL Server Agent Job from a stored procedure and returning job result","body":"<p>Need to have a stored procedure that calls a SQL Server Agent Job and returns whether or not the job ran successfully or not.</p>\n\n<p>So far I have<br></p>\n\n<pre><code>CREATE PROCEDURE MonthlyData\nAS\nEXEC msdb.dbo.sp_start_job N'MonthlyData'\n\nWAITFOR DELAY '000:04:00'\n\nEXEC msdb.dbo.sp_help_jobhistory @job_name = 'MonthlyData'\nGO\n</code></pre>\n\n<p>Which starts the job, whats the best way to get back if the job ran successfully or not?</p>\n\n<p>Ok made an edit and used WAITFOR DELAY as the job normally runs between 3-4 mins never longer than 4. Does the job but is there a more efficient way to do it?</p>\n"},{"tags":["c#","sql-server-2008","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":5842118,"title":"Store dimensions (along with image) in database columns?","body":"<p>I must store my images in varbinary(max) fields in a SQLServer 2008 database (file system is not an option in my environment).</p>\n\n<p>I'd like to be able to set image and height properties on HTML image tags when I serve these up (in my MVC2 app) and do different things in a gallery depending on portrait vs landscape orientation. </p>\n\n<p>So, from your experience, would it be worth the hassle (and de-normalization?) to  store this information in separate columns of the database, or is just cheap enough, performance-wise, to grab height &amp; width &amp; calculate orientation on the fly?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-agent-job"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":690,"score":4,"question_id":10088427,"title":"How to pass a parameter to a SQL Job that will execute a stored procedure","body":"<p>I have the below code (only the portion that is needed)</p>\n\n<pre><code>EXEC @ReturnCode = msdb.dbo.sp_add_jobstep @job_id=@jobId, @step_name=N'SomeStep', \n        @step_id=1, \n        @cmdexec_success_code=0, \n        @on_success_action=1, \n        @on_success_step_id=0, \n        @on_fail_action=2, \n        @on_fail_step_id=0, \n        @retry_attempts=0, \n        @retry_interval=0, \n        @os_run_priority=0, @subsystem=N'TSQL', \n        @command=N'exec [dbo].[PORT_Insert_Record] ''https://localhost''',  \n        @database_name=N'MyDatabase', \n        @flags=0\n</code></pre>\n\n<p>Now, I want to pass the <code>https://localhost</code> value into a variable and pass to the stored procedure (for some reason I cannot pass it inside the SP).</p>\n\n<p>So I tried </p>\n\n<pre><code>DECLARE @domainName varchar(max)\nDECLARE @sp varchar(max)\nSET @domainName ='https://localhost:'\nSET @sp ='exec [dbo].[PORT_Insert_Record]' + @domainName\n\nEXEC @ReturnCode = msdb.dbo.sp_add_jobstep @job_id=@jobId, @step_name=N'InsertRecordIntoResellerOpportunities', \n        @step_id=1, \n        @cmdexec_success_code=0, \n        @on_success_action=1, \n        @on_success_step_id=0, \n        @on_fail_action=2, \n        @on_fail_step_id=0, \n        @retry_attempts=0, \n        @retry_interval=0, \n        @os_run_priority=0, @subsystem=N'TSQL', \n        @command=@sp,  \n        @database_name=N'MyDatabase',  \n        @flags=0\n</code></pre>\n\n<p>but it is not working. I also search in the net for any idea/syntax etc.. but no luck as of now.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","database","sql-server-2008","schema"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":37,"score":1,"question_id":13184518,"title":"How to implement a schema with primary and foreign keys","body":"<p>I am trying to create relationships for my database tables, I developed a simple airline reservation system but I'm getting confused on how to get it right. My aim is to come up with a schema that shows primary keys and foreign keys.</p>\n\n<p>This is my database below</p>\n\n<p><img src=\"http://i.stack.imgur.com/YhOF6.png\" alt=\"enter image description here\"></p>\n\n<p>What am I missing it seems I do not have many foreign keys and a relationship diagram seems not to have connection because of that</p>\n\n<ul>\n<li>the Plist is a passenger list tables </li>\n<li>canreq is a cancel request table</li>\n<li>reg is the registration table</li>\n<li>fares is the fares table</li>\n<li>pid is a passenger id table</li>\n<li>schedule is a schedule table</li>\n</ul>\n"}]}
{"total":21073,"page":4,"pagesize":100,"questions":[{"tags":["visual-studio-2010","linq","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":12,"score":0,"question_id":13184343,"title":"Weekly Performance Chart - ASP.NET","body":"<p>I'm trying to make a bar chart and using LINQ but I don't have any idea how to get weekly performance percent.</p>\n\n<p>I have a database that keeps daily goals and every mission has its own score(0-10) and start date, finish date also connected with UserID. I have to make a bar chart that displays user, week and week's performance rate (%). But I have no clue how to calculate \"that week's rating\" and bind it to chart. </p>\n\n<p>Any suggestions?</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures","stored-functions","sql-function"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13173989,"title":"Convert stored procedure to table-valued query","body":"<p>I have this procedure</p>\n\n<pre><code>ALTER PROCEDURE [dbo].GetHerdByUserProc(@user int)\nAs \n    begin\n        Declare\n            @GroupId uniqueidentifier,\n            @UserTrade bit\n\n        Set @GroupId = (select tbUser.group_id from tbUser where Userid = @user)\n        Set @UserTrade = (select tbUser.isTrade from tbUser where Userid = @user)\n        if @GroupId IS NOT NULL and @UserTrade = '1'\n        Begin \n            select HerdId from tbUserHerds where tbUserHerds.UserId in (select Userid from tbUser where tbUser.Group_Id = @GroupId)\n            return;\n        END\n        If @GroupId IS NOT NULL\n        Begin   \n            select HerdId from tbUserHerds where tbUserHerds.UserId = @user\n            return;\n        End\n        return;\n    End\n</code></pre>\n\n<p>It returns a list correctly except I would also like to run a query on the list that is returned and as far as I am aware I cannot write a query such as</p>\n\n<pre><code>Select * from GetHerdByUserProc 80\n</code></pre>\n\n<p>So I am looking the best way to convert this to a table-valued query.</p>\n\n<p>I have changed the alter to say <code>'Create Function x(@user int) Returns Table As'</code></p>\n\n<p>But that does not seam to work it starts screaming errors at me.</p>\n\n<p>Any ideas?  The Database Server is MSSQL2008</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13176954,"title":"Sql Server union with If condition","body":"<p>I have a query like:</p>\n\n<pre><code>DECLARE @tmpValue\nSET @tmpValue = 0 -- it will be change \n\nSELECT * FROM Animal WHERE AniActive = 1\nUNION \nIF @tmpValue &gt; 0 \nSELECT * FROM Animal WHERE.Active = 0\n</code></pre>\n\n<p>When I use like this it is giving error because of if condition. I have to use UNION because of our structure. </p>\n\n<p>How can I use it with if condition?</p>\n\n<p>Thanks, <br/>\nJohn</p>\n"},{"tags":["sql-server-2008","toad","redgate"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13183087,"title":"RedGate search for TOAD?","body":"<p>I'm using MS SQL 2008 R2 with RedGate SQL Search. Recently I installed TOAD (free version). It looks okay and I can use it instead MSSMS, but it doesn't have RedGate Search, which I used to use. So now I use MSSMS and TOAD at the same time. I didn't find RedGate Search for TOAD. So it's impossible to use them together?</p>\n\n<p><strong>EDIT:</strong> I mean maybe I can use some other tool for TOAD instead RedGate?</p>\n"},{"tags":["sql-server-2008","ssms2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13183203,"title":"sqlcmd mode from SSMS - setvar assignment to a substitution variable possible?","body":"<p>I'm running this from SSMS 2008R2 with SQLCMD Mode enabled.</p>\n\n<p>With the code below:</p>\n\n<pre><code>:SETVAR GREETING \"HELLO\"\n:SETVAR SALUTATION $(GREETING)\n\nSELECT '$(GREETING)'\nSELECT '$(SALUTATION)'\n</code></pre>\n\n<p>I see the following in the results:</p>\n\n<pre><code>HELLO\n$(GREETING)\n</code></pre>\n\n<p>I was hoping to see:</p>\n\n<pre><code>HELLO\nHELLO\n</code></pre>\n\n<p>Is there a way to have a scripting variable in the assignment of another scripting variable?  If so, what is the syntax?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13183082,"title":"paginating table and getting row count","body":"<p>The query below fetches a subset of rows from a table starting at row 10 and ending at row 20. In addition, to save a query I need to return the total number of rows in the table. This is the best solution that I could think of. Are there any more efficient/elegant ways? In particular, I do not like the <code>partition by 1</code> part.</p>\n\n<pre><code>select *\nfrom (select count(*) over (partition by 1) as [count],\n             row_number() over (order by [Name],[Description]) as [row],\n             *\n      from [Products]) as t\nwhere row between 10 and 20\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":13180086,"title":"Call a SQL function in a query","body":"<p>I have an issue with a function in SQL Server 2008, if I execute a query with a function, it takes like 40 secs, if I remove the function and I add the logic of the function in the query, is 0 secs!</p>\n\n<p>Anybody can explain me the reason of why using a function could be so slow? I really want to use the function to encapsulate the logic but I don't find the way of...</p>\n"},{"tags":["sql-server-2008","powershell","connection","powershell-remoting"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":495,"score":1,"question_id":4913638,"title":"Connect to sql server via transitional computer issue, login failed for NT AUTHORITY\\ANONYMOUS LOGON","body":"<p>I have SQL Server 2008 to which I can connect using domain user credentials. There are many computers in the network and if I login under that domain user I can successfully connect to SQL Server (using Windows Authentication).</p>\n\n<p>The problem is when I use PowerShell remoting and establish remote session from computer A to computer B. When I run our <code>dbtool</code> that tries to connect to SqlServer (in remote session) \"<code>login failed for NT AUTHORITY\\ANONYMOUS LOGON</code>\" error occurs.</p>\n\n<p>It's strange, because I establish remote session under same domain user. Why <code>ANONYMOUS</code> is being passesd to SqlServer?</p>\n\n<p>Thanks for help</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13180231,"title":"Migrating DB from SQL 2005 Enterprise to SQL 2008 Standard","body":"<p>I'm attemtping to migrate a DB from SQL 2005 Enterprise to SQL 2008 Standard.  I've run into an issue because there is a Partition Function defined in the DB of the Enterprise edition.  I know Standard edtiions do not support Partition Functions. Upgrading the version of SQL im migrating to Enterprise isn't an option.</p>\n\n<p>I'm looking for a way to remove the partition function without causing any negative effects to the DB currently so I can migrate it to the 2008 Standard Edition.</p>\n\n<p>Any help would be greatly appreciated. Thanks!</p>\n\n<p>MOVED to dba.stackexchange.com. </p>\n"},{"tags":["sql-server","tsql","sql-server-2008","sqlcompare"],"answer_count":9,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1182,"score":3,"question_id":3012544,"title":"T-SQL - Is there a (free) way to compare data in two tables?","body":"<p>I have <code>table a</code> and <code>table b</code>. (SQL Server 2008)</p>\n\n<p>Both tables have the exact same schema.</p>\n\n<p>For the purposes of this question, consider <code>table a</code> = my local dev table, <code>table b</code> = the live table.</p>\n\n<p>I need to create a SQL script (containing <code>UPDATE/DELETE/INSERT</code> statements) that will update table b to be the same as table a. This script will then be deployed to the live database.</p>\n\n<p>Any free tools out there that can do this, or better yet a way I can do it myself?</p>\n\n<p>I'm thinking I probably need to do some type of a join on all the fields in the tables, then generate dynamic SQL based on that.</p>\n\n<p>Anyone have any ideas?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Okay, thought I'd clarify this question a little.</p>\n\n<p>The table I need to synchronize is a simple look-up table. The data is very simple and straightforward.</p>\n\n<p>Here's an idea of what <code>TABLE A</code> might look like:</p>\n\n<pre><code>IdFoo          Activity      IsFoo\n1              Foo           1\n2              Bar           0\n</code></pre>\n\n<p>Here's an idea of what <code>TABLE B</code> might look like:</p>\n\n<pre><code>IdFoo          Activity      IsFoo\n1              Foo           1\n2              Bar           1\n</code></pre>\n\n<p>Basically, all I want to do is update that <code>BIT</code> column (<code>IsFoo</code>) in <code>TABLE B</code> to match the corresponding value in <code>TABLE A</code> for the same IdFoo.</p>\n\n<p>Keep in mind:</p>\n\n<ul>\n<li><code>TABLE A</code> is on my local machine</li>\n<li><code>TABLE B</code> is on the live server</li>\n</ul>\n\n<p>Obviously I have a (reliable) backup of <code>TABLE B</code> on my local machine which i need to script against, then run the script on the live server.</p>\n\n<p>The table also has referential integrity (other columns I didn't show). Which means I can't just delete everything in <code>TABLE B</code> and do an insert from <code>TABLE A</code>.</p>\n\n<p>This script will be a once off. So no need to do things like linked server, replication, etc. Appreciate the answers though guys. =)</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Ok - so I've gone with Oleg's answer (VS2010 Data Compare). Quick, easy, and works a charm.</p>\n\n<p>Not to say the other answers are incorrect. I appreciate all the answers!</p>\n"},{"tags":["sql-server-2008","tsql","join","rownumber"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13175412,"title":"Return rows around row with a certain value with joins","body":"<p>I have fairly complicated join query from which I want to select a few rows around a result with a certain id.</p>\n\n<p>The query currently looks something like this:</p>\n\n<pre><code>WITH results AS \n  (\n    SELECT t1.id,  t1.position, t1.points, t2.name\n      ROW_NUMBER() OVER(ORDER BY t1.position ASC, t1.points DESC) AS rn\n      FROM Table1 t1\n      JOIN Table2 t2 ON t1.id = t2.Table1id\n      /* Several more joins here, some of which limit the result set */\n  )\nSELECT * FROM results\nWHERE rn &lt; ( SELECT rn+3 FROM results WHERE  id = @someid ) \nAND rn &gt; ( SELECT rn-3 FROM results WHERE id = @someid )\n</code></pre>\n\n<p>Is there a better way to solve this? Most of all I'm worried about performance with these multiple calls to a possibly huge CTE. </p>\n\n<p>The query is run on a <strong>SQL 2008</strong> server.</p>\n"},{"tags":["asp.net","sql-server-2008","iis7"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13180127,"title":"Sql Server Linked Server Issue \"Login failed for user 'NT AUTHORITY\\ANONYMOUS LOGON'","body":"<p>I have a domain user on both linked server and server which is referring the linked server.\nSame domain user is added to the pool identity of web supplication ( asp.net).\nWhat is happening, that application is successfully accessing the local DB and all data is coming fine. But when application try to access the stored procedure which is calling linked server it shows the following error \n\"Login failed for user 'NT AUTHORITY\\ANONYMOUS LOGON\"</p>\n\n<p>But more annoying is that it does not fail always, if someone is logged into SSMS web application can fetch this data but if he log off from the server ,after some time this error start appearing.</p>\n\n<p>It works fine when we have sql server 2008 R2 on both servers (linked and one using the linked  server) and windows 2008.\nBut fails when we have windows 2003 server and sql 2005( db from this is used a linked) , and sql server 2008 on windows server 2008</p>\n"},{"tags":["database","sql-server-2008","datagridview","dataset"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":31,"score":3,"question_id":13157891,"title":"Bit datatype to enum type mapping from database to dataset in SQL Server 2008","body":"<p>I have a table which has a column <code>Xyz</code> and it has <code>bit</code> datatype in SQL Server 2008.</p>\n\n<p>I'm getting the values from the table through data adapter and I'm storing it in a <code>DataSet</code> and a <code>DataGridView</code> will show the contents from the <code>DataSet</code></p>\n\n<p>In the gridview, for column <code>Xyz</code>, a check_box with/without tick is displayed but I want to display it as a buy/sell as a text instead of checkbox.</p>\n"},{"tags":["c#","sql-server-2008","enumerations"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":163,"score":1,"question_id":10132968,"title":"How to Enumerate SQL Server Instances","body":"<p>I´d like to have my application return instances of SQL Server 2008 R2 Developer/Express. </p>\n\n<p>I´m using:</p>\n\n<pre><code>System.Data.DataTable lokalni_servery = Microsoft.SqlServer.Management.Smo.SmoApplication.EnumAvailableSqlServers();\n\nforeach (System.Data.DataRow row in lokalni_servery.Rows)\n{\n    local_servers.Items.Add(row[\"Server\"].ToString());\n}\n</code></pre>\n\n<p>On my friend´s notebook with SQL Server 2008 R2 express 32 bit, it doesn´t find anything, but on my notebook with SQL Server 2008 R2 Developer 64 bit, it finds it almost everytime. \nI need to be able to find this instance of SQL on both machines.</p>\n\n<p>Does anybody know why the application is behaving like this? </p>\n\n<p>Is there a way to alter the method allowing for both notebooks to find the instance?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":13174399,"title":"Coalesce vs Case","body":"<p>I have 5 fields which are bringing back a mixture of values and NULLS. For reporting purposes I need to replace any potential NULLS with a value. The database that I am interrogating is updated nightly via an SSIS package.</p>\n\n<p>Obviously I will need to alter the .dtsx file to stop NULLS being brought through each day by adding some SQL.</p>\n\n<p>My question is:</p>\n\n<p>What is the most efficient way of dealing with these NULLS in terms of performance. So far ive identified <code>COALESCE</code> and <code>CASE</code> to deal with them and im leaning towards <code>COALESCE</code> because my alternative to <code>NULL</code> is not going to change, but I would be interested to hear if and why this would be the most efficient method.</p>\n"},{"tags":["vb.net","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":59,"score":3,"question_id":13168909,"title":"When inserting new columns in a datatable in VB 2010, how do I update the SQL Server 2008 Database?","body":"<p>Using VB 2010 and SQL Server 2008:</p>\n\n<p>I am able to insert new rows, delete rows, and update data in a datatable, and use a data adapter to update the database without any issues. When I try to add new columns, the column appears in the data table, but it does not update to the database. I currently am using the DataAdapter.Update(DataTable) Method.</p>\n\n<p>My code is as follows:</p>\n\n<pre><code>Dim dcNewColumn As New DataColumn\ndcNewColumn.ColumnName = strClassColumnName\nm_DataTable.Columns.Add(dcNewColumn)\nm_DataTable.Row(intCurrentRow).Item(strClassColumnName) = strClassName\ndcNewColumn = Nothing\n\nm_DA.Update(m_DataTable)\n</code></pre>\n\n<p>Is there a different method to updating the database when inserting new columns?</p>\n"},{"tags":["sql-server-2008","tsql","computed-columns"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13173183,"title":"Find SQL Server 2008 computed column dependency","body":"<p>I want to search whether a columns is participating in a computed column expression. </p>\n\n<p>I came up with this </p>\n\n<pre><code>SELECT \n    (select name \n     from sys.columns \n     where column_id = sys.sql_expression_dependencies.referencing_minor_id \n     and object_id = sys.sql_expression_dependencies.referencing_id) as [dependant_column]\nFROM sys.sql_expression_dependencies\nWHERE referencing_minor_id &gt; 0 \n    and referencing_class = 1 \n    and referenced_class = 1 \n    and object_name(referencing_id) = 'trns1'\n    and referenced_minor_id = (select column_id \n                           from sys.columns \n                           where name = 'class1' \n                           and OBJECT_NAME(object_id) = 'trns1')\n</code></pre>\n\n<p>Please help.</p>\n"},{"tags":["c#","sql","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13177612,"title":"Does select query change column data value if we use \"set\" in it","body":"<p>In reference to my <a href=\"http://stackoverflow.com/questions/13176567/temporary-sql-datafield/13177257#13177257\">Previous Question</a> someone said in select query if I set a column data value for a table it won't going to update columns value in my table within a stored procedure, is that's right?</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13178457,"title":"How to set and return a column Value in SQL Stored Procedure within If else statement","body":"<p>In reference to my <a href=\"http://stackoverflow.com/questions/13176567/temporary-sql-datafield/13177257#13177257\">Previous Question</a> I am not sure how can I set and then return a column data value with out saving it to table.</p>\n\n<pre><code>if @datafield = 1\nset ColumnA.table2=1\nelse if @datafield = 2 AND @datafield2 = 3\nset ColumnA.table2= 0\nelse\nreturn (SELECT ColumnA.table2 FROM table1 INNER JOIN table2 on table1.id and table2.id Where @datafield3 = 0)\n</code></pre>\n\n<p>I am not sure how to return after setting values, I did tried begin and end , not working tho</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13178443,"title":"fileupload value is not saving in database","body":"<pre><code>    SqlConnection con = new SqlConnection();\n    SqlCommand cmd = new SqlCommand(\"insert into Tbl_Videos(VideoName,VideoPath)values(@VideoName,@VideoPath)\");\n\n    string fileExt = System.IO.Path.GetExtension(FileUpload1.FileName);\n\n    if (fileExt == \".avi\")\n    {\n        try\n        {\n            FileUpload1.SaveAs(Server.MapPath(\"~/video/\" +FileUpload1.FileName));\n            Label1.Text = \"File name: \" +\n            FileUpload1.PostedFile.FileName + \"&lt;br&gt;\" +\n            FileUpload1.PostedFile.ContentLength + \" kb&lt;br&gt;\" +\"Content type: \"+FileUpload1.PostedFile.ContentType;\n           cmd.Parameters.AddWithValue(\"@VideoName\",FileUpload1.FileName);\n            cmd.Parameters.AddWithValue(\"@VideoPath\", FileUpload1.FileName);\n            cmd.ExecuteNonQuery();\n        }\n        catch (Exception ex)\n        {\n            Label1.Text = \"ERROR: \" + ex.Message.ToString();\n        }\n    }\n    else\n    {\n        Label1.Text = \"Only .avi files allowed!\";\n    }\n\n}\n</code></pre>\n"},{"tags":["php","sql","sql-server-2008","database-connection","connect"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":69,"score":3,"question_id":13028538,"title":"sqlsrv_connect() keep connection in application pool active","body":"<p>I have a php script that connects to a local SQL server database through sqlsrv_connect.</p>\n\n<pre><code>  $serverName = \"127.0.0.1\\MSSQLSERVER\";\n  $userName = 'username';\n  $userPassword = 'pass';\n  $dbName = \"name\";\n  $connectionInfo = array(\"database\"=&gt;$dbName,\n                              \"UID\"=&gt;$userName,\n                              \"PWD\"=&gt;$userPassword, \n                              \"MultipleActiveResultSets\"=&gt;true,\n                              \"ConnectionPooling\"=&gt;true);\n\n  sqlsrv_configure('WarningsReturnAsErrors', 0);\n\n  $this-&gt;connection = sqlsrv_connect( $serverName, $connectionInfo);\n</code></pre>\n\n<p>The first time that i load the website this code under is executing in about 1.5sec</p>\n\n<pre><code>$this-&gt;connection = sqlsrv_connect( $serverName, $connectionInfo);\n</code></pre>\n\n<p>If i reload the page the execution time for the same line is 0.0012 - 0.0020sec (much faster)</p>\n\n<p>If i wait for lets say for 10 minutes and try to reload the page again the execution time for connect is over 1sec</p>\n\n<p>Is there anything i can do to keep the connection \"active\" so to make the <code>sqlsrv_connect</code> runs faster? </p>\n\n<ol>\n<li>IIS Application pool idle shutdown is disable</li>\n<li>MSSQL Server connection timeout is 0</li>\n</ol>\n\n<p>Thanks in advance</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":54,"score":4,"question_id":13177765,"title":"Regarding get automatic columns in sql`","body":"<p>I have basically 50 fields in a table and I want to select this fields from table on a regular basis.</p>\n\n<p><strong>Problem is</strong>: I have to write all this 50 fields manually.</p>\n\n<p>Is there any shortcut in intellisence or any other tool where I can get all fields. automatically by pressing tool.</p>\n\n<p>Also guys if anyone knows here extra addons on sql..then please post it here.</p>\n"},{"tags":["sql-server","sql-server-2008","powershell","powershell-v2.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13152809,"title":"Invoke-SqlCmd QueryTimeout","body":"<p>Does anyone know how to set Invoke-SqlCmd QueryTimeout more than 65535? </p>\n\n<p>Microsoft said that they have fixed it in Denali but we are still using SQL 2008 R2 with latest service packs.</p>\n\n<p><a href=\"http://connect.microsoft.com/SQLServer/feedback/details/551799/invoke-sqlcmd-querytimeout-0-still-times-out\" rel=\"nofollow\">http://connect.microsoft.com/SQLServer/feedback/details/551799/invoke-sqlcmd-querytimeout-0-still-times-out</a></p>\n\n<p>Basically, we are trying to backup or restore the database using powershell. Some of our databases are very large so it takes more than 65535 to complete the job. </p>\n\n<p>Some suggested that we should use ADO.NET with timeout in powershell. But I wonder if we have any workaround for Invoke-SqlCmd...</p>\n"},{"tags":["sql-server-2008","reporting-services","subreports"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1908,"score":1,"question_id":7947454,"title":"Reporting Services: multiple subreports in one report","body":"<p>in my project there are three reports - Main Report and two subreports, each with its own dataset (the only column common to all the datasets is ItemID). The Main Report passes ItemID as parameter to each of its two subreports.</p>\n\n<p>The Main Report is built in a form-like layout, i.e. I use the List control and arrange the Main Report fields inside the List body. (I need to show only one record each time, so I chose List and not Table or Matrix.)</p>\n\n<p>If I add one of the subreports to the Main Report body (i.e. inside the List body), it works just fine. But if I try to add the other subreport to the Main Report, the data is shown only in the subreports while the fields of the Main Reports are empty (no data from the dataset of the Main Report is shown). I can't understand why it happens.</p>\n\n<p>What could be the problem here? </p>\n\n<p>I'll appreciate any help.</p>\n"},{"tags":["vb.net","sql-server-2008","select","if-statement"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":13173909,"title":"Select mysql if true then update, else insert","body":"<p>I Need an check if ID is already in the database, if that is true: Update values Longitude, Latitude, Timestamp. If not then insert all in the database.</p>\n\n<p>My script now is:</p>\n\n<pre><code>&lt;%@ Import Namespace=\"System.Data\"%&gt;   \n&lt;%@ Import Namespace=\"System.Data.SqlClient\"%&gt;   \n&lt;%@ Import Namespace=\"System.Reflection\"%&gt;\n&lt;%@ Page Language=\"VB\" %&gt;  \n&lt;script runat=\"server\"&gt;  \n\n\n    Dim Con As New SqlConnection\n    Dim Cmd As New SqlCommand\n    Dim SQLCommand As String = \"\"\n    Dim Reader As SqlDataReader\n\nProtected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load\n    If Not String.IsNullOrEmpty(Request.QueryString(\"data\")) Then\n        Dim data As String = Request.QueryString(\"data\")\n\n        Dim myObj As New MyObject\n        Dim properties() As PropertyInfo = myObj.GetType().GetProperties()\n        Dim values() As String = Server.UrlDecode(data).Replace(\"{\", \"\").Replace(\"}\", \"\").Replace(\"\"\":\"\"\", \"\"\"=\"\"\").Split(New Char() {\",\"}, StringSplitOptions.RemoveEmptyEntries)\n        For Each value As String In values\n            Dim keyValue() As String = value.Split(New Char() {\"=\"}, StringSplitOptions.RemoveEmptyEntries)\n            For Each prop As PropertyInfo In properties\n                If prop.Name.ToLower = keyValue(0).ToLower.Replace(\"\"\"\", \"\") Then\n                    prop.SetValue(myObj, keyValue(1).Replace(\"\"\"\", \"\"), Nothing)\n                End If\n            Next\n        Next\n\n        myObj.Save()\n        lblText1.Text = String.Format(\"ID: {0}\", myObj.ID)\n        lblText2.Text = String.Format(\"Longitude: {0}\", myObj.Longitude)\n        lblText3.Text = String.Format(\"Latitude: {0}\", myObj.Latitude)\n        lblText4.Text = String.Format(\"Timestamp: {0}\", myObj.Timestamp)\n\n\n'cmd.Parameters.AddWithValue(\"@ID\", ID)\n'cmd.Parameters.AddWithValue(\"@Longitude\", Longitude)\n'cmd.Parameters.AddWithValue(\"@Latitude\", Latitude)\n'cmd.Parameters.AddWithValue(\"@Timestamp\", Timestamp)\n\n'Con.ConnectionString = \"Data Source=sr04011389\\sql02;Initial Catalog=LocatieBepaling_Ontw;Integrated Security=True\"\n    'Cmd.Connection = Con\n    'Con.Open()\n\n   '     Cmd.CommandText = \"INSERT INTO dbo_Locatie(id, Longitude, Latitude, Timestamp) VALUES (1234, 4567, 789, 12-12-2012)\"\n\n\n' Reader = Cmd.ExecuteReader\n\n '        Reader.Close()\n  '       Con.Close()\n '      Con.Dispose()\n\n\n\n    End If\n\nEnd Sub\n'Dim values() As String = Server.UrlDecode(data).Replace(\"{\", \"\").Replace(\"}\", \"\").Replace(\"\"\":\"\"\", \"\"\"=\"\"\").Split(New Char() {\",\"}, StringSplitOptions.RemoveEmptyEntries)  For Each value As String In values \n\n\nPublic Class MyObject\n    Private _ID As String\n    Private _Longitude As String\n    Private _Latitude As String\n    Private _Timestamp As String\n\n\n    Public Property ID As String\n        Get\n            Return _ID\n        End Get\n        Set(value As String)\n            _ID = value\n        End Set\n    End Property\n\n\n    Public Property Longitude As String\n        Get\n            Return _Longitude\n        End Get\n        Set(value As String)\n            _Longitude = value\n        End Set\n    End Property\n\n\n    Public Property Latitude As String\n        Get\n            Return _Latitude\n        End Get\n        Set(value As String)\n            _Latitude = value\n        End Set\n    End Property\n\n\n    Public Property Timestamp As String\n        Get\n            Return _Timestamp\n        End Get\n        Set(value As String)\n            _Timestamp = value\n        End Set\n    End Property\n\n\n    Public Function Save() As Boolean\n Return True\n    Using objConn As New SqlConnection(\"Server=sr04011389\\sql02;database=LocatieBepaling_Ontw;Trusted_Connection=yes;Max Pool Size=400;Connect Timeout=600;\")\n      Try\n\n            Dim cmd As New SqlCommand(\"csp_save_my_object\")\n            cmd.CommandType = CommandType.StoredProcedure\n            cmd.Parameters.AddWithValue(\"@ID\", ID)\n            cmd.Parameters.AddWithValue(\"@Longitude\", Longitude)\n            cmd.Parameters.AddWithValue(\"@Latitude\", Latitude)\n            cmd.Parameters.AddWithValue(\"@Timestamp\", Timestamp)\n           Return cmd.ExecuteNonQuery() &gt; 0\n        Catch ex As Exception\n           Return False\n       End Try\n    End Using\n\n    End Function\n\n\n    Public Function SaveWithoutSP() As Boolean\n       Return True\n        Using Con As New SqlConnection(\"Server=sr04011389\\sql02;database=LocatieBepaling_Ontw;Trusted_Connection=yes;Max Pool Size=400;Connect Timeout=600;\")\n            Try\n               Con.Open()\n               Dim cmd As New SqlCommand(\"UPDATE dbo_Locatie SET (Longitude = @Longitude, Latitude = @Latitude,Timestamp = @Timestamp) WHERE id=@ID IF @@ROWCOUNT=0 INSERT INTO locatie VALUES (@ID, @Longitude, @Latitude, @Timestamp)\")\n              cmd.CommandType = CommandType.Text\n                cmd.Parameters.AddWithValue(\"@ID\", ID)\n                cmd.Parameters.AddWithValue(\"@Longitude\", Longitude)\n                cmd.Parameters.AddWithValue(\"@Latitude\", Latitude)\n                 cmd.Parameters.AddWithValue(\"@Timestamp\", Timestamp)\n                Return cmd.ExecuteNonQuery() &gt; 0\n            Catch ex As Exception\n                Return False\n\n            End Try\n        End Using\n    End Function\nEnd Class\n\n\n\n 'Sub Page_UnLoad()   \n 'objConn.Close()   \n 'objConn = Nothing  \n 'End Sub  \n\n &lt;/script&gt;  \n\n &lt;html&gt;   \n &lt;head&gt;   \n &lt;title&gt;TracknTrace&lt;/title&gt;   \n &lt;/head&gt;   \n &lt;body&gt;   \n &lt;form id=\"form1\" runat=\"server\"&gt;   \n &lt;asp:Label id=\"lblText\" runat=\"server\"&gt;&lt;/asp:Label&gt; \n &lt;br&gt;&lt;asp:Label id=\"lblText1\" runat=\"server\"&gt;&lt;/asp:Label&gt; &lt;/br&gt;\n &lt;br&gt;&lt;asp:Label id=\"lblText2\" runat=\"server\"&gt;&lt;/asp:Label&gt; &lt;/br&gt; \n &lt;br&gt;&lt;asp:Label id=\"lblText3\" runat=\"server\"&gt;&lt;/asp:Label&gt; &lt;/br&gt;\n &lt;br&gt;&lt;asp:Label id=\"lblText4\" runat=\"server\"&gt;&lt;/asp:Label&gt; &lt;/br&gt;\n &lt;/form&gt; \n</code></pre>\n\n<p><br>\n And the PHP code i used before was:</p>\n\n<pre><code> $result = mysql_query(\"SELECT * FROM locatie WHERE id='$id'\");\n if($result &amp;&amp; mysql_num_rows($result)&gt;0){\n {\n $query = \"Update locatie \n SET     longitude = '$longitude',\n latitude = '$latitude',\n timestamp = '$timestamp'\n WHERE id = '$id'\";}\n else\n //Als het nummer bekend is\n\n {\n  //Als het een nieuw nummer is\n $query = sprintf(\"INSERT INTO locatie (id, longitude, latitude, timestamp) VALUES ('% s', '%s', '%s', '%s') \", mysql_real_escape_string($id) , mysql_real_escape_string ($longitude),  mysql_real_escape_string($latitude), mysql_real_escape_string($timestamp));}\n\n\n\n $result = mysql_query($query) or die('Query failed: ' . mysql_error());\n echo \"OK\";\n</code></pre>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13176567,"title":"Temporary SQL datafield","body":"<p>Currently I am returning a boolean value as \"1\" or \"0\" or value of a column let say column A in one of my stored procedure and it works perfectly, however in one of application I am trying to get value like this</p>\n\n<pre><code>string temp = reader.TryGetValue(\"ColumnA\", out licenseStatus) ? temp : string.Empty;\n</code></pre>\n\n<p>Stored procedure is doing something like this,</p>\n\n<pre><code>if @datafield = 1\n    return 1\nelse if @datafield = 2 AND @datafield2 = 3\n    return 0\nelse\n    return (SELECT ColumnA.table2 FROM table1 INNER JOIN table2 on table1.id and table2.id Where @datafield3 = 0)\n</code></pre>\n\n<p>Now I want to return result as value of ColumnA always instead of sending \"0\" or \"1\" as I am not allowed to make changes to code in application.</p>\n\n<p>Is it possible ? I can't make any changes to ColumnA value at all either.</p>\n\n<p><strong>EDIT</strong></p>\n\n<blockquote>\n  <p>I already mentioned in my question that stored procedure is doing what\n  its suppose to do but not working with my code, as I am returning 1 or\n  0 at some point and my code isn't getting it as columnA so its setting\n  it up empty, I want to return 0 or 1 as value of ColumnA but at same\n  time I don't want to change value of columnA in table2..</p>\n  \n  <p>:)</p>\n</blockquote>\n"},{"tags":["c#","sql","sql-server-2008","jquery-ajax"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2234,"score":1,"question_id":2653883,"title":"Easy way to convert data table to hash table or sqldatareader to hashtable","body":"<p>Please tell me if there's an easy way to convert a <code>DataTable</code> to a <code>HashTable</code> or a <code>SQLDataReader</code> to a <code>HashTable</code>. I have to parse it through javascriptserializer. the code i m using, having some problem. please take a look and guide me.</p>\n\n<pre><code>try\n{\n    using (SqlConnection conn = new SqlConnection(ConnectionString))\n    {\n        using (SqlCommand cmd = new SqlCommand(query, conn))\n        {\n            conn.Open();\n            SqlDataReader dr = cmd.ExecuteReader(CommandBehavior.CloseConnection);\n            dt.Load(dr);\n        }\n    }\n\n    Hashtable sendData = new Hashtable();\n\n    foreach (DataRow drIn in dt.Rows)\n    {\n\n        sendData.Add(drIn[\"orderNumber\"].ToString(), drIn[\"customerName\"].ToString());\n\n    }\n\n    sendData.Add(\"orderNum\", order);\n    JavaScriptSerializer jss = new JavaScriptSerializer();\n    string output = jss.Serialize(sendData);\n    return output;\n}\ncatch (Exception ex)\n{\n    return ex.Message + \"-\" + ex.StackTrace;\n}\n</code></pre>\n\n<p>It's giving a correct result when queried from one table in the database but from another table it's having a problem. Is there any other way to do this? </p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13173372,"title":"How to select one record at a time without using cursor?","body":"<p>I have two tables in SQL SERVER.</p>\n\n<p>DBO.VitalPatientDetails=></p>\n\n<p>| PatientDetailsId | PatientId | PatientName | UnitName | BedName | PatientDOB | LastAlarmReceivedAt |</p>\n\n<p>DBO.VitalAlarmDetails=></p>\n\n<p>| Id | PatientDetailsId (Refers VitalPatientDetails.PatientDetailsId) | VitalGenerationTime | FileName | </p>\n\n<p>I need to retrive all fields of DBO.VitalAlarmDetails grouped by PatientDetailsId ordered by VitalGenerationTime in ascending order.\nI have written cursor for this as below and it is returning multiple result sets. I need to get it in single set without using cursor. I just want to know whether I can do this without cursor.</p>\n\n<pre><code>DECLARE @PatientDetailsId BIGINT\nDECLARE @getAlarmDetails CURSOR\n\nSET @getAlarmDetails = CURSOR FOR SELECT PatientDetailsId FROM VitalPatientDetails\n\nOPEN @getAlarmDetails\n    FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        SELECT * FROM VitalAlarmDetails\n        WHERE PatientDetailsId = @PatientDetailsId\n        ORDER BY VitalGenerationTime ASC\n\n        FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n    END\nCLOSE @getAlarmDetails\nDEALLOCATE @getAlarmDetails\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2008","email","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3817,"score":3,"question_id":1780486,"title":"Can a SQL Server Trigger send me an email?","body":"<p>I wish to send an email from a <code>Trigger</code>, on my SQL Server 2008 machine. The data of the email will be, basically, some of the Trigger information.</p>\n\n<p>Can someone provide some simple/sample code on how to do this, please? E.g. what's the system stored procedure called? Etc.</p>\n\n<p>I've not set up any SQL mail and stuff, so I'm guessing it's built in and I can leverage that. But just to be sure: do I need to install any extra software on the server?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13175025,"title":"Closing Management Studio Query - Sleeping Process","body":"<p>When I close a query (after running it) in Management Studio SQL2008 R2, the processes remain as \"sleeping\", \"AWAITING COMMAND\". I have to manually kill them to get exclusive access. This is on my dev machine. Any idea why closing the window isn't closing the connection?</p>\n"},{"tags":["sql-server-2008","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13174809,"title":"how do I select from stored procedure","body":"<p>I am trying to work with EF, for the first time ever. I'm not sure I fully understand EF yet.</p>\n\n<p>I already have a database with data in it, so I've generated my models from DB.\nOur current setup runs EVERYTHING through stored procedures, even selects.\nHowever, unless I'm mistaking, the models select directly into the tables, when I have generated them.</p>\n\n<p>Can I change this behaviour, so it calls the select procedure instead?</p>\n"},{"tags":["sql","sql-server-2008","join","subquery","one-to-many"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":13138885,"title":"sql subquery and join on one to many table","body":"<p>This one is causing me too much head scratching!  Basically, I need to show a list of locations, the current item that is stored there and the person who owns it.  I have created 4 tables and have these populated with data.</p>\n\n<p>Setup: MSSQL 2008</p>\n\n<p>What I am looking for is the \"Top(1)\" from tbl_locationHistory for the item and owner as there can only ever be one item or one owner at any one time at each location. Bear in mind that tbl_locationHistory could have multiple bits of data, I just need to pull back the latest ID for each one (e.g. the highest ownerID, the highest itemID thats currently available from the history table).</p>\n\n<h2>tbl_location</h2>\n\n<p>locID\nlocName</p>\n\n<h2>tbl_item</h2>\n\n<p>itemID\nitemName</p>\n\n<h2>tbl_owner</h2>\n\n<p>ownerID\nownerName</p>\n\n<h2>tbl_locationHistory</h2>\n\n<p>locHistID\nlocID\nitemID\nownerID\ndateModified</p>\n\n<p>I tried joining all of these tables together with joins. However I realised that wouldn't work as I wasn't pulling back the top ID for either \"owners\" or \"items\" and therefore the data being displayed would be inaccurate.  </p>\n\n<p>One things I have thought is that I should break up the history table into two parts: 1 x owner to location and 1 x item to location - however I am at my limit of SQL right now so could do with some pointers in the right direction as not sure which way to go with this.</p>\n\n<p>Therefore I would need assistance even if I have to break up the history table.</p>\n\n<p><strong>UPDATED 01/11/12</strong></p>\n\n<p>OK, I am going to paste some code in here.</p>\n\n<p>I am an old school Classic ASP coder.....havent needed to move on yet!  I am using classic asp and MSSQL to create this application. I am also using dreamweaver and therefore want the query to be placed in that so I can use the \"bindings\" function in DW CS6.</p>\n\n<p>Here was my original query:</p>\n\n<pre><code>SELECT DISTINCT p.pID, p.cliID, p.pNo, p.pName, p.dtCommissioned,     \np.description, ps.plotStatus, pt.plotType, o.oSalutation, o.oFname, o.oSname, man.manName, \nmod.model, sl.width, sl.length, sl.yr\nFROM history AS ph INNER JOIN owners AS o ON ph.ownerID   \n= o.ownerID INNER JOIN StockList AS sl ON ph.stockID = sl.stkID   \nINNER JOIN manufacturers AS man ON sl.make = man.manID \nINNER JOIN models AS mod ON sl.model = mod.cID FULL OUTER   \nJOIN plotType AS pt RIGHT OUTER JOIN                       \nplots AS p ON pt.plotTypeID = p.plotType LEFT OUTER JOIN                       \nplotStatus AS ps ON p.pStatus = ps.plotStatusID ON ph.plotID = p.pID\nWHERE (p.cliID = value)\nORDER BY p.pNo\n</code></pre>\n\n<p>Now, when I realised that I wasn't looking in the history table correctly for the highest HistoryID for the \"stockID\" and also the highest plotHistoryID for \"ownerID\" I started looking at how I could perform a \"subquery\" for each ID......this is where I have become stuck.</p>\n\n<p>I have tried  something along the lines of:</p>\n\n<pre><code>Select p.pID, p.cliID, p.pNo, p.pName, p.dtCommissioned,     \np.description, ps.plotStatus, pt.plotType, o.oSalutation, o.oFname, o.oSname, man.manName, \nmod.model, sl.width, sl.length, sl.yr\n(Select top 1 ph.plotHistoryID, ownerID\nFROM History AS ph\norder by ph.plotHistoryID desc)\nTHEN JOINING ETC\nTHEN DO ANOTHER SUBQUERY FOR THE OWNER ETC\n</code></pre>\n\n<p>However I couldn't get that to work, but I am now beyond my level of SQL in relation to Sub Queries and JOINS.</p>\n\n<p>The Output display will be:</p>\n\n<p>Plot No  |  Plot Name  |  plot type  |  Plot status  |  Current Owner  |  Current Stock</p>\n\n<p>Each of the Plot No's/Names/Type/Status will be populated with data as I need to show them. If the owner\\current stock is blank I have an IF statement saying \"no owner\" or \"no stock found\".  </p>\n\n<p>The user will then be able to then click on a \"view\" link at the end of the row and view details of the plot/location and will pass the pID to the next page via QueryString.</p>\n\n<p>Does this help?  I am getting a little desparate now! LOL</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13173615,"title":"Normalizing values in SQL query","body":"<p>I have an data table I wish to perform some numeric analysis on for that I need all the values to be in the same range. 0..1.</p>\n\n<p>I have a somewhat slow and longhanded way of accomplishing this but would like a more straigt forward performant solution to my problem</p>\n\n<p>What I need to do is:</p>\n\n<p>group by projectid\nwith in each project take the average of each of the values and divide by the largest average for the entire set.</p>\n\n<p>currently I have</p>\n\n<pre><code>select avg(foo * 1.0)/ (Select MAX(IL) FROM (select avg(foo * 1.0) as IL from table group by     \n                                             ProjectID) tbl)\nfrom table\n</code></pre>\n\n<p>so if the list is</p>\n\n<pre><code>projectid  | foo\n-----------------\n1          | 1\n1          | 2\n2          | 4\n2          | 2\n</code></pre>\n\n<p>the largest average is 3 and the result should therefor be</p>\n\n<p>0.5,1</p>\n\n<p>where the first is the average for projectId 1 divided by 3 and the second is the average for projectId 2 divided by 3</p>\n"},{"tags":["sql-server","sql-server-2008","unique-constraint"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":13173787,"title":"SQL Server : Unique constraint to verify that data does not exist in another table","body":"<p>Given that I have a table structure where I have a parent that can have \"Roles\" and that parent have children that can have the same \"Roles\", how can I create a constraint on the child table that verifies that the parent does not have the Role that is about to be inserted?</p>\n\n<p>Like this:</p>\n\n<pre><code>Parent\n |\n \\- ParentRoles\n |\n \\- Child\n    |\n    \\- ChildRoles\n</code></pre>\n\n<p>I want the union of the Child and Parent roles to be a list of unique roles (no duplicates).</p>\n\n<p>I have checked <a href=\"http://stackoverflow.com/questions/3200795/sql-server-check-constraint-on-a-column-where-values-come-from-another-table\">Constraint by UserFunction</a> (not recommended but would work) and tried creating a view with an unique index but ran into trouble because I have to use Union in the view and then I cannot index it.</p>\n\n<p>An answer on the <a href=\"http://stackoverflow.com/questions/3200795/sql-server-check-constraint-on-a-column-where-values-come-from-another-table\">Constraint by UserFunction</a> question suggests using Foreign Keys but I do not understand how I could make that work given my table structure.</p>\n"},{"tags":["sql-server-2008","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13132124,"title":"SQL Server 2008 Full text Search Performance Issue","body":"<p>I recently upgraded from a Win 2003 / SQL Server 2000 (HP ML350 G4p - Dual Xeon with 2GB RAM) to new hardware (IBM x3200 M3 - Single Xeon QC X3450 2.66GHz 10GB RAM) running Win 2008 R2 / SQL Server 2008. We run a classic ASP website and use Full Text Search to enable customers to search our product descriptions.</p>\n\n<p>The search is performed by a stored procedure which builds up a dynamic query to run the search using the <code>contains</code> predicate.  </p>\n\n<p>I have an intermittent problem in that some searches are extremely slow. Sometimes taking over a minute to complete. At other times they will complete in less than a second. Didn't have this problem on the old server at all. </p>\n\n<p>I have replicated this problem by running the stored procedure from the SSMS, and again, this can sometimes take an extremely long time.  </p>\n\n<p>I suspect the new Full Text Search system within SQL Server 2008, but I'm not sure how to pinpoint the issue. When the timeouts are occurring, there doesn't seem to be a big load on the server cpu.  I don't know where else to look. Relatively new to SQL Server 2008.</p>\n\n<p>Change Tracking on the Index if set to Off, and I'm running a job to incrementally update the index each day, as well as optimizing the catalog each day.</p>\n\n<p>Searching around on Google, this seems to be reasonably common a problem, but I haven't found a definitive answer to it yet.  Can someone point me in the right direction?</p>\n\n<p>Thanks in Advance,\nMike.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13171931,"title":"family tree sql query","body":"<p>I am working on Family tree application in asp.net with sql server 2008.</p>\n\n<p>My main table is like this:-</p>\n\n<pre><code>ID int PK\nName Varchar(50)\nMotherID int\nFatherID int\n\nID  MotherID FatherID   Name\n\n1   NULL    NULL    My Grand Father\n\n2   NULL    NULL    My Grand Mother\n\n3   someid  someid  My Mother\n\n4   2   1   My Father\n\n5   3   4   Me\n\n6   someid  someid  My wife\n\n7   3   4   My Brother\n\n8   6   5   My son.\n</code></pre>\n\n<p>I am looking for output like this</p>\n\n<pre><code>ID  MotherID    FatherID    Name        Level\n\n1   someid  someid  grandfather 0\n\n\n2   someid  someid  Father      1\n\n3   someid  someid  Me      2\n\n\n4   someid  someid  Brother     2\n\n5   someid  someid  My Son      3\n</code></pre>\n\n<p>Thanks in advance.\nKashmir.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":185,"score":2,"question_id":11225491,"title":"Select one row from multiple row in sql depands on condition","body":"<p>I have a table in sql 2008 named tblEmployeeAttendance like \n<img src=\"http://i.stack.imgur.com/cw9SU.jpg\" alt=\"enter image description here\"></p>\n\n<p>Here is some dummy data for a employee's one days attendance like</p>\n\n<p><img src=\"http://i.stack.imgur.com/P6puo.jpg\" alt=\"enter image description here\"></p>\n\n<p>Here AI refers AttendanceIn,AO refers AttendanceOut,BO refers BreakIn and BI refers BreakOut.There can multiple row in a day for a employee.First row should be AI,last row should be AO and others rows will be BreakIn,BreakOut Sequentially(that means BreakIn-BreakOut-BreakIn.....).</p>\n\n<p>My expected output would be like this</p>\n\n<p><img src=\"http://i.stack.imgur.com/SfrKP.jpg\" alt=\"enter image description here\"></p>\n\n<p>I need a sql query that will return one row per date and return data that must contain AttendanceIn and AttendanceOut Time depands on strRemark(AI &amp; AO). Please help me.</p>\n"},{"tags":["c#","sql-server-2008","datetime","datepicker"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":13169709,"title":"how to insert a datepicker datetime value into sql database","body":"<p>My SQL Server 2008 database has a table with a column of datatype <code>datetime</code>.</p>\n\n<p>When I try to insert values into the <code>datetime</code> column I am getting error.</p>\n\n<blockquote>\n  <p><em>Incorrect syntax near '-'</em></p>\n</blockquote>\n\n<p>My datetime picker has custom format <code>yyyy-MM-dd</code> e.g (2012-11-01)</p>\n\n<p>Following is the code sample I used to insert <code>datetime</code>.</p>\n\n<pre><code> System.DateTime myDate = default(System.DateTime);\n myDate = DateTimePickerPrint.Value;\n string query = string.Format(\"EXEC Save_Quotation_Bookshop '\" + txt_QutationNo.Text + \"','\" + txt_CusCode.Text + \"',#\" + myDate + \"#,\");\n</code></pre>\n\n<p>Please any one have an idea ?</p>\n"},{"tags":[".net","sql-server-2008","full-text-search"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":16,"score":-1,"question_id":13170778,"title":"Full Text Search SQL Server 2008","body":"<p>I am trying to design a search engine for a website using Visual Studio 2008 and SQL Server 2008. </p>\n\n<p>I have created two full text indexed tables <code>dbo.keyword</code> with columns <code>url</code>, <code>keyword</code> and <code>dbo.urlDetail</code> with columns <code>url</code>, <code>title</code>, <code>metatag</code>, <code>pagetext</code>.</p>\n\n<p>Plz. help me to design search feature from Textbox where users search for any data from from that website.</p>\n"},{"tags":["sql-server-2008","master-detail","cascading-deletes"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13158100,"title":"How do I delete the master record automatically when all detail records are deleted in SQL Server 2008?","body":"<p>Say I have two tables.  <code>Errors</code> and <code>ErrorsDetails</code>.  So I have one Errors record that could contain many ErrorDetails records.</p>\n\n<p>The users will periodically delete the detail records through an application they use.  When all detail records are cleaned up (deleted), I would like to automatically delete the master record too.</p>\n\n<p>What would be cool would be one SQL delete statement that would delete the details and the master if no more details are owned by the master.  But I can't seem to get a clean SQL statement that does that.   I'd rather not poll the master for details after every delete.</p>\n\n<p><strong>Errors</strong></p>\n\n<pre><code>ID        Error\n1         Import Error\n2         Export Error\n</code></pre>\n\n<p><strong>ErrorsDetails</strong></p>\n\n<pre><code>ID        ErrorsID        DetailedInfo\n1         1               Couldn't import file because of FTP error\n2         1               Couldn't import file because of permission error\n3         2               Couldn't export file because of directory doesn't exist\n</code></pre>\n\n<p>I've tried adding a <code>cascade</code> delete constraint like so but it didn't seem to work.</p>\n\n<pre><code>alter table dbo.ErrorsDetails\n    add constraint FK_Delete_Master\n        foreign key (ErrorsID) references dbo.Errors(ErrorsID) on delete cascade\n</code></pre>\n\n<p>Thanks for any suggestions.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>It's been mentioned to use triggers.  I thought about that but didn't mention it.  A trigger would certainly do the job.  Pros/Cons of triggers for this scenario?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13170371,"title":"Easier way to compare a DATE field to the date value of GETDATE?","body":"<p>I have a field in a table <code>Event.EventDate</code> and it's of the data type <code>DATE</code> rather than <code>DATETIME</code> and then I have a view that has the following <code>WHERE</code> clause:</p>\n\n<pre><code>WHERE e.EventDate &gt;= CAST(CONVERT(VARCHAR(MAX), GETDATE(), 101) AS DATETIME)\n</code></pre>\n\n<p>As you can see, I'm just trying to get all events <code>&gt;=</code> today's <strong>date</strong>. The above code works, but it's ugly. I tried this ...</p>\n\n<pre><code>WHERE e.EventDate &gt;= CONVERT(VARCHAR(MAX), GETDATE(), 101)\n</code></pre>\n\n<p>... and this ...</p>\n\n<pre><code>WHERE e.EventDate &gt;= CONVERT(DATETIME, GETDATE(), 101)\n</code></pre>\n\n<p>... but those didn't work, they gave me every event <code>&gt;</code> today's <strong>date</strong>. However, even if the above worked, it's still ugly.</p>\n\n<p>Isn't there a better way?</p>\n"},{"tags":["sql-server","sql-server-2008","windowsdomainaccount"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":4623,"score":1,"question_id":4268100,"title":"How to find loginname, database username, or roles of sqlserver domain user who doesn't have their own login?","body":"<p>I have created a login and database user called \"MYDOMAIN\\Domain Users\". I need to find what roles a logged on domain user has but all the calls to get the current user return the domain username eg. \"MYDOMAIN\\username\" not the database username eg. \"MYDOMAIN\\Domain Users\".</p>\n\n<p>For example, this query returns \"MYDOMAIN\\username\"</p>\n\n<pre><code>select original_login(),suser_name(), suser_sname(), system_user, session_user,  current_user, user_name()\n</code></pre>\n\n<p>And this query returns 0</p>\n\n<pre><code>select USER_ID()\n</code></pre>\n\n<p>I want the username to query database_role_members is there any fuction that will return it or any other way I can get the current users roles?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","login"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":13168175,"title":"SQL Script to Create Auto-Expiring Login","body":"<p>How can I script the creation of a new SQL Login (whether by Windows\nAuthentication or with SQL password) and have it automatically expire after some\ntime, e.g. 8 hours, 24 hours</p>\n\n<p>I've tried searching here in stackoverflow but I haven't found a solution. If you guys know of one that exists here, please let me know too. Thank you.</p>\n\n<p>I am using SQL Server 2005 and 2008</p>\n"},{"tags":["sql","sql-server-2008","tcp","remote-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13161247,"title":"Remote connection to SQL server 2008 sp2","body":"<p>I built a window application in visual studio 2010. It is working fine at my computer. when I trying to run from another computer it gives me an \nError: \n    A network-related or instance-specific error occurred while establishing a connection to     SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. </p>\n\n<p>here some information : \ncomputer ip: 192.168.0.25\nDNS - 192.168.0.12\ninstance - SQLEXPRESS</p>\n\n<p>Connection string : String = \"Data Source=192.168.0.12\\SQLEXPRESS;Initial Catalog=fleetInfo;User ID=user; Password=user123;\"</p>\n\n<p>Im running SQL Server Management Studio 2008 SP2. I checked sql server configuration Manager. Everything is fine.\nIn configuration Manager> protocols for SQLEXPRESS > TCP/IP:\nIP1 \nIP address: 192.168.20.100\nPort : null\nIP ALL\nDynamic port : 1408\nTCP port: null</p>\n\n<p>I'm wondering what is wrong Im doing here.</p>\n\n<p>Thanks guys.</p>\n"},{"tags":["sql-server-2008","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":11934922,"title":"Getting snippets of text searched using FTS in SQL Server","body":"<p>We store one page of text in each sql record as a single NVARCHAR(MAX) column. This column is full text indexed by SQL 2008. We use FREETEXTTABLE to query the full text index to locate documents containing a given keyword or phrase. The end user wants to see a small text snippet for each hit returned by FREETEXTTABLE in grid form. Ideally, this snippet would be the text representing the searched for keyword/phrase along with the word immediately to the left and right of the hit so as to provide context within the larger document text. \nThis is not an out of box feature.</p>\n\n<p>How to do this in SQL Server ??</p>\n\n<p>Thank you, \nMarcus</p>\n"},{"tags":["sql-server-2008","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12119740,"title":"How to find out where the search keyword is found in full-text search","body":"<p>Consider this</p>\n\n<pre><code>SELECT  * \nFROM Publication a          \nINNER JOIN  CONTAINSTABLE(Publication, (Title, Keywords), \n@TitlePartial)TitleSearchPartial ON  a.Id = TitleSearchPartial.[Key]\n</code></pre>\n\n<p>I am searching in (<code>Title</code> and <code>Keyword</code>) columns of the <code>Publication</code> table .\nThe search key word can be found anywhere in 'Title' or 'Keyword'\nHow to find which column the search keyword has been found in? Is there a out-of-box way to do this?</p>\n\n<p>Any ideas...</p>\n"},{"tags":["sql-server-2008","entity-framework","sql-server-express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13168166,"title":"\"The underlying provider failed on Open\" Entity Framework error","body":"<p>I've been getting the error \"The underlying provider failed on Open.\" recently and I've been pulling my hair out trying to figure out why.  On closer inspection of the error the inner exception is \"The connection was not closed. The connection's current state is connecting.\" and the stack trace is </p>\n\n<pre><code>\"at System.Data.ProviderBase.DbConnectionClosedConnecting.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)\n   at System.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry)\n   at System.Data.SqlClient.SqlConnection.Open()\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\"\n</code></pre>\n\n<p>As far as I can tell the error seems to happen at random or possibly when making changes to the application.  Any help would be greatly appreciated.</p>\n\n<p>My current setup is</p>\n\n<ul>\n<li>IIS Express</li>\n<li>Microsoft SQL Server Express Edition</li>\n<li>Visual Studio 2012</li>\n<li>MVC Web API \\ Asp.net MVC 4</li>\n<li>Entity Framework 5</li>\n</ul>\n\n<p>My data layer is modeled off the Repository pattern and injected via Structure map.</p>\n\n<p><strong>Repository</strong></p>\n\n<pre><code>public class Repository&lt;T&gt; : IDisposable, IRepository&lt;T&gt; where T : class\n{\n    private readonly DbSet&lt;T&gt; _dbSet;\n    private readonly DbContext _dbContext;\n\n    public Repository(IDbContextFactory&lt;MyContext&gt; dbContextFactory)\n    {\n        _dbContext = dbContextFactory.Create();\n        _dbSet = _dbContext.Set&lt;T&gt;();\n    }\n\n    //removed for brevitity\n\n    public void Dispose()\n    {\n        _dbContext.Dispose();\n    }\n</code></pre>\n\n<p><strong>DbContextFactory</strong></p>\n\n<pre><code>public class MyContextFactor : IDbContextFactory&lt;MyContext&gt;, IDisposable\n{\n    private MyContext _dataContext;\n\n    public MyContextFactor Create()\n    {\n        return _dataContext ?? (_dataContext = new MyContext());\n    }\n\n    public void Dispose()\n    {\n        _dataContext.Dispose();\n    }\n}\n</code></pre>\n\n<p><strong>Structure Map Registry for IOC</strong></p>\n\n<pre><code>For(typeof(IDbContextFactory&lt;MyContext&gt;)).HybridHttpOrThreadLocalScoped().Use(typeof(MyContextFactory));\n</code></pre>\n\n<p><strong>Connection String</strong></p>\n\n<pre><code>&lt;add name=\"MyContextConnectionString\" connectionString=\"metadata=res://*/Model.MyProject.csdl|res://*/Model.MyProject.ssdl|res://*/Model.MyProject.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=(local);initial catalog=MyDB;User Id=SQLUser;Password=****;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\"/&gt;\n</code></pre>\n\n<p>Things I've attempted to fix the problem and so far haven't worked</p>\n\n<ul>\n<li>ensure context is per http context via structure map scope</li>\n<li>added dispose to repository</li>\n<li>added dispose to ContextFactory</li>\n<li>switched from Intergrated Sql auth to Sql authentication</li>\n</ul>\n"},{"tags":["sql","sql-server-2008","merge-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":98,"score":5,"question_id":13009812,"title":"Inserts in Merge Replication database are insanely slow","body":"<p>I have a SQL server that is setup with merge replication to 800 mobile clients running SQL CE.</p>\n\n<p>The server has enough resources and the lines in and out of the company are more than adequate, the replication between clients and the server is generally good but we are getting an intermittent error that I just cannot track down.</p>\n\n<p>Yesterday we needed to insert 550 records into one of our main tables, the only triggers that exist are the standard merge replication ones.</p>\n\n<p>This insert took 14 hours due to it continually getting deadlocked with mobile devices trying to synch.</p>\n\n<p>Does anyone have any advice on how we can avoid locks on inserts and how to speed up the entire process?</p>\n\n<p>------ Update -----</p>\n\n<p>Following on from some comments I've run a profiler over a single insert and I'm seeing a lot of this sort of thing</p>\n\n<pre><code>insert into dbo.MSmerge_current_partition_mappings with (rowlock) (publication_number, tablenick, rowguid, partition_id)\n            select distinct 1, mc.tablenick, mc.rowguid, v.partition_id\n            from dbo.MSmerge_contents mc with (rowlock) \n            JOIN dbo.[MSmerge_JEMProjectME_PromotionResource_PARTITION_VIEW] v with (rowlock) \n            ON mc.tablenick = 286358001\n            and mc.rowguid = v.[rowguid]\n            and mc.marker = @child_marker \n            and v.partition_id in (select partition_id from dbo.MSmerge_current_partition_mappings cpm with (rowlock) JOIN\n                dbo.MSmerge_contents mc2 with (rowlock)\n                ON cpm.rowguid = mc2.rowguid\n                and mc2.marker = @marker)\n            where not exists (select * from MSmerge_current_partition_mappings with (readcommitted, rowlock, readpast) where \n                publication_number = 1 and \n                tablenick = 286358001 and\n                rowguid = v.[rowguid] and\n                partition_id = v.partition_id)\n</code></pre>\n\n<p>For many tables that I'm not meant to be inserting into... could this be a clue?</p>\n"},{"tags":["sql","tsql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":562,"score":2,"question_id":5711518,"title":"how to get the max size used by a field in table","body":"<p>I have a field which has been set to max size. How can i find the max size occupied by the field.</p>\n\n<p>For example if the records are for table TableA</p>\n\n<pre><code>FieldA\n\n123\nabcd\n1234567\n</code></pre>\n\n<p>I need to know which row occupied the most size and what the size is</p>\n\n<p>Thanks</p>\n\n<p>Prady</p>\n"},{"tags":["sql","database","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13167182,"title":"How can you define a computed column like this?","body":"<p>I have an <code>Equipment</code> table in SQL Server 2008 like this:</p>\n\n<pre><code>CREATE TABLE [dbo].[Equipment](\n[EquipmentID] [nchar](10) NOT NULL,\n[EquipmentName] [nchar](50) NOT NULL,\n[ProducedDate] [date] NOT NULL,\n[WarrantyPeriod] [int] NOT NULL,\n[SerialNumber] [nchar](20) NOT NULL,\n[BrandID] [tinyint] NOT NULL,\nCONSTRAINT [PK_Equipment] PRIMARY KEY CLUSTERED \n)\n</code></pre>\n\n<p>I want to have a computed column <code>WarrantyStatus</code> that will return either <code>Unexpired</code> or <code>Expired</code> when calculating, based on columns <code>ProducedDate</code> and <code>WarrantyPeriod</code>. </p>\n\n<p>This is wrong, but it's what I want:</p>\n\n<pre><code>ALTER TABLE [dbo].[Equipment]\nADD [WarrantyStatus] AS IIF(DATEDIFF(MONTH, [ProducedDate], GETDATE()) &lt; [WarrantyPeriod], \"Unexpired\", \"Expired\")\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13156038,"title":"Speed up dividing date intervals by minutes in Sql Server","body":"<p>I need to divide some date intervals by minutes. (For example, 2012-01-01 10:00 - 2012-01-01 10:00 interval should be divided into 2012-01-01 10:01, 2012-01-01 10:02, ... 2012-01-01 10:10).\nFor example, there is a table</p>\n\n<pre><code>CREATE TABLE [dbo].[Events](\n    [ID] [int] IDENTITY(1,1) NOT NULL,\n    [EventStart] [datetime] NOT NULL,\n    [EventEnd] [datetime] NOT NULL,\n    [Amount] [float] NOT NULL,\n CONSTRAINT [PK_Events] PRIMARY KEY CLUSTERED \n(\n    [ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n</code></pre>\n\n<p>This table is filled like</p>\n\n<pre><code>DECLARE @i integer = 0;\nDECLARE @initial_date datetime = '2012-01-01';\n\nWHILE @i &lt; 50000\nBEGIN\n    INSERT INTO [Events] (EventStart, EventEnd, Amount) VALUES (DATEADD(MINUTE, 10*@i, @initial_date), DATEADD(MINUTE, 10*(@i + 1), @initial_date), @i);\n    SET @i = @i + 1;\nEND\n</code></pre>\n\n<p>As a result we have many 10 minutes intervals.</p>\n\n<p>To divide it by minutes I use the following recursive CTE:</p>\n\n<pre><code>DECLARE @start_date datetime = '2012-01-01';\nDECLARE @end_date datetime = '2013-01-02';\n\n\nWITH Date_Ranges (StatDate, Amount, IntervalStart, CurrentMinute) AS (\n  SELECT \n    DATEADD(MINUTE, 0,  ev.EventStart) AS StatDate, ev.Amount, ev.EventStart AS IntervalStart, 1 AS CurrentMinute\n  FROM [Events] ev\n  WHERE ev.EventStart BETWEEN @start_date AND @end_date\n  UNION ALL\n  SELECT \n    DATEADD(MINUTE, CurrentMinute, ev.EventStart), ev.Amount, ev.EventStart AS IntervalStart, CurrentMinute + 1\n  FROM [Events] ev\n  INNER JOIN Date_Ranges ranges ON (ranges.IntervalStart = ev.EventStart AND \n    ranges.StatDate &gt;= ev.EventStart AND \n    ranges.StatDate &lt; ev.EventEnd)\n    WHERE DATEADD(MINUTE, CurrentMinute, ev.EventStart) BETWEEN @start_date AND @end_date AND\n        ev.EventStart BETWEEN @start_date AND @end_date\n) \n\nSELECT *\nFROM Date_Ranges --ORDER BY StatDate\n</code></pre>\n\n<p>The main problem is too slow execution of this recursive CTE on a large data amount.</p>\n\n<p>So, how can I speed up this?</p>\n"},{"tags":["sql-server-2008","insert","identity"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13147227,"title":"Should I use IDENT_CURRENT, @@IDENTITY, or SCOPE_IDENTITY?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1920558/what-is-the-difference-between-scope-identity-identity-identity-and-ide\">What is the difference between Scope_Identity(), Identity(), @@Identity, and Ident_Current?</a>  </p>\n</blockquote>\n\n\n\n<p>I have an INSERT statement that I'm running through Dapper, and I want to append to the INSERT statement so that I can get the identity value inserted and set it on the model. So, let's assume the following INSERT statement.</p>\n\n<pre><code>INSERT INTO Foo (Bar, Comments) VALUES ('Some Bar', 'Some Comments');\n    SELECT @@IDENTITY\n</code></pre>\n\n<p>I then plan to run that through the <code>Query</code> extension in Dapper. However, which one of the three options available in SQL should I use here?</p>\n\n<p>Just and FYI, it <em>seems</em> to me I should use SCOPE_IDENTITY, but I wanted to make sure and also understand <strong><em>why</em></strong> I should use one over the other.</p>\n"},{"tags":["sql-server","sql-server-2008","matlab"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4405,"score":1,"question_id":6593485,"title":"How to connect to Microsoft SQL Server 2008 (MSSQL) from Matlab?","body":"<p>This is probably a simple question:</p>\n\n<ul>\n<li>How do I connect to Microsoft SQL Server 2008 R2 from Matlab?</li>\n<li>How do I read a table into a matrix given some SQL query?</li>\n</ul>\n\n<p><strong>Update</strong></p>\n\n<p>I'd prefer a method that doesn't require use of manual setup using ODBC.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","cdc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13162619,"title":"Unable to restart CDC after making table changes","body":"<p>I need to add a couple of columns to CDC for a table that is already being tracked. My approach is as follows:</p>\n\n<pre><code>EXEC sys.sp_cdc_drop_job 'capture'\n\nBEGIN TRANSACTION\n\nBEGIN TRY\n    -- Copy existing data of the tracked table into a temporary table\n    SELECT * INTO CDC.dbo_MyTable_Temp FROM CDC.dbo_MyTable_CT\n\n    -- Add the new column to the temp table. This allows us to just use INSERT..SELECT * later\n    ALTER TABLE CDC.dbo_MyTable_Temp ADD MyColumn INT NULL\n\n    -- Disable CDC for the source table temporarily. This will drop the CDC table\n    EXEC sys.sp_cdc_disable_table @source_schema = 'dbo', @source_name = 'MyTable', @capture_instance = 'dbo_MyTable'\n\n    -- Reenable CDC for the source table. This will recreate the table with the new columns\n    EXEC sys.sp_cdc_enable_table @source_schema = 'dbo', @source_name = 'MyTable', @capture_instance = 'dbo_MyTable', @supports_net_changes = 1, @role_name = NULL, @filegroup_name = 'CDCGROUP'\n\n    -- Insert the old values into the CDC table\n    INSERT INTO cdc.dbo_MyTable_CT SELECT * FROM cdc.dbo_MyTable_Temp\n\n    -- Correct the start_lsn in CDC.change_tables. Otherwise all of the CDC stored procedures will be confused\n    -- and although the old data will exist in the table the functions won't return it\n    UPDATE cdc.change_tables SET start_lsn = (SELECT MIN(__$start_lsn) FROM cdc.dbo_MyTable_Temp) WHERE capture_instance = 'dbo_MyTable'\n\n    -- Drop the temp table\n    DROP TABLE cdc.dbo_MyTable_Temp\n\n    COMMIT TRANSACTION\nEND TRY\nBEGIN CATCH\n    ROLLBACK TRANSACTION\n    RAISERROR('Error!', 16, 1)\nEND CATCH\n\nEXEC sys.sp_cdc_add_job 'capture'\n</code></pre>\n\n<p>However, when the job runs again after being re-added it generates an error that there is a violation of the primary key constraint on <code>CDC.lsn_time_mapping</code>.</p>\n\n<p>Any suggestions?</p>\n\n<p>Thanks!</p>\n"},{"tags":[".net","sql-server-2008","reportbuilder3.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13165781,"title":"Can Report Builder 3.0 work if only .NET Framework 4 Client Profile is installed on Windows 7 client PC?","body":"<p>This <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=6116\" rel=\"nofollow\">page</a> mentions that Report Builder 3.0 system requirements need component Microsoft .NET Framework 3.5 SP1.</p>\n\n<p>Our users don't have the .net 3.5 framework nor the corresponding SP1 installed on their Windows 7s. I have the .NET Framework 4 (Client Profile as well as Extended) installed on my Windows 7.</p>\n\n<p>I'd like to know (or someone can point out) if only having the Framework 4 Client Profile would be enough for our users to create reports in Report Builder 3.0 and be able to connect to our SQL Server 2008 R2.</p>\n"},{"tags":["asp.net","sql","sql-server-2008","c#-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12526117,"title":"Error showing up Fill: SelectCommand.Connection property has not been initialized","body":"<pre><code>  DataSet ds = new DataSet();\n\n    SqlDataAdapter cmd = new SqlDataAdapter(\"Select * FROM event\", con);\n    cmd.Fill(ds, \"Table\");\n</code></pre>\n\n<p>Getting the same error again and again tried everything</p>\n\n<p>please help</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":48,"score":-2,"question_id":13163955,"title":"Find row which has unique values with respect to some of its columns","body":"<p>My SQL table is something like this:</p>\n\n<pre><code>id, name, value1, value2, value3, value4\n1, xyz, 1, 2, 4, 1\n2, xyz, 4, 2, 4, 1\n3, abc, 4, 2, 4, 1\n4, abc, 4, 2, 2, 1\n5, abc, 4, 2, 2, 1\n</code></pre>\n\n<p>I want to write a Sql query which returns rows which has <strong>any</strong> of their values (read: value1,value2,value3,value4) changed. So the result output would be:</p>\n\n<pre><code>id, name, value1, value2, value3, value4\n1, xyz, 1, 2, 4, 1\n2, xyz, 4, 2, 4, 1\n4, abc, 4, 2, 2, 1\n</code></pre>\n\n<p>I understand, if I just needed values in output I could have used Distinct or Group by like:</p>\n\n<pre><code>select distinct value1,value2,value3,value4 from table;\n</code></pre>\n\n<p>But, here I need id and name columns too in output.</p>\n\n<p>Wondering if I really need to write a subquery or create virtual/inner table to get my result. Or, there is a smarter way?</p>\n\n<p>My question is not similar to <a href=\"http://stackoverflow.com/questions/6941049/how-to-find-out-whether-a-table-has-some-unique-columns\">How to find out whether a table has some unique columns</a>. Let me know if you think otherwise, I can clarify.</p>\n"},{"tags":["sql-server-2008","crystal-reports","sql-server-2008-r2","crystal-reports-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13164231,"title":"cannot connect the report to the stored proc","body":"<p>I have one stored procedure. It is using one table valued function. When I try to point the crystal report to this stored proc, it  is giving me following error:</p>\n\n<p>Database vendor code: 229. Select permission was denied on the function.</p>\n\n<p>I granted the select permission to the function.</p>\n\n<p>What can be the problem?</p>\n"},{"tags":["vb.net","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13163028,"title":"get return value from stored procedure without output parameter","body":"<p>I have a vb.net application that inserts records into a db table using a stored procedure that is supposed to return a value. This stored procedure was setup by someone else and initially was linked to a webservice through which my application made the insert and got the return value in the returned xml. I now have access to the db table and not sure how to receive the return value in my vb.net method.</p>\n\n<p>SQl stored procedure snippet;</p>\n\n<pre><code>     @urlname varchar(500),\n@siteid varchar(16),\n@origin varchar(50),\n@queryid varchar(25)\n  AS\nSET NOCOUNT ON;\ndeclare @cnt int\ndeclare @serverip varchar(16)\ndeclare @mincnt int\ndeclare @siteservercnt int\nselect @cnt=COUNT(*) from sites\n      where urlname=@urlname\nif @cnt = 0\n    begin\n    insert into sites (urlname,siteid,exported,origin,queryid)\n    values(@urlname,@siteid,1,@origin,@queryid)\n    select @siteservercnt = COUNT(*) from siteserverip where siteid=@siteid\n    if @siteservercnt=0\n       begin\n            select top 1 @mincnt=COUNT(*),@serverip=serverip from siteserverip\n        group by serverip\n        order by COUNT(*)\n        select top 1 @mincnt=sitecount,\n                         @serverip=serverip from serveripcounts\n        order by sitecount\n        insert into siteserverip values(@siteid,@serverip)\n        update serveripcounts set sitecount=sitecount+1\n        where serverip=@serverip\n        end\n    end\nSELECT siteid from sites\nwhere urlname=@urlname\nreturn \n</code></pre>\n\n<p>and my vb.net code to do the insert</p>\n\n<pre><code>        CommandObj.CommandText = \"Getsite\"\n        CommandObj.CommandTimeout = 90\n\n        Dim newUrl As String = String.Empty\n\n        CommandObj.Parameters.Clear()\n\n        Dim m_param As SqlParameter\n\n        m_param = CommandObj.Parameters.Add(\"@urlname\", SqlDbType.VarChar, 500)\n        m_param.Direction = ParameterDirection.Input\n        m_param.Value = name\n\n\n        m_param = CommandObj.Parameters.Add(\"@siteid\", SqlDbType.VarChar, 16)\n        m_param.Direction = ParameterDirection.Input\n        m_param.Value = siteid\n\n        m_param = CommandObj.Parameters.Add(\"@origin\", SqlDbType.VarChar, 50)\n        m_param.Direction = ParameterDirection.Input\n        m_param.Value = method\n\n        m_param = CommandObj.Parameters.Add(\"@queryId\", SqlDbType.VarChar, 25)\n        m_param.Direction = ParameterDirection.Input\n        m_param.Value = forumID\n\n\n        Dim recordsAffected As Integer = CommandObj.ExecuteNonQuery\n</code></pre>\n"},{"tags":["sql-server-2008","connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13162813,"title":"What IP address should I use in connection string to connect remote database","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13161247/remote-connection-to-sql-server-2008-sp2\">Remote connection to SQL server 2008 sp2</a>  </p>\n</blockquote>\n\n\n\n<p>I'm fairly new in server field. I have a window application in VB, Im trying to connect database with my application. what live IP should I use in connection string to connect application with database?</p>\n\n<pre><code>String = \"Data Source=***.***.*.***\\SQLEXPRESS;Initial Catalog=StudentInfo;User ID=user; Password=st123;\"\n</code></pre>\n\n<p>Thanks guys.\ncheers</p>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":3,"up_vote_count":2,"down_vote_count":0,"view_count":85,"score":2,"question_id":13159526,"title":"Split values over multiple rows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5493510/turning-a-comma-separated-string-into-individual-rows\">Turning a Comma Separated string into individual rows</a>  </p>\n</blockquote>\n\n\n\n<p>I have the following output from a stored procedure and was wondering the best way to split the values into multiple rows.</p>\n\n<pre><code>reference   name                            subjects       subjectstitle\nLL9X81MT    Making and Decorating Pottery   F06,F27,F38       NULL\n</code></pre>\n\n<p>I need to trim the subjects field at the comma's and duplicate the information over three rows so the data would be as follows.</p>\n\n<pre><code>reference   name                            subjects       subjectstitle\nLL9X81MT    Making and Decorating Pottery   F06       NULL\nLL9X81MT    Making and Decorating Pottery   F27       NULL\nLL9X81MT    Making and Decorating Pottery   F38       NULL\n</code></pre>\n\n<p>I'm using MS SQL Server 2008 to setup these SP's and just need some help on how to split the subjects field up.</p>\n\n<p>Thanks,</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13161044,"title":"Checking if a given date fits between a range of dates","body":"<p>If I have 2 date columns in a table, <code>startDate</code> and <code>endDate</code>.  How do I return rows where a given date fits between those 2 dates?  For example:</p>\n\n<p>If the given date is <code>2012-10-25</code></p>\n\n<p>It should return the following rows</p>\n\n<pre><code>startDate   -   endDate\n2012-10-25  -   2012-10-25\n2011-09-10  -   2013-11-15\n2012-10-20  -   2012-10-25\n2012-10-23  -   2012-10-28\n2012-09-14  -   2012-10-28\n</code></pre>\n\n<p>from the following rows:</p>\n\n<pre><code>startDate   -   endDate\n2012-10-25  -   2012-10-25\n2011-09-10  -   2013-11-15\n2012-01-11  -   2012-10-11\n2012-10-20  -   2012-10-25\n2012-04-15  -   2012-04-16\n2012-05-20  -   2012-05-25\n2012-12-01  -   2012-12-10\n2012-10-23  -   2012-10-28\n2012-09-14  -   2012-10-28\n2012-11-13  -   2012-12-15\n</code></pre>\n\n<p>Is this possible with sql?</p>\n\n<p>I am using sql server 2008.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":2,"question_id":13161264,"title":"Arithmetic overflow error converting varchar to data type numeric. '10' <= 9.00","body":"<p>Below is a subset of the kind of table structure and data i'm working with.</p>\n\n<pre><code>CREATE TABLE #Test\n(\n     Val varchar(5)\n    ,Type varchar(5)\n)\n\nINSERT #Test VALUES ('Yes','Text')\nINSERT #Test VALUES ('10','Int')\nINSERT #Test VALUES ('10.00','Float')\nINSERT #Test VALUES ('9.00','Float')\nINSERT #Test VALUES ('9','Int')\n</code></pre>\n\n<p>I want to write a query that will let me know if the column 'Val' is &lt;= 9.00 (must be of numeric data type). I did this by doing the following:</p>\n\n<pre><code>SELECT *\nFROM\n    (\n        SELECT Val\n        FROM #Test\n        WHERE Type = 'Int'\n    ) IntsOnly\nWHERE IntsOnly.Val &lt;= 9.00\n</code></pre>\n\n<p>This gives me an arithmetic overflow error. However, if I exclude the row of data with the value '10':</p>\n\n<pre><code>SELECT *\nFROM\n    (\n        SELECT Val\n        FROM #Test\n        WHERE Type = 'Int'\n        AND Val &lt;&gt; '10'\n    ) IntsOnly\nWHERE IntsOnly.Val &lt;= 9.00\n</code></pre>\n\n<p>It works without any issue. <strong>My question is not how to fix this as I know I can simply convert the data to the format I require.</strong></p>\n\n<p>My question is why the value of '10' in the column 'Val' is returning an error. Surely the logic should just return 'False' and simply exclude the rows because '10' (which I assume is implicitly converted) is greater than 9.00.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sqlperformance"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":19,"score":2,"question_id":13161170,"title":"MSSQL Server 2008 Performance issue with very strange resolution","body":"<p>I'm a long time DBA (12 years in SQL). I'm running sql2008 enterprise in a win 2008 clustered environment. 128gb memory and 32cpu in each cluster node. Not wimpy.</p>\n\n<p>I've got the wierdest performance issue I've seen to date, and its baffling me why it would occur...looking for ideas.</p>\n\n<p>Occasionally, maybe 2-3 times per week, the performance of queries made by the application to the database will come to a crawl. SPs that normally execute in 500ms, suddenly are up arond 50 seconds. Forget about saving data...application .net code will time out before the data even makes the trip.</p>\n\n<p>First time this happened was about 4 weeks ago. I kicked off a profiler so I could see if there were excessive queries or something, and didnt see anything strange. So, I copied one of the batches from the profile and executed it in SSMS. From that moment, the performance was perfect again. Application was snappy and no issues.</p>\n\n<p>Next time it happened, I remembered that just running a batch in ssms seemed to \"fix\" the issue. So I took some benchmarks first and did it again. Same thing. Running ANY batch in SSMS relieves whatever is happening. I have reproduced this about 15-18 times over the past 4 weeks: The application comes to a crawl, and then I run any query in ssms, and all is well.</p>\n\n<p>This is obviously a problem. In order to find out what is running or going on, I have to run a batch--which makes the problem stop. SO the act of trying to observe the issue resolves it. GAH!</p>\n\n<p>Note: There are two clustered instances running on the same node. Only one of the two experiences this issue. And they are roughly the same size in terms of disk space and activity.</p>\n\n<p>Anyone ever seen this?</p>\n"},{"tags":["asp.net","sql","sql-server-2008","c#-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13159468,"title":"Date format Issue in SQL Server or ASP.NET","body":"<p>When I run a stored procedure in SQL Server 2008 CTP I get date <code>\"2012-10-31 00:00:00.000\"</code> with this format. </p>\n\n<p>But when I am converting it using</p>\n\n<pre><code>Convert.ToString(drConversation[\"ConversationDate\"])\n</code></pre>\n\n<p>in C#, I am getting <code>\"10/31/2012 12:00:00 AM\"</code>.</p>\n\n<p>Where should be problem? In C# code or in SQL Server?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","hierarchy"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13158857,"title":"How to query and parse adjacent list hierarchy using cte?","body":"<p>How can I query this parent-child hierarchy to produce a result set in which the levels are in their own columns? Sample data:</p>\n\n<pre><code>SET NOCOUNT ON;\nUSE Tempdb;\n\nIF OBJECT_ID('dbo.Employees', 'U') IS NOT NULL DROP TABLE dbo.Employees;\n\nCREATE TABLE dbo.Employees\n(\n  empid   INT         NOT NULL PRIMARY KEY,\n  mgrid   INT         NULL     REFERENCES dbo.Employees,\n  empname VARCHAR(25) NOT NULL,\n  salary  MONEY       NOT NULL,\n  CHECK (empid &lt;&gt; mgrid),\n  CHECK (empid &gt; 0)\n);\n\nCREATE UNIQUE INDEX idx_unc_mgrid_empid ON dbo.Employees(mgrid, empid);\n\nINSERT INTO dbo.Employees(empid, mgrid, empname, salary) VALUES\n  (1,  NULL, 'David'  , $10000.00),\n  (2,  1,    'Eitan'  ,  $7000.00),\n  (3,  1,    'Ina'    ,  $7500.00),\n  (4,  2,    'Seraph' ,  $5000.00),\n  (5,  2,    'Jiru'   ,  $5500.00),\n  (6,  2,    'Steve'  ,  $4500.00),\n  (7,  3,    'Aaron'  ,  $5000.00),\n  (8,  5,    'Lilach' ,  $3500.00),\n  (9,  7,    'Rita'   ,  $3000.00),\n  (10, 5,    'Sean'   ,  $3000.00),\n  (11, 7,    'Gabriel',  $3000.00),\n  (12, 9,    'Emilia' ,  $2000.00),\n  (13, 9,    'Michael',  $2000.00),\n  (14, 9,    'Didi'   ,  $1500.00);\n\nselect * from dbo.Employees\ngo     \n\n;WITH Tree (empid, mgrid, lv)\nAS (\n\nSELECT empid, mgrid, 1\nFROM Employees\nWHERE mgrid IS NULL \n\nUNION ALL\n\nSELECT E.empid, E.mgrid, lv + 1\nFROM Employees AS E\nJOIN Tree\nON E.mgrid= Tree.empid\n)\nSELECT empid, mgrid, lv\nFROM Tree\nORDER BY Lv, empid\n</code></pre>\n\n<p>The resulting table should have a structure like</p>\n\n<pre><code>+-------+-----+--------+--------+--------+--------+--------+\n| empid | lvl | level1 | level2 | level3 | level4 | level5 |\n+-------+-----+--------+--------+--------+--------+--------+\n|     1 |   1 |      1 | NULL   | NULL   | NULL   | NULL   |\n|     2 |   2 |      1 | 2      | NULL   | NULL   | NULL   |\n|     3 |   2 |      1 | 3      | NULL   | NULL   | NULL   |\n|     4 |   3 |      1 | 2      | 4      | NULL   | NULL   |\n|     5 |   3 |      1 | 2      | 5      | NULL   | NULL   |\n|     6 |   3 |      1 | 2      | 6      | NULL   | NULL   |\n|     7 |   3 |      1 | 3      | 7      | NULL   | NULL   |\n|     8 |   4 |      1 | 2      | 5      | 8      | NULL   |\n|     9 |   4 |      1 | 3      | 7      | 9      | NULL   |\n|    10 |   4 |      1 | 2      | 5      | 10     | NULL   |\n|    11 |   4 |      1 | 3      | 7      | 11     | NULL   |\n|    12 |   5 |      1 | 3      | 7      | 9      | 12     |\n|    13 |   5 |      1 | 3      | 7      | 9      | 13     |\n|    14 |   5 |      1 | 3      | 7      | 9      | 14     |\n+-------+-----+--------+--------+--------+--------+--------+\n</code></pre>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1298,"score":0,"question_id":11801911,"title":"Insert multiple rows into single column","body":"<p>I'm new to SQL, (using SQL 2008 R2) and I am having trouble inserting multiple rows into a single column.</p>\n\n<p>I have a table named <code>Data</code> and this is what I am trying</p>\n\n<pre><code>INSERT INTO Data ( Col1 ) VALUES\n('Hello', 'World')\n</code></pre>\n\n<p>That code was taken from <a href=\"http://stackoverflow.com/questions/452859/inserting-multiple-rows-in-a-single-sql-query\">this</a> question, but it, like many other examples I have found on the web uses 2 columns, I just want to use 1. What am I doing wrong?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","jquery-ajax","asp-classic"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13145967,"title":"Multiple identical AJAX calls","body":"<p>Sorry if the title is inaccurate, but I can't explain the problem in 1 line.</p>\n\n<p>The scenario is this:\nWe have a website showing live statistics calculated by constantly updated values in our SQL Server database. The website updates the stats every 15 seconds via AJAX, where it recalculates every time.\nNow, the problem is, that when over 200 people whats the real time stats it recalculates every 800 times every minute, which pretty much is unnecessary.</p>\n\n<p>It is possible to do 1 calculation every 15 second, and show this 1 calculation to every user when requested by them?</p>\n\n<p>Bare in mind, that some users can have selected to show the data in 1 way, while other users have selected to show the data in another way.</p>\n"},{"tags":["sql-server-2008","tsql","database-performance"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":42,"score":-1,"question_id":13158751,"title":"When is a database considered a 'large database'?","body":"<p>I have a SQL Server 2008 database, with a single table with apprx 50 columns. Primary key is a datetime. No normalisation further possible, it is simply a table storing values from different sensors every couple of seconds, so ints and decimals. \nSo now, for the past month I have close to 560k rows inserted.\nMy question is, when would I start to see performance problems due to too much data? </p>\n\n<p>To be more specific: \nMy requirement so far is to display(in a chart) the last month(not an issue for this question). If I always get from the DB only the last month, a query filtered by the PK(so indexed), does it matter how big the table gets?</p>\n\n<p>Ups, long rant :) Thanks for the input!</p>\n"},{"tags":["sql-server-2008","reporting-services","reportserver","reportmanager"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5468,"score":0,"question_id":1548719,"title":"SQL Server 2008 - The report manager URL shows a page without Properties tab","body":"<p>I have SQL Server 2008 Developer Edition and I'm facing the following issues with the Reporting Services.</p>\n\n<ol>\n<li><p>When I open the Report Manager URL (I get it from the Reporting Services Configuration Manager) in a browser, it shows me a SQL Server Reporting Services page with a folder icon on top left and links with text 'Home', 'My subscriptions', 'Help' on top right. That's it, I don't get to see anything else. \nI have a virtual directory with the same name as specified for Report Manager in Reporting Services Configuration Manager.</p></li>\n<li><p>Opening the Report Server in the browser gives the following error message-</p>\n\n<p><em>Reporting Services Error\n    The report server cannot open a connection to the report server database. A connection to the database is required for all requests and processing. (rsReportServerDatabaseUnavailable) Get Online Help\n    A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Shared Memory Provider, error: 40 - Could not open a connection to SQL Server)</em></p></li>\n</ol>\n\n<p>I tried the following at the command prompt in order to resolve it-</p>\n\n<pre><code>rsconfig -c -s &lt;SQLSERVERNAME&gt; -d reportserver -a Windows -u &lt;MYDOMAIN\\MYACCOUNT&gt; -p &lt;PASSWORD&gt;\n</code></pre>\n\n<p>but I got another error saying <code>Report Server WMI Provider error: Invalid namespace</code></p>\n\n<p>I would really appreciate any help on this.</p>\n\n<p>cheers</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13158956,"title":"UDF performance suddenly degraded","body":"<p>SQL Server 2008 R2</p>\n\n<p>I know this is a common problem (eg: <a href=\"http://connect.microsoft.com/SQLServer/feedback/details/524983/user-defined-function-performance-is-unacceptable\" rel=\"nofollow\">http://connect.microsoft.com/SQLServer/feedback/details/524983/user-defined-function-performance-is-unacceptable</a>) - but ive only just learned of it.</p>\n\n<p>We have a live production database that has performed fine for months, specifically a stored procedure that contains a large CTE that selects into a table variable. Then, based on a parameter on the procedure - data is selected from the table variable in various ways (column sequence, order by clause etc).</p>\n\n<p>This temporary table only has a few hundred rows inserted into it from the CTE - the source data is huge, but the resulting rows are always low in number)</p>\n\n<p>The select satements used on the table variable use 2 very simple UDF's:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[format_timeV2] ( @Time INT )\nRETURNS VARCHAR(20)\nAS \n    BEGIN\n        DECLARE @Time_Varchar VARCHAR(20)\n        SET @Time_Varchar = CONVERT(VARCHAR, @Time / 3600) + 'h ' + CONVERT(VARCHAR, ROUND(( ( CONVERT(FLOAT, ( @Time % 3600 )) ) / 3600 ) * 60, 0)) + 'm'\n        RETURN @Time_Varchar\n    END\nGO\n</code></pre>\n\n<p>And</p>\n\n<pre><code>CREATE FUNCTION [dbo].[udf_WeekEndDate] ( @Date DATETIME )\nRETURNS DATETIME\nAS \n    BEGIN\n        RETURN DATEADD(DAY, 7, CONVERT(DATETIME, CONVERT(VARCHAR(10), DATEADD(day, -1 - ( DATEPART(dw, @Date) + @@DATEFIRST - 2 ) % 7, @Date), 103) + ' 23:59:59', 103))\n    END\nGO\n</code></pre>\n\n<p>These UDF's have been working fine for months, if not years, the stored procedure in question has ALWAYS ran in under 6 seconds - but as soon as the UDF's above are included on the SELECT statement of the table variable the procedure takes MINUTES!</p>\n\n<p>As soon as we comment out the usage of these functions it returns to executing in 3-6 seconds.</p>\n\n<p>These functions are only being used on the <code>SELECT</code> from <code>@TableVar</code> statement (few hundred rows) - so i dont see why the query optimiser if struggling here?!?!</p>\n\n<p>If we run the following - the UDF's and procedure start to work normally again:</p>\n\n<pre><code>DBCC FreeProcCache\nDBCC DropCleanbuffers\n</code></pre>\n\n<p>So i can only assume the query optimiser is doing something stupid in the background - but it's not clear on the execution plan as to what it is.</p>\n\n<p>I have tried recreating the proc with <code>RECOMPILE</code> - this didnt help, only <code>FreeProcCache</code> &amp; <code>DropCleanbuffers</code> helped.</p>\n\n<p>Any ideas what the root cause of this? we dont really want to go re-writing all the UDFs as table valued function (which i understand is a work around for this problem) as this is a live production database which has been working fine for years.</p>\n\n<p><strong>EDIT 1:</strong> Blam requested detail of the actual query that hangs:</p>\n\n<pre><code>    IF @ModeInt = 2 \n        SELECT  [DET_NUMBERA] ,\n                [Name] ,\n                [Branch] ,\n                COUNT(*) OVER ( PARTITION BY [DET_NUMBERA] ) AS RowsForThisEmployee ,\n                CONVERT(VARCHAR(10), dbo.udf_WeekEndDate([Date]), 103) AS [WeekEnding] ,\n                [Date] ,\n                [Start Time] ,\n                [End Time] ,\n                [Duration] ,\n                dbo.format_timeV2([Duration] * 60) AS [DurationF] ,\n                [EntryCount] ,\n                [EntryColour] ,\n                [DurationColour] ,\n                [DurationComment]\n        FROM    @CompletedData\n        WHERE   [EntryCount] = 0\n        ORDER BY [DET_NUMBERA] ,\n                [Date] ,\n                [Start Time]\n\n    IF @ModeInt = 3 \n        SELECT  [DET_NUMBERA] ,\n                [Name] ,\n                [Branch] ,\n                COUNT(*) OVER ( PARTITION BY [DET_NUMBERA] ) AS RowsForThisEmployee ,\n                CONVERT(VARCHAR(10), dbo.udf_WeekEndDate([Date]), 103) AS [WeekEnding] ,\n                [Date] ,\n                [Start Time] ,\n                [End Time] ,\n                [Duration] ,\n                dbo.format_timeV2([Duration] * 60) AS [DurationF] ,\n                [EntryCount] ,\n                [EntryColour] ,\n                [DurationColour] ,\n                [DurationComment]\n        FROM    @CompletedData\n        WHERE   [EntryCount] &gt; 1\n        ORDER BY [DET_NUMBERA] ,\n                [Date] ,\n                [Start Time]\n</code></pre>\n\n<p>The temp table doesnt have an index (didnt think it was needed as it only ever contains 100 - 200 rows:</p>\n\n<pre><code>    DECLARE @CompletedData TABLE\n        (\n          [DET_NUMBERA] VARCHAR(7) ,\n          [Name] VARCHAR(255) ,\n          [Branch] VARCHAR(3) ,\n          [Date] DATE ,\n          [Start Time] TIME(0) ,\n          [End Time] TIME(0) ,\n          [Duration] INT ,\n          [EntryCount] INT ,\n          [EntryColour] VARCHAR(15) ,\n          [DurationColour] VARCHAR(15) ,\n          [DurationComment] VARCHAR(65)\n        )\n</code></pre>\n\n<p>The CTE populates the table in 3 seconds, its only the above SELETS that make use of UDF's that hang, if i remove the UDF's from the SELECT it works instantly.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13157708,"title":"Parsing error when creating view","body":"<p>I have a view which takes multiple rows and Comma Separated Values (CSV) from table columns with data. </p>\n\n<p>It was working well and I got the results that I needed. Now the view has some parsing error like:</p>\n\n<blockquote>\n  <p>Error in WHERE clause near '('. Unable to parse query text.</p>\n</blockquote>\n\n<p>Can someone help? Here is my code:</p>\n\n<pre><code>SELECT dbo.table1.title,\n       Stuff((SELECT ', ' + CONVERT(NVARCHAR(4000), dbo.table3.uid) AS [text()]\n              FROM   dbo.table2\n                     INNER JOIN dbo.table3\n                       ON dbo.table3.uid = dbo.table2.FK_Group\n              WHERE  dbo.table3.uid = dbo.table2.FK_Group\n                     AND dbo.table3.company = dbo.main.company\n                     AND dbo.table2.FK_Version = dbo.table1.fk_Version\n                     AND dbo.main_version.uid = dbo.table1.fk_Version\n              FOR XML PATH('')), 1, 1, '') AS groupName\nFROM   dbo.main_version\n       INNER JOIN dbo.[main]\n         ON dbo.version.fk_main = dbo.[main].uid\n       INNER JOIN dbo.main_schema\n         ON dbo.[main].fk_SCHEMA = dbo.main_schema.uid\n       INNER JOIN dbo.table1\n         ON dbo.version.uid = dbo.table1.fk_Version\nWHERE  ( dbo.main_version.active = 1 )\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":13143090,"title":"showing results of multiple queries in one table","body":"<p>In sql, one query gets one column, other query gets another column and so on, I want to show these multiple columns in one table as multiple columns.</p>\n\n<p>For example: \nQuery1 gives column 'EmployeeId' .........\nQuery2 gives column 'EmployeeName' .......\nQuery3 gives column 'EmployeeAddress'</p>\n\n<p>Now I want to show these three columns in one table like\ntable1 has columns 'EmployeeId', 'EmployeeName' and 'EmployeeAddress'</p>\n\n<p>Since in both Queries it is ORDER BY EmployeeId in increasing order, so in final table (table1 here) it gives corresponding Id, name and address.</p>\n"},{"tags":["sql","sql-server-2008","tsql","parsing"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13122997,"title":"T-SQL: Parsing names to ignore spaces and middle initials","body":"<p>I have a poorly maintained database that includes employee information.  Human Resources requested a report that lists instances where the employee name associated with an insurance coverage does not match the name on the insurance policy.  </p>\n\n<p>There are inconsistencies in the formatting of the names in both tables.  It's always last name then first name, but you might see any of the following in either table for a fictional employee named Steven J. Smith:</p>\n\n<ol>\n<li>Smith, Steven</li>\n<li>Smith,Steven</li>\n<li>Smith, Steven J.</li>\n<li>Smith,Steven J.</li>\n</ol>\n\n<p>I need to run a query looking for instances where EMPLOYEE.EMP_NAME &lt;> INSURANCE.SUBSCRIBER_NAME while allowing for differences in name formatting as shown above (i.e. picking up that \"Smith,Steven J.\" and \"Smith, Steven\" are (probably) the same person and igonring them).  </p>\n\n<pre><code>SELECT \n  EMPLOYEE.EMP_NO\n, EMPLOYEE.EMP_NAME\n, INSURANCE.SUBSCRIBER_NAME\n, INSURANCE.PAYOR_NAME\n\nFROM EMPLOYEE\n     INNER JOIN INSURANCE ON EMPLOYEE.EMP_NO = INSURANCE.EMP_NO\n\nWHERE EMPLOYEE.EMP_NAME &lt;&gt; INSURANCE.SUBSCRIBER_NAME\n</code></pre>\n\n<p>I know I want to do a substring to ignore the middle initial, but how do I account for ignoring whether or not there is a space after the comma?  </p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":61,"score":0,"question_id":13157750,"title":"Meaning of ; in queries","body":"<p>What is the meaning of ; at the end of queries?</p>\n\n<p>For example; what is the difference between:</p>\n\n<pre><code>select 1\nselect 2\n</code></pre>\n\n<p>and </p>\n\n<pre><code>select 1;\nselect 2\n</code></pre>\n"},{"tags":["sql-server-2008","table","stored-procedures","sync"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12853897,"title":"how to sync only tables and stored procedures between two sql server 2008 databases (NOT DATA)","body":"<p>I have two instances of my application database, one is on local server for testing purposes with some dummy data and the other is one is on online server. The thing that is common between both is the stored procedures, functions &amp; tables, so very often i have to move stored procedures and tables from my local server database to online server database.</p>\n\n<p>Is there any way to sync the database properly? rather than generating scripts than executing them manually.</p>\n\n<p>I'm using SQL Server 2008.</p>\n"},{"tags":["c#","sql","sql-server-2008","csv","sqlcmd"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13157514,"title":"Split and Export a Database Table Based on Size","body":"<p>All, I have developed an export mechanism to allow the selected tables from a givem database to be exported to .csv files; I can do this using <code>bcp</code> or <code>sqlcmd</code>. For large tables (> 1-2GB), I want to split the tables into serveral .csv files of a predetermined, user specifeid size (say 200MB).</p>\n\n<p>How can I determine the number of rows that make up the users specified size? This is so I can use a <code>sqlcmd</code> command like the following</p>\n\n<pre><code>DECLARE @sql VARCHAR(8000);\nSELECT @sql = 'sqlcmd -S' + @@SERVERNAME + ' -E -Q ' + \n              '\"SELECT * FROM Ia.dbo.[Episode];\" -o \"F:\\aaData\\Test2.csv\" -s\",\" -W';\nEXEC master..xp_cmdshell @sql;\n</code></pre>\n\n<p>with a <code>TOP N</code> clause to get the correct split .csv size. I may have to count the rows using a batch read, or is there a better way to do this?</p>\n\n<p>Thanks for your time.</p>\n"},{"tags":["sql-server-2008","indexing","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13155530,"title":"Optimize query with temp and while loop and lots of select statement within loop","body":"<p>I want to improve the performance of the query which has the records in temp table and am using while loop to access each row from temp table and use it accordingly but there are lots of check in the while loop for which many select statements are there so when there are lots of records say above 300-400, then it takes time as the table for which select statements are used contains records in thousands.</p>\n\n<p>Indexing will slow down the insert DML operations so what all things that can be done here.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","database-backups"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13137815,"title":"SQL Server backup devices","body":"<p>I'm trying to find out how to detect if a backup device exists using T-SQL.</p>\n\n<p>This is how I create my backup device:</p>\n\n<blockquote>\n  <p>EXEC master.dbo.sp_addumpdevice @devtype = N'disk', @logicalname =\n  N'TestTest', @physicalname = N'C:\\Program Files\\Microsoft SQL\n  Server\\MSSQL10_50.PTC_SQLPROD\\MSSQL\\Backup\\TestTest.bak'</p>\n</blockquote>\n\n<p>but I can't find how to detect if it already exists first.</p>\n"},{"tags":[".net","asp.net-mvc","asp.net-mvc-3","sql-server-2008","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13156594,"title":"in MVC3 how to recreate the EdmMetaData Table in Sql Server?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/11215035/mvc3-edmmetadata-table-not-found\">MVC3 EDMmetadata table not found</a>  </p>\n</blockquote>\n\n\n\n<p>I downloaded the MvcMusicStore example from <a href=\"http://mvcmusicstore.codeplex.com\" rel=\"nofollow\">mvcmusicstore.codeplex.com</a> \nand I have deleted the EdmMetaData Table.</p>\n\n<p>Everytime that I run it, I get this error...</p>\n\n<blockquote>\n  <p>\"Model compatibility cannot be checked because the database does not\n  contain model metadata. Ensure that IncludeMetadataConvention has been\n  added to the DbModelBuilder conventions.\"</p>\n</blockquote>\n\n<p>how can I recreate that table?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":25,"score":-1,"question_id":13156295,"title":"Timout when Selecting or Deleting a specific row","body":"<p>When executing a select or delete statement on a specific row in a table I get a timeout exception.</p>\n\n<p>How can I delete said row without using a delete statement?</p>\n"},{"tags":["sql","sql-server-2008","compression"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13155630,"title":"PAGE compression in SQL Server effect on running queries","body":"<p>I am planning to apply PAGE compression to some of the big tables in my database (DW to be precise). These tables are fairly big with over 15 Billion rows. When I applied the compression in test environment, the whole process took around 22 hours.These tables are accessed daily with quite long running queries.  My questions are</p>\n\n<ol>\n<li>While the compression is being applied would there be any affect on the queries that are running? Any lock etc I should be aware of?</li>\n<li>Is there a staggered approach to applying compression? </li>\n</ol>\n\n<p>3.Any other input/feedback you might have?</p>\n\n<p>many thanks</p>\n\n<p>Sean</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13155123,"title":"How skip id's from parent table on base of child table values","body":"<p>I have two tables</p>\n\n<pre><code>table1  \n\nides    name\n\n1001    AA\n1002    BB\n1003    CC\n\n\ntable2      \n\nides    posi    cwawr\n\n1001    2   xyz\n1001    4   lmn\n1001    6   abc\n1002    2   ijk\n1002    4   lmo\n1002    6   pqr\n1003    2   xyz\n1003    4   sfs\n</code></pre>\n\n<p>in both above table i want to select the all ides of table1 where the posi not equal to 2 and cwawr not equal to xyz. for example 1001 posi has 2 and cwawr has xyz so this id should be skip. same 1003 also have posi value 2 and cwawr has xyz so it also should be skip.</p>\n\n<p>so in result it should be </p>\n\n<pre><code>1002 \n</code></pre>\n\n<p>only.</p>\n\n<p>Thanks in advance,\nEshwer</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13075527,"title":"How to display data like Blogspot's BlogArchive in time order using asp.net C#","body":"<p>How can I display data entry on my aspx page like Blogspot's BlogArchive in time order?</p>\n\n<p>I think basically the database including a table with columns: Entry, Year, Month, Day so that we can display data like what I mean.\n(check link: <a href=\"http://i160.photobucket.com/albums/t194/perakit/mess/BlogArchive.jpg\" rel=\"nofollow\">http://i160.photobucket.com/albums/t194/perakit/mess/BlogArchive.jpg</a>)</p>\n\n<p>Note: I use SQL Server 2008 and Visual Studio 2008, asp.net C# for my project.</p>\n\n<p>Best thanks and appreciated for all replies.</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13150915,"title":"SQL - Average number of records within a time period","body":"<p>I'm trying to compile some lifetime value information for customers within one of our databases.</p>\n\n<p>We have an MS SQL Server database which stores all of our customer/transactional information.</p>\n\n<p>My issue is that I don't have much experience when it comes to MS SQL Server (or SQL in general) - I'd like to be able to run a query against the database that pulls AVG number of loans, and AVG revenue based on three criteria:</p>\n\n<p>1.) Loans be counted if they are 'approved'\n2.) Loans from a customer_id only be counted if the first loan (first identified by date_created field) be on or after a certain 'mm/yyyy'\n3.) I'm able to specify for how many months after the first 'mm/yyyy' to tally the number of loans / revenue to be included within the AVG</p>\n\n<p>Here is what the database would look like:</p>\n\n<pre><code>customer_id   | loan_status | date_created      | revenue\n111       | 'approved'  | 2010-06-20 17:17:09   | 100.00\n222       | 'approved'  | 2010-06-21 09:54:43   | 255.12\n333       | 'denied'    | 2011-06-21 12:47:30   | NULL\n333       | 'approved'  | 2011-06-21 12:47:20   | 56.87\n222       | 'denied'    | 2011-06-21 09:54:48   | NULL\n222       | 'approved'  | 2011-06-21 09:54:18   | 50.00\n111       | 'approved'  | 2011-06-20 17:17:23   | 100.00\n... loads' of records ...\n555       | 'approved'  | 2012-01-02 09:08:42   | 24.70\n111       | 'denied'    | 2012-01-05 02:10:36   | NULL\n666       | 'denied'    | 2012-02-05 03:31:16   | NULL\n555       | 'approved'  | 2012-02-17 09:32:26   | 197.10\n777       | 'approved'  | 2012-04-03 18:28:45   | 300.50\n777       | 'approved'  | 2012-06-28 02:42:01   | 201.80\n555       | 'approved'  | 2012-06-21 22:16:59   | 10.00\n666       | 'approved'  | 2012-09-30 01:17:20   | 50.00\n</code></pre>\n\n<p>If I wanted to find the avg transaction count (approved transactions), and average revenue per approved transaction for all customer's who's <strong>first</strong> loan was in/after 2012-01, and for a period of 4 months after then, how would I go about querying the database?</p>\n\n<p>Any help is greatly appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13153235,"title":"Dynamic backup file name","body":"<p>I use <code>SQL Server 2008 R2</code> and want to use <code>Backup Devices</code> for create backup of my database in each day. How can I create dynamic file name in `Backup Devices'.</p>\n\n<p>In below code I Create a Backup Devices but want to have Current Date (YYYY-MM-DD) in my backup file.</p>\n\n<pre><code>EXEC master.dbo.sp_addumpdevice  @devtype = N'disk', @logicalname = N'My Database Backup Location', @physicalname = N'D:\\Backup\\Backup YYYY-MM-DD.bak'\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["php","android","json","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":70,"score":-1,"question_id":13119310,"title":"Android Error parsing data org.json.JSONException: End of input at character 0 of","body":"<p>i got an error when i stored some parameters to php server. i used mssql server as database storage. here my log when i run my apps.</p>\n\n<pre><code>10-29 16:38:23.523: E/Buffer Error(4721): Error converting result java.lang.NullPointerException\n10-29 16:38:23.523: E/JSON Parser(4721): Error parsing data org.json.JSONException: End of input at character 0 of \n10-29 16:38:23.527: W/dalvikvm(4721): threadid=11: thread exiting with uncaught exception (group=0x40e91300)\n10-29 16:38:23.531: E/AndroidRuntime(4721): FATAL EXCEPTION: AsyncTask #1\n10-29 16:38:23.531: E/AndroidRuntime(4721): java.lang.RuntimeException: An error occured while executing doInBackground()\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at android.os.AsyncTask$3.done(AsyncTask.java:299)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.FutureTask$Sync.innerSetException(FutureTask.java:273)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.FutureTask.setException(FutureTask.java:124)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:307)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.FutureTask.run(FutureTask.java:137)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:230)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1076)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:569)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.lang.Thread.run(Thread.java:856)\n10-29 16:38:23.531: E/AndroidRuntime(4721): Caused by: java.lang.NullPointerException\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at com.example.androidsql.NewProductActivity$CreateNewProduct.doInBackground(NewProductActivity.java:345)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at com.example.androidsql.NewProductActivity$CreateNewProduct.doInBackground(NewProductActivity.java:1)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at android.os.AsyncTask$2.call(AsyncTask.java:287)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:305)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     ... 5 more\n10-29 16:38:23.715: W/IInputConnectionWrapper(4721): showStatusIcon on inactive InputConnection\n10-29 16:38:24.496: E/WindowManager(4721): Activity com.example.androidsql.NewProductActivity has leaked window com.android.internal.policy.impl.PhoneWindow$DecorView@417ebf98 that was originally added here\n10-29 16:38:24.496: E/WindowManager(4721): android.view.WindowLeaked: Activity com.example.androidsql.NewProductActivity has leaked window com.android.internal.policy.impl.PhoneWindow$DecorView@417ebf98 that was originally added here\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.ViewRootImpl.&lt;init&gt;(ViewRootImpl.java:374)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:292)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:224)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.WindowManagerImpl$CompatModeWrapper.addView(WindowManagerImpl.java:149)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.Window$LocalWindowManager.addView(Window.java:547)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.app.Dialog.show(Dialog.java:277)\n10-29 16:38:24.496: E/WindowManager(4721):  at com.example.androidsql.NewProductActivity$CreateNewProduct.onPreExecute(NewProductActivity.java:305)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.os.AsyncTask.executeOnExecutor(AsyncTask.java:586)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.os.AsyncTask.execute(AsyncTask.java:534)\n10-29 16:38:24.496: E/WindowManager(4721):  at com.example.androidsql.NewProductActivity$6.onClick(NewProductActivity.java:186)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.View.performClick(View.java:4084)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.View$PerformClick.run(View.java:16966)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.os.Handler.handleCallback(Handler.java:615)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.os.Handler.dispatchMessage(Handler.java:92)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.os.Looper.loop(Looper.java:137)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.app.ActivityThread.main(ActivityThread.java:4745)\n10-29 16:38:24.496: E/WindowManager(4721):  at java.lang.reflect.Method.invokeNative(Native Method)\n10-29 16:38:24.496: E/WindowManager(4721):  at java.lang.reflect.Method.invoke(Method.java:511)\n10-29 16:38:24.496: E/WindowManager(4721):  at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:786)\n10-29 16:38:24.496: E/WindowManager(4721):  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:553)\n10-29 16:38:24.496: E/WindowManager(4721):  at dalvik.system.NativeStart.main(Native Method)\n</code></pre>\n\n<p>and this is my method in android to send the parameters :</p>\n\n<pre><code>    class CreateNewProduct extends AsyncTask&lt;String, String, String&gt; {\n\n        /**\n         * Before starting background thread Show Progress Dialog\n         * */\n        @Override\n        protected void onPreExecute() {\n            super.onPreExecute();\n            pDialog = new ProgressDialog(NewProductActivity.this);\n            pDialog.setMessage(\"Loading, saving data...\");\n            pDialog.setIndeterminate(false);\n            pDialog.setCancelable(true);\n            pDialog.show();\n        }\n\n        /**\n         * Creating data\n         * */\n        protected String doInBackground(String... args) {\n            slongitude = longitude.getText().toString();\n            slatitude = latitude.getText().toString();\n            smerchant = merchant.getText().toString();\n            salamat = alamat.getText().toString();\n            stelp = telp.getText().toString();\n            shp = hp.getText().toString();\n            sbb = bb.getText().toString();\n            semail = email.getText().toString();\n\n            // Building Parameters\n            List&lt;NameValuePair&gt; params = new ArrayList&lt;NameValuePair&gt;(12);\n            params.add(new BasicNameValuePair(\"longitude\", slongitude));\n            params.add(new BasicNameValuePair(\"latitude\", slatitude));\n            params.add(new BasicNameValuePair(\"merchant\", smerchant));\n            params.add(new BasicNameValuePair(\"alamat\", salamat));\n            params.add(new BasicNameValuePair(\"telp\", stelp));\n            params.add(new BasicNameValuePair(\"hp\", shp));\n            params.add(new BasicNameValuePair(\"bb\", sbb));\n            params.add(new BasicNameValuePair(\"email\", semail));\n            params.add(new BasicNameValuePair(\"Fk_Ms_DataLevel2_ID\", \"1\"));\n            params.add(new BasicNameValuePair(\"Fk_Ms_City_ID\", \"2\"));\n            params.add(new BasicNameValuePair(\"Fk_Ms_Sales_ID_CreatedBy\", \"3\"));\n            params.add(new BasicNameValuePair(\"FK_Ms_Sales_ID_LastUpdateBy\", \"4\"));\n\n            // getting JSON Object\n            // Note that create product url accepts POST method\n            JSONObject json = jsonParser.makeHttpRequest(url_create_merchant,\n                    \"POST\", params);\n\n            // check log cat fro response\n            Log.d(\"Create Response\", json.toString());\n\n            // check for success tag\n            try {\n                int success = json.getInt(TAG_SUCCESS);\n\n                if (success == 1) {\n                    // successfully created product\n                    Log.d(\"Berhasil\", \"Good\");\n                    Toast.makeText(ctx, \"Berhasil\", Toast.LENGTH_SHORT).show();\n                    // closing this screen\n                    finish();\n                } else {\n                    // failed to create product\n                }\n            } catch (JSONException e) {\n                e.printStackTrace();\n                Log.d(\"Gagal\", e.toString());\n            }\n            return null;\n        }\n\n        /**\n         * After completing background task Dismiss the progress dialog\n         * **/\n        protected void onPostExecute(String file_url) {\n            // dismiss the dialog once done\n            pDialog.dismiss();\n        }\n    }\n</code></pre>\n\n<p>and this is my php code in server :</p>\n\n<pre><code>    &lt;?php\n\n$response = array();\n\n$dsn='sqlserver';\n$username='street'; \n$password='keymaker';\nprint_r($_POST);\n$koneksi= odbc_connect($dsn,$username,$password);\n\nif (isset($_POST['Fk_Ms_DataLevel2_ID']) &amp;&amp; isset($_POST['Fk_Ms_City_ID']) &amp;&amp; isset($_POST['Fk_Ms_Sales_ID_CreatedBy']) &amp;&amp; isset($_POST['FK_Ms_Sales_ID_LastUpdateBy']) &amp;&amp; isset($_POST['CreatedDated']) &amp;&amp; isset($_POST['LastUpdateDated']) &amp;&amp;\n    isset($_POST['longitude']) &amp;&amp; isset($_POST['latitude']) &amp;&amp; isset($_POST['merchant']) \n    &amp;&amp; isset($_POST['alamat']) &amp;&amp; isset($_POST['telp']) &amp;&amp; isset($_POST['hp']) &amp;&amp; isset($_POST['bb']) &amp;&amp; isset($_POST['email']) &amp;&amp; isset($_POST['Is_Deleted'])) {\n\n    $Fk_Ms_DataLevel2_ID = $_POST['Fk_Ms_DataLevel2_ID'];\n    $Fk_Ms_City_ID = $_POST['Fk_Ms_City_ID'];\n    $Fk_Ms_Sales_ID_CreatedBy = $_POST['Fk_Ms_Sales_ID_CreatedBy'];\n    $FK_Ms_Sales_ID_LastUpdateBy = $_POST['FK_Ms_Sales_ID_LastUpdateBy'];\n    //$CreatedDated = $_POST['CreatedDated'];\n    //$LastUpdateDated = $_POST['LastUpdateDated'];\n    $longitude = $_POST['longitude'];\n    $latitude = $_POST['latitude'];\n    $merchant = $_POST['merchant'];\n    $alamat = $_POST['alamat'];\n    $telp = $_POST['telp'];\n    $hp = $_POST['hp'];\n    $bb = $_POST['bb'];\n    $email = $_POST['email'];\n    //$Is_Deleted = $_POST['Is_Deleted'];\n\n    $query = \"INSERT INTO Ms_Merchant(Fk_Ms_DataLevel2_ID, Fk_Ms_City_ID, Fk_Ms_Sales_ID_CreatedBy, FK_Ms_Sales_ID_LastUpdateBy, Longitude, Latitude, Descriptions, Address, Telpon, Handphone, BB_PIN, email) \n            VALUES('$Fk_Ms_DataLevel2_ID', '$Fk_Ms_City_ID', '$Fk_Ms_Sales_ID_CreatedBy', '$FK_Ms_Sales_ID_LastUpdateBy', '$longitude', '$latitude', '$merchant', '$alamat', '$telp', '$hp', '$bb', '$email')\";\n    $result = odbc_exec($koneksi, $query);\n\n    if ($result) {\n        // successfully inserted into database\n        $response[\"success\"] = 1;\n        $response[\"message\"] = \"Product successfully created.\";\n\n        // echoing JSON response\n        echo json_encode($response);\n    } else {\n        // failed to insert row\n        $response[\"success\"] = 0;\n        $response[\"message\"] = \"Oops! An error occurred.\";\n\n        // echoing JSON response\n        echo json_encode($response);\n    }\n} else {\n    // required field is missing\n    $response[\"success\"] = 0;\n    $response[\"message\"] = \"Required field(s) is missing\";\n\n    // echoing JSON response\n    echo json_encode($response);\n}\n?&gt;\n</code></pre>\n\n<p>beside that error, i got an error <code>android.view.WindowLeaked: Activity has leaked window that was originally added here</code>. i need your opinions, advices, links and all of your helps. thank you very much.</p>\n"},{"tags":["asp.net","sql","sql-server-2008","iis-7.5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":13152746,"title":"How to grant IIS APPPOOL\\DefaultAppPool access to stored procedures in Asp.net using IIS?","body":"<p>Here is the error message I get, \"The EXECUTE permission was denied on the object 'GetDepartments', database 'BalloonShop', schema 'dbo\"</p>\n\n<p>I was able to workaround it by configuring sql server 2008 and making IIS APPPOOL\\DefaultAppPool a dbowner aside from datawriter and datareader, the problem is there are some security issues with it according to some articles that I found online. </p>\n\n<p>How do I allow  IIS APPPOOL\\DefaultAppPool to have access to all stored procs in my current database?(or in any database)</p>\n\n<p>(It would be nice if you could provide links/ script)</p>\n\n<p>Sir/Ma'am your answers would be of great help. Thank you++</p>\n"},{"tags":["sql-server-2008","ssis","unique-constraint"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13152183,"title":"insert data based on existing data","body":"<p>I have a table which has column like (CId, Source). Value for source can be (0,1,2,3). Now Table should have only two records for a CId.</p>\n\n<ol>\n<li>CId = 'X' and Source = 0</li>\n<li>CId = 'X' and Source = 1 (can be 2 or 3 as well)</li>\n</ol>\n\n<p>After this, if any other records comes (X,2) (X,3) should not be inserted.</p>\n\n<p>Keeping in mind the above constraints, I want to insert records into the table from a source file.\nI am using SSIS package to load the file.</p>\n"},{"tags":["c#","winforms","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":106,"score":0,"question_id":11638307,"title":"Single application multiple users through thin client","body":"<p>I have an application built in c# Winforms. In the back end I am using SQL Server 2008 Express. And I am using the application remotely through thin clients. My operating system is Windows server 2008.</p>\n\n<p>My problem is that when one user is using my software, if a 2nd user opens the software and tries to make any operation with the database, the database refuses to connect with the error </p>\n\n<blockquote>\n  <p>Cannot open the database 'database name' specified by login. Login\n  failed. Login failed for user \\windows username`.</p>\n</blockquote>\n\n<p>If the first user closes the application, then the second user can easily operate the database queries.</p>\n\n<p>Please help!!!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13137052,"title":"Error in running scheduled Job. Where to find error details","body":"<p>I want to delete row in SQL database when a column value matches with current date.\nI have created a scheduled job for deletion of data using SQL Server Management Studio. I have followed step as shown in <a href=\"http://www.youtube.com/watch?v=De_GOwnTDjo\" rel=\"nofollow\">Video</a> \nHere Type of script is T-SQL and command I have given is:</p>\n\n<pre><code>Delete from NewDB.dbo.Datetabel where Date=getDate();\nCOMMIT\n</code></pre>\n\n<p>I want to schedule this job on daily basis. But now for testing purpose I have given on hourly basis. But this job is failed.</p>\n\n<p>Where will I get the details of Error. I am working on sql2008 r2</p>\n\n<p>What should be reason for failure?\nEdited:\nNow job is getting success when code is  changed as:</p>\n\n<pre><code>BEGIN TRAN \nDelete from NewDB.dbo.Datetabel where Date=getDate();\nCOMMIT;\n</code></pre>\n\n<p>But Data is not deleted from the tabel.\nWhat may be issue now?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13151782,"title":"A network-related or instance-specific error occurred while establishing a connection to SQL Server","body":"<p>I have 2 applications, one is using Enterprise Library and second is using <code>asp:SqlDataSource</code> control to connect to the database. In the second application I am able to connect to the database. However in the first application where I am using Enterprise Library I am not able to connect to the database and I keep getting the following error</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while establishing a   connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: Named\n  Pipes Provider, error: 40 - Could not open a connection to SQL Server)</em></p>\n</blockquote>\n\n<p>Also I am able to connect to the database using SQL Server 2008 client</p>\n\n<p>Connection string</p>\n\n<pre><code>&lt;add name=\"Connection String\" \n     connectionString=\"Data Source=inblrgescintra\\intranet;Initial Catalog=Intranet1.0;Persist Security Info=True;uid=***;pwd=*****;Integrated Security=False;\" \n     providerName=\"System.Data.SqlClient\"/&gt;\n</code></pre>\n\n<p>Please help me</p>\n"},{"tags":["c#","sql-server-2008","ado.net","transactions"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13151775,"title":"Do many SavePoints within a SqlTransaction slow the transaction?","body":"<p>I am looping through a batch of records in a single transaction using ADO.Net/C# against SQL Server 2008 R2. By using SavePoints I am able to rollback only a single record inside the batch without affecting other records in this batch. My code is as given below. My question is: There are 2000 savepoints created within the single transaction, and I am not sure whether this large number of savepoints will negatively affect performance of transaction?</p>\n\n<pre><code>        SqlTransaction transaction = null;\n        SqlConnection connection = null;\n        try\n        {\n            connection = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings[\"RadControlsWinFormsApp2.Properties.Settings.PracticeConnectionString\"].ConnectionString);\n\n            int i = 0;\n            connection.Open();\n\n            transaction = connection.BeginTransaction(\"SampleTransaction\");\n\n            while (i &lt; 2000)\n            {\n                try\n                {\n                    i++;\n                    transaction.Save(\"DetailSavePoint\" );\n                    SqlCommand cmd1 = new SqlCommand(\"Insert into Persons (FirstName,LastName) values (@firstName, @lastName)\", connection);\n                    cmd1.CommandType = System.Data.CommandType.Text;\n                    cmd1.Transaction = transaction;\n                    cmd1.Parameters.AddWithValue(\"@firstName\", \"Mike\" + i);\n                    cmd1.Parameters.AddWithValue(\"@lastName\", \"Clark\" + i);\n                    cmd1.ExecuteNonQuery();\n\n                    if (i == 4 || i == 7 || i==1000)\n                    {\n                        string x = null;\n                        string y = x.Trim();\n                    }\n                    SqlCommand cmd2 = new SqlCommand(\"Insert into Countries (CountryName,Continent) values (@countryName, @continent)\", connection);\n                    cmd2.CommandType = System.Data.CommandType.Text;\n                    cmd2.Transaction = transaction;\n                    cmd2.Parameters.AddWithValue(\"@countryName\", \"Country\" + i);\n                    cmd2.Parameters.AddWithValue(\"@continent\", \"Continent\" + i);\n                    cmd2.ExecuteNonQuery();\n                }\n                catch (Exception exInner)\n                {\n                    //log the error for this detail record into a text file\n                    //roll back Only this detail record\n                    try\n                    {\n                        transaction.Rollback(\"DetailSavePoint\" );\n\n                        //RadMessageBox.Show(\"We have rolled back detail record for \" + i, \"Transaction Save Point\");\n                    }\n                    catch\n                    {\n                    }\n                }\n            }\n\n            // Attempt to commit the transaction.\n            transaction.Commit();\n            RadMessageBox.Show(\"We have committed the batched transaction.\", \"Transaction Committed\");\n        }\n        catch (Exception ex)\n        {\n\n            // Attempt to roll back the transaction. \n            try\n            {\n                transaction.Rollback();\n                RadMessageBox.Show(\"We have rolledback the batched transaction.\", \"Transaction Rolledback\");\n            }\n            catch (Exception ex2)\n            {\n                // This catch block will handle any errors that may have occurred \n                // on the server that would cause the rollback to fail, such as \n                // a closed connection.\n                // Console.WriteLine(\"Rollback Exception Type: {0}\", ex2.GetType());\n                // Console.WriteLine(\"  Message: {0}\", ex2.Message);\n            }\n        }\n        finally\n        {\n            if (transaction != null)\n            {\n                transaction.Dispose();\n            }\n            if (connection != null)\n            {\n                connection.Close();\n                connection.Dispose();\n            }\n        }\n</code></pre>\n"},{"tags":["sql","sql-server-2008","aggregate-functions"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13143987,"title":"How to select a value based on a count(*) in a subquery","body":"<p>I'm running a query below which won't work as I can't put an aggregate in a where clause, but given that it's in a subquery I'm not entirely sure what the best way forward is from here...!</p>\n\n<p>The line that doesn't work is:</p>\n\n<pre><code>        (select gradeid from commissionconsultants where UserId = ic.primaryconsultantid) \n        and starters = COUNT(*) ) from InvoiceCommissions ic\n</code></pre>\n\n<p>And the full query is as follows:</p>\n\n<pre><code>select u.username + ' ' + u.surname as UserName, \nic.primaryconsultantid, \nCOUNT(ic.invoiceid) as starters, \nDATENAME(mm,ic.invoiceissueddate) AS [month], \nDATEPART(yy,ic.invoiceissueddate) as [year], \ncast(SUM((ic.value / ic.exchangerate) * (ic.primaryconsultantperc / 100)) as numeric(8,2)) AS totalvalue, \n(select threshold from commissiongrades where gradeid = \n    (select gradeid from commissionconsultants where UserId = ic.primaryconsultantid) ) AS Threshold, \n(select percentage from commissiongradevalues where gradeid = \n    (select gradeid from commissionconsultants where UserId = ic.primaryconsultantid) \n        and starters = COUNT(*) ) from InvoiceCommissions ic\ninner join commissionconsultants cc on cc.userid = ic.primaryconsultantid\ninner join Users u on u.UserId = ic.primaryconsultantid\ngroup by primaryconsultantid, DATENAME(mm,invoiceissueddate), DATEPART(yy,invoiceissueddate), u.username + ' ' + u.surname \n</code></pre>\n\n<p>What, in essence, I am trying to do is lookup the commission percentage from a table (commissiongradevalues) based on the grade of the consultant (found in commissionconsultants) and the number of placements made in a given month.</p>\n\n<p>e.g. if a consultant has made one placement in a month, they will have XX commission percentage, and if they have made two placements in a month they will have YY commission percentage.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":44,"score":0,"question_id":13149232,"title":"How do I extract a substring from a random position in a string using built-in functions?","body":"<p>I have a series of data stored in the following fashion:</p>\n\n<pre><code>Word of various kinds (ANT\\username1) and even more words\nThis is another row, the words are random (ANT\\username2)\nThankfully the username only ever shows once (ANT\\username1)\n</code></pre>\n\n<p>Above represents three seperate rows. </p>\n\n<p>The general flow of this data is:</p>\n\n<ul>\n<li>Parenthesis can appear anywhere in the text</li>\n<li>The username portion of each string (ANT\\usernamex) will only ever appear once</li>\n<li>The text preceeding and proceeding the username portion is always different lengths.</li>\n<li>The username text may not always be present</li>\n</ul>\n\n<p>As you probably already guessed what I need to do is take the username from each row and where it isn't present return null. Unfortunately I have no idea how to approach this - I've played around with left() and right() functions but don't really know how else to tackle this. Would appreciate if any answers that use a number of functions to accomplish the task have a quick blurb explaining the flow of logic (so I can then read the documentation for the functions to learn).</p>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008","ssrs-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13148997,"title":"SQL Reporting Services Express Edition very slow even with no data","body":"<p>Am trying to figure out why our SSRS execution is so slow.  The home page takes about 10 seconds to load/refresh and reports take 12-15 seconds just to render to the 'Enter Parameter Settings' stage.  </p>\n\n<p>I have created a report with a single text box - no data connections - no data-set - so ZERO database access and yet it still consistently takes 12 seconds to render - A SINGLE TEXT BOX WITH NO DATABASE ACCESS!  Every single click in the report engine takes 12-15 seconds to respond to - which makes it quite painful to work with real data.</p>\n\n<p>The database and an IIS installation is also included on the same machine - but they are only accessed by a couple of users (nothing public) - so the machine isn't under a lot of load.  All other services on this box are responding quickly: The IIS installation is serving up web-service requests quickly and responsively - within a split-second.  And all database queries are running at a very speedy rate - consistent with the generous hardware on this box.</p>\n\n<p>It doesn't seem to be related to 'First Request' spooling up - this is happening on all requests.</p>\n\n<p>All the other answers relating to SSRS speed issues seem to be related to database query tuning and parameter handling - but this 'no-data' test report seems to be pointing to something wrong within the SSRS installation/execution itself.  </p>\n\n<p>Any help?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","pivot","pivot-without-aggregate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":63,"score":-1,"question_id":13142554,"title":"X number of Rows into X number of Columns","body":"<p>I need your help again for the following. Please note that I am using SQL SERVER 2008.\nI have a table (below) where we got Number of jobs done from the \"Pickup\" to the \"Dropoff\".\nThe requirements are (output format mentioned below).\n1) Get all the unique postcodes regardless of them being dropoffs or pickups. This will give us all the postcodes.\n2) Present the count of jobs done from PICKUP to the corresponding DROPOFF. For example, we pick passengers up from SE18 postcode twice and took them to SE18 once and SE19 once. It will be cleared from the REQUIRED OUTPUT table.</p>\n\n<pre><code>TABLE:\nJobID        Pickup       Dropoff\n====================================\n1            SE18         SE18\n2            SE18         SE19\n3            SE2          SE18\n4            SE28         SE2\n5            AL1          SE7\n6            BR1          SE10\n7            NW1          TW16\n8            AL1          SE18\n9            BR6          AL1\n10           E6           BR1\n.            .            .\n.            .            .\n.            .            .\n</code></pre>\n\n<p>The require output is as the following:</p>\n\n<pre><code>REQUIRED OUTPUT\n\n     SE18   SE2   SE28   AL1   BR1   NW1   BR6   E6   SE19  SE7  SE10  TW16 ..\n     =========================================================================\nSE18   1     -      -     -     -     -     -     -     1    0    0     0\nSE2    1     -      -     -     -     -     -     -     -    -    -     -         \nSE28   -     1      -     -     -     -     -     -     -    -    -     -          \nAL1    1     -      -     -     -     -     -     -     -    1    -     -       \nBR1    -     -      -     -     -     -     -     -     -    -    1     -        \nNW1    -     -      -     -     -     -     -     -     -    -    -     1      \nBR6    -     -      -     1     -     -     -     -     -    -    -     -       \nE6     -     -      -     -     1     -     -     -     -    -    -     -       \nSE19   -     -      -     -     -     -     -     -     -    -    -     -        \nSE7    -     -      -     -     -     -     -     -     -    -    -     -       \nSE10   -     -      -     -     -     -     -     -     -    -    -     -      \nTW16   -     -      -     -     -     -     -     -     -    -    -     -      \n.\n.\n.\n</code></pre>\n\n<p>Many thanks in advance.\nKind regards</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":592,"score":1,"question_id":3270779,"title":"SCOPE_IDENTITY() return NULL?","body":"<p>I am using SQL Server 2008 express, below is the SP, who return </p>\n\n<blockquote>\n  <p>(0 row(s) affected)  </p>\n  \n  <p>Msg 515, Level\n  16, State 2, Procedure\n  sp_AddCarrierFees, </p>\n  \n  <p>Line 21 Cannot\n  insert the value NULL into column\n  'attribute_value_id', table\n  'MyDevSystem.dbo.shipping_fees'; </p>\n  \n  <p>column\n  does not allow nulls. INSERT fails.\n  The statement has been terminated.</p>\n  \n  <p>(1 row(s) affected)</p>\n</blockquote>\n\n<p>And this is the SP :</p>\n\n<pre><code>GO\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROCEDURE [dbo].[sp_AddCarrierFees]\n    @carrier_id INT,\n    @zone_id INT,\n    @attribute_value_id INT,\n    @attribute_title varchar(20),\n    @fees decimal(6,2)\nAS\nBEGIN\n    if @attribute_value_id = 0 begin \n        insert into shipping_attribute_value (attribute_id,attribute_value,sort_order) \n        select attribute_id, @fees,0 from shipping_attribute where carrier_id=@carrier_id and attribute_title=@attribute_title; \n\n        declare @NewID int;\n        set @NewID = SCOPE_IDENTITY(); \n        print @NewID;\n\n        insert into shipping_fees (zone_id, attribute_value_id) values (@zone_id, @NewID); \n    end \n    else \n    begin \n        update shipping_attribute_value set attribute_value=@fees where attribute_value_id=@attribute_value_id;\n    end\nEND\n</code></pre>\n\n<p>Any people know why? I have read many post in StackOverFlow, but still not find solution.Somebody say use @@IDENTITY or IDENT_CURRENT instead, but it possible got the identity who made by other users.</p>\n\n<p><strong>FIXED:I found the reason, because the first insert statement is fail, so why return (0 row(s) affected) , after i fix that insert statement,it works now. thanks you for everyone.</strong></p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":35,"score":-1,"question_id":13147661,"title":"Option \"12.0\" is not valid. The command line parameters are invalid","body":"<p>We are trying to import data from Excel to SQL server table, when we are running package in BIDS the package running successfully.</p>\n\n<p>We have created the job and trying to run the same package through job we are getting the below error message.</p>\n\n<p>Microsoft (R) SQL Server Execute Package Utility Version 10.50.2500.0 for 32-bit Copyright (C) Microsoft Corporation 2010. Option \"12.0\" is not valid.  The command line parameters are invalid.</p>\n\n<p>Command Line</p>\n\n<pre><code>DTS \"\\MSDB\\Test\" /SERVER XXXXXX /CONNECTION \"XXXXXX.XXXXX.XXXXX\";\"\\\"Data Source=XXXXX;User ID=XXXXXX;Initial Catalog=XXXXX;Provider=SQLNCLI10.1;Persist Security Info=True;Auto Translate=False;Application Name=SSIS-MondelezSiteSideFTP-{6FE6809C-3E4C-4D2B-B9CF-B72D8E36B99A}SQLServernam‌​e.XXXXX.XXX;\\\"\" /CONNECTION \"ViewableMedia_xlsm\";\"\\\"Data Source=\\\\XXXXX\\XXXXX\\Data\\Datafeed\\SiteSide\\ViewableMedia\\SiteSideLoadTemplate.xl‌​sm;Provider=Microsoft.ACE.OLEDB.12.0;Extended Properties=\"\"Excel;;;\\\"\" /X86 /CHECKPOINTING OFF /REPORTING E\n</code></pre>\n\n<p>I am running the job in SQL server.</p>\n"},{"tags":["asp.net-mvc","sql-server-2008","connection-string"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":204,"score":0,"question_id":13039540,"title":"Trying to connect ASP.NET MVC to SQL Server 2008 R2 with possible wrong connection string","body":"<p>Running SQL Server 2008 R2 and ASP.NET MVC 2 web application on the Virtual Server of big german hosting-provider.</p>\n\n<p>I have a problem to connect to the SQL Server. </p>\n\n<p>On localhost this connection string works fine: </p>\n\n<pre><code> @\"Data Source=LOCAL-HP;Initial Catalog=OnlineVertrag;Integrated Security=True\";\n</code></pre>\n\n<p>I'm using a similar connection string on the server: </p>\n\n<pre><code>@\"Data Source=MYSERVER\\SQLEXPRESS;Initial Catalog=OnlineVertrag;Integrated Security=True\";\n</code></pre>\n\n<p>but nothing happens over there.</p>\n\n<p>Here is my project which I am trying to connect: <a href=\"http://www.hotcont.eu/OnlineVertrag/Home\" rel=\"nofollow\">http://www.hotcont.eu/OnlineVertrag/Home</a></p>\n"}]}
{"total":21073,"page":5,"pagesize":100,"questions":[{"tags":["sql-server","sql-server-2008","deprecated"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":625,"score":3,"question_id":5076791,"title":"How to replace REVOKE ALL in SQL Server 2008 R2","body":"<p>How do I replace the <strong>ALL</strong> permission now that it has been revoked: </p>\n\n<pre><code>REVOKE ALL ON dbo.MyObject TO MyUser\n</code></pre>\n\n<p>I'm looping through all the objects in a database and revoking all permissions for a specific user. So if I had to be specific about which permission to revoke, it would be a real hassle because I would have to find out what object I have and then revoke every possible permission for that type of object. Instead of just REVOKE ALL.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13146304,"title":"How to Select Every Row Where Column Value is NOT Distinct","body":"<p>I need to run a select statement that returns all rows where the value of a column (i.e. EmailAddress) is not distinct.</p>\n\n<p>For example, if the table looks like below:</p>\n\n<pre><code>CustomerName     EmailAddress\nAaron            aaron@gmail.com\nChristy          aaron@gmail.com\nJason            jason@gmail.com\nEric             eric@gmail.com\nJohn             aaron@gmail.com\n</code></pre>\n\n<p>I need the query to return:</p>\n\n<pre><code>Aaron            aaron@gmail.com\nChristy          aaron@gmail.com\nJohn             aaron@gmail.com (peer edited from john@gmail.com)\n</code></pre>\n\n<p>I have read many posts and tried different queries to no avail.  The query that I believe should work is below.  Can someone suggest an alternative or tell me what may be wrong with my query?</p>\n\n<pre><code>select EmailAddress, CustomerName from Customers\ngroup by EmailAddress, CustomerName\nhaving COUNT(distinct(EmailAddress)) &gt; 1\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":13144458,"title":"improving performance of a view that is heavily dependent on dates","body":"<p><strong>This view is taking me HOURS to execute:</strong></p>\n\n<pre><code>USE [SalesDWH]\nGO\n\n/****** Object:  View [dbo].[FirstLastEstablished]    Script Date: 10/29/2012 15:12:47 ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER view [dbo].[FirstLastEstablished] as\n\n\nwith cte_min as(\n\nselect \n      a.client_id\n      ,a.specimen_source\n      ,a.received_date\nfrom\n      millennium_dw_dev..F_ACCESSION_DAILY a\njoin\n            (select distinct\n                  f.client_id\n                  ,f.received_date\n                  ,f.accession_daily_key\n            from \n                  millennium_dw_dev..F_ACCESSION_DAILY f\n            join \n                  (select CLIENT_ID, MIN(received_date) MinRecDate\n                  from millennium_dw_dev..F_ACCESSION_DAILY\n                  group by CLIENT_ID) i\n            on f.CLIENT_ID=i.CLIENT_ID\n            and f.RECEIVED_DATE=i.MinRecDate) b\non    \n      a.ACCESSION_DAILY_KEY=b.ACCESSION_DAILY_KEY \n\n)\n\n,\ncte_max as \n(\n\nselect \n      a.client_id\n      ,a.specimen_source\n      ,a.received_date\nfrom\n      millennium_dw_dev..F_ACCESSION_DAILY a\njoin\n            (select distinct\n                  f.client_id\n                  ,f.received_date\n                  ,f.accession_daily_key\n            from \n                  millennium_dw_dev..F_ACCESSION_DAILY f\n            join \n                  (select CLIENT_ID, max(received_date) MaxRecDate\n                  from millennium_dw_dev..F_ACCESSION_DAILY\n                  group by CLIENT_ID) i\n            on f.CLIENT_ID=i.CLIENT_ID\n            and f.RECEIVED_DATE=i.MaxRecDate) b\non    \n      a.ACCESSION_DAILY_KEY=b.ACCESSION_DAILY_KEY \n\n)\n,\n\n\ncte_est as\n\n(\n\nselect distinct client_id, MLIS_DATE_ESTABLISHED\nfrom millennium_dw_dev..D_CLIENT\nwhere REC_ACTIVE_FLG=1\nand MLIS_DATE_ESTABLISHED is not null\n)\n\n,\n\nmainQuery as(\nselect distinct\n      f.client_id\n      ,cmin.specimen_source first_specimen_source\n      ,cmin.received_date first_received\n      ,cmax.specimen_source last_specimen_source\n      ,cmax.received_date last_received\n      ,cest.MLIS_DATE_ESTABLISHED MLIS_DATE_ESTABLISHED\nfrom millennium_dw_dev..F_ACCESSION_DAILY f\nleft join cte_max cmax\non cmax.CLIENT_ID=f.CLIENT_ID\nleft join cte_min cmin\non cmin.CLIENT_ID=f.CLIENT_ID\nleft join cte_est cest\non cest.CLIENT_ID=f.CLIENT_ID\n)\n,\nDateDifferences\nas\n\n(\nSELECT\nclient_id,\n   (DATEDIFF(dd, MLIS_DATE_ESTABLISHED,first_received) + 1)\n  -(DATEDIFF(wk, MLIS_DATE_ESTABLISHED,first_received) * 2)\n  -(CASE WHEN DATENAME(dw, first_received) = 'Sunday' THEN 1 ELSE 0 END)\n  -(CASE WHEN DATENAME(dw, MLIS_DATE_ESTABLISHED) = 'Saturday' THEN 1 ELSE 0 END)\n -(case when cast('01/01/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/26/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/01/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/27/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/01/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/25/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/03/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/07/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/26/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/01/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/31/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/05/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/06/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/25/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/24/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/03/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/30/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/05/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/24/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/26/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/02/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/28/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/03/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/22/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n\n\n   DifferenceExcludingWeekends\n  from\n  mainQuery\n)\n,\nTerritory \nas\n(\nselect distinct c.client_id,c.MLIS_TERRITORY,s.REGION_NAME\nfrom millennium_dw_dev..D_CLIENT c\nleft join millennium_dw_dev..D_SALES_HIERARCHY s\non s.TERRITORY_NAME=c.MLIS_TERRITORY\nwhere c.REC_ACTIVE_FLG=1\nand s.REC_ACTIVE_FLG=1\n\n)\n\nselect mainQuery.*,d.DifferenceExcludingWeekends,Territory.MLIS_TERRITORY,Territory.REGION_NAME\nfrom mainQuery\nleft join DateDifferences d\non mainQuery.CLIENT_ID=d.CLIENT_ID\nleft join Territory\non mainQuery.CLIENT_ID=Territory.CLIENT_ID\n\nGO\n</code></pre>\n\n<p>I did the sql server database tuning on this, and created all the recommended indexes. After 15min of executing the view again, I stopped it. </p>\n\n<p><strong>Are there obvious things that you could kindly point out to me about my query to optimize it more and improve execution time?</strong></p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13145837,"title":"Getting 0 results when I should not be","body":"<p>I am running this query </p>\n\n<pre><code>select * \nfrom PortalUser \nwhere ID not in (select distinct PortalUserID from LoginHistory where LoginDateTime &gt; '10/1/2012')\n</code></pre>\n\n<p>and getting 0 results. </p>\n\n<p>If I run </p>\n\n<pre><code>select distinct PortalUserID \nfrom LoginHistory \nwhere LoginDateTime &gt; '10/1/2012'\n</code></pre>\n\n<p>I get a result set as expected. Lets say 50 results</p>\n\n<p>If I run </p>\n\n<pre><code>select * \nfrom portalUser\n</code></pre>\n\n<p>I get 200 Results.</p>\n\n<p>Why is this?</p>\n\n<p>Just to be clear. The LoginHistory table has a PortalUserID that does not have to be Unique, however the PortalUser..ID is a unique field.</p>\n\n<p>Running this query </p>\n\n<pre><code>select count(ID) \nfrom PortalUser \nGO\nselect count(Distinct PortalUserID) \nfrom LoginHistory where LoginDateTime &gt; '10/1/2012''\n</code></pre>\n\n<p>returns 119 and 47 rows</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13134555,"title":"sub query in sql server","body":"<p>I have two tables :</p>\n\n<pre><code>create table sales (\n    unitcode int ,\n    categorycode smallint ,\n    ddate varchar(10) ,\n    price float\n)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>create table timetable (\n    year varchar(4) ,\n    month varchar(11) ,\n    ddate varchar(10)\n)\n</code></pre>\n\n<p>I want to write a subquery to find :\n in each month in each year which 2 products(unitcode , categorycode) have a top of price ?</p>\n"},{"tags":["c#","sql","sql-server-2008","smo"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13144755,"title":"How to enable/disable/get status of extendedProtection for Authentication in SQL Server 2008 using C#?","body":"<p>I need to :</p>\n\n<ol>\n<li>Get the status of <a href=\"http://msdn.microsoft.com/en-us/library/ff487261%28v=sql.105%29.aspx\" rel=\"nofollow\">Extended protection for Authentication</a></li>\n<li>Enable Extended Protection</li>\n<li>Disable Extended Protection </li>\n</ol>\n\n<p>in <strong>SQL Server 2008 and 2008 R2</strong> preferably using SQl Server Management Objects (SMO) API using C#.</p>\n\n<p>Can someone point me to the relevant resource that can help me accomplish the above goals?</p>\n\n<p>A non-SMO approach is also welcome. However, an approach that does not involve SQL queries, and uses C# is highly desired.</p>\n"},{"tags":["sql-server-2008","stored-procedures","common-table-expression"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13143284,"title":"Stored procedure as CTE_query_definition","body":"<p>Can I use a stored procedure as the <code>CTE_query_definition</code> of a CTE?</p>\n\n<p>For example:</p>\n\n<pre><code>WITH  CodesCTE\nAS ( Exec sp_TableReturningProc )\nSELECT * FROM CodesCTE;\n</code></pre>\n\n<p>If not, outside of declaring a batch / global temp table and using a <code>Select</code> statement against the temp table, is there a way around this limitation?</p>\n\n<p>I am in the process of developing the associated stored procedure and would love to simply the use of it for this purpose if possible.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":16,"score":-1,"question_id":13143930,"title":"Checking Specific Row's Value and Merge Values","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/194852/concatenate-many-rows-into-a-single-text-string\">Concatenate many rows into a single text string?</a><br>\n  <a href=\"http://stackoverflow.com/questions/10298805/mimic-group-concat-combined-with-group\">Mimic group_concat() combined with group</a>  </p>\n</blockquote>\n\n\n\n<p>this is the source table that I am currently working on:</p>\n\n<p><img src=\"http://i.stack.imgur.com/HSSbF.png\" alt=\"enter image description here\"></p>\n\n<p>And this is the desired output:</p>\n\n<p><img src=\"http://i.stack.imgur.com/xcnAB.png\" alt=\"enter image description here\"></p>\n\n<p>Can I achieve this by simple MSSQL query? Like just using <strong>GROUP BY or JOIN?</strong></p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13143367,"title":"Use 'JOIN' to select top five records from a table that match a specific column in table two","body":"<p>I have two table:</p>\n\n<pre><code>Audit\nAUDITID |  CUSTOMER  |  CUSTOMERNUMBER\n001     |    BILLY   |  11111 \n002     |    HOLLY   |  12222 \n003     |    HOLLY   | 12222\n004     |    DON     | 13333\n005     |    DON     | 13333\n\nSummary\nAuditID | Summary | Date\n001     |  1      |   30/1/2012\n001     |  2      | 1/10/2012\n001     | 3       |20/10/2012\n004     | 4       | 2/09/2012\n004     | 5       | 3/01/2012\n</code></pre>\n\n<p>I want to select the top five records table for each different AuditID that matches an Audit ID From the Audit table.</p>\n\n<p>The sql script i have so far is :</p>\n\n<pre><code>    SELECT Auditid, summary, date\n    FROM [Summary] SL1\n    INNER JOIN [Audit] AL1 ON SL1.[AuditID] = AL1.[AuditID]  \n    WHERE AL1.[AuditID] IN (  \n    SELECT TOP 5 AuditID  \n    FROM [Audit] AL2  \n    WHERE AL1.[CustomerNumber] = AL2.[CustomerNumber]   \n    ORDER BY AL2.[AuditID] DESC\n    )  \n</code></pre>\n"},{"tags":["sql-server","security","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2921,"score":3,"question_id":6212598,"title":"Server Role to execute SQL Server Agent Jobs in SQL SERVER 2008","body":"<p>The users from other departments ask me to grant them to execute Schedule Jobs / SSIS in SQL Server Agent.  At present, they cannot see SQL Server Agent tree in their ManagmentStudio.  I think, it's because they don't have the rights to execute them.</p>\n\n<p>So, I would like to know which server role should I give to them.  I only want to give them minimum privileges.  When I check the existing roles in my server, I could only see the following server roles</p>\n\n<ol>\n<li>bulkadmin</li>\n<li>dbcreator</li>\n<li>diskadmin</li>\n<li>processadmin</li>\n<li>public</li>\n<li>securityadmin</li>\n<li>serveradmin</li>\n<li>setupadmin</li>\n<li>sysadmin</li>\n</ol>\n\n<p>Please advise me.</p>\n"},{"tags":["c#",".net","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13136332,"title":"How to do a timed SQL server login?","body":"<p>Here is my problem , I am coding a C#  application that will log in to a remote <strong>SQL server 2008 [Express edition to be precise]</strong> and fetch data from the database table (say foo) periodically[after each fetch the SQL client connection is closed ] .</p>\n\n<p>How can I do this process periodically with a time interval like 60 seconds or so (user definable). ??</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","exists"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13141461,"title":"What can I do to speed up this SQL Query?","body":"<p>I've created this SQL query with the help of @Dems :-)</p>\n\n<p>Here is some detail, I tried to make a SQLFiddle but I kept getting errors with my variables... This works in Sql Server 2008...  My question is, how can I make my query faster? I know I'm doing a number of things wrong here (repeated nester queries), I'm hoping to get one of you SQL gurus to take a look and help me get this down from it's 30 minute execution time! :-S</p>\n\n<p>I'm not sure exactly how much information you need to be able to help me on this one, please fire away with any questions and I'll reply ASAP.  Sorry if the level of detail is lacking a little, I just don't know what you want/need to know!</p>\n\n<p>The basic idea behind the query is that in the game I want to find all players which haven't moved 5 units for a period of time, who have fired whilst stood still and did not fire for 60 minutes before they stopped moving.  The query works, but it's the <code>AND NOT EXISTS</code> clause which is slowing things down to a crawl, before I added that it took 16 seconds to run!  16 seconds is still a looong time, so any other improvements would be appreciated, but for now with this being my own POC game (just throwing bits and pieces together), 16 seconds is acceptable... </p>\n\n<pre><code>DECLARE @n INT , @DistanceLimit INT\nSELECT  @n = 2 , @DistanceLimit = 5;\n\nWITH    partitioned\n          AS ( SELECT   * ,\n                        CASE WHEN Distance &lt; @DistanceLimit THEN 1\n                             ELSE 0\n                        END AS PartitionID\n               FROM     EntityStateEvent\n               WHERE    ExerciseID = '8B50D860-6C4E-11E1-8E70-0025648E65EC'\n             ),\n        sequenced\n          AS ( SELECT   ROW_NUMBER() OVER ( PARTITION BY PlayerID ORDER BY EventTime ) AS MasterSeqID ,\n                        ROW_NUMBER() OVER ( PARTITION BY PlayerID, PartitionID ORDER BY EventTime ) AS PartIDSeqID ,\n                        *\n               FROM     partitioned\n             ),\n        filter\n          AS ( SELECT   MasterSeqID - PartIDSeqID AS GroupID ,\n                        MIN(MasterSeqID) AS GroupFirstMastSeqID ,\n                        MAX(MasterSeqID) AS GroupFinalMastSeqID ,\n                        PlayerID\n               FROM     sequenced\n               WHERE    PartitionID = 1\n               GROUP BY PlayerID ,\n                        MasterSeqID - PartIDSeqID\n               HAVING   COUNT(*) &gt;= @n\n             )\n    SELECT\nDISTINCT    ( sequenced.PlayerID ) ,\n            MIN(sequenced.EventTime) AS StartTime ,\n            MAX(sequenced.EventTime) AS EndTime ,\n            DATEDIFF(minute, MIN(sequenced.EventTime),\n                     MAX(sequenced.EventTime)) AS StaticTime ,\n            Player.Designation AS 'Player'\n    FROM    filter\n            INNER JOIN sequenced ON sequenced.PlayerID = filter.PlayerID\n                                    AND sequenced.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                    AND sequenced.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n            INNER JOIN Events ON Events.FiringPlayerID = sequenced.PlayerID \n            INNER JOIN Player ON Player.PlayerID = sequenced.PlayerID\n                                 AND Player.Force = 'FR'\n                                 AND NOT EXISTS ( SELECT    *\n                                                  FROM      Events\n                                                  WHERE     Events.FiringPlayerID = Player.PlayerID\n                                                  GROUP BY  Events.FiringTime\n                                                  HAVING    Events.FiringTime BETWEEN DATEADD(minute,\n                                                              -60,\n                                                              ( SELECT\n                                                              MIN(s.EventTime)\n                                                              FROM\n                                                              sequenced s\n                                                              WHERE\n                                                              s.PlayerID = filter.PlayerID\n                                                              AND s.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                                              AND s.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n                                                              ))\n                                                              AND\n                                                              ( SELECT\n                                                              MIN(s.EventTime)\n                                                              FROM\n                                                              sequenced s\n                                                              WHERE\n                                                              s.PlayerID = filter.PlayerID\n                                                              AND s.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                                              AND s.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n                                                              ) )\n            INNER JOIN Player HitPlayer ON HitPlayer.PlayerID = Events.HitPlayerID\n    WHERE   HitPlayer.[FORCE] = 'HO'\n    GROUP BY GroupID ,\n            sequenced.PlayerID ,\n            Events.FiringPlayerID ,\n            Events.FiringTime ,\n            Player.Designation\n    HAVING  DATEDIFF(minute, MIN(sequenced.EventTime),\n                     MAX(sequenced.EventTime)) &gt; 5\n            AND Events.FiringTime BETWEEN MIN(sequenced.EventTime)\n                                  AND     MAX(sequenced.EventTime)\n    ORDER BY StartTime\n</code></pre>\n"},{"tags":["sql-server-2008","amazon-ec2","database-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13098918,"title":"Setup up Sql Server replication on two EC2 instances","body":"<p>I've looked and looked for nearly a whole day on instructions on how to setup Sql server replication on two EC2 instances, first EC2 as a publisher, second one as both disribution and subscription server..</p>\n\n<p>Trouble is, I'm going around in circles, there are great documentations on how to do it on regular servers, but Replication doesn't support IP address, it needs named instances and I don't have that on Amazon EC2. </p>\n\n<p>RDS provides replication, but only for MySql so I don't want to use that right now..</p>\n\n<p>Has anyone successfully set up any kind of replication for MS Sql Server on EC2 instances? \nIs there any blog / documentation describing the faintest details of how to do this? </p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008","reporting-services","charts","business-intelligence"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3721,"score":1,"question_id":2580282,"title":"SQL Server 2008 Reporting Services Charting - adding a data table to bottom of a chart","body":"<p>I would like to add a data table to bottom of a (line) chart in a report.  I know I can create a matrix report with the same data source.  I would like to have everything lineup automatically like it does when you add a data table to a chart in Excel (as shown at <a href=\"http://www.tushar-mehta.com/excel/newsgroups/data_table/\" rel=\"nofollow\">http://www.tushar-mehta.com/excel/newsgroups/data_table/</a>). </p>\n\n<p>Example from Excel (from above link)\n<img src=\"http://www.tushar-mehta.com/excel/newsgroups/data_table/index.3.gif\" alt=\"Sample Chart\"></p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13135069,"title":"Why calling a function takes much more time than direct execution of function code","body":"<p>In my SQL Server 2008 R2 database, I have a query which calls a function. </p>\n\n<p>Lately this query has started to execute very slowly. I found that the user-defined function is hampering all the query. </p>\n\n<p>I tried to execute this function alone and it took 40 seconds to finish, while previously it executed in 3-4 seconds. So I tried to execute code that is inside of function and executed in this 3-4 seconds. </p>\n\n<p>I cannot understand why executing code of function takes far fewer time than calling function itself. I tried all this in SSMS only.</p>\n\n<p>That's the function itself</p>\n\n<pre><code>ALTER FUNCTION [dbo].[fn_SI_GetMark] (@AREA_ID int, @BD datetime, @ED datetime)  \nRETURNS decimal(24, 2) AS  \nBEGIN \n\n\n\nDeclare @mon int;\nset @Mon = 1;\nif(DateDiff(day, @BD, @ED) &gt; 40)\nbegin\n\ndeclare @q1sb datetime; set @q1sb = Convert(datetime, '01.01.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q1eb datetime; set @q1eb = Convert(datetime, '01.04.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q2sb datetime; set @q2sb = Convert(datetime, '01.04.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q2eb datetime; set @q2eb = Convert(datetime, '01.07.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q3sb datetime; set @q3sb = Convert(datetime, '01.07.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q3eb datetime; set @q3eb = Convert(datetime, '01.10.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q4sb datetime; set @q4sb = Convert(datetime, '01.10.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q4eb datetime; set @q4eb = Convert(datetime, '01.01.'+(Convert(nvarchar(4), Year(@BD) + 1)));\nif((@BD &gt;= @q1sb) and (@BD &lt; @q1eb))\nbegin\n    set @BD = @q1sb;\nend\nelse if((@BD &gt;= @q2sb) and (@BD &lt; @q2eb))\nbegin\n    set @BD = @q2sb;\nend\nelse if((@BD &gt;= @q3sb) and (@BD &lt; @q3eb))\nbegin\n    set @BD = @q3sb;\nend\nelse if((@BD &gt;= @q4sb) and (@BD &lt; @q4eb))\nbegin\n    set @BD = @q4sb;\nend\n\n\n\ndeclare @q1se datetime; set @q1se = Convert(datetime, '01.01.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q1ee datetime; set @q1ee = Convert(datetime, '01.04.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q2se datetime; set @q2se = Convert(datetime, '01.04.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q2ee datetime; set @q2ee = Convert(datetime, '01.07.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q3se datetime; set @q3se = Convert(datetime, '01.07.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q3ee datetime; set @q3ee = Convert(datetime, '01.10.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q4se datetime; set @q4se = Convert(datetime, '01.10.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q4ee datetime; set @q4ee = Convert(datetime, '01.01.'+(Convert(nvarchar(4), Year(@ED) + 1)));\nif((@ED &gt;= @q1se) and (@ED &lt;= @q1ee))\nbegin\n    set @ED = @q1ee;\nend\nelse if((@ED &gt;= @q2se) and (@ED &lt;= @q2ee))\nbegin\n    set @ED = @q2ee;\nend\nelse if((@ED &gt;= @q3se) and (@ED &lt;= @q3ee))\nbegin\n    set @ED = @q3ee;\nend\nelse if((@ED &gt;= @q4se) and (@ED &lt;= @q4ee))\nbegin\n    set @ED = @q4ee;\nend\n\n\nset @Mon = datediff(month, @BD, @ED) / 3;\n\nend\n\n\ndeclare @i int;\n\nDECLARE @Mark decimal(24, 2); SET @Mark = 0;\ndeclare @count int; SET @count = 0;\n\nDECLARE @AREA_PATH nvarchar(max), @SI_CheckListId int, @SI_CheckListTitle nvarchar(max), @SI_CheckListCreatedBy int;\n\n\nDECLARE @Mark2 decimal(24, 2); set @Mark2 = 0;\ndeclare @count2 int; SET @count2 = 0;\n\n\n\nDECLARE @areaIdStr nvarchar(max);\nset @areaIdStr = convert(nvarchar(max), @AREA_ID);\n\n\nDECLARE db_cursor_rights2 CURSOR\nfor\nSELECT     tbl_SI_CheckList.SI_CheckListId\nFROM         tblArea INNER JOIN\n                  tbl_SI_CheckList ON tblArea.AREA_ID = tbl_SI_CheckList.AreaId\nWHERE ('%/'+tblArea.AREA_PATH+'/%' like '%/'+@areaIdStr+'/%') \nand (((tbl_SI_CheckList.SI_CheckListIsDeleted &lt;&gt; 1) and (tbl_SI_CheckList.SI_CheckListDateCreated &lt;= @ED))\n    or  \n    ((tbl_SI_CheckList.SI_CheckListIsDeleted = 1) and (tbl_SI_CheckList.SI_CheckListDateDeleted is not null) and (tbl_SI_CheckList.SI_CheckListDateDeleted &gt;= @BD) and (tbl_SI_CheckList.SI_CheckListDateCreated &lt;= @ED)))\n\n\nOPEN db_cursor_rights2;  \nFETCH NEXT FROM db_cursor_rights2\nINTO @SI_CheckListId;\nWHILE @@FETCH_STATUS = 0\nBEGIN   \n\n\n    set @i = 1\n    while @i &lt;= @Mon\n    begin\n        set @Mark2 = 0\n        set @count2 = 0\n\n        SELECT     @Mark2 = @Mark2 + Mark\n        FROM       tbl_SI_CheckListRegistr\n        WHERE     (SI_CheckListId = @SI_CheckListId) and ((tbl_SI_CheckListRegistr.DateCreated &gt;= @BD) and (tbl_SI_CheckListRegistr.DateCreated &lt; @ED) and (tbl_SI_CheckListRegistr.IsDeleted &lt;&gt; 1))\n\n        if(@Mark2 is not null)\n        begin \n            set @Mark = @Mark + @Mark2;\n        end\n        set @i = @i + 1;    \n\n        SELECT     @count2 = count(Mark)\n        FROM       tbl_SI_CheckListRegistr\n        WHERE     (SI_CheckListId = @SI_CheckListId) and ((tbl_SI_CheckListRegistr.DateCreated &gt;= @BD) and (tbl_SI_CheckListRegistr.DateCreated &lt; @ED) and (tbl_SI_CheckListRegistr.IsDeleted &lt;&gt; 1))\n\n        if(@count2 = 0)\n        begin \n            set @count2 = @count2 + 1;\n        end \n\n        set @count = @count + @count2;      \n\n    end\n\n    FETCH NEXT FROM db_cursor_rights2\n    INTO @SI_CheckListId;\n\nEND\nCLOSE db_cursor_rights2;\nDEALLOCATE db_cursor_rights2;\n\nif(@count = 0)\nbegin\nset @count = 1;\nend\n\nset @Mark = round(@Mark/@count, 2)\n\nRETURN (@Mark)\n\n\nEND\n</code></pre>\n\n<p>and this is how i try to call it</p>\n\n<pre><code>DECLARE @AREA_ID int; SET @AREA_ID=1;\nDECLARE @BD datetime, @ED datetime;\nSET @BD=cast('2012-10-01' AS DATETIME);\nSET @ED=cast('2012-11-01' AS DATETIME);\nDECLARE @MArk decimal(24,2);\nset @Mark = (select dbo.fn_SI_GetMark(@AREA_ID, @BD, @ED));\nPRINT @Mark\n</code></pre>\n\n<p>Else one thing, i tried to execute this function on another dbserver (there is replication set up between this two servers) and it executes very fast. And another one observation if i call function without parameters, set them in function directly, it is also executes fast.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13139189,"title":"SQL set Table 1 COL A = Table 2 COL B if Table 1 COL C = Table 2 COL D","body":"<p>I have two tables</p>\n\n<p><strong>Table1</strong></p>\n\n<pre><code>REF1 REF2\n     A\n     B\n     C\n</code></pre>\n\n<p><strong>Table2</strong></p>\n\n<pre><code>UPN Filename\n1   A\n2   B\n3   C\n</code></pre>\n\n<p>what I want to do in SQL is this</p>\n\n<blockquote>\n  <p>If Table1 REF2 = Table2 Filename then set Table1 REF1 = Table2 UPN</p>\n</blockquote>\n\n<p>this is the sql I did</p>\n\n<pre><code>UPDATE    Table1\nSET       REF1 = Table2.UPN\nFROM      Table1 INNER JOIN Table2 \nON        Table1.REF2 = Table2.FileName \n</code></pre>\n\n<p>all this does is take the first value in row 1 of table2 and put it in every row under table1 in <code>REF1</code></p>\n\n<p>eg this is what I get </p>\n\n<p><strong>TABLE1</strong></p>\n\n<pre><code>REF1 REF2\n1    A\n1    B\n1    C\n</code></pre>\n\n<p>this is what I want</p>\n\n<p><strong>TABLE1</strong></p>\n\n<pre><code>REF1 REF2\n1    A\n2    B\n3    C\n</code></pre>\n\n<p>any help appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13139140,"title":"SQL Server 2008 Calculation Bug","body":"<p>Here is the query i am running</p>\n\n<pre><code>Select (100/18)*18\n</code></pre>\n\n<p>The answer i get is 90. I have tried declaring each of the numbers as decimals also, and i get the value <code>100.0008</code>, but when i calculate with variables as floats the answer is correct at '100' so does anyone have any idea why SQL calculates like this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13138194,"title":"Dependency on master and child in SQL","body":"<p>I have a master table like this</p>\n\n<pre><code>Product    Status  Product id\nA          True     1\nB          True     2\nC          true     3\nD          True     4\nE          false    5\nF          True     6\n</code></pre>\n\n<p>Now I have other table which is giving me the dependency of the product</p>\n\n<pre><code>Product    DependencyId\nC             2\nC             5\nE             1\nB             4\nB             6\n</code></pre>\n\n<p>Now when I searching for C, I can see that two products are dependent upon C now these two product is dependent upon other products.</p>\n\n<p>And let say I am searching for E, then I there are only one dependency of the product.</p>\n\n<p>Now, I need to check for a product that if any dependency is false or not. If any of the dependency is false then I have to return some text/value.</p>\n\n<p><strong>Result</strong></p>\n\n<pre><code>When product is C then output will be E (because the grand children of C (i.e. E) has false)\n\nWhen product is B then output will be NULL (becuase none of the child of B or their sub childrens has false)\n</code></pre>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":388,"score":0,"question_id":8485209,"title":"How to fillter the database null values of integer column in C# using if condition?","body":"<p>I am passing data value, to a database, using integer data type (accepting <code>null</code>). </p>\n\n<p>If in front-end I do not pass any integer it takes <code>null</code> value in db. While retrieving table data in front-end I am using <code>if</code> condition to filter the integer empty values. I have only integers to display, how to write the if condition?</p>\n\n<pre><code>int x;\nif(x!=(which code this place write)\n{\ntextbox.text=x; //x value not empty working if condition else goto else condition\n}\nelse\n{\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13137246,"title":"Column in table is of a type that is invalid for use as a key column in an index","body":"<p>I have a table where I am storing employee details. I want to alter the table and set one of the column <code>emp_code</code> as primary key. Its datatype is <code>nvarchar(max)</code>, but I am not able to set it as primary key.</p>\n\n<p>I run the following query : </p>\n\n<pre><code>ALTER TABLE user_master\nADD PRIMARY KEY (emp_code)\n</code></pre>\n\n<p>but it gives me an error :</p>\n\n<blockquote>\n  <p><em>Msg 1919, Level 16, State 1, Line 1</em><br>\n  <em>Column <code>emp_code</code> in table <code>user_master</code> is of a type that is invalid for use as a key column in an index.</em><br>\n  <em>Msg 1750, Level 16, State 0, Line 1</em><br>\n  <em>Could not create constraint. See previous errors.</em></p>\n</blockquote>\n\n<p>How can I overcome this?</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13132526,"title":"Selecting Change_Tracking_Current_Version() in SQL Server 2008 table trigger","body":"<p>I am using SQL Server 2008 and Change tracking is enabled on my Database.\nOn one of my tables in the database, I have created the following Trigger.</p>\n\n<pre><code>CREATE TRIGGER [dbo].[tr_student]\n   ON [dbo].[Student]\n   FOR UPDATE,DELETE\nAS \nBEGIN\n   SET NOCOUNT ON;\n   SELECT CHANGE_TRACKING_CURRENT_VERSION()\nEND\n</code></pre>\n\n<p>The purpose of this Trigger is - when I update or delete a record in table dbo.Student I should get the the Current change Tracking Version Id.</p>\n\n<p>But when I update/delete a record in the table, CHANGE_TRACKING_CURRENT_VERSION() is not giving the current version_id but the previous version_id. After the trigger is fired,if I execute \n    select CHANGE_TRACKING_CURRENT_VERSION()\nI am getting the correct current version id.</p>\n\n<p>So does the Change_Tracking_Current_Version() id change only after the trigger? Is there any method to get correct Change_Tracking_Current_Version() in the Trigger?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4715,"score":2,"question_id":4655981,"title":"SQL Server - use Exists clause in Where and Select","body":"<p>I have a view that's something like</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n</code></pre>\n\n<p>The intent is to fetch all orders that have at least one line item of type 1 along with their current status.</p>\n\n<p>We're in the process of adding a second type of line item, and I have modified the view such that it will include orders that have at least one line item of type 1 or type 2:</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND (EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n  OR EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.Id))\n</code></pre>\n\n<p>Easy enough, but I've just had a requirement added to show whether an order contains line items of type 1 or type 2 (or both) in the grid where these results are displayed:</p>\n\n<pre>\nOrder ID | T1 | T2 | Last name | Price    | Status\n============================================================\n12345    | x  |    | Smith     | $100.00  | In Production\n12346    | x  | x  | Jones     | $147.23  | Part Dispatched\n12347    |    | x  | Atwood    | $12.50   | Dispatched\n</pre>\n\n<p>The only way I can think of is to do:</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, \n       CASE WHEN EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderID = o.Id) THEN 1 ELSE 0 END AS HasType1,\n       CASE WHEN EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.ID) THEN 1 ELSE 0 END AS HasType2,\n       o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND (EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n  OR EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.Id))\n</code></pre>\n\n<p>But this smells wrong with the duplication of the <code>EXISTS</code> clauses.  Is there a better qway to write it?  Can I make it perform better?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":18,"score":-1,"question_id":13138279,"title":"How to handle millions of records performance in sql server 2008 r2?","body":"<p>1) Handle millions of records performance when data frequently updated. \n2) Process to Insert millions records with in few seconds.</p>\n"},{"tags":["c#","sql-server-2008","gmail","smtp-auth"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2272,"score":0,"question_id":10699296,"title":"The SMTP server requires a secure connection or the client was not authenticated. The server response was: 5.5.1 Authentication Required.","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10698779/the-smtp-server-requires-a-secure-connection-or-the-client-was-not-authenticated\">The SMTP server requires a secure connection or the client was not authenticated. The server response was: 5.5.1 Authentication Required</a>  </p>\n</blockquote>\n\n\n\n<p>I have a problem when i m run this code then error is occured that \"The SMTP server requires a secure connection or the client was not authenticated. The server response was: 5.5.1 Authentication Required. \"</p>\n\n<p>And my code is:</p>\n\n<p><em>Code</em></p>\n\n<pre><code>protected void ImageButton1_Click(object sender, ImageClickEventArgs e)\n{\n\n    MailMessage mail = new MailMessage();\n    mail.To.Add(\"info@msslindia.com\");\n    mail.From = new MailAddress(\"info@msslindia.com\");\n    string body = \"&lt;table&gt;&lt;tr&gt;&lt;td&gt;Company Name:&lt;/td&gt;&lt;td&gt;\" + txt_cname.Text + \"&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Address With No.:&lt;/td&gt;&lt;td&gt;\" + txt_addwithno.Text + \"&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Contact Person:&lt;/td&gt;&lt;td&gt;\" + txt_conperson.Text + \"&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Email Id&lt;/td&gt;&lt;td&gt;\" + txt_email.Text + \"&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Description&lt;/td&gt;&lt;td&gt;\" + txt_description.Text + \"&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\";\n    mail.Body = body;\n    mail.IsBodyHtml = true;\n    SmtpClient smtp = new SmtpClient();\n    smtp.Host = \"smtp.gmail.com\";\n    smtp.Port = 587;\n\n    smtp.Credentials = new System.Net.NetworkCredential(\"info@msslindia.com\", \"12345\");\n    smtp.EnableSsl = true;\n    smtp.Send(mail);\n\n\n    txt_cname.Focus();\n    txt_cname.Text = \"\";\n    txt_addwithno.Text = \"\";\n    txt_conperson.Text = \"\";\n    txt_email.Text = \"\";\n    txt_description.Text = \"\";\n\n}\n</code></pre>\n"},{"tags":["javascript","html","sql-server-2008","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":13136694,"title":"How to Insert Data from Html into Sql database in MVC4?","body":"<p>Hi all i have an application where user can build menu how ever they want using drag and drop...i have all the menus listes at the Bottom of the page and at the top i have an Add Column option\nnow user comes and clicks on add column, based on how many menu column he has and drags and drops menu items from the bottom of the page...now waht i want is i have an save option on click of save the data should be inserted into my DB here is my code how i am </p>\n\n<pre><code>             here is the script for Building the menu\n\n                  var i = 1;\n       var z = 1;\n       $(document).ready(function () {\n           $(\"button[id='columnadd']\").click(function () {\n               // create the element\n               var domElement = $('&lt;div id=\"shoppingCart' + i++ + '\" class=\"shoppingCart\"&gt;&lt;h2 class=\"ui-widget-header\"&gt;Add Menu Items Here &lt;img src=\"../Images/delete.png\" id=\"shoppingCart' + z++ + '\" style=\"float: right; cursor:pointer;\" onclick=\"removecolumn(this.id)\"/&gt;&lt;/h2&gt;&lt;aside class=\"ui-widget-content\" id=\"droppable\"&gt;&lt;ol&gt;&lt;li class=\"placeholder\"&gt;Add your items here&lt;/li&gt;&lt;/ol&gt;&lt;/aside&gt;&lt;/div&gt;');\n               var holder = \"#columnholder\";\n               $(\"#columnholder\").append(domElement);\n               //$(this).after(domElement);\n\n               // at this point you have domElement in your page\n\n               // make it droppable\n               domElement.find(\"ol\").droppable({\n                   activeClass: \"ui-state-default\",\n                   accept: '.small_box li',\n                   greedy: true,\n                   drop: function (event, ui) {                          \n                       makeItDroppableToo(event, ui, this);                                             \n                   }\n               });\n           });          \n           function makeItDroppableToo(e, ui, obj) {                  \n               $(obj).find(\".placeholder\").remove();\n               var placeholder = $(\"&lt;ol&gt;&lt;li&gt;Add Sub Menu here&lt;/li&gt;&lt;/ol&gt;\");\n               $(\"&lt;li&gt;&lt;/li&gt;\").append(ui.draggable.text()).append(placeholder).appendTo($(obj));\n\n               // this is the same as the previous one\n               placeholder.droppable({\n                   greedy: true,\n                   // put options here\n                   drop: function (event, ui) {\n                       makeItDroppableToo(event, ui, this);\n                   }\n               });\n           }\n           $(\".small_box li\" ).draggable({\n               appendTo: \"body\",\n               helper: \"clone\"\n           });\n       });\n       function removecolumn(obj) {              \n           $(\"\" + \"#\" + obj + \"\").remove();\n       }\n</code></pre>\n\n<p>here is my html from where he can drag the Menu Items</p>\n\n<pre><code>           &lt;body&gt;    \n&lt;div class=\"top-header\"&gt;&lt;span class=\"heading\"&gt;Menu Builder&lt;/span&gt;&lt;button id=\"preview\" &gt;Save&lt;/button&gt;&lt;button id=\"columnadd\" &gt;Add Column&lt;/button&gt;&lt;/div&gt;\n&lt;div id=\"columnholder\" class=\"column-holder\"&gt;&lt;/div&gt;\n&lt;div class=\"clear\"&gt;&lt;/div&gt;\n&lt;div class=\"menu-items\"&gt;    \n&lt;aside class=\"small_box\"&gt;\n        &lt;div class=\"menu-item-header\"&gt;&lt;h4&gt;BRANDS&lt;/h4&gt;&lt;/div&gt;\n        &lt;ul&gt;\n            &lt;li id =\"brand1\"&gt;&lt;a class=\"\" href=\"#\"&gt;Brand1&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand2\"&gt;&lt;a href=\"#\"&gt;Brand2&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand3\"&gt;&lt;a href=\"#\"&gt;Brand3&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand4\"&gt;&lt;a href=\"#\"&gt;Brand4&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand5\"&gt;&lt;a class=\"\" href=\"#\"&gt;Brand5&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand6\"&gt;&lt;a href=\"#\"&gt;Brand6&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand7\"&gt;&lt;a href=\"#\"&gt;Brand7&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand8\"&gt;&lt;a href=\"#\"&gt;Brand8&lt;/a&gt;&lt;/li&gt;\n        &lt;/ul&gt;\n    &lt;/aside&gt;\n\n    &lt;aside class=\"small_box\"&gt;\n        &lt;div class=\"menu-item-header\"&gt;&lt;h4&gt;CATEGORIES&lt;/h4&gt;&lt;/div&gt;\n        &lt;ul&gt;\n        &lt;li id =\"category1\"&gt;&lt;a href=\"#\"&gt;Category1&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category2\"&gt;&lt;a href=\"#\"&gt;Category2&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category3\"&gt;&lt;a href=\"#\"&gt;Category3&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category4\"&gt;&lt;a href=\"#\"&gt;Category4&lt;/a&gt;&lt;/li&gt;\n        &lt;li id =\"category5\"&gt;&lt;a href=\"#\"&gt;Category5&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category6\"&gt;&lt;a href=\"#\"&gt;Category6&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category7\"&gt;&lt;a href=\"#\"&gt;Category7&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category8\"&gt;&lt;a href=\"#\"&gt;Category8&lt;/a&gt;&lt;/li&gt;\n    &lt;/ul&gt;\n    &lt;/aside&gt;\n\n     &lt;aside class=\"small_box\"&gt;\n        &lt;div class=\"menu-item-header\"&gt;&lt;h4&gt;PRODUCTS&lt;/h4&gt;&lt;/div&gt;\n        &lt;ul&gt;\n        &lt;li id=\"Product1\"&gt;&lt;a href=\"#\"&gt;Product1&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product2\"&gt;&lt;a href=\"#\"&gt;Product2&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product3\"&gt;&lt;a href=\"#\"&gt;Product3&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product4\"&gt;&lt;a href=\"#\"&gt;Product4&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"Product5\"&gt;&lt;a href=\"#\"&gt;Product5&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product6\"&gt;&lt;a href=\"#\"&gt;Product6&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product7\"&gt;&lt;a href=\"#\"&gt;Product7&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product8\"&gt;&lt;a href=\"#\"&gt;Product8&lt;/a&gt;&lt;/li&gt;\n    &lt;/ul&gt;\n    &lt;/aside&gt;\n  &lt;/div&gt;\n &lt;/body&gt;\n</code></pre>\n\n<p>Now i have a Db  Menu</p>\n\n<pre><code>            [MenuId],[MenuName],[ParentID]\n</code></pre>\n\n<p>if an user builds His Menu like this</p>\n\n<pre><code>          [Column1]\n\n           Nike\n                Shoe\n                    Sports Shoe\n                    Casual Shoe\n                shirts\n                    Formal Shirts\n\n         [Column2]\n\n\n           Reebok\n                Shoe\n                    Sports Shoe\n                    Casual Shoe\n                shirts\n                    Formal Shirts\n</code></pre>\n\n<p>i should be able to insert in my DB like this</p>\n\n<pre><code>            [MenuId],[MenuName],[ParentID]\n               1    ,Nike       ,\n               2    ,Shoe       ,1 [Nike(Id of Nike)]\n               3    ,Soprts Shoe,2 [shoe(Id of Shoe)]\n               4    ,Casual Shoe,2 [shoe(Id of Shoe)]\n</code></pre>\n\n<p>in this way i should be able to insert my data,cana ny one help me here please ,i am not getting any idea here from where should i start this,</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13136022,"title":"select from the result of execute(@query)","body":"<p>I am using this SQL query</p>\n\n<pre><code>DECLARE @cols AS NVARCHAR(MAX),\n    @query  AS NVARCHAR(MAX)\n\nselect @cols = STUFF((SELECT distinct ',' + QUOTENAME(Animal2) \n                    from animals\n            FOR XML PATH(''), TYPE\n            ).value('.', 'NVARCHAR(MAX)') \n        ,1,1,'')\n\nset @query = 'SELECT Animal1, ' + @cols + ' from \n             (\n                select animal1, animal2, Corelation\n                from animals\n            ) x\n            pivot \n            (\n                min(Corelation)\n                for animal2 in (' + @cols + ')\n            ) p '\n\nexecute(@query)\n</code></pre>\n\n<p>See <a href=\"http://sqlfiddle.com/#!3/5b713/6\" rel=\"nofollow\">SQL Fiddle with demo</a></p>\n\n<p>When I execute the query I get a table as a return.</p>\n\n<p>How can I select from that table? I tried to use <code>SELECT * FROM (*past here the script*)</code> but it did not work. I just need to use the result of the execute(@query) as a table and select from it (to put it in a new table). How can I do it?</p>\n\n<p>Thanks</p>\n\n<p>NOTE: that query was an answer of <a href=\"http://stackoverflow.com/questions/13125187/sql-query-to-select-records-in-a-specific-format-using-pivot-or-other/\">this SO question</a></p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":18,"score":-1,"question_id":13135891,"title":"Creating a total row to display the total difference of column items in ms sql","body":"<p>I am trying to create a total row that takes items from a column and displays the difference in the total field as opposed to the sum. Is this even possible in SQL?</p>\n\n<pre><code>SELECT P.Part_Number, P.Units_On_Hand \nFROM Part AS P \nWHERE P.Part_Number IN ('AX12', 'AZ52')\n</code></pre>\n\n<p>This is the query I currently have to display the items I need the processing to be done on. How can I amend it to incorporate a total column to show the difference? </p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13134380,"title":"How to check cell value in GirdView if value is null then GrieView.Visible.Equals(false)","body":"<p>I want to checked value of Checkbox in GridView if any rows is null then next GridView can't show.</p>\n\n<pre><code>//Checkbox GridView1\n        foreach (GridViewRow rowItem in GridView1.Rows)\n        {\n            CheckBox chk = (CheckBox)(rowItem.Cells[4].FindControl(\"chkSelected1\"));\n            if (chk.Checked == false)\n            {\n                GridView2.Visible.Equals(false);\n                break;\n            }\n            else\n            {\n                GridView2.Visible.Equals(true);\n             }\n        }\n</code></pre>\n"},{"tags":["c#","winforms","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":39,"score":-1,"question_id":13134035,"title":"Saving data into two tables","body":"<p>I have two tables in my SQL Server 2008 database, one contains all the information about employee including image &amp; ID also and in another table having storing the image &amp; ID &amp; Image path....</p>\n\n<p>Can I use </p>\n\n<pre><code>insert into table1(e_imagedata) \nvalues(@ImageData1) \nwhere table2.e_id = table1.e_id\n</code></pre>\n\n<p>In SQL Server this query for inserting image in <code>table2</code> &amp; directly it will considered to <code>table1</code>... it doesn't work for now...</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1225,"score":0,"question_id":6490348,"title":"need to Show time in HH:MM format only","body":"<p>i declare a field as <strong>time</strong> in sql. it is storing the date in the format as <strong>HH:MM:SS</strong>. now i want to retrieve the time value in the format <strong>HH:MM</strong>  and show it on the design view. is it possible to show time only in HH:MM? if so how to cast it as <strong>HH:MM</strong> format?</p>\n"},{"tags":["c#","sql-server-2008","sync","syncframework","sql-server-ce-3.5"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12861769,"title":"Synchronisation SQL Server Compact 3.5 in C#","body":"<p>In my project, I want to sync SQL Server Compact 3.5 with MSSQL Server 2008. I passed all steps in Visual Studio 2010 like adding New Item >> Local Database Cache >> Configure Data Synchronization etc. The connection was complated successfully. But after this stage, I don't know how can i do synchronisation. <br>I have a button named \"Check Updates\". When clicked the update button, synchronisation must start and new datas from the MSSQL Server must add \"data.sdf\". I have no idea about how to be. I am a beginner in C# subjects. Could you help me?<br/>Kind regards.</p>\n"},{"tags":["sql-server","oracle","sql-server-2008","sql-server-2005","oracle11g"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13133378,"title":"Data Migration From Oracle To SQL Server","body":"<p>I have Oracle database in that in one or more table I have blob data also, i.e. images are stored, now I would like to move that data to sql server database, what is the best way to do this ?</p>\n\n<p>I would like to test for one table migration which contains image data in the Oracle database and move into SQL Server table.</p>\n\n<p>How do I test for migrating data from one table from Oracle to SQL Server ?</p>\n\n<p>but first thing I would like to confirm is that whether Image data moving from Oracle DB to SQL Server DB is possible, is there anything has to be taken care while migrating ?</p>\n\n<p>Thanks in advance.</p>\n\n<p>With Best Regards</p>\n"},{"tags":["sql-server-2008","jdbc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13133628,"title":"SQLException - Connection reset error","body":"<p>I am trying to establish a jdbc connection with SQL Server 2008 R2, using the SQLJDBC4 jar file and JDK 1.6. I am using Netbeans IDE and have added the SQLJDBC4 jar and added the path to the database in the 'databases' section in the services. The code is as below:</p>\n\n<pre><code>package connect2;\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.sql.Statement;\n\npublic class Connect2 {\n\n\n    public static void main(String[] args) throws SQLException {\n\n   Connection conn;\n        conn = null;\n           System.out.println(\"Done....\");\n\n           try\n           {\n\n               Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n\n               conn = DriverManager.getConnection (\"jdbc:sqlserver://172.17.39.13\\\\CRM:1433;databaseName=crm_xchanging\",\"crm_xchanging\",\"Welcome001\");\n               System.out.println (\"Database connection established\");\n\n\n           }\n           catch (ClassNotFoundException e)\n           {\n               System.out.println (e);\n           }\n           catch (SQLException ex)\n           {\n               System.out.println(\" error\");\n           }\n\n\n          finally\n         {\n             if (conn != null)\n              {\n\n                       try{\n\n               Statement st = conn.createStatement();\n                ResultSet res = st.executeQuery(\"SELECT * FROM  usertable\");\n                System.out.println(\"User Name: \" );\n                        while (res.next()) {\n                                String employeeName = res.getString(\"user_name\");\n                                System.out.println(employeeName);\n                                            }\n                    conn.close();\n    }\n                 catch(SQLException ex){\n  System.err.println(\"SQLException information\");\n\n  while(ex!=null) {\n  System.err.println (\"Error msg: \" + ex.getMessage());\n  System.err.println (\"SQLSTATE: \" + ex.getSQLState());\n  System.err.println (\"Error code: \" + ex.getErrorCode());\n  ex = ex.getNextException(); \n// For drivers that support chained exceptions\n  }}\n\n\n\n\n               }\n           }\n\n       }\n\n   }\n</code></pre>\n\n<p>This is the output I'm getting:</p>\n\n<pre><code>run:\nDone....\nDatabase connection established\nSQLException information\nError msg: Connection reset\nSQLSTATE: 08S01\nError code: 0\nBUILD SUCCESSFUL (total time: 1 second)\n</code></pre>\n\n<p>I don't think there is any mistake in the code or the JDK. I have also tried to set the max no. of active connections for SQL Server as 0 (infinite). How do I solve this problem?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1880,"score":2,"question_id":4875513,"title":"error in Multiple Select statements in Insert statement","body":"<p>I am writing a query which has multiple select statements in an insert statement</p>\n\n<pre><code>    INSERT INTO dbo.Products \n    (ProductName, \n     SupplierID, \n     CategoryID, \n     UnitsInStock, \n     UnitsOnOrder, \n     ReorderLevel, \n     Discontinued)\nVALUES  \n    ('Twinkies' , \n     (SELECT SupplierID FROM dbo.Suppliers WHERE CompanyName = 'Lyngbysild'),\n     (SELECT CategoryID FROM dbo.Categories WHERE CategoryName = 'Confections'), \n     0, \n     0, \n     10, \n     0)\n</code></pre>\n\n<p>Actually it gives error</p>\n\n<pre><code>Msg 1046, Level 15, State 1, Line 4\nSubqueries are not allowed in this context. Only scalar expressions are allowed.\nMsg 102, Level 15, State 1, Line 4\nIncorrect syntax near ','.\n</code></pre>\n\n<p>Where these two select statements returns only one value.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12539681,"title":"Renaming all constraint names with user defined names","body":"<p>How do I query the database for all types of constraints such as Primary Key,Foreign Key, Unique Key, and Default Constraint, and rename its system generate name to a name in following format:</p>\n\n<ul>\n<li>PK_ColumnName1_ColumnName2</li>\n<li>FK_ColumnName1</li>\n<li>UK_ColumnName1_ColumnName2</li>\n<li>DF_ColumnName1</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2008","replication"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":125,"score":1,"question_id":5820706,"title":"Adding foreign key constrain fails on subcriber","body":"<p>I have a replicated database using SQL Server 2008. Here is what I am trying to do.</p>\n\n<ol>\n<li>Create a new table  (MyNewTable)</li>\n<li>Create a column in an existing Table (MyExistingTable)</li>\n<li>Create a FK constraint on this column (in #2) as it points to PK to new table from #1.</li>\n</ol>\n\n<p>However when data get replicated to subscriber, i get following error in replication monitor.</p>\n\n<blockquote>\n  <p>The schema script \"script for adding foreign key constraint\" could not be propagated to the subscriber. (Source: MSSQL_REPL, Error number: MSSQL_REPL-2147201001)\n  Get help: <a href=\"http://help/MSSQL_REPL-2147201001\" rel=\"nofollow\">http://help/MSSQL_REPL-2147201001</a>\n  Foreign key \"MyFKConstraint\" references invalid table \"MyNewTable\" (Source: MSSQLServer, Error number: 1767)</p>\n</blockquote>\n\n<p>This script runs fine on publisher though. Some people seem to suggest that adding foreign key constraint cannot be done in a replicated environment when its created between an existing table and a new table. This is kind of hard to buy for me although I am kind of new to SQL Server replication. Any thoughts?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":89,"score":3,"question_id":13048811,"title":"CTE parent-child showing siblings","body":"<p>I have a CTE-query that displays a tree using recursion. This works great when displaying the whole tree. But I want to pass in ID as a variable and include the siblings for each current node.</p>\n\n<p>Testcode:</p>\n\n<pre><code>DECLARE @TT TABLE \n(\nID int,\nName varchar(25),\nParentID int,\nSortIndex int\n)\n\nINSERT @TT \nSELECT 1, 'A', NULL, 1 UNION ALL\nSELECT 2, 'B_1', 3, 1 UNION ALL\nSELECT 3, 'B', 1, 2 UNION ALL\nSELECT 4, 'B_2', 3, 2 UNION ALL\nSELECT 5, 'C', 1, 3 UNION ALL\nSELECT 6, 'C_2', 5, 2  UNION ALL\nSELECT 7, 'A_1', 1, 1 UNION ALL\nSELECT 8, 'A_2', 1, 2 UNION ALL\nSELECT 9, 'C_1', 5, 1 \n\n\n;WITH CTETree\nAS\n(\n    SELECT *, CAST(NULL AS VARCHAR(25)) AS ParentName, 1 AS Lev,\n    CAST(ROW_NUMBER() OVER(ORDER BY SortIndex) AS VARBINARY(MAX)) AS SortPath\n    FROM @TT\n    WHERE ParentID IS NULL\n\n    UNION ALL\n\n    SELECT F.*, CTETree.Name AS ParentName, Lev + 1,\n    SortPath + CAST(ROW_NUMBER() OVER(ORDER BY F.SortIndex) AS BINARY(32))\n    FROM @TT AS F\n    INNER JOIN CTETree\n    ON F.ParentID = CTETree.ID \n)\n\nSELECT * FROM CTETree\n    ORDER BY SortPath\n\n/*\nDESIRED RESULT:\n\nWHEN ID = 3 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n2   B_1 3   1   B   3\n4   B_2 3   2   B   3\n5   C   1   3   A   2\n\nWHEN ID = 1 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n5   C   1   3   A   2\n\nWHEN ID = 9 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n5   C   1   3   A   2\n9   C_1 5   1   C   3\n6   C_2 5   2   C   3\n\n*/\n</code></pre>\n\n<p>SQL-Fiddle: <a href=\"http://sqlfiddle.com/#!3/d41d8/5526\" rel=\"nofollow\">http://sqlfiddle.com/#!3/d41d8/5526</a></p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13124280,"title":"SSRS 'rsAccessed Denied' for Users Present in Security","body":"<p>I am having an interesting issue with SSRS and security settings. I have 2008 R2 installed on a Windows Server 2008 box. All users log into their workstations using their active directory credentials, some are local admins, some are just standard users. I have no problem accessing either the management or directory site as DOMAIN\\administrator. </p>\n\n<p>I have all reports, folders and data sources set to inherit the security settings on the server, but when I go to a users machine and type in the server address (host/reportserver), I get rsAccess Denied DOMAIN\\USER user has insufficient permissions. </p>\n\n<p>I have tried a number of different things based on posts I've read. </p>\n\n<ul>\n<li>Added NT Authority\\Authenticated Users and NT Authority\\Network\nService to security permissions </li>\n<li>Gave users 'Administrator' level access on the report server</li>\n<li>Disabled UAC on the workstation   </li>\n</ul>\n\n<p>I read that launching IE as administrator might solve the issue. That would require all users to be local admins, no? I think that is an unacceptable solution.</p>\n\n<p>As always, I appreciate assistance anyone can offer.</p>\n"},{"tags":["sql-server-2008","sql-update","aggregate-functions","common-table-expression"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":12983982,"title":"Aggregate CTE and Update Query","body":"<p>I have studied a number of aggregate and CTE post but have not found a solution for updating a minumum value from a CTE to an additional (non-CTE) outside table.  This is using SQL 2008 (Microsoft managment studio).  I am combining dates from an appointment table, dates for services from a billing table, and then cross checking those with a field in a patient table.  If that field called New Patient Date is blank, I want to update it with the earliest date from the other two tables.  They all joined on a common ID called chart or chart number. Here is the code...Any insights?</p>\n\n<pre><code>WITH New_Patients (chart_nbr, First_Visit)\n  AS\n  ( SELECT A.[Chart], MIN(A.[Appt Date])\n      FROM Appointment AS A, Patient AS P\n      WHERE A.[Chart] = P.[Chart Number]\n        AND A.[Appt Date] IS NOT NULL\n      GROUP BY A.[Chart]\n\n   UNION\n\n   SELECT BD.[Chart], MIN(BD.[Service Date 1])\n    FROM [Billing Detail] AS BD, Patient AS P \n    WHERE BD.[Chart] = P.[Chart Number]\n      AND [Transaction Code] IN \n         ('99201', '99202', '99203', '99204', '99205', '99211', '99212', '99213', \n         '99214', '99215', '99241', '99242', '99243', '99244', '97001', '97002')\n      AND BD.[Service Date 1] IS NOT NULL\n    GROUP BY BD.[Chart]\n\n   UNION\n\n   SELECT P.[Chart Number], P.[New Patient Date]\n     FROM Patient AS P\n     GROUP BY P.[New Patient Date], P.[Chart Number]  )\n\nUPDATE [Patient]    \nSET Patient.[New Patient Date]=MIN(First_Visit)\nFROM Patient AS P, New_Patients AS NP\nWHERE P.[Chart Number] = NP.chart_nbr\n    AND P.[New Patient Date]IS NULL\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13130303,"title":"SQL Server Query with boolean issue","body":"<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nalter PROCEDURE [dbo].[TCCPAUsersAndNamesByJobPosition] @EmpOrfreeLance bit\n\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    SELECT distinct t1.UserId , tblCustomers.name \n    FROM tblTime t1\n    inner join tblCustomers on t1.UserId=tblCustomers.custID\n    where (t1.userid in (select distinct custID from tblCustomers where sectionCat Like '%,35%') )\n    AND (t1.UserId in (select distinct custID from tblCustomers where IsEmployee = @EmpOrfreeLance))\n\nend\n</code></pre>\n\n<p>tried it also with  <code>IsEmployee = CONVERT(bit,@EmpOrfreeLance)</code></p>\n\n<p>and <code>SET @EmpOrfreeLance= CASE @EmpOrfreeLance WHEN 1 THEN 0 ELSE 0 END</code></p>\n\n<p>same all it retuns same list with same results no matter what </p>\n\n<p>Shouldn't it be simple ???</p>\n\n<p><code>IsEmployee</code> col-datatype is <code>(bit,null)</code></p>\n\n<p>my dev SQL server is 2008 ..online server is 2005 should it be a matter ...  </p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13130411,"title":"How to test SQL Server stored procedure with external database reference?","body":"<p>I've inherited a system with the following in a stored procedure.</p>\n\n<pre><code>SELECT blah, bleah FROM ThirdPartyDB.dbo.SomeView\n</code></pre>\n\n<p><code>ThirdPartyDB</code> is a client interface DB which we don't have access to other than the a fore mentioned view. All this works fine in production, but currently I can't test it because I don't have a <code>ThirdPartyDB</code> on the test server.</p>\n\n<p>Obviously I'd like to address this, but I'm wondering what is the best way to go about this?</p>\n\n<p>Is just creating a new DB on the test server with a table named <code>SomeView</code>, which seems the simplest approach the best way, or is there a better way I'm not aware of?</p>\n"},{"tags":["c#","sql-server-2008","date","time"],"answer_count":4,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":6006,"score":7,"question_id":655049,"title":"What are equivalent C# datatypes for the new \"date\", \"time\" and \"datetimeoffset\" types?","body":"<p>What are the most suitable equivalent C# datatypes for the new \"date\", \"time\" and \"datetimeoffset\" datatypes in Sql Server 2008?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","bulkinsert"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1368,"score":3,"question_id":10507162,"title":"Determine ROW that caused \"unexpected end of file\" error in BULK INSERT?","body":"<p>i am doing a bulk insert:</p>\n\n<pre><code>DECLARE @row_terminator CHAR;\nSET @row_terminator = CHAR(10); -- or char(10)\n\nDECLARE @stmt NVARCHAR(2000);\nSET @stmt = '\n  BULK INSERT accn_errors\n   FROM ''F:\\FullUnzipped\\accn_errors_201205080105.txt''\n   WITH \n      (\n        firstrow=2,\nFIELDTERMINATOR = ''|''  ,\nROWS_PER_BATCH=10000\n   ,ROWTERMINATOR='''+@row_terminator+'''\n   )'\nexec sp_executesql @stmt;\n</code></pre>\n\n<p>and am getting the following error:</p>\n\n<pre><code>Msg 4832, Level 16, State 1, Line 2\nBulk load: An unexpected end of file was encountered in the data file.\nMsg 7399, Level 16, State 1, Line 2\nThe OLE DB provider \"BULK\" for linked server \"(null)\" reported an error. The provider did not give any information about the error.\nMsg 7330, Level 16, State 2, Line 2\nCannot fetch a row from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>is there a way to know on which ROW this error occurred?</p>\n\n<p>i am able to import 10,000,000 rows without a problem and error occurs after that</p>\n"},{"tags":["asp.net-mvc-3","sql-server-2008","dapper"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13127886,"title":"Dapper returns null for SingleOrDefault(DATEDIFF(...))","body":"<p>I have a SQL statement similar to:</p>\n\n<p><code>SELECT DATEDIFF(Day, startDate, endDate) FROM Data WHERE ProjectId=@id</code></p>\n\n<p>In the case where <code>Data</code> doesn't have any records for <code>ProjectId</code>, SQL Server returns null.</p>\n\n<p>In Dapper, I execute this via:</p>\n\n<p><code>value = conn.Query&lt;int&gt;(\"...\").SingleOrDefault()</code></p>\n\n<p>In this case, I expect the semantics of <code>SingleOrDefault</code> to mean \"if this is null, return zero.\" In fact, my code is even more zero-friendly:</p>\n\n<pre><code>int toReturn = 0;\nusing (var conn = ...) {\n  toReturn = conn.Query&lt;int&gt;(\"SELECT DATEDIFF(...))\");\n}\nreturn toReturn;\n</code></pre>\n\n<p>When I debug and step into this code, I find that the line <code>yield return (T)func(reader)</code> is throwing a null pointer exception.</p>\n\n<p>Am I doing something wrong here, or is this by design?</p>\n\n<p>(FYI, the work-around is to wrap my select in an <code>ISNULL(..., 0)</code>)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":57,"score":-1,"question_id":13127166,"title":"how to get median for every record?","body":"<p>There's no median function in sql server, so I'm using this wonderful suggestion:</p>\n\n<p><a href=\"http://stackoverflow.com/a/2026609/117700\">http://stackoverflow.com/a/2026609/117700</a></p>\n\n<p>this computes the median over an entire dataset, but I need the median per record.</p>\n\n<p>My dataset is:</p>\n\n<pre><code>+-----------+-------------+\n| client_id | TimesTested |\n+-----------+-------------+\n|    214220 |           1 |\n|    215425 |           1 |\n|    212839 |           4 |\n|    215249 |           1 |\n|    210498 |           3 |\n|    110655 |           1 |\n|    110655 |           1 |\n|    110655 |          12 |\n|    215425 |           4 |\n|    100196 |           1 |\n|    110032 |           1 |\n|    110032 |           1 |\n|    101944 |           3 |\n|    101232 |           2 |\n|    101232 |           1 |\n+-----------+-------------+\n</code></pre>\n\n<p>here's the query I am using:</p>\n\n<pre><code>select client_id,  \n    (\n    SELECT\n    (\n     (SELECT MAX(TimesTested ) FROM\n       (SELECT TOP 50 PERCENT t.TimesTested \n       FROM counted3 t \n       where t.timestested&gt;1 \n       and CLIENT_ID=t.CLIENT_ID \n       ORDER BY t.TimesTested ) AS BottomHalf)\n     +\n     (SELECT MIN(TimesTested ) FROM\n       (SELECT TOP 50 PERCENT t.TimesTested \n       FROM counted3 t \n       where t.timestested&gt;1 \n       and CLIENT_ID=t.CLIENT_ID \n       ORDER BY t.TimesTested DESC) AS TopHalf)\n    ) / 2 AS Median\n    ) TotalAvgTestFreq\nfrom counted3 \n\ngroup by client_id\n</code></pre>\n\n<p>but it is giving my funny data:</p>\n\n<pre><code>+-----------+------------------+\n| client_id | median???????????|\n+-----------+------------------+\n|    100007 |               84 |\n|    100008 |               84 |\n|    100011 |               84 |\n|    100014 |               84 |\n|    100026 |               84 |\n|    100027 |               84 |\n|    100028 |               84 |\n|    100029 |               84 |\n|    100042 |               84 |\n|    100043 |               84 |\n|    100071 |               84 |\n|    100072 |               84 |\n|    100074 |               84 |\n+-----------+------------------+\n</code></pre>\n\n<p><strong>i can i get the median for every client_id ?</strong></p>\n\n<p>I am currently trying to use this <strong>awesome</strong> query from Aaron's site:</p>\n\n<pre><code>select c3.client_id,(\n    SELECT AVG(1.0 * TimesTested ) median\n    FROM\n    (\n        SELECT o.TimesTested , \n        rn = ROW_NUMBER() OVER (ORDER BY o.TimesTested ), c.c\n        FROM counted3 AS o\n        CROSS JOIN (SELECT c = COUNT(*) FROM counted3) AS c\n        where count&gt;1\n    ) AS x\n    WHERE rn IN ((c + 1)/2, (c + 2)/2)\n    ) a\n    from counted3 c3\n    group by c3.client_id\n</code></pre>\n\n<p>unfortunately, as Richardthekiwi points out:</p>\n\n<blockquote>\n  <p>it's for a single median whereas this question is about a median\n  per-partition</p>\n</blockquote>\n\n<p>i would like to know how i can join it on <code>counted3</code> to get the median per partition?></p>\n"},{"tags":["sql","sql-server-2008","tsql","sql-order-by"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":60,"score":1,"question_id":13128296,"title":"SQL Query: Need order by count, most must be on top, the rest follows","body":"<p>TABLEA</p>\n\n<pre><code>JobCode Job1 Job2 Job3 zip\n------- ---- ---- ---- ----------\nF       F    S    NULL 90030\nF       F    S    NULL 90031\nF       F    S    NULL 90031\nF       F    S    NULL 90034\nF       F         NULL 90034\nF       F    S    NULL 90034\nF       F    S    NULL 90034\nF       F         NULL 90034\nF       F    S    NULL 90035\nF       F         NULL 90035-4640\n</code></pre>\n\n<p>EXPECTED RESULTS:</p>\n\n<pre><code>JobCode Job1 Job2 Job3 zip\n------- ---- ---- ---- ----------\nF       F    S    NULL 90034\nF       F         NULL 90034\nF       F    S    NULL 90034\nF       F    S    NULL 90034\nF       F         NULL 90034\nF       F    S    NULL 90031\nF       F    S    NULL 90031\nF       F    S    NULL 90030\nF       F    S    NULL 90035\nF       F         NULL 90035-4640\n</code></pre>\n\n<p>Those with the SAME Zip should be ON top, then the rest follows. \nORDER BY Zip does not work because it DOES sort by ZIP, and NOT by number of occurence</p>\n\n<p>Using SQL Server 08</p>\n"},{"tags":["sql-server-2008","table","insert","network-programming","locking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13128026,"title":"Lock table before inserting into it","body":"<p>I created a C# application that works with network. And I use SQL Server 2008 Express for my application.</p>\n\n<p><strong>My problem is:</strong></p>\n\n<p>When 2 people on 2 computers at exactly the same time click on the <code>Insert</code> button, 2 rows are added into the database with the same number (that is the fault).</p>\n\n<p>If time does not same, my application check some conditions and this problem will not occur.</p>\n\n<p><strong>My question is:</strong></p>\n\n<p>Now I want lock table before insert for 1 person and unlock table after insert.</p>\n\n<p>How to do this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":15,"score":-2,"question_id":13128093,"title":"Master,Child and a link table","body":"<p>I have a two tables (Invoice, Item) and a link or junction table(InvoiceItem)</p>\n\n<p>I enter data in the two tables(Invoice,Item) via seperate forms in vb.net. how to update the link table automatically as it hold the fk of these tables.</p>\n\n<p>Table created in sql server 2008</p>\n\n<p>Table Invoice\nInvNo Pk\nInvDate</p>\n\n<p>Table Item\nItemID Pk\nItemDescription</p>\n\n<p>Table InvoiceItem\nInvNo FK\nItemID FK</p>\n\n<p>Please assist by giving the code for the stored procedure and the vb.net front end coding</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13034169,"title":"how to aggregate values from a pivot?","body":"<p>my query returns a dataset that looks like this:</p>\n\n<pre><code>+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n| CLIENT_ID | count1 | TestFreq1 | stdv1 | count2 | TestFreq2 |  stdv2  | count3 | TestFreq3 |  stdv3  | count4 | TestFreq4 |  stdv4  | count5 | TestFreq5 |  stdv5  | count6 | TestFreq6 |  stdv6  | count7 | TestFreq7 |  stdv7  | count8 | TestFreq8 |  stdv8  | count9 | TestFreq9 |  stdv9  | count10 | TestFreq10 | stdv10 | count11 | TestFreq11 | stdv11  | count12 | TestFreq12 | stdv12 |\n+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n|    210893 |    136 |         0 |     0 |     81 |        41 | 79.2685 |     19 |        63 | 58.321  |     24 |        21 | 20.4896 |      5 |        25 | 8.228   |      6 |        24 | 24.0638 |      4 |        25 | 24.6103 | 2      | 25        | 2.12132 |      2 |        23 | 21.9203 | 1       | 33         | NULL   |       2 |         29 | 7.77817 | 1       | 38         | NULL   |\n|    123321 |     50 |         0 |     0 |      5 |        26 | 7.87401 |     14 |        45 | 51.8002 |      3 |        25 | 14.7422 |      2 |        22 | 17.6777 |      4 |        36 | 21.4942 |      3 |        36 | 22.2711 | NULL   | NULL      | NULL    |      4 |        35 | 9.30949 | NULL    | NULL       | NULL   |       1 |         31 | NULL    | NULL    | NULL       | NULL   |\n|    454322 |    232 |         0 |     0 |    173 |        10 | 33.8487 |     36 |        36 | 36.6602 |     32 |        15 | 17.485  |     10 |        38 | 22.4809 |     13 |        23 | 20.0477 |      7 |        18 | 11.4143 | 3      | 32        | 24.5425 |      6 |        25 | 16.8602 | 3       | 28         | 21.166 |       2 |         25 | 4.94975 | 1       | 34         | NULL   |\n+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n</code></pre>\n\n<p><strong>instead of forcing the data to go out to <code>count13, stdv13, testfreq13, ..14..14..14, 15.15.15</code> how can i aggregate all the values 12 and over in the same field?</strong></p>\n\n<p>here's my query, and thank you so much for your guidance:</p>\n\n<pre><code>;WITH counted AS (\n  SELECT\n    client_id,\n    COUNT(*) AS TimesTested,\n    (datediff(day,MIN(received_date),max(received_date)))\n  /COUNT(*) as TestFreq\n  FROM f_accession_daily\n  GROUP BY\n    client_id,\n    patient_id\n),\ncounted2 as (\n  SELECT\n    client_id,\n    TimesTested,\n    CAST(COUNT(*) AS varchar(30)) AS count,\n    CAST(AVG(testfreq) as varchar(30)) as TestFreq,\n    CAST(STDEV(TestFreq) as varchar(30)) Stdv\n  FROM counted\n  GROUP BY\n    client_id,\n    TimesTested\n    )\n    ,\nunpivoted AS (\n  SELECT\n    client_id,\n    ColumnName + CAST(TimesTested AS varchar(10)) AS ColumnName,\n    ColumnValue\n  FROM counted2\n  UNPIVOT (\n    ColumnValue FOR ColumnName IN (count, TestFreq,stdv)\n  ) u\n),\npivoted AS (\n  SELECT\n    client_id clientid,\n    count1, TestFreq1,stdv1,\n    count2, TestFreq2,stdv2,\n    count3, TestFreq3,stdv3,\n    count4, TestFreq4,stdv4,\n    count5, TestFreq5,stdv5,\n    count6, TestFreq6,stdv6,\n    count7, TestFreq7,stdv7,\n    count8, TestFreq8,stdv8,\n    count9, TestFreq9,stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n  FROM unpivoted\n  PIVOT (\n    MAX(ColumnValue) FOR ColumnName IN (\n      count1,TestFreq1,stdv1,\n      count2,TestFreq2,stdv2,\n      count3,TestFreq3,stdv3,\n      count4,TestFreq4,stdv4,\n      count5,TestFreq5,stdv5,\n      count6,TestFreq6,stdv6,\n      count7,TestFreq7,stdv7,\n    count8, TestFreq8,   stdv8,\n    count9, TestFreq9,   stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n    )\n  ) p\n)\nselect * from pivoted\n</code></pre>\n\n<p>just to clarify i want to return the same exact results, it's just that for the last column i want to aggregate all values that fall into the <code>12+ bucket</code>. all the fields are going to be the same except the last three, which are going to be:</p>\n\n<pre><code>+----------+-------------+---------+\n| count12+ | TestFreq12+ | stdv12+ |\n+----------+-------------+---------+\n| 353      | 32423       | NULL    |\n| NULL     | NULL        | NULL    |\n| 342      | 25324       | NULL    |\n+----------+-------------+---------+\n</code></pre>\n\n<p>please note the much greater numbers above compared to the rest because the <strong>12+</strong> have been aggregated.</p>\n\n<p>thank you so much for your guidance!</p>\n"},{"tags":["sql-server-2008","database-design","sql-view"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":117,"score":0,"question_id":12044792,"title":"Column name collision in SQL Server view joining database architecture","body":"<p>First of all, sorry the way I write, bad English here.</p>\n\n<p>Please, consider the following scenario:</p>\n\n<p>I made my database architecture combining views as such:</p>\n\n<ul>\n<li>Entity <code>City</code> has the columns { <code>city_id, city_name, state_name, ...</code> }</li>\n<li>Entity <code>User</code> has the columns { <code>user_id, user_name, user_login, city_id, ...</code> }</li>\n</ul>\n\n<p>Each entity has a view, the <code>city</code> view does not have FK to any other entity, so its a simple select.</p>\n\n<p><code>User</code> entity have one FK to <code>city</code> entity, so it makes a join with the <code>city</code> entity in the view.</p>\n\n<p>As the following example:</p>\n\n<pre><code>create view vw_user as\n    select user.user_id,\n           user.user_name,\n           user.user_login,\n           vw_city.*\n    from user (nolock)\n    inner join vw_city (nolock) on vw_city.city_id = user.city_id\ngo\n</code></pre>\n\n<p>So if you have an entity like user_access with a FK to user, the view of <code>user_access</code> will have an inner join to <code>vw_user</code>, and it will bring up all the columns from <code>user</code> and <code>city</code> entities.</p>\n\n<p>In the end, I just make a query on the view, and it returns the full entity with all the foreign references.</p>\n\n<p>This works great, and make the maintenance procedures very easier, I have a stored procedure that recompile all the views if any change is needed to one of the entities.</p>\n\n<p>But, it has a problem, and I discovered this in a very bad situation, the system that uses this architecture is working very fast and smooth already, and I need to join two entities that share the entity city for example, so it generates a collision of columns, SQL Server does not allow this in views, you can execute a query with collision with no problem, but you can't do it in a view.</p>\n\n<p>So, this is my problem, I need to find a way to fix this, but I can't find an answer to it myself.</p>\n\n<p>The only thing I ended up doing is making a hard-coded view with the columns renamed.</p>\n\n<p>But I want a solution for the entire architecture, something permanent, like an upgrade.</p>\n\n<p>This architecture is followed in code, with C#, so there is a dependence on the column names.</p>\n\n<p>When I read the data from the query, I need to get the data from the column name, so this code can be reused with other classes, doing the same thing that the view does in the query, in the c# code.</p>\n\n<p>So, getting data with ordinal is out of the question.</p>\n\n<p>Any ideas?</p>\n\n<p>Thanks, and sorry, but this is very hard to describe.</p>\n"},{"tags":["java","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":44,"score":-3,"question_id":13126723,"title":"Connect to sql server 2008 using java","body":"<pre><code>    public static String executeDML(String command) \n    {\n        // Create a variable for the connection string.\n        String connectionUrl = \"jdbc:sqlserver://localhost:1433;databaseName=Args\";\n            //\"databaseName=Args;integratedSecurity=true;\";\n        // Declare the JDBC objects.\n        java.sql.Connection con = null;\n        java.sql.Statement stmt = null;\n         java.sql.ResultSet rs = null;\n            try \n            {\n                // Establish the connection.\n                //Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n                    con =  java.sql.DriverManager.getConnection(connectionUrl);\n                    // Create and execute an SQL statement that returns some data.\n                    stmt = con.createStatement();\n                    rs = stmt.executeQuery(command);\n                    // Iterate through the data in the result set and display it.\n                    while (rs.next()) {\n                         return rs.getString(\"ProductNumber\");\n                    }\n                    return \"\";\n            }\n        // Handle any errors that may have occurred.\n        catch (Exception e) {\n            return e.getMessage();\n        }\n        finally {\n            if (rs != null) try { rs.close(); } catch(Exception e) {}\n                if (stmt != null) try { stmt.close(); } catch(Exception e) {}\n                if (con != null) try { con.close(); } catch(Exception e) {}\n        }\n    }\n</code></pre>\n\n<p>this code to connect sql server 2008 using java , but it raised an exception when java.sql.DriverManager.getConnection(connectionUrl) method is called.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13122395,"title":"Removing quotes added to column names from Excel import SQL Server 2008","body":"<p>I've noticed that when I use SSMS to import an Excel spreadsheet into SQL Server quotation marks are added.  I've read somewhere that for whatever reason it's necessary for Excel to do this.  Once in SQL Server, these quotes around the column names are useless and I'd like to have a programmatic way to remove them.  The closest thing, which doesn't work, that I have tried to make is <code>EXEC sp_rename 'Table.[\"withquotes\"]', NewColumnName, 'replace(Table.[\"withquotes\",'\"','']</code>.  I'd like to loop through all of the column names in a table and use the <code>replace</code> function wherever a those column names contain quotation marks.  Is there a typical, idiomatic way to do this?</p>\n"},{"tags":["sql","sql-server-2008","pivot"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":13125187,"title":"sql query to select records in a specific format (using pivot or other)","body":"<p>I have an SQL table like this:</p>\n\n<pre><code>Animal1       Animal2       Corelation\n---------+---------------+--------------\nCat             Cat           1       \nCat             Dog           0.6     \nCat             Mouse         0.8     \nDog             Cat           0.6 \nDog             Dog           1    \nDog             Mouse         0.4      \nMouse           Cat           0.8     \nMouse           Dog           0.4     \nMouse           Mouse         1   \n</code></pre>\n\n<hr>\n\n<p>I'm looking for an SQL query to return the following results:</p>\n\n<pre><code>Animal 1       Cat              Dog               Mouse\n---------+---------------+------------------+---------------+\nCat            1                  0.6               0.8\nDog            6                  1                 0.4\nMouse          0.8                0.4               1\n</code></pre>\n\n<p>Basically i want more readable version of the table.</p>\n\n<p>I tried to use pivot like this:</p>\n\n<pre><code>use SymbolsDB\nselect * from [AnimalsTable]\npivot (\n   [Corelation]\n   for [Animal2] in (select * from [Animal2]\n)\n</code></pre>\n\n<p>But it is not working. i am not sure if I understand how the pivot works and if it can be used in my case. Or is there another way to do it? (I am trying to avoid loops because I have 1 million record)</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13125550,"title":"Drop tables that starts with specific characters","body":"<p>I have multiple table names like g_str_a , g_str_ab , g_str_abc . I would like to drop all those tables that start with g_str on SQL Server 2008.</p>\n\n<p>Will <code>DROP Tables like 'g_str'</code> help?</p>\n\n<p>Please help me with the script. </p>\n"},{"tags":["sql","sql-server","performance","sql-server-2008","ssis"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":497,"score":4,"question_id":9290291,"title":"SQL Script in VM taking long time for execution","body":"<p>I have the Execute SQL Script package that contains the script to insert about 150K records.</p>\n\n<p>Problem in here is when I execute the package in the Virtual machine its taking 25 min's approx and the same package in physical machine its taking 2 min's</p>\n\n<p>Question 1? Why its taking that much time to load the same data in VM.\nQuestion 2? How to solve this performance issue.</p>\n\n<p>Physical machine configuration has 4GB Ram and 250GB HD + Windows server 2008 R2 + SQL server 2008 R2 Standard Edition.\nVirtual machine has the same Configuration</p>\n\n<p><strong>Update: The Problem is with the SQL Server in VM.</strong></p>\n\n<p><strong>Question 1? Why its taking that much time to Run the same script in VM.</strong></p>\n\n<p><strong>Question 2? How to solve this performance issue.</strong></p>\n\n<p>Both the batabases schema in Physical Machine and VM are identical. Other databases are also same. There was no indexing applied for that tables in both machines. Datatypes are same. harddisk as I said has the same configuration.</p>\n\n<p>No RAID is done on both the machines.</p>\n\n<blockquote>\n  <p>Physical machine has the 2.67GHz RAM Quad Core and in the virtual machine has the\n  2.00GHz RAM Quad Core</p>\n</blockquote>\n\n<p>Version of SQL PM:</p>\n\n<p>Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) Apr  2 2010 15:48:46    Copyright (c) Microsoft Corporation Standard Edition (64-bit) on Windows NT 6.1  (Build 7601: Service Pack 1)</p>\n\n<p>Version of SQL PM:</p>\n\n<p>Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) Apr  2 2010 15:48:46    Copyright (c) Microsoft Corporation Standard Edition (64-bit) on Windows NT 6.1  (Build 7601: Service Pack 1) (Hypervisor)</p>\n\n<p>I executed the script Execution plan for both are the same as there is no difference in plan.</p>\n\n<p>Vendor is HP ML350 Machine.</p>\n\n<p>There are almost 20 VM's on the same physical server out of which 7 servers are active.</p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13124897,"title":"Converting the nvarchar to int","body":"<p>I have google online this question and for the life of me couldn't figure out why this kept throwing errors, any help is appreciated.</p>\n\n<blockquote>\n  <p>Conversion failed when converting the nvarchar value 'SELECT @orderid\n  = t.orderid FROM  (SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY creationdatetime DESC) AS row FROM\n  [intranet].[dbo].handbook_appendix_data WHERE id = ' to data type int.</p>\n</blockquote>\n\n<pre><code>DECLARE @sql nvarchar(500)\nDECLARE @table varchar(40)\nSET @table = 'handbook_section_data';\nSET @table = 'handbook_appendix_data';\n\nDECLARE @parentid INT\nDECLARE @id INT\nDECLARE @published INT\nDECLARE @orderid INT\nSET @parentid = 2\nSET @id = -1\nSET @published = 1\n\nSET @sql = N'SELECT @orderid = t.orderid FROM \n(SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY creationdatetime DESC) AS row FROM [intranet].[dbo].'+@table+' WHERE id = '+@id+' AND published = '+@published+') AS t\nWHERE t.published = '+@published+' AND t.row = 1';\nEXEC SP_EXECUTESQL @sql, N'@orderid INT OUTPUT', @orderid = @orderid OUTPUT --Get the OrderID from ID\n\nPRINT @orderid\n</code></pre>\n"},{"tags":["sql-server-2008","c#-4.0","ef-code-first","foreign-keys","data-migration"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13123930,"title":"Error dealing with foreign key constraint","body":"<p>I'm currently having a Foreign Key issue with a project I'm working on.  I'm using Entity Code First to create my DB.  Here is what I have thus far.</p>\n\n<h2>Tables</h2>\n\n<p>Units: Id, ...</p>\n\n<p>Category: Id, ...</p>\n\n<p>CategoryUnits: Id, CategoryId, UnitId</p>\n\n<h2>Code First</h2>\n\n<p>Category.cs</p>\n\n<pre><code>public partial class Category : BaseEntity, ILocalizedEntity\n{\n    private ICollection&lt;CategoryUnits&gt; _categoryUnits;\n\n    ...\n\n    public virtual ICollection&lt;CategoryUnits&gt; CategoryUnits\n    {\n        get { return _categoryUnits ?? (_categoryUnits = new List&lt;CategoryUnits&gt;()); }\n        protected set { _categoryUnits = value; }\n    }\n}\n</code></pre>\n\n<p>Units.cs</p>\n\n<pre><code>public class Units : BaseEntity\n{\n    ...\n}\n</code></pre>\n\n<p>CategoryUnits.cs</p>\n\n<pre><code>public partial class CategoryUnits : BaseEntity, ILocalizedEntity\n{\n    public virtual int UnitId { get; set; }\n    public virtual int CategoryId { get; set; }\n\n    public virtual Units Unit { get; set; }\n    public virtual Category Category { get; set; }\n}\n</code></pre>\n\n<p>CategoryUnitsMap.cs</p>\n\n<pre><code>public partial class CategoryUnitsMap : EntityTypeConfiguration&lt;CategoryUnits&gt;\n{\n    public CategoryUnitsMap()\n    {\n        this.ToTable(\"CategoryUnits\");\n        this.HasKey(cu =&gt; cu.Id);\n\n        this.HasRequired(cu =&gt; cu.Unit)\n            .WithMany()\n            .HasForeignKey(cu =&gt; cu.UnitId);\n\n        this.HasRequired(cu =&gt; cu.Category)\n            .WithMany(c =&gt; c.CategoryUnits)\n            .HasForeignKey(cu =&gt; cu.CategoryId);\n    }\n}\n</code></pre>\n\n<p>Currently what's happening is I get the following message when I try to insert data during a data migration program:</p>\n\n<p>The INSERT statement conflicted with the FOREIGN KEY constraint \"CategoryUnits_Category\". The conflict occurred in database \"NopDB3\", table \"dbo.Category\", column 'Id'.</p>\n\n<p>Here is the code where I'm actually putting data into the table.</p>\n\n<p>Program.cs</p>\n\n<pre><code>private static void AddDefaultOfficeSuppliesUnitRights()\n    {\n        try\n        {\n            var unitIds = new List&lt;int&gt;();\n            var sqlSelectStatement = \"Select * From Units With(NoLock)\";\n            var units = new DataSet();\n\n            using (var sqlCommand = new SqlCommand(sqlSelectStatement, sqlCon))\n            {\n                var sqlAdapter = new SqlDataAdapter();\n                sqlAdapter.SelectCommand = sqlCommand;\n                sqlCon.Open();\n                sqlAdapter.Fill(units);\n                sqlCon.Close();\n            }\n\n            foreach (DataRow dr in units.Tables[0].Rows)\n            {\n                var unitId = Int32.Parse(dr[\"Id\"].ToString());\n                unitIds.Add(unitId);\n            }\n\n            var sqlInsertStatement = GenerateCategoryUnitsForOfficeSupplies(\"Insert Into CategoryUnits (UnitId, CategoryId) Values (cuUnitId, 19)\", unitIds);\n            using (var sqlCommand = new SqlCommand(sqlInsertStatement, sqlCon))\n            {\n                sqlCon.Open();\n                sqlCommand.ExecuteNonQuery();\n                sqlCon.Close();\n            }\n\n            Console.WriteLine(\"Default Office Supply CategoryUnits Added\");\n        }\n        //Something went wrong\n        catch (Exception ex)\n        {\n            Console.WriteLine(\"Error in Add Default Category Units for Office Supplies: \" + ex.Message);\n        }\n        //Close out sql connection\n        finally\n        {\n            if (sqlCon.State != ConnectionState.Closed) sqlCon.Close();\n        }\n    }\n\nprivate static string GenerateCategoryUnitsForOfficeSupplies(string sqlInsertStatement, List&lt;int&gt; unitIds)\n    {\n        var sqlInsertStatements = string.Empty;\n        foreach (var unitId in unitIds)\n        {\n            sqlInsertStatements += sqlInsertStatement.Replace(\"cuUnitId\", unitId.ToString()) + \"; \";\n        }\n\n        return sqlInsertStatements;\n    }\n</code></pre>\n\n<p>The oddest thing about this is when I manually insert the data by sql statement, it works fine and has no errors.  Any suggestions would be helpful.</p>\n"},{"tags":["c#","sql-server-2008","entity-framework","exception-handling","foreign-keys"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":60,"score":0,"question_id":13123397,"title":"Getting INSERT statement conflicted with the FOREIGN KEY on SaveChanges()","body":"<p>I am new to working with the Entity Framework with SQL Server and I am having trouble inserting a record into my database. The problem is with 3 tables that are linked with primary keys and a foreign key and in the past I have not used databases with foreign keys.</p>\n\n<p>I am just trying to get some test data into the database for now but I keep getting the error: </p>\n\n<blockquote>\n  <p><em>INSERT statement conflicted with the FOREIGN KEY</em></p>\n</blockquote>\n\n<p>Can anyone help me get started with inserting into my database please? Here is the code I am using:</p>\n\n<pre><code>private void button3_Click(object sender, EventArgs e)\n{\n    TaxiDBEntities db = new TaxiDBEntities(); //connection to database\n    DriverStatus newDriverStatus = new DriverStatus(); // driver status object\n\n    /*populate the new driver object*/\n    //newDriverStatus.DriverID = Convert.ToInt32(driverComboBox.Text);\n    //newDriverStatus.Status = statusTextBox.Text;\n    //newDriverStatus.Area = areaTextBox.Text;\n\n    Driver driver = new Driver();\n\n    int driverIDInt = Convert.ToInt32(driverComboBox.Text);\n\n    //driver = db.Drivers.SingleOrDefault(p =&gt; p.DriverId == driverIDInt);\n    //if (driver == null)\n    //{\n        driver.DriverId = driverIDInt;\n        driver.Fname = \"test\";\n        driver.Lname = \"test\";\n    //}\n\n    db.DriverStatus.AddObject(newDriverStatus); // add driver object to entity model\n\n    DriverLog driverLog = new DriverLog();\n\n    driverLog.driverLogID = driverIDInt;\n    driverLog.DriverID = driverIDInt;\n    driverLog.date = DateTime.Now;\n\n    db.DriverLog.AddObject(driverLog);\n\n    DriverStatus driverStatus = new DriverStatus();\n\n    driverStatus.DriverID = driverIDInt;\n    driverStatus.Status = \"1\";\n    driverStatus.Area = \"1\";\n\n    db.DriverStatus.AddObject(driverStatus);\n\n    try\n    {\n        db.SaveChanges();\n    }\n    catch (Exception ex)\n    {\n        MessageBox.Show(ex.ToString());\n    }\n}\n</code></pre>\n"},{"tags":["sql-server-2008","user"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13123682,"title":"Create a user for SQL Server 2008?","body":"<p>I'm using this code to create a new user.</p>\n\n<pre><code>/****** Object:  User [primebox] ******/\nIF NOT EXISTS (SELECT * FROM sys.database_principals WHERE name = N'primebox')\nCREATE USER [primebox] FOR LOGIN [primebox] WITH DEFAULT_SCHEMA=[primebox]\nGO\n</code></pre>\n\n<p>and I got the following error when I try to create this specific user.</p>\n\n<blockquote>\n  <p><em>Msg 15007, Level 16, State 1, Line 1</em><br>\n  <em>'primebox' is not a valid login or you do not have permission.</em></p>\n</blockquote>\n\n<p>The part that I don't understand is, I can create others users but this one in particular looks invalid</p>\n\n<p>I tried to rename my database and got this error</p>\n\n<blockquote>\n  <p><em>Unable to rename primeboxs. (ObjectExplorer)</em></p>\n  \n  <p><em>Rename failed for Database 'primebox'.  (Microsoft.SqlServer.Smo)</em></p>\n  \n  <p><em>An exception occurred while executing a Transact-SQL statement or\n  batch. (Microsoft.SqlServer.ConnectionInfo)</em></p>\n  \n  <p><em>The database could not be exclusively locked to perform the operation.\n  (Microsoft SQL Server, Error: 5030)</em></p>\n</blockquote>\n\n<p>My guess is that the problem is the database name... but I got the code from another database (I'm creating a 'wanna be' backup) with the same user and database names. So I'm in a corner here... Any help will be a LOT appreciated =) </p>\n\n<p>PS: My computer name is box, windows 7. Using SQL Server 2008</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","select"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":13121094,"title":"Doing a comparison using the previous row?","body":"<p>I'm trying to work out an efficient way of comparing two rows in SQL Server 2008.  I need to write a query which finds all rows in the <code>Movement</code> table which have <code>Speed &lt; 10</code> N consecutive times.</p>\n\n<p>The structure of the table is:</p>\n\n<p>EventTime\nSpeed </p>\n\n<p>If the data were:</p>\n\n<pre><code>2012-02-05 13:56:36.980, 2\n2012-02-05 13:57:36.980, 11\n2012-02-05 13:57:46.980, 2\n2012-02-05 13:59:36.980, 2\n2012-02-05 14:06:36.980, 22\n2012-02-05 15:56:36.980, 2\n</code></pre>\n\n<p>Then it would return rows 3/4 (13:57:46.980 / 13:59:36.980) if I looked for 2 consecutive rows, and would return nothing if I looked for three consecutive rows.  The order of the data is EventTime/DateTime only.</p>\n\n<p>Any help you could give me would be great.  I'm considering using cursors but they're usually pretty inefficient.  Also, this table is approximately 10m rows in size, so the more efficient the better! :)</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13123752,"title":"Divide by zero error encountered when using count then divide","body":"<p>I want to do a count on a field and then 1 divide by this number so i get a decimal.\nWhen using the code below I get error 'Divide by zero error encountered.'</p>\n\n<pre><code>COUNT(1/isnull(nullif(current_balance,0),0)) as BALANCE_CURRENT_NU\n</code></pre>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":56,"score":-1,"question_id":13123224,"title":"SQL Server stored procedure parameters data type error","body":"<p>The following stored procedure in SQL Server 2008 was throwing an error    </p>\n\n<pre><code>/****** Object:  StoredProcedure [dbo].[UpdateCPA]    ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROCEDURE [dbo].[pdateCPA_INT]\n    @CPAColumn_Name nvarchar(100), @value Int, @RecordNum nvarchar(100)\nAS\nBEGIN\n    SET NOCOUNT ON;\n    --declare @CPAColumn_Name nvarchar(100) = 'UsrsID'\n    --declare @value Int = 3575\n    --declare @RecordNum int = 1\n\n    declare @thedate smalldatetime\n    set @thedate = GETDATE()\n    --select @thedate as NOW\n\n    declare @cmd nvarchar(max)\n\n    set @cmd = 'Update tblTimeCPAReport \n    set ' + @CPAColumn_Name + ' = '+@value+' \n    set ReportLastUpdate = ' + @thedate + '\n    where RecordNum='+@RecordNum\n\n    exec sp_executesql @cmd\n    select @cmd\nEND\n</code></pre>\n\n<p>It's throwing this error</p>\n\n<blockquote>\n  <p><em>Conversion failed when converting the nvarchar value 'Update\n  tblTimeCPAReport set UsrsID = ' to data type int.</em></p>\n</blockquote>\n"},{"tags":["c#","asp.net","linq","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13122935,"title":"Filling a Dictionary with large amount of LinqToSql objects fills up memory (IIS7 - W3WP.EXE)","body":"<p>I have a LinqToSQL query that reads large amount of data for a specific ID from a Table called \"Clients\" which contains about 20 rows of data about the client.</p>\n\n<pre><code>  var allClients = from client in context.Clients\n                         where client.ID == ID\n                         select client;\n\n\n  Dictionary&lt;string, Client&gt; existingEmailMap = new Dictionary&lt;string, Client&gt;();\n  Dictionary&lt;string, Client&gt; existingCellphoneMap = new Dictionary&lt;string, Client&gt;();\n\n foreach (Client client in allClients)\n        {\n            if (client.Email != null &amp;&amp; !existingEmailMap.ContainsKey(client.Email.Trim().ToUpper()))\n                existingEmailMap.Add(client.Email.Trim().ToUpper(), client);\n\n\n            if (client.Cellphone != null &amp;&amp; !existingCellphoneMap.ContainsKey(client.Cellphone.Trim().ToUpper()))\n                existingCellphoneMap.Add(client.Cellphone.Trim().ToUpper(), client);\n        }\n</code></pre>\n\n<p>As you can see I loop for each \"Client\" in allClients and check if Email and CellPhone exist, if one of them does exist i place them inside a Dictionary - This action fills IIS memory and if i have 100,000 clients it could take a lot of time and totally fill IIS memory to the maximum the computer can handle.\nI need this Dictionary so i can do some other checks on the clients before doing any update or insert.</p>\n\n<p>I know that Client object contains many other information other than the Client Info which might fill up memory.</p>\n\n<p>Any way to resolve this issue?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","sqlbulkcopy"],"answer_count":6,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":4508,"score":6,"question_id":2593689,"title":"How to prevent duplicate records being inserted with SqlBulkCopy when there is no primary key","body":"<p>I receive a daily XML file that contains thousands of records, each being a business transaction that I need to store in an internal database for use in reporting and billing.\nI was under the impression that each day's file contained only unique records, but have discovered that my definition of unique is not exactly the same as the provider's. </p>\n\n<p>The current application that imports this data is a C#.Net 3.5 console application, it does so using SqlBulkCopy into a MS SQL Server 2008 database table where the columns exactly match the structure of the XML records. Each record has just over 100 fields, and there is no natural key in the data, or rather the fields I can come up with making sense as a composite key end up also having to allow nulls. Currently the table has several indexes, but no primary key.</p>\n\n<p>Basically the entire row needs to be unique. If one field is different, it is valid enough to be inserted. I looked at creating an MD5 hash of the entire row, inserting that into the database and using a constraint to prevent SqlBulkCopy from inserting the row,but I don't see how to get the MD5 Hash into the BulkCopy operation and I'm not sure if the whole operation would fail and roll back if any one record failed, or if it would continue.</p>\n\n<p>The file contains a very large number of records, going row by row in the XML, querying the database for a record that matches all fields, and then deciding to insert is really the only way I can see being able to do this. I was just hoping not to have to rewrite the application entirely, and the bulk copy operation is so much faster.</p>\n\n<p>Does anyone know of a way to use SqlBulkCopy while preventing duplicate rows, without a primary key? Or any suggestion for a different way to do this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2292,"score":1,"question_id":3041325,"title":"Unable to attach \"AdventureWorks2008\" Sample Database to a named Instance in SQL Server 2008","body":"<p>First of all \"Northwind\" and \"AdventureWorksDW2008\" databases attached without problem, but \"AdventureWorks2008\" fails with the following error.</p>\n\n<pre><code>//Msg 5120, Level 16, State 105, Line 1\n Unable to open the physical file \n\"C:\\Program Files\\Microsoft SQL Server\\MSSQL10.MSSQLSERVER\\MSSQL\\DATA\\Documents\".\n Operating system error 2: \"2(The system cannot find the file specified.)\".\n Msg 5105, Level 16, State 14, Line 1\n A file activation error occurred. The physical file name \n 'C:\\Program Files\\Microsoft SQL Server\\MSSQL10.MSSQLSERVER\\MSSQL\\DATA\\Documents' \n may be incorrect. Diagnose and correct additional errors, and retry the operation.\n Msg 1813, Level 16, State 2, Line 1\n Could not open new database 'AdventureWorks2008'. CREATE DATABASE is aborted.\n</code></pre>\n\n<p>I did not use the default database instance \"MSSQLSERVER\" during install.</p>\n\n<p>So where is it finding this path \"C:...\\MSSQL10.MSSQLSERVER...\\Documents\"?</p>\n"},{"tags":["sql-server-2008","asp.net-membership","website-admin-tool"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":12772486,"title":"Web Site Administration Tool: The connection name 'LocalSqlServer' was not found in the applications configuration or the connection string is empty","body":"<p>I'm trying to use the Web Site Administration Tool to configure membership for a web site on my server. I've created an aspnetdb database on my local copy of SQL Server, and through the WSAT, I've managed to add several roles, and to lock down a couple of directories on the server. </p>\n\n<p>However, when I try to manage users, I get the following error:</p>\n\n<blockquote>\n  <p>The connection name 'LocalSqlServer' was not found in the applications configuration or the connection string is empty. at System.Web.Util.SecUtility.GetConnectionString(NameValueCollection config) at System.Web.Security.SqlMembershipProvider.Initialize(String name, NameValueCollection config) at System.Web.Configuration.ProvidersHelper.InstantiateProvider(ProviderSettings providerSettings, Type providerType)</p>\n</blockquote>\n\n<p>Clearly, the LocalSqlServer connection string <em>is</em> OK, otherwise I wouldn't have been able to add the roles, for example.</p>\n\n<p>The relevant parts of web.config are as follows:</p>\n\n<pre><code>  &lt;connectionStrings&gt;\n        &lt;clear /&gt;\n        &lt;remove name=\"LocalSqlServer\"/&gt;\n        &lt;add name=\"LocalSqlServer\" connectionString=\"Data Source=(local);Initial Catalog=aspnetdb;User Id=LoginUser;Password=password;\" providerName=\"System.Data.SqlClient\"/&gt;\n  &lt;/connectionStrings&gt;\n\n  &lt;system.web&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.0\" /&gt;\n    &lt;authentication mode=\"Forms\"&gt;\n      &lt;forms loginUrl=\"~/Account/Login.aspx\" timeout=\"2880\" defaultUrl=\"~/admin/admin.aspx\" /&gt;\n    &lt;/authentication&gt;\n        &lt;membership defaultProvider=\"SqlProvider\" userIsOnlineTimeWindow=\"15\"&gt;\n            &lt;providers&gt;\n                &lt;clear /&gt;\n                &lt;add\n          name=\"SqlProvider\"\n          type=\"System.Web.Security.SqlMembershipProvider\"\n          connectionStringName=\"LocalSqlServer\"\n          applicationName=\"myapp\" /&gt;\n            &lt;/providers&gt;\n        &lt;/membership&gt;\n    &lt;profile&gt;\n      &lt;providers&gt;\n        &lt;clear /&gt;\n                &lt;add name=\"AspNetSqlProfileProvider\" type=\"System.Web.Profile.SqlProfileProvider\" connectionStringName=\"LocalSqlServer\" applicationName=\"myapp\" /&gt;\n      &lt;/providers&gt;\n    &lt;/profile&gt;\n    &lt;roleManager enabled=\"true\"&gt;\n      &lt;providers&gt;\n        &lt;clear /&gt;\n                &lt;add name=\"AspNetSqlRoleProvider\" type=\"System.Web.Security.SqlRoleProvider\" connectionStringName=\"LocalSqlServer\" applicationName=\"myapp\" /&gt;\n      &lt;/providers&gt;\n    &lt;/roleManager&gt;\n  &lt;/system.web&gt;\n</code></pre>\n\n<p>As far I understand it, the Clear/Remove elements should override any other config files, but regardless, I tried adding the same connection string to the relevant machine.config, but to no avail.</p>\n\n<p>Any ideas?</p>\n\n<p>As an alternative, is there any reason why I can't call the Membership DB stored procedures directly? Does anyone know of any supporting documentation?</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":13120634,"title":"Cannot find table 0 in dataset using storeprocedures","body":"<p>I am not getting filled dataset after executing storeprocedure.</p>\n\n<pre><code>protected void btnsub_Click(object sender, EventArgs e)\n{  ArrayList arInsert = ReturnParameter_insert();\n    DataSet dsInsertProfile = objadmin.GetGridData(arInsert, objconstant.sSP_INSERT_PROFILE);\n\n    if(int.Parse(dsInsertProfile.Tables[0].Rows[0].ItemArray[0].ToString())== 0)\n    { lblThank.Text = \"Your profile have been successfully saved.\";\n    }\n    else\n    {\n        lblThank.Text = \"Your profile is not saved, please try again later.\";\n    }\n}\npublic ArrayList ReturnParameter_insert()\n{\n    ArrayList arProfile = new ArrayList();\n    Object[] c_first_name = new object[3] { \"@strFname\", \"Varchar\", (txtfname.Text != \"\") ? txtfname.Text : \"\" };\n    arProfile.Add(c_first_name);\n    return arProfile;\n}\n public DataSet GetGridData(ArrayList dbArray, string sSpName)\n    {\n        DataSet dsDataSet = new DataSet();\n        dsDataSet = datamanager.GetGridData(dbArray, sSpName);\n        return dsDataSet;\n    }\npublic static SqlDbType GetSqlDataType(string sDataType)\n    {\n        return (sDataType == \"Integer\") ? SqlDbType.Int : (sDataType == \"Varchar\") ? SqlDbType.VarChar : (sDataType == \"Date\") ? SqlDbType.Date : SqlDbType.BigInt;\n    }\npublic static DataSet GetGridData(ArrayList dbArray, string sSpName)\n    {\n        DataSet dsDataSet = new DataSet();\n        SqlConnection cn = createConnection();\n        SqlCommand cmd = new SqlCommand();\n        cmd.CommandType = CommandType.StoredProcedure;\n        cmd.CommandText = sSpName;\n\n        object objPrMtrName;\n        object objSqlType;\n        object objPrMtrVal;\n        int i;\n        for (i = 0; i &lt; dbArray.Count; i++)\n        {\n            objPrMtrName = ((object[])(dbArray[i]))[0];\n            objSqlType = ((object[])(dbArray[i]))[1];\n            objPrMtrVal = ((object[])(dbArray[i]))[2];\n            cmd.Parameters.Add(objPrMtrName.ToString(), GetSqlDataType(objSqlType.ToString())).Value = objPrMtrVal;\n        }\n        cmd.Connection = cn;\n        try\n        {\n            SqlDataAdapter adp = new SqlDataAdapter(cmd);\n            adp.Fill(dsDataSet);\n            return dsDataSet;\n        }\n        catch (Exception ex)\n        {\n            throw ex;\n        }\n        finally\n        {\n            cn.Close();\n            cn.Dispose();\n        }\n    }\n</code></pre>\n\n<p>My store procedure:</p>\n\n<pre><code>CREATE Procedure spInsert_profile\n(\n@strFname  varchar(200)\n\n)\nAS\nBEGIN\nInsert into gdt_Users([c_first_name] ,[d_modified_dttm],[d_created_dttm])values(@strFname,GETDATE(),GETDATE())\nEND\n</code></pre>\n\n<p>Here I am using 3 tier , the same methods are working successfully for other pages but not for this particular code.the dataset in GETGRIDDATA method is filling null value.i am not able to find.Pls help me....</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":11,"score":-3,"question_id":13121453,"title":"How to use log shipping in database","body":"<p>we want to take backup of database from one server and restore on other for this we want to use log shipping.\nI don't know how to use it and what access rights user need on the server to do log shipping.\nCould you please let me know what step by step procedure involved to do the same.\nThanks in advance</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13121088,"title":"SQL sub query select doubts","body":"<p>LogTable in SQL Server</p>\n\n<pre><code>timestamp                  user_name     session_id\n2012-10-17 06:30:10        Sanjay        034A955F\n2012-10-17 06:30:20        Sanjay        034A955F\n2012-08-20 13:20:59        John          0547961A \n2012-08-20 13:21:05        John          0547961A \n2012-08-20 13:22:10        John          0547961A \n2012-10-17 04:02:10        John          0977661B \n</code></pre>\n\n<p>Desired output</p>\n\n<pre><code>user       Total_login      This_Month_Login   Recent_Login  \nSanjay     2                2                  2012-10-17 06:30:10 \nJohn       4                1                  2012-10-17 04:02:10 \n</code></pre>\n\n<p>I tried to write SQL SELECT query to get above output but I am not good in SQL so couldn't take it ahead and wrote only for 2 columns. Can you please help me to get above select output?</p>\n\n<pre><code>select user_name as 'User', count (distinct session_id) as 'Total_Login' \nfrom \"LogTable\" \ngroup by user_name\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":13119925,"title":"Find out the number of Days and nights using sql query","body":"<p>I have a situation like find out the number of days and nights in a given Date range in sql can anyone help me..\nthanks in advance </p>\n"},{"tags":["sql-server-2008","database-design","view","database-performance","rdms"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":13113085,"title":"Creating a view that contains a view - performance hit?","body":"<p>When composing a view - should I stick with the base tables or can I feel confident that including a view within a view will not hurt performance.  I want to include the view because it would allow me to change one base view if i have a change to the table design opposed to updating every single view that is dependent on the table changed.  It just seems like the smarter thing to do, but want to make sure I am not doing something considered bad practice or hurts performance. </p>\n"},{"tags":["sql-server-2008","visual-studio-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13120259,"title":"how to move through records retrieved from database without using binding navigator in vb.net?","body":"<p>If i have a different tables in the database and i have to retrieve that data into the different textboxes in visual studio 2008 without using binding navigator?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":485,"score":2,"question_id":2732356,"title":"List of all tables with a relationship to a given table or view","body":"<p>In SQL Server is there a command to return a list of all tables with a relationship to a given table or view?</p>\n\n<p>EDIT: SQL SERVER 2008</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13116222,"title":"How to get week number of the month from the date in sql server 2008","body":"<p>In SQL Statement in microsoft sql server, there is a built-in function to get week number but it is the week of the year.</p>\n\n<pre><code>Select DatePart(week, '2012/11/30') // **returns 48**\n</code></pre>\n\n<p>The returned value <strong>48</strong> is the week number of the year. </p>\n\n<p>Instead of <strong>48</strong>, I want to get <strong>1, 2, 3 or 4</strong> (week number of the month). I think the week number of the month can be achieved by modules with Month Number of this week. For e.g.</p>\n\n<pre><code>Select DATEPART(week, '2012/11/30')%MONTH('2012/11/30')\n</code></pre>\n\n<p>But I want to know is there other built-in functions to get WeekNumber of the month in MS SQL SERVER.</p>\n"},{"tags":[".net","vb.net","sql-server-2008","excel","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":514,"score":0,"question_id":12404809,"title":"How to import data from Excel into SQL Server 2008 ","body":"<p>I actually want to import data from an Excel file into an existing database (I use SQL Server 2008 and VB.net) using a T-SQL stored procedure called from my VB.NET app.</p>\n\n<p>So is there a possibility to do that just by coding (without using any other tool SSIS or the SS import and export wizard), if yes can somebody give me just a simple sample of code.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["visual-studio-2010","sql-server-2008","firewall"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1299,"score":0,"question_id":8536852,"title":"A network related or instance-specific error occured while establishing a connection to SQL Server, error 40 - Could","body":"<p>Since I re-installed windows7, visual studio and Sql Server 2008 the same, I can't add a connection to a .mdf.\nI have already allowed the 1433 port access in the firewall but the error message remains:</p>\n\n<p><strong>A network related or instance-specific error occured while establishing a connection to SQL Server. The server was not found or is not accessible. Verify the name instance is correct and that the SQL Server is configured to allow remote connections.(provider:Shared Memory Provider, error 40 - Could not open a connection to SQL Server)</strong></p>\n\n<p>can you please help me?</p>\n"},{"tags":["sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8400,"score":0,"question_id":4197674,"title":"Insert data into a view (SQL Server)","body":"<p>I have the following setup:</p>\n\n<pre><code>CREATE TABLE dbo.Licenses\n(\n Id    int IDENTITY(1,1) PRIMARY KEY,\n Name  varchar(100),\n RUser nvarchar(128) DEFAULT USER_NAME()\n)\n\nGO\n\nCREATE VIEW dbo.rLicenses\nAS\nSELECT Name\nFROM   dbo.Licenses\nWHERE  RUser = USER_NAME()\n\nGO\n</code></pre>\n\n<p>When I try to insert data using the view...</p>\n\n<pre><code>INSERT INTO dbo.rLicenses VALUES ('test')\n</code></pre>\n\n<p>an error arises:</p>\n\n<pre><code>Cannot insert the value NULL into column Id, table master.dbo.Licenses; column does not allow nulls. INSERT fails.\n</code></pre>\n\n<p>Why doesn't the auto increment of the identity column work when trying to insert using the view and how can I fix it?</p>\n\n<p>Scenario is:</p>\n\n<p><strong>The different users of the database should only be able to work with their own rows in that table. Therefore I am trying to use the view as a kind of security by checking the username.</strong> Is there any better solution?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13119639,"title":"Comparing Image Data Types In SQL","body":"<p>How to Compare <code>Image</code> data types?</p>\n\n<p>I need compare a file stored in DB with an uploaded file But it says that comparing <code>Image</code> data type is not possible I even tried to convert to <code>nchar</code> </p>\n\n<pre><code>(CONVERT(char(1000), FileData) \n</code></pre>\n\n<p>Can anyone help me?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":47,"score":3,"question_id":13119350,"title":"using tsql to create a contigious time line set","body":"<p>Long time reader, first time poster. Hoping some SQL guru can lend me some processing power to solve a SQL problem elegantly and without cursors.</p>\n\n<p>I am trying to create a time line type result set from a data set with money and a Date, where the order in which they appear is important. See sample data and expectation below.</p>\n\n<pre><code>DECLARE @OrderData TABLE(\n      ID                      INT IDENTITY,\n      ProductId               INT,\n      WarehouseId             INT,\n      Cost MONEY,\n      SaleDate          DATETIME\n)\n</code></pre>\n\n<p> </p>\n\n<pre><code>INSERT INTO @OrderData\nVALUES\n      (1, 1, 2.71, '2012-02-23 10:01')\n      ,(1, 2, 2.71, '2012-02-23 10:02')\n      ,(1, 1, 2.71, '2012-02-23 10:03')\n      ,(1, 1, 2.71, '2012-02-23 10:04')\n      ,(1, 1, 2.71, '2012-02-23 10:05')\n      ,(1, 1, 2.8, '2012-02-23 10:06')\n      ,(1, 1, 2.9, '2012-02-23 10:07')\n      ,(1, 1, 2.71, '2012-02-23 10:08')\n      ,(1, 1, 2.71, '2012-02-23 10:09')\n</code></pre>\n\n<p>The result I am looking for is a time line of sales with from and to dates for a product and warehouse combination within it own set of sales. As soon as the sale price changes in the dataset  this should spawn a new row in the result set.</p>\n\n<p>Result structure for sample data.</p>\n\n<pre><code>Product, warehouse, minsale date, Max sale date\n1,1,2.71, 2012-02-23 10.01, 2012-02-23 10.05\n1,1,2.80, 2012-02-23 10.06, 2012-02-23 10.06\n1,1,2.90, 2012-02-23 10.07, 2012-02-23 10.07\n1,1,2.71, 2012-02-23 10.08, 2012-02-23 10.09\n1,2,2.71, 2012-02-23 10.02, 2012-02-23 10.02\n</code></pre>\n\n<p>Cheers for any help available.</p>\n"},{"tags":["sql-server-2008"],"answer_count":5,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":7335,"score":9,"question_id":1878430,"title":"Update Collation of all fields in database on the fly","body":"<p>We recently moved our database from our SQL Server 2005 server to our SQL Server 2008 server.  Everything moved over fine, however now we are finding that we are getting collation conflicts.  The old server had a different collation with the new server.</p>\n\n<p>Now our tables created before the move are one collation, and the ones created after are another collation. </p>\n\n<p>Is there a way to update the tables/columns with the old collation to the new collation?</p>\n\n<p>I understand setting the default database/server collation does not modify any existing tables <a href=\"http://stackoverflow.com/questions/825814/changing-database-collation-doesnt-update-collation-of-varchar-text-fields-in-the\">(link)</a>.  I really don't want to recreate the database if I don't have to.</p>\n\n<p>Any help really appreciated.</p>\n\n<p>Thanks for your help guys, finally got it working. </p>\n\n<p>For future reference, here is my final script:</p>\n\n<pre><code>SELECT 'ALTER TABLE [' + SYSOBJECTS.Name + '] ALTER COLUMN [' + SYSCOLUMNS.Name + '] ' +\nSYSTYPES.name + \n    CASE systypes.NAME\n    WHEN 'text' THEN ' '\n    ELSE\n    '(' + RTRIM(CASE SYSCOLUMNS.length\n    WHEN -1 THEN 'MAX'\n    ELSE CONVERT(CHAR,SYSCOLUMNS.length)\n    END) + ') ' \n    END\n\n    + ' ' + ' COLLATE Latin1_General_CI_AS ' + CASE ISNULLABLE WHEN 0 THEN 'NOT NULL' ELSE 'NULL' END\n    FROM SYSCOLUMNS , SYSOBJECTS , SYSTYPES\n    WHERE SYSCOLUMNS.ID = SYSOBJECTS.ID\n    AND SYSOBJECTS.TYPE = 'U'\n    AND SYSTYPES.Xtype = SYSCOLUMNS.xtype\n    AND SYSCOLUMNS.COLLATION IS NOT NULL\n    AND NOT ( sysobjects.NAME LIKE 'sys%' )\n    AND NOT ( SYSTYPES.name LIKE 'sys%' )\n    GO\n</code></pre>\n\n<p>Here is the <a href=\"http://samsudeenb.blogspot.com/2007/01/changing-database-collation.html\">site</a> that contained the script I based it on. I had to tweak it to get it working correctly.</p>\n"},{"tags":["visual-studio-2008","sql-server-2008","export","publishing","wizard"],"answer_count":3,"favorite_count":3,"up_vote_count":9,"down_vote_count":0,"view_count":21233,"score":9,"question_id":1391013,"title":"SQL Database Publishing wizard with SQL Server 2008","body":"<p>I'm desperately looking for SQL Database Publishing wizard. I've download it but it seems to require SQL Server 2005. According to <a href=\"http://blogs.msdn.com/webdevtools/archive/2007/10/15/sql-database-publishing-wizard-is-now-in-visual-studio-orcas.aspx\">http://blogs.msdn.com/webdevtools/archive/2007/10/15/sql-database-publishing-wizard-is-now-in-visual-studio-orcas.aspx</a> it comes with Visual Studio 2008, but my Visual Studio 2008 Professional doesn't have that menu item.</p>\n\n<p>Any ideas how can I get the SQL Database Publishing wizard working with SQL Server 2008.</p>\n"},{"tags":["sql-server-2008","microsoft-commerce-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13116923,"title":"ODBC SQL Server Driver: String data, right truncation[22001]","body":"<p>I am using Microsoft commerce server 2002 to store data when I add one more column in SQL Server with <code>varchar(max)</code>. </p>\n\n<p>I am getting this error:</p>\n\n<blockquote>\n  <p>[Microsoft][ODBC SQL Server Driver]String data, right truncation[22001]<br>\n    [Microsoft][ODBC SQL Server Driver]String data, right truncation</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":51,"score":1,"question_id":13116036,"title":"Insert Trigger , Help Please","body":"<p>I have 'Employee Registration' form (Windows Application). When the employee registration is done, at the same time i want to create an user. Taking the 'EmpCode' value from 'Employee Registration' and making it the value of 'UserName'. Please help me to write a trigger for it. </p>\n\n<p>Employee Registration Table\nColumns are</p>\n\n<pre><code>EMPCODE, \nEMPNAME, \nDESIGNATION, \nDEPARTMENT, \nDOJ,  \nEMAILID, \nCATEGORY, \nEMPSTATUS, \nEMPMANAGER etc etc\n</code></pre>\n\n<p>UserCreation Table\nColumns are</p>\n\n<pre><code>USERNAME, \nUSERPASSWORD, \nUSERMAPPINGCODE, \nUSERTYPE, \nUSERACTIVE, \nUSEREMAIL\n</code></pre>\n\n<p>When the insertion for 'employee regstratn' happens, same time the following thngs shud happen in 'UserCreation ' table....,</p>\n\n<p><code>EMPCODE</code>'s value should be saved as <code>USERNAME</code>'s value. \n<code>EMPNAME</code>'s value should be saved as <code>USERPASSWORD</code>'s value.\n<code>USERMAPPINGCODE</code>'s value optional \n<code>CATEGORY</code>'s value should be saved as <code>USERTYPE</code>'s value. \n<code>USERACTIVE</code>'s value is 1\n<code>EMAILID</code>'s value should be saved as <code>USEREMAIL</code>'s value</p>\n\n<p>Please help....</p>\n"},{"tags":["sql-server-2008","ssis","data-migration"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13112548,"title":"Syntax error in migrating from SQL Server 2008 to MySQL using SSIS","body":"<p>This is my first SSIS package and I have followed some tutorials and everything looked good until I ran it. I am trying to sync the data from a SQL Server 2008 database to a MySQL database (only 1 table with 2 columns). After running the package I get the following error.</p>\n\n<blockquote>\n  <p><em>[ADO NET Destination [16]] Error: An exception has occurred during\n  data insertion, the message returned from the provider is: You have an\n  error in your SQL syntax; check the manual that corresponds to your\n  MySQL server version for the right syntax to use near '\"UPC\", \"Model\")\n  VALUES (p1, p2)' at line 1</em></p>\n</blockquote>\n\n<p>And on the next line </p>\n\n<blockquote>\n  <p>[SSIS.Pipeline]<br>\n  Error: SSIS Error Code DTS_E_PROCESSINPUTFAILED.<br>\n  The ProcessInput method on component \"ADO NET Destination\" (16) failed with error code 0xC020844B while processing input \"ADO NET Destination Input\" (19).<br>\n  The identified component returned an error from the ProcessInput method. The error is specific to the component, but the error is fatal and will cause the Data Flow task to stop running.  There may be error messages posted before this with more information about the failure.</p>\n</blockquote>\n\n<p>My questions are:</p>\n\n<ol>\n<li>Why I am getting this error ?</li>\n<li>How to solve it ?</li>\n</ol>\n"},{"tags":["java","sql-server-2008","bigdecimal"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13116730,"title":"does java.math.BigDecimal works with sql server float type","body":"<p>does java.math.BigDecimal works with sql server float type?</p>\n\n<p>my application is not accurate on calculation , what we have decided to do is refactor all the application (over 5 years of development and somthimg like 200 years of development)</p>\n\n<p>my question is if I want touch the application sql does integers who have worked just fine eith an sql type float , would b treated as such when the conversion would b to big decimal and vise versa .</p>\n\n<p>10x !!!!</p>\n"},{"tags":["sql-server-2008","entity-framework","views"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12239833,"title":"entity framework view does not show all rows when selecting","body":"<p>I have a regular view in sql server 2008 and I`m using entity framework generate design from database approach. I already know about the keys issues for views in entity framework but that is not my solution. When I  query select * from view, it brings out 3 rows which is right, but all the rows are the same and are the first row in the database view.</p>\n\n<p>some help would be very appreciated.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":3296,"score":2,"question_id":9393207,"title":"Cannot resolve the collation conflict between \"SQL_Latin1_General_CP1_CI_AS\" and \"Latin1_General_CI_AI\" in the equal to operation","body":"<p>I am getting below said collation error since I have moved from a desktop machine to a laptop. My database has hundreds of stored procedures, so any solution like overriding some queries or fix collation for a column is not possible for me. </p>\n\n<p>\"Cannot resolve the collation conflict between \"SQL_Latin1_General_CP1_CI_AS\" and \"Latin1_General_CI_AI\" in the equal to operation\"</p>\n\n<p>My problem is not unique and I have searched for this quite a lot, but solutions available suggest me to override queries with some code which is not feasible. Please suggest some solution that may avoid this collation thing. </p>\n\n<p>I have tried this to alter my database collation.</p>\n\n<pre><code>ALTER DATABASE testDB  \nCOLLATE French_CI_AI ;  \nGO  \n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","fulltext","fulltext-index"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":316,"score":2,"question_id":3914798,"title":"Can I define which word breakers to use when building a mssql fulltext index?","body":"<p>I have created a fulltext catalog that stores the data from some of the columns in a table, but the contents seem to have been split apart by characters that I don't really want to be considered word delimiters. (\"/\", \"-\", \"_\" etc..)</p>\n\n<p>I know that I can set the language for word breaker, and <a href=\"http://msdn.microsoft.com/en-us/library/ms345188.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms345188.aspx</a> gives som idea on how to install new languages - but I need more direct control than that, because all of those languages still break on the characters I want to not break on.</p>\n\n<p>Is there a way to define my own language to use for finding word breakers?</p>\n"},{"tags":["sql","sql-server-2008","cube"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":938,"score":1,"question_id":2866022,"title":"Sum and average over null values SQL Server 2008 Analysis Services","body":"<p>I have a simple problem, I think, but I have googled and can't find the solution.  I have a cube that has MeasureA, MeasureB and MeasureC.  Not all three measures have values for each record, sometimes they can be null, it's depending if it was applicable.</p>\n\n<p>Now for my totals, I need to average but the average must not take nulls into account.  Any help will be much appreciated.  When I view the measures, the null values show as zeros.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":439,"score":3,"question_id":6581031,"title":"Update date time column","body":"<p>I want to update a <code>DateTime</code> filed with value like <code>2008-04-22 00:00:00.000</code> and add a fixed time to it + <code>1 Hour</code></p>\n\n<p>example i have the column like <code>2008-04-22 00:00:00.000</code> to be like <code>2008-04-22 01:00:00.000</code></p>\n\n<p>thanks</p>\n"},{"tags":["java","sql","database","sql-server-2008","exception"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13115296,"title":"Best Practice for handling duplicate INSERT statements","body":"<p>I am currently using Java to try to INSERT a customer in my Database:</p>\n\n<pre><code>public void saveCustomer(Customer c)  {\n    getConnection();\n\n try {\n\n     CallableStatement pstmt =  con.prepareCall(\"{call sp_saveCustomer(?,?)}\");\n     pstmt.setString(1, c.getName());\n     pstmt.setString(2, a.getLastName());\n     pstmt.executeUpdate();\n\n     closeConnection();\n    } catch (SQLException e) {\n       // Handle Exception\n    }\n}\n</code></pre>\n\n<p>When a user tries to INSERT a duplicate record, the catch block will trigger. What I'm worried about is that I don't know if this means a performance hit. Isn't a better way to check if a customer already exists? Something like:</p>\n\n<pre><code>public void saveCustomer(Customer c) {\n    getConnection();\n\n boolean exists = false; \n\n\n     CallableStatement pstmt =  con.prepareCall(\"{call sp_checkCustomerExistence(?,?)}\");\n     pstmt.setString(1, c.getName());\n     pstmt.setString(2, a.getLastName());\n     ResultSet rs = pstmt.executeQuery();\n     if (rs.next()) exists = true;\n     if ( exists ){\n     closeConnection(); \n     return;\n     } \n\n     CallableStatement pstmt =  con.prepareCall(\"{call sp_saveCustomer(?,?)}\");\n     pstmt.setString(1, c.getName());\n     pstmt.setString(2, a.getLastName());\n     pstmt.executeUpdate();\n\n     closeConnection();\n\n}\n</code></pre>\n\n<p>What would be the best solution based on the best performance? Should I check myself if the customer exists or should I let the Exception be thrown?</p>\n"},{"tags":["sql","visual-studio-2010","sql-server-2008","visual-studio-2005","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":238,"score":0,"question_id":5488577,"title":"Tableadapter You must have Microsoft SQL 2005 or greater","body":"<p>I just received a project that hasnt been touched in a while. It was written in VS2005 and SQl 2000. I upgraded the project to VS2010 with no problems. However; when I tried to modify the table adapters etc. I get the error \"You must have Microsoft SQL 2005 or greater\".</p>\n\n<p>This project has 100's of datasets and table adapters all referencing SQL 2000.</p>\n\n<p>I guess I have 2 questions:\nShould I takeall these adapters out and make a data layer and connect to the DB that way?</p>\n\n<p>Or can I upgrade the DB to SQL 2008 and it will all work the way it is? Not sure what is the best approach on this one.</p>\n\n<p>And this is a desktop app if it matters.</p>\n\n<p>Any suggestions would be great.</p>\n\n<p>Thanks </p>\n"},{"tags":["sql-server-2008","tsql","geometry","geospatial","spatial"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13114479,"title":"LineString to find Vehicle Passing through my 2 Line (4 Points)","body":"<p>I have got a task where in I have to Draw 2 lines on Google Map (4 Points) and on Submit event I need to display the Vehicle passing through that points. I am able to draw 2 lines on google map which gives me 4 points in Lat/Longitude format.</p>\n\n<p>Now the main questions is how can I query the database to get the Vehicle passing through two lines. I know I might have to use LineString function in T-SQL but how do i get all the vehicle passing through that lines? Any suggestions is welcome.</p>\n"},{"tags":["sql-server-2008","table","stored-procedures","csv"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13088681,"title":"How to update/Edit table through CSVs?","body":"<p>I stored 2 contact numbers in a table corresponding to one companyID in companycontactno. table. I did that using extracting values from CSV in Stored procedure.</p>\n\n<p>If i want to edit those conact numbers Corresponding to company ID how am i going to do that ??</p>\n\n<p>This is the storedProcedure i will use for editing contact numbers .. i am having difficulty in updating it .. plz help</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n\nCREATE PROCEDURE dbo.EditCompanyDetails\n(\n@OldCompanyName varchar(max),\n@NewCompanyName varchar(max),\n@newAddress varchar(max),\n@newMailID varchar(max),\n@Temp varchar(8000)\n)\n\nAS\nBEGIN\nSET NOCOUNT ON;\n\ndeclare @compID int\n\nDECLARE @c int, @a varchar(max), @id int, @variable varchar(8000), @max int\n\nDECLARE @Temp_Table table (serial_no int Identity(1,1), value varchar(max))\n\n--PROCEDURE--\n\n--Editing Company Table--\nset @compID=(Select Company.CompanyID from Company where Company.CompanyName=@OldCompanyName)\n\nupdate Company\nset CompanyName=@NewCompanyName, [Address]=@newAddress, Email=@newMailID\nwhere Company.CompanyID=@compID\n\n--For CONTACT NUMBERS\n\n    --Using Table to store CSV seperately in each row--\nselect @c = CHARINDEX(',', @Temp)\n\nwhile @c &gt; 0\nBEGIN\n    insert into @Temp_Table\n    select LEFT(@Temp, @c - 1)\n\n    select @Temp = right(@Temp, LEN(@Temp) - @c)\n    select @c = CHARINDEX(',', @Temp)\nEND\n\n--Update Table CompanyContactNo\n  --CompanyContactNo have following Columns:\n   --CNoID (PK)\n   --CompanyID (references PK in Company table\n   --ContactNumber\n\nset @max= (select MAX(serial_no) from @Temp_Table)\n\n\nwhile @max &gt; 0\nBEGIN\nset @variable = (select value from @Temp_Table where serial_no=@max)\n\nupdate CompanyContactNo\nset ContactNumber=@variable\nwhere CompanyID=@compID\nset @max = @max-1\nEND\n\nEnd\n\nGO\n</code></pre>\n"},{"tags":[".net","asp.net-mvc","sql-server-2008","ado.net","enterprise-library"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13112220,"title":"SqlClient login fail when trying to connect to database","body":"<p>This is so weird.  Ok here's my connection string in the web.config of my MVC 4 project:</p>\n\n<p><strong>Here is the connection string in my Unit Test Project's App.Config file:</strong></p>\n\n<pre><code> &lt;add name=\"ConnectionString\" connectionString=\"Data Source=THESERVERNAME;Initial Catalog=THETABLE;Persist Security Info=True;Integrated Security=SSPI\" providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>(I've replaced real names with fakes for this posting privacy only)</p>\n\n<p><strong>My unit test is:</strong></p>\n\n<pre><code>[Test]\npublic void GetMember_ByContractNumber_ReturnsAValidMember()\n{\n    // Arrang\n    const Int64 contractNumber = 2604914977;\n\n    // Act\n    DTO.Member member = MemberCRUD.RetrieveMember(contractNumber);\n\n    //Assert\n    Assert.IsNotNull(member);\n    Assert.IsNotNullOrEmpty(member.FirstName);\n    Assert.IsTrue(member.ContractNumber &gt; 0);\n}\n</code></pre>\n\n<p>It passes just fine!\n  I get a valid member object back from the database CRUD call.</p>\n\n<p><strong>The Problem:</strong></p>\n\n<p>But at the same time, when I try to make essentially the same call and same connection string from an MVC controller, the the same CRUD method in my DL bombs, it out at this point in code:</p>\n\n<p>and I get this exception:</p>\n\n<pre><code>{\"Login failed for user 'OURDOMAIN\\\\MYPCNAMEISHERE$'.\"} System.Data.SqlClient.SqlException\n</code></pre>\n\n<p>This database is <strong>remote</strong>, not on my local system.</p>\n\n<p>So obviously it's permissions but I don't see how to resolve this.  I think the reason my unit test passed is because it was maybe using my windows account as the identity when making the call to the DB whereas IIS for my MVC app was using the AppPoolIdentity.  So not sure how to fix this.  In my web.config I have Authentication set to None but I also tried setting it to Windows auth and enabling windows auth in IIS...no luck.</p>\n\n<p>I'm trying to run through my settings but no combination has worked so far for this permission issue.</p>\n\n<p>Again IIS is setup to use AppPoolIdentity but I also tried Network Service as the identity and added Network Service as a user and gave it permissions to my SQL DB..no luck.  I'm gonna try to add the AppPoolIdentity to my SQL Server DB but I doubt it's gonna work still.  Not sure what to try.\n-------------------------------- SUPPORTING PICS / Very Latest Settings ------------------</p>\n\n<p> in my web.config</p>\n\n<p>(I've got dbo rights on my AD account below)\n<img src=\"http://i.stack.imgur.com/AFx0L.jpg\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/XWEY2.jpg\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/ysEgi.jpg\" alt=\"enter image description here\"></p>\n\n<p>UPDATE:</p>\n\n<p><strong>Here's what I just tried as of the latest:</strong></p>\n\n<p><strong>1) Added the following users to SQL Server Security for my DB and gave them DBO rights:</strong></p>\n\n<ul>\n<li>NT AUTHORITY\\ANONYMOUS LOGON</li>\n<li>DOMAIN\\MYPCNAME$</li>\n<li>NT AUTHORITY\\NETWORK SERVICE</li>\n</ul>\n\n<p><strong>2) Added the following users to the file system security permissions for my app folder:</strong></p>\n\n<ul>\n<li>Authenticated Users</li>\n<li>IUSR</li>\n<li>SYSTEM</li>\n<li>NETWORK SERVICE</li>\n<li>MY AD ACCOUNT (DOMAIN\\MYACCOUNT)</li>\n<li>IIS APPPOOL\\MyAppPoolName</li>\n</ul>\n\n<p><strong>3) Then tried out a few things..all failed with the same error (Login Failed) when I render the MVC View:</strong></p>\n\n<p>changed the app pool identity to use the <strong>Local Service</strong>.  It then tried to connect to the SQL DB using NT AUTHORITY\\ANONYMOUS LOGON - I get login failed for NT AUTHORITY\\ANONYMOUS LOGON</p>\n\n<p>changed the pool identity to use <strong>Local System</strong>.  It tried to auth to SQL using 'DOMAINNAME\\MYPCNAME$' - I get login failed for DOMAINNAME\\MYPCNAME$</p>\n\n<p>changed the app pool identity to use <strong>Network Service</strong>.  It tried connect using 'DOMAINNAME\\MYPCNAME$'. - I get login failed for DOMAINNAME\\MYPCNAME$</p>\n\n<p>changed the app pool identity to use <strong>ApplicationPoolIdentity</strong>.  It tried to connect using 'DOMAIN\\MYPCNAMEN$'. - I get login failed for DOMAINNAME\\MYPCNAME$</p>\n\n<p><img src=\"http://i.stack.imgur.com/p4oQ8.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server-2008","select","increment"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":105,"score":1,"question_id":13055295,"title":"Increment value in SQL SELECT statement","body":"<p>Here is the sample code for what I am trying to do and below is the result:</p>\n\n<pre><code>   CREATE TABLE dbo.#TempDoc_DocContRoles (DocID int null, FullName varchar(500), DocContRole \n     varchar (100), NumRole int null)\n\n   INSERT INTO #TempDoc_DocContRoles(DocID, FullName, DocContRole) \n\n      SELECT \n          d.DocID, c.FirstName + ' ' + c.LastName as FullName, ldcro.DocContRole \n      FROM \n          Document as d \n      JOIN \n          dbo.Split( ',','30,31') AS l ON d.DocID = cast(l.[Value] AS int)\n      JOIN \n          Doc_Contact AS dc ON d.DocID = dc.DocID \n      JOIN \n          Contact AS c ON dc.P_Number = c.P_Number \n      LEFT JOIN \n          lkpDocContactRole AS ldcro ON ldcro.DocContRoleID = dc.DocContRoleID \n      JOIN \n          dbo.Split( ',','1,2,7') AS r ON ldcro.DocContRoleID = cast(r.[Value] AS int)\n\n\n   CREATE TABLE dbo.#MaxNumRoles (DocID int null, DocContRole varchar(100), NumRole int null)\n\n   INSERT INTO  dbo.#MaxNumRoles (DocID,DocContRole,NumRole)\n      SELECT \n          DocID, DocContRole, COUNT(*) \n      FROM \n          dbo.#TempDoc_DocContRoles \n      GROUP BY \n          DocID, DocContRole \n      HAVING \n          Count(*) &gt; 0\n\n   UPDATE td \n   SET td.NumRole = mr.NumRole\n   FROM dbo.#TempDoc_DocContRoles as td\n   INNER JOIN dbo.#MaxNumRoles as mr ON td.DocContRole = mr.docContRole \n\n   SELECT * FROM   dbo.#TempDoc_DocContRoles\n\n   DROP TABLE dbo.#TempDoc_DocContRoles   \n   DROP TABLE dbo.#MaxNumRoles \n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>DocID   FullName    DocContRole NumRole\n30      Smith    Author         3\n30      Daln     Staff          2\n30      Dolby    Author         3\n31      Tammy    Author         3\n30      Barny    Author         3\n30      Sanny    Res Coor       1\n30      Johny    Staff Rev      2\n</code></pre>\n\n<p>I would like to actually get:</p>\n\n<pre><code>DocID   FullName    DocContRole NumRole\n30      Smith    Author         1\n30      Daln     Staff          1\n30      Dolby    Author         2\n31      Tammy    Author         1\n30      Barny    Author         3\n30      Sanny    Res Coor       1\n30      Johny    Staff Rev      2\n</code></pre>\n\n<p>It should increment the number in <code>NumRole</code> per <code>docContRole</code> and <code>docID</code> (ex Author 1, Author 2 etc). Currently it gives the total number of authors per <code>DocID</code>.</p>\n\n<p>My ultimate goal is to get something like</p>\n\n<pre><code>       DocID    Author_1  Author_2 Author_3 Staff_1 Staff_2 ResCoor_1\n30              Smith      Dolby    Barny    Daln    Johny    Sanny \n31              Tammy   \n</code></pre>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":20,"score":-1,"question_id":13110102,"title":"Return a varchar(max) from a stored procedure in SQL Server 2008","body":"<p>I want to return a <code>varchar(max)</code> from a stored procedure in SQL Server 2008.</p>\n\n<p>So I tried:</p>\n\n<pre><code>alter proc SpSignup(\n    @username varchar(max),\n    @email varchar(max),\n    @password varchar(max),\n    @warning varchar(max) output)\nas\n   if exists(select email from [login] where email=@email)\n      return 'email already exists';\n\n   insert into [login](username, email, password) \n   values(@username, @email, @password)\n</code></pre>\n\n<p>I want to return a <code>varchar</code> value (<code>'email already exists'</code>) if the email exists in the table, and don't want to give any <code>@warning</code> as parameter.</p>\n\n<p>But it shows that <code>@warning para is not supplying</code> after exec this proc</p>\n\n<blockquote>\n  <p><em>Msg 201, Level 16, State 4, Procedure SpSignup, Line 0</em><br>\n  <em>Procedure or function 'SpSignup' expects parameter '@warning', which was not supplied.</em></p>\n</blockquote>\n\n<p>and also it doesn't shows the output (<code>'email already exists'</code>)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":58,"score":-1,"question_id":13099038,"title":"Get max of column using sum","body":"<p>I have one table with following data..</p>\n\n<pre><code>saleId amount date\n-------------------------\n  1     2000  10/10/2012\n  2     3000  12/10/2012\n  3     2000  11/12/2012\n  2     3000  12/10/2012\n  1     4000  11/10/2012\n  4     6000  10/10/2012\n</code></pre>\n\n<p>From my table I want result with max of sum amount between dates 10/10/2012 and 12/10/2012 which for the data above will be:</p>\n\n<pre><code>saleId  amount \n---------------\n1       6000\n2       6000\n4       6000\n</code></pre>\n\n<p>Here 6000 is the max of the sums (by saleId) so I want ids 1, 2 and 4.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","delete","delete-row"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":13108778,"title":"Fast deletion of many rows in data warehouse data","body":"<p>In SQL Server 2008 I have some million rows of data which needs be deleted. They are scattered across a handful of tables. Deletion takes up to 20 seconds which I think is way to slow! The data to be deleted is identified by a <code>timestamp</code> column. Here is what I have done so far in order to optimize:</p>\n\n<ul>\n<li>Using isolation level <code>read uncommitted</code>. I don't care about transactions. If we fail the user will issue the delete operation again. And new data is ensured not to have the <code>timestamp</code> we are deleting.</li>\n<li>Deleting leaf tables before parent tables.</li>\n<li>The <code>timestamp</code> column is part of the PK clustered index, in fact its the first position of the PK/index.</li>\n<li>Each table is emptied using a loop which deletes top 200000 entries in order to reduce the transaction log overhead.</li>\n<li>Neither I/O nor CPU is maxed out on the server</li>\n</ul>\n\n<p>What have I overlooked? </p>\n\n<p>Also I am in doubt of the effect of moving the timestamp column to  the first position in the PK. After doing so, must I reorganize the tables or is SQL Server smart enough to do this itself. My understanding of clustered index is that since it defines the physical layout of the rows, it is force into reorganizing the data. But we have no complaints from the customer that the changing clustered index operation took a long time to perform.</p>\n"},{"tags":["sql-server","sql-server-2008","ssms","ssms2008"],"answer_count":4,"favorite_count":3,"up_vote_count":15,"down_vote_count":0,"view_count":6863,"score":15,"question_id":2004789,"title":"How to alter SQL in \"Edit Top 200 Rows\" in SSMS 2008","body":"<p>In SQL Server 2008 Management Studio, when I right click on a database table and choose \"<strong>Select Top 100 Rows</strong>\", I can then e.g. easily add a \"ORDER BY \" statement to the SQL. That works <strong>fine</strong>.</p>\n\n<p>But when I do choose \"<strong>Edit Top 200 Rows</strong>\", I don't have the ability to <strong>alter</strong> the SQL (which makes it hard to find and edit a record just added in the 10,000 that are there.</p>\n\n<p>I am quite sure I was able to do this in <strong>SQL Server 2000</strong>.</p>\n\n<p><strong>Is there any way in SMSS 2008 to alter the way the records are displayed when editing records?</strong></p>\n"}]}
{"total":21073,"page":6,"pagesize":100,"questions":[{"tags":["sql-server-2008","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":25,"score":0,"question_id":13108219,"title":"How to stop automatic execution of a report?","body":"<p>If all parameters have the default value?</p>\n"},{"tags":["mysql","sql","sql-server","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":661,"score":0,"question_id":6311124,"title":"error 26 on sql server","body":"<p>I have prepared a program with Visual Basic 2010 and am using SQL database. (service based database) it works properly. But sometimes (when i dont use computer for a period like 2 hours) I try to start my program on VB (F5), it waits, and then gives this error:</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occured while establishing a connection to SQL Server. The server was not found or is not accesible. Verify that the instance name is correct and that SQL Server name is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified.)</p>\n</blockquote>\n\n<p>However, after restarting my computer one or two times, there is no error: it works well. I have googled it, but nothing helps. I'm afraid this error will be a problem when the user uses the program. How might I solve this?</p>\n"},{"tags":["android","sql-server-2008","ksoap2"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13098333,"title":"Android ksoap2 mssql 2008","body":"<p>I'm trying to pull values off my database msql2008 using  ksoap2. I have a .net webservice setup so that it will ask for a user and then return a string that is contained on the database. But it's not a function it's a procedure and the value is a reference variable. \nHere's my code. I've tried a number of things but nothing seems to work. </p>\n\n<pre><code>package com.example.hellosoap2;\n\nimport org.ksoap2.SoapEnvelope;\nimport org.ksoap2.serialization.PropertyInfo;\nimport org.ksoap2.serialization.SoapObject;\nimport org.ksoap2.serialization.SoapPrimitive;\nimport org.ksoap2.serialization.SoapSerializationEnvelope;\nimport org.ksoap2.transport.HttpTransportSE;\nimport android.app.Activity;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.widget.Button;\nimport android.widget.EditText;\nimport android.widget.TextView;\nimport android.widget.Toast;\n\npublic class MainActivity extends Activity {\n    private static String SOAP_ACTION1 = \"http://tempuri.org/HelloWorld\";\n    private static String NAMESPACE = \"http://tempuri.org/\";\n    private static String METHOD_NAME1 = \"HelloWorldResponse\";\n    private static String URL = \"http://www.letstrend.com/hello.asmx?WSDL\";\n    private static String SOAP_ACTION2 = \"http://tempuri.org/testGoal\";\n    private static String METHOD_NAME2 = \"testGoalResponse\";\n    private static String URL2 = \"http://www.letstrend.com/spurService.asmx?WSDL\";\n\nTextView test1, test2, test3, test4,test5,test6; \n@SuppressWarnings(\"deprecation\")\n@Override\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n    test1 = (TextView)findViewById(R.id.TextView01);\n\n    //Initialize soap request + add parameters\n\n    SoapObject request = new SoapObject(NAMESPACE, METHOD_NAME2);\n    String username = \"dash\";\n    String goalstr = \"\"; \n    request.addProperty(\"user\",username);\n    request.addProperty(\"goal\",goalstr);\n\n    //Declare the version of the SOAP request\n    SoapSerializationEnvelope envelope = new SoapSerializationEnvelope(SoapEnvelope.VER11);\n\n    envelope.setOutputSoapObject(request);\n    envelope.dotNet = true;\n    HttpTransportSE androidHttpTransport = new HttpTransportSE(URL2);\n\n    try {\n            androidHttpTransport.call(SOAP_ACTION2, envelope);\n        SoapPrimitive result=(SoapPrimitive)envelope.getResponse();\n        test1.setText(result.toString());\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n}  \n}\n</code></pre>\n\n<p>I should be sending the function Dash and getting back the value \"Lose 20 pounds\" in goalstr.</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13107602,"title":"transfer table data from one db to another db based on old 3 months date in sql server 2008 R2","body":"<p>i having database call sampleA table as transaction table, it is keep growing day by day, which is causing an issue while viewing report,thats the reason planing to reduce the volume of records in the table and move to another database, for this to achieve what are the steps to be done,kindly advice</p>\n"},{"tags":["c#","sql-server-2008","view","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":43,"score":0,"question_id":13106836,"title":"Is Entity key is a primary key in entity model","body":"<p>I have added view into entity model. It has 3 entity keys.\nThey are 1.Type 2.No 3.Customer. <img src=\"http://i.stack.imgur.com/d7DqA.png\" alt=\"View data in gridview\"></p>\n\n<p>Doubt:\nIf entity key is primary key then it will never show duplicate value.But in my grid showing duplicate values(see for <strong>Custmor</strong> column and <strong>Type</strong> column But not for <strong>No</strong> column).</p>\n\n<p>this is my SQL Result for view: This is showing duplicate value for No</p>\n\n<p><img src=\"http://i.stack.imgur.com/CLVaW.png\" alt=\"enter image description here\"></p>\n\n<p>Help: I need to show all data from view like SQL Reslut.</p>\n"},{"tags":["c++","sql-server-2008","qt4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12034525,"title":"QSqlDatabase ODBC query speed","body":"<p>I use <code>QSqlDatabase</code> to connect to remote <code>MSSQL Server</code>, but it seem the speed very slow. With a same query (the result is about 20 rows), i tried in <code>MSSQL Management 2008</code> take about 1s but in my application (use <code>QSqlDatabase</code>) it take nearly 8s, Anybody explain me why this happen?</p>\n"},{"tags":["sql-server","tsql","sql-server-2008","ssms2008"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":693,"score":5,"question_id":7207779,"title":"Scripts all Sprocs at once with DROP and CREATE","body":"<p>SQL Server 2008</p>\n\n<p><strong>Goal:</strong> To generate scripts for creating sprocs that are already in the DB. Must be one script per file.</p>\n\n<p>I know I can simply right click the database and 'Tasks>Generate Scripts', but that doesn't script the sproc in the template I want.</p>\n\n<p>I need the sproc to be scripted in the same template you get when you right click the sproc from the object explorer and 'Script Stored Procedure As>DROP and CREATE'.</p>\n\n<p>It's true you get a similar version of this through 'Tasks>Generate Scripts' but the main difference is the 'Tasks>Generate Scripts' method creates the script via the <code>dbo.sp_executesql</code> command because you cannot nest a <code>CREATE PROCEDURE</code> inside of an <code>IF</code> block</p>\n\n<p>Tasks>Generate produces this:</p>\n\n<pre><code>USE someDB\nGO\n\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'somesproc') AND type in (N'P', N'PC'))\nDROP PROCEDURE someSproc\nGO\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nIF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'someSproc') AND type in (N'P', N'PC'))\nBEGIN\nEXEC dbo.sp_executesql @statement = N'-- =============================================\nCREATE PROCEDURE \nAS\nBEGIN\n\nEND\n' \nEND\nGO\n</code></pre>\n\n<p>But I require this (as found from right clicking the sproc):</p>\n\n<pre><code>USE someDB\nGO\n\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'someSproc') AND type in (N'P', N'PC'))\nDROP PROCEDURE someSproc\nGO\n\nUSE someDB\nGO\n\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROCEDURE someSproc\n\nAS\nBEGIN\n    SET NOCOUNT ON;\n\nEND\n\nGO\n</code></pre>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server-2008","xml-parsing","xml-schema"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13096163,"title":"Shred XML into SQL Server 2008 creates duplicates","body":"<p>I have a XML file that I'm shredding into a table in SQL Server 2008. It goes several nodes deep and this is a first attempt for me to do this so I'm sure I'm missing the point somewhere.</p>\n\n<p>I got it to work, but for a XML with 97 records I get each record 97 times, i.e. a total of 9409 rows in the result set! That takes about 37 seconds. If I use <code>SELECT DISTINCT</code> I get the 97 rows but it (predictably) also takes 37 seconds.  </p>\n\n<p>First row of the XML:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;trmFileDataStream&gt;\n&lt;getTransactionDetails&gt;\n  &lt;getTransactionDetailsResponse&gt;\n    &lt;messages&gt;\n      &lt;resultCode&gt;Ok&lt;/resultCode&gt;\n      &lt;message&gt;\n        &lt;code&gt;I00001&lt;/code&gt;\n        &lt;text&gt;Successful.&lt;/text&gt;\n      &lt;/message&gt;\n    &lt;/messages&gt;\n    &lt;transaction&gt;\n      &lt;transId&gt;4570599999&lt;/transId&gt;\n      &lt;submitTimeUTC&gt;2012-08-12T20:52:05.01Z&lt;/submitTimeUTC&gt;\n      &lt;submitTimeLocal&gt;2012-08-12T15:52:05.01&lt;/submitTimeLocal&gt;\n      &lt;transactionType&gt;authCaptureTransaction&lt;/transactionType&gt;\n      &lt;transactionStatus&gt;pendingSettlement&lt;/transactionStatus&gt;\n      &lt;responseCode&gt;1&lt;/responseCode&gt;\n      &lt;responseReasonCode&gt;1&lt;/responseReasonCode&gt;\n      &lt;responseReasonDescription&gt;Approval&lt;/responseReasonDescription&gt;\n      &lt;AVSResponse&gt;P&lt;/AVSResponse&gt;\n      &lt;batch&gt;\n        &lt;batchId&gt;2007999999&lt;/batchId&gt;\n        &lt;settlementTimeUTC&gt;2012-08-12T21:12:40.193Z&lt;/settlementTimeUTC&gt;\n        &lt;settlementTimeLocal&gt;2012-08-12T16:12:40.193&lt;/settlementTimeLocal&gt;\n        &lt;settlementState&gt;pendingSettlement&lt;/settlementState&gt;\n      &lt;/batch&gt;\n      &lt;authAmount&gt;99.04&lt;/authAmount&gt;\n      &lt;settleAmount&gt;99.04&lt;/settleAmount&gt;\n      &lt;taxExempt&gt;false&lt;/taxExempt&gt;\n      &lt;payment&gt;\n        &lt;bankAccount&gt;\n          &lt;routingNumber&gt;XXXXCCCC&lt;/routingNumber&gt;\n          &lt;accountNumber&gt;XXXXNNNN&lt;/accountNumber&gt;\n          &lt;nameOnAccount&gt;Account Name&lt;/nameOnAccount&gt;\n          &lt;echeckType&gt;WEB&lt;/echeckType&gt;\n        &lt;/bankAccount&gt;\n      &lt;/payment&gt;\n      &lt;customer&gt;\n        &lt;id&gt;UWYN201H7C&lt;/id&gt;\n      &lt;/customer&gt;\n      &lt;billTo&gt;\n        &lt;firstName&gt;FirstName&lt;/firstName&gt;\n        &lt;lastName&gt;LastName&lt;/lastName&gt;\n        &lt;address&gt;123245 Some street.&lt;/address&gt;\n        &lt;city&gt;Some City&lt;/city&gt;\n        &lt;state&gt;WS&lt;/state&gt;\n        &lt;zip&gt;36123&lt;/zip&gt;\n        &lt;country&gt;USA&lt;/country&gt;\n        &lt;phoneNumber&gt;1234567891&lt;/phoneNumber&gt;\n      &lt;/billTo&gt;\n      &lt;recurringBilling&gt;false&lt;/recurringBilling&gt;\n    &lt;/transaction&gt;\n  &lt;/getTransactionDetailsResponse&gt;\n</code></pre>\n\n<p>My <code>SELECT</code> statement:</p>\n\n<pre><code>SELECT distinct\n  transactions.value ('(transId/text())[1]','varchar(100)') AS transID,\n  Replace(Replace(transactions.value ('(submitTimeUTC/text())[1]','varchar(100)'),'T',' '),'Z',' ') AS submitTimeUTC,\n  Replace(transactions.value ('(submitTimeLocal/text())[1]','varchar(100)'),'T',' ') AS submitTimeLocal,\n  transactions.value ('(transactionType/text())[1]','varchar(100)') AS transactionType,\n  transactions.value ('(transactionStatus/text())[1]','varchar(100)') AS transactionStatus,\n  transactions.value ('(responseCode/text())[1]','varchar(100)') AS responseCode,\n  transactions.value ('(responseReasonCode/text())[1]','varchar(100)') AS responseReasonCode,\n  transactions.value ('(responseReasonDescription/text())[1]','varchar(100)') AS responseReasonDescription,\n  transactions.value ('(AVSResponse/text())[1]','varchar(100)') AS AVSResponse,\n  transactions.value ('(authAmount/text())[1]','decimal(10,2)') AS authAmount,\n  transactions.value ('(settleAmount/text())[1]','decimal(10,2)') AS settleAmount,\n  transactions.value ('(taxExempt/text())[1]','varchar(100)') AS taxExempt,\n  transactions.value ('(recurringBilling/text())[1]','varchar(100)') AS recurringBilling,\n  rootb.value        ('(fileInformationLine/text())[1]','varchar(100)') AS FileInfo,\n\n  messagesb.value    ('(resultCode/text())[1]','varchar(100)') AS resultCode,\n  messageb.value     ('(code/text())[1]','varchar(100)') AS MsgCode,\n  messageb.value     ('(text/text())[1]','varchar(100)') AS MsgText,\n\n  batch.value        ('(batchId/text())[1]','varchar(100)') AS batchID,\n  batch.value        ('(settlementTimeUTC/text())[1]','varchar(100)') AS settlementTimeUTC,\n  batch.value        ('(settlementTimeLocal/text())[1]','varchar(100)') AS settlementTimeLocal,\n  batch.value        ('(settlementState/text())[1]','varchar(100)') AS settlementState,\n\n  bankacc.value      ('(routingNumber/text())[1]','varchar(100)') AS routingNumber,\n  bankacc.value      ('(accountNumber/text())[1]','varchar(100)') AS accountNumber,\n  bankacc.value      ('(nameOnAccount/text())[1]','varchar(100)') AS nameOnAccount,\n  bankacc.value      ('(echeckType/text())[1]','varchar(100)') AS echeckType,\n\n  Customer.value     ('(id/text())[1]','varchar(100)') AS customerID,\n\n  billTo.value       ('(firstName/text())[1]','varchar(100)') AS firstName,\n  billTo.value       ('(lastName/text())[1]','varchar(100)') AS lastName,\n  billTo.value       ('(address/text())[1]','varchar(100)') AS address,\n  billTo.value       ('(city/text())[1]','varchar(100)') AS city,\n  billTo.value       ('(state/text())[1]','varchar(100)') AS state,\n  billTo.value       ('(zip/text())[1]','varchar(100)') AS zip,\n  billTo.value       ('(country/text())[1]','varchar(100)') AS country,\n  billTo.value       ('(phoneNumber/text())[1]','varchar(100)') AS phoneNumber\n\nFROM\n   xmlImportTempTable\n\n/* Message branch */\nCROSS APPLY \n   xml_data.nodes('//trmFileDataStream/getTransactionDetails/getTransactionDetailsResponse') AS tMsg(getTD)\n\nOUTER APPLY     getTD.nodes('messages') AS getTD(messagesb)\nOUTER APPLY messagesb.nodes('message')  AS messagesb(messageb)\n\n/* Transaction branches */\nCROSS APPLY xml_data.nodes('//trmFileDataStream') AS Txn(rootb)\n\nOUTER APPLY        rootb.nodes('getTransactionDetails')         AS rootb(getTransDetl)\nOUTER APPLY getTransDetl.nodes('getTransactionDetailsResponse') AS rootc(getTransDtlResp)\nOUTER APPLY getTransDtlResp.nodes('transaction')                AS rootd(transactions)\n\nOUTER APPLY transactions.nodes('batch')       AS btc(batch)\nOUTER APPLY transactions.nodes('payment')     AS pmt(payment)\nOUTER APPLY      payment.nodes('bankAccount') AS bacc(bankacc)\nOUTER APPLY transactions.nodes('customer')    AS cust(customer)\nOUTER APPLY transactions.nodes('billTo')      AS billing(billTo)\n\nORDER BY transID\n</code></pre>\n\n<p>I CAN live with the performance (this will be ongoing imports and the xml files can be 6-7 times bigger than this one ) since I can extract the correct result set.  But I would really like to be able to figure out exactly how to do this right!  I just read here (http://stackoverflow.com/questions/61233/the-best-way-to-shred-xml-data-into-sql-server-database-columns) that adding the schema would help tremendously with the performance and I will try that tomorrow.  The multiple rows are the perplexing issue for me.</p>\n\n<p>Many thanks in advance:)</p>\n\n<p>Arnor Baldvinsson, Icetips Alta LLC</p>\n"},{"tags":["sql","sql-server-2008","tsql","ssis","data-warehouse"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":97,"score":2,"question_id":13061130,"title":"SQL SSIS using Derived Column Transform to deal with null data.. alternatives?","body":"<p>I have a source table that has 200+ columns, I am putting this into SSIS and using \"OLEDB  Source\" component to feed the data in then mapping the flow to a Derived Column Transformation to deal with null numeric/date/text data by replacing it with blank values.</p>\n\n<p>Currently, I am setting in my Derived Column the following expression:</p>\n\n<pre><code>ISNULL([EMPLOYEE ID]) ? \"\" : [EMPLOYEE ID]\n\nISNULL([EMPLOYEE FNAME]) ? \"\" : [EMPLOYEE FNAME]\n</code></pre>\n\n<p>etc...</p>\n\n<p>Since I have 200+ columns, I would have to do this 200 times in the Derived Transform, is there a better way of handling this using SSIS?</p>\n\n<p>Running SQL Server 2008 Standard on Windows 2008R2.</p>\n"},{"tags":["c#","sql-server","database","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":214,"score":3,"question_id":12292644,"title":"Speed up update of 185k rows in SQL Server 2008?","body":"<p>I have a binary file with about <strong>185k</strong> rows in it. <code>C#</code> parses file in seconds. What would be the best way to update <code>MSSQL</code> table with that data?</p>\n\n<p>What I've tried:</p>\n\n<ol>\n<li>Easiest way - read binary row, parse, update table. The whole process takes around 2 days to update all the data.</li>\n<li>Combine 200 update queries and send them at once to the MSSQL. In this case, update takes 8 to 10 hrs.</li>\n<li>Combine 500+ queries into single one. Works faster, but drops timeout exceptions time to time, so some updates are not going through.</li>\n</ol>\n\n<p>Any advice on how to speed up the update process?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13099957,"title":"Dynamic columns SQL Server","body":"<p>I need to come up with an output column based on the following dates entered.</p>\n\n<p>Here is what I have right now </p>\n\n<pre><code>declare @day1 date, @day2 date\n\nset @day1='4/1/2012'\nset @day2='8/31/2012'\n\nSelect * \nfrom\n   (select \n       at.Code, at.Description,\n       case MONTH(jex.Date)\n         when 1 then 'January'\n         when 2 then 'February'\n         when 3 then 'March'\n         when 4 then 'April'\n         when 5 then 'May'\n         when 6 then 'June'\n         when 7 then 'July'\n         when 8 then 'August'\n         when 9 then 'September'\n         when 10 then 'October'\n         when 11 then 'November'\n         when 12 then 'December'\n      end as [Month],\n      jep.Amount [Amount]\n   FROM \n       Journald jep\n   JOIN \n       Journa jex ON jex.JEntryID = jep.JyID\n   WHERE\n       CONVERT(VARCHAR(11), je.Date, 101) BETWEEN @day1 and @day2\n) Tba\nPivot(\nSUM([Amount])\nfor [Month] in ([January],[February],[March],[April],[May],[June],[July],[August],[Septemer],[October],[November],[December])\n)pivotx\n</code></pre>\n\n<p>I have an output where it lists all dates but I only needed to show columns based on the dates entered in this case April, May, June, July, August.</p>\n\n<p>EDIT Here is my output</p>\n\n<p><a href=\"http://i85.photobucket.com/albums/k42/esr0159/output.jpg\" rel=\"nofollow\">http://i85.photobucket.com/albums/k42/esr0159/output.jpg</a></p>\n\n<p>I only need April, May, June,July, August Columns but instead I am still showing all columns.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","csv"],"answer_count":7,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":7821,"score":3,"question_id":5611715,"title":"Where value in column containing comma delimited values","body":"<p>Hi I am wondering how to write an SQL statement for SQL Server 2008 that Selects entry's where a column contains a value, now the value within the column is a comma delimited list (usually - there could only be one entry (and no leading comma)) so what In checking for is \"is this value contained somewhere within the list?\", for instance:</p>\n\n<pre><code>COLUMN = Cat, Dog, Sparrow, Trout, Cow, Seahorse\nDoes COLUMN contain Cat? YES\nDoes COLUMN contain horse? NO\nDoes COLUMN contain Sheep? NO\n</code></pre>\n\n<p>or</p>\n\n<pre><code>COLUMN = Mouse\nDoes COLUMN contain Hare? NO\nDoes COLUMN contain Mouse? YES\n</code></pre>\n\n<p>etc</p>\n\n<p>I was thinking I could use the 'IN' keyword as such</p>\n\n<pre><code>SELECT id_column FROM table_name WHERE 'Cat' IN COLUMN\n</code></pre>\n\n<p>but this does not work as it seems that you can only use that to check if a column contains one of a series of comma delimited values.</p>\n\n<p>I also cannot use CONTAINS() OR 'LIKE' as this, in the above example would return values for 'horse' as the whole string contains horse in 'Seahorse', and I can't search for the needle plus a comma (if I'm looking for 'horse' the search would be 'horse,') as what if the entry is at the end of a the list?  And I can't search for a comma plus a needle (if I'm looking for 'horse' the search would be ',horse')\nas what if the entry is the first in the list? And I can't use both as what if the entry is the only (single) entry?</p>\n\n<p>Thanks for any help anyone can give.</p>\n\n<p>Cheers.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","common-table-expression","nearest-neighbor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13103097,"title":"SQL Server : generating nearest neighbour routes","body":"<p>Having a little trouble with generating routes using a nearest neighbour methodology with SQL Server in T-SQL. </p>\n\n<p><strong>Note:</strong> Using SQL Server 2008, I do not have access to spatial extensions.</p>\n\n<p><strong>Background:</strong></p>\n\n<p>I have a query, which through a series of loops and loops within loops builds routes, however, this query can take in excess of 10 minutes to traverse over 100+ visits.</p>\n\n<p>I have a working system, but I would like to bring the execution time down. Trying to minimise loops as they seem to kill performance. I recently stumbled on CTEs and they have been wonderful for my optimisation so far.</p>\n\n<p>I have the following table populated with all the visits that I have over a given period:</p>\n\n<pre><code>DECLARE @Visits TABLE \n(\n    Unique_ID int identity(1,1), \n    Location_ID int, \n    Day_ID int, \n    Lat float, \n    Long float\n)\n</code></pre>\n\n<p>And I have built a legend of all possible paths per day using:</p>\n\n<pre><code>DECLARE @VisitLegend TABLE  \n(\n    Day_ID int, \n    locationFromId int, \n    locationToId int, \n    distance float\n)\n\nINSERT INTO @VisitLegend (dayId, locationFromId , locationToId , distance)\nSELECT \nv1.Day_ID,\nv1.Unique_ID, \nv2.Unique_ID, \n[dbo].[udf_Distance_Between] (v1.Lat, v1.Long, v2.Lat, v2.Long)\nFROM @Visits v1\nJOIN @Visits v2 on v1.Unique_ID &lt;&gt; v2.Unique_ID \n         AND v1.Current_Day_ID = v2.Current_Day_ID \n         AND NOT (v1.Unique_ID = v2.Unique_ID and v2.Unique_ID = v1.Unique_ID)\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>Is there a way where I can step through each visit in the <code>@Visits</code> table, traverse the <code>@Visit</code> Legend table by the shortest distance without going to the same visit twice ?</p>\n\n<p>I did make a stab at using a CTE with recursion, however my problem is that I cannot prevent it from selecting a visit again further up the tree, nor can I limit the recursive subset to the smallest distance without trying to use an aggregate or a joined subquery which would only work with references to the parent query.</p>\n\n<p>My current attempt was:</p>\n\n<pre><code>;WITH pathBuilder(dayId, nodeId, distance) AS\n(\n    SELECT Day_ID, Unique_ID, CAST(0.0 as float)\n    FROM @Visits \n        UNION ALL\n    SELECT pb.dayId, vl.locationToId, vl.distance\n    FROM pathBuilder pb\n    JOIN @VisitLegend vl on vl.dayId = pb.dayId \n        and vl.locationFromId = pb.locationId \n)\nSELECT * FROM pathBuilder\n</code></pre>\n\n<p>However I cannot seem to get this to select the locations from the visits table, then step through each in the legend following the shortest and never going back to a <code>visitLocationId</code> that it has already visited.</p>\n\n<p><strong>Intended result:</strong></p>\n\n<p><code>@VisitLegend</code> has the following:</p>\n\n<pre><code>dayId       locationFromId locationToId distance\n----------- -------------- ------------ -----------\n1           1              2            5\n1           1              3            4\n1           2              1            5\n1           2              3            7\n1           3              1            4\n1           3              2            7\n</code></pre>\n\n<p>Which would produce the sequences: </p>\n\n<pre><code>1, 3, 2\n2, 1, 3\n3, 1, 2\n</code></pre>\n\n<p>Any ideas ? Been banging my head against the wall for quite some time on this.</p>\n\n<p>Otherwise is it a case of just using loops and bearing with the execution time?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13099463,"title":"Query Optimizing Request","body":"<p>I am very sorry if this question is structured in not a very helpful manner or the question itself is not a very good one!</p>\n\n<p>I need to <code>update</code> a <code>MSSQL</code> <code>table</code> call <code>component</code> every 10 minutes based on information from another <code>table</code> call <code>materials_progress</code></p>\n\n<p>I have nearly 60000 records in <code>component</code> and more than 10000 records in <code>materials_progress</code></p>\n\n<p>I wrote an <code>update query</code> to do the job, but it takes longer than 4 minutes to complete execution!\nHere is the <code>query</code> : </p>\n\n<pre><code>UPDATE component \nSET stage_id = \nCASE \n    WHEN t.required_quantity &lt;= t.total_received THEN 27\n    WHEN t.total_ordered &lt; t.total_received THEN 18\n    ELSE 18\nEND\nFROM\n    (\n    SELECT \n        mp.job_id,  \n        mp.line_no,  \n        mp.component,  \n        l.quantity AS line_quantity, \n        CASE WHEN mp.component_name_id = 2 THEN l.quantity*2\n            ELSE l.quantity\n        END AS required_quantity,\n        SUM(ordered) AS total_ordered, SUM(received) AS total_received ,\n        c.component_id \n    FROM line l \n    LEFT JOIN component c ON c.line_id = l.line_id\n    LEFT JOIN materials_progress mp ON l.job_id = mp.job_id AND l.line_no = mp.line_no AND c.component_name_id = mp.component_name_id \n    WHERE \n        mp.job_id IS NOT NULL  \n        AND (mp.cancelled IS NULL OR mp.cancelled = 0)\n        AND (mp.manual_override IS NULL OR mp.manual_override = 0)\n        AND c.stage_id = 18\n    GROUP BY  mp.job_id,  mp.line_no,  mp.component, l.quantity, mp.component_name_id, component_id\n    ) AS t\n\nWHERE \n    component.component_id = t.component_id\n</code></pre>\n\n<p>I am not going to explain the scenario as it too complex.. could somebody please please tell me what makes this query this much expensive and a way to get around it?</p>\n\n<p>Thank you very very much in advance!!!</p>\n\n<p>Edit 1:\nHere is the execution plan;\n<img src=\"http://i.stack.imgur.com/xNgxe.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","sql-server-2008","view","primary-key"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13100088,"title":"How to add a new column (as a primary key column ) to view","body":"<p>Is it possible to add the column (PK) to view. if yes..How can we?</p>\n\n<p>This is my view :</p>\n\n<pre><code>CREATE VIEW [dbo].[SalesDetailView]\nAS\nSELECT\n    DATENAME(yyyy, SH.CreatedDateTime) AS Year,\n    DATENAME(mm, SH.CreatedDateTime) AS Month, SH.CreatedDateTime AS Date,\n    SH.TransactionName AS Type, SH.SalesHeaderID AS No,\n    Customer.CustomerName AS Customer,\n    CustomerGroup.CustomerGroupName AS Customer_Group, SH.Reference AS Memo,\n    Item.ItemName AS Item, SD.LineDescription AS Item_Description,\n    Item.ItemType AS Item_Type, Item.UOM,\n    ItemGroup.ItemGroupName AS Item_Group,\n    CAST (SD.Quantity AS INT) AS Quantity, CAST(SD.Amount AS MONEY) AS Amount,\n    SD.Price, SD.Discount, SH.ExchangeRate AS Exchange_Rate,\n    Currency.CurrencyDescription AS Currency, SD.ClassID AS Class_ID,\n    SD.SalesTaxID AS SalesTax_ID, SalesTaxGroup.SalesTaxGroupName AS Tax_Group,\n    Employee.EmployeeName AS Salesperson,\n    ShippingMethod.ShippingMethodName AS Shipping_Method,\n    PaymentTerm.PaymentTermName AS Payment_Term,\n    PaymentMethod.PaymentMethodName AS Payment_Method\nFROM\n    SalesHeader SH, Customer\nLEFT OUTER JOIN \n    SalesDetail SD ON SH.SalesHeaderID = SD.SalesHeaderID\nLEFT OUTER JOIN \n    Item ON SD.ItemID = Item.ItemID\nLEFT OUTER JOIN \n    ItemGroup ON Item.ItemGroupId = ItemGroup.ItemGroupID\nLEFT OUTER JOIN \n    CustomerGroup ON Customer.CustomerGroupId = CustomerGroup.CustomerGroupID\nLEFT OUTER JOIN \n    Employee ON Customer.EmployeeID = Employee.EmployeeID\nLEFT OUTER JOIN \n    Currency ON Customer.CurrencyID = Currency.CurrencyID\nLEFT OUTER JOIN \n    SalesTaxGroup ON Customer.SalesTaxGroupID = SalesTaxGroup.SalesTaxGroupID\nLEFT OUTER JOIN \n    PaymentTerm ON Customer.PaymentTermID = PaymentTerm.PaymentTermID\nLEFT OUTER JOIN \n    ShippingMethod ON Customer.ShippingMethodID = ShippingMethod.ShippingMethodID\nLEFT OUTER JOIN \n    PaymentMethod ON Customer.PaymentMethodID = PaymentMethod.PaymentMethodID\nWHERE\n    SH.CustomerID = Customer.CustomerID\n    AND SH.TransactionName &lt;&gt; 'SalesOrder'\n    AND Sh.TransactionName &lt;&gt; 'Quote'\n</code></pre>\n"},{"tags":["sql-server-2008","sqlbulkcopy"],"answer_count":6,"favorite_count":5,"up_vote_count":9,"down_vote_count":0,"view_count":1031,"score":9,"question_id":4747126,"title":"Fastest way to insert into a SQL Server table from .NET code?","body":"<p>What is the fastest way to do this:</p>\n\n<ul>\n<li>One table, no references that I cannot prefill (i.e. there is one reference key there, but i have all the data filled in)</li>\n<li>LOTS of data. We talk of hundreds of millions of rows per day, coming in dynamically through an API</li>\n<li>Requests must / should be processed as soon as feasible in a near real time scenario (i.e. no writing out to a file for upload one per day). 2 seconds is the normal maximal delay</li>\n<li>Separate machines for data / application and the SQL Server</li>\n</ul>\n\n<p>What I do now:</p>\n\n<ul>\n<li>Aggregate up to 32*1024 rows into an array, then queue it.</li>\n<li>Read the queue in 2-3 threads. Insert into database using SqlBulkCopy.</li>\n</ul>\n\n<p>I get about 60k-75k rows imported per second, which is not enough, but quite close. I would love to hit 250.000 rows.</p>\n\n<p>So far nothing is really used. I get 20% time \"network I/O\" blocks, have one core 80% loaded CPU side. Discs are writing out 7mb-14mb, mostly idle. Average queue length on a RAID 10 of 6 raptors is.... 0.25.</p>\n\n<p>Anyone any idea how to speed this up? Faster server (so far it is virtual, 8gb ram, 4 cores, physical disc pass through for data).</p>\n\n<hr>\n\n<p>Adding some clarifications:</p>\n\n<ul>\n<li>This is a 2008 R2 Enterprise SQL Server on a 2008 R2 server. machien has 4 cores, 8gb ram. All 64 bit. The 80% load average comes from this machine showing about 20% cpu load.</li>\n<li>The table is simple, has no primary key, only an index on a relational reference (instrument reference) and a unique (within a set of instruments, so this is not enforced) timestamp.</li>\n<li>The fields on the table are: timestamp, instrument reference (no enforced foreign key), data type (char 1, one of a nubmer of characters indicating what data is posted), price (double) and volume (int). As you can see this is a VERY thin table. The data in question is tick data for financial instruments.</li>\n<li>The quesstion is also about hardware etc. - mostly because i see no real bottleneck. I am inserting in multiple transactions and it gives me a benefit, but a small one. Discs, CPU are not showing significant load, network io wait is high (300ms/second, 30% at the moment), but this is on the same virtualization platform which runs JSUT the two serers and has enough cores to run all. I pretty much am open to \"buy anotehr server\", but i want to identify the bottlenech first.... especially given that at the end of the day I am not grabbbing what the bottleneck is. Logging is irrelevant - the bulk inserts do NOT go into the data log as data (no clustered index).</li>\n</ul>\n\n<p>Would vertical partitioning help, for exmaple by a byte (tinyint) that wuold split the instrument universe by for example 16 tables, and me thus doing up to 16 inserts at the same time? As actually the data comes from different exchanges I could make a partition per exchange. This would be a natural split field (which is actualyl in instrument, but I could duplicate this data here).</p>\n\n<hr>\n\n<p>Some more clarifications: Got the speed even higher (90k), now clearlyl mited by network IO between machines, which could be VM switching.</p>\n\n<p>What I do now is do a connetion per 32k rows, put up a temp table, insert into this with SqlBUlkdCopy, THEN use ONE sql statement to copy to main table - minimizes any lock times on the main table.</p>\n\n<p>Most waiting time is now still on network IO. Seems I run into issues where VM wise. wIll move to physicla hardware in the next months ;)</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13095871,"title":"Merge not inserting. No error","body":"<p>Can someone tell me why this insert is failing but not giving me an error either?  How do I fix this?</p>\n\n<pre><code>merge table1 as T1\nusing(select p.1,p.2,p.3,p.4,p.5 from @parameters p\ninner join table1 t2\non p.1 = t2.1\nand p.2 = t2.2\nand p.3 = t2.3\nand p.4 = t2.4) as SRC on SRC.2 = T1.2\nwhen not matched then insert (p.1,p.2,p.3,p.4,p.5) \nvalues (SRC.1,SRC.2,SRC.3,SRC.4,SRC.5)\nwhen matched then update set t1.5 = SRC.5;\n</code></pre>\n\n<p>The T1 table is currently empty so nothing can match.  The parameters table does have data in it.  I simply need to modify this merge so that it checks all 4 fields before deciding what to do.  </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1393,"score":3,"question_id":2136336,"title":"Sql Server 2008 Cross-database table linking (relationships)","body":"<p>I have a bit of an issue, and to be honest I don't think there's an answer, but I'll give it a try anyway.</p>\n\n<p>So I have two databases [A]->Company and [B]->Product. Both databases have a Country table which is then linked to other tables in each individual database. The problem is that the data between the two Country tables is a complete duplicate. So, I essentially have to duplicate some of the relationships in each database, and maintenance on top of that is just difficult...</p>\n\n<p>So, I'm curious is there a way to create a cross-database relationship between tables so I can have only one set of Country+Helper tables that govern both databases?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13098973,"title":"How To Secure SQL Server Database On Client Machine?","body":"<p>I Just Completed My Window Application,In Which I Use SQL Server 2008 as Back-End.\nI Install My App With Database In Client Machine.\nBut Problem Is That My Client Can Also See My Database Using Sql Server Mangement Studio.\nI Want to Prevent Client To See Database.\nHow can i do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":66,"score":4,"question_id":13093642,"title":"Select rows with same column A but different column B","body":"<pre><code>ID          Zip        Room\n----------- ---------- ------\n317         94087      S105\n318         94087      L603\n1739        94404-1801 L603\n1823        94401-2129 L603\n1824        94401-2129 L603\n2135        94404-1801 L603\n2268        95136-1459 S604\n2269        95136-1459 S604\n3704        92673-6417 L402\n4479        93454-9670 L402\n4480        93454-9670 L402\n4782        92395-4681 L402\n4783        92395-4681 L402\n4852        92886-4411 L402\n4853        92886-4411 L402\n4959        92673-6417 L402\n5153        91773-4028 L402\n5202        91773-4028 L402\n5211        91765-2959 L402\n5212        91765-2959 L402\n5388        92336-0605 L402\n5392        92336-0605 L402\n5727        92870      L402\n5728        92870      L402\n5831        92557      L402\n5916        92557      L402\n</code></pre>\n\n<p>How do I select ID's that has THE SAME zip but different Room ?</p>\n\n<p>In the table above, I want the result to be:</p>\n\n<pre><code>ID          Zip        Room\n----------- ---------- ------\n317         94087      S105\n318         94087      L603\n</code></pre>\n\n<p>Using SQL Server 2008</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":13095216,"title":"SQL no primary or candidate keys in the referenced table","body":"<p>Here's my problem when I write my SQLSever expressions:</p>\n\n<blockquote>\n  <p>There are no primary or candidate keys in the referenced table 'Room'<br>\n  that match the referencing column list in the foreign key 'FK_<em>Booking</em>_RoomNo__4E298478'.</p>\n</blockquote>\n\n<p>And some snapshots to my program:</p>\n\n<pre><code>CREATE TABLE Booking(\n   HotelNo  NVARCHAR(4)     not null,\n   GuestNo      SMALLINT,  \n   DateFrom DATETIME    not null,\n   DateTo       DATETIME,\n   RoomNo       SMALLINT    not null,\n\n   PRIMARY KEY (HotelNo,DateFrom,RoomNo), \n   FOREIGN KEY (HotelNo) REFERENCES Hotel(HotelNo),\n   FOREIGN KEY (GuestNo) REFERENCES Guest(GuestNo),\n   FOREIGN KEY (RoomNo) REFERENCES Room(RoomNo));  &lt;---trouble on this line\n\nCREATE TABLE Room(\n   RoomNo       SMALLINT    not null, \n   HotelNo  NVARCHAR(4)     not null, \n   RoomType     NVARCHAR(25),\n   Price        DECIMAL(5,2),\n\n   PRIMARY KEY (RoomNo,HotelNo), \n   CONSTRAINT fk_Room FOREIGN KEY (HotelNo) REFERENCES Hotel(HotelNo));\n</code></pre>\n\n<p>and here is the Hotel table</p>\n\n<pre><code>CREATE TABLE Hotel(\n   HotelNo  NVARCHAR(4)     not null,\n   HotelName    NVARCHAR(25),\n   City     NVARCHAR(25),\n\n   PRIMARY KEY (HotelNo) );\n</code></pre>\n\n<p>I tried to do some search on this problem, and it says this might be caused when there's no primary key defined in the table Room, but as above, it is defined.</p>\n\n<p>Can someone please help me with this problem? </p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":32076,"score":8,"question_id":2474839,"title":"Unable to login to SQL Server + SQL Server Authentication + Error: 18456","body":"<p>I have created login account on my localhost\\sql2008 Server (Eg. User123)</p>\n\n<p>Mapped to Database (default)</p>\n\n<p>Authentication Mode on SQL Server is set to both (Windows and SQL)</p>\n\n<p>But login to SQL Server fails with following message (for User123)</p>\n\n<p>Note:  Have checked multiple time that UserName / Password are typed in correctly</p>\n\n<p>Error Details:</p>\n\n<blockquote>\n  <p>Login failed for user 'User123'\n  (Net.SqlClient Data Provider)</p>\n  \n  <p>Server Name : localhost\\sql2008 Error\n  Number: 18456 Severity : 14 State : 1\n  Line Number : 65536</p>\n</blockquote>\n\n<p>any help on this please.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","jquery","sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":40,"score":-1,"question_id":13098194,"title":"combine strings and convert to time of sql server using c# or jquery","body":"<p>I have two dropdowns for <code>startHour</code>, <code>startMinute</code>.Now i need to take selected hour and minute from dropdown and save in sql as time(7) datatype. How can i convert data using c# or jquery?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server-2008","log4net","support"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3122,"score":1,"question_id":1210906,"title":"does log4net AdoNetAppender support sql server 2008?","body":"<p>my config file below: very strange, i have spent a day to find out where i am wrong, but still not working, it still not log anything in the database，but i can output them using RollingFileAppender. Also, the store procedure WriteLog is working well.(I have tested it using sql server studio). I have tried to change the connectionType but not working. \nUnfortunately I dont have sql server 2000/2005 to test, my log4net version should be the latest one: log4net 1.2.10. Any help is appreciated.  </p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;section name=\"log4net\" type=\"log4net.Config.Log4NetConfigurationSectionHandler, log4net\" /&gt;\n  &lt;/configSections&gt;\n  &lt;log4net&gt;\n      &lt;appender name=\"AdoNetAppender_SqlServer\" type=\"log4net.Appender.AdoNetAppender\"&gt;\n        &lt;!--&lt;threshold value=\"OFF\" /&gt;--&gt;\n        &lt;bufferSize value=\"1\" /&gt;\n        &lt;connectionType value=\"System.Data.SqlClient.SqlConnection, System.Data, System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n        &lt;!--&lt;connectionType value=\"System.Data.SqlClient.SqlConnection, System.Data, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;--&gt;\n        &lt;connectionString value=\"Data Source=.\\MSSQLSERVER2008,2222;Initial Catalog=UnleashedSaaS;User ID=sa;Password=dogblack;\" /&gt;\n        &lt;commandType value=\"StoredProcedure\" /&gt;\n        &lt;commandText value=\"WriteLog\" /&gt;\n        &lt;parameter&gt;\n        &lt;parameterName value=\"@log_date\" /&gt;\n        &lt;dbType value=\"DateTime\" /&gt;\n        &lt;layout type=\"log4net.Layout.PatternLayout\" value=\"%date{yyyy'-'MM'-'dd HH':'mm':'ss'.'fff}\" /&gt;\n            &lt;/parameter&gt;\n      &lt;parameter&gt;\n                &lt;parameterName value=\"@thread\" /&gt;\n                &lt;dbType value=\"String\" /&gt;\n                &lt;size value=\"255\" /&gt;\n                &lt;layout type=\"log4net.Layout.PatternLayout\" value=\"%thread\" /&gt;\n            &lt;/parameter&gt;\n      &lt;parameter&gt;\n                &lt;parameterName value=\"@log_level\" /&gt;\n                &lt;dbType value=\"String\" /&gt;\n                &lt;size value=\"50\" /&gt;\n                &lt;layout type=\"log4net.Layout.PatternLayout\" value=\"%level\" /&gt;\n            &lt;/parameter&gt;\n      &lt;parameter&gt;\n        &lt;parameterName value=\"@logger\" /&gt;\n                  &lt;dbType value=\"String\" /&gt;\n                  &lt;size value=\"255\" /&gt;\n                  &lt;layout type=\"log4net.Layout.PatternLayout\" value=\"%logger\" /&gt;\n            &lt;/parameter&gt;\n      &lt;parameter&gt;\n              &lt;parameterName value=\"@message\" /&gt;\n              &lt;dbType value=\"String\" /&gt;\n              &lt;size value=\"4000\" /&gt;\n              &lt;layout type=\"log4net.Layout.PatternLayout\" value=\"%message\" /&gt;\n            &lt;/parameter&gt;\n         &lt;parameter&gt;\n             &lt;parameterName value=\"@exception\" /&gt;\n             &lt;dbType value=\"String\" /&gt;\n             &lt;size value=\"4000\" /&gt;\n             &lt;layout type=\"log4net.Layout.ExceptionLayout\" /&gt;\n         &lt;/parameter&gt;\n      &lt;/appender&gt;\n      &lt;appender name=\"RollingLogFileAppender\" type=\"log4net.Appender.RollingFileAppender\" &gt;\n        &lt;!--&lt;threshold value=\"OFF\" /&gt;--&gt;\n        &lt;file value=\"LogData\\\\\" /&gt;\n        &lt;appendToFile value=\"true\" /&gt;\n        &lt;datePattern value=\"ul_yyyy-MM-dd.LOG\" /&gt;\n        &lt;maxSizeRollBackups value=\"10\" /&gt;\n        &lt;rollingStyle value=\"Date\" /&gt;\n        &lt;maximumFileSize value=\"2MB\" /&gt;\n        &lt;staticLogFileName value=\"false\" /&gt;\n        &lt;layout type=\"log4net.Layout.PatternLayout\"&gt;\n          &lt;param name=\"ConversionPattern\" value=\"%d{yyyy-MM-dd HH:mm:ss} %p %u %c %l %m %n%n%n\" /&gt;\n        &lt;/layout&gt;\n      &lt;/appender&gt;\n      &lt;root&gt;\n        &lt;level value=\"ALL\"/&gt;\n        &lt;appender-ref ref=\"AdoNetAppender_SqlServer\" /&gt;\n        &lt;appender-ref ref=\"RollingLogFileAppender\" /&gt;\n      &lt;/root&gt;\n    &lt;/log4net&gt;\n&lt;/configuration&gt;\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13086725,"title":"fetch values of radiobutton list of primary key table to another foreign key table using asp.net","body":"<p>I have created two tables in a SQL Server database and a RadioButtonList in an ASP.NET page. In one table I have stored values for each radio button as primary key. I want that on clicking that radio button, its primary key value in stored another table in a foreign key column.</p>\n\n<p>Here I am using store procedure in MS-SQl. \nprimary key table is gender and foreign key table is user.In aspx page i dm dispalying gender as radiobuttons, now the question is how can i fetch primary id of gender table and fill in users table.My code is as below:</p>\n\n<pre><code>ArrayList arSample = new ArrayList();\nObject[] n_gender_id = new Object[3] { \"@intGender\", \"Int\", (rbtngender.SelectedValue != \"\") ? rbtngender.SelectedValue : \"\" };\n</code></pre>\n\n<p>I am getting values of radiobutton how get ids of particular button.\nhelp out.......</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13095183,"title":"getting cumulative average per client_ID","body":"<p>I have a table called:</p>\n\n<p><strong>F_Accession_Daily</strong></p>\n\n<pre><code>test_id varchar\nreceived_date date\npatient_id varchar\nclient_id varchar\n</code></pre>\n\n<p>There can be multiple test_id's per patient. Every test_id has only one received_date. every client_id can have multiple patient_id's. </p>\n\n<p>right now I am returning the average test frequency of times tested (<strong>TestFreq</strong>) per <code>client_id</code>. I have a column that will return </p>\n\n<blockquote>\n  <p>[test frequency of patients that had 2 and only 2 tests], [test\n  frequency for patients that had 3 and only 3 tests], [test frequency\n  for patients that had 4 and only 4].....[12 and only 12]. (these are labeled below as testfreq1, testfreq2, testfreq3....testfreq12</p>\n</blockquote>\n\n<p>These are only a client_id basis. </p>\n\n<p>example of the returned data:</p>\n\n<pre><code>+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n| client_id | MonthsCustomer | TotalPatients | Totalaccessions | count1 | TestFreq1 | stdv1 | count2 | TestFreq2 |  stdv2  | count3 | TestFreq3 |  stdv3  | count4 | TestFreq4 |  stdv4  | count5 | TestFreq5 |  stdv5  | count6 | TestFreq6 |  stdv6  | count7 | TestFreq7 |  stdv7  | count8 | TestFreq8 |  stdv8  | count9 | TestFreq9 |  stdv9  | count10 | TestFreq10 | stdv10  | count11 | TestFreq11 | stdv11  | count12 | TestFreq12 | stdv12  |\n+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n|    100001 |             42 |          4289 |           15393 |   1976 |         0 |     0 |    719 |       152 | 202.793 |    385 |       140 | 136.356 |    262 |       130 | 99.5561 |    183 |       117 | 81.273  |    136 |       111 | 71.8437 |    112 |       104 | 62.8288 | 87     | 98        | 51.9194 |     75 |        89 | 49.9136 |      63 |         96 | 40.0267 |      57 |         94 | 37.497  | 45      | 102        | 32.6785 |\n|    100003 |             34 |          2098 |           16026 |    509 |         0 |     0 |    303 |        68 | 97.9581 |    190 |        62 | 55.5366 |    137 |        61 | 50.9664 |    101 |        61 | 48.5921 |     89 |        46 | 27.7256 |     62 |        55 | 38.2849 | 77     | 46        | 27.995  |     60 |        49 | 27.8421 |      51 |         47 | 22.2794 |      48 |         42 | 21.0575 | 40      | 46         | 19.9365 |\n|    100004 |             36 |          5841 |           10693 |   3712 |         0 |     0 |   1122 |       223 | 256.033 |    468 |       236 | 157.251 |    211 |       181 | 103.755 |    165 |       175 | 76.5761 |     86 |       161 | 67.6254 |     46 |       151 | 55.4122 | 13     | 121       | 31.1677 |     12 |       104 | 45.7847 |       2 |         88 | 7.77817 |       3 |         92 | 36.2261 | NULL    | NULL       | NULL    |\n|    100008 |             37 |           581 |            1276 |    249 |         0 |     0 |    174 |        96 | 63.7575 |     91 |        72 | 35.5402 |     38 |        60 | 19.4539 |      9 |        59 | 10.2402 |      5 |        25 | 12.6372 |      1 |        43 | NULL    | NULL   | NULL      | NULL    |      2 |        27 | 4.94975 |       3 |         17 | 12.2202 |       1 |         28 | NULL    | 3       | 21         | 4.04145 |\n+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n</code></pre>\n\n<p>I need to add another column that gives the <code>TOTAL AVERAGE TEST FREQUENCY</code> per client_id. </p>\n\n<p>Another words, I would like to get the average of all the patients per client. </p>\n\n<p>the formula to get the average test frequency is:</p>\n\n<pre><code>(max(received_date) - min(received_date) )/ (count(distinct test_id)-1)\n</code></pre>\n\n<p>I need to get the average of above per patient per client, how do I do it?</p>\n\n<p>Thank you so much for your guidance.</p>\n\n<p>here's my current query that returned the above dataset:</p>\n\n<pre><code>with counted as(\n SELECT\n    client_id,\n    --case when COUNT(*)&gt;=12 then 12 else COUNT(*) end  TimesTested, \n    COUNT(*) as timestested,\n    case when count(*)&gt;1 then\n    (datediff(day,MIN(received_date),max(received_date)))\n  /(COUNT(*)-1) \n else\n 0\n end as testfreq\n  FROM f_accession_daily\n  GROUP BY\n    client_id,\n    patient_id    \n\n),counted2 as (\n  SELECT\n    client_id,\n   TimesTested,\n    CAST(COUNT(*) AS varchar(30)) AS count,\n    CAST(AVG(testfreq) as varchar(30)) as TestFreq,\n    CAST(STDEV(TestFreq) as varchar(30)) Stdv\n  FROM counted\n  GROUP BY\n    client_id,\n    TimesTested\n    )\n    ,\nunpivoted AS (\n  SELECT\n    client_id,\n    ColumnName + CAST(TimesTested AS varchar(10)) AS ColumnName,\n    ColumnValue\n  FROM counted2\n  UNPIVOT (\n    ColumnValue FOR ColumnName IN (count, TestFreq,stdv)\n  ) u\n),\npivoted AS (\n  SELECT\n    client_id clientid,\n    count1, TestFreq1,stdv1,\n    count2, TestFreq2,stdv2,\n    count3, TestFreq3,stdv3,\n    count4, TestFreq4,stdv4,\n    count5, TestFreq5,stdv5,\n    count6, TestFreq6,stdv6,\n    count7, TestFreq7,stdv7,\n    count8, TestFreq8,stdv8,\n    count9, TestFreq9,stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n  FROM unpivoted\n  PIVOT (\n    MAX(ColumnValue) FOR ColumnName IN (\n      count1,TestFreq1,stdv1,\n      count2,TestFreq2,stdv2,\n      count3,TestFreq3,stdv3,\n      count4,TestFreq4,stdv4,\n      count5,TestFreq5,stdv5,\n      count6,TestFreq6,stdv6,\n      count7,TestFreq7,stdv7,\n    count8, TestFreq8,   stdv8,\n    count9, TestFreq9,   stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n    )\n  ) p\n)\n,\nPatientStats as\n(\n select \n distinct\n f.client_id\n ,datediff(MM,c.mlis_date_established,GETDATE()) MonthsCustomer\n ,count(distinct patient_id) TotalPatients\n ,count(distinct accession_id) Totalaccessions\n from F_ACCESSION_DAILY f\n left join D_CLIENT c\n on f.CLIENT_ID=c.CLIENT_ID\n group by f.client_id,c.mlis_date_established\n)\n,\nOver12\nas\n(\nselect client_id,SUM(c) sumcount from\n(\nselect CLIENT_ID,COUNT(*) c\nfrom F_ACCESSION_DAILY\ngroup by CLIENT_ID,PATIENT_ID\nhaving count(*)&gt;12\n) a\ngroup by client_id\n)\n, final as (\nSELECT p.*,pivoted.*,Over12.sumcount SumofGreaterThan12\nFROM pivoted\nleft join PatientStats p\non p.CLIENT_ID=pivoted.CLIENTID\nleft join Over12\non over12.CLIENT_ID=p.CLIENT_ID\nwhere p.CLIENT_ID not in (select CLIENTid from SalesDWH..TestPractices)\n)\n/* Get the data into a temp table */\nSELECT * INTO #TempTable\nFROM final\n/* Drop the cloumns that are not needed */\nALTER TABLE #TempTable\nDROP COLUMN clientid\n/* Get results and drop temp table */\nSELECT * FROM #TempTable\norder by 1 \nDROP TABLE #TempTable\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13091505,"title":"SQL Server - Reference a column by name in agrregate function","body":"<p>Our application uses a series of tables with many varchar(1000) columns in them. During development of the system, that was considered to be more than enough space for the users to enter text. However, now we're encountering problems with text being cut off, so it seems like some users are entering more text that it can hold. However, I believe that there's rampant misuse of these fields, and I want to see which columns are being used.</p>\n\n<p>From a different question that was answered here on SO, I've come up with the following query to extract the names of the varchar columns in a table:</p>\n\n<pre><code>select\n   syscolumns.name as [Column],\n   syscolumns.length as [MaxLength]\nfrom \n   sysobjects, syscolumns \nwhere sysobjects.id = syscolumns.id\nand   sysobjects.xtype = 'u'\nand   sysobjects.name = 'TableWithTooManyVarcharColumns'\nand syscolumns.xusertype = 167\n</code></pre>\n\n<p>but now I want to use the names of these columns in a new query, and calculate </p>\n\n<pre><code>SELECT \n[Column] as [Name],\n[MaxLength],\nMAX(LEN([Column])) as [MaxUsedLength],\nAVG(LEN([Column])) as [AvgUsedLength],\nSTDEV(LEN([Column])) as [StdDev]\nFROM TableWithTooManyVarcharColumns\nINNER JOIN **{{ reference to table from query above }}**\n</code></pre>\n\n<p>Of course, the first query returns the name of the column, while the second one needs a reference to the column, so I'm not sure how to combine them properly. Any SQL Server gurus able to help?</p>\n"},{"tags":["sql-server","sql-server-2008","indexed-view"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2410,"score":3,"question_id":3501825,"title":"SQL Server Create View Index which contains distinct or group by","body":"<p>I have a table of address data in my SQL server database. This table is not normalized so it contain many addresses the are repeated. Each unique address can be identified by an Id field (these ids repeat often in the table).</p>\n\n<p>So i created a view on the table to extract all the unique addresses, using Select Distinct(AddressId) from the original table.</p>\n\n<p>Now i would like to create an index on this view to increase the speed of searching, but SQL server is not allowing me to create an index on the view as it contains a distinct or group by (i have tried both to see if it would allow me create index)</p>\n\n<p>Has anyone got any solution around this? or any views to an alternate way to do this.</p>\n\n<p>I need to query this view based on address keywords and return the ones based on the matching count, i have this query in place i'm trying to speed it up by indexing fields in the view.</p>\n\n<p>SQL Server 2008</p>\n\n<pre><code>SELECT      \n    AddressId,  \n    AddressNumber,  \n    AddressName, \n    Town, \n        City,\n        Country,\n    COUNT_BIG(*) As AddCount--,\n    --TRIM(AddressNumber + ' ') + LTRIM(AddressName + ' ')  + LTRIM(Town + ' ') + RTRIM(City + ' ') AS AddressLookup\nFROM\n    [Address] A\nGROUP BY\n    AddressId,\n    AddressNumber, \n    AddressName, \n    Town, \n    City, \n    Country\n</code></pre>\n\n<p>is my query....</p>\n\n<p>if i take out the column with AddressLookup i can add the indexes</p>\n\n<p>Cheers</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","null"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":74,"score":-4,"question_id":13092010,"title":"Alter every column in the database to disallow nulls in a SQL Server database","body":"<p>I've been struggling with the following problem;</p>\n\n<p>We have a large database with 2000+ columns and we have allowed nulls in the majority of them.\nNow I need a script that goes through all the columns and sets all the null values to a default value and alters the column to disallow nulls while setting the default.</p>\n\n<p>I need a script to do this for all the different datatypes (<code>nvarchar</code>, <code>int</code>, <code>smallint</code>, <code>datetime</code> etc).</p>\n\n<p>The reason I'm doing this is that I'm migrating the code to .net and it's a pain to handle all the null values that shouldn't be nulls.</p>\n\n<p>Also: <a href=\"http://www.bennadel.com/blog/85-Why-NULL-Values-Should-Not-Be-Used-in-a-Database-Unless-Required.htm\" rel=\"nofollow\">http://www.bennadel.com/blog/85-Why-NULL-Values-Should-Not-Be-Used-in-a-Database-Unless-Required.htm</a>\nand: <a href=\"http://msdn.microsoft.com/en-us/library/ms189265(v=sql.105).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms189265(v=sql.105).aspx</a></p>\n\n<p>Thanks for your time. :)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":13092682,"title":"SSIS package - loop through different connections for Execute SQL task","body":"<p>I am creating an MSSQL2008 SSIS package to generate and email reports from database tables. It works perfectly on a single database.  The client is running 3 different databases used by 3 different divisions.  The database structure is exactly the same. All three databases are located on the same server, same security / credentials are used.</p>\n\n<p>I created a \"For Each Loop Container\" in my SSIS package that loops through the list of 3 items and populates it into a variable.  How do I now take that and pass it to the \"Execute SQL Task\" to run three times (once for each database)?</p>\n\n<p>Thank you for your time!</p>\n"},{"tags":["mysql","sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":298,"score":3,"question_id":9261205,"title":"The SQL Server equivalent for the MySQL Limit","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2135418/equivalent-of-limit-and-offset-for-sql-server\">Equivalent of LIMIT and OFFSET for SQL Server?</a>  </p>\n</blockquote>\n\n\n\n<p>this is a mysql query</p>\n\n<pre><code>SELECT email FROM emailTable LIMIT 9,20 WHERE id=3\n</code></pre>\n\n<p>how do you write it in SQL Server (2008)?</p>\n\n<p>do I have to write </p>\n\n<pre><code>SELECT TOP 9,20 email FROM emailTable WHERE id=3\n</code></pre>\n\n<p>?\nThank you for your help</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13088856,"title":"SQL Server : add CSV programmable","body":"<p>I have the following code to insert a CSV file into a temp table:</p>\n\n<pre><code>USE [websitehere.com].[dbo]\nGO\nCREATE TABLE [websitehere.com].[dbo].[tmpTable]\n(ID INT,\n    Caller_Number VARCHAR(100),\n    Caller_Name VARCHAR(100),\n    GroupBy VARCHAR(100),\n    Campaign_Name VARCHAR(100),\n    DateAndTime VARCHAR(100),\n    Duration VARCHAR(100),\n    Call_Status VARCHAR(100))\nGO;\n\nBULK\nINSERT tmpTable \nFROM 'C:\\Users\\namehere\\Documents\\CallLog.csv' \nWITH\n(\n    FIELDTERMINATOR = ',',\n    ROWTERMINATOR = '\\n'\n)\nGO\n</code></pre>\n\n<p>But...</p>\n\n<ol>\n<li><p>It does not seem to add the <code>tmpTable</code>. It gives me an error </p>\n\n<blockquote>\n  <p><em>Msg 102, Level 15, State 1, Line 1<br>\n  Incorrect syntax near '.'.</em></p>\n</blockquote></li>\n<li><p>It won't add the insert command saying that</p>\n\n<blockquote>\n  <p><em>Msg 4834, Level 16, State 4, Line 8<br>\n  You do not have permission to use the bulk load statement.</em></p>\n</blockquote></li>\n</ol>\n\n<p>Any help would be great to take care of these 2 errors!</p>\n\n<p><strong>Update</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/Hxv6A.png\" alt=\"db user secutirys\"></p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13093585,"title":"When selecting function list from SQL Server 2008, Routine_body=External but all other data NULL","body":"<p>I'm attempting to get a list and definition of user defined functions within 3 different databases to combine into a single database.  </p>\n\n<p>I have the select statement that lists the 3 user defined functions but when I run it the <code>ROUTINE_BODY</code> column shows <code>'EXTERNAL'</code> but <code>EXTERNAL_NAME</code> and <code>EXTERNAL_LANGUAGE</code> is <code>NULL</code> (as well as <code>ROUTINE_DEFINITION</code> which it should be for an <code>EXTERNAL</code> routine).</p>\n\n<pre><code>SELECT * \nFROM INFORMATION_SCHEMA.ROUTINES \nWHERE ROUTINE_TYPE = 'FUNCTION'  \n</code></pre>\n\n<p>This gives me back the database, routine name, everything I need except for the actual definition of the function.  Can anyone help me with where SQL Server may be storing the SQL for the functions?</p>\n"},{"tags":["sql-server-2008","tsql","large-data-volumes"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":13092561,"title":"Inner join and Split on large volume of data","body":"<p>We are working on large volume data (row counts given below) :</p>\n\n<pre><code>Table 1 : 708408568 rows  -- 708 million\nTable 2 : 1416817136 rows -- 1.4 billion\n\nTable 1 Schema:\n----------------\nID -      Int PK\ncolumn2 - Int\n\nTable 2 Schema\n----------------\nTable1ID - Int FK\nSomeColumn - Int\nSomeColumn - Int\n</code></pre>\n\n<p>Table1 has PK1 which servers as FK for Table 2.</p>\n\n<h2>Index details :</h2>\n\n<pre><code>Table1 : \nPK Clustered Index on Id\nNon Clustered (Non Unique) on column2\n\nTable 2 :\nTable1ID (FK) Clustered Index\n</code></pre>\n\n<p>Below is the query which needs to be executed :</p>\n\n<pre><code>SELECT t1.[id]\n      ,t1.[column2]\nFROM  Table1 t1\ninner join Table2 t2\n    on s.id = cs.id\nWHERE t1.[column2] in (select [id] from ConvertCsvToTable('1,2,3,4,5.......10000')) -- 10,000 Comma seperated Ids\n</code></pre>\n\n<p>So to summarize, The inner join on ID should be handled by the clustered index on the same Ids on both PK and FK.\nand as for the \"huge\" Where condition on column2 we have a nonclustered index.</p>\n\n<p>However, the query is taking 4 minutes for a small subset of 100 Ids, we need to pass 10,000 ids.</p>\n\n<p>Is there a better way design wise that we can do this, or possibly does Table Partitioning help?</p>\n\n<p>Just wanted to get some ways of how to solve huge volume Select with Inner Join and Where IN.</p>\n\n<p>Note : ConvertCsvToTable is a Split function which has already been determined to perform optimally.</p>\n\n<p>Thanks !</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13092702,"title":"How to iterate this SQL Query?","body":"<p>I've got this query: </p>\n\n<pre><code>SELECT TOP 1 A.ExamTemplateId, A.Id AS AnsweredTestId, AVG(B.Score) AS AvgScore, A.[Date]\nFROM AnsweredTest AS A\nINNER JOIN AnsweredWorksheet AS B ON (A.Id = B.AnsweredTestId)\nWHERE A.StudentId = 'OPA-3DKCL2' AND A.ExamTemplateId = 1\nGROUP BY A.Id, A.ExamTemplateId, A.[Date]\nORDER BY AvgScore DESC\n</code></pre>\n\n<p>Please check that I have a <code>WHERE</code> condition which receives a static number. The query result is:</p>\n\n<p>EXAMPLE 1\n<img src=\"http://i.stack.imgur.com/EZqHP.png\" alt=\"\"></p>\n\n<p>EXAMPLE 2\n<img src=\"http://i.stack.imgur.com/mAdO8.png\" alt=\"enter image description here\"></p>\n\n<p>And it is correct! But now, I'd like to show all the records from a ExamTemplate table. But now I don't know how can I accomplish that. I was thinking creating a function but I'm not sure, it's just an idea.</p>\n\n<p>The final output which I'd like to receive is the union of last records:</p>\n\n<pre><code>1   1   0.7 2012-10-21 19:50:11.697\n2   10  0.555555555555556   2012-10-22 18:58:24.163\n</code></pre>\n\n<p>Thanks in advance.</p>\n\n<p>UPDATE:</p>\n\n<p>I've got highlighted with yellow color the rows which I'm interested. I set in the last query <code>TOP 1</code> because I want to get the highest average score by <code>ExamTemplateId</code>. And that's will be all.</p>\n\n<p><img src=\"http://i.stack.imgur.com/VUALu.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","sql-server-2008","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12936672,"title":"Table design with joining tables or separate ID in main table","body":"<p>I'm designing a database that has a couple of tables; FAQ's, Bulletins, and Attachments.  Bulletins and FAQ's could have an attachment associated with them, so my initial thought was to create a joining table with the two primary keys as a composite key:</p>\n\n<pre><code>Bulletin\n--------\nBulletinID\nSubject\nDescription\nNotes\n\nAttachment\n-----------\nAttachmentID\nFileName\nFilePath\netc.\n</code></pre>\n\n<p>Joining table:</p>\n\n<pre><code>BulletinAttachments\n-------------------\nBulletinID\nAttachmentID\n</code></pre>\n\n<p>As I design this, I also thought, what if other entities are introduced later (say Newsletter, Email, etc.) that need Attachments as well.  I would have to create a joining table for each of these entities.  Not awful, but it made me think, what if I got rid of the joining tables and put an AttachmentType in the Attachment table and then assigned the type accordingly:</p>\n\n<pre><code>AttachmentType\n--------------\nAttachmentTypeID\nAttachmentType\nDescription\n</code></pre>\n\n<p>The data in that table would be:<br>\n1-Bulletin<br>\n2-FAQ<br>\n3-Newsletter<br>\n4-Email</p>\n\n<p>Then the Attachment table would hold the AttachmentTypeID to identify it:</p>\n\n<pre><code>Attachments\n-----------\nAttachmentID\nAttachmentTypeID\nFileName\nFilePath\netc.\n</code></pre>\n\n<p>So my question is, for performance wise (using SQL 2008 R2), is there a better choice between the two?  Is there a better way to design this?  My concern with using individual joining tables is that we may have more entities come along and to accommodate Attachments, we would have to create a joining table and on our front-end software, we would have to write logic for it whereas the AttachmentTypeID would allow the front-end to insert a new AttachmentType and no db interaction would be needed.</p>\n"},{"tags":["sql-server-2008","geolocation","geocoding"],"answer_count":2,"favorite_count":6,"up_vote_count":17,"down_vote_count":0,"view_count":4603,"score":17,"question_id":7409051,"title":"Why use the SQL Server 2008 geography data type?","body":"<p>I am redesigning a customer database and one of the new pieces of information I would like to store along with the standard address fields (Street, City, etc.) is the geographic location of the address.  The only use case I have in mind is to allow users to map the coordinates on Google maps when the address cannot otherwise be found, which often happens when the area is newly developed, or is in a remote/rural location.</p>\n\n<p>My first inclination was to store latitude and longitude as decimal values, but then I remembered that SQL Server 2008 R2 has a <code>geography</code> data type.  I have absolutely no experience using <code>geography</code>, and from my initial research, it looks to be overkill for my scenario.</p>\n\n<p>For example, to work with latitude and longitude stored as <code>decimal(7,4)</code>, I can do this:</p>\n\n<pre><code>insert into Geotest(Latitude, Longitude) values (47.6475, -122.1393)\nselect Latitude, Longitude from Geotest\n</code></pre>\n\n<p>but with <code>geography</code>, I would do this:</p>\n\n<pre><code>insert into Geotest(Geolocation) values (geography::Point(47.6475, -122.1393, 4326))\nselect Geolocation.Lat, Geolocation.Long from Geotest\n</code></pre>\n\n<p>Although it's not <em>that</em> much more complicated, why add complexity if I don't have to?</p>\n\n<p>Before I abandon the idea of using <code>geography</code>, is there anything I should consider?  Would it be faster to search for a location using a spatial index vs. indexing the Latitude and Longitude fields?  Are there advantages to using <code>geography</code> that I am not aware of?  Or, on the flip side, are there caveats that I should know about which would discourage me from using <code>geography</code>?</p>\n\n<hr>\n\n<h2>Update</h2>\n\n<p>@Erik Philips brought up the ability to do proximity searches with <code>geography</code>, which is very cool.  </p>\n\n<p>On the other hand, a quick test is showing that a simple <code>select</code> to get the latitude and longitude is significantly slower when using <code>geography</code> (details below).  , and a comment on the <a href=\"http://stackoverflow.com/questions/6386577/sql-server-2008-r2-geography-distance/6387558#6387558\">accepted answer</a> to another SO question on <code>geography</code> has me leery:</p>\n\n<blockquote>\n  <p>@SaphuA You're welcome. As a sidenote be VERY carefull of using a\n  spatial index on a nullable GEOGRAPHY datatype column. There are some\n  serious performance issue, so make that GEOGRAPHY column non-nullable\n  even if you have to remodel your schema. – Tomas Jun 18 at 11:18</p>\n</blockquote>\n\n<p>All in all, weighing the likelihood of doing proximity searches vs. the trade-off in performance and complexity, I've decided to forgo the use of <code>geography</code> in this case.</p>\n\n<hr>\n\n<p>Details of the test I ran:</p>\n\n<p>I created two tables, one using <code>geography</code> and another using <code>decimal(9,6)</code> for latitude and longitude:</p>\n\n<pre><code>CREATE TABLE [dbo].[GeographyTest]\n(\n    [RowId] [int] IDENTITY(1,1) NOT NULL,\n    [Location] [geography] NOT NULL,\n    CONSTRAINT [PK_GeographyTest] PRIMARY KEY CLUSTERED ( [RowId] ASC )\n) \n\nCREATE TABLE [dbo].[LatLongTest]\n(\n    [RowId] [int] IDENTITY(1,1) NOT NULL,\n    [Latitude] [decimal](9, 6) NULL,\n    [Longitude] [decimal](9, 6) NULL,\n    CONSTRAINT [PK_LatLongTest] PRIMARY KEY CLUSTERED ([RowId] ASC)\n) \n</code></pre>\n\n<p>and inserted a single row using the same latitude and longitude values into each table:</p>\n\n<pre><code>insert into GeographyTest(Location) values (geography::Point(47.6475, -122.1393, 4326))\ninsert into LatLongTest(Latitude, Longitude) values (47.6475, -122.1393)\n</code></pre>\n\n<p>Finally, running the following code shows that, on my machine, selecting the latitude and longitude is approximately 5 times slower when using <code>geography</code>.</p>\n\n<pre><code>declare @lat float, @long float,\n        @d datetime2, @repCount int, @trialCount int, \n        @geographyDuration int, @latlongDuration int,\n        @trials int = 3, @reps int = 100000\n\ncreate table #results \n(\n    GeographyDuration int,\n    LatLongDuration int\n)\n\nset @trialCount = 0\n\nwhile @trialCount &lt; @trials\nbegin\n\n    set @repCount = 0\n    set @d = sysdatetime()\n\n    while @repCount &lt; @reps\n    begin\n        select @lat = Location.Lat,  @long = Location.Long from GeographyTest where RowId = 1\n        set @repCount = @repCount + 1\n    end\n\n    set @geographyDuration = datediff(ms, @d, sysdatetime())\n\n    set @repCount = 0\n    set @d = sysdatetime()\n\n    while @repCount &lt; @reps\n    begin\n        select @lat = Latitude,  @long = Longitude from LatLongTest where RowId = 1\n        set @repCount = @repCount + 1\n    end\n\n    set @latlongDuration = datediff(ms, @d, sysdatetime())\n\n    insert into #results values(@geographyDuration, @latlongDuration)\n\n    set @trialCount = @trialCount + 1\n\nend\n\nselect * \nfrom #results\n\nselect avg(GeographyDuration) as AvgGeographyDuration, avg(LatLongDuration) as AvgLatLongDuration\nfrom #results\n\ndrop table #results\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>GeographyDuration LatLongDuration\n----------------- ---------------\n5146              1020\n5143              1016\n5169              1030\n\nAvgGeographyDuration AvgLatLongDuration\n-------------------- ------------------\n5152                 1022\n</code></pre>\n\n<p>What was more surprising is that even when no rows are selected, for example selecting where <code>RowId = 2</code>, which doesn't exist, <code>geography</code> was still slower:</p>\n\n<pre><code>GeographyDuration LatLongDuration\n----------------- ---------------\n1607              948\n1610              946\n1607              947\n\nAvgGeographyDuration AvgLatLongDuration\n-------------------- ------------------\n1608                 947\n</code></pre>\n"},{"tags":["sql-server-2008","query","wildcard","like-operator"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13077636,"title":"Parameterizing an SQL query which uses the NOT LIKE, \" ^ \" wildcard?","body":"<p>How can I parameterize the following query? (By the way I'm using a full text indexed table, hence the <code>CONTAINS()</code>)</p>\n\n<pre><code>SELECT * FROM Table WHERE CONTAINS(Column, 'cat OR dog') \nand ((column NOT LIKE '%[^ cat OR dog]%')); \n</code></pre>\n\n<p>This didn't work:</p>\n\n<pre><code> DECLARE @term1 VARCHAR(10);\n\n DECLARE @term2 VARCHAR(10);\n\n SET @term1 = 'cat';\n\n SET @term2 = 'dog';\n\nSET @term3 = @term1 + ' ' + 'OR' + ' ' + @term2;\n\nSET @term4 = '[^ @term1  OR  @term2 ]' ;\n\nSELECT * FROM table WHERE CONTAINS(column, @term3) &lt;--up to this point works\nAND (column NOT LIKE '%[@term4]%'); &lt;--this part doesn't include the second term (@term2)\n</code></pre>\n\n<p>If you'd like to fiddle with this on your end, my Full Text Indexed table looks like:</p>\n\n<pre><code> animalListID     AnimalsList\n       1           cat dog\n       2           cat\n       3           cat dog bird\n</code></pre>\n\n<p>(basically i need the parameterized version of the <code>SELECT</code> statement which returns the rows with 'cat dog' and 'cat' and NOT 'cat dog bird')</p>\n\n<p>**This is a VERY oversimplified version of my data, but the question is an exact match of the concept I'm trying to achieve. The table will have millions of rows, and many terms in each row.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13091875,"title":"Update Script from Select","body":"<p>I need your support here.I want to change this to an update statement,I want to update all null values of E.Age with Birthage from PersonDeatl .The below script just selects .Table Employee and and PersonDeatl do not have keys to join them nor with EmpRet.Thanks guys</p>\n\n<pre><code>select distinct * from ((Select     \n           E.EmployeeId,E.Address,E.City,E.Zip,E.State,E.Age\n         from Employee E join\n          EmpRet R\n            on E.EmployeeId=R.EmployeeId\n        where R.Dscription='Age not Qualify'  and E.Age is null)Ag inner join\n       (select address,city,zip,state,BirthAge from PersonDeatl)Pd\n\n          on ag.Address=Pd.Address and ag.City=Pd.City and ag.zip=Pd.Zip)\n</code></pre>\n"},{"tags":["database","sql-server-2008","vb.net-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13091330,"title":"Creating database tables data type","body":"<p>I am creating Employee table what Data Type I gave to CNIC No means (National Identity Card) No,, for example CNIC No:54400-1566178-1.\n Please tell me anyone what data type i give </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13091072,"title":"How to find the SUM of the Calculated Percentage Column in SQL","body":"<p>I have a Column which calculates the Percentage , like this</p>\n\n<pre><code>Convert(decimal(5,2),(PatCount*100)/@PatientCount) as Per\n</code></pre>\n\n<p>Now i want the Total Sum of the above calculated Percentage. So i tried doing this,</p>\n\n<pre><code>,SUM(Convert(decimal(5,2),(PatCount*100)/@PatientCount)) as pa\n</code></pre>\n\n<p>But i am not geting the Desired Result . For ex </p>\n\n<pre><code>Per %    Total %\n6.00     6.00\n7.00     7.00\n85.00    85.00\n</code></pre>\n\n<p>I want the total Col to print as 98%.  Please can Somebody help me with this.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13090690,"title":"MS SQL REPLACE not showing results","body":"<p>Hey all i have the following query:</p>\n\n<pre><code>SELECT REPLACE(REPLACE(REPLACE(REPLACE(tmpTable.Caller_Number,'-',''),'(',''),')',''),' ','') \nFROM tmpTable \nWHERE EXISTS \n(SELECT REPLACE(REPLACE(REPLACE(REPLACE(OnlineAppDetails.addPhone,'-',''),'(',''),')',''),' ','') \nFROM OnlineAppDetails \nWHERE OnlineAppDetails.addPhone = tmpTable.Caller_Number)\nORDER BY GroupsBy ASC;\n</code></pre>\n\n<p>It returns no records... However, when i do this query:</p>\n\n<pre><code>SELECT * \nFROM tmpTable \nWHERE EXISTS \n(SELECT * FROM OnlineAppDetails \nWHERE SUBSTRING(OnlineAppDetails.addPhone,2,3)+'-'+SUBSTRING(OnlineAppDetails.addPhone,7,4)+SUBSTRING(OnlineAppDetails.addPhone,11,4) = tmpTable.Caller_Number)\nORDER BY GroupsBy ASC;\n</code></pre>\n\n<p>It returns records..</p>\n\n<p>The phome number is formatted like:</p>\n\n<pre><code>for OnlineAppDetails: (xxx) xxx-xxxx\nfor         tmpTable: xxx-xxx-xxxx\n</code></pre>\n\n<p>All i am doing is taking out the <strong>- ( ) and [space]</strong> in the phone number just to be sure i am being returned all the records i should be. I know there are matches in both tables so taking out <strong>- ( ) and [space]</strong> should still result in records returned.</p>\n\n<p><strong>update</strong></p>\n\n<p>Duh.... knew it was going to be simple.</p>\n\n<pre><code>SELECT * \nFROM tmpTable \nWHERE EXISTS \n(SELECT * \nFROM OnlineAppDetails \nWHERE  REPLACE(REPLACE(REPLACE(REPLACE(OnlineAppDetails.addPhone,'-',''),'(',''),')',''),' ','') = REPLACE(REPLACE(REPLACE(REPLACE(tmpTable.Caller_Number,'-',''),'(',''),')',''),' ',''))\nORDER BY GroupsBy ASC;\n</code></pre>\n"},{"tags":["sql-server-2008","iis","connection"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":23,"score":2,"question_id":13090256,"title":"IIS SQL connection fails under heavy load; reset IIS fixes temporarily","body":"<p>Server 1:  SQL Server 2008 Standard Edition\nServer 2:  Windows 2008 Server R2, IIS 7.0</p>\n\n<p>A web-site on Server 2 requires data in SQL Server on Server 1.</p>\n\n<p>Everything works fine for a while (weeks sometimes).  Then, under heavy load, Server 2 reports it cannot connect SQL Server on Server 1.  Once IIS on Server 2 reports it cannot connect to SQL on Server 1, it does not get better until IIS on Server 2 is restarted.  Perhaps restarting the application pool would work as well as a full IIS reset.  I'm not certain.</p>\n\n<p>I've tried changing the connection string to increase the connection pool size to unreasonably large values (1,000).  The failures still happen.</p>\n\n<p>The web-site is written in C#.  The data access layer is NHibernate.</p>\n\n<p>Here is the start of the exception:</p>\n\n<pre><code>[SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)]\n   System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject) +428\n   System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection) +65\n   System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory) +117\n   System.Data.SqlClient.SqlConnection.Open() +122\n   NHibernate.Connection.DriverConnectionProvider.GetConnection() +60\n   NHibernate.Impl.SessionFactoryImpl.OpenConnection() +39\n</code></pre>\n\n<p>Any ideas why this is happening?  How to diagnose/fix it?  I'm frustrated and considering ripping out NHibernate, which will take months and probably lead to many other kinds of problems.</p>\n"},{"tags":["sql-server-2008","data-warehouse","business-intelligence","msas"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13078556,"title":"Multiple kinds of payees","body":"<p>I make payments to various kinds of payees and I'm wondering whether I should create a dimension of each kind of payee and have multiple foreign keys in my fact table, or conflate the various kinds of payees via a type attribute and have a single FK in the PaymentFact table at the expense of having attributes that make no sense in the PayeeDim table for any particular value of PayeeDim.Type...</p>\n\n<p>how are these situations normally handled?</p>\n\n<p>TIA - e</p>\n"},{"tags":["sql-server-2008","excel","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13086976,"title":"SSIS with Excel sheets","body":"<p>I have created ssis package to loda data from excel to database. My problem is Those excel files proteced with password( I know the password) at the minute i am removing password mannually. Is there any way to automate in ssis, Because i have 200 excel files.</p>\n"},{"tags":["sql","sql-server-2008","timeout"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13088501,"title":"SQL Select Query Timing Out","body":"<p>I have a table in my SQL Server 2008 database called <strong>dbo.app_additional_info</strong> which contains approximately 130,000 records. Below shows the structure of the table.</p>\n\n<p><img src=\"http://i.stack.imgur.com/DLmyN.png\" alt=\"enter image description here\"></p>\n\n<p>When I run a query like the one below in SQL Server Management Studio 2008</p>\n\n<pre><code>select app_additional_text\nfrom app_additional_info\nwhere application_id = 2665 --Could be any ID here\n</code></pre>\n\n<p>My query takes a long time to execute (up to 5minutes) and sometimes it times out. This database is also connected to a Web Application and when it runs the above query, I always get a timeout error.</p>\n\n<p>Is there anything I can do to speed up the performance of my query? </p>\n\n<p>Your help with this would be greatly appreciated as this is grinding my web application to a halt.</p>\n\n<p>Thanks.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Below shows my execution plan from SSMS (I apologise for poor quality)</p>\n\n<p><img src=\"http://i.stack.imgur.com/xEnit.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/iMb8K.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["multithreading","performance","sql-server-2008","parallel-processing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":291,"score":0,"question_id":9561903,"title":"The query processor could not start the necessary thread resources","body":"<p>I having this error on my mssql server especially when there are many records inserted at the same time:\n <em>\"100|The query processor could not start the necessary thread resources for parallel query execution.\"</em> </p>\n\n<p>i try google search the problem to upgrade my sql performance so that can avoid this error, and plenty of it suggests to set maxdrop on the query or the max degree of parallelism on the mssql. </p>\n\n<p>But how can i know how many the value of the maxdrop or max degree of parallelism i should set to? \nand how i check the maximum value of max degree of parallelism of my server can run?\nif i change the max degree of parallelism of the server, means all the store proc will run following that setting, so will it affect other performance? or i just need to set the maxdrop on certain store proc?</p>\n"},{"tags":["sql","sql-server-2008","login","active-directory"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1018,"score":0,"question_id":9603405,"title":"Updating SQL Server 2008 LOGIN SID","body":"<p>If an Active Directory SID doesn't match the \n <code>SQL Server 2008</code>\n Login SID (<code>sys.server_principal</code>) there doesn’t appear to be a way to ALTER/UPDATE that value.  <code>ALTER USER</code> will allow you to remap a USER to a LOGIN, but <code>ALTER LOGIN</code> will not allow you to remap a LOGIN to Active Directory so to my question…</p>\n\n<p>Is there any way, documented or otherwise, to update the LOGIN SID with the AD SID besides dropping and recreating the login?  I am using <code>OPENROWSET</code> to get the AD SID value, but I can't find a way to update the LOGIN SID (mostly because I don't think it can be done)</p>\n\n<p>By the way, I am aware that ad-hoc queries to the system tables are not allowed (because I tried that already).</p>\n"},{"tags":["sql-server-2008","adventureworks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":8833302,"title":"Unable to find the instance while installing AdventureWorks2008R2_SR1","body":"<p>while installing the AdventureWorks2008R2_SR1 which is downloaded from the codeplex site, the instance value is not showing. How to enable the instance there. i can able lo log in to the sql server with the instance HA-INT2. But while installing AdventureWorks2008R2_SR1 it is not showing the instance. \nI attached the screen shot please find it<img src=\"http://i.stack.imgur.com/NcN50.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13087197,"title":"What happens when multiple simultaneous update requests received for a SQL table?","body":"<p>I have a table in SQL server database in which I am recording the latest activity time of users. Can somebody please confirm me that SQL server will automatically handle the scenario when multiple update requests received simultaneously for different users. I am expecting 25-50 concurrent update request on this table but each request is responsible for updating different rows in the table. Do i need something extra like connection pooling etc..?</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2","profiler","sql-server-profiler"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13087228,"title":"How do I see the final query text for a stored procedure sql query?","body":"<p>I am investigating a single stored procedure that is returning odd results. It dynamically builds sql and uses views and functions. It is difficult to follow what the final sql query applied to the database actually is from the code.</p>\n\n<p>Can I use SQL Server Profiler to see the final query text? </p>\n\n<p>If so, what are the steps? And how do I restrict the Profiler to monitor only a single specific stored procedure? </p>\n"},{"tags":["sql","sql-server","sql-server-2008","reporting-services"],"answer_count":3,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":3992,"score":6,"question_id":947379,"title":"Reporting Services Subscriptions won't allow modification of the To: Field","body":"<p>I have a little issue that is causing me a headache.  Our Report Server is SQL Ent 2008 on a Win 2008 server.  When users that have Report Browser permissions try to set up a report subscription the To: field is grayed out and pre-populated with their username.  They cannot change this and it won't deliver to their email address which would be username@domain.com.  Any leads would be greatly appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4157,"score":0,"question_id":3011782,"title":"How to solve the sql server 2008 restore error 3203","body":"<p>I am trying to restore the database in SQL Server 2008. The backup file is  SQL Server 2008 from another PC <strong>. When i want to restore show me the error</strong> </p>\n\n<p>TITLE: Microsoft SQL Server Management Studio</p>\n\n<pre><code>------------------------------\n\nAn exception occurred while executing a Transact-SQL statement or batch. (Microsoft.SqlServer.ConnectionInfo)\n\n------------------------------\nADDITIONAL INFORMATION:\n\nRead on \"D:\\New Folder (2)\\mihirreliance.bak\" failed: 38(Reached the end of the file.) (Microsoft SQL Server, Error: 3203)\n\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=10.00.1600&amp;EvtSrc=MSSQLServer&amp;EvtID=3203&amp;LinkId=20476\n\n------------------------------\nBUTTONS:\n\nOK\n------------------------------\n</code></pre>\n\n<p>Why this problem aries .How to solve this error.</p>\n"},{"tags":["sql-server-2008","amazon-web-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13087063,"title":"Microsoft SQL Server backup import to AWS Database","body":"<p>I want to import a .bak file in amazon DB instance (windows server 2008 r2), but this thing is not possible, because of permissions on the AWS.</p>\n\n<p>From Microsoft SQL Management Studio Restored the database from the .bak file to my local instance of SQL server (This worked)</p>\n\n<p>Have tried the following solutions but none of them worked:\n-Exported the tables and views on the AWS, this apparently worked, no problems were displayed,\nbut not exported for ex:Constraints, Triggers, Stored Procedures.</p>\n\n<p>-Generated script file for the Stored Proc., Triggers -> Some of them were working</p>\n\n<p>-Tried to Generate Script file for the whole DB, but it is big ~400mb, and could not execute the script on the AWS.</p>\n\n<p>Any suggestions would be great, regarding how to copy the database to the AWS or, how to restore a .bak file</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server-2008","datetime"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":129,"score":0,"question_id":13086021,"title":"Convert mm/dd/yyyy hh:mm;ss AM/PM to datetime","body":"<p>When I am trying to convert date I am getting below error</p>\n\n<pre><code>DECLARE @MinLogDate AS varchar(100)\nDECLARE @MinDate AS DATETIME\n\nSET @MinLogDate = '10/26/2012 01:23:90 AM'\nSET @MinDate = (SELECT CONVERT(CHAR(10), CONVERT(datetime, @MinLogDate,103),101))\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n  <p><em>The conversion of a varchar data type to a datetime data type resulted in an out-of-range value.</em></p>\n</blockquote>\n\n<p>How can I convert the varchar time to datetime?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>based on the answer i have modified.. below is the actual date time i am getting .. so now I am able to get mindate but max date is not working</p>\n\n<pre><code>    DECLARE @MinDate AS DATETIME\n    DECLARE @MaxDate AS DATETIME\n    DECLARE @MinLogDate AS varchar(100)\n    DECLARE @MaxLogDate AS varchar(100)\n\n    SET @MinLogDate = '8/1/2012 01:00:00 AM'\n    SET @MaxLogDate = '8/31/2012 01:00:00 PM'\n\n    SET @MinDate = CONVERT(datetime, LEFT(@MinLogDate, 10), 101)\n    SET @MaxDate = CONVERT(datetime, LEFT(@MaxLogDate, 10), 101)\n\n    SELECT @MinDate\n    SELECT @MaxDate\n</code></pre>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13081363,"title":"Load MySQL \".SQL Dump File\" into SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1770795/convert-mysql-script-to-mssql\">Convert MySQL script to MSSQL</a>  </p>\n</blockquote>\n\n\n\n<p>I have *.sql dump file that generated from the MySQL Server using the SQL Yog tool.Please anyone tell me how to convert the MySQL *.sql dump file in to SQL Script file.</p>\n"},{"tags":["sql-server","sql-server-2008","powershell","smo"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13072207,"title":"Can't get powershell to handle a SQL Server connection failure","body":"<p>I am deliberately trying to log in to a SQL Server where I do not have a login to test some error handling with PowerShell 2.0 and SMO using SQL Server 2008 R2.</p>\n\n<p>Here's my script:</p>\n\n<pre><code>param ([String]$instanceName);\n[System.Reflection.Assembly]::LoadWithPartialName('Microsoft.SqlServer.SMO') | out-null;\n\n$conn = new-object Microsoft.SqlServer.Management.Common.ServerConnection ; \n$conn.LoginSecure = $true; \n$conn.ServerInstance = $instanceName ; \n$conn.NonPooledConnection = $true ;  \n\ntry {\n    $serverInstance = New-Object Microsoft.SqlServer.Management.Smo.Server ($conn) ; \n}\n\ncatch { \n    $err = $Error[0].Exception ; \n    write-host \"Error caught: \"  $err.Message ; \n    continue ; \n} ; \n\nWrite-Output $serverInstance.Version;\n</code></pre>\n\n<p>the catch block does not get executed. Any ideas? I also tried to trap it using the <code>trap</code> function, but got the same result.</p>\n\n<p><strong>UPDATE 1</strong></p>\n\n<p>I have changed my script to the following and have got it to catch an exception on line</p>\n\n<pre><code>foreach($j in $serverInstance.Databases) {\n</code></pre>\n\n<p>If I comment out the foreach loop, <strong>the line below the foreach loop does not raise an exception</strong>, although it should (IMO).</p>\n\n<pre><code>param ([String]$instanceName);\n\n[System.Reflection.Assembly]::LoadWithPartialName('Microsoft.SqlServer.SMO') | out-null; # load the SMO assembly\nclear\n\n $ErrorActionPreference = \"Stop\";\n    $conn = new-object Microsoft.SqlServer.Management.Common.ServerConnection ; \n    $conn.LoginSecure = $false; \n    $conn.Login = \"sa\" ; \n    $conn.Password = \"password\" ; \n    $conn.ServerInstance = $instanceName ; \n    $conn.NonPooledConnection = $true ;  \n\ntry {\n    $serverInstance = New-Object Microsoft.SqlServer.Management.Smo.Server ($conn) ; \n    foreach($j in $serverInstance.Databases) { \n        write-host $j.name ; \n    } ; \n    Write-Output $serverInstance.Databases.Count;\n}\n\ncatch [Microsoft.SqlServer.Management.Common.ConnectionFailureException] {\n    $err = $Error[0].Exception ; \n    write-host \"Error caught: \"  $err.Message ; \n    while ( $err.InnerException )    {\n        $err = $err.InnerException;\n        Write-Host \"Inner exception:\" $err.InnerException.Message;\n        };      \n    return;\n} ; \n</code></pre>\n"},{"tags":["sql-server","visual-studio","sql-server-2008","visual-studio-2010"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":2713,"score":3,"question_id":2419828,"title":"DB Designer in Visual Studio 2010","body":"<p>I need to create an entirely new Sql Server 2008 database and want to use a Database Project in Visual Studio 2010 (Ultimate). I've created the project and added a table under the <em>dbo</em> schema. </p>\n\n<p>The table <em>.sql</em> is shown only as plain text, though with colors. It has no designer, no <em>Add Column</em>, and no autocomplete. Existing column's properties are grayed out. </p>\n\n<p>Usually, I use DB Project for nothing more than storing <em>.sql</em> files for source control purposes, but I'm assuming it can help me with designing the DB. Currently, it offers no such help and I think it's because I'm doing something wrong. Perhaps I need to deploy the DB to server first, or something of the such. I've looked for a Getting Started guide, but all guides I found start from importing an existing database.</p>\n\n<p><strong>Please help my understand what a DB Project can do for me and how.</strong></p>\n\n<p>Thanks,<br>\nAsaf</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13084902,"title":"SQL: Convert String of MMMDD to Datetime","body":"<p>I have a nvarchar(5) column of data that is formatted MMMDD (for example, OCT26). With my select statement, I'd like to convert it to a datetime data type with the current year, and then save that datetime value as an alias, say, UsefulDate. So something like 10-26-2012.</p>\n\n<p>Something like: SELECT (whatever SQL gets the job done) AS UsefulDate</p>\n\n<p>The exact formatting doesn't matter; I just need to be able to compare two dates together with greater than and less than operators. Also, sometimes the column will be blank. In that case, I'd like to set the alias to blank as well. Is this possible?</p>\n\n<p>Thanks for your help!</p>\n"},{"tags":["sql","sql-server-2008","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1665,"score":5,"question_id":10499290,"title":"Is it possible to deploy SSIS 2012 package on SQL Server 2008","body":"<p>I have a package that is developed in SSIS 2012 using Visual Studio 2010. </p>\n\n<ul>\n<li><p>Is it possible to deploy/attach this package on SQL Server 2008 </p></li>\n<li><p>If it is possible, does the licence of the sql server matter</p></li>\n</ul>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008","bids"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13084388,"title":"SSRS BIDS Unexpected end of file has occurred","body":"<p>I have come accross the following error in BIDS whilst working on one of my report parts.</p>\n\n<p>At the time I was playing around with an image that I imported into the project around 6 times, Visual Studio threw up an error about performance or memory, I re-booted and now this is all I see everytime I bring up the report part.</p>\n\n<p>I Have opened up the report that was deployed to the server the last time it was working in report builder 3.0, re-saved it in my project folder and attempted to re-add it to the project but it still throws up the error.</p>\n\n<p>Any suggestions?</p>\n\n<p><img src=\"http://i.stack.imgur.com/ABNw7.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","sql-server-2008","foreign-keys"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13084217,"title":"Sql Server 2008 Create Foreign Key Manually","body":"<p>I have inherited an old database which wasn't designed very well. It is a Sql Server 2008 database which is missing quite a lot of Foreign Key relationships. Below shows two of the tables, and I am trying to manually create a FK relationship between <strong>dbo.app_status.status_id</strong> and <strong>dbo.app_additional_info.application_id</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/NNaF4.png\" alt=\"enter image description here\"></p>\n\n<p>I am using SQL Server Management Studio when trying to create the relationship using the query below</p>\n\n<pre><code>USE myDatabase; \nGO ALTER TABLE dbo.app_additional_info \nADD CONSTRAINT FK_AddInfo_AppStatus FOREIGN KEY (application_id) \n    REFERENCES dbo.app_status (status_id) \n    ON DELETE CASCADE\n    ON UPDATE CASCADE ; \nGO\n</code></pre>\n\n<p>However, I receive this error when I run the query</p>\n\n<blockquote>\n  <p>The ALTER TABLE statement conflicted with the FOREIGN KEY constraint\n  \"FK_AddInfo_AppStatus\". The conflict occurred in database\n  \"myDatabase\", table \"dbo.app_status\", column 'status_id'.</p>\n</blockquote>\n\n<p>I am wondering if the query is failing because each table already contains approximately 130,000 records?</p>\n\n<p>Please help.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":544,"score":1,"question_id":4934034,"title":"select specific records with specific ordering without using a common condition","body":"<p>My purpose the following:</p>\n\n<p>I have a list of \"StudentID\"... Let's say: 4, 2, 3, 5, 7 (stored in an array for example),\nand I want to make a select statement that returns StudentID and StudentName of the specified studentID in the list, <strong><em>with the same order of the list</em></strong>.</p>\n\n<p>So the result should be:</p>\n\n<pre><code>StudentID StudentName\n4         Philip\n2         Mary\n3         Tima\n5         Lara\n7         Michel\n</code></pre>\n\n<p>How can I achieve this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13084245,"title":"How to get last record from the latest inserted record","body":"<p>I have a table like this</p>\n\n<pre><code>Col1   Col2  Mindate                        MaxDate \nA       B    12-04-2012 00:12:00:087        31-04-2012 00:00:01:001\nC       D    01-01-2011                     30-01-2011 \nA       B    09-05-2012                     27-05-2012\nA       B    11-07-2012                     21-07-2012\n</code></pre>\n\n<p>I have only inserted datetime in first row but omitied in other rows for brevity, all date columns are datetime.</p>\n\n<p>Assume that I have inserted the last records for A and B (Col1 and Col2 are combined key).\nNow I want last record for A amd B based on the mindate which in above case should be </p>\n\n<pre><code>A       B    09-05-2012                     27-05-2012\n</code></pre>\n\n<p>I am trying the following query:</p>\n\n<pre><code>SELECT * FROM tbl WHERE Col1 ='A' AND Col2='B' AND ....\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13081022,"title":"How to get checkbox value from gridview when checkbox OnCheckedChanged","body":"<p>I want to update data when I checked in gridview. Before I shoude get value from checkbox but my code return data from database only. I want current value after I checked.</p>\n\n<p><strong>CodeBehind:-</strong></p>\n\n<pre><code>protected void chkSelected_CheckedChanged(object sender, EventArgs e)\n{\n    for (int rowIndex = 0; rowIndex &lt; GridView1.Rows.Count; rowIndex++)\n    {\n        if (Convert.ToString(GridView1.Rows[rowIndex].Cells[4].Text) != \"\")\n        {\n            Response.Write(\"true\");\n        }\n        else\n        {\n            Response.Write(\"fasle\");\n        }\n    }\n}\n</code></pre>\n\n<p><strong>Design Code:-</strong></p>\n\n<pre><code>&lt;asp:GridView ID=\"GridView1\" runat=\"server\" DataSourceID=\"SqlDataSource1\"\n              CellPadding=\"4\" GridLines=\"None\" ForeColor=\"#333333\" Font-Size=\"Smaller\" \n              AutoGenerateColumns=\"False\"&gt;\n    &lt;RowStyle BackColor=\"#EFF3FB\" /&gt;\n    &lt;Columns&gt;\n        &lt;asp:BoundField DataField=\"LevelID\" HeaderText=\"ลำดับข้อ\" ReadOnly=\"True\" \n                        ItemStyle-Width=\"50\"  &gt;\n        &lt;/asp:BoundField&gt;\n        &lt;asp:BoundField DataField=\"LevelDesc\" HeaderText=\"คำถาม\" ReadOnly=\"True\" \n                        ItemStyle-Width=\"250\"  &gt;\n        &lt;/asp:BoundField&gt;\n        &lt;asp:BoundField DataField=\"ChoiceID\" HeaderText=\"ข้อย่อย\" ReadOnly=\"True\" \n                        ItemStyle-Width=\"50\"  &gt;\n        &lt;/asp:BoundField&gt;\n        &lt;asp:BoundField DataField=\"ChoiceDesc\" HeaderText=\"คำถามย่อย\" ReadOnly=\"True\" \n                        ItemStyle-Width=\"400\"  &gt;\n        &lt;/asp:BoundField&gt;\n        &lt;asp:TemplateField HeaderText=\"ใช่\"&gt;          \n            &lt;ItemTemplate&gt;              \n                &lt;asp:CheckBox ID=\"chkSelected\" runat=\"server\" Checked='&lt;%# Eval(\"Selected\").ToString().Equals(\"True\") %&gt;'\n                     AutoPostBack=\"true\" OnCheckedChanged=\"chkSelected_CheckedChanged\" CssClass=\"chkBox\" /&gt;          \n            &lt;/ItemTemplate&gt;       \n        &lt;/asp:TemplateField&gt; \n    &lt;/Columns&gt;\n    &lt;FooterStyle BackColor=\"#507CD1\" ForeColor=\"White\" Font-Bold=\"True\" /&gt;\n    &lt;PagerStyle BackColor=\"#2461BF\" ForeColor=\"White\" HorizontalAlign=\"Center\" /&gt;\n    &lt;SelectedRowStyle BackColor=\"#D1DDF1\" Font-Bold=\"True\" ForeColor=\"#333333\" /&gt;\n    &lt;HeaderStyle BackColor=\"#0000CD\" Font-Bold=\"True\" ForeColor=\"White\" /&gt;\n    &lt;EditRowStyle BackColor=\"#2461BF\" /&gt;\n    &lt;AlternatingRowStyle BackColor=\"White\" /&gt;\n&lt;/asp:GridView&gt;\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13083302,"title":"pivot table w/out function","body":"<p>I am trying to write a sql statement that creates a pivot table.</p>\n\n<p>The data is a list of survey responses and is made from a join query involving tables respondent, response and answer.  The answer table is structured as below:</p>\n\n<pre><code>______________________________________________________________\n|AnswerID|ResponseID|QuestionID|AnswerComment                |\n|      1 |        1 |        1 |This is answer 1             |\n|      2 |        1 |        2 |This is answer 2             |\n|      3 |        1 |        3 |This is answer 3             |\n|      4 |        2 |        1 |Answer 1 Respondent 2        |\n|      5 |        2 |        3 |Resp 2, No Q.2               |\n|      6 |        3 |        2 |I answered Q.2 only          |\n|____________________________________________________________|\n</code></pre>\n\n<p>Respondent looks like:</p>\n\n<pre><code>______________________________________________________________\n|RespondentID|GivenName|Surname|age, gender, blah blah       |\n|____________________________________________________________|\n</code></pre>\n\n<p>Response:</p>\n\n<pre><code>______________________________________________________________\n|ResponseID|ResponseDate|RespondentID|Attachment             |\n|____________________________________________________________|\n</code></pre>\n\n<p>and Question:</p>\n\n<pre><code>_____________________________________________________\n|QuestionID|QuestionNumber|QuestionText|            |\n|___________________________________________________|\n</code></pre>\n\n<p>I want my output in the form of:</p>\n\n<pre><code>________________________________________________________________________________________\n|RespondentInfo|ResponseDate|1                     |2                  |3               |\n|Respondent 1  |15/10/2012  |This is answer 1      |This is answer 2   |This is answer 3|\n|Respondent 2  |17/10/2012  |Answer 1 Respondent 2 |                   |Resp 2, No Q.2  |\n|Respondent 3  |19/10/2012  |                      |I answered Q.2 only|                |\n|______________________________________________________________________________________|\n</code></pre>\n\n<p>I want to get one line per respondent with each answer in the corresponding column.  The query I have created - although it pivots the answers to the correct columns - provides a new row for each answer with nulls in all the blank columns.</p>\n\n<p>My sql:</p>\n\n<pre><code>SELECT Respondent, ResponseDate, \n         [1], [2], [3]\nFROM  (\n       SELECT  Respondent.Surname + ', ' + FirstName as RespondentInfo, \n               Response.ResponseDate, \n               isnull(Answer.AnswerComment, '') as Answer, \n               Qustion.QuestionNumber\n       FROM    Answer INNER JOIN\n                Question ON Answer.QuestionID = Question.QuestionID INNER JOIN\n                   Response ON Answer.ResponseID = Response.ResponseID INNER JOIN\n                   Respondent ON Response.RespondentID = Respondent.RespondentID\n       ) as ResponseQuery\nPIVOT (\n    max(Answer)\nFOR ResponseQuery.QuestionNumber in ([1], [2], [3])\n       ) AS OutputTable\n</code></pre>\n\n<p>I think the issue is because I am not using an aggregate function so have defaulted to max().  Can anyone point me in the right direction.  </p>\n\n<p>Apologies if my question is too verbose.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13083191,"title":"WHERE clause not working, uses ISNULL","body":"<p>Not sure where the problem is, but I've got a function that is returning the wrong total.  I've put the same criteria into a view and it again returns the wrong records.</p>\n\n<pre><code>    FieldsA&lt;&gt;'XYZ' \nAND CustAcc=345 \nAND Supplier&lt;&gt;'FG67FG' \nAND Category='XYZ' \nAND isnull(STATUS,'ZZZ')='READY' \nAND isnull(DESPATCHSTATUS,\"ZZZ\")='APPROVED'\n</code></pre>\n\n<p>It works for most of the records, but one I'm looking at, is coming back and the DESPATCHSTATUS is 'REJECTED'.</p>\n\n<p>Any ideas why this, particularly ISNULL might misbehave?</p>\n"},{"tags":["c#","sql-server-2008","bcp"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":328,"score":1,"question_id":8008757,"title":"SQL Server BCP utility best separator character to use","body":"<p>I am sure many would came across this scenario.</p>\n\n<p>Whenever we use SQL Server BCP utility to import/export data to-from delimited text files, which is the best <code>\"Separator Character\"</code> to use. We have Note-text kind of fields which can have , and now we found | &amp; ~ is also used by our users in those fields.\nWhich character in your opinion has least chances of user ever used. Or you have better alternative to deal with this issue.</p>\n\n<p>Update-\nThis software is being developed in UK-English users.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":99,"score":0,"question_id":13073740,"title":"Need help on following sql query","body":"<p>This is my current SQL query. I need to modify this</p>\n\n<pre><code>SELECT \n    18 BrokerDealerID,\n    5 PortfolioID,\n    PeriodEndDate DATE,\n    SecurityIdentifier_All.SecurityId,\n    MAX(\n    (CASE \n        WHEN Securities.Quantity &lt; 0 THEN\n        100 + (100 - LocalPriceAmount)\n        ELSE\n        LocalPriceAmount\n     END\n        ) /100) Mark\nFROM\n    Fireball_Reporting..StateStreet_DailyPosition_Second StateStreet \nINNER JOIN\n    Fireball_Reporting..SecurityIdentifier_All ON StateStreet.CUSIP = SecurityIdentifier_All.Identifier\nINNER JOIN\n    Fireball..TradeBySecurityType Securities ON\n        Securities.PricingSecurityID = SecurityIdentifier_All.SecurityId AND Securities.Position = 1 AND\n(CASE WHEN StateStreet.SecurityName LIKE '% R V %' THEN StateStreet.SharesParValue * -1 ELSE StateStreet.SharesParValue END) = Securities.Quantity\nWHERE\n    CONVERT(DATETIME, StateStreet.PeriodEndDate) = '2012-10-23' --@PositionDate\nGROUP BY\n    PeriodEndDate,\n    SecurityIdentifier_All.SecurityId\n</code></pre>\n\n<p>I need to do change in 2nd condition i.e </p>\n\n<pre><code>(CASE WHEN StateStreet.SecurityName LIKE '% R V %' THEN StateStreet.SharesParValue * -1 ELSE StateStreet.SharesParValue END) = Securities.Quantity\n</code></pre>\n\n<p>I will give you an example.</p>\n\n<p>my select query giving me following output</p>\n\n<pre><code>securityname date       securityid portfolioid type mark               quantity\n------------ ---------- ---------- ----------- ---- ------------------ -------------\nR V DISH     10/23/2012 4879505    5           CDS  1.0487189900000000 -5000000.0000\nR V DISH      10/23/2012 4879505    5           CDS  1.0487189900000000 -2000000.0000\nR F DISH    10/23/2012 4879505    5           CDS  0.9512810100000000 3000000.0000\n</code></pre>\n\n<p>Here above it is giving me 3 records for same security id \nWhen I do MERGE using above result it is only taking 1st record directly if i don't check that 2nd condition which checks for <code>Quantity</code> but now i want to check only for \nWhen In StateStreet.SecurityName LIKE '% R V %' take the records from above result whose quantity is <code>-</code> if not then take the record whose quantity id <code>+</code> </p>\n\n<p>How could I change that case statement? or directly check for <code>% R V%</code> in select statement where i calculated mark  ?\nNeed technical help.\nI'm new to SQL.</p>\n"},{"tags":["sql","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":122,"score":0,"question_id":8779837,"title":"SSIS Data Flow Task Source as Tabbed Delimited File not reading last line throws partial data on last line error","body":"<p>Following is sample from my application</p>\n\n<p>Source- Tabbed Delimited file Col1 Col2 Col2 aa a 1 2 da a 1 2 ca a 1 2 ba a 1 2</p>\n\n<p>Destination- OLE DB Table</p>\n\n<p>create table test_data_1 (col1 varchar(100), col2 int, col3 varchar(100))</p>\n\n<p>Issue- all the rows are copied Except the last Row, when check debug file, there is a warning saying last line has Partial data hence ignored.</p>\n\n<p>Any suggestions on how to fix this issue in SSIS?</p>\n\n<p>Data is valid data.</p>\n"},{"tags":["sql-server-2008","table","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13081747,"title":"Find out the stored procedure using the table from all databases available","body":"<p>Please Help me on this issue. I have a specific table from a specific database. I want to find the stored procedure using the table from all databases available. </p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server-2008","filegroup"],"answer_count":3,"favorite_count":4,"up_vote_count":7,"down_vote_count":0,"view_count":16487,"score":7,"question_id":712449,"title":"How do i move a table to a particular FileGroup in MS Sql 2008","body":"<p>i've just created a secondary filegroup and wish to move some tables over to it and then make it read-only.</p>\n\n<p>I'm not sure how to do this?</p>\n\n<p>do i just use the <code>ALTER blah blah TO MyFileGroup</code> ?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":20,"score":-2,"question_id":13081232,"title":"Delete duplicate rows from table","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/841447/delete-duplicate-sql-records\">Delete Duplicate SQL Records</a>  </p>\n</blockquote>\n\n\n\n<p>I want to delete duplicate rows from a table</p>\n\n<pre><code>ID      uID     SID      USID\n------------------------------\n4391    007 Flight  ADM007\n4392    007 Enquiry ADM007\n6723    007 Flight  ADM007\n6724    007 Enquiry ADM007\n6725    008 Flight  ADM008\n6726    008 Enquiry ADM008\n4393    008 Flight  ADM008\n4394    008 Enquiry ADM008\n4395    009 Flight  ADM009\n4396    009 Enquiry ADM009\n6727    009 Flight  ADM009\n6728    009 Enquiry ADM009\n</code></pre>\n\n<p>I want to keep only </p>\n\n<pre><code>4391    007 Flight  ADM007\n4392    007 Enquiry ADM007\n6725    008 Flight  ADM008\n6726    008 Enquiry ADM008\n4395    009 Flight  ADM009\n4396    009 Enquiry ADM009\n</code></pre>\n\n<p>please give me suggestion</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13081347,"title":"Stored procedure to call a different stored procedure based on parameter","body":"<p>I would like to create a stored procedure in Sql Server that calls one of a number of different stored procedures and chooses which one based on the parameter supplied to it, but I can't seem to get the choosing syntax right.</p>\n\n<p>Currently attempting:</p>\n\n<pre><code>Begin\n  Set nocount on;\n  exec iif(param='individual', sp_FindIndividualRespondents, \n      iif(param='org', sp_FindOrgRespondents, sp_FindGroupRespondents))\nEnd\n</code></pre>\n\n<p>This is currently telling me: Incorect syntax near 'param'.</p>\n\n<p>I have looked here: <a href=\"http://stackoverflow.com/questions/4159528/conditional-where-clause-based-on-a-stored-procedure-parameter\">conditional where clause based on a stored procedure parameter?</a>, but I can't work out how to change that code to suit my situation.</p>\n\n<p>How do i provide a parameter to a stored procedure and then use it to choose and run a different stored procedure?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":91,"score":1,"question_id":13075465,"title":"Is there any alternative of 'like' operators in sql - for searching data","body":"<p>I need some help here, I am fetching data dependent upon the conditions</p>\n\n<p>Here I am using like operators, where client may use search with any word thus I have the below logic but here retrieval time is too high (it's taking 4mins) to get the data which is too slow.</p>\n\n<p>I did all indexing to table but still can't optimize the query.</p>\n\n<p>select * from authors \nwhere (address like '% Walmart %' OR address like 'Walmart %' OR address like '% Walmart' OR address like '% Walmart.com %' OR address like 'Walmart.com %' OR address like '% Walmart.com' OR address like '% Walmarts %' OR address like 'Walmarts %' OR address like '% Walmarts' OR address like '% Walmarts.com %' OR address like 'Walmarts.com %' OR address like '% Walmarts.com') </p>\n\n<p>-- Result is 1 Rows </p>\n\n<p>if i follow this logic</p>\n\n<p>select * from authors \n    where address like '%Walmart%'</p>\n\n<p>-- Result is 44 rows - it is fetching all rows</p>\n\n<p>But I need to get only that one row</p>\n"},{"tags":["mysql","sql","sql-server-2008","sql-server-triggers"],"answer_count":1,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13080765,"title":"Insert Data from MSSQL to MySql using Trigger","body":"<p>I have two database. One is in MSSQL and other is in MySql. I want to insert data into MySQL table while an insertion occurs in the MSSQL table. Is it possible using trigger in MSSQL? Please give me an answer?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13076890,"title":"Update table with random record in update statment in SQL Server?","body":"<p>I have two tables. <code>Table 1</code> has about 80 rows and <code>Table 2</code> has about 10 million. </p>\n\n<p>I would like to update all the rows in <code>Table 2</code> with a random row from <code>Table 1</code>. I don't want the same row for all the rows. Is it possible to update <code>Table 2</code> and have it randomly select a value for each row it is updating?</p>\n\n<p>This is what I have tried, but it puts the same value in each row.</p>\n\n<pre><code>update member_info_test\nset hostessid = (SELECT TOP 1 hostessId FROM hostess_test ORDER BY NEWID())\n</code></pre>\n\n<p>**Edited</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2804,"score":3,"question_id":1500290,"title":"How to Script Automatically, the securables assigned to a SQL account","body":"<p>I want to generate script to assign an user account to some securables, e.g. Table:Select.</p>\n\n<p>How to do this?</p>\n"},{"tags":["c#",".net","sql-server-2008",".net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13079439,"title":"location picker for .net 4","body":"<p>I'm developing an app to control onsite projects. I need to let the user specify the project's location from its country down to its address, and latitude/longitude coordinates. </p>\n\n<p>The problem is, location information isn't uniformly described across countries, i.e., countries have different names in their location hierarchy. So if one project is located in the USA, it will have a hierarchy of: </p>\n\n<pre><code>Country / State / City\n</code></pre>\n\n<p>Chile, on the other hand, has a hierarchy of:</p>\n\n<pre><code>Country / Region / County / City / district / neighborhood\n</code></pre>\n\n<p>How should I model this? </p>\n\n<p>Is there a premade <code>.net</code> module I can stick into my project that would work? Should I just simplify the hierarchy into four distinct levels, and let the user deal with the complexity of different hierarchies across countries?</p>\n\n<p>The best solution for me would be to use a premade assembly that I could stick into my code with little effort, but I'm not afraid to code an implementation on my own. </p>\n\n<p>The problem is that every solution I manage to cook seems too complicated to be practical, so any advice is more than welcome.</p>\n"},{"tags":["sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":13072990,"title":"Date Format In SSIS Derived Column","body":"<p>I have 2 questions, I have a text file with all my data, in the text file I have for example <code>Sply_DT</code> and <code>Imprt_DT</code>.</p>\n\n<p>For <code>Sply_Dt</code> I have to create <code>getdate()</code> and I have it formatted as <code>2012-10-25 12:04:16.09900000</code> using <code>(DT_DBTIMESTAMP)(DT_DBDATE)GETDATE()</code> but I want it formatted as <code>MM-DD-YY</code>.</p>\n\n<p>And for <code>Impt_DT</code>, it's in the <code>5/16/2011</code> format in dataviewer but when I placed it into a table it looks like <code>2011-05-16 00:00:00.000</code> and I want it in <code>MM-DD-YY</code> format.</p>\n"},{"tags":["sql-server-2008","optimization","integer","full-text-indexing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12979996,"title":"How does SQL Server full-text Index actually index the words in a catalog?","body":"<p>I have been searching long and hard for an answer regarding the processes full-text index uses to index the full text catalogs assigned to a document, where the document primary key is included in the indexing. I have not been able to find the MSDN article that describes this in depth.</p>\n\n<p>Why can't I use it for searching int-only strings in the full text search columns?</p>\n\n<p>SEE HERE: (WELL, I'm a new user so I remade the columns myself since I can't post an image)</p>\n\n<pre><code> ID       FIRSTNAME   LASTNAME    ADDRESS            FULLTEXTCOLUMN\n 1         JOHN        DOE        123 Main St.       1  JOHN DOE 123 Main St. \n 2         JANE        DOE        124 Summer St.     2  JANE DOE 124 Summer St.\n                                                     ^ ----------^ --can't search \n</code></pre>\n\n<p>For example, in <a href=\"http://www.codeproject.com/Articles/315101/SQL-Full-Text-Search-Programming\" rel=\"nofollow\">this link</a>, the author of the post shows that he has included the primary key int-only indexes in his full text-indexed column --- but why? After trying a <code>CONTAINS()</code> search on the int values for myself, the search can't find anything without text attached.</p>\n\n<p>So why do so many people show integer-only strings in their catalog if they aren't searchable? I have a huge need for integer-search options in my catalog, and hope I'm just missing something.</p>\n\n<p>Does this mean that the indexes are only assigned to strings that contain at least one letter?</p>\n\n<p>This question <a href=\"http://stackoverflow.com/questions/7394420/best-approach-for-doing-full-text-search-with-list-of-integers-documents\">here</a> describes a catalog format very close to what I'm trying to cheat the system to do in SQL Server (because this is my only database option).</p>\n\n<p>Thanks for your help!</p>\n\n<p>And yes, this is my closed question <a href=\"http://stackoverflow.com/questions/12963490/why-is-there-no-delimited-integer-only-cataloging-option-in-sql-server\">here</a> but I don't care because it is a \"real\" question and important one. I have a team of people behind me wondering this.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","geometry","geospatial"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13077666,"title":"STContains() on Two table to find where my Region lies in Country","body":"<p>I have Two table. 1st Table with column \"Point\" and 2nd Table with column \"NZTM\". Now I want to check where my Point lies in NZTM. Both the columns are converted into geometry. I got 15 million points and 2000 NZTM rows. 1 Point can belong to 0 or 1 or more NZTM.</p>\n\n<p>So for this operation I am using STContains. But this seem to be giving an issue as I am using cross join it joins all the columns in 1st table to all the columns of 2nd table and takes ages to complete this operation. I am using the following query</p>\n\n<pre><code>         Select case when A.points.STContains(B.NZTM) &gt;0\n            then \n                A.MeshBlockIdentifier\n            end val,\n            B.SeqID sid     \n        from dbo.EventConversion B\n        cross join\n        [dbo].[REGC12] A\n</code></pre>\n\n<p>Any one please help me on how do I check or use ST_Contains on my two columns?\nP.S I am using SQL Server 2008 R2</p>\n"},{"tags":["sql-server-2008","full-text-search","indexes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12943728,"title":"Is Full Text Search just as effecient when indexing integers separated by spaces in the same column?","body":"<p>I.E. Does full text search work just as well/better searching through <em>only</em> integers separated by spaces and indexed using the \"full text index\"?</p>\n\n<p>Thanks!</p>\n"},{"tags":["visual-studio-2010","sql-server-2008","crystal-reports","iis6"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13077615,"title":"Correct configuration for IIS 6.0 Application Pool on a windows 2003 server to access Crystal Reports","body":"<p>I have crystal reports correctly working on my local development machine IIS5.1 and Crystal Reports from VS2010 also works fine.</p>\n\n<p>I have a SQL database and everything is configured and running correctly in my local machine. The ODBC is correctly configured on my local machine and my server.</p>\n\n<p>However, I am getting a connection failed issue on the windows 2003 server for crystal reports. The Application Pool in IIS is configured to run under Network Service. </p>\n\n<p>Is this the correct recommendation? Any other suggestions?</p>\n"},{"tags":["sql-server-2008","table","search","delimiter"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12963072,"title":"Full \"Text\"-type search alternative/solution for catalog of delimited integers?","body":"<p>I am in need of an alternative to the Full Text Catalog/Index for text/character strings, as I am working with integer values. Is there something out there that is faster than using \"like\" to search through some sort of delimited integer catalog? (Each delimited integer should be indexed throughout the entire catalog, not just that values of each cell as a single unit?)</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","sql-server-2008","security","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13074704,"title":"SQL Server Activity Monitor Ports","body":"<p>I'm trying to convince my IT department to grant me necessary <a href=\"http://msdn.microsoft.com/en-us/library/ms175518.aspx#Security\" rel=\"nofollow\">permissions</a> on our SQL Server 2012 instance in order to use the Activity Monitor in the Management Studio.  Our lead IT administrator is concerned about granting them because he is unsure what, if any, ports Activity Monitor listens on.  I'd like to add that I currently have access to this SQL Server instance on port 1433.</p>\n\n<p>I'm not very familiar with Activity Monitor's inner workings, are there any specific ports Activity Monitor listens on that should be a security concern?  Does anyone know any resources that may provide this information?  I want to make sure I give an accurate response.</p>\n"},{"tags":["c#","sql-server-2008","nhibernate","asp.net-web-api","autofac"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":13003455,"title":"Why isn't my NHibernate update working?","body":"<p>I'm currently using the ASP.NET Web Api along with NHibernate &amp; Autofac...I'm having an issue where my update is not being committed to the database.  I'm using an ActionFilterAttribute to open and close a transcation every time an action is performed like so:</p>\n\n<pre><code>private ISessionFactory SessionFactory { get; set; }\n\npublic TransactionAttribute()\n{\n    SessionFactory = WebApiApplication.SessionFactory;\n}\n\npublic override void OnActionExecuting(System.Web.Http.Controllers.HttpActionContext actionContext)\n{\n    var session = SessionFactory.OpenSession();\n    CurrentSessionContext.Bind(session);\n    session.BeginTransaction();\n}\n\npublic override void OnActionExecuted(HttpActionExecutedContext actionExecutedContext)\n{\n    var session = SessionFactory.GetCurrentSession();\n    var transcation = session.Transaction;\n    if (transcation != null &amp;&amp; transcation.IsActive)\n    {\n        transcation.Commit();\n    }\n    session = CurrentSessionContext.Unbind(SessionFactory);\n    session.Close();\n}\n</code></pre>\n\n<p>Which works fine for the add, read, and delete functions in my repository.  Unfortunately, my update doesn't seem to be working (though I've tried it several ways):</p>\n\n<pre><code>public bool Update(Client client)\n{\n    var result = Get(client.ClientID);\n\n    if (result == null)\n    {\n        return false;\n    }\n\n    result.Name = client.Name;\n    result.Acronym = client.Acronym;\n    result.Website = client.Website;\n\n    return true;\n}\n</code></pre>\n\n<p>From what I've read if modifying an object during a transaction, there's no need to manually call Update or SaveOrUpdate, as this is tracked by NHibernate &amp; performed when the transaction is committed.</p>\n\n<p>Why would my update function not be working properly?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2008","tsql","sa"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":8758976,"title":"Is there a T-SQL function to return the name of the 'sa' account?","body":"<p>(I know the question sounds ridiculous, but bear with me ...)</p>\n\n<p>Our DBA changes the 'sa' account name to something else for their own security purposes.  There are business needs to use the account name in script (e.g. sp_add_job), but this will break in this situation.  I'd like to be able to submit a script that doesn't need to be edited to use the new 'sa' username before running.</p>\n\n<p>Is there a function/property similar to @@SERVERNAME that will return the name of this account?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13075066,"title":"SQL Query results pagination with random Order by in SQL Server 2008","body":"<p>I am trying to implement pagination to a page on my website that returns results from a database table.</p>\n\n<p>Currently, it returns all rows in a random order. However, as my database is growing, I want to paginate these results instead of displaying them all on one page. However, I don't want to return all results just to display 20 records for instance. Depending on the page, I want take just the 20 records from the database that are relevant.</p>\n\n<p>I'm following this tutorial: <a href=\"http://www.mikesdotnetting.com/Article/150/Web-Pages-Efficient-Paging-Without-The-WebGrid\" rel=\"nofollow\" title=\"Tutorial\">Tutorial</a></p>\n\n<p>However, the I cannot use the query with the <code>OFFSET</code> clause, because the hosting uses SQL SERVER 2008. (It is introduced in 2012 i believe).</p>\n\n<p>I tried following the answer to this <a href=\"http://stackoverflow.com/questions/187998/row-offset-in-sql-server\" title=\"Question\">Question</a>, but I want the results in a random order, and I cannot do an <code>ORDER BY</code> on a derived table... so I'm a bit stuck for ideas!</p>\n\n<p>Any help? Thanks!</p>\n\n<p>This is what I currently have:</p>\n\n<pre><code>    SELECT Title, Filename, PhotoURL, Orientation, FolderName, SetURL, RowNum\n      FROM (\n            SELECT  p.Title, p.Filename, p.URL AS PhotoURL, p.Orientation, s.FolderName, s.URL AS SetURL, ROW_NUMBER() OVER (ORDER BY p.PhotoID) AS RowNum\n          FROM  Photos p\n                LEFT OUTER JOIN SetPhotos sp\n                    ON sp.PhotoID = p.PhotoID\n                LEFT OUTER JOIN [Sets] s\n                    ON s.SetID = sp.SetID\n         WHERE  p.Hide = 0\n      ORDER BY  NEWID()\n        ) AS PaginatedPhotos\n WHERE  PaginatedPhotos.RowNum BETWEEN 0 AND 10\n</code></pre>\n"},{"tags":["sql-server-2008","ssis","ssis-data-transformations"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1128,"score":0,"question_id":3649724,"title":"Learning SSIS 2008","body":"<p>I would like to learn SSIS 2008. can any one guide me to get ebbok to learn SSIS 2008?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":48,"score":0,"question_id":13075079,"title":"Finding a line break in a text string in a SQL table?","body":"<p>I was trying to find line breaks and carriage returns in a column in a SQL table and I am not sure about the syntax.</p>\n\n<p>I tried:</p>\n\n<pre><code>SELECT foo FROM test\nWHERE foo LIKE CHAR(10)\n</code></pre>\n\n<p>I didn't get any results even though I know that the table should return results.  What am I doing wrong?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":53,"score":2,"question_id":13070519,"title":"Should I avoid using sp_getAppLock?","body":"<p>I have a stored procedure, and I want to ensure it cannot be executed concurrently.</p>\n\n<p>My (multi-threaded) application does all necessary work on the underlying table via this stored procedure.</p>\n\n<p>imo, locking the table itself is an unnecessarily drastic action to take, and so when I found out about <code>sp_GetAppLock</code>, which essentially enforces a critical section, this sounded ideal.</p>\n\n<p>My plan was to encase the stored procedure in a transaction and to set up <code>spGetAppLock</code> with transaction scope. The code was written and tested successfully.</p>\n\n<p>The code has now been put forward for review and I have been told that I should not call this function. However when asking the obvious question \"why not?\", the only reasons I am getting are highly subjective, to do with any form of locking being complicated.</p>\n\n<p>I don't necessarily buy this, but I was wondering whether anyone had any <em>objective</em> reasons why I should avoid this constuct. Like I say, given my circumstances a critical section sounds an ideal approach to me.</p>\n\n<p>TIA,\nPete</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":44,"score":0,"question_id":13073459,"title":"get random data from table in sql server?","body":"<pre><code>SELECT TOP 10 * \nFROM Questions TABLESAMPLE (100 ROWS) \norder by NEWID()\n</code></pre>\n\n<p>It returns the same 10 records every time but they are in a different sequence.  How can I get a different set of 10 random values each time?</p>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":552,"score":2,"question_id":5966823,"title":"SSRS Error: No Such Interface Supported","body":"<p>I have a user that cannot export a report from a Sql Server Reporting Services (SSRS) report in any format.  This user is running Windows 7 x86 SP1 with IE8.</p>\n\n<p>The user will bring up any report and it is displayed properly.  Then they will click on the Export button on the report toolbar (to export it to Excel or PDF) and this error is displayed:</p>\n\n<p><strong>No such interface supported</strong> - Reserved.ReportViewerWebControl.axd  URI:http//reportserver...</p>\n\n<p>Other people at this same location and simliar computer configuration have no issues.  The problem user has Office 2007 installed and it opens Excel files without issues.  Again, this user has this problem with ALL reports and no other user has this issue on any report.  Therefore, it is clearly a problem with something on his computer, but I really don't know where to start.</p>\n\n<p>In desperation, I had him click on the \"Print\" button on the Report toolbar, as I know that triggers the download of some MS-required component.  He was able to print from there, but the above error remains.</p>\n\n<p>I would greatly appreciate any suggestions or feedback.  Thank you!</p>\n"},{"tags":["sql","sql-server-2008","bitwise"],"answer_count":8,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":1860,"score":5,"question_id":158519,"title":"How to handle a lot of flags for a SQL record","body":"<p>I need advice on how to handle relatively large set of flags in my SQL2k8 table.</p>\n\n<p>Two question, bear with me please :)</p>\n\n<p>Let's say I have 20 flags I'd like to store for one record.</p>\n\n<p>For example:</p>\n\n<p>CanRead = 0x1\nCanWrite = 0x2\nCanModify = 0x4\n...\nand so on to the final flag 2^20</p>\n\n<p>Now, if i set the following combination of one record: Permissions = CanRead | CanWrite</p>\n\n<p>I can easily check whether that record has required permission by doing WHERE (Permissions &amp; CanRead) = CanRead</p>\n\n<p>That works.</p>\n\n<p>But, I would also like to retrieve all records that can either write OR modify.</p>\n\n<p>If I issue WHERE (Permissions &amp; ( CanWrite | CanModify )) = (CanWrite | CanModify) i obviously won't get my record that has permissions set to CanRead | CanWrite</p>\n\n<p>In other words, how can I find records that match ANY of the flags in my mask that i'm sending to the procedure?</p>\n\n<p>Second question, how performant is in in SQL 2008? Would it actually be better to create 20 bit fields?</p>\n\n<p>Thanks for your help</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":108,"score":1,"question_id":13072992,"title":"Avoid \"SELECT TOP 1\" and \"ORDER BY\" in Queries","body":"<p>I have the very table in sql server 2008 with lot of data</p>\n\n<pre><code>|ID|Name|Column_1|Column_2|\n|..|....|........|........|\n</code></pre>\n\n<p>more than 18,000 records. So i need to the the row with the lowest value of <code>Column_1</code> that is date but could by any data type (that is unsorted) so I use these sentence</p>\n\n<pre><code>SELECT TOP 1 ID, Name from table ORDER BY Column_1 ASC\n</code></pre>\n\n<p>But this is very very slow. And i think that i don't need to to sort the whole table. My question es how to get the same date with out using <code>TOP 1</code> and <code>ORDER BY</code></p>\n"},{"tags":["sql-server-2008","encryption"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13057332,"title":"Linked server requires no encryption","body":"<p>I'm trying to replicate a Linked Server from a Windows 2k3 / SQL Server 2000 to a Windows 2008 / SQL 2008 R2 setup.  </p>\n\n<p>The SQL 2000 Linked server is setup like this:</p>\n\n<pre><code>srvname=blah.blah.com\nsrvproduct=SQL Server\nprovidername=SQLOLEDB\ndatasource=blah.blah.com\nsrvnetname=blah.blah.com\nrpc=1\nrpcout=1\ndataaccess=1\n</code></pre>\n\n<p>The SQL 2008 R2 Linked Server is setup the same way.\nI've copied the remote users, and all seems fine, except when i tried to connect, I get this error:</p>\n\n<pre><code> OLE DB provider \"SQLNCLI10\" for linked server \"blah.blah.com\" returned message \"Client unable to establish connection\". (Microsoft SQL Server, Error: 20)\n Encryption not supported on SQL Server\n</code></pre>\n\n<p>I still have access to the SQL 2000 machine, and can run the query fine.  I'm guessing the issue is that Windows2008 machine is trying to send data encrypted, but the linked server is saying it can't handle encryption.  Something along those lines.  I've played with various different Data Source types, and nothing seems to pan out.  I don't have access to the remote server so I don't know what OS/Database is on it.</p>\n\n<p>Anyone with more SQL knowledge than me can point me in the right direction?\nThanks!</p>\n"},{"tags":["sql-server-2008","tsql","ssis","ssms","osql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13072607,"title":"Generating a .csv file by running a .sql script with osql.exe","body":"<p>I have a script file in a folder.I want to use TSQL to run this script without opening it in SSMS as I will be using SSIS to run this script to generate CSV.</p>\n\n<p>I have used OSQL to achieve this by using Execute Process Task but it is not giving me exact results I am looking for. It is generating spaces in the csv. A 17 mb file which I exported by rightclick as CSV option turned out to 1gb when I executed using OSQL code.The OSQL I used is:</p>\n\n<p><code>-E -S CCCMSDSQL20,1819 -d SHARE_SCRUB  -q  \"SET NOCOUNT ON\" -i \"C:\\Scripts\\.SQL\" -o \"C:\\Scripts\\.csv\" -n -h-1 -s\",\" -w 700</code></p>\n\n<p>I prefer a TSQL script which can achieve the same,so that I can use it in Execute SQL task and get the results.</p>\n\n<p>EDIT:\nI am working to generate multiple csv's from multiple .sql files in a folder .I am using a for each loop container and execute process task as of now.I want to change the execute process task to execute sql task and use this script to generate multiple files.</p>\n\n<p>If it is possible to write a TSQL code which can do the looping and generation of CSV files in one script I can use it without using the package.</p>\n\n<p>Thanks for your time and help.</p>\n"},{"tags":["sql-server-2008","duplicates","rows","reportbuilder3.0"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13073826,"title":"How to merge rows in SQL Report Builder when some rows have columns with no values?","body":"<p>I have been given a rather complex report and asked to update it so that a user can enter values for several parameters (some of which then present selections in multi-value paramenters), in order to generate a list of all computer names with one or more specific software packages installed on them. </p>\n\n<p>A \"simplified\" version of the main query (shown below) works, but unfortunately the report sometimes lists nearly duplicate rows for the same software package on the same computer; one with an installation date and the other without an installation. There are also records that have no installation date, but do not have a corresponding record with an installation date. </p>\n\n<p>I am able to eliminate rows without installation dates by adding \"AND arp.InstallationDate0 IS NOT NULL\" to the WHERE clause, but how can I change the query so that if duplicate records exist, only the one with the installation date is displayed, yet if only one record with no installation exists, that record is shown?  </p>\n\n<p>Thanks for any help you can offer.</p>\n\n<pre><code>SELECT DISTINCT sys.Name0 , arp.DisplayName0 , arp.Version0 , arp.InstallDate0 \n\nFROM v_R_System sys \n\nINNER JOIN (SELECT * FROM v_GS_ADD_REMOVE_PROGRAMS UNION SELECT * \n  FROM v_GS_ADD_REMOVE_PROGRAMS_64) arp ON sys.ResourceID = arp.ResourceID \n\nINNER JOIN v_FullCollectionMembership fcm ON sys.ResourceID = fcm.ResourceID \n\nWHERE arp.DisplayName0 IN (@productname) AND COALESCE (arp.Version0, '') LIKE @version  \n  AND fcm.CollectionID IN (@selectcollection) \n\nORDER BY sys.Name0\n</code></pre>\n"},{"tags":["sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":17,"score":-1,"question_id":13073651,"title":"Sql server Query to get the Table Altered Result","body":"<p>I have a table as below  </p>\n\n<pre><code>ClientID        AccountNumber   BalanceOnDay0       BalanceOnDay1   BalanceOnDay2       BalanceOnDay3       BalanceOnDay4       BalanceOnDay5       BalanceOnDay6       BalanceOnDay7\nABC1            123             10                  NULL            NULL                NULL                NULL                NULL                NULL                NULL    \nABC1            123             NULL                NULL            NULL                NULL                NULL                NULL                NULL                3       \n</code></pre>\n\n<p>I would like to see the result as beblow.  </p>\n\n<pre><code>ClientID        AccountNumber   BalanceOnDay0       BalanceOnDay1   BalanceOnDay2       BalanceOnDay3       BalanceOnDay4       BalanceOnDay5       BalanceOnDay6       BalanceOnDay7\nABC1            123             10                  NULL            NULL                NULL                NULL                NULL                NULL                3\n</code></pre>\n\n<p>Please suggest!</p>\n"}]}
{"total":21073,"page":7,"pagesize":100,"questions":[{"tags":["sql","sql-server","sql-server-2008","tsql","pivot"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":76,"score":3,"question_id":13072744,"title":"SQL Server PIVOT with multiple X-axis columns","body":"<p>Take the following example data:</p>\n\n<pre><code>Payroll Forname Surname Month   Year    Amount\n0000001 James   Bond    3       2011    144.00\n0000001 James   Bond    6       2012    672.00\n0000001 James   Bond    7       2012    240.00\n0000001 James   Bond    8       2012    1744.50\n0000002 Elvis   Presley 3       2011    1491.00\n0000002 Elvis   Presley 6       2012    189.00\n0000002 Elvis   Presley 7       2012    1816.50\n0000002 Elvis   Presley 8       2012    1383.00\n</code></pre>\n\n<p>How would i PIVOT this on the Year + Month (eg: 201210) but preserve Payroll, Forename &amp; Surname as seperate columns, for example, the above would become:</p>\n\n<pre><code>Payroll Forename    Surname 201103  201206  201207  201208\n0000001 James       Bond    144.00  672.00  240.00  1744.50\n0000002 Elvis       Presley 1491.00 189.00  1816.50 1383.00\n</code></pre>\n\n<p>I'm assuming that because the Year + Month names can change then i will need to employ dynamic SQL + PIVOT - i had a go but couldnt even get the code to parse, nevermind run - any help would be most appreciated!</p>\n\n<p>Edit: What i have so far:</p>\n\n<pre><code>    INSERT  INTO #tbl_RawDateBuffer\n            ( PayrollNumber ,\n              Surname ,\n              Forename ,\n              [Month] ,\n              [Year] ,\n              AmountPayable\n            )\n            SELECT  PayrollNumber ,\n                    Surname ,\n                    Forename ,\n                    [Month] ,\n                    [Year] ,\n                    AmountPayable\n            FROM    RawData\n            WHERE   [Max] &gt; 1500\n\n\nDECLARE @Columns AS NVARCHAR(MAX)\nDECLARE @StrSQL AS NVARCHAR(MAX) \n\nSET @Columns = STUFF((SELECT DISTINCT\n                                ',' + QUOTENAME(CONVERT(VARCHAR(4), c.[Year]) + RIGHT('00' + CONVERT(VARCHAR(2), c.[Month]), 2))\n                      FROM      #tbl_RawDateBuffer c\n    FOR              XML PATH('') ,\n                         TYPE \n            ).value('.', 'NVARCHAR(MAX)'), 1, 1, '') \n\nSET @StrSQL = 'SELECT PayrollNumber, ' + @Columns + ' from \n            (\n                select PayrollNumber\n                    , CONVERT(VARCHAR(4), [Year]) + RIGHT(''00'' + CONVERT(VARCHAR(2), [Month]), 2) dt\n                from #tbl_RawDateBuffer\n           ) x\n            pivot \n            (\n                sum(AmountPayable)\n                for dt in (' + @Columns + ')\n            ) p '\n\n\nEXECUTE(@StrSQL)\n\nDROP TABLE #tbl_RawDateBuffer\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":33,"score":-1,"question_id":13073449,"title":"SQL statement to return attendance data within a given date range","body":"<p>I wanna create a SQL statement that returns the attendance data for employees related to a pre-defined work shift. I have a 2 pre-defined work shifts the first one start at 08:00 AM and ends at 04:00 PM on the same day the other work shift start at 06:30 PM on a day and ends at 08:00 AM on the next day. Here's the structure of the tables from which the attendance data will be returned</p>\n\n<ul>\n<li>HR_Employee_Personal_Info: <code>[Employee ID], [Employee Name]</code></li>\n<li>HR_Employee_Job_Info: <code>[Employee ID], [Job Title], [Shift ID]</code></li>\n<li>HR_Attend_And_Leave_Of_Staff: <code>[Employee ID], [Verify Mode], [In/Out Mode],[Date],[Time]</code>    </li>\n</ul>\n\n<p>The verify mode has only value 1 for fingerprint and value 15 for face, the In/Out Mode only value 0 means attend state or 1 means leave state</p>\n\n<p>I will show with a sample data what exactly what I want</p>\n\n<p>Lets say that I have such data in tables</p>\n\n<ul>\n<li><code>HR_Employee_Personal_Info:</code></li>\n<li><code>[Employee ID]: 1, 2, 3 and 4</code></li>\n<li><p><code>[Employee Name]: Amr Mohammed, Ahmed Nabil, Ahmed Mohammed, Raafat Jodh</code></p></li>\n<li><p><code>HR_Employee_Job_Info</code></p></li>\n<li><code>[Employee ID]: 1, 2, 3 and 4</code></li>\n<li><code>[Job Title]: IT Admin, SW Developer, Accountant, Project Manager</code></li>\n<li><p><code>[Shift ID] 1, 1, 1 and 1</code>(1 for each of the 4 record)</p></li>\n<li><p>`HR_Attend_And_Leave_Of_Staff: [Employee ID], [Verify Mode], [In/Out Mode], [Date],[Time]</p></li>\n<li>`The first record will be: 1, 1, 0, 2012-09-18, 07:00</li>\n<li>The second record will be: 1, 1, 1, 2012-09-18, 16:00</li>\n<li>The third record will be: 2, 1, 0, 2012-09-18, 07:00</li>\n<li>The forth record will be: 3, 1, 1, 2012-09-18, 16:00</li>\n</ul>\n\n<p>NOTE: The 4 employees works in the same work shift, shift 1.</p>\n\n<p>You can see in the above sample data employee number 4 have no records in the table of the attendance. So I want the SQL statements returns me the data in such way</p>\n\n<pre><code>[Employee ID], [Employee Name], [Job tite], [A_Date], [A_time], [L_Date], [L_Time]\n</code></pre>\n\n<p>The first record  returned will be</p>\n\n<pre><code>1, Amr Mohammed, IT Admin, 2012-09-18, 07:00 AM, 2012-09-18, 04:00 PM\n</code></pre>\n\n<p>The second record returned will be</p>\n\n<pre><code>2, Ahmed Nabil, SW Developer, 2012-09-18, 07:00 AM, 2012-09-18, NULL \"He has no leave record \n</code></pre>\n\n<p>that date note the records within the attendance table above\"</p>\n\n<p>The third record returned will be </p>\n\n<pre><code>3, Ahmed Mohmmed, Accountant, 2012-09-18, NULL, 2012-09-18, 04:00 PM \"He has no attend record that date note the records within the attendance table above\"\n</code></pre>\n\n<p>The forth record returned will be</p>\n\n<pre><code>4, Raafat Jodh, Project Manager, 2012-09-18, NULL, 2012-09-18, NULL \"He has no records at all within the attendance table however he is working at the shift 1\".\n</code></pre>\n\n<p>So every one who is working in shift 1 his code, name, job title will be returned in by the desired SQL statements with NULL values at [A_time], [L_time] if has no record in the HR_Attend_And_Leave_Of_Staff</p>\n\n<p>I want to give a range of dates to retrieve all attendance data within that range. The above data only with date 2012-09-18 but if I selected the range starts at 2012-09-18 and ends at 2012-09-20 the data becomes with the dates 2012-09-18, 2012-09-19 and 2012-09-20 respectively.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13071566,"title":"Derived Tables vs. Correlated subquery in HAVING clause SQL Server 2008","body":"<p>In this example I've only got two tables with which I'm working.  I was checking to see which might run faster and the execution plans were identical.  The purpose of these queries is to find the minimum date associated with one record that's larger than the maximum date of another.  The first query is more concise (although it doesn't allow the <code>DATEDIFF</code> column the second one does).  I feel like writing a query the second way will, in the long run, be more costly performance wise, perhaps when I have many joins.  Are there any general rules about which method, or is it a case by case scenario and you let the optimizer work it out?  </p>\n\n<p>first</p>\n\n<pre><code>select c.patid,min(c.admitDate) as minDiabetesDate\n    from clm_extract as c\n    inner join icdClm as ic on ic.clmid=c.clmid\n    where ic.icd like '250%' \n    group by c.patid\n    having min(c.admitdate) &gt; \n    (\n        select MAX(c2.admitDate) as maxPreDiabetesDate\n            from clm_extract as c2\n            inner join icdClm as ic2 on ic2.clmid = c2.clmid\n            where ic2.icd ='79029' and c2.patid=c.patid\n            group by c2.patid\n    )\n</code></pre>\n\n<p>second </p>\n\n<pre><code>select distinct x.patid,x.minDiabetesDate,y.maxPreDiabetesDate \nfrom\n(   \n\nselect c.patid, min(c.admitdate) as minDiabetesDate\n    from clm_extract as c \n    inner join icdClm as ic on ic.clmid=c.clmid\n    where ic.icd like '250%'\n    group by c.patid\n)x\ninner join \n(\nselect c2.patid, MAX(c2.admitdate) as maxPreDiabetesDate\n    from clm_extract as c2\n    inner join icdClm as ic2 on ic2.clmid=c2.clmid\n    where ic2.icd ='79029'\n    group by c2.patid\n)y on x.patid=y.patid\ngroup by x.minDiabetesDate,y.maxPreDiabetesDate,x.patid\nhaving DATEDIFF(dd,y.MaxPreDiabetesDate,x.minDiabetesDate) &gt; 0\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","full-text-search"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":246,"score":3,"question_id":8011044,"title":"Contains() function falters with strings of numbers?","body":"<p>For some background information, I'm creating an application that searches against a couple of indexed tables to retrieve some records. It isn't overtly complex to the point of say Google, but it's good enough for the purpose it serves, barring this strange issue. </p>\n\n<p>I'm using the <code>Contains()</code> function, and it's going very well, except when the search contains strings of numbers. Now, I'm only passing in a string -- nowhere numerical datatypes being passed in -- only characters. We're searching against a collection of emails, each appended with a custom ID when shot off from a workflow. So while testing, we decided to search via number strings. </p>\n\n<p>In our test, we isolated a number <code>0042600006</code>, which belongs to one and only one email subject. However, when using our query we are getting results for <code>0042600001</code>, <code>0042600002</code>, etc. The query is this as follows (with some generic columns standing in):</p>\n\n<p><code>SELECT description, subject FROM tableA WHERE CONTAINS((subject), '0042600006')</code></p>\n\n<p>We've tried every possible combination: <code>'0042600006*'</code>, <code>'\"0042600006\"'</code> and <code>'\"0042600006*\"'</code>. </p>\n\n<p>I think it's just a limitation of the function, but I thought this would probably be the best place for answers. Thanks in advance. </p>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":32,"score":3,"question_id":13070992,"title":"inserting into A errors because of a foreign key contraint issue","body":"<p>Can someone help explain this to me and resolve it?</p>\n\n<p><a href=\"http://sqlfiddle.com/#!6/2adc7/9\" rel=\"nofollow\">http://sqlfiddle.com/#!6/2adc7/9</a></p>\n\n<p><strong>The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_tblMobileForms_tblForms\". The conflict occurred in database \"db_6_2adc7\", table \"dbo.tblForms\", column 'fm_id'.: insert into tblMobileForms(fm_name) values ('lol')</strong></p>\n\n<p>My schema has the ID from tblMobileForms be a foreign key to tblForms.fm_id</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5852,"score":0,"question_id":4659019,"title":"Out of Memory exception in SQL 2008","body":"<p>am getting an exception Out of Memory exception in SQL 2008 when i try to execute large amount of file in sqlserver2008.. its very urgent, is there any solution pls help me..</p>\n\n<p>I am trying to execute a large query in SQL server 2008 which inserts thousands of rows into a table.</p>\n\n<p>The exception which comes when executing this is \"System.OutOfMemoryException\".</p>\n"},{"tags":["sql-server-2008","auto-increment"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":4,"view_count":165,"score":-3,"question_id":9381240,"title":"Identity Increment","body":"<p><strong>I am combining 2 tables into 1, by using the following statements</strong> </p>\n\n<pre><code>Select Calls.*,Patient.*\nINTO Calls2\nFrom Calls,Patient\n</code></pre>\n\n<p>Now, i set one of the column as primary key but I cant get that primary key to have Identity Increment.\nWhat should i do to do this?</p>\n\n<p>Thanks in advance,\nMadhu</p>\n"},{"tags":["sql-server-2008","statistics","sql-server-2008-r2"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":136,"score":0,"question_id":10699239,"title":"Statistical Process Control Charts in SQL Server 2008 R2","body":"<p>I'm hoping you can point me in the right direction.</p>\n\n<p>I'm trying to generate a control chart (<a href=\"http://en.wikipedia.org/wiki/Control_chart\" rel=\"nofollow\">http://en.wikipedia.org/wiki/Control_chart</a>) using SQL Server 2008. Creating a basic control chart is easy enough. I'd just calculate the mean and standard deviations and then plot them.</p>\n\n<p>The complex bit (for me at least) is that I would like the chart to reset the mean and the control limits when a step change is identified.</p>\n\n<p>Currently I'm only interested in a really simple method of identifying a step change, 5 points appearing consecutively above or below the mean. There are more complex ways of identifying them (<a href=\"http://en.wikipedia.org/wiki/Western_Electric_rules\" rel=\"nofollow\">http://en.wikipedia.org/wiki/Western_Electric_rules</a>) but I just want to get this off the ground first.</p>\n\n<p>The process I have sort of worked out is:</p>\n\n<ol>\n<li>Aggregate and order by month and year, apply row numbers.</li>\n<li>Calculate overall mean</li>\n<li>Identify if each data item is higher, lower or the same as the mean, tag with +1, -1 or 0.</li>\n<li>Identify when their are 5 consecutive data items which are above or below the mean (currently using a cursor).</li>\n<li>Recalculate the mean if 5 points are above or 5 points are below the mean.</li>\n<li>Repeat until end of table.</li>\n</ol>\n\n<p>Is this sort of process possible in SQL server? It feels like I maybe need a recursive UDF but recursion is a bit beyond me!</p>\n\n<p>A nudge in the right direction would be much appreciated!</p>\n\n<p>Cheers</p>\n"},{"tags":["c#","sql-server-2008","c#-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":98,"score":2,"question_id":13069338,"title":"DateTimeFormat issue when pass the parameter to MS-Sql stored procedure","body":"<p>I have a stored procedure, which has a parameter like <code>@CurrentDate datetime</code>, when I pass the value <code>DateTime.Now</code> from the front end <em>(C#)</em> to this stored procedure it is working fine.</p>\n\n<p>But when I change the <em>Date Format</em> as <code>English(India)</code> in my system/server, that time <code>DateTime.Now</code> will return a value like <code>25-10-2012 PM 05:23:27</code>. I am passing this value to stored procedure and I'm getting an error message like the following,</p>\n\n<pre><code>Msg 242, Level 16, State 3, Line 10\nThe conversion of a varchar data type to a datetime data type resulted in an out-of-range value.\n</code></pre>\n\n<p>Note : I don't want to use <code>GETDATE()</code> from Sqlserver, I want to pass the parameter from c#.</p>\n\n<p>How can I solve this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13069084,"title":"How to configure alert and kill longrunning queries in SQL Profiler","body":"<p>is there anyway i can configure alert and kill long running queries using SQL Profiler or someithing in Management Studios ? </p>\n"},{"tags":["c#","sql-server-2008","reporting-services","registry","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13069073,"title":"How to check SQL Server Reporting Services configuration status?","body":"<p>I am writing an installation automation program for SQL Server, while upgrading default instance <code>MSSQLSERVER</code> of SQL Server 2008 to SQL Server 2012, I need to check Reporting Services Configuration status.</p>\n\n<p>Using registry there is possibility to check whether the Reporting Service is instaleld. But I am not getting any clue to check the configuration status of Reporting Services.</p>\n\n<p>Please let me know, if you have any idea on how to check the Configuration Status of Reporting Services.</p>\n"},{"tags":["sql-server-2008","database-backups"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13066710,"title":"SQL database has very small backup","body":"<p>I have a database of 216 GB. 75% is used by data, the rest is used by Index and Log. When I check free space in the database files I get values around 300 MB. The database is split over 3 data files. When I take a full backup without compression I get a backup of 38 GB. </p>\n\n<p>Can anyone explain this? Can I recover any disk space from the database?</p>\n\n<p>Update: If I try to restore the backup it requires over 200 GB of diskspace.</p>\n"},{"tags":["database","sql-server-2008","stored-procedures","metadata"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":161,"score":3,"question_id":7338418,"title":"How to find stored procedures by name?","body":"<p>I just need to search through all the stored procedures on my database looking for one that contains \"item\" in its name. Any ideas?</p>\n\n<p>I've been tinkering around with this, but it's not quite there yet:</p>\n\n<pre><code>SELECT DISTINCT OBJECT_NAME(ID) FROM SysComments WHERE Text LIKE '%Item%'\n</code></pre>\n"},{"tags":["sql","sql-server-2008","coldfusion","coldfusion-8"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":65,"score":3,"question_id":13066828,"title":"Adding Select All to dropdown","body":"<p>This is my query:</p>\n\n<pre><code> &lt;cfquery name=\"qry\" datasource=\"#variables.staffDs#\"&gt;\n  SELECT\n    firstname + ' ' + surname name, userid, mobileno, extension\n  FROM\n    currentstaff\n  WHERE\n    (mobileno IS NOT NULL OR\n     Left(LTrim(extension), 2) = '07')\n &lt;/cfquery&gt;\n</code></pre>\n\n<p>This is my ColdFusion dropdown box:</p>\n\n<pre><code>  &lt;select name=\"to\" id=\"to\"&gt;\n  &lt;option value=\"\"&gt; -- Select -- &lt;/option&gt;\n  &lt;option style=\"font-weight: bold\" value=\"\"&gt;Send to All&lt;/option&gt;\n  &lt;cfoutput query=\"people\"&gt;\n    &lt;option value=\"#qry.userid#\"&gt;#qry.name#&lt;/option&gt;\n  &lt;/cfoutput&gt;\n  &lt;/select&gt;\n</code></pre>\n\n<p>The names of all people are displayed in the dropdown box list.</p>\n\n<p>What I'd like to do is add an option at the top of the dropdown box to 'Sent to All' to select all users and I'm not sure how to do this.</p>\n\n<p>I'd like to incorporate any extra SQL I might need into my current query, if this is necessary.</p>\n"},{"tags":["php","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":44,"score":-2,"question_id":13065256,"title":"PHP Version 5.3.4 MSSQL 2008 R2 not connecting Warning: mssql_connect() [function.mssql-connect]: Unable to connect to server: 12.1.1.1\\SQLEXPRESS in","body":"<p>PHP Version 5.3.4 (windows)\nMSSQL 2008 R2</p>\n\n<p>Connecting with MSSQL server.</p>\n\n<pre><code>// Connect to MSSQL\n$server = \"12.1.1.1\"; \n$link = mssql_connect($server, 'username', 'password');\nif (!$link) {\n    die('Something went wrong while connecting to MSSQL');\n}\n</code></pre>\n\n<blockquote>\n  <p>Warning: mssql_connect() [function.mssql-connect]: Unable to connect\n  to server: 12.1.1.1\\SQLEXPRESS in.</p>\n</blockquote>\n\n<p>I have enabled php_mssql (thorugh wamp panale), i have cross verified php ext folder, php_mssql.dll available there.</p>\n\n<p>should install any thing other than mentioned above items. </p>\n\n<p><strong>Solution for the above problem:</strong></p>\n\n<p>php connected with mssql.</p>\n\n<p>PHP Version 5.3.4 &amp; MSSQL SQL SERVER 2008 R2</p>\n\n<ul>\n<li>Below steps i followed:\n<ol>\n<li>Enabled php_mssql.dll.</li>\n<li>Download this file <a href=\"http://www.mdome.org/wp-content/uploads/2011/05/ntwdblib.zip\" rel=\"nofollow\">Click here</a> Overrite the ntwdblib.dll into C:\\Documents and Settings\\manikandanj\\wamp\\bin\\php\\php5.3.4</li>\n<li>I have tried below code</li>\n</ol></li>\n</ul>\n\n<blockquote>\n<pre><code>//Connect to MSSQL\n$con = mssql_connect($server, 'uname', 'password');\n\nif (!$con) {\n    die('Something went wrong while connecting to MSSQL');\n}\n</code></pre>\n</blockquote>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":4,"up_vote_count":3,"down_vote_count":0,"view_count":4774,"score":3,"question_id":7670636,"title":"How to decrypt stored procedure in SQL Server 2008","body":"<p>I have one stored procedure which is encrypted using WITH ENCRYPTION option. Now I want to decrypt that procedure. I have already tried SP \"Decryptsp2K\" which is given for SQL 2000 in this forum :</p>\n\n<p><a href=\"http://forums.asp.net/t/1516587.aspx/1\" rel=\"nofollow\">http://forums.asp.net/t/1516587.aspx/1</a></p>\n\n<p>But it deletes my SP, not decrypt. Can any one guide me ?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c#","sql-server-2008","sqldependency"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":373,"score":1,"question_id":10951645,"title":"SQL Server 2008 R2 DeadLock on query Notification (SqlDependency)","body":"<p>I'm running into a deadlock issue on a SQL Server 2008 R2. When looking at the deadlock graph in the SQL Profiler, the problem seems to stem from query notifications : </p>\n\n<pre><code>  &lt;resource-list&gt;\n   &lt;keylock hobtid=\"72057654759522304\" dbid=\"6\" objectname=\"MyDB.sys.query_notification_814081939\" indexname=\"cidx\" id=\"lock15ab2aa80\" mode=\"RangeX-X\" associatedObjectId=\"72057654759522304\"&gt;\n    &lt;owner-list&gt;\n     &lt;owner id=\"process5c5708\" mode=\"RangeX-X\"/&gt;\n    &lt;/owner-list&gt;\n    &lt;waiter-list&gt;\n     &lt;waiter id=\"process4e9ae08\" mode=\"RangeS-U\" requestType=\"wait\"/&gt;\n    &lt;/waiter-list&gt;\n   &lt;/keylock&gt;\n   &lt;keylock hobtid=\"72057654759522304\" dbid=\"6\" objectname=\"MyDB.sys.query_notification_814081939\" indexname=\"cidx\" id=\"lock15e56a300\" mode=\"RangeS-U\" associatedObjectId=\"72057654759522304\"&gt;\n    &lt;owner-list&gt;\n     &lt;owner id=\"process4e9ae08\" mode=\"RangeS-U\"/&gt;\n    &lt;/owner-list&gt;\n    &lt;waiter-list&gt;\n     &lt;waiter id=\"process5c5708\" mode=\"RangeS-U\" requestType=\"wait\"/&gt;\n    &lt;/waiter-list&gt;\n   &lt;/keylock&gt;\n  &lt;/resource-list&gt;\n</code></pre>\n\n<p>These query notifications are implemented using SQLDependency. \nThe deadlock seems to be occuring when updating a table which is monitored by the SQLDependency.</p>\n\n<p>I don't really understand the deadlock graph syntax..The KeyLock mode is RangeS-U <a href=\"http://msdn.microsoft.com/en-us/library/ms191272%28v=sql.105%29.aspx\" rel=\"nofollow\">only while using the serializable transaction isolation level.</a>, right ? </p>\n\n<p>I've also read this <a href=\"http://stackoverflow.com/questions/446729/sql-server-2005-key-range-locks-in-read-committed-transaction-isolation-level\">question</a>... should i activate READ_COMMITED_SNAPSHOT ?</p>\n\n<p>thx...</p>\n"},{"tags":["xml","sql-server-2008","tsql","xml-parsing"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13065440,"title":"Extract keys and values from XML in a SQL Server stored procedure","body":"<p>I receive XML data like</p>\n\n<pre><code>&lt;t&gt;\n  &lt;ID&gt;8&lt;/ID&gt;\n  &lt;FirstName&gt;name 8&lt;/FirstName&gt;\n  &lt;LastName&gt;surname 8&lt;/LastName&gt;\n  &lt;DateOfBirth&gt;1963-05-23T00:00:00&lt;/DateOfBirth&gt;\n&lt;/t&gt;\n</code></pre>\n\n<p>In a SQL Server stored procedure. There are different xml data formats (the field numbers and field names can differ). Now, I should extract each field and it value and insert each field/value as a separate record in a table. </p>\n\n<p>Are there examples how I can do this with TSQL?</p>\n"},{"tags":["sql-server-2008","datetime"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13065340,"title":"Using a 'date' data type in SQL Server Management Studio 2008","body":"<p>I have a database with existing data that uses the datetime field which is a timestamp that uses date and time.</p>\n\n<p>I want to just store the date, not the time, as the time is never used anyway but due to the way the app works it is causing inconsistencies when reporting on the data.</p>\n\n<p>I believe there is a 'date' data type using the Design view on my table but when I tried to use that it said invalid data type. I also can't do this using the ALTER TABLE syntax in SQL.</p>\n\n<p>Because it's live data, I don't want to make too many changes that might cause problems. We have a demo system that I can play around with though.</p>\n"},{"tags":["c#","asp.net","database","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":59,"score":0,"question_id":13063705,"title":"exception error handling","body":"<p><img src=\"http://i.stack.imgur.com/Tuee5.png\" alt=\"enter image description here\"></p>\n\n<p>i am having this error in the image above whenever i want to book a flight in my airline reservation system project there is an exception error in my code this error message was popping up </p>\n\n<p><code>IndexOutOfRangeException unhandles by user code</code> </p>\n\n<p>...any ideas on how i can go about it my code is written in asp.net using c sharp??</p>\n\n<p>this is code</p>\n\n<pre><code>public partial class TICKET_BOOKING : System.Web.UI.Page\n{\n    protected void Page_Load(object sender, EventArgs e)\n    {\n\n    }\n    int a;\n    String constring = ConfigurationManager.ConnectionStrings[\"conn\"].ConnectionString.ToString();\n    public int Autonumber()\n    {\n        SqlConnection con = new SqlConnection(constring);\n        SqlCommand cmd = new SqlCommand();\n        cmd.CommandType = CommandType.Text;\n        cmd.Connection = con;\n        con.Open();\n        cmd.CommandText = \"select pid from pid\";\n        SqlDataAdapter da = new SqlDataAdapter();\n        DataSet ds = new DataSet();\n        DataTable dt = new DataTable();\n        da.SelectCommand = cmd;\n        da.Fill(dt);\n        a = Convert.ToInt32(dt.Rows[0][0].ToString()) + 1; //this is where its occuring\n        con.Close();\n        return a;\n    }\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13060782,"title":"SUM() data in a column based on another column data","body":"<p>I have a sql table </p>\n\n<pre><code>Project ID       Employee ID          Total Days\n\n1                   100                   1\n1                  100                   1\n1                  100                   2\n1                   100                   6\n1                   200                   8\n1                   200                   2\n</code></pre>\n\n<p>Now i need this table to look like</p>\n\n<pre><code>Project ID       Employee ID          Total Days\n\n1                   100                   10\n1                   200                   10\n</code></pre>\n\n<p>As iam new to sql,i am little confuse to use SUM() based on above condition.</p>\n"},{"tags":["sql-server","sql-server-2008","maintenance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13063887,"title":"how to disconnect all logged users in sql server except sa?","body":"<p>speI would like to disconnect all users from sql server except sa.</p>\n\n<p>THe need for this is:</p>\n\n<p>I wrote a dB maintenance utility for my ERP. Before running it I need to ask all users to logoff.\nSo somehow I would like to give them a message (through ERP) \"disconnecting in 5 minutes, please save your work and logoff or you'll be kicked out\" and then after 5 minutes run the command on the server that disconnects all people.\nI want \"sa\" or anyway \"1 specific user\" not to be disconnected, since th dbmaintenance utilty will user that user for db connection.</p>\n\n<p>I found this:</p>\n\n<pre><code>use master\nalter database MyDatabase set offline with rollback immediate\n</code></pre>\n\n<p>but how to say \"one specific user is an exception\"?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","window-functions"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":61,"score":2,"question_id":13061336,"title":"How to calculate the mode for each value in another column in TSQL","body":"<p>I have a table like this:</p>\n\n<pre><code>ID   Group  Gender\n------------------\n1    A      M\n2    A      M\n3    A      F\n4    A      M\n5    A      U\n6    B      F\n7    B      F\n8    B      M\n9    C      U\n10   C      F\n11   C      U\n</code></pre>\n\n<p>I am trying to calculate the <strong>mode group</strong> for each gender. In other words, for each gender, tell me which is the most popular group.  So the results I want would be as follows:</p>\n\n<pre><code>Gender  ModeGroup\n-----------------\nM       A          (because 3 males in group A, 1 in B and 0 in C)\nF       B          (because 2 females in group B, 1 in A and 1 in C)\nU       C          (because 2 unknown in group C, 0 in B and 1 in C)\n</code></pre>\n\n<p>In the case of a tie, I need a record returned for each of the tied groups.</p>\n\n<p>How can I do this elegantly in TSQL?  I think I need to use a window function, but I've  been struggling with how to go about it.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":11869727,"title":"Inner Join Delete in SQL Server 2008?","body":"<p>I am trying to join 2 tables together and do a delete on it.</p>\n\n<pre><code>DELETE TableA \nFROM TableA a\nINNER JOIN\nTableB b on b.Id = a.Id\nwhere title like 'test' \n</code></pre>\n\n<p>The above is what I come up with however I keep getting </p>\n\n<blockquote>\n  <p><em>The DELETE statement conflicted with the REFERENCE constraint</em></p>\n</blockquote>\n\n<p>I thought if I merge the 2 tables together then I will delete both at the same time and no constraints would be conflicted. </p>\n\n<p>Am I missing something in my query?</p>\n"},{"tags":["sql","database","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":91,"score":3,"question_id":11560713,"title":"Generate insert script for selected records?","body":"<p>I have a table with the following data:</p>\n\n<pre><code>Pk_Id  ProductName           Fk_CompanyId       Price\n------------------------------------------------------\n1      AMX                   1                  10.00\n2      ABC                   1                  11.00\n3      APEX                  1                  12.00\n4      AMX                   1                  10.00\n5      ABC                   1                  11.00\n6      APEX                  1                  12.00\n7      AMX                   2                  10.00\n8      ABC                   2                  11.00\n9      APEX                  2                  12.00\n</code></pre>\n\n<p>I want to generate Insert script for migrating records whose Fk_CompanyId is 1.</p>\n\n<p>There is an insert script option to generate script for all records but I want to filter some records to migrate to another database.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":3306,"score":2,"question_id":7515110,"title":"Create SQL INSERT Script with values gathered from table","body":"<p>I need to create a INSERT script in order to insert iin another database the same data.<br/> If in SQL Server I select \"Script table as > INSERT To\" I can easily recreate the skeleton for the INSERT statement. However since I have a several records to migrate, I would prefer to avoid having to insert the values manually.</p>\n\n<p><strong>Therefore is there any way to \"automatically\" get the INSERT script with also the values (coming from the target table) filled in?</strong> <br/>\nI know this could be done with SSIS, but I am wondering whether it would be possible as well with a quicker solution.</p>\n"},{"tags":["sql-server-2008","ssrs-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13060984,"title":"SQL Server Report Services Not Configuring","body":"<p>Ok this is kind of Frustrating... I think/know I am doing everything right... However SQL Server Reporting Services cannot be configured:</p>\n\n<p><strong>To Configure I did these following steps</strong></p>\n\n<ol>\n<li>Opened Reporting Services Configuration Manager</li>\n<li>Click Connect</li>\n<li><p>Clicked Web Services URL <br> </p>\n\n<ul>\n<li>Here (first) I just used the default values (just giving a different Name)</li>\n<li>Then I tried to configure by using the Host Header</li>\n<li>Clicked Advance Gave Host Header a Name from DNS something like (rs.constoso.com)</li>\n<li>Removed \"All assigned listener\"</li>\n</ul></li>\n<li><p>I Change the Database </p>\n\n<ul>\n<li>Created a new report database</li>\n<li>connected to database server</li>\n<li>used both Sharepoint Mode (cause eventually that is what I am trying to do) and the native mode.</li>\n</ul></li>\n<li><p>However no matter what I do the reporting service seems to not respond. When I click the Web Service URL it says the Reporting Service has some Error.</p></li>\n</ol>\n\n<p>I am not sure what am I doing wrong (is there something I am forgetting somewhere?)</p>\n\n<p>My System:</p>\n\n<ol>\n<li>Windows Server 2008 R2</li>\n<li>SQL server 2008</li>\n<li>Has Sharepoint 2010 installed</li>\n</ol>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1376,"score":3,"question_id":5180256,"title":"Create assembly from System.Web in SQL Server","body":"<p>Hi I have following problem:</p>\n\n<p>I need to create an assembly in SQL Server database from <code>system.web.dll</code> with following script:</p>\n\n<pre><code>CREATE ASSEMBLY SystemWeb \nFROM 'C:\\WINDOWS\\MICROSOFT.NET\\FRAMEWORK\\V2.0.50727\\SYSTEM.WEB.DLL' \nWITH PERMISSION_SET = UNSAFE\n</code></pre>\n\n<p>At fist cannot create because I retrieve some error because don't find some dependencies dll.</p>\n\n<p>I start to install first the dependencies like system.drawing.dll an so on without problem but when I'm trying to install <code>system.web.dll</code> it require <code>System.EnterpriseServices.dll</code> that require <code>System.Runtime.Remoting.dll</code> that require <code>System.Web</code> and here I'm inside a circle and cannot go OUT.</p>\n\n<p>Somebody can help to resolve it?</p>\n\n<p>Windows Server 2008 / SQL Server 2008 Enterprise</p>\n\n<p>Thank you a lot in advance</p>\n"},{"tags":["sql-server","sql-server-2008","memory-consumption"],"answer_count":4,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":16762,"score":2,"question_id":856575,"title":"SQL Server 2008 takes up a lot of memory?","body":"<p>I am conducting stress tests on my database, which is hosted on SQL Server 2008 64-bit running on a 64-bit machine with 10 GB of RAM.</p>\n\n<p>I have 400 threads. Each thread queries the database every second, but the query time does not take time, as the SQL profiler says that, but after 18 hours SQL Server uses up 7.2 GB of RAM and 7.2 GB of virtual memory.</p>\n\n<p>Is this normal behavior? How can I adjust SQL Server to clean up unused memory?</p>\n"},{"tags":["sql-server-2008","tsql","linked-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13060294,"title":"Pragmatically check for existing login for a linked server","body":"<p>I'm writing an admin script I can use for creating linked servers. The script does a <code>IF EXISTS</code> check on the linked server before creating, this works fine.</p>\n\n<p>I have added the <code>sp_addlinkedsrvlogin</code> details to the script to generate the appropriate permissions to access the linked server.</p>\n\n<p>When I try to re-run thescript again it throws the error:</p>\n\n<blockquote>\n  <p>Msg 15190, Level 16, State 1, Procedure sp_dropserver, Line 56 There\n  are still remote logins or linked logins for the server\n  'LinkedServerName'.</p>\n</blockquote>\n\n<h2>So my question is:</h2>\n\n<p><strong>What is the specific code to check for existence of a login for a linked server?</strong></p>\n\n<p>This will allow me to conditionally <code>EXEC sp_droplinkedsrvlogin</code> before issuing the conditional <code>EXEC sp_dropserver</code></p>\n\n<p><br/></p>\n\n<hr>\n\n<p>Code as it stands now:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>-- Set to master\n    USE master\n    GO\n\n-- Set linked server vars\n    DECLARE\n        @ServerName         varchar(max)    =   'Server Name'       -- Name you wish to give to the Linked Server connection. To remove ambiguity you can name this the same as the Data Source you are connecting to.\n        ,@ProductName       nvarchar(128)   =   'Product Name'      -- Type of OLE DB product you are connecting too, i.e. Oracle or SQL Server, e.g. SQl Server = N'MSSQL'.\n        ,@ProviderName      nvarchar(128)   =   'Provider Name'     -- The OLE DB provider is expected to be registered with the specified PROGID in the registry, e.g. SQL Server = N'SQLNCLI'.\n        ,@DataSource        nvarchar(4000)  =   'Source Name'       -- Is the name of the data source as interpreted by the OLE DB provider, i.e. the actual server name if connecting to MS SQL Server.\n        ,@Location          nvarchar(4000)  =   'Location'          -- Not really worth using, listed for compelteness according to Reference 1 Location.           \n        ,@ProviderString    nvarchar(4000)\n        ,@CatalogName       nvarchar(4000)  =   'Database Name'     -- (Optional) Name of the database/catalog you will connect to. \n    SET\n        @ProviderString =   'PROVIDER=SQLOLEDB; SERVER=' + @ServerName\n\n-- Set linked server login vars\n    DECLARE\n        @Useself            varchar(8)      =   'Option'            -- 'TRUE' or 'FALSE' or NULL. Determines whether to connect to @rmtsrvname\\@ServerName by impersonating local logins or explicitly submitting a login and password.\n        ,@LocalLogin        varchar(100)    =   'Domain\\Login'      -- Domain account.\n        ,@User              varchar(50)     =   'SQL user'          -- Is the remote login used to connect to rmtsrvname when @useself\\@Useself is FALSE.\n        ,@Password          varchar(20)     =   'Password'          -- Is the password associated with @rmtuser\\@User.\n\n-- Drop linked server if already exists to prevent error when creating\n    IF  EXISTS\n        (\n            SELECT  *\n            FROM    sys.servers\n            WHERE   server_id   !=  0\n                    AND name    =   @ServerName\n        )  \n        EXEC    sp_dropserver\n                @ServerName\n\n-- Create linked server         \n    EXEC    sp_addlinkedserver  \n            @server         =   @ServerName\n            ,@srvproduct    =   @ProductName\n            ,@provider      =   @ProviderName\n            ,@datasrc       =   @DataSource\n            ,@location      =   @Location\n            ,@provstr       =   @ProviderString\n            ,@catalog       =   @CatalogName\n\n-- Add permissions for usage            \n    EXEC    sp_addlinkedsrvlogin \n            @rmtsrvname     =   @ServerName\n            ,@useself       =   @Useself\n            ,@locallogin    =   @LocalLogin\n            ,@rmtuser       =   @User\n            ,@rmtpassword   =   @Password\n</code></pre>\n\n<hr>\n\n<p>Answer accepted below. I also found that you can force logins to be dropped when dropping a linked server by passing the argument <code>,@droplogins = 'droplogins'</code> to the <code>EXEC sp_dropserver</code> proc:</p>\n\n<pre><code>IF  EXISTS\n    (\n        SELECT  1\n        FROM    sys.servers\n        WHERE   server_id   !=  0\n                AND name    =   @ServerName\n    )  \n    EXEC    sp_dropserver\n            @server         =   @ServerName\n            ,@droplogins    =   'droplogins'\n</code></pre>\n"},{"tags":["sql","nhibernate","sql-server-2008","fluent-nhibernate","time"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":591,"score":2,"question_id":6751185,"title":"How to deal with TIME datatype from SQL Server 2008 with NHibernate?","body":"<p>I am using the <code>TIME</code> datatype from SQL Server 2008 and I am having some problems getting it to work with NHibernate.</p>\n\n<pre><code>public TimeTableEventMap()\n{\n    Id(x =&gt; x.Id)\n    Map(x =&gt; x.Day).NvarcharWithMaxSize().Not.Nullable();\n    Map(x =&gt; x.StartTime).Length(4).TimeDataType().Not.Nullable();\n    Map(x =&gt; x.Endtime).Length(4).TimeDataType().Not.Nullable();\n    References(x =&gt; x.TimeTable).Not.Nullable().Cascade.All();\n    References(x =&gt; x.RequiredSettings).Not.Nullable().Cascade.All();\n}\n\n/// &lt;summary&gt;\n///  MS Sql 2008 date type.\n/// &lt;/summary&gt;\n/// &lt;param name=\"map\"&gt;&lt;/param&gt;\n/// &lt;returns&gt;&lt;/returns&gt;\npublic static PropertyPart TimeDataType(this PropertyPart map)\n{\n   return map.CustomSqlType(\"time\");\n}\n\npublic class TimeTableEvent\n{\n    public virtual int Id { get; private set; }\n    public virtual DayOfWeek Day { get; set; }\n    public virtual DateTime StartTime { get; set; }\n    public virtual DateTime Endtime { get; set; }\n    public virtual TimeTable TimeTable { get; set; }\n    public virtual RequiredSetting RequiredSettings { get; set; }\n}   \n</code></pre>\n\n<p>I get this error</p>\n\n<blockquote>\n  <p>NHibernate.Exceptions.GenericADOException was caught<br>\n  Message=could not execute query<br>\n  [ SELECT TOP (@p0) this_.TimeTableEventId as TimeTabl1_15_1_,\n  this_.Day as Day15_1_, this_.StartTime as StartTime15_1_,\n  this_.Endtime as Endtime15_1_, this_.TimeTableId as TimeTabl5_15_1_,\n  this_.RequiredSettingsId as Required6_15_1_,\n  requiredse2_.RequiredSettingsId as Required1_10_0_,\n  requiredse2_.BackgroundColor as Backgrou2_10_0_, requiredse2_.Title as\n  Title10_0_ FROM TimeTableEvents this_ inner join RequiredSettings\n  requiredse2_ on\n  this_.RequiredSettingsId=requiredse2_.RequiredSettingsId WHERE\n  this_.TimeTableId in (@p1) ]<br>\n  Positional parameters:  #0>14<br>\n  [SQL: SELECT TOP (@p0) this_.TimeTableEventId as TimeTabl1_15_1_,\n  this_.Day as Day15_1_, this_.StartTime as StartTime15_1_,\n  this_.Endtime as Endtime15_1_, this_.TimeTableId as TimeTabl5_15_1_,\n  this_.RequiredSettingsId as Required6_15_1_,\n  requiredse2_.RequiredSettingsId as Required1_10_0_,\n  requiredse2_.BackgroundColor as Backgrou2_10_0_, requiredse2_.Title as\n  Title10_0_ FROM TimeTableEvents this_ inner join RequiredSettings\n  requiredse2_ on\n  this_.RequiredSettingsId=requiredse2_.RequiredSettingsId WHERE\n  this_.TimeTableId in (@p1)]<br>\n  Source=NHibernate<br>\n  SqlString=SELECT TOP (@p0) this_.TimeTableEventId as\n  TimeTabl1_15_1_, this_.Day as Day15_1_, this_.StartTime as\n  StartTime15_1_, this_.Endtime as Endtime15_1_, this_.TimeTableId as\n  TimeTabl5_15_1_, this_.RequiredSettingsId as Required6_15_1_,\n  requiredse2_.RequiredSettingsId as Required1_10_0_,\n  requiredse2_.BackgroundColor as Backgrou2_10_0_, requiredse2_.Title as\n  Title10_0_ FROM TimeTableEvents this_ inner join RequiredSettings\n  requiredse2_ on\n  this_.RequiredSettingsId=requiredse2_.RequiredSettingsId WHERE\n  this_.TimeTableId in (@p1)</p>\n  \n  <p>StackTrace:<br>\n  at NHibernate.Loader.Loader.DoList(ISessionImplementor\n  session, QueryParameters queryParameters)<br>\n  at NHibernate.Loader.Loader.ListIgnoreQueryCache(ISessionImplementor\n  session, QueryParameters queryParameters)<br>\n  at NHibernate.Loader.Loader.List(ISessionImplementor\n  session, QueryParameters queryParameters, ISet<code>1 querySpaces, IType[]\n  resultTypes)<br>\n  at NHibernate.Loader.Criteria.CriteriaLoader.List(ISessionImplementor\n  session)<br>\n  at NHibernate.Impl.SessionImpl.List(CriteriaImpl criteria,\n  IList results)<br>\n  at NHibernate.Impl.CriteriaImpl.List(IList results)<br>\n  at NHibernate.Impl.CriteriaImpl.List[T]()<br>\n  at NHibernate.Criterion.QueryOver</code>1.ListU<br>\n  at NHibernate.Criterion.QueryOver`1.NHibernate.IQueryOver.ListU<br>\n  at TimeTableRepo.cs:line 47<br>\n  at TimeTableService.cs:line 43<br>\n  InnerException: System.FormatException<br>\n  Message=Input string '16:00:00' was not in the correct\n  format.<br>\n  Source=NHibernate<br>\n  StackTrace:<br>\n  at NHibernate.Type.DateTimeType.Get(IDataReader rs,\n  Int32 index)<br>\n  at NHibernate.Type.NullableType.NullSafeGet(IDataReader rs, String name)<br>\n  at NHibernate.Type.NullableType.NullSafeGet(IDataReader rs, String[]\n  names, ISessionImplementor session, Object owner)<br>\n  at NHibernate.Type.AbstractType.Hydrate(IDataReader\n  rs, String[] names, ISessionImplementor session, Object owner)<br>\n  at NHibernate.Persister.Entity.AbstractEntityPersister.Hydrate(IDataReader\n  rs, Object id, Object obj, ILoadable rootLoadable, String[][]\n  suffixedPropertyColumns, Boolean allProperties, ISessionImplementor\n  session)<br>\n  at NHibernate.Loader.Loader.LoadFromResultSet(IDataReader rs, Int32 i,\n  Object obj, String instanceClass, EntityKey key, String rowIdAlias,\n  LockMode lockMode, ILoadable rootPersister, ISessionImplementor\n  session)<br>\n  at NHibernate.Loader.Loader.InstanceNotYetLoaded(IDataReader dr, Int32 i,\n  ILoadable persister, EntityKey key, LockMode lockMode, String\n  rowIdAlias, EntityKey optionalObjectKey, Object optionalObject, IList\n  hydratedObjects, ISessionImplementor session)<br>\n  at NHibernate.Loader.Loader.GetRow(IDataReader rs,\n  ILoadable[] persisters, EntityKey[] keys, Object optionalObject,\n  EntityKey optionalObjectKey, LockMode[] lockModes, IList\n  hydratedObjects, ISessionImplementor session)<br>\n  at NHibernate.Loader.Loader.GetRowFromResultSet(IDataReader resultSet,\n  ISessionImplementor session, QueryParameters queryParameters,\n  LockMode[] lockModeArray, EntityKey optionalObjectKey, IList\n  hydratedObjects, EntityKey[] keys, Boolean returnProxies)<br>\n  at NHibernate.Loader.Loader.DoQuery(ISessionImplementor session,\n  QueryParameters queryParameters, Boolean returnProxies)<br>\n  at NHibernate.Loader.Loader.DoQueryAndInitializeNonLazyCollections(ISessionImplementor\n  session, QueryParameters queryParameters, Boolean returnProxies)<br>\n  at NHibernate.Loader.Loader.DoList(ISessionImplementor\n  session, QueryParameters queryParameters)<br>\n  InnerException: System.InvalidCastException<br>\n  Message=Unable to cast object of type\n  'System.TimeSpan' to type 'System.IConvertible'.<br>\n  Source=mscorlib  </p>\n</blockquote>\n\n<pre><code>public List&lt;TimeTableEvent&gt; GetTimeTableEvents(Student student, List&lt;int&gt; timeTableIds)\n{\n    TimeTableEvent tAlias = null;\n\n    List&lt;TimeTableEvent&gt; allEvents = session.QueryOver&lt;TimeTableEvent&gt;(() =&gt; tAlias)\n        .Where(Restrictions.In(Projections.Property(() =&gt; tAlias.TimeTable.Id), timeTableIds))\n        .Fetch(r =&gt; r.RequiredSettings).Eager\n        .TransformUsing(Transformers.DistinctRootEntity)\n        .Take(QueryLimits.TimeTableEvents)\n        .List&lt;TimeTableEvent&gt;().ToList();\n\n    return allEvents;\n}\n</code></pre>\n"},{"tags":["sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":168,"score":0,"question_id":12127592,"title":"SSIS Package Deployment Fails using Windows Auth across domains","body":"<p>Trying to deploy a package on my local PC and connected to my client's vpn.  </p>\n\n<p>I get the error:</p>\n\n<pre><code>c:\\Program Files\\Microsoft SQL Server\\110\\DTS\\Binn&gt;dtutil /File c:\\www\\clients\\SomeCompany\\ssis\\warehouse\\Warehous\ne_Update_Table1.dtsx /DestServer SomeServerName /Copy sql;Warehouse_Update_Table1\nMicrosoft (R) SQL Server SSIS Package Utilities\nVersion 10.50.1600.1 for 64-bit\n\n\nError (0xC0014014) while checking for the existence of package \"Warehouse_Update_Table1\" on SQL Server.\nCould not save package \"Warehouse_Update_Table1\" because of error 0x80004005.\nDescription: Login failed. The login is from an untrusted domain and cannot be used with Windows authentication.\nSource: Microsoft SQL Server Native Client 10.0\n\n    c:\\Program Files\\Microsoft SQL Server\\110\\DTS\\Binn&gt;dtutil /File c:\\www\\clients\\SomeCompany\\ssis\\warehouse\\Warehouse_Update_Table1.dtsx /DestServer SomeServerName.SomeDomain.net /Copy s\n    ;Warehouse_Update_TestTable1\n    c:\\Program Files\\Microsoft SQL Server\\110\\DTS\\Binn&gt;dtutil /File c:\\www\\clients\\SomeCompany\\ssis\\tmlwarehouse\\Warehouse_Update_Table1.dtsx /DestServer/SomeServerName.SomeDomain.net /Copy sql;Warehouse_Update_Table1\n\n(obviously I have real values for \"SomeCompany\" and SomeServerName.SomeDomain\"\n</code></pre>\n\n<p>is there a way to elevate rights such as what you can do with an .exe to specify the domain of the sender or to elevate this request so this thing works?</p>\n\n<p>we are calling this using windows auth unfortunately because that's what the client ants.</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":13052903,"title":"SQL Server stored procedure, exec from another query","body":"<p>I'm learning SQL and I've got some problems calling a stored procedure from a new/different query. </p>\n\n<p>I has build a <code>installDB.sql</code> file where there are created some tables and additionally filled these with data.  </p>\n\n<p>Furthermore I use a stored procedure as well, to add some functions.  </p>\n\n<p>Example:</p>\n\n<pre><code>CREATE PROCEDURE Add_Book\n    @User CHAR(50),\n    @Book CHAR(50)\n    AS\nINSERT INTO Relationtable(book_id, user_id, current_dato) \n    VALUES(\n        (SELECT book_id FROM Books WHERE book_title = @Book),\n        (SELECT user_id FROM Users WHERE user_name = @User),\n         GETDATE()\n    )\n</code></pre>\n\n<p>In this query (tab) I can <code>exec</code> that procedure (without problems):  </p>\n\n<pre><code>exec Add_Book myUser, myBook\n</code></pre>\n\n<p>But if I try this command in a new query (tab), it doesn't work.  </p>\n\n<p>I want the <code>installDB</code> to build all my functions and be able to call them later from another queries.</p>\n\n<p>Is this possible?</p>\n"},{"tags":["c#","sql-server-2008","datetime","linq-to-entities","equality"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":68,"score":3,"question_id":13057855,"title":"Equality comparison fails between C# datetime and SQL datetime","body":"<p>I am trying to do an equality comparison between a C# datetime and a SQL datetime, which appears to fail due to the precision in which those values are stored. </p>\n\n<p>So say I have a really simple SQL table, with these fields:</p>\n\n<pre><code>ID (PK, int, not null) - identity\nTitle (text, null)\nUpdateTime (datetime, not null)\n</code></pre>\n\n<p>I create a class object via Entity framework, setting its UpdateTime to DateTime.Now like so:</p>\n\n<pre><code>DateTime now = DateTime.Now;\nTitle.UpdateTime = now;\n</code></pre>\n\n<p>When I insert my new object into the table, I see that all the values appear to be stored correctly. Now I want the ID that was created for my object.</p>\n\n<p>This is where things get borked. I try pulling the ID back via LINQ:</p>\n\n<pre><code>Title.ID = context.DBTitles.Where(x=&gt;x.UpdateTime == now).FirstOrDefault().ID;\n</code></pre>\n\n<p>This throws an exception because the query returns null, despite the fact that the 'now' I've inserted is supposedly the same as the 'now' that was inserted into my table.</p>\n\n<p>So my question : How do I ensure that my C# datetime is equivalent to the datetime stored in SQL? What is the best way to get my ID back?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":56,"score":2,"question_id":13057408,"title":"Compare values of two columns then select the larger value","body":"<p>I need to query a table and select 3 of the values of 4 columns. I need to compare the values of the 3rd column and the fourth column and select the larger value.</p>\n\n<p>For example:</p>\n\n<pre><code>column1  column2  column3  column4\n hello    hello      3        5   \n hi       hi         7        1   \n</code></pre>\n\n<p>I need to return:</p>\n\n<pre><code>column1  column2  Hybrid\n hello    hello     5   \n hi       hi        7   \n</code></pre>\n\n<p>I have been trying to use IF/ELSE but I just can't seem to get the syntax correct</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13057281,"title":"Grouping and Total Issue","body":"<p>I have a table called Phone_Details and the data looks like:</p>\n\n<pre><code>Name            DeviceType  InvoiceDate TotalCharges\nAguilera, Alex  Smart Phone 8/3/2012    606.55\nAguilera, Alex  Data Card   8/3/2012    26.17\n</code></pre>\n\n<p>I want Output as:</p>\n\n<pre><code>Name            Total Spend    # of devices    Avg Spend    # of Bills &gt;300\nAguilera, Alex  632.72              2            316.36            1\n</code></pre>\n\n<p>I tried doing this:</p>\n\n<pre><code>Select Name,Sum(Totalcharges), Count(DeviceType),Sum(Totalcharges)/Count(DeviceType)\nfrom dbo.Phone_Details\ngroup by Name\n</code></pre>\n\n<p>But How can i get the last column this?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":13057176,"title":"Msg 102, Level 15, State 1, Line 24 Incorrect syntax near '.'","body":"<p>All... based on another question I've posted here recently, I built this stored procedure, but when executed, I receive the error in the title. </p>\n\n<p>As you can see, I tried to remove any aliases, but it didn't matter. Not sure how to use PRINT to see the issue on this either. Of course the isolated <code>SELECT</code> statement works on its own.  </p>\n\n<p>I can even pull results from my temp table after the error appears. So is it a problem in this script or the results? Appreciate your assistance. I also only used the WHERE statement to limit the test results.  </p>\n\n<pre><code>    ALTER PROC ap_vhdr_test AS\nSET NOCOUNT ON\nIF OBJECT_ID('temp.dbo.#ap_vend_det') is NOT NULL\nDROP TABLE #ap_vend_det;\n\nCREATE TABLE #ap_vend_det           \n(db_name varchar(32)\n, vendor_name varchar(40)\n, vendor_code varchar(12)\n, voucher_no varchar(16)\n, invoice_num varchar(16)\n, inv_date varchar(16)\n, due_date varchar(16)\n, apply_date varchar(16)\n, total float\n, line_desc varchar(40)\n, company_id smallint\n, gl_num varchar(32)\n, acct_site varchar(32)\n, sort_code varchar(32)\n, nat_gl varchar(32)\n, gl_desc varchar(40)\n, category nvarchar(510)\n, sub_category nvarchar(510)\n, po_num varchar(16)\n, vendor_class varchar(8)\n)\nINSERT INTO #ap_vend_det\nEXEC sp_MSforeachdb N'IF ''?'' NOT IN ( ''model'',''tempdb'',''master'',''msdb'')\nBEGIN SELECT DISTINCT db_name = ''?''\n, amaster.addr1 --as vendor_name\n, amaster.vendor_code --as vendor_code\n, apdet.trx_ctrl_num --as voucher_no\n, aphdr.doc_ctrl_num --as invoice_num\n, CONVERT(varchar(16),dateadd(dd,(aphdr.date_doc - 639906),''1/1/1753''),101) --as inv_date \n, CONVERT(varchar(16),dateadd(dd,(aphdr.date_due - 639906),''1/1/1753''),101) --as due_date\n, CONVERT(varchar(16),dateadd(dd,(aphdr.date_applied - 639906),''1/1/1753''),101) --as apply_date\n, aphdr.amt_net --as total\n, aphdr.doc_desc --as line_desc\n, gldet.company_id --as company_id\n, gldet.account_code --as gl_num\n, gldet.seg2_code --as acct_site\n, gldet.seg3_code --as sort_code\n, gldet.seg1_code --as nat_gl\n, gldet.description --as gl_desc\n, ap_coa.group_header --as category\n, ap_coa.group_label  --as sub_category\n, apdet.po_ctrl_num --as po_num\n, apvend.vend_class_code --as vendor_class\nFROM ?.dbo.amaster --amaster\nJOIN ?.dbo.aphdr --aphdr                        --**\n    ON amaster.vendor_code = aphdr.vendor_code\n    AND amaster.pay_to_code = aphdr.pay_to_code\nJOIN ?.dbo.apdet --apdet\n    ON aphdr.trx_ctrl_num = apdet.trx_ctrl_num\nJOIN ?.dbo.gldet --gldet\n    ON aphdr.journal_ctrl_num = gldet.journal_ctrl_num\nJOIN ?.dbo.glt --glt\n    ON gldet.journal_ctrl_num = glt.journal_ctrl_num\nJOIN ?.dbo.apvend --apvend\n    ON amaster.vendor_code = apvend.vendor_code\nJOIN reps.dbo.ap_coa --ap_coa\n    ON gldet.seg1_code = ap_coa.acct_code\nWHERE aphdr.date_applied &gt;= ''734785''              \nEND';\n\nSELECT * FROM #ap_vend_det;\n</code></pre>\n"},{"tags":["sql","sql-server-2008","query","select"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13057029,"title":"SQL query to filter out match results","body":"<pre><code>        SELECT TOP 92 PERCENT \n        Convert(DateTime,Floor(Cast((DateTime) as Float)*24)/24,0) AS SummaryDateTime,\n        MIN(APM_ApplicationAvailability.PercentAvailability) AS MIN_of_ApplicationAvailability,\n        Nodes.Caption AS NodeName \n\n        FROM \n        (Nodes INNER JOIN APM_AlertsAndReportsData ON (Nodes.NodeID = APM_AlertsAndReportsData.NodeId))  INNER JOIN APM_ApplicationAvailability ON (APM_AlertsAndReportsData.ApplicationId = APM_ApplicationAvailability.ApplicationID)\n\n\n        WHERE \n        ( DateTime BETWEEN 40907 AND 41205 )\n         AND  \n        (\n          (APM_AlertsAndReportsData.ApplicationName LIKE '%HTTP%') AND \n          (Nodes.Caption = 'www.example.com')\n        )\nGROUP BY Convert(DateTime,Floor(Cast((DateTime) as Float)*24)/24,0), \nNodes.Caption\n\n\nORDER BY SummaryDateTime ASC\n</code></pre>\n\n<p>Above query giving me following result, which attached as an image. <img src=\"http://i.stack.imgur.com/zCENr.png\" alt=\"enter image description here\"> </p>\n\n<p>I want to write a query to filter out all <code>0.00%</code> results so it will just gives only <code>0.00%</code> data, because i don't care about <code>100%</code> data. I don't know how to filter data. </p>\n"},{"tags":["sql-server-2008","common-table-expression"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13055930,"title":"SQL Server CTE implementation","body":"<p>I'm writing a script as below based on my business logic, Please could any one suggest me, how can implement CTE (Common table expression)  </p>\n\n<pre><code>IF OBJECT_ID('tempdb..#tmpFirstTable') IS NOT NULL\nDROP TABLE #tmpFirstTable\n\n;WITH tempCTE AS ( select * from Table1  )      \n\nIF OBJECT_ID('tempdb..#tmpTable') IS NOT NULL\nDROP TABLE #tmpTable\nSELECT  * \ninto #tmpTable\nfrom table2  \n\nSelect * from tempCTE T1,#tmpTable T2 , #tmpFirstTable T3 where T1.ID = T2.ID and T2.ID = T3.ID\n</code></pre>\n\n<p>The above code format is should be as it is.  </p>\n\n<p>The <strong>ERROR</strong> which I'm getting is.  </p>\n\n<blockquote>\n  <p><em>Incorrect syntax near the keyword 'IF'.</em></p>\n</blockquote>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":60,"score":3,"question_id":13055967,"title":"SQL statement selecting most recent date no longer working","body":"<p>I've had a sudden failure in one of my reporting routines and have traced it back to the having portion of my statement. The function this has been serving, up until 2 days ago, was selecting the most recent date from the <code>dbo.data_feed_file</code> table (column name: <code>File_Date</code>). </p>\n\n<p>Statement follows</p>\n\n<pre><code>HAVING (dbo.data_feed_file.file_date = (Select MAX(File_Date) as Expr1\n                                        FROM dbo.data_feed_file AS data_feed_file_1))\n</code></pre>\n\n<p>First: is there an alternative way to write this? I've gotten my report working by removing the statement, it's just 2.5 million more lines than I want. I know I can hard code the date to pull just the specific date I want, but automation is obviously preferred.</p>\n\n<p>Second: Does anyone know what could cause this to spontaneously fail? I'm the only person with access to edit this query so I know nothing was changed (no really, nothing changed).</p>\n\n<p>Thanks in advance.</p>\n\n<p>Edit: To add clarification: There is no error message, the column headers are showing up as anticipated but no data is populated, it's just blank fields (as though nothing met the having criteria). The statement completes as though there is nothing wrong. I've confirmed there are no NULL values in the File_Date column.</p>\n"},{"tags":["sql-server-2008","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13055425,"title":"SQL Server 2008 FullTextSearch Single Character in Name Missing from Results","body":"<p>I have a full text indexed column in SQL Server 2008 which has the following rows: </p>\n\n<blockquote>\n  <p>W Smithers, Wilda Smithers, W2 Smithers</p>\n</blockquote>\n\n<p>When I run the following query I only get back Wilda Smithers and W2 Smithers.</p>\n\n<pre><code>SELECT  FT_TBL.full_name as results\nFROM dbo.ft_table AS FT_TBL WITH (NOLOCK) \nINNER JOIN CONTAINSTABLE (ft_table , full_name, '(\"w*\" AND \"smither*\")',12) AS KEY_TBL \nON FT_TBL.ft_key_id = KEY_TBL.[KEY]\nORDER BY KEY_TBL.RANK desc\n</code></pre>\n\n<p>Any suggestions on how to tweak this so W Smithers is also in my result set?</p>\n"},{"tags":["mysql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13055194,"title":"CAST(0x993902CE AS DATETIME) FROM SQL SERVER TO MYSQL","body":"<p>Does anyone knows how to <code>CAST(0x993902CE AS DATETIME)</code> from SQL SERVER (<a href=\"http://msdn.microsoft.com/en-us/library/aa258277%28v=sql.80%29.aspx\" rel=\"nofollow\"><code>smalldatetime</code> binary format</a>) to MYSQL?</p>\n\n<p>I tried <code>CAST(0X993902CE AS DATETIME)</code> in mysql but it returns NULL when it should return '2007-05-25 11:58:00'.</p>\n\n<p>If anyone can tell me a way to do this, I'd be grateful.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":46,"score":-3,"question_id":13055435,"title":"Difference between LIKE and NOT LIKE searching for alpha numeric data","body":"<p>What is the difference between these two statements as far as the results?</p>\n\n<pre><code>SELECT * FROM DTSEARCHER \nWHERE word LIKE '%[^a-zA-Z0-9]%'\n\nSELECT * FROM DTSEARCHER \nWHERE word not LIKE '%[^a-zA-Z0-9]%'\n</code></pre>\n"},{"tags":["sql-server-2008","ssis","mdx"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13052244,"title":"Sort an MDX cross join","body":"<p>I'm new to MDX so bear with me. </p>\n\n<p>I have crossed joined two dimensions so that I can report on Sales &amp; Target (from the sales dimension) with this week and this week last year (from the date dimension) in columns and listed locations in the rows.</p>\n\n<p>Psuedo code..</p>\n\n<pre><code>Select \n    {[DateDim].[ReportingPeriod].[Week].&amp;[2012]&amp;[20],\n     [DateDim].[ReportingPeriod].[Week].&amp;[2013]&amp;[20]}\n    *\n    {[Measures].[Total Sales],[Measures].[Target]} on Columns,\n\n    DrillDownLevel([LocationDim].[LocationName].[All]) on Rows from [MyCube]\n</code></pre>\n\n<p>How do I sort the results by sales this year? (.. <code>[2013].[20]</code>)</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13051942,"title":"Sql Server 2008 Missing Index on TempTable","body":"<p>I have developed a stored procedure with below code , by using the  <strong>#tmpRIStatusReport</strong>  as temp table and inserting the values into <strong>#tmpRIStatusReport</strong>  and for multi usage purpose.  </p>\n\n<p>while I was running the execution plan, It is saying the below message as missing the index on <strong>#tmpRIStatusReport</strong>.  </p>\n\n<pre><code>/*\nMissing Index Details from ~vs4E6E.sql - databaserver.databasename (developerID (113))\nThe Query Processor estimates that implementing the following index could improve the query cost by 18.9401%.\n*/\n\n/*\nUSE [tempdb]\nGO\nCREATE NONCLUSTERED INDEX [&lt;Name of Missing Index, sysname,&gt;]\nON [dbo].[#tmpRIStatusReport__________________________________________________________________________________________________00000000291F] ([SubId])\n\nGO\n*/\n</code></pre>\n\n<p>Please could you any one suggest me what I need to do?</p>\n"},{"tags":["sql-server","tsql","sql-server-2008","stored-procedures"],"answer_count":6,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":3526,"score":3,"question_id":3292531,"title":"t-sql stored procedure create scripts","body":"<p>I have a bunch of stored procedure names. I want to export the create script for each of the stored procedure. What is the best way to do it? </p>\n\n<p>Right now I am manually selecting the stored proc in SSMS and selecting <code>\"Script stored procedure as -&gt; Drop and Create to\"</code>. This seems tedious. I am hoping there is a better way to deal with this. Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":87,"score":2,"question_id":13053196,"title":"Incorrect syntax error on select statement from SQL Server using table variables","body":"<p>I have a stored procedure where I create a table variable and then try to execute a <code>select</code> against that table variable, but the output throws an incorrect syntax error.</p>\n\n<p>I have my stored procedure (simplified) below :</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[spGetLog] \nAS\n  SET NOCOUNT ON;\n\n  Declare @Table table (ID int identity(1,1), \n                        Node varchar(100)\n                       )\n\n  insert into @Table(Node) values ('employee')\n\n  Declare @sqlquery AS NVARCHAR(1000)\n\n  SET @sqlquery = 'select * from @Table;'\n  EXEC (@sqlquery)\n</code></pre>\n\n<p>Gives an error -- </p>\n\n<blockquote>\n  <p><em>Incorrect syntax near '@Table'</em></p>\n</blockquote>\n\n<p>In reality the <code>@sqlquery</code> variable I have is complex and I need to use a variable and \nexecute the query.</p>\n\n<p>Is there a way I can still execute my stored procedure using a variable? Any other\nsuggestions are welcome.</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13052474,"title":"Compound conditions in SQL Server 2008 stored procedure","body":"<p>Can you please let me know if stored procedure allow to handle compound condition as below:</p>\n\n<pre><code>if(\n    ( (select Count(*) from dbo.Membership where EmailID=@emailID) &gt;0) \n                                  || \n    ((select Count(*) from dbo.Allocation where ResourceEmail=@emailID)&gt;0))\n)\n</code></pre>\n"},{"tags":["sql-server-2008","entity-framework","datetime","compare","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":113,"score":4,"question_id":13034266,"title":"Entity Framework and DateTime comparison with millisecond precision","body":"<p>I've got a problem with Entity Framework (Code First) under C# regarding comparison of DateTime values. I use the below defined class Validity (simplified for this example) as a superclass of of other Entities that shall have a defined validity in time.</p>\n\n<pre><code>public abstract partial class Validity {\n    [Key]\n    public int ID { get; set; }\n\n    public DateTime? ValidFrom { get; set; }\n    public DateTime? ValidTo { get; set; }\n\n    /**\n     * @brief This method builds an IQueryable from another IQueryable,\n     * with added restriction on ValidityFrom/To\n     *\n     * An object's validitiy is defined to\n     *   1. start at timestamp ValidFrom (=inclusive) and\n     *   2. to end before ValidTo (=exclusive).\n     *   3. If ValidFrom or ValidTo is NULL, it means to be \"unbounded\"\n     *      in start or end time (respectively)\n     * \n     **/\n    public static IQueryable&lt;T&gt; isValidAt&lt;T&gt;(IQueryable&lt;T&gt; query, DateTime time) where T : Validity\n    {\n        return query.Where&lt;T&gt;(c =&gt; \n               (!c.ValidFrom.HasValue || time &gt;= c.ValidFrom)  // If ValidFrom != NULL, the given timestamp must be equal or \"after\" ValidFrom\n            &amp;&amp; (!c.ValidTo.HasValue || time &lt; c.ValidTo));     // If ValidTo != NULL, the given timestamp must be \"before\" ValidTo\n    }\n\n    /**\n     * @brief Shall invalidate the object at timestamp time (implicitly sets validTo attribute).\n     **/\n    public void inValidate(DateTime time)\n    {\n        ValidTo = time;\n    }\n}\n\npublic class Item : Validity {\n    public string property { get; set; }\n}\n</code></pre>\n\n<p>At the last three lines, you'll find the class \"Item\" which we'll take as an example. Let's have a look at this query:</p>\n\n<pre><code>DateTime requestTime = DateTime.Now;\nvar items = from n in Validity.isValidAt(db.Items, requestTime)\n            select n;\n</code></pre>\n\n<p>This query should return only return Objects of class Item which are \"valid\" at \"requestTime\". Note that for ValidTo == requestTime the Item is to be regarded as \"invalid\" (the timespan ValidFrom to ValidTo is -exclusive- ValidTo; see comments in source code above). </p>\n\n<h2>The Problem</h2>\n\n<p>I actually -have- results in my result set \"items\" having <code>ValidTo == requestTime</code>. \nI just checked this via</p>\n\n<pre><code>Item i= items.FirstOrDefault();\nif ((i.ValidFrom.HasValue &amp;&amp; i.ValidFrom &gt; requestTime)\n || (i.ValidTo.HasValue &amp;&amp; requestTime &gt;= i.ValidTo)) {\n\n   // ... SOME ERROR OUTPUT ...\n\n}\n</code></pre>\n\n<p>** NOTE: This error isn't happening seldom, but nearly all the time in the software as .inValidate(requestTime); is often called to invalidate an object. ** </p>\n\n<p>I manually checked via Microsoft SQL Server Management Studio (Microsoft SQL Server 2008 is used as backend) using the produced SQL query by LinQ. I had to declare/set @p_<em>linq</em>_0, @p_<em>linq</em>_1 myself (which both mean requestTime)...</p>\n\n<pre><code>DECLARE @p__linq__0 DATETIME\nDECLARE @p__linq__1 DATETIME\nSET @p__linq__0 = '2012-10-23 15:15:11.473'\nSET @p__linq__1 = '2012-10-23 15:15:11.473'\n</code></pre>\n\n<p>This actually works as expected. But if I use '2012-10-23 15:15:11' as a value instead, I'll receive wrong results (as expected). They are similiar to those in my program. So I guess that's the problem...</p>\n\n<p>In Database the \"DateTime\" has Milliseconds defined and ValidFrom/ValidTo are stored including Milliseconds. But I assume that the query doesn't include the milliseconds part of the timestamp for any reason... The variable requestTime how ever has the milliseconds value set.</p>\n\n<p>Unfortunately I don't know how to check the actual values sent in a query to verify this. I only know how to use the items.toString()-Method to output the generated SQL, which contains placeholders.</p>\n\n<p>I tried:\n1. <code>db.Log = Console.Out;</code> which didn't compile due to an error that \"db.Log\" would not be defined (also the auto completion didn't suggest \"Log\"). Whereas db is derived from DbContext.\n2. Also casting \"items\" to ObjectQuery and then using .ToTraceString() doesn't work, program crashes at runtime with error message that cast is invalid.</p>\n\n<p>If this is important: I use .NET 4.0 and EntityFramework.5.0.0.</p>\n\n<h2>Questions</h2>\n\n<ol>\n<li>How to Log/Output the complete SQL (including values of placeholders)?</li>\n<li>How to fix that problem in an elegant way? ...I don't mean a hack that just substracts a second from the 'time' which is assigned to \"ValidTo\" in inValidate()!</li>\n</ol>\n\n<p>Best regards,</p>\n\n<p>Stefan</p>\n\n<h2>EDIT (more details found)</h2>\n\n<p>I checked what happens via the SQL profiler, which seems fine. Timestamps with high (7 digits) precisions are supplied correctly when querying. BUT: I don't get the SELECT causing the incorrect result. So I guessed: it must be some caching. So I put a <code>db.SaveChanges();</code> directly before my LINQ query. Now I got all queries in the profiler.</p>\n\n<p>I tried the following code to change the datatype in database. As it was suggested by Slauma (see <a href=\"http://stackoverflow.com/a/8044310/270591\">http://stackoverflow.com/a/8044310/270591</a>).</p>\n\n<pre><code>modelBuilder.Entity&lt;Item&gt;().Property(f =&gt; f.ValidFrom)\n  .HasColumnType(\"datetime2\").HasPrecision(3);\nmodelBuilder.Entity&lt;Item&gt;().Property(f =&gt; f.ValidTo)\n  .HasColumnType(\"datetime2\").HasPrecision(3);\n</code></pre>\n\n<p>I dropped the whole database before restart... </p>\n\n<p><strong>Result:</strong> No success using HasPrecision(x); where x is one of 0, 3; (with or without db.SaveChanges() directly before); BUT: x = 7 fairly works with db.SaveChanges(); directly before the query... </p>\n\n<p>So, unfortunately this problem is still existent... </p>\n\n<h2>Current Workaround</h2>\n\n<p>I apply the following method to any DateTime value before assigning it to a database objects property. It just rounds the DateTime to full seconds precision (which I configured at the DB). Also this is applied to any DateTime used for comparison.</p>\n\n<p>Result: This is more a hack than a solution! I will need to write access functions for all setter methods, so that a direct assignment cannot happen by accident.</p>\n\n<pre><code>    public static DateTime DateTimeDBRound(DateTime time) {\n        DateTime t = time;\n        long fraction = (t.Ticks % TimeSpan.TicksPerSecond);\n        if (fraction &gt;= TimeSpan.TicksPerSecond / 2)\n        {\n            t = t.AddTicks(TimeSpan.TicksPerSecond - fraction);\n        }\n        else\n        {\n            t = t.AddTicks(-fraction);\n        }\n        return t;\n    }\n</code></pre>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13052451,"title":"Stored procedure returning DateTime format","body":"<p>I created a stored procedure as following,</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[Access_GetDate]\n(\n    @Name varchar(255)\n)\nAS\n    SELECT TOP(1) Employee.StartDate \n    FROM Employee \n    WHERE Employee.Name = @Name;\n</code></pre>\n\n<p>its working properly but returning date in this format </p>\n\n<pre><code>2012-10-24 00:00:00.000\n</code></pre>\n\n<p>However I want it in this format,</p>\n\n<pre><code>2012 10 24\n</code></pre>\n\n<p>only</p>\n"},{"tags":["sql-server-2008","xslt-1.0"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13052333,"title":"Execution breaks in SQL","body":"<p>we are creating a CSV file using a number of stored procedures with in an XSLT. But each time when we run this XSLT the execution breaks in the middle. And the result data varies in the number of records returned..It was working in our local server before but when we moved to a new server this problem started. (and there is no error shown)</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13051847,"title":"Replacing characters in a string based on rows in a table sql","body":"<p>I need to replace a list of characters in a string with some mapped characters.</p>\n\n<p>I have a table 'dbo.CharacterMappings' with 2 columns: 'CharacterToFilter' and 'ReplacementCharacter'.</p>\n\n<p>Say that there are 3 records in this table: </p>\n\n<pre><code>Filter   Replacement    \n$        s\n@        a\n0        o\n</code></pre>\n\n<p>How would I replace all of the filter characters in a string based on these mappings?</p>\n\n<p>i.e. 'Hell0 c@t$' needs to become 'Hello cats'.</p>\n\n<p>I cant really think of any way of doing this without resorting to a table variable and then looping through it. I.e. have a table variable with a 'count' column then use a loop to select 1 row at a time based on this column. Then I can use the REPLACE function to update the characters one at a time.</p>\n\n<p>Edit: I should note that I always want to strip out these characters (I don't need to worry about $5 -> s5 for example).</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":36,"score":-1,"question_id":13051392,"title":"check constraint for 2 columns","body":"<p>can anybody help me in writing a trigger on a table ,\n the scenario is like this\ni have a table named person with columns col1 and col2 ,</p>\n\n<pre><code>Person\ncol1 |  col2\n0    |  1\n1    |  0\n2    |  3\n3    |  1\n4    |  2\n5    |  3\n</code></pre>\n\n<p>these columns col1,col2  values are dependent on another table employee columns col3 col4</p>\n\n<pre><code>Employee\ncol3 | col4\n0    | 1\n1    | 0\n2    | 1\n3    | 3\n4    | 0\n5    | 3\n6    | 1\n</code></pre>\n\n<p>now if combination of col1 and col2 values (eg 0,1 from person table exists in employee table then do not update the columns col1 and col2 in person table ,if col1 and col2 values are  2,3 value doesn't exists in employee table ,so in this case if there is any update on columns  col1 and col2  just print a message</p>\n"},{"tags":["performance","sql-server-2008","c#-4.0","table","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13048907,"title":"Sql Server heavily queried Table - should I store secondary info (html text) in another table","body":"<p>The Overview:</p>\n\n<p>I have a table \"category\" that is for the most part used to categorise products and currently looks like this:</p>\n\n<pre><code>CREATE TABLE [dbo].[Category]\n( \nCategoryId int IDENTITY(1,1) NOT NULL, \nCategoryNode hierarchyid NOT NULL UNIQUE,\nCategoryString AS CategoryNode.ToString() PERSISTED,\nCategoryLevel AS CategoryNode.GetLevel() PERSISTED,\nCategoryTitle varchar(50) NOT NULL,\nIsActive bit NOT NULL DEFAULT 1\n)\n</code></pre>\n\n<p>This table is heavily queried to display the category hierarchy on a shopping website (typically every page view) and can have a substantial number of items.</p>\n\n<p>I'm using the Entity Framework in my data layer.</p>\n\n<p>The Question:</p>\n\n<p>I have a need to add what could potentially be a fairly large \"description\" which could come in the form of the entire contents of a web-page and I'm wondering whether I should store this in a related table rather than adding it to the existing category table given that the entity framework will drag the \"description\" column out of the database 100% of the time when 99.5% of the time I'll only want the CategoryTitle and CategoryId.</p>\n\n<p>Typically I wouldn't worry about the overhead of the Entity Framework, but in the case I think it might be important to take it into consideration. I could work around this with a view or a complex type from a stored proc, but this means a lot of refactoring that I'd prefer to avoid.</p>\n\n<p>I'm just interested to know if anyone has any thoughts, suggestions or a desire to slap my wrists in relation to this scenario...</p>\n\n<p>EDIT:</p>\n\n<p>I should add that the reason I'm hesitating to set up a secondary table is because I don't like the idea of adding an additional table that has a 1 to 1 relationship with the Category table - it seems somewhat pointless. But I'm also not a DBA so I'm not sure whether this is an acceptable practice or not.</p>\n"},{"tags":["sql-server","sql-server-2008","triggers","datatrigger"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13049724,"title":"MS Sql Server Triggers (2) executing at the same time: How do I catch what's causing it?","body":"<p>So I have 2 triggers on a table in my dbase. It's purpose is to log any data manipulation activities done by the user or by a third party import/export. The table where it saves it to have a datestamp which obviously marks when it was executed. For some reason, when this third party SSIS package writes a record to it it would trigger the triggers (as expected) but will have the exact same time. 1 record for inserting the record, and another record for updating the record. The problem is the datestamp is exactly the same up to the millisecond.</p>\n\n<p>Any ideas on how I can track the cause of this? Should I be looking at the SSIS package? I dont think that would cause the 2 triggers tho.</p>\n\n<p>Thanks for your time!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","database-tuning","sql-tuning"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13049452,"title":"SQL Server audit logout creates huge number of reads","body":"<p>I'm using SQL Server Profiler to figure out what process are consuming SQL process and I found that the event class <code>Audit Logout</code> is causing a huge number of reads and consume cpu process.</p>\n\n<p>Is it normal? Or do I have something wrong in the SQL Server configuration?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","sql-execution-plan"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13047903,"title":"SQL Server : delay before output (a print statement) is produced","body":"<p>I may have a slight feeling as to what is going on, but I thought I'd ask to get confirmation, and potentially look at an alternative.</p>\n\n<p>As a slight background, I've written a C# application that is providing a small front end to a stored procedure. The procedure contains a number of temporary table inserts from other stored procedures (and one table valued udf), and some xml processing.</p>\n\n<p>In order to get a sense of how far along I am in the stored procedure, I'm subscribing to the <code>InfoMessage</code> (using an <code>SqlInfoMessageEventHandler</code>) from an <code>SqlConnection</code>. I've put some informative print statements in various places throughout the SP, so I can get a sense of the processing which has completed and update a status bar accordingly).</p>\n\n<p>The rough structure of the SP is along these lines:</p>\n\n<pre><code>Print 'Beginning processing'\n\nCreate Temp Table\nInsert into Temp Table from Table Valued UDF\n\nPrint 'Creating working Tables'\nCreate more Temp Tables\nInsert into Temp Tables from SPs (each SP contains a print statement e.g 'Starting SP1').\n</code></pre>\n\n<p>All the messages are received and processed successfully, but there is a delay of a few seconds before any messages are returned from the server, then the first few arrive all at once (as though they were all processed but the output was held back for a while).</p>\n\n<p>I had naively assumed (I still have a lot to learn about DB mechanics) that my initial print statement would be returned before any of the other processing instructions within the SP took place.</p>\n\n<p>I assume that the server is doing something regarding fetching execution plans an/or potentially recalculating plans, or is it the case that query optimiser is doing some preprocessing before any results at all are returned?</p>\n\n<p>Hopefully my question is reasonably understandable from that mess of text. Essentially, would the query optimiser make the server perform some of the selects/inserts before the procedure actually begins sequentially encountering my print statements?</p>\n\n<p>I also tried doing some small temp table manipulation before my initial print statement, so some rows would be returned before the slow operations began but the result was much the same.</p>\n\n<p>Thanks for any responses.</p>\n"},{"tags":["python","perl","sql-server-2008","parsing"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":96,"score":1,"question_id":13037343,"title":"Best way to parse a file with columns that randomly change order before importing it into SQL Server 2008?","body":"<p>I have a file that has columns that look like this:</p>\n\n<pre><code>Column1,Column2,Column3,Column4,Column5,Column6\n1,2,3,4,5,6\n1,2,3,4,5,6\n1,2,3,4,5,6\n1,2,3,4,5,6\n1,2,3,4,5,6\n1,2,3,4,5,6\nColumn1,Column3,Column2,Column6,Column5,Column4\n1,3,2,6,5,4\n1,3,2,6,5,4\n1,3,2,6,5,4\nColumn2,Column3,Column4,Column5,Column6,Column1\n2,3,4,5,6,1\n2,3,4,5,6,1\n2,3,4,5,6,1\n</code></pre>\n\n<p>The columns randomly re-order in the middle of the file, and the only way to know the order is to look at the last set of headers right before the data (Column1,Column2, etc.)  (I've also simplified the data so that it's easier to picture.  In real life, there is no way to tell data apart as they are all large integer values that could really go into any column)</p>\n\n<p>Obviously this isn't very SQL Server friendly when it comes to using BULK INSERT, so I need to find a way to arrange all of the columns in a consistent order that matches my table's column order in my SQL database.  What's the best way to do this?  I've heard Python is the language to use, but I have never worked with it. Any suggestions/sample scripts in any language are appreciated.</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13048141,"title":"Using WildCard for dateTime column in SQL query","body":"<p>I want to look for all records within a table that has date column for a specific date, at the moment I am trying this query,</p>\n\n<pre><code>SELECT     *\nFROM      Table_ABC\nWHERE     DateCreated CONTAINS 24/10/2012\n</code></pre>\n\n<p>But its not working</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13046619,"title":"Query to get list active queries in my SQL Server","body":"<p>I want to get a list of information of active queries that are running in my SQL Server (in order to kill a few of those queries).</p>\n\n<p>I want a query to get this required information:</p>\n\n<pre><code>| query_id (if possible) | query_text | query_start_time | time_elapsed | host_name | user_group | query_status |\n</code></pre>\n\n<p>I am new to SQL Server please suggest....</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":13047746,"title":"Changing column name in a SQL Server table with 1000+ records","body":"<p>I have a column and want to change its name but nothing else using query, what would be the best way of doing it.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":1,"question_id":12979367,"title":"Date data from Text file to date time in SQL Server","body":"<p>I am using one flat file as source which have couple of columns belong to Date format and I have placed all the data into the SQL Server table which predefined.</p>\n\n<p>Example:-</p>\n\n<p>Flat file</p>\n\n<pre>CaseNO|CaseType|CDate\n1     |ORG     |1\\12\\2012\n2     |PGD     |3\\3\\2011\n</pre>\n\n<p>here when I check it with data viewer, Its looks like 2012-12-1 00:00:00.0000000. but the OLE DB connection creates the following errors.</p>\n\n<pre><code>[OLE DB Destination [7546]] Error: There was an error with input column \n\"CDate\" (8799) on input \"OLE DB Destination Input\" (7559). The column status\nreturned was: \"The value could not be converted because of a potential loss of data.\".\n</code></pre>\n\n<p>Please guide me...Appreciated your help.</p>\n\n<p>343</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13047490,"title":"SQL Server Criteria not working when values are NULL","body":"<p>Is there a way to capture all values that are <code>FieldName &lt;&gt; 'Value'</code>, that will return records where FieldName is NULL, without saying <code>(FieldName &lt;&gt; 'Value' OR FieldName IS NULL</code>) for every criteria field?</p>\n"},{"tags":["c#","database","sql-server-2008","entity-framework","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13046375,"title":"Removing Parent with one-to-many EntityFramework","body":"<p>I have this class ( Simplified )</p>\n\n<pre><code>public class User {\n    public string Username { get; set; }\n    public virtual Section Section { get; set; }\n}\n\npublic class Section {\n    public int DepartmentNumber { get; set; }\n    public virtual ICollection&lt;User&gt; DepartmentMembers { get; set; }\n}\n</code></pre>\n\n<p>What i try to achive is to delete a section. All users related to this section shoulde get a null value. This dosent work now because REFERENCE constraint \"FK_Users_Sections_Section\".</p>\n\n<p>What woulde be the correct way to do this? woulde i have to remove all users from this section before deleteing it? Is there a more elegant way to do this? Im using EntityFramework.</p>\n\n<p>My fluent API for this field:</p>\n\n<pre><code>modelBuilder.Entity&lt;User&gt;()\n            .HasOptional(u =&gt; u.Section)\n            .WithMany(s =&gt; s.DepartmentMembers)\n            .Map(m =&gt;\n                m.MapKey(\"Section\")\n            )\n            .WillCascadeOnDelete(false);\n</code></pre>\n\n<p>The WillCascadeOnDelete i have tried it by setting to false, removing the line and also adding the line with no arguments. </p>\n\n<p>I guess the solution is quit simple but i cant find any good explaination ( or mabye i dont understand the explainations i have been looking at. )</p>\n"},{"tags":["sql-server","sql-server-2008","delphi","delphi-xe2","ado"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":140,"score":4,"question_id":13028162,"title":"How to insert a string containing #0 in a NVARCHAR() column in MSSQL?","body":"<p>I'm sure this has a very simple solution, but I've exhausted my resources. I need to insert a bunch of <code>WideString</code> variables which may contain <code>#0</code> into a <code>NVARCHAR(1024)</code> column in MSSQL2k8. <code>#0</code> is treated as the string terminator somewhere in the transition... So, when I store <code>#6'r'#0'abc'</code>, only <code>#6'r'</code> is stored. I'm using <code>TADOQuery</code>. What can I do about this?</p>\n\n<hr>\n\n<p>Here's the code I use:</p>\n\n<pre><code>var\n  S: string;\nbegin\n  S := #6'r'#0'abc';\n  ADOQuery1.Append;\n  ADOQuery1S.Value := S;\n  { At this point, S = #6'r'#0'abc' and ADOQuery1S.Value = #6'r';}\n  ADOQuery1.Post;\nend;\n</code></pre>\n"},{"tags":["c#","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13046505,"title":"split column value of sql server in C#","body":"<p>There is a column \"AppendedData\" in \"Route\" table . It stores data in this format</p>\n\n<pre><code>-------------\nID |  AppendedData\n1  |  abc : xyz\n2  |  123a : gvk\n--------------\n</code></pre>\n\n<p>What I want is to write a search query over this \"AppendedData\" in where clause by spliting/substring it in two parts . The part before \":\" is to be used in matching the values.</p>\n\n<p>The current application that i am working is an old one so I can't go for writing an stored procedure . So what I am left is writing query in c# and executing it and returning a datable. So how can I do this in c#??</p>\n\n<p>I was trying this in sql server till now it is returning the second part ie, after \":\".</p>\n\n<p>my query:</p>\n\n<pre><code>select SUBSTRING(AppendedData,CHARINDEX(':',AppendedData)+1, 100) from  route\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":70,"score":1,"question_id":13036520,"title":"Why is cross apply making the query slow?","body":"<p>I have a query which is taking about 11 seconds to run for a single date. I want to run the same query for more multiple days. In other words, I want to be able to return snapshots for multiple days. Here is my original query:</p>\n\n<pre><code>SELECT \n    COUNT(*) AS 'Number of Cars',\n    d.ManufacturerName AS 'Make',\n    d.Name AS 'Model', \n    c.name AS 'Car Class'\nFROM CarRating a \n    INNER JOIN OwnedCar b ON a.OwnedCarID = b.OwnedCarID\n    INNER JOIN CarClass c ON a.CarClassID = c.CarClassID\n    INNER JOIN BaseCar d ON b.BaseCarID = d.BaseCarID\n\nWHERE \n    @myDate &lt; a.ExpiredWhen AND @myDate  &gt;= a.EffectiveWhen \nGROUP BY \n    d.Name, c.name,d.ManufacturerName\n</code></pre>\n\n<p>Like I mentioned the query about takes 11 sec. In order to run this query for multiple dates, I am using a date table and cross applying it to the above query:</p>\n\n<pre><code>SELECT [DATE], b.* FROM DimDate \nCROSS APPLY\n    (SELECT \n        COUNT(*) AS 'Number of Cars',\n        d.ManufacturerName AS 'Make',\n        d.Name AS 'Model', \n        c.name AS 'Car Class'\n    FROM CarRating a \n        INNER JOIN OwnedCar b ON a.OwnedCarID = b.OwnedCarID\n        INNER JOIN CarClass c ON a.CarClassID = c.CarClassID\n        INNER JOIN BaseCar d ON b.BaseCarID = d.BaseCarID\n\n    WHERE \n    dimDate.Date &lt; a.ExpiredWhen AND dimDate.Date &gt;= a.EffectiveWhen    \n    GROUP BY \n    d.Name, c.name,d.ManufacturerName) b\n\n WHERE DimDate.Date between @StartDate and @EndDate\n</code></pre>\n\n<p>This query takes 49 sec even for one day. Why is this slow? Is there a better way of doing this?</p>\n"},{"tags":["sql-server-2008","tsql","recursion"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2244,"score":1,"question_id":9004543,"title":"Recursive Child/Parent queries in T/SQL","body":"<p>I am using T/SQL in Microsoft SQL Server 2008</p>\n\n<p>I have a table</p>\n\n<pre><code>CREATE TABLE [TestTable](\n[CHILD] [int] NOT NULL,\n[PARENT] [int] NOT NULL\n) ON [PRIMARY]\n\nGO\n</code></pre>\n\n<p>These are some values which define a parent child hierarchial relationship</p>\n\n<pre><code>CHILD PARENT\n1       2\n2       0\n3       1\n4       2\n5       0\n</code></pre>\n\n<p>Visually, this table looks like this</p>\n\n<pre><code>0\n   2\n      1\n         3\n      4\n   5\n</code></pre>\n\n<p>I would ideally like the values to be shown as follows (where the right hand column indicates the generation)</p>\n\n<pre><code>CHILD    GENERATION\n 0          0\n 2          1\n 1          2\n 3          3\n 4          2\n 5          1\n</code></pre>\n\n<p>My T/SQL code looks like this</p>\n\n<pre><code>with n(CHILD, PARENT, GENERATION) as (\nselect CHILD, PARENT,1 as GENERATION from TestTable\nwhere PARENT=0 \nunion all\nselect nplus1.CHILD, nplus1.PARENT, GENERATION+1 from TestTable as nplus1, n\nwhere nplus1.PARENT=n.CHILD \n)\nselect CHILD,GENERATION from n\n</code></pre>\n\n<p>However it doesn't work!</p>\n\n<p>It returns</p>\n\n<pre><code>CHILD   GENERATION\n2        1\n5        1\n1        2\n4        2\n3        3\n</code></pre>\n\n<p>It has the right generation, but the wrong sort order!\nDoes anyone have any ideas how to solve this?</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13045069,"title":"What happens first: calculated persisted fields or ON INSERT TRIGGER updates","body":"<p>I have a table with persisted calculated fields.  It has a trigger that updates some fields based upon a number of fields including the persisted fields.</p>\n\n<p>Which is updated first, the persisted fields or the trigger'd update?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":13043717,"title":"Determine value/column that caused constraint violation in TSQL?","body":"<pre><code>DECLARE @temp AS TABLE (id INT NOT NULL PRIMARY KEY CLUSTERED, name VARCHAR(10))\nBEGIN TRY\ndeclare @Source table (id int not null, name varchar(10))\ninsert @Source\n    SELECT 11,'ABC' union all\n    SELECT 12,'CDE' union all\n    SELECT 13,'FGH' union all\n    SELECT 11,'IJK'\n\nINSERT INTO @temp\nSELECT * from @Source\nSELECT * FROM @temp\n\nEND TRY\nBEGIN CATCH\n EXEC msdb.dbo.sp_send_dbmail\n @profile_name = 'Profile Name', \n @recipients = 'email@email.com', \n @body = Error_Message, \n @subject = Error_Message ; \nEND CATCH;\nGO\n</code></pre>\n\n<p>This is my code working fine .. But what i want to include in the mail is ID which is causing the error as a reminder to some email id in This case it is \"11\".\nHow i can do this in some smart way ..?</p>\n"},{"tags":["sql-server-2008","syntax","remedy"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13046368,"title":"SQL syntax in openquery - apostrophes inside query","body":"<p>I have the following issue, I trying to obtain data via linked server in sql server 2008  from BMC Remedy </p>\n\n<p>Everything is fine with connection, but when I added <em>WHERE\n \"Assigned Group\" LIKE <strong>'</em>*scri%</strong>'<em>*</em>, I get error in sql server because of apostrophes which I have to use because BMC Remedy demands it. </p>\n\n<p>Do you know how to create correct syntax or force sql server to use quotation marks instead of apostrophes, or disable spell checking</p>\n\n<pre><code>SELECT *\n\nFROM OPENQUERY(Remedy, \n\n**'**\n\nSELECT\n Incident_Number\n FROM\n HPD_Help_Desk\n WHERE\n \"Assigned Group\" LIKE ' scri% '\n\n **'**\n\n)\n</code></pre>\n"},{"tags":["asp.net","sql","sql-server-2008","windows-server-2008","windows-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":13045974,"title":"2 applications use the same database","body":"<p>I have two ASP.net websites and each of them has a database.\nAll of them are in one server.\nOne table in both databases should have the same data (should be synchronized)</p>\n\n<p>I used some codes in both websites to insert, update or delete the records of the other Database and it worked fine on my own development studio (my own laptop) </p>\n\n<p>But when I uplaod them on windows server (2008 r2) insert and delete off the other website database doesn't work and when u log in one website u log out from the other website!! :(</p>\n\n<p>could u please help me? :p\nthanks soooo much</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13046020,"title":"How to add ten new columns to SQL table with 1000+ records in it without losing any single record","body":"<p>I am looking for query that I can use to add ten new boolean columns to existing table without effecting anything else in database. Also by default these boolean columns should be set to true as default.</p>\n\n<p>Looking for best practices.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>\"Also by default these boolean columns should be set to true as default.\"</p>\n\n<p>Sorry I meant to say that for records already exists new column should have value set as true, there shouldn't be any default value as I will set it myself.</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2008","oledb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":12974119,"title":"SSL Connection to database","body":"<p>My application need to establish secure connection with SQL Server 2008. Having enabled 'Force Encryption' in server side, following is my connection string from my C# application.</p>\n\n<pre><code>Initial Catalog=emp_test;Persist Security Info=True;User ID=sa;Password=***;Data Source=172.21.70.94;Provider=SQLOLEDB;Use Encryption for Data=True;Trust Server Certificate=True;\n</code></pre>\n\n<p>I did not provision any certificate in server - Hence I gave Trust Server Certificate=True, so that self signed server certificate is not validated.</p>\n\n<p>But the connection is not established with following error. </p>\n\n<blockquote>\n  <p><em>Database error: [DBNETLIB][ConnectionOpen (SECDoClientHandshake()).]SSL Security error.</em></p>\n</blockquote>\n\n<p>Without the two attributes related to security, it works fine.</p>\n\n<p>What do I need to change to get this to work?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","database-administration"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13045496,"title":"Unable to start SQL Server Instance 2008 R2 - DB file corrupt","body":"<p>I was not able to start the SQL Server 2008 R2 production DB instance. After reading the log file error message is</p>\n\n<p>\" The log scan number passed to log scan in database ‘master’ is not valid. This error may indicate data corruption or that the log file (.ldf) does not match the data file (.mdf). If this error occurred during replication, re-create the publication.\"</p>\n\n<p>After reading several post i realize that my MASTER DB file is corrupted. I have followed the below setup</p>\n\n<pre><code>Copy the Master.mdf and Masterlog.ldf file from Template location to My Database Data folder.\n\nC:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\Binn\\Templates to D:\\MSSQL\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\n</code></pre>\n\n<p>Note: Same error occur when i copy the all DB file like Master, MasterLog, MSDBData, MSDBlog, Model and ModelLog</p>\n\n<pre><code>When i run my MSSQLSEVER instance different problem occur.\n</code></pre>\n\n<p>In My server i had only C, D- Drive i dont have the E drive. How can i override these below error path.</p>\n\n<p>Error LOG</p>\n\n<pre><code>2012-10-24 02:51:12.79 spid5s Error: 17204, Severity: 16, State: 1.\n\n2012-10-24 02:51:12.79 spid5s FCB::Open failed: Could not open file e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBData.mdf for file number 1. OS error: 3(The system cannot find the path specified.).\n\n2012-10-24 02:51:12.79 spid5s Error: 5120, Severity: 16, State: 101.\n\n2012-10-24 02:51:12.79 spid5s Unable to open the physical file\n\n\"e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBData.mdf\". Operating system error 3: \"3(The system cannot find the path specified.)\".\n\n2012-10-24 02:51:12.79 spid5s Error: 17207, Severity: 16, State: 1.\n\n2012-10-24 02:51:12.79 spid5s FileMgr::StartLogFiles: Operating system error 2(The system cannot find the file specified.) occurred while creating or opening file 'e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBLog.ldf'. Diagnose and correct the operating system error, and retry the operation.\n\n2012-10-24 02:51:12.79 spid5s File activation failure. The physical file name \"e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBLog.ldf\" may be incorrect.\n</code></pre>\n"},{"tags":["sql-server-2008","tsql","datetime","date-range"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13044565,"title":"How to calculate Maximum incoming Call Peaks?","body":"<p>Here is part of database:</p>\n\n<pre><code>SessionID    SessionStartTime              SessionCloseTime\n24       2012-10-16 01:00:06.000           2012-10-16 01:01:22.000\n24       2012-10-16 01:00:08.000           2012-10-16 01:01:10.000\n24       2012-10-16 01:00:16.000           2012-10-16 01:01:12.000\n24       2012-10-16 01:00:30.000           2012-10-16 01:01:48.000\n24       2012-10-16 01:00:41.000           2012-10-16 01:02:08.000\n24       2012-10-16 01:00:48.000           2012-10-16 01:01:34.000\n24       2012-10-16 01:00:56.000           2012-10-16 01:03:09.000\n24       2012-10-16 01:01:02.000           2012-10-16 01:02:13.000\n24       2012-10-16 01:01:05.000           2012-10-16 01:03:16.000\n24       2012-10-16 01:01:09.000           2012-10-16 01:02:42.000\n24       2012-10-16 01:01:15.000           2012-10-16 01:02:48.000\n24       2012-10-16 01:01:18.000           2012-10-16 01:02:14.000\n24       2012-10-16 01:01:18.000           2012-10-16 01:02:06.000\n24       2012-10-16 01:01:42.000           2012-10-16 01:03:16.000\n24       2012-10-16 01:01:45.000           2012-10-16 01:03:04.000\n</code></pre>\n\n<p>In this db, I want to calculate max callpeaks. In other words, maximum how much calls are happened at the same time. I am working at a call center and I will generate a report with these records.  SessionID = 24 represents incoming calls. Any Suggestions,clues or calculation methods will be useful for me.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":9379,"score":2,"question_id":3922337,"title":"How to create composite primary key in SQL Server 2008","body":"<p>I am new to asp.net. I want to create tables in SQL Server 2008. Actually I don't know how to create composite primary key. Can anybody help me?</p>\n"},{"tags":["sql","sql-server-2008","c#-4.0","stored-procedures","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13044272,"title":"Need solution for transpose of table","body":"<p>I have a table named Sample which looks like.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Hq7Ip.png\" alt=\"enter image description here\"></p>\n\n<p>I want the output as following <img src=\"http://i.stack.imgur.com/GtJn4.png\" alt=\"enter image description here\"></p>\n\n<p>for this I have built the following Query: </p>\n\n<pre><code>SELECT YEAR/MONTH, 1L,3L,4L,6L,8L\n    FROM (\n    SELECT PANEL, LAYERCOUNT, MONTHS\n    FROM Sample) up\n    PIVOT (SUM(Count) FOR CountOFL IN (1L,3L,4L,6L,8L)) AS pvt\n    ORDER BY YEAR/MONTH\n</code></pre>\n\n<p>But it gives error Incorrect syntax near '1'.</p>\n\n<p><img src=\"http://i.stack.imgur.com/GtJn4.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":73,"score":-3,"question_id":13042647,"title":"Stored procedure to format data from temp object and put in grid view","body":"<p>I am new to stored procedure. </p>\n\n<p>I would like to change the format of data that I get from stored procedure. For example, a column returns a string value of <code>20110918190154</code>, I would like to change it to <code>2011/09/18 19:01:54</code>. </p>\n\n<p>This is how I execute the stored procedure and return a <code>DataTable</code>:   </p>\n\n<pre><code>   storedProcCommand = new SqlCommand(\"GetPurchaseHistory\", conn);\n   storedProcCommand.CommandType = CommandType.StoredProcedure;\n   storedProcCommand.Parameters.Add(\"@customerID\", cCustomerID);\n   adapter = new SqlDataAdapter(storedProcCommand);\n   adapter.Fill(allData);\n</code></pre>\n\n<p>Show the data in GridView as below:</p>\n\n<pre><code>   &lt;asp:GridView ID=\"GridView_PurchaseHistory\" runat=\"server\" AutoGenerateColumns=\"False\" &gt;\n   &lt;Columns&gt;    \n   &lt;asp:BoundField DataField=\"cTranDateTime\" HeaderText=\"Latest Purchase Date\" /&gt;\n   &lt;asp:BoundField DataField=\"cItemNo\" HeaderText=\"Item Number\" /&gt;\n   &lt;asp:BoundField DataField=\"cDescDef\" HeaderText=\"Description\" /&gt;\n   &lt;asp:BoundField DataField=\"fQty\" HeaderText=\"Total Quantity\" /&gt;\n   &lt;/Columns&gt; \n   &lt;/asp:GridView&gt;\n</code></pre>\n\n<p>The output would be like:</p>\n\n<pre><code>Latest Purchase Date\n20121007193111\n20120130171010\n20110918190154\n</code></pre>\n\n<p>I have written the code to substring and change the format which takes in 1 string as a time. I would like to know if there is anyway I can store the Date in a temp object and change its format accordingly.. Or if I could change before displaying it. </p>\n\n<p>Thank you so much.. Any advice is appreciated. </p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":5,"favorite_count":2,"up_vote_count":20,"down_vote_count":0,"view_count":12899,"score":20,"question_id":975286,"title":"SqlServer is in script upgrade mode","body":"<p>Vista just finished one of its many updates. After restarting my computer I try connecting to SqlServer2008 instance with Sql Server Management Studio and I get this error:</p>\n\n<p>Error connecting to '...\\MSSQLSERVER2008'.\nAdditional information:\nLogin failed for user '...'. Reason: Server is in script upgrade mode. Only administrator can connect at this time. (Microsoft SQL Server, Error: 18401).</p>\n\n<p>Pressing help gets me to an internet page saying there's no additional information.</p>\n\n<p>Thx Vista &amp; Updates. Anyone an idea because on the internet I can't find anything about this issue.</p>\n"},{"tags":["sql-server-2008","stored-procedures","where-clause"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":2,"question_id":13041972,"title":"Conditional WHERE clause","body":"<p>Question is simple - I believe answer may be simple too.</p>\n\n<p>System is SQL Server 2008 R2.</p>\n\n<p>There  is a stored procedure <code>sp_WHYWHYWHY</code> which takes 3 parameters - 2 are dates and one is supplier code.</p>\n\n<p>The <code>WHERE</code> clause in the statement looks something like this:</p>\n\n<pre><code>OrderDate BETWEEN @StartDate AND @EndDate\nAND SupplierCode = @SupplierCode\n</code></pre>\n\n<p>The business process has changed - as it always will. So now in the supplier code there is only one supplier (let's say <code>YY</code>)who is now aligned, business-wise, to another supplier (let's say <code>ABC</code>).</p>\n\n<p>Hence the code needs to say when querying for <code>ABC</code> - include <code>YY</code> as well.</p>\n\n<p>Something like</p>\n\n<pre><code>OrderDate BETWEEN @StartDate AND @EndDate\nAND SupplierCode = CASE WHEN @SupplierCode = 'ABC' THEN 'YY','ABC' ELSE @SupplierCode END\n</code></pre>\n\n<p>I know you can't write this like that - but that's just what the end result should be.</p>\n\n<p>How can I do this, really?</p>\n\n<p>Thanks for taking out time to read &amp; answer.</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":13043002,"title":"How to sort varchar type column that contain both string and numeric values","body":"<p>I have a table that has column name \"BatchNo\" and it contain both string and numeric values together. when i typed a select query i got following results.</p>\n\n<p><img src=\"http://i.stack.imgur.com/VRWHf.jpg\" alt=\"enter image description here\"></p>\n\n<p>i want to sort \"BatchNo\" column in following format</p>\n\n<p><img src=\"http://i.stack.imgur.com/f5Zwo.jpg\" alt=\"enter image description here\"></p>\n\n<p>In my problem future batches may be have a,b,c .... letters with numeric values or only numeric values. how can i sort this column ? Hope you guys can help me to get some solution.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":804,"score":2,"question_id":4052976,"title":"sql-server-2008: how do i sort the results of a procedure?","body":"<p>i am running:</p>\n\n<pre><code>exec sp_who \ngo\n</code></pre>\n\n<p>is it possible for me to sort by a field like:</p>\n\n<pre><code>exec sp_who order by dbname\ngo\n</code></pre>\n\n<p>?</p>\n\n<p>i would i accomplish this?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":180,"score":2,"question_id":11985328,"title":"Prevent the insertion of duplicate rows using SQL Server 2008","body":"<p>I am trying to insert some data from one table into another but I would like to prevent the insertion of duplicate rows.  I have currently the following query:</p>\n\n<pre><code>INSERT INTO Table1\n(\n    Table1Col1,\n    Table1Col2,\n    Table1Col3,\n    Table1Col4,\n    Table1Col5\n)\nSELECT\n    Table2Col1,\n    Table2Col2 = constant1,\n    Table2Col3 = constant2,\n    Table2Col4 = constant3,\n    Table2Col5 = constant4\nFROM Table2\nWHERE\n    Condition1 = constant5\nAND\n    Condition2 = constant6\nAND\n    Condition3 = constant7\nAND\n    Condition4 LIKE '%constant8%'\n</code></pre>\n\n<p>What I do not know is that the row I am trying to insert from Table2 into Table1 might already exist and I would like to prevent this possible duplication from happening and skip the insertion and just move onto inserting the next unique row.  </p>\n\n<p>I have seen that I can use a WHERE NOT EXISTS clause and use of the INTERSECT keyword but I did not fully understand how to apply it to my particular query as I only want to use some of the selected data from Table2 and then some constant values to insert into Table1.</p>\n\n<p>EDIT:</p>\n\n<p>I should add that the columns TableCol2 through to TableCol5 don't actually exist in the result set and I am just populating these columns alongside Table2Col1 that is returned.</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2","restore","database-backups"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":428,"score":1,"question_id":11877102,"title":"Can we restore database backup of SQL Server 2008 R2 Express to SQL Server 2008 Express ","body":"<p>I have a database backup in \"SQL Server 2008 R2\", Can i store this database backup in \"SQL 2008 Express\" ?</p>\n\n<p>Anyone who have knowledge about SQL-2008 kindly share to me.</p>\n"},{"tags":["visual-studio","sql-server-2008","tfs","tfs2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13041672,"title":"thinking of migrating to tfs 2012","body":"<p>I am using tfs 2010 /sql server 2008 r2 with vs.net 2010 at the moment. Thinking of upgrading tfs to 2012. Has anyone tried this? is this relatively easy? Should I upgrade to vs.net 2012 too? does it still work with sql server 2008 r2?</p>\n"},{"tags":["php","sql","sql-server-2008","php-5.4"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13041623,"title":"PHP MSSQL 2008R2 Help employee attendance faster code needed","body":"<p>i have a Employee database and it has a MSSQL server 2008 R2 and PHP 5.4 on iis7.5 the system all works ok but i have had a request to add and employee attendance system witch i have done but i dont like the code i have used and it is very slow we have 350+ employees current employees on the attendance and it slow to load </p>\n\n<p>This code finds the days in the month selected by default is the current month</p>\n\n<p>Then will get the employees from the database and for each employee it will query the database for each day in the month WITH SQL WHERE PRN = $PRN AND '$date' BETWEEN Sdate AND Edate ORDER BY id DESC</p>\n\n<p>if there is no match it will return NULL</p>\n\n<p>if it finds a record that matches the PRN and day is BETWEEN the start and end dates it will return the leave record found </p>\n\n<p>In the database table attendance leave is set with Pay Roll Number (PRN ) start date ( Sdate ) and End date ( Edate ) </p>\n\n<p>so the code below is what i have written and it is what i am using but i would like it if anyone knows how i could do this better or more efficient also page load time are becoming a problem</p>\n\n<pre><code>$de= date(\"d\");\n    $m= date('m');\n    $y= date('y');\n    if($year) {\n        $m= date('m',mktime(0,0,0,$month,1,$year));\n        $y= date('y',mktime(0,0,0,$month,1,$year));\n    }\n        $start_day = 1;\n        $num = cal_days_in_month(CAL_GREGORIAN, $m, $y);\n\n    for($i=0; $i&lt;$num; $i++){\n    echo '&lt;th class=\"attdate\" scope=\"col\" abbr=\"\"&gt;'.date('d/m',mktime(0,0,0,$m,($start_day+$i),$y)).'&lt;/th&gt;';\n    }\n    echo ' &lt;/tr&gt;';\n    $index=0;\n    foreach ( $search_result as $display_recent_result ) {\n    $prn = $display_recent_result-&gt;PRN;     \n    $index++;\n    echo '&lt;tr&gt;';\n\n    for($i=0; $i&lt;$num; $i++) {      \n    $date = date('Y-m-d',mktime(0,0,0,$m,($start_day+$i),$y));  \n    $state = attendance::find_by_PRN($prn, $date);      \n        if($state) {\n            $cat = attendance_category::find_by_id($state-&gt;CategoryID);\n            echo \"&lt;td height=\\\"32\\\" headers=\\\"$state-&gt;id\\\" class=\\\"$cat-&gt;Code\\\"&gt;\".$cat-&gt;Code.\"&lt;/td&gt;\";\n        } else {\n            echo \"&lt;td&gt;&amp;nbsp;&lt;/td&gt;\";\n        }       \n    }       \n    echo '&lt;/tr&gt;';\n    } \n    echo \"&lt;/table&gt;\";\n</code></pre>\n\n<p>This is the query Function </p>\n\n<pre><code>    public static function find_by_PRN($PRN, $date) {\n    $result_array = self::query(\"SELECT TOP 1 id, CategoryID FROM \".static::$table_name.\" WHERE PRN = $PRN AND '$date' BETWEEN Sdate AND Edate ORDER BY id DESC\");\n    return !empty($result_array) ? array_shift($result_array) : false;\n}\n</code></pre>\n\n<p>This is the Employees query </p>\n\n<pre><code>public static function display_attendance ( $sort=NULL ) {      \n    if($sort==999){ $sortsql=NULL;  }elseif($sort&gt;0){ $sortsql = 'AND AreaPosition = '. \"'$sort'\"; } else {$sortsql =NULL; }        \n    //$sql =\"SELECT * FROM \" . self::$table_name . \" WHERE Attendance = 1 AND CurrentEmployee = 1 $sortsql ORDER BY SURNAME \";\n\n                $sql=\"(SELECT PRN, NAME, SURNAME, Photo FROM \". self::$table_name .\" WHERE Attendance = 1 AND CurrentEmployee = 1 $sortsql )\n                        UNION\n                    (SELECT PRN, NAME, SURNAME, Photo FROM \". self::$table_name2 .\" WHERE Attendance = 1 AND CurrentEmployee = 1 $sortsql )\n                    ORDER BY SURNAME\";\n\n    return self::find_by_sql($sql);\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":13033645,"title":"Archiving Large Table (SQL Server 2008)","body":"<p>I have a very large table being filled with about 100s of million records each quarter.</p>\n\n<p>I manually move data from the existing table to another database using <a href=\"http://sqlserverperformance.wordpress.com/2011/08/13/gradually-deleting-data-in-sql-server/\" rel=\"nofollow\">this script</a>, to minimize the backup size, and to off load the production database when performing queries.</p>\n\n<p>Is there any better way, for example, some scheduled script that will move data from the production database to some other database and then delete the records from the source database every day or week efficiently? </p>\n\n<p>Note that my log file is growing rapidly due to the high number of INSERTs into this table, also when I move data to the archive database, DELETEs will be logged.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","database-restore"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13039345,"title":"SQL Server 2008 R2: Restore a single filegroup","body":"<p>Not sure if this is a duplicate of <a href=\"http://stackoverflow.com/questions/2951016/sql-server-2005-partial-filegroup-restore-on-qa-database\">SQL Server 2005: Partial Filegroup restore on QA database</a>, but if so then I apologise (even though it was not answered).</p>\n\n<p>I have a database on SQL2008R2 with multiple (3) filegroups. There are production and development copies of this database on separate servers.</p>\n\n<p>I have created a filegroup backup of the PRIMARY filegroup from production and wish to restore it on the development server. I do not want to try and backup/restore the entire database as one of the filegroups contains nearly 1TB of data and the servers are geographically distant.</p>\n\n<p>I have tried restoring the filegroup backup using \"with partial, recovery\" and I now have access to the data in that filegroup, but I have lost access to the data in the other filegroups (I am testing this on a 3rd server for now so I have not really lost anything as such).</p>\n\n<p>I am not even sure that what I am trying to do is possible (and it is starting to look as if it is not), can anybody shed any light on what else I might to to acheive my goal.</p>\n\n<p>Thanks.</p>\n"},{"tags":["java","sql-server-2008","jdbc"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":955,"score":0,"question_id":10928982,"title":"JDBC driver class not supported with sql server 2008","body":"<p>in my java code JDBC driver class is not supported with ms sql server 2008 while it works perfectly with ms sql server 2005</p>\n\n<p>i have put jdbc driver class  \"com.microsoft.sqlserver.jdbc.SQLServerDriver\" </p>\n\n<p>MY CODE IS</p>\n\n<pre><code>import java.sql.*;\n\n  public class MysqlConnect{\n  public static void main(String[] args) {\n  System.out.println(\"MySQL Connect Example.\");\n  Connection conn = null;\n  String url = \"jdbc:sqlserver://SQLSERVERIP:1433;\";\n  String dbName = \"DatabaseName=DBNAME\";\n  String driver = \"com.microsoft.sqlserver.jdbc.SQLServerDriver\";\n  String userName = \"sa\"; \n  String password = \"password\";\n  try {\n  Class.forName(driver).newInstance();\n  conn = DriverManager.getConnection(url+dbName,userName,password);\n  System.out.println(\"Connected to the database\");\n  conn.close();\n  System.out.println(\"Disconnected from database\");\n  } catch (Exception e) {\n  e.printStackTrace();\n  }\n }\n}    \n</code></pre>\n\n<p>while i am trying to connect it gives an error</p>\n\n<pre><code>com.microsoft.sqlserver.jdbc.SQLServerException: Cannot open database \"hj_cnb_ci\n\" requested by the login. The login failed.\n        at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError\n(SQLServerException.java:197)\n        at com.microsoft.sqlserver.jdbc.TDSTokenHandler.onEOF(tdsparser.java:246\n)\n        at com.microsoft.sqlserver.jdbc.TDSParser.parse(tdsparser.java:83)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.sendLogon(SQLServerC\nonnection.java:2529)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.logon(SQLServerConne\nction.java:1905)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.access$000(SQLServer\nConnection.java:41)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection$LogonCommand.doExecu\nte(SQLServerConnection.java:1893)\n        at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:4615)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLSe\nrverConnection.java:1400)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.connectHelper(SQLSer\nverConnection.java:1045)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.login(SQLServerConne\nction.java:817)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.connect(SQLServerCon\nnection.java:700)\n        at com.microsoft.sqlserver.jdbc.SQLServerDriver.connect(SQLServerDriver.\njava:842)\n        at java.sql.DriverManager.getConnection(Unknown Source)\n        at java.sql.DriverManager.getConnection(Unknown Source)\n        at MysqlConnect.main(MysqlConnect.java:14)\n</code></pre>\n\n<p>plz help me to sort out this issue..</p>\n"},{"tags":["sql-server-2005","sql-server-2008","database-backups","downgrade"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":15982,"score":4,"question_id":849678,"title":"Downgrading SQL server 2008 to SQL Server 2005","body":"<p>Are there any issues backing up a database from SQL Server 2008, and then importing it into SQL Server 2005? I had upgraded to SQL Server 2008, but 2008 seems to be too problematic so now I want to downgrade. Are there any problems in doing this?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","sql-server-2008-r2","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":13038964,"title":"SQL Server - Select between two number ranges in a varchar field with text and numbers","body":"<p>I have a table with ranges of numbers from 0-2000000. I can use a between statement to get the records of things if I do a BETWEEN 50 AND 100. That works. </p>\n\n<p>But the problem I'm running into is since this column is a varchar if there are any records with a something in the string as \"1FD32\", I can't select between it. SQL server can't convert the \"BETWEEN 50 AND 100\" because it is looking for an int. How can i get all the records between these ranges, and ignore any with letters in them?</p>\n"},{"tags":["sql-server","vb.net","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13038389,"title":"Proper way to execute a large SQL query in vb.net","body":"<p>I have a SQL query that I used my vb.net application to run it, but i have a problem when It exceeds to its command timeout property. I set it to 300, any tips or suggestions?</p>\n\n<p>here is the snippet of my code in vb.net</p>\n\n<pre><code>  .ExecuteQuery(\"exec spCentrIX_PracticeSet '\" &amp; oCompany &amp; \"','\" &amp; .SecDatabaseName &amp; \"'\", sDataSet)\n  Application.DoEvents()\n  .ExecuteQuery(\"exec spCentrIX_PracticeSet '\" &amp; oCompany &amp; \"','\" &amp; .SetDatabaseName &amp; \"'\", sDataSet)\n  Application.DoEvents()\n  .ExecuteQuery(\"exec spCentrIX_PracticeSet '\" &amp; oCompany &amp; \"','\" &amp; .TranDatabaseName &amp; \"'\", sDataSet)\n  Application.DoEvents()\n</code></pre>\n\n<p>same script that run three times. this script gets all the data from the 3 databases which runs okie. however, when it is running...it exceeds the connection timeout of my code.</p>\n"},{"tags":["sql-server-2008","spatial","simple.data"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13035158,"title":"Passing SqlGeometry To Simple.Data Stored Procedure","body":"<p>I am trying to pass a SqlGeometry type to a stored procedure using Simple.Data and SQL Server 2008.  The stored procedure definition looks like this:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[spUpdateDamLocation]\n(\n  @DamID int,\n  @Shape geometry\n)\n</code></pre>\n\n<p>The call I am using for Simple.Data looks like this:</p>\n\n<pre><code>var db = Simple.Data.Database.OpenConnection(dbConn);\ndb.spUpdateDamLocation(DamID: damLocation.DamID, Shape: damLocation.Shape);\n</code></pre>\n\n<p>Where <em>dbConn</em> is a connection string, <em>damLocation.DamID</em> is an integer and <em>damLocation.Shape</em> is a SqlGeometry object. </p>\n\n<p>The error I am getting is:</p>\n\n<pre><code>System.ArgumentException: UdtTypeName property must be set for UDT parameters.\nat System.Data.SqlClient.SqlParameter.Validate(Int32 index, Boolean isCommandProc)\nat System.Data.SqlClient.SqlCommand.SetUpRPCParameters(_SqlRPC rpc, Int32 startCount,     Boolean inSchema, SqlParameterCollection parameters)\nat System.Data.SqlClient.SqlCommand.BuildRPC(Boolean inSchema, SqlParameterCollection parameters, _SqlRPC&amp; rpc)\nat System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\nat System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\nat System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\nat System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\nat System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\nat System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader()\nat Simple.Data.Ado.DbCommandExtensions.TryExecuteReader(IDbCommand command)\nat Simple.Data.Ado.ProcedureExecutor.ExecuteReader(IDbCommand command)\nat Simple.Data.Ado.ProcedureExecutor.Execute(IDictionary`2 suppliedParameters, IDbTransaction transaction)\nat Simple.Data.Ado.ProcedureExecutor.Execute(IDictionary`2 suppliedParameters)\nat Simple.Data.Ado.AdoAdapter.Execute(String functionName, IDictionary`2 parameters)\nat Simple.Data.Database.ExecuteFunction(Object&amp; result, ExecuteFunctionCommand command)\nat Simple.Data.DataStrategy.TryInvokeFunction(String functionName, Func`1 getFunctionArguments, Object&amp; result)\nat Simple.Data.DataStrategy.TryInvokeMember(InvokeMemberBinder binder, Object[] args, Object&amp; result)\nat CallSite.Target(Closure , CallSite , Object , Int32 , SqlGeometry )\nat System.Dynamic.UpdateDelegates.UpdateAndExecuteVoid3[T0,T1,T2](CallSite site, T0 arg0, T1 arg1, T2 arg2)\n</code></pre>\n\n<p>Is there a way to specify a specific UDT of the parameter in Simple.Data?  If I were just using ADO.NET I would do something like this:</p>\n\n<pre><code>SqlParameter sqlParam = sqlCmd.Parameters.Add(\"@Shape\", SqlDbType.UDT);\nsqlParam.UdtTypeName = \"geometry\";\nsqlParam.Value = myTypeOfSqlGeometry;\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2008-r2","sql-management-studio"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13037863,"title":"Clarification as to why EXECUTE AS USER/LOGIN is not returning the expected results?","body":"<p>I am running the following query against a database:</p>\n\n<pre><code>execute as user = 'domain\\username'\nselect * from fn_my_permissions(null, 'DATABASE')\norder by subentity_name, permission_name\nrevert;\n</code></pre>\n\n<p>But the following error gets thrown:</p>\n\n<p><code>Cannot execute as the database principal because the principal \"dev\\spadmin\" does not exist, this type of principal cannot be impersonated, or you do not have permission.</code></p>\n\n<p>The user is the dbo of the database, and when I open up the properties in management studio, I can see that it is associated with that login.  Running <code>EXECUTE AS LOGIN = 'domain\\username'</code> does return results, on the other hand.  And if I explicitly run <code>EXECUTE AS USER = 'dbo'</code>, I get results.  I also have a different database where this same scenario returns results with both <code>EXECUTE AS USER</code> and <code>EXECUTE AS LOGIN</code>.</p>\n\n<p>In another scenario with a different user, I have ran <code>EXECUTE AS LOGIN = 'domain\\username'</code> and I do not get results, but I do get results with <code>EXECUTE AS USER = 'domain\\username'</code>.</p>\n\n<p>Both users in these scenarios are associated with logins that are members of <code>db_owner</code> for the database.</p>\n\n<p>Can anybody tell me why these queries are not returning the results that I expect?  And let me know if I am missing any important information.  Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":13037205,"title":"SQL to List Common Values of One Column Based on an Input List of Values From Another?","body":"<p>We have an ASP.NET application with SQL Server 2008 back end.\nWe have the following setup in our SpecimenEvents table:</p>\n\n<pre>EventID SpecimenID  EventType\n      1        101        A       \n      2        102        A\n      3        103        A\n      4        101        B\n      5        103        B\n      6        101        C</pre>\n\n<p>Given a list of SpecimenIDs as input -- how would you write a query to return just those EventType(s) COMMON to all SpecimenIDs in the input list?\nFor example: </p>\n\n<p>a SpecimenID input list of (101,102,103) should return 'A'</p>\n\n<p>a SpecimenID input list of (101) should return 'A','B','C'</p>\n\n<p>a SpecimenID input list of (101,103) should return 'A', 'B' ...</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13036717,"title":"multiple keyword search in sql","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2474229/keyword-to-sql-search\">Keyword to SQL search</a>  </p>\n</blockquote>\n\n\n\n<p>I am using SQL SERVER 2008 &amp; I am given to task to search for specific keywords( close to 100) relating to technical support notes. There are 20 columns and 1 million rows. The keywords I am looking is in 3 specific columns. How can I do it?</p>\n\n<p>Column header : date, week, Qtr, Agent, Manager, Customer,Problem, Description, Solution,Order #, </p>\n\n<p>I have to search for the keywords from Problem, Description, Solution columns. \nProblem : nvarchar\nDescription: nvarchar \nSolution : ntext </p>\n\n<p>Keywords : bluetooth, cd, dvd, hard drive, motherboard, power supply, battery, ac adapter, windows, blue screen. </p>\n\n<p>Sample data:\nProblem :noise from fan Description : noise from fan Solution: noise from fan and system heating up. has A20 BIOS. checked support site and BIOS update available. customer to try that and get back to us with results</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":32,"score":3,"question_id":13036917,"title":"SQL Server Views - Index Usage","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/8700126/index-is-not-getting-applied-on-indexed-view\">Index is not getting applied on Indexed View</a>  </p>\n</blockquote>\n\n\n\n<p>Is there a way to make the views to use only the index that I created on them, and not the ones on the base tables?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13036733,"title":"How to insert muliple rows to an existing table","body":"<p>Hi i am trying to insert 10000 records in to a table, by using this command. </p>\n\n<pre><code>CREATE TABLE mytable(\n    id            INTEGER      PRIMARY KEY,\n    TEXT          INTEGER       NOT NULL,\n    OLDID         iNTEGER       NOT NULL,\n    Firstname      VARCHAR(50)  NOT NULL,\n    Middlename    VARCHAR(50)   NULL,\n    last_name     VARCHAR(75)   NOT NULL,\n    EMAIL         VARCHAR(225)  NOT NULL,\n    STATUS        BOOL          NOT NULL\n);\n\nDECLARE @i int\ndeclare @rows_to_insert int\nSET @i = 6\nset @rows_to_insert = 10000\n\nWHILE @i &lt; @rows_to_insert\n    BEGIN\n        INSERT INTO mytable VALUES (@i, @i,@i,'john'+@i,null,'Test','john'+@i+'@someone.com','Active');\n        set @i = @i+1\n    END\n</code></pre>\n\n<p>But i am getting this Error.</p>\n\n<blockquote>\n  <p>Msg 8101, Level 16, State 1, Line 8\n  An explicit value for the identity column in table 'mytable' can only be specified when a column list is used and IDENTITY_INSERT is ON.</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":86,"score":2,"question_id":13034007,"title":"SQL split a result properly","body":"<p>I have a result from a request that gives me thousands of lines, and i want to split it into little temporary tables of 10k rows each, with an incremental number from 1 up to 10 000. Lets say i have a big query of 25 000 rows, what i want is to split it in 2 tables of 10k and a third table of 5k. Of course I dont know that exact number of pages i will have to split into.</p>\n\n<blockquote>\n  <p>My first query with all the rows is named [#DECLARATION] and have a number NumeroDeclaration that is 0 for page 1, 1 for page 2, etc. to 9. Each 10 000 of rows it is incremented from 0 to 10 000.</p>\n</blockquote>\n\n<p>at this time my request looks like this:</p>\n\n<pre><code>    --Page 1\n    SELECT * INTO [#PAGE1] FROM [#DECLARATION] WHERE NumeroDeclaration =0 ORDER BY NumeroTransaction;\n        --Numerotation\n        WITH upd AS (SELECT NumeroDeclaration, ROW_NUMBER() OVER (ORDER BY NumeroTransaction) AS Numtemp FROM [#PAGE1])\n        UPDATE upd SET NumeroDeclaration = Numtemp\n    --Page 2\n    SELECT * INTO [#PAGE2] FROM [#DECLARATION] WHERE NumeroDeclaration =1 ORDER BY NumeroTransaction;\n        --Numerotation\n        WITH upd AS (SELECT NumeroDeclaration, ROW_NUMBER() OVER (ORDER BY NumeroTransaction) AS Numtemp FROM [#PAGE2])\n        UPDATE upd SET NumeroDeclaration = Numtemp\n    --Page 3\n    --etc.... to Page 10...\n</code></pre>\n\n<p><strong>I have to do this over 10 pages, and it works, but is there another <em>shorter</em>/classier way to do it?</strong></p>\n\n<p>Im using SQL SERVER 2008 Thanks for reading</p>\n"}]}
{"total":21073,"page":8,"pagesize":100,"questions":[{"tags":["sql-server-2008","stored-procedures","linked-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13017428,"title":"inserting to a local table from a linked stored procedure","body":"<p>I have a sproc that is called from .net code which does an update on a local table and then is supposed to insert to a different local table values that are obtained from a remote procedure call to a linked server.</p>\n\n<p>I get this error message every time I try to insert the results from the linked server.  If i take out the insert into statement, but leave the remote procedure call in place, it works fine.  Here is the error:</p>\n\n<blockquote>\n  <p>System.Data.SqlClient.SqlException: The operation could not be\n  performed because OLE DB provider \"SQLNCLI10\" for linked server\n  \"MyLinkedServer\" was unable to begin a distributed transaction. OLE DB\n  provider \"SQLNCLI10\" for linked server \"MyLinkedServer\" returned\n  message \"The transaction manager has disabled its support for\n  remote/network transactions.\".</p>\n</blockquote>\n\n<p>this is the simple code I'm using:</p>\n\n<pre><code>INSERT INTO MyLocalTable\nEXEC [MyLinkedServer].[MyRemoteDatabase].[dbo].[usp_MySproc] @MyParam\n</code></pre>\n\n<p>any ideas what's wrong here or any suggestions of how I can insert the results from the remote procedure to a local table?</p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13035250,"title":"SET TRANSACTION ISOLATION LEVEL Scope on stored procedure","body":"<p>I am creating a stored procedure and I do not want any locking through out the script. I am sure that I need to state \"SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\" in the beginning of the script. But I am not sure how to start after the statement. One of the example from Microsoft show that start with \"BEGIN TRANSACTION\" and end with \"END TRANSACTION\". There is someone who starts without any  BEGIN and END statement after \"SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\". Please, suggest me for the right way of using \"SET TRANSACTION ISOLATION LEVEL\" statement to achieve my goal.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/aa259216(v=sql.80).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/aa259216(v=sql.80).aspx</a></p>\n\n<pre><code>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\nGO\nBEGIN TRANSACTION\nSELECT * FROM publishers\nSELECT * FROM authors\n...\nCOMMIT TRANSACTION\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/7975936/sql-server-how-to-set-default-isolation-level-for-the-entire-stored-procedure\">SQL Server: how to set default isolation level for the entire stored procedure?</a></p>\n\n<pre><code>BEGIN\nSET TRANSACTION ISOLATION LEVEL READ COMMITTED\n -- will a transaction level for a atomic transaction created by SQL Server for this statement be READ COMMITTED \nSELECT * FROM T\nEND\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13034596,"title":"sql insert using charindex","body":"<p>I am using SQL Server 2008</p>\n\n<p>I have this INSERT statement</p>\n\n<pre><code>INSERT INTO [dbo].[TempSequences]\n(Title, Sequence, FileTrackingTag)\nSELECT Title, Sequence, FileTrackingTag\nFROM   [dbo].[MasterSequence]\nWHERE  charindex(',' + FileTrackingTag + ',', ',' + @filetag + ',') &gt; 0;\n</code></pre>\n\n<p>Where FileTrackingTag is the one associated with said title and sequence.  However I am giving it a string of these tags</p>\n\n<p>i.e.</p>\n\n<pre><code> 'tag1,tag2,tag3,tag4'\n</code></pre>\n\n<p>How can I put the correct tag in there?  Thanks</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":98,"score":2,"question_id":13034584,"title":"PATINDEX and CHARINDEX returning different answers SQL Server 2008","body":"<p>I have a single table for which I wish to find all the instances where <code>0</code> is the <strong>last</strong> character in a string field.  I tried this by using two methods and they each returned different results.  </p>\n\n<p>This first query seemed to actually return the correct answer</p>\n\n<pre><code>select * from icd\n    where CHARINDEX('0',icd,LEN(icd)) =LEN(icd) \n</code></pre>\n\n<p>this one does not catch all of the answers</p>\n\n<pre><code>select * from icd\n    where PATINDEX('%0%',icd) = LEN(icd)\n</code></pre>\n\n<p>using </p>\n\n<pre><code>select t.ICD as theCharIndex,x.ICD as thePatIndex from\n(\n\nselect * from icd\n    where CHARINDEX('0',icd,LEN(icd)) =LEN(icd) \n) t\nleft join\n(\nselect * from icd\n    where PATINDEX('%0%',icd) = LEN(icd)\n) x on x.ICD=t.ICD\nwhere x.ICD is null\n</code></pre>\n\n<p>I found the set of data that <code>CHARINDEX</code> picked up that <code>PATINDEX</code> did not. I even did</p>\n\n<pre><code>update icd\nset ICD=RTRIM(icd)\n</code></pre>\n\n<p>Why would <code>PATINDEX</code> indiscriminately leave out some rows?</p>\n"},{"tags":["sql-server","sql-server-2008","primary-key","clustered-index"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":13029413,"title":"Sql Server table structure","body":"<p>I have the following data i want to upload:</p>\n\n<pre><code>(Pair)    (Date)    (Time)       (Bid)   (Ask)\nEurUsd  01/01/2012  18:04:01    1.55037 1.55137\nEurUsd  01/01/2012  18:04:20    1.55018 1.55118\nEurUsd  01/01/2012  18:04:22    1.55031 1.55131\nEurUsd  01/01/2012  18:04:36    1.55045 1.55145\nEurUsd  01/01/2012  18:04:40    1.55058 1.55158\nEurUsd  01/01/2012  18:04:40    1.5508  1.5518\n\nGbpUsd  01/01/2012  18:06:11    1.55097 1.55197\nGbpUsd  01/01/2012  18:06:22    1.55117 1.55217\nGbpUsd  01/01/2012  18:06:24    1.55128 1.55228\nGbpUsd  01/01/2012  18:06:38    1.55098 1.55198\n</code></pre>\n\n<p>The data types are as follows: Nchar(6), Date, Time, Decimal, Decimal.</p>\n\n<p>Unfortunately i cant guarantee that the rows will be unique on a minute basis. I will also be adding data to this table on a Daily basis &amp; other Pairs.</p>\n\n<p>Question 1). What is the best way to set up a PK for the above data. Im assuming i should just set up a new column called \"Id\", of type BigInt, and set its \"Is Identity\" to Yes? Then set the PK to be \"Id\"?</p>\n\n<p>Question 2). Clustered Index, based on \"Pair\",\"Date\", \"Time\"?</p>\n\n<p>Question 3). Im assuming that if i set up an \"Id\" column in the table, i would need to have ColumnMapping on any sqlbulkcopy operation i was using to upload the data? Or is it not possible to load data into the column once its \"Is Identity\" property is set?</p>\n\n<p>Thanks for your time.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","umbraco","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":13031484,"title":"\"Cannot open database - login failed\" . Works in Management Studio, not code","body":"<p>Oh yes, the famous error:</p>\n\n<blockquote>\n  <p>Cannot open database \"MYDBNAME\" requested by the login. The login failed. Login failed for user 'USERNAME'.</p>\n</blockquote>\n\n<p><strong>Let me explain my situation:</strong></p>\n\n<p>I have a database server, which has a SA account and my user account. The user has the correct mappings to my database (dbowner).</p>\n\n<p>I can open the database with this user, using SQL Management Studio 2008 R2, both on the SQL server itself (using localhost), and on my frontend server.</p>\n\n<p>However, when I run my application, I get the login failed error. </p>\n\n<p>Strange thing is I have a test application and a production application on our frontend server. The test application has test databases on the same database server, and there are no login problems here. The only difference between the two, are the prefix which differs from \"TEST\" to \"PROD\". The test application works, the production however, doesn't. The user mappings and seem it should work on both.</p>\n\n<p>Any ideas?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Our connectionstring:</p>\n\n<pre><code>&lt;add key=\"umbracoDbDSN\" value=\"Server=Websqlsrv01;Database=PROD_Databasename;User ID=umbraco_user;Password=password;Trusted_Connection=False\" /&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2008","sum"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13033455,"title":"Return sum of all sales values and sales value for each product","body":"<p>I have a query that will be like this</p>\n\n<pre><code>SELECT\n    ProductID,\n    ProductSales,\n    ProductLocationName\nFROM\n    ProductLocation\nWHERE\n    ProductLine=@ProductLine\n</code></pre>\n\n<p>So my sample results could be like this</p>\n\n<pre><code>ProductID    ProductSales   ProductLocationName\n1            $2             Boston\n1            $2             Chicago\n2            $8             Boston\n</code></pre>\n\n<p>There are some <code>productID/ProductSales</code> combinations which are repeated if the <code>ProductLocationName</code> is different but what I need to return is the following:</p>\n\n<p>I need to return what I am returning above in my sample results but also in addition to this I need to sum all <code>ProductSales</code> values except for duplicate <code>ProductID/ProductSales</code> combinations.</p>\n\n<p>Example from above:</p>\n\n<pre><code>ProductID 1 + ProductID 2\n$2 + $8 = $10\n</code></pre>\n\n<p>Note that I did not add $2 twice since that <code>prodID/Sales</code> value is repeated in the results, however I still need to return the 3 rows above since I have to show all 3 rows in my repeater.</p>\n\n<p>Hope I am being clear, in addition <code>ProductID</code> &amp; <code>ProductLocation</code> (and there will be other columns included in my query), I need </p>\n\n<ol>\n<li><p><code>ProductSales</code> (as displayed in <code>SampleResults</code> above) for each <code>ProductID</code>. I know that <code>SUM(ProductSales)</code> will get me this.</p></li>\n<li><p><code>SUM</code> of <code>ProductSales</code> for all unique <code>ProductID</code> values ($2 + $8 = $10)</p></li>\n</ol>\n\n<p>I would like to do all of this in the same stored procedure if possible.</p>\n\n<p>My main concern is how to get point 2, meaning SUM all of the <code>ProductSales</code> values, in my example $2+$8</p>\n\n<p>Please let me know if you need any more information, this is  my first post here.</p>\n"},{"tags":["sql-server-2008","permissions","schema","multi-tenant"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13032818,"title":"SQL Server : View permission to table","body":"<p>Is it possible to grant a user access to a view but restrict the user from accessing the table the view selects from? </p>\n\n<pre><code>CREATE TABLE [dbo].[tUsers](\n    [ID] [int] IDENTITY(1,1) NOT NULL,\n    [Username] [nvarchar](50) NULL,\n    [Password] [nvarchar](50) NULL,\n    [TenantID] int\n) ON [PRIMARY]\n\nCREATE VIEW [scmTenant1].[vUsers]\nAS\nSELECT     ID, Username, Password\nFROM         dbo.tUsers\nWHERE        TenantID = 1\n</code></pre>\n\n<p>The SQL Server user account (<code>usrTenant1</code>) has access to schema <code>scmTenant1</code> but does not have access to the <code>dbo</code> schema. I log into SQL Server Management Studio as <code>usrTenant1</code> and try executing this query:</p>\n\n<pre><code>SELECT * FROM scmTenant1.vUsers\n</code></pre>\n\n<p>Gives me error:</p>\n\n<blockquote>\n  <p><em>The SELECT permission was denied on the object 'tUsers', database 'Sandbox', schema 'dbo'.</em> </p>\n</blockquote>\n\n<p>If I grant this account access to the <code>dbo</code> schema the query executes fine.</p>\n\n<p>I think what I would really like to grant the view permission to the table. But my question is can you grant a user access to a view and restrict that user from accessing the underlying table the view selects from?</p>\n"},{"tags":["c#","sql-server-2008","entity-framework","permissions"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13033458,"title":"Manage entity access and permissions with Entity Framework","body":"<p>In a web application using Entity Framework 4.1 we use SQL Server Membership to manage user access. However we need to implement a more granular set of roles a permission management.</p>\n\n<p>In the database we have already created the relative tables:</p>\n\n<pre><code>- Roles \n- Permissions \n- UserInRole (roles per user)\n- RolesPermissions (permissions associated to a role) \n</code></pre>\n\n<p>Using attributes on some of the core entities we restrict the access semantically with EF, as example, given a specific user, s/he can see only the relative shipped orders or inherent data.</p>\n\n<p>Now we would like to inject the permissions in it, meaning as example that a <em>customer</em> can see and create orders, while a <em>company</em> (these are two different roles) could only see orders for their products and also print reports.</p>\n\n<p>The idea would be to use attributes also for permissions at entity level and check if the current user owns proper rights when a method is invoked. For instance:</p>\n\n<pre><code>public void BeforeAdd()\n{\n   // Get required permissions for the specific entity (Order as example)\n\n   //Check that current user has permission of creating a new Order \n}\n</code></pre>\n\n<p>Such a method would be called by each entity, allowing to centralize the control over permissions at entity level.</p>\n\n<p>We use MVC as frontend and in there we have already implemented roles and permissions access. We need to make the same with the backend part (containing data layer). These are two separate servers communicating via web services. By implementing permission management on the back end part would strengthen the control over data access.</p>\n\n<p>Is there any pattern or best practice that we could follow (eventually using some built in features of EF) to achieve permissions management?</p>\n"},{"tags":["sql-server-2008","database-design","database-deployment","sparse-columns"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13030023,"title":"what is the risk of using sparse columns instead of normal relational tables?","body":"<p>I have three table that related to one table,in my new design I want to replace the relationship by using sparse columns.\nyou Can see diagram below.</p>\n\n<p><img src=\"http://i.stack.imgur.com/CtIei.png\" alt=\"enter image description here\"></p>\n\n<p>I know I would have Redundancy.but i want to know what is the other risk of this way of design?\nby this new way my queries would be very easy and fast.what is your idea about it?sorry for my bad english,and thanks.</p>\n"},{"tags":["sql","sql-server-2008","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":213,"score":1,"question_id":13020960,"title":"SSIS Variable SQL command for ADO.net source","body":"<p>While this seems like a basic problem, I've been ripping my hair out FOR DAYS trying to get an efficient solution to this. </p>\n\n<p>I have a lookup table of values on a server that I read from and assemble into a string using a C# Script task. I write this string into a variable that I want to pass in as my WHERE parameters inside a large SQL query on a ADO.NET data source (from a different server which I only have read access to) in my data flow. For example, this string would just be something like</p>\n\n<pre><code>  ('Frank', 'John', 'Markus', 'Tom')\n</code></pre>\n\n<p>and I would append that as my WHERE clause. \n I can't read from a variable directly for an ADO.NET data source AND I can't use the 'Expression' property to set my SQL either as my SQL query is over 4000 characters. I could use an Execute SQL Task to run my query, load the results into a recordset and I assume, then loop through the recordset but that's extremely inefficient. </p>\n\n<p>What would be the best way to do this? My end goal is to put these results inside a table on the first server. </p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13029418,"title":"Having trouble using a multiple criteria search bar/button in Site.Master from an SQL server (C# / ASP.Net)","body":"<p>Hey people I'm having a little issue regarding a transfer of variables from Site.Master to another window, the purpose is to make a search function accessed from the whole asp.net web application...</p>\n\n<p>The code which is relevant from Site.Master:</p>\n\n<pre><code>&lt;div class=\"search\"&gt;\n        &lt;asp:Label ID=\"LandID\" runat=\"server\" Text=\"LandID\"/&gt;\n        &amp;nbsp;&lt;asp:TextBox ID=\"txtSearch\" runat=\"server\" /&gt;\n        &amp;nbsp;&lt;asp:Label ID=\"CarBrand\" runat=\"server\" Text=\"CarBrand\" /&gt;\n        &amp;nbsp;&lt;asp:TextBox ID=\"txtSearch2\" runat=\"server\" /&gt;\n        &amp;nbsp;&lt;asp:Label ID=\"Model\" runat=\"server\" Text=\"Model\"/&gt;\n        &amp;nbsp;&lt;asp:TextBox ID=\"txtSearch3\" runat=\"server\" /&gt;\n        &amp;nbsp;&lt;asp:Button ID=\"cmdSearch\" runat=\"server\" Text=\"Search\" Style=\"width: 100px\" OnClick=\"cmdSearch_Click\" /&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>The Code from Site.Master.Cs:</p>\n\n<pre><code>public static string Text { get; set; }\npublic static string Text2 { get; set; }\npublic static string Text3 { get; set; }\nprotected void Page_Load(object sender, EventArgs e)\n{\n\n}\nprotected void cmdSearch_Click(object sender, EventArgs e)\n{\n    Text = txtSearch.Text;\n    Text2 = txtSearch2.Text;\n    Text3 = txtSearch3.Text;\n    Response.Redirect(\"search.aspx\");\n}\n</code></pre>\n\n<p>The code from the search.aspx:</p>\n\n<pre><code>   &lt;asp:GridView ID=\"GridView1\" runat=\"server\" AutoGenerateColumns=\"False\" DataSourceID=\"SqlDataSource1\"\n    OnSelectedIndexChanged=\"GridView1_SelectedIndexChanged\" DataKeyNames=\"ID\"&gt;\n    &lt;Columns&gt;\n        &lt;asp:CommandField ShowSelectButton=\"True\" /&gt;\n        &lt;asp:BoundField DataField=\"ID\" HeaderText=\"ID\" SortExpression=\"ID\" InsertVisible=\"False\"\n            ReadOnly=\"True\" /&gt;\n        &lt;asp:BoundField DataField=\"LandID\" HeaderText=\"LandID\" SortExpression=\"LandID\" /&gt;\n        &lt;asp:BoundField DataField=\"Bilmaerk\" HeaderText=\"Bilmaerk\" SortExpression=\"Bilmaerk\" /&gt;\n        &lt;asp:BoundField DataField=\"Model\" HeaderText=\"Model\" SortExpression=\"Model\" /&gt;\n        &lt;asp:BoundField DataField=\"Variant\" HeaderText=\"Variant\" SortExpression=\"Variant\" /&gt;\n        &lt;asp:BoundField DataField=\"StartYear\" HeaderText=\"StartYear\" SortExpression=\"StartYear\" /&gt;\n        &lt;asp:BoundField DataField=\"SlutYear\" HeaderText=\"SlutYear\" SortExpression=\"SlutYear\" /&gt;\n        &lt;asp:BoundField DataField=\"Volumen\" HeaderText=\"Volumen\" SortExpression=\"Volumen\" /&gt;\n        &lt;asp:BoundField DataField=\"MaxDrej\" HeaderText=\"MaxDrej\" SortExpression=\"MaxDrej\" /&gt;\n        &lt;asp:BoundField DataField=\"AntalCylindre\" HeaderText=\"AntalCylindre\" SortExpression=\"AntalCylindre\" /&gt;\n        &lt;asp:BoundField DataField=\"TopHast\" HeaderText=\"TopHast\" SortExpression=\"TopHast\" /&gt;\n        &lt;asp:BoundField DataField=\"Acceleration\" HeaderText=\"Acceleration\" SortExpression=\"Acceleration\" /&gt;\n        &lt;asp:BoundField DataField=\"Beskrivelse\" HeaderText=\"Beskrivelse\" SortExpression=\"Beskrivelse\" /&gt;\n        &lt;asp:BoundField DataField=\"Effekt\" HeaderText=\"Effekt\" SortExpression=\"Effekt\" /&gt;\n        &lt;asp:BoundField DataField=\"Picture\" HeaderText=\"Picture\" SortExpression=\"Picture\" /&gt;\n    &lt;/Columns&gt;\n&lt;/asp:GridView&gt;\n&lt;selectparameters&gt;\n&lt;asp:ControlParameter ControlID=\"&lt;%=Text1 %&gt;\"&gt;&lt;/asp:ControlParameter&gt;\n&lt;asp:ControlParameter ControlID=\"&lt;%=Text2 %&gt;\"&gt;&lt;/asp:ControlParameter&gt;\n&lt;asp:ControlParameter ControlID=\"&lt;%=Text3 %&gt;\"&gt;&lt;/asp:ControlParameter&gt;\n&lt;/selectparameters&gt;\n&lt;asp:SqlDataSource ID=\"SqlDataSource1\" runat=\"server\" ConnectionString=\"&lt;%$ ConnectionStrings:CarConnectionString %&gt;\"\n    SelectCommand=\"SELECT * FROM [Bil] WHERE (([LandID] LIKE '%' +@LandID+ '%') AND ([Bilmaerk] LIKE '%' +@Bilmaerk+ '%') AND ([Model] LIKE '%' +@Model+ '%'))\"&gt;\n    &lt;SelectParameters&gt;\n        &lt;asp:ControlParameter ControlID=\"Text1\" Name=\"LandID\" PropertyName=\"Text\" Type=\"String\"\n            DefaultValue=\"%\" /&gt;\n        &lt;asp:ControlParameter ControlID=\"Text2\" Name=\"Bilmaerk\" PropertyName=\"Text\" Type=\"String\"\n            DefaultValue=\"%\" /&gt;\n        &lt;asp:ControlParameter ControlID=\"Text3\" Name=\"Model\" PropertyName=\"Text\" Type=\"String\"\n            DefaultValue=\"%\" /&gt;\n    &lt;/SelectParameters&gt;\n&lt;/asp:SqlDataSource&gt;\n</code></pre>\n\n<p>the Relevant code from search.aspx.cs:</p>\n\n<pre><code>   public partial class search : System.Web.UI.Page\n   {\nprotected string Text1 { get; set; }\nprotected string Text2 { get; set; }\nprotected string Text3 { get; set; }\n\nprotected void Page_Load(object sender, EventArgs e)\n{\n    Text1 = SiteMaster.Text;\n    Text2 = SiteMaster.Text2;\n    Text3 = SiteMaster.Text3;\n}\nprotected void GridView1_SelectedIndexChanged(object sender, EventArgs e)\n{\n    Constructor.SelectedCar = GridView1.SelectedRow.Cells[1].Text;\n    Response.Redirect(\"Selected.aspx\");\n}\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":12,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":21350,"score":7,"question_id":646845,"title":"Sql server 2008 log will not truncate. Driving me CRAZY!","body":"<p>I consider myself a very experienced SQL person. But I'm and failing to do these two things:</p>\n\n<ul>\n<li>Reduce the size of the allocated log.</li>\n<li><p>Truncate the log.</p>\n\n<p>DBCC sqlperf(logspace)</p></li>\n</ul>\n\n<p>returns:</p>\n\n<pre><code>Database Name   Log Size (MB)\tLog Space Used (%)\tStatus\nByBox   \t1964.25\t\t30.0657\t\t\t0\n</code></pre>\n\n<p>The following does not work with SQL 2008</p>\n\n<pre><code>DUMP TRANSACTION ByBox WITH TRUNCATE_ONLY\n</code></pre>\n\n<p>Running the following does nothing either</p>\n\n<pre><code>DBCC SHRINKFILE ('ByBox_1_Log' , 1)\nDBCC shrinkdatabase(N'bybox')\n</code></pre>\n\n<p>I've tried backups. I've also tried setting the properties of the database - 'Recover Model' to both 'FULL' and 'SIMPLE' and a combination of all of the above. Also tried setting the compatibility to SQL 2005 (I use this setting as I want to match our production server) and SQL 2008.</p>\n\n<p>No matter what I try, the log remains at 1964.25Mb, with 30% used, which is still growing.\nI'd like the log to go back down near 0% and reduce the log file size to a say 100Mb which is plenty. My database must hate me, it just ignores everything I ask it to do regarding the log.</p>\n\n<p>One further note, the production database has quite a few replicated tables, which I turn off when I perform a restore on my development box by using the following:</p>\n\n<pre><code>-- Clear out pending replication stuff\nexec sp_removedbreplication\ngo\nEXEC sp_repldone @xactid = NULL, @xact_segno = NULL,\n     @numtrans = 0, @time = 0, @reset = 1\ngo\n</code></pre>\n\n<p>Trying:</p>\n\n<pre><code>SELECT log_reuse_wait, log_reuse_wait_desc\nFROM sys.databases\nWHERE NAME='bybox'\n</code></pre>\n\n<p>Returns</p>\n\n<pre><code>log_reuse_wait  log_reuse_wait_desc\n0   NOTHING\n</code></pre>\n\n<p>Any words of wisdom or things to try are all welcome!</p>\n\n<p><hr /></p>\n\n<p>Looking at <a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqldatabaseengine/thread/9f9ae5c5-3031-4963-bb16-c7ed05d9890a/\">this</a> and setting the recovery model to FULL I have tried the following:</p>\n\n<pre><code>USE master\nGO\n\nEXEC sp_addumpdevice 'disk', 'ByBoxData', N'C:\\&lt;path here&gt;\\bybox.bak'\n\n-- Create a logical backup device, ByBoxLog.\nEXEC sp_addumpdevice 'disk', 'ByBoxLog', N'C:\\&lt;path here&gt;\\bybox_log.bak'\n\n-- Back up the full bybox database.\nBACKUP DATABASE bybox TO ByBoxData\n\n-- Back up the bybox log.\nBACKUP LOG bybox TO ByBoxLog\n</code></pre>\n\n<p>which returned:</p>\n\n<pre><code>Processed 151800 pages for database 'bybox', file 'ByBox_Data' on file 3.\nProcessed 12256 pages for database 'bybox', file 'ByBox_Secondary' on file 3.\nProcessed 1 pages for database 'bybox', file 'ByBox_1_Log' on file 3.\nBACKUP DATABASE successfully processed 164057 pages in 35.456 seconds (36.148 MB/sec).\n\nProcessed 2 pages for database 'bybox', file 'ByBox_1_Log' on file 4.\nBACKUP LOG successfully processed 2 pages in 0.056 seconds (0.252 MB/sec).\n</code></pre>\n\n<p>Perfect! But its not.</p>\n\n<p>And DBCC SHRINKFILE ('ByBox_1_Log' , 1) now returns with</p>\n\n<pre><code>DbId    FileId\tCurrentSize\tMinimumSize\tUsedPages\tEstimatedPages\n7   2\t251425\t251425\t251424\t251424\n</code></pre>\n\n<p>and DBCC SQLPERF(LOGSPACE) still reports 30% usage.\nI think I may have to resign myself to the fact there could well be a bug in SQL Server 2008, or that my log file has been corrupted in some manner. However, my database is in good working order, which leads me to think there is a bug <em>(shudders at the thought)</em>.</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":31,"score":-1,"question_id":13029371,"title":"Creating vintage table sql","body":"<p>This is quite difficult to explain so please bare with me.</p>\n\n<p>I'm creating a vintage table therefore the numbers go up diagonal for example</p>\n\n<pre><code>m1 m2 m3 m4 m5 m6 \n8  8  9  9  10 0\n78 56 6  6  0\n85 56 89 0\n89 86 0 \n56 0 \n</code></pre>\n\n<p>However, I want the numbers to roll over, therefore the top line should look like</p>\n\n<pre><code>m1 m2 m3 m4 m5 m6\n8  16 25 34 54 0\n</code></pre>\n\n<p>(example1)I tried to use some sequel but it didn't give me the right numbers and also on the bottom line it would look like</p>\n\n<pre><code>56 56 \n</code></pre>\n\n<p>This is because it would use the <code>m1+m2</code> sum. (example2) So when I used a case to only <code>m1+m2</code> when <code>m2 = 0</code> it didn't include numbers it should have and my overall number was less.</p>\n\n<p>example1:</p>\n\n<pre><code>select [Month] ,\nSUM(m1) as m1 ,\nsum(m1+m2) as m2,\nSUM(m2+m3) as m3 ,\nSUM(m3+m4) as m4 ,\nSUM(m4+m5) as m5 ,\nSUM(m5+m6) as m6 \nfrom #months\ngroup by [Month]\norder by [Month]\n</code></pre>\n\n<p>example2:\nI also tried </p>\n\n<pre><code>select [Month] ,\nSUM(m1) as m1 ,\nsum(case when m2 &lt;&gt; 0 then(m1+m2) else 0 end) as m2 ,\nSUM(case when m3 &lt;&gt; 0 then m2+m3 else 0 end) as m3 ,\nSUM(case when m4 &lt;&gt; 0 then m3+m4 else 0 end) as m4 ,\nSUM(case when m5 &lt;&gt; 0 then m4+m5 else 0 end) as m5 ,\nSUM(case when m6 &lt;&gt; 0 then m5+m6 else 0 end) as m6 ,\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","pivot"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":92,"score":4,"question_id":13022718,"title":"Return Columns As Rows based on Number of Months","body":"<p>This seems like a simple thing to accomplish but I'm not sure if I am thinking about it correctly to get the desired results. I'm using a pivot but I think I need something else paired with it.</p>\n\n<p>I have an invoice table that contains monthly invoices for each client. At most, a client will have 12 invoices per year, 1 for each month.</p>\n\n<pre><code>+----------+-------+-------+--------------+--------------+--------------+\n| ClientID | Month | Year  | ColumnValue1 | ColumnValue2 | ColumnValue3 |\n+----------+-------+-------+--------------+--------------+--------------+\n|        1 |     1 |  2012 |           20 |           30 |           50 |\n|        1 |     2 |  2012 |           25 |           35 |           40 |\n|        2 |     1 |  2012 |           28 |           38 |           48 |\n+----------+-------+-------+--------------+--------------+--------------+\n</code></pre>\n\n<p>Now, I want to create a list like below based on each client. There would be a column for each month. So Client 1 would look like:</p>\n\n<pre><code>+--------------+----+----+---+---+---+---+---+---+---+----+----+----+-------+\n|  ColumnName  | 1  | 2  | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | Total |\n+--------------+----+----+---+---+---+---+---+---+---+----+----+----+-------+\n| ColumnValue1 | 20 | 25 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  0 |  0 |  0 |   45  |\n| ColumnValue2 | 30 | 35 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  0 |  0 |  0 |   65  |\n| ColumnValue3 | 50 | 40 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  0 |  0 |  0 |   90  |\n+--------------+----+----+---+---+---+---+---+---+---+----+----+----+-------+\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13027819,"title":"dynamic sql passing paramter of length > 8000","body":"<p>I am creating a report that may allow for the user to select All Codes in the database.  When this is converted to a string, it passes a string with more than 8000 characters.  Since this is a parameter, I am not sure how to split this.  Does anyone have an idea?  I am using Sql Server 2008 and have tried the varchar(max) as well. Any other ideas?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13027471,"title":"SQL Server 2008 r2 how to split column values to multiple rows","body":"<p>How to split column values to raw values e.g:</p>\n\n<pre><code>Col1            col2\n1               james\n1               gold\n1               james@gmail.com\n2               john\n2               def\n2               def@gmail.com\n</code></pre>\n\n<p>col1 values keep on changing  to thousands.</p>\n\n<p>results:</p>\n\n<pre><code>col1            col2      col3      col4\n1               james     gold      james@gmail.com \n2               john      def       ef@gmail.com\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13012902,"title":"SQL Select then Delete","body":"<p>I need to clean out some old data from my database tables. Below shows two tables, <strong>app_status</strong> and <strong>app_personal_details</strong>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/BlqfP.png\" alt=\"enter image description here\"></p>\n\n<p>I have the following query to select all the records (applications) from the <strong>app_status</strong> table which have been created over 12 months from todays date</p>\n\n<pre><code>select status_id  \nfrom dbo.app_status  \nwhere submission_date &lt;= dateadd(month, -12, getdate()) order by 1\n</code></pre>\n\n<p>I then want to delete all the records from the <strong>app_personal_details</strong> table where the application_id exists in the list of retrieved status_id above.</p>\n\n<p>I hope this makes sense. I would like to know a quick way of deleting the data from both tables.</p>\n\n<p>Thanks for your help.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13027150,"title":"Conversion failed when converting the varchar value '300.00' to data type int","body":"<p>Is there a way to get rid of this error when using the following sql case when query?As some of the fields are varchar due to they way they were imported?</p>\n\n<pre><code>select * ,\ncase when [Month] = '200911' then netpay_nov09\n when [Month] = '200912' then netpay_dec09\n when [Month] = '201001' then netpay_jan10\nend as m1\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13027153,"title":"Function which returns table with two different conditions","body":"<p>I have a sql function which returns table with two different conditions.</p>\n\n<p>Example: I have a @temp Table </p>\n\n<pre><code>@temp\n(\nProject Name,\nProject ID,\nTasks,\nAdhoc Tasks\n)\n</code></pre>\n\n<p>Tasks       has to give the count of Tasks where Duration != 0\nAdhoc Tasks has to give the count of Tasks where Duration = 0</p>\n\n<p>My Result:</p>\n\n<pre><code>P Name   PID   Tasks     AdhocTasks\n  A        1      2          12\n  b        2      3          12\n  c        3      6          12\n  d        4      5          12\n</code></pre>\n\n<p>I have Projects e,f,g which has only Adhoc tasks but not displaying\nExpected Result:</p>\n\n<pre><code>P Name   PID   Tasks     AdhocTasks\n  A        1      2         2\n  b        2      3         3\n  c        3      6         1\n  d        4      5         2\n  e        5      0         1\n  f,       6      0         1 \n  g        7      0         2\n</code></pre>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13027217,"title":"SQL Server 2008 - Use IDENTITY field when inserting a row","body":"<p>My table has 3 columns <code>ID</code>, <code>ISOCode</code> and <code>CountryName</code>.</p>\n\n<p>Column <code>ID</code> is an IDENTITY column.</p>\n\n<p>When I insert new records into this table, I want to populate the <code>ISOCode</code> field - on occasion - with the same value as the <code>ID</code> field.</p>\n\n<p>I've tried SCOPE_IDENTITY(), @@IDENTITY and IDENT_CURRENT but none of these seems to work.</p>\n\n<p>Is there a way I can do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":13024831,"title":"How to iterate through each row in sql server?","body":"<pre><code>select name from sys.tables where name like '%JPro_VP_Service%'\n</code></pre>\n\n<p>My above query returns 26 table names.</p>\n\n<p>Now I'm trying to write a query to check in every table return from above query.</p>\n\n<pre><code>select * from JPro_VP_Service --consider this is my first table like wise I want to search in 26 tables return from above query\nwhere row_id like '%1-101%' or row_id like '%1-102%'\n</code></pre>\n\n<p>I think I need to write for or cursor to accomplish this can anyone help me how to achieve this?</p>\n"},{"tags":["sql-server-2008","windows-services","arcgis","arcgis-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13025824,"title":"cannot create sdeservice at arcgis10.1 with ms sql server 2008","body":"<p>I'm not sure if it is good place to put below my question, if not - please move it to the right place. I've got ArcGis 10.1 server and MSSQLSERVER 2008 and I have installed the ArcSDE. I wanna create windows service using command line and putting the command like below:</p>\n\n<pre><code>sdeservice -o create -p sde -n -d SQLSERVER, MSSQLSERVER -i esri_sde2 -s bgpn\n</code></pre>\n\n<p>the service has created, but if I wanna run the service it's starting and stopping for a short while. The message that i've got:</p>\n\n<pre><code>The esri_sde2 service on Local Computer started and then stopped. Some services stop automatically if they are not in use by other services or programs.\n</code></pre>\n\n<p>Does anyone got any idea why it is not working well? My operating system is Windows 7 64-bits. Thanks for any help.</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2008","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13024952,"title":"Attempt to fetch logical page (5:65424) in database 2 failed","body":"<p>I am getting following <code>SqlException</code> on calling a stored procedure -</p>\n\n<blockquote>\n  <p><em>Attempt to fetch logical page (5:65424) in database 2 failed. It belongs to allocation unit 7349876362857938944 not to 4899918190390149120.</em></p>\n  \n  <p><em>System.Data.SqlClient.SqlException occurred<br>\n  Message=\"Attempt to fetch logical page (5:65424) in database 2 failed. It belongs to allocation unit 7349876362857938944 not to 4899918190390149120.</em>  </p>\n  \n  <p>Source=\".Net SqlClient Data Provider\"<br>\n  ErrorCode=-2146232060<br>\n  Class=21<br>\n  LineNumber=257<br>\n  Number=605<br>\n  Procedure=\"ispDisplayCount\"<br>\n  Server=\"10.10.1.1\"<br>\n  State=3  </p>\n  \n  <p>StackTrace:<br>\n  at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)<br>\n  at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException\n  exception, Boolean breakConnection)<br>\n  at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject\n  stateObj)<br>\n  at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream,\n  BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject\n  stateObj)<br>\n  at System.Data.SqlClient.SqlDataReader.ConsumeMetaData()<br>\n  at System.Data.SqlClient.SqlDataReader.get_MetaData()<br>\n  at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds,\n  RunBehavior runBehavior, String resetOptionsString)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean\n  async)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String\n  method, DbAsyncResult result)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String\n  method)<br>\n  at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior\n  behavior, String method)<br>\n  at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior\n  behavior)<br>\n  at System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior\n  behavior)<br>\n  at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords,\n  String srcTable, IDbCommand command, CommandBehavior behavior)<br>\n  at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand\n  command, CommandBehavior behavior)<br>\n  at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.DoLoadDataSet(IDbCommand\n  command, DataSet dataSet, String[] tableNames)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.LoadDataSet(DbCommand\n  command, DataSet dataSet, String[] tableNames)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.LoadDataSet(DbCommand\n  command, DataSet dataSet, String tableName)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.ExecuteDataSet(DbCommand\n  command) in D:\\SVN_Workspace\\Login.cs:line 1205  </p>\n</blockquote>\n\n<p>What does this exception mean and any resolution to above issue?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":3,"view_count":41,"score":-3,"question_id":13024244,"title":"Select Male & Female's names from the same table Contacts","body":"<p>This is My 'Contacts' table.</p>\n\n<pre><code>| Names      |   Gender   |\n\n| Mike       | Male       |\n| Steve      | Male       |\n| Kelly      | Female     |\n| Jane       | Female     |\n| Natasha    | Female     |\n| Mathew     | Male       |\n| Jack       | Male       |\n</code></pre>\n\n<p>I want result like that:</p>\n\n<pre><code>|  Male      |   Female   |   \n\n| Mike       | Kelly      |\n| Steve      | Jane       |\n| Mathew     | Natasha    |\n| Jack       |            |\n</code></pre>\n\n<p>please give me solution to achieve this result in SQL Sever...\nAny suggestions are appreciated!</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13024006,"title":"Scalar-valued function doesn't return expected result","body":"<p>I have created a scalar-valued function in Microsoft SSMS, it is as follows:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[fGetCurrentBalFromName] \n(\n    @Name NVarchar,\n    @CliFl Bit\n)\nRETURNS Money\nAS\nBEGIN\n    DECLARE @CurrentBal Money\n\n    select @CurrentBal=SUM(tt.Debt) from  \n     (select case t.Clientfl when 1 then dbo.fGetClientNameFromId(t.AgentID) \n                    else dbo.fGetSupplierNameFromId(t.AgentID) \n             end as Cli,\n             t.Clientfl,\n         case t.Clientfl when 1 then \n            case t.Incomfl \n                when 1 then t.Amount \n                       else (-1)*t.Amount \n            end\n         else\n            case t.Incomfl\n                when 1 then (-1)*t.Amount\n                        else t.Amount\n            end\n         end as Debt              \n      from [Store].[dbo].[Money] t) tt where tt.Cli=@Name and tt.Clientfl=@CliFl\n      group by tt.Cli\n\n    RETURN @CurrentBal\n\nEND\n</code></pre>\n\n<p>When I execute </p>\n\n<pre><code>Select dbo.fGetCurrentBalFromName('Вали',1)\n</code></pre>\n\n<p>I get no(NULL) result.</p>\n\n<p>But when I try to execute the query alone without parameters</p>\n\n<pre><code>select SUM(tt.Debt) from  \n         (select case t.Clientfl when 1 then dbo.fGetClientNameFromId(t.AgentID) \n                        else dbo.fGetSupplierNameFromId(t.AgentID) \n                 end as Cli,\n                 t.Clientfl,\n             case t.Clientfl when 1 then \n                case t.Incomfl \n                    when 1 then t.Amount \n                           else (-1)*t.Amount \n                end\n             else\n                case t.Incomfl\n                    when 1 then (-1)*t.Amount\n                            else t.Amount\n                end\n             end as Debt              \n          from [Store].[dbo].[Money] t) tt where tt.Cli='Вали' and tt.Clientfl=1\n          group by tt.Cli\n</code></pre>\n\n<p>I get exactly what I want. \n So what is the mistake I had done creating the scalar-valued function. \n Any help will be appreciated!</p>\n"},{"tags":["asp.net",".net","sql-server-2008","windows-services"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":70,"score":1,"question_id":13023727,"title":"Windows Service SQL timeout exception","body":"<p>I have a Windows service which continuously each 10 seconds queries the SQL Server database table, and I also have a web site which also queries the same database table after 25 seconds.</p>\n\n<p>After some time I get exception - <code>server timeout exception has occurred</code>. I went through stack-overflow site and has done the changes to SQL configuration settings but still I got the same exception. What to do?</p>\n\n<p><strong>Stack Trace</strong></p>\n\n<p>at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\n   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\n   at System.Data.SqlClient.SqlDataReader.ConsumeMetaData()\n   at System.Data.SqlClient.SqlDataReader.get_MetaData()\n   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\n   at System.Data.Common.DbCommand.ExecuteReader(CommandBehavior behavior)\n   at Microsoft.Practices.EnterpriseLibrary.Data.Database.DoExecuteReader(DbCommand command, CommandBehavior cmdBehavior)\n   at Microsoft.Practices.EnterpriseLibrary.Data.Database.ExecuteReader(DbCommand command)\n   at Microsoft.Practices.EnterpriseLibrary.Data.CommandAccessor<code>1.&lt;Execute&gt;d__0.MoveNext()\n   at System.Collections.Generic.List</code>1..ctor(IEnumerable<code>1 collection)\n   at System.Linq.Enumerable.ToList[TSource](IEnumerable</code>1 source)</p>\n\n<p>at System.Runtime.Remoting.Messaging.Message.Dispatch(Object target, Boolean fExecuteInContext)\n   at System.Runtime.Remoting.Messaging.StackBuilderSink.SyncProcessMessage(IMessage msg, Int32 methodPtr, Boolean fExecuteInContext)</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13021252,"title":"Handling partitions when you don't know the tables affected","body":"<p>I have a little problem :(, I have a data base that reached 1000 partitions for one partition_schema, taking a look on the internet I found that it is the top but it can be increased to 15000. I can't increase it to 15000, the solution that I can do is merge some partitions.</p>\n\n<p>I have a partition by day since 20100101 and actually there is 999, it can't increase anymore, so I want to merge the partitions from one month, but before that I want to do a backup of the information that is going to be affected, BUT I don't know which tables are affected by the function that has 999 ranges.</p>\n\n<p>Q. How can I find out wich tables are affected by the function? or which is the best way to asure that merging the partitions I won't lose data?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13020405,"title":"Flattening XML structure in T-SQL","body":"<p>I have the following XML structure</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;DataItems&gt;\n    &lt;DataItem&gt;\n        &lt;ID&gt;ID1&lt;/ID&gt;\n        &lt;Metric1&gt;Metric11Value&lt;/Metric1&gt;\n        &lt;Metric2&gt;Metric12Value&lt;/Metric2&gt;\n        &lt;OptionalParameters&gt;\n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName1&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue1&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits1&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt; \n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName2&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue2&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits2&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt;\n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName3&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue3&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits3&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt;\n        &lt;/OptionalParamters&gt;\n    &lt;DataItem&gt;\n        &lt;ID&gt;ID2&lt;/ID&gt;\n        &lt;Metric1&gt;Metric21Value&lt;/Metric1&gt;\n        &lt;Metric2&gt;Metric22Value&lt;/Metric2&gt;\n        &lt;OptionalParameters&gt;\n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName1&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue1&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits1&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt; \n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName2&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue2&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits2&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt;\n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName3&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue3&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits3&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt;\n        &lt;/OptionalParamters&gt;\n    &lt;DataItem&gt;\n&lt;/DataItems&gt;\n</code></pre>\n\n<p>I would like to flatten it in a fashion that will give me a table row like</p>\n\n<pre><code>(ID, Metric1, Metric2, ParamName, ParamValue, ParamUnits)\n</code></pre>\n\n<p>The problem is that I don't know how do peform the dynamic filtering I need in order to eliminate the invalid rows that result during the inner join or cross apply. So what I have essentially a total of (Number of Data Items)^2 of rows with all the permutations of parameters names, values, and units. I want to know how to filter out the invalid rows.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":13019624,"title":"Why do I get these different results from two SQL queries?","body":"<p>This has been killing me all day =D.  Please help!</p>\n\n<p>Scenario 1:  Two DB's on the same server (A, B) and A has three tables.  Query is executed from B.</p>\n\n<p>Scenario 2: Two DB's one server is linked to the other. (B has link A) and A has three tables.  Query is executed from B.</p>\n\n<p>In scenario 1 (non linked server):</p>\n\n<pre><code>SET @val = ''\nSELECT @val = @val + 'Hello, my name is ' + [name] + '!' + CHAR(10) + CHAR(13)\nFROM A.sys.tables\n</code></pre>\n\n<p>Returns:\nHello, my name is Table1!\nHello, my name is Table2!\nHello, my name is Table3!</p>\n\n<p>In scenario 2 (linked server):</p>\n\n<pre><code>SET @val = ''\nSELECT @val = @val + 'Hello, my name is ' + [name] + '!' + CHAR(10) + CHAR(13)\nFROM LINKED.A.sys.tables\n</code></pre>\n\n<p>Returns:\nHello, my name is Table3!</p>\n\n<p>Why are these different?  If I use openquery() on the linked server the results are the same as scenario 1.  I'm trying to avoid using openquery() if possible.  Thanks!</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":29098,"score":1,"question_id":5341584,"title":"SQL Server - after insert trigger - update another column in the same table","body":"<p>I've got this database trigger:</p>\n\n<pre><code>CREATE TRIGGER setDescToUpper\nON part_numbers\n AFTER INSERT,UPDATE\nAS\nDECLARE @PnumPkid int, @PDesc nvarchar(128)\n\nSET @PnumPkid = (SELECT pnum_pkid FROM inserted)\nSET @PDesc = (SELECT UPPER(part_description) FROM inserted)\n\nUPDATE part_numbers set part_description_upper = @PDesc WHERE pnum_pkid=@PnumPkid\n\nGO\n</code></pre>\n\n<p><strong>Is this a bad idea?</strong> That is to update a column on the same table. I want it to fire for both insert and update. </p>\n\n<p>It works, I'm just afraid of a cyclical situation. The update, inside the trigger, fires the trigger, and again and again. <strong>Will that happen?</strong></p>\n\n<p>Please, don't nitpick at the upper case thing. Crazy situation.</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13019120,"title":"SQL Server 2008 Query to pull the max account date opened","body":"<p>i have the table as below,<br>\n        i would like to find the max(account_opened_date), if there is null date is existing, i have to show null values.</p>\n\n<p><strong>Scenario1</strong>  </p>\n\n<p><strong>Table1</strong>  </p>\n\n<pre><code>CLIENTID            ACCOUNTID           ACCOUNT_OPENED_DATE\n11562               3880                07/05/2012\n11562               3884                08/05/2012\n11562               3885                09/06/2012\n11562               3886                10/06/2012\n11562               3881                NULL\n11562               3882                NULL  \n</code></pre>\n\n<p>the results are as below.  </p>\n\n<pre><code>CLIENTID            ACCOUNTID           ACCOUNT_OPENED_DATE  \n11562               3882                NULL  \n</code></pre>\n\n<p>in the above scenario, i have to take null because, there is null values existing in account opened dates  </p>\n\n<p><strong>Scenario2</strong>  </p>\n\n<p><strong>Table1</strong>  </p>\n\n<pre><code>CLIENTID            ACCOUNTID           ACCOUNT_OPENED_DATE  \n11563               3880                07/05/2012\n11563               3884                08/05/2012\n11563               3885                09/06/2012\n11563               3886                10/06/2012\n11563               3881                11/10/2011\n11563               3882                10/22/2012  \n</code></pre>\n\n<p>The results ARE AS below.  </p>\n\n<pre><code>CLIENTID            ACCOUNTID           ACCOUNT_OPENED_DATE\n11563               3882                10/22/2012  \n</code></pre>\n\n<p>in the above scenario, i have to take 10/22/2012 because, there is no null values existing in account opened dates<br>\nPLEASE HELP!</p>\n"},{"tags":["windows","visual-studio","sql-server-2008","windows-server-2008","remote-debugging"],"answer_count":3,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":5670,"score":8,"question_id":2512244,"title":"Can't step into stored procedure on remote SQL Server 2008","body":"<p>I have a domain controller installed on virtual <code>Windows Server 2008 x64</code>.</p>\n\n<p><code>SQL Server 2008 Express x64</code> is running on <code>Windows Server 2008 x64</code> and client on <code>Windows 7 RTM x86</code>. Both have joined the domain.</p>\n\n<p>I'm starting both <code>Visual Studio 2008</code> and <code>SQL Server Management Studio 2008</code> under domain admin user. This account is a member of group <code>sysadmin</code> on <code>SQL Server</code>.</p>\n\n<p>Server has firewall exceptions for both <code>TCP</code> and <code>UDP</code> on ports <code>135-139</code> and <code>1433-1434</code>.</p>\n\n<p><code>Visual Studio 2008 Remote Debugger</code> services is started on server and <code>Domain Admins</code> group is allowed to debug.</p>\n\n<p>Remote DCOM works: I can attach to remote server and list it's processes, can switch to show only managed code, etc.</p>\n\n<p>When I'm starting debugging of a query in SMS I'm getting this error:</p>\n\n<blockquote>\n  <p>Failed to start debugger Error HRESULT\n  E_FAIL has been returned from a call\n  to a COM component. (mscorlib) Program\n  Location:</p>\n  \n  <p>at System.Runtime.InteropServices.Marshal.ThrowExceptionForHRInternal(Int32\n  errorCode, IntPtr errorInfo)</p>\n  \n  <p>at Microsoft.SqlServer.Management.UI.VSIntegration.DebugSession.DebugCallbacks.OnSqlInitializeDebuggingEvent(ISqlInitializeDebuggingEvent\n  sqlInitializeDebuggingEvent)</p>\n  \n  <p>at Microsoft.SqlServer.Management.UI.VSIntegration.DebugSession.DebugCallbacks.Microsoft.VisualStudio.Debugger.Interop.IDebugEventCallback2.Event(IDebugEngine2\n  debugEngine, IDebugProcess2\n  debugProcess, IDebugProgram2\n  debugProgram, IDebugThread2\n  debugThread, IDebugEvent2 debugEvent,\n  Guid&amp; riidEvent, UInt32 attribute)</p>\n</blockquote>\n\n<p>and </p>\n\n<blockquote>\n  <p>Unable to access the SQL Server\n  debugging interface.  The Visual\n  Studio debugger cannot connect to the\n  remote computer.  A firewall may be\n  preventing communication via DCOM to\n  the remote computer. Please see Help\n  for assistance.</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>Unable to start program MSSSQL://server.mydomain.local/master/sys/=0</p>\n</blockquote>\n\n<p>And  when stepping-in into a stored procedure using VS I'm getting the first one and this:</p>\n\n<blockquote>\n  <p>Exception from HRESULT: 0x89710016</p>\n</blockquote>\n\n<p>What have I do?</p>\n"},{"tags":["sql-server","sql-server-2008","collation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3790,"score":0,"question_id":1121105,"title":"Changing default collation of a SQL Server 2008 instance","body":"<p>When I try to change the default collation of a SQL Server instance using this commandline:</p>\n\n<pre>setup.exe /QUIET /ACTION=REBUILDDATABASE /INSTANCENAME=MSSQLSERVER /SAPWD=********* /SQLCOLLECTION=SQL_Latin1_General_CP1_CI_AS</pre>\n\n<p>I get the following message:</p>\n\n<pre>Microsoft (R) SQL Server 2008 Setup 10.00.1600.22\nCopyright (c) Microsoft Corporation.  All rights reserved.\n\nThe following error occurred:\nThe setting 'SQLCOLLECTION' specified is not recognized.\n\nError result: -2068578301\nResult facility code: 1204\nResult error code: 3\n\nPlease review the summary.txt log for further details</pre>\n\n<p>Is there anything I'm missing ? Do I need to do something special for the setup.exe to find the <code>SQL_Latin1_General_CP1_CI_AS</code> collation?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","reporting-services"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":9321,"score":4,"question_id":1097690,"title":"Converting SQL2008 RDL file to SQL2005","body":"<p>How do I convert a RDL file that was created using the SQL2008 designer to work on SQL2005 Reporting services?</p>\n"},{"tags":["sql-server-2008","search","index","integer","catalog"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":5,"view_count":100,"score":-5,"question_id":12963490,"title":"Why is there no delimited, integer-only cataloging option in SQL Server?","body":"<p>Is there something I'm missing?</p>\n\n<p>What I am trying to create is basically a table of indexes separated by spaces (or whatever type you fancy). I realize that Full Text Search would not be possible on merely int-type data columns because it understands \"spaces\" as the delimiter to separated data to be indexed across the whole catalog. </p>\n\n<p>I do realize that it does allow me to index <code>varbinary</code> type data, but why not just <code>int</code> data separated by spaces, rather than include integer AND text data to search through. IE, a </p>\n\n<pre><code> SEARCH * FROM MyTable\n WHERE CONTAINS(indexedcolumn, '1189')\n</code></pre>\n\n<p>with a full text index/catalog defined for a table that looks like:</p>\n\n<pre><code> indexedColumn      secondDelimitedIntColumn\n 1189               34 34209 1989 3 5\n</code></pre>\n\n<p>is not possible, but</p>\n\n<pre><code> SEARCH * FROM MyTable\n WHERE CONTAINS(uniqueColumn, 'a1189')\n</code></pre>\n\n<p>WOULD work using the full text index on a table with the following columns:</p>\n\n<pre><code> uniqueColumn secondDelimitedIntColumn\n a1189        b34 b34209 b1989 b3 b5  \n</code></pre>\n\n<p>so basically executing a <code>CONTAINS()</code> search on any column with a full text index on it will work only if there is some text attached to the integer string.</p>\n\n<p>But my question is asking \"Why can't I just used strings of integers separated by spaces, which saves me the step of having to add dummy text just to get trick SQL Server into allowing me to execute a full text search on indexed integer strings?\"</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server-2008","query","full-text-search","contains"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12945479,"title":"How to do a CONTAINS() on two columns of Full Text Index Search SQL","body":"<p>I have a table (MyTable) with the following columns:</p>\n\n<p>Col1: NameID VARCHAR(50) PRIMARY KEY NOT NULL\nCol2: Address VARCHAR(255)</p>\n\n<p>Data Example:</p>\n\n<p>Name: '1 24'\nAddress: '1234 Main St.'</p>\n\n<p>and i did a full text index on the table after making the catalog using default params.</p>\n\n<p>How can I achieve the following query:</p>\n\n<pre><code> SELECT * FROM MyTable\n WHERE CONTAINS(NameID, '1')\n AND CONTAINS(Address, 'Main St.');\n</code></pre>\n\n<p>But my query is returning no results, which doesn't make sense because this does work:</p>\n\n<pre><code> SELECT * FROM MyTable\nWHERE CONTAINS(Address, 'Main St.');\n</code></pre>\n\n<p>and so does this:</p>\n\n<pre><code> SELECT * FROM MyTable\n WHERE CONTAINS(Address, 'Main St.')\n AND NameID LIKE '1%'\n</code></pre>\n\n<p>but this also doesn't work:</p>\n\n<pre><code> SELECT * FROM MyTable\n WHERE CONTAINS(NameID, '1');\n</code></pre>\n\n<p>Why can't I query on the indexed, primary key column (Name) when I selected this column to be included with\nthe Address column when setting up the Full Text Index?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","sql-server-2008","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":58,"score":-1,"question_id":12991660,"title":"Unable to find the requested .Net Framework Data Provider. MVC 4 with Entity Framework","body":"<p>Am using the MVC 4 in VS2010 SP1 installed machine. Am getting the following error</p>\n\n<p>Unable to find the requested .Net Framework Data Provider. It may not be installed. </p>\n\n<p>My WebConfig look like this </p>\n\n<pre><code>      &lt;connectionStrings&gt;\n    &lt;add name=\"BuildEntities\" connectionString=\"metadata=res://*/Entity.Build.csdl|res://*/Entity.Build.ssdl|res://*/Entity.Build.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=www.xxxx.com,8754;Initial Catalog=xxxx;Persist Security Info=True;User ID=xxx;Password=xxxx;MultipleActiveResultSets=True&amp;quot;\"\n         providerName=\"System.Data.EntityClient\" /&gt;\n &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>I had SQL Server 2008 installed in my lap.</p>\n"},{"tags":["asp.net","sql-server-2008","session-state"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":154,"score":3,"question_id":12653708,"title":"SQLServer Session State Management Lost On App Pool Recycle","body":"<p>I have an application that has been having issues with losing session, and I'm almost positive  it has to do with the application pool recycling too often.  </p>\n\n<p>I wanted to try an out of process solution and have configured SQLServer sessionState, but when I recycle the worker process my session is still being blown away.  Here is my web.config</p>\n\n<pre><code>&lt;sessionState cookieless=\"false\" stateConnectionString=\"tcpip=localhost:42424\"  mode=\"SQLServer\" sqlConnectionString=\"Data Source=(local;User ID=user;Password=password\" timeout=\"180\" /&gt;\n</code></pre>\n\n<p>I've ran the appropriate sql scripts to setup the database and I can see that a session is created and stored in the database, but if i change the web.config or manually recycle the worker process my session is lost.  What am I doing wrong??</p>\n\n<p>Side note, I'm receiving the exact same behavior with StateServer mode.  I seemingly configure it properly, I can see the State service memory footprint get bigger when I login ....I tried to push a non serialized object into and received an error....but when I recycle the app pool or change the web.config I lose session....</p>\n\n<p>I've also tried to set up the Memcached session provider (which is what I would really like to use) that can be found here: <a href=\"http://memcachedproviders.codeplex.com/releases/view/10468\" rel=\"nofollow\">http://memcachedproviders.codeplex.com/releases/view/10468</a></p>\n\n<p>and it is also doing the same thing!  I can see the session being created in the database, and I will get an error pertaining to serialization when I try to interact with a non-serialized object....but I lose the session when the app pool is recycled.<br>\nAfter enabling some logging I'm seeing this in the event viewer:\n<strong>Event code: 1003 Event message: Application compilation is starting</strong></p>\n\n<p>Nobody??  I really need to get out of process session state working....help!!</p>\n"},{"tags":["c#","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13015334,"title":"How can I clone an existing table schema to create a new empty table with the same structure, using C#?","body":"<p>I'm connecting to an SQL Server 2008 database.</p>\n\n<p>Using C#, I'd like to create a new table, with a name specified by me, which looks exactly like an existing table in that database.  There are no foreign keys involved.</p>\n\n<p>I have code like </p>\n\n<pre><code>DataTable table = con.GetSchema(\"Tables\");\nforeach (System.Data.DataRow row in table.Rows)\n{\n    foreach (System.Data.DataColumn col in table.Columns)\n</code></pre>\n\n<p>But it doesn't get me very far.  Do I really need to iterate over all the tables myself?  Even if I identify the <code>DataTable</code> how do I clone it?  I looked at <code>DataTable.Clone</code> but I can't see how to set a new name and create that table on the database.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13013347,"title":"get data for per year","body":"<p>I have a problem with query so I have two tables : Job and Job answers,so to get number of answers of every job I do like that : </p>\n\n<pre><code>and ((month(a.created_at) = 10 and day(a.created_at) &gt;= 1) \n      or (month(a.created_at) between 11 and 12) \n      or (month(a.created_at) between 1 and 8) \n      or (month(a.created_at) = 9 and day (a.created_at) &lt;= 30))\n</code></pre>\n\n<p>Now I have another modification to do is to get a new number of answers of job by per year and between two date ( 1 september and 30 december for every year) [field : created_at] , </p>\n\n<pre><code>     +----------+-------+---------+------+----- +\n     | year     | job title | number of answers |\n     +----------+-------+---------+------+------+\n     | 2008     | Job1      | 58                | \n     | 2010     | Job2      | 45                | \n     | 2012     | Job3      | 122               |\n     +----------+-------+---------+------+------\n</code></pre>\n\n<p>year and date is in created_at field...</p>\n\n<p>Edit : </p>\n\n<p>for 01/10 to 30/9 I do : </p>\n\n<pre><code>  and ( (month(a.created_at) = 10 and day(a.created_at) &gt;= 1) \n        or month(a.created_at)   between 11 and 12 \n        or month(a.created_at) between 1 and 8 \n        or (month(a.created_at) = 9 and day (a.created_at) &lt;= 30))\n</code></pre>\n\n<p>edit 2 : </p>\n\n<pre><code> delimiter $$\nbegin\n\ndeclare @StartDay INT, @EndDay INT, @StartMonth INT, @EndMonth INT\nSelect @StartDay = 01, @StartMonth = 10, @EndDay = 30, @EndMonth = 09\n\nSelect year(a.created_at) as years , jd.JobDomain, count(a.Id) as nb_answer,   a.Job_id,   j.JobTitle \n from JobAppliance a\n inner join Job j on a.Job_id =  j.PublicId\n inner join JobDestination d on j.Id=d.Job_id\n inner join Jjobdomain jd on  j.Id = jd.Job_id\n\n and \n(\n@StartMonth = @EndMonth And \nMonth(a.created_at) = @StartMonth And \nDay(a.created_at) &gt;= @StartDay And \nDay(a.created_at) &lt;= @EndDay\n) Or (\n@StartMonth != @EndMonth And (\n(\n Month(a.created_at) = @StartMonth And\n  Day(a.created_at) &gt;= @StartDay\n) Or (\n  Month(a.created_at) Between @StartMonth + 1 And @EndMonth - 1\n) Or (\n  Month(a.created_at) = @EndMonth And\n  Day(a.created_at) &lt;= @EndDay\n)\n)\n)\n\ngroup by year(a.created_at) , a.Job_id, j.JobTitle;\n\nend$$\ndelimiter ;\n</code></pre>\n\n<p>I have a syntax error in declare?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","optimization"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13013126,"title":"What's the most efficient way to write a single record to an MS SQL 2008 Server using .NET?","body":"<p>I'm writing a command-line tool (to run on Windows 7 boxes) that inserts a single record into a table and then exits.  I'm using C# (.NET 4.5) and SQL Server 2008.</p>\n\n<p>The record of data contains a large (up to 6000 bytes) string, a time-stamp and an auto-incrementing integer ID primary key.  There are no foreign keys attached to the table.</p>\n\n<p>Also, since this is the most common usage scenario for this database I'd like to optimise for it.  Are there any tricks with how I set up the database that will help keep individual insert times low?</p>\n\n<p>[EDIT]\nThe code I'm currently using...</p>\n\n<pre><code>SqlConnection con = new SqlConnection(ConnectionString);\ncon.Open();\nSqlTransaction trans = con.BeginTransaction();\n\nSqlCommand cmd = new SqlCommand(\"INSERT INTO [msglog](message,project,username,computername,updated_at) VALUES (@m,@p,@u,@c,@i,@t)\", con, trans);\ncmd.Parameters.AddWithValue(\"@u\", Username);\ncmd.Parameters.AddWithValue(\"@c\", Computername);\ncmd.Parameters.AddWithValue(\"@m\", msg);\ncmd.Parameters.AddWithValue(\"@p\", ProjectName);\ncmd.Parameters.AddWithValue(\"@t\", DateTime.Now);\ncmd.ExecuteNonQuery();\ntrans.Commit();\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","reportingservices-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":337,"score":0,"question_id":7307369,"title":"Opening SSRS 2005 reports in SQL Server 2008","body":"<p>We have some reports created in SQL Server 2005. But Recently we converted them into 2008. But now we are not able to open the same report project in 2008. It is showing an error like this : </p>\n\n<blockquote>\n  <p>E://Projects/...Reporting.rptproj cannot be opened because its project\n  type (.rptproj) is not supported by this version of the application.\n  To open it, please use a version that supports this type of projects.</p>\n</blockquote>\n\n<p>We have SQL Server 2008 with SP1 is installed. we are trying to open the reports using SQL Server 2008 Business Intelligence Development Studio.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13011810,"title":"Need help in Pivoting","body":"<p>I have the below</p>\n\n<pre><code>Id  names   namevalues\n1   name1   first value1\n1   name2   first value2\n2   name1   second value1\n2   name2   second value2\n</code></pre>\n\n<p>DDL is as under</p>\n\n<pre><code>Declare @t table(Id int, names varchar(50),namevalues varchar(100))\nInsert Into @t select 1,'name1','first value1'\nInsert Into @t select 1,'name2','first value2'\nInsert Into @t select 1,'name1','second value1'\nInsert Into @t select 1,'name2','second value2'\n\nselect * from @t\n</code></pre>\n\n<p><strong>excepted output is</strong> </p>\n\n<pre><code>Id  name1           name2\n1   first value1    first value2\n2   second value1   second value2\n</code></pre>\n\n<p>my try</p>\n\n<pre><code>SELECT *\nFROM  @t AS src \nPIVOT ( \n    MAX(namevalues) FOR namevalues IN ([name1],[name2] ) \n) AS pvt \n</code></pre>\n\n<p>it's wrong....</p>\n\n<p>Please help</p>\n"},{"tags":["sql","sql-server","sql-server-2008","closures"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":68,"score":2,"question_id":13004825,"title":"Calculate number of cluster when i know about point in each cluster in sql","body":"<p>I'm trying to calculate number of cluster when I know all members of each cluster.</p>\n\n<p>I need a function in SqlServer2008 to solve this problem.</p>\n\n<p>My table has more than 14 million distinct records like this:</p>\n\n<pre><code>CREATE TABLE Test\n(\n   F1 varchar(5),\n   F2 varchar(5)\n)\nINSERT INTO TEST ( F1, F2) VALUES ( 'A', 'B')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'A', 'K')\nINSERT INTO TEST ( F1, F2) VALUES ( 'C', 'H')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'D', 'B')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'F', 'I')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'F', 'B')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'D', 'H' )\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'E', 'G' )\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'G', 'L' )\n</code></pre>\n\n<p>note that:</p>\n\n<pre><code>If A=B AND A=K THEN B=K \nIF E=G AND G=L THEN E=L\n</code></pre>\n\n<p>Now the output of the function should be as below:</p>\n\n<pre><code>ClusterNumber--- point\n1---A\n1---B\n1---k\n1---D\n1---F\n1---I\n1---H\n1---C\n2---E\n2---G\n2---L\n</code></pre>\n\n<p>I guess the solution would be a recursive function, but does not know it!</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13010013,"title":"Save Images From Ajax Control Toolkit Editor to SQL Database","body":"<p>I am using the default text editor available using the ajax control toolkit and I need to save an image that a user can paste into the editor, into the database. The column in the database is varbinary(MAX) but when I try to save I get the error below</p>\n\n<blockquote>\n  <p>Implicit conversion from data type nvarchar(max) to varbinary(max) is not allowed. Use the CONVERT function to run this query</p>\n</blockquote>\n\n<p>I then later converted the content to byte like so </p>\n\n<pre><code>var subgrantdesc = Convert.ToByte(grantdescription_editor.Content);  \n</code></pre>\n\n<p>Then in the parameter definition I have this</p>\n\n<pre><code>var param0 = new SqlParameter();\nparam0.ParameterName = \"@desc\";\nparam0.SqlDbType = System.Data.SqlDbType.VarBinary;\nparam0.Value = subgrantdesc;\nsql.Parameters.Add(param0); \n</code></pre>\n\n<p>However I get the error:</p>\n\n<blockquote>\n  <p>System.FormatException: Input string was not in a correct format. at System.Number.StringToNumber....  </p>\n</blockquote>\n\n<p>The above error points to the line of code where I am converting to <code>Byte</code>.\nI would like to know how I can save data(images and text) entered through the editor control into the SQL server database. I also would like to know if the HTML formatting will be retained.</p>\n\n<p>Any help will be appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","gis","geospatial"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12965191,"title":"ST_PointN to get Points from Geometry Column","body":"<p>I have a Shapefile from which I am extracting Geometry column and storing it into Table.\nThis is sample data stored in Geometry column which has 432 points.</p>\n\n<blockquote>\n  <p>0x000000000104AC010000AB3E57ABBBC4384127A08938705B57414F401361C3C43841C9E53F846C5B574190A0F8E1F6C438410F0BB5766E....</p>\n</blockquote>\n\n<p>Now I want to extract each and Every point i.e. 432 points from the Geometry column and store it into another table. For that I am using <code>ST_PointN</code> column but it only gives me 1 point at a time. <code>ST_NumPoint</code> will give me 432 number but not all the points.</p>\n\n<p>How do I extract each and every point from Geometry column and store it into DB?</p>\n\n<p>Cheers,</p>\n"},{"tags":["sql-server-2008","ssis","ssis-data-transformations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":422,"score":0,"question_id":10050721,"title":"SSIS Excel -Retrieving minimum date value and storing it into a variable","body":"<p>I have an Excel Source which has got 1000 rows with some 10 columns  and one of the column is a Date Field ,We have to retrieve the minimum date value and assign it to a variable in ssis .Could you guys provide me a script or steps to map that value to the variable...So that i can use it in control flow task to perform truncate operation using the variable value.\nplease adviiiise</p>\n\n<p>your help in this regard is appreciated.\nRosh..</p>\n"},{"tags":["sql-server-2008","locking","deadlock","database-backups"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13008769,"title":"MS SQL Server 2008, database completely locked","body":"<p>Our database becomes completely locked, and it seems that many tables not related to each other are locked at once. When this happens, it becomes locked for approximately 2 minutes, and when this happens it is not related to the amount of traffic that our application has at that time. </p>\n\n<p>We have tried to replicate the issue on our test servers by </p>\n\n<ul>\n<li>increasing the activity on the database (Inserts, Selects, Updates, Deleting), </li>\n<li>increasing the connections to the database simultaneously, </li>\n<li>increasing latch time, </li>\n<li>generating temporary locks on a particular table</li>\n</ul>\n\n<p>But could not arrive to a conclusion were this is coming from.</p>\n\n<p>Is there any type of configuration, or background running tasks of SQL Server, that may cause this (Backups, Transaction Log related stuff etc)? </p>\n\n<p>Is it possible to trace locks, by a date range (For example : Taking a snapshot of the current locks present in the database for a particular time)?</p>\n"},{"tags":["sql-server-2005","sql-server-2008","maintenance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1038,"score":1,"question_id":3184286,"title":"How to create maintenance plan in sql server?","body":"<p>when i m trying to create new maintenance plan in sql server it is popping up this error-</p>\n\n<pre><code>TITLE: Microsoft SQL Server Management Studio\n------------------------------\n\n'Agent XPs' component is turned off as part of the security configuration for \nthis server. A system administrator can enable the use of 'Agent XPs' by using   sp_configure. \nFor more information about enabling 'Agent XPs', see \"Surface Area   Configuration\" in \nSQL Server Books Online. (ObjectExplorer)  \n</code></pre>\n"},{"tags":["asp.net","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":52,"score":-2,"question_id":13007399,"title":"Trying to establish a connection with SQL Server 2008","body":"<pre><code>SqlConnection cnn = new SqlConnection();\ncnn.ConnectionString = \"Data Source=.;Database = deptStore;Integrated Security = true;\";\n\ncnn.Open();\nSqlCommand cmd = new SqlCommand();\ncmd.CommandText = \"insert into Employee values('\" + TextBox1.Text + \"','\" + TextBox2.Text + \"','\" + TextBox3.Text + \"','\" + TextBox4.Text + \"','\" + TextBox5.Text + \"','\" + TextBox6.Text + \"','\" + TextBox7.Text + \"','\" + TextBox8.Text + \"','\" + TextBox9.Text + \"','\" + TextBox10.Text + \"','\" + TextBox11.Text + \"','\" + TextBox12.Text + \"','\" + TextBox13.Text + \"')\";\ncmd.Connection = cnn;\n\ncmd.ExecuteNonQuery();\n\nResponse.Write(\"Record Save\");\ncnn.Close();\n</code></pre>\n\n<p>But I am getting following error:</p>\n\n<blockquote>\n  <p><em>SqlException was unhandled by user code</em></p>\n  \n  <p><em>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: Named\n  Pipes Provider, error: 40 - Could not open a connection to SQL Server)</em></p>\n</blockquote>\n\n<p>Kindly help me to understand the error and rectify it.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13007673,"title":"Why does select @@version gives 2005 when I installed 2008","body":"<p>Apparently I see about in SQL Server Management Studio and I saw 2008 version.</p>\n\n<p>But when I perform </p>\n\n<pre><code>select @@version \n</code></pre>\n\n<p>I am seeing version 2005</p>\n\n<p>I think this explains why my stored procedure could run on another computer whose compatibility level=100</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13007830,"title":"How to create a procedure in SQL server that does not allow to alter a particular column of a table?","body":"<p>I want to create a procedure that don't allow me to alter a column of a table.</p>\n\n<p>I have already create a procedure that does not allow me to alter anything in a particular table but now I want to be specific to a particular column.</p>\n\n<p>So now I don't want to be rolling back in case of table alter instead i want to roll back if alter is made to particular column of table.</p>\n"},{"tags":["perl","sql-server-2008","config"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13006624,"title":"Perl Syntax Error: bareword found where operator expected","body":"<p>This is my perl script code. in this i'm getting error like \"bareword found where operator expected at $cmd\"</p>\n\n<pre><code>my $path = $folder.\"/\".$host.\"_\".$database_name.\".bak\";\n$cmd .= \"-U $user_name -P $password -S $host -d master -Q \"BACKUP DATABASE [$database_name] TO DISK = N'$path'\" \";\n</code></pre>\n\n<p>any one help me?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":13006091,"title":"I need to combine multiple rows from a subquery into a string separated by a space","body":"<p>I'm creating an image gallery with albums. The gallery owner can first create one or more albums, and then create images to add to those albums. I'm having to use multiple view templates to pull this off. Regardless, here's what is hanging me up. Here is the core of my stored procedure:</p>\n\n<pre><code>DECLARE @MyString VARCHAR(MAX)\n\nSELECT @MyString = ISNULL(@MyString + ' ', ' ') + CAST(AlbumID AS VARCHAR(10)) + ' '\nFROM BD_AlbumGallery\nWHERE ImageID = PROBLEM HERE... Dont know what to do &lt;---\nORDER BY AlbumID\n\nSELECT a.[ImageID]\n      ,a.ImageFile\n      ,a.[ImageTitle]\n      ,a.[ImageCaption]\n      ,a.[Description]\n      ,a.[Active]\n      ,b.[AlbumID]\n      ,b.[ImageID]\n      ,c.[ListingID]\n      ,c.[Active]\n      ,c.[LevelID]\n      ,c.[Title]\n\n      ,@MyString AS AlbumClass\n\nFROM BD_Gallery A\nJOIN BD_AlbumGallery B\nON a.ImageID = b.ImageID\nJOIN BD_Listing C\nON a.ListingID = c.ListingID\nWHERE a.ListingID = @passedListingID\n  AND a.Active = 1\n  AND c.Active = 1\n  AND c.LevelID &gt; 5\n</code></pre>\n\n<p>So the problem is, the data is retrieved within a LI\nand one at a time of course... guess that's the obvious... to display properly in my gallery template.</p>\n\n<p>The only issue I'm having is I need the @MyString AS AlbumClass to be tied to a.ImageID, or b.ImageID, as they are the same.</p>\n\n<p>The reason is, the albums in the template are defined by a class.</p>\n\n<pre><code>&lt;li class=\"12 24 15 17\"&gt;Rest of my code for a single image result&lt;/li&gt;\n</code></pre>\n\n<p>So the AlbumID's being utilized as class names allows me to assign them to the jQuery dropdown category/album list that's in a template right before this one. I was thinking of a SubQuery. Ultimately, I need the results (for other reasons) to display in one result set.</p>\n\n<p>Please help.. Still trying to push my way through the learning curves.</p>\n\n<p>Thanks!</p>\n\n<ul>\n<li>Patrick</li>\n</ul>\n"},{"tags":["sql","oracle","sql-server-2008","recursion","common-table-expression"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12971580,"title":"SYS_CONNECT_BY_PATH in SQL Server","body":"<p>I am working on a migration project and need to convert following Oracle query into it's SQL Server equivalent.</p>\n\n<pre><code>select SYS_CONNECT_BY_PATH (b.actionnr,'/') as FATHER, SYS_CONNECT_BY_PATH (b.actionnr,'     | ') as REFPATH, LEVEL, \n(select count(p.refactionnr) from zisjob.zj_action p where p.refactionnr=b.actionnr)\nChilds, b.* from \n( select NVL(x.ANZFiles,0) ANZFiles, act.actionnr, act.refactionnr, act.lfno, act.jobnr,     act.\"TYPE\", act.actiontype\nfrom zisjob.zj_action act, zisjob.zj_actiontype t, \n( select f.lno, count(f.filenr) as ANZFiles from zisjob.zj_file f where f.lno != f.lfno     Group by f.lno )x\nwhere act.lfno=10 and act.actiontype = t.typeid(+) and act.actionnr = x.lno(+) )\nb start with b.actionnr in \n(select b.actionnr from zisjob.zj_action b where b.lfno = 10 and b.refactionnr is    null)\nconnect by nocycle prior b.actionnr=b.refactionnr order by 1 desc, 2 asc\n</code></pre>\n\n<p>I am using CTEs to do this. So far, I've come up with following :</p>\n\n<pre><code>with h$cte as \n(\n   select\n      cast (convert(varchar,b.actionnr)+'/' as varchar(max)) as FATHER,\n      cast(convert(varchar,b.actionnr)+' | ' as varchar(max)) as REFPATH,\n      1 as LEVEL,\n      --cast (row_number() over (order by @@spid) as varchar(max)) as LEVEL,\n      (select count(p.refactionnr) from zisjob.zj_action p \n       where p.refactionnr = b.actionnr) Childs, \n      b.* \n   from\n     (select \n         isnull(x.ANZFiles, 0) ANZFiles, act.actionnr, act.refactionnr, act.lfno,  \n         act.jobnr, act.\"TYPE\", act.actiontype\n      from zisjob.zj_action act \n      left outer join zisjob.zj_actiontype t on act.actiontype = t.typeid \n      left outer join\n          (select f.lno, count(f.filenr) as ANZFiles \n           from zisjob.zj_file f\n           where f.lno != f.lfno Group by f.lno ) x on act.actionnr = x.lno\n      where act.lfno = 10) b\nwhere \n   b.actionnr in\n       (select b.actionnr from zisjob.zj_action b \n        where b.lfno = 10 and b.refactionnr is null)\n\nUNION ALL\n\nselect\n    CAST(FATHER + '/'+ b.ACTIONNR as varchar(max)) as FATHER,\n    CAST(REFPATH + '|'+b.ACTIONNR AS VARCHAR(MAX)) as REFPATH,\n    h$cte.LEVEL + 1 as LEVEL,\n    (select count(p.refactionnr) from zisjob.zj_action p  \n     where p.refactionnr = b.actionnr) Childs, \n    b.*\nfrom\n   (select isnull(x.ANZFiles, 0) ANZFiles, act.actionnr, act.refactionnr, \n           act.lfno, act.jobnr, act.\"TYPE\", act.actiontype\n    from zisjob.zj_action act \n    left outer join zisjob.zj_actiontype t on act.actiontype = t.typeid \n    left outer join\n        (select f.lno, count(f.filenr) as ANZFiles from zisjob.zj_file f\n         where f.lno != f.lfno Group by f.lno) x on act.actionnr = x.lno\n    where act.lfno = 10) b, \n    h$cte\nwhere \n    b.actionnr in\n        (select b.actionnr from zisjob.zj_action b \n         where b.lfno = 10 and b.refactionnr is null)\n    and h$cte.ACTIONNR = h$cte.REFACTIONNR\n)\nselect &lt;columns&gt; from h$cte\n</code></pre>\n\n<p>The translated query giving following errors:</p>\n\n<blockquote>\n  <p><em>Msg 467, Level 16, State 1, Line 1</em><br>\n  <em>GROUP BY, HAVING, or aggregate functions are not allowed in the recursive part of a     recursive common table expression 'h$cte'.</em></p>\n  \n  <p><em>Msg 462, Level 16, State 1, Line 1</em><br>\n  <em>Outer join is not allowed in the recursive part of a recursive common table expression 'h$cte'</em></p>\n</blockquote>\n\n<p>How can I work around this? Any help in any form is greatly appreciated. Thanks in advance.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13006399,"title":"SQL Server 2008 trigger error remove","body":"<p>I have created a trigger in SQL Server 2008</p>\n\n<pre><code>CREATE TRIGGER [dbo].[ITEM_UOM_DELETE] ON\n   [dbo].[ITEM_UOM] INSTEAD OF DELETE\n   AS\n      declare @rowc int\n      set @rowc = (select count(*) from stock, deleted where \n      item = deleted.itemcode and uom = DELETED.MAINUNIT AND DOCTYPE &lt;&gt; 'OP')\n         if @rowc &gt; 0\n         begin\n           raiserror('Unit is in Use Cannot Delete', 16, 1)\n           rollback transaction\n         end\n</code></pre>\n\n<p>on execution of this trigger it gives the error output</p>\n\n<blockquote>\n  <p>Msg 50000, Level 16, State 1, Procedure ITEM_UOM_DELETE, Line 11<br>\n  Unit is in Use Cannot Delete<br>\n  Msg 3609, Level 16, State 1, Line 1<br>\n  The transaction ended in the trigger. The batch has been aborted.</p>\n</blockquote>\n\n<p>I want the defined error only</p>\n\n<blockquote>\n  <p><em>Unit is in Use Cannot Delete</em></p>\n</blockquote>\n\n<p>How to remove the error 'The transaction ended in the trigger. The batch has been aborted.' ?</p>\n"},{"tags":["sql-server-2008","bulkinsert"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":95,"score":3,"question_id":12992598,"title":"Bulk Insert into SQL Server 2008","body":"<pre><code>for (int i = 0; i &lt; myClass.Length; i++)\n{\n        string upSql = \"UPDATE CumulativeTable SET EngPosFT = @EngPosFT,EngFTAv=@EngFTAv WHERE RegNumber =@RegNumber AND Session=@Session AND Form=@Form AND Class=@Class\";\n        SqlCommand cmdB = new SqlCommand(upSql, connection);\n\n        cmdB.CommandTimeout = 980000;\n\n        cmdB.Parameters.AddWithValue(\"@EngPosFT\", Convert.ToInt32(Pos.GetValue(i)));\n        cmdB.Parameters.AddWithValue(\"@RegNumber\", myClass.GetValue(i));\n        cmdB.Parameters.AddWithValue(\"@EngFTAv\", Math.Round((engtot / arrayCount), 2));\n        cmdB.Parameters.AddWithValue(\"@Session\", drpSess.SelectedValue);\n        cmdB.Parameters.AddWithValue(\"@Form\", drpForm.SelectedValue);\n        cmdB.Parameters.AddWithValue(\"@Class\", drpClass.SelectedValue);\n\n\n        int idd = Convert.ToInt32(cmdB.ExecuteScalar());\n}\n</code></pre>\n\n<p>assuming <code>myClass.Length</code> is 60. This does 60 update statements. How can I limit it to 1 update statement. Please code example using the above code will be appreciated. Thanks</p>\n\n<p>Tried using this</p>\n\n<p>StringBuilder command = new StringBuilder();</p>\n\n<pre><code>            SqlCommand cmdB = null;\n            for (int i = 0; i &lt; myClass.Length; i++)\n            {\n                command.Append(\"UPDATE CumulativeTable SET\" + \" EngPosFT = \" + Convert.ToInt32(Pos.GetValue(i)) + \",\" + \" EngFTAv = \" + Math.Round((engtot / arrayCount), 2) +\n        \" WHERE RegNumber = \" + myClass.GetValue(i) + \" AND Session= \" + drpSess.SelectedValue + \" AND Form= \" + drpForm.SelectedValue + \" AND Class= \" + drpClass.SelectedValue + \";\");\n\n               //or command.AppendFormat(\"UPDATE CumulativeTable SET EngPosFT = {0},EngFTAv={1} WHERE RegNumber ={2} AND Session={3} AND Form={4} AND Class={5};\", Convert.ToInt32(Pos.GetValue(i)), Math.Round((engtot / arrayCount), 2), myClass.GetValue(i), drpSess.SelectedValue, drpForm.SelectedValue, drpClass.SelectedValue);\n\n\n\n            }//max length is 128 error is encountered\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":37,"score":-1,"question_id":12989275,"title":"How to refactor sql subquery field in sql?","body":"<p>i want to create a sql query which must select sum subquery also make Alacak-Borc process. But i can not.\nhow to make it (Alacak-Borc As BAKIYE) and how to REFACTOR BELOW CODE? thanks...</p>\n"},{"tags":["database","sql-server-2008","query","grails-2.0","grails-controller"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":12967518,"title":"SQL Querying Database","body":"<p>I have this following query\n <code>\"select abc from table where val = 1\"</code><br/>\nThe result i got was </p>\n\n<pre><code> [{abc=5}]\n</code></pre>\n\n<p>However, I <strong>need just the integer value 5</strong> from the result <strong>instead of the array[{abc=5}]</strong>.<br/>\nAnyone have any idea on how to do this? thanks\n*My friend told me that I will need to use substring to get just the 5 out from the [{abc=5}], but i have completely no clue on how to work on it. Any help will be appreciated!</p>\n\n<p>*edited </p>\n"},{"tags":["sql-server-2008","tsql","query-execution-plans","sql-execution-plan"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1211,"score":4,"question_id":8460416,"title":"query optimizer operator choice - nested loops vs hash match (or merge)","body":"<p>One of my stored procedures was taking too long execute. Taking a look at query execution plan I was able to locate the operation taking too long. It was a nested loop physical operator that had outer table (65991 rows) and inner table (19223 rows). On the nested loop it showed estimated rows = 1,268,544,993 (multiplying 65991 by 19223) as below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/MfaML.png\" alt=\"enter image description here\"></p>\n\n<p>I read a few articles on physical operators used for joins and got a bit confused whether nested loop or hash match would have been better for this case. From what i could gather:</p>\n\n<p>Hash Match - is used by optimizer when no useful indexes are available, one table is substantially smaller than the other, tables are not sorted on the join columns. Also hash match might indicate more efficient join method (nested loops or merge join) could be used.</p>\n\n<p><strong>Question:</strong> Would hash match be better than nested loops in this scenario?</p>\n\n<p>Thanks </p>\n"},{"tags":["vb.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12593695,"title":"Creating a simple CRUD wth VB 2010 ans SQL Server 2008","body":"<p>I'm a VB6.0 and I'm new to VB 2010 since I moved to web development job. </p>\n\n<p>I need your help in connecting vb2010 to sql server in any ways. I also want to know how to make a very simple CRUD in vb2010 and display it's records in a data grid or listview. </p>\n"},{"tags":["sql","sql-server-2008","check-constraints"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":13000698,"title":"Sub queries in check constraint","body":"<p>I have table designed in SQL Server 2008.</p>\n\n<p>I have a column in that table which needs to be checked against another table when data is inserting. </p>\n\n<pre><code>ALTER TABLE Table1\n        WITH CHECK ADD CONSTRAINT CK_Code\n        CHECK (MyField in (Select Field From Table2))\n</code></pre>\n\n<p>This cause an error </p>\n\n<blockquote>\n  <p><em>Sub-queries are not allowed in this context. Only scalar expressions are allowed.</em></p>\n</blockquote>\n\n<p>I have looked at this question about <a href=\"http://stackoverflow.com/questions/9722433/check-constraint-subqueries-are-not-allowed-in-this-context\">Check Constraint - Subqueries are not allowed in this context</a>.</p>\n\n<p>Is there any way of achieving this without using a trigger?</p>\n"},{"tags":["sql","xml","sql-server-2008","xpath","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13000743,"title":"Concatenating text of child nodes into a single column","body":"<p>I'm working with an API that returns property information.  Some of the textual information is stored across child nodes and I'd like to concatenate it into a single string (VARCHAR).</p>\n\n<p>My process is that I obtain the xml through a webservice, then pass this through to a proc which extracts the xml values and inserts them into a view, this is a snippet of the xml that I'm getting back:</p>\n\n<pre><code>&lt;properties&gt;\n    &lt;property propertyid=\"1234\"&gt;\n        &lt;bullets&gt;\n            &lt;bullet&gt;nice garden&lt;/bullet&gt;\n            &lt;bullet&gt;it smells a bit&lt;/bullet&gt;\n            &lt;bullet&gt;body under the patio&lt;/bullet&gt;\n        &lt;/bullets&gt;\n    &lt;/property&gt;\n    ...\n&lt;/properties&gt;\n</code></pre>\n\n<p>This is a glimpse into how the xml is being queried to extract values from it:</p>\n\n<pre><code>INSERT        \nINTO          VProperty\n(             PropertyId,\n              Description\n)\nSELECT        P.value('@propertyid', 'INT'),\n              NULL -- extract all the bullet text values into a single string\nFROM          @xml.nodes('/properties/property')\n</code></pre>\n\n<p>In this example, I'd like to be able to extract the information from the xml so it ends up like this:</p>\n\n<pre><code>PropertyId    Description\n1234          'nice garden\\r\\nit smells a bit\\r\\nbody under the patio\n</code></pre>\n\n<p>Is this going to be possible in pure sql/xml or am I going to need to perform some pre-processing on the xml before I enter SQL land?</p>\n\n<p>Any help greatly appreciated (as always).</p>\n"},{"tags":["sql-server-2008","deadlock","database-deadlocks"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12399401,"title":"deadlock between update on a set of rows and select some of the same rows","body":"<p>I have two SPID's running as transcations and below is what each one does among other things.</p>\n\n<p>SPID A -</p>\n\n<ol>\n<li>Updates rows 1-10 from table 1</li>\n<li>.......</li>\n</ol>\n\n<p>SPID B - </p>\n\n<ol>\n<li>Updates row 5 from table 1</li>\n<li>Selects rows 4,5 &amp; 6 from table 1 and updates a row in table 2.</li>\n<li>......</li>\n<li>......</li>\n</ol>\n\n<p>I'm facing a deadlock scenario where SPID A has updated row 4 and waiting for X lock on the clustered index to update row 5 and SPID B is in step 2 waiting for a S lock on the clustered index for row 4 which is in X lock by SPID A.\nThere is also a non clustered index on table 1 but it does not cover the select query, so it looks up the clustered index. I'm assuming that even if I make it a covering index SPID A will hold a lock on the non clustered index making SPID B to wait on it. \nI'm considering escalating the isolation level to serialization so that SPID A which is more or less updating the whole table will have to wait to acquire its lock if SPID B has already  started on its update to row 5. Also it will prevent SPID B from acquiring the x locks if SPID A has already begun. SPID A currently executes every 20 minutes and holds on to the transaction for about 10 secs.</p>\n\n<p>What other suggestions would any of you have for me to get rid of this deadlock?\nThanks.</p>\n"},{"tags":["sql-server-2008","visual-studio-2010"],"answer_count":6,"favorite_count":9,"up_vote_count":36,"down_vote_count":0,"view_count":107861,"score":36,"question_id":3536023,"title":"How to install sql server management studio 2008 component only","body":"<p>below is a list of the sql components that I installed in the Visual Studio 2010 Professional setup. Sadly, while trying to work I could not find <strong>sql server management studio 2008</strong> . </p>\n\n<p>Is there a way to download the sql server management studio 2008 separately and install only that component ?</p>\n\n<p>Since in the past I installed sql server management studio 2005 with a whole new instance of sql server 2005 and had couple of instances and it was a bit messy.</p>\n\n<p>Thank you</p>\n\n<p><img src=\"http://i.stack.imgur.com/CB0Do.jpg\" alt=\"alt text\"></p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12993853,"title":"Join the table valued function in the query","body":"<p>I have one table vwuser. I want join this table with the table valued function fnuserrank(userID). So I need to cross apply with table valued function:</p>\n\n<pre><code>SELECT *\nFROM vwuser AS a\nCROSS APPLY fnuserrank(a.userid)\n</code></pre>\n\n<p>For each userID it generates multiple records. I only want the last record for each empid that does not have a Rank of Term(inated).  How can I do this?</p>\n\n<p>Data:</p>\n\n<pre>\nHistoryID empid  Rank  MonitorDate\n1          A1     E1    2012-8-9\n2          A1     E2    2012-9-12 \n3          A1     Term  2012-10-13\n4          A2     E3     2011-10-09\n5          A2     TERM   2012-11-9 \n</pre>\n\n<p>From this 2nd record and 4th record must be selected.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":169,"score":2,"question_id":12999631,"title":"Split string by comma in SQL Server 2008","body":"<p>There are two strings <code>a</code> and <code>b</code></p>\n\n<p>The <code>a</code> string contains comma. I would like to split the a string by comma, then go through every element .</p>\n\n<p>IF the <code>b</code> string contains any element which split by comma will return 0</p>\n\n<p>(e.g: a = <code>\"4,6,8\"</code> ; b = <code>\"R3799514\"</code> because the <code>b</code> string contains 4 so return 0)</p>\n\n<p>How to achieve this with a stored procedure? Thanks in advance!</p>\n\n<p>I have seen a split function:</p>\n\n<pre><code>CREATE FUNCTION dbo.Split(@String varchar(8000), @Delimiter char(1))     \nreturns @temptable TABLE (items varchar(8000))     \nas     \nbegin     \ndeclare @idx int     \ndeclare @slice varchar(8000)     \n\nselect @idx = 1     \n    if len(@String)&lt;1 or @String is null  return     \n\nwhile @idx!= 0     \nbegin     \n    set @idx = charindex(@Delimiter,@String)     \n    if @idx!=0     \n        set @slice = left(@String,@idx - 1)     \n    else     \n        set @slice = @String     \n\n    if(len(@slice)&gt;0)\n        insert into @temptable(Items) values(@slice)     \n\n    set @String = right(@String,len(@String) - @idx)     \n    if len(@String) = 0 break     \nend \nreturn     \nend\n\nselect top 10 * from dbo.split('Chennai,Bangalore,Mumbai',',')\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","insert","updates","multilanguage"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12999108,"title":"How to insert multi language data in SQL Server using N?","body":"<p>I know by using <code>N'...'</code> we can insert multi language data into SQL Server. But I don't know how to use it with parameters. Please help me.. </p>\n\n<p>My code is :</p>\n\n<pre><code>Alter proc proc_T_NewsAddUpdate\n(  \n    @Id bigint,  \n    @Title nvarchar(500),\n    @Description nvarchar(1000),  \n    @image nvarchar(200),  \n    @DateOfNews datetime,  \n    @CreatedBy bigint,  \n    @ModifiedBy bigint,  \n    @IsVisible int,  \n    @IsDeleted int  \n)  \nas  \n    if exists(select 1 from T_LatestNews where ID=@Id)  \n    begin  \n        Update t_LatestNews \n        set Titlle = N@Title, \n            DesCription = N@Description,\n            Image = N@image,\n            dateOfnews = @DateOfNews,\n            modifiedDate = GETDATE(),\n            ModifiedBy = @ModifiedBy,\n            Isvisible = @IsVisible,\n            isdeleted = @IsDeleted \n         where \n            ID=@Id  \n\n        select 1  \n    end  \n    else  \n    begin  \n        insert into t_latestnews (Titlle, Description, Image, dateofnews, CreatedDate, ModifiedDate, CreatedBy, ModifiedBy, isvisible, isdeleted) \n        values(@Title, @Description, @image, @DateOfNews, GETDATE(), GETDATE(), @CreatedBy, @ModifiedBy, @IsVisible, @IsDeleted)  \n\n        select 1  \n    end\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12984088,"title":"sql - max from group flag setter","body":"<p>I m trying to achieve flag setting for the condition in my table below</p>\n\n<pre><code>p_id      mon_year      e_id     flag  \n----      ---------     -----    -----\n 1          2011/11       20       0\n 1          2011/11       21       1\n 1          2012/01       22       1\n 1          2012/02       23       0\n 1          2012/02       24       0\n 1          2012/02       25       1\n 2          2011/11       28       0\n 2          2011/11       29       1\n 2          2012/01       30       1\n</code></pre>\n\n<p>grouping by p_id,e_id and mon_year, the flag is set for the last value in the month.</p>\n\n<p>I m confused how can i achieve this</p>\n\n<p>I tried to achieved this by using row_number and partition to seperate out the value. By still looking for to achieved</p>\n\n<p>Output by using row_number query , i have got is as below:</p>\n\n<p>Grouping by </p>\n\n<pre><code>p_id      mon_year      e_id     row\n----      ---------     -----    -----\n 1          2011/11       20       1\n 1          2011/11       21       2\n 1          2012/01       22       1\n 1          2012/02       23       1\n 1          2012/02       24       2\n 1          2012/02       25       3\n 2          2011/11       28       1\n 2          2011/11       29       2\n 2          2012/01       30       1\n</code></pre>\n\n<p>Max of this value would set the flag column. But i m really bugged how to achieve it. Any help would be useful.</p>\n\n<p>Thanks !!</p>\n"},{"tags":[".net","sql","sql-server","windows","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":75,"score":-2,"question_id":12997384,"title":"SQL Server 2008 R2 in Windows Server 2008 R2","body":"<p>i want to install SQL Server 2008 R2.\nI clicked on the setup.exe and a message box popup:\n\"Microsoft .NET Framework 3.5 installation has failed.\nSQL Server 2008 Setup requires .NET Framework to be installed.\"</p>\n\n<h1>this is the sqlsetup.txt file in %temp%</h1>\n\n<p>setup launched\nAttempting to determine media source\nMedia Source value not specified on command line argument\nSetup is launched from media directly so default the value to the current folder\nMedia Source: S:\\SQL_Svr_Standard_Edtn_2008_R2_English_MLF_X16-29588\\\nAttemp to determine media layout based on file 'S:\\SQL_Svr_Standard_Edtn_2008_R2_English_MLF_X16-29588\\mediainfo.xml'\nMedia layout is detected as: Full\nNot a slip stream media, so continuing to run setup.exe from media\n/? or /HELP or /Action=HELP specified: false\nHelp display: false\nChecking to see if we need to install .net version 3.5\nDetermining the cluster status of the local maschine\nThe local maschine is not configured as a cluster node\nAttempting to find media for .Net version 3.5\nError: Cannot determine file version of .NET redist: 0x80004005\n.Net Version 3.5 installation failed, so setup will close. Error code: 0x80004005</p>\n\n<h1>Setup closed with exit code: 0x80004005</h1>\n\n<p>thank you very much for any help</p>\n"},{"tags":["sql-server","sql-server-2008","database-mail"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12233638,"title":"Database Mail in Sql Server 2008 not working","body":"<p>I am using Database Mail feature of SQL Server 2008 for the first time to send mail.</p>\n\n<p>I followed the steps in <a href=\"http://blog.sqlauthority.com/2008/08/23/sql-server-2008-configure-database-mail-send-email-from-sql-database/\" rel=\"nofollow\">Example</a></p>\n\n<p>All seems good. Send status in </p>\n\n<pre><code>SELECT * FROM sysmail_allitems \n</code></pre>\n\n<p>is sent.</p>\n\n<p>But the recipient hasn't received any mail..</p>\n\n<p>What could be the issue?</p>\n"},{"tags":["php","sql-server-2005","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":927,"score":3,"question_id":1471723,"title":"PHP - SQL Server 2005 express to 2008 standard problem","body":"<p>I have a PHP app running happily on the following system:</p>\n\n<ul>\n<li>web app: PHP version 5.2.3 </li>\n<li>OS: Windows Server 2003 Standard 32 bit </li>\n<li>database: SQL Server 2005 (express)</li>\n<li>web server: IIS 6</li>\n</ul>\n\n<p>I'm trying to get the same thing running on the following:</p>\n\n<ul>\n<li>web app: PHP version 5.2.11</li>\n<li>OS: Windows Server 2008 Standard 64 bit</li>\n<li>database: SQL Server 2008 Standard 64-bit</li>\n<li>web server: IIS 7</li>\n</ul>\n\n<p>After doing the install and setup I usually do, phpinfo() is running but there is no MSSQL section. I've looked around and found some MS documentation to set up the system using a <code>php_sqlsrv.dll</code> and tried that but it seems to use a different interface to connect to the database (no more <code>mssql_connect()</code>, now it's <code>sqlsrv_connect()</code>). Is this the only way to connect php to SQL Server 2008 or do I just have the setup wrong? If I can go back to PHP 5.2.3 and have it work, that will be fine but I didn't want to undo what I have if it won't help.</p>\n\n<p>Thanks,</p>\n"},{"tags":["tsql","sql-server-2008","sorting"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":343,"score":2,"question_id":5417735,"title":"Topological sorting in sql","body":"<p>I am resolving dependency between some objects in a table.\nI have to do something with objects in order their dependency.\nFor example, the first object doesn't depend on any object. The second and third ones depends on first one and so on. I have to use  <a href=\"http://en.wikipedia.org/wiki/Topological_sorting\" rel=\"nofollow\">topological sorting</a>.\nCould someone show the sample of implementation so sorting in t-sql.\nI have a table:</p>\n\n<pre><code>create table dependency\n(\n  DependencyId PK\n  ,ObjectId\n  ,ObjectName\n  ,DependsOnObjectId\n)\n</code></pre>\n\n<p>I want to get</p>\n\n<p>ObjectId\nObjectName\nSortOrder</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12994914,"title":"Insert query to import data from other database from another server","body":"<p>Normally the Insert query to import data would be:</p>\n\n<pre><code>Insert Into mytable\nSelect * From otherDB.dbo.Othertable\n</code></pre>\n\n<p>but problem is otherDB is not within my current server. It is on a different machine hosted online. Can you please tell what changes should be there to import it from different DB?</p>\n"},{"tags":["sql-server-2008","tsql","table-valued-parameters"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":295,"score":2,"question_id":8022682,"title":"How can I use a Table-Valued Parameter to insert multiple rows and then return their IDs?","body":"<p>In my application, I have a large of number (100+) of rows that I need to insert into the database.  Once they get inserted into the database, I need to insert their children, which have a foreign key reference back to the children.</p>\n\n<p>I'm wondering if there's a way to write a stored procedure that can insert all of those rows and return their IDs back to my application?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12993149,"title":"SQL Server single stored procedure for insertion","body":"<p>I am trying to create a stored procedure in SQL Server 2008 which can insert data into any table (not table specific). I created one shown below, but during execution of the procedure an exception is thrown i.e. </p>\n\n<blockquote>\n  <p><em>Invalid object name 'dbo.@table'.</em></p>\n</blockquote>\n\n<p>Stored procedure code:</p>\n\n<pre><code>CREATE PROCEDURE dbo.sp_InsertValues\n   @table varchar(15)\n   , @fields varchar(100)\n   , @values varchar(100)   \nAS\nBEGIN\n   INSERT INTO [dbo].[@table] (@fields) VALUES (@values)\nEND\nGO\n</code></pre>\n\n<p>Remember I checked the parameters table, columns and values parameters are not null.</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":572,"score":1,"question_id":6773496,"title":"How to replace clustered index scan with a non-clustered index seek or clustered index seek?","body":"<p>Below is my create table script:-</p>\n\n<pre><code>CREATE TABLE [dbo].[PatientCharts](\n[PatientChartId] [uniqueidentifier] ROWGUIDCOL  NOT NULL,\n[FacilityId] [uniqueidentifier] NOT NULL,\n[VisitNumber] [varchar](200) NOT NULL,\n[MRNNumber] [varchar](100) NULL,\n[TimeIn] [time](7) NULL,\n[TimeOut] [time](7) NULL,\n[DateOfService] [date] NULL,\n[DateOut] [date] NULL),\n</code></pre>\n\n<p>I have one clustered index on PatientChartId and two non-clustered index on VisitNumber and MRNNumber. This table has millions of records.</p>\n\n<p>The following query is doing a clustered index scan:-</p>\n\n<pre><code>SELECT  *\nFROM    dbo.PatientCharts\nINNER JOIN ( SELECT FacilityID\n                 FROM   Facilities\n                 WHERE  RemoteClientDB IN (\n                        SELECT  SiteID\n                        FROM    RemoteClient WITH ( NOLOCK )\n                        WHERE   Code = 'IN-ESXI-EDISC14'\n                                )\n               ) AS Filter ON dbo.PatientCharts.FacilityId = Filter.FacilityID   \n</code></pre>\n\n<p>This clustered index scan is taking a lot of time in production because of data volume.</p>\n\n<p>The execution plan is :-</p>\n\n<p><img src=\"http://i.stack.imgur.com/Qzquj.png\" alt=\"enter image description here\"></p>\n\n<p>I have even tried adding a Non-clusted index on FacilityID and including PatientChartID but still the same execution plan. </p>\n\n<p>I am doing DBCC FREEPROCCACHE  everytime to instruct sql server to use a new plan every time. </p>\n\n<p>Is there anything else which I should do to prevent clusteredindex scan ?</p>\n"},{"tags":["sql-server-2008","ssis","script-component"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":847,"score":0,"question_id":5833511,"title":"SSIS: Remove Empty Row from outputbuffer","body":"<p>I have an error on a data flow task.  </p>\n\n<p>i have an ado.net source going to an async script component.</p>\n\n<p>the problem comes at the very end of the insert from the script component to the destination where it </p>\n\n<p>tries to put the empty row it automatically puts in the output buffer in my table.</p>\n\n<p>Is there a way to prevent this from happening/ how can i manipulate the output buffer so i can remove specific rows from it?</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12996142,"title":"Getting SSL Provider Error when using IntegratedSecurity","body":"<pre><code>SqlConnection cnn = new SqlConnection();\ncnn.ConnectionString = \"Data Source=.;Database = deptStore;Integrated Security = true;\";\ncnn.Open();\nSqlCommand cmd = new SqlCommand();\ncmd.CommandText = \"insert into Employee values('\" + TextBox1.Text + \"','\" + TextBox2.Text + \"','\" + TextBox3.Text + \"','\" + TextBox4.Text + \"','\" + TextBox5.Text + \"','\" + TextBox6.Text + \"','\" + TextBox7.Text + \"','\" + TextBox8.Text + \"','\" + TextBox9.Text + \"','\" + TextBox10.Text + \"','\" + TextBox11.Text + \"','\" + TextBox12.Text + \"','\" + TextBox13.Text + \"')\";\ncmd.Connection = cnn;\ncmd.ExecuteNonQuery();\nResponse.Write(\"Record Save\");\ncnn.Close();\n</code></pre>\n\n<p>But I am getting following Error:</p>\n\n<p>SqlConnection cnn = new SqlConnection();\n                cnn.ConnectionString = \"Data Source=.;Database = deptStore;Integrated Security = true;\";</p>\n\n<pre><code>            cnn.Open();\n            SqlCommand cmd = new SqlCommand();\n            cmd.CommandText = \"insert into Employee values('\" + TextBox1.Text + \"','\" + TextBox2.Text + \"','\" + TextBox3.Text + \"','\" + TextBox4.Text + \"','\" + TextBox5.Text + \"','\" + TextBox6.Text + \"','\" + TextBox7.Text + \"','\" + TextBox8.Text + \"','\" + TextBox9.Text + \"','\" + TextBox10.Text + \"','\" + TextBox11.Text + \"','\" + TextBox12.Text + \"','\" + TextBox13.Text + \"')\";\n            cmd.Connection = cnn;\n            cmd.ExecuteNonQuery();\n            Response.Write(\"Record Save\");\n            cnn.Close();\n</code></pre>\n\n<p>But iam getting following Error:\nSqlException was unhandled by user code</p>\n\n<p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</p>\n\n<p>Kindly help me to understand the error and rectify it.</p>\n"},{"tags":["java","sql-server-2008","google-app-engine"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12953690,"title":"Java GAE :: Error: \"Permission denied: Not allowed to issue a socket connect: permission denied..","body":"<p>I got Error when running application as Web Application but the same file when I'm running as a Java Application it is working fine..\nLet me explain in bit more details \nHere is the code which when I'm running as a Java application it is working perfect</p>\n\n<pre><code> package com.gst.user.dao.impl;\nimport java.sql.CallableStatement;\nimport java.sql.DriverManager;\nimport java.sql.Connection;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\n\npublic class Sqldbconnect {\n\n    public static void main(String[] argv) throws SQLException {\n\n        System.out.println(\"-------- SQL JDBC Connection Testing ------\");\n\n        try {\n\n            Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n\n        } catch (ClassNotFoundException e) {\n\n            System.out.println(\"Where is your mysql jdbc Driver?\");\n            e.printStackTrace();\n            return;\n\n        }\n\n        System.out.println(\"Mysql JDBC Driver Registered!\");\n\n        Connection connection = null;\n\n        try {\n\n            connection = DriverManager.getConnection(\n                    \"jdbc:sqlserver://Idatabase:65535;DatabaseName=Data_Base\", \"DUser\",\"DPass\");\n\n        } catch (SQLException e) {\n\n            System.out.println(\"Connection Failed! Check output console\");\n            e.printStackTrace();\n            return;\n\n        }\n\n        if (connection != null) {\n            System.out.println(\"You made it!\");\n            connection.close();\n        } else {\n            System.out.println(\"Failed to make connection!\");\n        }\n    }\n\n}\n</code></pre>\n\n<p>But almost the same thing and in the same package if I try to run as web application it throws exception..\nHere is the code for that</p>\n\n<pre><code>package com.gst.user.dao.impl;\n\nimport java.sql.CallableStatement;\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\n\nimport com.gst.user.dao.CallSPDao;\n\npublic class CallSPDaoImpl implements CallSPDao {\n\n    @Override\n    public void callSPDao() throws SQLException {\n        // TODO Auto-generated method stub\n        System.out.println(\"Calling Stored processor Begins\");\n\n        System.out.println(\"-------- SQL JDBC Connection Testing ------\");\n\n        try {\n\n            Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n\n        } catch (ClassNotFoundException e) {\n\n            System.out.println(\"Where is your mysql jdbc Driver?\");\n            e.printStackTrace();\n            return;\n\n        }\n\n        System.out.println(\"Mysql JDBC Driver Registered!\");\n\n        Connection connection = null;\n\n        try {\n\n            connection = DriverManager.getConnection(\n                    \"jdbc:sqlserver://Idatabase:65535;DatabaseName=Data_Base\", \"DUser\",\"DPass\");\n                //  \n        } catch (SQLException e) {\n\n            System.out.println(\"Connection Failed! Check output console\");\n            e.printStackTrace();\n            return;\n\n        }\n\n        if (connection != null) {\n            System.out.println(\"You made it!\");\n            connection.close();\n        } else {\n            System.out.println(\"Failed to make connection!\");\n        }\n    }\n\n\n    }\n</code></pre>\n\n<p>And the exception is ::</p>\n\n<pre><code>com.microsoft.sqlserver.jdbc.SQLServerException: The TCP/IP connection to the host IL93SQLF031, port 65535 has failed. Error: \"Permission denied: Not allowed to issue a socket connect: permission denied.. Verify the connection properties, check that an instance of SQL Server is running on the host and accepting TCP/IP connections at the port, and that no firewall is blocking TCP connections to the port.\".\nat com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDriverError(SQLServerException.java:170)\nat com.microsoft.sqlserver.jdbc.SQLServerConnection.connectHelper(SQLServerConnection.java:1049)\nat com.microsoft.sqlserver.jdbc.SQLServerConnection.login(SQLServerConnection.java:833)\nat com.microsoft.sqlserver.jdbc.SQLServerConnection.connect(SQLServerConnection.java:716)\nat com.microsoft.sqlserver.jdbc.SQLServerDriver.connect(SQLServerDriver.java:841)\nat java.sql.DriverManager.getConnection(DriverManager.java:582)\nat java.sql.DriverManager.getConnection(DriverManager.java:185)\nat com.gst.user.dao.impl.CallSPDaoImpl.callSPDao(CallSPDaoImpl.java:38)\nat com.gst.user.action.UnsubscribeAction.unsubscribeUser(UnsubscribeAction.java:39)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:597)\nat com.google.appengine.tools.development.agent.runtime.Runtime.invoke(Runtime.java:115)\nat com.opensymphony.xwork2.DefaultActionInvocation.invokeAction(DefaultActionInvocation.java:453)\nat com.opensymphony.xwork2.DefaultActionInvocation.invokeActionOnly(DefaultActionInvocation.java:292)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:255)\nat org.apache.struts2.interceptor.debugging.DebuggingInterceptor.intercept(DebuggingInterceptor.java:256)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.DefaultWorkflowInterceptor.doIntercept(DefaultWorkflowInterceptor.java:176)\nat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:98)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.validator.ValidationInterceptor.doIntercept(ValidationInterceptor.java:265)\nat org.apache.struts2.interceptor.validation.AnnotationValidationInterceptor.doIntercept(AnnotationValidationInterceptor.java:68)\nat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:98)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ConversionErrorInterceptor.intercept(ConversionErrorInterceptor.java:138)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ParametersInterceptor.doIntercept(ParametersInterceptor.java:236)\nat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:98)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ParametersInterceptor.doIntercept(ParametersInterceptor.java:236)\nat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:98)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.StaticParametersInterceptor.intercept(StaticParametersInterceptor.java:190)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat org.apache.struts2.interceptor.MultiselectInterceptor.intercept(MultiselectInterceptor.java:75)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat org.apache.struts2.interceptor.CheckboxInterceptor.intercept(CheckboxInterceptor.java:90)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat org.apache.struts2.interceptor.FileUploadInterceptor.intercept(FileUploadInterceptor.java:243)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ModelDrivenInterceptor.intercept(ModelDrivenInterceptor.java:100)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ScopedModelDrivenInterceptor.intercept(ScopedModelDrivenInterceptor.java:141)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ChainingInterceptor.intercept(ChainingInterceptor.java:145)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.PrepareInterceptor.doIntercept(PrepareInterceptor.java:171)\nat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:98)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.I18nInterceptor.intercept(I18nInterceptor.java:176)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat org.apache.struts2.interceptor.ServletConfigInterceptor.intercept(ServletConfigInterceptor.java:164)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.AliasInterceptor.intercept(AliasInterceptor.java:192)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ExceptionMappingInterceptor.intercept(ExceptionMappingInterceptor.java:187)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat org.apache.struts2.impl.StrutsActionProxy.execute(StrutsActionProxy.java:54)\nat org.apache.struts2.dispatcher.Dispatcher.serviceAction(Dispatcher.java:511)\nat org.apache.struts2.dispatcher.ng.ExecuteOperations.executeAction(ExecuteOperations.java:77)\nat org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter.doFilter(StrutsPrepareAndExecuteFilter.java:91)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.api.socket.dev.DevSocketFilter.doFilter(DevSocketFilter.java:74)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.tools.development.ResponseRewriterFilter.doFilter(ResponseRewriterFilter.java:110)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.tools.development.HeaderVerificationFilter.doFilter(HeaderVerificationFilter.java:34)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.api.blobstore.dev.ServeBlobFilter.doFilter(ServeBlobFilter.java:61)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.apphosting.utils.servlet.TransactionCleanupFilter.doFilter(TransactionCleanupFilter.java:43)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.tools.development.StaticFileFilter.doFilter(StaticFileFilter.java:125)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.tools.development.BackendServersFilter.doFilter(BackendServersFilter.java:97)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:388)\nat org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\nat org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182)\nat org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765)\nat org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:418)\nat com.google.appengine.tools.development.DevAppEngineWebAppContext.handle(DevAppEngineWebAppContext.java:94)\nat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\nat com.google.appengine.tools.development.JettyContainerService$ApiProxyHandler.handle(JettyContainerService.java:380)\nat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\nat org.mortbay.jetty.Server.handle(Server.java:326)\nat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)\nat org.mortbay.jetty.HttpConnection$RequestHandler.content(HttpConnection.java:938)\nat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:755)\nat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:218)\nat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)\nat org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409)\nat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\n</code></pre>\n\n<p>The SQLSERVER is accepting the TCP/IP connection..\nAnd I'm using GAE 1.7.2,JDK 1.6.0_29, building JAVA application on Windows x64.\nAny Idea how to solve this issue..I think firewall is not an issue</p>\n\n<p>Any help/idea will be appreciated.</p>\n"},{"tags":["asp.net-mvc","sql-server-2008","session-state","session-cookies"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":143,"score":2,"question_id":12994772,"title":"Why Asp.net MVC4 can not use the cookieless of SQL Server Session state storage","body":"<p>ALL, Here is my web config in a Asp.net MVC4 application. I found if I set cookieless false ,everything goes fine. but If I don't want use cookie . then the application can not work.when I debug the application, I found the controller can not receive any request from the view. I think It is because when in the cookie-less mode, Something would be appended to the url before . like http:/ /localhost:8119/(S(3cicpjpagvpunr5he5fnfrj1))/.</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;sectionGroup name=\"system.web.webPages.razor\" type=\"System.Web.WebPages.Razor.Configuration.RazorWebSectionGroup, System.Web.WebPages.Razor, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"&gt;\n      &lt;section name=\"webAssets\" type=\"Telerik.Web.Mvc.Configuration.WebAssetConfigurationSection, Telerik.Web.Mvc\" requirePermission=\"false\" /&gt;\n      &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n      &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n    &lt;/sectionGroup&gt;\n  &lt;/configSections&gt;\n\n  &lt;connectionStrings&gt;\n    &lt;add name=\"...\" connectionString=\"...\" providerName=\"System.Data.SqlClient\" /&gt;\n  &lt;/connectionStrings&gt;\n  &lt;appSettings&gt;\n    &lt;add key=\"webpages:Version\" value=\"2.0.0.0\" /&gt;\n    &lt;add key=\"webpages:Enabled\" value=\"true\" /&gt;\n    &lt;add key=\"PreserveLoginUrl\" value=\"true\" /&gt;\n    &lt;add key=\"ClientValidationEnabled\" value=\"true\" /&gt;\n    &lt;add key=\"UnobtrusiveJavaScriptEnabled\" value=\"true\" /&gt;\n  &lt;/appSettings&gt;\n  &lt;system.web&gt;\n    &lt;customErrors mode=\"Off\" /&gt;\n    &lt;httpRuntime executionTimeout=\"14400\" maxRequestLength=\"716800\" /&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.0\" /&gt;\n    &lt;authentication mode=\"Forms\"&gt;\n      &lt;forms loginUrl=\"~/Account/Login\" timeout=\"2880\" /&gt;\n    &lt;/authentication&gt;\n    &lt;pages&gt;\n      &lt;namespaces&gt;\n        &lt;add namespace=\"System.Web.Helpers\" /&gt;\n        &lt;add namespace=\"System.Web.Mvc\" /&gt;\n        &lt;add namespace=\"System.Web.Mvc.Ajax\" /&gt;\n        &lt;add namespace=\"System.Web.Mvc.Html\" /&gt;\n        &lt;add namespace=\"System.Web.Routing\" /&gt;\n        &lt;add namespace=\"System.Web.WebPages\" /&gt;\n        &lt;add namespace=\"Telerik.Web.Mvc.UI\" /&gt;\n      &lt;/namespaces&gt;\n    &lt;/pages&gt;\n    &lt;profile defaultProvider=\"DefaultProfileProvider\"&gt;\n      &lt;providers&gt;\n        &lt;add name=\"DefaultProfileProvider\" type=\"System.Web.Providers.DefaultProfileProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" connectionStringName=\"DefaultConnection\" applicationName=\"/\" /&gt;\n      &lt;/providers&gt;\n    &lt;/profile&gt;\n    &lt;membership defaultProvider=\"DefaultMembershipProvider\"&gt;\n      &lt;providers&gt;\n        &lt;add name=\"DefaultMembershipProvider\" type=\"System.Web.Providers.DefaultMembershipProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" connectionStringName=\"DefaultConnection\" enablePasswordRetrieval=\"false\" enablePasswordReset=\"true\" requiresQuestionAndAnswer=\"false\" requiresUniqueEmail=\"false\" maxInvalidPasswordAttempts=\"5\" minRequiredPasswordLength=\"6\" minRequiredNonalphanumericCharacters=\"0\" passwordAttemptWindow=\"10\" applicationName=\"/\" /&gt;\n      &lt;/providers&gt;\n    &lt;/membership&gt;\n    &lt;roleManager defaultProvider=\"DefaultRoleProvider\"&gt;\n      &lt;providers&gt;\n        &lt;add name=\"DefaultRoleProvider\" type=\"System.Web.Providers.DefaultRoleProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" connectionStringName=\"DefaultConnection\" applicationName=\"/\" /&gt;\n      &lt;/providers&gt;\n    &lt;/roleManager&gt;\n    &lt;!-- &lt;sessionState mode=\"InProc\" timeout=\"30\" customProvider=\"DefaultSessionProvider\"&gt;\n      &lt;providers&gt;\n        &lt;add name=\"DefaultSessionProvider\" type=\"System.Web.Providers.DefaultSessionStateProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" connectionStringName=\"DefaultConnection\" applicationName=\"/\" /&gt;\n      &lt;/providers&gt;\n    &lt;/sessionState&gt; --&gt;\n    &lt;sessionState mode=\"SQLServer\" cookieless=\"true\" sqlConnectionString=\"data source=xxxx; User ID=xxxx; password=xxxx\" timeout=\"300\" sqlCommandTimeout=\"10\" /&gt;\n    &lt;httpHandlers&gt;\n      &lt;add verb=\"GET,HEAD\" path=\"asset.axd\" validate=\"false\" type=\"Telerik.Web.Mvc.WebAssetHttpHandler, Telerik.Web.Mvc\" /&gt;\n    &lt;/httpHandlers&gt;\n  &lt;/system.web&gt;\n  &lt;system.webServer&gt;\n    &lt;security&gt;\n      &lt;requestFiltering&gt;\n        &lt;requestLimits maxAllowedContentLength=\"3000000000\" /&gt;\n      &lt;/requestFiltering&gt;\n    &lt;/security&gt;\n    &lt;validation validateIntegratedModeConfiguration=\"false\" /&gt;\n    &lt;modules runAllManagedModulesForAllRequests=\"true\" /&gt;\n    &lt;directoryBrowse enabled=\"true\" /&gt;\n    &lt;handlers&gt;\n      &lt;remove name=\"asset\" /&gt;\n      &lt;add name=\"asset\" preCondition=\"integratedMode\" verb=\"GET,HEAD\" path=\"asset.axd\" type=\"Telerik.Web.Mvc.WebAssetHttpHandler, Telerik.Web.Mvc\" /&gt;\n    &lt;/handlers&gt;\n  &lt;/system.webServer&gt;\n  &lt;runtime&gt;\n    &lt;assemblyBinding xmlns=\"urn:schemas-microsoft-com:asm.v1\"&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.Helpers\" publicKeyToken=\"31bf3856ad364e35\" /&gt;\n        &lt;bindingRedirect oldVersion=\"1.0.0.0-2.0.0.0\" newVersion=\"2.0.0.0\" /&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.Mvc\" publicKeyToken=\"31bf3856ad364e35\" /&gt;\n        &lt;bindingRedirect oldVersion=\"0.0.0.0-4.0.0.0\" newVersion=\"4.0.0.0\" /&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.WebPages\" publicKeyToken=\"31bf3856ad364e35\" /&gt;\n        &lt;bindingRedirect oldVersion=\"0.0.0.0-2.0.0.0\" newVersion=\"2.0.0.0\" /&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"Microsoft.WindowsAzure.StorageClient\" publicKeyToken=\"31bf3856ad364e35\" culture=\"neutral\" /&gt;\n        &lt;bindingRedirect oldVersion=\"0.0.0.0-1.7.0.0\" newVersion=\"1.7.0.0\" /&gt;\n      &lt;/dependentAssembly&gt;\n    &lt;/assemblyBinding&gt;\n  &lt;/runtime&gt;\n &lt;/configuration&gt;\n</code></pre>\n"},{"tags":["c#","sql-server-2008","triggers"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":105,"score":-2,"question_id":12994694,"title":"Insert update delete trigger in SQL Server","body":"<p>I have a windows application form. The table is called <code>messages</code> and whenever user inserts updates or deletes a message, the date/timestamp is stored in the column <code>UserAction</code>. </p>\n\n<p>This column information should be retrieved and shown in the UI as a link. Clicking that link has an action and the link should be seen as read.</p>\n\n<p>Can someone help me in giving some ideas to achieve this action?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","performance","sql-server-2008","indexing"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":951,"score":0,"question_id":488258,"title":"Adding a index on my table for this query","body":"<p>This table gets hit with this query the most, so I want add a index to speed things up, this table will have 5 million rows it in.</p>\n\n<p>My query looks like this:</p>\n\n<p>SELECT someID \nFROM someTable \nWHERE \n    myVarChar = @myVarChar AND\n    MyBit = 0 AND MyBit2 = 1 AND MyBit3 = 0</p>\n\n<p>myVarChar is unique also.</p>\n\n<p>What would the best index be for this type of query?</p>\n\n<p>I currently have a single index that covers all of the 4 columns in the above query.</p>\n\n<p>I am using sql server 2008 standard.</p>\n\n<p>Do I have to reindex every so often or its automatic?</p>\n"},{"tags":["sql","tsql","sql-server-2008","combinatorics"],"answer_count":4,"favorite_count":5,"up_vote_count":8,"down_vote_count":0,"view_count":1919,"score":8,"question_id":3686062,"title":"Generate all combinations in SQL","body":"<p>I need to generate all combinations of size <code>@k</code> in a given set of size <code>@n</code>. Can someone please review the following SQL and determine first if the following logic is returning the expected results, and second if is there a better way?</p>\n\n<pre><code>/*CREATE FUNCTION dbo.Factorial ( @x int ) \nRETURNS int \nAS\nBEGIN\n    DECLARE @value int\n\n    IF @x &amp;lt;= 1\n        SET @value = 1\n    ELSE\n        SET @value = @x * dbo.Factorial( @x - 1 )\n\n    RETURN @value\nEND\nGO*/\nSET NOCOUNT ON;\nDECLARE @k int = 5, @n int;\nDECLARE @set table ( [value] varchar(24) );\nDECLARE @com table ( [index] int );\n\nINSERT @set VALUES ('1'),('2'),('3'),('4'),('5'),('6');\n\nSELECT @n = COUNT(*) FROM @set;\n\nDECLARE @combinations int = dbo.Factorial(@n) / (dbo.Factorial(@k) * dbo.Factorial(@n - @k));\n\nPRINT CAST(@combinations as varchar(max)) + ' combinations';\n\nDECLARE @index int = 1;\n\nWHILE @index &amp;lt;= @combinations\nBEGIN\n    INSERT @com VALUES (@index)\n    SET @index = @index + 1\nEND;\n\nWITH [set] as (\n    SELECT \n        [value], \n        ROW_NUMBER() OVER ( ORDER BY [value] ) as [index]\n    FROM @set\n)\nSELECT \n    [values].[value], \n    [index].[index] as [combination]\nFROM [set] [values]\nCROSS JOIN @com [index]\nWHERE ([index].[index] + [values].[index] - 1) % (@n) BETWEEN 1 AND @k\nORDER BY\n    [index].[index];\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12994000,"title":"Connecting to a remote database using Visual studio","body":"<p>I have domain , database name, database user and password </p>\n\n<p>I want to connect to my database remotely using visual studio 2010, How can I do this ? </p>\n\n<p>thanks in advance </p>\n"},{"tags":["sql-server","sql-server-2008","documentation","schema"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":2009,"score":1,"question_id":1732057,"title":"Tool to Document SQL Server Schema","body":"<p>Can anyone recommend a free (or cheap) program out there which allows me to easily document what certain tables and fields are used for in our applications? Ideally, when we update a fields type, it would automagically update in this tool. Also, showing what fields are indexed etc would be beneficial.</p>\n\n<p>What solutions have you guys / gals used to document your database?</p>\n\n<p>We use MS SQL Server 2008</p>\n"},{"tags":["sql-server","sql-server-2008","triggers","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2376,"score":0,"question_id":940189,"title":"Dynamically finding column values in a trigger from INSERT when the column name is a variable","body":"<p>I have a trigger that gets inserts and updates to a view. I need to find the columns that are being modified and get the value into the correct table.</p>\n\n<pre><code>INSERT INTO TempTableAttr_Lot(ID, [% Num]) VALUES(3, 24.0)\n</code></pre>\n\n<p>I am trying to figure out how, in my trigger, to get the value of ID and [% Num] columns.  The problem is that there can be 32 different columns that are set in the insert or update, so I want to loop through looking to see if that column is in the 'inserted' table.</p>\n\n<p>One problem is that if I use exec or execute, to build a dynamic query, inserted is not in scope for this.</p>\n\n<p>The view is dynamic in that if attributes are added then the view is regenerated by a stored procedure, so I can't assume what column names are in the view at any given time, it can grow and shrink.</p>\n\n<p>Ideally I would like to do <code>SET @Value = (SELECT i.[@Name] FROM inserted i)</code> But @Name is not a column name, but a variable in my trigger, so when I tried </p>\n\n<pre><code>DECLARE @ValueTable TABLE ( value sql_variant)\nINSERT INTO @ValueTable EXECUTE('SELECT i.[' + @Name + '] FROM inserted i')\nSET @Value = CONVERT(nvarchar(128), (SELECT DISTINCT * FROM @ValueTable))\n</code></pre>\n\n<p>this didn't work as inserted appears to not be in scope.</p>\n\n<p>For the first loop @Name = 'ID' and for the second it will be 'Col2' which was not inserted, so the value of @Value should be null, and I continue to loop through the possible column names until I finish, and the trigger is processed.</p>\n\n<p>I am calling it a trigger, it is defined as:</p>\n\n<pre><code>CREATE TRIGGER TempTableAttr_LotTrigger \nON  TempTableAttr_Lot \nINSTEAD OF UPDATE, INSERT\n</code></pre>\n\n<p>I am testing with an INSERT command at the moment. I realize that when doing an update I may need to look at the 'deleted' table.</p>\n\n<p>UPDATE: I am assuming only one row is being inserted at the moment, for my test, to see how to get this to work.  This is for an entity-attribute-value database, but I have a view that makes it look relational. When using Integration Service, when the updating is going on, any inserts or updates to the view will call the trigger. I am just trying to understand how to get the information I need so I can update the correct table, with the correct values.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":7,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":15435,"score":3,"question_id":1248423,"title":"how to see active SQL Server connections?","body":"<p>I am using SQL Server 2008 Enterprise. I want to see any active SQL Server connections, and the related information of all the connections, like from which IP address, connect to which DB or something.</p>\n\n<p>Any existing tools to solve this issue?</p>\n\n<p>thanks in advance,\nGeorge</p>\n"},{"tags":["c#","sql-server-2008","transactions","locks"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":12616509,"title":"Transactions and Locks","body":"<p>I am currently working with transactions and getting confused. These transaction are created at the data access layer and not in the stored procedures of the database (SQL Server 2008).\nI understand the normal working of Isolation Levels set for a transaction.\nI am unable to comprehend what should happen in the following scenario.</p>\n\n<ol>\n<li>Initiate a transaction</li>\n<li>Select Employee with ID=1.</li>\n<li>Update Employee with ID=1.</li>\n<li>Commit</li>\n</ol>\n\n<p>There are multiple threads doing the same thing but different ID. But there might be a case where in two threads look up the same ID. Lets call them Thread A and B. The above steps progress in the following manner with respect to the two threads. The Isolation Level is set to Repeatable Read. </p>\n\n<p>A1. Initiate a transaction\nA2. Select Employee with ID=1.\nB1. Initiate a transaction\nB2. Select Employee with ID=1.\nA3. Update Employee with ID=1.\nA4. Commit\nB3. Update Employee with ID=1.\nB4. Commit</p>\n\n<p>What I really want to achieve from the transaction is that when Thread A selects a particular record, Thread B should not even be able to select that record. I don't know if I am thinking on the right track by using transactions and locks for this scenario.</p>\n\n<p>Awaiting replies :)</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":2355602,"title":"how to pass this information to SQL Server 2008?","body":"<p>Please visit <a href=\"http://www.stumbleupon.com/\" rel=\"nofollow\">http://www.stumbleupon.com/</a></p>\n\n<p>It asks you what interests you.</p>\n\n<p>I would have a similar thing on my website except I would need to have 4 of such non-identical blocks. When a user has not selected anything in a section, it means s/he has selected all of them. 1 of these blocks would have around 10 options while the other 3 would have 2-3 options each.</p>\n\n<p>How do I pass what all a user has selected to SQL Server 2008? Please note I would have 4 sets of multiple params, and these 4 sets are basically 4 different columns in the row all containing integer id's. If and only if one param per section was passed, I would have done something like</p>\n\n<p>select * from table where column1 = @param1, column2 = @param2 and so on.</p>\n\n<p>but that is not the case, because a user could pass multiple values for @param1 and so on.</p>\n\n<p>I can get this done, but I want to know the most efficient way.</p>\n\n<p>If my post is not clear, please let me know. </p>\n\n<p>EDIT: \nBasically, if I am storing articles in the database, I have 4 columns in the row, each integer.  And I want to query these articles based on these 4 columns, but the catch is to pass the multiple values for these columns NOT just one value per column.</p>\n"},{"tags":["sql-server","sql-server-2008","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":109,"score":-1,"question_id":12989306,"title":"SQL Server row values as column names Pivot Table?","body":"<p>I have the following view in SQL Server 2008.</p>\n\n<pre><code>DEPT | EMP_ID | EMP_NAME | P_DATE  | HOURS_WORKED\n</code></pre>\n\n<p>I want the view to be this way:</p>\n\n<pre><code>DEPT | EMP_ID | EMP_NAME | 2012-09-28 | 2012-09-29 | 2012-09-30 | 2012-10-01 ...\n</code></pre>\n\n<p>where the above date column header is P_DATE below which is \"Hours_Worked\" values of that employee on that particular date.</p>\n\n<p>Like</p>\n\n<pre><code>2012-09-28\n\n09:00:00\n\n10:00:00\n</code></pre>\n\n<p>I am not sure whether I could achieve it using Pivot.</p>\n\n<p>Please go to this link for clear understanding : <a href=\"http://imgur.com/a/82eSo\" rel=\"nofollow\" title=\"SQL Server view images\">SQL Server View Snapshots</a></p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12984830,"title":"Stored procedure to delete from 3 tables","body":"<p>I'm creating an album and image gallery as a feature for a directory. Basically, a business can create albums, and add images to those albums.</p>\n\n<p>Here are my tables:</p>\n\n<ul>\n<li>BD_Album (AlbumID, OwnerID, AlbumName) </li>\n<li>BD_Image (ImageID, OwnerID, ImageFile, ImageTitle, ImageDescription, Active)</li>\n<li>BD_AlbumImage (EntryID, AlbumID, ImageID)</li>\n</ul>\n\n<p>I want to create a stored procedure that is executed when the owner deletes an album. My goal for this procedure is to clean up the tables.</p>\n\n<pre><code>DELETE FROM BD_Album WHERE AlbumID = @AlbumID --This is the obvious\nDELETE FROM BD_Image WHERE ...\nDELETE FROM BD_AlbumImage WHERE AlbumID = @AlbumID\n</code></pre>\n\n<p>My confusion comes in where I want to also remove any images from the <code>BD_Image</code> table that are associated with that album. (Warning, removing this album will also delete all images from within it. Are you sure?)</p>\n\n<p>The owners are able to create as many albums as they'd like. They can also assign an image to multiple albums via a listbox in the form.</p>\n\n<p>Probably a bit elementary, but any help would be appreciated.</p>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12989312,"title":"how to get data from two tables by passing single id common in both table in efw4.0","body":"<p>I want data of two tables(having foreign key) by passing single id and what should be its return type in efw 4.0?</p>\n"},{"tags":["sql-server","sql-server-2008","linked-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12458052,"title":"Linked Server Insert-Select Performance","body":"<p>Assume that I have a table on my local which is <code>Local_Table</code> and I have another server and another db and table, which is <code>Remote_Table</code> (table structures are the same).</p>\n\n<p><code>Local_Table</code> has data, <code>Remote_Table</code> doesn't. I want to transfer data from <code>Local_Table</code> to <code>Remote_Table</code> with this query:</p>\n\n<pre><code>Insert into RemoteServer.RemoteDb..Remote_Table\nselect * from Local_Table (nolock)\n</code></pre>\n\n<p>But the performance is quite slow.</p>\n\n<p>However, when I use SQL Server import-export wizard, transfer is really fast.</p>\n\n<p>What am I doing wrong? Why is it fast with Import-Export wizard and slow with insert-select statement? Any ideas?</p>\n"},{"tags":["asp.net","sql","sql-server","asp.net-mvc","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":155,"score":7,"question_id":12983539,"title":"Stored procedures in SQL Server master-child relationships not tables","body":"<p>In college last year I came across something I found very interesting with regard to stored procedures. It was mostly with regard to reducing code repetition for transaction management, error handling, and security. But I have researched it since and cannot find it anywhere. Perhaps I don't know what it is called so I will explain.</p>\n\n<p>Let's say I have a simple table (forget its relationships, just a single table). I have at least 5 possible operations I can do on it namely CRUD, with the R being read the details of one row, or read a list of rows for a given criteria. Again, let's not get into too much detail with complicated stored procedures and let's pretend, for this example, we want nothing but the following 5 operations to be performed:</p>\n\n<ul>\n<li>Create (simple insert)</li>\n<li>Read (one for reading a single row)</li>\n<li>Read multiple (reading a list of rows, simple <code>select * from sometable where some condition</code>, nothing complicated), </li>\n<li>Update (simple update)</li>\n<li>Delete (again, simple delete). </li>\n</ul>\n\n<p>For the purposes of this example, a simple table with 2 or 3 columns, and the most simple procedures you can come up with to do those operations.</p>\n\n<p><strong>The problem</strong>:</p>\n\n<p>My lecturer, when talking to us about transactions, advised us to take these simple procedures, and keep them separate as is normal. But then to write a master procedure which executes each of these. This means we have a master procedure into which we pass a character lets say 'C' for create and so on, and a series of conditions which decide which job to run. Of course, we should pass in the details needed from the master to the child proc which means we need to get them from the user as parameters. This master procedure is already beginning to sound complicated.</p>\n\n<p>His reasoning, do the transaction handling, validation, error handling, and security handling in the master procedure. Then call that master procedure with the required parameters, which does all the checking, and passes the parameters to the child procedure. Below is an example.</p>\n\n<p><img src=\"http://i.stack.imgur.com/nnSly.jpg\" alt=\"enter image description here\"></p>\n\n<p>Simple table, don't go worrying too much about relationships, keys, indexes, constraints, triggers and so on.</p>\n\n<p>For the below two pieces of code, the only real relevant bit is the parts between the try...catch. The rest is boiler plate for the master.</p>\n\n<p>Below is the code for a create procedure:</p>\n\n<pre><code>ALTER proc [Actions].[AreaCreate]\n--External Variables - Input\n@AreaName varchar(50),  @AreaAvailablity bit,   @Description varchar(max),\n\n--External Variables - Output\n@NoOfRecords int output\n\nas\n--Internal Variables\ndeclare @ErrorMessage varchar(max)\n\nBegin try\n    insert  [Tennis3rdYrMVC].[dbo].Areas\n            ([AreaName],    [AreaAvailablity],  [Description])\n    values  (@AreaName,     @AreaAvailablity,   @Description)\n\n    --Show # of records affected so you can detect nulls or empty lists\n    --and handle them as you choose in the code\n    set     @NoOfRecords = @@ROWCOUNT\nEnd try\nBegin Catch\n    set @ErrorMessage = ERROR_MESSAGE()\n    raiserror(@ErrorMessage,16,1)\n    return ERROR_NUMBER()\nEnd Catch\n\n--All Ok\nreturn 0\n</code></pre>\n\n<p>Below is another piece of code for a delete procedure</p>\n\n<pre><code>ALTER proc [Actions].[AreaDelete]\n--External Variables - Input\n@Id int,\n\n--External Variables - Output\n@NoOfRecords int output\n\nas\n--Internal Variables\ndeclare @ErrorMessage varchar(max)\n\nbegin try\n    delete from [Tennis3rdYrMVC].[dbo].Areas\n    where Id = @Id\n\n    --Show # of records affected so you can detect nulls or empty lists\n    --and handle them as you choose in the code\n    set @NoOfRecords=@@ROWCOUNT\nend try\nbegin catch\n    set @ErrorMessage = ERROR_MESSAGE()\n    raiserror(@ErrorMessage,16,1)\n    return ERROR_NUMBER()\nend catch\n\n--All Ok\nreturn 0\n</code></pre>\n\n<p>Finally, the suggested, and complicated master proc.</p>\n\n<pre><code>ALTER proc [Admin].[AreaMaster]\n--External Variables - Input\n@JobType int, -- 1=Create, 2=Read 1, 3=Read Many, 4=Update, 5=Delete\n--Master sprock uses null defaults because not every job requires every field to be present.\n--i.e. We dont need to know the area name of an area we want to delete.\n@Id int                 = null,     @AreaName varchar(50)       = null,\n@AreaAvailablity bit    = null,     @Description varchar(max)   = null,\n\n--External Variables - Output\n@NoOfRecords int = null output --Used to count the number of records affected where needed.\nas\nBEGIN\n    --Internal Variables\n    declare @ErrorMessage varchar(max)\n    declare @return_value int\n\n    -- SET NOCOUNT ON added to reduce network traffic and speed things up a little.\n    SET NOCOUNT ON;\n\n    /*\n    --VALIDATION\n\n    --Logic for ensuring all required values are entered should be done in processing below in\n    --the master sprock, NOT in the children (i.e. why check for valid id in 5 sprocks when you\n    --can do it here in one).\n\n\n    We will do all the processing needed to ensure valid and required values are entered where\n    needed.\n\n    --SECURITY\n    This is also where we put the security code required to stop SQL Injection and other\n    attacks, NOT in the child sprocks. The child sprocks would not be allowed to execute by\n    pages directly.\n\n    */\n\n    --Once all validation is done, call  relevant child sprocks\n\n    --Call AreaCreate Sprock\n    if(@JobType='1')\n    begin\n        exec    @return_value = [Actions].[AreaCreate]\n                @AreaName           = @AreaName,\n                @AreaAvailablity    = @AreaAvailablity,\n                @Description        = @Description,\n                @NoOfRecords        = @NoOfRecords OUTPUT\n\n        --select    @return_value 'Return Value'\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem creating area.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaShowDetail Sprock\n    if(@JobType='2')\n    begin\n        exec    @return_value   = [Actions].[AreaShowDetail]\n                @Id             = @Id,\n                @NoOfRecords    = @NoOfRecords output\n        ----Testing\n        --select    'Return Value' = @return_value\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem reading area details.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaShowList Sprock\n    if(@JobType='3')\n    begin\n        exec    @return_value   = [Actions].[AreasShowList]\n                @NoOfRecords    = @NoOfRecords output\n        ----Testing\n        --select    'Return Value' = @return_value\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem reading areas list.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaUpdate Sprock\n    if(@JobType='4')\n    begin\n        EXEC    @return_value = [Actions].[AreaUpdate]\n                @Id                 = @Id,\n                @AreaName           = @AreaName,\n                @AreaAvailablity    = @AreaAvailablity,\n                @Description        = @Description,\n                @NoOfRecords        = @NoOfRecords OUTPUT\n\n        --select    'Return Value'      = @return_value\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem updating area.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaDelete Sprock\n    if(@JobType='5')\n    begin\n        exec    @return_value   = [Actions].[AreaDelete]\n                @Id             = @Id,\n                @NoOfRecords    = @NoOfRecords output\n\n        --select    'Return Value'  = @return_value\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem deleting area(s).',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n    --All Ok\n    return 0\nEND\n</code></pre>\n\n<p>Is that complicated or what? Now imagine another level which if you have several tables to operate on, will decide which sub master to call, and this MasterMaster for want of a better name must have external parameters for every field in every table. However, the validation, security, and transaction code would be moved up to that level instead.</p>\n\n<p>More importantly, is that the way a professional would do it. And finally, I am using MVC with entity framework. Suppose I have a database like this (I have), and access is only allowed through this master stored procedure (it is). How do I call such a stored procedure from within EF and MVC. Even better, how would I bypass EF all together and get the data into my controller in a way my view will understand. I know how to do this with ASP.Net code behind. But not in MVC.</p>\n\n<p>Any suggestions. Please, feel free to tell me that this is completely crazy as it seems like a hell of a lot of work (what if you have 50 tables (I do). Imagine, 5 simple operations, across 50 tables = 250 child stored procedures + 50 Sub-Sub-Masters, + 5 Sub-Masters + 1 Master. I have my work cut out. Is there a tool that can do this or at least generate a template for me?</p>\n\n<p>So to summarise, My questions are:</p>\n\n<ol>\n<li>Is this overly complicated or is this the professional way to do this?</li>\n<li>What is the term used to describe this Master / child procedural relationship.</li>\n<li>Is there a tool that can automate this process.</li>\n<li>Is there a tool that can help me generate some kind of boilerplate template.</li>\n<li>How can I use this procedure with EF and MVC</li>\n<li>How can I bypass EF altogether and just find a way to call the procedure directly.</li>\n<li>Is there anything like the equivalent of classes, or even methods in T-SQL which can structure this much like a standard piece of code. Meaning that each child procedure is a method, each table has its properties, and the constructor will be the the initial (or altered) representation of the object.</li>\n<li>If 7 does exist, which would be more standard, the way I described (i.e.) splitting everything up, or the idea in 7.</li>\n</ol>\n\n<p>With regard to this point 4 I am talking about something simple, like the one already in SQL Server where you right click a procedure and choose execute and it generates some simple code for testing your procedure, or like the one for making functions.</p>\n\n<p>Thanks for reading this and for any help you can offer.</p>\n"},{"tags":["linq","sql-server-2008","auto-increment"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12980555,"title":"Auto increment in SQL Server while using linq","body":"<p>I want to update three fields/columns in my database table. One of them is primary key  \"id\", I made it autoincrement using visual studio's set column properties:</p>\n\n<pre><code>Identity Specification: Yes\n(Is Identity)         : Yes\nIdentity Seed         :  1\nIdentity Increment    :  1\n</code></pre>\n\n<p>Everything going ok, but after checking for 2 times that every thing is going fine I emptied the contents of the table so that the columns can be newly populated. But first row autoincrement column got the value 3. I deleted the row and tried again but It became 4 after row was updated. I don't know what is happening. My linq code has nothing to do with it I suppose, because its just insertion.</p>\n\n<p>Code behind linq:</p>\n\n<pre><code>//DLCountryies - .dbml filename\n// tblcountry - tablename\n// CountryName and CountryCode are Column names\n//txtCountryName - textbox\n\nusing (DLCountryiesDataContext countries = new DLCountryiesDataContext()) \n{                                                                         \n            tblcountry country = new tblcountry\n            {\n                CountryName = txtCountryName.Text.Trim(),\n                CountryCode = txtCountryCode.Text.Trim()\n            };\n\n            countries.tblcountries.InsertOnSubmit(country);\n            countries.SubmitChanges();\n} \n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-express"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1532,"score":0,"question_id":5956807,"title":"sp_dropserver and sp_addserver not working","body":"<p>I am using SQL Server Express 2008 R2 and I wanted to change the instance name from \"machine name\"\\SQLEXPRESS2008R2 to just \"machine name\".  I ran:</p>\n\n<pre><code>sp_dropserver 'old_name'\n\ngo\n\nsp_addserver 'new_name', 'local'\n\ngo\n</code></pre>\n\n<p>Then restarted the SQL Service.  Now when I look at </p>\n\n<pre><code>Select @@SERVERNAME --this is correct\n</code></pre>\n\n<p>But this isn't correct?</p>\n\n<pre><code>Select serverproperty('ServerName') --This still shows old name\n</code></pre>\n\n<p>So when I try to connect to my instance via SSMS I still have to connect using the old instance name isntead of the new on I just applied? What am I doing wrong? Why is the new name not taking?</p>\n\n<p>Thanks,</p>\n\n<p>S</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008"],"answer_count":3,"favorite_count":6,"up_vote_count":6,"down_vote_count":0,"view_count":2865,"score":6,"question_id":793643,"title":"Auditing SQL Server data changes","body":"<p>I'm looking at changing our Auditing process for our SQL Server 2005 databases and I came across Change Data Capture in SQL Server 2008. </p>\n\n<p>This looks like a good idea, and I'm tempted to try it, but before I do has anyone used it in a commercial environment and what are your thoughts?</p>\n\n<p>I noticed when I was reading about CDC in the MS help, it said that audit data would usually be kept for a couple of days. That's not possible here, I'd like to keep the data indefinitely, does anyone know of problems with this approach?</p>\n\n<p>If this isn't a good solution for reasons I'm unaware of, have you any other solutions for  auditing of data changes. I'm keen to use a system that can be implemented across the board on any tables I desire.</p>\n\n<p>I'm after the basic: \"Before, After, Who By, When\" information for any changes.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12985524,"title":"Merge two database table partitions by their partition number","body":"<p>I have created four partitions in SQL Server using the following functions.</p>\n\n<pre><code>CREATE PARTITION FUNCTION fnYearsRT(DateTime)\nAS RANGE RIGHT FOR VALUES\n('01/01/2005', '01/01/2006', '01/01/2007', '01/01/2008');\n\nCREATE PARTITION SCHEME date_partscheme\n AS PARTITION fnYearsRT\n TO (Filegroup1, Filegroup2, Filegroup3, Filegroup4,Filegroup5)\n\nCREATE TABLE Sales.ReturnsArchive\n  (\n     ReturnID  int  IDENTITY NOT NULL, \n     ProductID  int  NOT NULL, \n     CustomerID  int  NOT NULL, \n     ReturnDate  datetime  NOT NULL,  \n     ReturnReason  char(20)  NULL  \n  ) \n ON date_partscheme (ReturnDate)\n</code></pre>\n\n<p>After inserting data I have the following stats</p>\n\n<pre><code>Partition   COUNT\n2       5151\n3       19353\n4       51237\n5       45576\n</code></pre>\n\n<p>I want to merge partition 2 and 3 but I am unable to decide which range I should give in merge function. </p>\n"}]}
{"total":21073,"page":9,"pagesize":100,"questions":[{"tags":["c#","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12986281,"title":"how to change database version from 655 to 612?","body":"<p>Error -</p>\n\n<blockquote>\n  <p><em>mdf file can not be opened because it is version 655, this version\n  support 612 or earlier</em></p>\n</blockquote>\n\n<p>Note :</p>\n\n<p>I am created this database file using SQL Server 2005 and later that file is opened in SQL Server 2008 then automatically change version from 612 to 655.</p>\n\n<p>But I currently want to open that file in SQL Server 2005.</p>\n\n<p>Any solution is possible then help me.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12985795,"title":"How can we retrieve deleted rows in SQL Server 2008?","body":"<p>Can we retrieve back deleted rows of table(s) from a database in SQL Server 2008 ? </p>\n\n<p>If yes please let me know how can we do this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1331,"score":0,"question_id":10156733,"title":"SQL Server Date Formats (YYYY-MM-DD HH:MI:SS.MMM)","body":"<p>Update:\ni am still getting this <code>(4/14/2012 2:44:01 PM)</code>  result after trying this</p>\n\n<pre><code> select convert(varchar(30), '4/14/2012 2:44:01 PM',121) \n</code></pre>\n\n<p><strong>End Update</strong></p>\n\n<p>what format should i use in order to get this result set:</p>\n\n<pre><code>2012-04-14 14:44:01.683\n</code></pre>\n\n<p>i tried using this but does not show the micro/milli seconds</p>\n\n<pre><code>select convert(varchar(23), '4/14/2012 2:44:01 PM',120)\n</code></pre>\n\n<p>gets me this result:</p>\n\n<pre><code>4/14/2012 2:44:01 PM\n</code></pre>\n"},{"tags":["sql-server-2008","replication","database-replication"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":3354,"score":4,"question_id":3441081,"title":"Length of LOB data (78862) to be replicated exceeds configured maximum 65536","body":"<p><a href=\"http://stackoverflow.com/questions/925824/when-insert-length-of-lob-data-to-be-replicated-exceeds-configured-maximum-65536\">Here</a> is a related question.</p>\n\n<p>Why do I get this error even when I have not installed SQL Server replication ? The strangest thing is, when I run the fix</p>\n\n<pre><code>sp_configure 'max text repl size', 2147483647\nGo\nRECONFIGURE\nGO\n</code></pre>\n\n<p>it works and I no longer get this error</p>\n"},{"tags":["sql","sql-server-2008","query","sum","select-case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12984396,"title":"SQL Sum with conditions in a select case","body":"<p>have the following sql query</p>\n\n<pre><code>select catalogid\n   , sum(numitems) numitems\n   , sum(allitems) - sum(numitems) ignoreditems\nfrom\n(\n   select i.catalogid\n      , case\n           when (ocardtype in ('PayPal','Sofort') OR\n                   ocardtype in ('mastercard','visa') and\n                   odate is not null)\n              AND NOT EXISTS\n              (\n                 select *\n                 FROM bookedordersids b\n                 where b.booked = o.orderid\n              )\n           then numitems\n           else 0\n        end AS numitems\n      , numitems AS allitems\n   from orders AS o\n   join oitems AS i on i.orderid = o.orderid\n) AS X\ngroup by catalogid\n</code></pre>\n\n<p>now i've 2 tables Here\norders and oitems table</p>\n\n<p>the query sums the <code>numitems</code> and <code>ignoreditems</code> based on the conditions you see, now what if i want to find the sum only when the value of a column called <code>oprocessed</code> in <code>oitems</code> table is <code>0</code> ,</p>\n\n<p>do i add the following before <code>X</code></p>\n\n<pre><code>where oprocessed=0\n</code></pre>\n\n<p>or should i add a condition to the SELECT CASE?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":89,"score":2,"question_id":12980578,"title":"How to replace all spaces between a <p> and </p> tag","body":"<p>I am going through about 5000 records and needing to replace all spaces between a <code>&lt;p&gt; &lt;/p&gt;</code> tag with <code>&amp;nbsp;</code></p>\n\n<p>Would this work?</p>\n\n<p>I thought this would work with a SET replace()</p>\n\n<pre><code>SELECT *\nFROM FMS.[AuditItem] ai\nWHERE ai.[NotificationMessage] LIKE '%&lt;p&gt;% %&lt;/p&gt;%'\n</code></pre>\n\n<p>But I still have no way to select only the spaces between the paragraph tags. Right? Is there a better way to go about this? </p>\n"},{"tags":["sql-server-2008","stored-procedures","syntax-error","ssms-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12981182,"title":"SQL Server: stored procedure saves with errors","body":"<p>I am using SQL Server 2008 and SSMS 2012. I have a stored procedure that references a table that does not exist. The editor displays red underlines on the offending table to indicate that something is wrong. </p>\n\n<p>However when I execute the query, I get the message </p>\n\n<blockquote>\n  <p>Command(s) completed successfully.</p>\n</blockquote>\n\n<p>This is extremely annoying. I also connected to the engine from another machine and it experienced the same problem, which implies its on the server, not ssms. Is there some kind of setting on the database that determines whether the database checks the syntax of stored procedures? PLEASE HELP!</p>\n\n<p><strong>Clarification:</strong>\nI know that the syntax is wrong. The problem is that SSMS allows me to execute the CREATE or ALTER statement without error even when it references a table that does not exist. I want it to fail. Usually it does, but for some reason it suddenly stopped giving errors. I want it to give me errors. How do I do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":896,"score":2,"question_id":7475845,"title":"Getting Number of weeks in a Month from a Datetime Column","body":"<p>I have a table called FcData and the data looks like:</p>\n\n<pre><code>Op_Date\n\n2011-02-14 11:53:40.000\n2011-02-17 16:02:19.000\n2010-02-14 12:53:40.000\n2010-02-17 14:02:19.000\n</code></pre>\n\n<p>I am looking to get the Number of weeks in That Month from Op_Date. So I am looking for output like:</p>\n\n<pre><code> Op_Date                       Number of Weeks\n\n    2011-02-14 11:53:40.000       5   \n    2011-02-17 16:02:19.000       5\n    2010-02-14 12:53:40.000       5\n    2010-02-17 14:02:19.000       5\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":85,"score":6,"question_id":12979095,"title":"joining a pivot with another complex table","body":"<p>my pivot query generates:</p>\n\n<pre><code>+-----------+----+----+---+---+---+---+---+\n| client_id | 1  | 2  | 3 | 4 | 5 | 6 | 7 |\n+-----------+----+----+---+---+---+---+---+\n|    216436 |  9 |  0 | 0 | 0 | 0 | 0 | 0 |\n|    110522 | 76 |  3 | 0 | 0 | 0 | 0 | 0 |\n|    214981 |  0 |  1 | 0 | 0 | 0 | 0 | 0 |\n|    216360 | 52 |  1 | 0 | 0 | 0 | 0 | 0 |\n|    102574 |  1 |  0 | 0 | 0 | 0 | 0 | 0 |\n|    211754 | 97 | 14 | 2 | 0 | 0 | 0 | 0 |\n|    210734 |  8 |  4 | 0 | 0 | 0 | 0 | 0 |\n|    100123 |  1 |  0 | 0 | 0 | 0 | 0 | 0 |\n|    101840 |  2 |  0 | 0 | 0 | 0 | 0 | 0 |\n+-----------+----+----+---+---+---+---+---+\n</code></pre>\n\n<p>here's the query:</p>\n\n<pre><code>   select client_id,\n   [1],[2],[3],[4],[5],[6],[7] -- these are timestested (the amount of times tested)\n   from\n   (   SELECT DISTINCT CLIENT_ID\n   , PATIENT_ID\n   , count(*) over (partition by client_id, patient_id) AS patientcount\n\n   from f_accession_daily) as SourceTable\n   PIVOT\n   (\n   count(patient_id)\n   for patientcount in ([1],[2],[3],[4],[5],[6],[7])\n   ) as pivottable\n</code></pre>\n\n<p><strong>I need to bring the max/min dates for every time tested, (for [1], [2], [3], etc)</strong> from this table:</p>\n\n<pre><code>+-----------+-------------+-------+------------+------------+\n| client_id | TimesTested | count | maxRecDate | minRecDate |\n+-----------+-------------+-------+------------+------------+\n|    100034 |           2 |     1 | 6/25/2008  | 6/23/2008  |\n|    100034 |           1 |    20 | 6/30/2008  | 6/19/2008  |\n|    100038 |           3 |     1 | 7/25/2008  | 7/23/2008  |\n|    100038 |           1 |     4 | 7/25/2008  | 7/1/2008   |\n|    100050 |           1 |    15 | 8/11/2008  | 7/14/2008  |\n|    100060 |           1 |     2 | 8/12/2008  | 7/29/2008  |\n|    100070 |           1 |     3 | 8/15/2008  | 8/15/2008  |\n|    100049 |           1 |     3 | 8/22/2008  | 7/11/2008  |\n|    100029 |           3 |     2 | 8/25/2008  | 6/18/2008  |\n+-----------+-------------+-------+------------+------------+\n</code></pre>\n\n<p>the above table is generated by:</p>\n\n<pre><code>SELECT a.client_id AS client_id\n,a.patientcount TimesTested\n   , count(a.patientcount)/a.patientcount AS count\n   , max(f.received_date) AS maxRecDate\n   , min(f.received_date) AS minRecDate\nFROM\n(\n   SELECT DISTINCT CLIENT_ID\n   , PATIENT_ID\n   , count(*) over (partition by client_id, patient_id) AS patientcount\n\n   from f_accession_daily\n\n) AS a\nJOIN F_ACCESSION_DAILY AS f ON a.CLIENT_ID = f.CLIENT_ID\n   AND a.PATIENT_ID = f.PATIENT_ID\n\nGROUP BY a.CLIENT_ID, a.patientcount\n</code></pre>\n\n<p><strong>the resulting table that i need to get:</strong></p>\n\n<pre><code>+-----------+----+----------+-----------+----+----------+-----------+---+----------+-----------+---+----------+-----------+-----+\n| client_id | 1  | maxdate1 | mindate1  | 2  | maxdate2 | mindate2  | 3 | maxdate3 | mindate3  | 4 | maxdate4 | mindate4  |  5  |\n+-----------+----+----------+-----------+----+----------+-----------+---+----------+-----------+---+----------+-----------+-----+\n|    216436 |  9 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | etc |\n|    110522 | 76 | 1/1/2011 | 1/23/1984 |  3 | 1/1/2011 | 1/23/1984 | 0 | 1/1/2011 | 1/23/1984 | 0 | 2/1/2011 | 1/23/1984 |     |\n|    214981 |  0 | 1/1/2013 | 1/23/1985 |  1 | 1/1/2013 | 1/23/1985 | 0 | 1/1/2013 | 1/23/1985 | 0 | 1/1/2013 | 1/23/1985 |     |\n|    216360 | 52 | 1/1/2011 | 1/23/1985 |  1 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 |     |\n|    102574 |  1 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2014 | 1/23/1980 | 0 | 2/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 |     |\n|    211754 | 97 | 1/1/2012 | 1/23/1985 | 14 | 1/1/2012 | 1/23/1985 | 2 | 1/1/2012 | 1/23/1985 | 0 | 1/1/2012 | 1/23/1985 |     |\n|    210734 |  8 | 1/1/2011 | 1/23/1984 |  4 | 1/1/2011 | 1/23/1984 | 0 | 1/1/2011 | 1/23/1984 | 0 | 1/1/2011 | 1/23/1984 |     |\n|    100123 |  1 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1987 |     |\n|    101840 |  2 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2011 | 1/23/1980 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 |     |\n+-----------+----+----------+-----------+----+----------+-----------+---+----------+-----------+---+----------+-----------+-----+\n</code></pre>\n\n<p><strong>how do i join the two tables? the speed does not matter! thank you very much for your kind help.</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":217,"score":0,"question_id":7711336,"title":"SQL Server Rounding Issue","body":"<p>I'm using SQL Server 2005. And I'm using ROUND T-SQL function to round a decimal column value. But it seems that the rounded value is incorrect.</p>\n\n<pre><code>    PRINT ROUND(1890.124854, 2) =&gt; 1890.120000\n</code></pre>\n\n<p>As shown the ROUND function is returning 1890.12 where as it should be 1890.13. Does anyone encountered this and what should be the correct way of rounding so that I get the expected value 1890.13..?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2008","migrate"],"answer_count":3,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":7061,"score":3,"question_id":1010279,"title":"how to migrate from sql 2000 to sql 2008 via restore?","body":"<p>I'm running this code:</p>\n\n<pre><code>RESTORE DATABASE [MyDB_2009May11] \nFROM  DISK = N'C:\\DB Copy\\MyDB_2009May11.bak' \nWITH  \nMOVE N'Archive_Data' \n    TO N'C:\\Program Files\\Microsoft SQL Server\\MSSQL10.SQL2008\\MSSQL\\DATA\\MyDB_2009May11.mdf',  \nMOVE N'Data' \n    TO N'C:\\Program Files\\Microsoft SQL Server\\MSSQL10.SQL2008\\MSSQL\\DATA\\MyDB_2009May11.mdf',  \nMOVE N'Log' \n    TO N'C:\\Program Files\\Microsoft SQL Server\\MSSQL10.SQL2008\\MSSQL\\DATA\\MyDB_2009May11.ldf',  \nNOUNLOAD,  \nSTATS = 10\nGO\n</code></pre>\n\n<p>I'm getting this error:</p>\n\n<p>Msg 3176, Level 16, State 1, Line 1\nFile 'C:\\Program Files\\Microsoft SQL Server\\MSSQL10.SQL2008\\MSSQL\\DATA\\MyDB_2009May11.mdf' is claimed by 'Archive_Data'(3) and 'Data'(1). The WITH MOVE clause can be used to relocate one or more files.\nMsg 3013, Level 16, State 1, Line 1\nRESTORE DATABASE is terminating abnormally.</p>\n\n<p>How the crap do I migrate from sql server 2000 to 2008 when all I have is the backup file?</p>\n\n<p>:)  Any help is appreciated.  </p>\n"},{"tags":["sql","sql-server-2008","datediff"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":559,"score":0,"question_id":8345282,"title":"SQL Server Group By Month","body":"<p>I have a table which has this schema</p>\n\n<pre><code>ItemID    UserID    Year    IsPaid    PaymentDate  Amount\n1         1         2009    0         2009-11-01  300\n2         1         2009    0         2009-12-01  342\n3         1         2010    0         2010-01-01  243\n4         1         2010    0         2010-02-01  2543\n5         1         2010    0         2010-03-01  475\n</code></pre>\n\n<p>I'm trying to get a query working which shows the totals for each month. So far I've tried DateDiff and nested selects, but neither gives me what I want. This is the closest I have I think:</p>\n\n<pre><code>DECLARE @start [datetime] = 2010/4/1;\nSELECT ItemID, IsPaid,\n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 And DateDiff(m, PaymentDate, @start) = 0 AND UserID = 100) AS \"Apr\",\n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =1 AND UserID = 100) AS \"May\",\n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =2 AND UserID = 100) AS \"Jun\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =3 AND UserID = 100) AS \"Jul\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =4  AND UserID = 100) AS \"Aug\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =5  AND UserID = 100) AS \"Sep\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =6  AND UserID = 100) AS \"Oct\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =7 AND UserID = 100) AS \"Nov\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =8 AND UserID = 100) AS \"Dec\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =9 AND UserID = 100) AS \"Jan\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =10 AND UserID = 100) AS \"Feb\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =11 AND UserID = 100) AS \"Mar\" \nFROM LIVE L INNER JOIN Payments I ON I.LiveID = L.RECORD_KEY \nWHERE UserID = 16178 \n</code></pre>\n\n<p>But I just get nulls when I should be getting values. Am I missing something?</p>\n"},{"tags":["java","sql","sql-server","sql-server-2008","jdbc"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":5952,"score":0,"question_id":6403636,"title":"Connecting SQL Server 2008 to Java: Login failed for user error","body":"<p>I am trying to connect my Java code to a Microsoft SQL Server 2008 R2 Express database.  I have downloaded the Microsoft SQL Server JDBC Driver 3.0 and added the sqljdbc4.jar to my classpath.  I am using Netbeans and have included the sqljdbc4.jar in my project also.</p>\n\n<p>I created a database in the SQL Server Management Studio called TestDB1 and added some columns and values that I will use for testing.  I changed from Windows Authentication Mode by right clicking on the server JACOB=PC\\SQLEXPRESS->Properties->Secuity and changing from Windows Authentication Mode to SQL Server and Windows Authentication Mode.  </p>\n\n<p>I then created a new login by right clicking on the Login folder in the window explorer under JACOB-PC/SQLEXPRESS->Secuity Folder->Logins Folder and added a new login.  I gave it the name jhaip2, switched to SQL Server authentication and the set the password to jacob.  Enforce password policy and enforce password expiration are unchecked.  The default database is set to TestDB1.  Then under TestDB1->Secuity->Users->jhaip2->Database role membership I set jhaip2 to db_owner (I couldn't log in to the database in the management studio without doing this, probably not the right thing to do?).  I then restarted the server.</p>\n\n<p>Now for my java code, it is basically a direct copy of the JDBC Driver 3.0 Sample code except without windows authentication.</p>\n\n<pre><code>package databasetest1;\n\nimport java.sql.*;\n\npublic class connectURL {\n\n   public static void main(String[] args) {\n\n      // Create a variable for the connection string.\n      String connectionUrl = \"jdbc:sqlserver://localhost:1433;\" + \"databaseName=TestDB1;\";\n\n      // Declare the JDBC objects.\n      Connection con = null;\n      Statement stmt = null;\n      ResultSet rs = null;\n\n      try {\n         // Establish the connection.\n         Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n         System.out.println(\"Driver okay\");\n         con = DriverManager.getConnection(connectionUrl,\"jhaip2\",\"jacob\");\n         System.out.println(\"Connection Made\");\n\n      }\n\n      // Handle any errors that may have occurred.\n      catch (Exception e) {\n         e.printStackTrace();\n      }\n      finally {\n         if (rs != null) try { rs.close(); } catch(Exception e) {}\n         if (stmt != null) try { stmt.close(); } catch(Exception e) {}\n         if (con != null) try { con.close(); } catch(Exception e) {}\n      }\n   }\n}\n</code></pre>\n\n<p>When I run, it prints out \"Driver okay\" so I am assuming my driver is set up correctly.  Then it prints the error:</p>\n\n<pre><code>com.microsoft.sqlserver.jdbc.SQLServerException: Login failed for user 'jhaip2'.\n</code></pre>\n\n<p>It does not matter what username I use, it always fails.  I have a feeling I am setting up the user wrong.  If anyone could give me some help on how to properly set up a user or any guidance in how to simply connect to a SQL Server database in Java, I would appreciate it.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12982277,"title":"condensing a dataset on nulls","body":"<p>My query returns a table that looks like this (please note that I am posting a very simplified version of the output):</p>\n\n<pre><code>+-------+------+------+------+------+\n|       |  1   |  2   |  3   |  4   |\n+-------+------+------+------+------+\n| 14234 | 3    | null | null | null |\n| 14234 | null | null | 32   | null |\n| 33334 | 4    | null | null | 5    |\n| 33334 | null | 3    | null | null |\n+-------+------+------+------+------+\n</code></pre>\n\n<p>and i would like to reformat it to look like this:</p>\n\n<pre><code>+-------+---+------+------+------+\n|       | 1 |  2   |  3   |  4   |\n+-------+---+------+------+------+\n| 14234 | 3 | null | 32   | null |\n| 33334 | 4 | 3    | null | 5    |\n+-------+---+------+------+------+\n</code></pre>\n\n<p>as you can see the rows have been put together (condensed), i don't know what the right terminology would be. </p>\n\n<p>is there a quick way to do this with sql server?</p>\n\n<p>here's the original query:</p>\n\n<pre><code>;WITH \nPivotQuery as (\n    select client_id,\n       [1],[2],[3],[4],[5],[6],[7]\n       from\n       (   SELECT DISTINCT CLIENT_ID\n       , PATIENT_ID\n       , count(*) over (partition by client_id, patient_id) AS patientcount\n\n       from f_accession_daily) as SourceTable\n       PIVOT\n       (\n       count(patient_id)\n       for patientcount in ([1],[2],[3],[4],[5],[6],[7])\n       ) as pivottable),\n\nMinMaxTimes as (\n    SELECT a.client_id AS client_id\n    ,a.patientcount TimesTested\n       , count(a.patientcount)/a.patientcount AS count\n       , max(f.received_date) AS maxRecDate\n       , min(f.received_date) AS minRecDate\n    FROM\n    (\n       SELECT DISTINCT CLIENT_ID\n       , PATIENT_ID\n       , count(*) over (partition by client_id, patient_id) AS patientcount\n\n       from f_accession_daily\n\n    ) AS a\n    JOIN F_ACCESSION_DAILY AS f ON a.CLIENT_ID = f.CLIENT_ID\n       AND a.PATIENT_ID = f.PATIENT_ID\n\n    GROUP BY a.CLIENT_ID, a.patientcount),\n\nmaxDates as (\nSELECT client_id, [1] maxdate1, [2] maxdate2, [3] maxdate3, [4] maxdate4, [5] maxdate5, [6] maxdate6, [7] maxdate7\nFROM MinMaxTimes t\nPIVOT (max(maxRecDate)\nfor TimesTested IN ([1], [2], [3], [4], [5], [6], [7])\n) as p),\n\nminDates as (\nSELECT client_id, [1] mindate1, [2] mindate2, [3] mindate3, [4] mindate4, [5] mindate5, [6] mindate6, [7] mindate7\nFROM MinMaxTimes t\nPIVOT (max(minRecDate)\nfor TimesTested IN ([1], [2], [3], [4], [5], [6], [7])\n) as p)\n\nSELECT i.client_id, \n    p.[1], maxdate1, mindate1, \n    p.[2], maxdate2, mindate2, \n    p.[3], maxdate3, mindate3, \n    p.[4], maxdate4, mindate4, \n    p.[5], maxdate5, mindate5, \n    p.[6], maxdate6, mindate6, \n    p.[7], maxdate7, mindate7   \nFROM PivotQuery p\nLEFT OUTER JOIN maxDates a ON p.client_id = a.client_id\nLEFT OUTER JOIN mindates i ON a.client_id = i.client_id\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":67,"score":0,"question_id":12981816,"title":"What does a select statement inside a select statement mean?","body":"<p>What does a Transact SQL statement <code>Select</code> statement inside a <code>from</code> mean? </p>\n\n<p>I mean something like this </p>\n\n<pre><code> .. from ( \n    select .. \n )\n</code></pre>\n\n<p>Also, I need to know if the statement is bad for performance.  Can you provide me a link to the official documentation about this topic in Transact SQL?</p>\n"},{"tags":["c#","asp.net","sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":100,"score":3,"question_id":12981863,"title":"Advantages of a get<object Name> stored procedure architecture in .NET 4+?","body":"<p>I am migrating an existing .NET 2.0, SQL Server codebase to a .NET 4.0, SQL Server 2008 environment. </p>\n\n<p>The design pattern is that all app calls to the database go through a stored procedure. So there's a <code>get[object name]</code> stored procedure that needs to be created or altered for most select statements. </p>\n\n<p>So the disadvantages of this architecture to me are already evident: inconvenience. </p>\n\n<p>What are the advantages of this highly enforced stored procedure design? (now in .NET 4.0 as opposed to using an ORM). </p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12982104,"title":"Silent type conversions in SQL Server 2008","body":"<p>I just recently discovered that SQL Server will return equivalent answers for the following two queries</p>\n\n<pre><code>select * from myTable\n    where column1 in('034','023')\n\nselect * from myTable\n    where column1 in (34,23)\n</code></pre>\n\n<p>The data type in the varchar.  Does anyone have a link or knowledge of other 'silent' datatype conversions in SQL Server (or T-SQL, specifically perhaps)</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12980705,"title":"how to get rows data on the column side","body":"<p>I have a employee table with salary according to number of years as follows:</p>\n\n<pre><code>Employee_table\n-----------------------------------------------------------------------------\nemp_ID -  FirstName- LstName   salary  ...    year -  \n001   -   xx     -     yy   -   03212         2000       \n001   -   xx     -     yy   -   04212         2001        \n002   -   xxx     -    yyy  -   03425         2000         \n002   -   xxx     -    yyy  -   04425         2001          \n003   -   xxxx    -    yyyy  -  03429         2000         \n003   -   xxxx   -     yyyy  -  04429         2001         \n------------------------------------------------------------------------------\n</code></pre>\n\n<p>And I want to write a query which will give me the employee data with year on the column side as:</p>\n\n<pre><code>tblResults\n---------------------------------------------------------------------\nemp_ID   2000       2001          ....     ....            \n---------------------------------------------------------------------\n01        03212     04212   \n02        03425   - 04425    \n03        03429     04429   \n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12977490,"title":"SQL Converting Int to Date or Char","body":"<p>My dbase has date formats in 6 digits with a int datatype ('734503' = 01/01/2012).\nI have been able to successfully convert these to char with:</p>\n\n<pre><code>SELECT CONVERT(char(12),dateadd(dd,(date_paid -    639906),'1/1/1753'),101)  \nFROM   vouchers       \nWHERE date_paid =    '734503'\n</code></pre>\n\n<p>This gives me the output of 01/01/2012.\nBut if I search on the converted date in a query like this:</p>\n\n<pre><code>SELECT CONVERT(char(12),dateadd(dd,(date_paid - 639906),'1/1/1753'),101) \nFROM vouchers    \nWHERE date_paid &gt;= '09/01/2012'  AND date_paid &lt;= '09/30/2012'\n</code></pre>\n\n<p>Why doesn't the conversion take place?  Even if I use a CONVERT in the WHERE statement on the date_paid field, shouldn't it work there?  </p>\n\n<p>I suppose my question is how do I search with the converted character date and not have to use the 6 digit date?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":12979798,"title":"Weird SQL Server comparison is always false","body":"<pre><code>declare @test int\ndeclare @test2 int = 3\n\nselect case when @test != @test2 then 1 else 0 end\nselect case when @test = @test2 then 1 else 0 end\n</code></pre>\n\n<p>The result is always 0. Can someone explain this?</p>\n"},{"tags":["sql-server","sql-server-2008","audit"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":231,"score":5,"question_id":3933881,"title":"Is their an elegant way to track the modification of all columns of one table in SQL Server 2008","body":"<p>There is a table in my database containing 100 columns. I want to create a trigger to audit the modification for every update operation. </p>\n\n<p>What I can think is to create the update clause for all columns but they are all similar scripts. So is there any elegant way to do that?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12962044,"title":"sp_send_dbmail Error In Microsoft SQL Agent Job","body":"<p>I’m trying to send an email from a scheduled SQL Agent job using sp_send_dbmail and receive the following error:</p>\n\n<p>Msg 22050, Level 16, State 1, Line 0\nError formatting query, probably invalid parameters\nMsg 14661, Level 16, State 1, Procedure sp_send_dbmail, Line 504\nQuery execution failed: Msg 15404, Level 16, State 19, Server MyServer, Line 1\nCould not obtain information about Windows NT group/user 'MyDomain\\sqlagent', error code 0x5.</p>\n\n<p>Here is the code from the job step:</p>\n\n<pre><code>DECLARE @SQL NVARCHAR(400)\nSELECT @SQL = 'SELECT COUNT(staff_id) FROM Staff'\n\nEXEC msdb.dbo.sp_send_dbmail\n@recipients = 'me@myemail.com',\n@subject = 'Email Alert',\n@body = 'Test',\n@query = @SQL,\n@execute_query_database = 'MyDB'\n</code></pre>\n\n<p>SQL Agent is running under a domain account [MyDomain\\sqlagent].  I granted this user db_owner permission in the MyDB database in addition to adding it as a member of the DatabaseMailUserRole in msdb.  Still no luck.  If I remove the @query and @execute_query_database parameters it will send a ‘test’ email.  However, I need to attach the results from the query.</p>\n\n<p>Any help is appreciated, thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","logging","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12976938,"title":"Log of stored procedure parameters?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10279470/tracing-a-stored-procedures-parameters-handling\">Tracing a stored procedure’s parameters handling</a>  </p>\n</blockquote>\n\n\n\n<p>Is there any out-of-the-box functionality within SQL Server 2008 that will allow me to see a log of procedures executed, and the parameters passed?  </p>\n\n<p>We have a stored procedure whose return is used to determine if a user can log in to our application or not, and the stored procedure is returning some unexpected results. I'm trying to troubleshoot by seeing if the user ID is getting garbled as it's passed to the stored procedure, but I can't quite seem to find where I could go to check that.</p>\n\n<p>Does such a log/viewer exist?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":96,"score":1,"question_id":12976538,"title":"Removing duplicate combinations from result set in SQL Server","body":"<p>I have a table with two columns with data like this:</p>\n\n<pre><code>1,2\n1,3\n1,4\n2,1\n2,2\n3,1\n</code></pre>\n\n<p>I want to select just unique combinations, so out of those I would end up with:</p>\n\n<pre><code>1,2\n1,3\n1,4\n2,2\n</code></pre>\n\n<p>because 1,2 is the same combination as 2,1 etc</p>\n\n<p>How would I go about that in a SQL statement?</p>\n\n<p>In reality, my table has a third column and I want to add a where clause based on that third column so that only those rows are considered</p>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12977862,"title":"Subtract values of same column of a table depending on other column","body":"<p>I have a tabe <code>InvoiceOrderDetails</code>. It has following columns: </p>\n\n<pre><code>InvoiceNumber\nRecType\nAmount\nProjectCode\n</code></pre>\n\n<p>There can be multiple invoice numbers for the same <code>projectCode</code>. The <code>RecType</code> indicates that whether full payment has been made by client or not. </p>\n\n<p>For example: total invoice amount for <code>Project XYZ</code> is 9000$. Client paid the first installment of 3000$. Now the next invoice which will be sent to client is of 6000$. Also, if <code>Rectype</code> is 1 means full payment is done else there's still a balance pending. </p>\n\n<p>Now I have to create a computed column and display it in a grid where I want to show the remaining amount to client. That means, I have to check <code>RECTYPe</code> for all the invoices, grouped by <code>ProjectCode</code> and subtract the amount where with <code>Rectype</code> 1 from the amount with rectype 2.</p>\n\n<p>I am not able to get how to compute the column and display in the grid. I am using Asp.Net (C# 2010) along with SQL Server 2008. </p>\n\n<p>Any suggestions will be appreciated. </p>\n"},{"tags":["sql","sql-server-2008","group-by"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12957446,"title":"SQL How to group a table with special condition and join to another table","body":"<p>i have Table PRICE</p>\n\n<pre><code>CodePrice  CodeClient  TheZone Tempo W_Begin W_End Price\nA_0_49       88989       1       1      0      49   20\nA_50_99      60000       1       1      50     99   10\nB_0_49       88989       2       1      0      49   30\nC_0_49       50000       3       4      0      49   40\n</code></pre>\n\n<p>Table Ordre</p>\n\n<pre><code>  NoID  CodeClient    Cp   Agence  TheZone Tempo Weight \n    01      88989     44   bidon      1      1     12\n    02      60000     49   toto       2      2     10\n    03      60000     49   bigoi      1      1     56\n    04      88989     49   titi       3      3     8\n    05      50000     44   bidon      1      1     5\n</code></pre>\n\n<p>How can i show the result like this:</p>\n\n<pre><code>CodePrice   TheZone Tempo W_Begin W_End  SUm_Weight  SUM_Price  CountIDOrdre  CP   Agence\n  A_0_49        1       1      0      49       17         40          2         44    bidon\n  A_50_99       1       1      50     99       56         10          1         49    bigoi\n  B_0_49        2       1      0      49       0          0           0         null  null\n  C_0_49        3       4      0      49       0          0           0         null  null\n</code></pre>\n\n<p>in 1 SQL Syntax (1 Step).</p>\n\n<p>Nowdays i make it in 2 step</p>\n\n<pre><code>SELECT CodePrice\n      ,CodeClient\n      ,TheZone         \n      ,Tempo   \n      ,W_Begin\n      ,W_End\n      ,Price          \n  FROM PRICE\n  LEFT JOIN T_TARIF_ZONE ON PRICE.ZONE = T_TARIF_ZONE.NO_ID     \n  LEFT JOIN CLIENT ON PRICE.CodeClient= CLIENT.CODE_CL     \n\n  WHERE CodeClient= @NO_CLIENT AND TheZone = @ZONE AND UNITE = @UNITE \n  AND (Tempo   IN (SELECT ParsedString From dbo.ParseStringList(@ModLiv)))\n\n  ORDER BY MONTANT\n</code></pre>\n\n<p>after i select the price, now i can group the ordre on each price depends on Weight, zone, and another variable</p>\n\n<pre><code>SELECT count(NoID) as LVId            \n      ,sum(Weight)as Tot_Poids        \n      ,sum(Price) as Tot_Prix      \n\n  FROM [Ordre]\n  WHERE Weight&gt;= @TR_DEB AND Weight&lt;= @TR_FIN AND LE_ZONE = @LE_ZONE AND ENLEV_UNITE = @ENLEV_UNITE \n        AND DATE_CLOTURE &gt;= @Date_Deb AND DATE_CLOTURE &lt;= @Date_Fin AND STATUT_LV = 2 AND FACTURATION = @FACTURATION\n\n  HAVING count([NOID]) &gt; 0  \n</code></pre>\n"},{"tags":["sql-server-2008","filestream","denied"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":12977452,"title":"SQL Server 2008 filestream access is denied","body":"<p>Can someone help with an <code>Access is denied</code> error message received when attempting to insert FILESTREAM data into SQL Server 2008?</p>\n\n<p>I have an ASP.NET application running within an application pool configured with an application-specific user.  The web.config uses integrated security...</p>\n\n<pre><code>&lt;connectionStrings&gt;\n   &lt;add name=\"MyApp\" \n        connectionString=\"Data Source=localhost;Initial Catalog=MyDatabase;Integrated Security=SSPI;\"\n        providerName=\"System.Data.SqlClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>The application's Windows user belongs to a database role, <code>web_app</code>. This role has execute and select permissions. However I receive the following exception...</p>\n\n<pre><code>System.ComponentModel.Win32Exception (0x80004005): Access is denied\n</code></pre>\n\n<p>Thanks in advance for all help.</p>\n"},{"tags":["sql-server-2008","sql-server-agent"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12968295,"title":"Email notification subject changed after sql server agent job migration","body":"<p>I have a job on my server with email notification on success and failure. The mail notification has the subject as </p>\n\n<blockquote>\n  <p>[The job succeeded.] SQL Server Job System: 'XYZ' completed on \\123.</p>\n</blockquote>\n\n<p>or</p>\n\n<blockquote>\n  <p>[The job failed.] SQL Server Job System: 'XYZ' completed on \\123.</p>\n</blockquote>\n\n<p>Now I have migrated the job to another server but the mail notification is like</p>\n\n<blockquote>\n  <p>SQL Server Job System: 'XYZ' completed on \\456.</p>\n</blockquote>\n\n<p>Why does the subject not contain <code>[The job succeeded.]</code> or <code>[The job failed.]</code>? How to get it back in the subject line of email notification?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12958838,"title":"sql server 2008 filter on big list passed in","body":"<p>I am having a performance issue.  I am trying to select from a table based on a very long list of parameters</p>\n\n<p>Currently am using this stored proc</p>\n\n<pre><code>CREATE PROC [dbo].[GetFileContentsFromTitles]\n@MyTitles varchar(max)\nAS\nSELECT [Title], [Sequence] From [dbo].[MasterSequence]\nWHERE charindex(',' + Title + ',', ',' + @MyTitles + ',') &gt; 0;\n</code></pre>\n\n<p>Where @MyTitles can be a very big number (currently doing a string with 4000 entries seperated by commas).  Any suggestions?  Thanks  </p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12967467,"title":"Using Table valued function the code","body":"<pre><code>&lt;pre&gt;\nI have 3 tables and one table valued function: EmpHistory,EmpRank,Emp and fnEmpRank.\nThe sample data are given as follows:\nEmpHistory\nEmpHistID  EmpID  RankID  MonitorDate  RankName\n1          aba     JPR     2008-10-06   Junior Prof\n2          aba     JPR     2009-11-07   Junior Prof\n3          aba     TERM    2012-2-08    Termoinated Prof\n4          aba     ASST    2012-6-22     lab Assistant\n5          aba     ASST    2012-7-2      Lab Assistant\n6          aba     TSST    2012-8-4      Terminated Assistant\n\nEmpRank\nRankID    RankName\nJPR       Junior Professor\nSPR       Senior Professor\nASST      Junior Assistant\nSASST     Senior Assistant\nPL        Principal\n\nEmployee\nEmpID    EmpStartDate\naba       2008-10-06\nabc01     2007-09-23\nsdh        2009-7-26\nsbs        2012-2-8\n\n\nThe fnEmpRank function takes the emproleID and gives the employee history same as the empHistory Table. There is also empoyeerole table which has employeeroleid column.\n\nNow my problem is: I want the second last professor rank of the employee i.e in this case I want Junior Professor row(i.e) 2nd row from emphistory table). Currntly my code is using emphistory table but now intead of that table I want to use fnEmpRank as it gives the same data. I am also giving the sample code.\n\n\nselect\na.EmpID,\na.StartDate,\nJ.RankID,\nc.MonitorDate,\nfrom dbo.vwEmployee A(nolock)\nINNER join dbo.EmpHistory c(nolock) on c.Empid = a.EmpID\nand c.EmpHistoryID = (select max(c1.EmpHistoryID)\n            from dbo.EmpHistory c1(nolock)\n            where c1.Empid = c.EmpID\n            and c1.MonitorDate = \n                    (\n</code></pre>\n\n<p>I have 3 tables and one table valued function: EmpHistory,EmpRank,Emp and fnEmpRank.\n    The sample data are given as follows:</p>\n\n<p>create table EmpHistory(\nEmpHistID int,\nEmpID varchar,\nRankID varchar,\nMonitordate Date,\nRankname varchar)</p>\n\n<p>insert into EmpHistory\nselect 1,'aba','JPR','2008-10-6','Junior Professor'</p>\n\n<p>insert into EmpHistory\nselect 2,'aba','JPR','2009-11-7','Junior Professor'</p>\n\n<p>insert into EmpHistory\nselect 3,'aba','TERM','2012-2-8','Terminated Prof'</p>\n\n<p>insert into EmpHistory\nselect 4,'aba','ASST','2012-6-22','Lab Assistant'</p>\n\n<p>insert into EmpHistory\nselect 5,'aba','ASST','2012-7-2','Lab Assistant'</p>\n\n<p>insert into EmpHistory\nselect 1,'aba','JPR','2012-8-4','Terminated Assistant'</p>\n\n<p>create table EmpRank(\nRankID varchar,\nRankName varchar\n)</p>\n\n<p>insert into EmpRank\nselect 'JPR','Junior Professor'</p>\n\n<p>insert into EmpRank\nselect 'SPR','Senior Professor'</p>\n\n<p>insert into EmpRank\nselect 'ASST','Junior Assistant'</p>\n\n<p>insert into EmpRank\nselect 'SASST','Senior Assistant'</p>\n\n<p>insert into EmpRank\nselect 'PL','Principal'</p>\n\n<p>create table Employee(\nEmpID varchar,\nEmpStartDate date\n)</p>\n\n<p>insert into Employee\nselect 'aba','2008-10-06'</p>\n\n<p>insert into Employee\nselect 'abc01','2007-9-23'</p>\n\n<p>insert into Employee\nselect 'sdh','2009-7-26'</p>\n\n<p>insert into Employee\nselect 'sbs','2012-2-8'</p>\n\n<pre><code>The fnEmpRank function takes the emproleID and gives the employee history same as the empHistory Table. There is also empoyeerole table which has employeeroleid column.\n\nNow my problem is: I want the second last professor rank of the employee i.e in this case I want Junior Professor row(i.e) 2nd row from emphistory table). Currntly my code is using emphistory table but now intead of that table I want to use fnEmpRank as it gives the same data. I am also giving the sample code.\n\n\nselect\na.EmpID,\na.StartDate,\nJ.RankID,\nc.MonitorDate,\nfrom dbo.vwEmployee A(nolock)\nINNER join dbo.EmpHistory c(nolock) on c.Empid = a.EmpID\nand c.EmpHistoryID = (select max(c1.EmpHistoryID)\n            from dbo.EmpHistory c1(nolock)\n            where c1.Empid = c.EmpID\n            and c1.MonitorDate = \n                    (\n                    SELECT MAX(C2.MonitorDate)\n                    FROM dbo.EmpHistory C2\n                    WHERE C2.EmpID = C1.EmpID\n                    )\n\n                    )\njoin dbo.EmpRank d(nolock) on d.RankID = a.RankID\nleft join dbo.EmpHistory f(nolock) on f.EmpID = a.EmpID\n    and f.EmpHistoryID = (select max(g.EmpHistoryID)\n                from dbo.EmpHistory g(nolock)\n                where g.EmpID = a.EmpID\n                AND G.RankID not like 'T%'\n                and g.EmpHistoryID &amp;lt; c.EmpHistoryID)\nleft join dbo.EmpRank h(nolock) on h.RankID = f.RankID\n\nLEFT JOIN dbo.EmpHistory J(NOLOCK) ON J.EmpID = A.EmpID \n    AND J.EmpHistoryID = (\n        SELECT max(K.EmpHistoryID )\n        FROM dbo.EmpHistory K(NOLOCK) \n        WHERE K.EmpID = J.EmpID\n        AND K.AgentRankID NOT LIKE 'T%'\n        AND K.MonitorDate = (\n            SELECT max(M.MonitorDate )\n            FROM dbo.EmpHistory M(NOLOCK)\n            WHERE M.EmpID = J.EmpID \n            AND M.RankID NOT LIKE 'T%'\n        )\n    )\n\nwhere\nA.Prof=1\n c.RankID like 'T%'\nAND c.RankID &lt;&gt;'TSST'\nAND A.StartDate is not null\n\nHere there is one more problem: Even if the Employee is terminated from professor to Assitant, A.Prof values is still 1 and basically Assistant dont have the start dates but when professor are transformed to Assitant, they still contain the start date. How can I handle this in the code. Basically this code assumes that that if emp has the start date then he is the professor. Can any one help me?\n\n\n                    SELECT MAX(C2.MonitorDate)\n                    FROM dbo.EmpHistory C2\n                    WHERE C2.EmpID = C1.EmpID\n                    )\n\n                    )\njoin dbo.EmpRank d(nolock) on d.RankID = a.RankID\nleft join dbo.EmpHistory f(nolock) on f.EmpID = a.EmpID\n    and f.EmpHistoryID = (select max(g.EmpHistoryID)\n                from dbo.EmpHistory g(nolock)\n                where g.EmpID = a.EmpID\n                AND G.RankID not like 'T%'\n                and g.EmpHistoryID &lt; c.EmpHistoryID)\nleft join dbo.EmpRank h(nolock) on h.RankID = f.RankID\n\nLEFT JOIN dbo.EmpHistory J(NOLOCK) ON J.EmpID = A.EmpID \n    AND J.EmpHistoryID = (\n        SELECT max(K.EmpHistoryID )\n        FROM dbo.EmpHistory K(NOLOCK) \n        WHERE K.EmpID = J.EmpID\n        AND K.AgentRankID NOT LIKE 'T%'\n        AND K.MonitorDate = (\n            SELECT max(M.MonitorDate )\n            FROM dbo.EmpHistory M(NOLOCK)\n            WHERE M.EmpID = J.EmpID \n            AND M.RankID NOT LIKE 'T%'\n        )\n    )\n\nwhere\nA.Prof=1\n c.RankID like 'T%'\nAND c.RankID &lt;&gt;'TSST'\nAND A.StartDate is not null\n\nHere there is one more problem: Even if the Employee is terminated from professor to Assitant, A.Prof values is still 1 and basically Assistant dont have the start dates but when professor are transformed to Assitant, they still contain the start date. How can I handle this in the code. Basically this code assumes that that if emp has the start date then he is the professor. Can any one help me?\n&lt;/pre&gt;\n</code></pre>\n"},{"tags":["sql-server-2008","ms-access","ms-access-2010","double-quotes","datahandler"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12973211,"title":"SQL Updates/Inserts with data with double quotes","body":"<p>I have a database that collects client information using assessments and other tools. Often in the assessments there are double quotes in the data when - as may be expected - a direct quote is captured. When I run sql updates (Access front end using VBA to SQL Server 2008 R2 backend) it blows up on double quotes in the data. In the interim I've asked staff to use single quotes when they enter data, but that is an unsustainable solution as they forget and the program crashes when it hits the double quotes. The datatype is nvarchar(max). </p>\n\n<p>The current VBA string looks like this:</p>\n\n<p>strInsertSQL = \"INSERT INTO tblIRPDetail(IRPID, SectionID, Challenge, Goal, Objective, Intervention, IntDate) VALUES(\" &amp; intNewID &amp; \", \" &amp; intSection &amp; \", \"\"\" &amp; strChallenge &amp; \"\"\", \"\"\" &amp; strGoal &amp; \"\"\", \"\"\" &amp; strObjective &amp; \"\"\", \"\"\" &amp; strIntervention &amp; \"\"\", \"\"\" &amp; strIntDate &amp; \"\"\");\"</p>\n\n<p>Essentially any of the strVariables could have single or double quotes in any combination. It works for single quotes but not doubles. Surely this is a fairly common issue, I'm hoping someone has a simple solution!</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","database","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12975454,"title":"SQL Server 2008: Finding strings within a table which contain the word World","body":"<p>I'm trying to filter my query to show only table entries with the word WORLD and also contains other country codes. </p>\n\n<p>I have used the wildcard function but I am unsure as to how I can have it only return entries with both WORLD and other country codes.</p>\n\n<pre><code>SELECT *\nFROM [****].[dbo].[Titles]\nWHERE Territories LIKE '%world%'\n</code></pre>\n\n<p>Any help is appreciated </p>\n\n<p>EDIT: Expected result would return all rows with both WORLD and one or more country code in the field. The territories column in this table contains both World or country codes and should bot contain both. the reason im running this query is to search for any rows with bad data.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":787,"score":1,"question_id":2548594,"title":"DBCC SHRINKFILE 1 sproc for multiple databases","body":"<p>I have a need to execute DBCC SHRINKFILE for multiple db's within the same sproc.\nI <em>could</em> create multiple sprocs so it runs within the given context, but I was curious if there were alternatives?</p>\n"},{"tags":["sql-server-2008","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":12975607,"title":"MVC 4 make a migration to copy database values?","body":"<p>My friend and I are working on an MVC 4 application in visual studio 2010. We have migrations to synchronize the structure of our database, but we'd like to copy all the values from my database to his database. Is there a way to generate a migration that will handle this? or is the best option to make a back up and restore from the back up?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12975252,"title":"Carriage returns in job history message?","body":"<p>Is this at all possible? It would be nice to be able to use carriage returns in the job history message from print/raiseerror statements. I've tried all the usual stuff (CHAR(13) + CHAR(10), \\n\\r, etc...) to no avail, and I can't find anything on google. It would be nice aesthetically more than anything, like say using a print statement in your proc like \"Objects Created: \" and be able to read that in the job history a little more clearly than a giant blob of text, and I don't really want to write the job history to a log file.</p>\n\n<p>It may very well not be possible, but the distribution REPL-LogReader and some other jobs are tantalizingly able to show output with new lines, so the job history GUI must be able to process that somehow right?</p>\n\n<p>I'm using SSMS with SQL Server 2008. Thanks!</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12954143,"title":"Can a stored procedure return more than 1 value?","body":"<p>Is there anyway a stored procedure can return a list of values e.g. a column named as <code>ClientName</code> and returns all client names.</p>\n\n<p>I don't want to create a view or another table, it has to be done in a stored procedure or if there is any other way around.</p>\n"},{"tags":["sql-server","sql-server-2008","powershell","smo"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12971267,"title":"How to set database options using SQL Server SMO and powershell from a hash?","body":"<p>Using SQL Server 2008 R2 and Powershell 2.0</p>\n\n<p>I have created a hash of options that I want to set in a SQL Server database like so:</p>\n\n<pre><code>$dbopts = @{\n    \"AutoCreateStatistics\"=$true;\n    \"AutoUpdateStatistics\"=$true;\n    \"AutoShrink\"=$false;\n    };\n</code></pre>\n\n<p>I want to set these options on a SQL Server database using SMO. I created a function which accepts a SMO Database object and the DatabaseOptions hash as inputs. </p>\n\n<pre><code>function setDatabaseOptions {\n    param ($db, $opts);\n\n    foreach ($opt in $db.DatabaseOptions) {\n        # what to write here?\n\n    }\n\n}\n</code></pre>\n\n<p>I want to set the options in the hash to the database. Not sure the best way to do this. Any suggestions? An example, to set an option explicitly you would do</p>\n\n<p><code>$db.DatabaseOptions.AutoCreateStatistics = $true</code></p>\n"},{"tags":["sql","sql-server-2008","tsql","function","build"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":12969806,"title":"Get sum/average value of records defining equal time periods","body":"<p>I have the following information (return by view):</p>\n\n<pre><code>DateTime   ItemID  UserTyp Seconds\n\n2012-01-01 10      S       12      \n\n2012-01-01 10      S       18  \n\n2012-01-01 11      S       22  \n\n2012-01-02 11      M       52  \n\n2012-01-02 10      S       120  \n\n2012-01-02 11      S       NULL  \n\n2012-01-03 15      M       112  \n\n2012-01-03 12      S       182  \n\n2012-01-04 10      M       NULL  \n</code></pre>\n\n<p>What I need to done is to calculated the sum of all seconds by user types, but for five periods.</p>\n\n<p>The periods are set in the following way:</p>\n\n<ol>\n<li>Get the first and the last date</li>\n<li>Divided all days on five</li>\n<li>The result of the division is the days that one period includes</li>\n</ol>\n\n<p>Then for each period, depending on the DateTime and the UserType of the records, I should come up with this records:</p>\n\n<pre><code>Periods  UserTypeS_SUM(Seconds) UserTypeM_SUM(Seconds)\n1        \n2        \n3\n4\n5\n</code></pre>\n\n<p>Also, I should check if there is at least 5 records, before the division is make - if I have 4 for example, only one period will be used.</p>\n\n<p>I know it does not look so different, I have started to make a solution using function, but it looks kinda ineffective to me. Are there some build-in functions that could do this easy?</p>\n\n<p>EDIT: I am really sorry but  I have forget to mention that the I should this in view or table-valued function. No store procedures are allowed in this case.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12972320,"title":"How to do an inner join on row number in sql server","body":"<p>SQL Server 2008</p>\n\n<p>Two tables:</p>\n\n<p>Table A has following data:</p>\n\n<pre><code>RowA\nRowB\nRowC\nRowD\n</code></pre>\n\n<p>Table B has following data:</p>\n\n<pre><code>Row4\nRow3\nRow2\nRow1\n</code></pre>\n\n<p>I want to get the following output:</p>\n\n<pre><code>RowA Row1\nRowB Row2\nRowC Row3\nRowD Row4\n</code></pre>\n\n<p>The only common value between the two tables is the row number</p>\n\n<p>I can get the data individually of course:</p>\n\n<pre><code>SELECT val\nFROM A\nORDER BY val\n\nSELECT val\nFROM B\nORDER BY val\n</code></pre>\n\n<p>But how do I join on the row number?</p>\n\n<p>And what if I don't have an order-by, but just want the rows in the order they come out?</p>\n\n<pre><code>RowA Row4\nRowB Row3\nRowC Row2\nRowD Row1\n</code></pre>\n\n<p>as in the join of</p>\n\n<pre><code>SELECT val\nFROM A\n\nSELECT val\nFROM B\n</code></pre>\n"},{"tags":["vb.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12974004,"title":"Connection String with Windows Authentication Mode","body":"<p>I'm trying to test a simple connection to my database with VB.NET on my SQL Server 2008. The problem is my login is with Windows Authentication mode and I enter no password for it to connect to my SQL server.</p>\n\n<p>How will a connection string in this case look like? This has blocked my progress for the whole day. </p>\n\n<pre><code>Public Class Form1\n\n    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click\n        Dim connetionString As String\n        Dim connection As SqlConnection\n        Dim i As Integer\n        connetionString = \"Data Source=PEDRAM-PC\\PEDRAM;Initial Catalog=Test;User ID=Pedram-PC\\Pedram;Password=bro\"\n        connection = New SqlConnection(connetionString)\n        Try\n            connection.Open()\n        Catch ex As Exception\n            MsgBox(ex.ToString)\n        End Try\n    End Sub\nEnd Class\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":12973878,"title":"SQL Server 2008, add 'x' to auto increment value","body":"<p>I am using SQL Server 2008 and what I am trying to do is:</p>\n\n<p><code>update Daily set ReferenceNo = ReferenceNo + 100000</code></p>\n\n<p>I can't do this as this is field is as follows: <code>[ReferenceNo] [bigint] IDENTITY(1,1) NOT NULL,</code></p>\n\n<p>If I try to change remove the auto increment and save the table to do what I need to do I get the following error:</p>\n\n<p><img src=\"http://i.stack.imgur.com/GC0GZ.png\" alt=\"enter image description here\"></p>\n\n<p>Is there a way I can do this without dropping the table?</p>\n"},{"tags":["sql-server-2008","index"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12973521,"title":"Use of (INDEX(0)) in sql query","body":"<p>I run this query on SQL Server 2008:</p>\n\n<pre><code>SELECT * \nFROM Dealers WITH (INDEX(0))\nWHERE ID = 'rrsdsd'\n</code></pre>\n\n<p>But the execution plan shows that it used the clustered index of the table.</p>\n\n<p><img src=\"http://i.stack.imgur.com/5CGSr.png\" alt=\"enter image description here\"></p>\n\n<p>Why so?</p>\n"},{"tags":["sql","sql-server-2008","delphi","delphi-2009"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":166,"score":3,"question_id":12970913,"title":"How to fetch record count from ADO Query?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4237112/how-to-see-progress-of-query-execution-during-handle\">How to see progress of query execution during handle?</a>  </p>\n</blockquote>\n\n\n\n<p>I would like to show a progress bar indicating how much time it would take to fetch the results from database.  </p>\n\n<p>I use <code>TADOQuery</code> and open it in Async mode.  While the query state is <code>stFetching</code>, is there any way to know the [number of records fetched / total records]?</p>\n"},{"tags":["sql-server-2008","identity-column"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12969626,"title":"Alternative to Identity column","body":"<p>we have Orders table with an identity column (OrderID) but our order number is composed by OrderType (2 chars), OrderYear (2 chars) and OrderID (6 chars), totally 10 chars (i.e. XX12123456).\nThis counter has limitations: we can arrive to identity 999999 as OrderID . Next order will have ID composed by 7 chars. Obviously we cannot ave duplicates order ids.</p>\n\n<p>So we have created a table prefilled with progressive OrderID and OrderYear (from 100000 to 999999, order year from 12 to 16, for instance): this stored procedure begins a transacation with SERIALIZABLE isolation level, take first order id not used, update it as used and commit the transaction.</p>\n\n<p>Being our Orders table, i'm worried about deadlocks on executing order id calculation stored procedure or duplicated orderids.</p>\n\n<p>I'll test this with a console application that create multiple concurrency threads and try to extract orderids simulating a production load.</p>\n\n<p>Doubts are:</p>\n\n<ul>\n<li>Exists another method to simulate an identity column safely?</li>\n<li>May consider usage of triggers?</li>\n<li>May consider differente isolation level?</li>\n<li>Other ideas? :D</li>\n</ul>\n\n<p>Thanks!</p>\n\n<p>[EDIT]</p>\n\n<p>After googling and reading a bunch of MSDN documentation, i've found many examples showing how managing errors and dealocks and approaching a type of automatic reply directly from SP, as follow:</p>\n\n<p>CREATE PROCEDURE [dbo].[sp_Ordine_GetOrderID]</p>\n\n<p>@AnnoOrdine AS NVARCHAR(2) = NULL OUTPUT,\n@IdOrdine AS INT = NULL OUTPUT</p>\n\n<p>AS</p>\n\n<p>SET NOCOUNT ON</p>\n\n<p>DECLARE @retry AS INT\nSET @retry = 2</p>\n\n<p>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE</p>\n\n<p>WHILE (@retry > 0)\nBEGIN\n    BEGIN TRY</p>\n\n<pre><code>    BEGIN TRANSACTION OrderID   \n\n    SELECT TOP 1 @AnnoOrdine = AnnoOrdine, @IdOrdine = IdOrdine\n    FROM ORDINI_PROGRESSIVI --WITH (ROWLOCK)\n    WHERE Attivo = 1\n    --ORDER BY AnnoOrdine ASC, IDOrdine ASC \n\n    UPDATE ORDINI_PROGRESSIVI WITH (UPDLOCK)\n    SET Attivo = 0\n    WHERE AnnoOrdine = @AnnoOrdine AND IdOrdine = @IdOrdine\n\n    IF ISNULL(@IdOrdine, '') = '' OR ISNULL(@AnnoOrdine,'') = ''\n    BEGIN\n        RAISERROR('Deadlock', 1, 1205)\n    END\n\n    SET @retry = 0\n\n    COMMIT TRANSACTION OrderID  \n\n    SELECT @AnnoOrdine AS AnnoOrdine, @IdOrdine AS IdOrdine \n\nEND TRY\nBEGIN CATCH\n\n    IF (ERROR_NUMBER() = 1205)\n        SET @retry = @retry - 1;\n    ELSE\n        SET @retry = -1;\n\n    IF XACT_STATE() &lt;&gt; 0\n        ROLLBACK TRANSACTION;       \n\nEND CATCH\n</code></pre>\n\n<p>END</p>\n\n<p>This approach reduce deadlocks (absent at all) but sometimes i got EMPTY output parameter.\nTested with 30 contemporary threads (so, 30 customers processes that insert orders at the same moment)</p>\n\n<p>Here a debug log with query duration, in milliseconds: <a href=\"http://nopaste.info/285f558758.html\" rel=\"nofollow\">http://nopaste.info/285f558758.html</a></p>\n\n<p>Enough robust for production?</p>\n"},{"tags":["sql-server-2008","postgresql","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12966474,"title":"Is there a SSIS-like feature in PostgreSQL?","body":"<p>We are using the <a href=\"http://msdn.microsoft.com/en-us/library/ms141026.aspx\" rel=\"nofollow\">SSIS (SQL Server Integration Services)</a> in SQL 2008 R2 to copy database tables from 30+ databases (running on SQL Server 2000) to a single database for data analysis purposes on a daily basis. Is there a SSIS-like feature in PostgreSQL? As we are thinking to migrate our database to open source database in the future. Thanks!</p>\n"},{"tags":["sql-server-2008","adventureworks"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2851,"score":0,"question_id":10223664,"title":"Where to download this version of adventureworks database","body":"<p>Hi all, I started studying SQL Server from this book <a href=\"http://rads.stackoverflow.com/amzn/click/1590599802\" rel=\"nofollow\">SQL Server 2008\nTransact-SQL Recipes</a>.</p>\n\n<p>My problem is I can't get this file <code>AdventureWorks2008.msi</code>.</p>\n\n<blockquote>\n  <p>A majority of the examples in this book use the AdventureWorks\n  database (SQL Server 2008 OLTP version), which can be downloaded\n  online from the CodePlex site (www.codeplex.com), under the “Microsoft\n  SQL Server Product Samples: Database” project. Look for the file named\n  AdventureWorks2008.msi</p>\n</blockquote>\n\n<p>When I searched I get <a href=\"http://msftdbprodsamples.codeplex.com/releases/view/55926\" rel=\"nofollow\">this</a>.</p>\n"},{"tags":["asp.net","database","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12909335,"title":"<DataBase> is being recovered. Waiting until recovery is finished","body":"<p>I Have Develop an Application using Asp.net sql server and Jquery Ajax It is giving me </p>\n\n<p> is being recovered. Waiting until recovery is finished.</p>\n\n<p>why this message is coming</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12937126,"title":"Join TableA, TableB and TableC to get data from TableA and TableC","body":"<p>Why I am getting so many records for this</p>\n\n<pre><code>SELECT e.OneColumn, fb.OtherColumn\nFROM  dbo.TABLEA FB\nINNER JOIN dbo.TABLEB eo ON Fb.Primary = eo.foregin\nINNER JOIN dbo.TABLEC e ON eo.Primary =e.Foreign\nWHERE FB.SomeOtherColumn = 0\n</code></pre>\n\n<p>When I am running this I am getting Millions of records which is not the correct case, all tables has less number of records.</p>\n\n<p>I need to get the columns from TableA and TableC and because they are not joined logically so I have to use TableB to act as bridge</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Below is the count:</p>\n\n<pre><code>TABLEA = 273551\nTABLEB = 384412\nTABKEC = 13046\n</code></pre>\n\n<p>Above Query = After 2 minutes I have forcefully canceled the query.. till that time the count was <strong>11437613</strong></p>\n\n<p>Any suggestion?</p>\n"},{"tags":["sql-server","wcf","sql-server-2008","iis6","database-connection"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12970916,"title":"Can't connect to SQL Server from WCF service but I can from Management Studio","body":"<p>I'm trying to connect a .NET Framework 4.0 WCF REST service on an IIS6 to a SQL Server 2008 R2 database with this connection string:</p>\n\n<pre><code>&lt;add name=\"EReportEntities\" \n     connectionString=\"metadata=res://*/EReportModel.csdl|res://*/EReportModel.ssdl|res://*/EReportModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Server=localhost;Database=ADM;User Id=sa;Password=XXXXXXXX;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" \n     providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>But I can't. I get:</p>\n\n<pre><code>Event Type: Failure Audit\nEvent Source:   MSSQLSERVER\nEvent Category: (4)\nEvent ID:   18456\nDate:       10/19/2012\nTime:       10:47:48 AM\nUser:       N/A\nComputer:   UNILEVER\nDescription:\nLogin failed for user 'sa'. [CLIENT: &lt;local machine&gt;]\n\nFor more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp.\nData:\n0000: 18 48 00 00 0e 00 00 00   .H......\n0008: 09 00 00 00 55 00 4e 00   ....U.N.\n0010: 49 00 4c 00 45 00 56 00   I.L.E.V.\n0018: 45 00 52 00 00 00 07 00   E.R.....\n0020: 00 00 6d 00 61 00 73 00   ..m.a.s.\n0028: 74 00 65 00 72 00 00 00   t.e.r...\n</code></pre>\n\n<p>But, if I use sa user to login on SQL Server Management Studio I can login.</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12970785,"title":"WMI query - Reporting services and Analysis Services","body":"<p>I want to get configuration value of Native XML Web services, reporting services and Analysis Services. That means they are enabled or disabled.. through WMI Query</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12970907,"title":"Backup SQL Server db in a format to open in Microsoft Access","body":"<p>Is there a way to do a backup for SQL Server db in a format that opens in Microsoft Access or Excel for instance?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12966848,"title":"getting the minimum and maximum date in the same query","body":"<p>I have a working query that gives me the maxdate:</p>\n\n<pre><code>SELECT a.client_id AS client_id\n   , a.patientcount AS patientcount\n   , received_date AS maxRecDate\nFROM\n(\n   SELECT DISTINCT CLIENT_ID\n   , PATIENT_ID\n   , count(*) over (partition by client_id, patient_id) AS patientcount\n   from f_accession_daily\n) AS a\nJOIN F_ACCESSION_DAILY AS f ON a.CLIENT_ID = f.CLIENT_ID\n   AND a.PATIENT_ID = f.PATIENT_ID\nGROUP BY f.RECEIVED_DATE, a.CLIENT_ID, a.patientcount\nHAVING f.RECEIVED_DATE = MAX(f.received_date)\n</code></pre>\n\n<p>In the same query I would also like to return min(f.received_date).</p>\n\n<p>Is there a way to do this? perhaps with the subquery?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":48,"score":-3,"question_id":12970585,"title":"How to Rename Column name using DDL Statement in SQL","body":"<p>How to Rename <strong>Column</strong> name using <strong>DDL</strong> Statement in SQL</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":51,"score":-4,"question_id":12967813,"title":"Find path and height using SQL Server 2008","body":"<p>I need to find the start node and last node, and the height if possible, in the table where null indicates last node.</p>\n\n<pre><code>A       B\n1       2\n2       3\n3       4\n4       5\n5       6\n6       Null\n2       3\n3       4\n4       5\n5       6\n6       7\n7       Null\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","database-replication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":12968668,"title":"SQL Server merge replication (subscription does not exist)","body":"<p>I have setup a merge replication for almost 21 servers. Everything was OK, but after few days all subscriptions failed.</p>\n\n<p>In the subscription servers, although I have subscription in the subscription menu.</p>\n\n<p>Messages stating <code>the subscription does not exist</code>.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","cursor","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12965080,"title":"Is there a way to set ODBC Connection options in a DSN?","body":"<p>My application (a testcase automation tool) does not support calling ODBC's <a href=\"http://msdn.microsoft.com/en-us/library/ms130794.aspx\" rel=\"nofollow\">SQLSetStatmentOption</a>. I need to set the cursor option <a href=\"http://msdn.microsoft.com/en-us/library/ms131361.aspx\" rel=\"nofollow\">SQL_SOPT_SS_CURSOR_OPTIONS to SQL_CO_FFO_AF</a>. Right now I connect to the server using a connection string (no DSN). I am using <a href=\"http://msdn.microsoft.com/en-us/library/ms131291.aspx\" rel=\"nofollow\">sqlsrv32.dll or Sqlncl10.dll</a>.</p>\n\n<p>Is there a way to set the cursor option in a DSN (or other layer) between my tool and the MSSQL server?  The tool handles creating the cursor (or results set) and iterating through the result set in a way that seems to obscure any ability to manage it directly. It does allow for calling SQLSetConnectAttr() but as far as I can tell there's no way to set a cursor option in there.</p>\n\n<p>All of this is an attempt to speed up retrieving data over a remote connection. In SQL Management Studio I get comparable response times to the local or remote DB, but in the automation tool the remote queries take hundreds of times longer, probably because it seems to be making a round trip to the sever for every row.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12966509,"title":"converting normal query into fancy or partition/over query","body":"<p>My query:</p>\n\n<pre><code>with cte as (\n        select client_id,COUNT(patient_id) PatientCount from\n        (\n            select client_id,patient_id\n            from F_ACCESSION_DAILY\n            group by CLIENT_ID,PATIENT_ID\n            having COUNT(ACCESSION_ID)=2\n        ) a\n        group by CLIENT_ID\n)\n</code></pre>\n\n<p>works, but is not so useful to me. because although i can JOIN easily on this query, I will actually need to repeat this <code>WITH</code> statement many times because i need to be able to differentiate between:</p>\n\n<pre><code>having count(Accession_id)=2\n</code></pre>\n\n<p>and</p>\n\n<pre><code>having count(Accession_id)=3\n</code></pre>\n\n<p>and</p>\n\n<pre><code>having count(accession_id)=4\n</code></pre>\n\n<p>and so on until around 100</p>\n\n<p>i was thinking to do something more like this:</p>\n\n<pre><code>select distinct client_id, patient_id, count(*) over (partition by client_id, patient_id,accession_id) patientcount\n    from f_accession_daily\n</code></pre>\n\n<p>but i am stuck!</p>\n\n<p>i was wondering if you can point me into the right direction on how to convert the initial query into something <strong>more useable when having count(Accession)=many different values</strong>?</p>\n\n<p>thanks so much for your guidance.</p>\n"},{"tags":["sql-server-2008","replication"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3450,"score":1,"question_id":4123622,"title":"The process could not execute 'sp_replcmds' on <ServerName>","body":"<p>I am having a lot of trouble setting up transactional replication on my test server.  I am running SQL Server 2008 SP2.</p>\n\n<p>I am able to create a transactional publication.  The snapshot agent works fine and subscribing to the publication works fine as well.  The problem that I get is that the log reader agent fails with the error:</p>\n\n<p>The process could not execute 'sp_replcmds' on [ServerName]</p>\n\n<p>The snapshot and log reader agents are run under a windows account with administrator privileges on the domain and sysadmin privileges on the sql server.  I have also tried running the agents under the SQL agent profile.  I have tried executing sp_replflush and restarting the SQL agent.  I have also tried increasing -LoginTimeout to 500 and -ReadBatchSize to 10.</p>\n\n<p>Any help greatly appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":12968549,"title":"linking multiple queues to same service in SQL service broker","body":"<p>Hi Everyone,\n            I have just started working with SQL service broker. I was wondering if we can <strong>link two service broker queues to same service</strong> such that when a message is sent using that service, it will be delivered to both queues i.e both the queues will contain same copy of a message. Is there any way like this or there is some other way to do this? </p>\n\n<p>Thanks in advance</p>\n\n<p>Pankaj</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12963480,"title":"Duplicate in SQL Server 2008","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12904087/delete-script-sql-server-2008\">Delete script SQL Server 2008</a>  </p>\n</blockquote>\n\n\n\n<p>Here is a situation that I am trying to resolve. I have a table that is loaded with duplicates. It happened because similar rows were loaded from two or more different sources. That is being taken care of in the package.</p>\n\n<p>But I want to delete those rows which are duplicates. There is no key attribute here. Example of the sources are <code>Cleveland City</code> and <code>Ohio State</code>. And I have a column that shows from which source the row was loaded from (<code>DataSource</code> column).</p>\n\n<p>Thus in the row it shows as <code>DataSource = 'Cleveland'</code> or <code>DataSource = 'Ohio'</code>.</p>\n\n<p>I want to keep those records that resulted to be duplicates when they got loaded from Ohio. Its 100k records I may have to use joins. And one more thing my main table is joined with other four or five tables with <code>rId</code> which is unique for each row, that's why you see me joining with this tables and I DO NOT think I did it right. </p>\n\n<p>Could you check my work guys? I <strong>really</strong> appreciate it.</p>\n\n<pre><code> --Delete ct from--this is to delete w/c is my main intention\n SELECT * \n FROM\n  (\n     (\n        SELECT Rid,UID,ADDRESS,City,State,Zip,DataSource  \n        FROM F_staRes where dataSource='Ohio'\n     ) O inner join\n     (\n           SELECT Rid,UID,ADDRESS,City,State,Zip,DataSource  \n           FROM F_staRes \n           where DataSource  in   ('Clev','Columbus')\n     ) ct\n          on O.UID=ct.UID and O.ADDRESS=ct.ADDRESS  and O.City=ct.City and   \n          O.State=ct.State  and O.zip=ct.zip\n\n            join dbo.ResOrig ro\n            on ct.rId=ro.rId \n\n            join dbo.ResSta rs\n            on ct.rId=rs.rId\n\n            join dbo.ResDest rd \n            on ct.rId=rd.rId\n\n           where ct.DataSource in ('Clev','Columbus')\n</code></pre>\n"},{"tags":["c#","sql-server-2008","enterprise-library","connection-pooling"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12908709,"title":"MS Enterprise Library data access - Understanding SQL 'user connections' management","body":"<p>I'm trying to understand how MS Enterprise Library's data access block manages its connections to SQL. The issue I have is that under a steady load (from a load test), at 10 minute intervals the number of connections to SQL increases quickly - which causes noticeable jump in page response times from the website.</p>\n\n<p><em>This is the scenario I'm running:</em></p>\n\n<ul>\n<li>Visual Studio load test tools, running against 3 web servers behind a load balancer\n<ul>\n<li>The tools give full visibility over the performance counters to all web + DB boxes</li>\n</ul></li>\n<li>The tests take ~10 seconds each, and perform 4 inserts (form data), and some trivial selects</li>\n<li>There are 60 tests running concurrently. There is no increase or decrease in load during the entire test.\n<ul>\n<li>The test is run for between 20 minutes and 3 hours, with consistent results.</li>\n</ul></li>\n</ul>\n\n<p><em>And this is the issue we see:</em></p>\n\n<ul>\n<li>Exactly every 10 minutes, the performance counter from SQL for <strong>SQL General: User Connections</strong> increases - by ~20 connections total\n<ul>\n<li>The pages performing the HTTP post / DB insert are the ones most significantly affected. The other pages show moderate, but noticeable rises.</li>\n<li>The CPU/memory load on the web servers is unaffected</li>\n</ul></li>\n<li>This increase corresponds with a notable bump in page response times - E.g. from .3 seconds average to up to 5 seconds</li>\n<li>After ~5 minutes it releases many of the connections, with no affect on web performance\n<ul>\n<li>The following 5 minutes of testing gives the same (normal) web performance</li>\n<li>Ultimately, the graph looks like a <a href=\"http://www.sfu.ca/sonic-studio/handbook/Square_Wave.html\" rel=\"nofollow\">square wave</a> </li>\n</ul></li>\n<li>Happens all over again, 10 minutes after the first rise</li>\n</ul>\n\n<hr>\n\n<p><em>What I've looked at:</em></p>\n\n<p><strong>Database calls:</strong></p>\n\n<p>All calls in the database start with:</p>\n\n<pre><code>SqlDatabase database = new SqlDatabase([...]);\n</code></pre>\n\n<p>And execute either proc with no required output:</p>\n\n<pre><code>return database.ExecuteScalar([...], [...]);\n</code></pre>\n\n<p>Or read wrapped in a using statement:</p>\n\n<pre><code>using (SqlDataReader reader = (SqlDataReader)database.ExecuteReader([...], [...]))\n{\n    [...]\n}\n</code></pre>\n\n<p>There are no direct uses of SqlConnection, no .Open() or .Close() methods, and no exceptions being thrown</p>\n\n<p><strong>Database verification:</strong></p>\n\n<p>We've run SQL profiler over the login / logout events, and taken snapshots with the <a href=\"http://sqlserverplanet.com/dba/using-sp_who2\" rel=\"nofollow\">sp_who2</a> command, showing who owns the connections. The latter shows that indeed the web site (seen by machine + credential) are holding the connections.</p>\n\n<p>There are no scheduled jobs (DB or web server), and the user connection load is stable when there is no load from the web servers.</p>\n\n<p><strong>Connection pool config</strong></p>\n\n<p>I know the min &amp; max size of the connection pool can be altered with the connection string.</p>\n\n<p>E.g.: </p>\n\n<blockquote>\n  <p>\"Data Source=[server];Initial Catalog=[x];Integrated Security=SSPI;<strong>Max\n  Pool Size=75;Min Pool Size=5;</strong>\"</p>\n</blockquote>\n\n<p>A fall back measure may be to set the minimum size to ~10</p>\n\n<p>I understand the default max is 100, and the default min is 0 (<a href=\"http://www.techrepublic.com/article/educate-yourself-about-net-sql-server-connection-string-syntax/6084879\" rel=\"nofollow\">from here</a>)</p>\n\n<p>I'm a little bit lithe to think of connection pooling (specific to this setting) and the User Connections performance counter from SQL. <a href=\"http://msdn.microsoft.com/en-us/library/8xx3tyca%28v=vs.100%29.aspx\" rel=\"nofollow\">This article</a> introduces these connection pools as being used to manage connection string, which seems different to what I assume it does (hold a pool of connections generally available, to avoid the cost of re-opening them on SQL)</p>\n\n<p>I still haven't seen any configuration parameters that are handily defaulting to 5 or 10 minutes, to zero in on...</p>\n\n<hr>\n\n<p>So, any help is appreciated. </p>\n\n<p>I know that 10 minute spikes sounds like a change in load, or new activity is happening - but we've worked quite hard to isolate those &amp; any other factors - and for this question, I am hoping to understand EL scaling its connections up &amp; down.</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net","database","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12957447,"title":"Rules of thumb when storing large amounts of data in a database","body":"<p>I am thinking about creating an online journal that will hold large amounts of text. I am looking at purchasing one of go-daddys packages that comes with a database of 200mb. So are there any rules of thumb when it comes to storing large amounts of text in a database?</p>\n\n<p>Or would it be better if I stored the data in text files and then request the specific file when it is needed?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":12036030,"title":"SQL - find total records that occur before another","body":"<p>I have the following schema and want to find the number of clients that have a typeId of 10 appearing first.  The answer with the following data would be 2 (client id 1000 and 1003 have a 10 on the 1st January and an 11 on 2nd January.</p>\n\n<pre><code>CREATE TABLE Event (ClientId int, TypeId int, Date smalldatetime)\nINSERT Event (ClientId , TypeId, Date) VALUES (1000, 10, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1000, 11, '2 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1001, 11, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1001, 10, '2 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1002, 11, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1003, 10, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1003, 11, '2 JAN 12')\n</code></pre>\n\n<p>I have tried a few queries with ROW_NUMBER() but have got a bit lost.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12702524,"title":"unable to drop and create database in sql server","body":"<p>I'm working with SQL Server 2008 and I can't seem to do drop and create a database.</p>\n\n<p>I've tried a few different ways but I always end up failing to drop or trying to \"use\" before it seems to be created.</p>\n\n<p>My current attempt looks like this.</p>\n\n<pre><code>use master;\nGO\nIF EXISTS (SELECT name FROM master.dbo.sysdatabases WHERE name = N'test')\nBEGIN\nDROP DATABASE [test];\nEND\nGO\nCREATE DATABASE [test];\nGO\nuse [test];\nGO\n</code></pre>\n\n<p>The <code>GO</code> were suggested on a MS forum as a way to stop some issues that occur when selecting databases.</p>\n\n<p>With this I currently get the output (with a ore existing database of the same name) of:</p>\n\n<blockquote>\n  <p>Msg 3702, Level 16, State 4, Line 3<br>\n  Cannot drop database \"test\" because it is currently in use.<br>\n  Msg 1801, Level 16, State 3, Line 1<br>\n  Database 'test' already exists. Choose a different database name.<br>\n  Msg 2714, Level 16, State 6, Line 2<br>\n  There is already an object named 'staff_type' in the database.</p>\n</blockquote>\n\n<p>With the last 2 lines repeated for every table in my database.</p>\n\n<p>I'm sure its a simple issues as its only 3 quick lines in MySQL so it cant be that hard in TSQL.</p>\n\n<p>As always, any help or suggestions would be amazing.</p>\n"},{"tags":["sql-server","sql-server-2008","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12965181,"title":"How to create generic column in database table?","body":"<p>I have a table with a large number of very specific columns which are mostly \"Strings\". I believe this hardcoding of names will give me grief later on when rules changes. I am investigating the option of using a second table where each row is a column from the master table which could each have a lookup key for its name.</p>\n\n<p>I know this may seem anti ER best practice, but it would be flexible. I could use views with subselects ie Select (SQL1), (SQL2) etc from Table1. Not sure if one can update a multitable view though in SQLServer. </p>\n\n<p>Thoughts on the above greatly appreciated.</p>\n\n<p>Thanks,</p>\n\n<p>Ed</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12963698,"title":"How to round a SQL time variable?","body":"<p>I have declared a time variable with value 23:59:59. So, I need to round it to 24:00. Have you any idea?</p>\n\n<pre><code>declare @t1 time = '23:59:59'\n</code></pre>\n\n<p>This is necessary only in the select statement. I know that time cannot be inserted as 24:00.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/bb677243(v=sql.105).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb677243(v=sql.105).aspx</a></p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12964650,"title":"can you join on a stored procedure?","body":"<p>I have a bunch of <code>WITH</code> statements:</p>\n\n<pre><code>;with OneAccession as (\n        select client_id,COUNT(patient_id) PatientCount from\n        (\n            select client_id,patient_id\n            from F_ACCESSION_DAILY\n            group by CLIENT_ID,PATIENT_ID\n            having COUNT(ACCESSION_ID)=1\n        ) a\n        group by CLIENT_ID\n    )\n    ,\n\n    TwoAccessions as (\n    select client_id,COUNT(patient_id) PatientCount from\n        (\n            select client_id,patient_id\n            from F_ACCESSION_DAILY\n            group by CLIENT_ID,PATIENT_ID\n            having COUNT(ACCESSION_ID)=2\n        ) a\n    group by client_id\n    )\n\n    ,\n\n    ThreeAccessions as (\n    select client_id,COUNT(patient_id) PatientCount from\n    (\n        select client_id,patient_id\n        from F_ACCESSION_DAILY\n        group by CLIENT_ID,PATIENT_ID\n        having COUNT(ACCESSION_ID)=3\n    ) a\n    group by client_id\n    )\netc\n</code></pre>\n\n<p>And I join these statements on </p>\n\n<pre><code>select * from myTable\njoin OneAccession\non...\njoin TwoACcessions\non...\njoin ThreeAccessions\n</code></pre>\n\n<p>Instead of having all those <code>with</code> statements, can i just create a stored proc? I would just pass the value of <code>having count(accession_id)=**@myParam**</code> and do this:</p>\n\n<pre><code>select * from myTable\njoin storedproc(1)\non...\njoin storedproc(2)\non...\netc...\n</code></pre>\n\n<p><strong>Is there an issue on joining on a stored Proc?</strong> Is my methodology OK?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":68,"score":0,"question_id":12944646,"title":"how to create a subquery in sql using count based on outer query","body":"<p>I hope someone can help me with this query. Basically I have two queries that I want to \"combine\". I want the second query as an extra column along with the first query.\nThe first one is this :</p>\n\n<pre><code>SELECT t_Item_Storage_Location.Storage_Loc_Nbr, \nt_Storage_Location.Storage_Loc_Type_Code, \nCount(t_Load.Load_Id) AS CurrentLoadCount,\nt_load.MMM_Id_Nbr\n\nFROM t_Load INNER JOIN (t_Storage_Location INNER JOIN t_Item_Storage_Location ON \nt_Storage_Location.Storage_Loc_Nbr = t_Item_Storage_Location.Storage_Loc_Nbr) ON \n(t_Load.Storage_Loc_Nbr = t_Item_Storage_Location.Storage_Loc_Nbr) \nAND (t_Load.MMM_Id_Nbr = t_Item_Storage_Location.MMM_Id_Nbr)\n\n\nwhere ((((t_Item_Storage_Location.MMM_Id_Nbr) Between '702004%' And '702011%') \nAND ((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%A') \nAND ((t_Storage_Location.Storage_Loc_Type_Code)='CD') \nAND ((t_Load.Active_Status_Ind)='A') \nAND ((t_Load.QC_Status_Code) Like 'R%') \nAND ((t_Load.MMM_Facility_Code)='MC')) \nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%B'))\nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%C')) \nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%D')) \nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%E'))\n\n)\nGROUP BY t_Item_Storage_Location.MMM_Id_Nbr,\nt_Item_Storage_Location.Storage_Loc_Nbr, \nt_Storage_Location.Storage_Loc_Type_Code,\nt_Load.MMM_Facility_Code,\nt_load.MMM_Id_Nbr\n\nHAVING\nCount(t_Load.Load_Id)&lt;4\n</code></pre>\n\n<p>The second one, is based on the t_load.MMM_Id_Nbr of the first one. Basically I want a count of all the loads with that mmm_id_nbr.</p>\n\n<pre><code>SELECT count(Load_ID) as LoadCount, MMM_Id_Nbr, storage_Loc_Nbr\nFROM t_load \nWHERE QC_Status_Code like 'R%' and mmm_Facility_Code ='MC' and Active_Status_Ind='A'\nGROUP by MMM_Id_Nbr, storage_loc_Nbr\n</code></pre>\n"},{"tags":["algorithm","sql-server-2008","c#-4.0","linq-to-sql"],"answer_count":4,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":188,"score":8,"question_id":12866338,"title":"Select distinct groups of rows according to average","body":"<p>I have table <code>t_stats</code> with column <code>id (INT)</code> and column <code>ratio (DECIMAL(8,4))</code>.\n<code>id</code> is unique.</p>\n\n<p>I want to query table <code>t_stats</code> in order to select 3 groups with the same <code>AVG(ratio)</code> (closest possible).</p>\n\n<p>Can be done using temporary tables, as long as I can run it as a script or stored procedure.</p>\n\n<hr>\n\n<p>EDIT: Here is the concrete example:</p>\n\n<p>INPUT:</p>\n\n<pre><code>id    ratio\n--    -----\n24  0.930000\n25  0.390000\n26  0.800000\n27  0.920000\n28  0.550000\n30  0.810000\n31  0.770000\n32  0.800000\n33  0.590000\n36  0.760000\n37  0.910000\n40  0.690000\n43  0.390000\n45  0.310000\n46  0.760000\n47  0.710000\n54  0.710000\n55  0.950000\n57  0.920000\n60  0.890000\n62  0.700000\n66  0.890000\n68  0.950000\n107 0.760000\n559 0.990000\n560 0.540000\n565 0.430000\n566 0.830000\n568 0.590000\n579 0.970000\n599 0.900000\n623 0.450000\n749 0.800000\n750 0.970000\n753 0.820000\n754 0.730000\n766 0.620000\n768 0.430000\n770 0.790000\n838 0.700000\n875 0.835000\n987 0.900000\n988 0.740000\n1157    0.850000\n1250    0.630000\n1328    0.860000\n2171    0.900000\n2176    0.520000\n2177    0.980000\n2178    0.940000\n2180    0.970000\n2184    0.990000\n2187    0.950000\n2188    0.940000\n2189    0.920000\n2195    0.990000\n2233    0.900000\n2234    0.940000\n2235    0.950000\n2240    0.980000\n2243    0.920000\n2253    0.900000\n2266    0.530000\n2269    0.920000\n2270    0.970000\n2271    0.750000\n2272    0.820000\n2275    0.910000\n2277    0.930000\n2281    0.690000\n2282    0.710000\n2288    0.840000\n2528    0.870000\n2778    0.950000\n2814    0.990000\n</code></pre>\n\n<p>OUTPUT:</p>\n\n<pre><code>groupId    id     ratio\n-------    --     -----\n1       24      0.930000\n1       25      0.390000\n1       27      0.920000\n1       30      0.810000\n1       32      0.800000\n1       36      0.760000\n1       54      0.710000\n1       60      0.890000\n1       559     0.990000\n1       560     0.540000\n1       566     0.830000\n1       568     0.590000\n1       623     0.450000\n1       750     0.970000\n1       838     0.700000\n1       987     0.900000\n1       1157        0.850000\n1       2178        0.940000\n1       2180        0.970000\n1       2253        0.900000\n1       2269        0.920000\n1       2271        0.750000\n1       2281        0.690000\n1       2778        0.950000\n1       2814        0.990000\n2       26      0.800000\n2       28      0.550000\n2       31      0.770000\n2       40      0.690000\n2       45      0.310000\n2       55      0.950000\n2       57      0.920000\n2       66      0.890000\n2       107     0.760000\n2       565     0.430000\n2       579     0.970000\n2       753     0.820000\n2       754     0.730000\n2       766     0.620000\n2       875     0.835000\n2       1328        0.860000\n2       2176        0.520000\n2       2177        0.980000\n2       2184        0.990000\n2       2187        0.950000\n2       2189        0.920000\n2       2233        0.900000\n2       2234        0.940000\n2       2275        0.910000\n2       2282        0.710000\n3       33      0.590000\n3       37      0.910000\n3       43      0.390000\n3       46      0.760000\n3       47      0.710000\n3       62      0.700000\n3       68      0.950000\n3       599     0.900000\n3       749     0.800000\n3       768     0.430000\n3       770     0.790000\n3       988     0.740000\n3       1250        0.630000\n3       2171        0.900000\n3       2188        0.940000\n3       2195        0.990000\n3       2235        0.950000\n3       2240        0.980000\n3       2243        0.920000\n3       2266        0.530000\n3       2270        0.970000\n3       2272        0.820000\n3       2277        0.930000\n3       2288        0.840000\n3       2528        0.870000\n</code></pre>\n\n<p>So I want to make 3 groups of <code>n</code> values and aim for a specific average value <code>x</code>. (Exemple with <code>n=30</code> and <code>0.75 &lt; x &lt; 0.85</code> would look like 3 groups of 30 values each where each group has <code>0.75 &lt; AVG(ratio) &lt; 0.85</code> and an <code>id</code> can only belong to 1 group.)</p>\n\n<p>So average is almost same in each group, and close to <code>x</code>:</p>\n\n<pre><code>groupId     avg(ratio)\n-------     ----------\n1           0.805600\n2           0.789000\n3           0.797600\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2005","c#-4.0","dll",".net-assembly"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":102,"score":5,"question_id":12130591,"title":"Support multiple assemblies on ASP.NET\\C# projects","body":"<p>We're developing a ASP.NET application and having some problems with integration with a MS dll (Microsoft.AnalysisServices)?</p>\n\n<p>The original project was linked to the dll which came with SQLServer2005 (Version=9.0.242.0). After migrating to SQLServer2008R2 (version=10.0.0.0) we encountered this problem: </p>\n\n<blockquote>\n  <p>Could not load file or assembly 'Microsoft.AnalysisServices,\n  Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91'\n  or one of its dependencies. The system cannot find the file\n  specified.</p>\n</blockquote>\n\n<p>This is understood since we compile the project with one version and then another version is located on the server. After installing SQLServer2008R2 on the development machine the problem was fixed. </p>\n\n<p>However we now have another problem that we need to support both SQLServer2005 and SQLServer2008R2 environments. I know that we can redirect the search path for the dll using a config file (that it will search for a different version that what it was compiled with), but I can't seem to find instructions how to use it for Web Application (on w3wp). We tried to use \"Specific Version\"=false, but since this is a \"Strong Name\" assembly it doesn't work as one would think.</p>\n\n<p>The relevant link which I found is this:<br>\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/47d0b992-3c10-4851-b2a5-9f72d2c0976e\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/47d0b992-3c10-4851-b2a5-9f72d2c0976e</a></p>\n\n<p>Can someone please direct me to a link for solving this issue?</p>\n\n<p>Update: I guess I didn't test it correctly since it doesn't work for other servers in SQLServer2008 R2. I guess you can't use range in the newVersion element. So the question is still opened for everyone! . Bottom line is that I know that I have version 9.0.242.0 but the customers version may be either 9.0.242.0 or 10.0.0.0. Is there a method which I can dynamically choose the correct assembly on the production server</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":12961562,"title":"SQL Server : using elements in a case statement that might be NULL","body":"<p>Okay, so I have a question about using columns in a case statement that might be null.</p>\n\n<p>Again I have two tables the first looks like this <code>UserActivity</code>:</p>\n\n<pre><code>   userID    Action    Time\n     1         25       12:00\n     1         10       12:01\n     1         12       12:35\n     1          6       13:54\n     2         10        6:47\n     2         42        6:48\n     3          8       11:54\n     etc.\n</code></pre>\n\n<p>But the second now looks like this <code>UserSchedule</code>:</p>\n\n<pre><code>   userID      startTime1        stopTime1     startTime2    stoptime2  startTime3    stopTime3\n     1            07:00            09:00         11:00         12:00       14:30         16:30\n     2            11:00            12:30         14:00         15:30       \n     3            14:00            15:00\n    etc.\n</code></pre>\n\n<p>So I need to be able to evaluate when in relation to all of those start and stop times an Action took place. Some users will have up to 5 start/stop times in a day. Some will only have one.</p>\n\n<p>This code was given to me to resolve an earlier issue by @Adam Wengler, and it works great if there is only one start and stop time. I'm unsure how to include the logic to test against each of the 5 potential start/stop columns and ignore them if they are empty.</p>\n\n<pre><code>  UPDATE ua\n  SET ua.TimeStatusId = CASE\n                    WHEN ua.Time &gt;= us.Schedule_Start\n                       AND ua.Time &lt;= us.Schedule_stop THEN 1\n                    WHEN ua.Time &gt;= DATEADD(HOUR, -1, us.Schedule_Start)\n                       AND ua.Time &lt;= us.ScheduleStart THEN 0\n                    WHEN ua.Time &gt;= us.Schedule_Stop\n                       AND ua.Time =&lt; DATEADD(HOUR, 1, us.Schedule_Stop)\n                       THEN 2\n                    ELSE 3\n                  END\n  FROM dbo.UserActivity AS ua\n  INNER JOIN dbo.userSchedule AS us ON ua.UserId = us.UserId\n</code></pre>\n"},{"tags":["sql-server","performance","sql-server-2008","tsql","insert"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":120,"score":1,"question_id":12956286,"title":"Optimal insert/update batch for SQL Server","body":"<p>I'm making frequent inserts and updates in large batches from c# code and I need to do it as fast as possible, please help me find all ways to speed up this process.</p>\n\n<ol>\n<li>Build command text using <code>StringBuilder</code>, separate statements with <code>;</code> </li>\n<li>Don't use <code>String.Format</code> or <code>StringBuilder.AppendFormat</code>, it's slower then multiple <code>StringBuilder.Append</code> calls</li>\n<li>Reuse <code>SqlCommand</code> and <code>SqlConnection</code></li>\n<li>Don't use <code>SqlParameter</code>s (limits batch size)</li>\n<li>Use <code>insert into table values(..),values(..),values(..)</code> syntax (1000 rows per statement)</li>\n<li>Use as few indexes and constraints as possible</li>\n<li>Use simple recovery model if possible</li>\n<li>?</li>\n</ol>\n\n<p>Here are questions to help update the list above</p>\n\n<ol>\n<li>What is optimal number of statements per command (per one <code>ExecuteNonQuery()</code> call)?</li>\n<li>Is it good to have inserts and updates in the same batch, or it is better to execute them separately?</li>\n</ol>\n\n<p>My data is being received by tcp, so please don't suggest any Bulk Insert commands that involve reading data from file or external table. </p>\n\n<p>Insert/Update statements rate is about 10/3.</p>\n"},{"tags":["sql-server-2008","operators","operator-overloading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":174,"score":0,"question_id":1312588,"title":"Custom datatype operators in Sql Server?","body":"<p>In Sql Server 2008, they added new DATE and TIME datatypes, complementing DATETIME.<br>\nI wanted to combine a DATE and a TIME to a DATETIME, and thought maybe the obvious would work, and I could do  </p>\n\n<pre><code>SELECT DATEFLD + TIMEFLD FROM MYTABLE\n</code></pre>\n\n<p>and DATE + TIME would return the corresponding DATETIME. Unfortunately, that's a little too obvious, and did not work. So I am wondering, does Sql Server have any way to override operators, to create an override for \"+\" to handle DATE + TIME => DATETIME . </p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":10179127,"title":"Non-dynamic approach to do a series of union statements on table value function tvf","body":"<p>I have a table valued function that returns some details about a specific account.  Something like this.  Far more complex but you get the idea.  It's a multi line TVF if that makes a difference (not an inline statement)</p>\n\n<pre><code>select * from dbo.TBFDetailsByAccountKey(1234)\n\n-----------------------------------------------\ndate       |    amount    |     detail        |\n-----------------------------------------------\n4/1/2012   |    10.23     |  payment stuff    |\n4/2/2012   |    12.40     |  other stuff      |\n4/2/2012   |    14.23     |  second pmt today |\n</code></pre>\n\n<p>I now have need to call this same TVF repeatedly in a series of UNION ALL statements in order to return the details for all the account key's contained within a set of deposits.  Is there a way to do this without resorting to dynamic sql?</p>\n\n<p>My current approach is this... but it uses dynamic sql and I keep thinking there should be a better \"non dynamic\" way.</p>\n\n<pre><code>DECLARE @pResult varchar(max)\n\nSELECT @pResult = COALESCE(@pResult + ' UNION ALL ', '') + \n        'SELECT * FROM dbo.TBFDetailsByAccountKey(' + \n        Cast(AccountKey AS VarChar(25)) + ')'\n    FROM Account WHERE DepositKey = @pDepositKey\n\nEXEC(@pResult)  /* execute dynamic sql created above */\n</code></pre>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","data","sqlclient"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":12201943,"title":"SqlDbType.Date SQL Server 2005","body":"<p>I have a property like this:</p>\n\n<pre><code>private SqlParameter DateOfBirthSqlParameter\n{\n    get\n    {\n        return new SqlParameter(\"@date\", SqlDbType.Date)\n            {\n                Value = dateOfBirth.ToString(\"MM/dd/yyyy\");\n            };\n    }\n}\n</code></pre>\n\n<p><code>dateOfBirth</code> is a <code>DataTime</code> C# type. I use this parameter to add to my SQL command, that look like this.</p>\n\n<pre><code>Select * From mytable Where dob_dt = @date\n</code></pre>\n\n<p>The problem is that doesn't work in SQL Server 2005. I got an exception: </p>\n\n<blockquote>\n  <p><em>System.ArgumentException: The version of SQL Server in use does not\n  support datatype 'date'</em></p>\n</blockquote>\n\n<p>This because SQL Server 2005 doesn't support <code>Date</code>, this is a feature of later version (SQL Server <strong>2008</strong>). </p>\n\n<p>There are many solutions to this, for instance change <code>SqlDbType.Date</code> to <code>SqlDbType.DateTime</code></p>\n\n<p>I guess the reference <code>System.Data</code> is a version that provide all features supported for SQL Server 2008. Should I change it to something that only support 2005? that will help to discover other possible mismatches? What is the best way to handle this situation?</p>\n\n<p>Thanks.</p>\n\n<p><strong>Update: 8/31/2012</strong></p>\n\n<p>In the example, I used date of birth but In my application I used something else such as purchase_dt or something like it (with the time on it). My first Select Statement was:</p>\n\n<pre><code>Select * From mytable Where Cast(purchase_dt as Date) = @date\n</code></pre>\n\n<p>and that was fine in my computer with SQL Server <strong>2008</strong> and in another PC with SQL Server <strong>2005</strong> also was fine and just throws an exception when it got to the select. </p>\n\n<p>But, once I fixed that, with:</p>\n\n<pre><code>Select * From mytable Where Cast(DATEDIFF(dd, 0, purchase_dt) as DateTime) = @date\n</code></pre>\n\n<p>This broke the entire web application (in the other PC)... The problem was <code>SqlDbType.Date</code>. but Why it didn't break it before?</p>\n"},{"tags":["sql-server-2008","case"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":44,"score":2,"question_id":12959661,"title":"CASE statement or similar technique","body":"<p>I am trying to use a CASE statement but I don't get the answer that I would like to get.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>DECLARE @Table TABLE (DocID INT, DocNumber VARCHAR(10),DocDevStat INT, MilestoneDate DATETIME,  \n                      MilestoneID INT) \nINSERT INTO @Table VALUES (30, '14-1', 6, '10-01-2001', 10) \nINSERT INTO @Table VALUES (30, '14-1', 6, '10-15-2001', 11) \nINSERT INTO @Table VALUES (30, '14-1', 6, '11-06-2002', 13) \nINSERT INTO @Table VALUES (30, '14-1', 6, '11-01-2003', 27) \nINSERT INTO @Table VALUES (30, '14-1', 6, '11-01-2003', 30) \nINSERT INTO @Table VALUES (30, '14-1', 6, '03-01-2004', 28) \nINSERT INTO @Table VALUES (30, '14-1', 6, '03-01-2004', 35) \nINSERT INTO @Table VALUES (31, '14-3', 2, '06-27-2003', 10) \nINSERT INTO @Table VALUES (31, '14-3', 2, '05-05-2004', 27) \nINSERT INTO @Table VALUES (31, '14-3', 2, '05-05-2004', 30) \nINSERT INTO @Table VALUES (31, '14-3', 2, '07-20-2005', 35) \nINSERT INTO @Table VALUES (31, '14-3', 2, '08-31-2005', 32) \nINSERT INTO @Table VALUES (36, '1-2', 7, '10-01-1996', 10) \nINSERT INTO @Table VALUES (36, '1-2', 7, '10-01-1996', 11) \nINSERT INTO @Table VALUES (36, '1-2', 7, '12-01-1996', 28) \nINSERT INTO @Table VALUES (36, '1-2', 7, '12-01-1996', 35) \n\nSelect distinct t.Docid, t.DocNumber,\n\ncase when t.DocDevStat IN (6,7,8) and t.MilestoneID = 35 then Max(t.Milestonedate)\n     when t.DocDevStat IN (2,3,4) then Convert(date,GETDATE()) end AS LatestDate\n\nFROM @Table t\nGroup By t.DocID, t.DocNumber, t.DocDevStat, t.MilestoneID\n</code></pre>\n\n<p>The result I get is:</p>\n\n<pre><code>Docid      DocNumber    LatestDate\n30         14-1           NULL\n30         14-1           2004-03-01 \n31         14-3           2012-10-17 \n36          1-2           NULL\n36          1-2           1996-12-01 \n</code></pre>\n\n<p>But I would like to get:</p>\n\n<pre><code>Docid      DocNumber    LatestDate\n30         14-1           2004-03-01 \n31         14-3           2012-10-17 \n36          1-2           1996-12-01 \n</code></pre>\n\n<p>Is the CASE statement right technique to be used in this case?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":28,"score":-2,"question_id":12961115,"title":"TVF doesn't give any data","body":"<p>I have one table valued function. It gives no data when executed. But when I execute only the query of that table valued function by giving the same parameter, then I get the data. Why is this?</p>\n\n<p>I am executing TVF as follows:</p>\n\n<pre><code>select *\n  from fn_name(param1,param2,param3)\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","import-from-excel"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":12942687,"title":"Horizontal data into Vertical","body":"<p>I have horizontal table (Table1) and I need it to transform it into (Table2)</p>\n\n<p><strong>Table1:</strong></p>\n\n<pre><code>CEO     SALESMAN    PRODUCT(1)  PRODUCT(2)  PRODUCT(3)  PRODUCT(4)  PRODUCT(5)  ... PRODUCT(N)\n------  ----------  ----------  ----------  ----------  ----------  ----------      ----------\nMIKE    ANDERSON    76787,00    19388,00    0,00        2723,00     217,00          6581,00\nJOHN    ANGELA      0,00        0,00        73088,00    0,00        0,00            0,00\nJACK    JEFF        24716,00    0,00        2995,00     0,00        0,00            0,00\nSTUART  MICHAEL     0,00        23338,00    42656,00    0,00        0,00            0,00\n</code></pre>\n\n<p><strong>Table2:</strong></p>\n\n<pre><code>CEO     SALESMAN    PRODUCTS    VALUE\n------- ----------- ----------  --------\nMIKE    ANDERSON    PRODUCT(1)  76787,00\nJOHN    ANGELA      PRODUCT(1)  0,00\nJACK    JEFF        PRODUCT(1)  24716,00\nSTUART  MICHAEL     PRODUCT(1)  0,00\nMIKE    ANDERSON    PRODUCT(2)  19388,00\nJOHN    ANGELA      PRODUCT(2)  0,00\nJACK    JEFF        PRODUCT(2)  0,00\nSTUART  MICHAEL     PRODUCT(2)  23338,00\nMIKE    ANDERSON    PRODUCT(3)  0,00\nJOHN    ANGELA      PRODUCT(3)  73088,00\nJACK    JEFF        PRODUCT(3)  2995,00\nSTUART  MICHAEL     PRODUCT(3)  42656,00\nMIKE    ANDERSON    PRODUCT(4)  2723,00\nJOHN    ANGELA      PRODUCT(4)  0,00\nJACK    JEFF        PRODUCT(4)  0,00\nSTUART  MICHAEL     PRODUCT(4)  0,00\nMIKE    ANDERSON    PRODUCT(5)  217,00\nJOHN    ANGELA      PRODUCT(5)  0,00\nJACK    JEFF        PRODUCT(5)  0,00\nSTUART  MICHAEL     PRODUCT(5)  0,00\nMIKE    ANDERSON    ...     ...\nJOHN    ANGELA      ...     ...\nJACK    JEFF        ...     ...\nSTUART  MICHAEL     ...     ...\nMIKE    ANDERSON    PRODUCT(N)  6581,00\nJOHN    ANGELA      PRODUCT(N)  0,00\nJACK    JEFF        PRODUCT(N)  0,00\nSTUART  MICHAEL     PRODUCT(N)  0,00\n</code></pre>\n\n<p>What I've tried so far is to BULK INSERT Table1 into a temporary table and then work with this data until I get what I want. The problem is the N in PRODUCT() columns is variable so I can't create a temporary table with fixed columns and I need a dynamic query that somehow can read the quantity of products columns and work with it.</p>\n\n<p><strong>BULK INSERT</strong></p>\n\n<pre><code>BULK INSERT #temp\nFROM '\\\\path\\file.csv'\nWITH\n(\nFIRSTROW = 1,\nFIELDTERMINATOR= ';',\nROWTERMINATOR = '\\n',\nCODEPAGE='RAW'\n);\n</code></pre>\n\n<p><strong>Temporary table:</strong></p>\n\n<pre><code>CREATE TABLE    #temp(\ncol1    varchar(100)    null,\ncol2    varchar(100)    null,\ncol3    varchar(100)    null,\ncol4    varchar(100)    null,\ncol5    varchar(100)    null,\n...\ncol397  varchar(100)    null,\ncol398  varchar(100)    null,\ncol399  varchar(100)    null,\ncol400  varchar(100)    null\n)\n</code></pre>\n\n<p>When I run the BULK INSERT I get this error:</p>\n\n<pre><code>Msg 4832, Level 16, State 1, Line 1\nBulk load: An unexpected end of file was encountered in the data file.\nMsg 7399, Level 16, State 1, Line 1\nThe OLE DB provider \"BULK\" for linked server \"(null)\" reported an error. The provider did not give any information about the error.\nMsg 7330, Level 16, State 2, Line 1\nCannot fetch a row from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>This happens because I created a temporary table with fixed 400 columns and there were 127 product columns.</p>\n\n<p>I'm trying to avoid things like these:</p>\n\n<pre><code>DECLARE @NUM_ROWS INT\n\nSET     @NUM_ROWS = 123\n\nIF @NUM_ROWS = 1\nBEGIN\nCREATE TABLE    #temp(\ncol1    varchar(100)    null\n)\nEND\n\nIF @NUM_ROWS = 2\nBEGIN\nCREATE TABLE    #temp(\ncol1    varchar(100)    null,\ncol2    varchar(100)    null,\n)\nEND\n\n...\n\nIF @NUM_ROWS = 400\nBEGIN\nCREATE TABLE    #temp(\ncol1    varchar(100)    null,\ncol2    varchar(100)    null,\n...\ncol4    varchar(100)    null,\n)\nEND\n\nBULK INSERT #temp\nFROM '\\\\path\\file.csv'\nWITH\n(\nFIRSTROW = 1,\nFIELDTERMINATOR= ';',\nROWTERMINATOR = '\\n',\nCODEPAGE='RAW'\n);\n</code></pre>\n\n<p><strong>@NUM_ROWS</strong> would be the number of columns I would create the temp table.</p>\n\n<p>Does anyone know a way I can import this .csv file into SQL Server dynamically? By dynamically I mean creating a temporary table with the number of columns of PRODUCTS I'm bulk inserting. Or a workaround to avoid that error I posted above.</p>\n"},{"tags":["sql-server-2008","cognos-8"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12960475,"title":"COGNOS error:The correlation name XXXX is specified multiple times in a FROM clause","body":"<p>My COGNOS report gives the error consistently: <code>The correlation name XXXX is specified multiple times in a FROM clause</code> .When I click on the generated SQL, it shows that it is selecting the same db object (sometime a view, other times a table) twice. </p>\n\n<p>In the framework manager model, the object is present only once. Also when i test the query subject from framework manager, it runs fine. How can I debug it?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":58,"score":0,"question_id":12945306,"title":"How to return a sql result based on values in a boolean column","body":"<p>Here's the scenario. I have a single SQL Server 2008 table - Products - with 2 columns: id  and IsNotValid. The data would look something like this:</p>\n\n<pre><code>id     IsNotValid\n1        0\n1        0\n1        1\n2        0\n2        0\n3        1\n3        1\n</code></pre>\n\n<p>I would like a SQL statement that would return a result set that would return all the records (2) for the id=2 - in this case all the IsNotValid values for id=2 is 0. id=1 should not be returned as one of its IsNotValid records is 1. Similar for id=3. The data types are: id (int), IsNotValid (bit).</p>\n"},{"tags":["sql-server","sql-server-2008","ssms","ssms2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12960283,"title":"Command(s) completed successfully but... the tables are not created","body":"<p>I backed up my database table's and entire schema into .sql script using Visual Studio's <a href=\"http://weblogs.asp.net/jgalloway/archive/2006/12/29/tip-use-the-database-publishing-wizard-to-script-your-table-data.aspx\" rel=\"nofollow\">Database Publishing Wizard</a>.</p>\n\n<p>I then tried to re-create those tables on another PC, not before re-creating the database itself, with the same exact name and everything (using a script that I created via SSMS's <code>Script Database as)</code>.</p>\n\n<p>I then open that tables .sql file using SSMS and execute it. </p>\n\n<p>SSMS reports:</p>\n\n<blockquote>\n  <p>Command(s) completed successfully</p>\n</blockquote>\n\n<p>But examining Object Explorer reveals that <strong>no tables were created</strong>.</p>\n\n<p>Why is this happening?</p>\n\n<p>What have I missed?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12959197,"title":"Return n number of rows from SQL Server query","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/187998/row-offset-in-sql-server\">Row Offset in SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>I have a query which has a like condition and it returns around 1500 rows. Now I want to know how can I get the rows part by part, e.g. return 75 rows, then again the next 75 rows until it reaches the end of the rows. I know I can use something like <code>SELECT TOP 75</code></p>\n\n<p>I tried something like this but it does not return any rows</p>\n\n<pre><code>    SELECT * \n    FROM \n       (SELECT ROW_NUMBER() OVER (ORDER BY WarehouseSubType.id) as row,\n               WarehouseSubType.id, \n               WarehouseType.name as WarehouseTypename,\n               WarehouseType.alternateName AS WarehouseTypealternateName,\n               WarehouseSubType.name AS WarehouseSubTypename,\n               Warehouse.alternateName AS WarehousealternateName,\n               WarehouseSubType.alternateName AS WarehouseSubTypealternateName,\n               WarehouseSubType1.name AS WarehouseSubType1name,\n               WarehouseSubType1.alternateName AS WarehouseSubType1alternateName,\n               Warehouse.alternateName AS Warehousename,\n               Branch.name AS Branchname,\n               Branch.alternateName AS BranchalternateName,\n               WarehouseProductQuantity.actualQuantity,\n               WarehouseProductQuantity.reservedQuantity,\n               Supplier.companyName, \n               Supplier.companyNameAlternate,\n               Tafsil.description,\n               Tafsil.alternateDescription,\n                (WarehouseProductQuantity.actualQuantity - WarehouseProductQuantity.reservedQuantity) AS quantity \n        FROM WarehouseSubType \n        INNER JOIN WarehouseType ON (WarehouseSubType.warehouseTypeId = WarehouseType.id)\n        INNER JOIN WarehouseSubType1 ON (WarehouseSubType.id = WarehouseSubType1.warehouseSubTypeId)\n   ) a \nWHERE \n    warehouseTypename like '%Ve%' \n    AND row &gt; 0 and row &lt; 75\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1886,"score":1,"question_id":3241801,"title":"How to create duplicate table with new name in SQL Server 2008","body":"<p>How do I create a duplicate table with only the structure duplicated with a new name in SQL server 2008?</p>\n\n<p>I have table with 45 fields so I want to create new with same structure but new name.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","freetexttable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12934983,"title":"Term order in FREETEXTTABLE in SQL Server","body":"<p>From the documentation, it seems that SQL Server's FREETEXTTABLE should treat a search query containing multiple words as a bag-of-words.</p>\n\n<p>If I run:</p>\n\n<pre><code>SELECT *\nFROM FREETEXTTABLE(tblThings, *, 'Cartridge Black')\n</code></pre>\n\n<p>I get results where the word 'Cartridge' is immediately followed by the word 'Black', e.g.:</p>\n\n<pre><code>EPSON STYLUS INKJET CARTRIDGE BLACK\nINKJET CARTRIDGE BLACK 40ML\n</code></pre>\n\n<p>No results have the words in the other order.</p>\n\n<p>If instead I run</p>\n\n<pre><code>SELECT *\nFROM FREETEXTTABLE(tblThings, *, 'Black Cartridge')\n</code></pre>\n\n<p>I get a different set of results:</p>\n\n<pre><code>AD1020BK BLACK CARTRIDGE\nGD230X BLACK CARTRIDGE\n</code></pre>\n\n<p>In neither set of results would I find 'black ink cartridge'.</p>\n\n<p>Is there a way to make SQL Server disregard the order of the words?</p>\n"},{"tags":["sql-server-2008","priority","database-deadlocks","sql-job"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12947789,"title":"sqlserver how to set job priority","body":"<p>Is there any way to set one job priority higher then other,<br>\nIn my case there are two jobs those are working on same set of tables,first <strong><em>JOB-A</em></strong> which is running every 12 hr and other <strong><em>JOB-B</em></strong> is every 10 minutes , i think at some time when they run simultaneously <strong><em>JOB-B</em></strong> is getting in to deadlock and get failed,\ni google the topic and found <strong>sqlgoverner</strong> is helpful in such cases \ndoes anyone know how to resolve?</p>\n"},{"tags":["sql-server","sql-server-2008","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":124,"score":1,"question_id":11513781,"title":"SSIS - Convert Multiple Column Values To Null","body":"<p>I am using SSIS (SQL Server 2008 R2) to transform an input CSV file into an SQL table.  Five columns in the input file (reals - e.g. 19.54271) occasionally have a bad value (strings - e.g. \"NAN\") that cause the package to fail.</p>\n\n<p>What is the simplest way to check these 5 columns for the bad value \"NAN\", convert that into either a NULL value or known bad numeric (-9999), and write the corrected values into the same final SQL table?</p>\n\n<p>I have the following mess going so far, and finally decided to ask if there is a simpler way...</p>\n\n<p><img src=\"http://i.stack.imgur.com/QU5Oy.png\" alt=\"enter image description here\"></p>\n\n<p>My current conditional logic:<br>\n<img src=\"http://i.stack.imgur.com/zHClt.gif\" alt=\"enter image description here\"></p>\n\n<p>My Case1 Derived Column Conversion:<br>\n<img src=\"http://i.stack.imgur.com/bfkZn.gif\" alt=\"enter image description here\"></p>\n\n<p>Note: Still not sure if I can combine the other derived columns into one instance, but since my destination can have only one input, I suspect I will need to...</p>\n\n<p>TIA</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12958765,"title":"sql server 2008 statement","body":"<p>I need help with a statement.  I need the statement to select where one ting is true and then a list of other things may or maynot be there.  Here is my example</p>\n\n<pre><code>WHERE\n\n((uw._condition LIKE '11-CHECKLIST REQUESTED BY UW%' AND uw._Status = 'Pending') \n</code></pre>\n\n<p>-- this has to be true, the rest may or may not be true, however when it is not I get blank rows because of the and.  What can I use instead of this code to get the first part because it will always be there and the others might or might not be there.</p>\n\n<pre><code>AND \n(\n(uw._condition LIKE '[1-4]-%' AND uw._Status = '*******')\nOR\n(uw._condition LIKE '[6-7]-%' AND uw._Status = '*******')\nOR\n(uw._condition LIKE '[20-22]-%' AND uw._Status = '*******')\nOR\n(uw._condition LIKE '9[0-9][0-9]-%' AND uw._Status = '*******')\nOR\n(uw._condition LIKE '1[0-9][0-9][0-9]-%' AND uw._Status = '*******')\n))\n</code></pre>\n\n<p>Thanks,</p>\n"},{"tags":["ruby-on-rails","sql-server-2008","activerecord"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12861125,"title":"Errors when trying to prepare testing with Ruby on Rails that uses a SQL Server 2008 R2 database","body":"<p>What do I need to do to be able to run tests with a SQL Server 2008 database server using the gem <code>activerecord-sqlserver-adapter</code>?</p>\n\n<p>I am able to connect to the development database just fine using a 32bit ODBC connection through dev settings in database.yml:</p>\n\n<pre><code>#SQL Server\ndevelopment:\n  adapter: sqlserver\n  mode: odbc\n  dsn: &lt;odbc_name&gt;\n  username: &lt;db_user&gt;\n  password: &lt;db_password&gt;\n  host: &lt;sql host&gt;\n</code></pre>\n\n<p>I have started to setup some testing but run into an error when running:</p>\n\n<pre><code>rake db:test:prepare\n</code></pre>\n\n<p>Here is the error:</p>\n\n<pre><code>rake aborted!\nODBC::Error: 37000 (3708) [Microsoft][SQL Native Client][SQL Server]Cannot drop \nthe database 'master' because it is a system database.: DROP DATABASE [master]\n\nTasks: TOP =&gt; db:test:load =&gt; db:test:purge\n(See full trace by running task with --trace)\n</code></pre>\n\n<p>This error doesn't make sense to me.  Why is it trying to drop the master db?</p>\n\n<p>My test setup in database.yml is exactly the same as my dev above except it points to a different odbc which points to a different database.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I have noticed that when I run <code>rake db:test:prepare</code> the first step must be to delete the test database.  So it knows what database it is supposed to use at first. </p>\n\n<p>Why does it then try to delete the master? </p>\n\n<p>Is this because when sql doesn't find the default database it gives the user master by default and <code>rake db:test:prepare</code> cannot create the users default db so it loops back to the beginning and tries to drop again?</p>\n"},{"tags":["sql","database","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12957635,"title":"Sql query to insert datetime in SQL Server","body":"<p>I want to insert a <code>datetime</code> value into a table(SQL Server) using the sql query below</p>\n\n<pre><code>insert into table1(approvaldate)values(18-06-12 10:34:09 AM);\n</code></pre>\n\n<p>But I get this Error msg. <code>Incorrect syntax near '10'.</code></p>\n\n<p>I tried it with the quotes</p>\n\n<pre><code>insert into table1(approvaldate)values('18-06-12 10:34:09 AM');\n</code></pre>\n\n<p>I get this error message <code>Cannot convert varchar to datetime</code></p>\n\n<p>Kindly help! \nThanks.</p>\n"},{"tags":["c#","sql-server-2008","iis","impersonation"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":117,"score":1,"question_id":12957141,"title":"Impersonating IIS DefaultAppPool in standalone application","body":"<p>Description of my problem sounds somewhat complicated, what makes me think that my approach is flawed, so I will also appreciate any better idea.</p>\n\n<p><strong>Short description:</strong></p>\n\n<p>Given connection string to MSSQL 2008 DB and website name deployed on IIS6, I want to verify programatically whether website is able to connect to database.</p>\n\n<p><strong>Long description:</strong></p>\n\n<ol>\n<li>I have MSSQL Server database, let's call it <code>portal_db</code>.</li>\n<li>I have an application deployed on IIS6, called <code>portal</code>. I can access it by url <code>http://localhost/portal</code> . In Web.config file I specified connection string to my database, which look like: <code>\"server=(local)\\SQLEXPRESS;trusted_connection=yes;database=portal_db\"</code></li>\n<li>Web application is accessing database using <code>System.Data.SqlClient.SqlConnection</code>, without any wrappers, ORMs, mappings, anything.</li>\n<li>Website is configured to run in appool <code>PortalAppPool</code>. It's using <code>ApplicationPoolIdentity</code> as a security context.</li>\n<li>It is not possible to easily modify web application code (particularly the way it accesses database)</li>\n</ol>\n\n<p>When my web application tries to connect to database it either succeeds or fails, depending on whether user <code>IIS APPPOOL\\PortalAppPool</code> is configured in MSSQL database. That's a part which I understand, but when deploying my app I often forget to create new user/login in db for apppool virtual account. So what I want to do, is to verify from separate, standalone, console app (preferably written in C#, but not necessarily), whether my web application can access database, in following way:</p>\n\n<ol>\n<li>Read connection string from <code>Web.config</code></li>\n<li>Read app pool identity settings (managed to do this by Directory Services API)</li>\n<li>Impersonate identity with credentials defined on app pool (using impersonation class I found here: <a href=\"http://platinumdogs.me/2008/10/30/net-c-impersonation-with-network-credentials/\" rel=\"nofollow\">http://platinumdogs.me/2008/10/30/net-c-impersonation-with-network-credentials/</a> which uses ideas found in many other places, including MSDN)</li>\n<li>Open <code>SqlConnection</code> with connection string read from <code>Web.config</code></li>\n</ol>\n\n<p>It boils down to following snippet:</p>\n\n<pre><code>using (new Impersonator(\"IIS APPPOOL\\\\PortalAppPool\", \"\", \"\"))\n{\n    SqlConnection conn = new SqlConnection(databaseConnectString);\n    conn.Open();\n}\n</code></pre>\n\n<p>Everything works very well, when my app pool security context is set to any other value than <code>AppPoolIdentity</code> - specific user, local system, etc. When I change credentials passed to <code>Impersonator</code> to my user's name and password, I get desired result (exception when I have no login mapping in database, and everything is OK when I add one). But I just seem to not be able to impersonate <code>IIS APPPOOLS\\PortalAppPool</code> virtual account - just have no idea what parameters should be passed to <code>LogonUser</code> - I would not be surprised if it would not be even possible. Maybe I am focused on impersonation approach too much (I am using it to access registry keys and services of other users and it works good), and maybe there is some better way.</p>\n\n<p>If you have any other, better ideas, or need some more explanation to this problem, please let me know.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12955714,"title":"How to modify an SQL query with sub query to get an extra column","body":"<p>I am trying to modify a user query in order to return an extra column, INV1.WhsCode from the following SQL query:</p>\n\n<pre><code>SELECT  T0.CardCode,\n        T2.CardName,\n        T0.CodeBars,\n        T0.ItemCode,\n        T0.ItemName,\n        T3.Price AS [POS Price],\n        T1.AvgPrice,\n        T1.OnHand,\n        T1.MinStock,\n        T1.MaxStock,\n        T0.NumInBuy AS Packsize,\n        T0.LstSalDate,\n        (\n            SELECT SUM(Quantity) AS Expr1\n            FROM dbo.INV1\n            INNER JOIN OINV\n                    ON INV1.DocEntry = OINV.DocEntry\n            WHERE INV1.ItemCode = T0.ItemCode\n                    AND INV1.WhsCode = [%2]\n                    AND Month(OINV.DocDate) = month(GetDate())\n        ) AS [Current Period],\n        (\n            SELECT SUM(Quantity) AS Expr1\n            FROM dbo.INV1\n            INNER JOIN OINV\n                    ON INV1.DocEntry = OINV.DocEntry\n            WHERE INV1.ItemCode = T0.ItemCode\n                    AND INV1.WhsCode = [%2]\n                    AND Month(OINV.DocDate) = month(GetDate()) - 1\n        ) AS [Previous Period],\n        (\n            SELECT SUM(Quantity) AS Expr1\n            FROM dbo.INV1\n            INNER JOIN OINV\n                    ON INV1.DocEntry = OINV.DocEntry\n            WHERE INV1.ItemCode = T0.ItemCode\n                    AND INV1.WhsCode = [%2]\n                    AND Month(OINV.DocDate) = month(GetDate()) - 2\n        ) AS [60-90],\n        (\n            SELECT TOP 1 OPDN.DocDate AS Expr1\n            FROM dbo.PDN1\n            INNER JOIN OPDN\n                    ON PDN1.DocEntry = OPDN.DocEntry\n            WHERE PDN1.ItemCode = T0.ItemCode\n            ORDER BY OPDN.DocDate DESC\n        ) AS LastGRNDate\nFROM    OITM T0\n        INNER JOIN OITW T1\n            ON T0.ItemCode = T1.ItemCode\n        INNER JOIN OCRD T2\n            ON T0.CardCode = T2.CardCode\n        INNER JOIN ITM1 T3\n            ON T0.ItemCode = T3.ItemCode\n        INNER JOIN OWHS T4\n            ON T1.WhsCode = T4.WhsCode\n        INNER JOIN OITB T5\n            ON T0.ItmsGrpCod = T5.ItmsGrpCod\nWHERE   T3.PriceList = '3'\n        AND T4.WhsName = [%0]\n        AND T5.ItmsGrpNam = [%1]\n</code></pre>\n\n<p>How do I achieve this? (MS SQL Server 2008)</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-job"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":120,"score":2,"question_id":11986611,"title":"What do the Categories in SQL Server Agent Jobs mean?","body":"<p>This is the first time I am trying for the <strong>SQL Job Agent</strong>...I was <strong>trying to create the sample job</strong> and I got struck in between when it came to select the <strong>Category as highlighted</strong> in the below screen shot</p>\n\n<p><img src=\"http://i.stack.imgur.com/nTYYg.png\" alt=\"enter image description here\"></p>\n\n<p>I am new to <strong>SQL Server</strong> can you explain the meanings of categories as mentioned above? or any link will be hightly appreciated.</p>\n"},{"tags":["sql-server-2008","pdf","extraction"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":11679,"score":3,"question_id":1091700,"title":"How to extract data from a PDF?","body":"<p>My company receives data from an external company via Excel.  We export this into SQL Server to run reports on the data.  They are now changing to PDF format, is there a way to reliably port the data from the PDF and insert it into our SQL Server 2008 database?</p>\n\n<p>Would this require writing an app or is there an automated way of doing this?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":95,"score":2,"question_id":12954342,"title":"Set all columns to `null` in a table","body":"<p>Is there a quick way to change all fields in a table that are null to just empty fields. I have many columns so wondered if there was a way to do it by table rather than column by column.</p>\n\n<p>I need something like</p>\n\n<pre><code>update table 1 \nset * = '' \nwhere * is null\n</code></pre>\n\n<p>but obviously this is incorrect syntax</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures","informix","ibm"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":495,"score":1,"question_id":4447737,"title":"Translate stored procedure from MS SQL Server to Informix","body":"<p>I do not know how to write a specific stored procedure in Informix, so I had to write the logic in my mind in SQL Server which I know how to write (Microsoft simplicity)... So I will write my stored procedure in the SQL syntax and please any one who know Informix syntax and how to write tell me the equivalent of my stored procedure in Informix with little hints to learn the techniques used in both...</p>\n\n<p>My stored procedure is:</p>\n\n<pre><code>ALTER PROC [dbo].[DetectFine] @prog_code int\nAS\n---------------------------------\nDECLARE @lect_code int;\nDECLARE @prog_code_temp int;\nDECLARE @confirm_reg int;\nDECLARE @start_date_temp DATE;\n---------------------------------\nDECLARE Mycursor CURSOR FOR\nSELECT l.confirm_reg,p.[start_date],l.lect_code,l.prog_code\nFROM cc1lectprog l INNER JOIN cc1progtimes p\nON l.prog_code = p.prog_code\nWHERE p.prog_code = @prog_code;\n---------------------------------\nOPEN Mycursor ;\n---------------------------------\nFETCH NEXT FROM Mycursor\nINTO @confirm_reg,@start_date_temp,@lect_code,@prog_code_temp;\n---------------------------------\nWHILE @@FETCH_STATUS =0\nBEGIN\nSelect @confirm_reg as Cconfirm_reg, @start_date_temp as Cstart_date ,@lect_code as Clect_code,@prog_code_temp as Cprog_code_temp;\n-- This is executed as long as the previous fetch succeeds.\nIF @confirm_reg = 0 AND GETDATE()&gt;= DATEADD(DD,-3,@start_date_temp)\n-----------------------------------------------------------------------\nUPDATE cc1lectprog \nSET fine = 0\nWHERE lect_code = @lect_code AND prog_code = @prog_code_temp;\n-----------------------------------------------------------------------\nFETCH NEXT FROM Mycursor\nINTO @confirm_reg,@start_date_temp,@lect_code,@prog_code_temp;\n-----------------------------------------------------------------------\nEND\nCLOSE Mycursor\nDEALLOCATE Mycursor\n-----------------------------------------------------------------------\n</code></pre>\n\n<p>Note: this stored procedure is required to be executed every period of time like a job.  Is it possible to execute procedure with parameters every period of time or not? And what are the alternatives if not?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":12955560,"title":"Explicitly constraint drop not using the name","body":"<pre><code>CREATE TABLE [dbo].[tmp_rg_xx_LBJ]\n(\n[ROWVERSION] [bigint] NULL,\n[ROWDATE] [datetime] NULL,\n[SAPNO] [int] NOT NULL DEFAULT 1)\n\n\nIF  EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__tmp_rg_xx__SAPNO__1B0907CE]') AND type = 'D')\nBEGIN\nALTER TABLE [dbo].[LBJ] DROP CONSTRAINT [DF__tmp_rg_xx__SAPNO__1B0907CE]\nEND\n\nGO\n</code></pre>\n\n<p>I have a script that creates a table with a default in, but I want to drop the constraint. No problem manually as I know the name, except I want drop the constraint after recreating the table. So I can just re run the drop constraint script. How do you do this without explicitly using the name?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":12954082,"title":"Invalid column name: SQL Server 2008 R2","body":"<p>I have a stored procedure I use to extract binary data from SQL tables to create physical files. I have used it a couple of times on tables with the same structure restored from SQL backups, and it works OK. </p>\n\n<p>Today I wanted to extract some binary data from a new table inside a restored backup. I opened the stored procedure I have been using and set about altering the code. Once I was happy with the changes I tried to execute the 'ALTER' statement. Unfortunetly, both of the column names I have used are 'invalid' despite existing on the the 'Document' table.</p>\n\n<p>I have read a number of other threads regarding 'invalid column name' errors, but the majority of these seem to be typing errors. I've checked my column names numurous times (intelli sense even lets me put in 'Document.Document_ID' and 'Document.Document_Filename' but they still fail).</p>\n\n<p>Any ideas where I am going wrong?</p>\n\n<p>Source:</p>\n\n<pre><code>USE [Example Live]\nGO\n/****** Object:  StoredProcedure [dbo].[FileExport]    Script Date: 10/18/2012 11:42:14 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n-- Author:      Chris Murray\n-- Create date: 18/10/2012\n-- Description: Exports binary file data\n-- =============================================\nALTER PROCEDURE [dbo].[FileExport] \n-- Add the parameters for the stored procedure here\n@OutputFilePath VARCHAR(500) = 'C:\\Conv\\Example\\In\\Afiles\\'\nAS\nBEGIN\n\n   DECLARE @totrow int\n   DECLARE @currow int\n   DECLARE @result int\n   DECLARE @nsql nvarchar(4000)\n\n   DECLARE @sqlStatements table (ID int IDENTITY(1, 1),  SqlStatement varchar(max))   \n\n   INSERT\n   INTO @sqlStatements\n   SELECT 'BCP \"SELECT Document_Data FROM [Example Live].[dbo].[Document] WHERE Document_ID = '''\n  + CAST(Document_ID AS VARCHAR(500)) + '''\" queryout ' + @OutputFilePath \n  + CAST(Document_Filename AS VARCHAR(500)) + ' -S localhost\\SQLEXPRESS2008 -T -f C:\\Conv\\Example\\In\\AFiles\\Images.fmt'\n   FROM dbo.Photograph  \n\n   SET @totrow = @@ROWCOUNT\n   SET @currow = 1\n   WHILE @totrow &gt; 0 and @currow &lt;= @totrow\n   BEGIN\n      SELECT @nsql = SqlStatement\n      FROM @sqlStatements\n      WHERE ID = @currow\n      EXEC @result = xp_cmdshell @nsql\n      SET @currow = @currow + 1\n   END\nEND\n</code></pre>\n"},{"tags":["asp.net","sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":11501063,"title":"ASP.NET connections with READ UNCOMMITTED","body":"<p>I have a web application and all of its queries begin with</p>\n\n<pre><code>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\n</code></pre>\n\n<p>Is there any way to create all connections with this isolation level? Can I implement this to connection pool in web.config or somewehere else?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12954781,"title":"Refactoring T-SQL nested SELECT query to use in a case statement","body":"<p>I have the following table:</p>\n\n<pre><code>maker   model   type\nB   1121    pc\nA   1233    pc\nE   1260    pc\nA   1752    laptop\nA   1276    printer\nD   1288    printer\n</code></pre>\n\n<p>I need to receive a result in the form: maker, pc. If a particular maker has models in a given type, I need to concatenate the word 'yes' with the number of models in parentheses. Ex. yes(1) for maker 'A'. So, how can I avoid the following duplication?</p>\n\n<pre><code>CASE \nWHEN SELECT COUNT(*) WHERE ... &gt; 0\nTHEN 'yes(' + CAST((SELECT COUNT(*) WHERE ...) AS varchar) + ')'\n</code></pre>\n\n<p>This is not a real world problem. I just need to understand how to save a subquery result to use it in a branch statement. The result of this branch statement may contain the subquery result itself.</p>\n"},{"tags":["asp.net-mvc-3","sql-server-2008","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2149,"score":1,"question_id":10408182,"title":"A network-related or instance-specific error occurred while establishing a connection to SQL Server - ASP.NET MVC Entity Framework","body":"<p>I am using ASP.Net MVC 3 (Entity Framework) with Sql server 2008. Connection string is fine in web.config. But sometimes i get the following exception from my application:</p>\n\n<pre><code>    System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)\n\nGenerated: Wed, 02 May 2012 05:05:21 GMT\n\nSystem.Data.EntityException: The underlying provider failed on Open. ---&gt; System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\n   at System.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, Boolean encrypt, Boolean trustServerCert, Boolean integratedSecurity)\n   at System.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, SqlConnection owningObject)\n   at System.Data.SqlClient.SqlInternalConnectionTds.LoginWithFailover(Boolean useFailoverHost, ServerInfo primaryServerInfo, String failoverHost, String newPassword, Boolean redirectedUserInstance, SqlConnection owningObject, SqlConnectionString connectionOptions, TimeoutTimer timeout)\n   at System.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(SqlConnection owningObject, TimeoutTimer timeout, SqlConnectionString connectionOptions, String newPassword, Boolean redirectedUserInstance)\n   at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, Object providerInfo, String newPassword, SqlConnection owningObject, Boolean redirectedUserInstance)\n   at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection)\n   at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnection owningConnection, DbConnectionPool pool, DbConnectionOptions options)\n   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection)\n   at System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory)\n   at System.Data.SqlClient.SqlConnection.Open()\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\n   --- End of inner exception stack trace ---\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\n   at System.Data.EntityClient.EntityConnection.Open()\n   at System.Data.Objects.ObjectContext.EnsureConnection()\n   at System.Data.Objects.ObjectQuery`1.GetResults(Nullable`1 forMergeOption)\n   at System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable&lt;T&gt;.GetEnumerator()\n   at System.Linq.Enumerable.SingleOrDefault[TSource](IEnumerable`1 source)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.&lt;GetElementFunction&gt;b__2[TResult](IEnumerable`1 sequence)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.ExecuteSingle[TResult](IEnumerable`1 query, Expression queryRoot)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.System.Linq.IQueryProvider.Execute[S](Expression expression)\n   at System.Linq.Queryable.SingleOrDefault[TSource](IQueryable`1 source)\n   at MyApp.Data.UserRepository.GetUserDetails(String username)\n   at MyApp.Core.Services.SiteService.GetUserDetails(String username, Int64 userId)\n   at MyApp.PublicSite.Web.Controllers.BaseController.Initialize(RequestContext requestContext)\n   at System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext)\n   at MyApp.PublicSite.Web.Controllers.BaseController.Execute(RequestContext requestContext)\n   at System.Web.Mvc.ControllerBase.System.Web.Mvc.IController.Execute(RequestContext requestContext)\n   at System.Web.Mvc.MvcHandler.&lt;&gt;c__DisplayClass6.&lt;&gt;c__DisplayClassb.&lt;BeginProcessRequest&gt;b__5()\n   at System.Web.Mvc.Async.AsyncResultWrapper.&lt;&gt;c__DisplayClass1.&lt;MakeVoidDelegate&gt;b__0()\n   at System.Web.Mvc.Async.AsyncResultWrapper.&lt;&gt;c__DisplayClass8`1.&lt;BeginSynchronous&gt;b__7(IAsyncResult _)\n   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult`1.End()\n   at System.Web.Mvc.MvcHandler.&lt;&gt;c__DisplayClasse.&lt;EndProcessRequest&gt;b__d()\n   at System.Web.Mvc.SecurityUtil.&lt;GetCallInAppTrustThunk&gt;b__0(Action f)\n   at System.Web.Mvc.SecurityUtil.ProcessInApplicationTrust(Action action)\n   at System.Web.Mvc.MvcHandler.EndProcessRequest(IAsyncResult asyncResult)\n   at System.Web.Mvc.MvcHandler.System.Web.IHttpAsyncHandler.EndProcessRequest(IAsyncResult result)\n   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()\n   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously)\n</code></pre>\n\n<p>The Connection string is:</p>\n\n<pre><code>    &lt;connectionStrings&gt;\n    &lt;add name=\"MyAppDBContainer\" connectionString=\"metadata=res://*/MyAppDB.csdl|res://*/MyAppDB.ssdl|res://*/MyAppDB.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=SERVERNAME;initial catalog=MyAppDB;persist security info=True;user id=USERID;Password=PASSWORD;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>This exception occurs randomly and not able to get/reproduce it everytime. Any possible settings i may be missing here? Please suggest.</p>\n"}]}
{"total":21073,"page":10,"pagesize":100,"questions":[{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12953671,"title":"How to get and iterate through two dimentional list (using foreach I guess) in SQL stored procedure","body":"<p>I want a stored procedure that will put following results into a list and then I can go through each item of list I declared in stored procedure,</p>\n\n<p>first thing first I will take columns using this statement,</p>\n\n<pre><code>SELECT ColumnA, ColumnB \nFROM MyTable   // Save it into a two dimensional array or dictionary I guess\n</code></pre>\n\n<p>Then need to do another query within stored procedure for each <code>columnA</code> and <code>columnB</code> and get back a list of values for <code>columnC</code></p>\n\n<pre><code>if exists (\n    SELECT ColumnC FROM Table2 \n    Where ColumnA = //@ColumnA[i] or something  \n    AND SchemeID = //@ColumnB[i] or something)\n//then add ColumnC value to a list\nelse\ncontinue\n</code></pre>\n\n<p>I am new to SQL but have been working on C# for a moment so not sure how to make this stored procedure.</p>\n"},{"tags":["sql-server-2008","tsql","cursor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12953321,"title":"Inconsistent results from TSQL cursor","body":"<p>I've got a query that uses a cursor to insert data into my database. The weird thing is that the query runs the 1st time ( SSMS > Execute ), but if I run it a second time, the part with the cursor does not execute. </p>\n\n<p>However - If i then hit 'debug' I can debug and the whole query executes just fine. Right after that it works just fine once more and then, again, only the first insert script executes.</p>\n\n<p>I tried the FAST_FORWARD as mentioned <a href=\"http://stackoverflow.com/questions/4048147/inconsistent-cursor-results-when-looping-over-databases\">here</a> but that doesn't seem to solve the problem. Any suggestions?</p>\n\n<pre><code>/** Declarations **************************************************/\nDECLARE @TemplateFileName varchar(200)\nDECLARE @TemplatePreviewFileName varchar(200)\nDECLARE @TemplateId int\nDECLARE @CompanyId int\nDECLARE CompanyCursor cursor FAST_FORWARD FOR SELECT [CmpId] from SetCompany\n/******************************************************************/\n\n/** Set template name here ****************************************/\nSET @TemplateFileName           = 'Template_2'\nSET @TemplatePreviewFileName    = 'Template_2'\n/******************************************************************/\n\n/******************************************************************/\nINSERT INTO ... etc\nSET @TemplateId = @@IDENTITY;\nOpen CompanyCursor\n\nWHILE @@FETCH_STATUS = 0\n    BEGIN       \n        IF(@CompanyId IS NOT NULL)\n        BEGIN\n            PRINT 'Adding template ' + @TemplateFileName + ' with id ' + convert(varchar, @TemplateId) + ' to company ' + convert(varchar, @CompanyId);\n            INSERT INTO .... etc\n            PRINT 'OK';\n        END\n        Fetch NEXT FROM CompanyCursor INTO @CompanyId\nEND\nCLOSE CompanyCursor;\nDEALLOCATE CompanyCursor;\n</code></pre>\n\n<p>Running the 'first' time, I get:</p>\n\n<pre><code>(1 row(s) affected)\nAdding template Template_2.frx with id 2272 to company 10\n\n(1 row(s) affected)\nOK\nAdding template Template_2.frx with id 2272 to company 11\n\n(1 row(s) affected)\nOK\nAdding template Template_2.frx with id 2272 to company 12\n\n(1 row(s) affected)\nOK\nAdding template Template_2.frx with id 2272 to company 13\n\n(1 row(s) affected)\nOK\nAdding template Template_2.frx with id 2272 to company 14\n\n(1 row(s) affected)\nOK\n</code></pre>\n\n<p>Second time, only this:</p>\n\n<pre><code>(1 row(s) affected)\n</code></pre>\n\n<p>And indeed, the insert inside the cursor did not run.</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12499428,"title":"Select taking too long. Need advice for a better performance","body":"<p>Ok, here we go. There's this messy <code>SELECT</code> crossing other tables and ordering to get the one desired row. Basically I do the \"math\" inside the <code>ORDER BY</code>.</p>\n\n<p>1 base table.</p>\n\n<p>7 <code>JOINS</code> poiting to local tables.</p>\n\n<p><code>WHERE</code> with 2 clauses and a <code>NOT IN</code> crossing another table.</p>\n\n<p>You'll see in the code the <code>ORDER BY</code> is pretty damn big/ugly, it sums the result of 5 different calculations. I need that result to <code>order by</code> those calculations in order to get the worst row-case. </p>\n\n<p>The problem is once I execute the Stored Procedure it takes up to 8 seconds to run. That's kind of non-acceptable. So, I'm starting to check Indexes. </p>\n\n<p>So, I'm looking for advices on how to make this query run faster.\nI'm indexing the <code>WHERE</code> clauses and the field <code>LINEA</code>, Should I index something else? Like the rows Im crossing for the <code>JOINs</code>? or should I approach the query differently?</p>\n\n<p>Query:</p>\n\n<pre><code>SET @LINEA = (\n    SELECT TOP 1\n        BOA.LIN\n    FROM\n        BAND_BA BOA\n    LEFT JOIN\n        TEL PAR\n        ON REPLACE(BOA.Lin,'-','') = SUBSTRING(PAR.Te,2,10)\n    LEFT JOIN\n        TELP CLP\n        ON REPLACE(BOA.Lin,'-','') = SUBSTRING(CLP.Numtel,2,10)\n    LEFT JOIN\n        CA C\n        ON REPLACE(BOA.Lin,'-','') = C.An\n    LEFT JOIN\n        RE R\n        ON REPLACE(BOA.Lin,'-','') = R.Lin\n    LEFT JOIN\n        PRODUCTOS2 P2\n        ON BOA.PRODUCTO = P2.codigo\n    LEFT JOIN\n        EN \n        ON REPLACE(BOA.Lin,'-','') = EN.G\n    LEFT JOIN\n        TIP ID\n        ON TIPID = ID.ID\n    WHERE \n        BOA.EST = 'C' AND\n        ID.SE =  'boA' AND \n        BOA.LIN NOT IN (\n            SELECT \n                LIN \n            FROM \n                BAN\n\n            )   \n    ORDER BY (EN.VALUE + ANT.VALUE + REIT.VAL + C.VALUE + TEL.VALUE\n\n        ) DESC,             \n</code></pre>\n"},{"tags":["c#","asp.net","sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12953209,"title":"Retrieve Integer value from string in a Gridview","body":"<p>I have a gridview, when inserting data into the table <code>dept(100, 1, 'IT')</code> and when fetch the data from two tables <code>emp</code> and <code>dept</code> the records look like below grid:</p>\n\n<pre><code>EMpNo    DeptNo  DeptName\nHarshal   1        IT  \n</code></pre>\n\n<p>My problem is that, when I click on a grid view all records shows in respected text boxes\nbut issue is, I got all data except <code>empno</code>. Here I get as Name of employee instead of name  I want to <code>Empno</code>.</p>\n"},{"tags":["c#","sql-server-2008","unit-testing","teamcity","business-intelligence"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":244,"score":0,"question_id":10519736,"title":"Unit test (connect to Analysis Services) fails on TeamCity - but not on VS 2010 on the same machine","body":"<p>I've written some code that runs an MDX query against an SQL Server Analysis services. Unit tests on my dev machine work fine - however the TeamCity installation also runs the unit tests and only the ones connecting to the analysis services give an exception stating:</p>\n\n<pre><code>Test method GetNumCompaniesPerIndustryTest threw exception: \nMicrosoft.AnalysisServices.AdomdClient.AdomdConnectionException: The connection either timed out or was lost. \n---&gt; System.IO.IOException: Unable to read data from the transport connection: An existing connection was forcibly closed by the remote host. \n---&gt; System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host\n</code></pre>\n\n<p>This is the error I was getting before when my connection string wasn't right. The weird thing is that the server with TeamCity also has a VS 2010 installation so I can open the solution form the /buildAgent/work folder and run the unit tests. All tests work fine from VS - so there's no connection problem it seems.\nConnection string is in a settings file inside the DLL in application scope.</p>\n"},{"tags":["sql","sql-server-2008","sp-send-dbmail"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12950756,"title":"sp_send_dbmail with Binary Attachment Issue","body":"<p>I am attempting to use sp_send_dbmail to send out an attachment.\nThe attachment is stored in a varbinary(MAX) column in a table. Here is my query:</p>\n\n<pre><code>EXEC msdb.dbo.sp_send_dbmail \n        @recipients='mick.walker@somewhere.com',\n        @subject = 'Test Attachment',\n        @body = 'Test',\n        @body_format = 'HTML',\n        @profile_name = 'intranetadmin',\n        @query = 'Select DocumentData from [myDB].[dbo].[Documents] Where DocumentID = 8',\n        @query_result_header = 0,\n        @attach_query_result_as_file = 1,\n        @query_attachment_filename = 'Test.pdf',\n        @exclude_query_output = 1,\n        @query_no_truncate = 0;\n</code></pre>\n\n<p>The email sends sucessfully with a pdf attachment. However when it comes to opening the attachment, I get an error. I think the size of the file is being truncated, even though I explicitaally state no to in my query.</p>\n\n<p>I have checked the MAX allowed message size in the Database Mail settings and it is currently 104857600 bytes (100mb), the files I am attempting to send, are nowhere near this size - so I am a little puzzled.</p>\n"},{"tags":["sql","sql-server-2008","hierarchy","hierarchyid"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":347,"score":1,"question_id":8899230,"title":"Sql Hierarchy ID Sorting By Level","body":"<p>Is it possible to sort sql data in a hierarchy by it's hierarchy id, and then for each level sort it say alphabetically?</p>\n\n<p>So say we have an Employees Table that lists the organizational hierarchy based on the Employees ID</p>\n\n<p>You have Bob (5) who has Phil (17) and Charlie(28) Reporting to him, and Josie (6) has Tyler (15) and Mike (56) Reporting to her.</p>\n\n<p>If you sort it by HierarchyID it will look like:</p>\n\n<p>Bob (/5/)<br/>\n--Phil (/5/17/)<br/>\n--Charlie (/5/28/)<br/>\nJosie (/6/)<br/>\n--Tyler (/6/15/)<br/>\n--Mike (/6/56/)</p>\n\n<p>But It would probably make more sense to have it look like</p>\n\n<p>Bob<br/>\n--Charlie<br/>\n--Phil<br/>\nJosie<br/>\n--Mike<br/>\n--Tyler</p>\n\n<p>Is this possible without it getting too convoluted?</p>\n"},{"tags":["mysql","sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12949329,"title":"Is it possible to Connecting MYsql with sql server?","body":"<p>I am using an open source software which support mysql and i create application that uses asp.net 4.0 and sql server 2008....</p>\n\n<p>Is it possible to Connecting MYsql with sql server ?</p>\n\n<p>I want every insertion and updating should be made to both database servers as they have same schema of tables but one is mysql and other is sql server 2008 ?</p>\n\n<p>kindly explain step by step if possible</p>\n"},{"tags":["sql-server","sql-server-2008","row"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12950538,"title":"MS SQL 2008 - get all table names and their row counts in a DB","body":"<p>I'm trying to identify which tables are affected by a data update though an application (developed by others). There are more than 200 tables in the DB and I'd like to avoid checking each of them for changes.</p>\n\n<h3>Is there any other way where I can list all table names along with their row count?</h3>\n\n<pre><code>select table_name from information_schema.tables\n</code></pre>\n\n<p>List out all the tables in my DB buy how do I include number of rows as well?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sybase","sybase-ase"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12950844,"title":"Converting Sybase ASE-specific *= and =* into LEFT/RIGHT OUTER JOIN","body":"<p>I have some PHP applications running on Sybase ASE 15.0.2, and I need to port them to MicroSoft SQL Server 2008 R2.\nMany of the queries use the Sybase-only syntax with <code>*= and =*</code>\nIs there an automatic way to convert a query from the Sybase syntax to the standard syntax using LEFT/RIGHT OUTER JOIN ?</p>\n"},{"tags":["c#","sql-server-2008","gis","geocoding"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12949605,"title":"Get all points(circles with radius), that overlap given point","body":"<p>I need to find the best way for a \"circles overlapping given point\" system.</p>\n\n<p>I have a lot of points e.g. restaurants, and every item has a point of the place, and a radius for e.g. \"bringing out food\". The radius differ, some have 3 km, others 10 km.\nI am searching from a point. e.g. \"My position\" latitude/longitude.</p>\n\n<p>I need to find the best way to find all restaurants that overlaps my point. (Will bring food to me). (Not is point in circle, but what circles are overlapping my point.)</p>\n\n<p>I am thinking of storing lat/lng as geography type in SQLServer 2008. Is this the way to do it?</p>\n\n<p>Can I query directly on top of sqlserver? Or do I need to do it in code?\nAnd what is the way to do it?</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":18655,"score":6,"question_id":3169220,"title":"How to export query result to .csv file in SQL Server 2008?","body":"<p>How to export query result to .csv file in SQL Server 2008 ?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2008","compilation","real"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":67,"score":4,"question_id":12950174,"title":"SQL REAL 0 division causing interesting error on SQL Server 2008","body":"<p>Found an interesting problem on SQL Server yesterday, try this: </p>\n\n<pre><code>DECLARE @a REAL = 0.0000\nDECLARE @c DECIMAL (18,10) = 20754/3.45 -- this is 6015.6521730000\nDECLARE @b DECIMAL (18,10) = \nCASE \n    WHEN 1 &gt; 2 \n        THEN @a / 100\n    WHEN 1 = 2\n        THEN 56\n    ELSE @c\nEND\n\nSELECT @b\n</code></pre>\n\n<p>It seems to be a problem with precision, and how the case statement is compiled. It can be easily remedied by casting the REAL @a to a decimal in the case statement, but as it's @c we're returning and the other cases should never be hit, it's a strange problem to come across. \nAnyone know enough about SQL compilation to explain this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12948329,"title":"selecting minimum of multiple columns","body":"<p>I have three decimal columns named list1,list2,list3.\nI want to find the minimum of three in a single query.<br>\nI've tired this:</p>\n\n<pre><code>SELECT Least(list1, list2, list3) \nFROM   table1 \n</code></pre>\n\n<p>It throws an error that <code>least</code> is not recognized function.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12946298,"title":"Best way to get blog post titles along with blog name","body":"<p>Say I have 2 tables:</p>\n\n<blockquote>\n<pre><code>Blog      BlogPosts\nBlogId    BlogPostId\nName      BlogId\n          Title\n</code></pre>\n</blockquote>\n\n<p>When I am retrieving records, I want BlogPosts in CSV format. I've created a user defined function for this and pass in BlogId as a parameter. Is there any better way than this? Making DB requests in user defined functions can often be performance killer. Do you suggest any other way?</p>\n"},{"tags":["asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12949270,"title":"Updating records one by one","body":"<p>I have 5000 records I am calculating salary of one user and update his data in database. So it’s taking quit long to update 5000 records. I want to calculate all users’ salary first and then update to records in db.\n Is there any other way we can update db in single click</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12949804,"title":"Duplicate inserts with scheduled job through sql server Agent","body":"<p>I have a job that is scheduled through SQL Agent. It is scheduled to run every 2 minutes. When I am looking at the job history log I see it has ran once. But when I am looking at the table it has inserted two records and time difference between 2 records is just few milliseconds.</p>\n\n<p>I am trying to find out why it is happening and to looking to prevent this from happening.\nSql server version i'm using is 2008 on Windows server 2008. </p>\n\n<p>The stored procedure is doest not any prolem and before inserting i have a check IF NOT EXISTS (in the table)then insert. And also there is no trigger on that table.</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server-2008","query","nhibernate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12919949,"title":"How to group by SqlFunction with VarArgsSQLFunction in NHibernate","body":"<p>I'm trying to implement the following SQL query with QueryOver:</p>\n\n<pre><code>SELECT [Time]/1000\nFROM TableName\nGROUP BY [Time]/1000\n</code></pre>\n\n<p>Here's my current attempt:</p>\n\n<pre><code>var result = session\n    .QueryOver&lt;TableName&gt;\n    .Select(Projections.GroupProperty(\n        Projections.SqlFunction(\n            new VarArgsSQLFunction(\"(\", \"/\", \")\"),\n            NHibernateUtil.Int64,\n            Projections.Property(\"Time\")\n            Projections.Constant(1000))\n    ))\n    .List&lt;object&gt;();\n</code></pre>\n\n<p>Unfortunately I get the following exception (GenericADOException):</p>\n\n<pre><code>could execute query\n[ SELECT (this_.Time/@p0) as y0_ FROM [TableName] this_ GROUP BY (this_.Time/?) ]\n</code></pre>\n\n<p>And the inner exception:</p>\n\n<pre><code>Incorrect syntax near ?.\n</code></pre>\n\n<p>I can replace the \"GroupProperty\" with a \"Sum\" and it works. Any idea what's missing?</p>\n\n<hr>\n\n<p><strong>Update</strong>:\nApparently it's a bug in NHibernate. See also <a href=\"http://stackoverflow.com/questions/10696539/incorrect-syntax-near-nhibernate-generated-query\">this question</a>.</p>\n"},{"tags":["sql","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":76,"score":2,"question_id":12948070,"title":"DT_NTEXT columns in an SSIS package and Truncation Warnings","body":"<p>I have 2 questions : </p>\n\n<p>1) I have a DT_NTEXT column whose value I'm extracting from the database and trying to feed into a Test column in Excel. I'm using a data conversion step in between to convert this to DT_TEXT (the unicode text version).</p>\n\n<p>Still, in the end, Excel Connection Manager is writing ZERO rows (it's showing truncation warnings, but executing without error). I've even added a data viewer along the data flow with the following steps :</p>\n\n<p>\"<strong>In the arrows connecting your Source task to Data Conversion, and Data Conversion to Destination task , double click and you'll open the Data Flow Path Editor. Click on Data Viewer, then Add and click OK. That will allow you to see what is moving through the pipeline.</strong>\"</p>\n\n<p>I'm not seeing any difference when I run my package though.</p>\n\n<p>2) Is it possible for me to convert a DT_NTEXT column to a DT_WTSR column. In a perfect scenario, i should get this column into a standard nvarchar column in my Excel. </p>\n"},{"tags":["asp.net","sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12947687,"title":"which system table contains IsReportManagerEnabled parameter","body":"<p>I need to figure out which system table contains the IsReportManagerEnabled option\nfor Report Manager.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12947106,"title":"timeout error for growing database size","body":"<p>We have an application which is running under productive environment.The application has a web service which takes in data and saves the data in MS SQL database for future processing. This web service is used by our client to send the data. We receive around 80 records per seconds. </p>\n\n<p>Initially the application was working fine and the size of the database was 1 GB. The application is in production environment for around 6 months now and the database size has reached to 15 GB. Now all the operations on the database are taking more time. Clients are getting timeout error for the web service due to database slow speed. </p>\n\n<p>Please suggest a solution so that we can handle such a application where database size increases gradually. </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":44,"score":3,"question_id":12943686,"title":"SQL Server Row based grouping","body":"<p>Given the following setup:</p>\n\n<pre><code>DECLARE @TemplateInfo table (Name varchar(10), aRow int, aCol int, Value  int)\n\ninsert INTO @TemplateInfo (Name, aRow, aCol, Value)\nVALUES ('A', 0,0,1),('B', 0,0,2),('A',1,0,2),('B',1,0,1),('C',0,0,1),('C',1,0,1)\n</code></pre>\n\n<p>How can I select the unique Name name values that have (aRow=0, aCol=0, Value=1) AND (aRow=1, aCol=0, Value=1). </p>\n\n<p>I tried a query like this:</p>\n\n<pre><code>select  Name\nfrom    @TemplateInfo info\nwhere   (info.aRow = 0 and info.aCol = 0 AND Value = 1) \n        or (info.aRow = 1 and info.aCol = 0 AND Value = 1)\nGROUP BY Name\n</code></pre>\n\n<p>But that returns A, B and C.  How can I check to make sure there are matches across rows (only return C)</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12912363,"title":"Conversion failed when converting date and/or time from character string","body":"<p>Why does this statement succeed?</p>\n\n<pre><code>    SELECT CAST('08:50' as time)\n</code></pre>\n\n<p>But this one fails? <code>tmrec</code> is an nvarchar(6) column and contains the same value <code>'08:50'</code>. This is making me crazy since last 1 hour.</p>\n\n<pre><code>    SELECT   TOP 1 CAST(tmrec as time) \n    FROM     Instr \n    WHERE    igrp = 'JD' \n    ORDER BY ino , smallin\n</code></pre>\n\n<p><a href=\"http://postimage.org/image/f5wtcbr91/\" rel=\"nofollow\">This screenshot</a> shows the 1st query's result. It contains 08:50. Yet the 2nd query throws error.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Even this doesn't work which guarantees that conversion is applied only on fetched records:</p>\n\n<pre><code>    SELECT CAST( tmrec as time)\n    FROM\n         (\n            SELECT TOP 1 tmrec\n            FROM   [ccwise-courts].[dbo].[INSTR]\n            WHERE  igrp = 'JD' \n            ORDER BY ino , smallin\n         ) v\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":83,"score":2,"question_id":12941165,"title":"SQL Server : how to loop through rows and assign value","body":"<p>I have a couple of tables to deal with. One is like this:</p>\n\n<p><strong>dbo.userActivity</strong> </p>\n\n<pre><code> userID    Action    Time\n   1         25       12:00\n   1         10       12:01\n   1         12       12:35\n   1          6       13:54\n   2         10        6:47\n   2         42        6:48\n   3          8       11:54\n   etc.\n</code></pre>\n\n<p>The other table is a schedule that looks like this:</p>\n\n<p><strong>dbo.userSchedule</strong> </p>\n\n<pre><code> userID    schedule_start    schedule_stop\n   1            07:00            09:00\n   2            11:00            12:30\n   3            14:00            15:00\n  etc.\n</code></pre>\n\n<p>What I need to do for each row in <code>dbo.userActivity</code> is determine if each action was an hour before the <code>schedule_start</code>, between the <code>schedule_start</code> and <code>schedule_stop</code> times, an hour after <code>schedule_stop</code>, or any other time. </p>\n\n<p>So I need to append a column to <code>dbo.userActivity</code> with the values 'before', 'during', 'after', 'other' based on the time calculations.</p>\n\n<p>I'm really not sure how to do this and would appreciate any help you all could offer.</p>\n\n<p>EDIT:</p>\n\n<p>Okay, so I have that mostly working. I've just seen some of the real data I'll be working on and noticed that the activity times are full datetime stamps, whereas the activity schedule is just in time. So I need to convert the datetime to something I can compare.</p>\n\n<p>This looks like it works:</p>\n\n<blockquote>\n  <p>SELECT * \n  FROM\n    (\n        SELECT CONVERT(TIME, SCANDATE) as scanTime \n        FROM appData\n    ) st\n  WHERE st.scanTime &lt;= '6:00'\n  ORDER BY st.scanTime</p>\n</blockquote>\n\n<p>Just as an example. But when I try to incorporate that into the case statement below like this, it doesn't work. It applies the same THEN to every row.</p>\n\n<blockquote>\n<pre><code>SELECT\n  CASE\n  WHEN EXISTS\n  (\n  SELECT *\n  FROM\n  (\n  SELECT CONVERT(TIME, SCANDATE) as scanTime \n  FROM appData\n  ) st\n  WHERE st.scanTime &lt;= '6:00'\n  )\n  THEN 'Before 6 am'\n\n  ELSE '6 am or after'\n  END\nFROM appData\n</code></pre>\n</blockquote>\n\n<p>Any further thoughts on this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12943220,"title":"SSIS New Column with Condition","body":"<p>I have Created one new column using Derived column Record_Type as (DT_WSTR,25)\"\" data type, Then I used another derived column to create my condition  for Record_Type is  PRDCT_IND ==  TRUE  ? \"PRIME\" : \"SEC\".</p>\n\n<p>Can it be possible to create both the thing in one derived column?</p>\n\n<p>Appreciate your help.</p>\n\n<p>343</p>\n"},{"tags":["c#","asp.net-mvc","linq","sql-server-2008","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12929610,"title":"How to reset the identity column in C#?","body":"<p>I need to reset my identity field parametrically in MVC.net. I am using Linq and Entity Framework.</p>\n\n<p><strong>Reason:</strong> I am inserting thousands of records in my table by importing. I am importing records again after some period of time, so my id field value increasing so much </p>\n\n<p>For ex. In 100000000 so my field data type is Big int but it is not sufficient for my this value. So I need to reset my identity field. </p>\n"},{"tags":["sql-server-2008","full-text-search","multiple-columns"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":12943199,"title":"Is it possible to create a full text index on two or more columns on the same table in MS SQL?","body":"<p>Is this possible, or by default is this essentially what I'm doing by creating a full text index on the entire table, specifying in my query which column to query using the 'CONTAINS(column, phrase)' function?</p>\n\n<p>Thanks!</p>\n\n<p>If this question has already been asked (was unable to find a match) please feel free to delete.</p>\n"},{"tags":["c#","asp.net","sql-server-2008","c#-4.0","asp.net-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12945120,"title":"sql simple Query with dates","body":"<p>i have a time clock application that registers employes Attendance at work,</p>\n\n<p>i was trying to set the visibility of \"Enter\" <code>imageButton</code>\n(entrance e.g \"Timein\" field ) to hidden based on a query </p>\n\n<p>so if there was no <code>timeout</code> in last record that has a <code>TimeIn</code> for the current <code>UserId</code> then the <code>Enter</code> button will be hidden </p>\n\n<p>this is the table : (<code>tId</code> is PK IDENTITY)</p>\n\n<p><img src=\"http://i.stack.imgur.com/k7R6p.png\" alt=\"enter image description here\"></p>\n\n<p>so based on those records for example , the last (top 1) is not signed out so the user will not get to see the <code>Enter button</code>, that allows user to sign in, cause there was no last action of <code>TimeOut</code></p>\n\n<p>working from <code>asp.net</code> <code>C#</code> code behind i was trying to work a solution using <code>datedIff</code> as a query :</p>\n\n<p>but i guess i am missing something here </p>\n\n<p>please don't take it to account if this is the wrong approach i just wanted to show.. i did try though if there's a better way to achive what i need then just disregard that query  </p>\n\n<pre><code>select isnull((SELECT TOP 1 case when [TimeOut] is null then '' else convert(nvarchar,[TimeOut]) end FROM tblTime WHERE datediff(day,TimeOut,getdate())=0 and UserId =3571 ORDER BY tId DESC),'')\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12927861,"title":"Calculating time frames between status using SQL 2008/2012","body":"<p>Calculating time frames between status using SQL 2008/2012</p>\n\n<p>I've the following table who store the status of a student</p>\n\n<pre><code>+----+-----------+------------------+---------+---------+\n| ID | PERSON_ID |    TIMESTAMP     | IN_HOME | STUDYNG |\n+----+-----------+------------------+---------+---------+\n|  1 |         1 | 17/10/2012 19:00 |       0 |       0 |\n|  2 |         1 | 17/10/2012 19:02 |       1 |       0 |\n|  3 |         1 | 17/10/2012 19:03 |       1 |       1 |\n|  4 |         1 | 17/10/2012 19:04 |       1 |       1 |\n|  5 |         1 | 17/10/2012 19:05 |       1 |       0 |\n|  6 |         1 | 17/10/2012 19:10 |       0 |       0 |\n|  7 |         1 | 17/10/2012 19:12 |       0 |       0 |\n|  8 |         1 | 17/10/2012 19:20 |       1 |       0 |\n|  9 |         1 | 17/10/2012 19:25 |       1 |       0 |\n| 10 |         1 | 17/10/2012 19:26 |       1 |       1 |\n| 11 |         1 | 17/10/2012 19:30 |       1 |       0 |\n+----+-----------+------------------+---------+---------+\n</code></pre>\n\n<p>And i would like to produce results in 2 ways to make some reports:</p>\n\n<p>I:</p>\n\n<pre><code>+-----------+------------------+------------------+---------+---------+\n| PERSON_ID |      START       |       END        | IN_HOME | STUDYNG |\n+-----------+------------------+------------------+---------+---------+\n|         1 | 17/10/2012 19:00 | 17/10/2012 19:02 |       0 |       0 |\n|         1 | 17/10/2012 19:02 | 17/10/2012 19:03 |       1 |       0 |\n|         1 | 17/10/2012 19:03 | 17/10/2012 19:05 |       1 |       1 |\n|         1 | 17/10/2012 19:05 | 17/10/2012 19:10 |       1 |       0 |\n|         1 | 17/10/2012 19:10 | 17/10/2012 19:20 |       0 |       0 |\n|         1 | 17/10/2012 19:20 | 17/10/2012 19:26 |       1 |       0 |\n|         1 | 17/10/2012 19:26 | 17/10/2012 19:30 |       1 |       1 |\n+-----------+------------------+------------------+---------+---------+\n</code></pre>\n\n<p>II:</p>\n\n<pre><code>+-----+------------------+------------------+--------+---------+----------+----------+\n| PID |      START       |       END        | InHOME | TotTIME | FreeTIME | StudTIME |\n+-----+------------------+------------------+--------+---------+----------+----------+\n|   1 | 17/10/2012 19:00 | 17/10/2012 19:02 |      0 | 2min    | 2min     | 0min     |\n|   1 | 17/10/2012 19:02 | 17/10/2012 19:10 |      1 | 8min    | 6min     | 2min     |\n|   1 | 17/10/2012 19:10 | 17/10/2012 19:20 |      0 | 10min   | 10min    | 0min     |\n|   1 | 17/10/2012 19:20 | 17/10/2012 19:26 |      1 | 6min    | 6min     | 0min     |\n+-----+------------------+------------------+--------+---------+----------+----------+\n</code></pre>\n\n<p>What's the best solution to solve this problems? </p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12939851,"title":"Query tables across multiple databases","body":"<p>All... I need a way to query identical tables across multiple databases. I have roughly 30+ databases and they all have identical tables.  </p>\n\n<pre><code>    SELECT \n      a.name\n      , a.address\n      , b.company_id\n      , c.part_no\n      , c.cost\n    FROM accounts a\n    JOIN business b on a.whatever = b.whatever\n    JOIN crazy c ON b.things = c.things\n</code></pre>\n\n<p>Something simple like this, but across all databases. The focus isn't joining on multiple databases, that's simple, it's running this across all databases simultaneously. There's got to be a simpler way than creating a long drawn out stored procedure, no?</p>\n"},{"tags":["sql","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":67,"score":-1,"question_id":12806994,"title":"SSIS Conditional Filter split with bit data type","body":"<p>Data -  from table (58 columns), in this table 4 columns will use in conditional filter.</p>\n\n<p>1 column - bit data type(Color_Ind)</p>\n\n<p>1 column -  bit data type(Type_ind)</p>\n\n<p>2 columns - varchar data type(Region,State)</p>\n\n<p>process steps\n1) OLE DB connection to extract all data</p>\n\n<p>2) use Data Conversion to convert bit type columns into string data type.</p>\n\n<p>3) use conditional filter to filter the data into 5 different category.</p>\n\n<p>Probelm:-\n- If I use color_ind and Type_ind it will not create my desired output, but If I use it without these columns and only use Region and state it will create my desired output.</p>\n\n<p>Could you please tell me how to use bit data type into condtional filter in SSIS?</p>\n\n<p>Appreciate your help.</p>\n\n<p>Thanks</p>\n"},{"tags":["asp.net","sql-server-2008","geolocation","geospatial","computational-geometry"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":76,"score":0,"question_id":12061189,"title":"Optimize zipcode distance calculation","body":"<p>Here is the question I have for all</p>\n\n<p>I already have an existing system that does the \"Near By Zipcodes\" search.</p>\n\n<p>The purpose of this post is to see if I can optimize the process.</p>\n\n<p>Currently, I have about 43k zipcode records.</p>\n\n<p>The way my current algorithm works is I select 1 record and do a full table scan of 43k records.</p>\n\n<p>Is there a way to only take a subset (lat range, long range) and do the calculation that way?</p>\n"},{"tags":["sql-server-2008","database-diagram"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":348,"score":0,"question_id":11131528,"title":"SQL Server 2008 Unspecified error (MS Visual Database Tools)","body":"<p>I am a newbie using SQL Server 2008, and I am facing an error message when I try to make database diagram by right clicking on the database in SQL Server Management Studio:</p>\n\n<blockquote>\n  <p>Unspecified error\n  (MS Visual Database Tools)</p>\n  \n  <p>Program Location:</p>\n  \n  <p>at System.Runtime.InteropServices.Marshal.ThrowExceptionForHRInternal(Int32\n  errorCode, IntPtr errorInfo)<br>\n  at Microsoft.SqlServer.Management.UI.VSIntegration.Editors.VirtualProject.CreateDesigner(Urn\n  origUrn, DocumentType editorType, DocumentOptions aeOptions,\n  IManagedConnection con, String fileName)<br>\n  at Microsoft.SqlServer.Management.UI.VSIntegration.Editors.VirtualProject.Microsoft.SqlServer.Management.UI.VSIntegration.Editors.ISqlVirtualProject.CreateDesigner(Urn\n  origUrn, DocumentType editorType, DocumentOptions aeOptions,\n  IManagedConnection con, String fileName)<br>\n  at Microsoft.SqlServer.Management.UI.VSIntegration.Editors.ISqlVirtualProject.CreateDesigner(Urn\n  origUrn, DocumentType editorType, DocumentOptions aeOptions,\n  IManagedConnection con, String fileName)<br>\n  at Microsoft.SqlServer.Management.UI.VSIntegration.Editors.ScriptFactory.CreateDesigner(DocumentType\n  editorType, DocumentOptions aeOptions, Urn parentUrn,\n  IManagedConnection mc, String fileName)<br>\n  at Microsoft.SqlServer.Management.UI.VSIntegration.Editors.VsDocumentMenuItem.CreateDesignerWindow(IManagedConnection\n  mc, DocumentOptions options)  </p>\n</blockquote>\n\n<p>I have searched for this error and most of the responses were about \"common error when upgrading from 2005 to 2008\", which is not my case, because I have only just newly installed SQL Server 2008 4 days ago.</p>\n\n<p>Can someone help me to solve this problem?</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12921894,"title":"sql server 2008 query inline","body":"<p><code>select devicename, name, value, timestamp from table1</code> gives me the following,</p>\n\n<pre><code>DEVICENAME     NAME     VALUE    TIMESTAMP\n123            CURRENT  130      2012-10-16 13:00:00.000\n123            AVG      140      2012-10-16 13:00:00.000\n123            MIN      100      2012-10-16 13:00:00.000\n123            MAX      160      2012-10-16 13:00:00.000\n</code></pre>\n\n<p>How do i get them like this in sql query,</p>\n\n<pre><code>123, 130, 140, 100, 160 2012-10-16 13:00:00.000\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12939335,"title":"Execute SSIS Package when SQL and Visual studio is not installed","body":"<p>Is it possible to execute the SSIS package(.dtsx file) into the System when SQL and Visual Studio is not installed into the system.</p>\n\n<p>Minimum Requirement to execute the SSIS Package ?\nKindly Suggest how to proceed in this scenario ?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","asp.net-mvc","sql-server-2008","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":12942101,"title":"What's a good way to convert my LINQ-to-SQL objects into my model objects?","body":"<p>I've been noticing when I pull things out of the my MSSQL db using LINQ-to-SQL using something simple like:</p>\n\n<pre><code>    public IEnumerable&lt;Contact&gt; GetAll()\n    {\n        var Contacts = from c in _context.Contacts\n                      select new Models.Contact\n                      {\n                          ContactID = c.ContactID,\n                          FirstName = c.FirstName,\n                          LastName = c.LastName,\n                          Email = c.Email,\n                          Phone = c.Phone,\n                          Address1 = c.Address1,\n                          Address2 = c.Address2,\n                          City = c.City,\n                          State = c.State,\n                          Zip = c.Zip,\n                          HighImportance = (bool)c.HighImportance,\n                          PrimaryContact = (bool)c.PrimaryContact,\n                          OfficeLocation = c.OfficeLocation\n                      };\n        return Contacts;\n    }\n</code></pre>\n\n<p>I have a complex object (foreign key reference) to an OfficeLocations table which I would like to populate.  If I do something like:</p>\n\n<pre><code>_context.OfficeLocations.SingleOrDefault(ol =&gt; ol.OfficeLocationID == c.OfficeLocationID);\n</code></pre>\n\n<p>Then this returns the type which is generated by my DBML.  Up to now I've been using something like:</p>\n\n<pre><code>OfficeLocation = new OfficeLocation\n            {\n                OfficeLocationID = c.OfficeLocationID,\n                Name = c.OfficeLocation.Name,\n                Phone = c.OfficeLocation.Phone\n            }\n</code></pre>\n\n<p>But I feel like there should be a much better way to do it, maybe by using extension methods on my DBML data objects or something?</p>\n\n<p>Any thoughts would be greatly appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2008","max"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12865731,"title":"Trouble with SELECT statement - find Min, Max values under different conditions - SQL server 2008","body":"<p>Here is how my selection looks like:</p>\n\n<pre><code>DocID   DocNumber   MilestoneDate   MilestoneID\n30      14-1        2001-10-01  10\n30      14-1        2001-10-15  11\n30      14-1        2002-11-06  13\n30      14-1        2003-11-01  27\n30      14-1        2003-11-01  30\n30      14-1        2004-03-01  28\n30      14-1        2004-03-01  31\n31      14-3        2003-06-27  13\n31      14-3        2004-05-05  27\n31      14-3        2004-05-05  30\n31      14-3        2005-07-20  35\n31      14-3        2005-08-31  23\n36      1-2         1996-10-01  10\n36      1-2         1996-10-01  11\n36      1-2         1996-12-01  28\n36      1-2         1996-12-01  31\n</code></pre>\n\n<p>I need to make a report out of this selection that would have 1 row per DocID.\nIt would have columns \nDocID, \nDocNumber, \nEarliestDate = if MilestoneID 10 or 11 not empty select greater out of these two else\n               the earliest date out of other MilestoneIDs for that DocID (here is my trouble)\nAny help would be appreciated.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","hadoop","hdfs","sqoop"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":157,"score":0,"question_id":9568479,"title":"Sqoop authenticates but fails to start a map reduce job","body":"<p>I am trying to transfer data using sqoop from HDFS to the MSSQL server. But for some reasons, sqoop hangs at </p>\n\n<pre><code>tool.BaseSqoopTool: Enabled debug logging.\nsqoop.ConnFactory: Added factory com.microsoft.sqoop.SqlServer.MSSQLServerManagerFactory specified by /usr/lib/sqoop/conf/managers.d/mssqoop-sqlserver\nDEBUG sqoop.ConnFactory: Loaded manager factory: com.microsoft.sqoop.SqlServer.MSSQLServerManagerFactory\nDEBUG sqoop.ConnFactory: Loaded manager factory: com.cloudera.sqoop.manager.DefaultManagerFactory\nDEBUG sqoop.ConnFactory: Trying ManagerFactory: com.microsoft.sqoop.SqlServer.MSSQLServerManagerFactory\nINFO SqlServer.MSSQLServerManagerFactory: Using Microsoft's SQL Server - Hadoop Connector\nINFO manager.SqlManager: Using default fetchSize of 1000\nDEBUG sqoop.ConnFactory: Instantiated ConnManager com.microsoft.sqoop.SqlServer.MSSQLServerManager@45db05b2\nINFO tool.CodeGenTool: Beginning code generation\nDEBUG manager.SqlManager: No connection paramenters specified. Using regular API for making connection.\n</code></pre>\n\n<p>I check the firewall and it is allowing connections without any restrictions. Sqoop gets authenticated but doesnt initiate a map reduce job after it gets authenticated. Any one has faced similar problems before?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12461892,"title":"views not refreshing /sp_refreshview taking time for certain views even though there is no data in the view","body":"<p>I have got 2 client's databases(client1 and client 2).As a part of testing, I have restore those 2 databases in my local server.</p>\n\n<p>Views are created in a database called configDB(same server) and are pointing to  tables in a database  called CurrentsourceDB(data of client1).Now I have \nrenamed the CurrentsourceDB to CurrentsourceDB_old and \nsource2db(data of client2) to CurrentsourceDB\n(client1's data db and client2's data db both have same objects, same structure. The only difference is with data ).\nNow when I query the view it has to show data based on source2db(client2's data) But it still shows data based on source1(client1's data).</p>\n\n<p>So I have to either refresh all the view or just alter all the views then I can see the view's data based on present source database,source2db\nWhy does it happen, and is there any way to resolve the problem apart from refreshing?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12935664,"title":"Get size of a database that is hosted on a linked server?","body":"<p>Does anyone know how to get the size of a dabase that is hosted on a different server? I basicly want to monitor the size of that DB in a Job on my server.\nI tried something like:</p>\n\n<pre><code>select db_name(dbid), str(convert(dec(15),sum(size))* 8192/ 1048576,10) \nfrom [LINKEDSERVER].master.sys.sysaltfiles \ngroup by dbid order by 2 desc\n</code></pre>\n\n<p>For some reason this gives me the data on my current server instead of the remote server.\nAlso, I've read on a forum that the sysaltfiles is only updated at server restarts? This would make it unusable for monitoring, so do you have a better option instead?</p>\n"},{"tags":["sql-server-2008","sql-job"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12940711,"title":"Error Running SQL Server 2008 Job with SQL Server 2000 Linked Server","body":"<p>I have successfully created a linked server to our SQL 2000 server from within SSMS and I am able to query and retrieve data from it. I have a Merge query set up to read in data from this linked server and use it to update/insert into a table on the SQL 2008 server. When I run this query in SSMS it runs fine. As soon as I schedule it as a job it fails with the following error: \"Login failed for user'NT_Authority\\Network Service'. Reason. Failed to open the explicitly specified database. For each step in this job I have selected the \"Run as user\" and input the same credentials as was used to connect to the linked server. Since it is showing up as using NT_Authority I would guess I'm missing something somewhere. This is the first time I've tried to create a SQL job with a linked server so any direction/help would be appreciated.</p>\n\n<p>Edit. The login is using SQL authentication not Windows. </p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12940511,"title":"tsql coalesce with float and varchar","body":"<p>I have a float field which shows data as such:</p>\n\n<pre><code>1\n1.00\n3.12\n3.00\n</code></pre>\n\n<p>I also have a varchar field that shows as such:</p>\n\n<pre><code>NA\nND \nI\n</code></pre>\n\n<p>Data is as such: Fld_N is a float and Fld_S is varchar</p>\n\n<pre><code>Fld_N   Fld_S\n-----   ------\n1 \n        ND\n1.00    \n3.12\n3\n       NA\n       I\n</code></pre>\n\n<p>Notice that a row can have a value for either the Fld_N or the Fld_S but not both.</p>\n\n<p>What I am doing is using the coalesce as such:</p>\n\n<pre><code>    COALESCE(STR(Fld_N,9,2), Fld_S)  Fld\n</code></pre>\n\n<p>This doesn't quite work well as I have the decimal points always be upto 2 decimal points whereas I need it to support showing 1 as well as 1.00. Is there a way to not specify the decimal points and still accomomdate for showing 1 and 1.00 in my example? </p>\n"},{"tags":["c#","sql-server-2008","linq-to-sql","entity-framework-4"],"answer_count":3,"favorite_count":2,"up_vote_count":17,"down_vote_count":0,"view_count":6116,"score":17,"question_id":6384659,"title":"A dependent property in a ReferentialConstraint is mapped to a store-generated column","body":"<p>I get this error when writing to the database.</p>\n\n<p>A dependent property in a ReferentialConstraint is mapped to a store-generated column. Column: 'PaymentId'.</p>\n\n<pre><code>public bool PayForItem(int terminalId, double paymentAmount, \n      eNums.MasterCategoryEnum  mastercategoryEnum, int CategoryId, int CategoryItemId)\n    {\n\n        using (var dbEntities = new DatabaseAccess.Schema.EntityModel())\n        {\n            int pinnumber = 0;\n            long pinid = 1; //getPinId(terminalId,ref pinnumber) ;\n            var payment = new DatabaseAccess.Schema.Payment();\n            payment.CategoryId = CategoryId;\n            payment.ItemCategoryId = CategoryItemId;\n            payment.PaymentAmount = (decimal)paymentAmount;\n            payment.TerminalId = terminalId;\n            payment.PinId = pinid;\n\n            payment.HSBCResponseCode = \"\";\n            payment.DateActivated = DateTime.Now;\n            payment.PaymentString = \"Payment\";\n            payment.PromotionalOfferId = 1;\n            payment.PaymentStatusId = (int)eNums.PaymentStatus.Paid;\n\n            //payment.PaymentId = 1;\n\n            dbEntities.AddToPayments(payment);\n            dbEntities.SaveChanges();\n        }\n        return true;\n    }\n</code></pre>\n\n<p>I am new to Entity Framework and its driving me nuts</p>\n\n<p>The schema is</p>\n\n<p><img src=\"http://i.stack.imgur.com/ygkYW.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server-2008","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1385,"score":0,"question_id":6703368,"title":"sp_attach_single_file_db Error: failed with the operating system error 5(Access is denied.)","body":"<p>I'm  trying to use this DataBase that come with this sample project with from MS:</p>\n\n<p><a href=\"http://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa/sourcecode?fileId=18930&amp;pathId=365206059\" rel=\"nofollow\">http://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa/sourcecode?fileId=18930&amp;pathId=365206059</a></p>\n\n<p>So after I downloaded the files: I need to attach the .mdf DataBase to my Instance of MS SQL 2008.</p>\n\n<p>From Management Studio Attaching DataBase does not work and event using this command i receive the same error:</p>\n\n<blockquote>\n  <p>sp_attach_single_file_db 'School.mdf', 'C:\\School.mdf'</p>\n</blockquote>\n\n<hr>\n\n<p>ERROR:</p>\n\n<pre><code>Msg 5133, Level 16, State 1, Line 1\nDirectory lookup for the file \"C:\\School.mdf\" failed with the operating system error 5(Access is denied.).\n</code></pre>\n\n<p>Any idea what is wrong? Thanks for your help!</p>\n"},{"tags":["sql","sql-server-2008","tsql","pivot","transpose"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":52,"score":0,"question_id":12926901,"title":"Transposing Table","body":"<p>I've looking everywhere and have not finding anything useful.</p>\n\n<p>I have a table the captures assistance for employees.</p>\n\n<p>The  table that looks like this:</p>\n\n<pre><code>ID   | DATE     | ATTENDANCE\n________________\n2524 | 20121001 | ASISTANCE\n2525 | 20121001 | ABSCENCE\n2526 | 20121001 | ASISTANCE\n2527 | 20121001 | ASISTANCE\n2524 | 20121002 | ASISTANCE\n2525 | 20121002 | ABSCENCE\n2526 | 20121002 | ASISTANCE\n2527 | 20121002 | ASISTANCE\n2524 | 20121003 | ASISTANCE\n2525 | 20121003 | DAY OFF\n2526 | 20121003 | DAY OFF\n2527 | 20121003 | ASISTANCE\n</code></pre>\n\n<p>And I want a query that returns a table that will look like this:</p>\n\n<pre><code>ID   | 20121001  | 20121002  | 20121003\n________________\n2524 | ASISTANCE | ASISTANCE | ASISTANCE\n2525 | ABSCENCE  | ABSCENCE  | DAY OFF\n2526 | ASISTANCE | ASISTANCE | ASISTANCE\n2527 | ASISTANCE | ASISTANCE | DAY OFF\n</code></pre>\n\n<p>I tried individual querys and joining them, but since they are to many dates it takes too much to do so.</p>\n\n<p>How can I do it that is efficient and can be stored into a view or function??</p>\n"},{"tags":["xml","sql-server-2008"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":8041,"score":1,"question_id":1803911,"title":"Generating XML file from SQL Server 2008","body":"<p>I am working on an application where I need to get the SQL response as XML into an XML file (and to store it in some physical location, say c:\\xyz.xml).</p>\n\n<p>I am able to generate the XML content using the provisions available in SQL Server as shown below. </p>\n\n<pre><code>    SELECT * FROM @Table FOR XML AUTO, ELEMENTS\n</code></pre>\n\n<p>where: @Table is a table variable. </p>\n\n<p>I want to know how I can store the query output to a XML file from SQL Server itself. </p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","sql-server-2008","default-value"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":1999,"score":0,"question_id":6791675,"title":"How to set a default value for an existing column","body":"<p>This isn't working in SQL Server 2008:</p>\n\n<pre><code>ALTER TABLE Employee ALTER COLUMN CityBorn SET DEFAULT 'SANDNES'\n</code></pre>\n\n<p>The error is:</p>\n\n<blockquote>\n  <p>Incorrect syntax near the keyword 'SET'.</p>\n</blockquote>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","math","arithmetic-expressions"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":52,"score":3,"question_id":12925148,"title":"In T-SQL how can I get a column of 2-decimal points(or percentages)?","body":"<p>In SQL Server 2008, I am running a report where I need to divide two columns (called <code>Completes</code> and <code>Prescreens</code>, whole integers), and then I go to Excel and get the <code>Prescreens</code> divided by the <code>Completes</code>, and turn that into a number with 2 decimal places, then convert that to a percentage. i.e. -> 0.34, then becomes 34%.</p>\n\n<p>In SQL in know I probably can't get the output as \"34%\" but at least I'd like it as 0.34 .  So far I have:</p>\n\n<pre><code>cast((sq.Completes/sq.Screens ) as float ) as 'conv'\n</code></pre>\n\n<p>Completes are the smaller of numbers(usually 27, 38, etc), and Screens are bigger numbers(124, 276, etc.)</p>\n\n<p>But this is outputting my column as all <code>0s</code> . How do I make it show 0.34 , 0.84, etc</p>\n"},{"tags":["sql-server","sql-server-2008","where-clause"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12936993,"title":"SQL Server and intermediate materialization?","body":"<p><em>After reading <a href=\"http://sqlblog.com/blogs/adam_machanic/archive/2006/10/03/exploring-the-secrets-of-intermediate-materialization.aspx\" rel=\"nofollow\">this interesting article</a> about intermediate materialization - I still have some questions.</em> </p>\n\n<p>I have this query : </p>\n\n<pre><code>SELECT    *\nFROM  ...\nWHERE       isnumeric(MyCol)=1  and ( CAST( MyCol AS int)&gt;1) \n</code></pre>\n\n<p>However, the where clause order is <strong>not</strong> deterministic.</p>\n\n<p>So I <em>might</em> get exception here.( if he first tries to cast <code>\"k1k1\"</code> )</p>\n\n<p>I assume this will solve the problem</p>\n\n<pre><code>SELECT MyCol \nFROM\n    (SELECT TOP 100 PERCENT foo From MyTable WHERE ISNUMERIC (MyCol ) &gt; 1 ORDER BY MyCol ) bar\nWHERE\n    CAST(MyCol AS int) &gt; 100\n</code></pre>\n\n<ul>\n<li>why does putting <code>top 100 + order</code> will change VS my regular query ?</li>\n</ul>\n\n<p>I read in the comments  : </p>\n\n<blockquote>\n  <p>(the \"intermediate\" result -- in other words, a result obtained during\n  the process, that will be used to calculate the final result) will be\n  physically stored (\"materialized\") in TempDB and used from there for\n  the remainder of the user, instead of being queried back from the base\n  tables.</p>\n</blockquote>\n\n<ul>\n<li>what difference does it makes if it is stored in tempDB or queried back from the base tables? it is the <strong>same data</strong> !</li>\n</ul>\n"},{"tags":["database","sql-server-2008","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12937301,"title":"SQL Server 2008 - DB monitoring requirement , what is the best way to do it","body":"<p>I have a monitoring requirement where I need to keep checking table data every hour and if it reaches certain counts higher then previous hour, I need to notify certain users. I also need to create some kind of user interface so that user can track counts according to day/weekly too .</p>\n\n<p>I am developer and don't know much about DB except basic use like writing stored procedure / creating table etc. and I searched on internet and found so many options but don't know what will be the best option to go through and if it will fulfill my purpose. </p>\n\n<p>First one is to use SQL Server Reporting Services Enterprise edition. I am not sure if there is a way to compare data from previous one, write logic in it and send email notification in this.</p>\n\n<p>Second one is to write trigger on table and write logic in stored procedure and fire this trigger with stored procedure logic if its possible. And trigger will send email. But then I need to create some kind of interface in application level .</p>\n\n<p>Can someone please help if there is any other better way to do this or what is the best approach in between these two.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12926957,"title":"Ambiguous column name error in order by clause","body":"<p>Why doesn't this query work?</p>\n\n<pre><code>SELECT ROW_NUMBER() OVER (\n        ORDER BY DocumentID\n        ) peta_rn\n    , d.DocumentID\n    , d.IsReEfiled\n    , d.IGroupID\n    , d.ITypeID\n    , d.RecordingDateTime\n    , dbo.GetLatestStatusDateTime(d.DocumentID) AS LatestStatusDatetime\n    , dbo.FnCanChangeDocumentStatus(d.DocumentStatusID, d.DocumentID) AS CanChangeStatus\n    , d.IDate\n    , d.InstrumentID\n    , d.DocumentStatusID\n    , ig.Abbreviation AS IGroupAbbreviation\n    , u.Username\n    , j.JDAbbreviation\n    , inf.DocumentName\n    , it.Abbreviation AS ITypeAbbreviation\n    , d.DocumentDate\n    , ds.Abbreviation AS DocumentStatusAbbreviation\n    , dbo.GetFlatDocumentName(d.DocumentID) AS FlatDocumentName\nFROM Documents d\nINNER JOIN IGroupes ig\n    ON d.IGroupID = ig.IGroupID\nLEFT JOIN ITypes it\n    ON d.ITypeID = it.ITypeID\nLEFT JOIN Users u\n    ON u.UserID = d.UserID\nLEFT JOIN DocumentStatuses ds\n    ON d.DocumentStatusID = ds.DocumentStatusID\nLEFT JOIN InstrumentFiles inf\n    ON d.DocumentID = inf.DocumentID\nINNER JOIN Jurisdictions j\n    ON j.JurisdictionID = d.JurisdictionID\nWHERE 1 = 1\n</code></pre>\n\n<p>whereas this one works:</p>\n\n<pre><code>SELECT ROW_NUMBER() OVER (\n        ORDER BY d.DocumentID\n        ) peta_rn\n    , d.DocumentID\n    , d.IsReEfiled\n    , d.IGroupID\n    , d.ITypeID\n    , d.RecordingDateTime\n    , dbo.GetLatestStatusDateTime(d.DocumentID) AS LatestStatusDatetime\n    , dbo.FnCanChangeDocumentStatus(d.DocumentStatusID, d.DocumentID) AS CanChangeStatus\n    , d.IDate\n    , d.InstrumentID\n    , d.DocumentStatusID\n    , ig.Abbreviation AS IGroupAbbreviation\n    , u.Username\n    , j.JDAbbreviation\n    , inf.DocumentName\n    , it.Abbreviation AS ITypeAbbreviation\n    , d.DocumentDate\n    , ds.Abbreviation AS DocumentStatusAbbreviation\n    , dbo.GetFlatDocumentName(d.DocumentID) AS FlatDocumentName\nFROM Documents d\nINNER JOIN IGroupes ig\n    ON d.IGroupID = ig.IGroupID\nLEFT JOIN ITypes it\n    ON d.ITypeID = it.ITypeID\nLEFT JOIN Users u\n    ON u.UserID = d.UserID\nLEFT JOIN DocumentStatuses ds\n    ON d.DocumentStatusID = ds.DocumentStatusID\nLEFT JOIN InstrumentFiles inf\n    ON d.DocumentID = inf.DocumentID\nINNER JOIN Jurisdictions j\n    ON j.JurisdictionID = d.JurisdictionID\nWHERE 1 = 1\n</code></pre>\n\n<p>As you can see the only difference is I specify d.DocumentID. Is there anyway I can avoid having to specify <code>d.DocumentID</code> and instead specify only <code>DocumentID</code> without using an extra Select?  because after all, all documentID refer to the same value.</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12934584,"title":"Error when creating stored procedure","body":"<p>I'm noob at stored procedures, I have created a stored procedure that take some parameters from C# page, then send back result as <code>OUTPUT</code> parameter.</p>\n\n<p>I need to do some calculation to get end date, so I end up using a lot of IF statements. However, when I create the stored procedure I get error that I didn't know how to solve, every thing seems correct!.</p>\n\n<p>Here is the stored procedure code:</p>\n\n<pre><code>    CREATE PROCEDURE sp_RenewSubscription \n        -- Add the parameters for the stored procedure here\n        @Reference nvarchar(100),\n        @SubscribtionID nvarchar(100),\n        @Months int,\n        @Result nvarchar(200) OUTPUT\n    AS\n\nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    DECLARE @EndDate as nvarchar;\n    DECLARE @MonthCounts as int;\n\n    IF NOT EXISTS(SELECT [Reference] FROM [Norton].[dbo].[SubscriptionStatus] WHERE [Reference] = @Reference)\n    SET @Result = '0: Reference ID not found'\n    ELSE\n    IF NOT EXISTS(SELECT [Reference] FROM [Norton].[dbo].[SubscriptionStatus] WHERE [Reference] = @Reference AND [SubscribtionID] = @SubscribtionID)\n    SET @Result = '0: Subscribtion ID not found'\n    ELSE\n    BEGIN \n        SELECT TOP 1 @EndDate = [EndDate], @MonthCounts = [SubscriptionMonthCount] FROM [Norton].[dbo].[SubscriptionStatus] WHERE [Reference] = @Reference AND [SubscribtionID] = @SubscribtionID\n        IF @EndDate = '0'\n        BEGIN \n        UPDATE [Norton].[dbo].[SubscriptionStatus]\n        SET [SubscriptionMonthCount] = @Months + @MonthCounts\n        WHERE [Reference] = @Reference AND [SubscribtionID] = @SubscribtionID\n        END\n        ELSE\n        BEGIN \n        UPDATE [Norton].[dbo].[SubscriptionStatus]\n        SET [SubscriptionMonthCount] = @Months\n        WHERE [Reference] = @Reference AND [SubscribtionID] = @SubscribtionID\n        END\n\n    SET @Result = '1: Done Successfully'\n    END\nGO\n\nEND\nGO\n</code></pre>\n\n<p>This is error I got:</p>\n\n<blockquote>\n  <p>Msg 102, Level 15, State 1, Procedure sp_RenewSubscription, Line 44<br>\n  Incorrect syntax near 'END'.<br>\n  Msg 102, Level 15, State 1, Line 2<br>\n  Incorrect syntax near 'END'.*</p>\n</blockquote>\n\n<p>Thanks,</p>\n"},{"tags":["sql-server-2008","ssis","tempdb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12933056,"title":"Tempdb filling up","body":"<p>The BI project I'm currently working on receives it's data from a complex processes based in SPs that use (too) many temp tables.  This is something we do not have control over (or I would've changed it).<br>\nOur part in this project is mainly based on SSIS.  </p>\n\n<p>The processes run fine but the tempdb fills up relatively fast and then we start getting errors.</p>\n\n<p>I'm looking for 2 things:</p>\n\n<ol>\n<li>How to prevent the tempdb from \"overflowing\" (or at least slow it down)?</li>\n<li>How to clean up the tempdb when it does overflow? (preferably using SSIS)</li>\n</ol>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12935500,"title":"How go group same kind rows in sql","body":"<p>I have a table like:</p>\n\n<pre><code>    Table1\n---------------------\nId |Kind1|Kind2|Kind3|\n---------------------\n1  |  2  |  2  |  3  | *\n---------------------\n2  |  2  |  2  |  2  | +\n---------------------\n3  |  2  |  2  |  1  |\n---------------------\n4  |  2  |  2  |  3  | *\n---------------------\n5  |  2  |  1  |  1  |\n---------------------\n6  |  1  |  1  |  1  |\n---------------------\n7  |  2  |  2  |  2  | +\n----------------------\n</code></pre>\n\n<p>And I want to get that result as shown below Id's have to generate automaticaly\nI have to get count of same row group</p>\n\n<pre><code>Result\n------------------------------\nId |  Count |New1 |New2 |New3 |\n------------------------------\n1  |    2   |  2  |  2  |  2  | \n------------------------------\n2  |    2   |  2  |  2  |  3  |\n------------------------------\n3  |    1   |  2  |  2  |  1  |\n------------------------------\n4  |    1   |  2  |  1  |  1  |\n------------------------------\n5  |    1   |  1  |  1  |  1  |\n------------------------------\n</code></pre>\n\n<p>How can I do that in sql server?</p>\n"},{"tags":["sql","sql-server-2008","reporting-services","ssrs-2008","sql-compare"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12923611,"title":"SQL Server 2008: If Multiple Values Set In Other Mutliple Values Set","body":"<p>In SQL, is there anyway to accomplish something like this? This is based off a report built in SQL Server Report Builder, where the user can specify multiple text values as a single report parameter. The query for the report grabs all of the values the user selected and stores them in a single variable. I need a way for the query to return only records that have associations to EVERY value the user specified.</p>\n\n<pre><code>-- Assume there's a table of Elements with thousands of entries.  \n-- Now we declare a list of properties for those Elements to be associated with.\n\ncreate table #masterTable (\n    ElementId int, Text varchar(10)\n)\n\ninsert into #masterTable (ElementId, Text) values (1, 'Red');\ninsert into #masterTable (ElementId, Text) values (1, 'Coarse');\ninsert into #masterTable (ElementId, Text) values (1, 'Dense');\ninsert into #masterTable (ElementId, Text) values (2, 'Red');\ninsert into #masterTable (ElementId, Text) values (2, 'Smooth');\ninsert into #masterTable (ElementId, Text) values (2, 'Hollow');\n\n-- Element 1 is Red, Coarse, and Dense.  Element 2 is Red, Smooth, and Hollow.  \n-- The real table is actually much much larger than this; this is just an example.\n\n-- This is me trying to replicate how SQL Server Report Builder treats \n-- report parameters in its queries.  The user selects one, some, all, \n-- or no properties from a list. The written query treats the user's   \n-- selections as a single variable called @Properties.\n-- Example scenario 1: User only wants to see Elements that are BOTH Red and Dense.\nselect e.* \nfrom Elements e \nwhere (@Properties) --ideally a set containing only Red and Dense\nin\n(select Text from #masterTable where ElementId = e.Id) --ideally a set containing only Red, Coarse, and Dense\n--Both Red and Dense are within Element 1's properties (Red, Coarse, Dense), so Element 1 gets returned, but not Element 2.\n\n-- Example scenario 2: User only wants to see Elements that are BOTH Red and Hollow.  \nselect e.* from Elements e where\n(@Properties) --ideally a set containing only Red and Hollow\nin\n(select Text from #masterTable where ElementId = e.Id)\n--Both Red and Hollow are within Element 2's properties (Red, Smooth, Hollow), so Element 2 gets returned, but not Element 1.\n\n\n--Example Scenario 3: User only picked the Red option.\nselect e.* from Elements e where\n(@Properties) --ideally a set containing only Red\nin\n(select Text from #masterTable where ElementId = e.Id)\n--Red is within both Element 1 and Element 2's properties, so both Element 1 and Element 2 get returned.\n</code></pre>\n\n<p>The above syntax doesn't actually work because SQL doesn't seem to allow multiple values on the left side of the \"in\" comparison.  Error that returns:</p>\n\n<pre><code>Subquery returned more than 1 value. This is not permitted when the subquery follows =, !=, &lt;, &lt;= , &gt;, &gt;= or when the subquery is used as an expression.\n</code></pre>\n\n<p>Am I even on the right track here?  Sorry if the example looks long-winded or confusing.</p>\n\n<p>Here's the exact code I'm working with:</p>\n\n<pre><code>select p.*\nfrom Products p\nwhere\n(\n    (\n        --user can search through gloves, bats, or both\n        p.TypeId = 2 and 'Bat' in (@ProductTypes) \n        and \n        (\n            (\n                (@BatProperties) COLLATE DATABASE_DEFAULT in \n                (\n                    select props.Name from PropertyTypes props\n                    inner join ProductProperties pp on props.Id = pp.TypeId\n                    where pp.ProductId = p.Id\n                )\n            --still want query to run when no properties are selected\n            ) or not exists(select * from @BatProperties)\n        )\n    )\n    or\n    (\n        p.TypeId = 1 and 'Glove' in (@ProductTypes) --user can search through gloves, bats, or both\n        and\n        (\n            (\n                (@GloveProperties) COLLATE DATABASE_DEFAULT in \n                (\n                    select props.Name from PropertyTypes props\n                    inner join ProductProperties pp on props.Id = pp.TypeId\n                    where pp.ProductId = p.Id\n                )\n            --still want query to run when no properties are selected\n            ) or not exists(select * from @GloveProperties)\n        )\n    )\n)\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2012-express"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":32,"score":2,"question_id":12933173,"title":"Moving database files created by SQL Server 2012 Express to SQL Standard 2008","body":"<p>I am planing to built database driven website with DotNetNuke and SQL Server Express 2012 on my laptop and than host it on web server that has SQL Server 2008 Standard edition. </p>\n\n<p>Is SQL Server 2008 compatible with database files created by Server 2012? </p>\n\n<p>Because I can install and build website using SQL Server 2008 Express Edition and upload to hosting provider server.</p>\n"},{"tags":["sql","sql-server-2008","query","sorting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12933514,"title":"Sorting table data issue","body":"<p>I've quite bulky data in a Database table and I want to sort the data based on their ID (Primary Key). The data in the key column could be:</p>\n\n<pre><code>001/2011,\n002/2011,\n001/2012\n</code></pre>\n\n<p>When I use '<code>order by id</code>' it sorts the rows like</p>\n\n<pre><code>001/2011,\n001/2012,\n002/2011\n</code></pre>\n\n<p>However, what I am looking for is </p>\n\n<pre><code>001/2011,\n002/2011,\n001/2012\n</code></pre>\n\n<p>The data type of the id column is <code>varchar(50)</code>. Is there a special SQL function that I should use to sort such type of data?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":9523413,"title":"Trigger nesting level exceeded?","body":"<p>When this trigger fires, which is contained in the below code block</p>\n\n<pre><code>alter TRIGGER [dbo].[locations_update_geometry_After]\nON  dbo.TBL_LOCATIONS   \nfor update   \nAS   \n  INSERT dbo.TBL_LOCATIONS(SHAPE, X_Coord, Y_Coord,objectid) \n  SELECT a.Shape, a.X_Coord, a.Y_Coord, a.objectid\n  FROM  \n  (  \n    SELECT  \n      SHAPE = CASE WHEN SHAPE IS NOT NULL   \n        THEN SHAPE ELSE Geometry::STPointFromText('POINT('  \n          + CAST(X_Coord AS VARCHAR(20)) + ' '   \n          + CAST(Y_Coord AS VARCHAR(20)) + ')', 26917) END,  \n      X_Coord = CASE WHEN SHAPE IS NULL THEN X_Coord ELSE SHAPE.STX END,  \n      Y_Coord = CASE WHEN SHAPE IS NULL THEN Y_Coord ELSE SHAPE.STY END,  \n      objectid  \n     FROM inserted  \n  ) AS a\n</code></pre>\n\n<p>I get the following error message:</p>\n\n<blockquote>\n  <p>Unable to save edits. Underlying DBMS error [Microsoft SQL Server\n  Native Client 10: Maximum stored procedure, function, trigger, or view\n  nesting level exceeded (limit 32).</p>\n</blockquote>\n\n<p>I do not have 32 of anything associated with this table. any ideas?</p>\n"},{"tags":["sql-server-2008","login-control"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3462,"score":4,"question_id":4085700,"title":"Restrict SQL Server Login access to only one database","body":"<p>I have a SQL Server server which has around 50 databases on it. I wish to create a new Login for a client who wishes to have access to their database. But I don't want to give them access to the other ~49 databases.</p>\n\n<p>How can I do this?</p>\n\n<p>Cheers.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12933108,"title":"Retrieving data by date ranges with breaks in SQL Server","body":"<p>I need to retrieve data by selected dates. There is one major detail: user can select two days one after another, and then it can skip some days, and then select another ones.</p>\n\n<p>What is the best way to pass selected dates into a stored procedure and organize filter by such date ranges?</p>\n\n<p>For example, I have the table with the following structure:</p>\n\n<pre><code>CREATE TABLE [dbo].[Events](\n    [ID] [int] IDENTITY(1,1) NOT NULL,\n    [EventDate] [datetime] NOT NULL,\n    [Amount] [float] NOT NULL,\n CONSTRAINT [PK_Events] PRIMARY KEY CLUSTERED \n(\n    [ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>With the following data:</p>\n\n<pre><code>INSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-01-01 10:00', 12)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-01-01 11:00', 154)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-01-01 12:00', 4)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-02-01 10:00', 132)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-02-01 11:00', 212)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-03-01 10:00', 712)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-03-01 20:00', 892)\n</code></pre>\n\n<p>User wants to retrieve data with Event Date from 2012-01-01 10:00 and 2012-01-01 11:00,\nfrom 2012-03-01 09:00 to 2012-03-01 19:00, etc.</p>\n\n<p>User can select different count of intervals.</p>\n"},{"tags":["sql-server-2008","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12933348,"title":"How to alter inserted row in sql server trigger","body":"<p>This gave an error </p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Procedure Trig_Insert_Serials_Null, Line 30<br>\n  Incorrect syntax near the keyword 'INSERT'.</p>\n</blockquote>\n\n<p>Table structure: </p>\n\n<pre><code>Serials (CurrencyId, DivisionId, BranchId, NewSerialNumber, Display, TypeId)\n</code></pre>\n\n<p>I want to change 0 to null in (<code>CurrencyId, DivisionId, BranchId</code>).  </p>\n\n<pre><code>CREATE TRIGGER Trig_Insert_Serials_Null\n   ON  Serials\n   INSTEAD OF INSERT   \nAS \nBEGIN\n\nDECLARE @currencyId int;\nDECLARE @branchId int;\nDECLARE @divisionId int;\n\nSELECT @currencyId = INSERTED.CurrenceyId FROM INSERTED;\nSELECT @branchId = INSERTED.BranchId FROM INSERTED;\nSELECT @divisionId = INSERTED.DivisionId FROM INSERTED;\n\nIF @currencyId = 0 \n    SET @currencyId = NULL;\nEND\n\nIF @branchId = 0 \n    SET @branchId = NULL;\nEND\n\nIF @divisionId = 0 \n    SET @divisionId = NULL;\nEND\n\n\nINSERT INTO Serials (CurrenceyId,DivisionId,BranchId,NewSerialNumber,\n                         Display, TypeId)\nVALUES (INSERTED.CurrenceyId,INSERTED.DivisionId, INSERTED.BranchId,\n         INSERTED.NewSerialNumber, INSERTED.Display,INSERTED.TypeId)\n\nEND\nGO\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2145,"score":1,"question_id":5025388,"title":"SQL problem with error \"Invalid data type\"","body":"<p>Using SQL 2008</p>\n\n<p>So I created a User Defined type:</p>\n\n<pre><code>CREATE TYPE dbo.ServiceType AS TABLE (\n[TO_ZONE] varchar(30) NOT NULL,\n[FROM_ZONE] varchar(30) NOT NULL,\n[RATE] decimal(14,2) NOT NULL,\n[SERVICE_TYPE] varchar(255) NOT NULL\n);\n</code></pre>\n\n<p>And when I try to use it I get the error \"parameter or variable @variableName has an invalid data type\"</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[ImportServiceTypeRates]\n\n(@ServiceTypes dbo.ServiceType)  --I have tried it without the \"dbo.\" as well\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>So I added \"READONLY\" to my variable declaration</p>\n\n<pre><code>@ServiceTypes dbo.ServiceType READONLY\n</code></pre>\n\n<p>And I now get the error \"The parameter @Servicetype cannot be declared READONLY because it is not a table-valued parameter\"  ?WHAT?  </p>\n\n<p>I thought the \"CREATE TYPE ServiceType as TABLE\" was what declared it such???</p>\n\n<p>I also have showing in Types\\User-Defined Table Types\\dbo.ServiceType</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":12931421,"title":"Find the closest number based on the weight of combination for two pairs","body":"<p>This is a continuation of my previous question <a href=\"http://stackoverflow.com/questions/12928718/what-is-the-efficient-way-to-generate-combination-of-items-in-sql-server\">What is the efficient way to generate combination of items in SQL Server?</a> Let me explain the real scenario as what I am looking for and why....</p>\n\n<p>Suppose I have a table as under</p>\n\n<pre><code>Declare @t table(Number Int)\nInsert Into @t Values(10),(20),(30),(40),(18)\n\nNumber\n10\n20\n30\n40\n18\n</code></pre>\n\n<p>and I need to look for a number say 35 (or closest).</p>\n\n<pre><code>Declare @NumberToLookfor = 35\n</code></pre>\n\n<p>Now the search will happen based on the weight of combination for two pairs. Let me explain.</p>\n\n<pre><code>10+20 = 30\n\n10+30 = 40\n\n10+40 = 50\n\n10+18 = 28\n\n20 + 30 = 50\n\n20 + 40 = 60\n\n20 + 18 = 38\n\n30 + 40 = 70\n\n30 + 18 = 48\n\n40 + 18 = 58\n</code></pre>\n\n<p>so we can figure out that the weight of any two numbers are teh candidates here e.g. (10,20), (10,30)...(40,18)</p>\n\n<p>Once we get that, the first 3 closest pairs will be (20,18), (10,20) , (10,30) in this case. Because teh dirtance between 35 and 38 (20+18) is 3 whichle it is 5 for the other pairs  (10,20) , (10,30).</p>\n\n<p>I think that the explanation is clear to understand what I am looking for.(If not please let me know)</p>\n\n<p>What is the most efficient way of doing so?</p>\n\n<p>My attempt</p>\n\n<pre><code>Declare @t table(Number Int)\nInsert Into @t Values(10),(20),(30),(40),(18)\n\n;WITH Cte1 (Number,Ids,TotalWeight) AS \n( \n    SELECT  Number           \n            , ',' + CAST(Number AS VARCHAR(MAX)) \n            ,CAST(Number AS INT) \n    FROM @t \n    UNION ALL \n    SELECT  p.Number \n            ,c.Ids + ',' +  CAST(p.Number AS VARCHAR(MAX)) \n            ,CAST(c.TotalWeight + p.Number AS INT)            \n    FROM @t AS p JOIN Cte1 c ON p.Number &lt; c.Number\n),Cte2 AS( \n    SELECT          \n        *\n        ,DENSE_RANK() OVER(ORDER BY ABS(TotalWeight - 35)) [rank] \n    FROM Cte1 \n    WHERE (LEN(Ids) - LEN(REPLACE(Ids, ',', '')))/LEN(',') = 2 \n)\n\nselect *\nfrom Cte2 where [rank] &lt;= 2\n</code></pre>\n\n<p>It works.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SIrU6.png\" alt=\"enter image description here\"></p>\n\n<p>But if the values grows very big say more than 50 or so, then it becomes very very in efficient. Because in the first CTE , I am finding out the full permutation and in the second Cte choosing those values where only two elements participated.</p>\n\n<p>so when the value grows big, the first Cte behaves very very slowly.</p>\n\n<p>Is there any other way of doing so even for big tables.</p>\n\n<p>DDL provided</p>\n\n<pre><code>Declare @t table(Number Int)\nInsert Into @t Values  \n(1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18),(19),(20), \n(21),(22),(23),(24),(25),(26),(27),(28),(29),(30),(31),(32),(33),(34),(35),(36),(37),(38),(39),(40), \n(41),(42),(43),(44),(45),(46),(47),(48),(49),(50),(51),(52),(53),(54),(55),(56),(57),(58),(59),(60), \n(61),(62),(63),(64),(65),(66),(67),(68),(69),(70),(71),(72),(73),(74),(75),(76),(77),(78),(79),(80), \n(81),(82),(83),(84),(85),(86),(87),(88),(89),(90),(91),(92),(93),(94),(95),(96),(97),(98),(99),(100) \n</code></pre>\n\n<p>Many thanks in advance</p>\n"},{"tags":["sql","sql-server-2008","distinct"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12931399,"title":"Select distinct on one column","body":"<p>Here is my query:</p>\n\n<pre><code>SELECT DISTINCT TOP 500 \nbk.firstname,\nbk.surname,\nbk.email,\ncounty.region_id,\ninspection.inspection_date\n\nFROM\nbken bk\nLEFT OUTER JOIN county\n  ON bk.county = county.code\nLEFT OUTER JOIN inspection\n  ON bk.inspid = inspection.inspid\n\nWHERE\nbk.firstname IS NOT NULL\nAND bk.surname IS NOT NULL\nAND bk.email IS NOT NULL\nAND county.region_id IS NOT NULL\nAND  county.region_id &lt;&gt; 10  \nAND inspection_date &gt; '04/01/2012 00:00:00.000'\nAND inspection_date &lt; '10/01/2012 00:00:00.000'\n</code></pre>\n\n<p>My goal is to obtain a sample of 500 different people.</p>\n\n<p>Unfortunately this returns duplicate names (though the inspection dates are different) so I am trying to select distinct surnames to see if this will fix my problem. Can anyone help me do this? </p>\n\n<p>I'm using Microsoft SQL Server 2008.</p>\n"},{"tags":["asp.net","sql-server-2008","select","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":29,"score":-1,"question_id":12931107,"title":"Select query to fetch configurations value in reporting services and database engine services","body":"<p>In Reporting Services </p>\n\n<p>I need a select query to fetch the values of </p>\n\n<p>\"Web service requests and HTTP access\",\n\"Scheduled events and report delivery\",\n\"Windows Integrated Security\".</p>\n\n<hr>\n\n<p>In Database Engine services\nand  i need to fetch the value of \n\"Native XML Web services\".</p>\n"},{"tags":["c#",".net","sql-server-2008","datetime","asp.net-mvc-4"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12930418,"title":"Datetime field automatically converted to local (Can't Edit)","body":"<p>I'm trying to use <a href=\"http://www.asp.net/mvc/tutorials/mvc-4/getting-started-with-aspnet-mvc4/examining-the-edit-methods-and-edit-view\" rel=\"nofollow\">this tutorial</a> to learn a bit more about MvC4 but I'm having some problems with that <code>Datetime</code> field.</p>\n\n<p><strong>First Problem</strong>:<br>\nWhen I try to create an entry with a <code>datetime</code> in this format: <code>DD/MM/YYYY</code> (e.g. <code>20/06/2012</code>), I get an error: </p>\n\n<blockquote>\n  <p><em>The field ReleaseDate must be a date</em></p>\n</blockquote>\n\n<p>So I'm guessing it needs to be in this format (which is default in general): <code>MM/DD/YYYY</code> (e.g. <code>06/20/2012</code>). </p>\n\n<p>When I use the second format, I get a message:  </p>\n\n<blockquote>\n  <p><em>The value '06/20/2012' is not valid for ReleaseDate.</em></p>\n</blockquote>\n\n<p>The only way I can get it to work is when I enter both month and day &lt;= 12. e.g. <code>12/12/2012</code>.</p>\n\n<p><strong>Second Problem</strong>:<br>\nThis one is about the time. Let's say I enter <code>12/12/2012</code> and I get to successfully create an entry. By default it chooses <code>12:00:00 pm</code> as timestamp. The thing is that instead of pm it enters μμ (which is pm in Greek since clock in my pc is in Greek)</p>\n\n<p>When I try to edit the entry I get an error because of that. If I change μμ to pm it accepts it. But its weird and kinda annoying to get an error from a valid entry without changing anything.</p>\n\n<p><strong>Third Problem (Bonus)</strong>:<br>\nI have a field that is a number. I enter for example <code>199</code> and it accepts it. But in my list it shows it as <code>199,00</code>. When I try to edit again and I click save, I get this error: </p>\n\n<blockquote>\n  <p><em>The field Price must be a number.</em></p>\n</blockquote>\n\n<p>If I delete the comma and the 00 it accepts it again..</p>\n\n<p>As you can see its a very problematic table :) Any answers helping me out in any of my problems would be more than welcome. </p>\n\n<p>Ideally I would like the datetime in this format: <code>DD/MM/YYYY hh:mm:ss</code> (without pm and am 24 hours)</p>\n\n<p>But I will be happy for now if I can at least edit and save without the errors :)</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12930547,"title":"Migration of japanese data to Oracle","body":"<p>I am into data migration team, right now we got a project of Japanese database migration. We need to migrate all japanese data to our Oracle database. After which we need to compare Japanese data between source and target database. I just want to know is it possible to write normal SQL queries for Japanese data in SQL server, will it work and What are the risks associated with this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12929302,"title":"Any way to speed up this CTE?","body":"<p>This query is taking 5 seconds:</p>\n\n<pre><code>With cte as \n(\n    Select  ROW_NUMBER() OVER (Order By dbo.GetLatestStatusDateTime(d.DocumentID)) peta_rn, d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime,\n        d.IDate, d.InstrumentID, d.DocumentStatusID, u.Username, j.JDAbbreviation, inf.DocumentName,  dbo.GetLatestStatusDateTime(d.DocumentID) as LatestStatusDatetime,\n        it.Abbreviation as ITypeAbbreviation, d.DocumentDate, ds.Abbreviation as DocumentStatusAbbreviation \n                From Documents d Left Join IGroupes ig On d.IGroupID = ig.IGroupID \n                Left Join ITypes it On d.ITypeID = it.ITypeID \n                Left Join Users u On u.UserID = d.UserID \n                Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID \n                Left Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID Where 1 = 1  And d.JurisdictionID = 1\n)\nSelect  * from cte\n                Where 1 = 1 \n                And peta_rn&gt;92000 AND peta_rn&lt;=92100\n</code></pre>\n\n<p>Though this is a static query, it will be dynamic in the sense that <code>Order By</code> in <code>Row_Number()</code> would be based on what user selects. Eg. currently it is <code>dbo.GetLatestStatusDateTime(d.DocumentID)</code> but it can be anything else too. Hence this query would be generated in code using if and then. Anyways, can you spot any mistake in my query? Why would it take 5 seconds for mere 100 records? I have seen SQL server scale upto millions of records and this is just 1/10th of million and I am suffering from bottleneck :(</p>\n\n<p><strong>Edit: Massive improvement</strong></p>\n\n<p>Changing the query to this:</p>\n\n<pre><code>With cte as \n(\n\n        Select  ROW_NUMBER() OVER (Order By d.DocumentID) peta_rn, d.DocumentID\n                From Documents d Left Join IGroupes ig On d.IGroupID = ig.IGroupID \n                Left Join ITypes it On d.ITypeID = it.ITypeID \n                Left Join Users u On u.UserID = d.UserID \n                Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID \n                Left Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID Where 1 = 1  And d.JurisdictionID = 1\n)\nSelect  d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime,\n        d.IDate, d.InstrumentID, d.DocumentStatusID, u.Username, j.JDAbbreviation, inf.DocumentName, \n        it.Abbreviation as ITypeAbbreviation, d.DocumentDate, ds.Abbreviation as DocumentStatusAbbreviation \n                From Documents d Left Join IGroupes ig On d.IGroupID = ig.IGroupID \n                Left Join ITypes it On d.ITypeID = it.ITypeID \n                Left Join Users u On u.UserID = d.UserID \n                Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID \n                Left Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID\n                Inner Join cte On cte.DocumentID = d.DocumentID\n                And peta_rn&gt;92000 AND peta_rn&lt;=92100\n</code></pre>\n\n<p>executes the query in 1 second. But I still feel 1 second is too big just for 100 records. Any other optimizations please?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12928157,"title":"SQL query taking more than 3 minutes to get only 100 records","body":"<p>Can anybody please tell why would this query take minutes to execute?</p>\n\n<pre><code>Select  \n   d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime, \n   d.IDate, d.InstrumentID, d.DocumentStatusID,ig.Abbreviation as IGroupAbbreviation, \n   u.Username, j.JDAbbreviation, inf.DocumentName,\n   it.Abbreviation as ITypeAbbreviation, d.DocumentDate, \n   ds.Abbreviation as DocumentStatusAbbreviation \nFrom Documents d \nInner Join IGroupes ig On d.IGroupID = ig.IGroupID \nLeft Join ITypes it On d.ITypeID = it.ITypeID \nLeft Join Users u On u.UserID = d.UserID \nLeft Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \nLeft Join InstrumentFiles inf On d.DocumentID = inf.DocumentID                         \nInner Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID \nWhere \n    d.DocumentID IN\n      (SELECT DocumentID \n       FROM (SELECT ROW_NUMBER() OVER (Order By DocumentID desc) peta_rn, peta_query.* \n             From (Select d.DocumentID\n                   From Documents d) as peta_query) peta_paged \n       WHERE peta_rn &gt; 92000 AND peta_rn &lt;= 92100)\n</code></pre>\n\n<p>The subquery:</p>\n\n<pre><code>SELECT DocumentID \nFROM (SELECT \n         ROW_NUMBER() OVER (Order By DocumentID desc) peta_rn, peta_query.* \n      FROM\n         (SELECT d.DocumentID\n          FROM Documents d) as peta_query) peta_paged \nWHERE peta_rn &gt; 92000 AND peta_rn &lt;= 92100\n</code></pre>\n\n<p>itself takes 0 seconds but the whole query takes minutes and I don't even have that many Joins. It's hardly 6-7 joins which shouldn't create so much problems in my opinion as these all foreign keys have indexes on them. Can anybody suggest what could be the problem?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>This is awesome. See this query which executes in 0 seconds:</p>\n\n<pre><code>Select  d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime, \n        d.IDate, d.InstrumentID, d.DocumentStatusID, u.Username, j.JDAbbreviation, inf.DocumentName,\n        it.Abbreviation as ITypeAbbreviation, d.DocumentDate, ds.Abbreviation as DocumentStatusAbbreviation \n            From Documents d \n                Inner Join IGroupes ig On d.IGroupID = ig.IGroupID \n                Left Join ITypes it On d.ITypeID = it.ITypeID \n                Left Join Users u On u.UserID = d.UserID  \n                Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID                         \n                Inner Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID \n                    Where d.DocumentID IN\n                        (\n                            SELECT DocumentID FROM (SELECT \n                                ROW_NUMBER() OVER (Order By DocumentID desc) peta_rn, peta_query.* From \n                                (\n                                        Select   d.DocumentID\n                                                From Documents d \n\n                                ) as peta_query) peta_paged WHERE peta_rn&gt;92000 AND peta_rn&lt;=92100\n                        )\n</code></pre>\n\n<p>As you can see it just removes <code>ig.Abbreviation IGroupAbbreviation,</code> from the query. As soon as I put <code>ig.Abbreviation IGroupAbbreviation,</code> it starts taking minutes. Isn't this the heights of ridiculousness? What do you think would cause this?</p>\n\n<p><strong>Edit 2:</strong></p>\n\n<p>Some more weirdness. Changing <code>Inner Join IGroupes ig</code>  to <code>Left Join  IGroupes ig</code> executes the query in 0 seconds. Can you please suggest why would Inner Join take up minutes? Is this my problem is this some bug in SQL server? Only thing left now is to bang my head against wall. I have wasted more than 4 hours.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":27,"score":-1,"question_id":12929521,"title":"Return Distinct row in resultset in sql server 2008","body":"<p>How to select the distinct row if the particular column have same record multiple times in sql server 2008 and order by datetime.\nI have following column in table:</p>\n\n<ol>\n<li>id</li>\n<li>username</li>\n<li>fileid</li>\n<li>datetime</li>\n</ol>\n\n<p>I have try using following sql:</p>\n\n<pre><code>SELECT DISTINCT(fileid) FROM [DatabaseName].[dbo].[TableName] where usernumber = '015578957'\n</code></pre>\n\n<p>How can I select other column in above sql and order by datetime column and also return result set row where fileid column is distinct.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","date"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12928274,"title":"count records based on group of interval(days) on date column","body":"<p><strong>count data between intervals,interval depends on how much older the record</strong></p>\n\n<p>I have a table called <code>complaint</code> in which I have many columns with <code>ComplaintDate</code>,I want to show <strong>count of records depends on interval</strong>.</p>\n\n<p>Following interval will be used to categorized records:</p>\n\n<ol>\n<li>number of compalaint which is 10 days older.</li>\n<li>number of compalaint which is 10-20 days older.</li>\n<li>number of compalaint which is 20-30 days older.</li>\n<li>number of compalaint which is more than 30 days older.</li>\n</ol>\n\n<p>I have tried something like this </p>\n\n<pre><code>select SUM(CASE WHEN ComplaintDate BETWEEN DATEADD (dd,-10,getdate())AND   GETDATE()  THEN 1 ELSE 0 END) As '0-10',\n       SUM(CASE WHEN ComplaintDate BETWEEN  DATEADD (dd,-20,getdate()) AND DATEADD (dd,-10,getdate()) THEN 1 ELSE 0 END) AS '10-20',\n       SUM(CASE WHEN ComplaintDate BETWEEN DATEADD (dd,-30,getdate()) AND DATEADD (dd,-20,getdate()) THEN 1 ELSE 0 END) AS '20-30'       \n FROM Complaint \n</code></pre>\n\n<p><strong>also i want that day included in 0-10 days interval should not be count in 10-20 or 20-30 days interval and same should apply for other other intervals as well .</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","cursor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12929083,"title":"How do I use a simple query to search a list of data from a table and return non-duplicate results in a table?","body":"<p>I am trying to loop through the data in a table, and using the data to search to return the results in another table. </p>\n\n<p>How do I prevent duplicates from adding to the table? Note that the order of the query results adding are very important. So if the results are alr added, I don't want them to be added again. Note that the original ranking done by the full search category is misleading, I don't want to use that.</p>\n\n<p>I am using cursor, but I was told it can be solved using simple query, how do I do that? </p>\n\n<p>Below is the code.</p>\n\n<pre><code> ...\n\n    DECLARE @subQ NVARCHAR(200)\n    SET @subQ = ''\n\n    DECLARE cur1 CURSOR FOR\n    SELECT combination FROM @Subqueries\n\n    OPEN cur1\n    FETCH NEXT FROM cur1 INTO @subQ\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        INSERT INTO @Results (app_id, rank, importance)\n        SELECT app_id, rank, 1\n        FROM CONTAINSTABLE(dbo.Applications, display_name, @subQ) KEY_TBL\n        INNER JOIN Applications App\n        ON KEY_TBL.[KEY] = App.app_id\n\n        FETCH NEXT FROM cur1 INTO @subQ   \n    END   \n\n    CLOSE cur1\n    DEALLOCATE cur1\n\n    ...\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","pivot","transpose"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":12696225,"title":"SQL: Real Transpose","body":"<p>I know about pivot and unpivot. That is not what I want. Pivot and unpivot aggregate data, but that is not what I want. </p>\n\n<p>Think of a table as a matrix (linear algebra). If I start with an m x n matrix, I want to convert that matrix (table) into an n x m matrix. I want a true <a href=\"http://en.wikipedia.org/wiki/Transpose\" rel=\"nofollow\">TRANSPOSE</a>.</p>\n\n<p>How can I do this in SQL?</p>\n\n<p>For example if I have:</p>\n\n<pre><code>1  2  3\n1  2  4\n6  7  8\n3  2  1\n3  9  1\n</code></pre>\n\n<p>then the result should be:</p>\n\n<pre><code>1  1  6  3  3\n2  2  7  2  9\n3  4  8  1  1\n</code></pre>\n\n<p>Notice that the number of rows becomes the number of columns, and vice versa. Also notice that I have not grouped or aggregated any of the data. Every single value present in the source is present in the result, and their x-y coordinates have been swapped.</p>\n"},{"tags":["java","spring","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12928528,"title":"code working with sa account but not with other","body":"<p>I have a jdbc properties file with </p>\n\n<pre><code>database.username=mfuser\ndatabase.password=mfuser\n</code></pre>\n\n<p>If I changed this to user/pass --> sa/pass then my web application works perfectly but with mfuser it does. I have create a user in SQL Server Security with name mfsuer and password mfuser but it still not working....</p>\n\n<p>How I need to create the user <code>mfuser</code> so that it works? Any special privileges I need to provide for this user? I want it same like <code>sa</code></p>\n\n<p>Here is the error I am getting with mfuser</p>\n\n<pre><code>org.springframework.dao.PermissionDeniedDataAccessException: PreparedStatementCallback; SQL [select lm.login_id,lm.login_name,lm.login_password,lm.full_name, lm.email_address,lm.phone,lm.notes,lm.delete_status,lm.create_date,lm.create_by,lm.modify_date,lm.modify_by FROM Login_Master lm where lm.login_id=(select lm1.login_id from Login_master lm1 where lm1.login_name=? and lm1.login_password =?) ]; The SELECT permission was denied on the object 'Login_Master', database 'MCData', schema 'dbo'.; nested exception is java.sql.SQLException: The SELECT permission was denied on the object 'Login_Master', database 'MCData', schema 'dbo'.\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1137,"score":1,"question_id":5964693,"title":"How do I raise an error that SQL will see as a job failure?","body":"<p>I've got a job scheduled through the SQL Server Agent that runs a sproc which runs some other sprocs. Every sproc looks like this:</p>\n\n<pre><code>BEGIN TRY\n    -- do stuff\nEND TRY\nBEGIN CATCH\n    DECLARE @errorMessage varchar(4000)\n    DECLARE @procName varchar(255)\n    SELECT @errorMessage = error_message()\n    SELECT @procName = OBJECT_NAME(@@PROCID)\n\n    RAISERROR('%s threw an exception: %s', 16, 1, @procName, @errorMessage)\nEND CATCH\n</code></pre>\n\n<p>This all works fine - errors are raised and thrown up the stack, life is good. However, my RAISERROR calls don't appear to cause the job to fail - I'm set to receive an e-mail notification \"When the job fails,\" but never receive one. E-mail notifications are working, as I will get emails if I change the notification to \"when the job succeeds\". Is there some other function I should be using here in place of RAISERROR?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12926836,"title":"Query with row_number() taking too much time","body":"<p>I have around 90k records in my DB and I run this query:</p>\n\n<p>It takes too much time (around 4 seconds):</p>\n\n<pre><code>SELECT * FROM (SELECT \n    ROW_NUMBER() OVER (Order By DocumentID desc) peta_rn, peta_query.* From \n    (\n            Select   d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime, dbo.GetLatestStatusDateTime(d.DocumentID) as LatestStatusDatetime, \n                    dbo.FnCanChangeDocumentStatus(d.DocumentStatusID,d.DocumentID) as CanChangeStatus, d.IDate, d.InstrumentID, d.DocumentStatusID,ig.Abbreviation as IGroupAbbreviation, \n                    u.Username, j.JDAbbreviation, inf.DocumentName,\n                    it.Abbreviation as ITypeAbbreviation, d.DocumentDate, ds.Abbreviation as DocumentStatusAbbreviation,\n                    dbo.GetFlatDocumentName(d.DocumentID) as FlatDocumentName \n                    From Documents d Inner Join IGroupes ig On d.IGroupID = ig.IGroupID \n                            Left Join ITypes it On d.ITypeID = it.ITypeID \n                            Left Join Users u On u.UserID = d.UserID \n                            Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                            Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID \n                            Inner Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID                           \n    ) as peta_query) peta_paged WHERE peta_rn&gt;12000 AND peta_rn&lt;=12100\n</code></pre>\n\n<p>However this 2nd query executes in 1 second:</p>\n\n<pre><code>SELECT * FROM (SELECT \n    peta_query.* From \n    (\n            Select  ROW_NUMBER() OVER (Order By d.DocumentID desc) peta_rn, d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime, dbo.GetLatestStatusDateTime(d.DocumentID) as LatestStatusDatetime, \n                    dbo.FnCanChangeDocumentStatus(d.DocumentStatusID,d.DocumentID) as CanChangeStatus, d.IDate, d.InstrumentID, d.DocumentStatusID,ig.Abbreviation as IGroupAbbreviation, \n                    u.Username, j.JDAbbreviation, inf.DocumentName,\n                    it.Abbreviation as ITypeAbbreviation, d.DocumentDate, ds.Abbreviation as DocumentStatusAbbreviation,\n                    dbo.GetFlatDocumentName(d.DocumentID) as FlatDocumentName \n                    From Documents d Inner Join IGroupes ig On d.IGroupID = ig.IGroupID \n                            Left Join ITypes it On d.ITypeID = it.ITypeID \n                            Left Join Users u On u.UserID = d.UserID \n                            Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                            Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID \n                            Inner Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID                           \n    ) as peta_query) peta_paged WHERE peta_rn&gt;12000 AND peta_rn&lt;=12100\n</code></pre>\n\n<p>My questions are:</p>\n\n<p><strong>1)</strong> Can you please suggest why would my 1st query take so long to execute? I want to optimize my 1st query because it is generated by one of the automated program (whose source I do have but I can't move the RowNumber inside Select).</p>\n\n<p><strong>2)</strong> The time to execute this is also dependent on the peta_rn. If I give peta_rn > 50000 and peta_rn &lt;= 50100, it takes hopeless amount of time to execute. Can you please also suggest why would the time to execute depend upon the row that I am trying to fetch since ultimately I am only trying to fetch 100 rows at a time.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12921984,"title":"database engine tuning wizard \"apply recommendations\" is disabled","body":"<p>I just forced the database engine tuning wizard in ssms 2008 to analyze a 5mb trace.</p>\n\n<p>I got a list of recommendations returned to me, in terms of indexes to implement; however, I am unable to apply the recommendations because it is greyed out:</p>\n\n<p><img src=\"http://i.stack.imgur.com/7ukPl.png\" alt=\"enter image description here\"></p>\n\n<p>Does anyone know whether this is a bug? How would I manually implement the changes?</p>\n\n<p>Thank you so much for your guidance.</p>\n"},{"tags":["c#","winforms","sql-server-2008","combobox","sqldataadapter"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12925589,"title":"How to find the index - in DATABASE table - of selected item in connected ComboBox","body":"<p>Finding the selected item <em>string</em> in a combo box is easy:</p>\n\n<pre><code>String selectedString = comboBox1.SelectedItem.ToString();\n</code></pre>\n\n<p>Finding the selected item <em>index</em> in a combo box is also easy:</p>\n\n<pre><code>int selectedIndex = comboBox1.SelectedIndex; \n</code></pre>\n\n<p>But finding the index <strong>in a connected database table</strong> of the selected item in the combo box doesn't seem so trivial:</p>\n\n<pre><code>    DataTable dt = new DataTable();\n    SqlDataAdapter da = new SqlDataAdapter(\"SELECT * FROM tblContacts ORDER BY colFirstname\", sqlConnection);\n    da.Fill(dt);\n    for (int i = 0; i &lt; dt.Rows.Count; i++)\n    {\n        String addressRow = (String)dt.Rows[i][\"colFirstname\"];\n        comboBox1.Items.Add(addressRow);\n    }\n</code></pre>\n\n<p>I could try to somehow derive an index to the DB table from the selected item string, but that doesn't guarantee uniqueness.</p>\n\n<p>What is the proper way of finding the index <strong>in a connected database table</strong> of the selected item in the combo box?</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":23627,"score":1,"question_id":5626344,"title":"How to remove a column from an existing table?","body":"<p>How to remove a column from an existing table?</p>\n\n<p>I have a table <code>MEN</code> with <code>Fname</code> and <code>Lname</code></p>\n\n<p>I need to remove the <code>Lname</code></p>\n\n<p>How to do it?</p>\n"},{"tags":["c#","performance","entity-framework","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":1283,"score":8,"question_id":4355474,"title":"How do I speed up DbSet.Add()?","body":"<p>I have to import about 30k rows from a CSV file to my SQL database, this sadly takes 20 minutes.</p>\n\n<p>Troubleshooting with a profiler shows me that <strong>DbSet.Add is taking the most time, but why?</strong></p>\n\n<p>I have these Entity Framework Code-First classes:</p>\n\n<pre><code>public class Article\n{\n    // About 20 properties, each property doesn't store excessive amounts of data\n}\n\npublic class Database : DbContext\n{\n    public DbSet&lt;Article&gt; Articles { get; set; }\n}\n</code></pre>\n\n<p>For each item in my for loop I do:</p>\n\n<pre><code>db.Articles.Add(article);\n</code></pre>\n\n<p>Outside the for loop I do:</p>\n\n<pre><code>db.SaveChanges();\n</code></pre>\n\n<p>It's connected with my local SQLExpress server,   but I guess there isn't anything written till SaveChanges is being called so I guess the server won't be the problem....</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12877303,"title":"Prioritize the records in a table","body":"<p>I have a table which has id and statement columns, statement column contains statement like insert into tablename, update tablename, delete tablename (tablename might be any xxx), I have a scenario where I need to write a stored procedure, if I run SP it should get the insert records in statement column first with parent tablenames first and then child table insert into statement and after inserts update statement should come in any fashion and at last delete statement with child table statement first and then parent. </p>\n\n<p>Output should be like </p>\n\n<pre><code>statements\nINSERT INTO country(parent to state)\nINSERT INTO state(parent to city)\nINSERT INTO city(parent to zipcode)\nINSERT INTO zipcode\n</code></pre>\n"},{"tags":["sql-server-2008","crystal-reports","case","statement"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12921156,"title":"How do SQL sServer and Crystal Reports link together for case...then 0?","body":"<p>I'm new to CR &amp; SQL Server. I'm trying to understand how you can code a select case statement with \"case some-condition then 0\" and \"case some-other-condition then 1\" and have it connect in Crystal reports....if I want a particular year of data to show, how do I use this particular style of case statement in the SQL Server coding and how do I get it to connect to variable names in CR?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12899838,"title":"sql query to find difference in two fields","body":"<p>I have a sql server 2008 db  and focussed on two specific columns in a table of over 300 million records. I wanted to find duplicate records which the table has but disinguish from this result set how many and if any of the duplicates have a different field 2.\neg.</p>\n\n<p>field 1:   idUrl\nfield 2:   assignedId</p>\n\n<p>so for duplicates of course:</p>\n\n<pre><code>SELECT [idUrl]\n       ,[assignedId]\nFROM [Feeds].[dbo].[LogFeed]\ngroup by idUrl, assignedId\nhaving COUNT(entryId) &gt; 1\norder by entryid desc\n</code></pre>\n\n<p>So I want to find records where for any duplicates of idUrl are there any records where assignedId is not the same for the duplicate idUrls.</p>\n\n<p>eg</p>\n\n<pre><code> idUrl            assignedID\n www.google.com       10\n www.google.com       10\n www.google.com       10\n www.google.com        7\n</code></pre>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":117,"score":0,"question_id":12914959,"title":"Cannot bulk load because the file could not be opened. Operating system error code 21(The device is not ready.)","body":"<p>Cannot bulk load because the file could not be opened. Operating system error code 21(The device is not ready.).</p>\n\n<p>Hi All, </p>\n\n<p>I am a newbie to Image Upload in MS SQL Server using ASP.NET. its cool to upload a image in a query from the same machine as the server but when from a remote machine ASP.NET web application to MS SQL Server, I am getting the above mentioned error. </p>\n\n<p>I don't understand what needs to be done, i have seen several threads and forums but i am not able to understand, can you please help me out on the same. I am looking for some descriptive steps to fix this issue.</p>\n\n<pre><code>Session[\"FileName\"] equals some d drive file\n</code></pre>\n\n<p><strong>Query I use:</strong></p>\n\n<pre><code>command.CommandText = \"UPDATE user_info \"\n                                + \"SET User_Image = (SELECT * FROM Openrowset(Bulk '\" + Session[\"FileName\"] + \"', Single_Blob) AS User_Image) \"\n                                + \"WHERE id =\" + \"22222\";\n</code></pre>\n\n<ul>\n<li><p><strong>I use SQL Authentication</strong></p></li>\n<li><p><strong>I have enabled both named pipes + TCP/IP</strong></p></li>\n<li><p>if <strong>EXECUTE AS</strong> is to be used, can someone explain the query. Is there any setting that need to be enabled. I am desperate :(</p></li>\n</ul>\n\n<p>Thanks in advance !</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12924034,"title":"tsql dynamic sql best approach","body":"<p>The dynamica query I have below works but wondering if what I have below can be optimized or if there is a better way of doing it.</p>\n\n<p>I have a web form where the user enters a location and Date Collected. For the date collected, I have a From Date Collected and To Date Collected. The user an leave the To date collected blank in which case it will do anything greater than the From Date Collected.  </p>\n\n<p>Note how I am doing the IS NOT NULL and 1=1 below.  Also wondering if a dynamic SQL is the best approach or if there is a simpler way of doing this.</p>\n\n<pre><code>    DECLARE @sql varchar(max);\n\n    SET @sql = 'SELECT * from tblProgram WHERE 1=1' \n\n    IF (@Location IS NOT  NULL)\n    BEGIN\n      SET @sql = @sql + ' AND Location = ' +  @Location\n    END      \n\n    IF (@FromDateCollected IS NOT  NULL AND @ToDateCollected IS NOT NULL)\n    BEGIN\n         SET @sql = @sql + ' AND pw.DateCollected &gt;= ' +  QUOTENAME(convert(varchar, @FromDateCollected,101),'''') \n         + ' AND pw.DateCollected &lt;= ' + QUOTENAME(convert(varchar, @ToDateCollected,101),'''')\n\n    END\n    ELSE IF (@FromDateCollected IS NOT  NULL AND @ToDateCollected IS  NULL)\n    BEGIN\n      SET @sql = @sql + ' AND pw.DateCollected &gt;= ' +  QUOTENAME(convert(varchar, @FromDateCollected,101),'''') \n\n    END \n\n   exec(@sql)\n</code></pre>\n"},{"tags":["sql-server-2008","excel","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12908305,"title":"How to properly align the xls to bind the table data using a stored procedure in SQL Server 2008?","body":"<p>I wrote the stored procedure like this</p>\n\n<pre><code>CREATE Procedure [dbo].[usp_GetTrackAgencyCountReport_Job]\nAS\n   Declare @BodyMessage Varchar(1000),\n        @ToEmail Varchar(254),\n        @sql Varchar(max),\n        @Count int,\n        @intFlag INT,\n        @Agent varchar(200),\n        @From datetime,\n        @To datetime,\n        @DbName varchar(100)\n\n        SET @BodyMessage='Please find attached list of Agency names, for how many accounts rated, how many accounts submitted and how many accounts approved to QMS. '\n        Select @ToEmail='hemanth@zeninfotech.com;'\n        --Select @ToEmail='cpeterson@chris-leef.com; gpeterson@chris-leef.com; info@chris-leef.com'\n        SET @To= (SELECT DATEADD(day, DATEDIFF(day, 0, GETDATE()), 0))\n        SET @From=(SELECT DATEADD(day, DATEDIFF(day, 0, GETDATE()), -7))\n        SET @Agent=''\n        SET @DbName='QMSV3Dev'\n\nBegin   \n--crete temp table to get the details\nCREATE TABLE #tblAgencyCount(AID INT IDENTITY(1,1) NOT NULL,SaveDataCount varchar(50),AgentID varchar(50),GetRateCount varchar(50),ConvertedQuoteCount varchar(50))\nINSERT INTO #tblAgencyCount(SaveDataCount,AgentID) select COUNT(*),AQ.AgentID from Agent_Quote AQ where \n        AQ.CreatedOn between @From and @To\n        and AQ.AgentID like @Agent +'%' and AQ.StatusCode!='C' group by AQ.AgentID  \nSET @intFlag = 1\nset @Count=(select COUNT(*) from #tblAgencyCount)\nWHILE (@intFlag &lt;=@Count)\nBEGIN\ndeclare @Ai int\nset @Ai=(select AgentID from #tblAgencyCount where AID=@intFlag)\nUpdate #tblAgencyCount set GetRateCount=(select COUNT(*) from Agent_Quote AQ where \n        AQ.CreatedOn between @From and @To\n        and AQ.AgentID like @Ai and AQ.StatusCode!='C' and AQ.LowPrice!='' and AQ.HighPrice!=''),\n        ConvertedQuoteCount=(select COUNT(*) from Agent_Quote AQ where \n        AQ.CreatedOn between @From and @To\n        and AQ.AgentID like @Ai and AQ.StatusCode!='C' and AQ.ApproveStatus='Approved')\n         where AID=@intFlag\nSET @intFlag = @intFlag + 1\nEND\n--end \n    Drop Table Temp_AgencyCount\n    Create Table Temp_AgencyCount(AgencyName Varchar(250),SubmittedCount Varchar(50),GetRateCount varchar(50),ApprovedQuoteCount Varchar(50))\n    SET @sql='select A.Name,AC.SaveDataCount as SubmittedCount,AC.GetRateCount,AC.ConvertedQuoteCount as ApprovedQuoteCount from #tblAgencyCount AC Left Join ' + @DbName + '..Agent A On AC.AgentID = A.ID order by A.Name'\n    Insert into Temp_AgencyCount Values('Agency Name','Submitted Count','GetRate Count','Approved QuoteCount')\n    Insert into Temp_AgencyCount Values('------------------------------------','-----------------','---------------','-------------------')\n    Insert into Temp_AgencyCount Exec(@sql)\n    exec master..xp_cmdshell 'bcp \"SELECT AgencyName+Space(40-Len(AgencyName))+ ''-   ''+ SubmittedCount+Space(20-Len(SubmittedCount))+''- ''+GetRateCount+Space(20-Len(GetRateCount))+''- ''+ApprovedQuoteCount FROM AgentPortal_Live_21Sept2012..Temp_AgencyCoun\nt\" queryout C:\\WeeklyOnlineSubmissionReport.xls -c -T'\n    Select @Count=COUNT(*) from Temp_AgencyCount\n    If(@Count!=0)\n    Begin\n        EXEC msdb.dbo.sp_send_dbmail @profile_name='Profile',\n             @recipients=@ToEmail, @subject='Weekly Online Submission Report', \n             @body=@BodyMessage,@file_attachments='C:\\WeeklyOnlineSubmissionReport.xls'\n    End\nEnd\n\n--Exec usp_GetTrackAgencyCountReport_Job\n</code></pre>\n\n<p>It is working fine to create the Excel file and send to mail but I don't get correct format in one column in one line like that to display the Excel, how to align, please give me any idea about that</p>\n\n<p>Thank u\nhemanth</p>\n"},{"tags":["mysql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":50,"score":0,"question_id":12923930,"title":"Why migrate from MySql to sql server","body":"<p>My team has a product that was created using MySQL.  All of our other systems use SQL Server 2008, and I want to investigate migrating to SQL Server.  The person who headed up the MySQL server effort has left the company, so now we don't have anyone familiar with MySQL.  We want to migrate, but I want to be able to present a detailed analysis as to why we want to migrate.  Are there any documented case studies on the advantages/disadvanteges of MySQL, and any compelling reasons to migrate to SQL Server? FYI, the app is still in Beta mode, it would be easier to migrate now than 6 months from now.</p>\n\n<p>The two conversations that I don't want to have with my boss are:\n1) I want to migrate the app to SQL Server, and the reason is \"just because I want to \".\n2) We should have migrated 6 months ago, but we didn't and wish we had.</p>\n"},{"tags":["sql","sql-server-2008","tsql","date","datetime"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":119,"score":0,"question_id":12921808,"title":"Convert to MM/YYYY format","body":"<p>I have some bad data in the database for a varchar field.\nData includes: </p>\n\n<pre><code>10/2012\nMay, 2010\nAugust., 2010\n05/10/2009\n</code></pre>\n\n<p>But now I need to clean up these data &amp; update the column with MM/YYYY format. Anyone has any suggestions for doing this easier?</p>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12726580,"title":"Show Html entities like &amp; in report parameter as &","body":"<p>Is there an effective and/or fast way to show <code>Html entities</code> like <code>&amp;amp;</code> or <code>&amp;euml;</code> as <code>&amp;</code> and <code>ë</code> in an report viewer's parameter drop down list?</p>\n\n<p>I have <code>html</code> encoded values in the database and now I need to show the original value in parameter drop down list</p>\n\n<p>Or does <code>MSSQL</code> have an equivalent for this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12908486,"title":"How can I get the average difference between the max and min dates?","body":"<p>I am trying to get the <strong>average</strong> number of months difference between two dates:</p>\n\n<pre><code>select client_id, \n        avg(12*(year(MAX(received_date))-year(min(received_date))) \n        + MONTH(MAX(received_date))-MONTH(min(received_date)))\n        from tmpTwoAccessions\n        group by CLIENT_ID,PATIENT_ID\n</code></pre>\n\n<p>I am getting this message:</p>\n\n<pre><code>Cannot perform an aggregate function on an expression containing an aggregate or a subquery.\n</code></pre>\n\n<p>Can you please advise me on what am I doing incorrectly here?\nThanks so much for your guidance.</p>\n"},{"tags":["sql-server-2008","tsql","table","collation","temp"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":726,"score":3,"question_id":9648987,"title":"T-SQL Default Collation of temporary table","body":"<p>How can I check which is the collation of a temporary table?</p>\n\n<p>I want to do this, because I what to check what happens if I have database with a specific collation, different from the SQL Server instance and create a temporary table.</p>\n\n<p>Let's say we have this scenario:</p>\n\n<p>SQL Server 2008 - Latin1_General_CS_AS</p>\n\n<p>Test Database - Estonian_CS_AS</p>\n\n<p>Then create table #Test without specifying the collation. Which will be the collation of the table?</p>\n\n<p>I think Estonian_CS_AS, but in the test I am doing is said Latin1_General_CS_AS. That's why I need to find a SQL statement to check this.</p>\n\n<p>Note: from what I have read, I think that the collation of a temporary objects is defined by the tempdb collation. But if this is true, what difines its kind?</p>\n"},{"tags":["sql","sql-server","oracle","tsql","sql-server-2008"],"answer_count":3,"favorite_count":10,"up_vote_count":20,"down_vote_count":0,"view_count":9522,"score":20,"question_id":2046037,"title":"SQL Server: Can I Comma Delimit Multiple Rows Into One Column?","body":"<h1>Creating Comma Separated Lists In SQL</h1>\n\n<p><br/>\nHi All,</p>\n\n<p>I am attempting to merge something like this in my SQL Server database:</p>\n\n<pre>[TicketID], [Person]\n T0001       Alice\n T0001       Bob\n T0002       Catherine\n T0002       Doug\n T0003       Elaine</pre>\n\n<p>Into this:</p>\n\n<pre>[TicketID], [People]\n T0001       Alice, Bob\n T0002       Catherine, Doug\n T0003       Elaine</pre>\n\n<p>I need to do this in both SQL Server and Oracle.</p>\n\n<p>I have found the function <code>GROUP_CONCAT</code> for MySQL that does exactly what I need here, but MySQL is not an option here.</p>\n\n<p><strong>EDIT:</strong> Test bench:</p>\n\n<pre><code>DECLARE @Tickets TABLE (\n    [TicketID] char(5) NOT NULL,\n    [Person] nvarchar(15) NOT NULL\n)\n\nINSERT INTO @Tickets\nSELECT 'T0001', 'Alice' UNION ALL\nSELECT 'T0001', 'Bob' UNION ALL\nSELECT 'T0002', 'Catherine' UNION ALL\nSELECT 'T0002', 'Doug' UNION ALL\nSELECT 'T0003', 'Elaine'\n\nSELECT * FROM @Tickets\n</code></pre>\n"},{"tags":["c#",".net","sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12919919,"title":"SQL Data Base Sync","body":"<p>I want to Sync two different SQL Data base which is not in public IP, Is this possible with .Net Sync and WCF ?</p>\n\n<p>Or I Need to add both DB in public IP ?</p>\n"},{"tags":["sql-server-2008","migration","ms-access-2003"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12921243,"title":"SQL Server Migration Assistant invalid object name?","body":"<p>I'm using the SQL Server Migration Assistant 2008 for Access (SSMA 2008).</p>\n\n<p>I've specified which databases I want to import; and I've also specified which SQL Server data I want to import these files into. When it runs I I end up with alot of Synchronization Errors, with a description of <code>Invalid object name 'TableName'</code></p>\n\n<p>I added the <code>Administer</code> permissions to the <code>Admin</code> user and <code>User</code> group in the workgroup file for the database.</p>\n\n<p>I also <a href=\"http://www.sqlservercentral.com/Forums/Topic546504-131-1.aspx#bm561201\" rel=\"nofollow\">read that</a> that I should try compacting the database first and then try to do the migration again; I've tried that, and can't seem to retrieve the rest of the tables. </p>\n\n<p>The database doesn't appear to be corrupted, many users use it all the time (maybe the permissions are just corrupted).  I can also connect to it with SQuirrel SQL.</p>\n\n<p>Do I have any other options for importing the data into SQL Server 2008 R2?   </p>\n"},{"tags":["sql-server-2008","windows-7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12920886,"title":"A network-related or instance-specific error occured","body":"<p>I have installed SQL Server 2008 R2 Developer edition successfully. I have 2 problems</p>\n\n<ol>\n<li><code>Its showing 2 (local) servers in server name</code></li>\n<li><code>A network-related or instance-specific error occured while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Name Pipes Provider, error: 40 - Could not open a connection to SQL Server) (Microsoft SQL Server, Error: 2)</code></li>\n</ol>\n\n<p><img src=\"http://i.stack.imgur.com/Xc5QL.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12863786,"title":"A better solution to replace an old cursor?","body":"<p>I have two tables like this</p>\n\n<p>table1 sorted by paymentid, paydate:</p>\n\n<pre><code> paymentid   paydate   amount\n\n  1         20120101    100\n\n  1         20120101    150\n\n  1         20120101    150\n\n  2         20120115    100\n\n  2         20120115    100\n\n...\n</code></pre>\n\n<p>table2 sorted by paymentid, paydate:</p>\n\n<pre><code>paymentid    paydate   pay1   pay2   pay3....base on the position from table1...up to pay20\n\n1            20120101   null  null    null   \n\n2            20120115   null  null    null\n\n...\n</code></pre>\n\n<p>after update, table2 should be like this</p>\n\n<pre><code>1            20120101   100   100     150   null.....\n\n2            20120115   100   100     null  null    null.....\n</code></pre>\n\n<p>The possible solutions i can come up so far are:</p>\n\n<p>1, a temp table for looping thru table1</p>\n\n<p>2, a cursor...current solution:</p>\n\n<pre><code>declare @paymentid int \n\ndeclare @paydate   char(10)\n\ndeclare @amount    money\n\ndeclare @count int\n\ndeclare @saveid int\n\ndeclare @savedate char(10)\n\ndelcare cur cursor for select paymentid, paydate, amount from table1 order by paymentid, paydate\n\nopen cur\n\n\n\nfetch next from cur into @paymentid,@paydate,@amount\n\nwhile @@fetch_status = 0\n\n  if @saveid &lt;&gt; @paymentid or @savedate &lt;&gt; @paydate\n\n     set @count = 1\n\n     set @saveid = @paymentid\n\n     set @savedate = @paydate\n\n  else set @count = @count + 1\n\n  if @count = 1\n\n  update table2 \n\n  set pay1 = @amount\n\n  where paymentid = @paymentid and paydate = @paydate\n\n  if @count = 2\n\n  update table2 \n\n  set pay2 = @amount\n\n  ...\n\n  fetch next\n\n  ...\n</code></pre>\n\n<p>Any suggestion will be appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12906543,"title":"Changing the SQL Server Time & Date Comment Stamp at top of query","body":"<p>In SQL Server 2008/12 at the top of my procedures I have the following:</p>\n\n<pre><code>/****** Object:  StoredProcedure [Actions].[InsertArea]    Script Date: 16/10/2012 02:56:08 ******/\n                                 ----------------------                 ---------- --------      \n</code></pre>\n\n<p>It obviously changes depending on the name of the procedure and the date / time it was last modified.</p>\n\n<p>Is there any way to prevent this from changing or to alter it so I have a date created as opposed to a date last modified or am I just stuck with it this way.</p>\n\n<p>Thanks in advance for any help.</p>\n"},{"tags":["sql-server-2008","tsql","csv","aggregation"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":12920013,"title":"T-SQL: split and aggregate comma-separated values","body":"<p>I have the following table with each row having comma-separated values:</p>\n\n<pre><code>ID\n-----------------------------------------------------------------------------\n10031,10042\n10064,10023,10060,10065,10003,10011,10009,10012,10027,10004,10037,10039\n10009\n20011,10027,10032,10063,10023,10033,20060,10012,10020,10031,10011,20036,10041\n</code></pre>\n\n<p>I need to get a count for each <code>ID</code> (a groupby).</p>\n\n<p>I am just trying to avoid cursor implementation and stumped on how to do this without cursors.</p>\n\n<p>Any Help would be appreciated !</p>\n"},{"tags":["sql-server","database","sql-server-2008","check-constraints"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":477,"score":2,"question_id":8321619,"title":"Create custom error message in check constraints in SQL SERVER 2008","body":"<p>I'd like to see the ability to attach custom error messages to CONSTRAINT objects, specifically CHECK constrints. Either directly or via a custom error number in sysmessages.</p>\n\n<p>I've seen developers have to create triggers. I think that's not a good reason to implementing it.</p>\n\n<p>I'm using SQL SERVER 2008.</p>\n"},{"tags":["database","sql-server-2008","linq-to-sql","csv"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12892395,"title":"Cyrillics in LINQ to SQL database","body":"<p>I have comma separated file with cyrillics characters. When I read from it using StreamReader the characters are OK. I'm writing the file in LINQ to SQL database, however the column with cyrillics is written with ?????? .The column is nvarchar type. Does somebody had the same problem?</p>\n"}]}
{"total":21074,"page":11,"pagesize":100,"questions":[{"tags":["database","sql-server-2008","linq-to-sql","csv"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12892395,"title":"Cyrillics in LINQ to SQL database","body":"<p>I have comma separated file with cyrillics characters. When I read from it using StreamReader the characters are OK. I'm writing the file in LINQ to SQL database, however the column with cyrillics is written with ?????? .The column is nvarchar type. Does somebody had the same problem?</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12920248,"title":"\"Merging\" columns from several tables","body":"<p>Using SQL Server 2008, suppose I have several tables with 3 common columns (not related):</p>\n\n<p>TABLE1</p>\n\n<pre><code>col1 colSomeOther col2 colAnotherOne\n</code></pre>\n\n<p>TABLE2</p>\n\n<pre><code>col1 colSomeOther col2 colAnotherOne\n</code></pre>\n\n<p>TABLE3</p>\n\n<pre><code>col1 colSomeOther col2 colAnotherOne\n</code></pre>\n\n<p>I would like to create a view which merges col1 and 2 for the 3 tables above. Something like:</p>\n\n<p>VIEW</p>\n\n<pre><code>col1   col2\n</code></pre>\n\n<p>where col1 contains <strong>ALL elements</strong> from table 1, 2 and 3, and col2 contains ALL elements from col2 in table 1, 2, 3.</p>\n\n<p>Is this possible?</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":2,"view_count":43,"score":-1,"question_id":12919929,"title":"must declare scalar variable error \"@f_ndoganor\"","body":"<p>I get the error <code>must declare scalar variable error \"@f_ndoganor\"</code> at <code>@f_ndoganor</code>... I changed type of <code>@f_ndoganor</code> many types, as numeric, as int, as varchar... but I can't solve the problem ... </p>\n\n<pre><code>SqlConnection conn = new SqlConnection(\"Data Source=MAZI-PC\\\\PROJECTACC;Initial Catalog=programDB;Integrated Security=True\");\nstring sqlIns = \"INSERT INTO table_regjistrimi (f_kodi, f_emertimi,f_emri,f_shteti,f_lloj_kodi,f_vendodhja,f_vitiushtrimor,f_telefoni,f_email,f_web,f_nbiznesit,f_dbiznesit,f_nfiskal,f_dfiskal,f_ntvsh,f_dtvsh,f_ndoganore,f_ddoganore,f_npunes,f_dpunes,f_nlicenca,f_dlicenca,f_drejtori,f_rf,f_kontabilisti,f_konsumatori,f_autorizuari,f_npunesuarve,f_shenime) values (@f_kodi, @f_emertimi, @f_emri, @f_shteti, @f_lloj_kodi, @f_vendodhja, @f_vitiushtrimor, @f_telefoni, @f_email, @f_web, @f_nbiznesit, @f_dbiznesit, @f_nfiskal, @f_dfiskal, @f_ntvsh, @f_dtvsh, @f_ndoganore, @f_ddoganore, @f_npunes, @f_dpunes, @f_nlicenca, @f_dlicenca, @f_drejtori, @f_rf, @f_kontabilisti, @f_konsumatori, @f_autorizuari, @f_npunesuarve, @f_shenime)\";\n\n\nconn.Open();\ntry\n{\n    SqlCommand cmdIns = new SqlCommand(sqlIns,conn);\n\n    cmdIns.Parameters.AddWithValue(\"@f_kodi\", textBox1.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_emertimi\", textBox2.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_emri\", textBox3.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_shteti\", textBox4.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_lloj_kodi\", comboBox1.SelectedText);\n    cmdIns.Parameters.AddWithValue(\"@f_vendodhja\", textBox5.Text);\n    cmdIns.Parameters.AddWithValue(\"@adresa\", textBox6.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_vitiushtrimor\", textBox7.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_telefoni\", textBox8.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_email\", textBox9.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_web\", textBox10.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_nbiznesit\", textBox15.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_dbiznesit\", textBox21.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_nfiskal\", textBox16.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_dfiskal\", textBox22.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_ntvsh\", textBox17.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_dtvsh\", textBox23.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_ndoganor\", textBox18.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_ddoganor\", textBox24.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_npunes\", textBox19.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_dpunes\", textBox25.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_nlicenca\", textBox20.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_dlicenca\", textBox26.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_drejtori\", textBox30.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_rf\", textBox31.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_kontabilisti\", textBox32.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_konsumatori\", textBox33.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_autorizuari\", textBox34.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_npunesuarve\", textBox35.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_shenime\", textBox36.Text);\n    cmdIns.ExecuteNonQuery();\n    //admin\n}\n    catch (Exception ex )\n{\n    MessageBox.Show(ex.Message);\n}\nfinally\n{\n    conn.Close();\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":544,"score":2,"question_id":2870162,"title":"Can SQL Server 2008 use a variable in a WHERE IN clause","body":"<p>Are there any updates in SQL Server 2008 to allow a variable for the <code>IN</code> clause of a <code>WHERE</code> predicate?</p>\n\n<p>Will this code work as expected?</p>\n\n<pre><code>declare @InParams varchar(100) = '1,2';\n\nselect * from Category\nwhere CategoryID in @InParams;\n</code></pre>\n"},{"tags":["c#",".net","sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12918626,"title":"Select distinct values ignoring one field","body":"<p>I have a table similar to this</p>\n\n<pre><code>Table(Id int, PropertyId int, UserId int, AccesedOn datetime)\n</code></pre>\n\n<p>So the table can have value for one property for one user, but different times.</p>\n\n<pre><code>Eg.\n1,100,5, 2012-10-16 16:24:48\n2,100,5, 2012-10-17 11:22:00\n3,100,5, 2012-10-18 17:10:05\n</code></pre>\n\n<p>What I am trying here is to select distinct properties for specific user, but order by most recent access time.</p>\n\n<p>Also I am joining this table to three other tables which result in providing duplicate values. Therefore I have to use <code>DISTINCT</code> command.</p>\n\n<p>Problem I have is since I doing the <code>orderby AccesedOn</code>, it need to appear on select statement which doesn’t brings the distinct values since the <strong><em>AccesedOn</em></strong> column have different values.</p>\n\n<p>For above example it should return only <code>3,100,5, 2012-10-18 17:10:05</code></p>\n\n<p>Any suggestions to overcome this?</p>\n"},{"tags":["sql","database","sql-server-2008","query","sql-optimization"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12918362,"title":"Temporary table vs short-circuit operation for SQL query","body":"<p>Following is my query which I want to optimize, here the bottleneck for the optimization is CONDITION_B. </p>\n\n<pre><code>select @COMPUTE_X = count(distinct TABLEA.COLUMN_T5)\nfrom #TMP_TABLEA TABLEA\ninner join TABLEB on TABLEB.ID = TABLEA.ID\nleft join....\nwhere\n(\n  CONDITION_A --Complex condition\n) and\n(\n  CONDITION_B --Complex condition with some functions returning table\n)\n</code></pre>\n\n<p>If I put my result of above query leaving CONDITION_B to a temporary table and then apply CONDITION_B on that temporary table, I achieve a very good amount of performance gain. I think CONDITION_B always evaluated whether the result for CONDITION_A is false.</p>\n\n<p>Could anyone let me know if there is a better way of doing it. And does short-circuit operations work in SQL query statement, if yes what is the order of their processing.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","select"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":103,"score":0,"question_id":12918061,"title":"Combine 2 SQL SELECT statements","body":"<p>** Evidently some people think my question is not worthy of their time. I whole heartedly appologise for this. However, rather than down voting why not use that time to do something positive and at least tell me what info you would require to make this not be a cr@p question in your eyes. **</p>\n\n<p>I have a list of staff in table <code>tblMembers</code> and a list of clients in table <code>tblClients</code>.</p>\n\n<p>One person may have several client.</p>\n\n<p>The staff member associated with a client is identified by <code>staffId</code> against the client record.</p>\n\n<p>Each staff member has a category Id for the type of clients they have <code>catId</code>.</p>\n\n<p><em><strong>I need to find all of the staff for a given client type and then sort them by the number of clients they have. Staff members without any clients should show a result of 0 rather than not showing.</em></strong></p>\n\n<p>A simplified table structure would be:</p>\n\n<p><code>tblMembers</code>:</p>\n\n<pre><code>Id | catId\n</code></pre>\n\n<p><code>tblClients</code>:</p>\n\n<pre><code>Id | staffId \n</code></pre>\n\n<p>Any help would be greatly appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12917555,"title":"Convert Comma Delimited String to bigint in SQL Server","body":"<p>I have a varchar string of delimited numbers separated by commas that I want to use in my SQL script but I need to compare with a bigint field in the database.  Need to know to convert it:</p>\n\n<pre><code>DECLARE @RegionID varchar(200) = null\nSET @RegionID = '853,834,16,467,841,460,495,44,859,457,437,836,864,434,86,838,458,472,832,433,142,154,159,839,831,469,442,275,840,299,446,220,300,225,227,447,301,450,230,837,441,835,302,477,855,411,395,279,303'\n\nSELECT a.ClassAdID,    -- 1\n        a.AdURL,        -- 2\n        a.AdTitle,      -- 3\n        a.ClassAdCatID, -- 4\n        b.ClassAdCat,   -- 5\n        a.Img1,         -- 6\n        a.AdText,       -- 7\n        a.MemberID,     -- 9\n        a.Viewed,       -- 10\n        c.Domain,       -- 11\n        a.CreateDate    -- 12\n        FROM ClassAd a  \n        INNER JOIN ClassAdCat b ON b.ClassAdCAtID = a.ClassAdCAtID\n        INNER JOIN Region c ON c.RegionID = a.RegionID\n        AND a.PostType = 'CPN'\n        AND DATEDIFF(d, GETDATE(), ExpirationDate) &gt;= 0\n        AND a.RegionID IN (@RegionID)\n        AND Viewable = 'Y'\n</code></pre>\n\n<p>This fails with the following error: </p>\n\n<pre><code>Error converting data type varchar to bigint.\n</code></pre>\n\n<p>RegionID In the database is a bigint field.. need to convert the varchar to bigint.. any ideas..?</p>\n\n<p>Many thanks in advance,</p>\n\n<p>neojakey</p>\n"},{"tags":["sql-server-2008","sql-server-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12917858,"title":"Execute command when replicating database on publisher and subscriber?","body":"<p>I have two MSSQL 2012 databases.\nI have snapshot replication configured where the first server is a publisher and distributer, and the other is a subscriber.</p>\n\n<p>I would like to be able to execute a command on the publisher just before the replication job occurs, and then another command on the subscriber just after the replication finishes.</p>\n\n<p>I belive this should be a pull snapshot replication, so that the agent is located on the subscriber server.</p>\n\n<p>Is this even possible?</p>\n"},{"tags":["sql-server-2008","query","inner-join","multiple-columns"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12917711,"title":"In sql 2008 R2, how do i join 2 columns from one table with 2 columns in another table?","body":"<p>I have 2 tables. In table1 I have 2 columns -- cust_npa &amp; cust_nxx. In table2, I have 2 columns -- valid_npa &amp; valid_nxx. Each entry in table2.valid_npa has a corresponding entry in table2.valid_nxx.</p>\n\n<pre><code>valid_npa   valid_nxx\n201         551\n201         552\n201         553\n202         851\n202         852\n</code></pre>\n\n<p>I wish to return all the rows in table1 that have a combination of valid_nap &amp; valid_nxx from table2.</p>\n\n<p>For example, a row in table1 that has cust_npa of 201 and cust_nxx of 852 would not be returned (as this is not a valid combination from table2).</p>\n"},{"tags":["sql-server","sql-server-2008","entity-framework","asp.net-membership","connection-string"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12917410,"title":"Move ASPNETDB.mdf from local machine to SQL Server in production","body":"<p>so I have a problem which destroy my brain since a week. I'll try to be the more specific as possible.</p>\n\n<p>I have an Intranet Web Application in ASP.NET Razor MVC3 with <strong>Entity Framework Membership Provider</strong>. So, my ASPNETDB.mdf appears in my App_Data folder, and I also see it in my Server Explorer tab. Until there, everything is normal and alright. </p>\n\n<p>Now that my app is finish, I would like to move my ASPNETDB database on a distant sql server. So I'll do it, I joined my db in MSQL server management studio, and I changed my connection string from :</p>\n\n<pre><code>&lt;add name=\"ApplicationServices\" \nconnectionString=\"data source=.\\SQLEXPRESS;\n                  Integrated Security=SSPI;\n                  AttachDBFilename=|DataDirectory|FactuADH.dbo;\n                  User Instance=true\"    \nproviderName=\"System.Data.SqlServerCe.4.0\" /&gt;\n</code></pre>\n\n<p>to this one : </p>\n\n<pre><code>&lt;add name=\"ApplicationServices\"\n     connectionString=\"Server=SDCCID01;\n                       Initial Catalog=myDbName;\n                       User ID=myid;\n                       Password=mypswd\"\n     providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>So, to test it, I delete my ASPNETDB.mdf from my App_Data, and when I'll try to log on in my app, I can't. Other thing, when I shut down visual studio and re-open it, I have a new ASPNETDB.mdf database which is re-created (empty). It's look like my connection string have no impacte, even when I changed it, without delete my ASPNETDB from my App_Data folder, my application speak with my local aspnetdb, not one on my server. </p>\n\n<p>Any Idea ? </p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12917409,"title":"Upgraded SS2k5 to SS2k8 but instance still shows SS2k5","body":"<p><img src=\"http://i.stack.imgur.com/eT9Sp.png\" alt=\"enter image description here\">I used the standard MS install process to upgrade my SS2k5 instance to SS2k8R2. Took a long time, and installed programs shows SS2k8R2, but the instance still shows SS2k5. Ideas?</p>\n\n<p>![Here's what it shows:]</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":12915765,"title":"Continue inserting data in temporary table when met exception in SQL Server 2005 (also for 2008)","body":"<p>I have 2 simple tables</p>\n\n<pre><code>+------|---------|----------+\n+  ID  |  Value  |   Test   +\n+------|---------|----------+\n+  3   |   Test  |   12345  +\n+  4   |  MyVal  |   56789  +\n+  5   |  Another|   101010 +\n+------|---------|----------+\n\n\n\n+------|---------|----------+\n+  ID  |  Value  |   Test   +\n+------|---------|----------+\n+  3   |   Test  |   12345  +\n+  7   |  MyVal12|   56789  +\n+  5   |  Another|   101010 +\n+------|---------|----------+\n</code></pre>\n\n<p>The <code>ID</code> from both tables are primary keys.</p>\n\n<p>In my stored procedure, I create a temporary table like this:</p>\n\n<pre><code>CREATE TABLE #tempTable(\n        ID int NOT NULL PRIMARY KEY NONCLUSTERED,\n        FIELD VARCHAR(255))\n</code></pre>\n\n<p>and the part of my procedure stored with <code>try-catch</code> block:</p>\n\n<pre><code>BEGIN TRY\nINSERT INTO #tempTable(ID, FIELD)\nEXEC sp_executesql @myCustomSql, @paramList, @param1, @param2 ...\nEND TRY\n\nBEGIN CATCH\n      // what to put here ?\nEND CATCH\n</code></pre>\n\n<p>I want to add rows to my temporary table (you'll see the duplicates for ID = 3 and 5) and I want to continue adding. Finally I want to have the following content for table:</p>\n\n<pre><code>+------|---------+\n+  ID  |  FIELD  +\n+------|---------+\n+  3   |   Test  +\n+  4   |  MyVal  +\n+  5   |  Another+ \n+  7   |  MyVal12+\n+------|---------+\n</code></pre>\n\n<p>I gave here a simplified example, in my database I have over one hundred thousand rows and many columns.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008","triggers","project-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":12458348,"title":"trigger to stop specific field being set to NULL (single and multi-line updates)","body":"<p>Is it possible to create a trigger that will check if a specific field is being set to NULL (from a single-line or multi-line update), and if it is, to revert that field back to its initial value?</p>\n\n<p>I've searched on the site but not found anything that matches my exact requirements.</p>\n\n<p>A bit of background:</p>\n\n<p>We have two applications (a time management web app and microsoft project server) sending updates to each other about the resources in our organisation. When a change is made in either system, it sends that update to the other system. However, there are certain fields that only exist in the time management web app (table name <code>resource</code>), and MSP server is forcing one of these fields (field name <code>GLMaskingValue</code>) to <code>NULL</code> with some of its updates (not all, as far as I can tell). </p>\n\n<p>I have no access to the code, just the web app database, and I don't want to make the whole update statement fail (which I gather I could do using table constraints) - I just want to revert this one field back when and if someone tries to change it to <code>NULL</code>.</p>\n\n<p>I'm going down the route of triggers but there may well be a much better way of doing this - if so please enlighten me!</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12916125,"title":"SQL multiple tables into one","body":"<p>I have a table of products and a separate table of images for any particular product.</p>\n\n<p><code>tblProducts</code>:</p>\n\n<ul>\n<li>productID</li>\n<li>productName</li>\n</ul>\n\n<p><code>tblProductImages</code>:</p>\n\n<ul>\n<li>productID</li>\n<li>imageFileName</li>\n</ul>\n\n<p>I can return the product details and then the product images for that product with two separate queries but I'm unsure of how to get it into one query?</p>\n\n<p>So for example I would like to see:</p>\n\n<pre><code>productID productName imageFilename imageFilename imageFilename\n</code></pre>\n\n<p>as my result set (will need to be dynamic because there could be anything from 1 to 10 images uploaded per product).</p>\n\n<p>Is this something I can do with a PIVOT?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","checkpoint"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12916043,"title":"Does checkpoint block every other operation?","body":"<p>When Sql Server issues a checkpoint, does it block every other operation until the checkpoint is completed?</p>\n\n<p>If I understand correctly, when a checkpoint occurs, the server should write all dirty pages.</p>\n\n<p>When it's complete, it will write checkpoint to the transaction log, so in case of any failure it will process only transactions from that point of time (or transactions which already started at time of checkpoint). </p>\n\n<p>How does sql server prevent some non dirty page to become dirty while the checkpoint is in progress?</p>\n\n<p>Does it block all writes until the checkpoint is completed?  </p>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008","bids"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12916609,"title":"SSRS BIDS changing the meta tag","body":"<p>When developing reports using SSRS BIDS/SQL Server 2008 R2 is there anyway you can alter the metatag or css used for the report.</p>\n\n<p>I want to add this to the header of the report part in question:</p>\n\n<pre><code>&lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=7\"&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12915993,"title":"Join on to table with multiple matches but only bring back specified match","body":"<p>I have 3 tables.<br>\nTable A contains the data that my query is going to be based on. It contains id1.\nTable B is my connecting table, it contains 2 columns that I'm concerned with: id1 &amp; id2.  </p>\n\n<p>Table C is my lookup table, it contains id2 and ReasonName. I need the column ‘ReasonName’ and all the data from table A.</p>\n\n<p>If I do the following SQL:</p>\n\n<pre><code> SELECT NAME, \n       STARTDATE, \n       ENDDATE, \n       REASON, \n       ID1 \nFROM   TABLEA \n       LEFT JOIN TABLEB \n              ON TABLEA.ID1 = TABLEB.ID1\n</code></pre>\n\n<p>I am then able to do a second join on to TableC, however this is where the problem lies.\nThere are multiple matches in TableC so therefore my totalrows increases. I need to avoid this.\nSee image for what TableC looks like:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Ymazn.png\" alt=\"enter image description here\"></p>\n\n<p>If my SQL statement now looks like this:</p>\n\n<pre><code> SELECT TABLEA.NAME, \n       TABLEA.STARTDATE, \n       TABLEA.ENDDATE, \n       TABLEA.REASON, \n       TABLEA.ID1, \n       TABLEC.REASONNAME \nFROM   TABLEA \n       LEFT JOIN TABLEB \n              ON TABLEA.ID1 = TABLEB.ID1 \n       LEFT JOIN TABLEC \n              ON TABLEB.ID2 = TABLEC.ID2 \n</code></pre>\n\n<p>Then my rows increase by around 1000. This is because it is quite possible that TableA.id1 matches multiple id2’s found in TableC. It then duplicates rows apart from the different TableC.ReasonName.</p>\n\n<p>In TableC there is one ReasonName that I am concerned with. For this example I will say it is ‘reasonf’.</p>\n\n<p>What I need is to bring through ReasonName from TableC, BUT only the ones that contain reasonf, the rest I want to say NULL or to do a COALESCE with ‘No Reason’.\nI have tried putting a WHERE clause into the statement. See SQL:</p>\n\n<pre><code> SELECT TABLEA.NAME, \n       TABLEA.STARTDATE, \n       TABLEA.ENDDATE, \n       TABLEA.REASON, \n       TABLEA.ID1, \n       TABLEC.REASONNAME \nFROM   TABLEA \n       LEFT JOIN TABLEB \n              ON TABLEA.ID1 = TABLEB.ID1 \n       LEFT JOIN TABLEC \n              ON TABLEB.ID2 = TABLEC.ID2 \nWHERE  TABLEC.ID2 = 'asd1f5as98a4' \n</code></pre>\n\n<p>But then it will only bring though those records where there is a match with ‘reasonf’, I want it to display reasonf people and ignore the rest (leave as null or something) so I have no duplicates but my full result set.</p>\n\n<p>I'm thinking I may need to change to a right join or possibly change the WHERE but I'm not entirely sure.</p>\n"},{"tags":["sql-server-2008","appharbor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12915940,"title":"AppHarbor Shared SQL Space Allocation Error","body":"<p>We are running the Shared SQL Server Addon under the 'Nano' Plan with 10GB storage.</p>\n\n<p>We are nowhere near approaching our storage limit yet we are intermittently encountering this SQL error when writing to the database:</p>\n\n<blockquote>\n  <p>Could not allocate space for object 'dbo.<em>MyTable</em>' in database\n  '<em>MyDatabaseId</em>' because the 'PRIMARY' filegroup is full. Create disk\n  space by deleting unneeded files, dropping objects in the filegroup,\n  adding additional files to the filegroup, or setting autogrowth on for\n  existing files in the filegroup.</p>\n</blockquote>\n\n<p>It seems the problem is because we do not have enough unused space at any given time for the tables we are writing to. Here is the output from <code>sp_spaceused</code> on each table:</p>\n\n<pre><code>name             rows      reserved    data        index_size   unused\n---------------- --------- ----------- ----------- ------------ ------\nMyTable1         382862    177608 KB   177536 KB   8 KB         64 KB\n---------------- --------- ----------- ----------- ------------ ------\nMyTable2         137091    34248 KB    34240 KB    8 KB         0 KB\n---------------- --------- ----------- ----------- ------------ ------\n</code></pre>\n\n<p>EDIT: Further inspection shows the physical .mdf file has an Auto-Grow setting of 1024KB, should we expect to see a larger proportion of this as Unused table space?</p>\n\n<p>This is preventing us from creating indexes and worse still causing us to lose data. Is there a way to increase our allocation or another approach to take? Please advise.</p>\n"},{"tags":["sql-server-2008","msdtc","distributed-transactions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12860738,"title":"MSDTC: TransactionManagerCommunicationException after changing IP address of MSSQL server","body":"<p>after we moved our Win2k8 MSSQL2008 server to different IP address, we have troubles running unit tests against database on that SQL server from out build agent. Everything worked before we moved the database server. Now, unit tests which uses multiple database transactions fails with this error message:</p>\n\n<pre><code>System.Data.EntityException: The underlying provider failed on Open. \n---&gt;   System.Transactions.TransactionManagerCommunicationException: \nCommunication with the underlying transaction manager has failed. \n---&gt; System.Runtime.InteropServices.COMException: The MSDTC transaction manager \nwas unable to pull the transaction from the source transaction manager due to\ncommunication problems. \nPossible causes are: a firewall is present and it doesn't have an exception for the\nMSDTC process, the two machines cannot find each other by their NetBIOS names, or the \nsupport for network transactions is not enabled for one of the two transaction\nmanagers.\n</code></pre>\n\n<p>We checked the firewall settings, and ability to ping from one server to another, without problem. Probably there must be the old IP address of SQL Server stored somewhere, or what else can cause this problem? </p>\n\n<p>Thank you for help!</p>\n"},{"tags":["sql-server-2008","sql-optimization","query-plans"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12904376,"title":"Execution Plan Optimization when where clause is removed then added back","body":"<p>I have a stored procedure that uses a table valued function which executes in 9 seconds. If I  alter the table valued function and remove the where clause, the stored procedure executes in 3 seconds. If I add the where clause back, the query still executes in 3 seconds. </p>\n\n<p>I took a look at the execution plans and it appears that after I remove the where clause, the execution plan includes parallelism and the scan count for 2 of my tables drops for 50000 and 65000 down to 5 and 3. After I add the where clause back, the optimized execution plan still runs unless I run DBCC FREEPROCCACHE.</p>\n\n<p>Questions\n1. Why would SQL Server start using the optimized execution plan for both queries only when I first remove the where clause?</p>\n\n<ol>\n<li>Is there a way to force SQL Server to use this execution plan?</li>\n</ol>\n\n<p>Also, this is a paramaterized all-in-one query that uses the (Parameter is null or Parameter) in the where clause, which I believe is bad for performance.</p>\n\n<pre><code>RETURNS TABLE \nAS\nRETURN \n(\nSELECT  TOP (@PageNumber * @PageSize)\n                CASE\n                    WHEN @SortOrder = 'Expensive' THEN ROW_NUMBER()     OVER (ORDER BY SellingPrice DESC)\n                WHEN @SortOrder = 'Inexpensive' THEN ROW_NUMBER() OVER (ORDER BY SellingPrice ASC)                  \n                WHEN @SortOrder = 'LowMiles' THEN ROW_NUMBER() OVER (ORDER BY Mileage ASC)\n                WHEN @SortOrder = 'HighMiles' THEN ROW_NUMBER() OVER (ORDER BY Mileage DESC)\n                WHEN @SortOrder = 'Closest' THEN ROW_NUMBER() OVER (ORDER BY P1.Distance ASC)       \n                WHEN @SortOrder = 'Newest' THEN ROW_NUMBER() OVER (ORDER BY [Year] DESC)    \n                WHEN @SortOrder = 'Oldest' THEN ROW_NUMBER() OVER (ORDER BY [Year] ASC)                     \n                ELSE ROW_NUMBER() OVER (ORDER BY InventoryID ASC)\n            END as rn,\n            P1.InventoryID,\n            P1.SellingPrice,\n            P1.Distance,\n            P1.Mileage,\n            Count(*) OVER () RESULT_COUNT,\n            dimCarStatus.[year]\n    FROM    (SELECT InventoryID, SellingPrice, Zip.Distance, Mileage, ColorKey, CarStatusKey, CarKey FROM facInventory\n                JOIN @ZipCodes Zip\n                ON   Zip.DealerKey = facInventory.DealerKey) as P1\n    JOIN    dimColor\n            ON dimColor.ColorKey = P1.ColorKey\n    JOIN    dimCarStatus\n            ON dimCarStatus.CarStatusKey = P1.CarStatusKey  \n    JOIN    dimCar\n            ON dimCar.CarKey = P1.CarKey                        \n    WHERE\n            (@ExteriorColor is NULL OR dimColor.ExteriorColor like @ExteriorColor) AND\n            (@InteriorColor is NULL OR dimColor.InteriorColor like @InteriorColor) AND\n            (@Condition is NULL OR dimCarStatus.Condition like @Condition) AND\n            (@Year is NULL OR dimCarStatus.[Year] like @Year) AND\n            (@Certified is NULL OR dimCarStatus.Certified like @Certified) AND\n            (@Make is NULL OR dimCar.Make like @Make) AND\n            (@ModelCategory is NULL OR dimCar.ModelCategory like @ModelCategory) AND    \n            (@Model is NULL OR dimCar.Model like @Model) AND\n            (@Trim is NULL OR dimCar.Trim like @Trim) AND\n            (@BodyType is NULL OR dimCar.BodyType like @BodyType) AND\n            (@VehicleTypeCode is NULL OR dimCar.VehicleTypeCode like @VehicleTypeCode) AND\n            (@MinPrice is NULL OR P1.SellingPrice &gt;= @MinPrice) AND\n            (@MaxPrice is NULL OR P1.SellingPrice &lt; @MaxPrice) AND\n            (@Mileage is NULL OR P1.Mileage &lt; @Mileage)\n    ORDER   BY\n            CASE\n                WHEN @SortOrder = 'Expensive' THEN -SellingPrice\n                WHEN @SortOrder = 'Inexpensive' THEN SellingPrice \n                WHEN @SortOrder = 'LowMiles' THEN Mileage\n                WHEN @SortOrder = 'HighMiles' THEN -Mileage\n                WHEN @SortOrder = 'Closest' THEN P1.Distance        \n                WHEN @SortOrder = 'Newest' THEN -[YEAR]\n                WHEN @SortOrder = 'Oldest' THEN [YEAR]                  \n                ELSE InventoryID \n            END\n)\n</code></pre>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12915497,"title":"SQL Server Cross-Database, Cross-Server Relationships","body":"<p>In SQL Server are these things possible</p>\n\n<ol>\n<li>Writing a select query which references tables from different databases on the same server?</li>\n<li>Writing a select query which references tables from different databases on different servers?</li>\n<li>Having a primary key, foreign key relationship between tables in different databases on the same server?</li>\n<li>Having a primary key, foreign key relationship between tables in different databases on different servers?</li>\n</ol>\n\n<p>THanks,</p>\n\n<p>Sachin</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":9213375,"title":"T-SQL COUNT of 'A', 'B', and 'A or B'","body":"<p>Conceptually, I have a table with a list of fruit items.  I want, in a single query, to see counts of how many apples, oranges, 'apples or oranges', and 'other fruit' there are.</p>\n\n<p>How can I achieve this in T-SQL?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12906776,"title":"how to combat horrific performance when joining on WITH(s)","body":"<p>I do not have permissions to set up indexes on these tables unfortunately. </p>\n\n<p>The first two <code>WITH's</code> are causing this query to run for hours:</p>\n\n<pre><code>;with OneAccession as (\nselect client_id,COUNT(patient_id) PatientCount from\n(\nselect client_id,patient_id\nfrom F_ACCESSION_DAILY\ngroup by CLIENT_ID,PATIENT_ID\nhaving COUNT(ACCESSION_ID)=1\n) a\ngroup by CLIENT_ID\n)\n,\n\nTwoAccessions as (\nselect client_id,COUNT(patient_id) PatientCount from\n(\nselect client_id,patient_id\nfrom F_ACCESSION_DAILY\ngroup by CLIENT_ID,PATIENT_ID\nhaving COUNT(ACCESSION_ID)=2\n) a\ngroup by client_id\n)\n\n\n\nselect\nf.client_id\n, 12*(year(getdate())-year(min(f.received_date))) + MONTH(GETDATE())-MONTH(min(f.received_date))\n, COUNT(distinct f.patient_id) TotalPatients\n, COUNT(f.ACCESSION_ID) TotalSpecimens\n, o.PatientCount  TotalPatientsWOneSpec\n, t.PatientCount TotalPatientsWTwoSpec\nfrom F_ACCESSION_DAILY f\njoin\nOneAccession o\non o.CLIENT_ID=f.CLIENT_ID\njoin\nTwoAccessions t\non t.client_id=f.CLIENT_ID\nwhere f.CLIENT_ID not in (select clientid from SalesDWH..TestPractices)\nand f.SPECIMEN_SOURCE in ('Oral Fluid','Urine')\ngroup by f.CLIENT_ID,o.PatientCount,t.PatientCount\n</code></pre>\n\n<p>If I remove <code>OneAccession</code> and <code>TwoAccessions</code>, I can get results in just a few minutes!</p>\n\n<p>I would be very grateful for any guidance on improving my query syntax in order to speed this up!</p>\n\n<p>Thanks so much.</p>\n"},{"tags":["sql-server-2008","tsql","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11738511,"title":"name search with Full Text search","body":"<p>Table: User</p>\n\n<pre><code>...|Name                  |...|..\n__________________________________\n...|george walker          |...|..\n...|...                   |...|..\n</code></pre>\n\n<p>Now I want to write a query to get the above record for the following inputs:\n<code>george</code>\n<code>george walker</code> \n<code>george walker bush</code> etc.</p>\n\n<p>ie., alteast half of the words in search string should match but not any word match</p>\n\n<p>How can I write a query for this?</p>\n\n<p>Note: I would like to use <code>Full Text Search</code> feature because this table has few millions of records. <br>\nI doubt if I could use <code>SOUNDEX</code> with <code>Full Text</code></p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12914287,"title":"update or insert","body":"<p>I'm trying to update or insert data dependent on whether the account number is already in the existing data.\nFirstly I added the new variables to those with an acocunt number already in the table using this</p>\n\n<pre><code>drop table #test1\nselect a.*, B.Delq_Sep12, b.Bal_Sep12, b.Queue_Sep12\ninto #test1\nfrom  pcd1 a\nleft join #pcd_sep12  b on  (a.ACCOUNT_NUMBER = B.account_number)\n</code></pre>\n\n<p>Then I add all those records whose account number is not in test1 (created above) from #pcd_sep12 into test1</p>\n\n<pre><code>INSERT #test1\nSELECT * FROM #pcd_sep12 WHERE account_number NOT IN(SELECT account_number FROM #test1)\n</code></pre>\n\n<p>I get the error Column name or number of supplied values does not match table definition.</p>\n\n<p>I realise its because theres not the same number of fields but is there a way around this?</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","sql-server-2008","insert"],"answer_count":11,"favorite_count":3,"up_vote_count":17,"down_vote_count":0,"view_count":24839,"score":17,"question_id":2624713,"title":"How do I insert multiple rows WITHOUT repeating the \"INSERT INTO dbo.Blah\" part of the statement?","body":"<p>I know I've done this before years ago, but I can't remember the syntax, and I can't find it anywhere due to pulling up tons of help docs and articles about \"bulk imports\".</p>\n\n<p>Here's what I want to do, but the syntax is not exactly right... please, someone who has done this before, help me out :)</p>\n\n<pre><code>INSERT INTO dbo.MyTable (ID, Name)\nVALUES (123, 'Timmy'),\n    (124, 'Jonny'),\n    (125, 'Sally')\n</code></pre>\n\n<p>I know that this is <em>close</em> to the right syntax. I might need the word \"BULK\" in there, or something, I can't remember. Any idea?</p>\n\n<p>EDIT: Particularly, I need this for a SQL Server 2005 database. I've tried this code, to no avail:</p>\n\n<pre><code>DECLARE @blah TABLE\n(\n    ID INT NOT NULL PRIMARY KEY,\n    Name VARCHAR(100) NOT NULL\n)\n\nINSERT INTO @blah (ID, Name)\n    VALUES (123, 'Timmy')\n    VALUES (124, 'Jonny')\n    VALUES (125, 'Sally')\n\nSELECT * FROM @blah\n</code></pre>\n\n<p>I'm getting <code>Incorrect syntax near the keyword 'VALUES'.</code></p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12913633,"title":"Grouping the rows of a table in sql server","body":"<p>I have the below table which has 2 columns.I need to write a query which will return 3 columns,the first 2 column should match the 2 columns present in the table and the 3rd column should group into n splits.\nfor example in this case I want to split into 4 groups.so 1st 4 rows should return 1 in column 3,2nd 4 rows should return 2, 3rd 4 rows should return 3 and finally last 3 rows(as there are in total 15 rows) should return 4.</p>\n\n<pre><code>DECLARE @NAMES TABLE ( [ID] INT IDENTITY, [NAME] VARCHAR(20) )   \nINSERT INTO @NAMES SELECT 'NAME1' \nUNION ALL \nSELECT 'NAME2' \nUNION ALL \nSELECT 'NAME3' \nUNION ALL \nSELECT 'NAME4' \nUNION ALL \nSELECT 'NAME5' \nUNION ALL \nSELECT 'NAME6' \nUNION ALL \nSELECT 'NAME7' \nUNION ALL \nSELECT 'NAME8' \nUNION ALL \nSELECT 'NAME9' \nUNION ALL \nSELECT 'NAME10' \nUNION ALL \nSELECT 'NAME11' \nUNION ALL \nSELECT 'NAME12' \nUNION ALL \nSELECT 'NAME13' \nUNION ALL \nSELECT 'NAME14' \nUNION ALL \nSELECT 'NAME15' \n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","insert"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":322,"score":0,"question_id":1908825,"title":"Query regarding SQL Insert in SQL Server?","body":"<p>I am using SQL Server 2008 and developing a project which is in maintenance phase. </p>\n\n<p>I want to insert record in a table whose primary key is an Integer but not an identity. e.g. table name is <code>tblFiles</code> and fields are <code>ID, FileName, FileContent</code>. </p>\n\n<p>Actually that table is in use so I don’t want to make any schema change in it. And I want the key after row insertion because I have to put that in another table. Existing values in the Id column are different integer, means not in sequence. </p>\n\n<p>So I want the query that also returns me the Id value. So I want to insert only <code>FileName</code> and <code>FileContent</code> and some sort of sql to whom I can embed in my insert query which insert a unique Id and also send me that id </p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12913474,"title":"Adding into Cumulative Files","body":"<p>I have a cumulative file with 291170 records.  In my new table that needs to be added to the cumulative file there are some account numbers that are already in the cumulative file, and some that are new accounts.</p>\n\n<p>All i want to do is merge these variables on (delqsep12, queuesep12) to those accounts that in there but add all the variables that are originally in there for account numbers that arent already in there, they will just be blank.</p>\n\n<p>so cumulative file (cummu12) has </p>\n\n<pre><code>account_number, netpayjun, netpayjul, netpayaug , delqsep12, queuesep12\n</code></pre>\n\n<p>and the added file I want to merge in just has </p>\n\n<pre><code>delqsep12, queuesep12\n</code></pre>\n\n<p>So at the end I should have 295519 rows, new account_numbers have been added and those already those have just been updated with the new variables.\nAlso these new variables may have something in them for old accounts but some may be empty.</p>\n"},{"tags":["sql-server","sql-server-2008","full-text-search"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":54,"score":0,"question_id":12911101,"title":"Full-Text keywords unicode","body":"<p>I have a very large database with billions of words. I need to search inside these words, and the fastest way I know is using iFTS coming with SQL SERVER 2008.</p>\n\n<p>The data is in Turkish. I mean the language of the data is Turkish. And SQL SERVER 2008 handles Full-Text searches with no problem, even in Turkish.</p>\n\n<p>But the problem happens when I try to list the Full-Text words as described here: <a href=\"http://technet.microsoft.com/en-us/library/cc280900.aspx\" rel=\"nofollow\">http://technet.microsoft.com/en-us/library/cc280900.aspx</a></p>\n\n<p>The word columns returned from <strong>sys.dm_fts_index_keywords</strong> are <strong>keyword</strong> and <strong>display_term</strong>. But these columns are not in correct character set. For example there are both ı and i in Turkish charset. Similarly o and ö, g and ğ. But the words return are ascii encoded. Like <strong>kör</strong> is return as <strong>kor</strong> and <strong>için</strong> is returned as <strong>icin</strong>.</p>\n\n<p>But when I do a CONTAINS search, SQL Server matches the search words correctly returns true results. I mean searches with <strong>kör</strong> and <strong>kor</strong> return different results, which is the true behavior.</p>\n\n<p>So I need to get the words as they are stored in SQL, not their ascii representations.</p>\n\n<p>I hope I could explain my problem.</p>\n"},{"tags":["sql","sql-server-2008","database-design","localization"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":12911325,"title":"Is it a good idea to add a table with only one column (an auto incremented identity)?","body":"<p>I'm developing a multilingual web application and I'm having some difficulties deciding what would be the best way to handle a particular scenario in the database (SQL Server 2008).</p>\n\n<p>Let's say users can add posts. A post has default data and localized data. A post is also associated with exactly one category. The users can also manage these localized categories.</p>\n\n<p>The part about the posts is pretty clear to me. That will be something like this:</p>\n\n<pre><code>Posts\n-----\nPostId (auto incremented identity)\nCategoryId\nCreationDate\nSortOrder\n\nPostLocalizations\n-----------------\nPostId\nLanguageId\nTitle\nContent\n</code></pre>\n\n<p>The problem I have is that a category has no default data. It's just a textual description and I'm not sure what would be the best way to store the localizations.</p>\n\n<p>I can think of a possible solution, but I don't really like it.</p>\n\n<pre><code>Categories\n----------\nCategoryId (auto incremented identity)\n\nCategoryLocalizations\n---------------------\nCategoryId\nLanguageId\nName\n</code></pre>\n\n<p>I don't like that table with just one column: an auto incremented identity. Of course I can add dummy fields I don't really need like CreationDate or SortOrder, but that just seems silly.</p>\n\n<p>Is there a better way to solve this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12911478,"title":"sql query to find out the parent Store proecdure of a child procedure","body":"<p>i want a query to get all the  parent storeprodcedure from where the child storeprodcedure \"CHILDSP\"  is being called across the DB in a particular sql server</p>\n"},{"tags":["sql-server-2008","casting","varchar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12910643,"title":"Error with casting","body":"<p>I have a query where I have to extract some number fields from varchar column.\nWhen i do some replace and substring in select statement and cast it to bigint everything works fine, but when I use this same cast in join it throws error\n'Error converting data type varchar to bigint'.\nHow is this possible?</p>\n\n<pre><code>select CAST(\n        case when CHARINDEX('/',f.BML,1)&gt;0 \n            then substring(replace(replace(replace(replace(replace(replace(replace(replace(replace(f.BML,'A',''),'B',''),'C',''),'+',''),',',''),'S',''),'H',''),'P',''),'¸','') ,1,CHARINDEX('/',BML,1)-1)\n        else replace(replace(replace(replace(replace(replace(replace(replace(replace(f.BML,'A',''),'B',''),'C',''),'+',''),',',''),'S',''),'H',''),'P',''),'¸','') \n        end as bigint)\nfrom TableN n join TableO o  on\n    n.Id=o.Id \n    join TableF f on\n        f.OId=o.OId and\n        substring(cast(n.RJ as varchar(10)),1,3)=substring(CAST(f.MT AS varchar(10)),1,3) and\n    CAST(\n        case when CHARINDEX('/',f.BML,1)&gt;0 then substring(replace(replace(replace(replace(replace(replace(replace(replace(replace(f.BML,'A',''),'B',''),'C',''),'+',''),',',''),'S',''),'H',''),'P',''),'¸','') ,1,CHARINDEX('/',f.BML,1)-1)\n        else replace(replace(replace(replace(replace(replace(replace(replace(replace(f.BML,'A',''),'B',''),'C',''),'+',''),',',''),'S',''),'H',''),'P',''),'¸','') \n        end as bigint) =n.mbr\norder by n.Ident\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":909,"score":3,"question_id":8136937,"title":"SQL Server: check whether a Trigger is Enabled or Disabled?","body":"<p>How we can see which Trigger is Enabled or Disabled in SQL Server 2008?</p>\n"},{"tags":["c#","performance","entity-framework","sql-server-2008"],"answer_count":7,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":4387,"score":3,"question_id":3890974,"title":"Entity Framework 4 : Bad performance with SQL Server 2008","body":"<p>I'am developing a software based on Entity Framework to handle data in a MS SQL Server 2008 database.</p>\n\n<p><strong>[Trouble 1]</strong></p>\n\n<p>I've just tried to insert some small data (<strong>about 2 Mb</strong>) from my progam to the database : the performance are very bad ! It takes <strong>more than 1 minute</strong> to insert these datas !</p>\n\n<p>I've try to generate pre-compiled views, I've got the same results :-(</p>\n\n<p>All my code use a business layer (automatically generated from .edmx file with T4 template) to manage data in a service layer. It is very pratical to navigate in the relations of objects.</p>\n\n<p><strong>How can I improve the performance of these inserts with Entity Framework ?</strong></p>\n\n<p><strong>[Trouble 2]</strong></p>\n\n<p>Also, before inserting data in database with SaveChanges() method, I fill my object context with AddObject() method. I add about 100 000 small objects (about 2 Mb) to my object context with AddObject() : it takes a very long time (more than 10 minutes) !</p>\n\n<p><strong>How can I decrease this time ?</strong></p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>My program must save more than 50 Mb in database in less than 2-3 minutes ? Do you think it will be possible with EF ?</p>\n"},{"tags":["php","mysql","sql-server-2008","phpfox"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12907832,"title":"sql server unicode data migrating to mysql database","body":"<p>I am migrating a site which was using sql server database to a php/mysql script. I have a table posts with a field data type ntext. This field is holding a lot of unicode data. Now when I migrated this data to mysql table, it got spoiled. When php ui display this data, it shows as ?????. When I see it in phpmyadmin, data looks alright. Can someone help me what should be the field type and Collation. At the moment. The field type is mediumtext and Collation is utf8mb4_unicode_ci.</p>\n\n<p>You can see a <a href=\"http://phpfoxdev.ramtajogi.com/index.php?do=/post/13050/??????%20:%20???%20???%20????%20????%20????%20?????%20/mod_3/\" rel=\"nofollow\">http://phpfoxdev.ramtajogi.com/index.php?do=/post/13050/??????%20:%20???%20???%20????%20????%20????%20?????%20/mod_3/</a></p>\n\n<p>The actual text is ਹਰ ਰਾਤ ਤੇਰੀ ਯਾਦ ਸੀਨੇ ਨਾਲ ਸੋਂ ਜਾਂਦੇ ਹਾ, ਰਬ ਦੇ ਵਾਂਗੂ...    which is an indian language script.</p>\n\n<p>Help will be appreciated. </p>\n\n<p>Regards\nParminder</p>\n"},{"tags":["sql","sql-server-2008","triggers"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":49,"score":-2,"question_id":12908365,"title":"Before update trigger in SQL Server 2008 based on values present in other columns","body":"<p>I need to create a update trigger in SQL Server 2008 which will check 2 other columms for values if they are present then continue with updating else stop that update for each row. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12871329,"title":"SQL query to find out if different rows with same 2nd columns","body":"<p>I have a MessageThread table</p>\n\n<pre><code>UserUid   ThreadUid\n===================\nK1    111\nN1    111\nK1    222\nK1    333\nN1    444\nR1    111\nR1    222\nD1    333\nE1    444\nT1    555\n</code></pre>\n\n<p>One threadUid is only used for a same group of users.</p>\n\n<p>K1 and N1 can on only have same ThreadUid.</p>\n\n<p>if I know UserUid: K1 and N1</p>\n\n<p>How can I know if K1 and N1 has a same ThreadUid?</p>\n\n<p>Is there a way to get ThreadUid based on the provided UserUid? Seems impossible...</p>\n\n<h2>------------</h2>\n\n<p>If the UserUid is K1 and N1\nResult will be 111</p>\n\n<p>If the UserUid is K1 and T1\nResult will be empty</p>\n\n<p>If the UserUid is N1 and E1\nResult will be 444</p>\n"},{"tags":["sql-server-2008","ssrs-2008","bids"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":12890074,"title":"Query not working in SSRS 2008, or BIDS 2008, but does in SSMS","body":"<h1>Environment</h1>\n\n<hr>\n\n<h3>DB Server (DWH prod &amp; dev + SSRS prod)</h3>\n\n<ul>\n<li>Win XP SP3</li>\n<li>SQL Server 2008 Ent</li>\n<li>Corporate LAN</li>\n<li>No remote query timeout restrictions for DWH, i.e. they are set to <code>0</code></li>\n<li><code>600</code> seconds for remote query timeout set for the SSRS DB server</li>\n<li>No restrictions on concurrent connections, i.e. they are set to <code>0</code></li>\n<li>TCP/IP <code>KeepAlive</code> property for the SQL Servers = <code>30000</code></li>\n</ul>\n\n<h3>Dev Box</h3>\n\n<ul>\n<li>Win XP SP3</li>\n<li>BIDS 2008</li>\n</ul>\n\n<h3>Shared Data Source (used by the .rdl)</h3>\n\n<ul>\n<li>Uses the machine name for the server, no aliases</li>\n<li>Permissions are all ok</li>\n</ul>\n\n<p><br/></p>\n\n<h1>Problem</h1>\n\n<hr>\n\n<p>The error returned by BIDS when looking at the 'Preview' tab of the report comes up with this after about 1 minute (the query takes ~1 min 10 seconds in SSMS - <strong>Edit: 2012-10-16</strong> Have now replicated error in SSRS itself by deploying report to Report Manager and attempting to run the report: <em>exception stack trace added below</em>):</p>\n\n<blockquote>\n  <p>An error occurred during local report processing.</p>\n  \n  <p>An error has occurred during report processing.</p>\n  \n  <p>Query execution failed for dataset 'MainData'.</p>\n  \n  <p>A transport-level error has occurred when receiving results from the server. (provider: TCP Provider, error: 0 - The specified network name is no longer available.)</p>\n</blockquote>\n\n<ul>\n<li>The query has been tested, with the end-user account that has <code>db_datareader</code> permissions, against both prod and dev db servers, and works fine in SSMS.</li>\n<li>This account is used for execution of the .rdl at runtime by end-users.</li>\n<li>SSMS was used to verify the queries are syntactically correct, and returned a full and complete result set with no errors and no warnings.</li>\n</ul>\n\n<p><br/></p>\n\n<h1>The Query Structure (listed as such for brevity)</h1>\n\n<hr>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\nSET NOCOUNT ON\nSET ANSI_WARNINGS OFF\n\n/********************************************************** \n    CTE to be used to clean strings\n***********************************************************/\n;WITH\n    CTE_1           AS  ( SELECT SomeData )\n    ,CTE_2          AS  ( SELECT SomeData )\n    ,Recursive_CTE  AS  ( SELECT SomeData )     -- String cleaning performed here\n    ,CTE_3          AS  ( SELECT SomeData )\n\n/**************************     \n Data set returned here\n***************************/\nSELECT\n    Column_1\n    ,Column_2\n    ,Column_3\n    .\n    .\n    .\n    ,Column_n\nFROM\n    Fact\n    INNER JOIN  Dimension_1     AS 1        ON Fact.Key_1   = 1.Key_1\n    INNER JOIN  Dimension_2     AS 2        ON Fact.Key_2   = 2.Key_2\n    INNER JOIN  Dimension_3     AS 3        ON Fact.Key_4   = 3.Key_3\n    INNER JOIN  Dimension_5     AS 4        ON Fact.Key_4   = 4.Key_4\n    LEFT JOIN   CTE_3           AS clean    ON 4.Key_4      = clean.Key_4   -- Clean names returned in query and used in GROUP BY clause    \nWHERE\n    Condition_1 = Test_1\n    AND Condition_2 = Test_2\n    AND Condition_3 = Test_3\n    .\n    .\n    .\n    AND Condition_n = Test_n\nGROUP BY\n    Group_1 \n    ,Group_2\n    ,Group_3\n    .\n    .\n    .\n    ,Group_n\nORDER BY\n    Group_1 \n    ,Group_2\n    ,Group_3\n    .\n    .\n    .\n    ,Group_n\n</code></pre>\n\n<p><br/></p>\n\n<h3>Notes (not sure if any of this will be helpful or not):</h3>\n\n<ul>\n<li>The recursive CTE only carries out 24 recursions.</li>\n<li>All keys are <code>PRIMARY KEY CLUSTERED INDEXES</code></li>\n</ul>\n\n<p><br/></p>\n\n<h1>Question(s)</h1>\n\n<hr>\n\n<ol>\n<li>Where to look to start diagnosing what the issue actually is?</li>\n<li>How to fix the issue once it is identified?</li>\n</ol>\n\n<p><br/></p>\n\n<h1>What I have done so far...</h1>\n\n<hr>\n\n<p><strong>2012-10-15</strong></p>\n\n<ul>\n<li>Hunted on the Google machine to no avail.</li>\n<li>Spoke with other team members who have seen this occur, and they think it may be performance related, i.e. query is taking too long to run, or they think there may be stricter SQL code validation/syntax checking carried out by SSRS, or the connectors it uses.</li>\n</ul>\n\n<hr>\n\n<p><strong>2012-10-16</strong></p>\n\n<pre><code>ERROR: Throwing Microsoft.ReportingServices.ReportProcessing.ReportProcessingException: Query execution failed for dataset 'DataSet1'., ;\n Info: Microsoft.ReportingServices.ReportProcessing.ReportProcessingException: Query execution failed for dataset 'DataSet1'. ---&gt; System.Data.SqlClient.SqlException: A transport-level error has occurred when receiving results from the server. (provider: TCP Provider, error: 0 - The specified network name is no longer available.)\n   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj)\n   at System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error)\n   at System.Data.SqlClient.TdsParserStateObject.ReadSni(DbAsyncResult asyncResult, TdsParserStateObject stateObj)\n   at System.Data.SqlClient.TdsParserStateObject.ReadNetworkPacket()\n   at System.Data.SqlClient.TdsParserStateObject.ReadBuffer()\n   at System.Data.SqlClient.TdsParserStateObject.ReadByte()\n   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\n   at System.Data.SqlClient.SqlDataReader.ConsumeMetaData()\n   at System.Data.SqlClient.SqlDataReader.get_MetaData()\n   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\n   at System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior behavior)\n   at Microsoft.ReportingServices.DataExtensions.SqlCommandWrapperExtension.ExecuteReader(CommandBehavior behavior)\n   at Microsoft.ReportingServices.OnDemandProcessing.RuntimeDataSet.RunDataSetQuery()\n   --- End of inner exception stack trace ---\n</code></pre>\n\n<ul>\n<li>The above exception occurs multiple times in the log for the same dataset -> Possible cause could be the recursion in the CTE??</li>\n<li>I've checked TCP/IP settings at the DWH DB Server and SSRS DB Server levels. Both have the <code>KeepAlive</code> property set to <code>30000</code>, i.e. 30 seconds -> Possible cause of dropping the connection?</li>\n<li>Similar issue resolution (based on stack trace) found <a href=\"http://support.microsoft.com/kb/555938\" rel=\"nofollow\">here</a> for queries against Visual Studio 2005. I de-selected <code>Tools &gt; Options &gt; Database Tools &gt; Query and View Designers &gt; Cancel long running query</code> (it was set to 30 seconds). No change (nor would this client setting affect the report once deployed to the SSRS server I believe, but thought I'd give it a shot)</li>\n<li>Found <a href=\"http://blogs.msdn.com/b/sql_protocols/archive/2005/09/28/474698.aspx\" rel=\"nofollow\">this</a> that states <code>OBDC connection attempt when server is not ready to process a new local connection, possibly due to overload</code> -> Could recursive CTE's cause an overload like this when SSRS submits the query to the DWH server (even though I'm not making an ODBC conenction)??</li>\n<li>Found <a href=\"http://www.sqlservercentral.com/Forums/Topic652500-147-1.aspx#bm653337\" rel=\"nofollow\">this</a> that states SSRS doesn't like virtual tables (doesn't mention why, and provides no reference) -> Possible re-write of query required?</li>\n<li>Responded to comments re: network diagnostics</li>\n</ul>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":12904087,"title":"Delete script SQL Server 2008","body":"<p>Here is a situation that I am trying to resolve. I have a table that is loaded with duplicates. It happened because similar rows were loaded from two different sources. That is being taken care of in the package.</p>\n\n<p>But I want to delete those rows which are duplicates. There is no key attribute here (I can't use no PK). The two <strong>sources</strong> are Cleveland City and Ohio State. And I have a column that shows from which source the row was loaded from (<code>DataSource</code> column).</p>\n\n<p>Thus in the row it shows as <code>DataSource = 'Cleveland'</code> or <code>DataSource = 'OhioState'</code>.</p>\n\n<p>Below is a sample which I am stuck with. Could you guys have a different approach to delete those rows mine doesn't seem to be working well? Thanks again guys .. I don't think the way I am trying to approach is even correct...</p>\n\n<pre><code>    IF OBJECT_ID('tempdb..#Ohio') IS NOT NULL \n     BEGIN \n     DROP TABLE #Ohio\n     END \n\n  ;WITH Oh AS \n    ( SELECT ROW_NUMBER()OVER\n      (\n        PARTITION by UID,ADDRESS,CITY,STATE,Zip\n          ORDER BY \n            UID\n       ) AS IA,UID,ADDRESS,City,State,Zip FROM F_staRes\n     ) \n    SELECT * INTO #Ohio   FROM Oh WHERE IA&gt; 1   AND  DataSource='Ohio'  \n\n    IF OBJECT_ID('tempdb..#Clevland') IS NOT NULL \n    BEGIN \n   DROP TABLE #Clevland\n   END \n\n    ;WITH Cle AS \n     ( SELECT ROW_NUMBER()OVER\n      (\n           PARTITION by UID,ADDRESS,CITY,STATE,Zip\n       ORDER BY \n        UID\n         ) AS CE,UID,ADDRESS,City,State,Zip FROM F_staRes\n         ) \n   SELECT * INTO #Clevland   FROM Cle WHERE CE&gt; 1  AND  DataSource!='Ohio' \n\n    select * from #Clevland--I want to delete this records\n     Intersect \n     select * from #Ohio\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12905699,"title":"SQL Server - Query to return groups with multiple distinct records","body":"<p>My table:</p>\n\n<pre><code>Col1    Col2\n1       xyz\n1       abc\n2       abc\n3       yyy\n4       zzz\n4       zzz\n</code></pre>\n\n<p>I have a table with two columns. I want to query for records where col1 has more than one DISTINCT col2 values. In the example table given above, the query should return records for col1 with value \"1\".</p>\n\n<p>Expected query result: </p>\n\n<pre><code>Col1    Col2 \n1       xyz \n1       abc\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12906949,"title":"How elimate the tab space in the column in SQL Server 2008","body":"<p>I have an column with email in table <code>customer</code> where the data in the column contains special character: TAB</p>\n\n<p>When I do a select, I need to remove the TAB space from that column.</p>\n\n<p>Means there is an empty TAB space followed by the <strong>EmailID:     xyz.com</strong></p>\n\n<p>I tried using the <code>LTRIM</code> and <code>RTRIM</code> but that does not work here</p>\n\n<p>Your help is really appreciated.</p>\n\n<p>Thanks\nPrince</p>\n"},{"tags":["sql-server-2008","ms-access-2007"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12907007,"title":"How to order by frequency without aggregating?","body":"<p>Overview: <br>Compare day to day trades for produce as agent for various accounts to find difference between agent and company holdings showing only what is new; codes in current trades, but not previous trades.</p>\n\n<p>Objective: <br>Sort the trades by code (i.e. apples) with highest frequency.</p>\n\n<p>Current Code:</p>\n\n<pre><code>SELECT \n    Count(CurrentTrade.Code) AS CountOfCode, \n    CurrentTrade.portfolio_code, \n    CurrentTrade.Type, \n    CurrentTrade.Code, \n    sum(CurrentTrade.Custodian_holding) AS AgentHolding, \n    sum(CurrentTrade.Company_holding) AS CompanyHolding, \n    sum(CurrentTrade.Difference) AS TotalDifference\nFROM \n    CurrentTrade \n    LEFT JOIN PrevTrade \n    ON CurrentTrade.Company_holding = PrevTrade.Company_holding\nWHERE \n    PrevTrade.Company_holding) Is Null\nGROUP BY CurrentTrade.Code, CurrentTrade.portfolio_code, CurrentTrade.Code, CurrentTrade.Type\nORDER BY count(CurrentTrade.Code);\n</code></pre>\n\n<p>Current Results:</p>\n\n<pre><code> CountOfCode        account_code        Type        Code        AgentHodling        CompanyHolding        TotalDifference\n 1                  acc001049        prod        mango        2500                  0        2500\n 1                  acc636903        prod        mango        481081.29        481081.285        0.01\n 1                  acc179186        prod        mango        453639.61        511285.81        -57646.2\n 1                  acc179185        prod        mango        2775               2650        125\n 1                  acc170001        prod        grapes       0                     1500        -1500\n 1                  acc170000        prod        grapes       2500        0        2500\n 1                  acc107104        prod        apple        49797.22        49797.28        -0.06\n 1                  acc107103        prod        apple        0        -0.06        0.06\n 1                  acc107102        prod        apple        2000        500        1500\n 1                  acc107101        prod        apple        0        1500        -1500\n 1                  acc001189        prod        apple        0        1090.513        -1090.513\n</code></pre>\n\n<p>Reference:</p>\n\n<p>I received an answer to this (<a href=\"http://stackoverflow.com/questions/12888829/order-by-count-not-sorting-correctly-sql-ms-access-2007\">Order by count not sorting correctly - SQL (MS Access 2007)</a>) so this is a follow up.</p>\n\n<p>Question:</p>\n\n<p>Is it possible to order by frequency without aggregating all of the the results and still show order by highest frequency (apple, mango, grapes) including the account numbers associated?  <br>If use sum for the order by, “Cannot have aggregate function in ORDER BY” so I'm not sure I can do this and still keep the account numbers separate?</p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":117,"score":2,"question_id":12850524,"title":"SSRS - Grand Total of Group Expression Totals","body":"<p>My group total is an expression which subtracts the last <code>[Hours1]</code> value from the first <code>[Hours1]</code> value of the group <code>[EquipmentName1]</code> of the dataset \"dataset1.</p>\n\n<p>I need a Grand Total the group expression totals for each piece of equipment</p>\n\n<p>I am unable to use the same formula of subtracting last [Hours1] value from the first [Hours1] value of the dataset \"dataset1\" because.</p>\n\n<p>If I had 2 pieces of equipment, say Equipment1 and Equipment2:</p>\n\n\n\n<pre class=\"lang-none prettyprint-override\"><code>Equipment1 last [Hours1] = 10000 and first [Hours1] = 9500\nEquipment2 last [Hours1] = 10500 and first [Hours1] = 10000\n</code></pre>\n\n<p>If I used the formula of subtracting last <code>[Hours1]</code> value from the first <code>[Hours1]</code> value of the dataset <code>\"dataset1\"</code> the formula would be 10500 - 9500</p>\n\n<p>However, I want:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>(10000 - 9500) + (10500 - 10000) = Grand Total\n</code></pre>\n\n<p>Below is an attempt to draw part of my table</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>|_[Hours1]_|  =  Fields!Hours1.Value    \n(e.g. 9500)\n\n|___Expr___|  =  Last(Fields!Hours1.Value) - First(Fields!Hours1.Value) \n(e.g. 10000 - 9500 = 500)\n\n|__________|  =  I need to total the value of Expr for all pieces of equipment\n</code></pre>\n"},{"tags":["performance","sql-server-2008","stored-procedures","jdbc","clr"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12869062,"title":"SQL Server 2008 x64 Express Batch Insert Throughput Performance to CLR 'Instead Of Insert' Trigger","body":"<p>I have a simple NO-OP CLR Trigger being fired on a six field table with schema:</p>\n\n<pre><code> datetime (PK)\n char (PK)\n int (PK, FK)\n varchar(1)\n tinyint\n real\n</code></pre>\n\n<p>which should be a total of 19 bytes / row inserted.</p>\n\n<p>The FK in the above points to a table with schema:</p>\n\n<pre><code> int (PK)\n nchar(10)\n ncahr(10)\n nchar(10)\n nchar(10)\n</code></pre>\n\n<p>I am performing batch inserts using a prepared statement every 1000 rows. I am getting for 150K rows inserted an execution time of about 11s. This corresponds to a throughput of ~.24MB/s (150,000*19B / 11s). Why so slow? I am not even talking to the disk?</p>\n\n<p>I know that my client side code doing the sending is much faster. If I comment out the:</p>\n\n<pre><code> executeBatch()\n</code></pre>\n\n<p>method in the client I get upwards of 5MB/s. What else is going on with the JDBC/ODBC connection and processing in SQL Server to make things so slow?</p>\n\n<p>Is this really the throughput one can expect from SQL Server and an JDBC/ODBC connection in this case?</p>\n\n<p>---EDIT---</p>\n\n<p>The actual CLR code is very simple, literally an empty method:</p>\n\n<pre><code> public class Triggers\n {\n     [SqlTrigger(Name = \"InsertHook\", Target = ConfigConstants.TABLE_NAME, Event =   \"INSTEAD OF INSERT\")]\n     public static void InsertHook()\n     {\n       //empty\n     }\n }\n</code></pre>\n\n<blockquote>\n  <p>No-op in T-SQL Stored Procedure Total Measured Time was:3475297036ns\n  or 3.475297036sec INSERT COUNT:150000\n  0.783276657MB/s\n  43165.47 Rows/s</p>\n  \n  <p>INSERTING NORMAL into SQL Server Total Measured Time was:4884190118ns\n  or 4.884190118sec INSERT COUNT:150000 MB Sent:2.7179718017578125\n  0.556MB/s\n  30712.53 Rows/s</p>\n</blockquote>\n\n<p>Sadly, I do not have control over the schemas I am working with here. I guess I am still shocked that even with one FK constraint that this is the best SQL Server can do?</p>\n\n<p>In summary, if I had to rank the performance. It would be:</p>\n\n<blockquote>\n  <p>1) T-SQL NO-OP Instead of Trigger (Fastest) - 0.78MB/s  </p>\n  \n  <p>2) Inserting Normal - 0.56MB/s </p>\n  \n  <p>3) CLR NO-OP Stored Procedure Instead of Trigger - .24MB/s</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":614,"score":1,"question_id":8912813,"title":"SQL Server 2008 Pivot Query","body":"<p>I have data in a SQL Server 2008 table that looks like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/bh7TV.png\" alt=\"enter image description here\"></p>\n\n<p>I want to pivot it to look like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/85Tl2.png\" alt=\"enter image description here\"></p>\n\n<p>Basically I want to group on ReadTime and Coater and then pivot on the DataType column. Could someone help me with the T-SQL to do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":89,"score":1,"question_id":12900658,"title":"How to get level and count for item in recursive query","body":"<pre><code>WITH cte(folder_id, parent_id, folder_name)\nAS\n(\n    select folder.folder_id, folder.parent_id, folder.folder_name\n    FROM Folder_Table [folder] \n        JOIN File_Table [file] on [folder].[folder_id] = [file].[folder_id]\n    union all\n    select Folder_Table.folder_id,Folder_Table.parent_id,Folder_Table.folder_name\n    from cte \n        join Folder_Table on cte.parent_id = Folder_Table.folder_id\n)\nSELECT distinct * FROM cte\n</code></pre>\n\n<p>at this query i need to get the level of items and the count of child at the level \nif have child </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12905041,"title":"SQL update entry that matches a username and has highest date","body":"<p>I have a table <code>saved_offers</code> in my database. What I want to do is find all of the entires that match a username, and within those results, the one that has the highest <code>date</code> field.</p>\n\n<p>Here's a simpler example: say we have a table <code>baseball_players</code>. I want to find the player who plays for the Yankees with the highest batting average, and update his <code>description</code> field to say \"has the highest batting average\".</p>\n\n<p>I'm not a SQL guru by any means, so I apologize if this is overly easy.</p>\n\n<p>I've tried just about every combination of nested SELECTs and ORDERBY's in my update statement, but so far I'm not able to find a command that works.</p>\n"},{"tags":["asp.net","sql","vb.net","sql-server-2008","charts"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12630951,"title":"Populate new chart on ReportViewer1 with SQL query information","body":"<p>I am completely new to Charts in asp.net so bear with me, I have been reading multiple multiple webpages on how bind data to the charts but I still can not get anything to show up. </p>\n\n<p>I know this probably isnt the first instance of this question, but I cant figure this out to save my life. Im hoping with a little nudge I wont need any help on this topic after this.</p>\n\n<p>Say I have a dropdown and this drop down has two items in it. On Dropdown_IndexChange it will change the data source of chart1 that is located in ReportViewer (The database is going to be local). </p>\n\n<p>Index 0 creates a bar chart with the SQL Command: \n\"SELECT [SWversion:], [Batt_Wifi:], [Batt_Standby:], [Batt_OnCall:] FROM Amaze\"</p>\n\n<p>where SWVersion are the names of the series and the other 3 are the data.</p>\n\n<p>Index 1 creates a line chart with the sql command:\n\"SELECT [SWversion:], [Wifi_Pref_IC:], [Wifi_Pref_NC:], [Wifi_Only_IC:], [Wifi_Only_NC:] FROM Amaze\"</p>\n\n<p>SWVersion works the same way here as well. </p>\n\n<p>How can I get these charts to show up and how can I attach SWVersion names to the series.</p>\n\n<p>The code I am trying to work with is this:</p>\n\n<pre><code>    Chart1.DataSource = Nothing\n    Chart1.Visible = True\n    Dim newsqlcommand As String = \"SELECT [Batt_Wifi:], [Batt_Standby:], [Batt_OnCall:] FROM Amaze\"\n    Using con As New System.Data.SqlClient.SqlConnection(connexstring)\n        con.Open()      \n        Dim myCommand = New SqlDataAdapter(newsqlcommand, con)\n        Dim ds = New DataSet()\n        myCommand.Fill(ds)\n        Chart1.DataSource = myCommand\n        con.Close()\n        con.Dispose()\n    End Using\n    Chart1.DataBind()\n</code></pre>\n\n<p>I know this is only one of the SQL Commands but Im still trying to figure out how it works. I don't recieve an error, but with this I can't even get a chart to draw.</p>\n\n<p>Thanks for any and all help </p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":170,"score":3,"question_id":6796699,"title":"Determine if a couple of zip codes are contiguous","body":"<p>My customer has sales regions where each sales region consists of a list of zip codes.\nThe regions are pretty big and could be easier stored in format like :</p>\n\n<p>Region consists of zip code range from 00602 to 10012 and 20020 to 30020.</p>\n\n<p>How can I get from a list of zip codes to a list of such zip code ranges?</p>\n\n<p><strong>Consider the following data</strong></p>\n\n<pre><code>--This would be my list of all available zip codes in us:\n\nCREATE TABLE [Zip](\n    [Zip] [nvarchar](20) ,\n    [State] [nvarchar](50) ,\n)\n\n--This would be the Sales Region List\n\nCREATE TABLE [dbo].[SalesRegion](\n    [AreaCode] [nvarchar](50) \n) \n\n--This would be the original large list Zip Codes for the SalesRegions\n\nCREATE TABLE [dbo].[EnteredZip](\n    [Zip] [nvarchar](20) ,\n    [AreaCode] [nvarchar](50) \n) \n\n--This is where I would like to store the Zip Code Ranges\n\nCREATE TABLE [dbo].[SearchableZip](\n    [StartZip] [nvarchar](20) ,\n    [EndZip] [nvarchar](20) ,\n    [AreaCode] [nvarchar](50) \n) \n\n--Here is my sample Data:\n\n--Some Zip Codes in US\ninsert into dbo.Zip (Zip,[State]) values ('00501'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00544'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00601'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00602'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00603'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00604'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00605'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00606'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00610'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00611'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00612'   ,'PR')\n\n\n--Some Sales Regions\n\nInsert Into dbo.SalesRegion ( AreaCode ) values('Area1')\nInsert Into dbo.SalesRegion ( AreaCode ) values('Area2')\nInsert Into dbo.SalesRegion ( AreaCode ) values('Area3')\n\n\n--The zip codes of the Sales Regions\ninsert Into EnteredZip (Zip,AreaCode) values ('00544' , 'Area1')\ninsert Into EnteredZip (Zip,AreaCode) values ('00601' , 'Area1')\ninsert Into EnteredZip (Zip,AreaCode) values ('00602' , 'Area1')\n\ninsert Into EnteredZip (Zip,AreaCode) values ('00604' , 'Area2')\ninsert Into EnteredZip (Zip,AreaCode) values ('00606' , 'Area2')\n\ninsert Into EnteredZip (Zip,AreaCode) values ('00501' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00544' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00601' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00602' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00603' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00604' , 'Area3')\n\ninsert Into EnteredZip (Zip,AreaCode) values ('00610' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00611' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00612' , 'Area3')\n</code></pre>\n\n<p>Would result in this entries in the table SearchableZip</p>\n\n<pre><code>AreaCode             StartZip             EndZip\n-------------------- -------------------- -------------------------\nArea1                00544                00602\nArea2                00604                00604\nArea2                00606                00606\nArea3                00501                00604\nArea3                00610                00612\n</code></pre>\n\n<p>Is it possible to create SearchableZip with a sql script?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I fixed the table declaration and output data</p>\n"},{"tags":["android","sql-server","web-services","sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":55,"score":-5,"question_id":12903362,"title":"Andriod connection for SQL Server","body":"<p>I m writing an android application , that should interacts with the SQL server 2008.</p>\n\n<p>I understand in order to get the database connection , I would have to create a webservice.</p>\n\n<p>I m very new to both Android and Web service. Any link or document in this concern would be of great help.</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["sql-server","sql-server-2008","merge","case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12903276,"title":"SQL Server Merge with case?","body":"<p>Hello guys here with another question, regarding sql server 2008 r2 this time about the merge, is it possible to have a case inside the update portion of the merge?</p>\n\n<p>Because its telling me</p>\n\n<p>Msg 156, Level 15, State 1, Line 9\nIncorrect syntax near the keyword 'CASE'.</p>\n\n<pre><code>MERGE INTO PERSONAFISICA AS TARGET\nUSING dbo.#temp1 AS SOURCE\nON TARGET.RFC = SOURCE.RFC AND TARGET.APATERNO = SOURCE.APELLIDO_PATERNO AND\nTARGET.AMATERNO = SOURCE.Apellido_Materno\nWHEN MATCHED THEN\nUPDATE SET\nTARGET.NUM_CLIENTE = 0,\nTARGET.NOMBRE1 = LEFT(SOURCE.Nombre,CHARINDEX(' ', SOURCE.NOMBRE + ' ') -1),\nCASE \nWHEN LEN(SOURCE.NOMBRE) - LEN(REPLACE(SOURCE.NOMBRE,' ','')) &gt;= 1\nTHEN \nTARGET.NOMBRE2 = SUBSTRING(SOURCE.NOMBRE, CHARINDEX(' ', SOURCE.NOMBRE)+1, LEN(SOURCE.NOMBRE))\nELSE '' END,\nTARGET.APATERNO = SOURCE.Apellido_Paterno,\nTARGET.AMTERNO = SOURCE.Apellido_Materno,\nCASE \nWHEN SOURCE.SEXO = 'F' \nTHEN TARGET.IDGENERO = 2\nWHEN SOURCE.SEXO = 'M'\nTHEN TARGET.IDGENERO = 1\nELSE TARGET.IDGENERO = 0\nEND,\nCASE\nWHEN SOURCE.ESTADO_CIVIL = '0' \nTHEN TARGET.idestado_civil = 0\nWHEN SOURCE.ESTADO_CIVIL = 'C'\nTHEN TARGET.idestado_civil = 1\nWHEN SOURCE.ESTADO_CIVIL = 'D' \nTHEN TARGET.idestado_civil = 2\nWHEN SOURCE.ESTADO_CIVIL = 'S'\nTHEN TARGET.idestado_civil = 3\nWHEN SOURCE.ESTADO_CIVIL = 'V' \nTHEN TARGET.idestado_civil = 5\nWHEN SOURCE.ESTADO_CIVIL = 'U'\nTHEN TARGET.idestado_civil = 6\nELSE TARGET.idestado_civil = 0\nEND,\nTARGET.idregimen = 0,\nTARGET.saludo = SOURCE.SALUDO,\nTARGET.conyuge_nombre1 = '',\nTARGET.conyuge_nombre2 = '',\nTARGET.conyuge_apaterno = '',\nTARGET.conyuge_nombre2 = '',\nTARGET.dependiente = 0,\nTARGET.edad_dependiente = '',\nTARGET.ididentificacion = 0,\nTARGET.fecha_nacimiento = '1800-01-01',\nTARGET.rfc = SOURCE.RFC,\nTARGET.CURP = '',\nTARGET.idnacionalidad = 0,\nTARGET.email = SOURCE.Email_Personal,\nTARGET.idescolaridad = SOURCE.Escolaridad\nWHEN NOT MATCHED THEN\nINSERT (num_cliente, nombre1, nombre2, apaterno, amaterno, idgenero, idestado_civil,\nidregimen, saludo, conyuge_nombre1, conyuge_nombre2, conyuge_apaterno, conyuge_amaterno, dependiente,\nedad_dependiente, ididentificacion, fecha_nacimiento, rfc, curp, idnacionalidad, email, idescolaridad)\nVALUES (0, LEFT(nombre,CHARINDEX(' ',nombre + ' ')-1) AS [Primer Nombre],\nCASE WHEN LEN(nombre) - LEN(REPLACE(nombre,' ','')) &gt;= 1  THEN SUBSTRING(nombre, CHARINDEX(' ', nombre)+1, LEN(nombre)) ELSE '' END AS [Segundo Nombre],\nApellido_Paterno,Apellido_Materno)\nCASE \nWHEN SEXO = 'F' THEN 2\nWHEN SEXO = 'M' THEN 1\nELSE 0\nEND,\nCASE \nWHEN Estado_Civil = '0' THEN 0\nWHEN Estado_Civil = 'C' THEN 1\nWHEN Estado_Civil = 'D' THEN 2\nWHEN Estado_Civil = 'S' THEN 3\nWHEN Estado_Civil = 'V' THEN 5\nWHEN Estado_Civil = 'U' THEN 6\nELSE 0\nEND, 0, Saludo,'','','','',0,'',0,'1800-01-01',RFC,'',0,Email_Personal,Escolaridad\n</code></pre>\n"},{"tags":["c#","winforms","visual-studio-2010","sql-server-2008","ssms2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12902919,"title":"Automatically import table columns into form design","body":"<p>So far, I found C# on SQL Server impressively easy to develop with (when relying on the IDEs to walk you through completion).</p>\n\n<p>So it comes as no surprise that I expect a feature that may or may not be available with Visual Studio 2010 &amp; SQL Server 2008 Express:</p>\n\n<p>Instead of manually dragging <code>TextBox</code>es from the ToolBar into the Windows Form, then typing their names, etc. to associate them with a fields/columns in a table... is it possible to tell Visual Studio to automatically populate the form with <strong>all</strong> columns from a particular table?</p>\n\n<p>If so, how does one accomplishes that?</p>\n"},{"tags":["sql-server","sql-server-2008","amazon-ec2","ec2-ami"],"answer_count":6,"favorite_count":3,"up_vote_count":12,"down_vote_count":0,"view_count":4720,"score":12,"question_id":2781128,"title":"Amazon EC2 Instance - How to find SQL Server Password","body":"<p>I have created an Amazon EC2 Instance that provides Windows Server 2008 with SQL Sever 2008 pre-installed. Now in order to use the SQL Server for creating databases, or restoring backups of the databases that I have on my local machine, I need the \"sa\" password for SQL Server 2008.</p>\n\n<p>I have tried using the following but with no luck:</p>\n\n<ol>\n<li>sa</li>\n<li>password</li>\n<li>\"blank password\"</li>\n<li>\"same password as the admin password for my EC2 instance\"</li>\n</ol>\n\n<p>Could someone please guide me as to how to get started with using the Amazon EC2 Datacenter with respect to the \"sa\" password. </p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12902852,"title":"Does Count (*) skew desired results when performing additional join?","body":"<p>My query works fine; however, I need to join another dataset to my query, and I expect that the <code>count(f.*)</code> will break.</p>\n\n<p>Here's the query I start with:</p>\n\n<pre><code>SELECT\n       MIN(received_date) AS FirstVisit\n     , patient_id         AS PatientID\nINTO #LookupTable\nFROM F_ACCESSION_DAILY\n\nSELECT \n       f.doctor           AS Doctor\n     , COUNT(f.*)         AS CountNewPatients\n     , MONTH(firstvisit)  AS Month\n     , YEAR(firstvisit)   AS Year\nFROM F_ACCESSION_DAILY f \nINNER JOIN #LookupTable l ON f.received_date = l.FirstVisit \n                         AND f.patient_id = l.PatientID\nGROUP BY f.doctor\n       , MONTH(firstvisit)\n       , YEAR(firstvisit)\n\nDROP TABLE #LookupTable\n</code></pre>\n\n<p>I would like to Join the above query on another table. </p>\n\n<p>The question is <strong>*<em>will my <code>count(f.*)</code> stay the same or will it change because I've added a new dataset?</em>*</strong></p>\n\n<p>*<strong>*How do I make sure that the <code>count(f.*)</code> will remain the same?</strong></p>\n\n<p>Thank you so much for your guidance.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":11154225,"title":"SQL aggregation functions","body":"<p>Given the following table </p>\n\n<pre>Month        Product  Sales\n---------    -------  -----    \nJanuary         1      10\nJanuary         2      15\nFebruary        3      23\nMarch           1      15</pre>\n\n<p>The query I've used is:</p>\n\n<pre><code>SELECT DISTINCT a.* FROM( -- possibly needed for where clause\n    SELECT dateadd(month, x.MonthOffset,0) AS mes, x.produto, Sum(x.quantidade) AS vendas\n    FROM\n    (\n        SELECT DATEDIFF(month, 0, a.data) AS MonthOffset, a.produto, a.quantidade\n        FROM (\n          SELECT l.*, fc.data FROM LINHAS AS l JOIN FacturaCli AS fc\n              ON fc.codigo = l.codigo \n              UNION ALL\n          SELECT l.*, ff.dataEmissão FROM LINHAS AS l JOIN FacturaForn AS ff\n              ON ff.codigo = l.codigo\n        ) AS a\n    ) AS x\n    GROUP BY MonthOffset, produto\n) AS a\n</code></pre>\n\n<p>I would like to get the product with more sales per month.</p>\n\n<p>I'm having trouble doing query that requires a field that must not be in \"aggregate group\".\nNote that the table I provided is a result from a query.</p>\n\n<p>I'm using SQL Server 2008. I can't use temporary variables or <code>over</code> clause.\n<strong>I wouldn't like to repeat the query that lead me to this table!</strong> But if it is the only way, it's ok.</p>\n\n<p>Expected result:</p>\n\n<pre>Month        Product  Sales\n---------    -------  -----    \nJanuary         2      15\nFebruary        3      23\nMarch           1      15</pre>\n"},{"tags":["sql-server","database","sql-server-2008","data"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12902001,"title":"Similar feature as virtual private databases for IBM DB2/SQL Server?","body":"<p>is there a similar feature as virtual private database (VPD) for IBM DB2 and SQL Server? (I know VPD is available for Oracle DB) What is the name of the tool/program that is an alternative for VPD for IBM and/or Microsoft? </p>\n"},{"tags":["sql-server-2008","tsql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12899827,"title":"Indenting records with space in a T-SQL stored procedure","body":"<p>I have a stored procedure that returns records based on a <code>Department ID</code>:  </p>\n\n<pre><code>Employee Name                ManagerID         SupervisorID                ID  \n    John Smith                  1                     1                      1  \n    Tom Jones                   1                     2                      2  \n    Robert Thompson             1                     2                      3\n    Jennifer Stevens            1                     4                      4  \n</code></pre>\n\n<p>I want to indent the records that are returned as follows:  </p>\n\n<ul>\n<li>If ManagerID = ID (no indentation)  </li>\n<li>If SupervisorID = ID (2 spaces indented)  </li>\n<li>Else (4 spaces indented)*</li>\n</ul>\n\n<p>Something like:</p>\n\n<pre><code>John Smith  \n   Tom Jones  \n       Robert Thompson  \n   Jennifer Stevens\n</code></pre>\n\n<p>How would I accomplish that?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3673,"score":1,"question_id":3159810,"title":"Token-based server access validation failed with an infrastructure error","body":"<p>I would appreciate help with the following issue:</p>\n\n<p>I have created a local group in our SQL 2008 server and added two Windows user accounts \"DOMAIN\\UserName\"  I  then added the local group to the database and granted read only access.</p>\n\n<p>The users are trying to link tables using MS Access using and ODBC connection and getting the following error.\nUsers are not system administrators.</p>\n\n<p>Date                      6/30/2010 1:01:54 PM\nLog                         SQL Server (Current - 6/30/2010 1:10:00 PM)\nSource                  Logon\nMessage\nLogin failed for user 'DOMAIN\\UserName'. Reason: Token-based server access validation failed with an infrastructure error. Check for previous errors. [CLIENT: 999.99.9.99]\n \nDate        6/30/2010 1:01:54 PM\nLog     SQL Server (Current - 7/1/2010 8:12:00 AM)</p>\n\n<p>Source      Logon</p>\n\n<p>Message\nError: 18456, Severity: 14, State: 11.</p>\n\n<p>Database Server:\nwindows Server 2008 R2 Enterprise \nSystem type: 64-bit Operating System \nSQL Server 2008</p>\n"},{"tags":["oracle","sql-server-2008","oracle10g"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12863579,"title":"vertical output","body":"<p>I have column name in the table:</p>\n\n<pre><code>select LASTNAME\n  FROM dbo.Employees\n WHERE LASTNAME = 'Smith'\n</code></pre>\n\n<p>and output of the above query is</p>\n\n<pre><code>LASTNAME\nSmith\n</code></pre>\n\n<p>I want output like</p>\n\n<pre><code>   LASTNAME\n      S\n      m\n      i\n      t\n      h\n</code></pre>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12899215,"title":"SSRS 2008 R2 on Server 2008 XML Data extension error","body":"<p>I have an MVC 3 project that shows soem reports through SSRS.  I have everythign set up on a Windows 7 computer and it works fine.  We just installed Server 2008 on a new computer and I am trygin to get everythign running through IIS.  Everythign works fine except for the Data Source that I use for the reports.  I have it grabbing XML data from a Web Service to show in the report.  When I deploy all the report information to the Server 2008 SQL instance I get the following error when I look at the Data Source.</p>\n\n<p>The data processing extension used for this report is not available. It has either been uninstalled, or it is not configured correctly.</p>\n\n<p>If I lookin the Data Source Type dropdown the only option is SQL Server.  XML is not listed.  What do I need to do.  From what I read XML was supposed to be supported automatically without any setup.</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures","csv"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12900076,"title":"How to work with CSV values in stored procedure?","body":"<p>I have CSV values stored in string as:</p>\n\n<pre><code>    StringBuilder CSValue = new StringBuilder();\n    for (int i = 0; i &lt; obj._contactNumbers.Count; i++)\n    {\n        CSValue.Append(obj._contactNumbers[i]);\n        if (i != obj._contactNumbers.Count - 1)\n        {\n            CSValue.Append(\",\");\n        }\n    }\n</code></pre>\n\n<p>I have passed it to stored procedure (as CSValue.ToString()), now i have to pick each value and store it in cell. How should i seperate these values?? </p>\n\n<p>Please help me out!</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":12899635,"title":"SQL server 2008 concatenation","body":"<p>I am concatenating Address fields to put street address together in SELECT statement of  SQL Server 2008 R2. How do I use IIF/CASE statement to add 'Apt#' if apartment field is not null?</p>\n\n<pre><code>SELECT ISNULL(RTRIM(StreetNo),'') + ' ' \n    +  ISNULL(RTRIM(StPfx),'')+ ' ' \n    + ISNULL(RTRIM(Street),'')   + ' ' \n    + ISNULL(Stfx, ' ') + ' ' \n    + ISNULL(RTRIM(Apt),'') HOME_ADDRESS  \n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":12899727,"title":"SQL - Check if all the columns in one table also exist in another","body":"<p>I have 2 tables (say A and B) in a MS SQL DB representing customer transactions. Both share a column (say Column X).</p>\n\n<p>Ideally information in table B is a subset of information in table A.</p>\n\n<p>Can I run a SQL query to check based on Column X if all the values in Table B are present in Table A?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","tsql","tags"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12899619,"title":"GUID vs Identity for use with tags","body":"<p>I know this subject has been discussed at length (I have read lots of posts here and all over the web) and I don't like to flog a dead horse but I have a question about a more specific aspect of Integer ID vs GUID:</p>\n\n<p>I am writing out a schema which is going to have a tagging ability similar in use to the stackoverflow tags but it will have the same tags used against 5+ different tables.</p>\n\n<p>The basic tables I will be linking are as follows:</p>\n\n<p><strong>Tag Table</strong></p>\n\n<pre><code>Tag ID    Tag Name      Tag Description\n-------------------------------------------------------------\n     1    Hats          Tag for hats\n     2    Coats         Tag for coats\n     3    Gloves        Gloves tag\n     4    Ladies        Ladies item\n</code></pre>\n\n<p><strong>Items Table 1</strong></p>\n\n<pre><code>Item ID    Item Name    Cost\n------------------------------------------------------------\n      1    Deerstalker  £20.00\n      2    Fedora       £50.00\n      3    Scarf        £15.00\n</code></pre>\n\n<p>The bit I'm having trouble with is the <code>tag_item</code> table.</p>\n\n<p>I will have 5 tables with completely different structures that I want the users to be able to apply tags to so I think I'll need to do one of the following:</p>\n\n<ul>\n<li>Store <code>table name</code>/<code>table number</code> as well as the integer key of the row the tag relates to</li>\n<li>Store a <code>GUID</code> of the row, this will work independent of the table and make it much easier to get all tags for a certain row.</li>\n</ul>\n\n<p>What I'm unsure of is how this will affect performance for:</p>\n\n<ul>\n<li>Searching for all items over 5 tables with a certain tag/tags</li>\n<li>editing the tags for an item</li>\n<li>joins</li>\n</ul>\n\n<p>Is there any clearly better option in this case or anywhere I could read up on the advantages in this particular scenario?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":25,"score":-1,"question_id":12898763,"title":"Transaction Log Dates","body":"<p>I'm noticing that the dates on my MDF files are staying up to date (e.g. the Last Modified Date is current); however, the same date on the LDFs for the same databases have not changed in over a month. I've confirmed that the files are indeed the ones being used but I'm very surprised that the dates are not current. We are doing regualr standard maintenance on all of the databases.</p>\n\n<p>My question is more academic than functional. Why would these dates get out of synch?</p>\n"},{"tags":["sql-server-2008","openrowset"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":50,"score":-1,"question_id":12897096,"title":"Importing dates from Excel 2007 to sql server 2008 is not importing 'seconds' portion into the db table","body":"<p>In Excel, If I keep the cell formatting as 'Text' and import mixed type data (dates,string,int etc) from excel to sql server (I am using OpenDataSource for import), then the 'seconds' portion of the date (02/27/12 07:00:04) gets imported successfully to the database table as the case should be. </p>\n\n<p>However, when I am exporting mixed type data (dates,string,int etc) from Sql Server 2008 to Excel 2007 (I am using OpenRowSet for export), the cell formatting of the cells \nin Excel changes to 'General' automatically after the export. Now when I make any changes to a date in the excel (02/27/12 07:00:04), then the seconds portion disappears \nfrom the excel cell (2/27/2012 7:00) but can be seen in formula bar in the excel (2/27/2012  7:00:04 AM). Also, the cell formatting automatically changes to Custom\n(m/d/yyyy h:mm) on editing the cell. The issue is that when I try to import this modified data to sql server, the seconds portion does not get imported which causes data inconsistancy.</p>\n\n<p>Alternative I have already tried is as follows:\n1) I changed TypeGuessRows = 0 in registry([HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Jet\\4.0\\Engines\\Excel]) and added IMEX=1 to export query (as follows). But this has no \neffect.\n2) I changed Excel 8.0 in query to Excel 12.0 XML. This had no effect.</p>\n\n<p>Queries for Import/Export are as follows:</p>\n\n<p>Import Query is as follows:</p>\n\n<p>INSERT INTO [Fusion].flt_RealTimeValues\nSELECT [DowntimeValues ID],[Asset Name],[Start Date]\nFROM OPENDATASOURCE('Microsoft.ACE.OLEDB.12.0',\n'Data Source=C:\\ImportExport\\50370869_8837_4a79_809e_610aae98d925_import.xlsx;Excel 8.0;IMEX=1;HDR=Yes')...[DowntimeValues$]</p>\n\n<p>Export Query is as follows:\nThis is the dynamic query that gets populated at runtime. If required, I will provide the runtime query. </p>\n\n<p>SET @sql='INSERT INTO OPENROWSET (''Microsoft.ACE.OLEDB.12.0'', ''Excel 8.0;Database='+@FilePath+';HDR=YES'',''SELECT * FROM [' + @SheetName + '$]'''+')' +@StoredQuery  + ''  </p>\n\n<p>I would really appreciate help on this. </p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":92,"score":0,"question_id":12896147,"title":"Can I pass variable to select statement as column name in SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5637983/sql-select-dynamic-column-name-based-on-variable\">SQL: Select dynamic column name based on variable</a>  </p>\n</blockquote>\n\n\n\n<p>I have the following simple <code>select</code> statement:</p>\n\n<pre><code> DECLARE @value varchar(10) \n SET @value = 'intStep' \n\n SELECT @value FROM dbo.tblBatchDetail \n</code></pre>\n\n<p>I have tried </p>\n\n<pre><code> SELECT CAST(@value AS varchar(10)) FROM dbo.tblBatchDetail \n</code></pre>\n\n<p>and all I get a list of <code>intstep</code> </p>\n\n<p><strong>QUESTION</strong>: can I pass variable as column name to this statement? Or what is the best way of doing this </p>\n\n<p>I'm using SQL Server 2008 (9.0 RTM) </p>\n\n<p>This will be a stored procedure </p>\n\n<p>Thanks in advance </p>\n"},{"tags":["sql-server-2008","cdc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12896373,"title":"Creating CDC system table SQL Server 2008","body":"<p>I am facing problem with CDC tables in my database. I think few of these tables are damaged and are not capturing any audit information. I tried to disable CDC on these tables, but that did not work (I didn't even get an error). So I manually dropped a table.</p>\n\n<p>Now I cannot see the table in system tables - but its still not properly deleted. So I cannot re-enable it.</p>\n\n<p>I have got a fix here: <a href=\"http://support.microsoft.com/kb/966306\" rel=\"nofollow\">http://support.microsoft.com/kb/966306</a></p>\n\n<p>which is to manually create the CDC table of the same name in system tables - and retry disabling it.</p>\n\n<p>Now the question is how do I manually create a system table.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":763,"score":3,"question_id":7843399,"title":"Storing just Month and Year in SQL Server 2008?","body":"<p>Is it possible to save the month/year in SQL Server 2008 with a regular datetime?  I don't need a time stamp and the column is going to store unique mo/yr combinations (i.e. 10-11, 11-11, 12-11, etc,.).  </p>\n\n<p>Any recommendations?  </p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":44,"score":4,"question_id":12895090,"title":"what is the use of PLI keyword?","body":"<p>while writing some stored procedures in ms sql 2008, as I was typing some variable names I noticed that PLI was highlighted as a keyword.</p>\n\n<p>Does anyone have any idea what PLI is used for?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12851686,"title":"Who can help me to correct the below code?","body":"<p>I wrote the below code but when I run it the result wont \"Group by\" as I expect to be.could you help me to grouping the result.</p>\n\n<pre><code>select o.OrdId, o.Orddate, ordr.quantity, (ordr.quantity * ord.Iteprice) as price\nfrom Ord o\ninner join Orderrouter ordr on o.OrdId=ordr.OrdID\ninner join OrdItem ord on ordr.OrdItems = ord.ItemId\nwhere o.Paid = 1\nGroup by o.OrdId, o.Orddate, ordr.quantity, ord.Iteprice\norder by o.Orddate DESC\n</code></pre>\n"},{"tags":["c#","wpf","sql-server-2008","ubuntu","ubuntu-12.04"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":105,"score":0,"question_id":12894237,"title":"How to develop a C#.NET application for Ubuntu 12.04","body":"<p>I want to create a desktop application using C#.net (Database - SQL Server ) which is run on Ubuntu 12.04 operating system. </p>\n\n<p>How can I convert my C# .Net code into something compatible with Ubuntu?</p>\n"},{"tags":["sql","sql-server-2008","subquery"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12893960,"title":"SQL Query - Get Subquery results in Rows rather then Columns","body":"<p>I checked the Search, but none seem to answer this Question.. I expect it to be farely simple though:\nI have a query that results in two columns, but I need it to result in two rows.. Anyone know how?</p>\n\n<p>this is the query:</p>\n\n<pre><code>               SELECT        (SELECT        COUNT(Id) AS Expr1\n                      FROM            Table\n                      WHERE        (Description LIKE 'door%')) AS Door,\n                         (SELECT        COUNT(Id) AS Expr1\n                           FROM            Table AS Table_1\n                           WHERE        (Description LIKE 'window%')) AS Window\n</code></pre>\n\n<p>The result I GET is (of course):</p>\n\n<pre><code>[Door]     [Window]\n56         34\n</code></pre>\n\n<p>The result I'd LIKE to have is the following:</p>\n\n<pre><code>[OPTION]    [NROfRecords]\nDoor        56\nWindow      34\n</code></pre>\n\n<p>Any Ideas? Thanks in advance!  </p>\n"},{"tags":["java","sql","sql-server-2008"],"answer_count":5,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":621,"score":1,"question_id":9208126,"title":"To find the next work day","body":"<p>Let's say I have stored a bunch of holidays in my database.</p>\n\n<p>What I need to do is find out which is next work day excluding Saturdays and the public holidays defined in the database.</p>\n\n<p>eg.</p>\n\n<p>Let's say today is the Friday the 15th Feb and the 17th and the 18th are public holidays as defined in the database as datetime.  So now when I press a button that says next work day, it should return 19th Feb.</p>\n\n<p>Which is the most efficient way to to get it?</p>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12888165,"title":"Can I retrieve Data from two Databases?","body":"<p>I want to retrieve some data to use it in my grid, but the problem is my database design contains two databases.</p>\n\n<p>So, can I retrieve data from more than database, to use it at one grid ?</p>\n\n<p>I use ASP.Net, C#.Net 4, Microsoft SQL Server 2008 R2</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":12892194,"title":"getting error for if/else in a stored procedure","body":"<p>I am relatively very new to SQL queries but I have this stored procedure where I am trying to get value of a declared variable as mentioned below but getting error,</p>\n\n<p>First line is 20 here,</p>\n\n<pre><code>declare @m_ID_v int\nset @m_ID_v = ( select ID_C from M_T where MName_C = @MName_parameter)\n\ndeclare @g bit\nif (select G_L_Column from G_L_table Where M_ID_Column = @M_ID_variable)\n    set @g_v = 1\nelse\n    set @g_variable = 0\n</code></pre>\n\n<p>Exception I get:</p>\n\n<blockquote>\n  <p><em>Msg 4145, Level 15, State 1, Procedure GetID, Line 20<br>\n  An expression of non-boolean type specified in a context where a\n  condition is expected, near 'set'. Msg 156, Level 15, State 1,\n  Procedure GetID, Line 21 Incorrect syntax near the keyword 'else'.</em></p>\n</blockquote>\n\n<p>Now if I remove <code>declare @g...</code> and try to parse it, no error occurs</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I want my code to check for returned value by my select statement so \"if exists\" is not really what am looking for, sorry.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12892549,"title":"difference between if and if exists","body":"<p>I have this stored procedure, I was wondering if \"if exists\" will actually compare the value returned by select statement or it will just check if that condition can be executed or not, sorry for such a stupid question but I am new to SQL,</p>\n\n<pre><code>declare @m_ID_v int\nset @m_ID_v = ( select ID_C from M_T where MName_C = @MName_parameter)\n\ndeclare @g bit\nif exists (select G_L_Column from G_L_table Where M_ID_Column = @M_ID_variable)\n    set @g_v = 1\nelse\n    set @g_variable = 0\n</code></pre>\n\n<p>my select statement </p>\n\n<pre><code>select G_L_Column from G_L_table Where M_ID_Column = @M_ID_variable\n</code></pre>\n\n<p>Is returning either true or false, so just wanna make sure if \"if exists\" will work as \"if\"</p>\n"},{"tags":["sql-server-2008","ms-access-2007"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12888829,"title":"Order by count not sorting correctly - SQL (MS Access 2007)","body":"<p>Overview:\nCompare day to day trades for produce as agent for various accounts to find difference between agent and company holdings showing only what is new; codes in current trades, but not previous trades.</p>\n\n<p>Objective:\nSort the trades by code (i.e. apples) with highest frequency.</p>\n\n<p>Current table:</p>\n\n<pre><code>--------------------------------------------------------------------------------------------------------------\n|        DATE | ACCT_CODE | TYPE | TYPE_DESCRIPTION |    CODE | DIFFERENCE | AGENT_HOLDING | COMPANY_HOLDING |\n--------------------------------------------------------------------------------------------------------------\n| 02 Aug 2012 | acc107101 | prod |          produce |   apple |      -1500 |             0 |            1500 |\n| 02 Aug 2012 | acc107101 | prod |          produce |   apple |       1500 |          2000 |             500 |\n| 02 Aug 2012 | acc107101 | prod |          produce |   apple |          0 |             0 |               0 |\n| 02 Aug 2012 | acc107101 | prod |          produce |   apple |          0 |         49797 |           49797 |\n| 02 Aug 2012 | acc170000 | prod |          produce |  grapes |       2500 |          2500 |               0 |\n| 02 Aug 2012 | acc170000 | prod |          produce |  grapes |      -1500 |             0 |            1500 |\n| 02 Aug 2012 | acc008221 | caus |             cash |    cash |          0 |             0 |               0 |\n| 02 Aug 2012 | acc008221 | caus |             cash | carrots |          0 |         43273 |           43274 |\n| 01 Aug 2012 | acc008221 | caus |             cash |    cash |          0 |             0 |               0 |\n| 01 Aug 2012 | acc008221 | caus |             cash | carrots |          0 |         43273 |           43274 |\n| 02 Aug 2012 | acc179185 | prod |          produce |   mango |        125 |          2775 |            2650 |\n| 02 Aug 2012 | acc179185 | prod |          produce |   mango |     -57646 |        453639 |          511286 |\n| 02 Aug 2012 | acc636903 | prod |          produce |   mango |          0 |        481081 |          481081 |\n| 02 Aug 2012 | acc001049 | prod |          produce |   mango |       2500 |          2500 |               0 |\n| 02 Aug 2012 | acc001189 | prod |          produce |   apple |      -1091 |             0 |            1091 |\n--------------------------------------------------------------------------------------------------------------\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>SELECT \n    Count(CurrentTrade.Code) AS CountOfCode, \n    CurrentTrade.date, \n    CurrentTrade.Acct_Code, \n    CurrentTrade.Type, \n    CurrentTrade.Code, \n    CurrentTrade.Agent_Holding, \n    CurrentTrade.Company_Holding, \n    CurrentTrade.Difference\nFROM CurrentTrade \nLEFT JOIN PrevTrade \n    ON CurrentTrade.Company_Holding=PrevTrade.Company_Holding\nWHERE (((PrevTrade.Company_Holding) Is Null) AND ((CurrentTrade.Code)&lt;&gt;'cash'))\nGROUP BY \n    CurrentTrade.Code,CurrentTrade.date, \n    CurrentTrade.Acct_Code, \n    CurrentTrade.Type, \n    CurrentTrade.Agent_Holding, \n    CurrentTrade.Company_Holding, \n    CurrentTrade.Difference\nORDER BY count(CurrentTrade.Code) ASC;\n</code></pre>\n\n<p>Current results:</p>\n\n<pre><code>---------------------------------------------\n| COUNTOFCODE |        DATE | TYPE |   CODE |\n---------------------------------------------\n|           1 | 02 Aug 2012 | prod | grapes |\n|           1 | 02 Aug 2012 | prod | grapes |\n|           1 | 02 Aug 2012 | prod |  apple |\n|           1 | 02 Aug 2012 | prod |  apple |\n|           1 | 02 Aug 2012 | prod |  apple |\n|           1 | 02 Aug 2012 | prod |  apple |\n|           1 | 02 Aug 2012 | prod |  apple |\n|           1 | 02 Aug 2012 | prod |  mango |\n|           1 | 02 Aug 2012 | prod |  mango |\n|           1 | 02 Aug 2012 | prod |  mango |\n|           1 | 02 Aug 2012 | prod |  mango |\n---------------------------------------------\n</code></pre>\n\n<p>Issue:\nHow to fix to use correct ORDER BY frequency (apples, mango, grapes)?</p>\n"},{"tags":["sql","sql-server-2008","common-table-expression"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":12891637,"title":"Unexpected results from CTE","body":"<p>I've created a complex process that uses several CTEs (mainly for recursive hierarchical work).<br>\nOn small sample sets of data everything goes as expected but when I apply the code to large sets of data I received unexpected (and wrong) results.</p>\n\n<p>I think I've narrowed it done to the CTEs. The recursive CTEs are \"fed\" data processed in several earlier CTEs, and that seems to be the problem.</p>\n\n<p>I set up a <a href=\"http://sqlfiddle.com/#!3/c8a47/6\" rel=\"nofollow\">sample data set</a> as follows:</p>\n\n<ul>\n<li>Four rows with unique data</li>\n<li>Each row receives a random row number (this is added in a CTE</li>\n</ul>\n\n<p>I then take the results of the first CTE and perform a self-join in a second CTE.<br>\nI expected all rows to join, each to itself. What actually happens is that unequal rows join up.</p>\n\n<p>Can someone offer up an explanation for this behaviour? </p>\n"},{"tags":["c#","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":132,"score":2,"question_id":12832294,"title":"Output from SQL Server and C# different","body":"<p>I believe something is wrong with my coding. It's not filtering by date I guess. Please help</p>\n\n<p>SQL code:</p>\n\n<pre><code>SELECT\n   CONVERT(char(80), i.InvDate,3) AS InvDate,\n   i.InvoiceNo,\n   i.EmployerCode,\n   i.TaxAmount + i.SubTotal AS Amount,\n   '' AS Payment,\n   pd.GivenName\nFROM\n   dbo.Invoice i\nINNER JOIN \n   dbo.PatientDetails pd ON (pd.MedicalRecordID = i.MedicalRecordID)\n</code></pre>\n\n<p>C# code:</p>\n\n<pre><code>SqlCommand objCmd = new SqlCommand(\"SELECT CONVERT(char(80), i.InvDate,3) AS InvDate, \n    i.InvoiceNo,\n    i.EmployerCode,\n    i.TaxAmount + i.SubTotal AS Amount,\n    '' AS Payment,\n    pd.GivenName \nFROM\n    dbo.Invoice i \nINNER JOIN dbo.PatientDetails pd ON (pd.MedicalRecordID = i.MedicalRecordID) \nWHERE (InvDate &gt;= CONVERT(datetime, '\" + dtpFrom.Text + \"', 105 )) \n    AND (InvDate &lt;= CONVERT(datetime, '\" + dtpTo.Text + \"', 105)),\" , objConn);\n</code></pre>\n\n<p>This is what I want to achieve:</p>\n\n<p><img src=\"http://i47.tinypic.com/167trt3.png\" alt=\"enter image description here\"></p>\n\n<p>This is what I get:</p>\n\n<p><img src=\"http://i50.tinypic.com/28m2z5x.png\" alt=\"enter image description here\"></p>\n\n<p>Before i get kicked from here. I'll make some edits.</p>\n\n<p>EDIT:</p>\n\n<p>DateTime is in a 105 format (dd-mm-yyyy)</p>\n\n<pre><code>WHERE (InvDate &gt;= CONVERT(datetime, '\" + dtpFrom.Text + \"', 105 )) \nAND (InvDate &lt;= CONVERT(datetime, '\" + dtpTo.Text + \"', 105))\n</code></pre>\n\n<p>This is supposed to choose from a particular date. EG: from 11 Oct 2012 to 15 Oct 2012.</p>\n\n<p>Even without DateTimepicker, The output doesn't show me \"GivenName\"</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12839273,"title":"How to find the inner SP's taking time","body":"<p>I have 1 main procedure and inside 5 procedure calls and my Main SP taking too much time. I want to find out which is the procedure call taking time to execute amongst inside 5 procedures.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":74,"score":-1,"question_id":12888775,"title":"SQL select @variable","body":"<p>I have a simple SQL statement that is to get the first rowid from question, but it gives an error thanks to too many items return. So how can I fix it ?</p>\n\n<pre><code>    DECLARE @first_id int  \n\nselect @first_id = (SELECT row_number() over (order by id) as id FROM question)\n</code></pre>\n\n<p><code>SELECT @first_id = id FROM question</code> >> this syntax works fine but not what I want from query result.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","excel","c#-4.0","import-from-excel"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":224,"score":0,"question_id":12889518,"title":"Import data directly from Excel sheet into SQL Server table","body":"<p>I have multiple table's data in single Excel sheet with exact column names, now I want to insert that data into my SQL Server 2008 tables.</p>\n\n<p>For example: I have one table <code>Student</code> which has columns <code>Stud_ID, Stud_Name, Branch, Status</code>.</p>\n\n<p>And same as, I have one Excel sheet <code>Student</code> which has columns <code>Stud_ID, Stud_Name, Branch, Status</code>. Excel sheet has multiple records of data in it.</p>\n\n<p>Now I want to insert that data into the SQL Server table <code>Student</code>.</p>\n\n<p>How can I do that using C# coding and without coding (directly Excel to SQL Server database)? Please guide me its urgent.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":2712,"score":10,"question_id":6054144,"title":"How can I group by date time column without taking time into consideration","body":"<p>I have a bunch of product orders and I'm trying to group by the date and sum the quantity for that date. How can I group by the month/day/year without taking the time part into consideration?</p>\n\n<p><code>3/8/2010 7:42:00</code> should be grouped with <code>3/8/2010 4:15:00</code></p>\n"},{"tags":["sql-server","sql-server-2008","subquery"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":65,"score":0,"question_id":12889091,"title":"Syntax error on selecting from sub-query","body":"<p>Getting syntax error while executing the following query?</p>\n\n<pre><code>select *\n    from (select row_number() over (order by title) as RowNum  from question)\n    where RowNum&gt;5\n</code></pre>\n\n<p>Anyone knows how to get it fixed?</p>\n"},{"tags":["sql-server-2008","migration","cassandra"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12867951,"title":"Migrate from MSSQL to Cassandra","body":"<p>I wish to start very quickly with my new project. I have experience in MSSQL, but no experience with Cassandra, so MSSQL would definitely be the fastest. But IF my project would become successful I would like to migrate to Cassandra. Is that even possible and if so a painstaking job or pretty straightforward?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12886216,"title":"An expression of non-boolean type specified in a context where a condition is expected, near ')'","body":"<p>I have a script in trigger to insert the audit table if any update happens on T_Referral table and i am using a Decrypt function to Decrypt the data in one of the column. My code in trigger is :</p>\n\n<pre><code>DECLARE @Sql_Insert nvarchar(max)\nSET @Sql_Insert = ''\nSET @Sql_Insert='INSERT INTO [Logg].AuditLogData(TableName, ColumnName, OldValue, OldValue_Decode, NewValue, NewValue_Decode, AuditSubCategoryID,[GuID])\nselect TableName, ColumnName, OldValue_Decode, case when ColumnName = ''BookingUserReferenceValue'' then utl.sfDecrypt(NewValue,0) Else NewValue end, NewValue_Decode, AuditSubCategoryID,[GuID] from #AuditLogData\nwhere ISNULL(OldValue,'') != ISNULL([NewValue],'')'\n\nexec utl.uspOpenOrCloseEncryptionKey 'open'\nexec(@Sql_Insert )\nexec utl.uspOpenOrCloseEncryptionKey 'close'\n</code></pre>\n\n<hr>\n\n<p>My update script is </p>\n\n<pre><code>Update RTS.T_Referral   \nset BookingUserReferenceValue =  cast ('John Wayne' as varbinary(256))\nwhere ReferralId = 20\n</code></pre>\n\n<p>I am Updating the record to <code>John Wayne</code> as varbinary in <code>T_Referral</code> table(record looks like <code>0x4A6F686E205761796E65</code>) and when update trigger is called it would load that record as John Wayne in Audit table. When the record is inserted in BookingUserReferenceValue it will be encrypted. The datatype of column BookingUserReferenceValue is Varbinary(256). when i try to update the record in that column i get error :</p>\n\n<blockquote>\n  <p>An expression of non-boolean type specified in a context where a\n  condition is expected, near ')'.</p>\n</blockquote>\n\n<p>Any Idea whats wrong?\nThanks</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12885468,"title":"SQL Server : update multiple rows with different values","body":"<p>I am trying to update multiple rows with different values, but don't need to match any specific ID. </p>\n\n<p>Of course, both columns on two different tables will have a same number of records.</p>\n\n<p>Example, I have a table <code>Table1</code> and <code>Column1</code> and a query with list 10 items in that table (<em>the <code>ID</code> is not consecutive</em>).</p>\n\n<pre><code>ID  ItemName\n1    Item1\n2    Item2\n4    Item3\n5    Item4\n6    Item5\n8    Item6\n9    Item7\n14    Item8\n18    Item9\n23    Item10\n</code></pre>\n\n<p>Now, I have another table <code>Table2</code> and <code>Column2</code> that I want to update with those 10 items above.  </p>\n\n<p>This also has different IDs, but <code>ItemName</code> is blank/null value.</p>\n\n<pre><code>ID   ItemName\n301    NULL\n321    NULL\n323    NULL\n331    NULL\n333    NULL\n335    NULL\n336    NULL\n355    NULL\n377    NULL\n388    NULL\n</code></pre>\n\n<p>So, I a looking for a query where I can update the <code>Table2</code> and <code>Column2</code> with those 10 items from <code>Table1</code>, and the result looks like this </p>\n\n<pre><code>ID   ItemName\n301    ITem1\n321    ITem2\n323    ITem3\n331    ITem4\n333    ITem5\n335    ITem6\n336    ITem7\n355    ITem8\n377    ITem9\n388    ITem10\n</code></pre>\n\n<p>Please help.  Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12881899,"title":"sql server, get output value sp_executesql","body":"<pre><code>SET ROWCOUNT @startRowIndex\n     SELECT @first_id = id FROM Question q ORDER BY q.id\n</code></pre>\n\n<p>this is straight forward enough to get the first id from a table, however in case the sql statement is in string, how can i get the same result like above</p>\n\n<p>i mean how to get output <code>q.id</code> from <code>EXEC sp_executesql @sql</code>?</p>\n\n<pre><code>IF  @sortCommand like 'sortAsAnswerCount' OR \n    @sortCommand like 'sortAsNonAnswer'\nBEGIN\n\n    set @sql=N'WITH LikeCounts\n        AS\n        (\n        SELECT     TOP (100) PERCENT q.Id, q.Title, c.CustomerId, c.CreatedOnUtc,\n                                  (SELECT     COUNT(*)\n                                    FROM          dbo.CustomerLikeQuestion\n                                    WHERE      (QuestionId = q.Id)) AS LikeCount\n        FROM         dbo.CustomerContent AS c INNER JOIN\n                              dbo.Question AS q ON c.Id = q.Id\n        ORDER BY likecount DESC\n        )\n        SELECT *, row_number() over (order by likecount desc) as RowNum\n        fROM LikeCounts'\n\nEND\n</code></pre>\n"},{"tags":["sql","sql-server-2008","ldf"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":12884559,"title":"Transaction Log file .ldf is too small","body":"<p>Current database is almost 200GB however the transaction log file is only 4.1GB. \nI am worried if this influences the performance of databse and how could it be solved. </p>\n\n<p>When I do this query</p>\n\n<pre><code>DECLARE @DatabaseName VARCHAR(50) ;\n  SET @DatabaseName = 'dbname'\n  SELECT name ,\n    recovery_model_desc ,\n    log_reuse_wait_desc\n  FROM  sys.databases\n  WHERE name = @DatabaseName\n\nShow Recovery Model = Simple, Log Reuse Wait = Nothing. \n</code></pre>\n\n<p>Anyone has a knowledge why the log file is so small, and does this influences on the performance?</p>\n"},{"tags":["sql-server-2008","entity-framework","code-first","sql-server-ce-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12751318,"title":"SQL Server CE identifies a cyclical reference with Entity Framework Code First but SQL Server 2008 does not","body":"<p>I am working on an Entity Framework Code First project that has a fairly complex Data Model which deploys absolutely fine on SQL Server 2008.</p>\n\n<p>However when creating an SQL Server CE database for some local End-To-End testing I get the following error message when EF creates the database:</p>\n\n<p><code>System.Data.SqlServerCe.SqlCeException: The referential relationship will result in a cyclical reference that is not allowed. [ Constraint name = FK_Sites_Persons_PersonId ].</code></p>\n\n<p>I have disabled the <code>ManyToManyCascadeDeleteConvention</code> in my DataContext model creation method, so that isn't the cause of the problem. The trouble I have is that the relationship in question looks fine in the SQL Server 2008 database- it appears to be a normal foreign key from what I can tell and I can't see anything flowing back in the other direction, although it is not impossible that there is a longer-path circular reference. I don't know why CE would fail and 2008 would succeed.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","random"],"answer_count":1,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":75,"score":4,"question_id":12883303,"title":"Select X random users per item","body":"<p>I have 2 tables: <code>Items</code> &amp; <code>Users</code>.</p>\n\n<p><code>Items</code> contains <code>ItemID, and Num_Users</code><br>\n<code>Users</code> contains <code>UserID</code></p>\n\n<p>For each <code>ItemID</code>, I need to randomly select a number of Users according to the value stated in the Num_Users column.</p>\n\n<p>I created a sample set of data on <a href=\"http://sqlfiddle.com/#!3/bdde1\" rel=\"nofollow\">SQL Fiddle</a>.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","rownumber"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":125,"score":0,"question_id":12881648,"title":"SQL Server row_number","body":"<p>I have a problem to create a custom <code>rownumber</code> with an alias column. Here are some sample data:</p>\n\n<p>Table <code>question</code>:</p>\n\n<pre><code>id   title   \n--   --------    \n1     xx\n2     xxx\n</code></pre>\n\n<p>..</p>\n\n<p>Table <code>customerLikeQuestion</code>:</p>\n\n<pre><code>Id   QuestionId CustomerId\n---------------------------\n1       20          xx\n2       100         xx \nxx\n</code></pre>\n\n<p>Query:</p>\n\n<pre><code>SELECT  q.Id,\n        (SELECT     COUNT(*) \n         FROM          dbo.CustomerLikeQuestion\n         WHERE      (QuestionId = q.Id)) AS LikeCount\nFROM dbo.Question AS q\nORDER BY likecount DESC\n</code></pre>\n\n<p>The previous query shows:</p>\n\n<pre><code> id    LikeCount\n2136    6\n2138    5\n2150    5\n</code></pre>\n\n<p>Now I'd like to put a <code>rownumber</code> to count an incremental order of a row. I tried the following query:</p>\n\n<pre><code>SELECT     TOP (100) PERCENT Id,\n           (SELECT     COUNT(*) AS Expr1\n            FROM          dbo.CustomerLikeQuestion\n            WHERE      (QuestionId = q.Id)) AS LikeCount, \n            row_number() over (order by likecount) as RowNum\nFROM         dbo.Question AS q\nORDER BY likecount DESC\n</code></pre>\n\n<p>But it gives me the following error:</p>\n\n<blockquote>\n  <p><em>invalid column Likecount.</em></p>\n</blockquote>\n\n<p>I do know that <code>Over()</code> cannot work with alias, but how can I get around this problem, either with CTE or subquery, I have not yet come up with any idea. please help.</p>\n\n<p>The right result should be like this: </p>\n\n<pre><code>id  likecount, rownum\n----------------------    \nxx     6        1\nxx     5        2 \nxx     4        3\n..     0        xx\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":78,"score":1,"question_id":12881735,"title":"Database maximum size in SQL Server 2008","body":"<p>What is the maximum <code>.mdf</code> database size limit in SQL Server 2008 Enterprise ?</p>\n"},{"tags":["sql-server-2008","delphi","tadoquery","rows-affected"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":162,"score":3,"question_id":12779534,"title":"Delphi - TADOQuery.RowsAffected always -1 with UPDATE SQL statement","body":"<p>I'm executing a SQL UPDATE statement using a TADOQuery component and want to inspect the number of rows that were updated.  The UPDATE statement is executing fine and the rows are modified accordingly but the .RowsAffected property always returns -1.  The documentation states -1 indicates an error with the statement, but as I say it executes fine.  I've tried prefixing the statement with SET NOCOUNT OFF but this made no difference.  My code is as follows :</p>\n\n<pre><code>var\n  adoUpdateQuery: TADOQuery;\n  blnUpdatedOK: Boolean;\nbegin\n  adoUpdateQuery := TADOQuery.Create(nil);\n  adoUpdateQuery.DisableControls;\n  adoUpdateQuery.Connection := adcMiddleTierDB;\n  adoUpdateQuery.ExecuteOptions := [eoExecuteNoRecords];\n  adoUpdateQuery.SQL.Text := 'UPDATE MyTable SET Status = 1 WHERE Status = 0';\n  try\n    adoUpdateQuery.ExecSQL;\n    blnUpdatedOK := (adoUpdateQuery.RowsAffected &gt; 0);\n</code></pre>\n\n<p>I'm using Delphi XE2, connecting to MS SQL Server 2008R2.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12879253,"title":"How to make multiple occurences of the same item have a different value from the first occurence?","body":"<p>I have a database that looks like this:</p>\n\n<pre><code>label_id, scan_type, scan_cost\n</code></pre>\n\n<p>And some rows that look like this:</p>\n\n<pre><code>001, A40, 70\n001, A40, 70\n002, A40, 85\n003, A40, 85\n003, A40, 85\n</code></pre>\n\n<p>I need to produce a result set that looks like this:</p>\n\n<pre><code>001, A40, 70\n001, A40, 0\n002, A40, 85\n003, A40, 85\n003, A40, 0\n</code></pre>\n\n<p>That is, any multiple occurrence of the same <code>label_id</code> then the <code>scan_cost</code> column needs to be set to 0, but the first occurrence of each <code>label_id</code> the value needs to remain untouched.</p>\n\n<p>The <code>label_id</code> are not sequential if that changes anything.</p>\n\n<p>Is it possible to achieve this behaviour in SQL? Note the SQL dialect is T-SQL, Microsoft SQL Server 2008</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":60,"score":-2,"question_id":12876626,"title":"Simple compare of datetime in SQL Server 2008","body":"<p>I have a <code>datetime</code> column storing the time of change including date and time parts.</p>\n\n<p>I am trying to return all of the changed rows using my stored procedure, which has one <code>datetime</code> parameter being passing it into </p>\n\n<pre><code>SELECT * FROM TABLE WHERE Changed &gt; @param\n</code></pre>\n\n<p>Surprisingly it returns <strong>no rows</strong>.</p>\n\n<p>I tried to use <code>BETWEEN</code>, time ranges, <code>DATEPART</code>, <code>DATEDIFF</code> but without success. Playing with this issue I found that if I do not compare seconds everything works.</p>\n\n<p>Any ideas, please?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2008","containstable","isabout"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12877852,"title":"Can I use a variable when using ISABOUT?","body":"<p>I'm trying to use a stored procedure to create a table that ranks posts by taking a topic name and using keywords and weights associated with that topic name to determine how they should be ranked. I've been trying to use CONTAINSTABLE and ISABOUT, but I'm having trouble with putting the keywords and weights into the ISABOUT statement. I've tried converting the keywords and weights from the table they're in into a varchar variable, and putting that variable into the ISABOUT statement, but when I run the SP, the resulting table is empty, so I'm assuming the variable isn't working and I'm not sure where to go from here.</p>\n\n<p>Here's what I have so far:</p>\n\n<pre><code>CREATE PROCEDURE rankingSP (@Topic varchar(30))\nAS\nBEGIN\n    --creates table to display when sp is executed  \n    CREATE TABLE #rankingTable(\n    Post_ID     int,\n    Post_cont   varchar(max),\n    [Rank]      decimal(18,2))\n\n    --creates string with keywords and weights\n    DECLARE @keywordString varchar(max)\n    SELECT @keywordString = COALESCE(@keywordString + ',','') \n    + Keyword + ' ' + 'WEIGHT' + '(' + CONVERT(varchar,K_weight) + ')'\n    FROM Keyword\n    PRINT @keywordString\n\n    --inserts rankings into rankingTable\n    INSERT INTO #rankingTable\n    SELECT\n    p.[Post_ID],\n    p.[Post_cont],\n    ct.[RANK]\n    FROM CONTAINSTABLE\n    (\n    Post,\n    Post_cont,\n    N'ISABOUT (@keywordString)'\n    ) ct\n    INNER JOIN Post p\n    ON ct.[KEY] = p.Post_ID\n    ORDER BY ct.[RANK] DESC;\n\n    --displays the ranking table\n    SELECT * FROM #rankingTable\n    ORDER BY [Rank]DESC\nEND\n</code></pre>\n"}]}
{"total":21074,"page":12,"pagesize":100,"questions":[{"tags":["sql-server-2008","select","random"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":12879496,"title":"how to pick randome number from the number list","body":"<p>I need to choose one number randomly from the list of bigint in sql server 2008.\nthe number list is not continue</p>\n\n<p>For example : The number list may be like this</p>\n\n<p>1578\n1579\n1580\n1587\n1589\n1590\n1595\n1603</p>\n\n<p>Thanks in Adv.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12875396,"title":"How to use use derived table column in sql query?","body":"<p>I have one table mytrade like following</p>\n\n<pre><code>tradeid securityid quantity\n\n111    899    12000\n112    899    1000\n113    788    15000\n114    566    -15000\n115    566    -1000\n</code></pre>\n\n<p>so to gather total quantity for security id i write following query (I tried this into #temptable also create temptable and then select below )</p>\n\n<pre><code>select\ntradeid,\nsecurityid,\nsum(quantity) OVER(Partition by securityid) as total\nfrom mytrade\n</code></pre>\n\n<p>which gives me output like below</p>\n\n<pre><code>tradeid securityid total\n\n114    566    -16000\n115    566    -16000\n113    788    15000\n111    899    13000\n112    899    13000\n</code></pre>\n\n<p>now i want to insert values into secondtable based on \"total\" quantity.</p>\n\n<pre><code>insert secondTable (securityid,quantity,price)\n(\nselect securityid,quantity,101.1 from mydata..mytrade\nwhere #temptable.total = 13000 and securityid = 899\n)\n</code></pre>\n\n<p>but getting error:</p>\n\n<p>The multi-part identifier \"#temptable.total\" could not be bound.</p>\n\n<p>if i put this whole statement into#temptable and then assign as above then also getting this error how should i bound \"total\" column please guide me?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","dynamic-sql"],"answer_count":8,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":25930,"score":6,"question_id":4626292,"title":"How to use table variable in a dynamic sql statement?","body":"<p>In my stored procedure I declared two table variables on top of my procedure. Now I am trying to use that table variable within a dynamic sql statement but I get this error at the time of execution of that procedure. I am using Sql Server 2008.</p>\n\n<p>This is how my query looks like, </p>\n\n<pre><code>set @col_name =  'Assoc_Item_' + Convert(nvarchar(2), @curr_row1);\nset @sqlstat = 'update @RelPro set ' + @col_name + ' = (Select relsku From @TSku Where tid = ' + Convert(nvarchar(2), @curr_row1) + ') Where RowID = ' + Convert(nvarchar(2), @curr_row);\nExec(@sqlstat);\n</code></pre>\n\n<p>And I get the following errors, </p>\n\n<p>Must declare the table variable \"@RelPro\".\nMust declare the table variable \"@TSku\".</p>\n\n<p>I have tried to take the table outside of the string block of dynamic query but to no avail... Please help,</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":95,"score":-2,"question_id":12864467,"title":"How to take sum of column with same id in SQL?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10142367/sql-query-to-sum-the-data\">sql query to sum the data</a>  </p>\n</blockquote>\n\n\n\n<p>I have following table structure </p>\n\n<pre><code>TradeId     TableName        PricingSecurityID  Quantity    Price   \n2008        Fireball.dbo.Bond    506             50         100.0000    \n2009        Fireball.dbo.Bond    506             50         100.2500    \n2010        Fireball.dbo.Bond    588             50         100.7500    \n2338        Fireball.dbo.Bond    588             100        102.5000    \n</code></pre>\n\n<p>I need to take a sum of <code>Quantity</code> of matching or we can say group by particular <code>PricingSecurityID</code></p>\n\n<p>like for <code>PricingSecurityID=506</code> I should get <code>quantity=100</code> </p>\n\n<p>and for <code>PricingSecurityID=588</code> I should get <code>quantity=150</code> </p>\n\n<p>How can I write this SQL query?</p>\n\n<blockquote>\n  <p>I did try with simple group by statement\n  but as i'm also selecting tradeid i'm getting error :\n  Column 'TradeId' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</p>\n</blockquote>\n"},{"tags":["c#","asp.net","sql-server-2008","gridview","filter"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3232,"score":0,"question_id":6137664,"title":"how to filter a gridview","body":"<p>I have a gridview connected to a database by sqldatasource. I have multiple drop down lists and a table where users can select different data to filter the gridview. </p>\n\n<p>I know how to set this up for one control but have no idea how to do it for multiple ones. Ideally what I would like to do is onfilterButton_Click the code behind connects to a stored procedure in the database. The parameters would depend on the filter options the user has chosen. I just don't know how to write the stored procedure. (I am not the best at SQL)</p>\n\n<p>But I am open to suggestions of better ways to do this. I am using c# visual studios 2010 and sql server 2008.</p>\n\n<p>I have been stuck on this for over a week now so really any practical help would be welcome. </p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12873118,"title":"Trigger is trying to insert duplicate key","body":"<p>I have a trigger that is fired on Insert. This trigger inserts on another table. here is my code: </p>\n\n<pre><code>    SELECT @maxTeamId = 0\nSELECT @maxTeamId = ISNULL(MAX(teamId), 0) from [dbo].[tblTeamslist]\n\n--- Check if home team has already been inserted into the table.\nSELECT @homeTeamId = -1\nSELECT \n    @homeTeamId = teamId \nFROM \n    [dbo].[tblTeamslist] t\n    JOIN inserted i\n    ON t.teamName = i.hometeam\nIF (@homeTeamId = -1) \nBEGIN\n  SET IDENTITY_INSERT tblteamslist ON\n    SELECT @homeTeamId = @maxTeamId + 1\n    SELECT @maxTeamId = @maxTeamId + 1\n    INSERT INTO [dbo].[tblTeamslist] (teamid,teamname) SELECT @homeTeamId, i.hometeam FROM inserted i\n SET IDENTITY_INSERT tblteamslist off\nEND\n\n--- Check if away team has already been inserted into the table.\nSELECT @awayTeamId = -1\nSELECT \n    @awayTeamId = teamId \nFROM \n    [dbo].[tblTeamslist] t\n    JOIN inserted i\n    ON t.teamName = i.awayteam\nIF (@awayTeamId = -1) \nBEGIN\n  SET IDENTITY_INSERT tblteamslist ON\n    SELECT @awayTeamId = @maxTeamId + 1\n    SELECT @maxTeamId = @maxTeamId + 1\n    INSERT INTO [dbo].[tblTeamslist]  (teamid,teamname) SELECT @awayTeamId, i.awayteam FROM inserted i\n  SET IDENTITY_INSERT tblteamslist off\nEND\n</code></pre>\n\n<p>As you realized I am trying to input a team that if it is not exists on tblTeamsList. Here is the error that i am getting 'Violation of PRIMARY KEY constraint 'PK_tblTeamsList'. Cannot insert duplicate key in object 'dbo.tblTeamsList'. The duplicate key value is (24).'. \nIn the code i am trying to increase the id by +1 each time. What is going wrong ?</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12871818,"title":"Error in filling a datagrid with a query","body":"<p>I have a <code>DataGridView</code> and I add my query to this, when executed my query throws this error:</p>\n\n<blockquote>\n  <p><em>The schema returned by the new query differs from the base query</em></p>\n</blockquote>\n\n<p>This my query:</p>\n\n<pre><code>        SELECT\n               B.SettingKey, 'SysSettingsDep' AS TableName,\n               B.SettingValue, B.SettingDesc\n        FROM   SysCustomer AS A INNER JOIN\n               SysSettingsDep AS B ON A.SettingKey = B.SettingKey\n        UNION\n        SELECT C.SettingKey, 'SysSettingsMachine' AS TableName,\n               C.SettingValue, C.SettingDesc\n\n        FROM    SysCustomer AS A INNER JOIN\n                SysSettingsMachine AS C ON A.SettingKey = C.SettingKey\n        UNION\n        SELECT  D.SettingKey, 'SysSettings' AS TableName,\n                D.SettingValue, D.SettingDesc\n        FROM    SysCustomer AS A INNER JOIN SysSettings AS D ON\n                A.SettingKey = D.SettingKey\n</code></pre>\n\n<p>help me to solve this,</p>\n\n<p>tnx </p>\n"},{"tags":["sql-server","sql-server-2008","pivot","entity-attribute-value"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":206,"score":2,"question_id":7365742,"title":"Pivot to obtain EAV data","body":"<p>I have an EAV table (simple key/value in every row) and I need to take the 'value' from two of the rows and concat them into a single row with a single column. I can't seem to get through the part where I just have the pivot straight. Can anyone help me figure this out?</p>\n\n<pre><code>Declare @eavHelp Table\n(\n    [Key]         VARCHAR (8)       NOT NULL,\n    [Value]       VARCHAR (8)      NULL\n)\nInsert Into @eavHelp Values ( 'key1' , 'aaa' )    \nInsert Into @eavHelp Values ( 'key2' , 'bbb' )\n\nSelect * From @eavHelp \nPivot\n(   Min( [Value] ) \n    For [Value] in ( hmm1 , hmm2 )\n)\nas Piv Where [Key] = 'key1' or [Key] = 'key2'\n</code></pre>\n\n<p>That makes:</p>\n\n<pre><code>Key      hmm1     hmm2\n-------- -------- --------\nkey1     NULL     NULL\nkey2     NULL     NULL\n</code></pre>\n\n<p>But what I want to make is:</p>\n\n<pre><code>hmmmX\n-----\naaa;bbb\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12874392,"title":"SQL subtotaling","body":"<p>I am trying to write a SQL Server 2008 query which will output data into subtotaled columns. My SQL skills are pretty poor still, so I could really use some help.</p>\n\n<p>I have two tables, A and B. </p>\n\n<pre><code>A.user (unique) \nA.answer  &lt;- can only be one of two answers, 'Answer1' or 'Answer2' \nB.user (unique) \nB.zip\n</code></pre>\n\n<p>What I am trying to do is write a SQL statement that generates a four column output that summarizes answer by zip. Like this:</p>\n\n<pre><code>Zip    Answer1    Answer2   Total\n----------------------------------\n12345     25        22        47\n23456     7          0         7\n45678     0         15        15\n</code></pre>\n\n<p>Any sage advice?</p>\n\n<p>Thanks!</p>\n\n<p>-tony</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":76,"score":0,"question_id":12864934,"title":"Expecting SELECT or '( ' in Sql","body":"<p>Basically when I register (Registration details goes to Login table), then this data goes to 2 tables:</p>\n\n<ol>\n<li>Login table<br></li>\n<li>Registration table(Specific)</li>\n</ol>\n\n<p>Using <code>@Attrib</code> I check which data needs to go to which table.  But here I am getting an error near the first <code>else</code> part.</p>\n\n<p>The error is:</p>\n\n<blockquote>\n  <p>Incorrect syntax near '@Attrib' expecting SELECT or ,'('</p>\n</blockquote>\n\n<p>Here is the code:</p>\n\n<pre><code>ALTER procedure [dbo].[Registration_SP]\n(\n    @Email varchar(50),\n    @Password varchar(50),\n    @Repassword varchar(50),\n    @Attrib varchar(50) \n)\nAS\n\nBEGIN\n\n    Insert into Login (Email,Password,Repassword,Attrib)\n    values(@Email,@Password,@Repassword,@Attrib)\n\n    IF (@Attrib = 'Student')\n    BEGIN\n        Insert into StudentReg\n            (StudentId,FirstName,LastName,Gender,Address1,Address2,Address3,\n             LandPhone,MobilePhone,Budget,IsFinancialSupport,CourseName,\n             IsJobSeeker,Country,Region,IsSupportActive,RegDate,ImagePath,\n             ShortCode)\n        Values(@Email,'','','','','','','','','','','','','','','','','','')\n    END\n    ELSE (@Attrib = 'Financial Supporter')\n    BEGIN\n        Insert into SupporterReg   \n        (SupporterId,SupporterName,University,ContactNo,StudentLocation,RegDate,\n         ImagePath,ShortCode)\n        Values(@Email,'','','','','','','')\n    END\n</code></pre>\n\n<p>Further clarification, I have atttached the image below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/hsqqD.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":55,"score":4,"question_id":12867644,"title":"How to retrieve DISTINCT values from this table?","body":"<p>Here goes my table values. ( 7 Records )</p>\n\n<pre><code>SELECT * FROM tbl1\n</code></pre>\n\n<p>I can't post the image as my rep is low. So i am linking it here \n<a href=\"http://i.stack.imgur.com/CFl0u.png\" rel=\"nofollow\">http://i.stack.imgur.com/CFl0u.png</a></p>\n\n<p>I wrote a query to avoid the last record, but i am still getting the last record. (ALL I NEED IS DISTINCT EMAILS)</p>\n\n<pre><code>SELECT DISTINCT CandEmail,CandName,EmployerId,ContNum,IsDeleted,CandPortalId FROM tbl1\nWHERE EmployerId = 7 AND IsDeleted = 0\n</code></pre>\n\n<p>The above query still retrieves the same 7 records with last duplicate email record.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12871920,"title":"Error on SELECT * INTO statement","body":"<p>I want to transfer all data from one table into another with the following code:</p>\n\n<pre><code>INSERT INTO tblpremier \n   SELECT * INTO #TempTable\n   FROM dbo.IntermediateTable\n\nALTER TABLE #TempTable\nDROP COLUMN id\n\nSELECT * FROM #TempTable\n</code></pre>\n\n<p>And I get an error</p>\n\n<blockquote>\n  <p><em>Incorrect syntax near the keyword 'INTO'</em></p>\n</blockquote>\n\n<p>at the second line of this code. Any help?. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":12871174,"title":"What's wrong with this ALTER TABLE statement?`","body":"<p>I wrote a SQL statement to add some columns in my existing table <code>Company</code>, but it's causing an error.</p>\n\n<p>This is my statement:</p>\n\n<pre><code>ALTER TABLE Company add(id3 int , id4 int, id5 int  , pjid int , ssid int , \n    searchkeyword1 nvarchar(max) ,searchkeyword2 nvarchar(max) ,\n    searchkeyword3 nvarchar(max) ,searchkeyword4 nvarchar(max) );\n</code></pre>\n\n<p>Thanks ,</p>\n"},{"tags":["sql","sql-server","silverlight","sql-server-2008","reporting-services"],"answer_count":8,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":1449,"score":6,"question_id":1248059,"title":"looking for some cool Silverlight chart Demos","body":"<p>I am currently using Reporting Service of SQL Server 2008, and I think the user interface is not very elegant. And I want to use Silverlight as user interface to render reporting service backend data. Two questions,</p>\n\n<ol>\n<li><p>Is it possible? Reporting Service exposes interface which Silverlight could retrieve data and render?</p></li>\n<li><p>I am looking for some cool Demos, better free with source codes, which could dynamically show different kinds of charts, curves on coordinates based on the data retrieved by some data source (e.g. Reporting Service).</p></li>\n</ol>\n\n<p>thanks in advance,\nGeorge</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12869048,"title":"hierarchy query sql server 2008","body":"<pre><code>EmployeeId, Name, ManagerId\n1,Mac Manager, null\n2,Sue Supervisor, 1\n3,Earl Employee, 2\n4,Sam Supervisor, 1\n5,Ella Employee, 4\n\nGiven: Employee Id = 3\n</code></pre>\n\n<p>Can you help me with sql to get the employee plus managers up the chain?</p>\n\n<p>In this example the results would be</p>\n\n<pre><code>Earl\nSue\nMac\n</code></pre>\n"},{"tags":["sql-server-2008","database-design","varcharmax"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12808471,"title":"Storing distance matrix as VarChar(Max) in SQL Server database","body":"<p>I'm developing a fleet scheduling application and look for an effective way to store distances between geographic locations.</p>\n\n<p>The application-code accesses the matrix as a two-dimensional array <em><code>double[,]</code></em>.</p>\n\n<p>In order to make the matrix persistent, I currently serialize the matrix as a string. After serialization it looks like this:</p>\n\n<pre><code>\"1 4 9 8 3 6 \\n\n 5 6 7 9 3 6 \\n\n 34 4 5 6 6 7 \\n\"\n</code></pre>\n\n<p>Then it is stored in a column of type <code>varchar(max)</code> in a SQL Server 2008 database. However, I wonder if this string could get too big. </p>\n\n<p>Assuming that each entry has one digit and neglecting white-spaces and \"\\n\"s, theoretically I could store the distances of around 46000 locations (square-root of 2 147 483 647 - the size of <code>varchar(max)</code>) in one entry. This would be sufficient in my context.</p>\n\n<p>Does this approach have any severe disadvantages? Would it be better to store distances in an extra table, where each row contains one distance between two locations?</p>\n\n<p>If 100 users of our application stored 1000 locations respectively, I would have 100000000 = 100 * 1000 * 1000 rows in such a table....</p>\n"},{"tags":["sql","sql-server-2008","database-design"],"answer_count":6,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":1863,"score":4,"question_id":5384183,"title":"Database Design Question - Categories / Subcategories","body":"<p>I have a question for how I would design a few tables in my database. I have a table to track Categories and one for Subcategories:</p>\n\n<pre><code>TABLE Category\n    CategoryID INT\n    Description NVARCHAR(500)\n\nTABLE Subcategory\n    SubcategoryID INT\n    CategoryID INT\n    Description NVARCHAR(500)\n</code></pre>\n\n<p>A category might be something like Electronics, and its Subcategories might be DVD Players, Televisions, etc.</p>\n\n<p>I have another table that is going to be referencing the Category/Subcategory. Does it need to reference the SubcategoryID?</p>\n\n<pre><code>TABLE Product\n    SubcategoryID INT  -- should this be subcategory?\n</code></pre>\n\n<p>Is there a better way to do this or is this the right way? I'm not much of a database design guy. I'm using SQL Server 2008 R2 if that matters.</p>\n"},{"tags":["c#","asp.net",".net","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12870477,"title":"How to rollback transaction at later stage?","body":"<p>I have a data entry ASP.NET application. During a one complete data entry many transactions occur. I would like to keep track of all those transactions so that if the user wants to abandon the data entry, all the transaction of which I have been keeping record can be rolled back.</p>\n\n<p>SQL 2008 ,Framework version is 4.0 and I am using c#.</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12870657,"title":"Cant find error (Unclosed quotation mark after the character string ''.)","body":"<p>Code snippet:</p>\n\n<pre><code>dbCommand = new SqlCommand(\"sp_EVENT_UPATE '\" \n    + currentEvent.EventID + \"','\" + currentEvent.Description + \"','\" \n    + currentEvent.DisciplineID + \"'\", dbConnection);\n</code></pre>\n\n<p>Where am I missing a quote?</p>\n"},{"tags":["database","sql-server-2008","vmware-workstation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12870128,"title":"Access a SQL Server database on localhost from vmware guest os","body":"<p>I am doing a client server project and i needed to test whether client server model is working. I am now trying to use windows xp 32 bit, which is a virtual guest os in vmware workstation, to act as a client by making my physical machine(windows 7 x64 sp1) server.</p>\n\n<p>I am using SQL Server 2008. I need to access the database in the server from my client.\nHow can I do this?Is it possible to do so?... Thanks in advance..</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":3,"view_count":44,"score":-2,"question_id":12869831,"title":"Where is Database or Script for (http://www.scribd.com/doc/109623538/SQL-Queires-Asked-in-Interviews)","body":"<p>Where is Database or Script for This Queries In Link.\n(http://www.scribd.com/doc/109623538/SQL-Queires-Asked-in-Interviews)?</p>\n\n<p>-Thank You.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12868607,"title":"Determining Page count on each Sql Table without using DBCC?","body":"<p>I am trying to compress my largest tables in my db. I will do this by running the SP_ForEachDB stored procedure. However I cannot figure out how to view the total page count. I can get row count with this query...</p>\n\n<p>USE DEVELOP04_HiltonUS</p>\n\n<p>GO</p>\n\n<p>SELECT \n    [TableName] = so.name, \n    [RowCount] = MAX(si.rows) \nFROM \n    sysobjects so, \n    sysindexes si \nWHERE \n    so.xtype = 'U' \n    AND \n    si.id = OBJECT_ID(so.name) \nGROUP BY \n    so.name \nORDER BY \n    2 DESC</p>\n\n<p>Which returns: \n            TABLE NAME   ROW COUNT\n           PlannedShift  38268660\n        BudgetStaffStat  19353104\n          BudgetKBIStat  14142631\nEmployeeShiftAdjustment  13493745\n            Requirement  11020921\n     EmployeeShiftError  6857235\n      JobclassLaborData  5638692</p>\n\n<p>and so on for all my tables.</p>\n\n<p>I am looking for the same thing but returning page Count instead.</p>\n"},{"tags":["c#","visual-studio-2010","sql-server-2008","asp.net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12867998,"title":"sql database interaction from visual studio","body":"<p>I have a helper class in my root <code>AppCode</code> folder that saves me time and coding executing database related tasks</p>\n\n<p>and i am looking for a way to have all tables and columns names into the intelliSense</p>\n\n<p>so for example</p>\n\n<pre><code>public static class GetTableData\n{\n    //base method\n    static int ExecSQLint(string TblintSQL)\n    {\n        int value;\n        SqlConnection myConn = new SqlConnection(\"server=(local);Initial Catalog=dbName;Integrated Security=True\");\n        SqlCommand TblintCMD = new SqlCommand(TblintSQL, myConn);\n\n        try\n        {\n            myConn.Open();\n            value = Convert.ToInt32(TblintCMD.ExecuteScalar());\n        }\n        finally\n        {\n            myConn.Close();\n        }\n\n        return value;\n    }\n\n    //return a Database value as int \n    public static int AsInt(string FieldToSearch, string tblName, string WhereClause, string FLdValue)\n    {\n        string TblintSQL = \"SELECT \" + FieldToSearch + \" FROM \" + tblName + \" WHERE \" + WhereClause + \" ='\" + FLdValue + \"'\";\n        return ExecSQLint(TblintSQL);\n    }\n}\n</code></pre>\n\n<p>so if i need a customer id(int) from  a table for example </p>\n\n<p>some <code>[tblCustomers]</code> i have a column named <code>custID</code> and <code>name</code></p>\n\n<p>i will retrive customer id via following Code </p>\n\n<pre><code>int custId = GetTableData.AsInt(\"custID\", \"tblCustomers\", \"name\", \"warren\");\n</code></pre>\n\n<p>I would like to get available Columns and table names into Visual studio so i will not have to use\nstrings as used in example above \nwhat would be the simplest way to achieve that ?, </p>\n\n<p>is it by generating  a code that will generate a  class with <code>const strings</code> </p>\n\n<p>or is there a utility I don't know about inside the Visual Studio ? (I'm currently using 2010 Pro)</p>\n"},{"tags":["sql-server","sql-server-2008","ms-access","ms-access-2007"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12867898,"title":"SQL Server Bit Field Sorts Backwards in MS Access Boolean/Checkbox","body":"<p>I've been using SQL Server with ODBC linked tables for quite a long time already. Only today did I discover that SQL Server bit fields are backwards in MS Access. If you right-click on a Datasheet checkbox column and choose \"Sort Cleared to Selected\", it actually sorts Selected to Cleared.</p>\n\n<p>I understand that this comes from the fact that Access/Jet/ACE stores True as -1 whereas the SQL Server bit field stores True as 1.</p>\n\n<p>I'm wondering what the best solution for this is. Can I just use some kind of integer field to get around this problem?</p>\n"},{"tags":["sql","sql-server-2008","record"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":483,"score":2,"question_id":3436611,"title":"Select latest record with some more conditions","body":"<pre><code>ID    Level Effective Date  ExpirationDate\n000012-12     2 12/01/2005  NULL\n000012-12    1    12/01/2005  NULL\n000012-12    2    12/01/2005  01/01/2009\n000012-A12    2 10/01/1994  11/30/2005\n000012-A12    2 01/01/1999  11/30/2005\n000012-A12    2 09/01/2001  11/30/2005\n000012-A12    1 12/01/2005  12/31/2007\n</code></pre>\n\n<p>Only most current Records will be fetched. It means in the above scenario<br>\nExp date - If <code>null</code> the record is still active.<br>\n           If greater then current time stamp, its future exp date , which means still active.<br>\n           If less then current time stamp , then terminated.<br>\nMost current is the most active or latest terminated record. If it has active and terminated then only active will be shown. Else last terminated record.</p>\n\n<p>One ID can have 2 rows for same effective date and exp date but multiple levels. So in that case we would need to select only 1 record for level one.</p>\n\n<p>So as per the data set above below is the intended output</p>\n\n<p>Output          </p>\n\n<pre><code>000012-12    1   12/01/2005  NULL\n000012-A12  2   12/01/2005  01/01/2009\n</code></pre>\n\n<p>Please help</p>\n\n<p>Thomas. Please look into the following data set.</p>\n\n<pre><code>Insert #Test( Id, Level, EffectiveDate, ExpirationDate ) Values ('000872-A24',1,'1994-10-01',NULL); \nInsert #Test( Id, Level, EffectiveDate, ExpirationDate ) Values ('000872-A24',1,'1999-01-01',NULL);  \nInsert #Test( Id, Level, EffectiveDate, ExpirationDate ) Values ('000872-A24',2,'2001-09-01',NULL ); \nInsert #Test( Id, Level, EffectiveDate, ExpirationDate ) Values ('000872-A24',1,'2003-01-01','2007-12-31'); \n</code></pre>\n\n<p>When you run the query it should give</p>\n\n<blockquote>\n  <p>000872-A24    2   09/01/2001  NULL</p>\n</blockquote>\n\n<p>but now it returns </p>\n\n<blockquote>\n  <p>000872-A24    1   01/01/2003  12/31/2007</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12867063,"title":"SQL Coalesce STR results in an INT","body":"<p>I have the following:</p>\n\n<pre><code>    Select tp.PH_F pHF, COALESCE(STR(tp.pH_F), tp.pH_S) pH\n     From tblprod tp\n</code></pre>\n\n<p>Note that PH_F is a float</p>\n\n<p>I get the following results</p>\n\n<pre><code>PHF    PH\n---    ---\n7.256   7\n7.59   8\n</code></pre>\n\n<p>Why does the STR convert int the Coalesce result in an INT? What I like happen is have it be the same value.</p>\n\n<p>What I like happen is the following:</p>\n\n<pre><code>PHF    PH\n---    ---\n7.256   7.256\n7.59   7.59\n</code></pre>\n\n<p>How can I have this happen with the Coalesce? </p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":68,"score":-1,"question_id":12854817,"title":"Inserting data into one column fails saying values in another column can't be null","body":"<p>I can't understand this misunderstanding by SQL&nbsp;Server.</p>\n\n<p>As you can see, I'm trying to insert into column Ordamount, but SQL&nbsp;Server shows me in its error message that it can't insert null into column UserID?</p>\n\n<pre><code>Declare @variable1 int =( select sum(Orr.quantity *OI.Iteprice)\n                          from Orderrouter Orr\n                          inner join OrdItem OI on Orr.OrdItems =OI.ItemId\n                          where OrdId = 1)\n\n insert into Ord (Ordamount)\n values (@variable1);\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>Msg 515, Level 16, State 2, Line 6<br/> Cannot insert the value\n  NULL into column 'UserID', table 'Example.dbo.Ord'; column does\n  not allow nulls. INSERT fails.</p>\n  \n  <p>The statement has been terminated.</p>\n</blockquote>\n"},{"tags":["entity-framework","sql-server-2008","connection-string"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1226,"score":2,"question_id":5920765,"title":"Does the Entity Framework use a default intital catalog and what assumptions does it make?","body":"<p>I did (pretty much) everything correct in a new EF project, but I forgot to use the named connection string in the EF context class, so, it used the default.</p>\n\n<p>It created a new database inside the SQL Express default data directory, and it worked perfectly.</p>\n\n<p>When I realised my mistake (After wondering for ages why no files were showing up in the app_data folder), I renamed the class to use the named connection string and then I kept getting the following error:</p>\n\n<blockquote>\n  <p>Unable to complete operation. The\n  supplied SqlConnection does not\n  specify an initial catalog.</p>\n</blockquote>\n\n<p>I know how to fix this, but, EF is like magic to me! I can't believe it works as well as it does and I am just curious as to what it uses by default / is there a list anywhere of \"assumptions\" that EF uses on your behalf if you specify nothing?</p>\n"},{"tags":["sql","sql-server-2008","tsql","pivot"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12865206,"title":"SQL rotate rows to columns...dynamic number of rows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10404348/sql-server-dynamic-pivot-query\">SQL Server dynamic PIVOT query?</a>  </p>\n</blockquote>\n\n\n\n<p>I have a dataset that has the below structure.</p>\n\n<pre><code>CREATE TABLE #TempTable\n  (\n     Measure_ID  INT,\n     measurement DECIMAL(18, 4)\n  )\n\nINSERT INTO #TempTable\nVALUES\n(1,2.3)\n,(1,3.4)\n,(1,3.3)\n,(2,3)\n,(2,2.3)\n,(2,4.0)\n,(2,4.5)\n</code></pre>\n\n<p>I need to produce output that will look like this.</p>\n\n<pre><code>1,2.3,3.4,3.3\n2,3,2.3,4.0,4.5\n</code></pre>\n\n<p>Basically its a pivot on Measure_ID.  Unfortunately, there can be an unlimited number of measure_id's.  So Pivot is out.</p>\n\n<p>I'm hoping to avoid CURSORS, but will if that turns out to be the best approach.</p>\n"},{"tags":["sql-server-2008","stored-procedures","views","udf","computed-columns"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12865584,"title":"Multiple SQL Server Computed columns populate using a single UDF possible?","body":"<p>I have to populate two columns(say EmpId and EmpName) as computed in my View. I was using a scalar User Defined Function to get that id from another table. But now, I have to get both the columns. Is there a way I can return two columns from my UDF(which I'm calling using a stored proc.) to populate my View.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server-2008","date","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12864759,"title":"Stored procedure in SQL Server 2008 to determine the next two working days are holidays or not ( as per usa holidays)","body":"<p>I need a stored procedure to determine whether the next two working days are holidays or not.</p>\n\n<p>Today is : <code>date.now()</code></p>\n\n<p>Thanks &amp; Regards.</p>\n\n<p>I tried like this :</p>\n\n<pre><code>create procedure holidaysearch\n   @holidaydate varchar(10)\nas\nbegin\n  set nocount on\n\n  select xxxx\nfrom dbsample\n  where hilidaydate = @holidaydate\nend\n</code></pre>\n"},{"tags":["sql","sql-server-2008","reporting-services","charts","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12824063,"title":"SSRS 2008: Expression to determine width of bar in chart?","body":"<p>I have a query which returns a dataset like the one below:</p>\n\n<pre><code>WaitTimeGroup   WaitTimeGroupID     WaitTimeGroupNotify    Count\nupto 1h         1                   0                      0\nupto 2h         2                   0                      5\nupto 3h         3                   0                      15\nupto 3h30m      4                   1                      3\nupto 3h45m      5                   2                      2\nupto 4h         6                   3                      1\nupto 6h         7                   0                      9\nupto 12h        8                   0                      0\nover 12h        9                   0                      0\n</code></pre>\n\n<p>Which is then used to display the following chart using SSRS 2008:</p>\n\n<p><img src=\"http://i.stack.imgur.com/AC9lJ.png\" alt=\"enter image description here\"></p>\n\n<p>What I would like to be able to do is make the non-gray bars wider, in particular the bright red one. The colors are determined by the WaitTimeGroupNotify value.</p>\n\n<p>I've tried setting an expression in the PixelPointWidth CustomAttribute property though this displayed all bars with the same width.</p>\n\n<p>Is this possible using SSRS 2008 or perhaps someway it can be achieved by modifying my dataset?</p>\n"},{"tags":["sql","sql-server-2008","dbf"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":5213,"score":4,"question_id":3119868,"title":"How to go from DBF files to SQL Server 2008?","body":"<p>I have an application that uses DBF files and I need to import them to SQL Server 2008. However, I also need to modify some of the data along the way and some columns will be added to tables while others will be deprecated.</p>\n\n<p>So far I'm using DBF -> Access -> MS Migration Assistant -> SQL Server 2008. But I think that there has to be a better way to handle it. I'd like to get away from the Migration Assistant because it doesn't let you modify the data when you import it.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","database-design"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":401,"score":4,"question_id":6418214,"title":"Table Normalization (Parse comma separated fields into individual records)","body":"<p>I have a table like this:</p>\n\n<p><strong>Device</strong></p>\n\n<pre><code>DeviceId   Parts\n\n1          Part1, Part2, Part3\n2          Part2, Part3, Part4\n3          Part1\n</code></pre>\n\n<p>I would like to create a table 'Parts', export data from Parts column to the new table. I will drop the Parts column after that</p>\n\n<p>Expected result</p>\n\n<p><strong>Parts</strong></p>\n\n<pre><code>PartId PartName\n\n  1      Part1\n  2      Part2\n  3      Part3\n  4      Part4\n</code></pre>\n\n<p><strong>DevicePart</strong></p>\n\n<pre><code>DeviceId PartId\n\n  1      1\n  1      2\n  1      3\n  2      2\n  2      3\n  2      4\n  3      1\n</code></pre>\n\n<p>Can I do this in SQL Server 2008 without using cursors?</p>\n"},{"tags":["php","sql-server-2008","zend-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":11135561,"title":"Connecting to MSSQL-Server 2008 under Zend server","body":"<p>Hi I'm currently trying to connect to MSSQL-Server-2008 using php on a Zend (web) server.\nI've tried out a few things now but always end up getting:\nPHP Warning:  PHP Startup: Unable to load dynamic library 'E:\\Zend\\ZendServer\\lib\\phpext\\php_pdo_sqlsrv_53_ts_vc9.dll' - The required module was not found\n<em>(sry if the error message sounds a bit strange I translated it manually into english)</em></p>\n\n<p>First step I did was to download:\nMicrosoft SQL Server 2008 R2 Native Client</p>\n\n<p>2nd step was that I downloaded:\nSQLSRV20.EXE and extracted the files into the phpext directory.</p>\n\n<p>3rd step was that I tried to turn on:\npdo_sqlsrv_53_nts_vc9\nand / or \npdo_sqlsrv_53_ts_vc9\nAnd restarted php.</p>\n\n<p>Regardless of what I did I received the above error message.\nThus every time I try to connect to the mssql server I get an error message:\n*PHP Fatal error:  Call to undefined function sqlsrv_connect()* </p>\n\n<p>Are there any additional steps needed?\n(PHP Version I use is: 5.3.9 with a very new version of the zend server).</p>\n\n<p>thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12863900,"title":"SQL server 2008: Conversion of varchar to datetime failed","body":"<p>I have problems with the following code:</p>\n\n<pre><code>USE [PCIPNY];\n\ninsert into [dbo].[test_Drug_Medication_1]\n(\n       [MedicationID] ,[ClinicID] ,[PatientID] ,[MyDrugID] ,[NDC] ,[DoctorID] ,[DrugID] ,[DrugFullDesc] ,[Generic_Name]\n      ,[Print_Name] ,[Manufacture] ,[Inactive_Date] ,[Strength] ,[Units] ,[Pkg_Size] ,[Pkg_Type] ,[Route] ,[Take]\n      ,[Frequency] ,[Duration] ,[Qualifier] ,[Quantity] ,[Refill] ,[Note] ,[DAW] ,[CreateDate] ,[CreateBy]\n      ,[ModifyBy],[IsControl] ,[UserDefine] ,[scheduleLevel] ,[BeginDate] ,[EndDate] ,[Active] ,[sente]\n      ,[OnCologyCheckStatus] ,[OnCologyCheckStatus1] ,[OnCologyCheckStatus2] ,[SIG] ,[Printed] ,[ICDCode] ,[SendeFaxed] ,[DosageForm] ,[GPI]\n      ,[IsBrand] ,[IsGeneric] ,[GenericAndBrand] ,[SigUnit] ,[IsDrug] ,[Status]\n)\n\nSELECT\n      [MedicationID] ,[ClinicID] ,[PatientID] ,[MyDrugID] ,[NDC] ,[DoctorID] ,[DrugID] ,[DrugFullDesc] ,[Generic_Name]\n      ,[Print_Name] ,[Manufacture] ,[Inactive_Date] ,[Strength] ,[Units] ,[Pkg_Size] ,[Pkg_Type] ,[Route] ,[Take]\n      ,[Frequency] ,[Duration] ,[Qualifier] ,[Quantity] ,[Refill] ,[Note] ,[DAW] ,[CreateDate] ,[CreateBy]\n      ,[ModifyBy] ,[IsControl] ,[UserDefine] ,[scheduleLevel] ,[BeginDate] ,[EndDate] ,[Active] ,[sente]\n      ,[OnCologyCheckStatus] ,[OnCologyCheckStatus1] ,[OnCologyCheckStatus2] ,[SIG] ,[Printed] ,[ICDCode] ,[SendeFaxed] ,[DosageForm] ,[GPI]\n      ,[IsBrand] ,[IsGeneric] ,[GenericAndBrand] ,[SigUnit] ,[IsDrug] ,[Status]\n\n  FROM [ec14].[dbo].[Drug_Medication]\n    where 1=1\n      and clinicid in (select clinicid from [dbo].[clinic] where org_db = 'ec14' and ClinicID=1234);\n</code></pre>\n\n<p>I got this error:</p>\n\n<blockquote>\n  <blockquote>\n    <p>Msg 241, Level 16, State 1, Line 3<br>\n    Conversion failed when converting date and/or time from character string.</p>\n  </blockquote>\n</blockquote>\n\n<p>I found out that the error is in the column <code>begindate</code>. </p>\n\n<p>The column <code>begindate</code> in ec04(origin location) is <code>charvar(16)</code> datatype.<br>\nThe column <code>begindate</code> in PCIPNY(destination location) is <code>datetime</code> datatype.</p>\n\n<p>Is there any solution to make this work?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12840034,"title":"error in stored procedure variable declaration","body":"<p>I have a query</p>\n\n<pre><code>create procedure pr_InsertFilterOnItemCreation\n@zCategoryId int,\n@zItemId int,\n@zFilterid int\nas\ndeclare @productId int\nset @productId = (SELECT convert(int,IDENT_CURRENT('item')))\nif( @productId&lt;&gt;null)\nbegin\ninsert into t_lnk_cat_product_filter_item set   cde_catid=@zCategoryId,cde_productid=@productId,cde_filterid=@zFilterid,cde_filteritemid=@zItemId\nselect 1\nend\n</code></pre>\n\n<p>I'm getting error </p>\n\n<blockquote>\n  <p>Incorrect syntax near the keyword 'set'</p>\n</blockquote>\n"},{"tags":["c#","sql-server-2008","ibm-midrange"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12861087,"title":"Sql Server isn't closing a connection to linked Server after execution","body":"<p>I am using a linked server to update records in AS/400. It isn't closing the connections properly. On the AS/400 side there are still a number of connections idle. In the sql log it is showing:</p>\n\n<p>EXCEPTION_ACCESS_VIOLATION writing address 0000000000000024 at 0x0000000077BDE4B4</p>\n\n<p>It doesn't appear that it is every time we open a connection and update the file on the AS/400 side. We updated 222 records and there were still 210 connections open. I would expect there to be 222.</p>\n\n<p>We are calling a stored procedure from a .NET app. In the stored procedure we are executing:</p>\n\n<p>EXECUTE (@as400Query) at S100405D</p>\n\n<p>Where the as400Query is a string with the update statement and S100405D is the linked server. The records are getting updated in the AS/400, so that isn't an issue. Just seems that when trying to close the connections, there is an error. Also I checked the settings on the linked server and the connection timeout = 0 (off). Not sure if setting a timeout will close them, or it won't matter because it is throwing an error anyways. </p>\n\n<p>Any help would be greatly appreciated!</p>\n\n<p>Brian </p>\n"},{"tags":["sql","sql-server","sql-server-2008","pivot","pivot-table"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12859871,"title":"How to get the description from the tables?","body":"<p>I got this query with the help of @Blue Feet. But the below query i have the instance type and in addition to that i need the instance type description from another tables.So i need to make a join with extra two tables.</p>\n\n<pre><code>Table - RelationShips:\n------------------------\nTable Name                          Column Name                 Key\nCSPGI50_VALID_INSTANCE_TYPE         CSPGI50_INSTANCE_TYPE_C     Primary\nCSPGJ02_MSG_OBJ                     CSPGJ02_MSG_K               Primary \nCSPGI03_MANUAL_ASN                  CSPGI03_ASN_C                primary\nCSPGJ03_MSG_TRANSLN                 CSPGJ03_LOCALE_C              primary   \n\nColumn Having tables:\n------------------------------\nCSPGI50_VALID_INSTANCE_TYPE(CSPGJ02_MSG_K,CSPGI50_INSTANCE_TYPE_C)\nCSPGJ03_MSG_TRANSLN(CSPGJ02_MSG_K)\nCSPGI03_MANUAL_ASN(CSPGI03_INSTANCE_TYPE_C)\nCSPGJ02_MSG_OBJ(CSPGJ02_MSG_K)\n</code></pre>\n\n<p>i have this below query,</p>\n\n<pre><code>SET DATEFIRST 1  \nSELECT \n    case when InstanceType is not null then InstanceType else 'Sum' End InstanceType , \n    sum([39]) AS FirstWeek, \n    sum([38]) AS SecondWeek,   \n    sum([37]) AS ThirdWeek, \n    sum([36]) AS FourthWeek, \n    sum([35]) AS FifthWeek, \n    sum([34]) AS SixthWeek  \nFROM \n(\n    SELECT [SPGI03_INSTANCE_TYPE_C] AS InstanceType, \n        [39], [38], [37], [36], [35], [34]  \n    FROM \n    ( \n        SELECT I03.[SPGI03_INSTANCE_TYPE_C],  \n            DatePart(wk, I03.[SPGI03_CREATE_S]) WeekNo, \n            DATEADD(DAY, 7 -DATEPART(WEEKDAY,I03.[SPGI03_CREATE_S]),\n            I03.[SPGI03_CREATE_S]) WeekEnd  \n        FROM [SUPER-G].[dbo].[CSPGI03_MANUAL_ASN] I03, [SUPER-G].[dbo].[CSPGI50_VALID_INSTANCE_TYPE] I50  \n        where I50.[SPGI50_INSTANCE_TYPE_C] = I03.[SPGI03_INSTANCE_TYPE_C] \n            and  I50.[SPGA04_RATING_ELEMENT_D] = 2 \n            and I03.[SPGI03_EXCEPTIONED_F] = 'N'  \n            and I03.[SPGI03_DISPUTED_F] != 'Y'  \n            and I03.[SPGI03_CREATE_S] between '08-19-2012 12:00:00.000' AND DATEADD(day , 7, '09-30-2012 11:59:59.000' \n    )) x \n    pivot \n    ( \n        count(WeekEnd) \n        FOR weekno IN ([39], [38], [37], [36], [35], [34])  \n    ) p \n) x1 \nGROUP BY  InstanceType WITH ROLLUP\n</code></pre>\n\n<h2>What i want:</h2>\n\n<p>I want to add the Instance Type Description from the </p>\n\n<pre><code>Table 2-column name([SPGJ03_MSG_TRANSLN_X])\n</code></pre>\n\n<p>If you have doubt please refer my previous query link\n<a href=\"http://stackoverflow.com/questions/12743869/how-to-group-by-the-each-week-upto-last-six-week-sundays-dates-in-sql\">How to group by the each week upto last six week sundays dates in sql?</a></p>\n"},{"tags":["sql","sql-server-2008","enterprise-library","enterprise"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":355,"score":4,"question_id":4479574,"title":"How do I pass a table-valued parameter to SQL Server 2008 via EntLib 5.0?","body":"<p>How do I pass a table-valued parameter to SQL Server 2008 via EntLib 5.0?</p>\n"},{"tags":["sql","sql-server","string","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":133,"score":1,"question_id":12854674,"title":"sql split string to one row","body":"<pre><code>declare @sqlstr varchar(max);\nselect @sqlstr = 'a,b,c,d,e,f';\n</code></pre>\n\n<p>I want use a sql statement to one row with six columns in sql server2008.</p>\n\n<pre><code>a,b,c,d,e,f\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":91,"score":1,"question_id":12853319,"title":"combine today and total previous from today of that same column results in one sql query","body":"<pre><code>declare @temp table (ddate datetime)\n\ninsert @temp\nselect DATEDIFF(d,0,CONVERT(smalldatetime,'09/30/2012')  -Number)\nfrom master..spt_values\nwhere type='p' and number &lt; DatePart(d,'09/30/2012')\norder by 1\n\nDECLARE @DeptCode int =1 \n</code></pre>\n\n<p><strong>-- to display of particular date data</strong> </p>\n\n<pre><code>select   ComplaintMedia_Abbri,\nddate,COUNT(ComplaintMedia)  as c\nfrom    Complaint \nINNER JOIN @temp \nON convert(datetime,convert(varchar(10),ComplaintDate,101),101)=convert(datetime,convert(varchar(10),ddate,101),101)        \nWHERE isnull(Receivedby_Dept,Relatesto_Dept)=1     \ngroup by ComplaintMedia_Abbri,ddate\norder by ddate,ComplaintMedia_Abbri\n</code></pre>\n\n<p><strong>-- to display till date particular date data running total</strong> </p>\n\n<pre><code>select   ComplaintMedia_Abbri,ddate,\n    COUNT(ComplaintMedia_Abbri)  as c\n    from    Complaint \n\n    INNER JOIN @temp \n    ON convert(datetime,convert(varchar(10),ComplaintDate,101),101)&lt;=convert(datetime,convert(varchar(10),ddate,101),101)       \n\n    WHERE isnull(Receivedby_Dept,Relatesto_Dept)=1     \n    group by ComplaintMedia_Abbri,ddate\n</code></pre>\n\n<p>I want to show running total till date and today (that day ) records in one  sql query results .....</p>\n\n<p>as on join there is two difference conditions. </p>\n\n<p>expected result should be look like this </p>\n\n<p><img src=\"http://i.stack.imgur.com/dxhoz.jpg\" alt=\"expected result for above query \"></p>\n\n<p><strong>Edit :</strong>\nI am able to achive this result by using these queries and joining them but i want to do this task in one single query instead of two queries </p>\n\n<p>my current way can be check here . sorry for such long question but i think its necessary to understand question actually ..</p>\n\n<pre><code>declare @temp table (ddate datetime)\n\ninsert @temp\nselect DATEDIFF(d,0,CONVERT(smalldatetime,'09/30/2012')  -Number)\nfrom master..spt_values\nwhere type='p' and number &lt; DatePart(d,'09/30/2012')\norder by 1\n\n--select * from @temp\n\nSELECT * FROM \n\n        (select ddate,ISNULL(L,0) AS Letter,\n          ISNULL(P,0) AS Phone,\n          ISNULL(E,0) AS Email,\n          ISNULL(W,0) AS WEB \n          FROM \n          (\n            select   ComplaintMedia_Abbri,\n          ddate,COUNT(ComplaintMedia)  as c\n            from    Complaint \n            INNER JOIN @temp \n            ON convert(datetime,convert(varchar(10),ComplaintDate,101),101)=convert(datetime,convert(varchar(10),ddate,101),101)        \n            WHERE isnull(Receivedby_Dept,Relatesto_Dept)=1     \n            group by ComplaintMedia_Abbri,ddate\n    ) p \n\n    pivot (SUM(c) FOR ComplaintMedia_Abbri IN (E,W,L,P)) AS pvt \n\n    ) AS [A]\n\n    INNER JOIN \n\n    (\n    select ddate,ISNULL(L,0) AS LetterTot,\n      ISNULL(P,0) AS PhoneTot,\n      ISNULL(E,0) AS EmailTot,\n      ISNULL(W,0) AS WEBTot\n      FROM \n      (\n\n    select   ComplaintMedia_Abbri,ddate,\n    COUNT(ComplaintMedia_Abbri)  as c\n    from    Complaint \n\n    INNER JOIN @temp \n    ON convert(datetime,convert(varchar(10),ComplaintDate,101),101)&lt;=convert(datetime,convert(varchar(10),ddate,101),101)       \n\n    WHERE isnull(Receivedby_Dept,Relatesto_Dept)=1     \n    group by ComplaintMedia_Abbri,ddate\n    ) p \n\n   pivot (SUM(c) FOR ComplaintMedia_Abbri IN (E,W,L,P)) AS pvt\n\n\n\n    ) AS [B]\n\n   ON A.ddate=B.ddate\n\n   order by A.ddate\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql","ssms","sqlcmd"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":3291,"score":2,"question_id":9889334,"title":"Windows authenticated SQL Server - need admin privileges","body":"<p>I've managed to install SQL Server 2008 R2, but I fail when trying to create a new database because of rights (or lack of) (\"CREATE DATABASE PERMISSION DENIED\"). So I tried to assign the admin privileges to my current login - \"User does not have permission to perform this action.\" I also tried to create a new login that would have admin privileges but with no luck, obviously.</p>\n\n<p>Can anyone point me in the right direction to granting myself admin rights so that I can create a database? It's a local server. And I can install again if I really need to (takes a while on this machine so it's preferable to somehow make changes to this schema if possible).</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":26,"score":-1,"question_id":12859361,"title":"what are different constraints in denormalisation in MS SQL server?please, if possible with examples","body":"<p>what are different constraints in denormalisation in MS SQL Server? please,if possible with examples</p>\n"},{"tags":["c#","sql-server-2008","stored-procedures","codebehind"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12857638,"title":"Removing records from a stored procedure recordset","body":"<p>I have a stored procedure that returns a recordset (resultset A) based on a complex query, and the records are in a particular sequence. I have another query that returns ID values from another table (resultset B).  </p>\n\n<p>I want to do something like \"Get me records from resultset A where id exists in (resultset B)\".  </p>\n\n<p>I need to do this in codebehind. Any ideas how to go about doing this?</p>\n"},{"tags":["sql","sql-server-2008","tsql","datetime"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":99,"score":3,"question_id":12858311,"title":"TSQL - get last second of current hour","body":"<p>I need to use a query to get the last second of an hour based on a field in a table.</p>\n\n<p>I have worked this query, which appears to work (SQL Server 2008)</p>\n\n<blockquote>\n  <p>SELECT DATEADD(S, -1, DATEADD(hh, 1, dateadd(minute, datediff(minute,0,GETDATE()) / 60 * 60, 0)))</p>\n</blockquote>\n\n<p>Is this the best way to go about this or are there cleaner (more readable) and faster ways. I am considering speed as this will run on a table with a lot of string processing and am trying to optimize where I can.</p>\n\n<p>EDIT: I originally posted the text and subject of this question to read 'last minute of current hour' This was intended to read 'last second'. My mind has obviously shut down for the day. Apologies for my mistake</p>\n"},{"tags":["sql-server-2008","columnname"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":127,"score":2,"question_id":12854226,"title":"how to get column names where column value is null in SQL Server 2008","body":"<p>Question:</p>\n\n<p>For a given table, I need an SQL (SQL Server 2008 Query) which can get all the column names having column value as NULL.</p>\n\n<p>Any help is appreciated.</p>\n"},{"tags":["sql-server","tsql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":7271,"score":4,"question_id":3525997,"title":"Generate MD5 hash string with T-SQL","body":"<p>Is there a way to generate MD5 Hash string of type varchar(32) without using fn_varbintohexstr</p>\n\n<pre><code>SUBSTRING(master.dbo.fn_varbintohexstr(HashBytes('MD5', 'email@dot.com')), 3, 32)\n</code></pre>\n\n<p>So it could be used inside a view with SCHEMABINDING</p>\n"},{"tags":["sql","sql-server","sql-server-2008","protection"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12855667,"title":"password protecting my SQL Server database from users","body":"<p>I am a bit confused after reading around the internet that this cannot be done.</p>\n\n<p>I have an application that I install on clients machine. This application uses SQL Server 2008 database that is installed along with the application. The database contains some tables that contain important information like giftvoucher balance.</p>\n\n<p>I want to prevent unauthorised access to the database but problem is since I am installing my database on client machine they already have access to the SQL management studio through windows authentication.</p>\n\n<p>Is it possible to prevent them from getting access to my database and tables ?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12854180,"title":"How to weekly aggregate data in sql and include skipped weeks too","body":"<p>I am working in SQL Server 2008. I am writing a stored procedure which aggregates data on a weekly basis.</p>\n\n<p>Code for aggregation is </p>\n\n<pre><code>ALTER PROCEDURE [dbo].[ups_URLBatchStats] \n   (@startDate datetime, @endDate datetime,@source varchar(8))\nAS BEGIN\n    SELECT \n       DATEADD(wk, DATEDIFF(wk, 0, ScheduleDate), 6) AS [Week Commencing], \n       SUM(Unresolved) AS Unresolved,\n       SUM(Resolved) AS Resolved,\n       SUM(TurkSpend) AS TurkSpend\n    FROM \n       dbo.V_URLBatchStats \n    WHERE\n       ScheduleDate BETWEEN @startDate AND @endDate \n       AND Source = ISNULL(@source, Source)\n    GROUP BY\n       DATEADD(wk, DATEDIFF(wk, 0, ScheduleDate), 6)\n    ORDER BY \n       DATEADD(wk, DATEDIFF(wk, 0, ScheduleDate), 6)\nEND\n</code></pre>\n\n<p>Show it gives me correct result, but if there are no data for any week I have to show it with values of '0' in the columns.</p>\n\n<p>So how can I handled these skipped weekly rows?</p>\n\n<p>Thanks in advance.  </p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":67,"score":3,"question_id":12852681,"title":"How to display the time with half and hour intervals in sql","body":"<p>I am using SQL Server 2008, I have time column (<code>varchar</code>) with time intervals 10 min basis. I want to display the time with half and hour basis..</p>\n\n<p>The table (<code>timeslot</code>) has this data:</p>\n\n<pre><code>time\n-----\n11:10 AM\n11:20 AM\n11:30 AM\n11:40 AM\n11:50 AM\n12:00 PM\n12:10 PM\n12:20 PM\n12:30 PM\n12:40 PM\n12:50 PM\n01:00 PM\n01:10 PM\n01:20 PM\n</code></pre>\n\n<p>And I want to display this output:</p>\n\n<pre><code>time\n-----\n11:00 AM\n11:30 AM\n12:00 PM\n12:30 PM\n01:00 PM\n01:30 PM\n</code></pre>\n\n<p>Can anybody help me on this? thanks in advance...</p>\n"},{"tags":["c#","asp.net","sql-server-2008","ado"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":12853804,"title":"Image from SQL Server Table to asp.net image control","body":"<pre><code>SqlCommand cmd = new SqlCommand(\"select top 1(CMTID),COMMENT,HEADING from FTAB ORDER BY CMTID DESC\", conn);\nconn.Open();\nSqlDataReader sdr = cmd.ExecuteReader();\nif (sdr.Read() == true)\n{\n    lblHead.Text = sdr[\"HEADING\"].ToString();\n    lblData.Text = sdr[\"COMMENT\"].ToString();\n\n}\nconn.Close();\n</code></pre>\n\n<p>that is the code for normal data value reterive from table now I want to get Picture from sql server that save as Binary data that code mention in bottom., so I want to reterive picture on Image control of asp.net so please guide me .</p>\n\n<pre><code>if (FileUpload1.HasFile)\n    {\n        conn.Close();\n        String SqlQery;\n        SqlQery = \"select max(CMTID) from FTAB\";\n        SqlCommand cmdid = new SqlCommand(SqlQery, conn);\n        conn.Open();\n        MaxID = (int)(cmdid.ExecuteScalar()) + 1;\n        conn.Close();\n        byte[] img = new byte[FileUpload1.PostedFile.ContentLength];\n        HttpPostedFile myimg = FileUpload1.PostedFile;\n        myimg.InputStream.Read(img, 0, FileUpload1.PostedFile.ContentLength);\n        SqlCommand cmd = new SqlCommand(\"insert into FTAB (CMTID,IMAGEDT,COMMENT,DATETM,HEADING) values (@imgid,@image,@comment,@datetm,@heading)\", conn);\n\n        SqlParameter imgid = new SqlParameter(\"@imgid\",SqlDbType.Int);\n        imgid.Value = MaxID;\n        cmd.Parameters.Add(imgid);\n\n        SqlParameter uploading = new SqlParameter(\"@image\", SqlDbType.Image);\n        uploading.Value = img;\n        cmd.Parameters.Add(uploading);\n\n        SqlParameter cmtt = new SqlParameter(\"@comment\", SqlDbType.NVarChar);\n        cmtt.Value = RadTextBox3.Text;\n        cmd.Parameters.Add(cmtt);\n\n        SqlParameter dttm = new SqlParameter(\"@datetm\", SqlDbType.DateTime);\n        dttm.Value = DateTime.Now;\n        cmd.Parameters.Add(dttm);\n\n        SqlParameter hhding = new SqlParameter(\"@heading\", SqlDbType.NVarChar);\n        hhding.Value = RadTextBox8.Text;\n        cmd.Parameters.Add(hhding);\n\n        conn.Open();\n        cmd.ExecuteNonQuery();\n        conn.Close();\n        lblHead.Text = \"Image uploaded\";\n    }\n    else\n    {\n        lblHead.Text = \"No file selected\";\n    }\n</code></pre>\n"},{"tags":["sql-server-2008","pdo","yii","freetds"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":301,"score":0,"question_id":9311138,"title":"pdo dblib stored procedure insert wrong characters","body":"<p>i'm using microsoft sql server as database and my php code on centos server. using freetds and dblib to connect from yii framework to mssql.</p>\n\n<p>everything's are fine. after insert into db by Stored Procedure, data saved but in database query we have ??????? in this NVARCHAR column.</p>\n\n<p>my data in utf-8 arabic. this is my configuration and code:</p>\n\n<p>fretds.conf  </p>\n\n<pre><code>[mss]  \n        host = 172.31.1.2  \n        ip = 172.31.1.2  \n        port = 1433  \n        tds version = 7.0\n</code></pre>\n\n<p>yii main configuration</p>\n\n<pre><code>'db'=&gt;array(\n        'connectionString' =&gt; 'dblib:host=mss;database=XXXX;charset=utf8',\n        'username' =&gt; 'XXX',\n        'password' =&gt; 'XXXXXXXX',\n        'charset' =&gt; 'utf8',\n        'tablePrefix' =&gt; 'tbl_',\n        'enableProfiling' =&gt; true,\n        'schemaCachingDuration' =&gt; 5 * 60 * 60,\n        ),\n</code></pre>\n\n<p>my model Stored Procedure</p>\n\n<pre><code>$builder=$this-&gt;getCommandBuilder();\n$table=$this-&gt;getMetaData()-&gt;tableSchema;\n\n$command=$builder-&gt;createSqlCommand('EXEC dbo.sp_link_comment_insert  :link_id, :cmnt_parent_id, :user_id, :cmnt_status, :cmnt_text, :cmnt_thread',\n                    array(\n                        ':link_id'=&gt;58829,\n                        ':cmnt_parent_id'=&gt;'',\n                        ':user_id'=&gt;9,\n                        ':cmnt_status'=&gt;1,\n                        ':cmnt_text'=&gt;'تست ارسال comment',\n                        ':cmnt_thread'=&gt;0,\n                    )\n                );\n$command-&gt;execute();\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12850937,"title":"Full Join on two queries","body":"<p>I'm trying to do a full join on two SQL queries, below:</p>\n\n<p><b>1st Query:</b></p>\n\n<pre><code>SELECT\n    ID\n    ,SUM(CASE WHEN reason = 4 THEN 0 ELSE quantity*price END) AS TValue\n    ,COUNT(*) AS CountAll\nFROM table1\nWHERE Date&gt;=@StartDate AND Date&lt;=@EndDate\nGROUP BY ID\n</code></pre>\n\n<p><b>2nd Query:</b></p>\n\n<pre><code>SELECT\n    ID\n    ,SUM(CASE WHEN reason = 1 THEN 1 ELSE 0 END) AS New\n    ,SUM(CASE WHEN reason = 6 THEN 1 ELSE 0 END) AS Amend\n    ,SUM(CASE WHEN reason = 5 THEN 1 ELSE 0 END) AS Cancel\nFROM Table2\nWHERE Date2 &gt;=@StartDate AND Date2&lt;= @EndDate\nGROUP BY ID\n</code></pre>\n\n<p><b>Result from query1</b></p>\n\n<pre><code>ID   CountAll     TValue    \n-------------------------\nid1     24         1020      \nid2     13         2030      \nid3      4          120    \n</code></pre>\n\n<p><b>Result from query 2:</b></p>\n\n<pre><code>ID     New     Amend     Cancel\n--------------------------------\nid1    12         4         6\nid2     7         6         1\nid4     2         1         2\n</code></pre>\n\n<p>Needed output:</p>\n\n<pre><code>ID     TValue     CountAll     New    Amend    Cancel   Total(countall+new+amend+cancel)\n----------------------------------------------------------------------------------------\nId1    1020          24        12       4         6        46\nId2    2030          13         7       6         1        27\nid3     120           4         0       0         0         4\nId4       0           0         2       1         2         5\n</code></pre>\n\n<p>I'll post my current solution if requested, but it is pretty far from working.</p>\n\n<p>I've been doing a bit of research and I think I need to either make a union to join the ID'S, or just do a Full Join. (Second day ever doing sql)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12850330,"title":"Error 8120 in T-SQL (nested select command)","body":"<p>What is my mistake in this statement?</p>\n\n<pre><code>Select Max (TBLvirtual.c2) as MOF --&gt; Most ordered food (MOF)--//\n      ,TBLvirtual.c1\nfrom\n    (select a.OrdItems as c1, count(a.OrdID) as c2\n     from Orderrouter a \n     group by a.OrdItems) as TBLvirtual\n</code></pre>\n\n<p>I received this error:</p>\n\n<blockquote>\n  <p>Msg 8120, Level 16, State 1, Line 3 Column 'TBLvirtual.c1' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</p>\n</blockquote>\n"},{"tags":["visual-studio-2008","sql-server-2008","ssis"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2909,"score":0,"question_id":6446619,"title":"how debug a script component in SSIS","body":"<p>It's simple but i can't make it work, and read in so many place a lot of solutions and no one had worked for me. How can i accomplished this.</p>\n\n<p><strong>Note</strong></p>\n\n<p>I put the break point in my code and run the entire package but still without work</p>\n"},{"tags":["xml","sql-server-2008","ssis"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12847625,"title":"How Do I split a SQL Server 2008 XML result into individual files in SSIS","body":"<p>The source query returns the XML I need in one variable. In SSIS how do I take that variable returned by the OLE adapter and split it out on each top level leaf into a file. In the case of my sample data I want to start a new file for the submission type tag but the file name will be the date and Patient ID. So a new file for every patient.</p>\n\n<p>Sample data.</p>\n\n<pre><code>&lt;submission type=\"HOSPITAL\" data=\"CLINICAL\" version=\"1.0\" action-code=\"ADD\"&gt;\n    &lt;provider&gt;\n        &lt;provider-id&gt;120129&lt;/provider-id&gt;\n        &lt;patient&gt;\n            &lt;birthdate&gt;07-26-1925&lt;/birthdate&gt;\n            &lt;sex&gt;F&lt;/sex&gt;\n            &lt;race&gt;1&lt;/race&gt;\n            &lt;ethnic&gt;N&lt;/ethnic&gt;\n            &lt;postal-code&gt;32142&lt;/postal-code&gt;\n            &lt;episode-of-care measure-set=\"PN\"&gt;\n                &lt;admit-date&gt;09-13-1987&lt;/admit-date&gt;\n                &lt;discharge-date&gt;09-14-1988&lt;/discharge-date&gt;\n                &lt;pthic/&gt;\n                &lt;patient-id&gt;7228&lt;/patient-id&gt;\n                &lt;detail answer-code=\"3\" row-number=\"0\" question-cd=\"ANOTHERINF\"/&gt;\n                &lt;detail answer-code=\"Y\" row-number=\"0\" question-cd=\"ANTIALLERGY\"/&gt;\n            &lt;/episode-of-care&gt;\n        &lt;/patient&gt;\n    &lt;/provider&gt;\n&lt;/submission&gt;\n&lt;submission type=\"HOSPITAL\" data=\"CLINICAL\" version=\"1.0\" action-code=\"ADD\"&gt;\n    &lt;provider&gt;\n        &lt;provider-id&gt;168729&lt;/provider-id&gt;\n        &lt;patient&gt;\n            &lt;birthdate&gt;07-26-1835&lt;/birthdate&gt;\n            &lt;sex&gt;F&lt;/sex&gt;\n            &lt;race&gt;1&lt;/race&gt;\n            &lt;ethnic&gt;N&lt;/ethnic&gt;\n            &lt;postal-code&gt;39142&lt;/postal-code&gt;\n            &lt;episode-of-care measure-set=\"PN\"&gt;\n                &lt;admit-date&gt;09-13-1986&lt;/admit-date&gt;\n                &lt;discharge-date&gt;09-14-1987&lt;/discharge-date&gt;\n                &lt;pthic/&gt;\n                &lt;patient-id&gt;888&lt;/patient-id&gt;\n                &lt;detail answer-code=\"3\" row-number=\"0\" question-cd=\"ANOTHERINF\"/&gt;\n                &lt;detail answer-code=\"Y\" row-number=\"0\" question-cd=\"ANTIALLERGY\"/&gt;\n            &lt;/episode-of-care&gt;\n        &lt;/patient&gt;\n    &lt;/provider&gt;\n&lt;/submission&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12850468,"title":"Appropriate Aggregate function, or how to get around it","body":"<p>I'm trying to do a select statement using a <b>\"CASE\"</b> operation, but it says that my condition (abc.reason) is invalid because it is not contained in either an aggregate function or the GROUP BY clause. I've tried adding it to the GROUP BY clause but there is an unnecessary row created in my results table. Any tips?</p>\n\n<p><code>\nSELECT</p>\n\n<pre><code>DISTINCT ID \n,(CASE WHEN reason = 4 THEN null ELSE SUM(quantity*price) END) AS Value\n,COUNT(*) AS CountAll\n</code></pre>\n\n<p>FROM TransactionsDB</code></p>\n\n<p><code>GROUP BY ID</code></p>\n\n<p><code>ORDER BY ID DESC</code></p>\n\n<p></p>\n\n<p>If I change my GROUP BY Clause to <b><code>GROUP BY ID, reason</b></code> then my results are:</p>\n\n<p>ID    ---- VALUE ----- COUNTALL</p>\n\n<p>id1 - - 1000    - - - - - 22</p>\n\n<p>id1 - - - NULL  - - - - 1</p>\n\n<p>id2 - - - - 232 - - -- 17     </p>\n\n<p>id3 - - - - 113 -- - - 2</p>\n\n<p>id3 - - - - NULL - - 1</p>\n\n<p>When really I need the results:</p>\n\n<p>ID    ---- VALUE ----- COUNTALL</p>\n\n<p>id1 - - 1000    - - - - - <b>23</b></p>\n\n<p>id2 - - - - 232 - - -- 17     </p>\n\n<p>id3 - - - - 113 -- - - <b>3</b></p>\n\n<p>Thank you in advance!!!!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12849602,"title":"Output inserted ID from base table","body":"<p>I have a table that will hold pending data that will update another table on the same server.  This pending table gets it data from another servers stored procedure.  Once data is in this pending table, a stored procedure will attempt to insert, update, or delete based on a tinyint column in the pending table.  </p>\n\n<p>This pending table will remain empty unless something needs to occur.  At the end of the procedure, we delete from this pending table.</p>\n\n<p>An issue arose by way of what happens if the same record that needs to be updated gets inserted twice from the other server while the procedure is running.  At the end, both records would be cleared.  I've attempted to solve this by adding an incremental id onto the pending table but I can't output the id in the insert:</p>\n\n<pre><code>insert into config.table (col1, col2, col3)\noutput inserted.col3, pendingId into @table\nselect p.col1, p.col2, p.col3\nfrom pendingTable p\n left join config.table t on p.col1 = t.col1\nwhere t.col1 is null\n</code></pre>\n\n<p>I'm getting an error on the pendingId.  I plan to use the @table variable to delete from pending to avoid deleting records that were not touched (newly inserted records that were added while procedure was running).</p>\n\n<pre><code>delete p\nfrom pendingTable p\n inner join @table t on p.pendingId = t.pendingId and p.col3 = t.col3\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":51,"score":0,"question_id":12831738,"title":"Joining data from two tables with different WHERE clauses","body":"<p>I need to perform a variety of Joins / Unions on two separate tables to combine my results into a single table. First I will share what I have and what I need, then I'll share my current non-working solution.</p>\n\n<p>What I have:  </p>\n\n<ul>\n<li><p>Each table consists of a list of operations performed, each operation has a <code>opPatient</code> (all patients have had multiple operations), <code>opClassification</code> (1, 2, 3 or 4), <code>opDate</code>, <code>opPrice</code>. </p></li>\n<li><p>A <code>Start</code> and <code>End</code> date of the query.</p></li>\n</ul>\n\n<p>What I need:</p>\n\n<p>To produce a single table with:</p>\n\n<ul>\n<li>A list of all distinct <code>opPatients</code></li>\n<li>For each patient:\n<ul>\n<li>Total <code>opprice</code> of all operations</li>\n<li>Total <code>opPrice</code> of all operations with classification of 4 (Classification 4 is only in <code>table2</code>)</li>\n<li>Total number of all operations</li>\n<li>Total number of operations with a classification of 3</li>\n<li>Total number of operations with a classification of 2</li>\n</ul></li>\n<li>All of the above <code>WHERE opDate &gt;= @StartDate AND opDate &lt;= EndDate</code></li>\n</ul>\n\n<p>Current solution (not working obviously)</p>\n\n<ul>\n<li><p>Sets the <code>start</code> and <code>end</code> dates (no errors here)</p>\n\n<pre><code>SET @StartDate = DATEADD(DAY, -(DATEPART(Day, @Date)-1), @Date);    \nSET @EndDate = DATEADD(DAY, -1, (DATEADD(MONTH, 1, @StartDate)));\n\nSELECT\n   Operation = (SELECT DISTINCT operation FROM table1\n                UNION\n                SELECT DISTINCT operation FROM table2),\n   TotalPrice = CAST(opPrice) AS MONEY),\n   TotalOps = COUNT(*),\n   opC4 = COUNT(CASE\n            WHEN opClassification = 4 THEN 1 \n            ELSE Null                                  \n            END) \n            WHERE opDate &lt;= @EndDate AND opDate &gt;= @StartDate \n            FROM table2,            \n   opC3 = COUNT (CASE WHEN opClassification = 3 THEN 1 ELSE Null END),\n   opC2 = COUNT (CASE WHEN opClassification = 2 THEN 1 ELSE Null END)\n FROM \n    table1, table2\n WHERE \n     table1.opDate &lt;= @EndDate AND table1.opDate &gt;= @StartDate \n ORDER BY \n     Operation\n</code></pre></li>\n</ul>\n\n<p>All help, tips and pointers would be greatly appreciated!</p>\n\n<p>Thanks!!\nSincerely, A nooby coder.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12849940,"title":"Assigning ID to a row using an insert statement from one table into another","body":"<p>I've been trying to insert data from one row in a temporary table into an existing table in my database, which I've managed to do, but I also want to increment the ID column that already exists in the Topic table. The temp table has two columns, ID and keyword, but the keyword I'm getting from the temp table is always the first row, so the ID will always be 1 in the temp table, whereas I want the ID to be the count of the topic table plus 1.</p>\n\n<p>Sorry if this has been asked before, I just had no idea what to search for!</p>\n\n<p>This is what I have so far, not sure if I'm on the right track or not:</p>\n\n<pre><code> --declare topic id and set it as one more than the current number of rows\n DECLARE @T_ID int\n SET @T_ID = (SELECT COUNT(*) FROM Topic)+1\n\n --insert keyword into Topic table\n INSERT INTO Topic(Topic_ID, Topic_Name)\n SELECT keyword FROM #tempKeywords \n WHERE ID = 1\n</code></pre>\n"},{"tags":["mysql","sql-server-2008","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":160,"score":0,"question_id":12716595,"title":"Error when trying to update via linked server (mssql -> mysql) - Select works","body":"<p>I am having an issue when trying to do an update via a linked server.  Error is the following: </p>\n\n<pre><code>OLE DB provider \"MSDASQL\" for linked server \"**LINKED_SERVER_NAME\" returned message \"Data provider or other service returned an E_FAIL status.\".\nMsg 7330, Level 16, State 2, Line 1\nCannot fetch a row from OLE DB provider \"MSDASQL\" for linked server \"LINKED_SERVER_NAME\".\n</code></pre>\n\n<p>I have no problem selecting data but any time I try to do an update it fails. My update code:</p>\n\n<pre><code>Update [LINKED_SERVER_NAME]...[Table_Name]\nSET post_content = 'alert'\nwhere ID = 5061\n</code></pre>\n\n<p>This is my select statement which DOES work:</p>\n\n<pre><code>select top 100 * from [LINKED_SERVER_NAME]...[Table_Name] where ID = 5061\n</code></pre>\n\n<p>I am using:</p>\n\n<ul>\n<li>Microsoft SQL Server Management Studio 2008 </li>\n<li>Trying to connect from MS SQL -> MySQL via ODBC Connector 5.2 (5.1\nhas same issue)</li>\n</ul>\n\n<p>UPDATE\nI have tried to use \"OPENQUERY\" -> this does not work either</p>\n"},{"tags":["php","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":425,"score":2,"question_id":7444516,"title":"PHP Sql Server Output Parameter","body":"<p>I'm struggling with an output parameter in PHP and SQL Server 2008.  I keep getting the error:</p>\n\n<blockquote>\n  <p>Notice: Undefined variable: UserID in C:\\inetpub\\wwwroot\\PersonalWebsitePHP\\Register.php on line 67 Error in executing statementArray ( [0] => Array ( [0] => IMSSP [SQLSTATE] => IMSSP [1] => -7 [code] => -7 [2] => An invalid PHP type was specified as an output parameter. DateTime objects, NULL values, and streams cannot be specified as output parameters. [message] => An invalid PHP type was specified as an output parameter. DateTime objects, NULL values, and streams cannot be specified as output parameters. ) ) </p>\n</blockquote>\n\n<p>My code: </p>\n\n<pre><code>$con = sqlsrv_connect(\".\\SQLExpress\", $connectionInfo);\n                            if ($con === false) {\n                                echo \"Could not connect \\n\";\n                                die(print_r(sqlsrv_errors(), true));\n                            }\n\n                            $params = array(\n                                            array($_POST[\"FirstName\"], SQLSRV_PARAM_IN),\n                                            array($_POST[\"LastName\"], SQLSRV_PARAM_IN),\n                                            array($_POST[\"Email\"], SQLSRV_PARAM_IN),\n                                            array($_POST[\"Username\"], SQLSRV_PARAM_IN),\n                                            array(md5($_POST[\"Password\"]), SQLSRV_PARAM_IN),\n                                            array(date(\"Y-m-d H:i:s\"), SQLSRV_PARAM_IN),\n                                            array($_SERVER[\"REMOTE_ADDR\"], SQLSRV_PARAM_IN),\n                                            array(\"Member\", SQLSRV_PARAM_IN),\n                                            array(\"No\", SQLSRV_PARAM_IN),\n                                            array($UserID, SQLSRV_PARAM_OUT)\n                                           );\n                            $tsql_callSP = \"{call InsertUser(?,?,?,?,?,?,?,?,?,?)}\";\n                            $stmt3 = sqlsrv_query($con, $tsql_callSP, $params);\n                            if ($stmt3 === false) {\n                                echo \"Error in executing statement\";\n                                die(print_r(sqlsrv_errors(), true));\n                            }\n                            sqlsrv_next_result($stmt3);\n                            echo \"Hi \" . $_POST[\"FirstName\"] . \", your User ID is \" . $UserID . \".\";\n\n                        }\n                    } else {\n                        die (\"The reCAPTCHA wasn't entered correctly.  Go back and try it again.\");\n\n                    }\n</code></pre>\n\n<p>I followed the tutorials exactly.  When I declare     $UserID before the array, it just prints out the value declared in the variable rather than the output parameter.  The input parameters work fine since I can see them in the database.  Hope someone can help with this one.</p>\n\n<p>Thank you</p>\n\n<p>Douglas</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":283,"score":2,"question_id":9114913,"title":"Find length of varchar(max) column","body":"<p>I am trying to find the length of string columns specified in a table.</p>\n\n<p>I do this with the help of <code>CHARACTER_MAXIMUM_LENGTH</code> from <code>infomation_schema.columns</code>.</p>\n\n<p>However, for <code>varchar(max)</code> it returns -1. I was wondering if I should return the maximum allowed length whenever <code>varchar(max)</code>, <code>nvarchar(max)</code>, etc columns are present in the table?</p>\n"},{"tags":["sql-server-2008","ssis","oracle10g","database-migration"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":12848844,"title":"SSMA or SSIS for migration from Oracle 10 to SQL Server 2008 R2","body":"<p>We are planning to migrate an Oracle 10g database to SQL Server 2008 R2.<br/> At the moment nothing is implemented in the target database and this will give us the opportunity to change and improve the existing schema during the migration.<br/></p>\n\n<p>Not only the data, but also stored procedures and views have to be imported.</p>\n\n<p>I already worked with SSIS and I found an excellent product for data manipulation. <br/>A colleague mentioned SSMA for the migration. However after some research on the net it seems that it would be suitable mainly for data migration and conversion, while SSIS seems to provide a wider set of functinalities (Tasks, custom scripts, etc).</p>\n\n<p>Which are the pro/contra of the two products and which one would best fit for the task?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":89,"score":1,"question_id":12847433,"title":"INNER JOIN versus IN statement for SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1200295/sql-join-vs-in-performance\">SQL JOIN vs IN performance?</a>  </p>\n</blockquote>\n\n\n\n<p>We're backed by SQL Server 2008. We have an application where a user can choose a list of items to search on, and they get all items based on those items. The two techniques we've used are:</p>\n\n<pre><code>SELECT * FROM mytable WHERE myval IN ('A', 'B', 'C')\n</code></pre>\n\n<p>and</p>\n\n<pre><code>INSERT INTO tempTable (tempvalue) ('A'), ('B'), ('C')\nSELECT * FROM mytable m INNER JOIN tempTable t WHERE m.myval = t.tempvalue\n</code></pre>\n\n<p>The first option is easier, for sure, but performance is horrible once the user has chosen over 50 values. It's to the point where we're talking about scrapping the IN because performance degrades rapidly. </p>\n\n<p>So, why does IN perform that badly? Is this typical or is it something specific with our setup? </p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2771,"score":4,"question_id":5303134,"title":"How to add a new schema to sql server 2008?","body":"<p>How do you add a new schema to a database? I am creating a new table and would like to select my own schema from the properties list, but I don't know how to create it. I am using SQL Server Management 2008.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","cross-apply"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12846320,"title":"Using Table valued Function in join","body":"<p>There is a Table valued function which gives multiple rows as output and there are 2 columns as output.</p>\n\n<p>Now I want use this function in the query for all the employees in the employees table</p>\n\n<p>I am using CROSS APPLY but its taking long time and doesn't give any result.</p>\n\n<p>This is the query which I tried</p>\n\n<pre><code>select *\nfrom emp A Cross APPLY fnempDiv(A.EmpID)\n</code></pre>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":41,"score":-2,"question_id":12501501,"title":"SELECT lowest unused figure from range using SQL","body":"<p>I have a table that has a 'location' field that ranges from 1 to 25. I use the  following SQL to currently return the lowest 'location' that is currently unused;</p>\n\n<pre><code>select top 1 field from [dbo].[misc_fields] where field NOT IN (select location from ListFields where listid = @listid) order by field\n</code></pre>\n\n<p>The problem with this is that it is reliant on the misc_fields table which contains a row for each location (1-25). I would like to remove the need to have this lookup table and just define the range within the Stored Procedure itself.</p>\n"},{"tags":["sql-server-2008","replace"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12846495,"title":"Replace equivalence for SQL Server 2008","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10385933/replace-into-in-sql-server-2008\">Replace Into in SQL Server 2008</a>  </p>\n</blockquote>\n\n\n\n<p>How can I do this</p>\n\n<pre><code>REPLACE INTO \"product_to_store\" (\"store_id\", \"product_id\") VALUES ('1', '1')\n</code></pre>\n\n<p>in SQL Server 2008? </p>\n\n<p>I need to replace this values no just update</p>\n"},{"tags":["c#","sql-server-2008","entity-framework","associations"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12844758,"title":"Entity Framework Odd Behaviour","body":"<p>I've not been working with EF until this week (v5) and now I'm making a few database changes it's doing some really weird things.</p>\n\n<p>I deleted an NVARCHAR Country field and replaced that with an CountryId int field that is a Foreign Key to the Id column of the Country table</p>\n\n<pre><code>ALTER TABLE [dbo].[UserProfile]  WITH CHECK ADD  CONSTRAINT [FK_UserProfile_Countries]   FOREIGN KEY([CountryId])\nREFERENCES [dbo].[Countries] ([Id])\n</code></pre>\n\n<p>Updating the model in VS2012 is doing some really unexpecting things.  Its reporting an error on the field I removed:</p>\n\n<blockquote>\n  <p>Error 11010: Association End 'Country' is not mapped.</p>\n</blockquote>\n\n<p>And I have two virtual fields added to the model which doesn't seem correct:</p>\n\n<pre><code>public partial class UserProfile\n{\n    public int UserId { get; set; }\n    ...\n    public int CountryId { get; set; }\n\n    public virtual Country Country { get; set; }\n    public virtual Country Country1 { get; set; }\n}\n</code></pre>\n\n<p>I've read there is a bug with the designer and manually running \"Run Custom Tool\" on the .tt files fixes this but it doesn't appear to have worked.</p>\n\n<p>Has anyone seen this or solved it?</p>\n"},{"tags":["database","sql-server-2008","security","encryption"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":64,"score":3,"question_id":12840665,"title":"Securing a SQL Server database on a server administered /controlled by third party admins","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4552376/is-it-possible-to-password-protect-an-sql-server-database-even-from-administrato\">Is it possible to password protect an SQL server database even from administrators of the server?</a>  </p>\n</blockquote>\n\n\n\n<p>I am hosting my database on SQL Server 2008 on a windows 7 machine. The Windows 7 machine and the SQL Server 2008 are controlled and administered by third party admins. </p>\n\n<p>I have sensitive information in my database. </p>\n\n<p>How do I secure my database, so that the third party admins do not look at the sensitive data?</p>\n\n<p>Is there any way to restrict the third party admins from copying the stored procedures, table designs etc.</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12834145,"title":"How to get the procedure call from a DMV in SQL Server 2008?","body":"<p>I am using SQL Server 2008 and we need to catch the s procedure call using DMV and stored it in the table for tracking. Is it possible to get the stored procedure call ?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","correlated-subquery"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":55,"score":4,"question_id":12845281,"title":"SQL Delete clears the table instead of erroring","body":"<p>I have a piece of SQL which (you would think) wouldn't compile, but which instead deletes all rows from the target table.</p>\n\n<p>Consider this setup:</p>\n\n<pre><code>create table TableA (ColumnA varchar(200));\ncreate table TableB (ColumnB varchar(200));\n\ninsert TableA values ('A'),('B'),('C');\ninsert TableB values ('A');\n</code></pre>\n\n<p>Then the following sql:</p>\n\n<pre><code>--Returns all rows from TableA\nselect * from TableA;\n\n--Does not error (ColumnA does not exist on TableB)\ndelete TableA where ColumnA in (select ColumnA from TableB)\n\n--No Rows are returned\nselect * from TableA;\n</code></pre>\n\n<p>The delete statement above causes all rows to be removed from <code>TableA</code>, rather than erroring that <code>ColumnA</code> doesn't exist in <code>TableB</code></p>\n\n<p>There's a SQL Fiddle demontrating this here: <a href=\"http://www.sqlfiddle.com/#!3/9d883/6\" rel=\"nofollow\">http://www.sqlfiddle.com/#!3/9d883/6</a></p>\n\n<p>It seems that the <code>ColumnA</code> from <code>TableA</code> is being picked up, but expected it to be \"out of scope\". </p>\n\n<p>Why is this?</p>\n"},{"tags":[".net","sql","xml","sql-server-2008"],"answer_count":6,"favorite_count":1,"up_vote_count":5,"down_vote_count":1,"view_count":525,"score":4,"question_id":9135260,"title":"sql query to produce xml output","body":"<p>I have these tables </p>\n\n<p><strong>Table 1</strong>\n<code>tbl1_site\n[facilityId]\n[name]</code></p>\n\n<p><strong>Table 2</strong>\n<code>tbl2_applicant\n[pvid] \n[facilityId] \n[npi] \n[firstname]</code></p>\n\n<p>FK join key: tbl1_site.facilityId = tbl2_applicant.facilityId</p>\n\n<p><strong>Table 3</strong>\n<code>tbl3_abstraction\n[pvid] \n[patientnumber]\n[diabetesdiagnosis]\n[dateofbirth]</code></p>\n\n<p>FK join key: tbl2_applicant.pvId = tbl3_abstraction.pvId</p>\n\n<p>i have problem to create a sql query to reproduce this xml output.</p>\n\n<p>thanks</p>\n\n<pre><code>&lt;account&gt;\n    &lt;metadata /&gt;\n    &lt;practice-sites&gt;\n        &lt;practice-site&gt;\n            &lt;metadata&gt;\n                &lt;data-element id=\"name\"&gt;\n                    &lt;value&gt;My Own Diabetes Medical Center&lt;/value&gt;\n                &lt;/data-element&gt;\n            &lt;/metadata&gt;\n            &lt;applicants&gt;\n                &lt;metadata /&gt;\n                &lt;applicant&gt;\n                    &lt;metadata&gt;\n                        &lt;data-element id=\"npi\"&gt;\n                            &lt;value&gt;1234567890&lt;/value&gt;\n                        &lt;/data-element&gt;\n                        &lt;data-element id=\"firstname\"&gt;\n                            &lt;value&gt;Joseph&lt;/value&gt;\n                        &lt;/data-element&gt;\n                    &lt;/metadata&gt;\n                    &lt;clinical-abstractions&gt;                           \n                        &lt;clinical-abstraction&gt;\n                            &lt;data-element id=\"diabetesdiagnosis\"&gt;\n                                &lt;value&gt;Backward&lt;/value&gt;\n                            &lt;/data-element&gt;\n                            &lt;data-element id=\"dateofbirth\"&gt;\n                                &lt;value&gt;02/01/2009&lt;/value&gt;\n                            &lt;/data-element&gt;\n                            &lt;data-element id=\"patientnumber\"&gt;\n                                &lt;value&gt;1&lt;/value&gt;\n                            &lt;/data-element&gt;\n                        &lt;/clinical-abstraction&gt;\n                    &lt;/clinical-abstractions&gt;\n                &lt;/applicant&gt;\n            &lt;/applicants&gt;\n        &lt;/practice-site&gt;\n    &lt;/practice-sites&gt;\n&lt;/account&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12843486,"title":"SQL update with join and select","body":"<p>I have have the following query. What I am tryihng to do is to update the Type field in HeaderTbl\nbased on the value from the DetailTbl for a given Id. </p>\n\n<pre><code>    update HeaderTbl\n    set HeaderTbl.Type = DetailTbl.Type\n    from HeaderTbl join DetailTbl\n    on HeaderTbl.Id = DetailTbl.Id\n</code></pre>\n\n<p>For a HeaderTbl id, there can be multiple DetailTbl Ids.\nSay for a given Id (lets say Id=5) we have 7 Ids that are Id=5 in the DetailTbl.\nWith the above quiery, it will hit the HeaderTbl then 7 times and update it - correct? The result that will stick will the last 7th one, correct?  </p>\n\n<p>I am doing a large update so just want to make sure I do not overlook anything.</p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12842175,"title":"How do I wrap a detail row onto multiple lines?","body":"<p>SQL Server Reporting Services 2008</p>\n\n<p>I have a row with 30 fields. Instead of one row with 30 fields, I want to arrange them so I have three rows of 10 fields each. I created this report using the wizard and the report type is a table (not matrix). How do I do this?</p>\n\n<p>Here is the desired output:</p>\n\n<pre><code>Header1   Header2   Header3\nData1     Data2     Data3\n\nHeader4   Header5   Header6\nData4     Data5     Data6 \n\nHeader7   Header8   Header9\nData7     Data8     Data9 \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12842142,"title":"Invalid Column Name Projectgroup_NAM","body":"<p>My query in SQL Sever:</p>\n\n<pre><code>INSERT INTO BIT_Dashboard.dse.L_Projectgroup (Projectgrouptype_CD) VALUES\n(\nCASE Projectgroup_NAM\n\n    WHEN ( \n         'BLA'\n        | 'BI Projekt'\n        | 'PDP'\n        | 'VBM'\n        ) THEN ('PRO')\nEND\n)\n</code></pre>\n\n<p>I am getting the following error: \n\"Invalid column name 'Projectgroup_NAM'.\"</p>\n\n<p>he thing is (maybe I forgot to emphasise that) is that I already have some rows in the table and I would like to update the Projectgrouptype_CD in the certain row with the query. What am I doing wrong?</p>\n\n<p>Wha is my query not working?</p>\n"},{"tags":["c#","sql","visual-studio-2010","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12775171,"title":"Merging data from 2 tables","body":"<p>DISCLAIMER : THIS IS A TEST/DUMMY/FAKE DATABASE</p>\n\n<p>Hi guys, i have a problem, below are the 2 table structures. When i use </p>\n\n<pre><code>SELECT CONVERT(char(80), InvDate,3) AS InvDate,InvoiceNo,EmployerCode,TaxAmount + SubTotal AS Amount,'' AS Payment FROM dbo.Invoice;\n</code></pre>\n\n<p><img src=\"http://i48.tinypic.com/icpzpy.png\" alt=\"enter image description here\"></p>\n\n<p>I wish to add in a column patients name where by it will be tagged to invoice number. So what i mean is that, when the query is executed, it should show me the patientdetails tagged together with invoice number. But in the both table structures there are no links. The only linkage i can think of \"MedicalRecordID\". I'm tried using UNION function didnt give me the desired output. Any help?</p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Drawing;\nusing System.Linq;\nusing System.Text;\nusing System.Windows.Forms;\nusing System.Data.SqlClient;\n\n\nnamespace MedicalDataExporter\n{\npublic partial class frmSales : Form\n{\n    public frmSales()\n    {\n        InitializeComponent();\n    }\n\n\n    private void dtpFrom_ValueChanged(object sender, EventArgs e)\n    {\n\n    }\n\n    private void btnExtract_Click(object sender, EventArgs e)\n    {\n\n        SqlConnection objConn = new SqlConnection(\"Data Source=test;Initial Catalog=test;Persist Security Info=True;User ID=test;Password=test\");\n\n       System.Data.SqlClient.SqlConnection(conStr);\n        objConn.Open();\n\n        SqlCommand objCmd = new SqlCommand(\"SELECT CONVERT(char(80), InvDate,3) AS InvDate,InvoiceNo,EmployerCode,TaxAmount + SubTotal AS Amount,'' AS Payment FROM Invoice WHERE (InvDate &gt;= CONVERT(datetime, '\"+dtpFrom.Text +\"', 105 )) AND (InvDate &lt;= CONVERT(datetime, '\"+dtpTo.Text+\"', 105))\", objConn);\n\n        SqlDataReader objReader;\n        objReader = objCmd.ExecuteReader();\n\n        System.IO.FileStream fs = new System.IO.FileStream(\"C:\\\\CMSExportedData\\\\Sales-\" + DateTime.Now.ToString(\"dd-MM-yyyy\") + \".txt\", System.IO.FileMode.Create);\n        System.IO.StreamWriter sw = new System.IO.StreamWriter(fs, System.Text.Encoding.Default);\n\n        int count = 0;\n        while (objReader.Read())\n        {\n\n            for (int i = 0; i &lt; 5; i++)\n            {\n                if (!objReader.IsDBNull(i))\n                {\n                    string s;\n                    s = objReader.GetDataTypeName(i);\n                    //MessageBox.Show(s);\n                    if (objReader.GetDataTypeName(i) == \"char\")\n                    {\n                        sw.Write(objReader.GetString(i));\n                    }\n                    else if (objReader.GetDataTypeName(i) == \"money\")\n\n                    {\n                        sw.Write(objReader.GetSqlMoney(i).ToString());\n                    }\n                    else if (objReader.GetDataTypeName(i) == \"nvarchar\")\n                    {\n                        sw.Write(objReader.GetString(i));\n                    }\n                }\n                if (i &lt; 4)\n                {\n                    sw.Write(\"\\t\");\n                }\n\n            }\n            count = count + 1;\n            sw.WriteLine();\n\n        }\n        sw.Flush();\n        fs.Close();\n        objReader.Close();\n        objConn.Close();\n        MessageBox.Show(count + \" records exported successfully.\");\n        this.Close();\n    }\n\n    private void groupBox1_Enter(object sender, EventArgs e)\n    {\n\n    }\n\n    private void dtpTo_ValueChanged(object sender, EventArgs e)\n    {\n\n    }\n\n    private void frmSales_Load(object sender, EventArgs e)\n    {\n\n    }\n}\n}\n</code></pre>\n\n<p>Here is the table structure:</p>\n\n<p><img src=\"http://i45.tinypic.com/2cwu2j6.png\" alt=\"enter image description here\"></p>\n\n<p>Here is the 2nd table structure:</p>\n\n<p><img src=\"http://i45.tinypic.com/29yplvl.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":9,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":7679,"score":1,"question_id":1143915,"title":"What is the difference between drop table and delete table in SQL Server?","body":"<p>In SQL Server, what is the difference between the following two-</p>\n\n<ul>\n<li><p>Right click on a database object (table/view) and opt for Drop table (i.e. Script table as -> DROP To -> New Query Editor Window)</p></li>\n<li><p>Right click on a database object (table/view) and opt for Delete.</p></li>\n</ul>\n\n<p>I tried them both and both perform the same action. Any reason for having two options for the same thing? Is the Delete option just a crude way of dropping the DB object?</p>\n\n<p>Just for the record - I'm using SS2008.</p>\n"},{"tags":["sql-server","sql-server-2008","exception","exception-handling","cursor"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12827575,"title":"How do I catch a specific exception type from within a stored procedure?","body":"<p>I am writing a stored procedure which iterates over all of the databases on the server and populates a table variable with an aggregate of the data from <strong>some</strong> of the different databases.  Some databases I'm not interested in as they are irrelevant.  The problem is when my CURSOR iterates through those databases I don't care about, a SELECT statement is issued on a table that doesn't exist.  How can I ignore the <code>Invalid object name</code> exception and continue with my processing?</p>\n\n<p><strong>Edit</strong>:</p>\n\n<p>Here is how I was attempting to skip over databases that were irrelevant:</p>\n\n<pre><code>DECLARE db_cursor CURSOR FOR\n\nSELECT name\nFROM MASTER.dbo.sysdatabases\nWHERE name NOT IN ('master','model','msdb','tempdb') \n\nOPEN db_cursor \n\nFETCH NEXT FROM db_cursor INTO @currentDatabaseName  \n\nWHILE @@FETCH_STATUS = 0\n    BEGIN\n        SET @sql = 'SELECT COUNT(Name) FROM ' + @currentDatabaseName + '.sys.Tables WHERE Name = ''SomeTableICareAbout'''\n\n        INSERT INTO @tableSearchResult\n        EXEC sp_executesql @sql\n\n        SET @tableCount = (SELECT COUNT(*) FROM @tableSearchResult WHERE TableCount = 1)\n\n        --If the table I care about was found, then do the good stuff\n        IF @tableCount &gt; 0\n            ...\n</code></pre>\n\n<p>The problem with this approach is if the executing user (in my case a service account) does not have access to SELECT on the table, then I never know about that error.  If the user doesn't have SELECT access, I want that exception to be raised.  But, even if the user doesn't have SELECT access, it can SELECT on the sys.Tables view.</p>\n"},{"tags":["sql-server-2008","tsql","query-hints"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12826949,"title":"Combine Table Hints INDEX and FORCESEEK with Two Joins Not On PK","body":"<p>See first query below.<br>\nCan NOT combine table hint Index and forceseek with two joins and the joins are not on the PK.<br>\nHow to make the first query compile?</p>\n\n<p>Interesting<br>\n-  if just one join or the other then can combine index and forceseek hints<br>\n-  if the index is the PK then can combine 2 joins and have both hints </p>\n\n<pre><code>-- compiler fails \n-- Query processor could not produce a query plan because of the hints defined in this query. Resubmit the query without specifying any hints and without using SET FORCEPLAN.  \nSelect Count(Distinct([docSVsys].[sID])) \nFrom [docSVsys] with (nolock) \nLeft Join [docSVtext] with (nolock, Index(IX_docSVtext_value_sID), forceseek ) \n       On [docSVtext].[sID] = [docSVsys].[sID]\nLeft Join [docMVtext] with (nolock, Index(ix_docMVtext_value_sID), forceseek) \n       On [docMVtext].[sID] = [docSVsys].[sID]\nwhere [docSVtext].[value] = 'doug'  or\n      [docMVtext].[value] = 'doug' \n\n--  can do one join\nSelect Count(Distinct([docSVsys].[sID])) \nFrom [docSVsys] with (nolock) \nLeft Join [docSVtext] with (nolock, Index(IX_docSVtext_value_sID), forceseek ) \n       On [docSVtext].[sID] = [docSVsys].[sID]\nwhere [docSVtext].[value] = 'doug'\n\n--  can do the other join\nSelect Count(Distinct([docSVsys].[sID])) \nFrom [docSVsys] with (nolock) \nLeft Join [docSVtext] with (nolock, Index(IX_docSVtext_value_sID), forceseek ) \n       On [docSVtext].[sID] = [docSVsys].[sID]\nwhere [docSVtext].[value] = 'doug'\n\n\n-- if on the PK then can do forceseek on two join   \nSelect Count(Distinct([docSVsys].[sID])) \nFrom [docSVsys] with (nolock, INDEX(PK_docSVsys)) \nLeft Join [docSVtext] with (nolock, Index(PK_docSVtext), forceseek ) \n    On [docSVtext].[sID] = [docSVsys].[sID]\nLeft Join [docMVtext]  with (nolock, Index(PK_docMVtext), forceseek) \n    On [docMVtext].[sID] = [docSVsys].[sID]\nwhere [docSVtext].[value] = 'doug'\n   or [docMVtext].[value] = 'doug'\n</code></pre>\n\n<p>This does what I want and runs 100 times faster.<br>\nThis has almost an identical query plan to the answer from ypercube.<br>\nBut I cannot combine this with some other conditions I need. </p>\n\n<pre><code>Select count(distinct([docSVsys].[sID]))\nFrom [docSVsys] with (nolock) \nLEFT HASH JOIN [docSVtext] with (nolock) \n  on [docSVtext].[sID] = [docSVsys].[sID] \n and [docSVtext].[value] = 'doug'\nLEFT HASH JOIN [docMVtext] with (nolock)\n  on [docMVtext].[sID] = [docSVsys].[sID] \n and [docMVtext].[value] = 'doug'\nwhere [docSVtext].[sID] is not null \n   or [docMVtext].[sID] is not null \n</code></pre>\n\n<p>This also uses the proper indexes and is the fastest.<br>\nFor now I don't have the option to rewrite the format.<br>\nThe program builds up queries to other tables.<br>\nWe incorrectly wanted the same format for where as an order by and that got us where we are.  </p>\n\n<pre><code>SELECT  count(distinct(c.sID))  \nfrom                \n(   SELECT sv.[sID] \n    FROM [docSVtext] AS sv\n    WHERE sv.[value] = 'doug'\n    UNION ALL \n    SELECT mv.[sID] \n    FROM [docMVtext] AS mv\n    WHERE mv.[value] = 'doug'\n) as c\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","table-valued-parameters"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":89,"score":-1,"question_id":12427121,"title":"Need help optimizing TSQL table valued function","body":"<p>Here is the function:</p>\n\n<pre><code>CREATE FUNCTION dbo.agedItemResult(@ILC VARCHAR(30))\n    RETURNS @AgedTable TABLE (\nItemID INT,\nItemLookupCode VARCHAR(30),\n[Month] INT,\n[Year] INT,\nAged INT,\nDebug01 VARCHAR(MAX),\nDebug02 VARCHAR(MAX),\nDebug03 VARCHAR(MAX),\nDebug04 VARCHAR(MAX),\nDebug05 VARCHAR(MAX)\n) \nAS\nBEGIN\n\nDECLARE @TotalSold INT\nDECLARE @AdjustmentQty INT\nDECLARE @FirstRcvdStart DATETIME\nDECLARE @FirstRcvdEnd DATETIME\n--DECLARE @ILC VARCHAR(MAX)\n--DECLARE @ItemID INT\nDECLARE @MovingQty INT\nDECLARE @MovingMonthStart DATETIME\nDECLARE @MovingMonthEnd DATETIME\nDECLARE @CurrentMonthStart DATETIME\nDECLARE @CurrentMonthEnd DATETIME\nDECLARE @CurrentRcvd INT\nDECLARE @NumMonths INT\nDECLARE @AgeReached INT\n/*DECLARE @AgedTable TABLE (    ItemID INT,\n                            ItemLookupCode VARCHAR(MAX),\n                            [Month] INT,\n                            [Year] INT,\n                            Aged INT,\n                            Debug01 VARCHAR(MAX),\n                            Debug02 VARCHAR(MAX),\n                            Debug03 VARCHAR(MAX),\n                            Debug04 VARCHAR(MAX),\n                            Debug05 VARCHAR(MAX)\n                            )*/\n\n--SET @ILC = '21208641'\nSET @TotalSold          = (SELECT SUM(Sold) FROM JSInventorySnapShot WHERE ItemLookupCode = @ILC)\nSET @AdjustmentQty      = (SELECT SUM(HQAdjustment) FROM JSInventorySnapShot WHERE ItemLookupCode = @ILC)\nSET @FirstRcvdStart     = (SELECT TOP 1 FirstTransferred FROM JSInventorySnapShot ORDER BY FirstTransferred ASC)\nSET @FirstRcvdEnd       = (SELECT DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0, @FirstRcvdStart)+1,0)))\nSET @CurrentMonthStart  = (SELECT DATEADD(s,0,DATEADD(mm, DATEDIFF(m,0, GETDATE()),0))) \nSET @CurrentMonthEnd    = (SELECT DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0, GETDATE())+1,0))) \nSET @NumMonths          = (SELECT CASE \n                            WHEN DATEPART(DAY, @FirstRcvdStart) &gt; DATEPART(DAY, @CurrentMonthEnd) \n                                THEN DATEDIFF(MONTH, @FirstRcvdStart, @CurrentMonthEnd) - 1 \n                                ELSE DATEDIFF(MONTH, @FirstRcvdStart, @CurrentMonthEnd) \n                            END) + 1\nSET @MovingQty          = @TotalSold\nSET @CurrentRcvd        = ISNULL((SELECT SUM(Rcvd) FROM JSInventorySnapShot WHERE ItemLookupCode = @ILC AND [Month] = Month(@FirstRcvdStart)), 0) + @AdjustmentQty\nSET @MovingMonthStart   = @FirstRcvdStart\nSET @MovingMonthEnd     = @FirstRcvdEnd\nSET @MovingQty          = @MovingQty - @CurrentRcvd\nSET @AgeReached         = 0\n\nWHILE(@NumMonths &gt; 0)\nBEGIN\n    IF (@CurrentRcvd = 0)\n    BEGIN\n        INSERT INTO @AgedTable (ItemID, ItemLookupCode, [Month], [Year], Aged, Debug01) \n            SELECT (SELECT TOP 1 ItemID FROM JSInventorySnapShot WHERE ItemLookupCode = @ILC),\n                        @ILC, \n                        MONTH(@MovingMonthStart),\n                        YEAR(@MovingMonthStart),\n                        0,\n                        @AdjustmentQty\n    END\n    ELSE\n    BEGIN\n        IF(@MovingQty &gt; 0)\n        BEGIN\n            INSERT INTO @AgedTable (ItemID, ItemLookupCode, [Month], [Year], Aged, Debug01) \n                SELECT (SELECT TOP 1 ItemID FROM JSInventorySnapShot WHERE ItemLookupCode = @ILC),\n                            @ILC, \n                            MONTH(@MovingMonthStart),\n                            YEAR(@MovingMonthStart),\n                            0,\n                            @AdjustmentQty\n        END\n        ELSE\n        BEGIN\n            IF (@AgeReached = 1)\n            BEGIN\n                INSERT INTO @AgedTable (ItemID, ItemLookupCode, [Month], [Year], Aged) \n                    SELECT (SELECT TOP 1 ItemID FROM JSInventorySnapShot WHERE ItemLookupCode = @ILC),\n                                @ILC, \n                                MONTH(@MovingMonthStart),\n                                YEAR(@MovingMonthStart),\n                                @CurrentRcvd\n            END\n            ELSE\n            BEGIN\n                INSERT INTO @AgedTable (ItemID, ItemLookupCode, [Month], [Year], Aged) \n                    SELECT (SELECT TOP 1 ItemID FROM JSInventorySnapShot WHERE ItemLookupCode = @ILC),\n                                @ILC, \n                                MONTH(@MovingMonthStart),\n                                YEAR(@MovingMonthStart),\n                                (-1 * @MovingQty)\n                    SET @AgeReached = 1\n            END\n        END\n    END\n    SET @NumMonths          = @NumMonths - 1\n    SET @MovingMonthStart   = (SELECT DATEADD(s,0,DATEADD(mm, DATEDIFF(m,0, @MovingMonthStart)+1,0))) \n    SET @MovingMonthEnd     = (SELECT DATEADD(s,-1,DATEADD(mm, DATEDIFF(m,0, @MovingMonthEnd)+2,0)))\n    SET @CurrentRcvd        = ISNULL((SELECT SUM(Rcvd) FROM JSInventorySnapShot WHERE ItemLookupCode = @ILC AND [Month] = Month(@MovingMonthStart)), 0)\n    SET @MovingQty          = @MovingQty - @CurrentRcvd\n    END\n    RETURN\nEND\n</code></pre>\n\n<p>Here's what it does in a nutshell:</p>\n\n<p>First we find the first item ever received or moved and use the date as the starting date. Then we find the total sales for the that item, and begin subtracting the receiving amount from sales. The remainder is considered aged (not sold) and is evaluated against the next month. We then move to the next month and repeat the process until we hit a negative number or 0. If we hit a negative number then that means we have hit a month that we ordered more than sold to date, and that amount is considered aged (not sold). If there are more months to evaluate then any FURTHER received amount is considered aged by default as it clearly as not been sold.</p>\n\n<p>Here is sample data from the table used for evaluation: </p>\n\n<pre><code>ID      ItemID  ItemLookupCode  HQAdjustment    FirstTransferred        Rcvd    RcvdDateEarly           RcvdDateLate            Sold    SoldDateEarly           SoldDateLate            Sales   Month   Year    StartOfMonthQty EndOfMonthQty\n17350   188993  21208641        0               2012-04-05 13:29:14.000 48      2012-04-27 11:00:40.100 2012-04-27 11:00:40.100 40      2012-04-05 13:29:14.000 2012-04-30 12:50:13.000 75.20   4       2012    0               8\n34427   188993  21208641        0               2012-04-05 13:29:14.000 120     2012-05-22 10:14:40.213 2012-05-22 10:14:40.213 24      2012-05-04 17:42:12.000 2012-05-29 10:22:10.000 44.72   5       2012    8               104\n48437   188993  21208641        0               2012-04-05 13:29:14.000 0       NULL                    NULL                    12      2012-06-02 16:24:45.000 2012-06-21 11:15:05.000 22.36   6       2012    104             92\n62369   188993  21208641        0               2012-04-05 13:29:14.000 60      2012-07-16 12:57:33.330 2012-07-16 12:57:33.330 9       2012-07-11 14:42:01.000 2012-07-25 14:58:41.000 16.22   7       2012    92              143\n75781   188993  21208641        0               2012-04-05 13:29:14.000 0       NULL                    NULL                    2       2012-08-01 12:56:10.000 2012-08-14 19:01:00.000 4.01    8       2012    143             141\n</code></pre>\n\n<p>Here is the result of my function for the above data:</p>\n\n<pre><code>ItemLookupCode  Month   Rcvd    Sold    Aged\n21208641        4       48      40      0\n21208641        5       120     24      81\n21208641        6       0       12      0\n21208641        7       60      9       60\n21208641        8       0       2       0\n</code></pre>\n\n<p>This tells me that we sold everything received in April. Ordered again in May, sold some but still have left over inventory (aged). Then without selling the inventory out in July we ordered more again, and therefore that inventory is automatically considered to be aged.</p>\n\n<p>The purpose of this function is stop what happened above. Which is ordering items that have aged (unsold) inventory. It's also used for evaluating how much of a department is aged and if we should consider starting a sale to get rid of aged items.</p>\n\n<p>The problem is that we have no less then 40,000 items to evaluate. This function works great for single items, however it takes 30 seconds for 100 items. I'm hoping someone can come a long and look at my function and realize I'm going about it the completely wrong way. If I could accomplish inline calculations and carry over the remainder that would be great.</p>\n\n<p>I basically need this in simplified pseudo-code:</p>\n\n<pre><code>Foreach (Month2Date)\nIf AllInventoryAged = 1 Then //This says we've reached our sales:rcved thresh-hold and all received inventory is aged from here on out.\n   ThisMonthAged = RcvedForMonth\nElse\n   TotalSales - RcvedForMonth = Aged\n    If Aged &lt; 0 Then\n        ThisMonthAged = Aged * -1 //We received more than sold so it's negative and we have hit our sales:rcved thresh-hold.\n        AllInventoryAged = 1 //Anything received from this point on is aged.\n    Else    \n        ThisMonthAged = 0  //We received less this month then sold. A good thing.\n        TotalSales = Aged //We carry on the remainder for further evaluation\n</code></pre>\n\n<p>I hope I have been thorough in explaining myself this time. Sorry it's so long. I just really wanted to cover all questions I had in my last post.</p>\n"},{"tags":["c#","security","sql-server-2008","encryption","communication"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":374,"score":2,"question_id":2915036,"title":"How to secure the communication between a SQL Server database and a c# administrative tool?","body":"<p>How can I secure the communication between a C# program running locally on my computer and a SQL Server in a hosted environment?</p>\n\n<p>I have an asp.net application that is secured by SSL encryption. So using the asp.net from an open wlan connection is no problem.</p>\n\n<p>How can I achieve the same kind of encryption for my administrative tool? Would it be best to write a service? But how would that connection to the service be secured?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":12840352,"title":"using a count from one table in another table","body":"<p>So i have genereated a number from a count in #table1 which I want to show in another table that I have created.\nSo the syntax for the first count is </p>\n\n<pre><code>select COUNT(*)\ninto #table1\nfrom #test8\nwhere account_number1 is null\nGROUP BY varmonth,MONYEAR\nORDER BY varmonth, MONYEAR\n</code></pre>\n\n<p>Then the second table is </p>\n\n<pre><code>SELECT MONYEAR, \nCOUNT(*) AS TOTAL,\nSUM(CURRENT_BALANCE_AMOUNT) REH_BAL,\nFROM #table1\nWHERE ROWNUMBER = 1 \nGROUP BY varmonth,MONYEAR\nORDER BY varmonth, MONYEAR\n</code></pre>\n\n<p>However I want that first count to slide in between the count and sum in the second table.\nis there a way of doing this so all the numbers output in one final table?\nThanks</p>\n"},{"tags":["sql-server-2008","svn"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12838123,"title":"Add SVN to SQL Server 2008","body":"<p>I am wondering if there is any tool, or puling to control a database in SQL Server 2008.</p>\n\n<p>I've already tried Agent SVN and SQL Source Control 3.0 of RedGate but both of them are [1]>free or&lt; too expensive for my pocket.</p>\n\n<p>I also tried <a href=\"http://www.codeproject.com/Articles/15962/SQL-Server-database-versioning-with-Subversion-SVN\" rel=\"nofollow\">http://www.codeproject.com/Articles/15962/SQL-Server-database-versioning-with-Subversion-SVN</a> but it's out of date....</p>\n\n<p>Any suggestion? What should I try? </p>\n\n<p>What I want is a source control in the changes done inside the DB, not in the files that generate it.</p>\n\n<p>Edit: [1] both of them are too expensive, not free</p>\n"},{"tags":["sql-server-2008","stored-procedures","temporary-tables","coldfusion-8"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1874,"score":1,"question_id":5044712,"title":"Use temp table or table variable for stored procedure that returns 100+ rows","body":"<p>Okay basically I am creating a stored procedure that will return data for our coldfusion power search.</p>\n\n<p>I created a view, to hold data from multiple tables, with the same column names returned of course.</p>\n\n<p>Then in my stored procedure i have created a simple temporary table like this....</p>\n\n<pre><code>    CREATE TABLE #TempSearchResults\n(\n    search_id int identity,\n    id integer,\n    type varchar(20),\n    title varchar(50),\n    url varchar(250),\n    rank integer\n)\n</code></pre>\n\n<p>Then I added an index to it, in my perhaps limited experience as a way to improve performance.</p>\n\n<pre><code>CREATE UNIQUE INDEX idx on #TempSearchResults (search_id)\n</code></pre>\n\n<p>Then i did my select into massive query</p>\n\n<pre><code>insert into #TempSearchResults\nselect id, type, title, url, rank + 1200 as rank\nfrom my view\nwhere company_id = @company_id\nand title like @keyword\nunion all\nselect id, type, title, url, rank + 1100 as rank\nfrom my view\nwhere company_id = @company_id\nand title like @keyword\nand description like @keyword\n</code></pre>\n\n<p>and it goes on like that having different rank math values for where it found the keyword in the tables.</p>\n\n<p>And at the end it does...</p>\n\n<pre><code>select id, type, title, url, rank\nfrom #TempSearchResults\ngroup by id, type, title, url, rank\norder by rank desc, title asc;\n</code></pre>\n\n<p>Now when I test that stored procedure in coldfusion, it seems to take very long.</p>\n\n<p>So I am thinking, either I am using temp tables wrong or incompletely for optimal performance.</p>\n\n<p>Or perhaps I should switch to table variables...</p>\n\n<p>But I was just reading...<a href=\"http://sqlnerd.blogspot.com/2005/09/temp-tables-vs-table-variables.html\" rel=\"nofollow\">Temp Tables VS Table Variables</a></p>\n\n<p>Funny thing is, this stored procedure seems to be slower than me running the query directly via coldfusion, which I prefer not to. </p>\n\n<p>I am hoping for optimal performance....</p>\n\n<p>Thank you...</p>\n\n<p>Below is the basic logic or code for the view I am using.</p>\n\n<pre><code>select some field as id, some field as title, some field as description, 'url link' as url, 1 as rank\nfrom table a\nunion\nselect some field as id, some field as title, some field as description, 'url link' as url, 1 as rank\nfrom table b\nunion\nselect some field as id, some field as title, some field as description, 'url link' as url, 1 as rank\nfrom table c\n</code></pre>\n\n<p>Etc like that. I can't reveal the exact details, as that would be a security breach. I hope that makes it clearer.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","full-text-search"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12837982,"title":"Get matching names from SQL Server","body":"<p>My problem is, I have a database of people names and their achievements. Now, I have some paragraphs which contains the person names. I need to extract the names from those paragraphs. The web-end of the application will append a hyperlink of the extracted names with their activities.</p>\n\n<p>Data in my database might look like:</p>\n\n<pre><code>Name          |  Achievement\n----------------------------------------                              \nSteve Jobs    |  Founder of Apple\nBill Gates    |  Founder of Microsoft\n</code></pre>\n\n<p>Now I have string like: <code>After saving up some money, Steve Jobs took off for India in the search of enlightenment.</code></p>\n\n<p>I need to find <code>Steve Jobs</code> from the above string and add to hyper link to that. \nAny idea how to do this?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3021,"score":0,"question_id":6587360,"title":"change to database to 'online' and set db to 'multi-user'","body":"<p>I have a 2008 sql database that is offline that I would like to take online and set to multi-user.  Using sql server management studio - new query window - when i execute the following:</p>\n\n<pre><code>   ALTER DATABASE mydb SET ONLINE;\n\n    ALTER DATABASE mydb SET MULTI_USER;\n</code></pre>\n\n<p>I receive this error message:</p>\n\n<blockquote>\n  <p>Msg 5064, Level 16, State 1, Line 1\n  Changes to the state or options of\n  database 'mydb' cannot be made at this\n  time. The database is in single-user\n  mode, and a user is currently\n  connected to it.<br>\n  Msg 5069, Level 16,\n  State 1, Line 1 ALTER DATABASE\n  statement failed. Msg 5064, Level 16,\n  State 1, Line 3 Changes to the state\n  or options of database 'mydb' cannot\n  be made at this time. The database is\n  in single-user mode, and a user is\n  currently connected to it. Msg 5069,\n  Level 16, State 1, Line 3 ALTER\n  DATABASE statement failed.</p>\n</blockquote>\n\n<p>How would I get the database online and in multi-user mode?</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":62,"score":-3,"question_id":12837511,"title":"Why is one of the queries returning no rows?","body":"<p>I have 2 queries like this:</p>\n\n<p>Query #1:</p>\n\n<pre><code>SELECT * \nFROM dbo.Products \nWHERE CAST(ID AS VARCHAR) IN ('6', '8', '9', '10', '12', '14', '110', '106')\n</code></pre>\n\n<p>Query #2:</p>\n\n<pre><code>SELECT * \nFROM dbo.Products \nWHERE CAST(ID AS VARCHAR) IN (SELECT ('6'', ''8'', ''9'', ''10'', ''12'', ''14'', ''110'', ''106'))\n</code></pre>\n\n<p>Why does the second query return no rows? When 1st query is returning some rows.</p>\n"},{"tags":["c#","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12835884,"title":"I want to find number of days from given days","body":"<p>Hi everyone I have two dates and want to find number of days including both dates, I tried something like this...</p>\n\n<pre><code>select datediff(\"d\", '10/11/2012', '10/12/2012')\n</code></pre>\n\n<p>It is showing 1, but I want the result as 2 because we have 2 days 11 and 12\n...</p>\n\n<p>Any help will be appreciated.\nThanks in advance</p>\n"},{"tags":["sql-server-2008","coldfusion","odbc"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2763,"score":0,"question_id":6291877,"title":"Cannot connect to SQL Server 2008 Error 18456 Login failed for user","body":"<p>I'm trying to connect to our SQL Server box from our web server. The only thing i've been able to find regarding the issue is to enable tcp/ip and mixed authentication.</p>\n\n<ol>\n<li>TCP/IP is already enabled </li>\n<li>Mixed authentication mode is selected </li>\n<li>we already have 1 user successfully connecting to a different database so I know TCP/IP and mixed authentication are working.</li>\n<li>Logging in as the problem user from sql manager works fine.</li>\n<li>I get the same error creating an ODBC connection as well as a ColdFusion SQL Server data source.</li>\n</ol>\n\n<p>According to the log files, which isn't logging all the attempts also indicates State 40, which is \"Default database could not be accessed (SQL 2008).\"\nI've check and the default database is the one I want to open. The Schema is DBO.</p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008","transparentdataencryption"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":96,"score":-2,"question_id":3067177,"title":"I get an error when implementing tde in SQL Server 2008","body":"<pre><code>USE MyDatabase\nGO\nCREATE DATABASE ENCRYPTION KEY\nWITH ENCRYPTION\nALGORITHM = AES_256 BY SERVER CERTIFICATE TDECert\n\nGO\n</code></pre>\n\n<p>when i execute this statement in SQL Server 2008 I get the error:</p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 1<br>\n  Incorrect syntax near the keyword\n  'KEY'.<br> Msg 319, Level 15, State 1,\n  Line 2<br> Incorrect syntax near the\n  keyword 'with'. If this statement is a\n  common table expression or an\n  xmlnamespaces clause, the previous\n  statement must be terminated with a\n  semicolon.</p>\n</blockquote>\n\n<p>What to do?\nI just want to encrypt my db.</p>\n"},{"tags":["sql-server-2008","join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12835513,"title":"Linking two tables with nothing in common","body":"<p>I am trying to join these statements:</p>\n\n<pre><code>select min(len(Password)) as min, \n       max(len(Password)) as max, \n       avg(len(Password)) as avg \nFROM Customer.dbo.Password \n\nUNION ALL\nselect min(len(password2)) as min, \n       max(len(password2)) as max, \n       avg(len(password2)) as avg \nFROM website.dbo.password2\n</code></pre>\n\n<p>To these:</p>\n\n<pre><code>SELECT c.name COLLATE SQL_Latin1_General_CP1_CI_AS colName, o.name COLLATE SQL_Latin1_General_CP1_CI_AS tableName, 'website' db FROM website.sys.all_columns as c INNER JOIN website.sys.all_objects o ON c.object_id = o.object_id WHERE c.name like '%password%' AND type = 'U'\n\nUNION\nSELECT c.name COLLATE SQL_Latin1_General_CP1_CI_AS colName, o.name COLLATE SQL_Latin1_General_CP1_CI_AS tableName, 'Customer' db FROM Customer.sys.all_columns as c INNER JOIN Customer.sys.all_objects o ON c.object_id = o.object_id WHERE c.name like '%password%' AND type = 'U' \n</code></pre>\n\n<p>They have no columns in common. The first two SELECT statements produce three columns of the min, max and avg of password length and second two produce colName, tableName and db name of where the password is held.</p>\n\n<p>I'd like to display both result sets in one table purely for visual reasons, to get the corresponding the min, max, avg to the appropriate colName, tableName and db.</p>\n\n<p>I tried doing it this way:</p>\n\n<pre><code>DECLARE @numberTable TABLE (link nvarchar(500), max int, min int, avg int)\nINSERT INTO @numberTable\n\nselect 'link', min(len(Password)) as min, \n       max(len(Password)) as max, \n       avg(len(Password)) as avg \nFROM Customer.dbo.Password UNION ALL\nselect 'link', min(len(password2)) as min, \n       max(len(password2)) as max, \n       avg(len(password2)) as avg \nFROM website.dbo.password2\n\nSELECT * FROM @numberTable ORDER BY max\n\nDECLARE @myTable TABLE (link nvarchar(500), colName nvarchar(500), tableName   nvarchar(500), db nvarchar(500))\nINSERT INTO @myTable\n\nSELECT 'link', c.name COLLATE SQL_Latin1_General_CP1_CI_AS colName, o.name COLLATE SQL_Latin1_General_CP1_CI_AS tableName, 'website' db FROM website.sys.all_columns as c INNER JOIN website.sys.all_objects o ON c.object_id = o.object_id WHERE c.name like '%password%' AND type = 'U' UNION\n\nSELECT 'link', c.name COLLATE SQL_Latin1_General_CP1_CI_AS colName, o.name COLLATE SQL_Latin1_General_CP1_CI_AS tableName, 'Customer' db FROM Customer.sys.all_columns as c INNER JOIN Customer.sys.all_objects o ON c.object_id = o.object_id WHERE c.name like '%password%' AND type = 'U' \n\nSELECT * FROM @myTable ORDER BY db\n\nSELECT link\nFROM @myTable\nLEFT OUTER JOIN @numberTable\nON @myTable.link = @numberTable.link\n</code></pre>\n\n<p>Unfortunately this didn't work.</p>\n\n<p>I'm using Microsoft SQL Server 2008.</p>\n\n<p>Hope what I'm after makes sense.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12835347,"title":"how to earn the average of two diffrenet store procedure with two different tables?","body":"<p>I have a store procedure with the result like this:</p>\n\n<pre><code>Aaa Bbb Ccc Ddd Eee Average\n2   7   5   4   5   5\n</code></pre>\n\n<p>And I have another store procedure with the result like this:</p>\n\n<pre><code>Fff Ggg Hhh Iii Jjj Kkk Average\n28  6   7   5   6   6   6\n</code></pre>\n\n<p>Now I wanna have the average of two average column above!\nWhat can I do?\njust notice that these two store procedures are the result of different tables!</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":107,"score":3,"question_id":12833919,"title":"Select all dates between first day of month and current date","body":"<p>Just want to select all dates between  cureent date and first day of month . I want to use fill all dates in a temp table </p>\n\n<pre><code>declare @temp table \n (\n   ddate datetime \n  ) \n</code></pre>\n\n<p>I have tried with  <code>with cte</code>  and i don't want to use while loop becuase i want to avoid while in stored procedure . </p>\n\n<p>For example as today is <code>11-oct-2012</code> </p>\n\n<p>so temp table should have 11 rows starting from <code>1-oct-2012</code> to <code>11-oct-2012</code> </p>\n"},{"tags":["sql-server","sql-server-2008","while-loop","temporary-tables","rowcount"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":308,"score":0,"question_id":12833787,"title":"Using row count from a temporary table in a while loop SQL Server 2008","body":"<p>I'm trying to create a procedure in SQL Server 2008 that inserts data from a temp table into an already existing table. I think I've pretty much figured it out, I'm just having an issue with a loop. I need the row count from the temp table to determine when the loop should finish. </p>\n\n<p>I've tried using @@ROWCOUNT in two different ways; using it by itself in the WHILE statement, and creating a variable to try and hold the value when the first loop has finished (see code below). </p>\n\n<p>Neither of these methods have worked, and I'm now at a loss as to what to do. Is it possible to use @@ROWCOUNT in this situation, or is there another method that would work better?</p>\n\n<pre><code>CREATE PROCEDURE InsertData(@KeywordList varchar(max))\nAS\nBEGIN\n\n--create temp table to hold words and weights\nCREATE TABLE #tempKeywords(ID int NOT NULL, keyword varchar(10) NOT NULL); \n\nDECLARE @K varchar(10), @Num int, @ID int\n\nSET @KeywordList= LTRIM(RTRIM(@KeywordList))+ ','\nSET @Num = CHARINDEX(',', @KeywordList, 1)\nSET @ID = 0\n\n--Parse varchar and split IDs by comma into temp table\nIF REPLACE(@KeywordList, ',', '') &lt;&gt; ''\nBEGIN\n    WHILE @Num &gt; 0\n    BEGIN\n        SET @K= LTRIM(RTRIM(LEFT(@KeywordList, @Num - 1)))\n        SET @ID = @ID + 1\n        IF @K &lt;&gt; ''\n        BEGIN\n            INSERT INTO #tempKeywords VALUES (@ID, @K) \n        END\n        SET @KeywordList = RIGHT(@KeywordList, LEN(@KeywordList) - @Num)\n        SET @Num = CHARINDEX(',', @KeywordList, 1)\n        --rowcount of temp table\n        SET @rowcount = @@ROWCOUNT\n    END\nEND\n\n--declaring variables for loop\nDECLARE @count INT\nDECLARE @t_name varchar(30)\nDECLARE @key varchar(30)\nDECLARE @key_weight DECIMAL(18,2)\n--setting count to start from first keyword\nSET @count = 2\n--setting the topic name as the first row in temp table\nSET @t_name = (Select keyword from #tempKeywords where ID = 1)\n--loop to insert data from temp table into Keyword table\nWHILE(@count &lt; @rowcount)\n    BEGIN\n        SET @key = (SELECT keyword FROM #tempKeywords where ID = @count)\n        SET @key_weight = (SELECT keyword FROM #tempKeywords where ID = @count+2)\n        INSERT INTO Keyword(Topic_Name,Keyword,K_Weight)\n        VALUES(@t_name,@key,@key_weight)\n        SET @count= @count +2\n    END \n--End stored procedure  \nEND\n</code></pre>\n"},{"tags":["sql-server-2008","query-optimization"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":105,"score":2,"question_id":10602400,"title":"Query optimizing suggession needed","body":"<p>I have written a script which takes about 15 hours to execute. I need some query optimization technique or suggestion to make this script as faster as possible...\nIf anyone could help, take a look on the script:</p>\n\n<pre><code>declare @max_date date\ndeclare @client_bp_id int\n\nSelect @max_date=MAX(tran_date) from All_Share_Txn\n\nDELETE FROM Client_Share_Balance\n\nDECLARE All_Client_Bp_Id CURSOR FOR\nSELECT Bp_id FROM  Client       --Take All Client's BPID \n    OPEN All_Client_Bp_Id\n    FETCH NEXT FROM All_Client_Bp_Id\n        INTO @client_bp_id\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n\n    Insert Client_Share_Balance(Bp_id,Instrument_Id,Quantity_Total,Quantity_Matured,Quantity_Pledge,AVG_Cost,Updated_At,Created_At,Company_Id,Created_By,Updated_By)\n    select @client_bp_id,Instrument_Id,\n       sum(case when Is_buy='True' then Quantity when Is_buy='False'  then -quantity end), --as Total Quantity\n       sum(case when Mature_Date_Share &lt;= @max_date then (case Is_buy when '1' then quantity when '0' then -quantity end) else 0 end),  --as Free Qty\n       ISnull((select sum(case pu.IsBuy when '1' then -pu.quantity else pu.quantity end) from\n            (Select * from Pledge UNION Select * from Unpledge) pu\n                where pu.Client_Bp_id=@client_bp_id and pu.Instrument_Id=t1.Instrument_Id and pu.Txn_Date&lt;=@max_date\n                group by pu.Client_Bp_id,pu.Instrument_Id),0),  -- as Pledge_Quantity\n       dbo.Avg_Cost(@client_bp_id,Instrument_Id), --as Avg_rate\n       GETDATE(),GETDATE(),309,1,1\n\n    from All_Share_Txn t1\n    where Client_Bp_id=@client_bp_id and Instrument_Id is not null \n    group by Instrument_Id\n    having sum(case Is_buy when '1' then quantity when '0' then -quantity end)&lt;&gt; 0\n    or sum(case when Mature_Date_Share &lt;= @max_date then (case Is_buy when '1' then quantity when '0' then -quantity end) else 0 end) &lt;&gt; 0\n\n    FETCH NEXT FROM All_Client_Bp_Id\n        INTO @client_bp_id\n\nEND\n\nCLOSE All_Client_Bp_Id\nDEALLOCATE All_Client_Bp_Id\n</code></pre>\n\n<p>Just need to verify if the code could be written more efficiently.. </p>\n"},{"tags":["xml","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":12834236,"title":"SQL Server 2008 XML changes on insert","body":"<p>I am having issues while inserting XML into XML column in table using SQL Server 2008. </p>\n\n<p>I insert </p>\n\n<pre><code>&lt;test&gt;&lt;/test&gt;\n</code></pre>\n\n<p>and SQL Server column stores it as:</p>\n\n<pre><code>&lt;test /&gt;\n</code></pre>\n\n<p>Now, I know that the latest form is actually the correct one and that the first form is not really a correct XML syntax, but I have to keep XML as it was passed in with import from customer. In it's original form.</p>\n\n<p>We have been using DB2 for years and DB2 does not alter your inserted XML.</p>\n\n<p>So my question is... Is it possible to disable XML optimization on XML columns in SQL Server  2008?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12832738,"title":"Modify a stored procedure to display the latest role for an employee","body":"<p>I have a stored procedure which returns the 3 months' data for an employee. I have to modify the procedure in such a way that while displaying the role of the employee is his role in the latest month.</p>\n\n<p>If for the latest month, the data does not exist, then the previous month's role is displayed.\nThe table has an identity column (PK), <code>EMP_ID</code>, <code>Role</code> and various other columns. But for answering this question, this much data is sufficient, I hope.</p>\n"}]}
{"total":21074,"page":13,"pagesize":100,"questions":[{"tags":["sql-server-2008","iis7","asp-classic","connection","sql-server-native-client"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":11751,"score":5,"question_id":5216151,"title":"Cannot connect from Classic ASP to SQL Server 2008 R2 using SQL Native Client (Windows 7 - IIS7)","body":"<p>I'm able to connect to SQL server 2008 R2 when I use <code>Provider=SQLOLEDB</code> in my connection string. But when I use <code>Provider=SQLNCLI</code> in connection string I'm unable to connect.</p>\n\n<blockquote>\n  <p>ADODB.Connection error '800a0e7a'</p>\n  \n  <p>Provider cannot be found. It may not\n  be properly installed.</p>\n  \n  <p>/test.asp, line 7</p>\n</blockquote>\n\n<p>Code written within <code>test.asp</code> is below</p>\n\n<pre><code>&lt;%\n    Set cn = Server.CreateObject(\"ADODB.Connection\")\n\n    'Doesn't work\n    cn.Open \"Provider=SQLNCLI;Server=remoteServer\\SQL2008R2;Database=DB;UID=MyUser;PWD=pa55word;\"  \n\n    'Works Perfectly\n    'cn.Open \"Provider=SQLOLEDB;Server=remoteServer\\SQL2008R2;Database=DB;UID=MyUser;PWD=pa55word;\" \n\n    cn.CommandTimeout = 900\n    cn.Close\n    Response.write(\"dfjslkfsl\")\n%&gt;\n</code></pre>\n\n<p>The SQL Server I'm trying to connect (from classic ASP Page within my IIS 7 on windows 7) is located on different server in a different network to which I'm connecting using VPN. </p>\n\n<p>I tested sql native client by creating a sql native client System DSN connection to the said Sql server 2008 R2 (which is connected through VPN) from ODBC datasource administrator. And it got connected successfully.</p>\n\n<p>These snaps are from my windows 7 system\n<img src=\"http://i.stack.imgur.com/HI3Ks.png\" alt=\"Appwiz.cpl snap\"></p>\n\n<p><img src=\"http://i.stack.imgur.com/RgOfM.png\" alt=\"IIS 7 features\"></p>\n\n<p><img src=\"http://i.stack.imgur.com/r5crO.png\" alt=\"enter image description here\"></p>\n\n<ul>\n<li>Windows 7</li>\n<li>IIS 7</li>\n<li>Classic ASP page (.asp)</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":4,"up_vote_count":3,"down_vote_count":0,"view_count":7161,"score":3,"question_id":3856002,"title":"Problems with sending notification emails from SQL Server 2008","body":"<p>I have a problem setting up email notifications in SQL Server 2008.</p>\n\n<p>I am using SQL Server 2008 to build a data cube. This process consists of several jobs, that are all scheduled to run each night at a specific time. To see whether a job was running without any failure, it is possible to set up email notification.</p>\n\n<p><img src=\"http://new.smilinginthesun.de/stackoverflow/01emailOperator.png\">\n<img src=\"http://new.smilinginthesun.de/stackoverflow/02emailNotification.png\"></p>\n\n<p>Unfortunately, no email is sent even though I think I have set up database mail correctly. </p>\n\n<p>All guides I can found just explains, how to set up database mail (eg. <a href=\"http://blog.sqlauthority.com/2008/08/23/sql-server-2008-configure-database-mail-send-email-from-sql-database/\" rel=\"nofollow\">http://blog.sqlauthority.com/2008/08/23/sql-server-2008-configure-database-mail-send-email-from-sql-database/</a>), but thats it.<br>\nIf I sent a mail to test functionality (via test email button or from T-SQL script) it works just fine and the email arrives. But when using the notification feature in a job, it doesn't even create a <code>sysmail_mailitems</code> or <code>sysmail_log</code> entry.<br>\nI have also send an email using <code>sp_notify_operator</code>, successfully. So the operator set up seems to work, too. (Thanks, Joe Stefanelli, for the hint.)</p>\n\n<p>There is a great workaround written for SQL Server 2005, that works for me, too: <a href=\"http://www.howtogeek.com/howto/database/sending-automated-job-email-notifications-in-sql-server-with-smtp/\">http://www.howtogeek.com/howto/database/sending-automated-job-email-notifications-in-sql-server-with-smtp/</a>, but why isn't it possible to just use that build-in functionality?</p>\n\n<p>Does anyone knows if there is anything else to do, to make that email notification task work properly? Thanks in advise.</p>\n"},{"tags":["sql-server-2008"],"answer_count":6,"favorite_count":4,"up_vote_count":6,"down_vote_count":0,"view_count":18893,"score":6,"question_id":2870126,"title":"SQL Server 2008 to SQL Server 2005","body":"<p>I have an MDF and LDF file of SQL Server 2005. i attached it with SQL Server 2008 and did some change in data. now when i attached it back to sql server 2005 Express Edition it gives version error.</p>\n\n<blockquote>\n  <p>The database 'E:\\DB\\JOBPERS.MDF'\n  cannot be opened because it is version\n  655. This server supports version 612 and earlier. A downgrade path is not\n  supported. Could not open new database\n  'E:\\DB\\JOBPERS.MDF'. CREATE DATABASE\n  is aborted. An attempt to attach an\n  auto-named database for file\n  E:\\DB\\Jobpers.mdf failed. A database\n  with the same name exists, or\n  specified file cannot be opened, or it\n  is located on UNC share.</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","common-table-expression"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":124,"score":3,"question_id":12827236,"title":"TSQL - Recursive CTE inefficient - Need an alternative","body":"<p>Here is a table with sample data:</p>\n\n<pre><code>DECLARE @TestTable TABLE (\n    ItemID INT,\n    A INT,\n    B INT,\n    Month INT)\n\nINSERT INTO @TestTable VALUES (1234, 5, 9, 1)\nINSERT INTO @TestTable VALUES (1234, 6, 9, 2)\nINSERT INTO @TestTable VALUES (4321, 5, 11, 1)\nINSERT INTO @TestTable VALUES (4321, 12, 11, 2)\nINSERT INTO @TestTable VALUES (1324, 14, 6, 1)\nINSERT INTO @TestTable VALUES (1324, 5, 6, 2)\nINSERT INTO @TestTable VALUES (1234, 1, 9, 3)\nINSERT INTO @TestTable VALUES (1324, 9, 6, 3)\n</code></pre>\n\n<p>Something to note is that the B column is always the same as it's only used once in this calculation, but is needed for the initial calculation.</p>\n\n<p>I am attempting to subtract B from A on the first row, then on subsequent rows subtract the previous rows difference from A. Effectively, <code>B - A = C</code> on the first then <code>C - A</code> on all subsequent rows FOR THE RELATED ItemID.</p>\n\n<p>Here are the results I'm expecting:</p>\n\n<pre><code>ItemID  A   B   C   Month   RowNumber\n1234    5   9   4   1       1\n1234    6   9   -2  2       2\n1234    1   9   -3  3       3\n1324    14  6   -8  1       1\n1324    5   6   -13 2       2\n1324    9   6   -22 3       3\n4321    5   11  6   1       1\n4321    12  11  -6  2       2\n</code></pre>\n\n<p>Here is how I am accomplishing this.</p>\n\n<pre><code>;WITH CTE_TestValue AS (\n    SELECT \n        Main.ItemID,\n        Main.A,\n        Main.B,\n        Main.Month,\n        ROW_NUMBER() OVER (Partition BY Main.ItemID ORDER BY Main.Month) AS RowNumber\n    FROM @TestTable AS Main\n),\nCTE_TestColumnC AS (\n    SELECT \n        MainA.ItemID,\n        MainA.A,\n        MainA.B,\n        (MainA.B - MainA.A) AS C,\n        MainA.Month,\n        MainA.RowNumber\n    FROM CTE_TestValue AS MainA\n        WHERE MainA.Rownumber = 1\n\n    UNION ALL\n\n    SELECT \n        MainB.ItemID,\n        MainB.A,\n        MainB.B,\n        (Sub.C - MainB.A) AS C,\n        MainB.Month,\n        MainB.RowNumber\n    FROM CTE_TestValue AS MainB\n        INNER JOIN CTE_TestColumnC AS Sub\n            ON MainB.RowNumber - 1 = Sub.RowNumber\n            AND MainB.ItemID = Sub.ItemID\n--      CROSS JOIN CTE_TestColumnC AS Sub\n--          WHERE Sub.RowNumber + 1 = MainB.RowNumber\n--          AND MainB.ItemID = Sub.ItemID \n)\nSELECT \n    Main.ItemID,\n    Main.A,\n    Main.B,\n    Main.C,\n    Main.Month,\n    Main.RowNumber\nFROM CTE_TestColumnC AS Main\nORDER BY ItemID, Month, RowNumber\n</code></pre>\n\n<p>This works fine on a small data-sample, but I'm dealing with about 20,000 ItemId's each repeating 10 times. It finishes all the first row calculations instantly, as expected, and then the calculation times go up DRASTICALLY.</p>\n\n<p>As you can see I've tried both an <code>INNER JOIN</code> and a <code>CROSS JOIN</code>. I believe they have the same execution plan with the parameters that I've given the <code>CROSS JOIN</code>.</p>\n\n<p>Is there a more effective/efficient way to accomplish this?</p>\n\n<p>I allowed this to run for 5 hours yesterday to see if it ever ended.. it did not.</p>\n\n<p>Another note: When I'm using this on the test data I <code>SELECT</code> WITHOUT using <code>ORDER</code> to hopefully help speed things along. The <code>ORDER</code> is just for my convenience when I'm fact checking.</p>\n"},{"tags":["sql-server-2008","database-permissions","symmetric-key"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1478,"score":2,"question_id":6625400,"title":"Cannot find the symmetric key in SQL Server 2008","body":"<p>I have a permissions issue with regard to using a symmetric key under a specific user name when a stored procedure is executed.</p>\n\n<p>Despite running</p>\n\n<pre><code>GRANT CONTROL ON CERTIFICATE::myCert TO myUser\nGRANT VIEW DEFINITION ON SYMMETRIC KEY::myKey TO myUser\n</code></pre>\n\n<p>I still get the same error:</p>\n\n<blockquote>\n  <p>Cannot find the symmetric key 'myKey',\n  because it does not exist or you do\n  not have permission.</p>\n</blockquote>\n\n<p>The Master Key, Certificate and Symmetric Key were set under the database the user name relates to.</p>\n\n<p>If I run the SP under Windows Authentication it works fine.</p>\n\n<p>Here's the stored procedure:</p>\n\n<pre><code>OPEN SYMMETRIC KEY myKey DECRYPTION\nBY CERTIFICATE myCert\n\nINSERT INTO sp_Password\n(billEncryptPassword)\nVALUES(ENCRYPTBYKEY(KEY_GUID('myKey'),@billEncryptPassword))\n\nRETURN @@IDENTITY       \nCLOSE SYMMETRIC KEY myKey \n</code></pre>\n\n<p>What have I missed?</p>\n"},{"tags":["tsql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":726,"score":1,"question_id":6953417,"title":"How to execute Table valued function","body":"<p>I have following function which returns Table .</p>\n\n<pre><code>create Function FN(@Str varchar(30))\n  returns\n  @Names table(name varchar(25))\n  as \n  begin \n\n      while (charindex(',', @str) &gt; 0)\n      begin\n      insert into @Names values(substring(@str, 1, charindex(',', @str) - 1))\n     set  @str = substring(@str, charindex(',', @str) + 1, 100)  \n      end\n      insert into @Names values(@str)  \n\n      return\n  end\n</code></pre>\n\n<p>Could any one please explain me how to run this function.</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12809838,"title":"SQL Server 2008 R2 Merge is deleteing the wrong set of data","body":"<p>I have the table <code>tblCollectionGameList</code></p>\n\n<pre><code>CREATE TABLE dbo.tblCollectionGameList\n(\n    ListID smallint IDENTITY(0,1) NOT NULL,\n    CollectionID smallint NOT NULL,\n    IncludedSectionID smallint NOT NULL,\n    CONSTRAINT PK_CollectionGameList_ListID PRIMARY KEY CLUSTERED (ListID ASC),\n    CONSTRAINT FK_CollectionGameList_SectionInfo FOREIGN KEY (CollectionID) REFERENCES dbo.tblSectionInfo (SectionID),\n    CONSTRAINT FK_CollectionGameList_SectionInfo2 FOREIGN KEY (IncludedSectionID) REFERENCES dbo.tblSectionInfo (SectionID)\n)\n</code></pre>\n\n<p>which I run the following <code>MERGE</code> command on after passing an XML set of values to from my website</p>\n\n<pre><code>SELECT \n   CAST(colx.query('data(CollectionID) ') AS varchar) AS CollectionID,\n   CAST(colx.query('data(IncludedSectionID) ') AS varchar) AS IncludedSectionID\nINTO #TEMPtblCollectionGameList\nFROM @XMLTable.nodes('DocumentElement/XMLTable') AS Tabx(Colx)\n\nMERGE dbo.tblCollectionGameList AS t\nUSING #TEMPtblCollectionGameList AS s\nON (t.CollectionID = s.CollectionID AND t.IncludedSectionID= s.IncludedSectionID)\nWHEN NOT MATCHED BY TARGET\n    THEN\n        INSERT (CollectionID, IncludedSectionID)\n        VALUES (s.CollectionID, s.IncludedSectionID)\nWHEN NOT MATCHED BY SOURCE\n    THEN\n        DELETE\n;\n</code></pre>\n\n<p>which is not working right. If I have an existing set of data in my table:</p>\n\n<pre><code>ListID  CollectionID    IncludedSectionID\n34      86              0\n35      86              1\n</code></pre>\n\n<p>and I try to place new data from my web page for a collection with a different <code>CollecitonID</code> it is removing the old data and placing the new data in:</p>\n\n<pre><code>ListID  CollectionID    IncludedSectionID\n38      92              10\n39      92              11\n</code></pre>\n\n<p>what is wrong with my <code>MERGE</code> code that is making it affect items outside the <code>CollectionID</code> that the webpage is passing for an update?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12828475,"title":"How to udate a sql server table with millions records quickly?","body":"<p>I have to update a table which is havig two millions record using Like keyword in the  where clause. The query looks like below:</p>\n\n<pre><code>UPDATE TABLE XYZ\nSET Column1='1'\nWhere Column2 Like'%' + var1 + '%' AND Column3 Like '%' + var2 +'%'\n</code></pre>\n\n<p>This execution is taking around 2 minutes at the moment. </p>\n\n<p>Please suggest, is there any way I can optimize the above query to bring the query execution time in seconds?</p>\n"},{"tags":["sql-server-2008","loops"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12830854,"title":"SQL Server 2008 - excluding from number of ranges of numbers","body":"<p>I need help with a SQL script.</p>\n\n<p>I have an <code>orders</code> table with a <code>card_number</code> column and I have another table called <code>card_range</code> which stores <code>card_number</code> ranges per client with a column to flag whether it's active or not active.</p>\n\n<p>When I select data from the <code>orders</code> table I would like to exclude all <code>card_number</code> ranges which are inactive</p>\n\n<p>Eg. <code>orders</code> table</p>\n\n<pre><code>order_id   card_number\n1          101\n2          102\n3          201\n4          301\n</code></pre>\n\n<p><code>card_range</code> table, active 0 = no, 1 = yes</p>\n\n<pre><code>start_card_number end_card_number active\n101               199             0\n201               299             1\n301               399             0\n</code></pre>\n\n<p>So the only data I want to return from the orders table is</p>\n\n<pre><code>order_id card_number\n3        201\n</code></pre>\n\n<p>The script that I'm trying to figure out is the looping thru the <code>card_range</code> table...thanks</p>\n"},{"tags":["c#","sql-server-2008","nhibernate","spatial"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12828258,"title":"Performing spatial searches in nHibernate","body":"<p>I want to use spatial searches in nHibernate v3.3.1.4000 but <code>nHibernate.Spatial</code> does not support the latest version of nHibernate. I found out that it's in the form of <code>HashFoo.Nhib.Spatial</code>. What can I do to perform spatial searches?</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12831415,"title":"SQL String Comparison with different string format","body":"<p>Here is my question. Let said i have job_grade column with different job grade such as  </p>\n\n<blockquote>\n  <p>E6A>E5A>E4A>E3A>C1>C2>C3>2>3>4>9E</p>\n</blockquote>\n\n<p>If i wish to display the job grade less than <code>E4A</code> the outcome result will be  </p>\n\n<blockquote>\n  <p>E3A,C1,C2,C3,2,3,4,9E </p>\n</blockquote>\n\n<p>Because the string format is different and the methods I have been try is compare it one by one. Isn't that other method if I don't want to compare 1 by 1? </p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12827912,"title":"No lock runs of the same query","body":"<pre><code>                if exists (select 1 from schema.TableName (nolock) where Id = @id) \n                update schema.TableName set DocumentXML = @documentXml, ClientDocumentGUID=@clientDocGuid, Incomplete = @incomplete where Id = @id\n                else\n                insert into schema.TableName\n                select @id, @templateId, @clientVisitGuid, @clientGuid, @chartGuid, @scmDocumentGuid, @clientDocGuid, @incomplete, getdate(), @createdByGuid, @documentXml\n</code></pre>\n\n<p>I have a C# program that runs the query above.  I have situations coming up where rows are being inserted twice.  I think the issue is this query.  The idea is that the query can be run twice given the same <code>@Id</code>.  The first time should be an insert, the second time should be an update. </p>\n\n<p>Note the query has a <code>(no lock)</code>.  Does this mean that the queries are not necessarily run in a FIFO fashion? I believe the two row problem can only arise if I run this query asynchronously.</p>\n"},{"tags":["sql-server","database","sql-server-2008","database-design"],"answer_count":8,"favorite_count":6,"up_vote_count":9,"down_vote_count":0,"view_count":2316,"score":9,"question_id":4373968,"title":"Database design: Calculating the Account Balance","body":"<p>How do I design the database to calculate the account balance?</p>\n\n<p>1) Currently I calculate the account balance from the transaction table\nIn my transaction table I have \"description\" and \"amount\" etc..</p>\n\n<p>I would then add up all \"amount\" values and that would work out the user's account balance.</p>\n\n<hr>\n\n<p>I showed this to my friend and he said that is not a good solution, when my database grows its going to slow down???? He said I should create separate table to store the calculated account balance. If did this, I will have to maintain two tables, and its risky, the account balance table could go out of sync.</p>\n\n<p>Any suggestion?</p>\n\n<p><strong>EDIT</strong>: OPTION 2: should I add an extra column to my transaction tables \"Balance\".\nnow I do not need to go through many rows of data to perform my calculation.</p>\n\n<p>Example\nJohn buys $100 credit, he debt $60, he then adds $200 credit.</p>\n\n<p>Amount $100, Balance $100.</p>\n\n<p>Amount -$60, Balance $40.</p>\n\n<p>Amount $200, Balance $240.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12828032,"title":"How to perform bitwise operation on comma delimited column?","body":"<p>I have a table which has 2 columns:</p>\n\n<pre><code>ID (INT) (PK)  NumList (VARCHAR)\n1              2,4,25\n2              2,12,25,33\n3              3,10\n</code></pre>\n\n<p>How would I let's say add a column to this table and apply the OR (|) operator on the numbers in the list?</p>\n\n<pre><code>ID   NewCol\n1    31\n2    63\n3    11\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":9844345,"title":"Interrupting a database file shrink process in SSMS 2008","body":"<p>I recently removed table data from a batch of production databases and I've been shrinking the database files using the 'Shrink File' feature in SSMS.  Some of the databases will shrink more than 50gb.  I noticed that this processes takes a very long time to complete and that there is no cancel button while this process is running.  I am connecting to all the database servers remotely via RDP and cannot guarantee that they won't be power-cycled during the trim process.</p>\n\n<p>If the shrink process is running and the server is power-cycled, will I experience database corruption?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":12829055,"title":"SQL Server keeps on counting rows","body":"<p>I've disabled row counting using <code>SET NOCOUNT ON</code> but it seems that sqlserver is still counting rows.</p>\n\n<pre><code>USE Northwind\nSET  NOCOUNT ON;\nSELECT * FROM Products p\nSELECT @@ROWCOUNT AS 'RowCount';\n</code></pre>\n\n<p>the query returns 77 for row count, why?</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008","mysqli"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12828310,"title":"Specific JOIN of 3 tables retrieving data","body":"<p>I have 3 tables in MySQL</p>\n\n<pre><code>USERS\nuid\nemail\npassword\ncreated\n</code></pre>\n\n<p>This is the table that have all records of all users </p>\n\n<pre><code>PHOTOS\niid\nuid\nfile\nthumb\nuploaded\n</code></pre>\n\n<p>This is the table where all photos posted by each user are kept on</p>\n\n<pre><code>COMMENTS\ncid\niid\nuid\nmessage\ncreated\n</code></pre>\n\n<p>This is the table where all the comments on each photo by every user are kept on</p>\n\n<p>What i want is a query that retrives me the amount (<code>COUNT</code>) of comments on every photo for every unique (<code>DISTINCT</code>) user. \nFor example (the resulting output must be) :</p>\n\n<pre><code>comment_amount  by_user on_picture\n3               1       1\n2               2       1\n2               1       2\n5               2       2\n6               2       3\n</code></pre>\n\n<p>so the output could tell us if it is formated something like (example)</p>\n\n<pre><code>3 comments posted by USER1 on PICTURE1\n2 comments posted by USER2 on PICTURE1\n\n2 comments posted by USER1 on PICTURE2\n5 comments posted by USER2 on PICTURE2\n\n6 comments posted by USER2 on PICTURE3\n</code></pre>\n\n<p>What i have so far is</p>\n\n<pre><code>SELECT \nusers.uid\nFROM users\nINNER\n    JOIN photos\n    ON photos.uid = users.uid\nINNER\n    JOIN comments\n    ON comments.iid = photos.iid\n</code></pre>\n\n<p>and here is the sandbox testing</p>\n\n<pre><code>http://sqlfiddle.com/#!2/955d5/1\n</code></pre>\n\n<p>But i don't know what to do next, any help would be appreciated! Also any language beside MySQL should work as well!</p>\n"},{"tags":["sql","sql-server-2008","count"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":46,"score":3,"question_id":12825599,"title":"How to combine the count for a distinct field data","body":"<p>The result of my query:</p>\n\n<pre><code>SELECT SYS_Product, \n       CASE \n         WHEN MEMVendor_Name = 'Unavailable' OR MEMVendor_Name = 'unknown' \n           THEN 'Error' \n         ELSE MEMVendor_Name \n       END AS MEMVendor_Name, \n       COUNT(MEMVendor_Name) AS MEMVendor_NameCount\nFROM  dbo.ahs_master_bc_system_mem_vendor AS V\nWHERE (AHS_CurrentCfg = 1) \nand SYS_Product='Gen8'\nGROUP BY SYS_Product, MEMVendor_Name\n</code></pre>\n\n<p>is as follows:</p>\n\n<pre><code>SYS_Product | MEMVendor_Name| MEMVendor_NameCount\n_____________________________________________\nGen8          Elpida           1\nGen8          Micron           84\nGen8          Nanya            28\nGen8          Netlist          0\nGen8          Samsung          55\nGen8          SK-Hynix         86\nGen8          Error            0 &lt;----\nGen8          Error            2 &lt;----\n</code></pre>\n\n<p>Problem: how can I get the \"Sum\" of JUST the Error to be 2(0+2) still maintaining the counts of others:</p>\n\n<pre><code>SYS_Product | MEMVendor_Name| MEMVendor_NameCount\n_____________________________________________\nGen8          Elpida            1\nGen8          Micron            84\nGen8          Nanya             28\nGen8          Netlist           0\nGen8          Samsung           55\nGen8          SK-Hynix          86\nGen8          Error             2 &lt;===\n</code></pre>\n\n<p>I need the group by since these results will be combined with another query based on the SYS_Product and MEMVendor_Name</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2008","openxml"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12827126,"title":"How to Join OPENXML data to my Inner Join Query?","body":"<p>OpenXML:</p>\n\n<pre><code>DECLARE @idoc int\nDECLARE @doc varchar(1000)\nSET @doc =\n'&lt;ROOT&gt;\n        &lt;Employee EmployeeID = \"1\"  EmpStatus = \"Full Time\"/&gt;\n        &lt;Employee EmployeeID = \"2\"  EmpStatus =\"Part Time\" /&gt;\n        &lt;/ROOT&gt;'\n    EXEC sp_xml_preparedocument @idoc OUTPUT, @doc\nSELECT    *\nFROM       OPENXML (@idoc, '/ROOT/Employee',1)\n            WITH (EmployeeID  varchar(10),\n                  EmpStatus varchar(20))\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>EmployeeID    EmpStatus\n    1         Full Time\n    2         Part Time\n</code></pre>\n\n<p>Table query:</p>\n\n<pre><code>    SELECT hr.EmployeeID, hr.Title, c.FirstName,c.LastName \n    FROM HumanResources.Employee hr WITH (NOLOCK)\n    INNER JOIN ContactInfo c WITH (NOLOCK)\n    ON hr.ContactID = c.ContactID\n    Where hr. EmployeeID IN ( 1, 2)\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>EmployeeID  Title         FirstName  LastName\n    1   Engineering   Mike       Brown\n    2   Programmer    Yves       Anthony\n</code></pre>\n\n<p>How to join OpenXML data to my inner join query using <code>EmployeeID</code>?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12826482,"title":"Guide me with this stored procedure or function","body":"<pre><code>Manager | Employee  |HireDate\n----------------------------------------\nManagerA| EmpA      |1/1/2012\nmanagerA| EmpB      |1/15/2012\nManagerB| Emp C     |2/1/2012\nManagerA| Emp D     |2/15/2012\nManagerB| Emp E     |2/8/2012\n</code></pre>\n\n<p>The bonus amount for each manager is calculated based on how many recruits were hired that month.\nex. each Manager gets 1000 for first hire and 500 additional for every next.</p>\n\n<p>Its almost like each record has a seed</p>\n\n<pre><code>Manager | Employee  |HireDate   | Seed\n------------------------------------------------\nManagerA| EmpA      |1/1/2012   | 1\nmanagerA| EmpB      |1/15/2012  | 2\nManagerB| Emp C     |2/1/2012   | 1\nManagerA| Emp D     |2/15/2012  | 1\nManagerB| Emp E     |2/8/2012   | 2\n</code></pre>\n\n<p>and Bonus is a function of the seed as 1000+(seed-1)*500</p>\n\n<p>I need help generating the seed .I am not sure if I should use a stored procedure to generate the seed or a function</p>\n\n<p>eventually I want to generate a table as below</p>\n\n<pre><code>Manager | Employee  |HireDate   | Bonus\n-------------------------------------------------\nManagerA| EmpA      |1/1/2012   | 1000\nmanagerA| EmpB      |1/15/2012  | 1500\nManagerB| Emp C     |2/1/2012   | 1000\nManagerA| Emp D     |2/15/2012  | 1000\nManagerB| Emp E     |2/8/2012   | 1500\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","stored-procedures"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12826465,"title":"Stored proceedure call 2nd SP with Trans Commit","body":"<p>I have one store procedure that will need to call a second stored procedure passing over one input parameter. Due to the nature of both stored procs I'd like to be able to use transactions and commit to ensure all elements are carried out before being committed.</p>\n\n<p>If the relevant contents of the first stored proc are within the transaction aswell as the call to the 2nd stored proc, will this suffice or is it the case that the events of the 2nd sp would be commited seperately???</p>\n\n<p>I hope that makes sense, &amp; thanks for in advance for the help.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12824547,"title":"Stored procedure dealing with multiple records","body":"<p>I have the following SQL which works great at this stage:</p>\n\n<pre><code>  INSERT INTO recEntrantStatus (entrantId, roundId, judgeId, notified, voted, enterNextRound)\n  SELECT entrantId, (@round + 1), judgeId, 0, 0, 0\n  FROM recEntrantStatus\n  WHERE roundId = @round\n  AND voted = 1\n  AND enterNextround = 1\n</code></pre>\n\n<p>This code checks for all rows where <code>enterNextRound</code> is true, and then creates a new row for each of them.</p>\n\n<p><strong>However, I now need to expand this so that:</strong></p>\n\n<ol>\n<li><p>Check a second table (<code>tblJudges</code>) for all judges and get an array of all the judges Id's (Id)</p></li>\n<li><p>Do the same as in the above example except now creating each of the above rows for each of the judges / judges Id's obtained from step 1. </p></li>\n</ol>\n\n<p>Any help / suggestions would as always be greatly appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":["database","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":710,"score":0,"question_id":6882818,"title":"How i can stop SQL server 2008 Express from Startup in Windows ?","body":"<p>i am installing SQL server 2008 express and found that many exe run on startup even i not used them.</p>\n\n<p>can i stop them or allow to run them only after when i want to run them. means when i want only that time those run otherwise not.</p>\n\n<p>how i can remove them from startup</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":128,"score":0,"question_id":12817099,"title":"insert XML file in SQL via SSIS","body":"<p>I have this procedure </p>\n\n<pre><code>ALTER proc [dbo].[adenti] \n(\n   @entra nvarchar(max)\n)\nas \nDECLARE @sql varchar(4000); \nSET @sql = 'INSERT INTO provaxml (arquivo) SELECT CAST(BulkColumn AS XML) FROM OPENROWSET(BULK ''' + @entra + ''', SINGLE_BLOB) as arquivo'; \nEXEC( @sql );\n</code></pre>\n\n<p>The code above works. </p>\n\n<p>Is it possible to use <em>Integration Services</em> to insert all the XML file in a path into a SQL table?</p>\n"},{"tags":["sql","sql-server-2008","tsql","datetime","dynamic-sql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":170,"score":2,"question_id":12805269,"title":"Convert datetime stored procedure parameter to a filter (in WHERE clause) in a dynamic T-SQL query","body":"<p>Below I have a snippet of code from a stored procedure I'm trying to make dynamic.  Meaning I want to run the <code>EXEC('select * from table_name WHERE filter=something')</code> to return a result set to my web service.  The week_start_date field in my table that I'm querying is a datetime field, not a date field.  How do I properly append the datetime parameter to the dynamic SQL so it interprets it correctly in the query?  Also, if you have suggestions on how to make the code cleaner, I'll take advice.</p>\n\n<p><strong>When I look at the data, I have values that look like this:</strong></p>\n\n<pre><code>2012-08-10 00:00:00.000\n</code></pre>\n\n<p><strong>T-SQL code that is not working:</strong></p>\n\n<pre><code>ALTER PROCEDURE [dbo].[logged_time_by_week]\n    @week_start_date_filter datetime = null\nAS\nBEGIN\n</code></pre>\n\n<p>....</p>\n\n<pre><code>    DECLARE @select_clause nvarchar(4000);\n    DECLARE @from_clause nvarchar(4000);\n    DECLARE @where_clause nvarchar(4000);\n    DECLARE @order_clause nvarchar(4000);\n\n    SET @select_clause = \n        ' SELECT '\n        + ' [sunday_hours],'\n        + ' [monday_hours],'\n        + ' [tuesday_hours],'\n        + ' [wednesday_hours],'\n        + ' [thursday_hours],'\n        + ' [friday_hours],'\n        + ' [saturday_hours]'\n\n    SET @from_clause =\n        ' FROM '\n        + ' [timesheet_row] '\n\n    SET @where_clause = ''\n\n    IF @week_start_date_filter IS NOT NULL AND @week_start_date_filter != ''\n    BEGIN \n        IF @where_clause != ''\n        BEGIN\n            SET @where_clause = @where_clause + ' AND ' \n        END\n        SET @where_clause = @where_clause + ' [week_start_date] = ' + CONVERT(nvarchar, @week_start_date_filter)\n    END\n\n    IF @where_clause != '' \n    BEGIN\n        SET @where_clause = ' WHERE ' + @where_clause\n    END\n\n    SET @order_clause = ' ORDER BY [' + @sort_column + '] ' + @sort_direction\n\n    EXEC(@select_clause + @from_clause + @where_clause + @order_clause)\n</code></pre>\n"},{"tags":["sql-server-2008","tsql","sql-management-studio"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":83,"score":2,"question_id":12661644,"title":"How to Connect to SQL from Management Console using T-SQL","body":"<p>I have a group of SQL servers spread out in 25 locations that all have the same database.  I can connect to all of them manually using the Management Console.  In the server management console under \"New Query\", I would like to learn how to wrap a query or a group of t-sql statements with a loop that will first make the connection to one of the servers, specify the database, and then run the query/statement.  This way if I need to run a common query on all of the databases, such as updating the databases, I don't have to manually connect to each one, expand the console, click on the database, and then click \"New Query.\"</p>\n\n<p>The servers are all named wsrv01, wsrv02, wsrv03, etc., so I could loop through the names easily; I just don't know how to do the loop or make the connection.</p>\n\n<p>This is kind of a unique environment...I've used RedGate in the past on other projects and love it; but this is a different situation.</p>\n\n<p>Basically, I want to avoid having to do this and drill into each server to run a query:</p>\n\n<p><img src=\"http://i.stack.imgur.com/9uSKm.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12789402,"title":"How to accomodate a database for 2 unique identifiers?","body":"<p>I currently have a table that has an <code>IDENTITY</code> field.  The field is declared as an <code>INT</code> type.  The problem is that I have some new unique values, but they are not <code>INT</code>, they are alpha-numeric, so I can't put them in the <code>INT</code> field. Is my only option to create another column and stick these in a new <code>NON-IDENTITY</code> column or is there an alternative.  The example above is just for 2 different identity formats, but what if I start getting more, I don't want to have to create a column for every type of formatted alpha(number).</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":95,"score":1,"question_id":9696806,"title":"Dynamically Changing the Return Type of a Function","body":"<p>I am writing a Function that has a return-type which will dynamically change depending on the column which we are passing.\nHere in the following code I am passing the column-value, column-datatype. But I am getting error while running the code.</p>\n\n<blockquote>\n  <p>\"A RETURN statement with a return value cannot be used in this\n  context.\"</p>\n</blockquote>\n\n<p>If this is not possible then how to change the return type dynamically.\nKindly suggest solution.</p>\n\n<pre><code>Create Function myFunction(@ColValue varchar(100), @ColReturnType varchar(100))\nRETURNS @ColReturnType\nAS\nBEGIN\n    IF(@ColValue = 'xxxxx')\n    BEGIN\n        return 0\n    END\n    ELSE\n    BEGIN\n       return @ColValue\n    END\nEND\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12803916,"title":"Select to retrieve multiple rows then loop results for Insert statement","body":"<p>I need to create a stored procedure to do the following;</p>\n\n<pre><code>    SELECT * FROM TABLE1\n</code></pre>\n\n<p>Then for each row returned;</p>\n\n<pre><code>    INSERT INTO TABLE2 (column1, column2, column3,...) \n    VALUES (value1, value2, value3,...)\n</code></pre>\n\n<p>How would I go about doing this?</p>\n\n<p><em><strong></em></strong> UPDATE <strong>**</strong></p>\n\n<p>So based on responses so far I've got the following sql;</p>\n\n<pre><code>INSERT INTO recEntrantStatus (entrantId, roundId, judgeId)\nSELECT entrantId, judgeId\nFROM recEntrantStatus\nWHERE roundId = 0\nAND voted = true\nAND enterNextround = true\n</code></pre>\n\n<p>But I need to add a fixed value eg an input @round into the newly created records in the column roundId.</p>\n\n<p>How do I go about doing that?</p>\n\n<p>Thanks.</p>\n\n<p>------------------------------------- UPDATE 2 -------------------------------------------</p>\n\n<p>So thanks to some significant help from you guys, I've now got the following SQL which works great at this stage:</p>\n\n<pre><code>  INSERT INTO recEntrantStatus (entrantId, roundId, judgeId, notified, voted, enterNextRound)\n  SELECT entrantId, (@round + 1), judgeId, 0, 0, 0\n  FROM recEntrantStatus\n  WHERE roundId = @round\n  AND voted = 1\n  AND enterNextround = 1\n</code></pre>\n\n<p>This code checks for all records where 'enterNextRound' is true, and then creates a new record for each of them.</p>\n\n<p>However, I now need to expand this so that:</p>\n\n<p>A) Check a second table(tblJudges) for all judges and get an array of all the judges Id's (Id)</p>\n\n<p>B) Do the same as in the above example except now creating each of the above records for each of the judges / judges Id's obtained from step A. </p>\n\n<p>Any help / suggestions would as always be greatly appreciated.</p>\n\n<p>Thanks!</p>\n\n<p>CLOSED - Question posted as a new question due to additional requirements. Thanks!</p>\n"},{"tags":["sql-server-2008","tsql","for-xml","for-xml-explicit"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12735615,"title":"SQL Server EXPLICIT mode with FOR XML","body":"<p>I am using SQL Server 2008 and I'm trying to produce a custom xml using <code>EXPLICIT</code> mode with <code>FOR XML</code>.</p>\n\n<p>I have the one to many relation having following query</p>\n\n<pre><code>select  \n    p.personid, p.firstname, a.P_City \nfrom \n    tblPeople p with (nolock) \nleft outer join \n    tblAddresses a with (nolock) on p.personid = a.personid \nwhere \n    p.personid = 120773\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/hQOEk.png\" alt=\"enter image description here\"></p>\n\n<p>I want person as parent and address as child may be multiple because people to address having one to many relation.</p>\n\n<p>I wrote the following query</p>\n\n<pre><code> select 1 as TAG,\n        null as parent, \n        p.personid as [person!1!personid],\n        p.FirstName as [person!1!firstname],\n\n        null as [addr!2!] \n        from tblPeople p with (nolock) where p.PersonID in (120773,117396)\n\n        union all \n\nselect 2,1, \n        p.PersonID, p.FirstName, a.P_City from tblAddresses a with(nolock), tblPeople p \n        where p.PersonID=a.PersonID and p.PersonID in (120773,117396)\n\n        for xml explicit\n</code></pre>\n\n<p>Output as follows, it is broken xml with person nested there is some thing wrong with my code for sure.</p>\n\n<pre><code>&lt;person personid=\"117396\" firstname=\"David\"/&gt;\n    &lt;person personid=\"120773\" firstname=\"Doyle\"&gt;\n        &lt;addr&gt;Mount Rainier&lt;/addr&gt;\n        &lt;addr&gt;Annapolis&lt;/addr&gt;\n&lt;/person&gt;\n</code></pre>\n\n<p>Can some one please help me out !!!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-order-by"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":12824195,"title":"SQL Server 2008 datetime index performance bug","body":"<p>I read through the following post:\n<a href=\"http://stackoverflow.com/questions/1716798/sql-server-2008-ordering-by-datetime-is-too-slow\">SQL Server 2008: Ordering by datetime is too slow</a></p>\n\n<p>but there is more going on with the client/server than what is begin described here.  We are using SQL Server 2008 R2, and have a very large (100M+ rows) table with a primary id index, and a <code>datetime</code> column with a nonclustered index. We are seeing some highly unusual client/server behavior based upon the use of an <code>order by</code> clause <em>specifically</em> on a <strong>indexed datetime column</strong>.</p>\n\n<p>If we run the following query (edited to protect some content):</p>\n\n<pre><code>select * \nfrom [big table] \nwhere serial_number = [some number] \norder by test_date desc\n</code></pre>\n\n<p>The query times-out every time. In the SQL Server Profiler the executed query looks like this to the server:</p>\n\n<pre><code>exec sp_cursorprepexec @p1 output,@p2 output,NULL,N'select * .....\n</code></pre>\n\n<p>Now if you modify the query to, say this:</p>\n\n<pre><code>declare @temp int;\nselect * from [big table] \nwhere serial_number = [some number] \norder by test_date desc\n</code></pre>\n\n<p>The the SQL Server Profiler shows the executed query looks like this to the server, and it WORKS instantly:</p>\n\n<pre><code>exec sp_prepexec @p1 output, NULL, N'declare @temp int;select * from .....\n</code></pre>\n\n<p>As a matter of fact, you can even put an empty comment ('--;') instead of a unused declare statement and get the same result. So initially we were pointing to the sp pre-processor as the root cause of this issue, but if you do this:</p>\n\n<pre><code>select * \nfrom [big table] \nwhere serial_number = [some number] \norder by Cast(test_date as smalldatetime) desc\n</code></pre>\n\n<p>It works instantly as well (you can cast it as any other <code>datetime</code> type), returning the result in milliseconds. And the profiler shows the request to the server as:</p>\n\n<pre><code>exec sp_cursorprepexec @p1 output, @p2 output, NULL, N'select * from .....\n</code></pre>\n\n<p>So that somewhat excludes the <code>sp_cursorprepexec</code> procedure from the full cause of the issue. Add to this the fact that the <code>sp_cursorprepexec</code> is also called when no 'order by' is used and the result it also returned instantly.</p>\n\n<p>We've googled around for this issue quite a bit, and I see similar issues posted from others, but none that break it down to this level.</p>\n\n<p>So have others witnessed this behavior? Does anyone have a solution better than putting meaningless SQL in front of the select statement to change the behavior? Being that SQL Server should be invoking the order by after the data is collected, it sure seems like this is a bug in the server that has persisted for a long time. We have found this behavior to be consistent across many of our large tables, and is reproducible.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":81,"score":4,"question_id":12823320,"title":"SQL Server : Table Spool when adding ORDER BY","body":"<p>I have a very simple query that I am trying to optimize. issues_notes is a simple table, while meta_users is a table on a remote database server that I am querying via a view.</p>\n\n<p>when I run the query without ordering it returns immediately, but when I add <code>ORDER BY date</code> it takes about 4 seconds to return. I had SQL Server show the execution plan, and it appears that the slowness is introduced in a <code>Table Spool</code> operation that happens only on the join. Is there a way to prevent this \"optimization\"?</p>\n\n<p>Query:</p>\n\n<pre><code>SELECT \n    [issues_notes].[date], \n    [meta_users].[firstname], \n    [meta_users].[lastname], \n    [issues_notes].[note] \nFROM \n    [issues_notes] \n    LEFT JOIN [issues_issue] \n        ON ([issues_notes].[issue_id] = [issues_issue].[id]) \n    LEFT OUTER JOIN [meta_users] \n        ON ([issues_notes].[author_id] = [meta_users].[userid]) \nWHERE \n    ([issues_issue].[issue_hash] = '%s' ) \n</code></pre>\n\n<p>Execution Plan without Order By:</p>\n\n<p><img src=\"http://i.stack.imgur.com/wuEOZ.png\" alt=\"enter image description here\"></p>\n\n<p>Execution Plan With Order By: </p>\n\n<p><img src=\"http://i.stack.imgur.com/ZcjhQ.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-profiler"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":12822946,"title":"See running procedure in SQL server Profiler","body":"<p>How can I see running procedures in SQL Server Profiler?</p>\n\n<p>It only shows when the execution is done.</p>\n\n<p>I have some procedures that requires my attention if it is taking too long to get executed. Getting to know after it is done is useless for me</p>\n\n<p>thanks</p>\n"},{"tags":["tsql","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":111,"score":1,"question_id":7485667,"title":"T-SQL compilation issue for simple query involving DMV","body":"<p>For some reason, the following query which uses the <code>sys.dm_exec_requests</code> DMV and the <code>sys.dm_exec_sql_text</code> DMV fails to compile:</p>\n\n<pre><code>SELECT er.session_id, es.[text]\nFROM sys.dm_exec_requests AS er \n  CROSS APPLY sys.dm_exec_sql_text(er.[sql_handle]) AS es \n</code></pre>\n\n<p>The query excerpt above is part of a much larger (and more complex) query which fails, because this smaller query will not execute, giving me the syntax error:</p>\n\n<blockquote>\n  <p>Msg 102, Level 15, State 1, Line 3 Incorrect syntax near '.'.</p>\n</blockquote>\n\n<p>The query seems simple enough, yet it looks like the T-SQL parser is balking at the <code>er.sql_handle</code>. I thought this might be an escaping issue and tried <code>er.[sql_handle]</code>, but sadly got the same error.</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":56,"score":1,"question_id":12822710,"title":"SQL Order by with Condition?","body":"<p>until now i have the following Query:</p>\n\n<pre><code>select dl \nfrom Dienstleistung as dl inner join \n     dl.DienstleistungsOrte as dlo with dlo.ID = :raumID \norder by dl.Bezeichnung\n</code></pre>\n\n<p>Is it possible to order two colums with a condition?</p>\n\n<p>What i want is to order by dl.Bezeichnung and dl.Sortierung. The Condition should be: </p>\n\n<pre><code>IF dl.Sortierung = 0 ---&gt; order by dl.Bezeichnung\nand\nIF dl.Sortierung &gt; 0 ---&gt;order by dl.Sortierung\n</code></pre>\n"},{"tags":["performance","sql-server-2008","query","table"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12822518,"title":"How to improve Query performance on large table in MS SQL Server 2008 R2","body":"<p>I have a table with 20 million records. What is the best option to improve query performance on this table. Is partitioning the table into filegroups  is a best option or splitting the table into multiple smaller tables? </p>\n"},{"tags":["sql-server","sql-server-2008","sum","pivot","average"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12820627,"title":"SQL Server pivot average","body":"<p>I have a Microsoft SQL server pivot query that gets a sum of values with rows per category and monthly columns 1 to 12</p>\n\n<p>I currently have 13 columns returned in the query, for example, with no data after april:</p>\n\n<pre><code> Category  [1]   [2]   [3]   [4]   [5]   [6]   [7]   [8]   [9]   [10]   [11]   [12]\n -----------------------------------------------------------------------------------\n Food      150   200   0     125   null  null  null  null  null  null   null   null  \n Drink     140    0     90   115   null  null  null  null  null  null   null   null  \n</code></pre>\n\n<p>Per category, I need to add the total sum of values, as well as the average value ignoring months with no data.\nFor the data above, I need to add the columns:</p>\n\n<pre><code> Sum   Average\n 475    118.75\n 345     86.25\n</code></pre>\n\n<p>I tried many different methods, but I couldn't find a way.</p>\n"},{"tags":["sql-server-2008","full-text-indexing","stop-words"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12822638,"title":"SQL Full Text Index - Ignore Dollar Amounts / Use Wildcards","body":"<p>I've got some documents that have been run through and OCR and I'm indexing them via SQL Server and a fulltext.</p>\n\n<p>I've got a stop list set up but that appears to only work for whole words.  Does anyone know how you might use a wildcard or another workaround?</p>\n\n<p>Here are some of the sample entries that are being catalogued:</p>\n\n<p>$,000\n$,000,000\n$,000,090\n$,006\n$,015\n$,063,980\n$,087\n$,089,000\n$,100,000\n$,140\n$,143\n$,175\n$,200.00</p>\n\n<p>I've tried to put in \"$*\" and \"$%\", but that doesn't appear to work like I might hope.  Anyone have any thoughts?</p>\n"},{"tags":["sql","sql-server-2008","excel","stored-procedures","excel-2010"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":160,"score":0,"question_id":12693967,"title":"Table in Excel from SQL Server stored procedure with parameter field in workbook","body":"<p>I need to create a dynamic report using Excel 2010 and SQL Server. Going off of previous ones created by others I figured out how to create the data connection and use the stored procedure with a specific parameter in the connection properties definition tab. The other reports use a <code>?</code> in the command definition and use a cell in the workbook to define the parameter. </p>\n\n<p>How do I do that too?</p>\n\n<p>Specific steps to creating the connection/report/parameter selection or any help much appreciated.</p>\n"},{"tags":["sql","sql-server-2008","tsql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":195,"score":2,"question_id":12813563,"title":"Writing a stored procedure with an insert statement with unlimited parameters","body":"<p>I'm having a bit of trouble with a question given to me in an assignment. My lecturer isn't the greatest at explaining things in a way I can understand, so I'm hoping I can get some help here.</p>\n\n<p>This is the question we were given:</p>\n\n<blockquote>\n  <p>Construct a stored procedure to insert data into the keyword table. The format of the input string should be (Topic_name, ‘K1,W1,K2,W2,K3,W3…Kn, Wn’). Ks are keywords and Ws are weights. If the Topic name cannot be found in the Topic table then you need to insert the new topic name into the Topic table first and subsequently insert other data into the keyword table. Your stored procedure should always check the string pattern to ensure it is correctly formatted and the correct data types are used. Provide a feedback message to the user if the string pattern is invalid.</p>\n</blockquote>\n\n<p>This is my keyword table:</p>\n\n<pre><code>CREATE TABLE Keyword(\n    Topic_Name  VARCHAR(30) NOT NULL,\n    Keyword VARCHAR(30) NOT NULL,\n    K_weight    INT     NOT NULL,\n    PRIMARY KEY(Topic_Name, Keyword),\n    FOREIGN KEY(Topic_Name) REFERENCES Topic);\n</code></pre>\n\n<p>The main issue I'm having is with the parameters. I have no idea how to get the SP to count how many parameters the user has included. Any help I could get would be greatly appreciated. If you need any additional information, just let me know. Cheers.</p>\n"},{"tags":["php","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12405964,"title":"Error when connecting to mssql server with PHP","body":"<p>I'm trying to connect to a Navision database (MSSQL 2008) through PHP.</p>\n\n<p>On my Linux server, I have build FreeDTS and recompiled PHP with the mssql extension.</p>\n\n<p>However, I get the following error:</p>\n\n<blockquote>\n  <p>Warning: mssql_connect() [function.mssql-connect]: Unable to connect to server: </p>\n</blockquote>\n\n<p>I have copied the code to a Windows server running PHP, and it connects just fine.</p>\n\n<p><strong>Server info:</strong></p>\n\n<pre>\nOS: Centos 6.2\nPHP version: 5.2.17\nFreeDTS version: 0.91\n</pre>\n\n<p>I have tried to connect to the Mssql server through telnet, and that works fine. So no firewall issues.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12818707,"title":"What is the best way to group by username with this SQL statement?","body":"<pre><code>SELECT \n  M.FromUserID,\n  UF.Fname + ' ' + UF.Sname As FullName,\n  UF.URL as Username,\n  Subject,\n  Body,\n  M.Ctime,\n  M.ViewedDate,\n  M.MessageID,\n  M.Starred,\n  M.Deleted,\n  M.ToUserID,\n  (SELECT TOP 1 Fname + ' ' + Sname as FullName FROM user_basics UB WHERE UB.UserID = M.ToUserID) as ToName,\n  (SELECT TOP 1 URL FROM user_basics UB WHERE UB.UserID = M.ToUserID) as ToUserName \nFROM Messages M \n  LEFT JOIN User_Basics UF ON UF.userID = M.FromUserID \nWHERE M.ToUserID = 1433 AND Deleted IS NULL ORDER BY M.Ctime DESC\n</code></pre>\n\n<p>I want to display a message history with the most recent message first grouped by Username...</p>\n\n<p>When I use the group by method it tells me I need to add in all the other columns...</p>\n\n<p><code>Column 'Messages.FromUserID' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</code></p>\n\n<p>There must be a better way?</p>\n"},{"tags":["sql","oracle","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12819313,"title":"Copy database table from SQL Server to Oracle","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/571051/moving-data-from-sql-server-to-oracle-repeatedly\">Moving Data from SQL Server to Oracle Repeatedly</a>  </p>\n</blockquote>\n\n\n\n<p>Is it possible to copy a table from SQL Server to a new table in Oracle?</p>\n\n<p>I am pretty sure that it is not possible, but I would like an expert confirmation and how if it exists.</p>\n\n<pre><code>CREATE TABLE `backup_db.backup_table` \n  SELECT * FROM `live_db.live_table`;\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>To be more clear, I need to copy this table every day from SQL Server to Oracle.</p>\n\n<p>I know that it is not elegant, but I have no other choice.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":57,"score":0,"question_id":12817923,"title":"issue using IN clause with sub query","body":"<p>I have the following query </p>\n\n<pre><code>SELECT COUNT(*) \nFROM Table1 \nWHERE Column1 IN\n(SELECT  Column1 FROM Table2)\n</code></pre>\n\n<p>Actually there is no column named Column1 in the Table2.\nSo if we execute only the sub query </p>\n\n<pre><code> SELECT  Column1 FROM Table2\n</code></pre>\n\n<p>it will throw the error -  Invalid column name 'Column1'.</p>\n\n<p>But if I Execute the full query , I am not getting any error. It is returing the total row count in Table1.</p>\n\n<p>So I would like to know the reason why this query it not giving any error in this case And the way the IN clause works in this scenario.</p>\n"},{"tags":["c#","sql-server-2008","networking","connection"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":138,"score":0,"question_id":12818557,"title":"Connect C# app with SQL Server 2008 via network","body":"<p>I have an error when attempting to connect</p>\n\n<blockquote>\n  <p><em>object reference not set to an instance of an object.</em></p>\n</blockquote>\n\n<p>The app is working on my laptop with SQL Server database, but I need to connect the app on my laptop and connect with SQL Server on my PC (<code>Sharkawy-PC</code>) via network I need help for <code>app.config</code> code &amp; code to every form to use the connection from <code>app.config</code>.</p>\n\n<pre><code>    private void btnlogin_Click(object sender, EventArgs e)\n    {\n        SqlCommand cmd;\n       string UserName = txtusername.Text;\n      var Connectionstring = ConfigurationManager.ConnectionStrings[\"BookingConnectionString\"].ConnectionString;\n      SqlConnection conn = new SqlConnection(Connectionstring);\n\n       //////SqlConnection conn = new SqlConnection();\n       //////conn.ConnectionString = System.Configuration.ConfigurationSettings.AppSettings[\"BookingConnectionString\"];\n\n        string strsql = \"select * from UserInfo,UsersGroup  where UserInfo.GroupID=UsersGroup.GroupID and UserName = '\" + UserName + \"' and UserPassword='\" + txtusername.Text + \"'\";\n        cmd = new SqlCommand(strsql, conn);\n        conn.Open();\n\n        dr = cmd.ExecuteReader();\n        if (dr.HasRows)\n        {\n            dr.Read();\n            string d = dr.GetString(9).ToString();\n\n            if (d == \"Admin\")\n            {\n                AdminMainfrm adminmainfrm = new AdminMainfrm(txtusername.Text);\n                this.Hide();\n                adminmainfrm.ShowDialog();\n            }\n            else\n            {\n                UserMainfrm UserMainfrm = new UserMainfrm();\n                this.Hide();\n                UserMainfrm.ShowDialog();\n            }\n        }\n        else\n        {\n            label5.Text = \"Invalid Username or password, please try again\";\n\n        }\n        conn.Close();\n    }\n</code></pre>\n\n<p>This is my connection in app.config</p>\n\n<pre><code>&lt;add name=\"Booking.Properties.Settings.BookingConnectionString\"\n     connectionString=\"DRIVER=SQL Server;SERVER=SHARKAWY-PC;UID=sa;PWD=123456;APP=Microsoft® Windows® Operating System;WSID=SHARKAWY;DATABASE=Booking;Network=DBMSSOCN\"          \n     providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2008","outer-join"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":12818258,"title":"Multiple outer joins semantics","body":"<p>Some SQL code:</p>\n\n<pre><code>SELECT *\nFROM table1 tab1 \n   LEFT OUTER JOIN table2 tab2 ON (tab1.fg = tab2.fg)\n   LEFT OUTER JOIN table4 tab4 ON (tab1.ss = tab4.ss)\n   INNER JOIN table3 tab3 ON (tab4.xya = tab3.xya)\n   LEFT OUTER JOIN table5 tab5 ON (tab4.kk = tab5.kk)\n</code></pre>\n\n<p>I know what different types of JOINs do, but what I'd like to know is: for each JOIN, which table assumes the role of the \"LEFT\" table? Will <code>table1</code> always have the role of the \"LEFT\" table?</p>\n"},{"tags":["sql-server-2008","table-variable","self-reference"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":63,"score":0,"question_id":12810792,"title":"table variable self reference in SQL server 2008","body":"<p>I found a very strange thing in SQL server. I am not sure it is normal.</p>\n\n<pre><code>insert @table\nselect ID, Lastname\nfrom tableB\nwhere ID NOT IN ( select ID from @Table)\n</code></pre>\n\n<p>It always says 0 row inserted.\nIf I use a physical table instead of @table, it works fine.</p>\n\n<p>do I miss anything in my query?</p>\n"},{"tags":["c#",".net","sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12795172,"title":"Set TCP/IP protocol enable for SQL Server 2008 r2 in C#","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2266697/changing-sql-server-settings-programmatically\">Changing SQL Server settings programmatically</a>  </p>\n</blockquote>\n\n\n\n<p>To setup a network connection between client C# application and SQL Server 2008 R2 I know what should manually do, my problems is how to do following steps in the C# code!</p>\n\n<ol>\n<li>Set TCP/IP protocol Enabled for a server instance like <code>MSSQLSERVERR2</code>.</li>\n<li><p>Restart my SQL Server engine.</p>\n\n<p>I can do the other steps by SQL queries:</p></li>\n<li><p>Add User and grant admin permission.</p>\n\n<pre><code>CREATE LOGIN momtahen \nWITH PASSWORD = '123'\n\nEXEC master..sp_addsrvrolemember @loginame = N'momtahen', \n                                 @rolename = N'sysadmin'\n</code></pre></li>\n<li><p>Set mixed authentication mode for my SQL Server.</p>\n\n<pre><code>EXEC xp_instance_regwrite N'HKEY_LOCAL_MACHINE', \nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer', N'LoginMode', REG_DWORD, 2\n</code></pre></li>\n</ol>\n\n<p>I need C# code or SQL query that I could execute using C#.</p>\n\n<p>Also I have to mention that I have seen following question and no help yet!</p>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/9138172/enable-tcp-ip-remote-connections-to-sql-server-express-already-installed-databas\">Enable tcp\\ip remote connections to sql server express already installed database with code or script(query)</a></li>\n<li><a href=\"http://stackoverflow.com/questions/9137836/enable-remote-connections-to-sql-express-with-a-script/9154540#9154540\">Enable remote connections to sql express with a script</a></li>\n<li><a href=\"http://stackoverflow.com/questions/2499957/what-are-registry-settings-to-enable-tcp-on-sql-server-2005-and-2008\">what are registry settings to enable TCP on SQL Server 2005 and 2008?</a></li>\n</ul>\n\n<p>Thanks to them by the way. So any Idea?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","count"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":12817010,"title":"Getting content and count from SQL at same time","body":"<p>I've got 2 tables, <code>albums</code> and <code>pictures</code>...</p>\n\n<p><code>pictures</code> has relation to <code>albums</code> via <code>fk_albumID</code>.</p>\n\n<p>Now want im trying is to select all from <code>albums</code>, and at the same time count how many pictures that has relation to <code>albums</code>...</p>\n\n<p>I tried with:\n<code>SELECT *, (SELECT COUNT(*) FROM pictures WHERE pictures.fk_albumID = albums.albumID) AS albumCount FROM pictures, albums</code></p>\n\n<p>But this first of all dont return any results if theres no pictures at all...\nAnd then it repeats results according to count.\nSo if albums has 3 pictures, then i will get the album 3 times in my list, when i bind it to a Repeater.</p>\n\n<p>And i tried:\n<code>SELECT COUNT(albums.albumID) AS albumCount, albums.albumName, albums.albumID FROM albums INNER JOIN pictures ON pictures.fk_albumID = albums.albumID GROUP BY albums.albumID, albums.albuName</code></p>\n\n<p>But this only shows albums that has pictures...</p>\n"},{"tags":["c#","asp.net","xml","sql-server-2008","streamreader"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12817523,"title":"stream reader c# taking off leading 0","body":"<p>I am using stream reader (ASP.NET C# 4.0) to read an XML file. However when i am importing the data to store in my MS SQL 2008 R2 Database it is taking off the leading 0 from an amazon item ID i am using.</p>\n\n<p>For example the amazonitemid is stored in the XML file as - 00567416803507. However when it is moved to the DB via stream reader it removed the 2 0's- 567416803507 . This also happens if there is just 1 leading 0.</p>\n\n<p>I have looked around for any solutions but cant seem to find anything that is of use. Does any one know any way around this, or even why this is happening?</p>\n"},{"tags":[".net","sql","sql-server","sql-server-2008","c#-4.0"],"answer_count":1,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12816308,"title":"Do triggers have any performance impact on the stored procedure","body":"<p>I am creating a stored procedure that updates a single record. Based on that record very large number of records are recalculated and updated in another table. Currently I am using a trigger for this purpose. I just want to know if triggers have any performance issues that I should look into. Also does stored procedure returns the result after the trigger is completed or stored procedure returns result even if trigger is still running.</p>\n"},{"tags":["sql-server","sql-server-2008","full-text-search"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12816574,"title":"MS SQL Full Text Search Ranking for Multiple Words using FREETEXTTABLE","body":"<p>There are a few weird scenarios I encounter, while doing search on a particular column of a table in the database. I used FREETEXTTABLE in Sql Server 2008 R2. Note that if I search in different order of the words in the query, the results are the same. </p>\n\n<p>1) I searched for \"Widget Manager\". And it turns out that \"Widget Maker\" (1 row) gets ranked 44, the cells with \"X Manager\", \"Y Manager\", \"Z Manager\" etc gets ranked 0. Isn't \"Manager\" also hit in the other search results? Why is \"Widget\" more important?</p>\n\n<p>2) I searched for \"Widget File Manager\". And it turns out that \"Widget Maker\" (1 row) gets ranked 39, the cells with \"File Manager\" (6 rows) gets ranked 10, other \"XXX Manager\" rows get ranked 0. Why is \"Widget\" still ranked higher than \"File Manager\", 1 word gets hit instead of 2 words, the ranking is still higher?</p>\n\n<p>3) I searched for \"Widget File\". The row with \"Widget Maker\" (1 row) gets ranked 39, white the cells with \"File Manager\" (6 rows) gets ranked 10. There are no other results.\nHowever if I search for \"Widget Review\". The row with \"Review Manager\" (1 row) gets ranked 37, the row with \"Widget Maker\" (1 row) gets ranked 28. There are no other results. \nHow did \"Review\" get ranked higher than \"Widget\", and \"Widget\" gets ranked higher than \"File\"?</p>\n\n<p>I saw the formula in the <a href=\"http://msdn.microsoft.com/en-us/library/cc879245.aspx\" rel=\"nofollow\">link</a> for \"Ranking of FREETEXTTABLE\"  but I still don't understand. The formula seems to only tell me that the frequency of the words in the query and the particular property of the table matters.</p>\n\n<p>Why does the search results seem so inconsistent? Can someone explain to me? N how do I go about resolving these?</p>\n"},{"tags":["sql","sql-server-2008","reporting","snapshot","database-mirroring"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":12816568,"title":"SQL Server 2008 mirrored Database with manual failover, need reporting database","body":"<p>Our current setup is a principal database used in production with a manual failover mirrored database for HA. </p>\n\n<p>I need to setup a reporting database as well. What would be the best approach? Shall I setup a SQL job to drop and create the snapshot of the mirrored Database and refresh this every night? </p>\n\n<p>Does anyone have any other suggestions?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","winforms","sql-server-2008","connection-string"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":77,"score":0,"question_id":12816164,"title":"cannot connect sql server 2008 from another computer","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10627159/system-data-sqlclient-sqlexception-a-network-related-or-instance-specific-error\">System.Data.SqlClient.SqlException A network-related or instance-specific error</a>  </p>\n</blockquote>\n\n\n\n<p>i have winform application in c# which connect to my own db and its working fine my current sql connection string is :</p>\n\n<pre><code>SqlConnection con = new SqlConnection(\"Data Source=ITPL_PC1;Initial Catalog=Data_Project;Persist Security Info=True;user id=sa;Password=insforia\"); \n</code></pre>\n\n<p>but when i am taking this winform to another computer its not working .. then i am changing my connection string to :</p>\n\n<pre><code>SqlConnection con = new SqlConnection(\"Data Source=192.168.0.28\\\\ITPL_PC1;Initial Catalog=Data_Project;Persist Security Info=True;user id=sa;Password=insforia\"); \n</code></pre>\n\n<p>but its not working ...</p>\n\n<p>i have changed all the settings in sql server of remote access but still it showing an error</p>\n\n<pre><code>Sql Exception was unhandled \nA network-related or instance-specific error occurred while establishing a connection      to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified) \n</code></pre>\n\n<p>is my connection string is wrong? what it should be?</p>\n\n<p>pls help me out</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5215,"score":0,"question_id":5258234,"title":"SQL Server 2008 cannot connect to Database Engine","body":"<p>I don't know how to do this. I opened my SQL Server and connected using Windows Authentication at 10am. Until now, it does not go to the \"Explorer\".</p>\n\n<p>I checked the services. The SQL Server Browser is running as well as the SQL Server Service. I restarted the service, but this did not solve the problem.</p>\n\n<p>What should I do?</p>\n\n<p>Below is the screen shot of the error.\n<img src=\"http://i.stack.imgur.com/C8kyg.jpg\" alt=\"enter image description here\"></p>\n\n<p>Here's regarding the services I mentioned earlier\n<img src=\"http://i.stack.imgur.com/3KcUH.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","javascript","asp.net","sql-server-2008","iis7"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12800638,"title":"Data not loading in grid (This error is occurring inconsistently)","body":"<p>While loading data in grid in production server I found following script Error on Page left bottom corner <em>(This error is occurring only on production server, in local server its working fine)</em>\n <strong>This error is occurring inconsistently</strong></p>\n\n<p>Webpage error details</p>\n\n<p>User Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; BTRS123646; Embedded Web Browser from: <a href=\"http://bsalsa.com/\" rel=\"nofollow\">http://bsalsa.com/</a>; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; .NET4.0C; .NET4.0E)\nTimestamp: Tue, 9 Oct 2012 12:11:23 UTC</p>\n\n<p>Message: <strong>Unterminated string constant</strong>\nLine: <strong>111115201</strong>\nChar: 187\nCode: 0</p>\n\n<p>URI:   XYXZ/MYApp/MyPage.aspx</p>\n\n<p>following is the code for binding data in grid</p>\n\n<pre><code> try\n            {\n                conGetPost.ConnectionString = ConfigurationManager.ConnectionStrings[\"ConnStr\"].ConnectionString;\n                conGetPost.Open();\n                SqlCommand cmdGetPost = new SqlCommand();\n                cmdGetPost.CommandTimeout = 999999999;\n                cmdGetPost.Connection = conGetPost;\n                cmdGetPost.CommandType = CommandType.StoredProcedure;\n                cmdGetPost.CommandText = \"MySP\";\n                if (wdpfrom.Value.ToString() == \"1/1/0001 12:00:00 AM\" || wdpTo.Value.ToString() == \"1/1/0001 12:00:00 AM\")\n                {\n                    ShowMessage(\"Please select proper Date range\");\n                    wdgPost.DataSource = \"\";\n                    wdgPost.DataBind();\n                    return;\n                }\n                else\n                {\n                    cmdGetPost.Parameters.AddWithValue(\"@dateFrom\", wdpfrom.Value);\n                    cmdGetPost.Parameters.AddWithValue(\"@dateTo\", Convert.ToDateTime(wdpTo.Value.ToString()).Add(new TimeSpan(23, 59, 59)));\n                }\n                cmdGetPost.Parameters.AddWithValue(\"@ID\", ID);\n                SqlDataAdapter daGetPost = new SqlDataAdapter();\n                daGetPost.SelectCommand = cmdGetPost;\n                daGetPost.Fill(dsGetPost);\n                if (dsGetPost.Tables.Count &gt; 0)\n                {\n                    if (dsGetPost.Tables[0].Rows.Count &gt; 750)\n                    {\n                        ShowMessage(\"Maximum record found please reduce date range\");\n                        wdgPost.DataSource = \"\";\n                        wdgPost.DataBind();\n                        return;\n                    }\n                }\n                wdgPost.ClearDataSource();\n                wdgPost.DataSource = dsGetPost;\n                wdgPost.DataBind();\n                if (dsGetPost.Tables[0].Rows.Count == 0)\n                {\n                    ShowMessage(\"No records found\");\n                }\n                Session[\"dsGetPost\"] = dsGetPost;\n            }\ncatch( Exception ex)\n            {\n\n                return;\n            }\nfinally\n            {\n                if (conGetPost != null)\n                {\n                    conGetPost.Close();\n                    conGetPost = null;\n                }\n            }\n</code></pre>\n\n<p>How to know the line no in my C# code?\nHow to fix it? Please Help</p>\n"},{"tags":["sql-server-2008","entity-framework","ado.net","ef-code-first"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":134,"score":2,"question_id":12724320,"title":"Forcing code-first to always initialize a non-existent database?","body":"<p>Sometimes, I'll delete my development database and run my EF code-first application.  I'll get the error:</p>\n\n<blockquote>\n  <p>Cannot open database \"AssessmentSystem\" requested by the login. The login failed.\n  Login failed for user 'AssessmentAdmin'.</p>\n</blockquote>\n\n<p>I think this is because the <code>DbContext</code> only runs the DB initialization logic \"once per AppDomain when the context is used for the first time\", as <a href=\"http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm\" rel=\"nofollow\">this page</a> says.  This means I need to recycle the IIS application pool to get EF to recreate my database if I drop it.</p>\n\n<p>Is there any way I can get the DB initialization code to run <em>every time</em> I try to access the database?  So, it will always check to see whether the DB exists and if not, create it instead of trying to open it, even if it's using the same AppDomain that previously accessed the database that I have now dropped?</p>\n\n<p>Note that I would like this initializtion check to be done on <em>every query</em>, so even having it done in <code>Application_Start</code> isn't often enough; ideally, I'd like to be able to load some DB data, delete the DB, then load some DB data and it would recreate the DB without my even having to restart the application (basically I would just have to reload the web page that loads some DB data).</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":12815258,"title":"Get url part only in SQL Server","body":"<p>My table data is looks like:</p>\n\n<pre><code>SessionRefere  \n\nhttp://www.google.com/url?sa=t&amp;rct=j&amp;q=aaa bbb&amp;source=web&amp;cd=1&amp;cad=rja&amp;sqi=2&amp;ved=0CB4QFjAA&amp;url=http://www.abc.com/&amp;ei=QFR0UM-JKIrQrQfsuoG4CQ&amp;usg=AFQjCNExYcKkcvobBbktLGNksptf1giQRw\n-------------------------------------------------\nhttp://www.google.com/reader/view/?hl=es&amp;tab=Xq&amp;at=RTknd_lBUUnvNqan2641EA\n----------------------------------------------------\nhttp://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=5&amp;cad=rja&amp;ved=0CEgQFjAE&amp;url=http://www.abc.com/ppp.aspx&amp;ei=dmd0UOO9AYnY4QS1sYGwBw&amp;usg=AFQjCNGIFcJUUSVpl_ZiZoSWDP2LkIagtw\n</code></pre>\n\n<p>It's only sample data.There are many cases like this. So I want original url part before count.</p>\n\n<p>I use this query to get data.</p>\n\n<pre><code>DECLARE @temp table(RefPage nvarchar(200))\ninsert into @temp\nSELECT\n   CASE CHARINDEX( '?', SessionReferer)\n       WHEN 0 THEN SessionReferer\n       ELSE LEFT(SessionReferer, CHARINDEX( '?', SessionReferer) - 1) END AS RefPage \nFROM Tracker WHERE [start] between '1-1-2010' and '1-1-2015' and  SessionReferer&lt;&gt; ''\n\n select distinct RefPage, count(*) as [VisitTime] from @temp\n  group by RefPage\norder by [VisitTime] desc\n</code></pre>\n\n<p>and my result is:</p>\n\n<pre><code>SessionRefere                           VisitTime\nhttp://www.google.com/url                 2\nhttp://www.google.com/reader/view/        1 \n</code></pre>\n\n<p>But I want a result:</p>\n\n<pre><code>SessionRefere                           VisitTime\nhttp://www.google.com                      3\n</code></pre>\n\n<p>Is it possible to get desire result or I am in wrong way? Thanks.</p>\n"},{"tags":["sql-server-2008","permissions","visual-studio-lightswitch"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12753654,"title":"New LightSwitch Project","body":"<p>I have started a new Lightswitch project using a SQL database that was created with Lightswitch.  When I publish and install the new Desktop project everything goes fine with no errors in publishing, installing or loading the new application. The first and only screen appears. I can click on different records and the data shows up and I can edit the data.  However, if I use the list search function all of the fields get Red x'd.<br>\nThe original application works the way it supposed to work.\nI have tried with and without IIS: Published with (local) and (IIS) and get the same results with both methods.\nThe connecection string options for the new app are not the same as the original in that System Admin and Sytem user connecection strings are not offered so it is difficult to know if I replicating a working setup or not.\nIn Mananagement Studio I am awash in security, permissions, roles, and login selecitons.  It seems clear that this is permission level problem but I have no idea on where to start trouble shooting.  </p>\n"},{"tags":["sql-server-2008","db2","linked-server"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12786654,"title":"Does not support the required transaction interface","body":"<p>I have created a Linked Server between Sql Server 2008 R2 and DB2.</p>\n\n<p>I can do selects and updates from the Query Windows, but if I try to wrap my updated in a BEGIN TRANSACTION - COMMIT TRANSACTION I get the following error:</p>\n\n<p><strong>The requested operation could not be performed because OLE DB provider \"DB2OLEDB\" for linked server \"DB2\" does not support the required transaction interface.</strong></p>\n\n<p>\"DB2\" is the name of my Linked Server.</p>\n\n<p>I have tried both using four-part names, e.g.</p>\n\n<pre><code>UPDATE [DB2].[TEST].[TEST].[TEST]\nSET [COL2] = 2\nWHERE [COL1] = 1\n</code></pre>\n\n<p>and using OPENQUERY, e.g.</p>\n\n<pre><code>UPDATE OPENQUERY (DB2, 'SELECT [COL2] FROM TEST.TEST WHERE [COL1]=1)\nSET [COL2]=2\n</code></pre>\n\n<p>If I just execute the statements it works fine. If I wrap them in a transaction it does not.</p>\n\n<p>Any help would be appreciated.</p>\n"},{"tags":["sql","sql-server-2008","tsql","sqlgeography"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":12810624,"title":"sql server union on geography columns","body":"<p>I'm using sql server 2008 R2, and I have two tables, Regions and Facilities.  Both have a column containing a geography element.</p>\n\n<p>I want to calculate the union on the intersection of the geograpy elements, like this:</p>\n\n<pre><code>SELECT * from Regions join Facilities on [Regions].[geography].STIntersects([Facilities].[geography])\n</code></pre>\n\n<p>which of course doesn't work.  The regions are large polygons, and the facilities are points each of which is contained in only one polygon.</p>\n\n<p>I can write some kind of (pseudocode)</p>\n\n<pre><code>for each r in Regions:\n    for each f in Facilities:\n        if f.[geography].STIntersects(r.[geography]):\n            print r, f\n</code></pre>\n\n<p>but the whole point of using a database is to operate on the set not the elements, surely?</p>\n\n<p>So, is there a better way to do this?</p>\n\n<p>thanks\nMelanie</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12812377,"title":"SQL Server 2008 R2 Invalid object name error","body":"<p>Here's the stored procedure I'm trying to implement:</p>\n\n<pre><code>    Alter PROCEDURE pro_worst_supplier_test \n@datey nvarchar(4), @datem nvarchar(2)\n   AS\n   BEGIN\n-- SET NOCOUNT ON added to prevent extra result sets from\n-- interfering with SELECT statements.\nSET NOCOUNT ON;\n-- Insert statements for procedure here\n\nselect y.CompanyName from (SELECT s.CompanyName,(select min(t.b) from (select (round(sum(OD.Quantity * (1-OD.Discount) * OD.UnitPrice),0)) as b from [Order Details] group by ProductID) t) as q\nFROM ((((Products p \ninner join [Order Details] OD on p.ProductID=OD.ProductID) \ninner join Categories c on p.CategoryID=c.CategoryID) \ninner join Suppliers s on p.SupplierID=s.SupplierID)\ninner join Orders o on o.OrderID=od.OrderID)\nwhere c.CategoryName='Produce' AND SUBSTRING(CONVERT(nvarchar(22), o.OrderDate, 111),1,4)=@datey AND SUBSTRING(CONVERT(nvarchar(22),o.OrderDate, 111),6,2)=@datem\ngroup by s.CompanyName) y\nwhere q=(select MIN(q)from y) \nEND \nGO\n</code></pre>\n\n<p>When I tried to execute it by</p>\n\n<pre><code>exec proc_worst_supplier_test '1998','04'\n</code></pre>\n\n<p>I got an error </p>\n\n<blockquote>\n  <p><em>Invalid object name 'y'</em></p>\n</blockquote>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","combinations"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":3,"view_count":88,"score":-2,"question_id":12789668,"title":"most rewards and highest value for purchased products","body":"<p>Given:</p>\n\n<pre><code>purchased\nproduct, qty\n----------\nstrawberry,1\nbanana,3\n\n\nreward_requirements (related to a rewards table)\nreward_id, product, qty, value\n------------------------------------\n1, strawberry, 1, 20\n3, banana, 1, 60\n3, strawberry, 1, 60\n4, banana, 3, 50\n\npossible outcome 1\nreward_id, product, qty, value\n--------------------------------\n1, strawberry, 1, 20\n4, banana, 3, 50\n\npossible outcome 2\nreward_id, product, qty, value\n-----------------------\n3, banana, 1, 60\n3, strawberry, 1, 60\n\n!notice outcome 2 is a single reward id so value only 60 (not 120)   \n\nOutcome 1 is the desired output because it gives highest value with 70.\n</code></pre>\n\n<p>Can you help me with this sql or c# to get the most rewards with highest value? Maybe, this sounds like homework, so how about just walking me thru it in plain English.</p>\n\n<p>Business rule</p>\n\n<p>Purchased products can be used only once toward reward.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12799824,"title":"How to get table name, column name, column describe, column value in SQL SERVER 2008","body":"<p>I have a table called Users:</p>\n\n<pre><code>UserID  UserName  UserPwd\n  1      zhang     123456\n  2      li        455667\n  3      wang      332222\n</code></pre>\n\n<p>I would like to get the result like below(UserID='1'):</p>\n\n<pre><code>tableName   columnName   columnDescribe      columnValue\n  Users       UserName     The user name         zhang\n  Users       UserPwd      The user password     123456\n</code></pre>\n\n<p>Can anyone help me out?</p>\n\n<pre><code>SELECT t.name AS [tableName],\n   c.name AS [columnName],\n   cd.value AS [columnDescribe]\nFROM  sysobjects t\nINNER JOIN sysusers u\n ON  u.uid = t.uid\nLEFT OUTER JOIN sys.extended_properties td\n ON  td.major_id = t.id\n    AND  td.minor_id = 0\n AND  td.name = 'MS_Description'\nINNER JOIN syscolumns c\n ON  c.id = t.id\nLEFT OUTER JOIN sys.extended_properties cd\n ON  cd.major_id = c.id\n AND  cd.minor_id = c.colid\n AND  cd.name = 'MS_Description'\nWHERE t.type = 'u' AND t.name='Users'\nORDER BY t.name, c.colorder\n</code></pre>\n"},{"tags":["sql","xml","sql-server-2008","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12807537,"title":"How to get xml from many records?","body":"<p>So I have the below that will allow me to get xml from one record in the <code>Products</code> table.</p>\n\n<p>However, I need to to be able to get the XML from ALL records in the <code>Products</code> table, along with its <code>ProductId</code>.</p>\n\n<p>I'm confused on how to start this.</p>\n\n<pre><code>DECLARE @MyXML XML\nSET @MyXML =\n    (SELECT ProductsXML\n     FROM Products\n     WHERE ProductId= 1)\nSELECT \n    a.b.value('@upccode','int') as UPC,\n    a.b.value('@dateadded','date') as DateAdded\nFROM\n    @MyXML.nodes('xml/Product/UPC')a(b);\n</code></pre>\n\n<p>I'm using SQL Server 2008.</p>\n\n<p>Test Data:</p>\n\n<pre><code>ProductId: 1\nProductsXML:\n&lt;xml&gt;\n        &lt;Product&gt;\n            &lt;UPC upccode=\"1237\" dateadded=\"10/9/2012\"/&gt;\n            &lt;UPC upccode=\"1236\" dateadded=\"10/8/2012\"/&gt;\n            &lt;UPC upccode=\"1235\" dateadded=\"10/7/2012\"/&gt;\n            &lt;UPC upccode=\"1234\" dateadded=\"10/6/2012\"/&gt;\n        &lt;/Product&gt;\n    &lt;/xml&gt;\n\nProductId: 2\nProductsXML:\n&lt;xml&gt;\n        &lt;Product&gt;\n            &lt;UPC upccode=\"9876\" dateadded=\"9/9/2012\"/&gt;\n            &lt;UPC upccode=\"9877\" dateadded=\"9/8/2012\"/&gt;\n            &lt;UPC upccode=\"0998\" dateadded=\"9/7/2012\"/&gt;\n            &lt;UPC upccode=\"7877\" dateadded=\"9/6/2012\"/&gt;\n        &lt;/Product&gt;\n    &lt;/xml&gt;\n</code></pre>\n\n<p>The Result I'm looking for is something like this:</p>\n\n<pre><code>ProductId      UPC        DateAdded\n---------      ---        ---------\n1              1237       10/9/2012\n1              1236       10/8/2012\n....\n2              9876       9/9/2012\n2              9877       9/8/2012\n</code></pre>\n\n<p>Right now I can get the above but ONLY by specifying one <code>PoductId</code> at a time. I want to be able to run all of the `Products' without specifying each entry.</p>\n"},{"tags":["sql-server","sql-server-2008","gis","geospatial"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12809201,"title":"Storing 'Point' column from ShapeFile","body":"<p>I have a Shapefile (*.shp) which I am loading into the Database. I have a column called \"Point\" which stores the Data in shapes. For example </p>\n\n<p>POLYGON ((1543297.7815 5169880.9468, 1543236.7046 5169848.3834, 1543195.0218 5169930.2767, 1543104.4989 5170101.6818, 1543056.805 5170191.9835, 1542969.1187 5170358.1396, 1542820.9656 5170638.8525, 1542820.6605 5170639.7223, 1542816.1912 5170647.8707, 1543158.2618 5170829.6437, 1543318.4126 5170915.6562, 1543559.2078 5171043.8001, 1543840.2014 5171192.4698, 1544108.917 5171336.1306, 1544271.7972 5171422.313, 1544357.0262 5171263.5454, 1544447.9779 5171091.3804, 1544468.04 5171054.3179, 1544529.7931 5170936.192, 1544583.3416 5170837.5321, 1544658.3376 5170696.5608, 1544699.0638 5170622.0859, 1543985.6169 5170245.4526, 1543618.4129 5170050.7422, 1543297.7815 5169880.9468))</p>\n\n<p>The data type of the Column \"Point\" is nvarchar(max). Now the problem is when the size of Polygon exceeds , the column truncates and does not store all the values. I can't convert Points into Geometry as I want to convert Points into Lat/long from Polygon.</p>\n\n<p>Help Please!</p>\n"},{"tags":["sql-server-2008","tfs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12810886,"title":"TFS Setup, Report permission","body":"<p>I have created myself as an user on ths server, part of the Administrators group.\nAdded myself to TFS, Under 'Global Security' as an all powereful user.\nAnd within SQL Server, I have my login un in Logins, role of SysAdmin, and my login is mapped to ReportServer database (And ReportServerTempDB).</p>\n\n<p>When I connect to the ReportServer database with my login, I seem to have permissions to look at tables. and muck about.</p>\n\n<p>I am able to connect to the TFS server from my development PC. I then try to 'Create a New Team Project..'.</p>\n\n<p>I enter a name of my project (\"A Test Project\"), and next, nect next, and Finish... and I get an error:</p>\n\n<blockquote>\n  <p>TFS218027: The following reporting folder could not be created on the\n  server that is running SQL Server Reporting Service:\n  /TfsReports/ATestProject. The report server is located at\n  <code>http://servername/Reports</code>. The error is: Permission granted to user\n  ServerName\\CraigL are insufficent for performing this operation.\n  Verify that the path is correct and that you have the sufficient\n  permissions to create a folder on that server, and try again</p>\n</blockquote>\n\n<p>Any idea what I am missing?</p>\n"},{"tags":["ruby-on-rails","ruby","sql-server-2008","sqlite3"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":35,"score":3,"question_id":12809620,"title":"Rails App for Support Team With Two Databases","body":"<p>I've looked at some answers on SO and looked up some documentation but most of what I've found is geared towards querying multiple databases with similar data (i.e. replicated dbs or different clients...)</p>\n\n<p>I have a very specific thing I'm trying to accomplish:</p>\n\n<p>I have a support team that needs to monitor the results of some queries against a SQL Server db (for example, if there are > than three rows panic!). Unfortunately I'm not going to be able to use the same server for authentication (which they want) and was thinking of just using sqlite. Anyone ever implemented something similar with any success?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12807881,"title":"Compare values from 2 tables based on Dates from one of the 2 tables?","body":"<p>I have 2 tables that have similar data and I need to compare the values of one table with the other where the dates are equal.</p>\n\n<p>Example tables:</p>\n\n<pre><code>CREATE TABLE [data].[ProfileReconciliation] (\n[ProfileName] varchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL ,\n[OriginalFeedDate] datetime NOT NULL ,\n[AggregationDate] datetime NOT NULL ,\n[TotalDescription] varchar(200) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL ,\n[TotalSalesAmount] decimal(18,2) NOT NULL ,\n[LoadKey] int NULL \n)\nON [DATA]\nGO\n\nCREATE TABLE [data].[Aggregation] (\n[ColumnName] varchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL ,\n[dataDate] date,\n[profileDate] datetime  ,\n[aggregationType] varchar(200) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL ,\n[dataValue] decimal(18,2) NOT NULL ,\n\n)\nON [DATA]\nGO\n</code></pre>\n\n<p>So, the <code>dataValue</code> in the <code>Aggregation</code> table needs to be compared to the <code>TotalSalesAmount</code> in the <code>ProfileReconciliation</code> table. The <code>dataDate</code> in the <code>Aggregation</code> table matches up with the <code>AggregationDate</code> in the <code>ProfileReconciliation</code> table.  The ProfileReconciliation table only contains data from a daily feed, so we only need to compare the dates that are in the ProfileReconciliation with the Aggregation table. I need to indicate weather the values of each table are equal and if not I need to show a flag indicating so. I started by selecting the data from the Aggregation table where the dataDate was in AggregationDate. I obviously have to cast the AggregationDate. I just have no clue where to head next or what the best approach to this is.</p>\n\n<p>Example Data:\n From ProfileReconciliation table</p>\n\n<pre><code>OPDCost 2012-10-08 17:43:51.000 2012-10-07 00:00:00.000 SUM(Total_Net_Cost_Amt) 21323923.00 5307\n\nOPDS    2012-10-08 17:43:51.000 2012-10-07 00:00:00.000 SUM(Total_Net_Sales_Amt)    70753228.00 5307\n</code></pre>\n\n<p>From Aggregation table:</p>\n\n<pre><code>SPVData.fact.DayStoreProdCost   2012-10-07  2012-10-09 09:06:20.9167944     20970788.131400 \nSPVData.fact.DayStoreProdExtra   2012-10-07     2012-10-09 09:03:19.1558724     70642458.910000 \n</code></pre>\n\n<p>So as you can see the amounts do not match up so we wwould want teh results to look like this:</p>\n\n<pre><code>**ProfileName  Date                      ProfileAmount AggregationAmount   Equal**\nOPDCost      2012-10-07 00:00:00.000   21323923.00   20970788.13         0\nOPDS         2012-10-07 00:00:00.000   70753228.00   70642458.91         0\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":48,"score":2,"question_id":12807514,"title":"SQL Server extra text after table name in SELECT","body":"<p>I found a SQL statement to the effect of:</p>\n\n<pre><code>SELECT * FROM Users x\n</code></pre>\n\n<p>My question is: what is <code>x</code>? I have never seen this before.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12807378,"title":"Create Computed column by using the data from other tables' columns","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2769007/formula-for-computed-column-based-on-different-tables-column\">formula for computed column based on different table&#39;s column</a>  </p>\n</blockquote>\n\n\n\n<p>How can I create a computed column by gathering the data from other tables' columns data for example I have \"Amount\" column and I have to collect it's necessary data from 2 other tables  <b> \"Orderrouter</b>.colorquantity\"  and \"<b> OrderItem</b>.ItemPrice\" ? </p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12807021,"title":"sql sort with default value always on top","body":"<p>i want to sort a column INITIALS that stores initials of people. The default value for the column is \"N/A\". After the sort all the rows with the default value should be display first and then the rest should be sorted. so if i have something like ..</p>\n\n<p>AB\nZY\nEG\nUI\nFE\nEE\nN/A\nUY\nN/A\nYX</p>\n\n<p>after the sort it should be</p>\n\n<p>N/A\nN/A\nAB\n.\n.\nZY</p>\n\n<p>the simple sort will display the all the \"N/A\"s in the middle. how would i achieve this? thanks</p>\n"},{"tags":["sql","sql-server-2008","replace"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12806975,"title":"SQL Replace used during a compare","body":"<p>I currently run this query:</p>\n\n<pre><code>UPDATE table1 \nSET column1 = table2.columnA  \nFROM table2\nWHERE column2 = table2.columnA\nAND column3 = table2.columnC\n</code></pre>\n\n<p>Yes there is a duplicate column, sorry.</p>\n\n<p>When I cross reference <code>column2</code> with  <code>table2.columnA</code> there is a chance to get <code>NULL</code> because <code>column2</code> <strong>DOES NOT</strong> contain <code>/</code> where as <code>table2.columnA</code> <strong>may</strong> contain <code>/</code> </p>\n\n<p>I don't want to change the data in <code>table2.columnA</code> </p>\n\n<p>It is my understanding that I can run this query to <code>REPLACE</code> the characters.</p>\n\n<pre><code>SELECT REPLACE ([table2.columnA],'/','-')\nFROM table2\n</code></pre>\n\n<p>It is necessary that this does not make a permanent change to  <code>table2</code> so I want to make sure that I am getting this right or to see if there is a better way. </p>\n\n<p>Now I want to combine the two queries but am unsure how.</p>\n\n<pre><code>UPDATE table1 \nSET column1 = table2.columnA  \nFROM table2\nWHERE column2 = (SELECT REPLACE([table2.columnA],'/','-')table2.columnA)\nFROM table2\nAND column3 = table2.columnC\n</code></pre>\n\n<p>Thanks for the help!</p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12806462,"title":"Upgrade RDLC from 2008 to 2010 (2005 report to 2008 report) Error","body":"<p>I have multiple reports that have been created over the years and anytime a RDLC file is opened in the VS2010, it is asking for an upgrade. I have seen many posts about changing the .config file, but these files are not using config files since they are application based. I have Microsoft.ReportViewer.Winforms, .Common, .ProcessingObjectModel and, .WebForms 9.0 and 8.0 installed on the lab machine. </p>\n\n<p>After upgrading a report and trying to run it on the lab machine ( ms server 2008) I am returned an error of: \"The report definition has an invalid target namespace 'http://schemas.microsoft.com/sqlserver/reporting/2008/01/reportdefinition' which cannot be upgraded. </p>\n\n<p>Does Report Viewer 2010 Redistributable Package fix this issue? I cannot find a distinct answer. If not, is there another workaround without changing server modes from local to server? </p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12806361,"title":"temporal data fix","body":"<p>We messed up on application side and loaded some incorrect data in one column.. Now we need to fix this data.. Here is what we need to do.</p>\n\n<pre><code>Starttime                      Answertime\n\n2012-08-30 00:40:40.000      2012-08-30 03:40:53.000\n</code></pre>\n\n<p>Answertime is almost 3 hour more than starttime which is incorrect. Now what we need to is find the difference of <b>seconds</b> between answertime and startime and add it to starttime. So for above 2012-08-30 <b>00:40:53.000</b> will be new answertime.</p>\n\n<p>Kind of confused at the moment on how to do it. Using sql server 2008 R2</p>\n"},{"tags":["sql","xml","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12805295,"title":"How to get XML attributes from XML with an unknown number of rows","body":"<p>I have the following query that allows me to get xml data from ONE row of xml from a specified column.</p>\n\n<p>However, Product can have 1 UPC child, or a lot.</p>\n\n<p>How can I alter my query to return all the existing children of Product?</p>\n\n<pre><code>DECLARE @MyXML XML\nSET @MyXML =\n    (SELECT ProductsXML\n     FROM Products\n     WHERE ProductId= 1)\nSELECT \n    a.b.value('Product[1]/UPC[1]/@upccode','DATE') as UPC,\n    a.b.value('Product[1]/UPC[1]/@dateadded','DATE') as DateAdded\n    FROM @MyXML.nodes('xml')a(b) \n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":511,"score":2,"question_id":1672179,"title":"SQL Server: How to extract comments from stored procedures for deployment","body":"<p>We have lots of stored procedures which all contain a lot of comments.<br />\nIs there a way to extract the comments from the stored procedures for deployment so the users can't see them when they modify a stored procedure with SQL Server Management Studio?</p>\n\n<p>Note: We're using SQL Server 2008.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":301,"score":0,"question_id":11531136,"title":"How to convert database table structure to XML file in sql server?","body":"<p>How will I convert table Schema to XML format? Format is given below.</p>\n\n<pre><code>&lt;Tables&gt;\n  &lt;Table&gt;\n    &lt;Name&gt;courses&lt;/Name&gt;\n    &lt;Schema&gt;dbo&lt;/Schema&gt;\n    &lt;Columns&gt;\n      &lt;Column&gt;\n        &lt;Name&gt;id&lt;/Name&gt;\n        &lt;DataType&gt;int&lt;/DataType&gt;\n     &lt;/Column&gt;\n     &lt;Column&gt;\n       &lt;Name&gt;page_name&lt;/Name&gt;\n       &lt;DataType&gt;nvarchar&lt;/DataType&gt;\n       &lt;Length&gt;50&lt;/Length&gt;\n     &lt;/Column&gt;\n    &lt;/Columns&gt;\n  &lt;/Table&gt;\n  &lt;Table&gt;\n    &lt;Name&gt;course_details&lt;/Name&gt;\n    &lt;Schema&gt;dbo&lt;/Schema&gt;\n    .....\n    .....\n  &lt;/Table&gt;\n&lt;/Tables&gt;\n</code></pre>\n\n<p>I am able to generate the structure for columns and tables separately. But I want to consolidated both. How is it possible?\nMy SQL scripts</p>\n\n<p><strong>For Tables:</strong></p>\n\n<pre><code>SELECT\nDistinct\nTABLE_NAME as Name,\nTABLE_SCHEMA as [Schema]\nFROM INFORMATION_SCHEMA.TABLES\nWHERE TABLE_SCHEMA='dbo'\nORDER BY TABLE_NAME ASC\nFor XML PATH ('Table'),\nRoot('Tables')\n</code></pre>\n\n<p><strong>For Columns:</strong></p>\n\n<pre><code>SELECT\nColumn_Name as Name,\nDATA_TYPE as DataType,\nCHARACTER_MAXIMUM_LENGTH as [Length]\nFROM INFORMATION_SCHEMA.COLUMNS\nFor XML PATH ('Column'),\nRoot('Columns')\n</code></pre>\n"},{"tags":["sql-server-2008","database-backups","database-restore","transaction-log"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12804533,"title":"Restore all Sql server transaction log but one query?","body":"<p>Is there any way to restore an entire Transaction Log but one query?</p>\n\n<p>for example a delete query, or update query, that you accidentally execute?</p>\n\n<p>Cause i know its is posible, to restore to a certain time, but what if the evil query affected only one table, and you dont want to loose the changes in the other tables?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","service-broker"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12787546,"title":"Looking for a Service Broker tutorial--- multiple clients and one target","body":"<p>I need to implement a solution where 150 restaurants send order \"ticket\" information to the corporate server. Does anyone know of a good tutorial for this? I've been through the MS tutorial with one client and one target server. </p>\n\n<p>Some questions I'll be looking at:</p>\n\n<p>1) Can the contract and message types be the same for every client?<br>\n2) Does the server require a different certificate from each client?<br>\n3) Do the client's use the same target (corporate) certificate.<br>\n4) Is there only one endpoint for each machine client or server.<br></p>\n\n<p>Thanks,</p>\n\n<p>SMadirondack</p>\n"},{"tags":["sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12784211,"title":"Move SQL Server database modification between development and live database without data","body":"<p>I am working with SQL Server and I have two databases - one for development and another one for a live users.</p>\n\n<p>I want a way to move the changes (create new tables, SP, functions, modifications, relations, indexes) from development database to a live database automatically</p>\n\n<p>now I am copy the script for each element and execute it on the live database</p>\n"},{"tags":["sql-server","sql-server-2008","ms-access","ms-access-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12802303,"title":"How can I see non-standard characters in MS Access (Stored in SQL Server) correctly","body":"<p>I currently store my string fields in SQL Server as <code>varchar(x)</code>.  The Database stores records from across the globe, but non standard characters, such as 'glyphics from Asia or Cyrillic Script/Azbuka from Russia appear as '?????????????' question marks.</p>\n\n<p>How can I prevent this from happening and what are the ramifications of changing SQL Server to handle such input.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","text","nvarchar"],"answer_count":6,"favorite_count":5,"up_vote_count":42,"down_vote_count":0,"view_count":12576,"score":42,"question_id":2133946,"title":"nvarchar(max) vs NText","body":"<p>What are the advantages and disadvantages of using the <code>nvarchar(max)</code> vs. <code>NText</code> data types in SQL Server? I don't need backward compatibility, so it is fine that <code>nvarchar(max)</code> isn't supported in older SQL Server releases.</p>\n\n<p><strong>Edit:</strong> Apparently the question also applies to <code>TEXT</code> and <code>IMAGE</code> vs. <code>varchar(max)</code> and <code>varbinary(max)</code>, for those searching for those data-types later.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server-2005","tsql","sql-server-2008","format"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2511,"score":3,"question_id":6469683,"title":"Format() function doesn't work?","body":"<p>I am trying to execute following built-in function in sql but it gives me error that this  function doesn't exist </p>\n\n<p>my query:</p>\n\n<pre><code>select EmpId, EmpName, format(EmpJoinDate, \"YYYY-DD-MM\") as date from Employee\n</code></pre>\n\n<p>Error i am getting:</p>\n\n<pre><code>'format' is not a recognized built-in function name\n</code></pre>\n\n<p>What may be  the problem, or what am i doing wrong? </p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12800824,"title":"SQL store dynamic data","body":"<p>I have a table, which links to another table specifying the the value of a  key-value pair. The Value table then links to a table holding the name (key). The tables are defined (near enough) as follows:</p>\n\n<pre><code>---------------\nEntity\n---------------\nEntityID\nName\nSome other data\n\n---------------\nValue\n----------------\nValueID\nEntityID\nValue\n\n---------------\nKey\n---------------\nKeyID\nValueID\nName\n</code></pre>\n\n<p>Each Entity can have many Values and each Value has one Key. Each Entity may not have the same number of Values. Basically, this structure is allowing me to add table rows dynamically, without modifying the Entity table. </p>\n\n<p>I want to  do a select * on the Entity table, using the Key.Name field as a column header, and displaying the appropriate Value.Values</p>\n\n<p>Is there a dynamic structure available in SQL that I can do an insert into for each row in Entity, then return a select on?</p>\n\n<p>I hope this makes sense!</p>\n"},{"tags":["sql-server","sql-server-2008","row-level-security"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":888,"score":4,"question_id":7942301,"title":"Implementing Row Level Security in SQL Server 2008","body":"<p>Is there a built-in feature, or way to simulate RLS(Row Level Security) in SQL Server 2008 as found in Oracle? </p>\n"},{"tags":["sql-server-2008","reporting-services","report","rdl"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12636873,"title":"SSRS - How to autorefresh to the next page multiple pages report","body":"<p>I have a SSRS report that has 4 pages. I want it to refresh to the next page every x seconds. When it reaches last page, then report should loop back to the first page.</p>\n\n<p>I have sql server 2008</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":98,"score":2,"question_id":12797963,"title":"Left Join is not working","body":"<p>I wrote following query </p>\n\n<pre><code>SELECT \n   us.Id as Id, us.Name as Name,\n   SUM(CASE WHEN c.isPublish = 0 THEN 1 ELSE 0 END) AS PendingCoupons,\n   SUM(CASE WHEN c.isPublish = 1 and convert(date,c.PublishedDate,101) &gt;=  convert(date, GETDATE(), 101) THEN 1 ELSE 0 END) AS ApprovedCouponsToday,\n   SUM(CASE WHEN c.isPublish = 0 and convert(date,c. CreateDate, 101) = convert(date, GETDATE(), 101) THEN 1 ELSE 0 END) AS PendingCouponsToday,\n   SUM(CASE WHEN c.isPublish = 1 THEN 1 ELSE 0 END) AS ApprovedCoupons,\n   SUM(CASE WHEN c.isPublish = 1 and c.Userid = us.Id and convert(date, c.PublishedDate, 101) &gt;= convert(date, GETDATE(), 101) THEN 1 ELSE 0 END) AS ApprovedByUserToday,\n   SUM(CASE WHEN c.isPublish = 1 and c.Userid = us.Id THEN 1 ELSE 0 END) AS ApprovedByUser,\n   SUM(CASE WHEN c.ReviewVerify = 1 and convert(date, c.PublishedDate, 101) &gt;= convert(date, GETDATE(), 101) THEN 1 ELSE 0 END) AS ProcessToday,\n   COUNT(*) AS Total\nFROM \n   Users AS us\nLEFT JOIN \n   Coupon c ON Userid = us.Id\nGROUP BY \n   us.Name , us.Id\n</code></pre>\n\n<p>and I have following two tables </p>\n\n<p><img src=\"http://i.stack.imgur.com/tWZdT.png\" alt=\"Tables\"></p>\n\n<p>and after running above query the result is always this </p>\n\n<p><img src=\"http://i.stack.imgur.com/ZpCAR.png\" alt=\"Result\"></p>\n\n<p>Is there any error in this query , because its always returning me count \" 0 \"  and I have almost 100 coupons on every user but its not showing </p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12799485,"title":"SQL Server : CREATE SEQUENCE - unknown object type","body":"<p>I encounter a problem with the following part of a query:</p>\n\n<pre><code>IF EXISTS (SELECT * FROM sys.sequences seq JOIN sys.schemas sch ON seq.schema_id=sch.schema_id WHERE seq.name=N'LID'  AND sch.name=N'dbo' )\n   DROP SEQUENCE [dbo].[LID]\nGO\n</code></pre>\n\n<p>It keeps telling me, that <code>sys.sequences</code> is an unknown object name and <code>seq.schema_id</code> cannot be resolved.</p>\n\n<p>I run SQL Server Express 2008 R2.</p>\n\n<p>How do I Fix this?</p>\n"},{"tags":["database","sql-server-2008","database-design","join","relational-database"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12799197,"title":"Find efficient way of joining tables","body":"<p>Here is the problem:\nWe have 3 tables (MS SQL 2008 R2):</p>\n\n<p>Table 1 FILMS (table with films)</p>\n\n<p>Table 2 Songs (table with songs)</p>\n\n<p>Table 3 Titles</p>\n\n<p>Since “Films” and “Songs” can contain more than one title (I have many titles on different languages), I want to keep all of the titles in the separate table “Titles”. Primary keys in tables Films and Songs are based on [int] identity specification with increment +1. </p>\n\n<p>So for example: we can have a film and song with ID=3.</p>\n\n<p>How can I join table “Titles” with “Films” and “Songs”?</p>\n\n<p>P.S. I tried to create unique keys by adding a new column [idKey] with formula to FILMS an SONGS</p>\n\n<p>for Films it was <code>(CONVERT([nvarchar](10),[ID],(0))+'f')</code></p>\n\n<p>for Songs it was <code>(CONVERT([nvarchar](10),[ID],(0))+'s')</code></p>\n\n<p>where [ID] is their identity specification\nBut I wasn’t able to mark this column as a primary key</p>\n"},{"tags":["sql","sql-server-2008","view","pivot-table"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12798421,"title":"SQL Server View Incorrect syntax","body":"<p>i have the following DB:</p>\n\n<p><img src=\"http://i.stack.imgur.com/u3MOC.png\" alt=\"My DB\"></p>\n\n<p>I want to create view that give this information in a row:   </p>\n\n<pre><code>document_id    Creator    Manager    Special    Archive  \n</code></pre>\n\n<p>(Creator,Manager,Special,Archive)  are AuthorityName values</p>\n\n<p>So fisrt i created a view:  </p>\n\n<pre><code>SELECT     dbo.DocumentAuthorities.DocumentId, dbo.DocumentAuthorities.AuthorityId,   dbo.Authorities.AuthorityName, dbo.Authorities.AuthorityLevel\nFROM         dbo.DocumentAuthorities CROSS JOIN\n                          dbo.Authorities\n</code></pre>\n\n<p>then i tried this:  </p>\n\n<pre><code> SELECT * FROM \n    (\n    SELECT Documents.Id, AuthorityName.AuthorityId, AuthorityName.AuthorityName\n    FROM AuthorityName CROSS JOIN Documents\n     ) src \n     PIVOT\n     ( \n        max(dbo.AuthorityName.AuthorityName) \n        FOR AuthorityName \n        IN ([Creator],[Director],[Special],[Archive])\n      )\n</code></pre>\n\n<p>but i get this error: </p>\n\n<blockquote>\n  <p>Msg 102, Level 15, State 1, Line 11 Incorrect syntax near ')'.</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2008","hierarchy"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":12796667,"title":"Return unique combinations from many to many join","body":"<p>I have a hierarchy table with the following data :</p>\n\n<pre><code>SOURCE  TARGET  Level   ID\n0       1       1       1\n0       2       1       2\n2       3       2       3\n2       4       2       4\n2       5       2       5\n1       3       2       6\n1       4       2       7\n1       5       2       8\n5       3       3       9\n5       3       3       10\n4       3       3       11\n4       3       3       12\n3       6       3       13\n3       6       3       14\n3       6       4       15\n3       6       4       16\n3       6       4       17\n3       6       4       18\n</code></pre>\n\n<p>The SOURCE and TARGET rows are the original data and are used to connect between parents and children. for example, the third row (SOURCE 2, TARGET 3 on LEVEL 2) connects to the second row (SOURCE 0, TARGET 2 on LEVEL 1) since the Source of the first equals the target of the second. <br>\nThe ID column is added at the end using a ROW_NUMBER function and is used to give each row a unique ID.<br>\nIt may be easier to understand if SOURCE is replaced with PARENT and TARGET with CHILD.</p>\n\n<p>I join the table to itself in order to find the \"parent\". <br>\nI want each \"instance\" of a \"source\" on each level to connect to one of its parents. It's not important which ones connect but all need to be connected and to <strong>different</strong> parents.</p>\n\n<p>The final results should look something like this:</p>\n\n<pre><code>SOURCE  TARGET  Level   ID   P_ID\n0       1       1       1    NULL\n0       2       1       2    NULL\n2       3       2       3    2\n2       4       2       4    2\n2       5       2       5    2\n1       3       2       6    1\n1       4       2       7    1\n1       5       2       8    1\n5       3       3       9    5\n5       3       3       10   8\n4       3       3       11   4\n4       3       3       12   7\n3       6       3       13   3\n3       6       3       14   6\n3       6       4       15   9\n3       6       4       16   10\n3       6       4       17   11\n3       6       4       18   12\n</code></pre>\n\n<p>Any suggestions on how to write a good ms-sql query for this?</p>\n"},{"tags":["sql-server-2008","remote-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12796877,"title":"Copy new records from datatable and identify changes in old records","body":"<p>Assume there are two tables: <code>Remote_table</code> and <code>My_table</code>.</p>\n\n<p><code>Remote_table</code> has 6 columns:</p>\n\n<pre><code>PROJECT   JOB_TYPE   MONTH  YEAR**       HOURS     IS_DELETED\n134393     70         1       2013      30     0\n134393     70         2       2013      50     0\n134393     70         3       2013      80     0\n134393     70         10      2012      10     0\n134393     70         11      2012      0      0\n134393     70         12      2012      15     0\n</code></pre>\n\n<p><code>My_table</code> is a copy of <code>remote_table</code>.</p>\n\n<p>I tried to copy only the new records from the <code>remote_table</code> by this query:</p>\n\n<pre><code>SELECT    *\nFROM [remote_DB].[LudanProjectManager].[dbo].Remote_table            \nEXCEPT           \nSELECT    *\nFROM My_table\n</code></pre>\n\n<p>It works OK but I get a duplicate primary key exception when changes have been made on the <code>remote_table</code> on the hours column.</p>\n\n<p>Can anyone think of a way to copy only the new records from <code>remote_table</code> and if changes has been made on old records, to identify them and update the <code>my_table</code> to correspond?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12797096,"title":"How to convert DateTime into text and concate with text?","body":"<p>I want to convert DateTime to text and concate with text.</p>\n\n<pre><code>declare @AssignDate datetime \nset @AssignDate =getdate()\nselect 'Date: ' + convert(char(16),@AssignDate)\n</code></pre>\n\n<p>But my output is coming like: Date: Oct  9 2012  3:0,</p>\n\n<p>My output should be \"Date: 09/10/2012 15:30\"</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":159,"score":0,"question_id":12795264,"title":"Alphanumeric and special character sorting in SQL Server 2008","body":"<pre><code>Select number \nfrom tableName \norder by Number\n</code></pre>\n\n<p>It displays like below</p>\n\n<pre><code>1\n10\n11\n14\n14A\n14AA\n19\n2\n20\n21\n</code></pre>\n\n<p>Instead it should display like below</p>\n\n<pre><code>1 \n2\n10\n11\n14\n14A\n14AA\n19\n20\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":71,"score":-1,"question_id":12791574,"title":"Stored procedure using loops not working","body":"<p>I have a proc which generates a trigger to catch insert operations and load into the audit table. It creates and prints the first set of parameters (Local variables declartion for new data) but when it comes to the step \"Local variable declartion for new data Decode\" it doesnt print anything. It works for fewer columns but if table has lot of columns then it doesnt work. </p>\n\n<pre><code>CREATE PROCEDURE [Log].[Generate_AuditTrigger_For_Insert]  'T_Referral|T_ReferralInsertAudit', 'Umesh', 'RTS', 'True' \n(\n    @TableNameARRAY VARCHAR(MAX),\n    @NAME VARCHAR(MAX),\n    @SCHEMA_NAME VARCHAR(100),\n    @UseConfiguredRecordIdentifier bit\n)\n\nAS\nBEGIN\n\n/* Tool Variables*/\nDECLARE @TableName VARCHAR(1000)\nDECLARE @TableDescription VARCHAR(1000)\nDECLARE @ColumnCount INT \nDECLARE @INCREMENT INT\nSET @INCREMENT = 5\nDECLARE @Counter INT \nDECLARE @StringColumn VARCHAR(1000)\nDECLARE @seprater CHAR(1)\nSET @seprater =','\nDECLARE @seprater_position INT, @seprater_pos int\nDECLARE @ARRAY_VALUE VARCHAR(1000)\nDECLARE @SQL NVARCHAR(1000)\nDECLARE @PARAMS NVARCHAR(1000)\nDECLARE @COMMENTS VARCHAR(1000)\n\nIF @TableNameARRAY &lt;&gt; '0'\n BEGIN\n   SET @TableNameARRAY = @TableNameARRAY + ','\n   WHILE PATINDEX('%,%', @TableNameARRAY) &lt;&gt; 0\n   BEGIN\n             SELECT @seprater_position = PATINDEX('%,%', @TableNameARRAY)\n             SELECT @ARRAY_VALUE = LEFT(@TableNameARRAY, @seprater_position-1)\n\n            /*---------------------------------------------------*/\n\n            SELECT @seprater_pos = PATINDEX('%|%', @ARRAY_VALUE)\n\n            SET @TableName = LEFT(@ARRAY_VALUE,@seprater_pos-1)\n            SET @TableDescription = STUFF(@ARRAY_VALUE, 1, @seprater_pos, '')\n            SET @Counter = 0\n            PRINT ''\n            PRINT 'GO'\n            PRINT 'IF  EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N''' + @SCHEMA_NAME + '.[trg' + @TableDescription + ']''))'\n            PRINT 'DROP TRIGGER [' + @SCHEMA_NAME + '].[trg' + @TableDescription + ']'\n            PRINT ''\n            PRINT 'GO'\n            PRINT ''\n            PRINT '/********************************************************************************'  \n            PRINT '*  Name          : trg' + @TableDescription\n            PRINT '*  Version       : 1.0'  \n            PRINT '*  Developer     : '   +@NAME\n            PRINT '*  Description   : Insert Audit Log Trigger'  \n            PRINT '*  Tables        : ' + @TableName  \n            PRINT '*  Views Used    : None'   \n            PRINT '*  Procedures    : None'  \n            PRINT '*  Functions     : None' \n            PRINT '*********************************************************************************'\n            PRINT '*                  Modification History'  \n            PRINT '*'  \n            PRINT '* DATE               NAME                NATURE OF CHANGES'  \n            PRINT '*--------------------------------------------------------------------------------'  \n            PRINT '* ' + CONVERT(VARCHAR(10), GETDATE(), 110) + '       ' + @NAME + '               Creation &amp; Initial Coding'    \n            PRINT '*'   \n            PRINT '*'\n            PRINT '*'\n            PRINT '*'\n            PRINT '*' \n            PRINT '*********************************************************************************/' \n            PRINT ''\n            PRINT 'CREATE TRIGGER [' + @SCHEMA_NAME + '].[trg' + @TableDescription + ']' \n            PRINT 'ON [' + @SCHEMA_NAME + '].[' + @TableName + ']'\n            PRINT 'AFTER  INSERT'\n            PRINT 'AS'\n            PRINT ''\n            PRINT 'BEGIN'\n            PRINT ''            \n            SELECT @SQL = N'SELECT @ColumnCount = (SELECT count(COLUMN_NAME) ' + \n                    N'FROM INFORMATION_SCHEMA.COLUMNS ' +\n                    N'WHERE TABLE_NAME = ''' + REPLACE(REPLACE(quotename(@TableName), '[', ''), ']', '') +\n                    N''');'         \n\n            SELECT @PARAMS = N'@ColumnCount int OUTPUT'\n            EXEC sp_executesql @SQL, @PARAMS, @ColumnCount = @ColumnCount OUTPUT\n\n            PRINT '     /*Local variable declartion for new data*/'\n            PRINT ''\n            DECLARE @CREATED_COL_COUNT INT\n            SET @CREATED_COL_COUNT = 0\n\n            WHILE @Counter &lt; (@ColumnCount + @INCREMENT)\n            BEGIN\n                Set @Counter = @Counter + 1\n                SELECT @StringColumn = (SELECT COL_NAME(OBJECT_ID(@SCHEMA_NAME + '.' + @TableName), @Counter) AS 'Column Name')\n\n                SET @CREATED_COL_COUNT = @CREATED_COL_COUNT + 1\n                PRINT '     DECLARE @NEW_' + @StringColumn + ' VARCHAR(1000)'\n\n            CONTINUE\n            END\n\n            PRINT ''    \n            PRINT '     /*Local variable declartion for new data Decode*/'    \n            SET @CREATED_COL_COUNT = 0    \n            SET @Counter = 0    \n\n            WHILE @CREATED_COL_COUNT &lt; (@ColumnCount)    \n\n            BEGIN    \n                Set @Counter = @Counter + 1    \n                SELECT @StringColumn = (SELECT COL_NAME(OBJECT_ID(@SCHEMA_NAME + '.' + @TableName), @Counter) AS 'Column Name')    \n                IF @StringColumn IS NOT NULL      \n                SET @CREATED_COL_COUNT = @CREATED_COL_COUNT + 1    \n\n                PRINT '     DECLARE @NEW_' + @StringColumn + '_DECODE_VALUE VARCHAR(1000)'    \n                CONTINUE    \n            END    \n\n\n            IF @CREATED_COL_COUNT &lt; @ColumnCount  \n            BEGIN\n                PRINT ''\n                PRINT '     RAISERROR ''ERROR IN COLUMN COUNT INCREMENT, PLEASE CHECK THE TRIGGER TOOL AND TRY AGAIN'''\n                PRINT ''\n            END\n            SET @Counter = 0\n            PRINT ''\n\n            PRINT ''    \n            PRINT '     /*Local variable declartion for new data decode value sql*/'    \n            SET @CREATED_COL_COUNT = 0    \n            SET @Counter = 0    \n\n            WHILE @CREATED_COL_COUNT &lt; (@ColumnCount)    \n\n            BEGIN    \n                Set @Counter = @Counter + 1    \n                SELECT @StringColumn = (SELECT COL_NAME(OBJECT_ID(@SCHEMA_NAME + '.' + @TableName), @Counter) AS 'Column Name')    \n                IF @StringColumn IS NOT NULL      \n                    SET @CREATED_COL_COUNT = @CREATED_COL_COUNT + 1    \n\n                PRINT '     DECLARE @NEW_' + @StringColumn + '_SQL NVARCHAR(1000)'    \n                CONTINUE    \n            END    \n\n            PRINT ''\n\n            SET NOCOUNT ON\n            DECLARE @COUNTER_TEST INT\n            SET @COUNTER_TEST =0\n\n            PRINT '     /*Local variable declartion*/'\n            PRINT ''\n            PRINT '     DECLARE @AuditLogActionTypeID  INT'\n            PRINT '     DECLARE @RecordIdentifierName NVARCHAR(100)'            \n            PRINT '     DECLARE @RecordIdentifierValue NVARCHAR(1000)'\n            PRINT '     DECLARE @ActionBy_UserId VARCHAR(25)'\n            PRINT '     DECLARE @COMMENTS VARCHAR(600)'\n            PRINT '     '\n            PRINT '     IF (SELECT COUNT(*) FROM INSERTED) &gt; 0 '\n            PRINT '     BEGIN'\n            PRINT '         /*Get new data from inserted table and assign into local variable*/'\n            PRINT '         SELECT'\n\n            SET @Counter = 0\n            WHILE @COUNTER_TEST &lt; (@ColumnCount) \n            BEGIN\n                Set @Counter = @Counter + 1\n                SELECT @StringColumn = (SELECT COL_NAME(OBJECT_ID(@SCHEMA_NAME + '.' + @TableName), @Counter) AS 'Column Name')\n\n                IF @StringColumn IS NOT NULL\n                SET @COUNTER_TEST = @COUNTER_TEST + 1\n\n                IF @COUNTER_TEST &lt; (@ColumnCount)    \n                    BEGIN    \n                        PRINT '             @NEW_' + @StringColumn + ' = CAST(' + @StringColumn + ' AS VARCHAR(1000)),'    \n                        IF EXISTS (SELECT * FROM [Log].AuditLogDecodeTableMapping WHERE SourceColumn = @StringColumn)    \n                        PRINT '             @NEW_' + @StringColumn + '_SQL = [Log].GenerateDynamicQuery(''' + @SCHEMA_NAME + '.' + @TableName + ''',''' + @StringColumn + ''', CAST(' + @StringColumn + ' AS VARCHAR(1000))),'    \n                        IF EXISTS (SELECT * from [Log].AuditSubCategory where AssociatedTable = @TableName AND RecordIdentifierName = @StringColumn) AND (@UseConfiguredRecordIdentifier = 'True')\n                            BEGIN\n                                PRINT '             @RecordIdentifierName = ''' + @StringColumn + ''','\n                                PRINT '             @RecordIdentifierValue = CAST(' + @StringColumn + ' AS VARCHAR(1000)),' \n                            END                     \n                    END    \n                ELSE    \n                    BEGIN    \n                        PRINT '             @NEW_' + @StringColumn + ' = CAST(' + @StringColumn + ' AS VARCHAR(1000))'    \n                        IF EXISTS (SELECT * FROM [Log].AuditLogDecodeTableMapping WHERE SourceColumn = @StringColumn)    \n                        PRINT '             @NEW_' + @StringColumn + '_SQL = [Log].GenerateDynamicQuery(''' + @SCHEMA_NAME + '.' + @TableName + ''',''' + @StringColumn + ''', CAST(' + @StringColumn + ' AS VARCHAR(1000))),'    \n                        IF EXISTS (SELECT * from [Log].AuditSubCategory where AssociatedTable = @TableName AND RecordIdentifierName = @StringColumn) AND (@UseConfiguredRecordIdentifier = 'True')\n                        BEGIN\n                            PRINT '             @RecordIdentifierName = ''' + @StringColumn + ''''  \n                            PRINT '             @RecordIdentifierValue  = CAST(' + @StringColumn + ' AS VARCHAR(1000))'     \n                        END                             \n                    END    \n\n            CONTINUE\n            END\n\n            PRINT '         FROM'\n            PRINT '             INSERTED'\n            PRINT ''\n            PRINT '     END'\n            PRINT '     '\n            PRINT '     DECLARE @CURRENT_USER_NAME VARCHAR(MAX) '\n            PRINT '     SET @CURRENT_USER_NAME  = suser_sname() '\n            PRINT '     DECLARE @USER_NAME VARCHAR(MAX) '\n            PRINT '     SET @USER_NAME = Substring(@CURRENT_USER_NAME, patindex(''%\\%'', @CURRENT_USER_NAME) + 1, LEN(@CURRENT_USER_NAME)) '\n            PRINT '     SELECT @ActionBy_UserId = @@SPID'\n            PRINT '     '\n            PRINT '     IF (@ActionBy_UserId IS NULL)'\n            PRINT '     BEGIN '\n            PRINT '         SET @ActionBy_UserId = ''-1'''\n            PRINT '     END '\n\n            SET  @COMMENTS = ' Column in ' +@SCHEMA_NAME+'.'+ @TableName +  ' table has been Inserted by user id '' +  @ActionBy_UserId + '''\n            PRINT '     SET  @COMMENTS = ''' + @COMMENTS  + ''''\n            PRINT ''\n            SET @Counter = 0\n            SET @COUNTER_TEST = 0\n\n            IF (@UseConfiguredRecordIdentifier = 'False')\n            BEGIN\n\n            /*Create TABLE #PRIMARYCOLUMNS(variable) to take resultset*/\n            CREATE TABLE #PRIMARYCOLUMNS ( ROWID INT IDENTITY(1, 1), COLUMN_NAME VARCHAR(1000))\n            DECLARE @COUNT INT\n            DECLARE @ROW INT\n            DECLARE @COLUMN_NAME VARCHAR(1000)  \n            DECLARE @COMMENTS_NAME VARCHAR(1000)\n            DECLARE @COMMENTS_DATA VARCHAR(1000)\n\n            SET @COMMENTS_NAME = ''\n            SET @COMMENTS_DATA = ''\n\n            /*taking primary column details as record in to #PRIMARYCOLUMNS(variable)Table*/\n            INSERT #PRIMARYCOLUMNS \n            SELECT c.name AS COLUMN_NAME\n            FROM sysindexes i\n            INNER JOIN sysobjects t ON i.id = t.id\n            INNER JOIN sysindexkeys k ON i.indid = k.indid AND i.id = k.ID\n            INNER JOIN syscolumns c ON c.id = t.id AND c.colid = k.colid\n            WHERE  \n                i.id = t.id AND i.indid BETWEEN 1 And 254 \n                AND (i.status &amp; 2048) = 2048\n                AND t.id = OBJECT_ID(@SCHEMA_NAME + '.' + @TableName)\n            ORDER BY \n            k.KeyNo\n\n            SET @COUNT = @@ROWCOUNT\n            SET @ROW = 1\n\n            /*looping through the Result set (#PRIMARYCOLUMNS)*/\n            WHILE @ROW &lt; @COUNT + 1\n            BEGIN\n\n                SELECT @COLUMN_NAME = COLUMN_NAME FROM #PRIMARYCOLUMNS WHERE ROWID = @ROW\n\n                SET @COMMENTS_NAME = @COMMENTS_NAME + @COLUMN_NAME \n                SET @COMMENTS_DATA = @COMMENTS_DATA + 'CAST(@NEW_' + @COLUMN_NAME + ' AS VARCHAR(1000))'\n\n                IF @ROW &lt; @COUNT \n                BEGIN\n                    SET @COMMENTS_NAME = @COMMENTS_NAME + ', '\n                    SET @COMMENTS_DATA = @COMMENTS_DATA + ' +'', ''+ '\n                    END\n                    SET @ROW = @ROW + 1\n                END\n\n                PRINT '     SET @RecordIdentifierName' + ' = ''' + @COMMENTS_NAME + ''''\n                PRINT '     SET @RecordIdentifierValue' + ' = ' + @COMMENTS_DATA + ''\n\n                DROP TABLE #PRIMARYCOLUMNS\n\n            END\n\n\n            PRINT '     /*Execute the SQL Statement to load decode value for New Data*/'\n            SET @CREATED_COL_COUNT = 0\n            SET @Counter = 0\n\n                WHILE @CREATED_COL_COUNT &lt; (@ColumnCount)\n\n                BEGIN\n                        Set @Counter = @Counter + 1\n                        SELECT @StringColumn = (SELECT COL_NAME(OBJECT_ID(@SCHEMA_NAME + '.' + @TableName), @Counter) AS 'Column Name')\n\n                IF @StringColumn IS NOT NULL  \n                    SET @CREATED_COL_COUNT = @CREATED_COL_COUNT + 1\n\n                IF EXISTS (SELECT * FROM [Log].AuditLogDecodeTableMapping WHERE SourceColumn = @StringColumn)\n                        PRINT '     EXEC sp_executesql @NEW_' + @StringColumn + '_SQL , N''@DecodedValue VARCHAR(MAX) OUTPUT' + ''', ' +  N'@DecodedValue ' + ' = ' + N'@NEW_' + @StringColumn + '_DECODE_VALUE ' + ' OUTPUT'\n                        CONTINUE\n                END\n            PRINT '     '\n            PRINT '     DECLARE @AuditSubCategoryID smallint '\n            PRINT '     SET @AuditSubCategoryID = NULL'\n            PRINT '     SELECT @AuditSubCategoryID = AuditSubCategoryID from [Log].AuditSubCategory where AssociatedTable = ''' + @TableName + ''''\n\n            PRINT ''\n\n            PRINT '     IF @AuditSubCategoryID IS NULL'\n            PRINT '     SET @AuditSubCategoryID = -1'\n            PRINT '     /*Get the Action Type Id from [Log].AuditLogActionType Table for Insert transaction*/'\n            PRINT '     SELECT @AuditLogActionTypeID  = ActionTypeId  FROM [Log].AuditLogActionType WHERE ActionTypeDesc = ''Insert'''\n            PRINT ''\n            SELECT @StringColumn = (SELECT COL_NAME(OBJECT_ID(@SCHEMA_NAME + '.' + @TableName), @Counter) AS 'Column Name')\n            PRINT '     Insert into [Log].AuditLogData  (TableName, ColumnName, RecordIdentifierName, RecordIdentifierValue, ActionBy_UserId, ActionDateTime, ActionType, Audit_Description, OldValue, OldValue_Decode, NewValue, NewValue_Decode, AuditSubCategoryID)'\n\n            SET @COUNTER_TEST = 0\n            SET @Counter = 0\n            WHILE @COUNTER_TEST &lt; (@ColumnCount)\n                    BEGIN\n                            Set @Counter = @Counter + 1\n                            SELECT @StringColumn = (SELECT COL_NAME(OBJECT_ID(@SCHEMA_NAME + '.' + @TableName), @Counter) AS 'Column Name')\n                IF @StringColumn IS NOT NULL\n\n                SET @COUNTER_TEST = @COUNTER_TEST + 1\n                IF @COUNTER_TEST &lt; (@ColumnCount)\n                PRINT '         SELECT '''+ @TableName + ''', '''+ @StringColumn + ''', @RecordIdentifierName, @RecordIdentifierValue, @ActionBy_UserId, GetDate(), @AuditLogActionTypeID , ''' + @StringColumn + ''' + @COMMENTS , null , null, CAST(@NEW_' + @StringColumn + ' AS VARCHAR(1000)), COALESCE(('''' + @NEW_' + @StringColumn+'_DECODE_VALUE + ''''), null' + '), @AuditSubCategoryID UNION ALL'\n\n                ELSE\n                PRINT '         SELECT '''+ @TableName + ''', '''+ @StringColumn + ''', @RecordIdentifierName, @RecordIdentifierValue, @ActionBy_UserId, GetDate(), @AuditLogActionTypeID , ''' + @StringColumn + ''' + @COMMENTS , null , null, CAST(@NEW_' + @StringColumn + ' AS VARCHAR(1000)), COALESCE(('''' + @NEW_' + @StringColumn+'_DECODE_VALUE + ''''), null' + '), @AuditSubCategoryID'\n            CONTINUE\n            END\n            PRINT ''            \n            PRINT 'END'             \n            PRINT ''\n\n            /*---------------------------------------------------*/\n             SELECT @TableNameARRAY = STUFF(@TableNameARRAY, 1, @seprater_position, '')\n  END\nEND\nPRINT           'GO'\n\nEND\n\nGO\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2008","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":666,"score":0,"question_id":6526982,"title":"SQL there was a problem sending the command to the program","body":"<p>I'm using Windows 7 and SQL Server 2008 R2 and whenever I try and double click a .sql file I get some stupid error \"there was a problem sending the command to the program\" does anyone know how to fix this? I have UAC keep popping up whenever I open SQL server or BIDS, but seems fine with Vis studio 2010 for some reason... oh and I checked that the exe was running as admin, I saw that posted somewhere...</p>\n"},{"tags":[".net","sql-server-2008",".net-assembly","clrstoredprocedure"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12794882,"title":"CLR Integration to return resultset","body":"<p>I am integrating CLR with SQL Server 2008, it's successfully configured. but i am calling a webservice inside this SqlProcedure. </p>\n\n<p>Here is the code, i have tried to return xml response.</p>\n\n<pre><code>[Microsoft.SqlServer.Server.SqlProcedure]\npublic static void SendReceiveAsXML(SqlString request)\n{\n    SqlPipe sp;\n    sp = SqlContext.Pipe;\n    MsgWS obj = new MsgWS();\n    string s = obj.SendAndReceiveAsXml(request.ToString());\n\n    sp.Send(s);\n\n}\n</code></pre>\n\n<p>There may be a possibility of \"maximum length exceeds exception\". to prevent this, i need to retrieve the response as reader as well as this is the requirement of end component i am integrating with sql.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SCQex.jpg\" alt=\"enter image description here\"></p>\n\n<p>Any suggestions are welcome.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2","information-schema"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":12793070,"title":"Deny access to information schema in SQL Server","body":"<p>I am looking for the best way to disable access to the <code>sys.tables</code> / <code>Information Schema</code> for a user / group in SQL Server.</p>\n\n<p>I found <a href=\"http://www.derkeiler.com/Newsgroups/microsoft.public.sqlserver.security/2008-09/msg00088.html\" rel=\"nofollow\">this thread from 2008 </a></p>\n\n<p>It shows a way how to deny access on <code>[sys].[something]</code> like so:</p>\n\n<pre><code> DENY SELECT ON [sys].[columns] TO DenySystemTableSelectRole\n GO\n DENY SELECT ON [sys].[tables] TO DenySystemTableSelectRole\n GO\n DENY SELECT ON [sys].[syscolumns] TO DenySystemTableSelectRole\n GO\n DENY SELECT ON [sys].[sysobjects] TO DenySystemTableSelectRole\n GO\n</code></pre>\n\n<p>But no way how to disable access on the <code>Information Schema</code>:</p>\n\n<pre><code>DENY SELECT ON INFORMATION_SCHEMA.TABLES To DenySystemTableSelectRole\n</code></pre>\n\n<p>This seems not to work.</p>\n\n<p>How can I disable access to information_schema?</p>\n\n<p>And is there an easier way disable access to all <code>sys</code> / <code>information_schema</code>?</p>\n\n<p><strong>Update:</strong>\nActually I can not run both ot the following statements:</p>\n\n<pre><code>DENY SELECT ON [sys] TO reducedDBO\nGO\nDENY SELECT ON INFORMATION_SCHEMA To reducedDBO\nGO\n</code></pre>\n\n<p>I tried to run them on the specific DB where the User exists, and I also tried on the \"master\".</p>\n\n<p>I still can run:</p>\n\n<pre><code> SELECT * from\n INFORMATION_SCHEMA.TABLES \n</code></pre>\n\n<p>-->still returns results</p>\n\n<pre><code> SELECT * from\n sys.TABLES \n</code></pre>\n\n<p>-->no results anymore</p>\n\n<p>Including <code>SCHEMA::</code> in the query made it possible to create the securables</p>\n\n<pre><code>DENY SELECT ON SCHEMA::[sys] TO reducedDBO\nGO\nDENY SELECT ON SCHEMA::INFORMATION_SCHEMA To reducedDBO\nGO\n</code></pre>\n\n<p>But now I still can select all the information from the DB.</p>\n\n<p>I had a look at the \"Securables\"-Tab in the users Property-window in Management Studio 2008, it looks like this:</p>\n\n<p><em>Entry that does block the selecion of sys.tables</em></p>\n\n<p>Schema:sys, Name:tables, Type:View </p>\n\n<p>Permissions for sys.tables: Permission:Select, Grantor:dbo, Deny is checked</p>\n\n<p><em>Entry that do not block any selection</em></p>\n\n<p>Schema:, Name:INFORMATION_SCHEMA, Type:Schema </p>\n\n<p>Permissions for INFORMATION_SCHEMA: Permission:Select, Grantor:dbo, Deny is NOT checked (I tried to check it, but no chance..)</p>\n\n<p>Permission:Select, Grantor:INFORMATION_SCHEMA, Deny is checked</p>\n\n<hr>\n\n<p>I tried to set the permissions over the GUI, but then I get the same error that setting permissions would be possible only on the master DB.\nBut I not have the user/login added to the master DBs security.</p>\n\n<p><strong>Solution:</strong></p>\n\n<p>The only way I could make the <code>deny</code> work for the <code>information_schema</code> was to <strong>add the user to the master-db</strong> and run the <code>deny select</code> on the master:</p>\n\n<pre><code>DENY SELECT ON [sys].[tables] TO reducedDBO\nGO\nDENY SELECT ON INFORMATION_SCHEMA.TABLES To reducedDBO\nGO\n</code></pre>\n\n<p>And as in this code, it can only be executed for single tables.</p>\n"},{"tags":["sql-server-2008","query","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12793566,"title":"How can I convert images into binary format and insert them into table?","body":"<p>I have 200 images that I have to convert into binary format. And then I have to insert all them into myImages table without make changes in the current name of my all images.\nMy table structure is :</p>\n\n<pre><code>Id              int             Unchecked\nPictureBinary   varbinary(MAX)  Checked\nMimeType        nvarchar(40)    Unchecked\nSeoFilename     nvarchar(300)   Checked\nIsDeleted       bit             Unchecked\n</code></pre>\n\n<p>Can any one help me to do that? I want to insert all binary images by single query or by store procedure.</p>\n"}]}
{"total":21074,"page":14,"pagesize":100,"questions":[{"tags":["asp.net","sql-server","database","performance","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":44,"score":3,"question_id":12795236,"title":"Find database calls from a Page","body":"<p>I am using <code>sql server 2008</code> and website is in <code>asp.net 1.1</code>.</p>\n\n<p>Is there a way to find out <strong><code>how many times database has been called from a page</code></strong>?</p>\n\n<pre><code>What are the stored procedure called from the page?\n\nWhat are the tables involved in a page load?\n</code></pre>\n\n<p>Please suggest how can i track these?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","refactoring"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12794515,"title":"how to refactor select sentence which include more subqueries field?","body":"<p>Sometimes, Subqueries is good coose like that:</p>\n\n<p>select x1.test, (select r from table) from ......</p>\n\n<p>But more subqueries produce more handicap like performance problems and reusability whatelse...</p>\n\n<p>How to refactor below sql codes that must be more faster than before...</p>\n\n<pre><code>\n\nSelect f.c1\n      ,f.c2\n         ,f.c3 As 'c3Id'\n         ,p.Value As 'c3'\n         ,m.c4 As 'r1'\n\n\n         ,(Select SUM(t1.table1x)\n             From [ap].table1 t1\n             Where t1.table1x = 1 \n               And f.c1 = t1.c1 \n               And f.c2 = t1.c2\n               And f.c3 = t1.c3) As 'r2'\n\n         ,(Select SUM(t2.x)\n             From [ap].table2 t2\n             Where t2.c1 = f.c1\n               And t2.c1 = f.c2\n               And t2.c3 = f.c3) As 'r3'\n\n         ,(Select SUM(t1.table1x)\n             From [ap].table3 t3\n             Where t3.table3Turu = 2\n               And f.c1 = t3.c1 \n               And f.c2 = t3.c2\n               And f.c3 = t3.c3) As 'r4'\n\n         ,(Select SUM(t4.x)\n             From [ap].table4 t4\n             Where t4.c1 = f.c1\n               And t4.c1 = f.c2\n               And t4.c3 = f.c3) As 'r5'\n\nFrom [ap].table1 f \nInner Join [dbo].table5 m On f.c1 = m.col11\nInner Join [dbo].table6 p On f.c3 = p.col22\n\nWhere p.xxxx = 'test'\nGroup By f.c1, f.c2, f.c3, m.c4, p.Value\n\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","ssms"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":153,"score":0,"question_id":12793976,"title":"Unable to connect SSMS, Microsoft SQL Server, Error: 53","body":"<p>SQL Server Managment Studio is not connecting on my database server machine at production server.</p>\n\n<p>Whereas production sites accessing database. When I tried to connect database from SSMS, I get this error:</p>\n\n<blockquote>\n  <p><em>Cannot connect to 111.11.11.11.</em></p>\n  \n  <p><em>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: Named\n  Pipes Provider, error: 40 - Could not open a connection to SQL Server)\n  (Microsoft SQL Server, Error: 53)</em></p>\n</blockquote>\n\n<p>I was using this SSMS last couple of years,n this SSMS is running fine since more then year on production database server n i didn't closed ever, now when i connecting this SSMS but facing this issue, whereas my sites which accessing this database is working fine. </p>\n\n<p>I also tried to access database from sqlcmd but no luck n facing facing this error:</p>\n\n<blockquote>\n  <p>HResult 0x35, Level 16, State 1<br>\n  Named Pipes Provider: Could not open a connection to SQL Server [53].<br>\n  Sqlcmd: Error: Microsoft SQL Server Native Client 10.0 : A network-related or instance-specific error has occurred while establishing a connection to SQL Server.<br>\n  Server is not found or not accessible. Check if instance name is correct and if SQL Server is configured to allow remote connections. For more information see SQL Server Books Online..</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12792020,"title":"TSql Case within Case","body":"<p>I am trying to do a select statment in tsql with a case within a case. First is based on what the SearchField is. Next I need to do it based on the SearchOper. </p>\n\n<pre><code>    declare @searchField varchar(50)  \n    declare @searchString varchar(50)\n    declare @searchOper varchar(50)\n\n    case @searchField\n     when 'CompanyName' then\n        case @searchOper\n          when 'eq' then\n            select * from tbl1 where CompanyName = @searchString\n         when 'ne' then \n           select * from tbl1 where CompanyName &lt;&gt; @searchString\n         end\n     when 'StoreNum' then\n        case @searchOper\n          when 'eq' then\n             select * from tbl1 where StoreNum = @searchString\n          when  'ne' then\n             select * from tbl1 where StoreNum &lt;&gt; @searchString\n        end \n     end \n</code></pre>\n\n<p>Note what I am trying to do is within the case statement do a select.</p>\n\n<p>I get a message saying Incorrect syntax near the keyword 'case'. </p>\n"},{"tags":["ruby-on-rails","sql-server","ruby-on-rails-3","sql-server-2008","heroku"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12574655,"title":"Heroku, Rails and Remote Microsoft SQL Server","body":"<p>first i would like to say that I have done research and know that the following is \"possible\"--I was hoping to find folks with real-world experience with this setup to see if I \"should\" do it this way. </p>\n\n<p>So, I have a Ruby/Rails web app that i've developed that links directly to Microsoft SQL Server 2008R2 on a private network. I'm trying to decide whether to deploy to Heroku or simply build a local Ubuntu web server. I'd prefer to use Heroku, however am concerned that connecting to a remote Microsoft SQL Server may be too much trouble. I have full access to network equipment, firewall, IP addresses, routing, etc. </p>\n\n<p>Currently my app uses TinyTDS and activerecord-sqlserver-adapter to connect from my local dev machine and works like a charm. I'd love to use Heroku (ok with paying for it)--but how stable and/or supported is this feature? Could I use a free SSL cert to encrypt data travelling over the internet? And, would I need to purchase an add-on for Heroku to get a static IP for my site to properly secure traffic coming to my firewall?</p>\n\n<p>I'm totally willing to put in work to make it run on Heroku...but I don't want to use unreliable or unsupported (or insecure) hacks...in this case I'd just deploy locally to Ubuntu.</p>\n\n<p>Thanks!</p>\n"},{"tags":["php","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":4,"view_count":46,"score":-4,"question_id":12792502,"title":"How to format a date in PHP","body":"<p>I have a database with a table, and it has a field with datetime type. When I collect data from that field and show it in PHP, it shows \"Oct 9 2012 2:06PM\". I want to convert its format to \"10/09/2012 14:06:00\". Please note that before I convert it, it doesn't have \"second\" and I want it have \"00\" seconds after conversion. </p>\n\n<p>How can I format this date in PHP?</p>\n"},{"tags":["sql-server-2008","jdbc","glassfish","connection-pooling"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":125,"score":0,"question_id":12773137,"title":"Glassfish \"Connection closed\" error with a connection pool, JDBC, and SQL Server 2008","body":"<p>When I try to do more than one transaction in a JSF page, I get the following error:</p>\n\n<pre><code>A potential connection leak detected for connection pool MSSQL. The stack trace of the thread is provided below : \ncom.sun.enterprise.resource.pool.ConnectionPool.setResourceStateToBusy(ConnectionPool.java:324)\ncom.sun.enterprise.resource.pool.ConnectionPool.getResourceFromPool(ConnectionPool.java:758)\ncom.sun.enterprise.resource.pool.ConnectionPool.getUnenlistedResource(ConnectionPool.java:632)\ncom.sun.enterprise.resource.pool.AssocWithThreadResourcePool.getUnenlistedResource(AssocWithThreadResourcePool.java:196)\ncom.sun.enterprise.resource.pool.ConnectionPool.internalGetResource(ConnectionPool.java:526)\ncom.sun.enterprise.resource.pool.ConnectionPool.getResource(ConnectionPool.java:381)\ncom.sun.enterprise.resource.pool.PoolManagerImpl.getResourceFromPool(PoolManagerImpl.java:245)\ncom.sun.enterprise.resource.pool.PoolManagerImpl.getResource(PoolManagerImpl.java:170)\ncom.sun.enterprise.connectors.ConnectionManagerImpl.getResource(ConnectionManagerImpl.java:338)\ncom.sun.enterprise.connectors.ConnectionManagerImpl.internalGetConnection(ConnectionManagerImpl.java:301)\ncom.sun.enterprise.connectors.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:190)\ncom.sun.enterprise.connectors.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:165)\ncom.sun.enterprise.connectors.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:160)\ncom.sun.gjc.spi.base.DataSource.getConnection(DataSource.java:113)\ncl.codesin.colegios.util.persistencia.DAOManejador.abrir(DAOManejador.java:126)\n</code></pre>\n\n<p>Please notice the last line I pasted:</p>\n\n<pre><code>cl.codesin.colegios.util.persistencia.DAOManejador.abrir(DAOManejador.java:126)\n</code></pre>\n\n<p><code>abrir</code> does the following:</p>\n\n<pre><code>public void abrir() throws SQLException {\n    try\n    {\n        if(this.con==null || this.con.isClosed())\n            this.con = fuenteDatos.getConnection();\n    }\n    catch(SQLException e)\n    {\n        throw e;\n    }\n}\n</code></pre>\n\n<p>It works in a singleton DAO manager this way: the DAO manager has one instance of each DAO and manages a single connection that every DAO shares. When a DAO is requested, it does the following:</p>\n\n<pre><code>public DAORegion getDAOregion() throws SQLException {\n        try\n        {\n            if(con == null) //con is the connection the DAO manager uses\n            {\n                this.abrir();\n            }\n        }\n        catch(SQLException e)\n        {\n            throw e;\n        }\n        if(this.DAOregion==null)\n        {\n            this.DAOregion = new DAORegion(this.con);\n        }\n        return DAOregion;\n    }\n</code></pre>\n\n<p>When closing a connection, the manager just calls to <code>con.close()</code> without anything else.</p>\n\n<p>By the way, I have no persistence.xml since I'm working with JDBC.</p>\n\n<p>What am I doing wrong? Thank you beforehand.</p>\n\n<p>EDIT: By desactivating the leak detection from the Glassfish server I could avoid the exception, however I'm still getting a \"Connection closed\" error. Worst is, now I don't know exactly where the error is being thrown.</p>\n\n<p>EDIT 2: I changed my DAO manager again. Here's the implementation.</p>\n\n<pre><code>public class DAOManejador {\n\n    public static DAOManejador getInstancia() {\n        return DAOManejadorSingleton.INSTANCIA;\n    }\n\n    //This is just a sample, every getDAOXXX works the same.\n    public DAOUsuario getDAOusuario() throws SQLException {\n        try\n        {\n            if(con == null)\n            {\n                this.abrir();\n            }\n        }\n        catch(SQLException e)\n        {\n            throw e;\n        }\n        if(this.DAOusuario==null)\n        {\n            this.DAOusuario = new DAOUsuario(this.con, this.stmt, this.res);\n        }\n        return DAOusuario;\n    }\n\n    public void abrir() throws SQLException {\n        try\n        {\n            if(this.con==null || this.con.isClosed())\n                this.con = fuenteDatos.getConnection();\n        }\n        catch(SQLException e)\n        {\n            throw e;\n        }\n    }\n\n    public void iniciaTransaccion() throws SQLException {\n        try\n        {\n            con.setAutoCommit(false);\n        }\n        catch(SQLException e)\n        {\n            throw e;\n        }\n    }\n\n    public void cierraTransaccion()  throws SQLException {\n        try\n        {\n            con.setAutoCommit(true);\n        }\n        catch(SQLException e)\n        {\n            throw e;\n        }\n    }\n\n    public void comprometer() throws SQLException {\n        try\n        {\n            con.commit();\n        }\n        catch(SQLException e)\n        {\n            throw e;\n        }\n    }\n\n    public void deshacer() throws SQLException {\n        try\n        {\n            con.rollback();\n        }\n        catch(SQLException e)\n        {\n            throw e;\n        }\n    }\n\n    public void cerrar() throws SQLException {\n        try\n        {\n            if(this.stmt!=null &amp;&amp; !this.stmt.isClosed())\n                stmt.close();\n\n            if(this.res!=null &amp;&amp; !this.res.isClosed())\n                this.res.close();\n\n            if(this.con!=null &amp;&amp; !this.con.isClosed())\n                con.close();\n        }\n        catch(SQLException e)\n        {\n            throw e;\n        }\n    }\n\n    public void comprometerYTerminarTransaccion() throws SQLException {\n        try\n        {\n            this.comprometer();\n            this.cierraTransaccion();\n        }\n        catch(SQLException e)\n        {\n            throw e;\n        }\n    }\n\n    public void comprometerYCerrarConexion() throws SQLException {\n        try\n        {\n            this.comprometer();\n            this.cierraTransaccion();\n            this.cerrar();\n        }\n        catch(SQLException e)\n        {\n            throw e;\n        }\n    }\n\n    //Protegidos\n    @Override\n    protected void finalize() throws SQLException, Throwable\n    {\n        try\n        {\n            this.cerrar();\n        }\n        finally\n        {\n            super.finalize();\n        }\n    }\n\n    //Private\n    private DataSource fuenteDatos;\n    private Connection con = null;\n    private PreparedStatement stmt = null;\n    private ResultSet res = null;\n\n    private DAOUsuario DAOusuario = null;\n    private DAORegion DAOregion = null;\n    private DAOProvincia DAOprovincia = null;\n    private DAOComuna DAOcomuna = null;\n    private DAOColegio DAOcolegio = null;\n\n    private DAOManejador() throws Exception {\n        try\n        {\n            InitialContext ctx = new InitialContext();\n            this.fuenteDatos = (DataSource)ctx.lookup(\"jndi/MSSQL\");\n        }\n        catch(Exception e){ throw e; }\n    }\n\n    private static class DAOManejadorSingleton {\n        public static final DAOManejador INSTANCIA;\n        static\n        {\n            DAOManejador dm;\n            try\n            {\n                dm = new DAOManejador();\n            }\n            catch(Exception e)\n            { dm=null; }\n            INSTANCIA = dm;\n        }\n    }\n\n}\n</code></pre>\n\n<p>What I did now is to provide a single access point for every DAO. When a DAO wants to use a statement or a resource, they'll all use the same one. When they need to open again one, the system does the following:</p>\n\n<pre><code>public abstract class DAOGenerico&lt;T&gt; {\n\n    //Protected\n    protected final String nombreTabla;\n    protected Connection con;\n    protected PreparedStatement stmt;\n    protected ResultSet res;\n\n    protected DAOGenerico(Connection con, PreparedStatement stmt, ResultSet res, String nombreTabla) {\n        this.nombreTabla = nombreTabla;\n        this.con = con;\n        this.stmt = stmt;\n        this.res = res;\n    }\n\n    //Prepares a query\n    protected final void prepararConsulta(String query) throws SQLException \n    {            \n        try\n        {\n            if(this.stmt!=null &amp;&amp; !this.stmt.isClosed())\n                this.stmt.close();\n            this.stmt = this.con.prepareStatement(query);\n        }\n        catch(SQLException e){ throw e; }\n    }\n\n    //Gets a ResultSet\n    protected final void obtenerResultados() throws SQLException {\n        try\n        {\n            if(this.res!=null &amp;&amp; !this.res.isClosed())\n                this.res.close();\n            this.res = this.stmt.executeQuery();\n        }\n        catch(SQLException e){ throw e; }\n    }\n\n}\n</code></pre>\n\n<p>And it <em>still</em> doesn't work.</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":1012,"score":3,"question_id":883278,"title":"Running Sql Server stored proc in context of caller","body":"<p>This is making me nuts and I'm sure the answer is SO easy.</p>\n\n<p>I have multiple schemas that each have a view named \"Task\".  I want to make a single stored proc that users running in multiple default schemas can execute successfully -- that stored proc does a select on the Task view.</p>\n\n<p>So say I have these objects:</p>\n\n<p>View: fr.Task (users with default schema of 'fr' get this if they just type \"select * from Task\"\nView: de.Task (ditto, but for users with default schema of 'de')</p>\n\n<p>StoredProc: dbo.MyProc -- all users have execute permissions.  The proc is simply:</p>\n\n<pre><code>select count(*) from Task\n</code></pre>\n\n<p>Now I would expect (and I want) that if a user with default schema 'fr' did </p>\n\n<pre><code>exec dbo.MyProc\n</code></pre>\n\n<p>Then they would get the count of rows from view fr.Task.  But instead they get error \"Invalid object name 'Task'.\"</p>\n\n<p>Is it not possible to make a generic storedproc that will execute a select in the schema of the running user?</p>\n\n<p>Thx,\nBill</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12789225,"title":"How to update the each record in sql server","body":"<p>I need to update each records in the table using the Update script</p>\n\n<p>query 1:</p>\n\n<pre><code>Select acheivementsId \nfrom Students \nwhere student_id = 2\n</code></pre>\n\n<p>Result:: 61 records// Number of acheivementsid</p>\n\n<p>query 2 :</p>\n\n<pre><code>Select acheivementsId \nfrom Students \nwhere student_id = 4  \n</code></pre>\n\n<p>Result: 61 records// Number of acheivementsid</p>\n\n<p>I need to update Student_id = 2 acheivementid's  with student_id = 4 acheivementId's.</p>\n\n<p>how to write the Update Statement for updating 61 records.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","ssis","business-intelligence"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12789182,"title":"Passing a variable value from Control Flow to Data Flow in SSIS","body":"<p>I have a fairly straightforward SSIS package where I can't sucessfully pass the value of a package-scoped variable from the Control Flow to a Data Flow task.  Consider the below diagram:</p>\n\n<p><img src=\"http://i.stack.imgur.com/NrFVH.jpg\" alt=\"Control Flow\"></p>\n\n<p>The Execute SQL task gets values from a list of \"machines\".  This is used to control a ForEach Loop Container, which works very well.  Next a script task performs some math and assigns a single number to a package scoped variable (integer type).  I have added message boxes that pop up during the loop so that I can verify that the value of this variable is being set properly.</p>\n\n<p>The last icon is a data flow where I want to use the variable value.  I have a simple script task that contains just a message box showing me the current value of this same variable.  Every time, the variable is the value that I initially set in the designer (BIDS).  Therefore, the value is not being \"passed\" to the data flow.  I have verified multiple times that the names of the variables are correct (including case sensitive values).</p>\n\n<p>This should be pretty simple, and I am getting frustrated with this issue.  I would greatly appreciate and suggestions or comments.  Thank you!</p>\n"},{"tags":["java","sql-server-2008","jtds"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12788128,"title":"INSERT failed because the following SET options have incorrect settings: 'ARITHABORT'","body":"<p>I have read the topics in Stackoverflow about this problem, but I really haven't a solution yet.</p>\n\n<p>My problem is sending a String or Clob as an XML parameter in a Stored Procedure in SQL Server 2008. I'm using jTDS to connect it. I've read that I have to set the \"ARITHABORT\" to ON, but I really don't know where I can do it.</p>\n\n<p>Maybe in my own session in JAVA or in DB too... Please help!! (And sorry for my very very bad english)</p>\n\n<p>Ok! Here is the method that is giving me the error:</p>\n\n<pre><code>   private static final String PR_SV_MUDA_STATUS_EVENTO_CONCLUIDO = \"{CALL PR_SV_MUDA_STATUS_EVENTO_CONCLUIDO(?, ?, ?, ?)}\";\n\n\n   public String modificaStatus(Connection connection, Integer eventoRobo, String path) throws SQLException {\n    Connection conn = null;\n\n    conn = GenericHibernateDAO.criaConexao();\n\n\n    CallableStatement cs2 = conn.prepareCall(PR_SV_MUDA_STATUS_EVENTO_CONCLUIDO);\n\n    cs2.setInt(1, eventoRobo);\n    cs2.setString(2, null);\n    cs2.setString(3, null);\n    cs2.setString(4, path);\n    cs2.execute();\n    conn.close();\n\n    return null;\n}\n</code></pre>\n"},{"tags":["c#","sql-server","sql-server-2008","sql-server-2008-r2","sql-management-studio"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12788904,"title":"How to determine the effective permissions for a user of a SQL Server database through C#?","body":"<p>When I say effective permissions, I'm referring to the permissions listed when you go into the properties of a database in SQL Server Management Studio, click \"Permissions\", and then click the \"Effective\" tab.</p>\n\n<p>So far, I have been able to determine the explicit permissions with the following code:</p>\n\n<pre><code>using Microsoft.SqlServer.Management.Smo;\n...\nDatabasePermissionInfo[] permissions = database.EnumDatabasePermissions(\"username\");\n</code></pre>\n\n<p>However, I still need to obtain the effective permissions. In this scenario, I added a login for a user and gave it the role of <code>db_datareader</code> and <code>db_datawriter</code> for a database through the User Mapping.  </p>\n\n<p>In the permissions for the database, the effective permissions listed are <code>CONNECT, DELETE, INSERT, SELECT,</code> and <code>UPDATE</code>, but the explicit permissions only list connect (which is the only thing that the above code pulls back). So is there a way to programmatically retrieve the effective permissions as well?  </p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","datetime"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":1,"view_count":6735,"score":2,"question_id":6064674,"title":"SQL Server 2008 - How to convert GMT(UTC) datetime to local datetime?","body":"<p>I have an insert proc that passes in <code>GETDATE()</code> as one of the values because each insert also stores when it was inserted. This is hosted on SQL Azure - which uses GMT.</p>\n\n<p>Now, when I am receiving messages, I have the GMT date stored for each of them in their timestamp columns, how do I convert this to the local <code>datetime</code> for wherever you are when you are accessing my page? </p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":38,"score":-2,"question_id":12789115,"title":"Stored procedure is not working","body":"<p>I have created a stored procedure to retrieve some details based on the certain values passed to a parameter. THis requires switching between the SQLs to be executed by stored procedure. Following is the code:</p>\n\n<pre><code>USE [DFS]\nGO\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROCEDURE [dbo].[DAFS]\n@EmailID Nvarchar(128),\n@clientID int,\n@userType Varchar(50),\n@Success numeric output, \n@msg varchar(100) output  \n\nAS\n\nBEGIN\n    if @userType='Normal User'\n        IF EXISTS (SELECT 1 FROM dbo.Allcdn \n                    WHERE EmailID = @EmailID AND ClientID = @clientID) \n            begin\n                set @Success=0\n                set @msg='Carry on ....'\n            end\n        else\n            begin\n                set @Success=6  \n                set @msg='Not allowed ...' \n            END\n        end\n    else\n        Begin\n            IF EXISTS (SELECT 1 FROM dbo.Alcon \n                        WHERE EmailID = @EmailID AND ClientID = @clientID) \n                BEGIN\n                    set @Success=0\n                    set @msg='Carry on...' \n                END \n            END\n        End\n    end\nEND\n</code></pre>\n\n<p>The entire processing is based on the variable @userType. Not sure why the stored procedure is not compiling. </p>\n"},{"tags":["xml","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12788813,"title":"Post XML data to a URL in TSQL","body":"<p>I have some lead data which I need to post to a URL in XML format. Since lead data need to be posted after some calculations, I want to post within from TSQL. </p>\n\n<pre><code>&lt;LeadID&gt;1142637&lt;/LeadID&gt;\n&lt;LeadType&gt;2&lt;/LeadType&gt;\n&lt;DateCreated&gt;2012-05-08T13:13:59.103&lt;/DateCreated&gt;\n&lt;FirstName&gt;test&lt;/FirstName&gt;&lt;LastName&gt;name&lt;/LastName&gt;\n</code></pre>\n\n<p>I was able to convert Table join data to XML in TSQL as shown above but now I am stuck with posting this to 3rd party URL from TSQL. </p>\n\n<p>Can someone with this knowledge help me please?</p>\n"},{"tags":["sql","sql-server-2008","pivot"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":2,"view_count":66,"score":-1,"question_id":12787064,"title":"need to get the min and max date for an id with a datavalue for min(date) and max(date) datavalue in the same column","body":"<p>Given this data:</p>\n\n<pre><code>ID      FirstDate       LastDate       ItemId\n12A     05-11-2011      05-11-2011        0\n12A     12-19-2011      12-19-2011        3\n12A     01-04-2012      01-04-2012        3\n12A     01-19-2012      01-19-2012       12\n64B     06-15-2010      06-15-2010        0\n64B     08-19-2011      08-19-2011        3\n</code></pre>\n\n<p>I want to see:</p>\n\n<pre><code>ID     FirstDate    FirstItemId     LastDate     LastItemId\n12A    05-11-2011       0           01-19-2012       12\n64B    06-15-2010       0           08-19-2011        3\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":99,"score":2,"question_id":12784854,"title":"What are the differences between these?","body":"<p>What are the differences between the two queries?</p>\n\n<pre><code>   SELECT     CountryMaster.Id\n   FROM       Districts INNER JOIN\n   CountryMaster ON Districts.CountryId = CountryMaster.Id\n\n   SELECT     CountryMaster.Id\n   FROM       CountryMaster INNER JOIN\n   Districts ON Districts.CountryId = CountryMaster.Id  \n</code></pre>\n\n<p>Please mind the \ni) Table positions and second\nii) On Fields</p>\n\n<p>As I know, output will be same. But I  want to know, is there any drastic effects of the same if I neglect positions of tables and columns in complex queries or tables having tons of data like thousands and lakhs of rows...</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3598,"score":1,"question_id":3396409,"title":"SQL Server 2008 Backup fails: BACKUP DATABASE is terminating abnormally","body":"<p>I have a <strong>stored procedure, which performs a database backup</strong> for a specific database.\nThe problem is, it does work on one server and does not work on another server (the servers are on different machines). The backup drive is a local drive of the server.\nOn the second server I get the exception \"<strong><em>BACKUP DATABASE is terminating abnormally.</em></strong>\"</p>\n\n<p>In the log file there are the following informations:</p>\n\n<pre><code>...     Error: 18204, Severity: 16, State: 1.\n...     BackupDiskFile::CreateMedia: Backup device 'D:\\XXX.bak' failed to create. Operating system error 5(failed to retrieve text for this error. Reason: 15105).\n...     Error: 3041, Severity: 16, State: 1.\n...     BACKUP failed to complete the command BACKUP DATABASE XXX. Check the backup application log for detailed messages.\n</code></pre>\n\n<p>What could be the reason for that and where can I find the mentioned backup application log?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":6,"view_count":47,"score":-6,"question_id":12788268,"title":"The Best Database Script With Query List For Best Practice \"SQL\"","body":"<p>Can any one give \nThe Best Database Script With Query List For Best Practice  \"SQL\".</p>\n\n<p>-Regards \n Dipan</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","nolock"],"answer_count":6,"favorite_count":8,"up_vote_count":41,"down_vote_count":0,"view_count":25324,"score":41,"question_id":1452996,"title":"Is the NOLOCK (Sql Server hint) bad practice?","body":"<p>I'm in the business of making website and applications that are <em>not</em> mission critical -> eg. banking software, space flight, intensive care monitoring application, etc. You get the idea.</p>\n\n<p>So, with that massive disclaimer, is it bad using the NOLOCK hint in some Sql statement? A number of years ago, it was suggested by a fellow Sql Administrator that I should use NOLOCK if I'm happy with a <code>dirty read</code> .. which will give me a bit more performance out of my system because each read doesn't lock the table/row/whatever.</p>\n\n<p>I was also told that it's a great solution if I'm experiencing <code>dead-locks</code> (cringe). So, I started following that thought for a few years until a Sql guru was helping me with some random code and noticed all the NOLOCKS in my sql code. I was politely scolded and he tried to explain it to me (why it's not a good thing) and I sorta got lost :( I felt that the essence of his explanation was 'it's a band-aid solution to a more serious problem .. especially if you're experiencing deadlocking. As such, fix the root of the problem`. </p>\n\n<p>I did some googling recently about it and came across <a href=\"http://blogs.msdn.com/davidlean/archive/2009/04/06/sql-server-nolock-hint-other-poor-ideas.aspx\" rel=\"nofollow\">this post</a>.</p>\n\n<p>So, can some sql db guru sensei's please enlighten me? Be nice .. I'm blond :( so take it slowly, kind sir/madam.</p>\n\n<p>cheers :)</p>\n"},{"tags":["sql","sql-server-2008","truncate"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12785510,"title":"SQL truncate table error at -U","body":"<p>I want to run the following but I get an error at the '-' in front of 'U'</p>\n\n<p><code>sqlcmd -U foo -P Bar -S server -D db -Q \"use db truncate table Table1\"</code></p>\n\n<p>Thanks for the help</p>\n\n<p>EDIT:</p>\n\n<p><code>TRUNCATE TABLE table1</code> </p>\n\n<p>Does not work as it says I do not have permission.</p>\n"},{"tags":["c#","asp.net","html5","sql-server-2008","html5-video"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":133,"score":2,"question_id":12783106,"title":"Playing a video file from a sql server blob via ashx handler using HTML5 Video Tag","body":"<p>I am using code from this <a href=\"http://www.codeproject.com/Articles/21480/Video-Uploader-Control-for-SQL-Server\" rel=\"nofollow\">codeproject article</a> to upload a MP4 video file to SQL server(varbinary(MAX)) and play it back from there.</p>\n\n<p>My requirement is to use SQL server specifically instead of storing and fetching videos from the file system.</p>\n\n<p>This is the code I am using to play the video:</p>\n\n<pre><code>&lt;video id='my_video_1'  controls\n   width=\"640\" height=\"264\"\n  data-setup=\"{\"controls\":true, \"preload\":none}\" &gt;\n  &lt;source src='&lt;%# \"VideoHandler.ashx?id=\" + Eval(\"ID\") %&gt;' type='video/mp4'&gt;  \n&lt;/video&gt;\n</code></pre>\n\n<p>If I use a physical video file as the video source, it works. However the above code does not work.</p>\n\n<p>In \"Internet Explorer\" the tag renders a black box with a red cross</p>\n\n<p>In \"Chrome\" the player buttons are visible but when I click play button, no video is played. When we right click it shows \"Save Video as...\" option and the downloaded file runs fine with a desktop media player.</p>\n\n<p>Please help me with correct code.</p>\n"},{"tags":["sql","xml","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12786865,"title":"Concatenate XML variables in SQL Server","body":"<p>I have a query in a stored procedure retrieving some data in XML format to be returned in a variable <code>@xml_data</code>, like this:</p>\n\n<pre><code>SELECT @xml_data = (\n    SELECT * FROM (\n        SELECT   1 AS Tag\n                ,0 AS Parent\n                .....\n        FROM    MyTable\n        WHERE   id = @id\n\n        UNION ALL\n\n        SELECT   2 AS Tag\n                ,1 AS Parent\n                ....\n        FROM    MyTable2\n        WHERE   id = @id\n\n        UNION ALL\n\n        SELECT   3 AS Tag\n                ,2 AS Parent\n                ....\n        FROM    MyTable3\n        WHERE   id = @id\n    ) results\nFOR XML EXPLICIT, TYPE)\n</code></pre>\n\n<p>This is working like the proverbial dream :)</p>\n\n<p>However, I'd like to concatenate a header to this XML (e.g. <code>&lt;xml version=\"1.0\" encoding=\"ISO-8859-1\"/&gt;</code>) and can't figure out how to do it. I've tried converting to <code>NVARCHAR</code>, selecting the two variables in one statement but can't seem to get it right. </p>\n\n<p>Can anyone help??</p>\n\n<p>Thanks :)</p>\n"},{"tags":["sql-server-2008","query","duplicates"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12784540,"title":"Create duplicate records in a lookup table, for each unique value of a column id","body":"<p>I have a lookup table with id(primary key), name, value and branchId as the columns. Currently I have a set of data with the branchId being the same for the entire records. I need to duplicate the data with same values for the name and value columns, but a different value of branchId in the same table.</p>\n\n<p>Any help with the query/script to achieve this would be appreciated.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["c#","sql","database","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":134,"score":0,"question_id":12785072,"title":"Comparing two rows in the same table in sql server","body":"<p>I have looked at similar answers but, this is what I am looking for since I did not find any answers from previously answered questions:</p>\n\n<p>This is my scenario: I have a table <code>[res_user]</code> with <code>username, password, key_pin</code> which saves a username, an encrypted password, and a 4 digit pin or key.</p>\n\n<p>I am making an app in C# that allows a manager to log in and make changes to the database from the app itself.</p>\n\n<p>The manager is first prompted to log in with a username, a password, and their key_pin they are provided with. The pin is what will encrypt and decrypt the password to and from the database.</p>\n\n<p>Now I have a username <code>[manager]</code> and an encrypted password already saved in the database with the <code>key_pin</code>.</p>\n\n<p>How can I make sure that the manager logging in is the right one, meaning how can I compare the username and the encrypted password in the database from the C# app.</p>\n\n<p>These are the steps that I though of that I will implement in the app itself (using SQL syntax in c#):</p>\n\n<ol>\n<li><p>Encrypt the password,</p></li>\n<li><p>Get the saved encryption in the database using the login username, and</p></li>\n<li><p><strong>Compare</strong> the encryption returning a yes or a no back to the app for access control.</p></li>\n</ol>\n\n<p>allowing 5 attempts to log in.</p>\n\n<p>This is the first and second part I did:</p>\n\n<pre><code>try\n{\n   using (SqlConnection con = new SqlConnection(ConfigurationManager.ConnectionStrings[\"STRING\"].ConnectionString))\n   {\n     using (SqlCommand cmd = new SqlCommand(\"dbo.Res_User\", con))\n     {\n       cmd.CommandText = \"INSERT INTO Res_User(username, password, key_pin) SELECT '\" + username + \"' , dbo.fnEncDecRc4('\" + pin + \"','\" + password + \"'), '\" + pin + \"'\";\n       con.Open();\n       cmd.ExecuteNonQuery();\n\n       MessageBox.Show(\"Added\", \"Information\", MessageBoxButtons.OK);\n\n       cmd.CommandText = \"SELECT password FROM Res_User WHERE username = @username\";\n       cmd.Parameters.AddWithValue(\"@username\", username);\n       cmd.ExecuteNonQuery();\n\n       using (SqlDataReader reader = cmd.ExecuteReader())\n       {\n           if (reader.HasRows)\n           {\n               while (reader.Read())\n               {\n                    MessageBox.Show(reader[\"password\"].ToString(), \"Information\", MessageBoxButtons.OK);\n               }\n           }\n       }\n</code></pre>\n\n<p>How do I go about doing the third part?</p>\n\n<p>Only if someone can help me compare the saved enc. password and the login enc. password which I did in part one.</p>\n\n<p>Let me know if more information is needed.</p>\n\n<p>Thank You.</p>\n\n<p>Any help will be appreciated.</p>\n"},{"tags":["sql-server-2008","database-design","database-schema"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12141133,"title":"Correctness, Possibility of adding dummy row to force FK working","body":"<p>I have <strong>OutputInvoiceDetails</strong> and <strong>InputInvoicesDetails</strong> reference to <strong>InputDetailedItemsDetails</strong>.<br/>- I have two categories of Items : <strong>Detailed</strong> items and <strong>Global</strong> items.<br/> - <strong>InputDetailedItemsDetails</strong> holds details about an Item of type <strong>Detailed</strong>.<br/> - My problem is that  Global Items do not have SerialNumber etc so they are not concerned by <strong>DetailedItemsDetails</strong> Table.\n<br/><br/>I felt into similar situation several times so I want to know in this case : <br/>\n Is this schema correct ?\n Do I need to add a dummy row for Global items ? \n<img src=\"http://i.stack.imgur.com/QYAh3.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12784125,"title":"set and group by in the same query","body":"<p>Can I combine a 'set' with a 'group by'?</p>\n\n<pre><code>Column1  Column2  Column3  Column4\n30       15        3 Sep\n20       2         2 Sep\n</code></pre>\n\n<p>After updating:</p>\n\n<pre><code>Column1   Column2   Column3    Column4\n30        15        3 Sep      30/50+15/17\n20        2         2 Sep      20/50+2/17\n</code></pre>\n\n<p>I'm grouping the data by the entire September to calculate the sums: 50 and 17\nAnd use this to update Column4 in the same query.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":37823,"score":5,"question_id":1518823,"title":"How to find the port for MS SQL Server 2008?","body":"<p>I am running MS SQL Server 2008 on my local machine. I know that the default port is 1433 but some how it is not listening at this port. The SQL is an Express edition.</p>\n\n<p>I have already tried the log, SQL Server Management Studio, registry, and extended stored procedure for finding the port. But, I could not find it. Please help me. Thanks.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":8,"view_count":47,"score":-6,"question_id":12784392,"title":"\"Show table\" equivalent syntax","body":"<p>I need to do the equivalent of</p>\n\n<pre><code>SHOW TABLES LIKE 'ka_product_import'\n</code></pre>\n\n<p>in SQL Server 2008. How can I do this?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12783222,"title":"How to work with row index in T-Sql","body":"<p>I have a Table Reminder, Messaging and Users. I have to implement that whenever a row is created in the Reminder table then the Administrators from the Users table will get message in their Messaging table. </p>\n\n<p>I am doing everything inside the sql query. I have reached till the inserton and selection of all admin users, also I am able to run a loop on the number of records. I want to insert one by one in a loop.</p>\n\n<pre><code>If @flag=1 // flag=1 means reminder is created successfully\nBEGIN\n Declare @BackUpMessage as varchar(200)\n Set @BackupMessage = 'Hi Admin,\\r\\n\n \\t A backup has been scheduled by the system. Details are given below: \\r\\n\n    a) Bakcup Type : '+rem_type+' \\r\\n\n    b) Backup Date : '+ Convert(varchar,GETDATE()+@days)+''\n\n Set @Count = (Select Count(*) From JFPUsers Where RoleId=1 and Active=1) // Total Numbers of Admin\n IF @Count &gt; 0\n    Declare @i int =0\n\n    Select Id From JFPUsers Where RoleId=1 and Active=1 // Getting Id of each admin to save\n    While @i &lt; @Count\n    BEGIN\n        Insert Into JFMessaging (MessageBody, SenderId,RecieverId,IsRead,SentOn,IsActive)\n        Values(@BackUpMessage, -1, ,0,GETDATE(),1) // I am stucked here \n    END\nEND\n</code></pre>\n\n<p>I can do it easily using C# but I want to do these stuffs in a single connection and in a single hit @ backend . </p>\n\n<p><strong>Update : See Image and the summary</strong></p>\n\n<p>Summary : What I need is whenever a record is created in reminder. The query will pick all admin from JFPUsers {condition RoleId=1 is admin} and create that much row in JFMessaging where SenderId will be the user creating reminder or -1 (for system) and RecieverId will contain the admin id with a custom notification message. </p>\n\n<p><img src=\"http://i.stack.imgur.com/iblPQ.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12783376,"title":"Check constraint in sql server 2008 with ltrim and rtrim functions","body":"<p>I am using below code to add constraint on <code>CreatID</code> column. But its not working. I can still add text like <code>'   xyz'</code> which I don't want to. Also when only spaces are there in text it should be considered as <code>'null'</code> value. Like if I enter <code>'&lt;space&gt;&lt;space&gt;&lt;space&gt;'</code> this then it should be considered as null.</p>\n\n<pre><code>ALTER TABLE [dbo].[OneC_Gadget_AppDetails]  WITH CHECK \n    ADD  CONSTRAINT [chk_CreateID_val] \n    CHECK  ((len(ltrim(rtrim([AppActionContent])))&gt;(1)))\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12782210,"title":"SQL Server UPDATE multiple row value from another table","body":"<p>I have a table contain Id and Rcount. I need to update the Rcount for every member. Something like this</p>\n\n<pre><code>Id| Rby| Rcount\n1 | 0  | 0\n2 | 1  | 0\n3 | 1  | 0\n4 | 3  | 0\n5 | 4  | 0\n6 | 4  | 0\n7 | 4  | 0\n8 | 7  | 0\n</code></pre>\n\n<p>I get the value by using</p>\n\n<pre><code>SELECT Rby, COUNT(Rby) FROM member GROUP BY Rby;\n\nRby| COUNT(Rby)\n0  | 1\n1  | 2\n3  | 1\n4  | 3\n7  | 1\n</code></pre>\n\n<p>How can i update the result to the column Rcount??</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12783040,"title":"SQL Server attach and detach database","body":"<p>I am getting the following error on a different machine which is maintained by IT.</p>\n\n<blockquote>\n  <p>Could not find row in sysindexes for database ID 40, Object ID 1,\n  Index ID 1. RUN DBCC Checktable on sysindexes.</p>\n</blockquote>\n\n<p>I am able to attach and detach the database on my laptop.</p>\n\n<p>I tried <code>DBCC Checktable (SYSINDEXES)</code> and it gives an error</p>\n\n<blockquote>\n  <p>Cannot find a table or object with the name Sysindexes.</p>\n</blockquote>\n\n<p>Any idea on how can I troubleshoot this issue?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12782627,"title":"Short Sql query to merge rows","body":"<p>If I have this table:</p>\n\n<pre><code>Column1 Column2     Column3 \n20          NULL     3/27/2012 \nNULL        50      3/27/2012\nNULL        40      3/27/2012\n</code></pre>\n\n<p>How can I turn it into:</p>\n\n<pre><code>Column1 Column2     Column3 \n20          90      3/27/2012 \n</code></pre>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":49,"score":0,"question_id":12779052,"title":"How to add time (like 9:25:03 + 11:36:27 = ) of single column in sql server 2008","body":"<p>i have column(time datatype) which contains values like </p>\n\n<pre><code>9:25:03 \n4:43:21 \n2:50:13 \n11:25:33\n</code></pre>\n\n<p>,what query should i write to get sum of all values in the column</p>\n"},{"tags":["sql","sql-server-2008","case"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12781988,"title":"Case when SQL Server 2008","body":"<p>I have a single table with no relations.  When the field countyName is a zero length string I need <code>Statewide</code> to be in the result set.  Otherwise, I need then value of the field to stay as it is, e.g.: <img src=\"http://i.stack.imgur.com/3q5aZ.jpg\" alt=\"enter image description here\"> notice how in the second column there is 'Statewide' and 'countyName'.  countyName should be the original value actually stored in the database.</p>\n\n<pre><code>`countyName`  `address`\n               blah blah\nJackson        blah blah\n</code></pre>\n\n<p>needs to be (first rows on both examples are column names)</p>\n\n<pre><code>countyName     address\nStatewide      blah blah\nJackson        blah blah\n</code></pre>\n\n<p>Here's what I tried, you can ignore the rest of the fields in this example</p>\n\n<pre><code>select case servicetype\n       when 'cr' then 'Community Resource'\n       when 'ed' then 'Education'\n       when 'fb' then 'Faith-based'\n       when 'me' then 'Medical Equipment'\n       when 'hc' then 'Health Care'\n       else 'Other' \n       end as serviceType\n\n       ,case countyName\n       when '' then 'Statewide'\n       else 'countyname' end\n\n       ,name\n       ,physicaladdress\n       ,city\n       ,statelocation\n       ,zip\n       ,phone\n       ,website\n       from main\n\n      order by countyName, servicetype, name\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12781677,"title":"How to transfer local sql server or database to another computer ","body":"<p>I'm working on a project with 4 other guys, and we are developing an android app with a DB. Now, we are going to use a localhost for our SQL Server, I want to be able to take the database from my laptop and copy it to the other guys' computers. I\"m using SQL Server 2008 Management Studio. </p>\n\n<p>Any ideas of how to do it? I don't mind to copy the entire localhost server if we can do that.</p>\n\n<p>BTW, I tried to backup the DB on my laptop by right-click on the DB (created <code>.bak</code> file) but there is no restore option on the other computer.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12776195,"title":"How to change case in string","body":"<p>My table has one column that contain strings like:   <code>” HRM_APPLICATION_DELAY_IN”</code></p>\n\n<p>I want to perform bellow operations on each row on this column </p>\n\n<ol>\n<li>convert to lower case</li>\n<li>remove underscore <code>“_”</code></li>\n<li>change case (convert to upper case) of the character after the underscore like: <code>” hrm_Application_Delay_In”</code></li>\n</ol>\n\n<p>Need help for conversion. Thanks for advance</p>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12779456,"title":"Update if foreign key is missing","body":"<p>I'm pretty new to stored procedures, here's my problem.</p>\n\n<p>I've got 2 tables, <code>albums</code> and <code>pictures</code>.</p>\n\n<p>Table <code>albums</code>:</p>\n\n<pre><code>albumID     int\nalbumName   varchar(50)\nalbumInfo   text\nalbumDate   datetime\n</code></pre>\n\n<p>Table <code>pictures</code>:</p>\n\n<pre><code>imgID       int\nimgFile     varchar(50)\nimgName     varchar(50)\nfk_FotoID   int\nfk_albumID  Int\n</code></pre>\n\n<p>I want a stored procedure that if any pictures got a <code>fk_albumID</code> that doesn't exist in <code>albums</code>.</p>\n\n<p>And then do some stuff if I don't... fx. change the <code>fk_albumID</code></p>\n"},{"tags":["sql","sql-server-2008","odbc","datediff"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12779090,"title":"DateDiff in SQL ODBC","body":"<p>I'm using a datediff in SQL.  It returns records when run directly in sql server 2008, but when I try and run it through ODBC it doesn't bring up an error, but it returns no rows.</p>\n\n<pre><code>SELECT  mc_id, mc_date_entered,\n COUNT([mv_value]) total\nFROM MarkbookValue t1\n    RIGHT JOIN MarkbookColumn t2 ON t1.mv_column_id = t2.mc_id\nWHERE mc_module_id = '703000026609358' \n    AND DateDiff(dd, mc_date_entered, '2012-10-05 20:00:00') = 0\n    AND mc_type = 'KEF'\n    AND mc_entered_by = 'A.ADMIN'\nGROUP BY\n    mc_id, mc_date_entered;\n</code></pre>\n\n<p>Getting rid of the DateDiff lets the function run correctly, but I'd obviously like to have it in there.  What am I doing wrong?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":53,"score":0,"question_id":12779323,"title":"Is SCOPE_IDENTITY() relevant to the session or to the table?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/353526/reason-for-using-identity-rather-than-scope-identity\">Reason for using @@identity rather than scope_identity</a>  </p>\n</blockquote>\n\n\n\n<p>When a user adds a record to a table, I want to return the ID of that record to be used in the pages following the insert. I'm currently using this command (see example): </p>\n\n<pre><code>INSERT INTO tCRnames (fname, lname) VALUES ('Super','Man')\nDECLARE @Id INT;\nSET @Id = SCOPE_IDENTITY();\nSELECT @Id;\n</code></pre>\n\n<p>I have two questions regarding this method. </p>\n\n<ol>\n<li><p>Is this command relevant to the session? Meaning if two users insert a record at exactly that same time, will there be a problem with the returned ID's?</p></li>\n<li><p>Is there a better way to return the inserted ID? Currently all my ID's are normal identity fields, which is fine; but we are thinking of making some changes to some of our services which will leave us with ID fields that are NOT identity fields.</p></li>\n</ol>\n\n<p>You will then get a generated ID such as \"TMP001-05\" or just \"000004\".</p>\n\n<p>How do I return the inserted ID from that insert(besides from returning it upon generation)?</p>\n"},{"tags":["sql-server-2008","stored-procedures","parameters","case"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":100,"score":1,"question_id":12620373,"title":"Using Case field as parameter column in stored procedures in SQL Server","body":"<pre><code>CREATE PROCEDURE [dbo].[rpt_Report]\n   @Product varchar(20) = NULL,\n   @From DateTime = null,\n   @To DateTime = null\nAS\nBEGIN\n    SELECT \n       CO.PO, CO.DLVRY,   \n       CASE\n          WHEN co.CUST_ID = '120' THEN '120' \n          WHEN HDR.PO_NO LIKE 'CL%' THEN 'CL'\n          WHEN RED.REU = 'SK' THEN 'STOCK' \n          WHEN RED.REU = 'SM' THEN 'ORTS' \n          WHEN co.ITEM = 'PW%' THEN 'CHAIN' \n          WHEN co.ITEM LIKE 'D%' THEN 'VAN' ELSE 'MISC' \n       END AS PRODUCT \n     FROM   \n        co AS co    \n     INNER JOIN \n        HDR AS HDR ON co.NUMBER = HDR.NUMBER \n     INNER JOIN \n        RED AS RED ON co.ITEM = RED.ITEM \n     WHERE   \n        (co.DLVRY BETWEEN @From AND @To) AND (@Product = PRODUCT)\n     ORDER BY\n        co.DLVRY DESC\nEND\n</code></pre>\n\n<p>When I execute it I am getting an error saying </p>\n\n<blockquote>\n  <p>Msg 207, Level 16, State 1, Procedure rpt_Report, Line 34<br>\n  Invalid column name 'PRODUCT'.</p>\n</blockquote>\n\n<p>I should use the case field value as parameter in where CLAUSE.</p>\n"},{"tags":["perl","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12777325,"title":"How to write sql result into csv file","body":"<p>I'm having two tables like A and B. Table A having the Columns Name. Table B having the Columns Company Name.</p>\n\n<p>This is my code:</p>\n\n<pre><code>$query1 = \"SELECT Name FROM A\"; \n$query2 = \"SELECT Company Name FROM B\"; \n\n$statement1 = $connection-&gt;prepare($query1);    \n$statement2 = $connection-&gt;prepare($query2);\n\n$statement1-&gt;execute();\n$statement2&gt;execute();\n\nwhile ( ($name) = $statement-&gt;fetchrow_array) {\n    push (@Name, $name);    \n} \nwhile ( ($companyname) = $statement-&gt;fetchrow_array) {\n    push (@companyName, $companyname);  \n}\n\nopen (FH, \"&gt;&gt;Output.csv\") or die \"$!\";\n</code></pre>\n\n<p>I need to write the data in the csv file like this</p>\n\n<pre><code>Name   CompanyName\n\nxxx     yyyy\n\nxxx     yyyy\n\nxxx     yyyy\n\nxxx     yyyy\n\nxxx     yyyy\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","union"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12779838,"title":"Is there a way to use Union with Use?","body":"<p>I have several USE statements that I wish to UNION to get all the results in one result set but I cannot do this since UNION can only be used with SELECT. Is there a work around or any way to achieve my goal another way?</p>\n\n<p>Example:</p>\n\n<pre><code>USE Customer \nselect min(len(Password)) as min, \n    max(len(Password)) as max, \n    avg(len(Password)) as avg \nFROM Password\nUSE website \nselect min(len(password)) as min, \n    max(len(password)) as max, \n    avg(len(password)) as avg \nFROM Password\n</code></pre>\n\n<p>I have many more of these statements using different databases &amp; tables so wanted to group them all together.</p>\n\n<p>I'm using Microsoft SQL Server 2008.</p>\n"},{"tags":["c#","sql-server-2008","gui"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":2,"view_count":31,"score":-1,"question_id":12779463,"title":"Pls Help C# Gui Sql Server 2008 R2 Search Integration","body":"<p>I have a database for patients which i can add \"Age, Sex, Hands\" and i need to make a Gui with advanced search function which is possible to make a query like \"Give me male patients who is born between 1980 and 2000 and who uses left hand\" can someone pgrogramm for me a little instance of this? I have very few knowlodge of C# and sql server 2008 r2 and i need to improve an existing program and deliver to my mentor in next days, i am already late :(, any help would be much much apreciated<img src=\"http://i.stack.imgur.com/LWtcm.png\" alt=\"this is what i get with very less search function and it must be improved to advanced search function\"></p>\n\n<p>thanks in advance</p>\n"},{"tags":["sql","database","sql-server-2008","autoit","remote-connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":12751102,"title":"Problems connecting to remote SQL Server using AutoIT","body":"<p>I am attempting to create a login mechanism by which you can access a remote SQL Server 2008 R2 database, in a private network, if the credentials are correct. I intend to implement the database at my work server and this program at a client which is in the same subnet as the server. Here is my code so far:</p>\n\n<pre><code>Func Login()\n\n   $loginGUI = GUICreate(\"Login\", 250, 150, -1, -1) ; will create a dialog box that when displayed is centered\n   GUISetState(@SW_SHOW)\n   GUICtrlCreateLabel ( \"Input valid credentials to login\", 40, 10,-1,-1) \n   GUICtrlCreateLabel ( \"Username\", 40, 40,-1,-1)\n   Local $userInput = GUICtrlCreateInput(\"\", 100, 37, 100, 20)\n   GUICtrlSetState($userInput, $GUI_FOCUS)\n   GUICtrlCreateLabel ( \"Password\", 40, 70,-1,-1)\n   Local $passwordInput = GUICtrlCreateInput(\"\", 100, 67, 100, 20, $ES_PASSWORD)\n   Local $loginButton = GUICtrlCreateButton(\"Login\", 40, 105, 70)\n   Local $exitButton = GUICtrlCreateButton(\"Exit\", 130, 105, 70)\n\n   GUISetState()\n   ; Run the GUI until the dialog is closed\n   While 1\n      $msg = GUIGetMsg(1)\n      Switch $msg[0]\n         Case $loginButton\n            $user = GUICtrlRead($userInput)\n            $password = GUICtrlRead($passwordInput)\n            Global $loginCon = ObjCreate( \"ADODB.Connection\" )\n            With $loginCon\n               .ConnectionString =(\"DRIVER={SQL Server};SERVER=192.168.1.30\\SQLEXPRESS;DATABASE=Test;UID=\"&amp;$user&amp;\";PWD=\"&amp;$password&amp;\";\")\n               .Open\n            EndWith\n            If ($user =\"\" and $password=\"\") or @error Then\n               MsgBox(48, \"Login error\", \"Connection failed! Wrong Username/Password.\")\n               GUICtrlSetData($userInput, \"\")\n               GUICtrlSetData($passwordInput, \"\")\n               GUICtrlSetState($userInput, $GUI_FOCUS)\n            Else\n               $loginCon.Close\n               GUIDelete()\n               Main()\n               ExitLoop\n            EndIf\n         Case $exitButton\n            GUIDelete()\n            ExitLoop\n         Case $GUI_EVENT_CLOSE\n            GUIDelete()\n            ExitLoop\n      EndSwitch\n   WEnd\n\nEndFunc\n</code></pre>\n\n<p>I've also did the following actions:</p>\n\n<ol>\n<li>Used SQL Server Management Studio to allow remote connections as well as the proper permissions for the correct user to access the database.</li>\n<li>Used SQL Server Configuration Manager to enable SQL Server Browser and the TCP/IP protocol with the proper configurations to access the server.</li>\n<li>Created a firewall Inbound and Outbound rule which allows access to TCP port 1433 and UDP port 1434 for the server and client (just in case).</li>\n<li>Added <code>sqlservr.exe</code> and <code>sqlbrowser.exe</code> to the firewall allowed programs list.</li>\n<li>Installed SQL Server Native Client 2008 R2 on the client PC.</li>\n</ol>\n\n<p>I could connect locally to my database using the server IP but I get the following error when attempting to connect from the remote client to the server:</p>\n\n<blockquote>\n  <p><em>err.description is: [Microsoft][ODBC SQL Server Driver][DBNETLIB]SQL Server does not exist or access denied.</em></p>\n</blockquote>\n\n<p>Strangely enough, I could connect from the remote client using <code>sqlcmd</code>. I also have to mention that I am currently using my laptop to hold my test database. It's IP is assigned by the DCHP server from work and always remains the same.</p>\n\n<p>Is my code incorrect or do I have to make additional server/client configurations? Any help is appreciated.</p>\n\n<p>Thank you for reading and have a great day,<br>\nK33p3r</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":40,"score":0,"question_id":12776440,"title":"bulk data updates in sql server","body":"<p>I have two huge tables in sql server 2008. Table first has user’s data and table second has user related information\nIn table first have 10000 users and second table have 1 user *66 mean one user have 66 rows in second table (10000*66=660000 records in second table). I want to update all users’ info in second table. If anyone know the best way to update records.\nCurrently it will take 5 hours to update. Please help </p>\n\n<p>Ok let me explain my query\nI have 10000 users in first table \nEach time I am taking first user and take their records from second table in temp table and sort the temp table by their max rankid then after I am going to update second table based on rankid.</p>\n\n<p>First table (Structure)                 </p>\n\n<pre><code>UserID  PK ,Cluster index\n</code></pre>\n\n<p><strong>Data</strong></p>\n\n<pre><code>UserID\n1\n2\n3\n</code></pre>\n\n<p><strong>Second table(Structure)</strong></p>\n\n<pre><code>UserID          FK , non cl index   \nRankID          Int, non cl index   \nSecondtblID PK cluster index    \nSel4RankID  Int non cl index    \n</code></pre>\n\n<p>Data</p>\n\n<pre><code>UserID  RankID  SecondtblID  Sel4RankID(by default all 0)\n1       8       1            0\n1       2       2            0\n1       4       3            0\n1       7       4            0\n</code></pre>\n\n<h1>temp table(structure)</h1>\n\n<pre><code>UserID int\nRankID Int\nSel4RankID Int\nSecondtblID Int \n</code></pre>\n\n<p>Data of single user</p>\n\n<pre><code>UserID  RankID  Sel4RankID  SecondtblID\n1       8       1           1\n1       7       1           2\n1       4       0           3\n1       2       0           4\n</code></pre>\n\n<p>First I am updating Sel4RankID=0 then sort the data in temp table and update the second table with respective id in temp table </p>\n\n<p>hope you will get and understand my problem </p>\n"},{"tags":["database","sql-server-2008","godaddy","database-backups","database-restore"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12776912,"title":"How to export DB from Godaddy?","body":"<p>I formatted my PC, forgot to take DB files from disk and lose db files. Now I want to export database file from my Godaddy account to work in local. I toke backup, but could not restore it, got so error:</p>\n\n<blockquote>\n  <p>System.Data.SqlClient.SqlError: The database was backed up on a server\n  running version 10.50.2796. That version is incompatible with this\n  server, which is running version 10.00.1600. Either restore the\n  database on a server that supports the backup, or use a backup that is\n  compatible with this server. (Microsoft.SqlServer.Smo)</p>\n</blockquote>\n\n<p>How can I take MS SQL SERVER database file from godaddy hosting?</p>\n"},{"tags":["sql","database","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":26,"score":2,"question_id":12776652,"title":"Select top Values For each day of Specified month","body":"<p>I am sorry if the question is silly because i'm new to SQL Server. I want to select top 5 records for each day of specified month.\ne.g. </p>\n\n<pre><code>top 5 records for day 1 in month september\ntop 5 records for day 2 in month september\ntop 5 records for day 3 in month september\n.\n.\ntop 5 records for day 31 in month september\n</code></pre>\n\n<p>and show these all records as a one result.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":171,"score":0,"question_id":12776700,"title":"Using while loop in T-SQL function","body":"<p>Non-database programmer here. It happens so, that I need to create a function in T-SQL which returns workdays count between given dates. I believe that the easiest how it's done is with <strong>while</strong> loop. Problem is, that as soon as I write something like</p>\n\n<pre><code>while @date &lt; @endDate\nbegin\n\nend\n</code></pre>\n\n<p>the statement won't execute, claiming \"incorrect syntax near the keyword 'return'\" (not very helpful). Where's the problem?</p>\n\n<p>P.S. Full code:</p>\n\n<pre><code>ALTER FUNCTION [dbo].[GetNormalWorkdaysCount] (\n@startDate DATETIME,\n@endDate DATETIME\n)   \nRETURNS INT\n\nAS\nBEGIN\n    declare @Count INT,\n            @CurrDate DATETIME\n    set @CurrDate = @startDate\n\n    while (@CurrDate &lt; @endDate)\n    begin\n\n    end\n\n    return @Count\nEND\nGO\n</code></pre>\n"},{"tags":["sql-server-2008","xml-parsing"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12775488,"title":"XML to SQL Server 2008 extract","body":"<p>I need further assistance with extracting records from XML and loading it into a SQL Server table.</p>\n\n<p>I have this as my <code>@xml</code>:</p>\n\n<pre><code>&lt;admin submitter_id=\"login0\" effective_date=\"mm/dd/yyyy\"&gt;\n&lt;rec effected_id=\"login1\" adjustment=\"100.00\" type=\"foo\"&gt;\n&lt;reason reason_id=\"1\" /&gt;\n&lt;reason reason_id=\"2\" /&gt;\n&lt;/rec&gt;\n&lt;rec effected_id=\"login2\" adjustment=\"50.00\" type=\"bar\"&gt;\n&lt;reason reason_id=\"3\" /&gt;\n&lt;/rec&gt;\n&lt;/admin&gt;\n</code></pre>\n\n<p>I need this from a result set:</p>\n\n<pre><code>login0, login1, mm/dd/yyyy, 100.00, foo, 1\nlogin0, login1, mm/dd/yyyy, 100.00, foo, 2\nlogin0, login2, mm/dd/yyyy, 50.00, bar, 3\n</code></pre>\n\n<p>Does that make sense?  The adjustment to the reason_id is one to many.  I have figured out how to extract all the values except for the second line.  I can only obtain the first reason_id and then it proceeds to the next record.  I think this can be beaten with a CROSS APPLY but I cannot get it to work.  Please help!</p>\n\n<p>oh, I may also have received bogus XML.  So if that's wrong, please tell me!</p>\n"},{"tags":["visual-studio-2010","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12775157,"title":"Sql Server 2008 Database Project Delta Deployment","body":"<p>I have created a new Sql 2008 Database Project in Visual Studio 2010.  I imported the database objects and only kept the stored procedures.  That all worked as expected.  Where I have the problem is that it tries to deploy the entire set of procedures each time.  I expect it to only create the deployment script for the delta.  I am pretty sure that I combed every setting, but I can't find it.  So if someone could first validate that this is possible and second tell me where to look. I need to do this because we only deploy the stored procedures with each release, the database schema is not modified.</p>\n"},{"tags":["sql-server-2008","smss"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":117,"score":3,"question_id":12721705,"title":"Make SQL Server 2008 Management Studio's Intellisense ignore case?","body":"<p><strong>2012-10-04：</strong></p>\n\n<p>SQL Server 2008 Management Studio has Intellisense, and it is very helpful, but it is case-sensitive.</p>\n\n<p>For example, I have 3 tables:</p>\n\n<ul>\n<li>Gy_Customer_Email</li>\n<li>Gy_Customer_Para</li>\n<li>gy_customertemp</li>\n</ul>\n\n<p>Here's how Intellisense behaves:</p>\n\n<pre><code>select * from   gy_customer       -- My input\n                gy_customertemp   -- Intellisense suggestion\n\nselect * from   Gy_Customer       -- My input\n                Gy_Customer_Email -- Intellisense suggestion\n                Gy_Customer_Para  -- Intellisense suggestion\n</code></pre>\n\n<p>I want to Intellisense to display all 3 options, regardless of case. How can I do that?</p>\n\n<p><strong>2012-10-08：</strong></p>\n\n<p>Thanks for  Ashley Ross!</p>\n\n<p>I had installed Service Pack 1 for SQLManagementStudio　according to your reference point, But  then issue is still not resolved.</p>\n\n<p>What should i do next?</p>\n\n<p><img src=\"http://i.stack.imgur.com/JzLSa.jpg\" alt=\"enter image description here\"></p>\n\n<p>My SQL Management Studio's option:</p>\n\n<p><img src=\"http://i.stack.imgur.com/rpq0w.jpg\" alt=\"enter image description here\"></p>\n\n<p>My SQL Management Studio's version</p>\n\n<p><img src=\"http://i.stack.imgur.com/4433k.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12773275,"title":"Remove Quotation Marks On All Rows in a Column","body":"<p>I have a column in a table that has values encapsulated in quotation marks (i.e. \"USA\", \"Mexico\", \"Russia\", \"China\", etc.) I would like to remove the quotation marks and leave the rest of the string intact (USA, Mexico, etc.). Is there a simple statement for this?  Or do I need to use a combination of LEFT, RIGHT, and SUBSTRING functions? Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2008","ssas"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12701931,"title":"Delta Deployments OLTP/OLAP SQL Server","body":"<p>I have a requirement to look at Delta deployments of OLTP Database and OLAP Cubes in SQL Server between UAT and Production and I wondered was this capable out-of-the-box with SQL Server?</p>\n\n<p>I know SQL Server Data Tools (SSDT) has a Schema comparison tool but that doesn't meet my requirements (other than schema), we are looking for the DB (Data) and also Cube..</p>\n\n<p>Can a delta on a cube even be done?</p>\n\n<p>Another option might be commercial tools (if they exist)</p>\n\n<p>Cheers</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":12772828,"title":"Cannot Update a Numeric Named Column","body":"<p>I am trying to perform a simple task in SQL Server and receiving an error. I have a table called World.Internet_CountryYear. The table has year columns (i.e. 1960, 1965, etc.) with numerical data in the fields, but the data type for the columns is varchar(max). Currently, the fields that do not have data have \"\" in them, which I would like to replace with 0.00. So, I try to run a simple update command as follows:</p>\n\n<pre><code>UPDATE World.Internet_CountryYear\nSET 1960 = '0.00'\nWHERE 1960 = '\"\"'\n</code></pre>\n\n<p>For some reason, I receive an error saying \"Incorrect syntax near '1960'\"</p>\n\n<p>Is there a problem with the DDL of this table? What am I missing here? I have tried specifying World.Internet_CountryYear.1960 as well, but still receive a similar error: Incorrect syntax near '.1960'</p>\n\n<p>Any suggestions?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":168,"score":0,"question_id":1216128,"title":"Looking for good SQL Server 2008 reference","body":"<p>Does anyone know any good reference or general help for SQL Server 2008?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","encryption","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":596,"score":0,"question_id":8831986,"title":"How to Encrypt SQL Server 2008 Database","body":"<p>I have a database which currently is using by my application. I dodn't want to change <strong>anything</strong> in my application CORE. But I want to encrypt <code>DATA</code> and <code>INFORMATION</code> in which <code>stored</code> or <code>is storing</code> in database.</p>\n\n<p><code>SQL Server 2008</code> (or 2008 R2) should have an internal mechanism to encrypt and decrypt information which given and taken to application.</p>\n\n<p>How to get it to work? Encryption is needed for all of the fields in Database, numerics, strings, booleans, datetimes, etc.</p>\n\n<p>Any help is appriciated</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":12765630,"title":"rewards the products qualify for","body":"<pre><code>products purchased\n--------------------------\nbana\nbana\nbana\nstra\nkiwi\n\nreward requirements table (related to a rewards table)\nreward id, products\n----------------------\n1,bana\n1,bana\n1,bana\n2,stra\n2,bana\n3,stra\n4,cart\n5,bana\n5,bana\n5,oliv\n</code></pre>\n\n<p>Can you help me with sql to get rewards\nthe products purchased qualifies for?</p>\n\n<p>In the case above the reward ids would be:</p>\n\n<pre><code>1\n2\n3\n</code></pre>\n\n<p>If there is a better design that would make the solution easier I welcome those as well. I'm using product names for the sake of easier explaining, I hope. (I'll replace with product ids later)</p>\n"},{"tags":["sql","database","sql-server-2008","tsql","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12769346,"title":"1:1 table relation can't insert new row","body":"<p>I have a table inheritance in my database. I have table \"<code>Item</code>\" and Table \"<code>Something</code>\". <code>Item</code> has <code>ItemId</code> which is <strong>primary key and auto increment</strong>. In table <code>Something</code> I have <code>ItemId</code> which is <strong>primary key (not autoincrement)</strong>. Theese tables are in <strong>1:1</strong> relation.<br/>\nSo I have tried to insert data in those tables but this doesn't work:</p>\n\n<pre><code>...\nDECLARE @itemId int\n\n    INSERT INTO dbo.Items\n    (ItemTypeId,UserId,CreatedOnDate,Title,Description)\n    VALUES\n    (@p_ItemTypeId,@p_UserId,@p_CreatedOnDate,@p_Title,@p_Description)\n\n    SELECT @itemId = SCOPE_IDENTITY()\n\n    INSERT INTO dbo.Something\n    (ItemsId)\n    VALUES\n    (@itemId)\n...\n</code></pre>\n\n<p>This is the error that I get:</p>\n\n<pre><code>The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_Items_Somethings\".\n</code></pre>\n\n<p>Tables create script:</p>\n\n<pre><code>CREATE TABLE [dbo].[Items](\n    [ItemdId] [int] IDENTITY(1,1) NOT NULL,\n    [ItemTypeId] [int] NULL,\n    [UserId] [int] NULL,\n    [CreatedOnDate] [smalldatetime] NULL,\n    [Title] [nvarchar](50) NULL,\n    [Description] [nvarchar](max) NULL,\n\n CONSTRAINT [PK_Items] PRIMARY KEY CLUSTERED \n(\n    [ItemId] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n\nALTER TABLE [dbo].[Items]  WITH CHECK ADD  CONSTRAINT [FK_Items_Somethings] FOREIGN KEY([ItemId])\nREFERENCES [dbo].[Somethings] ([ItemId])\nGO\n\nALTER TABLE [dbo].[Items] CHECK CONSTRAINT [FK_Items_Somethings]\nGO\n\n\nCREATE TABLE [dbo].[Somethings](\n    [ItemId] [int] NOT NULL,\n CONSTRAINT [PK_Somethings] PRIMARY KEY CLUSTERED \n(\n    [ItemId] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n</code></pre>\n"},{"tags":["java","sql","sql-server-2008","jdbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12771180,"title":"Get the primary key value from SQL table using java","body":"<p>I'm using java to insert users to a sql database table. The insert works great. \nHowever, the user id is the primary key and gets auto increment. I want to get the value of the user id after I inserted the new user to the table. </p>\n\n<p>Here is the insert part:</p>\n\n<pre><code>PreparedStatement create_statement;\nStringBuilder sb = new StringBuilder();\nsb.append(\"INSERT INTO \");\nsb.append(this.get_database());\nsb.append(\".dbo.\");\nsb.append(this.get_table());\nsb.append(\" ( username, password, email_addr, first_name, middle_name, last_name, dob, street_addr, phone_num, bio)   \");\nsb.append(\" VALUES( ? , ? , ? , ? , ? , ? , ? , ? , ? , ? );\");\n\ntry {\n    create_statement = this.sql_connection.prepareStatement(sb.toString());\n    create_statement.setString(1, this.username);\n    create_statement.setString(2, this.password);\n    create_statement.setString(3, this.email_addr);\n    create_statement.setString(4, this.first_name);\n    create_statement.setString(5, this.middle_name);\n    create_statement.setString(6, this.last_name);\n    create_statement.setString(7, this.dob);\n    create_statement.setString(8, this.street_addr);\n    create_statement.setString(9, this.phone_num);\n    create_statement.setString(10, this.bio);\n    create_statement.executeUpdate();\n</code></pre>\n\n<p>I'm looking for the answer for an hour, some do it by using <strong>ResultSet</strong>. However, I keep getting errors or null when trying to get the data from <strong>create_statement</strong></p>\n\n<p>Help :(</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12770585,"title":"Insert manually into a table by SQL statement, but key is autoincremented","body":"<p>Let's say I have a table of users and the <code>id</code> column is the primary key and auto incremented. </p>\n\n<p>I want to just try and add user manually by this statement:</p>\n\n<pre><code>INSERT INTO table_name (id, username, password)  \nVALUES (?, Mike, Mike);\n</code></pre>\n\n<p>but I don't want to specify the <code>?</code> value, just want to add to the next row.</p>\n\n<p>Thanks everyone, I forgot to set the id column to auto increment. it works now.</p>\n"},{"tags":["asp.net","sql-server-2008","godaddy","shared-hosting"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":96,"score":-1,"question_id":12762787,"title":"Hosting .net website on GoDaddy while database is on another server","body":"<p>I have two accounts on GoDaddy one Virtual dedicated server and another Shared hosting. I want to host my website on Shared hosting while having database on Virtual dedicated server.</p>\n\n<p>I am able to run this website from my local where connection string is pointing to database hosted on Virtual dedicated server. But when I am trying to host same site on GoDaddy shared hosting. </p>\n\n<p>It throws an error <strong>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified)</strong></p>\n\n<p>I think issue is different as I am able to connect to same database from my local.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["java","sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":12769171,"title":"jdbc.SQLServerException: Login failed for user for any user","body":"<p>I trying to test the connection with my local sql DB. I have this code:</p>\n\n<pre><code>try{\n    Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\").newInstance();\n    DriverManager.getConnection(\"jdbc:sqlserver://localhost:1433;databaseName=SocialFamilyTree;user=SOSCOMP\");\n\n}catch(Exception e){\n    System.out.println(\"Couldn't get database connection.\");\n    e.printStackTrace();\n}\n</code></pre>\n\n<p>I tried many users. my windows user is SOSCOMP and doesn't have a password. I also know that SQL 2008 create users as \"sys\" \"dbo\", I tried these too. I'm always getting:</p>\n\n<pre><code>Couldn't get database connection.\ncom.microsoft.sqlserver.jdbc.SQLServerException: Login failed for user 'SOSCOMP'.\n\n    at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:196)\n    at com.microsoft.sqlserver.jdbc.TDSTokenHandler.onEOF(tdsparser.java:246)\n    at com.microsoft.sqlserver.jdbc.TDSParser.parse(tdsparser.java:83)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.sendLogon(SQLServerConnection.java:2532)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.logon(SQLServerConnection.java:1929)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.access$000(SQLServerConnection.java:41)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection$LogonCommand.doExecute(SQLServerConnection.java:1917)\n    at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:4026)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:1416)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.connectHelper(SQLServerConnection.java:1061)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.login(SQLServerConnection.java:833)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.connect(SQLServerConnection.java:716)\n    at com.microsoft.sqlserver.jdbc.SQLServerDriver.connect(SQLServerDriver.java:841)\n    at java.sql.DriverManager.getConnection(DriverManager.java:579)\n    at java.sql.DriverManager.getConnection(DriverManager.java:243)\n    at FT_Receiver.FT_Receiver.main(FT_Receiver.java:12)\n</code></pre>\n\n<p>Any ideas?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","crystal-reports","crystal-reports-2008","crystal-reports-2010"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12768909,"title":"how to show columns of a table into a row of a crystal report","body":"<p>i am creating a class attendance report with crystal report, i am using stored procedure as data source for report. that stored procedure is returning the record in the form of column\nfor all students for all day like----</p>\n\n<pre><code>&gt; Studid        date          Attendance\n&gt; 0001          01              P\n&gt; 0001          02              P\n&gt; 0001          03              P\n&gt; 0002          01              P\n&gt; 0002          02              P \n&gt; 0002          03              A\n&gt;                 ...           ..               . ...           ..  \n&gt; .\n&gt; \n&gt; And in crystal report i want to display the record like this.......\n&gt; \n&gt; \n&gt; StudID   date1   date2   date3   date4  date5  ...   ...    ...  \n&gt; 0001       P       P       P       ..     ..    ...   ...    ...  \n&gt; 0002       P       P       A       ..     ..    ... \n&gt; ...        ...    ...      ...     ...    ..    ...    ...   ...\n</code></pre>\n\n<p>Any one can help me out.</p>\n\n<p>Thanks In advance</p>\n\n<p>Ravindra</p>\n"},{"tags":["sql-server","sql-server-2008","ssis"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":31,"score":-2,"question_id":12767671,"title":"Migration from ceridian to peoplesoft using Sql server integration services","body":"<p>I need to migrate from CEREDIAN database to PEOPLESOFT using SSIS service, can anybody guide me how to go for it...\n??</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":697,"score":0,"question_id":1558380,"title":"SQL Server equivalent of Javascript UnEscape","body":"<p>I have a table in SQL Server 2008 with a column having the string stored in JavaScript Escape format. When queried from application, I am doing the JavaScript UnEscape of the returned string, so no issues.</p>\n\n<p>How do i UnEscape the string when I directly query the database? Is there any equivalent function for JavaScript UnEscape in SQL?</p>\n"},{"tags":["sql-server-2008","tsql","join","group-by"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12767105,"title":"Update Table by Join and Group by","body":"<p>A Company has many Reviews which has Rating Column itself.</p>\n\n<pre><code>CompID  Ratig\n12  3\n13  3\n17  4\n22  4\n23  5\n24  3\n28  3,2\n</code></pre>\n\n<p>This is what I need to be set to each company by id. <strong>Now Rating In Company Column is</strong> <code>NULL</code>.</p>\n\n<p>I've written something like this:</p>\n\n<pre><code>UPDATE Companies c\nJOIN Reviews r on c.CompanyID = r.CompanyID\nSET c.Rating = AVG(r.rating)\ngroup by r.CompanyID\n</code></pre>\n"},{"tags":["sql-server-2008","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12766804,"title":"How to create a trigger on remote SQL Server 2005/2008 database?","body":"<p>I want to create a trigger on a table that exists on a remote SQL Server 2005/2008 database. I only have read only access to that database. My first question is, is this even possible?</p>\n\n<p>If this is not possible what are my other options, because i want to listen to any changes on that table and perform some calculations.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","asp.net","sql","sql-server-2008","enterprise-library"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":289,"score":1,"question_id":12601992,"title":"Database name is not allowed with a table-valued parameter","body":"<p>I am getting following error when I call the <code>Select</code> function:</p>\n\n<blockquote>\n  <p>The incoming tabular data stream (TDS) remote procedure call (RPC)\n  protocol stream is incorrect. Table-valued parameter 3\n  (\"@SearchTableVar\"), row 0, column 0: Data type 0xF3 (user-defined\n  table type) has a non-zero length database name specified.  Database\n  name is not allowed with a table-valued parameter, only schema name\n  and type name are valid.</p>\n</blockquote>\n\n<p><strong>C# code</strong></p>\n\n<pre><code>//DTO\npublic class SP_SearchEntity_Result\n{\n    public string ID { get; set; }\n    public string NAME { get; set; }\n}\n\n//Businesslogic\npublic IQueryable Select(int PageIndex, int PageSize, List&lt;KeyValuePair&lt;string, string&gt;&gt; SearchBy, List&lt;KeyValuePair&lt;string, System.Data.SqlClient.SortOrder&gt;&gt; SortBy)\n{\n    SqlDatabase obj = (SqlDatabase)DatabaseFactory.CreateDatabase();//System.Configuration.ConfigurationManager.ConnectionStrings[\"MySqlServer\"].ConnectionString\n    return obj.ExecuteSprocAccessor&lt;SP_SearchEntity_Result&gt;(\"SP_SearchEntity\", PageIndex, PageSize, SearchBy.ToDataTable(), SortBy.ToDataTable()).AsQueryable&lt;SP_SearchEntity_Result&gt;();\n}\n\n//Extension methods\npublic static DataTable ToDataTable(this List&lt;KeyValuePair&lt;string, string&gt;&gt; source)\n{\n    DataTable dataTable = new DataTable(\"Test\");\n    dataTable.Columns.Add(\"KEY\",typeof(System.String));\n    dataTable.Columns.Add(\"VALUE\", typeof(System.String));\n\n    foreach (KeyValuePair&lt;string, string&gt; data in source)\n    {\n        var dr = dataTable.NewRow();\n        dr[\"KEY\"] = data.Key;\n        dr[\"VALUE\"] = data.Value;\n        dataTable.Rows.Add(dr);\n    }\n\n    return dataTable;\n}\n\npublic static DataTable ToDataTable(this List&lt;KeyValuePair&lt;string, System.Data.SqlClient.SortOrder&gt;&gt; source)\n{\n    DataTable dataTable = new DataTable(\"Test\");\n    dataTable.Columns.Add(\"KEY\", typeof(System.String));\n    dataTable.Columns.Add(\"VALUE\", typeof(System.String));\n\n    foreach (KeyValuePair&lt;string, System.Data.SqlClient.SortOrder&gt; data in source)\n    {\n        var dr = dataTable.NewRow();\n        dr[\"KEY\"] = data.Key;\n        dr[\"VALUE\"] = data.Value == System.Data.SqlClient.SortOrder.Ascending ? \"ASC\" : \"DESC\";\n        dataTable.Rows.Add(dr);\n    }\n\n    return dataTable;\n}\n</code></pre>\n\n<p><br/>\n<br/>\nThe stored procedure returns two tables in result</p>\n\n<p><strong>SQL proc definition</strong></p>\n\n<pre><code>CREATE TYPE KeyValueTableVariable AS TABLE\n(\n    [KEY] NVARCHAR(800),\n    [VALUE] NVARCHAR(800)\n)\nGO\nCREATE PROCEDURE SP_SearchEntity\n@PageIndex INT=NULL,      \n@PageSize INT=NULL,     \n@SearchTableVar dbo.KeyValueTableVariable READONLY,\n@SortTableVar dbo.KeyValueTableVariable READONLY \nAS\nBEGIN\n    /*Bla bla bla*/\n    SELECT '1' as [ID], 'Nitin' as [NAME]\n    SELECT '1' as [COUNT]\nEND\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","where-clause"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12212758,"title":"Check if datetime is in current date","body":"<p>I am using SQLServer 2008. I have a table X with field Y that is a datetime format. In the WHERE statement of my query I only want to keep the rows where the date of field Y equals the current date.</p>\n\n<p>I have searched the internet but couldnt find an example that works for SQLServer/</p>\n\n<p>Thank you for your help!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12437227,"title":"how to know how many rows will be affected before running a query in microsoft sql server 2008","body":"<p>i've read a bit about ROWCOUNT but its not exactly what im looking for. from my understanding rowcount states the number of rows affected AFTER you run the query. what im looking for is knowing BEFORE you run the query. is this possible?</p>\n"},{"tags":["java","android","sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12765681,"title":"How do I connect to local SQL database using java jdbc","body":"<p>When I try something like this:<br/>\n<strong>Class.forName(\"com.mysql.jdbc.Driver\").newInstance();\nDriverManager.getConnection(\"jdbc:mysql://192.168.2.116:3306/SocialFamilyTree\");</strong> <br/></p>\n\n<p>I get an error: <br/>\n<strong>com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure</strong></p>\n\n<p>Tried:</p>\n\n<pre><code>try{\n    Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\").newInstance();\n    DriverManager.getConnection(\"jdbc:sqlserver://localhost:1433\");\n\n}catch(Exception e){\n    System.out.println(\"Couldn't get database connection.\");\n    e.printStackTrace();\n}\n</code></pre>\n\n<p>and got:</p>\n\n<pre><code>Couldn't get database connection.\nOct 06, 2012 11:15:37 PM com.microsoft.sqlserver.jdbc.SQLServerConnection &lt;init&gt;\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":4,"view_count":52,"score":-4,"question_id":12764197,"title":"new Date + last Time","body":"<p>Parametr @NewDate = '20121005' nvarchar(8)</p>\n\n<p>Source</p>\n\n<pre><code>Id | DocDate                 | CreationDate            | PrintDate \n1  | 2012-10-01 00:44:20.150 | 2012-10-07 00:44:20.150 | 2012-10-07 00:50:20.150\n</code></pre>\n\n<p>Need replace date on NewDate, but time last old</p>\n\n<pre><code>Id | DocDate                 | CreationDate            | PrintDate\n1  | 2012-10-05 00:44:20.150 | 2012-10-05 00:44:20.150 | 2012-10-05 00:50:20.150\n</code></pre>\n"},{"tags":["asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":132,"score":-2,"question_id":12761099,"title":"How to insert multiple images into SQL Server 2008 database directly from any of the folder?","body":"<p>If I don't want to do too much hard work of writing the name of each of 1000s images, then is there is any shortcut to insert multiple images directly from the folder to database. Actually I want to buildup a project Picture gallery in asp.net that contain thousands of images of type like nature, kids etc. and all the info about each image to be stored into the database.</p>\n"},{"tags":[".net","sql-server-2008","sqldatareader"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12695948,"title":"SqlDataReader Convert SQL Signed to .NET Unsigned Integers","body":"<p>Often use SQL Identity as the ID of .NET objects.<br>\nStart the ID at 0 or 1 as don't want the objects to have negative IDs.<br>\nThe ID is presented to users so it needs to be logical to humans.   </p>\n\n<p>Also often use something like ((Int32)key1 &lt;&lt; 32) + key2; for hash<br>\nIf unsigned can so with faster (UInt32)key1 &lt;&lt; 32 | key2;</p>\n\n<p>Since SQL does not have unsigned data type half the range is lost. </p>\n\n<p><strong>What is a good practice for converting from SQL signed to unsigned in .NET?</strong>  </p>\n\n<p><strong>Where the convert goes from 0 to max.</strong><br>\n<strong>A straight cast does not not work as (UInt16)Int16.Min = Int16.Max +1.</strong><br>\n<strong>Need to convert Int16.Min to 0 and Int16.Max to UInt16.Max.</strong>    </p>\n\n<p>In SQL will set the Identity seed to minimum (or minimum +1) for the data type.</p>\n\n<p>Currently have a situation where going to blow through Int32 max but doubt it will ever get past UInt32 max.   If it does get past UInt32 max the app and database will need a full review.</p>\n\n<p>Tried extensions to SqlDataReader and it seems to work.<br>\nWill post as an answer.<br>\nNot yet gone into production so checking SO for something better or warnings about the approach.</p>\n\n<p>Don't need DataTable compatibility as this app uses zero and never will. </p>\n\n<p>We don't use Entity Framework nor SQL LINQ.  Grunge TSQL and SP. </p>\n\n<pre><code>public static class MyExtensions\n{\n    public static UInt16 GetUInt16(this SqlDataReader rdr, int i)\n    {\n        //return (UInt16)rdr.GetInt16(i);  // wrong answer\n        Int16 int16 = rdr.GetInt16(i);\n        UInt16 uint16 = (UInt16)(int16 + 32768);\n        return uint16;\n    }\n    public static UInt32 GetUInt32(this SqlDataReader rdr, int i)\n    {\n        Int32 int32 = rdr.GetInt32(i);\n        UInt32 uint32 = (UInt32)(int32 + 2147483648);\n        return uint32;\n    }\n}  \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","ms-access","ms-access-2007"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":77,"score":-1,"question_id":12740484,"title":"access db and sql server 2008 express how do i link them","body":"<p>Is it possible for someone to connect </p>\n\n<p><code>microsoft access database</code>\n to\n <code>sql server 2008 express</code></p>\n\n<p>i want to view the tables of the access database in ms server and i also want to make queries like</p>\n\n<p><code>CREATE UPDATE JOINS</code> </p>\n\n<p>but i am failing how to do it,any ideas?? or books i can read i have been browing online but i am not getting a straight forward answer...i want to make \n<code>queries and view tables from the sql  server</code> </p>\n\n<p>thanks alot</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":52,"score":0,"question_id":12759693,"title":"IN SQL Server how to list high and low season","body":"<p>For a database SQL Server 2008 I have a list of dates that are either in the high season, top price, or in the low season, low price.\nWe have only three types of duration of stay for wich it is relavant, week Monday till Monday, midweek Monday till Friday, or weekend Friday till Monday\nIs it possible to say in a range that it belongs to the high season or low. \nOn this moment we have just al list of all possible dates and in wich season it belongs.\nIf more info is needed I'll share it.</p>\n"},{"tags":["sql-server","sql-server-2008","microsoft"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5212,"score":0,"question_id":6569508,"title":"Problem in sql server 2008 installation","body":"<p>I'm trying to install Ms sql server 2008 on my win 7 enabled laptop. im facing a problem while selecting the path to install. when i go on choose 'instalation' and then when i click on 'New sql server stand alone installation or add features to an existing installation' it pops up browse dialog box to select installation folder. i selected c:/program files/Microsoft SQL Server/'tried all the folders under this folder.' although it gives me an error msg saying 'c:/program files/Microsoft SQL Server/ is not a valid installation folder. i tried 1000 times. but still im getting the same error. i already had sql server 2005 and i uninstalled it. after that only i'm trying to install ms sql server 2008. what is the problem here? how could i fix this issue?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":83,"score":0,"question_id":12748464,"title":"Optimizing a where clause (short circuiting), SQL Server 2008","body":"<p>How can one optimize this query:</p>\n\n<pre><code>declare @MyParam nvarchar(100) = 25846987;\n\nselect top 100 * from MySelectTable\nwhere\n(MyParam = @MyParam)\nOR\n(@MyParam = 0 and MyParam in (SELECT MyParam FROM aMassiveSlowTable WHERE Id = 'random1'))\nOR\n(@MyParam = 1 and MyParam in (SELECT MyParam FROM aMassiveSlowTable WHERE Id = 'random2'))\nOR\n(@MyParam = 2 and MyParam in (SELECT MyParam FROM aMassiveSlowTable WHERE Id = 'random3'))\n</code></pre>\n\n<p>When i use only this part:</p>\n\n<pre><code>declare @MyParam nvarchar(100) = 25846987;\n\nselect top 100 * from MySelectTable\nwhere\n(MyParam = @MyParam)\n</code></pre>\n\n<p>It returns in 1 second.</p>\n\n<p>When using all the parameters, it takes about 5 minutes. </p>\n\n<p>I believe it's because it's scanning aMassiveSlowTable when all it has to do is match MyParam = @MyParam.</p>\n\n<p>How do I make it skip all the other comparisons if @MyParam matches MyParam? I tried using CASE statements but they don't work with <strong>IN</strong> clauses. I tried rearranging the AND's in the paranthesis and even adding additional filtering to <em>aMassiveSlowTable</em>.</p>\n\n<p>If @MyParam does not match MyParam, it's ok if the query takes a little longer.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12760804,"title":"How come numeric scale returns an additional digit","body":"<p>I have a column that is <code>varchar</code>, and I am trying to convert it to <code>numeric(8,2)</code> to return it like this <code>1.00</code>, but its returning it like this instead <code>1.000</code></p>\n\n<p>Example:</p>\n\n<pre><code> Select \n   Convert(numeric(8,2),WholesaleCost) * 2.2)\n FROM Table\n</code></pre>\n\n<p>This Returns <code>50.900</code></p>\n\n<p>Seems like when I reduce the scale to <code>numeric(8,1)</code> instead of <code>numeric(8,2)</code> it returns how I want it, which is <code>50.90</code></p>\n\n<p>Does anyone know why its doing this? Why its adding an additional scale digit to the result?  Shouldnt it be <code>50.9</code> when i do <code>numeric(8,1)</code>?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12718886,"title":"installing a second instance of SQL Server 2008","body":"<p>I am trying to install second instance of SQL Server 2008 enterprise edition in my window 7 machine using network server, local service, and my admin account. However I keep getting the below error. Can somebody please let me know that which user should I use?</p>\n\n<p>The following error has occurred:</p>\n\n<p><code>is not a valid login or you do not have the permission.</code></p>\n\n<p>Thanks for your help</p>\n"},{"tags":["query","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":899,"score":0,"question_id":2674410,"title":"Is there any way to debug SQL Server 2008 query?","body":"<p>Is there any way to debug a SQL Server 2008 query?</p>\n"},{"tags":["sql-server-2008","substring"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12759412,"title":"Extract string from another string in sql server 2008","body":"<p>i have a table in which i save form html which include image also like this</p>\n\n<pre><code>&lt;img src=\"../UploadedFiles/2143_logo.png\" &gt;\n&lt;img src=\"../UploadedFiles/2343_New_logo.jpeg\" &gt;\n&lt;img src=\"../UploadedFiles/2786_old_logo.bmp\" &gt;\n</code></pre>\n\n<p>i want to extract image name for each record like this</p>\n\n<pre><code>2143_logo.png\n\n2343_New_logo.jpeg\n\n2786_old_logo.bmp\n</code></pre>\n\n<p>i don't know how to get it done please help me out   </p>\n\n<p>thanks in advance</p>\n"},{"tags":["sql-server","performance","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12360558,"title":"SQL Server Intermittent performance on simple select","body":"<p>We are experiencing some intermittent performance issues with queries such as</p>\n\n<pre><code>SELECT * FROM tblUser\n</code></pre>\n\n<p>or  </p>\n\n<pre><code>SELECT * FROM tblUser WITH (NOLOCK)\n</code></pre>\n\n<p>You can run them over and over, returning about 28k records. Most of the time they come back in 3 seconds, and then one in 20 will return in 50 second.</p>\n\n<p>Obviously there are no JOIN or WHERE clause issues, or query plan issues. We have also tried copying that data to another database on a different hard drive, all with the same results.</p>\n\n<p>Running perfmon shows no resource conflicts for memory or CPU.</p>\n\n<p>We have a dedicated SQL Server, running SQL 2008 Enterprise x64 Build 7600 (SP1), on a Windows 2008 R2 Enterprise Build 7600 server. It has 48 CPUs with 256GB of RAM. And lots of disk space. The maximum SQL memory is set to 210GB currently.</p>\n\n<p>And changing MaxDOP has not not helped (we've tried 0, 1, 8, 16, etc.).</p>\n\n<p>The other thing we can see is that when you see the query taking 50 seconds, you can then open up another window in SSMS, run a similar query (say SELECT * FROM otherdb..tblOther) and it will finish at the exact same time as the original query. Both get hung up and then finish together.</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12758836,"title":"Occasional time out stored procedure","body":"<p>I'm facing a weird problem. </p>\n\n<p>I have a site with multiple roles. Every role have a dashboard which contains some display data, charts etc.</p>\n\n<p>Now the problem is for few roles when the user tries to logs in, is getting time out exception occasionally.</p>\n\n<p>In the first instance it looked like problem with the query. But when I re-executed the same stored procedure, everything started working as expected. </p>\n\n<p>Is there any possibility of caching?</p>\n\n<p>Any help in right direction will be highly appreciated.</p>\n\n<p>Note: database version used is SQL Server 2008</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12758370,"title":"Insert back slash in sql server database","body":"<p>I have string with back slash needed to insert into the MS Sql Server 2008 database using following insert sql query:</p>\n\n<pre><code>INSERT INTO Databsename.dbo.tblname\nVALUES     (Getdate(),\n            Getdate(),\n            'NewsHoroscopetest/voice/_06101214132pm014771957.wav',\n            20,\n            '014771045',\n            '01454545') \n</code></pre>\n\n<p>Here, Insertion failed due to back slash in the string value. I have also tried using double back slash. It shows following error:</p>\n\n<pre><code>Msg 8152, Level 16, State 14, Line 1\nString or binary data would be truncated.\nThe statement has been terminated.\n</code></pre>\n\n<p>How can I escape the back slash in above sql?</p>\n"},{"tags":["sql-server-2008","login","asp-classic"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12748795,"title":"Can't log into website having migrated to sql server from mysql","body":"<p>I can seem to get a correct connection to my website have moved from a mysql database to a sql server 2008 r2 db. The website is written in classic asp and uses conn.inc file. The contents of this file is as below. I have <em>*</em>* the password. </p>\n\n<pre><code>&lt;%\nDim strConn\nDim conn\nstrConn = \"Provider=SQLNCLI10;Server=chintranet2;Database=Gremlin;Uid=Gremlin;Pwd=********;\"\nSet conn = Server.CreateObject(\"ADODB.Connection\")\nconn.ConnectionString= strConn\nconn.Open\n%&gt;\n</code></pre>\n\n<p>The error I get is:</p>\n\n<pre><code>Microsoft SQL Server Native Client 10.0 error '80040e4d' \n\nLogin failed for user 'Gremlin'. \n\n/Gremlinv4/connections/conn.inc, line 7 \n</code></pre>\n\n<p>Can anyoine please shed any light on this. The user is created in sql server and has permissions assigned as \"owner\".</p>\n\n<p>Thanks for any help.</p>\n"},{"tags":["asp.net","sql","visual-studio","sql-server-2008","iis7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12757418,"title":"Cannot access my SQL Server database in my website using IIS","body":"<p>My connection string is correct. It works when I debug and run from inside Visual Studio.</p>\n\n<p>My problem is that I need to browse my site from the IIS to be able to access my website from any PC in my network.</p>\n\n<p>When I changed the application pool identity to <code>localsystem</code>, it worked. I am worried that it won't work on any PC in my network, because I have no means to test it. </p>\n\n<p>Can you confirm whether or not it would work? </p>\n"},{"tags":["sql-server-2008","tsql","bulkinsert","bcp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":103,"score":0,"question_id":12755680,"title":"Bulk load data conversion error (overflow)","body":"<p>I have been racking my brain trying to figure out this error. I just don't get it.  </p>\n\n<p>SQL Server Database Error: Bulk load data conversion error (overflow) for row 1, column 1 (CUR_CLM_UNIQ_ID).  </p>\n\n<p>Here is my code:</p>\n\n<pre><code>SET DATEFORMAT ymd;\ngo\nBULK INSERT \naco.PartAClaimsHeader\nFROM 'C:\\Users\\Derek\\Documents\\files\\P.A1000.ACO.CCLF1.D120730.T1251070'\nWITH\n(\n --DATAFILETYPE ='CHAR',\n  FORMATFILE='C:\\Users\\Derek\\Documents\\files\\HeaderFileFormat.xml',\n  --ERRORFILE='C:\\Users\\Derek\\Documents\\files\\ERRORS.TXT',\n  ROWTERMINATOR='\\r\\n',\n  CODEPAGE='RAW',\n -- KEEPNULLS,\n  TABLOCK\n  )\n  GO  \n</code></pre>\n\n<p>It's fixed width.\nHere is  some sample data</p>\n\n<pre><code>00190000777340000000000000109061100000924A 102012-01-182012-02-16323569   ~         0000000003522.44 12010000~1154529360~         1518945500~         \n00158077735600000000000000100256140000646D 602011-07-222011-07-241141401  78650     0000000009238.12 12010247~1992759419159875707215987570721598757072\n0022980857396000000000000010S191274000037A 602012-06-042012-06-08112988   2988      0000000002255.52 12010885~1760429880~         1831184316~         \n</code></pre>\n\n<p>Here is my format file</p>\n\n<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;BCPFORMAT xmlns=\"http://schemas.microsoft.com/sqlserver/2004/bulkload/format\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n&lt;RECORD&gt;\n    &lt;FIELD ID=\"1\" xsi:type=\"CharFixed\" LENGTH=\"13\"/&gt;\n    &lt;FIELD ID=\"2\" xsi:type=\"CharFixed\" LENGTH=\"13\"/&gt;\n    &lt;FIELD ID=\"3\" xsi:type=\"CharFixed\" LENGTH=\"6\"/&gt;\n    &lt;FIELD ID=\"4\" xsi:type=\"CharFixed\" LENGTH=\"11\"/&gt;\n    &lt;FIELD ID=\"5\" xsi:type=\"CharFixed\" LENGTH=\"2\"/&gt;\n    &lt;FIELD ID=\"6\" xsi:type=\"CharFixed\" LENGTH=\"10\"/&gt;\n    &lt;FIELD ID=\"7\" xsi:type=\"CharFixed\" LENGTH=\"10\"/&gt;\n    &lt;FIELD ID=\"8\" xsi:type=\"CharFixed\" LENGTH=\"1\"/&gt;\n    &lt;FIELD ID=\"9\" xsi:type=\"CharFixed\" LENGTH=\"1\"/&gt;\n    &lt;FIELD ID=\"10\" xsi:type=\"CharFixed\" LENGTH=\"7\"/&gt;\n    &lt;FIELD ID=\"11\" xsi:type=\"CharFixed\" LENGTH=\"7\"/&gt;\n    &lt;FIELD ID=\"12\" xsi:type=\"CharFixed\" LENGTH=\"2\"/&gt;\n    &lt;FIELD ID=\"13\" xsi:type=\"CharFixed\" LENGTH=\"17\"/&gt;\n    &lt;FIELD ID=\"14\" xsi:type=\"CharFixed\" LENGTH=\"1\"/&gt;\n    &lt;FIELD ID=\"15\" xsi:type=\"CharFixed\" LENGTH=\"2\"/&gt;\n    &lt;FIELD ID=\"16\" xsi:type=\"CharFixed\" LENGTH=\"2\"/&gt;\n    &lt;FIELD ID=\"17\" xsi:type=\"CharFixed\" LENGTH=\"4\"/&gt;  \n    &lt;FIELD ID=\"18\" xsi:type=\"CharFixed\" LENGTH=\"1\"/&gt;\n    &lt;FIELD ID=\"19\" xsi:type=\"CharFixed\" LENGTH=\"10\"/&gt;\n    &lt;FIELD ID=\"20\" xsi:type=\"CharFixed\" LENGTH=\"10\"/&gt;\n    &lt;FIELD ID=\"21\" xsi:type=\"CharFixed\" LENGTH=\"10\"/&gt;\n    &lt;FIELD ID=\"22\" xsi:type=\"CharFixed\" LENGTH=\"10\"/&gt;\n    &lt;FIELD ID=\"23\" xsi:type=\"CharTerm\" TERMINATOR=\"\\r\\n\"/&gt;\n&lt;/RECORD&gt;\n&lt;ROW&gt;\n    &lt;COLUMN SOURCE=\"1\" NAME=\"c1\" xsi:type=\"SQLINT\"/&gt;\n    &lt;COLUMN SOURCE=\"2\" NAME=\"c2\" xsi:type=\"SQLINT\"/&gt;\n    &lt;COLUMN SOURCE=\"3\" NAME=\"c3\" xsi:type=\"SQLVARYCHAR\"/&gt;\n    &lt;COLUMN SOURCE=\"4\" NAME=\"c4\" xsi:type=\"SQLVARYCHAR\" /&gt;\n    &lt;COLUMN SOURCE=\"5\" NAME=\"c5\" xsi:type=\"SQLTINYINT\" /&gt;\n    &lt;COLUMN SOURCE=\"6\" NAME=\"c6\" xsi:type=\"SQLDATE\"/&gt;\n    &lt;COLUMN SOURCE=\"7\" NAME=\"c7\" xsi:type=\"SQLDATE\"/&gt;\n    &lt;COLUMN SOURCE=\"8\" NAME=\"c8\" xsi:type=\"SQLCHAR\" LENGTH=\"1\"/&gt;\n    &lt;COLUMN SOURCE=\"9\" NAME=\"c9\" xsi:type=\"SQLCHAR\" LENGTH=\"1\" /&gt;\n    &lt;COLUMN SOURCE=\"10\" NAME=\"c10\" xsi:type=\"SQLVARYCHAR\" /&gt;\n    &lt;COLUMN SOURCE=\"11\" NAME=\"c11\" xsi:type=\"SQLVARYCHAR\"/&gt;\n    &lt;COLUMN SOURCE=\"12\" NAME=\"c12\" xsi:type=\"SQLCHAR\" LENGTH=\"2\"/&gt;\n    &lt;COLUMN SOURCE=\"13\" NAME=\"c13\" xsi:type=\"SQLDECIMAL\" SCALE=\"2\" PRECISION=\"17\"/&gt;\n    &lt;COLUMN SOURCE=\"14\" NAME=\"c14\" xsi:type=\"SQLCHAR\" LENGTH=\"1\" /&gt;\n    &lt;COLUMN SOURCE=\"15\" NAME=\"c15\" xsi:type=\"SQLCHAR\" LENGTH=\"2\" /&gt;\n    &lt;COLUMN SOURCE=\"16\" NAME=\"c16\" xsi:type=\"SQLCHAR\" LENGTH=\"2\"/&gt;\n    &lt;COLUMN SOURCE=\"17\" NAME=\"c17\" xsi:type=\"SQLVARYCHAR\"/&gt;\n    &lt;COLUMN SOURCE=\"18\" NAME=\"c18\" xsi:type=\"SQLCHAR\" LENGTH=\"1\"/&gt;\n    &lt;COLUMN SOURCE=\"19\" NAME=\"c19\" xsi:type=\"SQLCHAR\"  LENGTH=\"10\"/&gt;\n    &lt;COLUMN SOURCE=\"20\" NAME=\"c20\" xsi:type=\"SQLCHAR\" LENGTH=\"10\" /&gt;        \n    &lt;COLUMN SOURCE=\"21\" NAME=\"c21\" xsi:type=\"SQLCHAR\"  LENGTH=\"10\"/&gt;        \n    &lt;COLUMN SOURCE=\"22\" NAME=\"c22\" xsi:type=\"SQLCHAR\"  LENGTH=\"10\"/&gt;        \n    &lt;COLUMN SOURCE=\"23\" NAME=\"c23\" xsi:type=\"SQLCHAR\" /&gt;                \n&lt;/ROW&gt;\n&lt;/BCPFORMAT&gt;\n</code></pre>\n\n<p><strong>UPDATE</strong>: I changed the 2 first INT's to VARCHAR in the db and format file and it worked no problem. Would like to keep them INT's though.</p>\n"},{"tags":["sql","sql-server-2008","insert"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":32,"score":-1,"question_id":12757020,"title":"Split a Table into 2 or more Tables based on Column value","body":"<p>I have a Table called \"MIVTable\" which has the following records,</p>\n\n<pre><code>    MIVID      Quantity         Value\n   ------     ----------       --------\n      14           10             3000\n      14           20             3500\n      14           15             2000\n      15           20             3000\n      15           50             7500\n      16           25             2000\n</code></pre>\n\n<p>Here, I need to store the above Table into two tables such as \"HeaderTbl\" and \"DetailTbl\" based on the MIVID as follows:</p>\n\n<p>HeaderTbl:</p>\n\n<pre><code>   HID      MIVID       TotalQuantity    TotalValue\n  -----    -------      -------------    -----------\n    1         14               45           8500 \n    2         15               70          10500\n    3         16               25           2000\n</code></pre>\n\n<p>Here HID is the Primary Key with Identity Column.</p>\n\n<p>DetailTbl:</p>\n\n<pre><code>  HID        MIVID        Quantity        Value\n -----      -------     ------------     -------\n   1           14             10           3000\n   1           14             20           3500\n   1           14             15           2000\n   2           15             20           3000\n   2           15             50           7500\n   3           16             25           2000\n</code></pre>\n\n<p>Suppose, if the MIVTable contains 4 different MIVID means, then 4 row should be created based on the MIVID on the HeaderTbl. How to do this?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":8,"favorite_count":4,"up_vote_count":11,"down_vote_count":0,"view_count":9679,"score":11,"question_id":1883071,"title":"How do I find the data directory for a SQL Server instance?","body":"<p>We have a few <em>huge</em> databases (20GB+) which mostly contain static lookup data.  Because our application executes joins against tables in these databases, they have to be part of each developers local SQL Server (i.e. they can't be hosted on a central, shared database server).  </p>\n\n<p>We plan on copying a canonical set of the actual SQL Server database files (*.mdf and *.ldf) and attach them to each developer's local database.</p>\n\n<p>What's the best way to find out the local SQL Server instance's data directory so we can copy the files to the right place?  This will be done via an automated process, so I have to be able to find and use it from a build script.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12756769,"title":"SQL convert datetime and subtract hours","body":"<p>I am trying to convert a datetime (createTime) field from its default 2012-10-06 02:29:37.243 format to am/pm so I use</p>\n\n<pre><code>convert(varchar, CreateTime, 100) as CreateTime\n</code></pre>\n\n<p>and get <strong>Oct  6 2012  4:29AM</strong>.</p>\n\n<p>So far so good but in the same statement I want to subtract 4 hours and then display the field (GMT issues).</p>\n\n<p>I have gone through some posts here but could not find anything that can do it in single statement.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":37,"score":0,"question_id":12754792,"title":"Both original and updated in the same field sql server","body":"<p>I have this question for you,why would this give me the updated value with the original in the same field\"Ohio\" that was the original...now after proc\"Ohio OH\" I only want the updated value.Th function returns only one value I tested it before using it in the proc. Thanks in advance for looking into it guys.</p>\n\n<pre><code>CREATE PROC [dbo].[Changestringstate] \nAS \n    UPDATE stage.statetable \n    SET    originalstatename = Rtrim(originalstatename) --avoiding trailing space issues \n\n    UPDATE stage.statetable \n    SET    originalstatename = Replace(originalstatename, \n                               Substring (originalstatename, \n                               Len (originalstatename) - ( \n                               Charindex(' ', Reverse( \n                               originalstatename)) ) + 1, Len(originalstatename) \n                               ), \n           dbo.Changefunction(originalstatename)) \n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures","swap","dynamic-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":12755667,"title":"How I can swap two values in same column with dynamic SQL?","body":"<p>I am using SQL Server 2008.</p>\n\n<p>I have many tables, each table contains <strong>ID</strong> field and <strong>TheOrder</strong> field.</p>\n\n<p>I want to create a <strong>stored procedure</strong> which can swap values of two records in <strong>TheOrder</strong> field.</p>\n\n<p>I am getting the <strong>IDs</strong> of these records by <strong>ASP.NET</strong> code and pass them to the stored procedure.</p>\n\n<p>But because I want to execute this <strong>stored procedure</strong> on many tables, I have to use dynamic SQL and pass table name from <strong>ASP.NET</strong> code.</p>\n\n<p>My <strong>stored procedure</strong> code is:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[SwapOrders]\n    @TblName nvarchar(20)\n    , @ID1 int\n    , @ID2 int\nAS\nBEGIN\n    DECLARE @ID1Str nvarchar(5)\n    SET @ID1Str = CAST(@ID1 AS nvarchar)\n    DECLARE @ID2Str nvarchar(5)\n    SET @ID2Str = CAST(@ID2 AS nvarchar)\n    DECLARE @Order1 nvarchar(5)\n    DECLARE @Order2 nvarchar(5)\n    DECLARE @Cmd nvarchar(100)\n    /* Get orders */\n    SET @Cmd = 'SELECT @Order1 = [TheOrder] FROM ' + @TblName + ' WHERE ID = ' + @ID1Str\n    EXECUTE sp_executesql @Cmd, \"@Order1 nvarchar(5) OUTPUT\", @Order1 = [TheOrder]\n    SET @Cmd = 'SELECT @Order2 = [TheOrder] FROM ' + @TblName + ' WHERE ID = ' + @ID2Str\n    EXECUTE sp_executesql @Cmd, \"@Order2 nvarchar(5) OUTPUT\", @Order2 = [TheOrder]\n    /* Update orders */\n    SET @Cmd = 'UPDATE ' + @TblName + ' SET TheOrder = @Order2 WHERE ID = ' + @ID1Str\n    EXECUTE sp_executesql @Cmd, \"@Order2 nvarchar(5)\", @Order2\n    SET @Cmd = 'UPDATE ' + @TblName + ' SET TheOrder = @Order1 WHERE ID = ' + @ID2Str\n    EXECUTE sp_executesql @Cmd, \"@Order1 nvarchar(5)\", @Order1\nEND\nGO\n</code></pre>\n\n<p>When I tested this code, two values of <strong>TheOrder</strong> field become <strong>NULL</strong>.</p>\n\n<p>What is the problem?</p>\n\n<p>Thanks very much for any help, and I am sorry for long question.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12756367,"title":"Identify DB dependency","body":"<p>How to identify database dependencies in SQL Server 2008? Find below what I have tried thus far but I am not convinced myself as I think sysobjects, syscomments, syscolumns are of SQL Server 2000 versions. May be I could just change them to sys.objects, sys.comments and sys.columns but is that the optimized way of doing it in SQL Server 2008? Or do we have better methods to achieve this?</p>\n\n<p>I have read about sys_modules and am not sure whether that is what is the way to go? If so, how to make use of it for this case.</p>\n\n<pre><code>SELECT DISTINCT\n    CASE SO.type \n        WHEN 'C' THEN 'Check Constraint'\n        WHEN 'D' THEN 'Default Constraint'\n        WHEN 'F' THEN 'FK Constraint'\n        WHEN 'FN' THEN 'Scalar Function'\n        WHEN 'L' THEN 'Log'\n        WHEN 'P' THEN 'Stored Procedure'\n        WHEN 'K' THEN 'PK Constraint'\n        WHEN 'RF' THEN 'REPL Filter Stored Proc'\n        WHEN 'S' THEN 'System Table'\n        WHEN 'TF' THEN 'Table Function'\n        WHEN 'TR' THEN 'Trigger'\n        WHEN 'U' THEN 'User Table'\n        WHEN 'UQ' THEN 'Unique Constraint'\n        WHEN 'V' THEN 'View'\n        WHEN 'X' THEN 'Extended Stored Proc'\n    ELSE SO.type\n    END AS 'ObjectType'\n    , SO.name AS 'ObjectName'\nFROM \n    dbo.sysobjects AS SO WITH (NOLOCK)\n    LEFT JOIN \n    dbo.syscomments AS SC WITH (NOLOCK) ON SC.id = SO.id\n    LEFT JOIN \n    dbo.syscolumns AS SCol WITH (NOLOCK) ON SCol.id = SO.id\n    AND SCol.name LIKE ('%' + @FindString + '%')\nWHERE \n    SO.name NOT LIKE 'sys%'\n    AND \n        (\n            SO.name      LIKE  ('%' + @FindString + '%')\n            OR SC.text   LIKE  ('%' + @FindString + '%')\n            OR SCol.name LIKE  ('%' + @FindString + '%')\n        )\nORDER by 'ObjectType', 'ObjectName'\n</code></pre>\n\n<p>Have declared @FindString as Varchar(200)!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":12754920,"title":"Insert only Month and Year date to SQL table","body":"<p>I am using MS SQLServer and trying to insert a month/year combination to a table like this:</p>\n\n<pre><code>INSERT INTO MyTable VALUES (1111, 'item_name', '9/1998')\n</code></pre>\n\n<p>apparently, the above command cannot work since</p>\n\n<pre><code>Conversion failed when converting date and/or time from character string.\n</code></pre>\n\n<p>Because <code>9/1998</code> is a bad format. I want to fix this and this column of the table will show something like:</p>\n\n<pre><code>9/1998\n12/1998\n(other records with month/year format) \n...\n</code></pre>\n\n<p>Can someone help me with this? </p>\n\n<p>thank you</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":12754303,"title":"MSSQL 2008 R2 Remote Connection issue","body":"<p>I have installed MSSQL Server 2008 R2 in mixmode, but currently issue is I can't use SQL through ip nor ip with port, even I have enabled TCP/IP and open port in firewall too.</p>\n\n<p>I tried to telnet 127.0.0.1 1433 to check whether its working or not but its not connectinng\nI tried almost every possible things but failed in each.</p>\n\n<p>How do I get this to work?</p>\n"},{"tags":["sql-server-2008","stored-procedures","sql-order-by"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12753857,"title":"Sorting SQL records","body":"<p>I need to sort my SQL stored procedure recordset (shown below) alphabetically (by CustomerName), but also maintaining the sequential order of RecordID (meaning RecordID 2 is above RecordID 3, in relation to ParentID &amp; ID fields).  Any suggestions?  </p>\n\n<pre><code>ID           ParentID         RecordID        CustomerName\n53445347        5344        2                 Witt - 47\n534453475345    53445347    3                 Witt - 45\n534453475346    53445347    3                 Witt - 46\n53445351        5344        2                 Sjob - 51\n534453515348    53445351    3                 Sjob - 48\n534453515349    53445351    3                 Sjob - 49\n534453515350    53445351    3                 Sjob - 50\n53445357        5344        2                 Hal - 57\n534453575355    53445357    3                 Hal - 55\n534453575356    53445357    3                 Hal - 56\n534453577252    53445357    3                 Hal - 52\n53446852        5344        2                 Boston, - 52\n534468526850    53446852    3                 Boston, - 50\n534468526851    53446852    3                 Boston, - 51\n534468527205    53446852    3                 Boston, - 05\n53447884        5344        2                 Agri - 84\n534478847883    53447884    3                 Agri - 83\n534478847957    53447884    3                 Agri - 57\n</code></pre>\n\n<p>The intended output would be like:  </p>\n\n<pre><code>53447884        5344        2                 Agri - 84\n534478847883    53447884    3                 Agri - 83\n534478847957    53447884    3                 Agri - 57\n53446852        5344        2                 Boston, - 52\n534468526850    53446852    3                 Boston, - 50\n534468526851    53446852    3                 Boston, - 51\n534468527205    53446852    3                 Boston, - 05\n53445357        5344        2                 Hal - 57\n534453575355    53445357    3                 Hal - 55\n534453575356    53445357    3                 Hal - 56\n534453577252    53445357    3                 Hal - 52\n53445351        5344        2                 Sjob - 51\n534453515348    53445351    3                 Sjob - 48\n534453515349    53445351    3                 Sjob - 49\n534453515350    53445351    3                 Sjob - 50\n53445347        5344        2                 Witt - 47\n534453475345    53445347    3                 Witt - 45\n534453475346    53445347    3                 Witt - 46\n</code></pre>\n"},{"tags":["sql-server-2008","security"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":42,"score":0,"question_id":12753777,"title":"What hashing algorithm does SQL Server 2008 R2 use for the sa password?","body":"<p>I think it's SHA1, but I'm unsure on how to tell.</p>\n"}]}
{"total":21074,"page":15,"pagesize":100,"questions":[{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12744846,"title":"Sql Convert string value","body":"<p>I want to convert string value to floating such as</p>\n\n<pre><code>User entered value      Expected Result\n1/2                     0.5\n1                       1\n1/4                     0.25\n1 1/2                   1.5\n</code></pre>\n\n<p>How to convert this kind of value in sql server?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12751034,"title":"How to remove anything to the left and included the first instance of a special character in a string ","body":"<p>What is the SQL statement to do the following? Kinda stuck here *scratch head</p>\n\n<ul>\n<li>139G - Hello World (Happy Files)</li>\n<li>140G - Mike Tyson (US -Files)</li>\n</ul>\n\n<p>to become</p>\n\n<ul>\n<li>Hello World (Happy Files)</li>\n<li>Mike Tyson (US -Files)</li>\n</ul>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12752516,"title":"filename in sql procedure","body":"<p>I have this working in T-SQL</p>\n\n<p>insert into provaxml  (arquivo)</p>\n\n<pre><code>sELECT  CAST(BulkColumn AS XML) FROM OPENROWSET(BULK N'C:\\2012-09\\myfile.xml', SINGLE_BLOB)as arquivo\n</code></pre>\n\n<p>i m trying to write a procedure :</p>\n\n<pre><code>alter proc adentro (@nome nvarchar(max))as\ninsert into provaxml  (arquivo)\nsELECT  CAST(BulkColumn AS XML) FROM OPENROWSET(BULK N'C:\\2012-09\\myfile.xml', SINGLE_BLOB)as arquivo \n</code></pre>\n\n<p>How i must write to change the filename by the variable @nome i have try this way but no works </p>\n\n<pre><code> alter proc adentro (@nome nvarchar(max))as\ninsert into provaxml  (arquivo)\nsELECT  CAST(BulkColumn AS XML) FROM OPENROWSET(BULK N @nome, SINGLE_BLOB)as arquivo \n</code></pre>\n\n<p>Thanks in advance</p>\n\n<p>Alejandro</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12753513,"title":"Single rowset in variable","body":"<p>I m stuck at this place. I m trying to get a single rowset value in a variable.</p>\n\n<pre><code>DECLARE @last_timestamp as varchar;\nSET @last_timestamp = SELECT MAX(modify_timestamp) FROM dbo.table1\nPRINT @last_timestamp\n</code></pre>\n\n<p>It is returning the below error</p>\n\n<pre><code>Msg 156, Level 15, State 1, Line 2\nIncorrect syntax near the keyword 'SELECT'.\n</code></pre>\n\n<p>Is Cursor the only solution to this problem. Any help would be helpful ?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12752671,"title":"How to figure out why rows are disappearing from my SQL server?","body":"<p>I'm working with a SQL Server 2008 installation that was maintained for years by another team of programmers.</p>\n\n<p>I'm having a problem that rows of data seem to be mysteriously disappearing from a specific table in my server.</p>\n\n<p>I would like to be able to set up some sort of monitoring system that would tell me when the table is modified, and a summary of the modification.</p>\n\n<p>I think that \"triggers\" might be what I'm looking for, but I've never used them before. Are triggers what I want to use, and if so, what is a good resource for learning to use them? Is there a better solution?</p>\n\n<p>I think that I should mention that the table I'm referring to is not that frequently updated, so I don't think that adding a little bit of overhead should be a big deal, but I would prefer a solution that I can brush away once the problem is resolved.</p>\n"},{"tags":["sql","sql-server-2008","bcp"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12752471,"title":"SQL BCP isn’t working from SQL server 2008 but it does from CMD","body":"<p>I’m using this command to run the BCP in sql server 2008:</p>\n\n<pre><code>SQL: EXEC SEKURA.dbo.SP_REPORTE_AUTOM_CARTERA_PASIVA ''05/10/2012''\nDATE: 5OCT2012\nFILENAME: Cartera_Pasiva_5OCT2012_561608.xls\nFILEROUTE: \\\\409029-WEB1\\SEKURA_REPORTES\\Cartera_Pasiva_5OCT2012_561608.xls\nFILETITLE: Cartera Pasiva 5OCT2012\nBCP: exec master..xp_cmdshell 'BCP \"EXEC SEKURA.dbo.SP_REPORTE_AUTOM_CARTERA_PASIVA ''05/10/2012''\" queryout \\\\409029-WEB1\\SEKURA_REPORTES\\Cartera_Pasiva_5OCT2012_561608.xls -T -w -U -S'\n</code></pre>\n\n<p>And it doesn’t work and I get no error messages.</p>\n\n<p>If I run this command <code>BCP \"EXEC SEKURA.dbo.SP_REPORTE_AUTOM_CARTERA_PASIVA '05/10/2012'\" queryout \\\\409029-WEB1\\SEKURA_REPORTES\\Cartera_Pasiva_5OCT2012_561608.xls -T -w -U -s</code> from CMD it woks just fine.</p>\n\n<p>Im running all this directly from the server.</p>\n\n<p>Please help.</p>\n"},{"tags":["sql-server-2008","business-intelligence","bids"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12749380,"title":"Setup Enviroment Sql server 2008 R2, BIDS, needing samples","body":"<p>I have installed SQL Server 2008 R2 SP3 express edition 64 bits, and the Advanced Services for BIDS. Following an Ebook tutorial I need a SQL Server AdventureWorksDW 2008 R2 sample database as the basis for building an SSAS cube\".</p>\n\n<p>I am supposed to find \"samples\" after installattion in \"C:\\Program Files\\Microsoft SQL\nServer\\100\\Tools\\\" but I have in this dir is \"binn\". Do I need to download these files separately? </p>\n"},{"tags":["sql-server-2008","ssrs-reports","virtual-machine","windows-xp-sp3"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":14,"score":1,"question_id":12751921,"title":"Cannot deploy reports on localhost/reports","body":"<p>I am using Microsoft SQL Server 2008 R2, Sql Server Reporting Services(SSRS) on an xp virtual machine.. I have created a report and am trying to deploy it... but getting this error... </p>\n\n<pre><code>The specified report server URL http://localhost/Reports could not be found. \nVerify the syntax of the URL and that the report server exists.\n</code></pre>\n\n<p>I went to see my \"services\".... SQL Server (SQLEXPRESS) is \"started\", but SQL Server (MSSQLSERVER) is not. When I try to start it, it says</p>\n\n<blockquote>\n  <p>windows could not start the sql server on local computer error code 10048</p>\n</blockquote>\n\n<p>I tried to go in cmd and tried</p>\n\n<pre><code>C:\\Program Files\\Microsoft SQL Server\\MSSQL.1\\MSSQL\\Binn\\sqlservr.exe -sMSSQLSERVER\n</code></pre>\n\n<p>I get this, \nServer Error: 17058, Severity: 16, State: 1.</p>\n\n<p>can someone please help me...</p>\n"},{"tags":["python","database","sql-server-2008","client","twisted"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":12751359,"title":"Options to write a Python Server that will check database consitently for updates and changes","body":"<p>I am a self taught Python programmer and I have an idea for a project that I'd like to use to better my understanding of Socket programming and networking in general.  I was hoping that someone would be able to tell me if I am on the right path, or point me in another direction.<br><br>\nThe general idea is to be able to update a database via a website UI, then a Python Server would then be consistently checking that database for changes. If it notices changes it would then hand out a set of instructions to the first available connected client.<br>\n<br>\nThe objective is to<br>\nA - Create a server that reads from a database.<br>\nB - Create clients that connect to said server from a remote machine.<br>\nC - The server would then consistently read the database and and look for changes, for instance a column that is a Boolean that would signify Run/Don't run. <br>\nD - If say the run Boolean is true, the server than would hand the instructions off to the first available client.<br>\nE - The client itself would then handle updating the database of certain runtime occurrences<br><br>\nQuestions/Concerns<br>\nA - My first concern is the resources it would take to be constantly reading the database and searching for changes. Is there a better way of doing this? Or Could I write a loop to do this and not worry much about it?<br>\nB - I have been reading the documentation/tutorials on Twisted and at this moment this looks like a viable option to be able to handle the connections of multiple clients (20-30 for arguments sake). From what I've read Threading looks to be more of a hassle than it's worth.<br><br>\nAm I on the right track? Any suggestions? Or reading material worth looking at?<br>\nThank you in advance</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12750446,"title":"SQL selecting where all distinct values exist in another column","body":"<p>I have a table in which the first two rows are Company, Year. Each company will have some years, but not necessarily all of them:</p>\n\n<pre><code>ABC | 2010\nABC | 2011\nABC | 2012\nBBC | 2011 //does not have all the years, don't want to select it\n</code></pre>\n\n<p>I'd like to select a list of companies which have ALL the years (not just some of them), but I'm having trouble writing a select query to do that. I imagine this is really easy but I can't figure it out for some reason.</p>\n"},{"tags":["sql-server-2008","sql-server-2005","merge"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12353514,"title":"SQL 2008 Merge Statement - 2008 Source - 2005 Target","body":"<p>Is it safe to say that if I'm trying to create a MERGE statment and run from SQL 2008, both the source and target database must be SQL 2008 or later?</p>\n\n<p>I'm trying to run a MERGE statement on SQL 2008 where the source is a SQL 2008 database and the target is 2005...but I get red squiggles under all 2005 table references.</p>\n"},{"tags":["c#","sql","sql-server-2008","excel","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1352,"score":0,"question_id":6658284,"title":"How to split a large dataset into multiple Excel  spreadsheets using an SSIS package?","body":"<p>I'm facing a problem with an SSIS package. </p>\n\n<ul>\n<li>A query is executed to obtain some data from the DataBase (SQL Server\n2008) (Data Flow Task executed)</li>\n<li>Export the data extracted to an Excel 97-2003 spreadsheet (.xls) using Excel Destination</li>\n</ul>\n\n<p>As most of you know the xls files are limited per sheet to 65,536 rows by 256 columns. So when the query extracts more than the records limit (65,536), the Excel Destination Step fails.</p>\n\n<p>I get the following error messages. </p>\n\n<p><code>Error: 0xC0202009 at Calidad VIDA, Excel Destination [82]: SSIS Error Code DTS_E_OLEDBERROR. An OLE DB error has occurred. Error code: 0x80004005.</code></p>\n\n<p><code>Error: 0xC0209029 at Calidad VIDA, Excel Destination [82]: SSIS Error Code DTS_E_INDUCEDTRANSFORMFAILUREONERROR. The \"input \"Excel Destination Input\" (93)\" failed because error code 0xC020907B occurred, and the error row disposition on \"input \"Excel Destination Input\" (93)\" specifies failure on error. An error occurred on the specified object of the specified component. There may be error messages posted before this with more information about the failure. Error: 0xC0047022 at Calidad VIDA, SSIS.Pipeline: SSIS Error Code DTS_E_PROCESSINPUTFAILED. The ProcessInput method on component \"Excel Destination\" (82) failed with error code 0xC0209029 while processing input \"Excel Destination Input\" (93). The identified component returned an error from the ProcessInput method. The error is specific to the component, but the error is fatal and will cause the Data Flow task to stop running. There may be error messages posted before this with more information about the failure.</code></p>\n\n<p><code>Error: 0xC02020C4 at Calidad VIDA, OLE DB Source [1]: The attempt to add a row to the Data Flow task buffer failed with error code 0xC0047020.</code></p>\n\n<p><code>Error: 0xC0047038 at Calidad VIDA, SSIS.Pipeline: SSIS Error Code DTS_E_PRIMEOUTPUTFAILED. The PrimeOutput method on component \"OLE DB Source\" (1) returned error code 0xC02020C4. The component returned a failure code when the pipeline engine called PrimeOutput(). The meaning of the failure code is defined by the component, but the error is fatal and the pipeline stopped executing. There may be error messages posted before this with more information about the failure.</code></p>\n\n<p>The file needs to be in that format, because the clients don't have newer versions. And they don't want to buy licenses. Does anyone know how to work around with this issue?\nI should use a Script task and make the excel by my own, or I should make a for each loop and create various excels woorkbooks?</p>\n"},{"tags":["c#",".net","asp.net-mvc","sql-server-2008","nhibernate"],"answer_count":7,"favorite_count":5,"up_vote_count":9,"down_vote_count":0,"view_count":625,"score":9,"question_id":12272586,"title":"How do you do Versioning in Nhibernate?","body":"<p>I can't believe it is so hard to get someone to show me a simple working example. It leads me to believe that everyone can only talk like they know how to do it but in reality they don't.</p>\n\n<p>I shorten the post down to only what I want the example to do. Maybe the post was getting to long and scared people away.</p>\n\n<p>To get this bounty I am looking for a WORKING EXAMPLE that I can copy in VS 2010 and run.</p>\n\n<p>What the example needs to do.</p>\n\n<ol>\n<li>Show what datatype should be in my domain for version as a <strong>timestamp</strong> in mssql 2008</li>\n<li>Show nhibernate automatically throwing the \"StaleObjectException\"</li>\n<li>Show me working examples of these 3 scenarios</li>\n</ol>\n\n<p><strong>Scenario 1</strong></p>\n\n<p>User A comes to the site and edits Row1. User B comes(note he can see Row1) and clicks to edit Row1, UserB should be denied from editing the row until User A is finished.</p>\n\n<p><strong>Scenario 2</strong></p>\n\n<p>User A comes to the site and edits Row1. User B comes 30mins later and clicks to edit Row1. User B should be able to edit this row and save. This is because User A took too long to edit the row and lost his right to edit.</p>\n\n<p><strong>Scenario 3</strong></p>\n\n<p>User A comes back from being away. He clicks the update row button and he should be greeted with StaleObjectException.</p>\n\n<p>I am using asp.net mvc and fluent nhibernate. Looking for the example to be done in these.</p>\n\n<hr>\n\n<p><strong>What I tried</strong></p>\n\n<p>I tried to build my own but I can't get it throw the StaleObjectException nor can I get the version number to increment. I tired opening 2 separate browser and loaded up the index page. Both browsers showed the same version number.</p>\n\n<pre><code>public class Default1Controller : Controller\n{\n    //\n    // GET: /Default1/\n\n    public ActionResult Index()\n    {\n        var sessionFactory = CreateSessionFactory();\n\n        using (var session = sessionFactory.OpenSession())\n        {\n            using (var transaction = session.BeginTransaction())\n            {\n                var firstRecord = session.Query&lt;TableA&gt;().FirstOrDefault();\n                transaction.Commit();\n                return View(firstRecord);\n            }\n\n        }\n\n    }\n\n    public ActionResult Save()\n    {\n        var sessionFactory = CreateSessionFactory();\n        using (var session = sessionFactory.OpenSession())\n        {\n            using (var transaction = session.BeginTransaction())\n            {\n                var firstRecord = session.Query&lt;TableA&gt;().FirstOrDefault();\n                firstRecord.Name = \"test2\";\n                transaction.Commit();\n                return View();\n            }\n        }\n    }\n\n    private static ISessionFactory CreateSessionFactory()\n    {\n        return Fluently.Configure()\n            .Database(MsSqlConfiguration.MsSql2008\n                .ConnectionString(c =&gt; c.FromConnectionStringWithKey(\"Test\")))\n            .Mappings(m =&gt; m.FluentMappings.AddFromAssemblyOf&lt;TableA&gt;())\n                             //  .ExposeConfiguration(BuidSchema)\n            .BuildSessionFactory(); \n    }\n\n\n    private static void BuidSchema(NHibernate.Cfg.Configuration config)\n    {\n        new NHibernate.Tool.hbm2ddl.SchemaExport(config).Create(false, true);\n    }\n\n}\n\n\npublic class TableA\n{\n    public virtual Guid Id { get; set; }\n    public virtual string Name { get; set; }\n\n    // Not sure what data type this should be for timestamp.\n    // To eliminate changing to much started with int version\n    // but want in the end timestamp.\n    public virtual int Version { get; set; } \n}\n\npublic class TableAMapping : ClassMap&lt;TableA&gt;\n{\n    public TableAMapping()\n    {\n        Id(x =&gt; x.Id);\n        Map(x =&gt; x.Name);\n        Version(x =&gt; x.Version);\n    }\n}\n</code></pre>\n"},{"tags":["c#","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":12749360,"title":"Restrict access to SQL SERVER 2005 or 2008 Express database to my c# app","body":"<p>I've always found answers here without having to open a thread, but this time I really need advice from specialists.</p>\n\n<p>My Windows Software creates a SQL Server Express Database as it installs, using scripts, and a IIS Server providing data to users through an extranet web-application.</p>\n\n<p>Database engine can be SQL Server 2005 Express or 2008 Express.</p>\n\n<p>My problematic is the following : I want to restrict access to the database to my IIS server, but I can't use a specific Windows account authentication. I actually use the default windows profile but it's of course not a good solution.</p>\n\n<p>I can't use TDE because of eventuality of 2005 database. I don't want to use CDE because of Indexing loose and performance issues.</p>\n\n<p>I of course can't specify database parameters manually.</p>\n\n<p>Is there a way to create schema or SQL Server user from my c# app, and makes my code the only accessor (except local administrators of the computer of course) to my database ?</p>\n\n<p>What my possibilities are? Which one do would you suggest me?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12748547,"title":"SQL I need multiple cases for one column","body":"<p>My previous question was - <a href=\"http://stackoverflow.com/questions/12746573/insert-substring-into-new-column\">insert substring into new column</a></p>\n\n<p>I have two cases I want to run on the same column.</p>\n\n<p>The first -  </p>\n\n<pre><code>SET [ref_id] = CASE \nWHEN CHARINDEX('-', [full_id]) = 4 \nTHEN SUBSTRING([full_id], 1, 3) ELSE NULL\n</code></pre>\n\n<p>The second - </p>\n\n<pre><code>SET [ref_id] = CASE \nWHEN CHARINDEX('ZZZ-', [full_id]) = 1 \nTHEN SUBSTRING([full_id], 5, 3) ELSE NULL\n</code></pre>\n\n<p>My <code>[full_id]</code> column data format is mainly <code>ABC-123D2-45FG67</code> BUT some of it is all numbers or is prefixed with <code>ZZZ-</code> </p>\n\n<p>If the data is only numbers I want the <code>[ref_id]</code> column to be NULL.</p>\n\n<p>If the data is prefixed with <code>ZZZ-</code> I want that part to be skipped.</p>\n\n<p>If the data is not <code>ZZZ-</code> and starts with <code>ABC-</code> I want to copy the <code>ABC</code> (in some cases there is <code>AB-1234</code> and that should be NULL).</p>\n\n<p>My code works fine except that the two strings do not function together and when I run them separately they cancel out the work of the previous query.</p>\n\n<p>How can I run both and end up with NULLS only for the data in formats like <code>123456</code> and <code>AB-1234</code> </p>\n\n<p>Thank you for the help.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":89,"score":-1,"question_id":12743869,"title":"How to group by the each week upto last six week sundays dates in sql?","body":"<p>Currently am working on the report. What i need is\nsample table,</p>\n\n<pre><code>Instance Type   Sep-23  Sep-16  Sep-09  Sep-02  Aug-26  Aug-19\n-------------------------------------------------------------------------\nEarly ASN        4        2      4        1       1       2\nLate ASN         2        1      5        3       1       1\n     Sum         6        3      9        4       2       3\n</code></pre>\n\n<p>But the Actual Table is,</p>\n\n<pre><code>SPGI01_INSTANCE_TYPE_C  SPGI01_CREATE_S\n--------------------------------------------------------------\nEarly ASN                9/17/2012 12:00:00.000\nEarly ASN           9/18/2012 10:06:11.000\nEarly ASN           9/19/2012 8:00:04.000\nEarly ASN           9/20/2012 3:00:05.000\nEarly ASN           9/10/2012 12:00:07.000\nEarly ASN           9/11/2012 12:00:32.000\nEarly ASN           9/3/2012 12:00:17.000\nEarly ASN           9/4/2012 10:06:00.000\nEarly ASN           9/5/2012 8:00:00.000\nEarly ASN           9/6/2012 3:00:00.000\nEarly ASN           8/31/2012 12:00:00.000\nEarly ASN           8/26/2012 12:00:00.000\nEarly ASN           8/14/2012 12:00:00.000\nEarly ASN           8/15/2012 12:00:00.000\nLate ASN            9/17/2012 12:00:00.000\nLate ASN            9/18/2012 10:06:00.000\nLate ASN            9/11/2012 12:00:00.000\nLate ASN            9/3/2012 12:00:00.000\nLate ASN            9/4/2012 10:06:00.000\nLate ASN            9/5/2012 8:00:00.000\nLate ASN            9/6/2012 3:00:00.000\nLate ASN            9/6/2012 2:00:00.000\nLate ASN            8/31/2012 12:00:00.000\nLate ASN            8/31/2012 12:00:00.000\nLate ASN            8/31/2012 12:00:00.000\nEarly ASN           8/15/2012 12:00:00.000\n</code></pre>\n\n<p>I need to group by the \"SPGI01_INSTANCE_TYPE_C\" column and group the each week sunday upto last six week sundays.Here i pasted two sample tables one table is what i want and another table is what i have. Give me the solution for this.</p>\n\n<p>My query is,</p>\n\n<pre><code>SELECT distinct I01.[SPGI01_INSTANCE_TYPE_C],\ncount (I01.[SPGI01_INSTANCE_TYPE_C])\n  FROM [SUPER-G].[dbo].[CSPGI01_ASN_ACCURACY] I01,\n  [SUPER-G].[dbo].[CSPGI50_VALID_INSTANCE_TYPE] I50\n\nwhere\nI01.[SPGA02_BUSINESS_TYPE_C] = 'prod'\nand\nI01.[SPGA03_REGION_C] in( 'ap','na','sa','eu')\nand \nI01.[SPGI01_SUB_BUSINESS_TYPE_C] = 'PRD'\nand\n(I01.[SPGI01_CREATE_S] between '2012-01-01 12:00:00.000' AND DATEADD(day , 7, '2012-01-15 00:00:00.000'))\n\nand\nI01.[SPGI01_EXCEPTIONED_F] = 'N'\nand\nI01.[SPGI01_DISPUTED_F] != 'Y'\nand\nI50.[SPGI50_INSTANCE_TYPE_C] = I01.[SPGI01_INSTANCE_TYPE_C]\nand \nI50.[SPGA04_RATING_ELEMENT_D] = 1\ngroup by I01.[SPGI01_INSTANCE_TYPE_C]\n</code></pre>\n"},{"tags":["sql-server-2008","common-table-expression","rowlocking"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":132,"score":5,"question_id":12168229,"title":"Where to use ROWLOCK, READPAST with CTE, Subquery and Update?","body":"<p>In trying to avoid deadlocks and synchronize requests from multiple services, I'm using ROWLOCK, READPAST.  My question is where should I put it in a query that includes a CTE, a subquery and an update statement on the CTE?  Is there one key spot or should all three places have it (below)?  Or maybe there's a better way to write such a query so that I can select ONLY the rows that will be updated.</p>\n\n<pre><code>alter proc dbo.Notification_DequeueJob\n    @jobs int = null\nas\n\n    set nocount on;\n    set xact_abort on;\n\n    declare @now datetime\n    set @now = getdate();\n\n    if(@jobs is null or @jobs &lt;= 0) set @jobs = 1\n\n    ;with q as (\n        select \n            *, \n            dense_rank() over (order by MinDate, Destination) as dr\n        from \n        (\n            select *, \n                min(CreatedDt) over (partition by Destination) as MinDate\n            from dbo.NotificationJob with (rowlock, readpast)\n        ) nj\n\n    where (nj.QueuedDt is null or (DATEDIFF(MINUTE, nj.QueuedDt, @now) &gt; 5 and nj.CompletedDt is null))\n    and (nj.RetryDt is null or nj.RetryDt &lt; @now)\n    and not exists(\n        select * from dbo.NotificationJob\n        where Destination = nj.Destination\n        and nj.QueuedDt is not null and DATEDIFF(MINUTE, nj.QueuedDt, @now) &lt; 6 and nj.CompletedDt is null)\n    )\n    update t\n        set t.QueuedDt = @now, \n            t.RetryDt = null\n    output \n        inserted.NotificationJobId, \n        inserted.Categories, \n        inserted.Source, \n        inserted.Destination, \n        inserted.Subject, \n        inserted.Message\n    from q as t\n    where t.dr &lt;= @jobs\ngo  \n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","select","in-clause"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3547,"score":3,"question_id":4452539,"title":"sql server - IN clause with multiple fields","body":"<p>Is it possible to include in a \"IN\" clause multiple fields??? something like the following</p>\n\n<pre><code>select * from user\nwhere code, userType in ( select code, userType from userType )\n</code></pre>\n\n<p>thanks</p>\n\n<p>I'm using ms sql server 2008</p>\n\n<p>--</p>\n\n<p>edit: I know this can be achieved with joins and exists (thanks for your answers anyway), I just wanted to know if it could just be done with the IN clause...</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":65,"score":2,"question_id":12746687,"title":"Getting all records including non matching records","body":"<p>I have the following tables</p>\n\n<p>Payment</p>\n\n<p>PayTypeId, Description</p>\n\n<ul>\n<li>0 , Credit  </li>\n<li>1, Debit</li>\n<li>2,Master</li>\n</ul>\n\n<p>ActualPayment\nId,PayTypeId,Amount</p>\n\n<ul>\n<li>1,1,10</li>\n</ul>\n\n<p>Here is the output i am looking at </p>\n\n<p>Id,PayTypeId,Amount</p>\n\n<ul>\n<li>1,0,NULL</li>\n<li>1,1,10</li>\n<li>1,2,NULL</li>\n</ul>\n\n<p>Basically I want all the records of ActualPayment including all payment types.</p>\n\n<p>Here is the query i have used but am not getting any records</p>\n\n<pre><code>select\n*\nfrom #ActualPayments ap \nleft join #Payment p on ap.paytypeid = p.paytypeid \nwhere p.paytypeid is null\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12746573,"title":"insert substring into new column","body":"<p>I have a db where one column contains 2 pieces of data, e.g. first and last name.</p>\n\n<p>The format is roughly <code>ABC-1D23-4F34</code> </p>\n\n<p>I want to copy and insert the first 3 letters, the ABC, into a new column. Lets call these columns <code>[full_id]</code> and <code>[ref_id]</code> </p>\n\n<p>From reading it looks like substring is able to do this but I am doing something wrong here.</p>\n\n<p><code>INSERT INTO [ref_id]</code></p>\n\n<p><code>SUBSTRING([full_id], 1, 3)</code></p>\n\n<p><code>FROM db.Name</code></p>\n\n<p>Thank you for the help.</p>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>The update string worked. But I found that there are issues with my data and it is not all in proper formatting. </p>\n\n<p>Is there a way to write a case where if the substring is not 3 letters it writes a null value?</p>\n\n<p>Thanks again, and sorry for having bad data.</p>\n"},{"tags":["c#","asp.net","sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":12746498,"title":"Pass C# variable and use it as a Column Value in SQL Statement Query","body":"<p>I need to use the value of a variable as one of my fields in my SQL insert query that I am generating.\nIn PHP I do this:</p>\n\n<pre><code>if($currency = \"USD\")\n{\n $columntoinsert = \"USD_Currency\";\n} \nelse\n{\n $columntoinsert = \"\";\n}\n</code></pre>\n\n<p>Then in my SQL statement I would execute the query like so:</p>\n\n<pre><code>$sqlinsertpayment = sqlsrv_query($connect,\"INSERT INTO Payments_TBL(column1,column2,$columntoinsert,columnn)VALUES(????)\",$params) or die(\"An error occurred trying to execute the statement\");  \n</code></pre>\n\n<p>I want to do the same in C#. I have the following code to set the column I want to use</p>\n\n<pre><code>var amountfield = \"\";\n  if (save_currency != \"USD\")\n    {\n      amountcolumn = \"Amount\";\n\n     }\n  else\n   {\n      amountcolumn = \"USD_Amount\";\n   }\n</code></pre>\n\n<p>But I can't execute my sql query in since trying to use <code>amountcolumn</code> in the query string generates an <code>Invalid column name</code> error which is expected. How can I use the variable in this manner: </p>\n\n<pre><code>var sql = new sqlCommand(\"INSERT INTO Payments_TBL(column1,column2,myc#variablevaluehere,column3,....)Values(@value,@value,@value)\",new sqlConnection(conn)); \n</code></pre>\n\n<p>Open to other alternatives. All help will be appreciated.</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":12745782,"title":"Select DateTime column of table in 24 hour format with sql","body":"<p>I have a table with a column <code>ReceivedOn</code> of type <code>DateTime</code>. I am executing a stored procedure with select statement like this:</p>\n\n<pre><code>Select \n    CONVERT(DateTime,ReceivedOn)[Date/Time], MessageText[Event] \nFrom \n    RawFeed \nWhere \n    ATM = (Select Code From ATM Where ATM = @ATMID) \n    AND ReceivedOn Between @From And @To \nOrder By \n    ReceivedOn Desc \n</code></pre>\n\n<p>I am storing stored procedure result in a DataTable object. and showing this object on my <code>.aspx</code> page</p>\n\n<pre><code>dtReturn = sspObj.ExecuteDataTable();\nreturn dtReturn ;\n</code></pre>\n\n<p><code>DataTable</code> object is converting into HTML table using some <strong>function</strong> storing result in table object and adding that to the page</p>\n\n<pre><code>tOutput = Generix.convertDataTable2HTMLTable(dtOutput, true, true, false);\nPage.Controls.Add(tOutput);\n</code></pre>\n\n<p>But instead of displaying values as</p>\n\n<pre><code>2012-10-05 16:40:35.234\n</code></pre>\n\n<p>I get output like this:</p>\n\n<pre><code>2012-10-05 04:40:35 PM\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":44,"score":0,"question_id":12732546,"title":"SQL Server 2008 'sp_syspolicy_purge_history' Function","body":"<p>What does this built-in function do?  What is the \"history\" that it is deleting?</p>\n"},{"tags":["sql-server-2008","datetime-format"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12399674,"title":"How to retrieve records by date ignoring time","body":"<p>I have a table that contains date/time column with values like <code>9/11/2012 11:50:08 AM</code>, <code>9/11/2012 4:06:19 PM</code>, <code>10/11/2012 4:06:19 PM</code></p>\n\n<p>How can I retrieve records that date on <code>'9/11/2012'</code>?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12744062,"title":"Unable to install SQL Server 2008 Express SP1","body":"<p>I am facing difficulties installing the MS SQL Server Express 2008 Service Pack 1. I already have MS SQL Server Express 2008 installed and all I want to do is to install the SP1 however I get following error message even though all features are selected, it still tells me to select one or more features:\n<img src=\"http://i.stack.imgur.com/shu6v.jpg\" alt=\"enter image description here\"></p>\n\n<p>Also just for information, when I open the SQL Server Configuration Manager to manage my SQL Server Services, the following error message is displayed:\n<img src=\"http://i.stack.imgur.com/O9Vr5.jpg\" alt=\"enter image description here\"></p>\n\n<p>If anyone who has faced this and has a solution then please let me know, as my aim is to install management studio, but for that I must have SP1 installed at least, and I'm stuck at that point.\nThanks.</p>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2117,"score":0,"question_id":2465523,"title":"How can I show the Percentage Value On my Legends in Report (Pie Chart)","body":"<p>I'm new to SQL Server. how can I add the values of my Pie Chart to the Legend next to the Series fields? In this case I want the percentage.</p>\n\n<p>For example: </p>\n\n<pre><code>United States 43.2%\nCanada 22%\netc. \n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12742799,"title":"Change row to columns","body":"<p>I have this query:</p>\n\n<pre><code>SELECT     \n   dbo.[Values].Value, dbo.Definition.FieldName, dbo.Definition.DefinitionID\nFROM         \n   dbo.Records AS R \nINNER JOIN\n   dbo.[Values] ON R.RecordID = dbo.[Values].RecordID \nINNER JOIN\n   dbo.Definition ON dbo.[Values].DefinitionID = dbo.Definition.DefinitionID\n</code></pre>\n\n<p>and result is:</p>\n\n<pre><code>Value   FieldName   DefinitionID\n1   test new    6\n4   abc 6\n0   test new    7\n0   abc 7\n34  test new    8\n910 abc 8\n</code></pre>\n\n<p>etc.</p>\n\n<p>I try to get this:</p>\n\n<pre><code>test new | abc | DefinitionID\n1           4     6\n0           0     7\n34          910   8\n</code></pre>\n\n<p>I try to pivot this, but without success. Column <code>dbo.[Values].Value</code> is type of <code>nvarchar(MAX)</code></p>\n"},{"tags":["sql","sql-server-2008","sql-management-studio"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":12742830,"title":"Alias a linked Server in SQL server management studio?","body":"<p>Hoping someone can help - is there a way in SQL server management studio 2008 R2 that I can alias a linked SQL server?</p>\n\n<p>I have a server, added by IP address, to which I do not have the login credentials - however as the connection is already setup I can login ok.</p>\n\n<p>Issue is that, this is a dev environment, prior to a live deployment and the IP I have as a linked server needs to be 'accessible' by my stored procs under a different name, eg 'myserver' not 192.168.xxx.xxx...</p>\n\n<p>Any help much appreciated.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12743066,"title":"Convert Time in SQL not to have millisecond","body":"<p>I have a <code>datetime</code> column in my table but I need to separate it into date and time so here's what I've done so far.</p>\n\n<pre><code>CONVERT(VARCHAR(10), [timeStamp], 103) AS date, CONVERT(TIME, [timestamp]) AS time\n</code></pre>\n\n<p>But the problem is, I'm having milliseconds in the time column (eg. 23:39:55.0000000) so how can I do to have just hour:minute:second only?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12741274,"title":"DataBase mirroring Connectivity Error in 2008 r2","body":"<p>i have checked in local area network mirroring it worked fine but i have two server in static ip it does not having domain Name .i gave the ip and port number in the configuring security\nfor both principal and mirror server and also i created certificate for both server\nwhen i use cmd after creating certificate  in mirror server </p>\n\n<pre><code> ALTER DATABASE MirrorDB SET PARTNER = 'TCP://principalIP:5022';\n</code></pre>\n\n<p>GO</p>\n\n<p>it will show error as</p>\n\n<blockquote>\n  <p>ERROR:Neither the partner nor the witness server instance for database \"MirrorDB\" is available. Reissue the command when at least one of the instances becomes available.</p>\n</blockquote>\n\n<p>then i have set partner off in mirrorDB</p>\n\n<pre><code>ALTER DATABASE MirrorDB SET PARTNER OFF\n</code></pre>\n\n<p>then i have run query</p>\n\n<pre><code>ALTER DATABASE MirrorDB SET PARTNER = 'TCP://principalIP:5022';\n</code></pre>\n\n<p>GO</p>\n\n<p>it executed successfully and then i try to execute in principal server</p>\n\n<pre><code>ALTER DATABASE MirrorDB SET PARTNER = 'TCP://mirror serverip:5022';\n</code></pre>\n\n<p>GO</p>\n\n<p>it will show error as</p>\n\n<blockquote>\n  <p>ERROR:The mirror database, \"MirrorDB\", has insufficient transaction log data to preserve the log backup chain of the principal database.  This may happen if a log backup from the principal database has not been taken or has not been restored on the mirror database.</p>\n</blockquote>\n\n<p>whats the problem can any one help me to synchronize the mirroring please?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":39,"score":-1,"question_id":12742453,"title":"Mapping between login and user","body":"<p>Is it possible to uncouple mapping between login and user database without deleting user ?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12727942,"title":"Can I Group By an Unknown Number of Columns?","body":"<p>I am currently trying to re-write a stored procedure to take into account the normalisation of one of our tables. In the original procedure we have two tables:    </p>\n\n<pre><code>CREATE TABLE #t_batch\n(batch_id   integer, \nthread_group NVARCHAR(60),\ndye_code_1  NVARCHAR(10),\ndye_conc_1  NUMERIC(19, 7),\ndye_code_2  NVARCHAR(10),\ndye_conc_2  NUMERIC(19, 7),\ndye_code_3  NVARCHAR(10),\ndye_conc_3  NUMERIC(19, 7),\ndye_code_4  NVARCHAR(10),\ndye_conc_4  NUMERIC(19, 7),\ndye_code_5  NVARCHAR(10),\ndye_conc_5  NUMERIC(19, 7),\ndye_code_6  NVARCHAR(10),\ndye_conc_6  NUMERIC(19, 7))\n\nCREATE TABLE #t_group\n(group_id   INTEGER IDENTITY(1, 1),\ndye_code_1  NVARCHAR(10),\ndye_conc_1  NUMERIC(19, 7),\ndye_code_2  NVARCHAR(10),\ndye_conc_2  NUMERIC(19, 7),\ndye_code_3  NVARCHAR(10),\ndye_conc_3  NUMERIC(19, 7),\ndye_code_4  NVARCHAR(10),\ndye_conc_4  NUMERIC(19, 7),\ndye_code_5  NVARCHAR(10),\ndye_conc_5  NUMERIC(19, 7),\ndye_code_6  NVARCHAR(10),\ndye_conc_6  NUMERIC(19, 7),\nthread_group NVARCHAR(60), \nnum_batches INTEGER)\n</code></pre>\n\n<p>After a number of actions #t_batch was populated with a number of records. We then inserted data into #t_group in the following way:</p>\n\n<pre><code>INSERT INTO #t_group\n(dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3,\ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group, num_batches)\nSELECT dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3, \ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group, COUNT(batch_id_fk)\nFROM #t_batch\nGROUP BY dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3, \ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group\nORDER BY dye_code_1, dye_conc_1, dye_code_2, dye_conc_2, dye_code_3, dye_conc_3, \ndye_code_4, dye_conc_4, dye_code_5, dye_conc_5, dye_code_6, dye_conc_6, \nthread_group\n</code></pre>\n\n<p>So, we had a series of records that are grouped by the dye columns and a unique group_id for each unique combination of dyes and their concentrations. Also, there is a count of the batch records for each group. </p>\n\n<p>However, since there is in reality no limit to the number of dyes for a batch the tables have been normalised:</p>\n\n<pre><code>CREATE TABLE #t_batch\n(batch_id   INTEGER, \nthread_group NVARCHAR(60))\n\nCREATE TABLE #t_batch_dye\n(batch_id_fk INTEGER, \nstage   INTEGER,\nsequence    INTEGER, \ndye_code    NVARCHAR(10),\ndye_conc    NUMERIC(19,7))\n\nCREATE TABLE #t_group\n(group_id   INTEGER IDENTITY(1, 1),\nthread_group NVARCHAR(60), \nnum_batches INTEGER)\n\nCREATE TABLE #t_group_dye\n(group_id   INTEGER, \nstage   INTEGER,\nsequence    INTEGER,\ndye_code    NVARCHAR(10),\ndye_conc    NUMERIC(19,7))\n</code></pre>\n\n<p>Now, my question is: assuming that we have #t_batch and #t_batch_dye populated and that there are a varying number of #t_batch_dye records for each record in #t_batch, how can I insert records into #t_group with a unique group_id for each unique combination of dyes and their concentrations as well as a count of the batches for each group?</p>\n\n<p>Is this something I could use the PIVOT keyword for? The examples I have found on the web all seem to assume that the number of pivoted fields is known in advance.</p>\n\n<p>Many thanks, </p>\n\n<p>David</p>\n\n<p>Glasgow, Scotland</p>\n\n<hr>\n\n<p>Update:</p>\n\n<p>What I have done is to use a function that returns a concatenated string of codes and concs and used that to group the data.</p>\n\n<pre><code>DECLARE @dyes NVARCHAR(2000)  \n\n SELECT @dyes = ISNULL(@dyes,'') + dye_code + ' ' + convert(nvarchar,      requested_dye_conc) + ' '\n FROM   #t_batch_dye\n WHERE  batch_id_fk = @batch_id\n ORDER BY dye_code ASC\n</code></pre>\n"},{"tags":["sql-server-2008","ssis","execution-time"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":97,"score":1,"question_id":12331497,"title":"optimizing SSIS 2008 package","body":"<p>We are dealing with large data in SQL Server database,<br/>\nNow package execution taking hours to execute.<br/>\nIs there any way/techniques to optimize execution time of the package?<br/>\nI know about <a href=\"http://www.simple-talk.com/sql/ssis/ssis-and-parallelism-the-unseen-minions/\" rel=\"nofollow\">SSIS Parallelism</a>.<br/>\nIs there any other best ways?</p>\n\n<p><strong>Edit:</strong><br/>\nwe are dealing with more than 2 crores of records.<br/>\nSQL server database is the data-source as well as destination (in the same server), And I  used transformations like, Derived column, conditional split, multicast, data conversion, lookup, OLEDB command, OLEDB  destination, OLEDB source, Merge, merge join, sorter, aggregate transformations.</p>\n"},{"tags":["sql-server","sql-server-2008","merge","amazon-ec2","replication"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12322317,"title":"Setting up SQL 2008 Merge Replication between Amazon EC2 instances","body":"<p>Does anyone have step-by-step instructions on how to setup SQL Server 2008 Merge replication between two Amazon Windows EC2 servers?  In particular, I'm having issues configuring the subscription using the remote EC2 Instance server name.  I'm also having issues getting the subscriber instance to access the Snap Shot Folder on the Publisher.</p>\n\n<p>If anyone has successfully configured SQL Server 2008 Merge replication between 2+ Amazon EC2 instances, please let me know how you accomplished it.</p>\n"},{"tags":["sql-server-2008","bulkinsert"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":107,"score":1,"question_id":11803765,"title":"Excluding Content From SQL Bulk Insert","body":"<p>I want to import my IIS logs into SQL for reporting using Bulk Insert, but the comment lines - the ones that start with a # - cause a problem becasue those lines do not have the same number f fields as the data lines.</p>\n\n<p>If I manually deleted the comments, I can perform a bulk insert.</p>\n\n<p>Is there a way to perform a bulk insert while excluding lines based on a match such as : any line that beings with a \"#\".</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","sql-server","sql-server-2008","stored-procedures","output-parameter"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":113,"score":1,"question_id":12739914,"title":"Stored procedure output parameter returning rounded value","body":"<p>I'm using output parameters to return values from a stored procedure. </p>\n\n<p>Declaration in stored procedure is : <code>@GrandTtl DECIMAL(19,3) OUT</code></p>\n\n<p>The <code>SELECT</code> query is:</p>\n\n<pre><code>SET @GrandTtl = (SELECT TOP 1 Bill_Amount \n                 FROM Tbl_Restaurant_Kitchen_Order_Bill_Details \n                 WHERE Bill_Number = @billno)\n</code></pre>\n\n<p>For example, the select query returns the value <code>4087.67</code> then the output parameter value is returned as <code>4088</code> from SQL Server to C#.</p>\n\n<p>Here is the C# code calling the stored procedure:</p>\n\n<pre><code>SqlCommand cmd = new SqlCommand(\"Sp_RestCC_BillDetails\", con);\ncmd.CommandType = CommandType.StoredProcedure;\n\nSqlParameter OutParam26 = cmd.Parameters.Add(\"@GrandTtl\", SqlDbType.Decimal,19);\n\nda = new SqlDataAdapter(cmd);\n\ncon.Open();\nda.Fill(ds, \"dtRestCC_Items\");\ncon.Close();\n\nobjRCCBEL.GrandTtlOut = Convert.ToDecimal(cmd.Parameters[\"@GrandTtl\"].Value);\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2008-r2"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12719266,"title":"How to join two unrelated tables in sql","body":"<p>I have two tables:</p>\n\n<p>Table 1: Formulas</p>\n\n<pre><code>FormulaId    Formula Text\n1            [Qty] * [Rect]\n2            [Qty] * [Al]\n3            [Mt] * [Cat]  \n</code></pre>\n\n<p>Table 2: Context</p>\n\n<pre><code>ContextId    Name\n1            Test 1\n2            Test 2\n3            Test 3\n4            Test 4    \n</code></pre>\n\n<p>I need to join those somehow in sql server 2008 R2 to get a table where for each context id I will have a full list of formulas, i.e.</p>\n\n<p>Result</p>\n\n<pre><code>ContextId    Name     FormulaId    Formula Text    \n1            Test 1   1            [Qty] * [Rect]\n1            Test 1   2            [Qty] * [Al]\n1            Test 1   3            [Mt] * [Cat]\n2            Test 2   1            [Qty] * [Rect]\n2            Test 2   2            [Qty] * [Al]\n2            Test 2   3            [Mt] * [Cat]\n3            Test 3   1            [Qty] * [Rect]\n3            Test 3   2            [Qty] * [Al]\n3            Test 3   3            [Mt] * [Cat]\n4            Test 4   1            [Qty] * [Rect]\n4            Test 4   2            [Qty] * [Al]\n4            Test 4   3            [Mt] * [Cat]\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12609483,"title":"sql server get multiple levels of data","body":"<p>How can I achieve the following using SQL server? I am trying to get page counts in Sitefinity.</p>\n\n<p>The table structure has lot of columns but below are the ones that matter</p>\n\n<pre><code>**Id**                  **parentid**                **title**\n ABC                        DEF                     title1\n XYZ                        DEF                     title2\n LLL                        DEF                     title3\n PPP                        ABC                     title4\n III                        ABC                     title5\n WWW                        PPP                     title6\n</code></pre>\n\n<p>A page can have subpages, and a subpage can have further subpages. In database, a subpage is represented with ID column and the parent page with parentID. How can i get count of children for each parent?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","notepad++","ssis-data-transformations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12738446,"title":"What is the maximum number of records i can see in Notepad++?","body":"<p>I have a file with the name ABC.D110111 which is of 10GB size.\nI have to load this huge data to database table. So i created a DTS package to load from file to table.\nbefore loading i just want to see how many records exist in the file. So i opened it in notepad++. It is showing around 2lakhs records.</p>\n\n<p>Since it is a 10GB file, it will definitely have morethan 2lakhs records. But i am able to see </p>\n\n<p>only 2lakhs. Is there any row limitation in Notepad++? If yes, how many rows or how much size?</p>\n\n<p>If load it as it is by running my DTS package, will i get all records or few records?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","pivot"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12736551,"title":"Query to produce survey summary (PIVOT)","body":"<p>Let's suppose I have two tables:</p>\n\n<pre><code>Question (Id, Text)\nAnswer (Value, QuestionId, Guid)\n</code></pre>\n\n<p>Column <code>Guid</code> groups answers from the same person.</p>\n\n<p>I need a query to produce results like this:</p>\n\n<pre><code>'Question 1' | 'Question 2'\n4            | 3\n1            | NULL\nNULL         | 5\n2            | 6\n9            | NULL\n</code></pre>\n\n<p>Questions texts are transformed into column headers and answers values are in rows. Answers are grouped by <code>Guid</code>, so there are answers from one person in one row. If a person didn't answer particular question, NULL is returned.</p>\n\n<p>Number of questions can vary.</p>\n\n<p>Data used to produce sample results:</p>\n\n<pre><code> Question\n Id   | Text\n 1    | Question 1\n 2    | Question 2\n\n Answer\n Value | QuestionId | Guid\n 4     | 1          | AAA\n 3     | 2          | AAA\n 1     | 1          | BBB\n 5     | 2          | CCC\n 2     | 1          | DDD\n 6     | 2          | DDD\n 9     | 1          | EEE\n</code></pre>\n\n<p>Can you please help me out with a query to produce the results?</p>\n"},{"tags":["sql-server-2008","pagination","limit"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12736770,"title":"Limit for a SQL Server query (to be used for pagination)","body":"<p>I've got a large query that pulls back contacts based upon a search. Here's a simplified example of the query. (Table and field names have been changed to protect the innocent.)</p>\n\n<pre><code>SELECT DISTINCT TOP 20 DB1.FieldID, DB1.Field1, DB.Field2, DB.Field3,\nDB2.Field88, DB3.Field77\nFROM tblLamp DB1\nLEFT JOIN tblSand DB2 ON DB2.FieldID = DB1.FieldID\nLEFT JOIN tblLime DB3 ON DB3.FieldID = DB1.FieldID\nWHERE (Field1 LIKE 'hotwet%' ESCAPE '!' OR Field2 LIKE 'maarten%' ESCAPE '!')\nAND DB2.Field99 != '1111-2222-3333-4444'\nAND (DB1.CreatorID IN (...) OR DB1.OwnerID IN (...) OR DB1.FieldID IN (...))\nORDER BY DB1.Field1 ASC, DB1.Field2 ASC\n</code></pre>\n\n<p>I've found a lot of examples on the web that use ROW_NUMBER() but I haven't been able to get it working with this query. Any ideas?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":12736461,"title":"Best practice when create a subset of data in C#","body":"<p>What would be considered best practice when working with the following scenario?</p>\n\n<p>I have a dataset of ~6 million records total, broken down into 30+ tables with some tables having a few hundred thousand records.  I need to use an api that only allows an insert of 200 records at a time.</p>\n\n<p>I am breaking down the insert by table. Now here is where I am considering the first two options that came to my mind.  I can either get the full dataset for that table and then in C# loop through the dataset only inserting 200 at a time.  Or I can make multiple database calls grabbing 200 records at a time. Creating my object and making the call to the API to insert my records. Which I think I could make the next database call while the other records are being inserted.</p>\n"},{"tags":["c#","sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12736398,"title":"In Microsoft.SqlServer.Management.Smo, what kind of access is User.HasDBAccess referring to?","body":"<p><a href=\"http://msdn.microsoft.com/en-us/library/microsoft.sqlserver.management.smo.user.hasdbaccess%28v=sql.105%29.aspx\" rel=\"nofollow\">Microsoft's documentation</a> pretty much just says that it returns \"a Boolean value that specifies whether the database user has access to the database,\" but what kind of access is it referring to exactly?  Can the user read/write to the database, or does it just mean that you can simply connect to it?  Thanks for any input.</p>\n"},{"tags":["java","sql-server-2008","websphere-7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12631140,"title":"Java - There was an error updating the admin table","body":"<p>I have a method written in java to execute the SQL statment for INSERT,UPDATE and DELETE modes. This was working on WebSphere 6.1 and after upgrading to WebSphere 7.0 it stopped working.</p>\n\n<p>Below is my code :</p>\n\n<pre><code>public void executeSQL() throws SQLException, ParseException, NamingException\n{\n    // Get a Connection from the Connection Pool if the connection is closed\n    Connection dbCon = DriverUtilities.getConnectionFromContext(DriverUtilities.DIRECTPAY_DB);\n\n    // create a Statment object whose ResultSet is  scroll sensitive and with Concurrent Updatable.\n    Statement stmt = dbCon.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_UPDATABLE);\n    dbCon.setAutoCommit(true);\n\n    String strColumn = null;\n    String colName = null;\n    String colVal = null;\n    String colType = null;\n\n    String sql = null;\n\n    try {\n    if (isUpdate | isDelete) {\n        //ResultSet rs = stmt.executeQuery(\"select * from \" + getTableName());\n\n        ResultSet rs = stmt.executeQuery(\"select * from \" + getSqlFrom());\n\n        //Move the ResultSet to the Row Index       \n        rs.absolute(iRowIndex + 1);\n\n        Enumeration enum1 = ColNames.elements();\n\n        int i = 1;\n\n        // Update Block\n        if (isUpdate) {\n            while (enum1.hasMoreElements()) {\n                //column name for update\n                strColumn = (String) enum1.nextElement();\n\n                // value from the screen\n                colVal = (String) requestParams.get(\"post\" + strColumn);\n\n                //get column type\n                colType = colTypeHash.get(strColumn).toString();\n\n                //if colvalue from screen not null then test for the Column type\n                if ((colVal == null) || (colVal.equalsIgnoreCase(\"null\"))){\n                    rs.updateNull(i);                               \n                } else {\n                    if ((colType.equalsIgnoreCase(\"INT\")) || (colType.equalsIgnoreCase(\"SMALLINT\"))) {\n                        if (colVal.trim().length() &gt; 0)\n                            rs.updateInt(i, Integer.parseInt(colVal));\n                    } else if ((colType.equalsIgnoreCase(\"DATETIME\"))) {\n                        if (colVal.trim().length() &gt; 0)\n                            rs.updateTimestamp(i, toTimestamp(colVal));\n                    } else if ((colType.equalsIgnoreCase(\"CHAR\"))) {\n                        //if (colVal.trim().length() &gt; 0)\n                            rs.updateString(i, colVal);\n                    } else if ((colType.equalsIgnoreCase(\"NVARCHAR\"))) {\n                        //if (colVal.trim().length() &gt; 0)\n                            rs.updateString(i, colVal);\n                    } else if ((colType.equalsIgnoreCase(\"VARCHAR\"))) {\n                        //if (colVal.trim().length() &gt; 0)\n                            rs.updateString(i, colVal);\n                    } else if ((colType.equalsIgnoreCase(\"DECIMAL\"))) {\n                        if (colVal.trim().length() &gt; 0)\n                            rs.updateString(i, colVal);\n                    } else if ((colType.equalsIgnoreCase(\"FLOAT\"))) {\n                        if (colVal.trim().length() &gt; 0)\n                            rs.updateDouble(i, Double.parseDouble(colVal));\n                    } else if ((colType.equalsIgnoreCase(\"BIT\"))) {\n                        if (colVal.trim().length() &gt; 0)\n                            rs.updateByte(i, Byte.parseByte(colVal));\n                        //rs.updateDouble(i, Double.parseDouble(colVal));\n                    } else if ((colType.equalsIgnoreCase(\"int identity\"))) {\n                        // ignore it\n                    } else {\n                        System.out.println(\"WARNING DATATYPE UNSUPPORTED in ADMIN: \" + colType);\n                    }\n                }\n\n                i++;\n            }\n            //Setting Identity Insert ON.\n            stmt.executeUpdate(\"SET IDENTITY_INSERT \"+getTableName()+\" ON\");\n            rs.updateRow();\n        }\n\n        //delete block\n        if (isDelete) {\n            rs.deleteRow();\n        }\n\n        rs.close();\n    }\n\n    //Insert Block\n    if (isInsert) {\n        //Setting Identity Insert ON.\n        stmt.executeUpdate(\"SET IDENTITY_INSERT \"+getTableName()+\" ON\");\n        // get the SQL statement for Insert         \n        sql = getSQL();\n\n        int resultFlag = stmt.executeUpdate(sql);\n    }\n    //Setting Identity Insert OFF.\n    stmt.executeUpdate(\"SET IDENTITY_INSERT \"+getTableName()+\" OFF\");\n    stmt.close();\n    dbCon.close();\n\n    } catch (SQLException e) {\n        System.out.println(\"executeSQL failed: \" + sql + \", \" + StackTraces.getStackTrace(e));\n        try {\n            stmt.close();\n        } catch(Exception ee){\n        }\n        try {\n            dbCon.close();\n        } catch(Exception ee){\n        }\n        throw (e);\n\n    } catch (java.lang.NumberFormatException e) {\n        System.out.println(\"executeSQL failed: \" + sql + \", \" + StackTraces.getStackTrace(e));\n        try {\n            stmt.close();\n        } catch(Exception ee){\n        }\n        try {\n            dbCon.close();\n        } catch(Exception ee){\n        }\n        throw (e);\n    }\n}\n</code></pre>\n\n<p>Below is my Error stack trace :</p>\n\n<pre><code>[9/27/12 16:28:06:497 GMT-06:00] 0000002a SystemOut     O ---------------- sql = SELECT  * FROM PRODUCT ------------------------\n[9/27/12 16:28:06:664 GMT-06:00] 0000002a SystemOut     O ERROR: \n[9/27/12 16:28:06:685 GMT-06:00] 0000002a WSRdbManagedC W   DSRA1300E: Feature is not implemented: javax.sql.PooledConnection.addStatementEventListener\n[9/27/12 16:28:37:378 GMT-06:00] 0000002e SystemOut     O executeSQL failed: null, com.microsoft.sqlserver.jdbc.SQLServerException: Cannot find the object \"PRODUCT\" because it does not exist or you do not have permissions.\n    at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:197)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1493)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(SQLServerStatement.java:775)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(SQLServerStatement.java:676)\n    at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:4575)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:1400)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:179)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:154)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeUpdate(SQLServerStatement.java:633)\n    at com.ibm.ws.rsadapter.jdbc.WSJdbcStatement.pmiExecuteUpdate(WSJdbcStatement.java:1693)\n    at com.ibm.ws.rsadapter.jdbc.WSJdbcStatement.executeUpdate(WSJdbcStatement.java:1041)\n    at com.bcbskc.bbb.directpay.admin.AdminTableBean.executeSQL(AdminTableBean.java:313)\n    at com.bcbskc.bbb.directpay.admin.AdminTableBean.manipulateTable(AdminTableBean.java:132)\n    at com.bcbskc.bbb.directpay.actions.ManipulateAdminTableAction.manipulateTable(ManipulateAdminTableAction.java:104)\n    at com.bcbskc.bbb.directpay.actions.ManipulateAdminTableAction.execute(ManipulateAdminTableAction.java:46)\n    at com.bcbskc.bbb.common.uiframework.Controller.doPost(Controller.java:56)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:738)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1657)\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1597)\n    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:131)\n    at com.bcbskc.bbb.common.security.AuthbeanFilter.doFilter(AuthbeanFilter.java:88)\n    at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:188)\n    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:116)\n    at com.ibm.ws.webcontainer.filter.WebAppFilterChain._doFilter(WebAppFilterChain.java:77)\n    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:908)\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:934)\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:502)\n    at com.ibm.ws.webcontainer.servlet.ServletWrapperImpl.handleRequest(ServletWrapperImpl.java:179)\n    at com.ibm.ws.webcontainer.servlet.CacheServletWrapper.handleRequest(CacheServletWrapper.java:91)\n    at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:864)\n    at com.ibm.ws.webcontainer.WSWebContainer.handleRequest(WSWebContainer.java:1583)\n    at com.ibm.ws.webcontainer.channel.WCChannelLink.ready(WCChannelLink.java:186)\n    at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleDiscrimination(HttpInboundLink.java:452)\n    at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleNewRequest(HttpInboundLink.java:511)\n    at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.processRequest(HttpInboundLink.java:305)\n    at com.ibm.ws.http.channel.inbound.impl.HttpICLReadCallback.complete(HttpICLReadCallback.java:83)\n    at com.ibm.ws.tcp.channel.impl.AioReadCompletionListener.futureCompleted(AioReadCompletionListener.java:165)\n    at com.ibm.io.async.AbstractAsyncFuture.invokeCallback(AbstractAsyncFuture.java:217)\n    at com.ibm.io.async.AsyncChannelFuture.fireCompletionActions(AsyncChannelFuture.java:161)\n    at com.ibm.io.async.AsyncFuture.completed(AsyncFuture.java:138)\n    at com.ibm.io.async.ResultHandler.complete(ResultHandler.java:204)\n    at com.ibm.io.async.ResultHandler.runEventProcessingLoop(ResultHandler.java:775)\n    at com.ibm.io.async.ResultHandler$2.run(ResultHandler.java:905)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1604)\n\n[9/27/12 16:28:37:379 GMT-06:00] 0000002e SystemOut     O ManipulateAdminTableAction failed: There was an error updating the admin table.  Please check the data for errors and format. com.microsoft.sqlserver.jdbc.SQLServerException: Cannot find the object \"PRODUCT\" because it does not exist or you do not have permissions.com.microsoft.sqlserver.jdbc.SQLServerException: Cannot find the object \"PRODUCT\" because it does not exist or you do not have permissions.\n    at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:197)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1493)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(SQLServerStatement.java:775)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(SQLServerStatement.java:676)\n    at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:4575)\n    at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:1400)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:179)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:154)\n    at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeUpdate(SQLServerStatement.java:633)\n    at com.ibm.ws.rsadapter.jdbc.WSJdbcStatement.pmiExecuteUpdate(WSJdbcStatement.java:1693)\n    at com.ibm.ws.rsadapter.jdbc.WSJdbcStatement.executeUpdate(WSJdbcStatement.java:1041)\n    at com.bcbskc.bbb.directpay.admin.AdminTableBean.executeSQL(AdminTableBean.java:313)\n    at com.bcbskc.bbb.directpay.admin.AdminTableBean.manipulateTable(AdminTableBean.java:132)\n    at com.bcbskc.bbb.directpay.actions.ManipulateAdminTableAction.manipulateTable(ManipulateAdminTableAction.java:104)\n    at com.bcbskc.bbb.directpay.actions.ManipulateAdminTableAction.execute(ManipulateAdminTableAction.java:46)\n    at com.bcbskc.bbb.common.uiframework.Controller.doPost(Controller.java:56)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:738)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1657)\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.service(ServletWrapper.java:1597)\n    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:131)\n    at com.bcbskc.bbb.common.security.AuthbeanFilter.doFilter(AuthbeanFilter.java:88)\n    at com.ibm.ws.webcontainer.filter.FilterInstanceWrapper.doFilter(FilterInstanceWrapper.java:188)\n    at com.ibm.ws.webcontainer.filter.WebAppFilterChain.doFilter(WebAppFilterChain.java:116)\n    at com.ibm.ws.webcontainer.filter.WebAppFilterChain._doFilter(WebAppFilterChain.java:77)\n    at com.ibm.ws.webcontainer.filter.WebAppFilterManager.doFilter(WebAppFilterManager.java:908)\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:934)\n    at com.ibm.ws.webcontainer.servlet.ServletWrapper.handleRequest(ServletWrapper.java:502)\n    at com.ibm.ws.webcontainer.servlet.ServletWrapperImpl.handleRequest(ServletWrapperImpl.java:179)\n    at com.ibm.ws.webcontainer.servlet.CacheServletWrapper.handleRequest(CacheServletWrapper.java:91)\n    at com.ibm.ws.webcontainer.WebContainer.handleRequest(WebContainer.java:864)\n    at com.ibm.ws.webcontainer.WSWebContainer.handleRequest(WSWebContainer.java:1583)\n    at com.ibm.ws.webcontainer.channel.WCChannelLink.ready(WCChannelLink.java:186)\n    at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleDiscrimination(HttpInboundLink.java:452)\n    at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.handleNewRequest(HttpInboundLink.java:511)\n    at com.ibm.ws.http.channel.inbound.impl.HttpInboundLink.processRequest(HttpInboundLink.java:305)\n    at com.ibm.ws.http.channel.inbound.impl.HttpICLReadCallback.complete(HttpICLReadCallback.java:83)\n    at com.ibm.ws.tcp.channel.impl.AioReadCompletionListener.futureCompleted(AioReadCompletionListener.java:165)\n    at com.ibm.io.async.AbstractAsyncFuture.invokeCallback(AbstractAsyncFuture.java:217)\n    at com.ibm.io.async.AsyncChannelFuture.fireCompletionActions(AsyncChannelFuture.java:161)\n    at com.ibm.io.async.AsyncFuture.completed(AsyncFuture.java:138)\n    at com.ibm.io.async.ResultHandler.complete(ResultHandler.java:204)\n    at com.ibm.io.async.ResultHandler.runEventProcessingLoop(ResultHandler.java:775)\n    at com.ibm.io.async.ResultHandler$2.run(ResultHandler.java:905)\n    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1604)\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12734360,"title":"How do I interpret sp_spaceused() results when trying to determine a table's true size on disk?","body":"<p>I am trying to do some capacity planning based on some current database table sizes in SQL Server 2008. The goal here is to figure out how much disk storage I may potentially need in the future based on \"past weather\". </p>\n\n<p>I didn't see anything in the MSDN doc page for sp_spaceused() about how exactly to interpret the results for one table. \n<a href=\"http://msdn.microsoft.com/en-us/library/ms188776.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms188776.aspx</a></p>\n\n<p>Is it simply a matter of summing: reserved + data + index_size + unused?</p>\n\n<p>Thanks. </p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12731545,"title":"What are the advantages/disadvantages of SQL Server bulk insert?","body":"<p>What are the advantages/disadvantages of SQL Server bulk insert?</p>\n\n<p>advantages/disadvantages vs regular single row inserts while an app is processing data.</p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":12726835,"title":"Execute Stored Proc As","body":"<p>I am preparing MCITIP test, I got a question below. Can anyone give me a code example to demonstrate this? I have been a SQL Server developer for years but never touched anything other than dbo.</p>\n\n<p>You are a database developer on an instance of sql server 2008. \nYour inventory database contains several tables that contain information related to historical inventory transactions.\nYou have created a transact-sql stored procedure that will accept a component type, query the tables in the inventory database, and create another table containing all finished good products that have used the specified component.\nTables referenced in the stored procedure are owned by different database users.\nYou want to allow a user, invllser, to call the stored procedure using transact-sql, but you do not want to grant the user access to the underlying tables. </p>\n\n<p>Which action should you take?</p>\n\n<p><strong>The answer is:</strong></p>\n\n<p>B. Create a proxy user user1, grant user1 the needed permissions, and re-create the stored procedure including an execute as user1 clause. grant invuser permission to execute the stored procedure.</p>\n\n<p><strong>This is the explanation:</strong></p>\n\n<p>To execute the stored procedure successfully, the user calling the stored procedure would require permissions on both the stored procedure and on any underlying database objects referenced by the stored procedure. </p>\n\n<p>You should create a proxy user user1, grant user1 the needed permissions, and re-create the stored procedure including an execute as user1 clause. then, you should grant invuser permission to execute the stored procedure. </p>\n\n<p>in this scenario, you need the stored procedure to run under the security context of a specific user with elevated privileges who has access to objects owned by multiple database users. \nyou want invuser to be able to call the stored procedure without granting invuser permissions on the underlying tables. an ownership chain is created when a database object, such as stored procedure, accesses another database object, such as an underlying table. if a user has access to the stored procedure and the underlying table has the same owner as the stored procedure, then explicit permission to the underlying table is not required. </p>\n\n<p>sql server will only check permissions on the underlying table if it has a different owner. however, you must note that ownership chaining does not occur when the stored procedure contains ddl.in this scenario, the underlying tables are owned by multiple users, and the stored procedure contains ddl.therefore, ownership chaining will not occur. </p>\n\n<p>to allow invuser access, you can use the execute as clause to force the stored procedure to execute with additional privileges. when creating a stored procedure, you can include the execute as clause to specify the security context under which the stored procedure should execute. </p>\n\n<p>you can specify the following values in the execute as clause: \nself: specifies the stored procedure executes under the security context of the current user.\nowner: specifies the stored procedure executes under the security context of the user that owns it. \ncaller: specifies the stored procedure executes under the security context of the user calling it. </p>\n\n<p>user name: specifies the stored procedure executes under the security context of the specified user, regardless of which user called the stored procedure. by default, a stored procedure executes under the security context of the caller. </p>\n\n<p>however, in this scenario you can create a proxy user with additional permissions, user1, and force the stored procedure to run underuser1's security context by creating the stored procedure with the execute as user1 clause. </p>\n\n<p>then, you can grant invuser permission to execute the stored procedure. when invuser executes the stored procedure, it will run with user1's permissions.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":88,"score":-1,"question_id":12733038,"title":"SSIS Row Count with Condition","body":"<p>I have Product table have Productid  and Product_No as Primary key. Now when I process the rows and filter it in Black,Blue,Red,white color category. I know How to filter it but the problem is I have to update the row counts in another table Product_Category(Product_Id as PK). but I have update according to Product_DI.</p>\n\n<p>Explanation:-Filtering Product table with Black color\nProduct table</p>\n\n<pre><code>Product_ID | Product_No | Price | Color\n1          | 1          | 2.50  | Black\n1          | 2          | 0.96  | Black\n1          | 3          | 0.96  | Black\n1          | 4          | 0.96  | Black\n2          | 1          | 0.96  | Black\n2          | 2          | 0.96  | Black\n3          | 1          | 0.96  | Black\n</code></pre>\n\n<p>SO I have to update the Product_Category</p>\n\n<pre><code>Product_ID | Color_CNT\n1          | 4\n2          | 2\n3          | 1\n</code></pre>\n\n<p>Please share your knowledge. Appreciate your help.</p>\n"},{"tags":["java","sql-server-2008","websphere-7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12732957,"title":"java.sql.SQLException: SQL Server version 8 is not supported by this driver. SQL State = 08S01, Error Code = 0","body":"<p>I have upgraded my application to <code>Websphere 7.0</code>from <code>Websphere 6.1.</code> I am using <code>Microsoft SQL server jdbc driver 4.0</code> for this application. When i use <code>sqljdbc4.jar</code> i get the following error when connecting to database for authentication.</p>\n\n<pre><code>  SystemError java.sql.SQLException: SQL Server version 8 is not supported by this driver. SQL State = 08S01, Error Code = 0\n</code></pre>\n\n<p>How to get rid of this.</p>\n"},{"tags":["sql-server-2008","schema"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":12733055,"title":"Sql Server Schemas as Access Control","body":"<p>I am working on splitting a database into two schemas (for two companies). Currently, these companies share a single database (relatively small, less than 5gb). The idea was to split them into two schemas, i.e. db.company1.* and db.company2.*. </p>\n\n<p>What I want to do is make it so the shared IT department shows all the information from both schemas. The idea is inheritance, I guess, both company schemas should \"inherit\" from the dbo schema, and the IT department would use the dbo schema to show all information from both companies in its views.</p>\n\n<p>Is this possible, or do I have to create a dbo schema that unions the tables from both schemas together?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12731026,"title":"Extracting data from the middle of a string in SQL Query","body":"<p>I currently have a SQL query that is displaying several columns of data. In one of those columns I would like to pare down the data to only display what is really needed. The problem is the data I want is in the middle of string. I know what is before the value I need and what is after that is a fixed constant. The rest of the string may change. Is there a way in a SQL query to only display that data?  </p>\n\n<p>Below is an example of the data in the string. I would like to only see the data between the LR and SCCM. </p>\n\n<pre><code>A   %VR1  P  P%V 104.922043 %      Pt 4.902552 psig       PLR2  P  LR **0.350922** sccm      PL 0.001313 dpsig   \n\nR   %VR1  P  P%V 105.017807 %      Pt 4.934245 psig       PLR2  F  LR **5.366095** sccm      PL 0.014557 dpsig     \n\nA   %VR1  P  P%V 100.644852 %      Pt 5.112900 psig       PLR2  P  LR **-0.029057** sccm     PL 0.000377 dpsig     \n\nA   %VR1  P  P%V 101.631256 %      Pt 5.107606 psig       PLR2  P  LR **2.515130** sccm      PL 0.006896 dpsig       \n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":58,"score":3,"question_id":12729920,"title":"Shortcut method for n columns compared against the same constant?","body":"<p>I can't find an answer one way or the other for this. Pretty simple question with very little detail.</p>\n\n<p>Is there a better way to do something like this:</p>\n\n<pre><code>SELECT *\nFROM tablename tn\nWHERE tn.col1 = 1\n      AND tn.col2 = 1\n      AND tn.col3 = 1\n      AND tn.col4 = 1\n      ...\n      AND tn.coln = 1\n</code></pre>\n\n<p>Where multiple columns all have to be compared the same way to a single constant?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":80,"score":3,"question_id":12731046,"title":"Changing ntext column type to varchar(n) in SQL Server","body":"<p>I'm having a problem when converting all table columns with <code>ntext</code> type in my database. I wrote this query in order to alter my columns, but there is a syntax error:</p>\n\n<pre><code>ALTER TABLE mytable ALTER COLUMN mycolumn \nVARCHAR(SELECT MAX(DATALENGTH(mycolumn)) FROM  mytable);\n</code></pre>\n\n<p>Even though <code>SELECT MAX(DATALENGTH(mycolumn)) FROM mytable</code> is returning the correct number, the query cannot be executed.</p>\n\n<p>The syntax error is:</p>\n\n<blockquote>\n  <p><em>Incorrect syntax near the keyword 'select'.(which is inside the\n  <code>varchar</code>)</em></p>\n</blockquote>\n\n<p>How can I solve the problem?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12726148,"title":"Split numeric from character data","body":"<p>It's possible to split this data?</p>\n\n<pre><code>DATA\n----------\nFORD3000\nMILLER1300\n</code></pre>\n\n<p>I want to make it like this:</p>\n\n<pre><code>ENAME | SAL\n------------\nFORD    3000\nMILLER  1300\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":577,"score":0,"question_id":4377761,"title":"Too Long Query Duration in SQL Server 2008 R2 DataCenter","body":"<p>We have a query and <a href=\"http://i.stack.imgur.com/vq0ka.png\" rel=\"nofollow\">this is an actual execution plan</a></p>\n\n<p><a href=\"http://i.stack.imgur.com/Y0DlH.png\" rel=\"nofollow\"><img src=\"http://i.stack.imgur.com/Y0DlH.png\" alt=\"alt text\"></a>\nAs you can see  - Clustered Index Seek takes 99%.\nAlso it seeks on primary keys (type <strong>int</strong>).</p>\n\n<p>Table <em>Source</em> has 275 000 rows.<br>\nTable <em>AuthorSource</em> has 2 275 000 rows.</p>\n\n<p>No partition and compression used.</p>\n\n<p>The problem is that first time execution takes 25-40 seconds. But the second run successively takes 1-2 seconds.</p>\n\n<p>Also we have replication, queue reader, log reader agents running on this server.<br>\nAmount of RAM: 4GB<br>\nSql Server uses: 3.7GB</p>\n\n<p>We think, that sql caches query after first execution for some period of time, and this is the reason, that second run takes only 1-2 seconds.  </p>\n\n<p>But irrespective of cache and other reasons, it is very strange, that primary key index seek query takes 20-40 seconds.</p>\n\n<p><strong>This issue is repeated. Any different parameters</strong> we provide to the query  - we get same results: very long first time query and fast the second and the following.  </p>\n\n<p>May be some additional settings or Resource Governor ability we have to use ?   </p>\n\n<pre><code>        exec sp_executesql N'\nSELECT [Project1].[C1] AS         [C1]\nFROM   ( SELECT CAST(1 AS bit) AS X\n       ) AS [SingleRowTable1]\n       LEFT OUTER JOIN\n              (SELECT [GroupBy1].[A1] AS                        [C1]\n              FROM    ( SELECT COUNT(CAST(1 AS bit)) AS         [A1]\n                      FROM    (SELECT [Extent1].[Mention_ID]                       AS [Mention_ID]                      ,\n                                      [Extent1].[Theme_ID]                         AS [Theme_ID]                        ,\n                                      [Extent1].[Mention_Weight]                   AS [Mention_Weight]                  ,\n                                      [Extent1].[AuthorSource_ID]                  AS [AuthorSource_ID1]                ,\n                                      [Extent1].[Mention_CreationDate]             AS [Mention_CreationDate]            ,\n                                      [Extent1].[Mention_DeletedMark]              AS [Mention_DeletedMark]             ,\n                                      [Extent1].[Mention_AuthorTags]               AS [Mention_AuthorTags]              ,\n                                      [Extent1].[Mention_Tonality]                 AS [Mention_Tonality]                ,\n                                      [Extent1].[Mention_Comment]                  AS [Mention_Comment]                 ,\n                                      [Extent1].[Mention_AdditionDate]             AS [Mention_AdditionDate]            ,\n                                      [Extent1].[UserToAnswer_ID]                  AS [UserToAnswer_ID]                 ,\n                                      [Extent1].[GeoName_ID]                       AS [GeoName_ID]                      ,\n                                      [Extent1].[Geo_ID]                           AS [Geo_ID]                          ,\n                                      [Extent1].[Mention_PermaLinkHash]            AS [Mention_PermaLinkHash]           ,\n                                      [Extent1].[Mention_IsFiltredByAuthor]        AS [Mention_IsFiltredByAuthor]       ,\n                                      [Extent1].[Mention_IsFiltredByGeo]           AS [Mention_IsFiltredByGeo]          ,\n                                      [Extent1].[Mention_IsFiltredBySource]        AS [Mention_IsFiltredBySource]       ,\n                                      [Extent1].[Mention_IsFiltredBySourceType]    AS [Mention_IsFiltredBySourceType]   ,\n                                      [Extent1].[GengineLog_InstanceId]            AS [GengineLog_InstanceId]           ,\n                                      [Extent1].[Mention_PermaLinkBinaryHash]      AS [Mention_PermaLinkBinaryHash]     ,\n                                      [Extent1].[Mention_APIType]                  AS [Mention_APIType]                 ,\n                                      [Extent1].[Mention_IsFilteredByAuthorSource] AS [Mention_IsFilteredByAuthorSource],\n                                      [Extent1].[Mention_IsFavorite]               AS [Mention_IsFavorite]              ,\n                                      [Extent1].[Mention_SpamType]                 AS [Mention_SpamType]                ,\n                                      [Extent1].[MentionContent_ID]                AS [MentionContent_ID]               ,\n                                      [Extent2].[AuthorSource_ID]                  AS [AuthorSource_ID2]                ,\n                                      [Extent2].[Author_ID]                        AS [Author_ID]                       ,\n                                      [Extent2].[Source_ID]                        AS [Source_ID]                       ,\n                                      [Extent2].[Author_Nick]                      AS [Author_Nick]                     ,\n                                      [Extent2].[Author_UrlBinaryHash]             AS [Author_UrlBinaryHash]            ,\n                                      [Extent2].[AuthorSource_Type]                AS [AuthorSource_Type]               ,\n                                      [Extent2].[Author_Url]                       AS [Author_Url]                      ,\n                                      [Extent2].[AuthorSource_Description]         AS [AuthorSource_Description]        ,\n                                      [Extent2].[AuthorSource_Gender]              AS [AuthorSource_Gender]\n                              FROM    [dbo].[Mention]                              AS [Extent1]\n                                      LEFT OUTER JOIN [dbo].[AuthorSource]         AS [Extent2]\n                                      ON      [Extent1].[AuthorSource_ID] = [Extent2].[AuthorSource_ID]\n                              WHERE   (\n                                              [Extent1].[Mention_DeletedMark] &lt;&gt; CAST(1 AS bit)\n                                      )\n                              AND\n                                      (\n                                              [Extent1].[Mention_IsFiltredByAuthor] &lt;&gt; CAST(1 AS bit)\n                                      )\n                              AND\n                                      (\n                                              [Extent1].[Mention_IsFilteredByAuthorSource] &lt;&gt; CAST(1 AS bit)\n                                      )\n                              AND\n                                      (\n                                              [Extent1].[Mention_IsFiltredByGeo] &lt;&gt; CAST(1 AS bit)\n                                      )\n                              AND\n                                      (\n                                              [Extent1].[Mention_IsFiltredBySource] &lt;&gt; CAST(1 AS bit)\n                                      )\n                              AND\n                                      (\n                                              [Extent1].[Mention_IsFiltredBySourceType] &lt;&gt; CAST(1 AS bit)\n                                      )\n                              )                              AS [Filter1]\n                              LEFT OUTER JOIN [dbo].[Source] AS [Extent3]\n                              ON      [Filter1].[Source_ID] = [Extent3].[Source_ID]\n                      WHERE   (\n                                      [Filter1].[Theme_ID] = @p__linq__49557\n                              )\n                      AND\n                              (\n                                      [Extent3].[Source_Type] &lt;&gt; @p__linq__49558\n                              )\n                      ) AS [GroupaBy1]\n              ) AS [Project1]\n       ON     1 = 1\n',N'@p__linq__49557 int,@p__linq__49558 int',@p__linq__49557=7966,@p__linq__49558=8\n</code></pre>\n\n<p><a href=\"http://i.stack.imgur.com/Hn2VL.png\" rel=\"nofollow\">IndexSeeking Performance Information</a></p>\n\n<p>Also we wrote query manually in sql with this simple code:</p>\n\n<pre><code>        Select COUNT(1) from Mention m inner join AuthorSource auth on m.AuthorSource_ID = auth.AuthorSource_ID inner join\n    Source s on auth.Source_ID = s.Source_ID where \n    m.Mention_DeletedMark = 0 AND m.Mention_IsFilteredByAuthorSource = 0 AND m.Mention_IsFiltredByAuthor = 0 \n    AND m.Mention_IsFiltredByGeo = 0 AND m.Mention_IsFiltredBySource = 0 AND m.Mention_IsFiltredBySourceType = 0\n    AND m.Theme_ID = 7966\n    and s.Source_Type &lt;&gt; 8 \n</code></pre>\n\n<p>and execution plan is the same that we posted.</p>\n"},{"tags":["sql-server-2008","triggers","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1280,"score":2,"question_id":10336384,"title":"dynamic sql error: 'CREATE TRIGGER' must be the first statement in a query batch","body":"<p>As part of some administrative tasks, we have many tables that each need a trigger created. The trigger will set a flag and the date in the Audit database when an object has been modified. For simplicity, I have a table with all the objects that need triggers created.</p>\n\n<p>I am trying to generate some dynamic sql to do this for each object, but I am getting this error:<br>\n<code>'CREATE TRIGGER' must be the first statement in a query batch.</code></p>\n\n<p>Here is the code to generate the sql.</p>\n\n<pre><code>CREATE PROCEDURE [spCreateTableTriggers]\nAS\n\nBEGIN\n\nDECLARE @dbname     varchar(50),\n        @schemaname varchar(50),\n        @objname    varchar(150),\n        @objtype    varchar(150),\n        @sql        nvarchar(max),\n        @CRLF       varchar(2)\n\nSET     @CRLF = CHAR(13) + CHAR(10);\n\nDECLARE ObjectCursor CURSOR FOR\nSELECT  DatabaseName,SchemaName,ObjectName\nFROM    Audit.dbo.ObjectUpdates;\n\nSET NOCOUNT ON;\n\nOPEN    ObjectCursor ;\n\nFETCH NEXT FROM ObjectCursor\nINTO    @dbname,@schemaname,@objname;\n\nWHILE @@FETCH_STATUS=0\nBEGIN\n\n    SET @sql = N'USE '+QUOTENAME(@dbname)+'; '\n    SET @sql = @sql + N'IF EXISTS (SELECT * FROM sys.triggers WHERE object_id = OBJECT_ID(N'''+QUOTENAME(@schemaname)+'.[Tiud_'+@objname+'_AuditObjectUpdates]'')) '\n    SET @sql = @sql + N'BEGIN DROP TRIGGER '+QUOTENAME(@schemaname)+'.[Tiud_'+@objname+'_AuditObjectUpdates]; END; '+@CRLF\n    SET @sql = @sql + N'CREATE TRIGGER '+QUOTENAME(@schemaname)+'.[Tiud_'+@objname+'_AuditObjectUpdates] '+@CRLF\n    SET @sql = @sql + N'   ON '+QUOTENAME(@schemaname)+'.['+@objname+'] '+@CRLF\n    SET @sql = @sql + N'   AFTER INSERT,DELETE,UPDATE'+@CRLF\n    SET @sql = @sql + N'AS '+@CRLF\n    SET @sql = @sql + N'IF EXISTS(SELECT * FROM Audit.dbo.ObjectUpdates WHERE DatabaseName = '''+@dbname+''' AND ObjectName = '''+@objname+''' AND RequiresUpdate=0'+@CRLF\n    SET @sql = @sql + N'BEGIN'+@CRLF\n    SET @sql = @sql + N'    SET NOCOUNT ON;'+@CRLF\n    SET @sql = @sql + N'    UPDATE  Audit.dbo.ObjectUpdates'+@CRLF\n    SET @sql = @sql + N'    SET RequiresUpdate = 1'+@CRLF\n    SET @sql = @sql + N'    WHERE   DatabaseName = '''+@dbname+''' '+@CRLF\n    SET @sql = @sql + N'        AND ObjectName = '''+@objname+''' '+@CRLF\n\n    SET @sql = @sql + N'END' +@CRLF\n    SET @sql = @sql + N'ELSE' +@CRLF\n    SET @sql = @sql + N'BEGIN' +@CRLF\n    SET @sql = @sql + N'    SET NOCOUNT ON;' +@CRLF\n    SET @sql = @sql + @CRLF\n    SET @sql = @sql + N'    -- Update ''SourceLastUpdated'' date.'+@CRLF\n    SET @sql = @sql + N'    UPDATE  Audit.dbo.ObjectUpdates'+@CRLF\n    SET @sql = @sql + N'    SET SourceLastUpdated = GETDATE() '+@CRLF\n    SET @sql = @sql + N'    WHERE   DatabaseName = '''+@dbname+''' '+@CRLF\n    SET @sql = @sql + N'        AND ObjectName = '''+@objname+''' '+@CRLF\n    SET @sql = @sql + N'END; '+@CRLF\n\n    --PRINT(@sql);\n    EXEC sp_executesql @sql;\n\n    FETCH NEXT FROM ObjectCursor\n    INTO    @dbname,@schemaname,@objname;\n\nEND\n\nCLOSE ObjectCursor ;\nDEALLOCATE ObjectCursor ;\n\nEND\n</code></pre>\n\n<p>If I use <code>PRINT</code> and paste the code to a new query window, the code executes without any problem.</p>\n\n<p>I have removed the <code>GO</code> statements as this was also giving errors.</p>\n\n<p>What am I missing?<br>\nWhy am I getting an error using <code>EXEC(@sql);</code> or even <code>EXEC sp_executesql @sql;</code>?<br>\nIs this something to do with the context within <code>EXEC()</code>?<br>\nMany thanks for any help.</p>\n"},{"tags":[".net","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12729671,"title":"SQL Server : query with column named 'PLAN' executes but throws an error","body":"<p>We have a table with a column named <code>PLAN</code> which is a keyword. We are using brackets but the query still throws an error. Weird thing is the query still executes. The error makes the .net web context explode of course. Any ideas?</p>\n\n<pre><code>USE [SomeDB]\n\nUPDATE [SomeTable] \nSET [SomeTable].[PLAN] = 2 \nWHERE [SomeTable].[RECNUM] = 1 \n</code></pre>\n\n<p>Microsoft SQL Server 2008 (SP3)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":59,"score":0,"question_id":12726098,"title":"increase counter while using exec","body":"<p>I want to use a counter in a way like the below one:</p>\n\n<pre><code>exec\n('begin insert into ' + @temp07 + ' (FileID,FileName)\nSelect aof_id,aof_fileName from PaFi07(' + @partId + ');\n\nsp_executesql @sqlCounter, N'@intCount int output, @intConst int,  @intCount = @intCount output,  @intConst = @intConst \nend')\n</code></pre>\n\n<p>so how can i let the counter work?</p>\n\n<p>any suggestion that the counter work inside this EXEC command\nTHANX</p>\n"},{"tags":["sql-server","visual-studio-2010","sql-server-2008","ms-access-2007"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12725146,"title":"can't mix order by and group by in sql","body":"<p>I got a problem with sql. i dunno why access and sql server keep show me the error. \nI use phpmyadmin, but no issue. </p>\n\n<p>I have 1 table. My table name is t_data</p>\n\n<pre><code>ID  MasterCode  DetailCode  Description  Item  Status\n1       1           1.1      Resources   Meat     1\n2       1           1.1      Resources   Meat     1\n3       1           1.1      Resources   Meat     1\n4       1           1.1      Resources   Meat     1\n5       3           3.1       Utility    oil      1\n6       2           2.1      Transport   BBM      1\n</code></pre>\n\n<p>I want to query that table and want the result looks like:</p>\n\n<pre><code>MasterCode  Description\n    1       Resources\n    2       Utility\n    3       Transport\n</code></pre>\n\n<p>And here is my sql syntax</p>\n\n<pre><code>\"select MasterCode, Description from t_data group by Description order by MasterCode\"\n</code></pre>\n\n<p>Usually i just use that sql syntax, and i can get what i want. But now i can't.  </p>\n\n<blockquote>\n  <p>you tried to execute a query which does not include the specified expression as an aggregate function.</p>\n</blockquote>\n\n<p>I got that error if i'm using access and sql server. If i'm using phpmyadmin in XAMPP, it working fine. But I don't want to use phpmyadmin. I want to use access or sql server. </p>\n\n<p>I already search on google about that error. and i change my sql into this.</p>\n\n<pre><code>\"select count(*), Description from t_data group by Description \"\n</code></pre>\n\n<p>and<code>\"select a.categoryMaster, b.categoryDesc from t_category a inner join t_category b on a.categoryDetail = b.categoryDetail\"</code></p>\n\n<p>not solved my problem, because i want to get the MasterCode too. </p>\n\n<p>any solution? thanks.  </p>\n"},{"tags":["sql-server","json","sql-server-2008","serialization","deserialization"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12719876,"title":"Can i serialized datetime data JSON in query SQL Server 2008","body":"<p>I have deserialize data date time, and save it in my database table column:</p>\n\n<blockquote>\n  <p>\\/Date(1328029200000+0700)\\/</p>\n</blockquote>\n\n<p>But can I convert it to date format again using query sql?</p>\n"},{"tags":["sql-server-2008","entity-framework","sql-server-2005","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12720738,"title":"Stored procedure execution in Entity Framework in SQL Server 2005","body":"<p>I am using MVC3 and Entity Framework for calling a stored procedure in SQL Server 2008. The procedure has no parameters and in the profiler I get the proc execution as</p>\n\n<pre><code>exec sp_executesql N'sp_GetDashSessionboardRoomTimeSlot', N'@p0 nvarchar(4000)', @p0=NULL\n</code></pre>\n\n<p>This is how I call in the c# code.</p>\n\n<pre><code>SqlParameter sa = null;\nvar query = from dashboardData in TBSCIDBContext.Database.SqlQuery&lt;SessionDashboardData&gt;(\"sp_GetDashSessionboardRoomTimeSlot\", sa)\n            select dashboardData;\n</code></pre>\n\n<p>This works fine. But I have changed my database to SQL Server 2005 and I need to use it </p>\n\n<p>So when I call the same procedure using the same C# code the profiler returns the same exec statement but the sql gives error </p>\n\n<blockquote>\n  <p>Incorrect syntax near 'sp_GetDashSessionboardRoomTimeSlot'</p>\n</blockquote>\n\n<p>pls help me in how to fix this problem as I need to use this stored procedure and in SQL Server 2005</p>\n"},{"tags":["sql-server-2008","hierarchy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12727011,"title":"Are the alternatives to a self referencing table?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4048151/what-are-the-options-for-storing-hierarchical-data-in-a-relational-database\">What are the Options for Storing Hierarchical Data in a Relational Database?</a>  </p>\n</blockquote>\n\n\n\n<p>I have hierarchical data that would typically be put into a self referencing table, and am curious to know if there are there any alternatives to that pattern that...</p>\n\n<ul>\n<li>don't require things like recursion to query </li>\n<li>don't require a complex implementation</li>\n</ul>\n\n<p>There is no limitation that would prevent me from using a self referencing table, but I am curious to know what other options exist for handling hierarchical data in SqlServer. </p>\n\n<p>The canonical example of a Self Referencing Table - </p>\n\n<pre><code>CREATE TABLE SRTable AS (\n  ID INT IDENTITY(1,1)\n  , Descr VARCHAR(25)\n  , ParentID INT\n)\n</code></pre>\n\n<p>The \"self referencing\" element is where ParentID references ID.</p>\n"},{"tags":["sql","sql-server-2008","tsql","like","full-text"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":98,"score":-5,"question_id":12724702,"title":"SQL text LIKE doesn't always work","body":"<p>I'm comparing text values in the same table and same column in SQL Server 2008, but the results are sometimes incorrect. Possibly relevant column info:  </p>\n\n<pre><code>Data type: text  \nFull Text: True  \nCollation: SQL_Latin1_General_CP1_CI_AS\n</code></pre>\n\n<p>Out of 100 actual matches I only get 62. I have compared field values that are not picked up by LIKE in some comparison tools and they are 100% same, no additional spaces, line breaks etc.</p>\n\n<p>Any idea why text LIKE doesn't always work?</p>\n\n<p>SQL:</p>\n\n<pre><code>SELECT a.text as one, b.text as two\n  FROM [Db].[dbo].[Table] a join\n  [Db].[dbo].[Table] b on\n  a.text LIKE b.text\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12723863,"title":"Data type for numbers with maximum length in SQL Server","body":"<p>I want to store number that can be of length more than 20 digit but not has maximum length defined.</p>\n\n<p>I search for the datatype that hold maximum value entered and found <code>varchar(max)</code>, I want to have something like <code>numeric(max)</code> but that is not there.</p>\n\n<p>What should I use, is it fine to use <code>varchar(max)</code> but then how can I validate for number?</p>\n"},{"tags":["c#","sql-server-2008","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":110,"score":0,"question_id":12562736,"title":"Dynamic SQL INSERT Takes 30x Longer than it Should","body":"<p>We have built a C# .NET system that can be used to create data warehouses. This system takes selected databases and run a script against these databases to create a combined database/warehouse. </p>\n\n<p>Now, I have three databases to be compiled into a single database and I am copying two tables from each (table [XI] and table [XII] - which have a one to many relationship, but have no constraints set up at the time of the copy/<code>INSERT INTO</code>). The figures for the script to run and the relevant sizes for each table are below:</p>\n\n<p>The executed script consists of 30 SQL queries.</p>\n\n<ol>\n<li><p><strong>DatabaseA</strong>: </p>\n\n<pre><code>Table [XI]  29,026 Rows (size 20,128Kb).\nTable [XII] 531,958 Rows (size 50,168Kb).\nTime taken for entire script: 1.51s.\n</code></pre></li>\n<li><p><strong>DatabaseB</strong>:</p>\n\n<pre><code>Table [XI]  117,877 Rows (size 17,000Kb).\nTable [XII] 4,000,443 Rows (size 512,824Kb).\nTime taken for entire script: 2.04s.\n</code></pre></li>\n</ol>\n\n<p>These both run fine and fast. The next is almost exactly the same size as the first but takes 40x as long!</p>\n\n<ol>\n<li><p><strong>DatabaseC</strong>:</p>\n\n<pre><code>Table [XI]  29,543 Rows (size 20,880Kb).\nTable [XII] 538,302 Rows (size 68,000Kb).\nTime taken for entire script: 44.38s.\n</code></pre></li>\n</ol>\n\n<p>I cannot work out why this is taking so long. I have used SQL Server Profiler and the Performance Monitor, but I cannot nail-down the reason for this massive change in performance. </p>\n\n<p>The query being used to do the update is dynamic and is shown at the bottom of this question - it is large due the explicit reference to the required columns. My question is; what could be causing this inordinate increase in execution time?</p>\n\n<p>Any clues would be greatly appreciated.</p>\n\n<p><em>SQL:</em></p>\n\n<pre><code>DECLARE @DbName NVARCHAR(128);\nSET @DbName = (SELECT TOP 1 [DbName] \n               FROM [IPACostAdmin]..[TmpSpecialOptions]);\nDECLARE @FilterSql NVARCHAR(MAX);\nSET @FilterSql = (SELECT TOP 1 [AdditionalSQL] \n                  FROM [IPACostAdmin]..[TmpSpecialOptions]);\nDECLARE @SQL NVARCHAR(MAX);\nDECLARE @SQL1 NVARCHAR(MAX);\nDECLARE @SQL2 NVARCHAR(MAX);\nSET @SQL1 = \n    'INSERT INTO [' + @DbName + ']..[Episode] \n        ([Fields1], ..., [FieldN])'; \nSET @SQL2 = \n'SELECT \n     [Fields1], ..., [FieldN] \nFROM [B1A] ' + @FilterSql + ';'; \nSET @SQL = @SQL1 + @SQL2;\nEXEC(@SQL);\nGO\n</code></pre>\n\n<p>Note: I am splitting the dynamic SQL into <code>@SQL1</code> and <code>@SQL2</code> for clarity. Also note that I have not shown all columns due to space and the fact that it would largely be redundant.</p>\n\n<p><em>Edit1.</em></p>\n\n<p><em>1. The databases are on the same server.</em></p>\n\n<p><em>2. The database files, including logs are in the same directory on the same drive.</em></p>\n\n<p><em>3. There are no primary/foriegn keys or constraints set up on the source databases (DatabaseA/B/C) or the data warehouse database at the time of this <code>INSERT INTO</code>.</em></p>\n\n<p><em>Edit2. I have ran the above query in management studio and it took 5s!?</em></p>\n\n<p><em>Edit3. I have added a temporary <code>CLUSTERED INDEX</code> in a hope that this would assist this query, this has not helped either.</em> </p>\n"},{"tags":["xml","sql-server-2008","tsql","sql-server-2005","validation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12724440,"title":"SQL Server :  validate XML","body":"<p>I'm using SQL Server 2005 and 2008 and am trying to import a variety different XML files into my db, and occasionally the XML is not valid. Each XML file will differ from the last.</p>\n\n<p>Is there any way to create a function which will return 0 or 1 depending on whether the XML is valid?</p>\n\n<p>Thanks</p>\n\n<p>C</p>\n"},{"tags":[".net","windows","sql-server-2008","clickonce"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12687481,"title":"Run application connect to SQL Server by Windows Guest user account","body":"<p>I have a .NET windows application connected to a SQL Server 2008 database, I am deploying this app on clients machines using click-once technique through the web.</p>\n\n<p>Now I am testing the application under different user permissions.</p>\n\n<p>When I test the application on Administrator user and the standard user (limited user in Windows XP). and the app run successfully </p>\n\n<p>When I tested the application on the Guest user account, I got the following .NET SQL Exception:</p>\n\n<pre><code>The type initializer for 'System.Data.SqlClient.SqlConnection' threw an exception.\n 9/26/2012 11:25:33 AM: Stack:    at System.Data.SqlClient.SqlConnection..ctor()\n at    \n  System.Data.Linq.SqlClient.SqlProvider.System.Data.Linq.Provider.IProvider.Initialize\n (IData \n Services dataServices, Object connection)\n at System.Data.Linq.DataContext.Init(Object connection, MappingSource mapping)\n at System.Data.Linq.DataContext..ctor(String fileOrServerOrConnection, MappingSource \n mapping)\n</code></pre>\n\n<p>and here is the inner exception:</p>\n\n<p>System.TypeInitializationException: The type initializer for 'System.Data.SqlClient.SqlConnectionFactory' threw an exception. ---> System.TypeInitializationException: The type initializer for 'System.Data.SqlClient.SqlPerformanceCounters' threw an exception. ---> System.UnauthorizedAccessException: Access to the path 'Global.net data provider for sqlserver' is denied.\n   at System.IO._<em>Error.WinIOError(Int32 errorCode, String maybeFullPath)\n   at System.Threading.Mutex.&lt;>c</em>_DisplayClass3.&lt;.ctor>b__0(Object userData)\n   at System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode code, CleanupCode backoutCode, Object userData)\n   at System.Threading.Mutex..ctor(Boolean initiallyOwned, String name, Boolean&amp; createdNew, MutexSecurity mutexSecurity)\n   at System.Diagnostics.SharedUtils.EnterMutexWithoutGlobal(String mutexName, Mutex&amp; mutex)\n   at System.Diagnostics.SharedPerformanceCounter.Verify(CategoryEntry* currentCategoryPointer)\n   at System.Diagnostics.SharedPerformanceCounter.FindCategory(CategoryEntry** returnCategoryPointerReference)\n   at System.Diagnostics.SharedPerformanceCounter.GetCounter(String counterName, String instanceName, Boolean enableReuse, PerformanceCounterInstanceLifetime lifetime)\n   at System.Diagnostics.SharedPerformanceCounter..ctor(String catName, String counterName, String instanceName, PerformanceCounterInstanceLifetime lifetime)\n   at System.Diagnostics.PerformanceCounter.Initialize()\n   at System.Diagnostics.PerformanceCounter.set_RawValue(Int64 value)\n   at System.Data.ProviderBase.DbConnectionPoolCounters.Counter..ctor(String categoryName, String instanceName, String counterName, PerformanceCounterType counterType)\n   at System.Data.ProviderBase.DbConnectionPoolCounters..ctor(String categoryName, String categoryHelp)\n   at System.Data.SqlClient.SqlPerformanceCounters..ctor()\n   at System.Data.SqlClient.SqlPerformanceCounters..cctor()\n   --- End of inner exception stack trace ---\n   at System.Data.SqlClient.SqlConnectionFactory..ctor()\n   at System.Data.SqlClient.SqlConnectionFactory..cctor()\n   --- End of inner exception stack trace ---\n   at System.Data.SqlClient.SqlConnection..cctor()</p>\n\n<p>Can any one tell me how to solve this problem? :)</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12542825,"title":"multiple outer join on the same table - low performance","body":"<p>My sales app. need to perform some calculation for assessment of distribution and sales operations, \nall the needed data within one table: \n<br>My tables:\nStoreTable: <code>storeId int,StoreName varchar</code>\nProductsDistributionTable:</p>\n\n<pre><code>distributionId int, StoreId int, DistributionDate date,productA float,productB float,productC float.\n</code></pre>\n\n<p>Indexes:storeId(PK),DistributionId(pk),distributionDate. <br>\nNONCLUSTERED INDEX [IX_D_storeID] ON [dbo].distribution <br>\nThe number of stores greater than 10,000 stores!<br>\nDistribution data for 3 months: records more than 3,500,000 records!\n<br>\nto get data looks like:</p>\n\n<p><br>  <code>store Id   storeName  Average from begining       Average within period, LastSales  ,LastSales within period , DaysFromLastSalesDateB,LastSalesDateA</code>\n<br>I used a stored proc:<br></p>\n\n<pre><code>ALTER PROCEDURE [dbo].[USP_StoresAndDistributionEvaluation_CX]\n        @startDate           date  ,\n        @endDate           date   \nAS\ndeclare @dateDiff_A Int\nset @dateDiff_A=DATEDIFF(dd,@startDate,@endDate)\nset @dateDiff_A=@dateDiff_A + 1;\n\nSELECT  s.storeId,s.storeName, Total_Average,  Period_Average, LastSalesValueA,LastSalesValueB, DaysFromLastSalesDateB,LastSalesDateA\nFROM (\n    SELECT  \n        sG.storeName, ds.storeId,  isnull(Period_Average,0)  as Period_Average,\n        isnull(DATEDIFF(dd,LastSalesDateA,getDate()),0) as DaysFromLastSalesDateA,\n        isnull(DATEDIFF(dd,LastSalesDateB,@endDate),0) as DaysFromLastSalesDateB\n    FROM \n        (\n            select \n                ds.storeId,\n                (isnull(SUM(product_A) + sum(product_C) + sum(product_B) ,0) / (DATEDIFF(dd, min(DistributionDate), getDate()) + 1)) AS Total_Average, \n                max(ds.DistributionDate) as lastSalesDateA\n            from dbo.distributionTable  ds\n            where (DistributionDate &gt;= '2012/01/01')\n            and ((product_A &gt; 0) OR  (product_B &gt; 0) OR  (product_C &gt; 0))\n            group by ds.storeId \n\n        ) AS ds\n        INNER JOIN\n            (select storeId, StoreName from dbo.storesTable) as s ON ds.storeId = s.storeId\n        LEFT OUTER JOIN (\n            SELECT \n                storeId, \n                (isnull(SUM(product_A) + sum(product_C) + sum(product_B) ,0) / @dateDiff_A) AS Period_Average,\n                max(DistributionDate) as LastSalesDateB\n            FROM  dbo.distributionTable\n            WHERE (DistributionDate BETWEEN CONVERT(VARCHAR, @startDate, 102) AND CONVERT(VARCHAR, @endDate, 102))\n            group by storeId\n            ) AS q ON q.storeId = ds.storeId\n        LEFT OUTER JOIN (\n            SELECT top 1 \n                storeId, \n                (isnull((product_A) + (product_C) + (product_B) ,0)) AS LastSalesValueA \n            FROM  dbo.distributionTable\n            WHERE (DistributionDate &gt;= '2012/01/01')\n            order by DistributionDate desc\n            ) AS qb on  qb.storeId = ds.storeId\n        LEFT OUTER JOIN (\n            SELECT top 1 \n                storeId, \n                (isnull((product_A) + (product_C) + (product_B) ,0)) AS LastSalesValueB \n            FROM  dbo.distributionTable\n            WHERE (DistributionDate BETWEEN CONVERT(VARCHAR, @startDate, 102) AND CONVERT(VARCHAR, @endDate, 102))\n            order by DistributionDate desc\n            ) AS qm on qm.storeId = ds.storeId\n    GROUP BY      \n        s.storeId, s.storeName, Total_Average, Period_Average, LastSalesValueA, LastSalesValueB, DaysFromLastSalesDateB, LastSalesDateA\n) as aq     \n</code></pre>\n\n<p><strong>The problem:performance is very bad</strong> <br></p>\n\n<p><br>\n<strong>EDIT :</strong> update first select statement (where , having).\n<br>I wonder if there is an optimal way to enhance this queries\n<br> Any help greatly appreciated!</p>\n"},{"tags":["sql-server-2008","select","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12723985,"title":"How to SELECT from several tables with additional conditions?","body":"<p>I have table \"Table_Codes\" in my SQL Server database</p>\n\n<pre><code>Code | Description | Owner | Location\nA202   SomeDescr1    Owner1       M-3\nB301   SomeDescr2    Owner2       M-3\nC898   SomeDescr3    Owner3       M-2\nB744   SomeDescr4    Owner4       M-3\nV123   SomeDescr5    Owner5       M-3         - code is not define in second table\n</code></pre>\n\n<p>Also I have table \"Table_Stock\"</p>\n\n<pre><code>Code | Qty |     DC\nA202    10       M-3\nB301    12       M-2      !-not the same location like in 1st table for this code\nC898    90       M-2\nB744   120       M-3\n</code></pre>\n\n<p>I can't to build correct query to select next result from this tables:       </p>\n\n<pre><code>    Code |    Qty(Location=DC) |  Qty on alternate DC (Location from 1st table &lt;&gt; DC)\n    A202             10                       0\n    B301              0                      12\n    C898             90                       0\n    B744            120                       0\n    V123   Not in stock            Not in stock\n</code></pre>\n\n<p>I can do it by using auxiliary tables. But I want to know how to do it by using single SELECT query?</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":12723098,"title":"Synchronise tables in sql","body":"<p>I got 7 tables in sql server 2005 having relation with each other based on primary key and foreign keys. I need to make a new table which will contain columns of all the 7 tables together. I need this new table to be synchronised every time with the main 7 tables. What is the best way to do this in Sql server 2005 or 2008..</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":223,"score":2,"question_id":12204577,"title":"Exporting binary file data (images) from SQL via a stored procedure","body":"<p>I am trying to export a fairly larege number of image files, stored internally in an SQL database as binary data. </p>\n\n<p>Being fairly new to writing stored procedures in SQL, I have come across a couple of very usefull guides on how this can be achived, but I seem to be missing something.</p>\n\n<p>I am running SQL Server 2008 R2 locally, and I am trying to write the files to a folder on my C:\\ drive.</p>\n\n<p>Here is the buisness part of what I have so far:</p>\n\n<pre><code>BEGIN\nDECLARE @cmd VARCHAR(8000)\nDECLARE @result int\n\nDECLARE curExportBinaryDocs CURSOR FAST_FORWARD FOR\nSELECT 'BCP \"SELECT Photograph_Data FROM [ALBSCH Trial].[dbo].[Photograph] WHERE Photograph_ID = '\n  + CAST(Photograph_ID AS VARCHAR(500)) + '\" queryout \"' + @OutputFilePath \n  + CAST(Photograph_ID AS VARCHAR(500)) + '.jpg\"' + ' -n -T'\nFROM dbo.Photograph\n\nOPEN curExportBinaryDocs   \nFETCH NEXT FROM curExportBinaryDocs INTO @cmd\nWHILE @@FETCH_STATUS = 0\n  BEGIN\n     --PRINT @cmd\n     EXEC @result = xp_cmdshell @cmd         \n     FETCH NEXT FROM curExportBinaryDocs INTO @cmd\n  END \nCLOSE curExportBinaryDocs\nDEALLOCATE curExportBinaryDocs\nEND\n</code></pre>\n\n<p>'@result' is always being set to '1' (failed) after the xp_cmdshell call. All the table names/fields are correct, so I suspect there is something wrong with my BCP call, but I am not sure what to try next.</p>\n\n<p>Any help or advice would be very welcome.</p>\n"},{"tags":["visual-studio","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1171,"score":3,"question_id":10053813,"title":"Cannot create new database diagram in SQL Server 2008","body":"<p>I'm using SQL Server Management Studio 2008 and SQL Server 2008.<br/><br/>\nCurrently, I cannot create new database diagram from the SSMS 2008 on an SQL Server 2008 instance.<br/><br/>\nHas anyone ever experienced this ? <br/><br/>\nThe problem started after I tried to install Visual Studio 11 Beta, and apparently the Beta also installs SQL Server 2012 RC0. Now I have uninstalled the Visual Studio 11 Beta and the SQL Server 2012 that goes along with it.</p>\n\n<p>EDIT :\nError message that shows when I tried to create new database diagrams is : \"The specified module could not be found (MS Visual Database Tools)\"</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12722631,"title":"Cannot-resolve the collation conflict between \"SQL_Latin1_General_CP1_CI_AS\" and \"Latin1_General_CI_AS\" in the equal to operation","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1607560/cannot-resolve-the-collation-conflict-between-sql-latin1-general-cp1-ci-as-and\">Cannot resolve the collation conflict between &ldquo;SQL_Latin1_General_CP1_CI_AS&rdquo; and &ldquo;Latin1_General_CI_AS&rdquo; in the equal to operation</a>  </p>\n</blockquote>\n\n\n\n<p>When I try to join two tables on the same column a.C1=b.C2 I get this message:</p>\n\n<p>Cannot resolve the collation conflict between \"SQL_Latin1_General_CP1_CI_AS\" and \"Latin1_General_CI_AS\" in the equal to operation.</p>\n\n<p>Can you tell me please is there any way to join them without changing the collations in tables?</p>\n\n<pre><code>SELECT * FROM\nBIT_Dashboard.dse.Solution a\nINNER JOIN\nLeistungsportfolio.dbo.EBFHB_Jobliste b\nON a.Solution_NAM = b.SolutionName\nWHERE a.Solution_NAM COLLATE DATABASE_DEFAULT = b.SolutionName COLLATE DATABASE_DEFAULT\n</code></pre>\n\n<p>Error Msg: \"Cannot resolve the collation conflict between \"SQL_Latin1_General_CP1_CI_AS\" and \"Latin1_General_CI_AS\" in the equal to operation.\"</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":132,"score":0,"question_id":12721823,"title":"How to drop all Foreign Key constraints in all tables?","body":"<p>I want to write sql command to drop all constraints in all tables. I searched on the internet and found the following which works fine if the database is small and not complex.</p>\n\n<pre><code>DECLARE @name VARCHAR(128) \nDECLARE @constraint VARCHAR(254) \nDECLARE @SQL VARCHAR(254) \nDECLARE @schema VARCHAR(128)\n\nSELECT @name = (SELECT TOP 1 TABLE_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'FOREIGN KEY' ORDER BY TABLE_NAME) \nSELECT @schema = (SELECT TOP 1 schema_name(schema_id) FROM sys.objects WHERE [name] = @name) \n\nWHILE @name is not null \nBEGIN \n    SELECT @constraint = (SELECT TOP 1 CONSTRAINT_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'FOREIGN KEY' AND TABLE_NAME = @name ORDER BY CONSTRAINT_NAME) \n    WHILE @constraint IS NOT NULL \n    BEGIN \n        SELECT @SQL = 'ALTER TABLE ' + @schema + '.[' + RTRIM(@name) +'] DROP CONSTRAINT [' + RTRIM(@constraint) +']' \n        EXEC (@SQL) \n        PRINT 'Dropped FK Constraint: ' + @constraint + ' on ' + @name \n        SELECT @constraint = (SELECT TOP 1 CONSTRAINT_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'FOREIGN KEY' AND CONSTRAINT_NAME &lt;&gt; @constraint AND TABLE_NAME = @name ORDER BY CONSTRAINT_NAME) \n    END \nSELECT @name = (SELECT TOP 1 TABLE_NAME FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS WHERE constraint_catalog=DB_NAME() AND CONSTRAINT_TYPE = 'FOREIGN KEY' ORDER BY TABLE_NAME) \nSELECT @schema = (SELECT TOP 1 schema_name(schema_id) FROM sys.objects WHERE [name] = @name) \nEND \nGO \n</code></pre>\n\n<p>It does not work if I run it with a more complex database or even AdventureWork. It shows some erros like below.</p>\n\n<pre><code>Msg 3728, Level 16, State 1, Line 1\n'FK_ap_invoice_modification_type_id' is not a constraint.\nMsg 3727, Level 16, State 0, Line 1\nCould not drop constraint. See previous errors.\nMsg 3725, Level 16, State 0, Line 1\nThe constraint 'PK_ap_invoice' is being referenced by table '_drop_now_ap_invoice_detail', foreign key constraint 'FK_ap_invoice_detail_ap_invoice'.\nMsg 3727, Level 16, State 0, Line 1\nCould not drop constraint. See previous errors.\n</code></pre>\n\n<p>The reason is because some FKs are referenced by other table. I have to run this script for a couple times until the database is clean.</p>\n\n<p>I want to know how can I clear all FKs in the database.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":12722298,"title":"GROUP-BY expression must contain at least one column that is not an outer reference","body":"<p>i have this query:</p>\n\n<pre><code>SELECT\nSolutionName    -- Solution_NAM\nfrom  Table_View\nGroup By 1\n</code></pre>\n\n<p>where Table_View is of course a view.\nI am gettign this error message:</p>\n\n<p>Each GROUP BY expression must contain at least one column that is not an outer reference.</p>\n\n<p>Can you help me resolve this?\nIt´s inside Ms SQL Server 2008</p>\n"},{"tags":["sql-server","database","sql-server-2008","memory-leaks"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12721708,"title":"SQL Server DB Engine Memory Leakage","body":"<p>We have a Windows Form Application and the back-end of the application is SQL Server Express 2005/2008. Our application can be installed on Windows XP SP3/ Windows Vista/ Windows 7.</p>\n\n<p>We have observed huge memory leakage in SQL Server Express.</p>\n\n<p>Normally, there are two process running even if the application is not used by the user:</p>\n\n<ol>\n<li><p>A polling process to check the availability of files. (If files are not available then, only one query is fired to check some configuration setting)</p></li>\n<li><p>A Scheduling process. (This process fires a query every minute to check for any scheduled task)</p></li>\n</ol>\n\n<p>We have observed that the memory usage of the SQL Server (sqlsrvr.exe) keeps on increasing.  In around an hour, the memory usage reaches upto 1GB and it never comes down.</p>\n\n<p>We have also noticed that, if the interval of the polling process is increased, then the memory usage increases gradually but, it does increase.</p>\n\n<p>The higher memory usage by SQL server downgrades the machine performance and  the performance of all other applications running on the machine.</p>\n\n<p>Please provide suggestions to control the memory usage of SQL server in this case.</p>\n\n<p>PFB the details:</p>\n\n<ol>\n<li><p>Software causing issue :SQL Server 2005/2008 Express editions (named instance)</p></li>\n<li><p>Operating Systems on which issue can be simulated  : Windows XP SP3/ Windows Vista/ Windows 7</p></li>\n</ol>\n\n<p>Regards,</p>\n\n<p>Abhineet</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2152,"score":1,"question_id":2197727,"title":"connect sql server 2005/2008 over internet","body":"<p>How do I connect to SQL Server 2005/2008 using Management Studio or other desktop application over the internet?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12713820,"title":"Unintended recursive call in SQL Server stored procedure","body":"<p>I have a table into which I have to insert data if a particular key is not present. I decided to write a stored procedure to insert data. What I want to do is: </p>\n\n<ol>\n<li>Create a stored procedure.</li>\n<li>Insert a bunch of rows using the stored procedure.</li>\n<li>Drop the stored procedure. </li>\n</ol>\n\n<p>I want to do all this in a single script file so that no one ever knows that the stored procedure existed.</p>\n\n<p>Here is what I have:</p>\n\n<p><strong>Create</strong></p>\n\n<pre><code>CREATE PROCEDURE My_Proc(@key varchar(10))\n  AS\n  BEGIN\n  IF NOT EXISTS (SELECT * FROM [dbo].[My_Table] WHERE [key] = @key)\n    INSERT INTO [dbo].[My_Table] (key, created, modified)\n    VALUES (@key, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\n  END\n</code></pre>\n\n<p><strong>Insert</strong></p>\n\n<pre><code>EXECUTE My_Proc 99241\nGO\nEXECUTE My_Proc 99242\nGO\nEXECUTE My_Proc 99243\nGO\n</code></pre>\n\n<p><strong>Drop</strong></p>\n\n<pre><code>DROP PROCEDURE My_Proc\n</code></pre>\n\n<p>Now I right click on my database in SQL Server Management Studio, click on <code>New Query</code> and paste the above query. I get the following output:</p>\n\n<pre><code>(1 row(s) affected)\n\n(1 row(s) affected)\nMsg 217, Level 16, State 1, Procedure My_Proc, Line 9\nMaximum stored procedure, function, trigger, or view nesting level exceeded (limit 32).\n\n(1 row(s) affected)\nMsg 217, Level 16, State 1, Procedure My_Proc, Line 9\nMaximum stored procedure, function, trigger, or view nesting level exceeded (limit 32).\n</code></pre>\n\n<p>I am unable to figure out what is causing the error. Also, When I highlight the specific <code>EXECUTE</code> command on SSMS like so <code>EXECUTE My_Proc 99241</code> the data gets inserted without any error. </p>\n"},{"tags":["sql","sql-server-2008","jobs"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12261627,"title":"Automatic deletion of values in MS SQL Server 2008 Express Edition","body":"<p>Is there a way to have my server check some data in a table and delete or modify it every X minutes. I know this can be done by creating a job, but it seems that it is not possible with MS SQL Server 2008 Express Edition. Is there any alternative way of doing it? </p>\n"},{"tags":["sql","sql-server","database-design","sql-server-2008"],"answer_count":5,"favorite_count":6,"up_vote_count":21,"down_vote_count":0,"view_count":3457,"score":21,"question_id":1398453,"title":"Why & When should I use SPARSE COLUMN? (SQL SERVER 2008)","body":"<p>After going thru some tutorials on SQL SERVER 2008's new feature SPARSE COLUMN, I have found that it doesn't take any space if the column value is 0 or null but when there is a value, it takes 4 times the space a regular(non sparse) column holds.</p>\n\n<p>If my understanding is correct, then why I will go for that at the time of database design?\nAnd if I use that, then at what situation so I be?</p>\n\n<p>Also out of curiosity, how come no space get's reserve when a column is defined as sparse column(I mean to say, what is the internal implementation for that)</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server-2008","tsql","merge"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":12718727,"title":"MERGE is not merging data as expected","body":"<p>My first attempt at a MERGE run is not throughing any errors but it is not merging the data like I want. Can anyone tell me what I am doing wrong? The point is to compair #Temp and #tblCollectionGameList and update #tblCollectionGameList so that it contains only the items inside #Temp (inserting missing items into tblCollecitonGameList and deleteing items from tblColletionGameList that are no longer in #Temp)</p>\n\n<pre><code>    CREATE TABLE #Temp\n(\n    CollectionID smallint NOT NULL,\n    IncludedSectionID smallint NOT NULL\n)\n\nINSERT INTO #Temp (CollectionID, IncludedSectionID) VALUES(0, 0);\nINSERT INTO #Temp (CollectionID, IncludedSectionID) VALUES(0, 1);\n\nSELECT * FROM #Temp;\n\nCREATE TABLE #tblCollectionGameList\n(\n    ID smallint IDENTITY(0,1) NOT NULL,\n    CollectionID smallint NOT NULL,\n    IncludedSectionID smallint\n)\n\nINSERT INTO #tblCollectionGameList (CollectionID, IncludedSectionID) VALUES(0,0);\nINSERT INTO #tblCollectionGameList (CollectionID, INcludedSectionID) VALUES(0,2);\n\nSELECT * FROM #tblCollectionGameList;\n\nBEGIN TRAN\n\nMERGE #tblCollectionGameList AS t\nUSING #Temp AS s\nON (t.CollectionID = s.CollectionID)\nWHEN NOT MATCHED BY TARGET\n    THEN\n        INSERT(CollectionID, IncludedSectionID) VALUES (s.CollectionID, s.IncludedSectionID)\nWHEN NOT MATCHED BY SOURCE\n    THEN\n        DELETE;\n\nSELECT * FROM #tblCollectionGameList;\n\nROLLBACK TRAN\n\nDROP TABLE #Temp;\nDROP TABLE #tblCollectionGameList;\n</code></pre>\n"},{"tags":["c#","sql-server-2008","stored-procedures","arraylist"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":135,"score":-1,"question_id":12395099,"title":"Sql Server 2008, modify query via stored procedure into .NET ArrayList","body":"<p>Below is an example of using the stored procedure(GetTimesWithCustomerNames) then via ArrayList collecting data retrieved by the query:</p>\n\n<pre><code>/*\n    GetTimesWithCustomerNames 3571, 6, 2012, 1\n    GetTimesWithCustomerNames '3571', '6', '2012', '0'\n\n*/\nALTER PROCEDURE [dbo].[GetTimesWithCustomerNames]\n@userid int=0, @month int=0, @year int=0,@reasonid int=0\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    if @userid!=0 begin\n\n        create table #tmp (tId int, UserId int, \n        TimeIn1 smalldatetime, [TimeOut1] smalldatetime, \n        TimeIn2 smalldatetime, [TimeOut2] smalldatetime, tId2 int,\n        TimeIn3 smalldatetime, [TimeOut3] smalldatetime, tId3 int,\n        ActiveDate smalldatetime, ReasonID int, Name nvarchar(100), ReasonType nvarchar(100),\n        TotalMins int)\n\n        insert into #tmp (tId, UserId, TimeIn1, TimeOut1, ActiveDate, ReasonID, Name, ReasonType)\n        SELECT\n        t1.tId, t1.UserId, t1.TimeIn, t1.[TimeOut], t1.ActiveDate, t1.ReasonID, tblCustomers.Name,\n        (select reasontype from tblTimeReas where ReasonID=t1.ReasonID) as ReasonType\n        FROM tblTime t1\n        inner join tblCustomers on t1.UserId=tblCustomers.custID\n        where (t1.userid=@userid)\n        and (DATEPART(MONTH,t1.timein)=@month or @month=0)\n        and (DATEPART(YEAR,t1.timein)=@year or @year=0)\n        and (t1.reasonid = @reasonid or @reasonid=0)        \n        and\n        (select COUNT(1) from tblTime t2 where userid=@userid and datediff(day,t2.TimeIn,t1.TimeIn)=0 and t2.tId&lt;t1.tId)=0\n\n        update #tmp\n        set tId2 = (select top 1 tId from tblTime t2 where userid=@userid and DATEDIFF(day,t2.timein,#tmp.timein1)=0\n                        and t2.tId&gt;#tmp.tId order by tId asc)\n        update #tmp\n        set tId3 = (select top 1 tId from tblTime t3 where userid=@userid and DATEDIFF(day,t3.timein,#tmp.timein2)=0\n                        and t3.tId&gt;#tmp.tId2 order by tId asc)\n\n        update #tmp\n        set TimeIn2 = (select TimeIn from tblTime where tId=tId2),\n            TimeOut2 = (select [TimeOut] from tblTime where tId=tId2),\n            TimeIn3 = (select TimeIn from tblTime where tId=tId3),\n            TimeOut3 = (select [TimeOut] from tblTime where tId=tId3)\n\n        update #tmp set TotalMins = (\n            isnull(DATEDIFF(minute,timein1,timeout1),0)+\n            isnull(DATEDIFF(minute,timein2,timeout2),0)+\n            isnull(DATEDIFF(minute,timein3,timeout3),0)\n        )\n\n        select * from #tmp order by TimeIn1\n        drop table #tmp\n\n    end\n\nEND\n</code></pre>\n\n<p>I would like to know, for given userid I can have all data returned into an ArrayList - what is the way to retrive a set of values per userid ? Will it be possible to have a data returned per user(few) in an arrayList and <strong>not for one only</strong> like this procedure ?</p>\n\n<p>In this query data is <code>TimeIn</code> <code>TimeOut</code> <code>ActiveDate</code> etc...</p>\n\n<ul>\n<li>ReEditing\nI think my question is should the task be for the code behind in a foreach loop or would it be possible to modify the procedure to accept more than one userid?</li>\n</ul>\n\n<p>The code I am using to store data in code behind is:   </p>\n\n<pre><code> public static ArrayList loadData(string sql)\n    {\n\n        DBManager dbManager = new DBManager(DataProvider.SqlServer, \"Data Source=(local);Initial Catalog=databaseName;Integrated Security=True\");\n\n        ArrayList data = new ArrayList();\n\n        try\n        {\n            dbManager.Open();\n            dbManager.ExecuteReader(System.Data.CommandType.Text, sql);\n            while (dbManager.DataReader.Read())\n            {\n               Hashtable x = new Hashtable();\n\n                for (int i = 0; i &lt; dbManager.DataReader.FieldCount; i++)\n                {\n                    x.Add(dbManager.DataReader.GetName(i), dbManager.DataReader.GetValue(i));\n                }\n                x.Add(\"COUNTER\", data.Count+1);\n                data.Add(x);\n            }\n        }\n        catch { data = null; }\n        finally\n        {\n            dbManager.Dispose();\n        }\n\n        return data;\n    }\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12709014,"title":"Determine SELECTs are equivalent","body":"<p>Can you please help me to determine if these 2 SELECTs are equivalent?</p>\n\n<pre><code>SELECT sd.SESSION_DATA_ID\nFROM SessionData sd\nWHERE sd.DEVICE_TYPE = 'TRAC'\n    AND (EXISTS\n          (SELECT sr.ID\n           FROM SessionResult sr\n           LEFT JOIN BarcodeValues bv ON \n                sr.BARCODE_VALUE_0 = bv.ID AND \n                sr.SESSION_DATA_ID = sd.SESSION_DATA_ID AND\n                sr.EVENT_NAME = 'Multi Full Cntr'\n           WHERE\n             bv.ENCRYPTED_VALUE LIKE '' OR bv.ENCRYPTED_VALUE IS NULL))\n\nSELECT\n    DISTINCT sd.SESSION_DATA_ID\nFROM SessionData sd\nLEFT JOIN SessionResult sr ON sd.SESSION_DATA_ID = sr.SESSION_DATA_ID\nLEFT JOIN BarcodeValues bv ON bv.ID = sr.BARCODE_VALUE_0\nWHERE\n    sd.DEVICE_TYPE = 'TRAC' AND\n    (sr.EVENT_NAME = 'Multi Full Cntr' AND\n    bv.ENCRYPTED_VALUE LIKE '' OR bv.ENCRYPTED_VALUE IS NULL) OR\n    sr.EVENT_NAME is NULL\n</code></pre>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":12648180,"title":"Creating 'util' - stored procedure section, as with .net helper classes","body":"<p>A few minutes ago I was only searching for a simple syntax (SQL server) query that will copy a table Row .</p>\n\n<p>This is usually done from time to time, when working on a ASP.net project, testing data with queries \ninside the <em>SQL SERVER management studio</em> . so one of the routine actions is copying a row, altering the required columns to be different from each other, then testing data with queries </p>\n\n<p>So I've encountered  <a href=\"http://stackoverflow.com/questions/3967665/how-can-i-copy-a-row-into-same-table-with-sql-server-2008\">- this stored procedure-</a> ,as answer by Dan Atkinson</p>\n\n<p>but adding it to where all non testing purpose are stored lead me to think \nis it possible to store them in sorted order so I could Distinguish </p>\n\n<p>'utils' or 'testingPurpose' ones from those used in projects</p>\n\n<p>(default folder inside managment treeview is Programmabilty) could this be another folder too \nor this is not an option ?</p>\n\n<p>if not , I thought of  <code>Utils.</code>  prefix like that (if no other way exist)</p>\n\n<pre><code>dbo.Utils.CopyTableRow\ndbo.Utils.OtherRoutineActions ....\n</code></pre>\n\n<p>Or there's a designated way to achieve what I was thinking of.</p>\n"},{"tags":["sql-server-2008","connection-string","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1301,"score":2,"question_id":6019764,"title":"Problem creating SSRS report subscriptions","body":"<p>I am not able to create subscriptions for SSRS reports as it give the following error\n\"Subscriptions cannot be created because the credentials used to run the report are not stored, or if a linked report, the link is no longer valid\"</p>\n\n<p>My set up is as followong \nServerA - Database Server\nServerB - Report Server\nMachineC - Internet explorer to view the reports</p>\n\n<p>So I am viewing reports on MachineC IE, and ServerB connects to ServerA for Datasource.\nCan someone please hep what could be the issue or fix for this . Thanks </p>\n"},{"tags":["c#","asp.net","sql-server-2008","windows-phone-7"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":12715393,"title":"Retrieve multiple images from SQL to web servers in ASP.NET","body":"<p>I've managed to retrieve one image from a sql server 2008 database to my web server in asp.net but I do not know how I can retrieve multiple images and then use these image in WP7.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12714905,"title":"Can't select columns from database","body":"<p>I have 3 tables: </p>\n\n<ul>\n<li><code>[Users]: UserId, Name...</code></li>\n<li><code>[Topics]: TopicId, CreatorUserId...</code></li>\n<li><code>[Comments]: CommentId, TopicId...</code>. </li>\n</ul>\n\n<p>Now, I'd like to select the creators of the most popular topics according to this mechanism:\nget the comments, which is newer than the specified date. Group those comments by the creator of the topic, and order by the number of rows in the groups.</p>\n\n<p>However, I'm not sure that my query follows this logic(it seems according to the results, but I have only a few users and topics), but the main problem is that when I want to select the name of the user (<code>Users.Name</code>), I get an error:</p>\n\n<blockquote>\n  <p><em>Column '[TestDatabase].[dbo].[Users].[Name]' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</em></p>\n</blockquote>\n\n<p>T-SQL query:</p>\n\n<pre><code>SELECT \n   Users.UserId, Users.Name, COUNT(Users.UserId) as RowCountInGroup\nFROM [TestDatabase].[dbo].[Users]\nINNER JOIN [TestDatabase].[dbo].[Topics] ON Topics.CreatorUserId = Users.UserId\nINNER JOIN [TestDatabase].[dbo].[Comments] ON Comments.TopicId = Topics.TopicId\nWHERE \n   Comments.CreationDate &gt; CAST('14 SEPTEMBER 2012' as DateTime)\nGROUP BY Users.UserId\nORDER BY RowCountInGroup DESC\n</code></pre>\n\n<p>Thanks for helping me.</p>\n\n<p>EDIT: I've copied the original error message. I need to select the Email, the City, etc columns from the User, so I'm not sure that adding all of these to the <code>group by</code> clause is the best solution.</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12714991,"title":"SQL Server Copy Database Wizard fails","body":"<p>I'm trying to use the SQL Server 2008R2 Copy Database wizard to copy a couple of databases from one computer to another. (These are client data, and I want a copy on my notebook, so I can work on this project on the road.) </p>\n\n<p>With some effort, I've gotten to the point of \"Execute SQL Server Agent Job,\" at which point it fails. Examining the log file, I find this line:</p>\n\n<p>OnError,ZENBOOK-2012,NT AUTHORITY\\SYSTEM,VOSTRO-2011_ZENBOOK-2012_Transfer Objects Task,{46B5C485-28C3-4DD4-858C-A62E87EA9AB5},{4D84AAB3-69EB-4BDE-BE51-FC9DEF614E3A},10/3/2012 2:50:16 PM,10/3/2012 2:50:16 PM,0,0x,Failed to connect to server .</p>\n\n<p>I'm using Windows authentication on both ends. I have no problem opening the source database in SSMS on the destination machine using Windows authentication.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["c#","asp.net","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":201,"score":0,"question_id":12714429,"title":"Insert into table with value of auto increment column SQL Server","body":"<p>I have a table with primary key auto increment ID column.</p>\n\n<p>In some cases, I would like to insert the value of the auto increment column into another column in the same table (Without update statement).</p>\n\n<p>Is it possible?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12713816,"title":"Dynamic tsql variable data types causing query to return wrong results","body":"<p>I am using Sql Server 2008</p>\n\n<p>Say you have a table named \"Weights\" and within that table you have a column named \"Weight\" with its data type defined as \"real\" with the following data.</p>\n\n<p>Weight(real data type)</p>\n\n<p>2\n2.001\n2.002\n2.003\n2.004\n2.005\n2.006\n2.007\n2.008\n2.009\n3</p>\n\n<p>Here is the query I am running in the new query window against the table</p>\n\n<pre><code>declare @sql nvarchar(MAX)\ndeclare @params nvarchar(MAX)\ndeclare @interval float = .001\ndeclare @conversion float = 1/@interval         \n\nset @sql =\nN'select FLOOR(Weight * @INPUTconversion)*@INPUTinterval as [Weight],\nCOUNT(1) as ''Count''\nFROM dbo.Weights\nGROUP BY FLOOR(Weight*@INPUTconversion)*@INPUTinterval\norder by FLOOR(Weight*@INPUTconversion)*@INPUTinterval'\n\nset @params =\nN'\n@INPUTconversion real,\n@INPUTinterval float'\n\nexec sp_executesql @sql, @params,  \n@INPUTconversion = @conversion,\n@INPUTinterval = @interval\n</code></pre>\n\n<p>Here is the result which appears to be wrong.</p>\n\n<p>Weight Count</p>\n\n<p>2   2\n2.002   1\n2.003   1\n2.004   1\n2.005   1\n2.006   1\n2.007   2\n2.009   1\n3   1</p>\n\n<p>How can I make the return look like this using the same query? Do I need to change my variable data types?</p>\n\n<p>Weight Count</p>\n\n<p>2   1\n2.001   1\n2.002   1\n2.003   1\n2.004   1\n2.005   1\n2.006   1\n2.007   1\n2.008   1\n2.009   1\n3   1</p>\n"},{"tags":["sql","sql-server-2008","schema"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12713635,"title":"Duplicate Schema in Sql Server 2008","body":"<p>I am wanting to duplicate an existing schema with the table structure, but not any of the existing data. Essentially, we are separating two companies that currently share a single schema in the database, and they have the exact same data structure, but we want them in different schemas (for access control purposes). </p>\n\n<p>It is possible to copy the entire table structure of one schema into a new schema without bringing over any of the data?</p>\n"},{"tags":["sql","sql-server-2008","database-connection"],"answer_count":3,"favorite_count":2,"up_vote_count":20,"down_vote_count":0,"view_count":11670,"score":20,"question_id":3270199,"title":"A connection was successfully established with the server, but then an error occurred during the pre-login handshake","body":"<p>I am getting following error when i am trying to connect Production DB from Local Environment.</p>\n\n<p>I was able to connect Production DB before, but suddenly i am getting following error, any idea?</p>\n\n<p><strong>A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: TCP Provider, error: 0 - The handle is invalid.)</strong></p>\n\n<p>I was trying to run asp.net website in local PC, which has connection string of Production DB, following is stack trace for error i am getting in local environment.</p>\n\n<pre><code>at MyWebsiteDAL.clsForumQuestion.SelectAll(Int32 CurrentPageIndex, Int32 PageSize) in D:\\EDrive\\My WebSites\\MyWebsite\\MyWebsite\\MyWebsiteDAL\\clsForumQuestion.cs:line 821\n   at CodeConnect.Default.Page_Load(Object sender, EventArgs e) in D:\\EDrive\\My WebSites\\MyWebsite\\MyWebsite\\MyWebsite\\Default.aspx.cs:line 100\n   at System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e)\n   at System.Web.Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e)\n   at System.Web.UI.Control.OnLoad(EventArgs e)\n   at System.Web.UI.Control.LoadRecursive()\n   at System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint)\n</code></pre>\n\n<p>Any idea what might have gone wrong here?</p>\n"},{"tags":["sql-server-2008","insert-update","identity-column"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12648643,"title":"insert command SQL server -identity Pkey autoincrement - column name by type , in \"where condition\"","body":"<p>i would like to alter a stored procedure so i will not suplly the <code>identity</code> column name </p>\n\n<pre><code>INSERT INTO tablName ..... WHERE IDENTITY_Column = 10\n</code></pre>\n\n<p>can i tell sql server managment studio to just refer to the <code>IDENTITY</code> column so it will find \nit by its type which is (at least in my tables a default) autoincremet PK ID type</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":12712494,"title":"How to calculate time between records in SQL Server 2008","body":"<p>For an audit table in sql 2008, I need to calculate the time each order is in a given step (represented as the new column). </p>\n\n<pre><code> Old      New           Time Entered        Order Number\n NULL     Step 1        4/30/12 10:43       1C2014A\n Step 1   Step 2        5/2/12 10:17        1C2014A\n Step 2   Step 3        5/2/12 10:28        1C2014A\n Step 3   Step 4        5/2/12 11:14        1C2014A\n Step 4   Step 5        5/2/12 11:19        1C2014A\n Step 5   Step 9        5/3/12 11:23        1C2014A\n NULL     Step 1        5/18/12 15:49       1C2014B\n Step 1   Step 2        5/21/12 9:21        1C2014B\n Step 2   Step 3        5/21/12 9:34        1C2014B\n Step 3   Step 4        5/21/12 10:08       1C2014B\n Step 4   Step 5        5/21/12 10:09       1C2014B\n Step 5   Step 6        5/21/12 16:27       1C2014B\n Step 6   Step 9        5/21/12 18:07       1C2014B\n NULL     Step 1        6/12/12 10:28       1C2014C\n Step 1   Step 2        6/13/12 8:36        1C2014C\n Step 2   Step 3        6/13/12 9:05        1C2014C\n Step 3   Step 4        6/13/12 10:28       1C2014C\n Step 4   Step 6        6/13/12 10:50       1C2014C\n Step 6   Step 8        6/13/12 12:14       1C2014C\n Step 8   Step 4        6/13/12 15:13       1C2014C\n Step 4   Step 5        6/13/12 15:23       1C2014C\n Step 5   Step 8        6/13/12 15:30       1C2014C\n Step 8   Step 9        6/18/12 14:04       1C2014C\n</code></pre>\n\n<ul>\n<li>The steps are not required to be sequential, so step 1 can happen after step 5.</li>\n<li>The records for an order are not stored sequentially by step or order, but rather are intermixed with other orders based upon the Time Entered.  The sample data being ordered by Order Number then New is NOT normal and cannot be depended upon.</li>\n<li>Each step can be repeated for any given order, if repeated for an order, then sum the times by step.</li>\n<li>The starting step record is always null in the Old column</li>\n<li>Starting step is calculated as the time difference between when it is in the New column and when it is the value in the Old column for a given order.</li>\n</ul>\n\n<p>Output can be as simple as:</p>\n\n<pre><code>Order Number   Step      Time in Step\n1C2014A        Step 1    6:09\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","search","indexed-view"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12711561,"title":"Indexed view to optimize search over multiple tables","body":"<p>I have a question concerning an idea I have about optimizing performance of a complex search query. This is the situation:</p>\n\n<p>Base table, with the fields to search on:</p>\n\n<pre><code>Server (uniqueNumber, serverName, hostName)\n</code></pre>\n\n<p>Tables to join, with the fields to search on:</p>\n\n<pre><code>Customer (Company, vatNumber)\nCustomerContact (firstName, lastName, email, telephone, mobile)\nIp (ipAddress)\n</code></pre>\n\n<p>The idea I had was to create an indexed view like this:</p>\n\n<pre><code>viewServers (ServerID, Term)\n</code></pre>\n\n<p>(clustered index on ServerID, non-clustered on Term)</p>\n\n<p>which is a union of all possible data:</p>\n\n<pre><code>SELECT * FROM (\n    SELECT s.ServerID AS ServerID, c.Company AS Term FROM Customer c \n        INNER JOIN Server s ON s.CustomerID = c.CustomerID\n    UNION\n    SELECT s.ServerID AS ServerID, c.vatNumber AS Term FROM Customer c \n        INNER JOIN Server s ON s.CustomerID = c.CustomerID\n    UNION\n    SELECT s.ServerID AS ServerID, c.firstName AS Term FROM CustomerContact cc \n        INNER JOIN Customer s ON s.CustomerID = cc.CustomerID\n        INNER JOIN Server s ON s.CustomerID = c.CustomerID\n    UNION\n    SELECT s.ServerID AS ServerID, i.ipAddress AS Term FROM Ip i \n        INNER JOIN Server s ON i.ServerID = i.ServerID\n    UNION\n) AS result ORDER BY Term\n</code></pre>\n\n<p>When I want to search, I was planning to this:</p>\n\n<pre><code>SELECT * FROM Server WHERE ServerID IN (SELECT ServerID FROM viewServers WHERE Term LIKE @Term\n</code></pre>\n\n<p>Good or bad idea? </p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12712109,"title":"SQL Server 2008 Upgrade to 2008 R2 Error: Rule \"SQL Server 2008 R2 Feature Upgrade\" failed","body":"<p>I've been trying to upgrade a SQL Server 2008 database to the 2008 R2 version.</p>\n\n<p>While doing the Upgrade Rules check, I get the following error:</p>\n\n<blockquote>\n  <p><em>Rule \"SQL Server 2008 R2 Feature Upgrade\" failed.</em></p>\n  \n  <p><em>The specified edition upgrade is not supported. For information about\n  supported upgrade paths, see the SQL Server 2008 R2 version and\n  edition upgrade matrix in Books Online.</em></p>\n</blockquote>\n\n<p>I am trying to upgrade because I need to import a \"Dump\" that comes from an R2 server and can't be imported into a 2008 server. </p>\n\n<p>After some research, I learned that this might be because I'm trying to upgrade an Express version to a Standard version but I double checked that this is not the case.</p>\n\n<p>I'd like to know why this is happening, how to fix it and if there is not a way to bypass this error and upgrade the server anyways.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":9716869,"title":"Table Insert and Range Check ?","body":"<p>I'm using the <a href=\"http://technet.microsoft.com/en-us/library/dd776382.aspx\" rel=\"nofollow\">Table Value constructor</a> to insert a bunch of rows at a time.</p>\n\n<p>However if i'm using sql replication, I run into a range check constraint on the publisher on my id column managed automatically.</p>\n\n<p>The reason is the fact that the id range doesn't seem to be increased during an insert of several values, meaning that the max id is reached before the actual range expansion could occur (or the id threshold).</p>\n\n<p>It looks like this <a href=\"http://support.microsoft.com/kb/972006\" rel=\"nofollow\">problem</a> for which the solution is either running the merge agent or run the sp_adjustpublisheridentityrange stored procedure.</p>\n\n<p>I'm litteraly doing something like :</p>\n\n<pre><code>INSERT INTO dbo.MyProducts (Name, ListPrice)\nVALUES ('Helmet', 25.50),\n       ('Wheel', 30.00),\n       ((SELECT Name FROM Production.Product WHERE ProductID = 720),\n        (SELECT ListPrice FROM Production.Product WHERE ProductID = 720));\nGO\n</code></pre>\n\n<p>What are my options (if I don't want or can't adopt any of the proposed solution) ? Expand the range ? Decrease the threshold ? </p>\n\n<p>Can I programmatically modify my request to circumvent this problem ? </p>\n\n<p>thanks.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":12710556,"title":"SQL Server compare date in bigint with current date","body":"<p>I've a date/time field stored as BIGINT in the database. I need to retrieve records where the date in the database is older than 30 days from current date. I tried the following and it works. </p>\n\n<p>Is there a better/simpler way to accomplish it?</p>\n\n<pre><code>select \n    datediff(day, CONVERT(DATE, DATEADD(s, dateInBigint / 1000, '19700101'), 102),\n                  CONVERT(date, getdate(),102));\n</code></pre>\n\n<p>e.g.:</p>\n\n<pre><code>select \n   datediff(day, CONVERT(DATE, DATEADD(s, 1348986702000 / 1000, '19700101'), 102),\n                 CONVERT(date, getdate(), 102));\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12710527,"title":"Group by ID and get the name by case statement?","body":"<p>I have the following query</p>\n\n<pre><code>SELECT ID, TestReason\nFROM Test as t\nINNER JOIN TestResult as tr ON t.ID = tr.TestID\n</code></pre>\n\n<p>A test can have multiple test results.</p>\n\n<p>The <code>TestResults</code> are <code>A, B, C</code> or <code>D, F</code>.</p>\n\n<p>I need to say for each test, give me the max test result, but the ID's on the test results have nothing to do with the grade, so I have to use the string.</p>\n\n<p>Here are the tables:</p>\n\n<p><strong>Test</strong></p>\n\n<pre><code>ID    TestReason\nint    int\n</code></pre>\n\n<p><strong>Test Reason</strong></p>\n\n<pre><code>ID    Grade\nint   varchar(2)\n</code></pre>\n\n<p>So basically the highest grade trumps all, so if the test (<code>TestID = 1</code>) contains a test result of <code>A,C,C,D,D</code> I need the 1 record returning like so:</p>\n\n<pre><code>1 A\n</code></pre>\n\n<p>How would I do this?</p>\n"},{"tags":["sql-server","sql-server-2008","windows-vista"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":976,"score":3,"question_id":1320506,"title":"SQL Server 2008 SSMS won't remember password","body":"<p>SQL Server 2008 doesn't remember password inspite of checking the \"Remember Password\" checkbox.</p>\n\n<p>I was suspecting a reboot would solve the problem. But, the issue persists.</p>\n\n<p>Environment: Windows Vista Ultimate, SQL Server 2008 </p>\n\n<p>I have been hesitant to post this, as it seems so trivial and weird.</p>\n"}]}
{"total":21074,"page":16,"pagesize":100,"questions":[{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12710422,"title":"Search in SQL Server table NVARCHAR column ignoring unicode special characters","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2461522/how-do-i-perform-an-accent-insensitive-compare-e-with-e-e-e-and-e-in-sql-ser\">How do I perform an accent insensitive compare (e with &#232;, &#233;, &#234; and &#235;) in SQL Server?</a>  </p>\n</blockquote>\n\n\n\n<p>Let's say I have in my column text:</p>\n\n<pre><code>\"some text ... España .. some text\"\n</code></pre>\n\n<p>Is it possible to write query which returns me this row even if I write:</p>\n\n<pre><code>where dataColumn LIKE N'%espana%' \n</code></pre>\n\n<p>I have limited number of special characters that I have to ignore</p>\n\n<p>thanks for any help</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","date"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12708616,"title":"Finding months between given dates","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/7885851/months-between-two-dates\">Months between two dates</a>  </p>\n</blockquote>\n\n\n\n<p>I need to bring the result ,what are the months falls between two dates.  </p>\n\n<p>Eg. Suppose date is</p>\n\n<pre><code>Declare @FrDate datetime,@ToDate datetime\nSet @FrDate ='2010-05-31 17:38:58.577' \nSet @ToDate ='2010-09-01 17:38:58.577'\n</code></pre>\n\n<p>need Output </p>\n\n<pre><code>Result\nMAY\nJUN\nJUL\nAUG\nSEP\n</code></pre>\n"},{"tags":["sql-server-2008","group-by"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":582,"score":2,"question_id":11920317,"title":"COUNT(DISTINCT) in multiple columns in SQL Server 2008","body":"<p>In Oracle, it's possible to get a count of distinct values in multiple columns by using the <strong>||</strong> operator (according to <a href=\"http://www.dbasupport.com/forums/showthread.php?t=11349\" rel=\"nofollow\">this forum post</a>, anyway):</p>\n\n<pre><code>SELECT COUNT(DISTINCT ColumnA || ColumnB) FROM MyTable\n</code></pre>\n\n<p>Is there a way to do this in SQL Server 2008?  I'm trying to perform a single query to return some group statistics, but I can't seem to do it.</p>\n\n<p>For example, here is a table of values I'm trying to query:</p>\n\n<pre><code>AssetId MyId    TheirId   InStock\n328     10      10        1\n328     20      20        0\n328     30      30        0\n328     40      10        0\n328     10      10        0\n328     10      10        0\n328     10      10        0\n328     10      10        0\n</code></pre>\n\n<p>For AssetId #328, I want to compute the total number of unique IDs in the <strong>MyId</strong> and <strong>TheirId</strong> columns (4 = 10, 20, 30, 40), as well as the total number of non-zero rows in the <strong>InStock</strong> column (1):</p>\n\n<pre><code>AssetId     TotalIds    AvailableIds\n328         4           1\n</code></pre>\n\n<p>Is there a way to work this magic somehow?</p>\n"},{"tags":[".net","sql-server-2008","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":12707375,"title":"Stored procedure is slow in Entity Framework","body":"<p>I am calling a stored procedure (that returns data) from Entity Framework using the query below</p>\n\n<pre><code>from sp in db.GetSale(bID, SID,m,y).Where(x =&gt; x.isActive == true)\nselect sp\n</code></pre>\n\n<p>If I run this procedure directly, it takes only 2 seconds, but when I call this stored procedure through EF, it is taking 10 to 15 seconds. </p>\n\n<p>Any guidance to improve the situation? I have seen other post here on SO but have no success</p>\n\n<p>Edit</p>\n\n<p>Here is sqlplan for my procedure\n<a href=\"https://skydrive.live.com/redir?resid=87DCBD5D3E9AAA57!374\" rel=\"nofollow\">https://skydrive.live.com/redir?resid=87DCBD5D3E9AAA57!374</a></p>\n"},{"tags":["sql","sql-server-2008","ssms"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12602036,"title":"SSMS 2008 Estimated Execution Plan, Execution Plan Analysis tooltip disappears","body":"<p>In SQL Server Management Studio 2008, when I run an estimated execution plan, I right click in the results to display the Execution Plan Analysis.</p>\n\n<p>On the left of the estimated execution plan are icons that allow you to see the information about the plan.  To see the text you have to hover your mouse over the icons.  The text displays in tooltips.  However, the tooltips disappear after a couple of seconds and I have to move my mouse away and re-hover.  This makes if very difficult to read.</p>\n\n<p>Is there another way or place to see this text?</p>\n\n<p>Thanks!</p>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005","asp.net-4.0","asp.net-3.5"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":138,"score":1,"question_id":12660926,"title":"Add Column in Grid view according to SQL query","body":"<p>I am using this query:</p>\n\n<pre><code>select EmployeeId, receptionist_name, date_of_sale,\n  count(date_of_sale) \nfrom FrontOffice \ngroup By EmployeeId, receptionist_name, date_of_sale \norder by date_of_sale\n</code></pre>\n\n<p>for filling the grid view. But I can bound the <code>EmployeeId</code>, <code>receptionist_name</code>, <code>date_of_sale</code>, so can you tell me how can I bound the 4th column in grid view and how to fill the grid view.</p>\n\n<p><strong>UPDATE:</strong> Here is the code I am using:</p>\n\n<pre><code>&lt;Columns&gt; \n    &lt;asp:BoundField HeaderText=\"Date\" DataField=\"date_of_sale\" /&gt; \n    &lt;asp:BoundField HeaderText=\"Employe Id\" DataField=\"EmployeeId\" /&gt; \n    &lt;asp:BoundField HeaderText=\"Receiptist Name\" DataField=\"receptionist_name\" /&gt; \n    &lt;asp:TemplateField HeaderText=\"No. of Prospectus Sale\"&gt; \n    &lt;ItemTemplate&gt; \n        &lt;asp:Label ID=\"salecount\" runat=\"server\" \n          Text='&lt;%# Eval(\"SaleCount\") %&gt;'&gt;&lt;/asp:Label&gt; \n    &lt;/ItemTemplate&gt; \n    &lt;/asp:TemplateField&gt; \n&lt;/Columns&gt;\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":12705789,"title":"Find n largest values in a column ","body":"<p>I am trying to find the n largest numbers in a particular column in SQL Server.</p>\n\n<p>We can find the largest value in a column and the 2nd largest value easily.</p>\n\n<p>But how do I find say, 5 largest values in a column ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","deadlock"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12707122,"title":"Why would a select/read cause an exclusive (X) lock?","body":"<p>Some deadlocks are occurring in a database used by an API I'm working on. This is only happening when the API is load tested. During the initial investigation and research some importing indexes seemed to be missing and have now been applied. This seems to have resolved the deadlock issue. Before the indexes were applied SQL was performing an index scan. After the indexes were applied SQL was performing an index seek.</p>\n\n<p>The reason for this question is to solidify my understanding of deadlocks. I'm still a bit confused as to why without the indexes the select statements caused an exclusive (X) Lock in MS SQL?</p>\n\n<p>This is purely, I think, down to me not understanding the deadlock graph. From what I can see the 2 processes in the picture below are both doing selects.. so how can that cause the exclusive (X) lock? Is there something not on the graph perhaps?</p>\n\n<p>Here is the deadlock graph which occurs without the extra indexes:</p>\n\n<p><img src=\"http://i.stack.imgur.com/7R2OC.png\" alt=\"enter image description here\"></p>\n\n<p>...and here is the XML ( from that graph:</p>\n\n<pre><code>&lt;deadlock-list&gt;\n &lt;deadlock victim=\"process4c3708\"&gt;\n  &lt;process-list&gt;\n   &lt;process id=\"process4c3708\" taskpriority=\"0\" logused=\"1580\" waitresource=\"KEY: 5:72057594038910976 (a94bedf44228)\" waittime=\"99\" ownerId=\"13602992\" transactionname=\"user_transaction\" lasttranstarted=\"2012-10-03T10:59:34.830\" XDES=\"0x8cbf23b0\" lockMode=\"S\" schedulerid=\"3\" kpid=\"7588\" status=\"suspended\" spid=\"67\" sbid=\"0\" ecid=\"0\" priority=\"0\" trancount=\"1\" lastbatchstarted=\"2012-10-03T10:59:35.027\" lastbatchcompleted=\"2012-10-03T10:59:35.020\" clientapp=\".Net SqlClient Data Provider\" hostname=\"DEVMACHINE\" hostpid=\"8440\" loginname=\"user\" isolationlevel=\"read committed (2)\" xactid=\"13602992\" currentdb=\"5\" lockTimeout=\"4294967295\" clientoption1=\"671088672\" clientoption2=\"128056\"&gt;\n    &lt;executionStack&gt;\n     &lt;frame procname=\"adhoc\" line=\"1\" stmtstart=\"170\" stmtend=\"728\" sqlhandle=\"0x02000000b3a88339052734f326b9dbb95deb1d46fe4d192d\"&gt;\nselect basefolder1_.Identifier as col_0_0_ from TradeInfo tradepr0_ inner join BaseFolder basefolder1_ on tradepr0_.BaseFolderId=basefolder1_.Id where basefolder1_.BoxId=@p0 and tradepr0_.PersonId=@p1 and tradepr0_.CurrentTrade=1 and tradepr0_.IsActive=1;     &lt;/frame&gt;\n     &lt;frame procname=\"unknown\" line=\"1\" sqlhandle=\"0x000000000000000000000000000000000000000000000000\"&gt;\nunknown     &lt;/frame&gt;\n    &lt;/executionStack&gt;\n    &lt;inputbuf&gt;\n(@p0 uniqueidentifier,@p1 uniqueidentifier,@p2 uniqueidentifier,@p3 uniqueidentifier)select basefolder1_.Identifier as col_0_0_ from TradeInfo tradepr0_ inner join BaseFolder basefolder1_ on tradepr0_.BaseFolderId=basefolder1_.Id where basefolder1_.BoxId=@p0 and tradepr0_.PersonId=@p1 and tradepr0_.CurrentTrade=1 and tradepr0_.IsActive=1;\nselect basefolder1_.Identifier as col_0_0_ from TradeInfo tradepr0_ inner join BaseFolder basefolder1_ on tradepr0_.BaseFolderId=basefolder1_.Id where basefolder1_.BoxId=@p2 and tradepr0_.PersonId=@p3 and tradepr0_.SuspendedTrade=1 and tradepr0_.IsSuspended=1;\n    &lt;/inputbuf&gt;\n   &lt;/process&gt;\n   &lt;process id=\"process5dd4c8\" taskpriority=\"0\" logused=\"1580\" waitresource=\"KEY: 5:72057594038910976 (b34811986aff)\" waittime=\"301\" ownerId=\"13602927\" transactionname=\"user_transaction\" lasttranstarted=\"2012-10-03T10:59:34.660\" XDES=\"0xafb9f950\" lockMode=\"S\" schedulerid=\"4\" kpid=\"2076\" status=\"suspended\" spid=\"61\" sbid=\"0\" ecid=\"0\" priority=\"0\" trancount=\"1\" lastbatchstarted=\"2012-10-03T10:59:35.020\" lastbatchcompleted=\"2012-10-03T10:59:35.020\" clientapp=\".Net SqlClient Data Provider\" hostname=\"DEVMACHINE\" hostpid=\"8440\" loginname=\"user\" isolationlevel=\"read committed (2)\" xactid=\"13602927\" currentdb=\"5\" lockTimeout=\"4294967295\" clientoption1=\"671088672\" clientoption2=\"128056\"&gt;\n    &lt;executionStack&gt;\n     &lt;frame procname=\"adhoc\" line=\"1\" stmtstart=\"170\" stmtend=\"728\" sqlhandle=\"0x02000000b3a88339052734f326b9dbb95deb1d46fe4d192d\"&gt;\nselect basefolder1_.Identifier as col_0_0_ from TradeInfo tradepr0_ inner join BaseFolder basefolder1_ on tradepr0_.BaseFolderId=basefolder1_.Id where basefolder1_.BoxId=@p0 and tradepr0_.PersonId=@p1 and tradepr0_.CurrentTrade=1 and tradepr0_.IsActive=1;     &lt;/frame&gt;\n     &lt;frame procname=\"unknown\" line=\"1\" sqlhandle=\"0x000000000000000000000000000000000000000000000000\"&gt;\nunknown     &lt;/frame&gt;\n    &lt;/executionStack&gt;\n    &lt;inputbuf&gt;\n(@p0 uniqueidentifier,@p1 uniqueidentifier,@p2 uniqueidentifier,@p3 uniqueidentifier)select basefolder1_.Identifier as col_0_0_ from TradeInfo tradepr0_ inner join BaseFolder basefolder1_ on tradepr0_.BaseFolderId=basefolder1_.Id where basefolder1_.BoxId=@p0 and tradepr0_.PersonId=@p1 and tradepr0_.CurrentTrade=1 and tradepr0_.IsActive=1;\nselect basefolder1_.Identifier as col_0_0_ from TradeInfo tradepr0_ inner join BaseFolder basefolder1_ on tradepr0_.BaseFolderId=basefolder1_.Id where basefolder1_.BoxId=@p2 and tradepr0_.PersonId=@p3 and tradepr0_.SuspendedTrade=1 and tradepr0_.IsSuspended=1;\n    &lt;/inputbuf&gt;\n   &lt;/process&gt;\n  &lt;/process-list&gt;\n  &lt;resource-list&gt;\n   &lt;keylock hobtid=\"72057594038910976\" dbid=\"5\" objectname=\"ccp.dbo.TradeInfo\" indexname=\"PK__Activity__3214EC07060DEAE8\" id=\"lock8011dd00\" mode=\"X\" associatedObjectId=\"72057594038910976\"&gt;\n    &lt;owner-list&gt;\n     &lt;owner id=\"process5dd4c8\" mode=\"X\"/&gt;\n    &lt;/owner-list&gt;\n    &lt;waiter-list&gt;\n     &lt;waiter id=\"process4c3708\" mode=\"S\" requestType=\"wait\"/&gt;\n    &lt;/waiter-list&gt;\n   &lt;/keylock&gt;\n   &lt;keylock hobtid=\"72057594038910976\" dbid=\"5\" objectname=\"ccp.dbo.TradeInfo\" indexname=\"PK__Activity__3214EC07060DEAE8\" id=\"lock8a864e00\" mode=\"X\" associatedObjectId=\"72057594038910976\"&gt;\n    &lt;owner-list&gt;\n     &lt;owner id=\"process4c3708\" mode=\"X\"/&gt;\n    &lt;/owner-list&gt;\n    &lt;waiter-list&gt;\n     &lt;waiter id=\"process5dd4c8\" mode=\"S\" requestType=\"wait\"/&gt;\n    &lt;/waiter-list&gt;\n   &lt;/keylock&gt;\n  &lt;/resource-list&gt;\n &lt;/deadlock&gt;\n&lt;/deadlock-list&gt;\n</code></pre>\n"},{"tags":["c#","sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12706669,"title":"Error in in select data from table in SQL Server","body":"<p>I use this code to select from a table in SQL Server 2008:</p>\n\n<pre><code>sqlcomm.CommandText = \"select [objId] from [tablename] where href = @href\"\n</code></pre>\n\n<p>The type of <code>href</code> in my table is <code>ntext</code> and I use this code to select:</p>\n\n<pre><code> sqlcomm.Parameters.Add(\"@href\", SqlDbType.NVarChar);\n sqlcomm.Parameters[\"@href\"].Value = 'somestring';\n IDataReader reader = sqlcomm.ExecuteReader();\n</code></pre>\n\n<p>But it errors: </p>\n\n<blockquote>\n  <p><em>The data types ntext and varchar are incompatible in the equal to operator</em></p>\n</blockquote>\n\n<p>When I use <code>SqlDbType.NText</code> it have same error. I can't change type of <code>href</code> column in my table. When I use <code>like @href</code> it works, but I couldn't use <code>LIKE</code> because I want to exact match.</p>\n\n<p>How can I solve my problem?</p>\n"},{"tags":["sql","sql-server-2008","decimal"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12706689,"title":"SQL Format as of Round off removing decimals","body":"<p>I have a calculated field 'MySum' in inner query whose value after calculation is 58.</p>\n\n<p>I need to get 20% of this value.</p>\n\n<p>If I give: </p>\n\n<pre><code>MySum * 20 /100, I get 11\n</code></pre>\n\n<p>If I give: </p>\n\n<pre><code>((20 * CAST(MySum as decimal(6,2)))/100) , I get 11.60000\n</code></pre>\n\n<p>If I give </p>\n\n<pre><code>Round(((20 * CAST(MySum as decimal(6,2)))/100), 2), I still get 11.60000\n</code></pre>\n\n<p>I want that,</p>\n\n<p>If result comes 11.6, it should display 12 and if result is 11.4, it should display 11.</p>\n\n<p>I want to Rounded off values. Any function for that ?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12706245,"title":"sql server alter permission","body":"<p>Experts</p>\n\n<p>I am trying to set up permission for our IT team. All our IT staffs are member of I.T group. With  the database in question  the IT staffs  groups are member of db_reader, db_reader and can execute all SP/Fun. one particular user I want to give the permission to modify the objects. </p>\n\n<pre><code>CREATE USER [S\\Al] FOR LOGIN [S\\Al] WITH DEFAULT_SCHEMA=[dbo]\n</code></pre>\n\n<p>added him to db_ddlAmin role</p>\n\n<pre><code>EXEC sp_addrolemember N'db_ddladmin', N'S\\Al'\n</code></pre>\n\n<p>all the objects in our db belongs to DBO schema..so i have give alter permission on dbo schema to the user</p>\n\n<pre><code>GRANT ALTER ON SCHEMA::[dbo] TO [S\\Al]\n</code></pre>\n\n<p>But when this user tries to modify an sp or drop a table he gets </p>\n\n<p>Cannot alter the procedure 'XX', because it does not exist or you do not have permission.\nCannot drop table 'XX', because it does not exist or you do not have permission. </p>\n\n<p>This user can create a new table, but if he tries to drop the newly  created table he get the permission error..</p>\n\n<p>This user is member of 4 other group where the group  is a member of either db_owner or db_ddladmin role, </p>\n\n<p>What am I doing wrong, how can i resolve this..</p>\n\n<p>Thanks</p>\n\n<p>VT</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":2,"view_count":105,"score":2,"question_id":12671117,"title":"Comma Separated values with SQL Query","body":"<p>My SQL table is like following</p>\n\n<pre><code>City_Code     Post_Code    Post_Code_Description\n100           A1           ABC\n100           C8           XYZ\n100           Z3           MNO\n200           D4           LMN\n300           E3           IJK\n300           B9           RST\n</code></pre>\n\n<p>It's a mapping between city_code and Post_Code. One City_Code has many Post Codes. Now i want to run a Query to get something like following</p>\n\n<pre><code>City_Code     Post_Code    Post_Code_Description\n100           A1,C8,Z3     ABC,XYZ,MNO\n200           D4           LMN\n300           E3,B9        IJK,RST\n</code></pre>\n\n<p>Can you please help me with thisy SQL table is like following</p>\n"},{"tags":["asp.net","sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":12702217,"title":"Creating a select query based on selected checkboxes in asp.net in stored procedure","body":"<p>I've two tables in the database named Customer and orders. In my ASP.NET page I've checkboxes representing the the fields in those two tables. <img src=\"http://i.stack.imgur.com/Vp0bj.jpg\" alt=\"enter image description here\"></p>\n\n<p>The user can select from the checkboxes (Firstname,OrderitemName is compulsory). Based on the selected checkboxes,  I need to generate a sql query. The query will be returning the results with filter applied from the CustomerType Drop down list when the user presses Submit button.</p>\n\n<p>For this, I checked whether the checkbox is selected in my code and passed it as bit type in my stored procedure. My stored procedure is,</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[GetCustomerDetails]     \n@LastName BIT,\n@Phone BIT,\n@Email BIT,\n@Quantity BIT,\n@OrderedDate BIT,\n@ReturnPolicy BIT,\n@CustomerType nvarchar(40)  \n</code></pre>\n\n<p>AS\nBEGIN\n    SET NOCOUNT ON\n    DELCARE \n        @Sql NVARCHAR(4000)</p>\n\n<pre><code>SET @Sql='SELECT c.FirstName,o.OrderItemName'\nIF @LastName =1\n    BEGIN\n        SET @Sql=@sql+'c.LastName,'\n    END \nIF @Phone =1\n    BEGIN\n         SET @Sql=@sql+'c.Phone,'\n    END \nIF @Email =1\n    BEGIN\n        SET @Sql=@sql+'c.Email,'\n    END\nIF @Quantity =1\n    BEGIN\n        SET @Sql=@sql+'o.Quantity,'\n    END \nIF @OrderDate =1\n    BEGIN\n        SET @Sql=@sql+'o.OrderDate,'\n    END \nIF @ReturnPolicy =1\n    BEGIN\n        SET @Sql=@sql+'o.ReturnPolicy'\n    END\n\nSET @sql=@sql +' ' +'from Customer c inner join Order o on c.CustomerId=o.CustomerID where c.CustomerType =' + '@CustomerType'\n\nEXEC(@sql)\n</code></pre>\n\n<p>END</p>\n\n<p>Right now, many additional table columns (30 columns) had been added in the checkbox in the asp.net page. This is just adding too many bit type variables and if conditions to check those bit type variable and concatenate it to @sql based on those bit type variable in the stored procedure. Is there any better way to accomplish this? Please suggest.</p>\n"},{"tags":["sql","sql-server-2008","excel","ssas"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12701683,"title":"Pivot table and get aggregation on multiple arguments","body":"<p>this is my base table:</p>\n\n<pre><code>Region year carsSold bicyclesSold\nRegX   1999       50          100\nRegX   2000      150           30\nRegY   1998       60           40\n</code></pre>\n\n<p>What I would like to have as a result is:</p>\n\n<pre><code>Region Year          1998 1999 2000\nRegX   carsSold         0   50  150\n       bicyclesSold     0  100   30  \nRegY   carsSold        60    0    0\n       bicyclesSold    40    0    0\n</code></pre>\n\n<p>Is there any way to do it in sql server ? Is there a way to do this in excel ? What is the best solution for such data presentation. Could You suggest any software  appropriate for that ?</p>\n\n<p>I know about Pivoting tables in sql server but cant write anything what would give result close to what excactly I want</p>\n"},{"tags":["sql","sql-server-2008","pivot","pivot-table"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":144,"score":2,"question_id":12701872,"title":"T-SQL PIVOT: One row to column name and the other to value","body":"<p>I am using SQL Server 2008.</p>\n\n<p>I have two tables </p>\n\n<ol>\n<li><code>User</code> (<code>UserID, Name, Link</code>)</li>\n<li><code>UserNotes</code> (<code>NoteID, UserID, Title, Description</code>)</li>\n</ol>\n\n<p>This is the sample data structure.</p>\n\n<pre><code>INSERT INTO [User]\n    ([UserID], [Name], [Link])\nVALUES\n    (1, 'John', 'L1'),\n    (2, 'Steve', 'L234');\n\nINSERT INTO [UserNotes]\n    ([NoteID], [UserID], [Title], [Description])\nVALUES\n    (1, 1, 'AboutJohn', 'This is about john'),\n    (2, 1, 'John Work', 'This is where John work'),\n    (3, 1, 'John Education', 'This is the uni where John go'),\n    (4, 2, 'Steve Note1', 'Des1 about Steve'),\n    (5, 2, 'Steve Note2', 'Des2 about Steve');\n</code></pre>\n\n<p>Here is <a href=\"http://sqlfiddle.com/#!3/4f77d\" rel=\"nofollow\">SQL Fiddle</a></p>\n\n<p>I want to create view (<code>User_view</code>) as follows and when I execute this command the output should be as follows.</p>\n\n<pre><code>SELECT * FROM User_view WHERE UserID IN (1)\n\nUserID    Name   AboutJOhn              JohnWork                  JohnEducation\n1         John   This is about john     This is where Johnwork    This is the uni where John go\n</code></pre>\n\n<p><code>Title</code> column of child table should become column name and <code>Description</code> should become value of that column and we do not know how many rows we will have. I am aware of the issue when we select two users and which name to use column name. In that case we can use (Note1, Note2, Note3, etc for multiple User), otherwise use title field as Column name. Is it possible to do so? Cheers!</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":26,"score":0,"question_id":12703044,"title":"Difference between stored procedure and function in SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1179758/function-vs-stored-procedure-in-sql-server\">Function vs. Stored Procedure in SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>I want to know what the differences between a stored procedure and a function in SQL Server are?</p>\n\n<p>And where each one is used in ?</p>\n\n<p>For example I have just written a stored procedure and I have finished it with </p>\n\n<pre><code>return @@Identity \n</code></pre>\n\n<p>So can we say is this a function because this will return a value?</p>\n\n<p>These sort of problems has made me distracted.</p>\n"},{"tags":["c#",".net","sql-server-2008","syncframework","microsoft-sync-framework"],"answer_count":1,"favorite_count":16,"up_vote_count":13,"down_vote_count":0,"view_count":6710,"score":13,"question_id":1656652,"title":"Syncing SQL Server 2008 Databases over HTTP using WCF & Sync Framework","body":"<p>I've tried to get a solution for the above said question from MSDN Social and other resources from Microsoft. I was specifically looking for offline scenarios where client come online only to fetch updates from the Server. </p>\n\n<p>There are plenty of articles on Sync covering Sql CE but MSFT team seems to be ignoring questions from the community on Syncing with Sql Express clients. There is no standard provider for Sql Express client yet, and Sql 2008 change tracking is not supported in the latest release too. Since Sql Replication is an expensive alternative, I have to go with Sync Framework.</p>\n\n<p><strong>Have anyone here in SO worked with Sync Framework, syncing through WCF endpoints? Please share code samples or sample projects.</strong> </p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12700307,"title":"Order of SQL Server statements execution","body":"<p>I have SQL server 2008 R2, windows 7 OS.</p>\n\n<p>Within the server, I have a table <code>con1</code> which was created by following SQL statement.</p>\n\n<pre><code>CREATE TABLE [dbo].[con1](\n    [digit_str] [nvarchar](50) NULL\n) ON [PRIMARY]\n</code></pre>\n\n<p>In the <code>con1</code> table, I have these values:</p>\n\n<pre><code> digit_str\n----------------\n    1\n    1\n    2\n    3\n    4\n    5\n    1.\n</code></pre>\n\n<p>I did executed following SQL statement against the database:</p>\n\n<pre><code>SELECT t1.digit FROM\n(\nselect CAST(digit_str as int) as digit from con1 where RIGHT(digit_str,1) &lt;&gt; '.'\n) as t1\nwhere t1.digit &lt;&gt; 1\n</code></pre>\n\n<p>the server given me following error message:</p>\n\n<blockquote>\n  <p><em>Conversion failed when converting the nvarchar value '1.' to data type int.</em></p>\n</blockquote>\n\n<p>I thought my inner SQL executed first and created a temp table <code>t1</code>, so <code>1.</code> is not included in table <code>t1</code>, then SQL parser will use <code>where t1.digit &lt;&gt; 1</code> to filter temp table <code>t1</code>.</p>\n\n<p>But above seems not right, so any one explains execution order of above SQL?</p>\n"},{"tags":["sql-server","windows","sql-server-2008","windows-7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12701710,"title":"Can SQL server Developer edition be installed on Windows 7 Home Premium?","body":"<p>We are planning to buy OS and RDBMS for our organization. I wanted to know whether SQL server 2008 Developer Edition:</p>\n\n<p><a href=\"http://rads.stackoverflow.com/amzn/click/B003KWQBQ2\" rel=\"nofollow\">http://www.amazon.com/Developer-Edtn-2008-32-bit-English/dp/B003KWQBQ2/ref=sr_1_2?s=software&amp;ie=UTF8&amp;qid=1349233840&amp;sr=1-2&amp;keywords=SQL+Server+Developer+Edition</a></p>\n\n<p>be installed on Windows 7 Home Premium:</p>\n\n<p><a href=\"http://rads.stackoverflow.com/amzn/click/B004Q0PT3I\" rel=\"nofollow\">http://www.amazon.com/Windows-Premium-64bit-System-Builder/dp/B004Q0PT3I/ref=sr_1_1?s=software&amp;ie=UTF8&amp;qid=1349234718&amp;sr=1-1&amp;keywords=windows+7+os</a></p>\n\n<p>Or are they both incompatible? Please suggest your thoughts. I know it installs on Windows 7 Ultimate because I have it on my machine but not sure about Home Premium.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":472,"score":1,"question_id":9331529,"title":"SQL Server NTILE - Same value in different quartile","body":"<p>I have a scenario where i'm splitting a number of results into quartilies using the SQL Server NTILE function below. The goal is to have an as equal number of rows in each class</p>\n\n<pre><code>case NTILE(4) over (order by t2.TotalStd) \n   when 1 then 'A' when 2 then 'B' when 3 then 'C' else 'D' end as Class\n</code></pre>\n\n<p>The result table is shown below and there is a (9,9,8,8) split between the 4 class groups A,B,C and D. </p>\n\n<p>There are two results which cause me an issue, both rows have a same total std value of 30 but are assigned to different quartiles.</p>\n\n<pre><code>8   30  A\n2   30  B\n</code></pre>\n\n<p>I'm wondering is there a way to ensure that rows with the same value are assigned to the same quartile? Can i group or partition by another column to get this behaviour?   </p>\n\n<pre><code>Pos TotalStd    class\n1   16  A\n2   23  A\n3   21  A\n4   29  A\n5   25  A\n6   26  A\n7   28  A\n8   30  A\n9   29  A\n1   31  B\n2   30  B\n3   32  B\n4   32  B\n5   34  B\n6   32  B\n7   34  B\n8   32  B\n9   33  B\n1   36  C\n2   35  C\n3   35  C\n4   35  C\n5   40  C\n6   38  C\n7   41  C\n8   43  C\n1   43  D\n2   48  D\n3   45  D\n4   47  D\n5   44  D\n6   48  D\n7   46  D\n8   57  D\n</code></pre>\n"},{"tags":["c#","sql-server-2008","api","http-post","n-tier"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":68,"score":3,"question_id":12697752,"title":"Creating objects vs. SELECTing directly from database","body":"<p>I'm currently working on an integration project to connect two disparate systems.<br>\nMy plan is to setup an HTTP-API to allow System A to issue commands through HTTP-POST to System B.<br>\nThe commands will be used to issue CRUD instructions to a SQL server database to retrieve and update membership card data (e.g. 'create membership', 'update membership', etc.) and then return the data to System A as XML.  I know n-tier design dictates that I should have a MembershipCard class with several properties:  </p>\n\n<pre><code>public class MembershipCard\n{\n    private string number;\n    private decimal points;\n\n    public string Number\n    {\n        get { return number; }\n        set { number = value; }\n    }\n\n    public decimal Points\n    {\n        get { return points; }\n        set { points = value; }\n    }\n</code></pre>\n\n<p>Along with several methods that make calls to the DAL:  </p>\n\n<pre><code>    public string GetPoints(string cardnumber) \n    {\n        return MembershipCardDB.BalanceRequest(cardnumber);\n    }\n</code></pre>\n\n<p>However, I'm having some difficulty justifying this approach as the static DAL class, MembershipCardDB seems to perform all the work that I need (seen below): </p>\n\n<pre><code>    public static string BalanceRequest(string cardNumber)\n    {\n        string response = string.Empty;\n        string sqlselect = \n            \"SELECT Balance                         \" +\n            \"FROM tbl_MemberShipCard                \" +\n            \"WHERE Card_No = @cardNumber                 \" +\n            \"FOR XML PATH ('Card'), ROOT('CardBalance')\";\n\n        using (SqlConnection connect = new SqlConnection(\"Data Source=TEST\\\\TEST;Initial Catalog=TEST;User Id=sa;Password=TEST\"))\n        {\n            connect.Open();\n            using (SqlCommand command = new SqlCommand(sqlselect))\n            {\n                command.Parameters.AddWithValue(\"@cardNumber\", cardNumber);\n                response = (string)command.ExecuteScalar();\n            }\n        }\n        return response;\n    }\n</code></pre>\n\n<p>Is there anything that I'm overlooking by simply removing the MembershipCard class and just pulling the data from the database and formatting it as XML?</p>\n"},{"tags":["php","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":174,"score":0,"question_id":10608952,"title":"Connect PHP to a local SQL 2008 Express database?","body":"<p>I have spent about a day troubleshooting this and I can't find anything wrong. I get the error:</p>\n\n<pre><code>Could not connect to server: SQL Server Network Interfaces: Error Locating Server/Instance Specified [xFFFFFFFF]\n[message] =&gt; [Microsoft][SQL Server Native Client 11.0]SQL Server Network Interfaces: Error Locating Server/Instance Specified\n</code></pre>\n\n<p>when I try to hit a page that has a db query. I have tried PHP 5.4 and 5.3. My .ini file has the lines,</p>\n\n<pre><code>extension=php_sqlsrv_53_nts.dll\n\n[sqlsrv]\nsqlsrv.LogSubsystems = 0\nsqlsrv.LogSeverity = 0\nsqlsrv.WarningReturnAsErrors = 0\n</code></pre>\n\n<p>and php_sqlsrv_53_nts.dll is in the ext folder. <code>phpinfo()</code> shows:</p>\n\n<pre><code>sqlsrv\nsqlsrv support  enabled\n\nDirective   Local Value Master Value\nsqlsrv.ClientBufferMaxKBSize    10240   10240\nsqlsrv.LogSeverity  0   0\nsqlsrv.LogSubsystems    0   0\nsqlsrv.WarningsReturnAsErrors   On  On\n</code></pre>\n\n<p>so I know the driver is loaded. My connection code is:</p>\n\n<pre><code>define('DB_SERVER',     '(local)\\sqlexpress');\ndefine('DB_NAME',       'DatabaseName');\n\npublic function __construct() {\n    $connectionInfo = array('Database' =&gt; DB_NAME, 'ReturnDatesAsStrings' =&gt; true);\n    $this-&gt;connection = sqlsrv_connect( DB_SERVER, $connectionInfo ) or die('Could not connect to server: &lt;br/&gt;&lt;br/&gt;'.print_r( sqlsrv_errors(), true));\n}\n</code></pre>\n\n<p>This is a local db, so there shouldn't be any issues with tcp, named pipes, etc. I can connect to this db fine in .Net projects. At this point I'm open to anything as I've scoured Google and Stack Overflow and tried just about everything.</p>\n"},{"tags":["php","database","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":96,"score":1,"question_id":10623862,"title":"sqlsvr_connect() not connecting!? Trying to connect with php","body":"<p>Im trying to connect to a ms sql database, but I'm running into a timeout error... </p>\n\n<p>I already installed the microsoft driver by adding and enabling, </p>\n\n<pre><code>extension=php_sqlsrv_53_ts.dll\n</code></pre>\n\n<p>in my php.ini file, and added the dll into my php extenstions, which is in my \"C:\\Program Files\\PHP\\ext\"... and also, my extension_dir in my php.ini is also \"C:\\Program Files\\PHP\\ext\"</p>\n\n<p>I am using this code to connect...</p>\n\n<pre><code>phpinfo();\n\n$serverName = \"xxx.xxx.xxx.xxx/sqlexpress\";\n\n$connectionInfo = array(\n     \"Database\"=&gt;\"dbname\", \n     \"UID\"=&gt;\"username\", \n     \"PWD\"=&gt;\"password\");\n\n$conn = sqlsrv_connect( $serverName, $connectionInfo);\n\nif($conn){\n     echo \"Connection established.\\n\";\n}else{\n     echo \"Connection could not be established.\\n\";\n     die( print_r( sqlsrv_errors(), true));\n}\n</code></pre>\n\n<p>The phpinfo() is showing that sqlsrv is indeed in Registered PHP Streams.  The problem is not an undefined function, but it just keeps loading... it doesn't timeout, it doesn't give me an error, it just keeps thinking...  Am I missing something? please help!</p>\n"},{"tags":["php","sql-server-2008","wamp"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2482,"score":2,"question_id":9254329,"title":"Connecting to SQL Server 2008 through PHP","body":"<p>I need to connect to a SQL Server 2008 through PHP (WAMP, latest version). I have the sqlsrv drivers installed and set up and they do show up in <code>phpinfo()</code>.</p>\n\n<p>I'm using the following lines to connect to my DB, using Windows Authentication:</p>\n\n<pre><code>$serverName = \"(local)\";\n$connectionOptions = array(\"Database\"=&gt;\"MyTestDatabase\");\n$conn = sqlsrv_connect( $serverName, $connectionOptions) or die(\"Error!\");\n</code></pre>\n\n<p>And I'm getting the following error:</p>\n\n<pre><code>Array \n( \n    [0] =&gt; Array \n    ( \n        [0] =&gt; IMSSP \n        [SQLSTATE] =&gt; IMSSP \n        [1] =&gt; -49\n        [code] =&gt; -49 \n        [2] =&gt; This extension requires the Microsoft SQL Server 2011 Native Client. Access the following URL to download the Microsoft SQL Server 2011 Native Client ODBC driver for x86: http://go.microsoft.com/fwlink/?LinkId=163712 \n        [message] =&gt; This extension requires the Microsoft SQL Server 2011 Native Client. Access the following URL to download the Microsoft SQL Server 2011 Native Client ODBC driver for x86: http://go.microsoft.com/fwlink/?LinkId=163712\n    ) \n    [1] =&gt; Array \n    ( \n        [0] =&gt; IM002 \n        [SQLSTATE] =&gt; IM002 \n        [1] =&gt; 0 \n        [code] =&gt; 0 \n        [2] =&gt; [Microsoft][ODBC Driver Manager] Data source name not found and no default driver specified \n        [message] =&gt; [Microsoft][ODBC Driver Manager] Data source name not found and no default driver specified\n    )\n)\n</code></pre>\n\n<p>Any help would be great, but please be specific since I really don't know my way around WAMP except for a few basics.</p>\n"},{"tags":["php","sql-server-2008","iis7","sql-server-native-client"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":319,"score":1,"question_id":9779990,"title":"Connecting to a SQL Express server with PHP","body":"<ul>\n<li>PHP Version 5.3.10</li>\n<li>IIS Version 7.5</li>\n<li>SQL Express server 2008 r2</li>\n<li>PHP extensions php_pdo_sqlsrv_53_ts.dll and php_sqlsrv_53_ts.dll.  </li>\n</ul>\n\n<p>The problem is that when I run this PHP code: </p>\n\n<pre><code>if (function_exists('sqlsrv_connect')) {  \n    echo \"Connection functions are available.\\n\";  \n} else {  \n    echo \"Connection functions are not available.&lt;br /&gt;\\n\";  \n}  \n$serverName = \"TEST-DESKTOP\\SQLEXPRESS\";  \n$connectionInfo = array( \"Database\"=&gt;\"DALEDB\");  \n\n// connection to the database  \n$conn = sqlsrv_connect( $serverName, $connectionInfo);  \nif( $conn === false )\n{\n    echo \"Could not connect.&lt;br /&gt;\";\n    die( print_r( sqlsrv_errors(), true));\n}\n</code></pre>\n\n<p>My output is:</p>\n\n<pre><code>Connection functions are available\nCould not connect\n\nArray\n(\n    [0] =&gt; Array\n    (\n        [0] =&gt; IMSSP \n        [SQLSTATE] =&gt; IMSSP \n        [1] =&gt; -49 \n        [code] =&gt; -49 \n        [2] =&gt; This extension requires the Microsoft SQL Server 2011 Native Client. Access the following URL to download the Microsoft SQL Server 2011 Native Client ODBC driver for x86: http://go.microsoft.com/fwlink/?LinkId=163712 \n        [message] =&gt; This extension requires the Microsoft SQL Server 2011 Native Client. Access the following URL to download the Microsoft SQL Server 2011 Native Client ODBC driver for x86: http://go.microsoft.com/fwlink/?LinkId=163712\n    ) \n    [1] =&gt; Array\n    (\n        [0] =&gt; IM002 \n        [SQLSTATE] =&gt; IM002 \n        [1] =&gt; 0 \n        [code] =&gt; 0 \n        [2] =&gt; [Microsoft][ODBC Driver Manager] Data source name not found and no default driver specified \n        [message] =&gt; [Microsoft][ODBC Driver Manager] Data source name not found and no default driver specified\n    )\n) \n</code></pre>\n\n<p>I already had the 2008 r2 native client but I installed the 2011 client to no success and have been stuck at this point for the past 2 days. If anyone could give me some pointers it would be much appreciated.</p>\n"},{"tags":["sql-server-2008","sqlclr"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":12691396,"title":"How do you check the version number of a sql server clr?","body":"<p>What is the best way to check / version a sql server clr?\nI am currently creating a SqlFunction that returns a version number (which I set before release).  This allows me to query the version e.g.</p>\n\n<pre><code>select mySchema.GetClrAppVersion\n</code></pre>\n\n<p>Any thoughts or ideas would be appreciated.</p>\n"},{"tags":["sql-server-2008","identity-insert","generate-scripts"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12696567,"title":"SQL Server Generate Scripts with Identity Insert","body":"<p>When generating database scripts, I'm scripting data to be migrated to a different environment.  Is there a setting in the script generation that I can enable to set IDENTITY_INSERT on/off automatically so I don't have to go through each table manually in the generated script and set it? I'm using SSMS and I'd like to do this via SSMS.</p>\n\n<p>Here's what I am getting:</p>\n\n<pre><code>INSERT my_table (my_table_id, my_table_name) VALUES (1, 'val1');\nINSERT my_table (my_table_id, my_table_name) VALUES (2, 'val2');\n</code></pre>\n\n<p>Here's what I want:</p>\n\n<pre><code>SET IDENTITY_INSERT my_table ON\nINSERT my_table (my_table_id, my_table_name) VALUES (1, 'val1');\nINSERT my_table (my_table_id, my_table_name) VALUES (2, 'val2');\nSET IDENTITY_INSERT my_table OFF\n</code></pre>\n"},{"tags":["php","sql-server-2008","wamp"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1149,"score":0,"question_id":9249690,"title":"How to connect to SQL Server database through PHP?","body":"<p>I'm building a web-service for an Android application that needs to connect to a SQL Server database. I'm trying to connect through PHP (WAMP) on my home computer to the SQL Server database.</p>\n\n<p>However, I don't have experience SQL Server and don't know how to proceed. For SQL Server, I'm using default settings and Windows Authentication, so I'm not sure what to type into the connection string.</p>\n\n<p>Below you have my connection:</p>\n\n<pre><code>$connStr = \"PROVIDER=SQLOLEDB;SERVER=\".$myServer.\";UID=\".$myUser.\";PWD=\".$myPass.\";DATABASE=\".$myDB; \n$conn-&gt;open($connStr); //Open the connection to the database\n</code></pre>\n\n<p>I haven't found a concrete example anywhere so far, so I need to know what the variables <code>$myServer</code>, <code>$myUser</code> etc. need to be in the case of Windows Authentication.</p>\n\n<p>Alternatively, how can I switch to a User-Name and Password Authentication in SQL Server?</p>\n\n<p>LE: Using Microsoft SQL Server 2008 and SQL Server Management Studio</p>\n"},{"tags":["sql-server","sql-server-2008","arabic","fulltext"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12243423,"title":"FullText search does not match Arabic Kaaf letter In Arabic mode","body":"<p>When I use full text in arabic language and search in table,\nany record that contains arabic Kaaf letter (ك) does not appear in the result.</p>\n\n<p>When I use full text in neutral mode I can search them!!</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12686149,"title":"T-SQL pivot with more the one non-pivot columns","body":"<p>I have several columns and making pivot. I want to have multiple non-pivot columns and to make pivot using the last one. In the original specification <a href=\"http://msdn.microsoft.com/en-us/library/ms177410%28v=sql.105%29.aspx\" rel=\"nofollow\">here</a> it is shown that you can have only one non-pivot column.</p>\n\n<pre><code>SELECT &lt;non-pivoted column&gt;,\n\n    [first pivoted column] AS &lt;column name&gt;,\n\n    [second pivoted column] AS &lt;column name&gt;,\n\n    ...\n\n    [last pivoted column] AS &lt;column name&gt;\n\nFROM\n\n    (&lt;SELECT query that produces the data&gt;)\n\n    AS &lt;alias for the source query&gt;\n\nPIVOT\n\n(\n\n    &lt;aggregation function&gt;(&lt;column being aggregated&gt;)\n\nFOR\n\n[&lt;column that contains the values that will become column headers&gt;]\n\n    IN ( [first pivoted column], [second pivoted column],\n\n    ... [last pivoted column])\n\n) AS &lt;alias for the pivot table&gt;\n\n&lt;optional ORDER BY clause&gt;;\n</code></pre>\n\n<p>Is there a way to have more non-pivot columns, because it is pivoting my data using all columns after the first one.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","reportserver"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12691494,"title":"Back-up Report Server Encryption Key as a Job","body":"<p>What's the T-SQL to back up your report server's encryption key?</p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12532935,"title":"update script stored procedure sql server2008","body":"<p>I am fairly new to posting questions i greatly appreciate your support.\nI wanted to write a proc to update my table <code>testAd</code>.</p>\n\n<p>A replace function could do it but I have almost a million records to update and I am trying to use stored procedure.</p>\n\n<p>Could you have a look at what I have started? Thank you I appreciate it. I should come up with something by end of day today..a kind of  tough situation. I tried the one below it doesn't seem to be working.</p>\n\n<pre><code>CREATE PROC [dbo].[testAd]\nAS\nDECLARE @ci  VARCHAR (255)\nUPDATE Stage.TestAdd\nSET @ci=AddressOne\nSET @ci= CASE @ci\n WHEN 'Des Moines'  THEN 'IA' \n WHEN 'Seattle'    THEN 'WA'\n WHEN 'Pheonix'    THEN 'Az'   \n WHEN 'Phx'   THEN 'Az'\n .\n . \n ELSE @ci\n</code></pre>\n\n<p>END</p>\n"},{"tags":["sql-server","sql-server-2008","data-partitioning"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12688086,"title":"SQL Server Partition per table on Tenant ID - disk space used","body":"<p>We are currently developing a Multi Tenant web application.\nThis application stores all it's data in 1 single database.</p>\n\n<p>Datarows for a tenant are always with the tenant id.</p>\n\n<p>At the moment we are considering creating table partitions, with the tenant id as partitioning key. This makes sense because 99.9% of all queries will include the tenant id as a where clause criterium. If I understand correctly, SQL Server query optimize all such queries by eliminating the table partitions that not contain the partition key (in my case the tenant id).</p>\n\n<p>Any comments on this strategy (serious drawbacks, do or do not use filegroups etc, maximum allowed partitions per table...) would be appreciated.</p>\n\n<p>But my main question is this:\nWe want to calculate the disk usage per tenant. SQL Server supports reporting on disk usage per partition (standard report).\ndoes anybody know of T-SQL that would allow me to get the disk usage of all table partitions for a given tenant ID?</p>\n"},{"tags":["sql-server-2008","replication"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":8574,"score":3,"question_id":2723061,"title":"SQL Server 2008 replication failing with: process could not execute 'sp_replcmds'","body":"<p>I have an issue with SQL replication that I am having trouble fixing.  What I am doing is restoring two DBs from a production backup, and then installing replication between them.  The replication seems to be configured without any errors, but when I look at the status I see error messages like this: </p>\n\n<p>I have an issue with SQL replication that I am having trouble fixing.  What I am doing is restoring two DBs from a production backup, and then installing replication between them.  The replication seems to be configured without any errors, but when I look at the status in Replication Monitor I see error messages like this:</p>\n\n<blockquote>\n  <p>Error messages:</p>\n  \n  <p>The process could not execute\n  'sp_replcmds' on 'MYSERVER1'. Get\n  help: <a href=\"http://help/MSSQL_REPL20011\" rel=\"nofollow\">http://help/MSSQL_REPL20011</a></p>\n  \n  <p>Cannot execute as the database\n  principal because the principal \"dbo\"\n  does not exist, this type of principal\n  cannot be impersonated, or you do not\n  have permission. (Source: MSSQLServer,\n  Error number: 15517) Get help:\n  <a href=\"http://help/15517\" rel=\"nofollow\">http://help/15517</a></p>\n  \n  <p>The process could not execute 'sp_replcmds' on 'MYSERVER1'.\n  Get help: <a href=\"http://help/MSSQL_REPL22037\" rel=\"nofollow\">http://help/MSSQL_REPL22037</a></p>\n</blockquote>\n\n<p>What does this mean?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12692736,"title":"SQL does replace and CAST on select affect the Database?","body":"<p>I am creating a view and I was asked to do a 'replace' and a 'cast', so as an example:</p>\n\n<pre><code>SELECT CAST(qtyshipped AS INT) AS 'QTYShipped', REPLACE(itemval,'.','')\nFROM Database\n</code></pre>\n\n<p>Within the view, should not actually change the information in the database but just in the query correct? (It works perfectly in my sandbox server but i just want to confirm)</p>\n"},{"tags":["sql-server-2008","asp-classic"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":161,"score":0,"question_id":3418643,"title":"Connecting from classic ASP app to an instance of SQL server 2008","body":"<p>My classic ASP app is connecting to SQL server 2000 installed on a network server. The current code works:</p>\n\n<pre><code>myConn.Open (\"Driver={SQL Server};Server=myNetServ;Database=myDB;UID=myID;PWD=myPWD;Trusted_Connection=No;\")\n</code></pre>\n\n<p>Now my app needs to connect to a named instance \"SQL2008\" of the SQL server 2008 installed on the same network server.  This code doesn't work:</p>\n\n<pre><code>myConn.Open (\"Driver={SQL Server Native Client 10.0};Server=myNetServ\\SQL2008;Database=myDB;UID=myID;PWD=myPWD;Trusted_Connection=No;\")\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","statistics"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":662,"score":1,"question_id":6784299,"title":"Calculating the 95th Percentile value?","body":"<p>I am trying to calculate the 95th percentile point in my table column and am using the <code>TOP 95 PERCENT</code> construct. I was wondering if the following approach is correct or if there is a better way of doing the same.</p>\n\n<pre><code>SELECT AVG(Value) \nFROM\n(\n    SELECT TOP 95 PERCENT WITH TIES Value\n    FROM [Sample].[dbo].[numbers]\n    ORDER BY Value DESC\n) AS NineP\n</code></pre>\n"},{"tags":["sql-server-2008","ssis","permissions"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":14282,"score":3,"question_id":1105241,"title":"What permissions needed to connect to SQL Server Integration Services","body":"<p>I need to allow a consultant to connect to SSIS on a SQL Server 2008 box without making him a local administrator. If I add him to the local administrators group, he can connect to SSIS just fine, but it seems that I can't grant him enough permissions through SQL Server to give him these rights without being a local admin.</p>\n\n<p>I've added him to every role on the server, every database role in MSDB shy of DBO, and he's still not able to connect. I don't see any SSIS-related Windows groups on the server -  <strong>Is membership in the Local Administrators group really required to connect to the SSIS instance on a SQL Server?</strong> It seems like there is somewhere I should be able to grant \"SSIS Admin\" rights to a user (even if it's a Windows account and not a SQL account), but I can't find that place.</p>\n\n<p><strong>UPDATE</strong>: I've found an <a href=\"http://msdn.microsoft.com/en-us/library/aa337083.aspx\" rel=\"nofollow\">MSDN article</a> (See the section titled \"Eliminating the 'Access if Denied' Error\") that describes how to resolve problem, but even after following the steps, I'm still not able to connect. Just wanted to add it to the discussion</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","dynamic-sql"],"answer_count":1,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12687419,"title":"create dynamic path to server.database.table in T-SQL","body":"<p>I am trying to dynamically create tables. Tables from one database (@sourcedatabase) are used to create tables in another (@targetdatabase).</p>\n\n<p>This works fine when I explicitly name the databases. However, I would like them to be dynamic, as in the following example. I have read a lot about that and I am fine using things like </p>\n\n<pre><code>set @sql = 'DROP TABLE ' + @targetdatabase + '.' + @SomeNAME \nexecute (@sql)\n</code></pre>\n\n<p>but I am at a loss when it gets a bit more complex:</p>\n\n<pre><code>declare @sourcedatabase as varchar(max) = 'DATABASE1'\ndeclare @targetdatabase as varchar(max) = 'DATABASE2'\n\ndeclare @HighestID as int = (SELECT  max(Id) FROM @sourcedatabase.system.Organisationtype)\ndeclare @i as int = (SELECT  max(Id) FROM @sourcedatabase.system.Organisationtype)\n\nwhile @i &gt;= (SELECT  min(Id) FROM @sourcedatabase.system.LaagTypeOrganisatie)\nBEGIN\n--SOME ACTIONS\nset @i = @i + 1 \nEND \n\ndeclare @x as int = (select count(*) from @targetdatabase.sys.tables where name = @SomeNAME)\n\nIF   @x &lt;&gt; 0\nBEGIN\nset @sql = 'DROP TABLE ' + @targetdatabase + '.' + @SomeNAME \nexecute (@sql)\nEND\n</code></pre>\n\n<p>As you see I would like to have the database-naming variable.\nTurning this whole script into one exec statement is quite complex and not very pretty to read.\nWould it be an idea to read this script in a textfile, do a replace on @targetdatabase en @sourcedatabase and then execute it? If so, how would this be done?</p>\n\n<p>I am looking forward to your ideas and contributions!</p>\n\n<p>edit: the script is executed as a jobagent</p>\n"},{"tags":["sql-server-2008","active-directory","vpn"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12692338,"title":"Cannot generate SSPI context when connecting through VPN","body":"<p>I have a user who has no problem connecting to SQL Server 2008 when connected through LAN. However, when he connects through a VPN from home, he gets \"Cannot generate SSPI context\" when trying to connect to SQL. It looks like when the user connects through VPN, he authenticates just fine into AD and has access to all other resources.</p>\n\n<p>I have been trying to solve this problem with our System Administrators for weeks, but nobody seems to know the cause.</p>\n\n<p>Could someone please point me into a right direction to what I should be looking at to try to solve this problem.</p>\n\n<p>Thank you very much!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12691558,"title":"How to use count statement to get information from multiple tables in sql server?","body":"<p>How can I make a query for getting the number of employees on each department using a count function with the fields <code>Dept_id</code>, <code>Dept_name</code>, <code>Number of employees</code> using the data structure below?</p>\n\n<pre><code>create database Emp_det\n\ncreate table Dept\n(\n    Dept_ID int not null primary key,\n    Dept_name varchar(255)\n)\n\ncreate table Emp_table\n(\n    Emp_no int not null primary key,\n    Emp_name varchar(255) not null,\n    Dept_ID int foreign key references Dept(Dept_ID),\n    Emp_status varchar(255)\n)\n\ncreate table Salary_table\n(\n    Emp_no int not null foreign key references Emp_table(Emp_no),\n    From_date datetime,\n    End_date datetime,\n    Basic int,\n    HRA int,\n    Others int,\n    Total int,\n    Emp_status varchar(255),\n\n    constraint pk_emp_det primary key (emp_no,From_date)\n);\n\ninsert into Dept\nvalues(10, 'I.T'), (11, 'H.R'),(12, 'Procurement'),(13, 'QS');\n\ninsert into Emp_table\nvalues(1111,'Manivannan','10','A'),\n(1222,'Faizal','10','A'),\n(4122,'Marzook','10','A'),\n(1223,'Venu','11','A');\n\ninsert into Salary_table\nvalues(1111,'01/09/2012','1/10/2012',10000,10000,2000,22000,'A'),\n(1222,'01/09/2012','1/10/2012',5000,5000,1000,11000,'A'),\n(4122,'01/09/2012','1/10/2012',1000,1000,5000,2500,'A'),\n(1223,'01/09/2012','1/10/2012',10000,10000,2000,22000,'A')\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12427712,"title":"Status of Data in Rollback of Large Transaction in SQL Server","body":"<p>I have a data warehousing procedure that downloads and replaces dozens of tables from a linked server to a local database.  Every once in a while, the code will get stuck on one of the tables on the linked server because the table on the linked server is in a state of transition.  I am under the assumption that since the entire procedure is considered one transaction commit, when the procedure gets stuck, none of the changes made by the procudure so far would have committed.  But the opposite seems to be true, tables that were \"downloaded\" before the procedure got stuck would have been updated with today's versions on the local server.  Shouldn't SQL Server wait for the entire procedure to finish before the changes are durable?  </p>\n\n<pre><code>CREATE PROCEDURE MYIMPORT\n\nAS\n\nBEGIN\n\n\nSET NOCOUNT ON\n\nIF EXISTS (SELECT * FROM INFORMATION.SCHEMA.TABLES WHERE TABLE_NAME = 'TABLE1')\nDROP TABLE TABLE1\n\nSELECT COLUMN1, COLUMN2, COLUMN3 \nINTO TABLE1\nFROM OPENQUERY(MYLINK, 'SELECT COLUMN1, COLUMN2, COLUMN3 FROM TABLE1')\n\nIF EXISTS (SELECT * FROM INFORMATION.SCHEMA.TABLES WHERE TABLE_NAME = 'TABLE2')\nDROP TABLE TABLE2\n\nSELECT COLUMN1, COLUMN2, COLUMN3 \nINTO TABLE2\nFROM OPENQUERY(MYLINK, 'SELECT COLUMN1, COLUMN2, COLUMN3 FROM TABLE2')\n--IF THE PROCEDURE GETS STUCK HERE, THEN CHANGES TO TABLE1 WOULD HAVE BEEN MADE ON THE LOCAL SERVER WHILE NO CHANGES WOULD HAVE BEEN MADE TO TABLE3 ON THE LOCAL SERVER\n\nIF EXISTS (SELECT * FROM INFORMATION.SCHEMA.TABLES WHERE TABLE_NAME = 'TABLE3')\nDROP TABLE TABLE3\n\nSELECT COLUMN1, COLUMN2, COLUMN3 \nINTO TABLE3\nFROM OPENQUERY(MYLINK, 'SELECT COLUMN1, COLUMN2, COLUMN3 FROM TABLE3')\n\n\nEND\n</code></pre>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":141,"score":2,"question_id":7323919,"title":"Debugging a stored procedure","body":"<p>I have the following stored procedure:</p>\n\n<pre><code>USE [OfficeAuto]\nGO\n\n/****** Object:  StoredProcedure [dbo].[INSERT_Project]    Script Date: 09/06/2011 10:42:44 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER procedure [dbo].[INSERT_Project]\n...\n</code></pre>\n\n<p>When I try to debug this, I cannot step past <code>SET ANSI_NULLS ON</code>.  The debugger just stops.  I thought I could step through a stored procedure just like through code in VS.  Not sure what I am doing wrong.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12685734,"title":"Is it an optimistic approach?","body":"<p>In examples on an optimistic approach, @version (for example as parameter in procedures) is always in advance known.\nWhether it is possible to receive @version in the procedure and on what it can affect.\nPart of procedure:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[UpdateTestTable2]\n...\nSELECT @version = [version]\nFROM dbo.TestTable2\nWHERE Id = @Id\n\nBEGIN TRANSACTION\n\nUPDATE dbo.TestTable2\nSET testName = @testName\nWHERE Id = @Id AND [version] = @version\n...\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12689100,"title":"How to improve SQL Query Performance","body":"<p>I have the following DB Structure (simplified):</p>\n\n<pre><code>Payments\n----------------------\nId        | int\nInvoiceId | int\nActive    | bit\nProcessed | bit\n\n\nInvoices\n----------------------\nId              | int\nCustomerOrderId | int\n\n\nCustomerOrders\n------------------------------------\nId                       | int\nApprovalDate             | DateTime\nExternalStoreOrderNumber | nvarchar\n</code></pre>\n\n<p>Each Customer Order has an Invoice and each Invoice can have multiple Payments.\nThe <code>ExternalStoreOrderNumber</code> is a reference to the order from the external partner store we imported the order from and the <code>ApprovalDate</code> the timestamp when that import happened.</p>\n\n<p>Now we have the problem that we had a wrong import an need to change some payments to other invoices (several hundert, so too mach to do by hand) according to the following logic:<br>\nSearch the Invoice of the Order which has the same external number as the current one but starts with 0 instead of the current digit.</p>\n\n<p>To do that I created the following query:  </p>\n\n<pre><code>UPDATE DB.dbo.Payments \n    SET InvoiceId=\n        (SELECT TOP 1 I.Id FROM DB.dbo.Invoices AS I\n            WHERE I.CustomerOrderId=\n                (SELECT TOP 1 O.Id FROM DB.dbo.CustomerOrders AS O \n                    WHERE O.ExternalOrderNumber='0'+SUBSTRING(\n                      (SELECT TOP 1 OO.ExternalOrderNumber FROM DB.dbo.CustomerOrders AS OO\n                        WHERE OO.Id=I.CustomerOrderId), 1, 10000)))\n    WHERE Id IN (\n        SELECT P.Id\n          FROM DB.dbo.Payments AS P\n            JOIN DB.dbo.Invoices AS I ON I.Id=P.InvoiceId\n            JOIN DB.dbo.CustomerOrders AS O ON O.Id=I.CustomerOrderId\n         WHERE P.Active=0 AND P.Processed=0 AND O.ApprovalDate='2012-07-19 00:00:00'\n</code></pre>\n\n<p><strong>Now I started that query on a test system using the live data (~250.000 rows in each table) and it is now running since 16h - did I do something completely wrong in the query or is there a way to speed it up a little?</strong><br>\nIt is not required to be really fast, as it is a one time task, but several hours seems long to me and as I want to learn for the (hopefully not happening) next time I would like some feedback how to improve...</p>\n"},{"tags":["sql","sql-server-2008","locking"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":12675266,"title":"Why lock in Testdatabase but not in Devdatabase","body":"<p>I have just setup a testing clone of the database we use for development. However, when I run our application against this new database it creates a lock and in the end timeout waiting forever.</p>\n\n<p>The SQL that creates my problem: </p>\n\n<pre><code>-- In one connection it runs this\nset transaction isolation level read committed\nbegin tran\nINSERT INTO [Test].[dbo].[Status] ([TransactionID], [Status]) VALUES (6122481, 1)\n</code></pre>\n\n<p>Then before that transaction is committed another connection tries to run:</p>\n\n<pre><code>set transaction isolation level read committed\nbegin tran\nSELECT * FROM [Test].[dbo].[Status] with(rowlock) WHERE [Test].[dbo].[Status].[TransactionID] = 6122482 \n</code></pre>\n\n<p>However, this second transaction will never run as it waits for the first one to complete forever until the application timeouts. </p>\n\n<ol>\n<li>SQL Server 2008</li>\n<li>I have not much control over the actual SQL, we use LLBLGen (ORM) for it</li>\n<li>It works fine on our development and production databases. </li>\n<li>The test database was created by restore of a new backup of the dev database</li>\n<li>I think the major difference is the number of rows in the table (&lt;100 in test compared to > 100000 for dev)</li>\n</ol>\n\n<p>My guess is that SQL server does things differently when there's a lot of rows in the table. Question is how to fix the test database without adding lots and lots of data to it if thats the problem, or what else I should do?</p>\n\n<p>The table has some indexes, and also a FK on the transaction table on TransactionID:</p>\n\n<pre><code>CREATE NONCLUSTERED INDEX [idx1] ON [dbo].[Status] \n(   [TransactionID] ASC,\n    [Status] ASC\n) INCLUDE ( [Created]) \n\nCREATE NONCLUSTERED INDEX [idx2] ON [dbo].[Status] \n(   [Status] ASC,\n    [Created] ASC\n) INCLUDE ( [TransactionID]) \n\nALTER TABLE [dbo].[Status] ADD  CONSTRAINT [PK_Statuses] PRIMARY KEY CLUSTERED \n(   [StatusID] ASC\n)\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":12689525,"title":"error in batch sql server","body":"<p>For list1, select 'ok' will be run even select 1/0 generate an error. for list 2 select 'ok' will not be run since update fail. Both list generate error of level 16 but why there are such difference?</p>\n\n<pre><code>--1\nselect 1/0  \nselect 'ok'\n\n--2\ncreate table #t (a int)\ninsert into #t values(1)\n\nupdate #t set b = 99\nselect 'ok'\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":101,"score":3,"question_id":12688205,"title":"SQL: Find difference between rows where a column value matches","body":"<p>sorry if my title doesn't properly describe what task I'm trying to perform.</p>\n\n<p>For a university project, I have received the access logs of a website, I have discarded the unneeded columns and condensed it down to this:</p>\n\n<pre><code>╔══════════╦══════════════════════╦═════════════════╦═════════════╦════════════════╗\n║ accessid ║ date_time_in_seconds ║ yg_requester_id ║ referent_id ║ referent_docid ║\n╠══════════╬══════════════════════╬═════════════════╬═════════════╬════════════════╣\n║     2449 ║        2009011621830 ║           32276 ║       12648 ║              1 ║\n║     2776 ║        2009011622726 ║           76360 ║       11070 ║              1 ║\n║     2804 ║        2009011622783 ║           32276 ║       13845 ║              1 ║\n║     2894 ║        2009011623025 ║           32276 ║        7222 ║              1 ║\n║     2895 ║        2009011623037 ║           32276 ║        1530 ║              1 ║\n║     3000 ║        2009011623406 ║           32276 ║        3728 ║              1 ║\n║     3019 ║        2009011623497 ║          520060 ║       10356 ║              1 ║\n║     3245 ║        2009011625780 ║          300841 ║        4607 ║              1 ║\n║     3274 ║        2009011628309 ║          532664 ║       14377 ║              1 ║\n║     3275 ║        2009011628420 ║          532664 ║        9097 ║              1 ║\n╚══════════╩══════════════════════╩═════════════════╩═════════════╩════════════════╝\n</code></pre>\n\n<p>Originally the time and datestamps were in seperate columns per unit of measurement (year, month, day, hour, minute, second) and for the purposes of easier calculation, I have consolidated them into date_time_in_seconds which has the format</p>\n\n<pre><code>[0000][00][00][00000]\n[YEAR][MONTH][DAY][Number of Seconds since 00:00]\n</code></pre>\n\n<p>accessid is the table entry ID, yg_requester_id is the unique id of the website visitor, referent_id is the ID of the web site article they read, referent_docid denotes the type of article, however is not needed in this task.</p>\n\n<p>Basically, I would like to be able to find the time difference since the last different referent_id was accessed by the same yg_requester_id.\nSo for instance, looking at this section of rows from the above table:</p>\n\n<pre><code>╔══════════╦══════════════════════╦═════════════════╦═════════════╦════════════════╗\n║ accessid ║ date_time_in_seconds ║ yg_requester_id ║ referent_id ║ referent_docid ║\n╠══════════╬══════════════════════╬═════════════════╬═════════════╬════════════════╣\n║     2449 ║        2009011621830 ║           32276 ║       12648 ║              1 ║\n║     2776 ║        2009011622726 ║           76360 ║       11070 ║              1 ║\n║     2804 ║        2009011622783 ║           32276 ║       13845 ║              1 ║\n╚══════════╩══════════════════════╩═════════════════╩═════════════╩════════════════╝\n</code></pre>\n\n<p>yg_requester_id 32276 accessed the article with id <strong>12648</strong> at <strong><em>06:03:50</em></strong> (<em>21830</em> seconds after midnight) on the 16th of January 2009. They then accessed the article with id <strong>13845</strong> at <strong><em>06:19:43</em></strong> (<em>22783</em> seconds after midnight)  on the 16th January 2009. So it is safe to assume that the user read the first article (id <strong>12648</strong>) for about 15 minutes and 50 seconds</p>\n\n<p>What I would like to find is that time difference between the articles accessed by the same user. Consecutive articles read by a user may not have consecutive accessid's (although it will always increment). I would also like to limit the time read to about an hour as the task is to filter out records where the time read is <em>under</em> a variable number of minutes (15 for instance).</p>\n\n<p>Thanks in advance, let me know if any more information is needed</p>\n"},{"tags":[".net","database","sql-server-2008","c#-4.0","backup"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":873,"score":1,"question_id":9835553,"title":"How to backup Sql Database Programmatically in C#","body":"<p>I want to write a code to backup my Sql Server 2008 Database using C# in .Net 4 FrameWork. Can anyone help in this.</p>\n"},{"tags":["sql-server-2008","windows-7","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":602,"score":1,"question_id":11230361,"title":"What permissions are required to bulk insert in SQL Server from a network share with Windows authentication?","body":"<p>I am working on an application which bulk-loads data into a SQL Server 2008 database. It writes a CSV file to a network share then calls a stored procedure which contains a BULK INSERT command.</p>\n\n<p>I'm migrating the application to what amounts to a completely new network. In this new world bulk insertion fails with this error:</p>\n\n<pre><code>Msg 4861, Level 16, State 1, Line 1\nCannot bulk load because the file \"\\\\myserver\\share\\subfolder\\filename\" could not be opened. Operating system error code 5(failed to retrieve text for this error. Reason: 15105).\n</code></pre>\n\n<p>I connect to the database using Windows Authentication, using the same account which wrote the file. The file, and the folder in which it resides, grant read and modify rights both to my user account and the database server's domain service account. That service account apparently has constrained delegation permitted, which is mentioned on <a href=\"http://msdn.microsoft.com/en-us/library/ms188365.aspx\" rel=\"nofollow\">MSDN</a>. Still no good. If I connect using a SQL Server account then bulk insertion succeeds, but we are trying to stick exclusively to Windows Authentication.</p>\n\n<p>Does anybody have a handle on what needs to be done to make this work? How exactly does SQL Server go about accessing data on network shares, hopping between its service account and that of the connected user? I know that I can bulk insert in a similar situation in our current infrastructure, but it is so crufty with age that it would be hard to track down what has been done to enable this in the past.</p>\n"},{"tags":[".net","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12685743,"title":"Sql Server 2008 decimal(10,2) divides the inserted value by 100","body":"<p>I have this column that looks like this in a table <code>DECIMAL(10,2)</code> and a stored procedure that inserts rows in that table. The parameter for that column looks like this <code>@FuelLiters AS DECIMAL(10, 2),</code><br>\nI call this stored procedure using ado.net. The sql parameter for that column looks like this</p>\n\n<pre><code>cmd.Parameters.Add(@FuelLiters, SqlDbType.Decimal).Value = fuelLiters; \n(it's decimal value)\n</code></pre>\n\n<p>Whatever i do sql is modifying my value so it has 2 decimals. If fuelLiters = 56 it will save in the database 0.56. If fuelLiters = 75.4 it will save in the database 7.54.</p>\n\n<p>What am i doing wrong?</p>\n\n<p>My sql parameter now looks like this, but still the same problem.</p>\n\n<pre><code>            SqlParameter fuelParam = new SqlParameter();\n            fuelParam.SqlDbType = SqlDbType.Decimal;\n            fuelParam.ParameterName = \"@FuelLiters\";                \n            fuelParam.Precision = 10;\n            fuelParam.Scale = 2;\n            fuelParam.Value = fuelLiters ;\n            cmd.Parameters.Add(fuelParam);\n</code></pre>\n\n<p>LE: I modified the sql parameter so that the value is set after precision and scale are set and i added the stored procedure.</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[SaveFuel] \n    @Id AS INT,\n    @RegNumber AS NVARCHAR(50),\n    @FuelLiters AS DECIMAL(10, 2)\nAS\nBEGIN\n\n    INSERT INTO [dbo].[Fuel]\n        (\n            [Id],       \n            [RegNumber],\n            [Fuel_litres]         \n        )\n        VALUES\n        (\n            @Id,\n            @RegNumber,\n            @FuelLiters\n        )\n\nEND\n</code></pre>\n\n<p>ok, i am stupid, there is a trigger i didn't notice which was doing some <em>corrections</em> on that field </p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","over-clause"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12686140,"title":"Issue with Window Function in MSSQL 2008 R2","body":"<p>I am receving execution error in following sql script.</p>\n\n<pre><code>Select TOP 1 Percent a.accode,a.voucherdate,a.credit,a.Debit,\n    SUM(a.Debit) Over (Order By [a.accode],[a.voucherdate] ) as rdr \n\n    from VoucherMain as a \n    Order By a.accode,a.voucherdate\n</code></pre>\n\n<p>Error Message</p>\n\n<p><em>Incorrect syntax near 'order'.</em></p>\n\n<p>Can anyone tell me what's wrong with the script syntext?</p>\n"},{"tags":["sql","database","sql-server-2008","relational-database"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":715,"score":1,"question_id":7647718,"title":"SQLServer - How to find dependent tables on my table?","body":"<p>Using <code>SQLServer</code> :</p>\n\n<p>I have a table <code>user</code> :</p>\n\n<ul>\n<li><p><code>id</code></p></li>\n<li><p><code>name</code></p></li>\n<li><p><code>email</code></p></li>\n</ul>\n\n<p>There are some other tables (about 200 more tables), some of which use <code>user.id</code> as foreign key on <code>cascade delete</code>.</p>\n\n<p>So, I want to find out - Which tables use this foreign key (<code>user.id</code>) ?</p>\n\n<p>I am accessing my sql-server with <code>SQL Server Management Studio</code>.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":12685792,"title":"fetch comma seprated value in SQL query","body":"<p>Please check below table </p>\n\n<pre><code>Code   Name  \n-----------\n 001   A\n 001   B\n</code></pre>\n\n<p>My query is </p>\n\n<pre><code>Select Code,Name from TableA\n</code></pre>\n\n<p>But i need records like </p>\n\n<pre><code>Code  Name\n------------\n001    A,B\n</code></pre>\n\n<p>How can I do that ?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","hex","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":79,"score":1,"question_id":12678380,"title":"Storing hex equivalent in identity column in sql","body":"<p>Just as the title says, if I have a table has a struct like this</p>\n\n<pre><code>create table myTable\n(\nID int identity(1,1) not null,\ncol1 varchar(20) not null,\ncol2 varchar(20) not null\nconstraint pk_myTable primary key (ID)\n)\n</code></pre>\n\n<p>If I insert some value in this table it would automatically take value in col <code>ID</code>. I wanna know is a way I could get SQL Server to store hex equivalent in the column. Say, for 1, it should store <code>0x01</code> <code>2 as 0x02</code>... <code>10 as 0xA</code> and so on?</p>\n\n<p>I don't wanna know any tricks or something, I know I can create this this col as <code>varchar</code> and then create a procedure for insert, or create a trigger for insert, that would do the required transformation and would produce the desired result, that's <em>not</em> a big issue.</p>\n\n<p>But what I wanna know is there a inbuilt function/procedure/trigger that would help me achieve what I am trying to achieve? Not necessarily in SQL Server 2008, but may be in 2012, does there exists anything like this?</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12684838,"title":"Issue Related to Date Range in SQL Server","body":"<p>I have written following Query in SQL Server :</p>\n\n<pre><code>SELECT * \nFROM AttendanceMaster \nWHERE Date between '8/12/2012' AND '8/20/2012' \n</code></pre>\n\n<p>butt Query result returns  '8/13/2012' AND '8/19/2012'</p>\n\n<p>but it doesn't returns result for date 12/8/2012  and for date 8/20/2012</p>\n\n<p>so what is the solution to get the data for above two date ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12684534,"title":"How to store ouput of FOR XML Path in a variable?","body":"<p>I want to store the output of for XML Path in a variable. However this doesn't work:</p>\n\n<pre><code>Declare @Tab    dbo.SingleColumnTable\n\nInsert INTO @Tab\n\nValues(\n    'Jack'\n)\n\nInsert INTO @Tab\n\nValues(\n    'Armageddon'\n)\n\nDeclare @RetVal varchar(8000) = ''\n\nSelect Top 1 @RetVal = Data\nFrom\n(\n    Select ';' + ' ' + Name as 'Data'\n               From @Tab t2\n               for xml path('')\n) v  \n</code></pre>\n\n<p>As you can see I am trying to set the column name of returned output as Data but it doesn't work. I get error <code>Invalid column name 'Data'.</code></p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12684162,"title":"Alternative to cursors for denormalizing many values into one column?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2046037/sql-server-can-i-comma-delimit-multiple-rows-into-one-column\">SQL Server: Can I Comma Delimit Multiple Rows Into One Column?</a><br>\n  <a href=\"http://stackoverflow.com/questions/6344950/sql-query-to-get-aggregated-result-in-comma-seperators-along-with-group-by-colum\">SQL Query to get aggregated result in comma seperators along with group by column in SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>I have a table similar to this:</p>\n\n<pre><code>DocumentID      Name\n1           Jack D'Souza\n1           Rick Astley\n1           Frankestein\n1           Einstein\n</code></pre>\n\n<p>I want to write a SQL Server scalar function which would accept in parameter as DocumentID and give a CSV separated value. So, If I pass in <code>1</code>, it would give <code>Jack D'Souza, Rick Astley, Frankestein, Einstein</code></p>\n\n<p>Inside the function, I can create in cursor and create this CSV list. But is there any alternative to using cursor?</p>\n"},{"tags":["sql","sql-server-2008","ssis","text-files","fixed-width"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12683876,"title":"Select Query for the fixed length","body":"<p>I have an table called customer where i am selecting few columns and making its fixed length,where i need to send the values to SSIS packages for an fixed length output and is written in a text file</p>\n\n<pre><code>customerID:10\nMobilenumber:11\nEmailaddress:256\n\nselect customerID,mobilenumber,Emailaddress from customer \n</code></pre>\n\n<p>I want to make sure my customerID is always length of 10, mobile number 11, emailaddress 256.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":228,"score":3,"question_id":11204136,"title":"First-in-first-out (FIFO) inventory costing","body":"<p>Here's an interesting article that I found useful on my project:</p>\n\n<p><a href=\"http://www.simple-talk.com/sql/performance/set-based-speed-phreakery-the-fifo-stock-inventory-sql-problem/\" rel=\"nofollow\">Set-based Speed Phreakery: The FIFO Stock Inventory SQL Problem</a>:</p>\n\n<blockquote>\n  <p>Stock table which we use to track the track movements of stock in and out of our imaginary stock warehouse. Our warehouse is initially empty, and stock then moves into the warehouse as a result of a stock purchase (tranCode = 'IN'), or due to a subsequent return (tranCode = 'RET'), and stock moves out of the warehouse when it is sold (tranCode = 'OUT'). Each type of stock tem is indentified by an ArticleID. Each movement of stock in or out of the warehouse, due to a purchase, sale or return of a given item, results in a row being added to the Stock table, uniquely identified by the value in the StockID identity column, and describing how many items were added or removed, the price for purchases, the date of the transaction, and so on.</p>\n</blockquote>\n\n<p>Though I'm using this on my on-going project, Im stuck on how to get the price-to-charge on every transaction 'OUT'. I need to have this value to determine how much i will charge my customers.</p>\n\n<ol>\n<li><p>First add 5 apples (each $10.00) to the stock, for a total of $50.00</p></li>\n<li><p>Add 3 apples (each $20.00) to the stock total of 8 apples, for a total price of $110.00</p></li>\n<li><p>Then take out 6 items (5 each $10.00 and 1 each $20.00)  $70 total</p></li>\n<li><p>After the transaction it will be leaving 2 apples @$20 each with a total of $40</p></li>\n</ol>\n\n<hr>\n\n<pre><code> Here's my current table\n Item    transaction code    qty     price   \n apple   IN                    5     10.00    \n apple   IN                    3     20.00   \n apple   OUT                   6          \n\n Manual computation for the OUT transaction price (FIFO)\n QTY     price   total price \n 5       10.00   50.00 \n 1       20.00   20.00 \n TOTAL:6         70.00 \n\n Output of the script:\n Item    CurrentItems   CurrentValue\n apple   2            40.00\n\n What I need:\n Item    transaction code    qty     price   CurrentItems    CurrentValue \n apple   IN                    5     10.00   5               50.00 \n apple   IN                    3     20.00   8               110.00 \n apple   OUT                   6             2                   40.00 \n\n This too will be OK\n Item    transaction code    qty     price   CurrentItems    \n apple   IN                    5     10.00   0               \n apple   IN                    3     20.00   0                \n apple   OUT                   6         70 \n</code></pre>\n\n<p>The script posted that won the competition was very useful, I hope someone can help me on how to get the price per 'OUT' transaction</p>\n"},{"tags":["mysql","sql","database","sql-server-2008","relational-database"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":118,"score":0,"question_id":12675386,"title":"how to display data from different tables column into one table column","body":"<p>I am trying to get data in one table's column from different tables (with same name) column in one database in SQL2008.</p>\n\n<p>I created one table using different tables primary key column name (e.g.- My new table looks like</p>\n\n<p>Location, Customer, Service, Channel, Monthlyperiod.....those tables are already created. I am trying to get each tables column value in other table.(e.g. - existing Lacation table column value in new location table column.</p>\n\n<p>Please help me. Thanks a lot in advance.</p>\n"},{"tags":["sql-server","tsql","sql-server-2008","date"],"answer_count":7,"favorite_count":3,"up_vote_count":11,"down_vote_count":0,"view_count":6674,"score":11,"question_id":7168874,"title":"Get first day of week in SQL Server","body":"<p>I am trying to group records by week, storing the aggregated date as the first day of the week. However, the standard technique I use for rounding off dates does not appear to work correctly with weeks (though it does for days, months, years, quarters and any other timeframe I've applied it to).</p>\n\n<p>Here is the SQL:</p>\n\n<pre><code>select \"start_of_week\" = dateadd(week, datediff(week, 0, getdate()), 0);\n</code></pre>\n\n<p>This returns <code>2011-08-22 00:00:00.000</code>, which is a Monday, not a Sunday. Selecting <code>@@datefirst</code> returns <code>7</code>, which is the code for Sunday, so the server is setup correctly in as far as I know.</p>\n\n<p>I can bypass this easily enough by changing the above code to:</p>\n\n<pre><code>select \"start_of_week\" = dateadd(week, datediff(week, 0, getdate()), -1);\n</code></pre>\n\n<p>But the fact that I have to make such an exception makes me a little uneasy. Also, apologies if this is a duplicate question. I found some related questions but none that addressed this aspect specifically.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12682626,"title":"Simple INSERT Query in SQL Server","body":"<p>I m looking to a way to insert into database Table T1 from T2 (append operation_</p>\n\n<p>Table 1 : dbo.t1</p>\n\n<pre><code>col1   col2\n----   -----\n1       ABC\n2       ABCr  \n3       ABCs\n4       ABCd\n</code></pre>\n\n<p>Table 2 : dbo.t2</p>\n\n<pre><code>col1   col2\n----   -----\n7       ABCe\n8       ABCy  \n</code></pre>\n\n<p>Now , table 1 becomes</p>\n\n<pre><code>col1   col2\n----   -----\n1       ABC\n2       ABCr  \n3       ABCs\n4       ABCd\n7       ABCe\n8       ABCy  \n</code></pre>\n\n<p>SQL query , I m using is:</p>\n\n<pre><code>select * \ninto dbo.t1\nfrom dbo.t2\n</code></pre>\n\n<p>I know it would way too simple using #temp table.</p>\n\n<p>I m looking for a way so that I just append the rows from T2 to T1 and keep performance as well. The existing rows of T1 is not touch at all.</p>\n\n<p>Any help would be helpful.</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":12680440,"title":"Data encrypted in SQL Server 2008 doesn't work in 2008 R2","body":"<p>I have encrypted card info in SQL Server 2008. After migrating to SQL Server 2008 R2, the application cannot decrypt the credit card column. </p>\n\n<p>Does it have anything to do with new master key for 2008 R2? What is causing the problem?</p>\n"},{"tags":["database","sql-server-2008","database-project"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12666140,"title":"Insert test data for each unit test for SQL Server 2008 Database Project","body":"<p>I have Visual Studio Premium and I'm using the test projects that come with it for my database. I'd like to be able to insert test data just before a unit test is run for each test in my Visual studio SQL Server 2008 database project. Do I do this right in the test itself or is there some other way to do a Data Generation Plan for each unit test? Also I'd like to be able to reuse the test data sometimes in different unit tests.</p>\n\n<p><strong>EDIT: More detail:</strong>\nI have a stored procedure which matches buyers and sellers in a fake stock program that will be run in a job. I need the test because there are so many different combinations of data that can be fed into the SP that I don't want to lose track of. The SP takes a chunk of buyers and WHILE loops through them and one by one matches them up with sellers. Hopefully that gives enough detail...</p>\n"},{"tags":["sql","tsql","sql-server-2008","sql-server-2008-r2"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":786,"score":1,"question_id":6131323,"title":"How to select the top n from a union of two queries where the resulting order needs to be ranked by individual query?","body":"<p>Let's say I have a table with usernames:</p>\n\n<pre><code>Id  |  Name\n-----------\n1   |  Bobby\n20  |  Bob\n90  |  Bob\n100 |  Joe-Bob\n630 |  Bobberino\n820 |  Bob Junior\n</code></pre>\n\n<p>I want to return a list of <code>n</code> matches on name for 'Bob' where the resulting set first contains exact matches followed by similar matches.    </p>\n\n<p>I thought something like this might work</p>\n\n<pre><code>SELECT TOP 4 a.* FROM\n(\n    SELECT * from Usernames WHERE Name = 'Bob'\n    UNION\n    SELECT * from Usernames WHERE Name LIKE '%Bob%'\n) AS a\n</code></pre>\n\n<p>but there are two problems:</p>\n\n<ol>\n<li>It's an inefficient query since the sub-select could return many rows (looking at the execution plan shows a join happening before top)</li>\n<li>(Almost) more importantly, the exact match(es) will not appear first in the results since the resulting set appears to be ordered by primary key.</li>\n</ol>\n\n<p>I am looking for a query that will return (for TOP 4)</p>\n\n<pre><code>Id | Name\n---------\n20 | Bob\n90 | Bob\n\n(and then 2 results from the LIKE query, e.g. 1 Bobby and 100 Joe-Bob)\n</code></pre>\n\n<p>Is this possible in a single query?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","greatest-n-per-group"],"answer_count":3,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":1053,"score":6,"question_id":7579916,"title":"How do I select TOP 5 PERCENT from each group?","body":"<p>I have a sample table like this:</p>\n\n<pre><code>CREATE TABLE #TEMP(Category VARCHAR(100), Name VARCHAR(100))\n\nINSERT INTO #TEMP VALUES('A', 'John')\nINSERT INTO #TEMP VALUES('A', 'John')\nINSERT INTO #TEMP VALUES('A', 'John')\nINSERT INTO #TEMP VALUES('A', 'John')\nINSERT INTO #TEMP VALUES('A', 'John')\nINSERT INTO #TEMP VALUES('A', 'John')\nINSERT INTO #TEMP VALUES('A', 'Adam')\nINSERT INTO #TEMP VALUES('A', 'Adam')\nINSERT INTO #TEMP VALUES('A', 'Adam')\nINSERT INTO #TEMP VALUES('A', 'Adam')\nINSERT INTO #TEMP VALUES('A', 'Lisa')\nINSERT INTO #TEMP VALUES('A', 'Lisa')\nINSERT INTO #TEMP VALUES('A', 'Bucky')\nINSERT INTO #TEMP VALUES('B', 'Lily')\nINSERT INTO #TEMP VALUES('B', 'Lily')\nINSERT INTO #TEMP VALUES('B', 'Lily')\nINSERT INTO #TEMP VALUES('B', 'Lily')\nINSERT INTO #TEMP VALUES('B', 'Lily')\nINSERT INTO #TEMP VALUES('B', 'Tom')\nINSERT INTO #TEMP VALUES('B', 'Tom')\nINSERT INTO #TEMP VALUES('B', 'Tom')\nINSERT INTO #TEMP VALUES('B', 'Tom')\nINSERT INTO #TEMP VALUES('B', 'Ross')\nINSERT INTO #TEMP VALUES('B', 'Ross')\nINSERT INTO #TEMP VALUES('B', 'Ross')\n\nSELECT Category, Name, COUNT(Name) Total\nFROM #TEMP\nGROUP BY Category, Name\nORDER BY Category, Total DESC\n\nDROP TABLE #TEMP\n</code></pre>\n\n<p>Gives me the following:</p>\n\n<pre><code>A   John    6\nA   Adam    4\nA   Lisa    2\nA   Bucky   1\nB   Lily    5\nB   Tom     4\nB   Ross    3\n</code></pre>\n\n<p>Now, how do I select the <code>TOP 5 PERCENT</code> records from each category <em>assuming each category has more than 100 records (did not show in sample table here)</em>? For instance, in my actual table, it should remove the <code>John</code> record from <code>A</code> and <code>Lily</code> record from <code>B</code> as appropriate (again, I did not show the full table here) to get: </p>\n\n<pre><code>A   Adam    4\nA   Lisa    2\nA   Bucky   1\nB   Tom     4\nB   Ross    3\n</code></pre>\n\n<p>I have been trying to use <code>CTE</code>s and <code>PARTITION BY</code> clauses but cannot seem to achieve what I want. It removes the TOP 5 PERCENT from the overall result but not from each category. Any suggestions?</p>\n"},{"tags":["sql","sql-server-2008","edit","alter","computed-columns"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2919,"score":3,"question_id":2372655,"title":"How can I alter this computed column in SQL Server 2008?","body":"<p>I have a computed column created with the following line:</p>\n\n<pre><code>alter table tbPedidos \nadd restricoes as (cast(case when restricaoLicenca = 1 or restricaoLote = 1 then 1 else 0 end as bit))\n</code></pre>\n\n<p>But, now I need to change this column for something like:</p>\n\n<pre><code>alter table tbPedidos \nalter column restricoes as (cast(case when restricaoLicenca = 1 or restricaoLote = 1 or restricaoValor = 1 then 1 else 0 end as bit))\n</code></pre>\n\n<p>But it's not working. I'm trying to input another condition to the case statement, but it's not working.</p>\n\n<p>Thanks a lot!</p>\n"},{"tags":["sql-server-2008","tsql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12678292,"title":"Earn the average of a row in a stored procedure in SQL Server","body":"<p>I have a stored procedure in SQL Server that returns the average of some column like this:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[Financial] \nAS\nBEGIN\n    SELECT \n        avg([aa ]) as 'aaa',\n        avg([bb]) as 'bbb',\n        avg([cc ]) as 'ccc',\n        avg([dd]) as 'ddd',\n        avg([ee]) as 'eee',\n        avg([ ff]) as 'fff'\n    FROM [FIN]\nEND\n</code></pre>\n\n<p>NOW my problem is that I want to have the average of this procedure's result, I mean this current procedure give me a row that it contains average of some column. Now I want to have the average of this row! what can I do?</p>\n\n<p>Let me explain more the result of above procedure may be:</p>\n\n<pre><code>4,7,8,9,6\n</code></pre>\n\n<p>For next I want the average of </p>\n\n<pre><code>4,7,8,9,6 \n</code></pre>\n"},{"tags":["c#","sql-server-2008","entity-framework-4","foreach","iqueryable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12677841,"title":"Breaking a loop when enumerating an IQueryable","body":"<p>I have the following code:</p>\n\n<pre><code>var docs = ctx.Documents.Select(a =&gt; \n    new { a.ID, Content = a.Document, a.LastModified, CreatedDate = a.Created });\n\nforeach (var doc in docs)\n{\n    if (Utility.ContinueDocumentPreview)\n    {\n        _createFile(doc.ID, doc.Content, doc.CreatedDate, doc.LastModified);\n        _fireProgress(++counter, count);\n    }\n    else\n    {\n        break;\n    }\n}\n</code></pre>\n\n<p>The Utility.ContinueDocumentPreview flag is set to false when a user hits a Cancel button while this process is running.  The problem is when the flag is false and the code should break out of the loop, I get a SQL timeout exception.</p>\n\n<p>Am I doing this incorrectly?</p>\n"},{"tags":["sql-server-2008","size","varchar"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":17430,"score":6,"question_id":1761124,"title":"How many characters in varchar(max)","body":"<p>How many characters can a SQL Server 2008 database field contain when the data type is VARCHAR(MAX)?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12676936,"title":"how to earn avg of one row in sql server","body":"<p>I have a store procedure in sql that give me average of some column:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[Financial] \n\nAS\nBEGIN\n    select avg([aa ]) as 'aaa',\n    avg([bb]) as 'bbb',\n    avg([cc ]) as 'ccc',\n    avg([dd]) as 'ddd',\n    avg([ee]) as 'eee',\n    avg([ ff]) as 'fff'\nfrom [FIN]\nEND\n</code></pre>\n\n<p>Now my problem is if I wanna give avg for the result of this procedure,what can I do?you know the result of this procedure is one row,now I want to earn the avg of this row. what should I add to my current procedre?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1036,"score":0,"question_id":816395,"title":"SQL Server 2008 Slow Table, Table Partitioning","body":"<p>I have a table that has grown to over 1 million records... today (all valid)</p>\n\n<p>I need to speed it up... would Table Partitioning be the answer? If so can i get some help on building the query?</p>\n\n<p>The table has 4 bigint value keys and thats all with a primary key indexed and a index desc on userid the other values are at max 139 (there is just over 10,000 users now)</p>\n\n<p>Any help or direction would be appreciated :)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssrs-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2429,"score":1,"question_id":9480389,"title":"Error converting data type varchar to float","body":"<pre><code>CASE\nWHEN (Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)- FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))&gt; 0 AND (Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)- FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))&lt;=0.25 THEN (0.25+FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))\n\nWHEN (Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)- FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))&gt; 0.25 AND (Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)- FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))&lt;=0.50 THEN (0.50+FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))\n\nWHEN (Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)- FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))&gt; 0.50 AND (Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)- FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))&lt;=0.75 THEN (0.75+FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))\n\nWHEN (Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)- FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))&gt; 0.75 AND (Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)- FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))&lt;1 THEN (1+FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))\n\n\nWHEN (Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)- FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))= 0 THEN (0+FLOOR(Cast(CONVERT(DECIMAL(10,2),(totaleffort/7.40)) as nvarchar)))\n\nEND\n\nAS Estimated_Effort_Days,\n</code></pre>\n\n<p>The above code is currently rounding up a field called totaleffort to the nearest.25, for example if i have a value of 78.19 it will round up to 78.25.</p>\n\n<p>I have a new requirement for the value of zero, when the value = 0 then i need to display the text 'unknown number' I have attempted to add an additional case statement however the query fails to run with an error : </p>\n\n<blockquote>\n  <p>Error converting data type varchar to float.</p>\n</blockquote>\n\n<p>Does anyone have a reccomendation for me</p>\n"},{"tags":["asp.net","sql-server-2008","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":145,"score":1,"question_id":12674141,"title":"SQL Server 2012 and .NET Framework 4.0","body":"<p>I have a server which configured for SQL Server 2008 R2 and ASP.NET 4.0.</p>\n\n<p>The hosting company won't support .Net Framework 4.5 and SQL Server 2012 and latest Entity Framework.</p>\n\n<p>I have created my website with .Net Framework 4.5 and latest Entity Framework 5. How can I change the publish settings to old server execute that ? </p>\n"},{"tags":["c#","sql-server-2008","asp.net-3.5"],"answer_count":4,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":16506,"score":2,"question_id":1196793,"title":"The SELECT permission was denied on the object 'Address', database 'CNET_85731', schema 'dbo'","body":"<p>I have been working away for the last 7 months on a C# ASP.NET using Visual Studio 2008 and SQL Server 2008.</p>\n\n<p>Today, I was running part of my application which was previously running and I got the following error:</p>\n\n<p>The SELECT permission was denied on the object 'Address', database 'CNET_85731', schema 'dbo'.</p>\n\n<p>I walked through my code and discovered that this error was being caused in the following User Control:</p>\n\n<pre><code>protected void sdsAddressesList_Selected(object sender, SqlDataSourceStatusEventArgs e)\n{\n    if (e.AffectedRows == 0)\n    {\n        ddlAddresses.Items.Insert((0), new ListItem(\"No Billing Addresses\", \"0\"));\n    }\n}\n</code></pre>\n\n<p>the SQLDataSource is defined as follows:</p>\n\n<pre><code>&lt;asp:SqlDataSource ID=\"sdsAddressesList\" runat=\"server\" OnSelecting=\"sdsAddressesList_Selecting\" OnSelected=\"sdsAddressesList_Selected\"\n    SelectCommand=\"SELECT [AddressId], [ZipPostalCode], ZipPostalCode + '&amp;nbsp;--&amp;nbsp;' + Address1 AS CombinedAddress FROM [Address] WHERE ([CustomerID] = @CustomerID AND [IsBillingAddress] = @IsBillingAddress) ORDER BY [ZipPostalCode]\"\n    ConnectionString=\"&lt;%$ ConnectionStrings:eCoSysConnection %&gt;\"&gt;\n    &lt;SelectParameters&gt;\n        &lt;asp:Parameter Name=\"CustomerID\" Type=\"Int32\" /&gt;\n        &lt;asp:Parameter Name=\"IsBillingAddress\" Type=\"Boolean\" /&gt;\n    &lt;/SelectParameters&gt;\n&lt;/asp:SqlDataSource&gt;\n</code></pre>\n\n<p>Basically, what the control does is retrieve a list of addresses for the logged on user from the [Address] table and then populate the drop down list ddlAddresses.</p>\n\n<p>The Address table has all the same permissions as the rest of the tables in the database.  I have around 60 tables and approximately 200 stored procedures all merrily working away doing SELECTs, etc.  No problem.  Except for this one issue.  What on earth is going on?  I haven't made any changes to the database or table permissions.</p>\n\n<p>Can anyone help me please.</p>\n\n<p>Regards</p>\n\n<p>Walter</p>\n"},{"tags":["sql","tsql","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":948,"score":3,"question_id":5996177,"title":"Output a comma seperated list in T-SQL","body":"<p>I have a table with phone numbers in it. Instead of spitting out a single row for each number I want to return a comma separated list of phone numbers. What's the easiest way to do this in sql? A while loop?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":12673769,"title":"Stored procedure to return an extra column with count of foreign id in SQL","body":"<p>Firstly I am new to SQL, and I have trouble in setting up a simple stored procedure. I am learning SQL and need some help here.</p>\n\n<p>Scenario:</p>\n\n<ul>\n<li><p>I have two tables, <code>Fruits</code> and <code>Oranges</code></p></li>\n<li><p><code>Fruits</code> has the following columns</p>\n\n<ul>\n<li>fruitId</li>\n<li>fruitSeason</li>\n</ul></li>\n<li><p><code>Oranges</code> has the following columns</p>\n\n<ul>\n<li>organgesId</li>\n<li>fruitId</li>\n<li>orangeName</li>\n</ul></li>\n</ul>\n\n<p>I want to create a stored procedure to return all <code>Fruits</code> along with an extra column count, this count will be total number of fruits id in <code>Oranges</code>.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":108,"score":7,"question_id":12414104,"title":"How to use OUTPUT clause of SQL Server for update","body":"<pre><code>DECLARE @t2 AS TABLE(id INT)  \n\nINSERT INTO dbo.EntityMaster\n        (EntityType)\nOUTPUT INSERTED.EntityId INTO @t2\nSELECT 'G' FROM #tmp\n</code></pre>\n\n<p><code>#tmp</code> is a temporary table that contains data loaded from an xml. I need to generate <code>EntityId</code> for each record contained in <code>#tmp</code>. It can be done by inserting record first into <code>EntityMaster</code> table then insert this entityid back into <code>#tmp</code> for each record.</p>\n\n<p>Instead of inserting record into <code>@t2</code>, I need to update <code>#tmp</code> for each record. </p>\n\n<p>Any possibility?</p>\n"},{"tags":[".net","sql-server-2008","entity-framework","asp.net-4.0","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":12611960,"title":"Entity Framework code first with TimeStamp type","body":"<p>I am using SQL Server 2008 R2 and Entity Framework 5.0. When the database is generated, I cannot add my property of type TimeStamp without having the following error:\nThere is no store type corresponding to the conceptual side type </p>\n\n<blockquote>\n  <p>'Edm.Time(Nullable=True,DefaultValue=,Precision=)' of primitive type\n  'Time'.</p>\n</blockquote>\n\n<p>I have set the Entity Configuration to the type time or timestamp without success</p>\n\n<pre><code>Property(x =&gt; x.RestBetweenSet).HasColumnType(\"timestamp\");\n</code></pre>\n\n<p>When I go in the Sql Server Management Studio and edit the table I can set a column of timestamp.</p>\n\n<p>What do I need to do to have Entity Framework code first be able to generate this column?</p>\n\n<p>Thank you</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":97,"score":3,"question_id":12671345,"title":"SQL Server 2008 cannot drop constraint","body":"<p>I'm trying to drop a primary key constraint from a table using the following</p>\n\n<pre><code>ALTER TABLE SchemaName.LabourGrade DROP CONSTRAINT Labour_Grade_pk\n</code></pre>\n\n<p>and getting the error <code>Labour_Grade_pk is not a constraint.</code></p>\n\n<p>when I do</p>\n\n<p><code>SELECT * FROM sysobjects WHERE name = 'LabourGrade_pk'</code></p>\n\n<p>I get one row back. It does have FKs to it so I tried dropping those first but same problem.\nI only want to drop the PK so as to change the column's datatype, is there better way to do this?</p>\n"},{"tags":["sql-server-2008","zend-framework","utf-8","php-5.4"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":503,"score":2,"question_id":10834175,"title":"PHP 5.4 on Linux: How to connect with MS SQL Server 2008?","body":"<p>I have a Linux server Debian 6, with Apache 2.2 and PHP 5.4 installed.\nI need to connect my application with a MS SQL Server 2008.</p>\n\n<p>My application is using Zend Framework 1.11 and charset UTF-8 (I'll have users from all places in the world and they will put data in their own language).</p>\n\n<p>FRIST, I tried to use Microsoft SQL Server ODBC driver for Linux.\nIt says is only for Red Hat, but I follow these instructions to install:</p>\n\n<p><a href=\"http://www.codesynthesis.com/~boris/blog/2011/12/02/microsoft-sql-server-odbc-driver-linux/\" rel=\"nofollow\">http://www.codesynthesis.com/~boris/blog/2011/12/02/microsoft-sql-server-odbc-driver-linux/</a></p>\n\n<p>I could connect and make some selects on it, but I couldn't insert data on it. I got a problem on binding parameters on pdo statements.</p>\n\n<p>Insert data like the following didn't work:</p>\n\n<pre><code>$stmt = $conn-&gt;prepare(\"insert into mar_regions (name) values (:name)\");\n$resp = $stmt-&gt;execute(array(':name' =&gt; $param));\n</code></pre>\n\n<p>But if I used like the this, it works:</p>\n\n<pre><code>$stmt = $conn-&gt;prepare(\"insert into mar_regions (name) values ('\".$param.\"')\");\n$resp = $stmt-&gt;execute();\n</code></pre>\n\n<p>So I gave up from this driver, because my application no ZF 1.11 will not work if this.</p>\n\n<p>SECOND, I try to use PDO Driver for FreeTDS. This one works ok and I could use on my ZF 1.11 application.</p>\n\n<p>But then, I got one more problem: charsets.\nI configure my freeTDS.conf to use UTF-8, change my tables to use NVARCHAR insted of VARCHAR and could insert utf-8 data like this:</p>\n\n<pre><code>$stmt = $dbh-&gt;prepare(\"insert into mar_teste (name) values (N'ンから初・配信 € зеленый банан ÀÀÀÀáááááá')\");\n$resp = $stmt-&gt;execute();\n</code></pre>\n\n<p>But, on my ZF 1.11, I can't pass this 'N' attribute on querys! So my application still didn't work.</p>\n\n<p>As you can see I tried everything.</p>\n\n<p><strong>So my question is</strong>:How to connect from linux, using ZF 1.11 charset UTF-8, on MS SQL Server 2008?</p>\n\n<p>Maybe you guys can say if I did something wrong on my previous tests or show me how to did it properly.</p>\n\n<p>I would appreciate any help!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","cumulative-sum"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":101,"score":4,"question_id":12668785,"title":"Cumulating value of current row + sum of previous rows","body":"<p>How would you do to tranform a Column in a table from this: </p>\n\n<pre><code>ColumnA   ColumnB\n2           a\n3           b\n4           c\n5           d\n1           a\n</code></pre>\n\n<p>to this:</p>\n\n<pre><code>ColumnA          ColumnB\n3                 a\n6(=3+3)           b   \n10(=4+3+3)        c   \n15(=5+4+3+3)      d \n</code></pre>\n\n<p>I'm interested to see esp. what method you would pick.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2008","index","filtered-index"],"answer_count":2,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":191,"score":8,"question_id":10897198,"title":"Filtered index condition is ignored by optimizer","body":"<p>Assume I'm running a website that shows funny cat pictures. I have a table called <code>CatPictures</code> with the columns <code>Filename</code>, <code>Awesomeness</code>, and <code>DeletionDate</code>, and the following index:</p>\n\n<pre><code>create nonclustered index CatsByAwesomeness\non CatPictures (Awesomeness) \ninclude (Filename)\nwhere DeletionDate is null\n</code></pre>\n\n<p>My main query is this:</p>\n\n<pre><code>select Filename from CatPictures where DeletionDate is null and Awesomeness &gt; 10\n</code></pre>\n\n<p>I, as a human being, know that the above index is all that SQL Server needs, because the index filter condition already ensures the <code>DeletionDate is null</code> part.</p>\n\n<p>SQL Server however doesn't know this; the execution plan for my query will not use my index:</p>\n\n<p><img src=\"http://i.stack.imgur.com/XlC1a.png\" alt=\"query plan, doing a table scan\"></p>\n\n<p>Even if adding an index hint, it will still explicitly check <code>DeletionDate</code> by looking at the actual table data:</p>\n\n<p><img src=\"http://i.stack.imgur.com/02ODx.png\" alt=\"query plan that uses the index, but still does a bookmark lookup\"></p>\n\n<p>(and in addition complain about a missing index that would include <code>DeletionDate</code>).</p>\n\n<p>Of course I could</p>\n\n<pre><code>include (Filename, DeletionDate)\n</code></pre>\n\n<p>instead, and it will work:</p>\n\n<p><img src=\"http://i.stack.imgur.com/f76n9.png\" alt=\"query plan with the index that includes DeletionDate; this index is used\"></p>\n\n<p>But it seems a waste to include that column, since this just uses up space without adding any new information.</p>\n\n<p>Is there a way to make SQL Server aware that the filter condition is already doing the job of checking <code>DeletionDate</code>?</p>\n"},{"tags":["sql-server","sql-server-2008","database-design"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12671153,"title":"What columns to include on filtered index?","body":"<p>Let's say there is a table called T1</p>\n\n<pre><code>CREATE TABLE T1\n(\n  GID INT NOT NULL,\n  Attrib1 BIT NOT NULL,\n  Attrib1Date DATE NOT NULL,\n  Attrib2 BIT NOT NULL,\n  CONSTRAINT PK_T1 PRIMARY KEY (GID)\n)\n</code></pre>\n\n<p>Now, I'm creating indexes for query, where only rows with Attrib1 equal 1 or Attrib2 equal 1 are interesting. Let's say there are only 20% of rows like that. </p>\n\n<p><em>Please, do not concern about Attrib1 to Attribe2 corelation - they are given only for two separate examples.</em></p>\n\n<p>It's obvious to use filtered indexes - I mean: INDEX-es with WHERE clause. But question is what columns to include?</p>\n\n<p><strong>Sample queries:</strong></p>\n\n<pre><code>SELECT * FROM T1 WHERE Attrib1 = 1 ORDER BY Attrib1Date\nSELECT * FROM T1 WHERE Attrib2 = 1\n</code></pre>\n\n<p><strong>Example and question 1)</strong></p>\n\n<p>Which INDEX is more correct?</p>\n\n<pre><code>CREATE NONCLUSTERED INDEX IX_Attrib1\nON T1 (Attrib1, Attrib1Date)\nWHERE Attrib1 = 1\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>CREATE NONCLUSTERED INDEX IX_Attrib1\nON T1 (Attrib1Date, Attrib1)\nWHERE Attrib1 = 1\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>CREATE NONCLUSTERED INDEX IX_Attrib1\nON T1 (Attrib1Date)\nWHERE Attrib1 = 1\n</code></pre>\n\n<p><strong>Example and question 2)</strong></p>\n\n<p>Is it correct to build filtered index containing only column by which is filtered, like:</p>\n\n<pre><code>CREATE NONCLUSTERED INDEX IX_Attrib2\nON T1 (Attrib2)\nWHERE Attrib2 = 1\n</code></pre>\n"},{"tags":["asp.net","sql-server-2008","iis7"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":404,"score":2,"question_id":8932921,"title":"IIS7 can't connect to database","body":"<p>Our production server has suddenly started coming up with errors when connecting to the database. I get the error below on any database call from any web app on the server.</p>\n\n<pre><code>\"A connection was successfully established with the server, but then an error \noccurred during the pre-login handshake. (provider: SSL Provider, error: 0 - \nThe specified data could not be decrypted.\"\n</code></pre>\n\n<p>I don't even want, and never have connected to SQL Server with SSL so I don't know why it's doing this. The database works fine and I can access it using the dev versions of the apps from my office. The database is hoted remotely.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12316628,"title":"How to update a primary key column which should reflect in foreign key column?","body":"<p>I have two tables <code>emp_details</code> and <code>dep_details</code>.</p>\n\n<p>In <code>emp_details</code> the fields are (<code>empid</code>, <code>empname</code>, <code>empsal</code>, <code>deptId(f.key)</code>) and in <code>dept_details</code> fields are (<code>deptID(P.key)</code>, <code>deptname</code>).</p>\n\n<p>If I update the <code>empname</code>, <code>empsal</code> and <code>deptname</code> from <code>empdetails</code> and <code>deptdetails</code>, the primary key column and foreign key column <code>deptID</code> must get updated simultaneously. </p>\n\n<p>Below is the Stored Procedure that I tried:</p>\n\n<pre><code>alter proc UpdateEmployeeDetail(@eid int ,@ename varchar(30),@esal float, @deptid varchar(30),@deptname varchar(30))\nas \nbegin\nupdate e set e.ename=@ename, e.esal=@esal, e.deptid=@deptid from\n EmployeeDetails e where  e.eid=@eid\n update d set d.deptid=@deptid, d.deptname=@deptname from  DepartmentDetails d  , EmployeeDetails e\n where e.deptid=d.deptid and d.deptid=@deptid\nend \ngo'\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":71,"score":1,"question_id":12671629,"title":"how to add a column at a specific position in a table?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6121884/sql-server-2008-cannot-insert-new-column-in-the-middle-position-and-change-dat\">SQL Server 2008 : Cannot Insert new column in the middle position and change data type</a>  </p>\n</blockquote>\n\n\n\n<p>Hi i am using SQL SERVER 2008 &amp; 2008 R2 i would like to add a column in a table at a specific position using alter command. is there any way keyword using which we can add a column at a specific position ? thanks! in adavanced.</p>\n"},{"tags":["c#","asp.net",".net","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12662932,"title":"Chaining user responses with SQL Server and ASP.NET","body":"<p>I'm not quite sure how to approach this so thought it best to ask, see if anyone has any ideas that may help.</p>\n\n<p>I have a table stored in SQL Server that stores Exchange 2010 Mailbox Server Performance Data with this schema:</p>\n\n<pre><code>CREATE TABLE [dbo].[2010_Perfmon_MBX]\n(\n    [ID] [int] IDENTITY(1,1) NOT NULL,\n    [Server] [varchar](50) NULL,\n    [ObjectName] [varchar](100) NULL,\n    [CounterName] [varchar](100) NULL,\n    [InstanceName] [varchar](100) NULL,\n    [Value] [decimal](18, 3) NULL,\n    [DateTime] [datetime] NULL\n)\n</code></pre>\n\n<p>I also have an ASP.NET website written in C#. I want to allow users to select cascading answers, that ultimately returns the requested data into a GridView/Graph.</p>\n\n<p>Right now, my main challenge is how to ensure the data is not returned until the end user has selected values from all of the columns.</p>\n\n<p>I want to stage it like this:</p>\n\n<p>User is asked for a server to pull data from</p>\n\n<pre><code>SELECT DISTINCT(Server)\nFROM 2010_Perfmon_MBX\n</code></pre>\n\n<p>Let's pretend they pick the server <code>MailboxServer.domain.com</code>:</p>\n\n<pre><code>SELECT DISTINCT(ObjectName)\nFROM 2010_Perfmon_MBX\nWHERE Server = 'MailboxServer.domain.com'\n</code></pre>\n\n<p>User is then asked, based on the server <code>MailboxServer.domain.com</code>, for an ObjectName. They pick <code>'msexchangeis mailbox'</code> for example:</p>\n\n<pre><code>SELECT DISTINCT(CounterName)\nFROM 2010_Perfmon_MBX\nWHERE Server = 'MailboxServer.domain.com'\nAND ObjectName = 'msexchangeis mailbox'\n</code></pre>\n\n<p>Next the user is asked for <code>CounterName</code>. They pick <code>'active rpc threads'</code>:</p>\n\n<pre><code>SELECT DISTINCT(InstanceName)\nFROM 2010_Perfmon_MBX\nWHERE Server = 'MailboxServer.domain.com'\nAND ObjectName = 'msexchangeis mailbox'\nAND CounterName = 'active rpc threads'\n</code></pre>\n\n<p>Lastly they pick the <code>InstanceName</code>. In this example <code>'Database20'</code>. The full query then runs which pulls back all of the data based on the choices made:</p>\n\n<pre><code>SELECT *\nFROM 2010_Perfmon_MBX\nWHERE Server = 'MailboxServer.domain.com'\nAND ObjectName = 'msexchangeis mailbox'\nAND CounterName = 'active rpc threads'\nAND InstanceName = 'Database20'\n</code></pre>\n\n<p>What is the most elegant way of ensuring that the flow of choices works without jumping ahead and chaining the selections?</p>\n\n<p>I need to ensure that the selections are dynamic, and is based on available data in the SQL Server table for the selected server, so only valid data can be chosen.</p>\n\n<p>Thanks for reading.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":56,"score":0,"question_id":12670409,"title":"Comma-separated values with SQL query","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10083836/sql-select-group-by-and-string-concat\">Sql select group by and string concat</a>  </p>\n</blockquote>\n\n\n\n<p>My SQL table looks like this:</p>\n\n<pre><code>City_Code        Post_Code   Post_Code_Description\n100               A1          ABC\n100               C8          XYZ\n100               Z3          MNO\n200               D4          LMN\n300               E3          IJK\n300               B9          RST\n</code></pre>\n\n<p>It's a mapping between <code>city_code</code> and <code>Post_Code</code>. One <code>City_Code</code> can have many <code>Post Codes</code>. Now I want to run a query to get something like this:</p>\n\n<pre><code>City_Code           Post_Code         Post_Code_Description\n100                 A1,C8,Z3          ABC,XYZ,MNO\n200                 D4                LMN\n300                 E3,B9             IJK,RST\n</code></pre>\n\n<p>Can you please help me with this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12669831,"title":"select Query with length issue","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/121864/most-efficient-t-sql-way-to-pad-a-varchar-on-the-left-to-a-certain-length\">Most efficient T-SQL way to pad a varchar on the left to a certain length?</a>  </p>\n</blockquote>\n\n\n\n<p>I have the customer table where the customerID is of length:10\nbut there are few customer where the length is 3 or 5</p>\n\n<pre><code>ex: \n3445\n34\n789\n7800\n</code></pre>\n\n<p>but the output should be like the following, I need to prefix zero here if length is less than 10</p>\n\n<pre><code>0000003445\n0000000034\n0000000789\n0000007800\n</code></pre>\n\n<p>Script to get this data is:</p>\n\n<blockquote>\n  <p>select customerID from customer</p>\n</blockquote>\n\n<p>Any help on this would be great, thanks.</p>\n"},{"tags":["asp.net",".net","sql-server-2008","asp.net-3.5","tool-advice"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":82,"score":-1,"question_id":3305794,"title":"How to save in database","body":"<p><strong>http://www.dsebd.org/latest_PE_all2_08.php</strong></p>\n\n<p>above url contain information want to save is database ms2008.\nHow to save this value .</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12668528,"title":"SQL Server : GROUP BY clause to get comma-separated values","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/8868604/sql-group-concat-function-in-sql-server\">SQL group_concat function in SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>I am looking to create a query but somehow I am unable to do so. Can anyone please help me out here?</p>\n\n<p>The original data</p>\n\n<pre><code>ID    ReportId     Email\n1     1            a@a.com\n2     2            b@b.com\n3     1            c@c.com\n4     3            d@d.com\n5     3            e@e.com\n</code></pre>\n\n<p>I want to group by <code>ReportId</code>, but all the email should be comma separated. So the result should be:</p>\n\n<pre><code>ReportId     Email\n1            a@a.com, c@c.com\n2            b@b.com\n3            d@d.com, e@e.com\n</code></pre>\n\n<p>What is the best way to do this? </p>\n\n<p>I am trying the group by clause but if there is any other thing then i am open to implement that also. I really appreciate your time and help on this. Thank you.</p>\n"},{"tags":["xml","sql-server-2008","cdata"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":720,"score":0,"question_id":6941769,"title":"XML Column Extract ![CDATA[ ]]","body":"<p>I am running the below query to extract data from an xml column...question is how to  extract data that is in between ![CDATA[\"\"]] ?</p>\n\n<pre><code>select        \n     CAST(xml as xml).value('(//@nodeName)[1]','nvarchar(20)') as NodeName,       \n     CAST(xml as xml).value('(//![CDATA [prdDetDesc]])[1]','nvarchar(225)') as DetDesc,\n     CAST(xml as xml).value('(//prdImg)[1]','nvarchar(1000)') as prdImage\nfrom [dbo].[cmsContentXml])\n</code></pre>\n\n<p>I need to extract data that is present between [[\"\"]]</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["php","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12669006,"title":"sqlsrv_fetch_array in php","body":"<p>I try to retrieve a single row data without looping, somehow i couldn't echo the result that I want:   </p>\n\n<pre><code>$sql = \"SELECT * FROM table WHERE [TxId] = '?'\";\n    $params = array($TxId);\n    $stmt = sqlsrv_query($conn, $sql, $params);\n\n$row = sqlsrv_fetch_array($stmt, SQLSRV_FETCH_ASSOC);\n$status = $row[\"Status\"];\necho \"status: \".$status.\"&lt;br&gt;\";\n</code></pre>\n\n<p>Is SQL server and Mysql different in retrieve single row record?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server-2008","split"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":483,"score":0,"question_id":7161166,"title":"SQL Server 2008 - Split","body":"<p>How do we use cross apply and split values in a column?</p>\n\n<p>I have a function dbo.split that based on a comma separates the values into separate column  </p>\n\n<pre><code> Id         Name      Value  \n1234    A     6767  \n1234    A     6767,1111   \n5678    A     6767  \n5678    A     6767,1111  \n9999    A     6767  \n</code></pre>\n\n<p>Please help with SQL query to Cross Apply and also use the split function</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","common-table-expression"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":102,"score":2,"question_id":12668468,"title":"initialize and increment variable inside cte query sqlserver 2008","body":"<p>I am using sqlserver 2008 ,I want to initialize and increment variable (<code>@NUMTwo</code>) both at the same time, in my second part(Problem Line).</p>\n\n<p>I am creating a cte query.</p>\n\n<p>Is this possible , if yes then please let me know.</p>\n\n<p>following is a sample example.I hope i am clear.</p>\n\n<pre><code>CREATE table #TempTable \n(\nchildProductID  INT,parentProductID INT,productModel varchar(50),[Num2] VARCHAR(100)\n)\n\nDECLARE @NUMTwo  INT = 0\nWITH tableR   AS    \n (\n\n        -- First Part\n    SELECT childProductID = null,parentProductID=null,productModel  from Products where productid in (@a),[Num2] = convert(varchar(100), '')\n            UNION ALL\n            --Second Part            \n    SELECT e.childProductID,e.parentProductID,prd.productModel FROM ProductIncludes AS e  \n            ,[Num2] = convert(varchar(100),'1.'  + @NUMTwo+=1 )    -- Problem line\n    INNER JOIN  Products AS PRD ON e.childProductID = PRD.productID      \n    WHERE parentProductID in (@a)  \n\n      )\n\nINSERT INTO #TempTable(childProductID,parentProductID,productModel,[Num2])\nSELECT childProductID,parentProductID,productModel,[Num2]\n\nEND \nSELECT * FROM #TempTable\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":12668343,"title":"how can i get name of table and its column while checking the reference of any value in multiple columns?","body":"<p>When deleting any Team from team table, i need to check that teamId is available in other tables or not. for this i am using following query:-</p>\n\n<pre><code>        select  count(TeamId) from \n        ( select TeamId from Project union all \n          select  TeamId from TeamMember union all \n          select  TeamId from Department union all \n          select TeamId from Role   union all \n        ) as Id where TeamId = 1\n</code></pre>\n\n<p>this query is working fine, and returns number of count. </p>\n\n<p>but now i need name of that table and its column, where i found that teamId. </p>\n\n<p>if it is possible than please give me right solution.</p>\n\n<p>thanks in advance..</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12315796,"title":"attach database failed for server microsoft.sqlserver.smo in sql server 2008 error 3415","body":"<p>\"attach database failed for server microsoft.sqlserver.smo in sql server 2008 error 3415\"</p>\n\n<p>i can add files from C: but can't from any other location.What will be the reason?\nneed immediate help...</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","divide-by-zero"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":11337250,"title":"How to avoid divide by zero error here?","body":"<p>The following query that I have is encountering a divide by 0 error:</p>\n\n<pre><code>select  pp.building_name, \n        ld.tenant_trading_name,  \n        tenancy_reference,  \n        ld.turnover_threshold, \n        ld.percentage_rent, \n        ld.income_base_rent_ach, \n        ld.income_base_rent_ach / ld.percentage_rent as correct \nfrom \n    lease_deal.lease ld\n\ninner join property.property pp\n    on ld.building_id = pp.building_id\n\nwhere \n    (ld.income_base_rent_ach / ld.percentage_rent ) &lt;&gt; ld.turnover_threshold\n    and lease_status = 'APPROVED'\n    and ld.progenesis_load_date is  null\norder by pp.building_name\n</code></pre>\n\n<p>I've tried to correct this by doing the following - but I'm receiving a syntax error and I'm unsure why? What is syntactically incorrect here?</p>\n\n<pre><code>select  pp.building_name, \n        ld.tenant_trading_name,  \n        tenancy_reference,  \n        ld.turnover_threshold, \n        ld.percentage_rent, \n        ld.income_base_rent_ach, \n        ld.income_base_rent_ach / ld.percentage_rent as correct \nfrom \n    lease_deal.lease ld\n\ninner join property.property pp\n    on ld.building_id = pp.building_id\n\nwhere \n    case when ld.percentage_rent = 0\n    then 1=1\n    else ((ld.income_base_rent_ach / ld.percentage_rent ) &lt;&gt; ld.turnover_threshold)\n    end\n    and lease_status = 'APPROVED'\n    and ld.progenesis_load_date is  null\norder by pp.building_name\n</code></pre>\n"}]}
{"total":21074,"page":17,"pagesize":100,"questions":[{"tags":["sql-server","sql-server-2005","sql-server-2008","rowlocking"],"answer_count":3,"favorite_count":5,"up_vote_count":14,"down_vote_count":0,"view_count":9044,"score":14,"question_id":3114826,"title":"Is it possible to force row level locking in SQL Server?","body":"<p>I can see how to turn off row level and page level locking in SQL Server, but I cannot find a way to force SQL Server to use row level locking. Is there a way to force SQL Server to use row level locking and NOT use page level locking?</p>\n"},{"tags":["python","sql-server","sql-server-2008","pyodbc"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":135,"score":4,"question_id":11810681,"title":"Accessing a local SQL Server 2008 database with pyodbc on Windows 7","body":"<p>I'm trying to use pyodbc to connect to a local copy of a SQL Server 2008 database (it connects to the remote production database just fine).</p>\n\n<p>However, when I try connecting to the local copy using the following command:</p>\n\n<pre><code>pyodbc.connect('DRIVER={SQL\nServer};SERVER=localhost;DATABASE=mydb;UID=me;PWD=pw')\n</code></pre>\n\n<p>the connection fails with the following error message:</p>\n\n<pre><code>pyodbc.Error: ('08001', '[08001] [Microsoft][ODBC SQL Server\nDriver][DBNETLIB]SQL Server does not exist or access denied. (17)\n(SQLDriverConnect); [01000] [Microsoft][ODBC SQL Server\nDriver][DBNETLIB]ConnectionOpen (Connect()). (5)')\n</code></pre>\n\n<p>Trying to connect via Windows authentication (with <code>'Trusted_Connection=yes'</code>) fails as well.</p>\n\n<p>I can connect to the local database fine using SQL Server Management Studio with both Windows Authentication and SQL Server Authentication. Any ideas why I can't connect with pyodbc?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":47,"score":-2,"question_id":12666569,"title":"Any idea how to grab just names from the following values?","body":"<p>We have a table with just one fieldname called Names.</p>\n\n<p>There are several rows of long values associated with this fieldname.</p>\n\n<p>Below is an example of how long each row of values could be.</p>\n\n<pre><code>Names\n\n0000000024DOE JAMES JAN E102/02/1988107/11/2007 13011UNASSIGNED EMPLOYEEID 0175420670 3303302 - DY1 B100 1000 - 07/11/2007 0000028800 0000040849 0000173045 0000021600 \netc\netc\n</code></pre>\n\n<p>Is it possible to just extract only the names from the lists similar to above?</p>\n\n<p>For instance, we would like to extract DOE JAN while ignoring the rest of the values.</p>\n\n<p>Sometimes, the names have a middle initial.</p>\n\n<p>Example:</p>\n\n<pre><code>0000000024DOE JAMES JAN E102/02/1988107/11/2007 13011UNASSIGNED EMPLOYEEID 0175420670 3303302 - DY1 B100 1000 - 07/11/2007 0000028800 0000040849 0000173045 0000021600 \n</code></pre>\n\n<p>In this example, the value we would like to extract is Doe Jan E.</p>\n\n<p>Any ideas how to go about it if it is possible?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":71,"score":7,"question_id":12666306,"title":"Properly using the Count Function","body":"<p>In the Enrollment_Changes table, the phone model listed is the phone the subscriber changed FROM on that date.</p>\n\n<p>If there is no subsequent change on Enrollment_Changes, the phone the subscriber changed TO is listed on the P_Enrollment table</p>\n\n<p>For example, subscriber 12345678 enrolled on 1/5/2011 with a RAZR.  On 11/1/2011 he changed FROM the RAZR.  You can see what he changed TO with the next transaction on Enrollment_Changes on 05/19/2012.  </p>\n\n<p>How would you find the Count of subs that first enrolled with the iPhone 3? </p>\n\n<p>Here is the code I have for creating the tables</p>\n\n<p>Create Tables: TBL 1</p>\n\n<pre><code>USE [Test2]\nGO\n\n/****** Object:  Table [dbo].[P_ENROLLMENT]    ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [dbo].[P_ENROLLMENT](\n    [Subid ] [float] NULL,\n    [Enrollment_Date] [datetime] NULL,\n    [Channel] [nvarchar](255) NULL,\n    [Region] [nvarchar](255) NULL,\n    [Active_Status] [float] NULL,\n    [Drop_Date] [datetime] NULL,\n    [Phone_Model] [nvarchar](255) NULL\n) ON [PRIMARY]\n\nGO\n</code></pre>\n\n<p>TBL 2</p>\n\n<pre><code>USE [Test2]\nGO\n\n/****** Object:  Table [dbo].[ENROLLMENT_CHANGES]     ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE TABLE [dbo].[ENROLLMENT_CHANGES](\n    [Subid] [float] NULL,\n    [Cdate] [datetime] NULL,\n    [Phone_Model] [nvarchar](255) NULL\n) ON [PRIMARY]\n\nGO\n</code></pre>\n\n<p>Insert TBL1</p>\n\n<pre><code>INSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12345678, '2011-01-05 00:00:00', 'Retail', 'Southeast', 1, NULL, 'iPhone 4');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12346178, '2011-03-13 00:00:00', 'Indirect Dealers', 'West', 1, NULL, 'HTC Hero');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12346679, '2011-05-19 00:00:00', 'Indirect Dealers', 'Southeast', 0, '2012-03-15 00:00:00', 'Droid 2');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12347190, '2011-07-25 00:00:00', 'Retail', 'Northeast', 0, '2012-05-21 00:00:00', 'iPhone 4');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12347701, '2011-08-14 00:00:00', 'Indirect Dealers', 'West', 1, NULL, 'HTC Hero');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12348212, '2011-09-30 00:00:00', 'Retail', 'West', 1, NULL, 'Droid 2');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12348723, '2011-10-20 00:00:00', 'Retail', 'Southeast', 1, NULL, 'Southeast');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12349234, '2012-01-06 00:00:00', 'Indirect Dealers', 'West', 0, '2012-02-14 00:00:00', 'West');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12349745, '2012-01-26 00:00:00', 'Retail', 'Northeast', 0, '2012-04-15 00:00:00', 'HTC Hero');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12350256, '2012-02-11 00:00:00', 'Retail', 'Southeast', 1, NULL, 'iPhone 4');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12350767, '2012-03-02 00:00:00', 'Indirect Dealers', 'West', 1, NULL, 'Sidekick');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12351278, '2012-04-18 00:00:00', 'Retail', 'Midwest', 1, NULL, 'iPhone 3');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12351789, '2012-05-08 00:00:00', 'Indirect Dealers', 'West', 0, '2012-07-04 00:00:00', 'iPhone 3');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12352300, '2012-06-24 00:00:00', 'Retail', 'Midwest', 1, NULL, 'Droid 2');\n\nINSERT INTO [P_ENROLLMENT]([Subid ], [Enrollment_Date], [Channel], [Region], [Active_Status], [Drop_Date], [Phone_Model]) \n    VALUES(12352811, '2012-06-25 00:00:00', 'Retail', 'Southeast', 1, NULL, 'Sidekick');\n</code></pre>\n\n<p>Insert TBL2</p>\n\n<pre><code>INSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12345678, '2011-11-01 00:00:00', 'RAZR');\n\nINSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12346178, '2012-01-07 00:00:00', 'HTC Hero');\n\nINSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12348723, '2012-01-28 00:00:00', 'RAZR');\n\nINSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12350256, '2012-02-21 00:00:00', 'Blackberry Bold');\n\nINSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12349745, '2012-05-05 00:00:00', 'HTC Hero');\n\nINSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12345678, '2012-05-19 00:00:00', 'Palm Pre');\n\nINSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12347190, '2012-05-20 00:00:00', 'HTC Hero');\n\nINSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12350256, '2012-05-21 00:00:00', 'Blackberry Bold');\n\nINSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12349234, '2012-06-04 00:00:00', 'Palm Pre');\n\nINSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12346178, '2012-06-05 00:00:00', 'iPhone 3');\n\nINSERT INTO [ENROLLMENT_CHANGES]([Subid], [Cdate], [Phone_Model]) \n    VALUES(12350767, '2012-06-10 00:00:00', 'iPhone 3');\n</code></pre>\n"},{"tags":["java","tsql","sql-server-2008","checksum"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":313,"score":3,"question_id":6892138,"title":"Implementing SQL CHECKSUM in Java","body":"<p>I have an existing database in SQL Server 2008 that performs user authentication via stored procedure for an existing PHP web application.  The web application sends the stored procedure a string, however the stored procedure stores, and checks the value with SQL Checksum (<a href=\"http://msdn.microsoft.com/en-us/library/ms189788.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms189788.aspx</a>).  The Stored Procedure casts the string as NVARCHAR(50), and stores the CHECKSUM as int in the user table.</p>\n\n<p>I am now writing a new Java application on top of the existing database, and I'm writing a custom spring authentication manager.  I would like to re-implement the CHECKSUM algorithm in Java so I do not need to call a stored procedure to perform the conversion, however I can not find any documentation on how SQL CHECKSUM works.</p>\n\n<p>I tried the following code, with the guess that it was CRC32, however it fails to return the same value as SQL CHECKSUM:</p>\n\n<pre><code>String pass = \"foobar\";\nCRC32 crc32 = new CRC32();\ncrc32.update(pass.getBytes(\"UTF-16\")); //This is due to the stored procedure casting as nvarchar\ncrc32.getValue();\n</code></pre>\n\n<p>Can anyone point me to the algorithm that SQL CHECKSUM uses so I can re-implement it in Java?</p>\n\n<p>The question also isn't which algorithm provides the best hash for security. Security is outside of the requirements in this particular instance, as we are not prepared to force a system wide password reset. The question is what algorithm is used by T-SQL CHECKSUM, so that it could be re-implemented. This particular use case is for auth, however there is potential for this being necessary in many different applications.</p>\n"},{"tags":["sql-server-2008","exchange-server"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12661763,"title":"Exchange SQL Server 2008 Database Mail issue","body":"<p>In my web application I have created a mail sender class and set the configurations of <code>web.config</code> file like this:</p>\n\n<pre><code> &lt;mailSettings&gt;\n  &lt;smtp deliveryMethod=\"PickupDirectoryFromIis\"&gt;\n    &lt;network host=\"smtp.domain.com\"\n             port=\"587\"\n             userName=\"mail@domain.com\"\n             password=\"password\"/&gt;\n  &lt;/smtp&gt;\n &lt;/mailSettings&gt;\n</code></pre>\n\n<p>This is sending email. But SQL Server database mail can not send mail with the same account info.</p>\n\n<p>Only one difference is <code>PickupDirectoryFromIis</code> .</p>\n\n<p>Is there any setting on exchange server?</p>\n\n<p>In the SQL Server Logs the errors are following.</p>\n\n<p>Message</p>\n\n<blockquote>\n  <p><em>The mail could not be sent to the recipients because of the mail\n  server failure. (Sending Mail using Account 2 (2012-09-30T16:55:04).\n  Exception Message: Cannot send mails to mail server. (The SMTP server\n  requires a secure connection or the client was not authenticated. The\n  server response was: 5.7.1 Client was not authenticated).</em></p>\n</blockquote>\n"},{"tags":["asp.net","sql","sql-server","sql-server-2008","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":12661325,"title":"Records Doesn't Appear in Table reporting services 2008","body":"<p>When I use table in reporting services 2008 and dragging fields into it,\nit shows repeated records of column header, not values.</p>\n\n<p>What's wrong here ?</p>\n\n<p><img src=\"http://i.stack.imgur.com/VvTMp.png\" alt=\"enter image description here\"></p>\n\n<p>Instead of displaying the field values in the output, it is displaying the field names</p>\n"},{"tags":["sql-server-2008","insert","duplicates"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12646679,"title":"How to insert conditionally","body":"<p>I create a temporary table #tbl(account, last_update). I have following  two inserts from different source (could be tables from different databases) to insert account with last update date. For example</p>\n\n<pre><code>create table #tbl ([account] numeric(18, 0), [last_update] datetime)\n\ninsert into #tbl(account , last_update)\nselect table1.account, max(table1.last_update)\nfrom table1 join…\ngroup by table1.account\n\ninsert into #tbl(account , last_update)\nselect table2.account, max(table2.last_update)\nfrom table2 join…\ngroup by table2.account\n</code></pre>\n\n<p>The problem is this could cause duplicate account in the table #tbl. I either have to avoid it during each insert or remove the duplicate after both insert. Also, if there is account with two different last_update, I want the #tbl have the latest last_update. How do I achieve this conditional insert? Which one will have better performance?</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":11,"favorite_count":2,"up_vote_count":13,"down_vote_count":0,"view_count":56041,"score":13,"question_id":1509977,"title":"convert varchar into datetime in sql server","body":"<p>How do i convert a string of format -> mmddyyyy into datetime in sql server 2008?</p>\n\n<p>My target column in 'DateTime'</p>\n\n<p>I have tried with Convert and most of the Date style values - I get a 'The conversion of a varchar data type to a datetime data type resulted in an out-of-range value.' error message</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12378316,"title":"SQL count zero even when there are no records?","body":"<p>I am using SQL Server 2008</p>\n\n<p>I have 2 tables</p>\n\n<ol>\n<li><p>PS</p>\n\n<p>Columns: PS_ID(PK), AID(FK), PS_Vendor</p></li>\n<li><p>System</p>\n\n<p>Columns: System_ID(PK), AID(FK), Sys_Prod</p></li>\n</ol>\n\n<p>The two tables are connected thru <code>PS.AID = System.AID</code> </p>\n\n<p>I have to find the count of <code>PS_Vendors</code> for each <code>SYS_Product</code> and the total for each <code>Sys_product</code>.</p>\n\n<p>My output has to look like:</p>\n\n<pre><code>PS_Vendor Sys_product Count Total\n ABC         A         2      10  \n ABC         B         5      20       \n ABC         C         0      15\n XYZ         A         3      10\n XYZ         B         0      20\n XYZ         C         12     15 \n</code></pre>\n\n<p>I created a view called <code>PS_system_View</code>:</p>\n\n<pre><code>select * from system\nleft outer join ps\non ps.aid=system.aid\n</code></pre>\n\n<p>I am having trouble combining these</p>\n\n<pre><code>select B.ps_vendor, A.sys_product, B.Count,A.Total from \n\n--To get the total:\n\nselect sys_product, sum(total) as Total from\n\n(select sys_product, ps_vendor, sum(case when sys_product is not null then 1 else 0 end) as total\n\n from PS_System_view\n\n)A\n\ngroup by sys_product\n\nleft join\n\n(\n\n--To get the count:\n\nselect sys_product, ps_vendor, sum(case when ps_vendor is not null then 1 else 0 end) as count from\n PS_System_view\n\nwhere ps_vendor is not null and sys_product is not null\n\n)B on B.sys_product=A.Sys_product\n</code></pre>\n"},{"tags":["sql","sql-server-2008","asp-classic","full-text-search"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":169,"score":0,"question_id":4438349,"title":"SQL 2008 Full Text Search from Classic ASP?","body":"<p>I have a legacy app in which I need to enable search. </p>\n\n<p>Recently we've switched to SQL 2008 and I was wondering to do it with it's Full Text Search.</p>\n\n<p>However my question is...is there API available for Classic ASP? Any references?</p>\n"},{"tags":["jquery","ajax","asp.net-mvc-3","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12211739,"title":"Remove element (both from client and server ) that I just added with Ajax - MVC3","body":"<p>I have a view where I add some elements to a table from Database; let's call the table Students. On the view I also have the option to assign to the student I am adding to the table some books . I have done this with Ajax. </p>\n\n<p>Demo:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>    Name of Student: ...\n    Books : &lt;here is a drop down&gt; ( from database)    &lt; here is a button&gt; (add button)\n\n    &lt;ul&gt;\n   When I click the button here I append some books. I also retain on Session the id of every book ( in a list and when I click submit I send that list to the server )\n    &lt;/ul&gt;\n[Submit button]\n</code></pre>\n\n<p>The problem is that I want to add a delete buton too like this :</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>    Name of Student: ...\n\n    Books : &lt;here is a drop down&gt;     &lt; here is a button&gt; \n\n    &lt;ul&gt;\n    Book1  delete\n    Book2  delete\n    &lt;/ul&gt;\n[Submit button]\n</code></pre>\n\n<p>And when I click the delete button to remove that element from the list and from the Session. </p>\n\n<p>Here is my code:</p>\n\n<ul>\n<li><p>Script from the View</p>\n\n<pre><code>$(function () {\n\n    $(\"#add\").click(function () {\n\n        //items.push($(\"#category\").val());\n        $.ajax({\n            url: '@Url.Action(\"AddCategory\")',\n            type: \"POST\",\n            dataType: \"JSON\",\n            data: { id: $(\"#categoryId option:selected\").val() },\n            beforeSend: function () { },\n            success: function (data) {\n\n                $(\"#toFill\").append(\"&lt;li&gt;\" + $(\"#categoryId option:selected\").text() + \" \" + \"&lt;span style='cursor:pointer;' id='a'&gt;\" + \"[X]\" + \"&lt;/span&gt;\" + \" \" + \"&lt;/li&gt;\");\n            },\n            error: function () { alert(\"error\") }\n\n        })\n        $(\"#toFill #a\").click(function () {\n\n            $.ajax({\n                url: '@Url.Action(\"DeleteCat\")',\n                type: \"POST\",\n                dataType: \"JSON\",\n                data: { id: $(\"#categoryId option:selected\").val() },\n                beforeSend: function () { },\n                succes: function (data) {\n                    // $(\"li\").remove();\n                    alert(\"lala\"); return false;\n                },\n                error: function () { alert(\"error at delete\") }\n\n\n\n            })\n\n        });\n    })\n</code></pre></li>\n<li><p><code>AddCategory</code> and <code>DeleteCat</code> from Controller:</p>\n\n<pre><code>public ActionResult AddCategory(int id)\n{\n    Session.Category.Add(id);\n    return Json(id, JsonRequestBehavior.AllowGet);\n}\n\npublic ActionResult DeleteCat(int id)\n{\n    Session.Category.Remove(id);\n    return Json(id, JsonRequestBehavior.AllowGet);\n}\n</code></pre></li>\n</ul>\n"},{"tags":["sql-server-2008","sql-server-express","visio","windows-7-x64"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2096,"score":4,"question_id":5658648,"title":"Visio 2010 DataSources not showing in reverse engineer wizard","body":"<p>Hi I am trying to do a database diagram in visio 2010 to existing database. I am using the reverse engineer wizard. When I push new button on datasource field. I follow the steps to add new datasource. It looks like everything worked no errors, tested connection and it passes. But after finishing the process it should add it to the datasource box so I can select and proceed on. But it does not show up. DataSource is still blank.</p>\n\n<p>Specifics: It is a 2008 R2 Express db trying to connect to using visio 2010. OS is Window 7 64bit.</p>\n\n<p>Can anyone help.</p>\n"},{"tags":["c#",".net","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":12611906,"title":"Posting data to a SQL Server 2008 database from web service yields error","body":"<p>I am trying to use c# to post data to a web service (that I wrote). This web service runs fine when I run it from my local machine. As soon as I move to it a server (within my building), it throws this error: </p>\n\n<blockquote>\n  <p>Server was unable to process request.<br>\n  ---> ExecuteNonQuery: Connection property has not been initialized.</p>\n</blockquote>\n\n<p>Any ideas what might be causing this?  </p>\n\n<p>I have checked:</p>\n\n<ul>\n<li><p>app pool identity - network service</p>\n\n<p>\n    \n        \n            \n                \n                    \n                    \n                        \n                        \n                        \n                        \n                    \n                \n            \n        \n        \n        \n        \n            \n            \n                \n                    \n                    \n                    \n                    \n                \n            \n             section enables configuration \n                of the security authentication mode used by \n                ASP.NET to identify an incoming user. \n            -->\n            \n             section enables configuration \n                of what to do if/when an unhandled error occurs \n                during the execution of a request. Specifically, \n                it enables developers to configure html error pages \n                to be displayed in place of a error stack trace.</p>\n\n<pre><code>        &lt;customErrors mode=\"RemoteOnly\" defaultRedirect=\"GenericErrorPage.htm\"&gt;\n            &lt;error statusCode=\"403\" redirect=\"NoAccess.htm\" /&gt;\n            &lt;error statusCode=\"404\" redirect=\"FileNotFound.htm\" /&gt;\n        &lt;/customErrors&gt;\n        --&gt;\n        &lt;pages&gt;\n            &lt;controls&gt;\n                &lt;add tagPrefix=\"asp\" namespace=\"System.Web.UI\" assembly=\"System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n                &lt;add tagPrefix=\"asp\" namespace=\"System.Web.UI.WebControls\" assembly=\"System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n            &lt;/controls&gt;\n        &lt;/pages&gt;\n        &lt;httpHandlers&gt;\n            &lt;remove verb=\"*\" path=\"*.asmx\"/&gt;\n            &lt;add verb=\"*\" path=\"*.asmx\" validate=\"false\" type=\"System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n            &lt;add verb=\"*\" path=\"*_AppService.axd\" validate=\"false\" type=\"System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n            &lt;add verb=\"GET,HEAD\" path=\"ScriptResource.axd\" type=\"System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\" validate=\"false\"/&gt;\n        &lt;/httpHandlers&gt;\n        &lt;httpModules&gt;\n            &lt;add name=\"ScriptModule\" type=\"System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n        &lt;/httpModules&gt;\n    &lt;/system.web&gt;\n    &lt;system.codedom&gt;\n        &lt;compilers&gt;\n            &lt;compiler language=\"c#;cs;csharp\" extension=\".cs\" warningLevel=\"4\" type=\"Microsoft.CSharp.CSharpCodeProvider, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\"&gt;\n                &lt;providerOption name=\"CompilerVersion\" value=\"v3.5\"/&gt;\n                &lt;providerOption name=\"WarnAsError\" value=\"false\"/&gt;\n            &lt;/compiler&gt;\n        &lt;/compilers&gt;\n    &lt;/system.codedom&gt;\n    &lt;!-- \n        The system.webServer section is required for running ASP.NET AJAX under Internet\n        Information Services 7.0.  It is not necessary for previous version of IIS.\n    --&gt;\n    &lt;system.webServer&gt;\n        &lt;validation validateIntegratedModeConfiguration=\"false\"/&gt;\n        &lt;modules&gt;\n            &lt;remove name=\"ScriptModule\"/&gt;\n            &lt;add name=\"ScriptModule\" preCondition=\"managedHandler\" type=\"System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n        &lt;/modules&gt;\n        &lt;handlers&gt;\n            &lt;remove name=\"WebServiceHandlerFactory-Integrated\"/&gt;\n            &lt;remove name=\"ScriptHandlerFactory\"/&gt;\n            &lt;remove name=\"ScriptHandlerFactoryAppServices\"/&gt;\n            &lt;remove name=\"ScriptResource\"/&gt;\n            &lt;add name=\"ScriptHandlerFactory\" verb=\"*\" path=\"*.asmx\" preCondition=\"integratedMode\" type=\"System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n            &lt;add name=\"ScriptHandlerFactoryAppServices\" verb=\"*\" path=\"*_AppService.axd\" preCondition=\"integratedMode\" type=\"System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n            &lt;add name=\"ScriptResource\" preCondition=\"integratedMode\" verb=\"GET,HEAD\" path=\"ScriptResource.axd\" type=\"System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"/&gt;\n        &lt;/handlers&gt;\n    &lt;/system.webServer&gt;\n    &lt;runtime&gt;\n        &lt;assemblyBinding xmlns=\"urn:schemas-microsoft-com:asm.v1\"&gt;\n            &lt;dependentAssembly&gt;\n                &lt;assemblyIdentity name=\"System.Web.Extensions\" publicKeyToken=\"31bf3856ad364e35\"/&gt;\n                &lt;bindingRedirect oldVersion=\"1.0.0.0-1.1.0.0\" newVersion=\"3.5.0.0\"/&gt;\n            &lt;/dependentAssembly&gt;\n            &lt;dependentAssembly&gt;\n                &lt;assemblyIdentity name=\"System.Web.Extensions.Design\" publicKeyToken=\"31bf3856ad364e35\"/&gt;\n                &lt;bindingRedirect oldVersion=\"1.0.0.0-1.1.0.0\" newVersion=\"3.5.0.0\"/&gt;\n            &lt;/dependentAssembly&gt;\n        &lt;/assemblyBinding&gt;\n    &lt;/runtime&gt;\n&lt;/configuration&gt;\n</code></pre></li>\n</ul>\n"},{"tags":["sql","database","sql-server-2008","tsql","self-join"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":12208025,"title":"Fetch rows based on the highest value of a column and criteria on another column","body":"<p>I'm looking for an SQL query that gives a Scr for each user, from the highest Seq, where the Scr is not equal to 0. It is guaranteed that the Seq values are unique for each User.</p>\n\n<p><strong>Sample data:</strong></p>\n\n<pre>\nID  Cde User    Scr Seq\n1   1   James   110 19\n2   1   James   85  20\n3   1   James   99  21\n4   1   James   99  22\n5   1   James   0   23\n6   2   Andrew  88  19\n7   2   Andrew  88  20\n8   2   Andrew  88  21\n9   2   Andrew  0   22\n10  2   Andrew  0   23\n11  3   David   0   19\n12  3   David   95  20\n13  3   David   95  21\n14  3   David   0   22\n15  3   David   0   23\n</pre>\n\n<p><strong>Query results:</strong></p>\n\n<pre>\nID  Cde User    Scr Seq\n4   1   James   99  22\n8   2   Andrew  88  21\n13  3   David   95  21\n</pre>\n"},{"tags":["sql","database","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":10731405,"title":"How can I join these two tables into the same Sql result","body":"<p>I'm trying to generate a SQL query that can join two tables together and return the result .. but the second table is 'flattened'. I'm not sure if that's the correct technical term. Is it denormalized?</p>\n\n<p>Anyways, can someone suggest how I could do this?</p>\n\n<p>Table: <strong>Users</strong></p>\n\n<pre><code>UserId  Name\n1       Pure.Krome\n2       John\n3       Jill\n4       Jane\n</code></pre>\n\n<p>Table: <strong>UserAliases</strong></p>\n\n<pre><code>UserAliasId  UserId  Alias\n1            1       Idiot\n2            1       PewPew\n3            3       BlahBlahBlah\n</code></pre>\n\n<p><strong>Desired results</strong></p>\n\n<pre><code>UserId  Name        Aliases\n1       Pure.Krome  Idiot PewPew\n2       John\n3       Jill        BlahBlahBlah\n4       Jane\n</code></pre>\n\n<p>Please note: </p>\n\n<ul>\n<li>A user does NOT need to have an alias. So that's a zero->many relationship (<code>outer join</code>)</li>\n<li>The delimiter for the flattening of the 2nd table is a SPACE. If an alias has a space, bad luck for me. (Consider it, bad data).</li>\n</ul>\n\n<p>Another example of my problem is to think of a StackOverflow question + tags.</p>\n"},{"tags":["database","sql-server-2008","tsql","join"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":73,"score":2,"question_id":11822522,"title":"Complex SQL Join","body":"<p>I am fairly new to SQL joins, but I have a tricky issue here. I have tried to resolve this on my own, and searched as well, but unsuccessful.  </p>\n\n<p>I have two primary SQL tables </p>\n\n<p><strong>CustProfile</strong>  </p>\n\n<pre><code>ClientID || ClientName \n</code></pre>\n\n<p><strong>CustTransaction</strong>  </p>\n\n<pre><code>CorpID || DivID || DeptID \n</code></pre>\n\n<p>I need to display my output as follows:  </p>\n\n<pre><code>`CorpID` `CorpIDClientName` `DivID` `DivIDName` `DeptID` `DeptIDName`  \n\nCustTransaction.CorpID join on CustProfile.ClientID to get `CorpIDClientName`  \nCustTransaction.DivID join on CustProfile.ClientID to get `DivIDName`  \nCustTransaction.DeptID join on CustProfile.ClientID to get `DeptIDName`  \n</code></pre>\n\n<p>I hope someone can provide the join query. Thanks in advance</p>\n"},{"tags":["sql","database","sql-server-2008","tsql","count"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":117,"score":1,"question_id":12360143,"title":"TSQL Count function and distinct missing NULL values","body":"<p>According to MSDN, the TSQL COUNT(*) function includes any NULL values in the result unless DISTINCT is also used (source: <a href=\"http://msdn.microsoft.com/en-us/library/ms175997.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms175997.aspx</a>)</p>\n\n<p>However, in my query NULL values are being ignored. To test this, I created a small table and filled it with some data:</p>\n\n<pre><code>CREATE TABLE tbl (colA varchar(1), colB varchar(10))\nINSERT tbl VALUES\n('Y', 'test1'),\n('Y', 'test2'),\n(null, 'test3'),\n(null, 'test4'),\n('N', 'test5')\n</code></pre>\n\n<p>I then ran the following 2 queries on it: </p>\n\n<pre><code>SELECT count(*) FROM tbl\nWHERE colA &lt;&gt; 'N'\n</code></pre>\n\n<p>and </p>\n\n<pre><code>SELECT DISTINCT colA FROM tbl\nWHERE colA &lt;&gt; 'N'\n</code></pre>\n\n<p>Both results ignore the NULL values. I get 2 and 'Y' as the results respectively. I'm at a loss to why this is happening. Could someone please clue me in?</p>\n\n<p>Results simulated in SQL Fiddle: <a href=\"http://sqlfiddle.com/#!3/8f00b/9\" rel=\"nofollow\">http://sqlfiddle.com/#!3/8f00b/9</a></p>\n"},{"tags":["sql","sql-server","database","sql-server-2008","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12248899,"title":"How can i concatenate and make a group of text in sql server?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/451415/simulating-group-concat-mysql-function-in-ms-sql-server-2005\">Simulating group_concat MySQL function in MS SQL Server 2005?</a>  </p>\n</blockquote>\n\n\n\n<p>I have a table <strong>tb1</strong>. I want concatenated result set.</p>\n\n<p><img src=\"http://i.stack.imgur.com/60DSY.png\" alt=\"enter image description here\"></p>\n\n<p>Please help me by writing  a query for this problem?</p>\n"},{"tags":["sql-server","database","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":218,"score":0,"question_id":8812733,"title":"Getting a count of each distinct row in SQL Server ","body":"<p>How do I get this statement (which returns duplicates):</p>\n\n<pre><code>  Select Name from Table\n</code></pre>\n\n<p>To return this:</p>\n\n<pre><code>  Select Distinct Name, Count(Number of non-distinct Name rows)\n</code></pre>\n\n<p>?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql","database","sql-server-2008","tsql","reporting-services"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":93,"score":2,"question_id":12241362,"title":"Make single row of multiple rows by appending to the right in SQL Server?","body":"<p>I have a table such as this:</p>\n\n<pre>\nUserID  AddressLine1, AddressLine2, Phone\n1, First Street, Somewhere, 123\n1, Second Street, Somewhere2, 124\n2, 32th Street, Somewhere, 125\n2, 24th Street, Somewhere3, 126\n2, 25th Street, Somewhere4, 127\n</pre>\n\n<p>How do I convert this to (Output needs to have each field in separate column, each comma implies a column de-limiter):</p>\n\n<pre>\n1, First Street, Somewhere, 123, Second Street, Somewhere2, 124\n2, 32th Street, Somewhere, 125, 24th Street, Somewhere3, 126, 25th Street, Somewhere4, 127</pre>\n\n<p>This is for a report i am doing in SSRS.  Each user can have a dynamic number of addresses and they all need to be on a single row per user in the end result.</p>\n"},{"tags":["sql","database","windows","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":104,"score":4,"question_id":12593492,"title":"SQL Server : max date and inner join","body":"<p>I have two tables, one is a list of tasks. The other containing historical values for those tasks.</p>\n\n<p>I need to generate a list of the latest event (and its description) for each check, as long as long as its <code>Date_Executed</code> is less than the current datetime minus the <code>Timeframe</code> (<code>TimeFrame</code> being hours within the task has to be done, formatted for use in <code>DATEADD</code>). But only if they have an <code>active = 1</code>. </p>\n\n<p>Table: <strong>checks</strong></p>\n\n<pre><code>Check_id  description  TimeFrame active\n1         Task One     -24       0\n2         Task Two     -24       0\n3         Task Forty   -48       1\n4         Task Somehin -128      1\n</code></pre>\n\n<p>Table: <strong>events</strong></p>\n\n<pre><code>Event_id  Check_id   Comment     Date_Executed             User_Executed\n1         1          NULL        2012-09-18 16:10:44.917   admin\n2         1          NULL        2012-09-25 11:39:01.000   jeff\n3         4          Failed      2012-09-25 13:20:09.930   steve\n4         4          Half failed 2012-09-25 13:05:09.953   marsha\n5         2          NULL        2012-09-25 14:02:24.000   marsha\n6         3          NULL        2012-09-18 16:10:55.023   marsha\n</code></pre>\n\n<p>The best solutions I have so far is:</p>\n\n<pre><code>SELECT \n    a.[Date_Executed]\n    a.[Check_id], \n    a.[Comments],\n    b.[frequency], \n    b.[Check_id],\n    b.[description]     \nFROM \n    [checksdb].[dbo].events as a, \n    [checksdb].[dbo].checks as b\nwhere \n    b.active = 1\n    and a.[Date_Executed] &lt; = dateadd(HOUR,b.[frequency],GETDATE())\n    and a.Check_id = b.Check_id\norder by Check_id, priority\n</code></pre>\n\n<p>and</p>\n\n<pre><code>select MAX(date_Executed), Task_id from daily_check_events group by Task_id\n</code></pre>\n\n<p>Neither of which gets me what I need, I could really use some help.</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008","tsql"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":73,"score":4,"question_id":12634436,"title":"How to get the latest row from table using JOIN","body":"<p>I have a join of 5 tables to get the tasks posted by each member having about 15 columns. But for sample code I have taken just two tables of them. </p>\n\n<pre><code>SELECT TOP 5 \n    dbo.MemberMst.MemberID, dbo.MemberMst.fname, \n    dbo.TaskMst.TaskMstID, dbo.TaskMst.OnDate, dbo.TaskMst.Description\nFROM   \n    dbo.MemberMst \nLEFT JOIN\n    dbo.TaskMst ON dbo.MemberMst.MemberID = dbo.TaskMst.MemberID\n</code></pre>\n\n<p>Output is:</p>\n\n<pre><code>MemberID fname  TaskMstID    OnDate                   Description\n3    Ursula     NULL         NULL                      NULL\n84   Opeyemi    30           2012-09-18 00:00:00.000     asd\n85   test       21           2012-09-18 10:30:46.900     aaa\n85   test       22           2012-09-18 10:31:04.967     eeee\n85   test       23           2012-09-18 10:31:26.640     vvvv\n</code></pre>\n\n<p>Here in above query I get 3 rows for <code>MemberID=85</code> who posted 3 tasks but I need only one task from that member which is the latest. How to get the latest task posted by a member so that result would be:-</p>\n\n<pre><code>MemberID fname  TaskMstID OnDate                Description\n3    Ursula     NULL      NULL                   NULL\n84   Opeyemi    30        2012-09-18 00:00:00.000   asd\n85   test       23        2012-09-18 10:31:26.640   vvvv\n</code></pre>\n\n<p>I mean to say just only one record for each <code>memberID</code> having tasks?</p>\n\n<p>Help appreciated..!</p>\n\n<p>Thanks in advance...!</p>\n"},{"tags":["sql","database","oracle","sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":100,"score":1,"question_id":12559551,"title":"SQL Server equivalent of WM_CONCAT function","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1621747/concat-field-value-to-string-in-sql-server\">Concat field value to string in SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>What is the SQL Server equivalent of WM_CONCAT?</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12624382,"title":"SQL Server : join and append columns","body":"<p>I have a SQL question, and hope someone could help me or give me some pointers. Much appreciated.</p>\n\n<p>I have two tables: A and B.</p>\n\n<ul>\n<li>A has columns <code>ID</code> which is the primary key field, and <code>NAME</code></li>\n<li>B has columns <code>DUPID</code>, <code>NAME</code> and <code>ID</code> which is the primary key </li>\n</ul>\n\n<p>The relationship between A and B is in B, the <code>DUPID</code> contains certain values of <code>A.ID</code>, and the request is to append distinct <code>B.NAME</code> value to <code>A.NAME</code> separated by semi-colon based on join <code>A.ID = B.DUPID</code>.. </p>\n\n<p>Maybe my explanation isn't clear, here is a simple example.</p>\n\n<pre><code>A                                  B\nID  NAME                           DUPID      NAME\n1   null                            1             John\n2   null                            1             John\n3   null                            1             Mark\n4   null                            3             Luke\n5   null                            3             Luke\n                                    3             Luke\n                                    3             Matthew\n</code></pre>\n\n<p>So eventually, I will need to update table A, and make it look like below</p>\n\n<pre><code>A\nID      NAME\n1        John;Mark\n2        null\n3        Luke;Matthew\n4        null\n5        null\n</code></pre>\n"},{"tags":["sql","sql-server","database","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":48,"score":3,"question_id":12542864,"title":"SQL SVR 08 R2 Limit a field to specific values","body":"<p>For example, say I have field 'Gender' and I want to allow only the values Male, Female or Unisex. Is this possible in the SQL server management studio? </p>\n\n<p>Update: So far the solution is pointing towards the 'Check constraints' function which can be found by right-clicking on the desired column.</p>\n\n<p>Still, I'm getting syntax errors. Any thoughts on how I should type up the constraint?</p>\n\n<p>Answer: Turns out I just needed to type it likes this </p>\n\n<pre><code>Gender = 'Male' OR Gender = 'Female' OR Gender = 'Unisex'\n</code></pre>\n"},{"tags":["sql","sql-server-2008","query","tsql","join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":180,"score":0,"question_id":11714915,"title":"FULL OUTER JOIN vs. FULL JOIN","body":"<p>Just playing around with queries and examples to get a better understanding of joins.  I'm noticing that in SQL Server 2008, the following two queries give the same results:</p>\n\n<pre><code>SELECT * FROM TableA\nFULL OUTER JOIN TableB\nON TableA.name = TableB.name\n</code></pre>\n\n<hr>\n\n<pre><code>SELECT * FROM TableA\nFULL JOIN TableB\nON TableA.name = TableB.name\n</code></pre>\n\n<p>Are these performing exactly the same action to produce the same results, or would I run into different results in a more complicated example?  Is this just interchangeable terminology?</p>\n"},{"tags":[".net","sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":10953014,"title":"Capturing MS SQL output","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/8689336/how-can-i-display-the-output-of-sql-print-command-in-c\">How Can i display the output of SQL &ldquo;PRINT&rdquo; Command in C#?</a>  </p>\n</blockquote>\n\n\n\n<p>I have SQL statement that generates another SQL statement by outputting it via PRINT command.  Right now I have to manually run it in SQL editor, copy the resulting string query and run that query in different window. </p>\n\n<p>I'd like to automate that using a .NET console app.  Is it possible to capture the PRINT statement output in .NET? Is there another way to capture SQL PRINT output?</p>\n"},{"tags":["sql-server","sql-server-2008","schema"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12632608,"title":"Safe/reliable/standard process for making major changes to a database with existing data?","body":"<p>I would like to take one table that is heavy with flags and fields, and break it into smaller tables.  The parent table to be revised/broken down already contains live data that must be handled with care.</p>\n\n<p>Here is my plan of attack, that I'm hoping to execute this weekend while no one is using the systsem.</p>\n\n<ol>\n<li>Create the new tables that we will need</li>\n<li>Rename the existing parent table, ParentTable, to ParentTableOLD</li>\n<li>Create a new table called ParentTable with the unneeded fields gone, and new fields added</li>\n<li>Run a procedure to copy the entries in ParentTableOLD to the new tables, mapping old data to new tables/fields where applicable</li>\n<li>Delete the ParentTableOLD table</li>\n</ol>\n\n<p>The above seems pretty reasonable and simple to me, I'm fairly certain it will work.  I'm interested in other techniques to achieve this (the above is the only thing I can think of), as well as any kind of tools to help stay organized.  Right now I'm running on pen and paper.</p>\n\n<p>Reason I ask is that several times now, I've been re-inventing the wheel just because I didn't know any better, and someone more experienced came along and saw what I was doing and said, \"oh there's a built-in way to help do this,\" or, \"there's a simpler way to do this.\"  I did coding for months and months with Visual Studio before someone stopped by and said \"you know about breakpoints to step through the code, yeah?\" --- life changing, hah.</p>\n\n<p>I have SQL Server 2008 R2 with SSMS.</p>\n"},{"tags":["html","sql","sql-server-2008","query","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12627676,"title":"Passing Html tag in Update query","body":"<p>There is an existing table in database where I want to update one column. If I right click on the table--->select edit 200 rows and try to edit the cell data it says that the cell is read-only. I am using SQL management studio 2008R2. \nSo I was trying to update it using an update Query but I am pretty new to the SQL queries and the whole database thing. Is this the proper way to pass an HTML tag in queries?</p>\n\n<pre><code>UPDATE OutputTemplate\n  SET emailText='(&lt;p&gt;Thank you for your  gift of {Amount} to the {CommunityName}&lt;/p&gt;&lt;br /&gt;Support &amp; Charity Campaign.&lt;br /&gt;\n --------------------------------------------\n ---          Transaction Detail          ---\n --------------------------------------------\n &lt;span&gt;Credit Card Details&lt;/span&gt; \n &lt;span style=\"text-decoration: underline;\"&gt;Personal Info Details &amp; Amount&lt;/span&gt;)'\n WHERE id='2'\n</code></pre>\n\n<p>It's showing some parsing error, incorrect syntax while executing the query.</p>\n\n<p>Sorry to ask such a basic question but I tried to google it, unfortunatelly nothing showed up useful.</p>\n\n<p>Thanks </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12644320,"title":"Record in dm_exec_cached_plans but not in dm_exec_query_stats","body":"<p>I am trying to identify how many times a proc has been executed.</p>\n\n<p>When I search by plan handle, I find a record in dm_exec_cached_plans but not in dm_exec_query_stats.  All of the documentation I can find indicates that if a record is in  dm_exec_cached_plans then it should always have a corresponding record in  dm_exec_query_stats.  </p>\n\n<p>Does anyone know a scenario where this would not be true?</p>\n"},{"tags":["sql-server-2008","index"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12648882,"title":"sql server does deleting column rebuild index?","body":"<p>Anyone know what happens to the index when I drop a column from a table?</p>\n\n<p>Does SQL Server rebuild that index? What if it's a clustered index?</p>\n\n<p>I have a 150 million row table, and I need to drop a column. Will this rebuild the table if it's ordered as a clustered index? Or does the index just understand that one of its columns are dropped?</p>\n"},{"tags":["sql-server","database","sql-server-2008","design","san"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":12649589,"title":"Shared volume for data (multiple MDF) and another shared volume for logs (multiple LDF) on SAN","body":"<p>I have 3 instances of SQL Server 2008, each on different machines with multiple databases on each instance. I have 2 separate LUNS on my SAN for MDF and LDF files. The NDX and TempDB files run on the local drive on each machine. Is it O.K. for the 3 instances to share a same volume for the data files and another volume for the log files? </p>\n\n<p>I don't have thin provisioning on the SAN so I would like to not constaint disk space creating multiple volumes because I was adviced that I should create a volume (drive letter) for each instance, if not for each database. I am aware that I should split my logs and data files at least. No instance would share the actual database files, just the space on drive.</p>\n\n<p>Any help is appretiated.</p>\n"},{"tags":["sql-server-2008","stored-procedures","sqlgeography"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":11606230,"title":"Get position from geography column","body":"<p>I'm migrating a table containing geographic information as latitude, longitude, to one using a geography column (in SQL server 2008).</p>\n\n<p>I need to update a stored procedure which returns those values.  </p>\n\n<p>I can do this:</p>\n\n<pre><code>DECLARE @geog geography;\nSET @geog = (SELECT [geography] FROM MyTable);\n\nSELECT @g.STAsText();\n</code></pre>\n\n<p>but the signature for the SP, which I don't want to change, requires this:</p>\n\n<pre><code>@latitude [float] OUTPUT,\n@longitude [float] OUTPUT\n</code></pre>\n\n<p>How do I get the right values, as floats?  </p>\n\n<p>I can use <a href=\"http://sqltutorials.blogspot.com.au/2007/09/sql-function-split.html\" rel=\"nofollow\">http://sqltutorials.blogspot.com.au/2007/09/sql-function-split.html</a> or similar, but surely this shouldn't be that convoluted?</p>\n\n<p>Thanks\nMelanie</p>\n"},{"tags":["sql","sql-server","sql-server-2008","variables","string-concatenation"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":172,"score":2,"question_id":12639948,"title":"SQL NVARCHAR and VARCHAR Limits","body":"<p>All, I have a large (unavoidable) dynamic SQL query. Due to the number of fields in the selection criteria the string containing the dynamic SQL is growing over 4000 chars. Now, I understand that there is a 4000 max set for <code>NVARCHAR(MAX)</code>, but looking at the executed SQL in Server Profiler for the statement </p>\n\n<pre><code>DELARE @SQL NVARCHAR(MAX);\nSET @SQL = 'SomeMassiveString &gt; 4000 chars...';\nEXEC(@SQL);\nGO\n</code></pre>\n\n<p>Seems to work(!?), for another query that is also large it throws an error which is ascociated with this 4000 limit(!?), it basically trims all of the SQL after this 4000 limit and leaves me with a syntax error. Dispite this in the profiler it is showing this dynamic SQL query in <strong>full</strong>(!?). </p>\n\n<p>Whay exactly is happening here and should I just be converting this @SQL variable to VARCHAR and get on with it?</p>\n\n<p>Thanks for your time.</p>\n\n<p>Ps. It would also be nice to be able to print out more than 4000 chars to look at these big queries. The following are limited to 4000 </p>\n\n<pre><code>SELECT CONVERT(XML, @SQL);\nPRINT(@SQL);\n</code></pre>\n\n<p>is there anyother cool way?</p>\n"},{"tags":["sql-server","sql-server-2008","proxy","migration","sybase"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12253223,"title":"Create table that invokes a stored procedure in SQL Server 2008","body":"<p>I'm migrating SPs from Sybase to SQL Server and I have a case where they use \"proxy tables\" which are used to internally invoke a SP whenever they are used in a query... </p>\n\n<p>The syntax used to create the proxy table is something like this:</p>\n\n<pre><code>USE myDatabase\ngo\nsp_addobjectdef proxy_table_name, 'loopback.myDatabase..sp_name', 'rpc'\ngo\nCREATE EXISTING TABLE proxy_table_name\n(\n    col1       int NOT NULL,\n    col2       char(2) NOT NULL,\n    col3       varchar(20) NOT NULL,\n    _id_sp     int NULL\n)\nLOCK ALLPAGES\ngo\n</code></pre>\n\n<p>And the SP definition something like this:</p>\n\n<pre><code>CREATE procedure sp_search_intermediary_agent\n(\n      @param_default_1      char(1)  = 'N',  \n      @param_default_2      bit      = 0, \n      @i_id_query           int \n)\nas\nbegin\n........ (some code here)\n\n\n  select col1, col2, col3 from table_where_data_is \n  where  id_table = @i_id_query\n  return 0\nend\ngo\n</code></pre>\n\n<p>And the proxy table is used within the query as if it were a normal table...</p>\n\n<pre><code>select col1, col2, col3,....\nfrom  table_1, proxy_table_name\nwhere table_1.id_field = proxy_table_name._id_sp\n</code></pre>\n\n<p>Please, any ideas about how to migrate this \"proxy tables\" to SQL Server 2008?? </p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":127,"score":1,"question_id":12268566,"title":"SQL map a login to an existing user","body":"<p>I have recently upgraded my development environment from SQL 2000 to SQL 2008 R2.  I've done a backup of our production db and restored it our new dev server.</p>\n\n<p>I have created  a login on the dev server which mirrors the login I use on the production server, but I can't get it mapped to the 'dbo' user in the database.  When I edit the properties of the login in 'User Mapping\",  I replace the user with 'dbo',  and I get the following error:</p>\n\n<blockquote>\n  <p>TITLE: Microsoft SQL Server Management Studio Create failed for User\n  'dbo'.  (Microsoft.SqlServer.Smo) An exception occurred while\n  executing a Transact-SQL statement or batch.\n  (Microsoft.SqlServer.ConnectionInfo) User, group, or role 'dbo'\n  already exists in the current database. (Microsoft SQL Server, Error:\n  15023)</p>\n</blockquote>\n\n<p>So how do I map a login to an existing user?</p>\n"},{"tags":["java","sql-server-2008","hibernate"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":104,"score":3,"question_id":12645258,"title":"Getting dynamically generated column names from result of Hibernate native query","body":"<p>I'm executing stored procedure with Hibernate native method, this stored procedure creates column names depending on another table Ids. So its columns look like something like this:</p>\n\n<blockquote>\n  <p>| id | ... some other columns ... | name | c_1 | c_2 | c_4 | c_.. |</p>\n</blockquote>\n\n<p>If I call <code>Query.getResultList()</code>  it returns <code>List&lt;Object[]&gt;</code>, and I don't know column names. I have to know column names (and corresponding column index) to continue my further business logic. I also cannot use <code>EntityManager.createNativeQuery(String s, Class aClass)</code> since it is not one POJO class. </p>\n\n<p>Currently I'm getting <code>List&lt;Object[]&gt;</code> without problem, but I need, for example, <code>Map&lt;String,Object[]&gt;</code>  column name as a key and column values as an array of Objects.</p>\n\n<p>How can I get all column names with their values?</p>\n"},{"tags":["c#","sql-server-2008","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12650861,"title":"Entity Framework won't update newly added properties of an entity","body":"<p>I've just added few more properties to one of my entities, and now I cannot update them.</p>\n\n<p>Here is a snippet of my code:</p>\n\n<pre><code>Artikal art = db.Artikli.First();            \nart.Image = picbyte;\nart.BarcodeType = \"UAC\";\nart.Model = \"RayBan\";\nart.StrProperty1 = \"aaaa\";\nart.StrProperty2 = \"bbbb\";\nart.StrProperty5 = \"cccc\";\ndb.SaveChanges();\n</code></pre>\n\n<p><code>Image</code>, <code>Model</code> and <code>StrProperty5</code> are newly added fields, while the rest are\"old\".</p>\n\n<p>This is what I captured via profiler:</p>\n\n<pre><code>exec sp_executesql N'update [dbo].[Artikli]\nset [StrProperty1] = @0, [StrProperty2] = @1, [BarcodeType] = @2\nwhere ([IdArtikal] = @3)\n',N'@0 nvarchar(256),@1 nvarchar(256),@2 nvarchar(16),@3 int',@0=N'aaaa',@1=N'bbbb',@2=N'UAC',@3=1\n</code></pre>\n\n<p>So EF doesn't even try to update those \"new\" properties.</p>\n\n<p>I just added properties, Model First, Update Database from Model, as I have done many times before.</p>\n\n<p>What could have gone wrong? How do I fix this?</p>\n"},{"tags":["sql-server-2008","tsql","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12650944,"title":"How to insert value from stored procedure to variable in function in SQL Server","body":"<p>I have a stored procedure which returns a value (ex: <code>GetData</code>)</p>\n\n<p>How can I declare a variable in another function to get this value?</p>\n\n<p>Something like this</p>\n\n<pre><code>Create Function Test\nReturn Int\nBegin\n    Declare @data My_Data_Type\n    Declare @count int\n    SET @data = exec GetData\n    Select @count = count(*)\n    From @data\n\n    Return @count\nEnd\n</code></pre>\n\n<p>Please help me !!!!</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","service-broker"],"answer_count":5,"favorite_count":5,"up_vote_count":15,"down_vote_count":0,"view_count":1673,"score":15,"question_id":507721,"title":"Is anyone using the Service Broker in SQL Server?","body":"<p>When I attended a presentation of SQL Server 2008 at Microsoft, they did a quick gallup to see what features we were using. It turned out that in the entire lecture hall, my company was the only one using the Service Broker. This surprised me a lot, as I thought that more people would be using it.</p>\n\n<p>My experience with SB is that it does it's job well, but is pretty tough to administer and it's hard to get an overview. </p>\n\n<p>So, have you considered using the Service Broker? If not, why not? Did you go for MSMQ instead? Is there anything in SQL Server 2008 that would make you consider using the Service Broker.</p>\n"},{"tags":["sql","sql-server-2008","ssms"],"answer_count":3,"favorite_count":5,"up_vote_count":24,"down_vote_count":0,"view_count":17838,"score":24,"question_id":4673065,"title":"ALTER DATABASE failed because a lock could not be placed on database","body":"<p>I need to restart a database because some processes are not working. My plan is to take it offline and back online again.</p>\n\n<p>I am trying to do this in Sql Server Management Studio 2008:</p>\n\n<pre><code>use master;\ngo\nalter database qcvalues\nset single_user\nwith rollback immediate;\nalter database qcvalues\nset multi_user;\ngo\n</code></pre>\n\n<p>I am getting these errors:</p>\n\n<pre><code>Msg 5061, Level 16, State 1, Line 1\nALTER DATABASE failed because a lock could not be placed on database 'qcvalues'. Try again later.\nMsg 5069, Level 16, State 1, Line 1\nALTER DATABASE statement failed.\nMsg 5061, Level 16, State 1, Line 4\nALTER DATABASE failed because a lock could not be placed on database 'qcvalues'. Try again later.\nMsg 5069, Level 16, State 1, Line 4\nALTER DATABASE statement failed.\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["c#",".net","sql-server-2008","accounting"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12648173,"title":"Handling empty cells in DataGridView","body":"<p>How do I handle empty cell values in a DataGridView where I have 3 columns(Account Title, Debit, Credit), the first column the user chooses an account, then inputs either the Debit or Credit column, thus leaving an empty cell in every row. I have 3 tables involved for a single entry.</p>\n\n<pre><code>create table Debit (debit_id, amount, **acct_id, entry_id);\ncreate table Credit (credit_id, amount, **acct_id, entry_id);\ncreate table Entry (entry_id, date);\n</code></pre>\n\n<p>Basically I want it to look like <a href=\"http://www.edisonsattic.com/articles/images/QBTrust1/2.gif\" rel=\"nofollow\">this</a>. What I've done so far is joined those 3 tables</p>\n\n<pre><code>SELECT  Entry.entry_id, Entry.Date, Debit.acct_id, Debit.amount, \nCredit.acct_id, Credit.amount FROM Entry FULL OUTER JOIN Debit\nON Entry.entry_id = Debit.entry_id FULL OUTER JOIN Credit\nON Entry.entry_id = Credit.entry_id\n</code></pre>\n\n<p>Having 6 columns in the DataGridView. I still haven't thought of a query to show only 3 columns where the Debit and Credit accounts are in one column and the amount on their appropriate column, and if there was how does it handle the empty cells on the column for Debit and Credit What I've done works but usability wise it's not good.</p>\n\n<p>Can you suggest of ways for me to do this.</p>\n\n<p>** Account table</p>\n"},{"tags":["sql-server-2008","collation"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":8656,"score":1,"question_id":7428685,"title":"how to change server collation in SQL Server 2008 R2","body":"<p>how do I change the server collation setting from 'Chinese_PRC_CI_AS' to 'Latin1_General_CI_AS'?</p>\n"},{"tags":["sql-server-2008","tsql","function","reporting-services"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":12639163,"title":"Cannot resolve the collation conflict","body":"<p>I am getting the following error message.</p>\n\n<blockquote>\n  <p>Cannot resolve the collation conflict between \"Latin1_General_CI_AI\" and \"SQL_Latin1_General_CP1_CI_AS\" in the equal to operation.</p>\n</blockquote>\n\n<p>I only get it when I place this code below in my WHERE clause.</p>\n\n<pre><code>WHERE Region IN (SELECT Token FROM dbo.getParmsFromString(@Region))\n</code></pre>\n\n<p>Now @Region contains all the values from my multi-select fields from SSRS.</p>\n\n<p>Below is the code for the function that is used.</p>\n\n<pre><code>CREATE FUNCTION [dbo].[getParmsFromString]\n    (@String VARCHAR(MAX))\nRETURNS @Parms TABLE\n(\n    Token VARCHAR(MAX)\n)\nAS\nBEGIN\n    IF CHARINDEX(',', @String) != 0\n    BEGIN\n        ;WITH cte0(Token, List) AS\n              (\n                SELECT   SUBSTRING(@String, 1, CHARINDEX(',',@String,1) - 1)\n                        ,SUBSTRING(@String,CHARINDEX(',',@String,1) + 1, LEN(@String)) + ','\n\n                UNION ALL\n\n                SELECT     SUBSTRING(List,1,ISNULL(CHARINDEX(',',List,1) - 1,1))\n                        ,SUBSTRING(List,CHARINDEX(',',List,1) + 1, LEN(List))\n                FROM cte0\n                WHERE LEN(cte0.List) &gt; 0\n              )\n\n            INSERT INTO @Parms (Token)\n            SELECT Token\n            FROM cte0\n            OPTION (MAXRECURSION 0)\n        RETURN;\n    END\n\n    ELSE\n        INSERT INTO @Parms\n            SELECT @String\n        RETURN;\nEND\n</code></pre>\n"},{"tags":[".net","sql-server-2008","compatibility"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12646786,"title":"Backward Compatibility in Windows Forms App built on .NET 4","body":"<p>I have built an application using c# on .NET. My software will run on PCs having XP SP3 to Win 7. I did my research in deciding which version of .NET to use for development. Microsoft website clearly says that .NET 4 apps can run on XP SP3. I trusted them, built the app till a month where its halfway, I just had a test deployment &amp; boooooom. Its not even starting up &amp; gives errors that not all components required are installed. I researched and SQL Server 2008 couldnt be installed.</p>\n\n<p>I've done the following:\n- Tried to install .NET 4 on XP SP3. Gets installed easily. BUT SQL Server express 2008 (which my app uses) couldnt be installed, it says to install .NET 2\n- IF I install .NET 2, I am not sure whether the app will run on Windows 7.</p>\n\n<p>Please Help. My Client will kill me !</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":12645840,"title":"TSQL Self Join: Exclude consecutive ID records having set criteria","body":"<p>I have a table as below:</p>\n\n<pre><code>ID, DATE, STATUS\n1, 01JAN2012, STOP\n1, 04JAN2012, RESTART\n2, 01JAN2012, STOP-1\n3, 10JAN2012, STOP\n4, 15JAN2012, RESTART\n5, 01JAN2012, STOP-1\n5, 04JAN2012, STOP-2\n5, 10JAN2012, STOP\n5, 15JAN2012, RESTART\n</code></pre>\n\n<p>Expected Output:</p>\n\n<pre><code>ID, DATE, STATUS\n2, 01JAN2012, STOP-1\n3, 10JAN2012, STOP\n4, 15JAN2012, RESTART\n5, 01JAN2012, STOP-1\n5, 04JAN2012, STOP-2\n</code></pre>\n\n<p>I want a SELECT statement to exclude all records with same ID having (STATUS='RESTART') and one consecutive previous record, if available. </p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12646091,"title":"Cannot find created Schema in SQL","body":"<p>I created a schema using just</p>\n\n<pre><code>CREATE SCHEMA Company\n</code></pre>\n\n<p>When i re rxecute this query </p>\n\n<blockquote>\n  <p>There is already an object named 'Company' in the database.</p>\n</blockquote>\n\n<p>Error occurs but i cannot find my schema in the object explorer. I am also unable to </p>\n\n<pre><code>use [Company]\n</code></pre>\n\n<p>Because the server cannot find it . </p>\n\n<h2>What should i do to create a schema which appers in the database . And how do i delete,find or use this one ?</h2>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12644312,"title":"Could not locate file 'mydatabase' for database 'mydatabase' in sys.database_files. The file either does not exist, or was dropped","body":"<p>dbcc shrinkfile('mydatabase',113311) fails with following error</p>\n\n<p>Could not locate file 'mydatabase' for database 'mydatabase' in sys.database_files. The file either does not exist, or was dropped</p>\n\n<p>Its failing once in while randomly. I have nightly task that executes dbcc shrinkfile. Works fine most of the time. There is no problem with logical file name etc...\nmy logical file name is 'mydatabase'. I have verified my logical name using below queries.</p>\n\n<p>DBCC FILEHEADER (mydatabase)</p>\n\n<p>select * from mydatabase.dbo.sysfiles </p>\n\n<p>Select * from master..sysaltfiles</p>\n\n<p>This is really strange as i could't find any root cause. SQL 2008R2 SP2</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12645748,"title":"How to put multiple line data in Text column for SQL Server 2008?","body":"<p>In SQL Server 2008, I create a table with a column(text). Then I want to put kind of formated data in in this column, for example more than one line like:</p>\n\n<pre><code>Line 1\nLine 2\nLine 3\n</code></pre>\n\n<p>If I copy and paste above data into the column, only first line data saved in the column. How to resolve this issue for both code and manual input(like MSSMS)?</p>\n"},{"tags":["asp.net","sql","vb.net","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12631859,"title":"Show HTML from SQL Cell in AutoGeneratedColumns","body":"<p>Ive been banging my head against the wall for the last few hours, I just cant seem to view the HTML markup from a SQL Cell in a GridView.</p>\n\n<p>When I set the AutoGenerateColumns=False it's easy because I can set the boundfield property in the DataGird ASP.Net markup. However, I can't seem to do anything with the gridview if the AutoGenerate is turned on.</p>\n\n<p>Here is my vb code:</p>\n\n<pre><code>      Dim sqlcmd As String = \"Select [Bugs:], [QC#:] FROM \" &amp; \"\"\"\" &amp; datasource &amp; \"\"\"\" &amp; Extra\n    Using con As New System.Data.SqlClient.SqlConnection(connexstring)\n        con.Open()\n            Dim da = New SqlDataAdapter(sqlcmd, con)\n            Dim ds = New DataSet()\n            da.Fill(ds)\n            Gridview1.DataSource = ds\n            da.Dispose()\n            ds.Dispose()\n        con.Close()\n    End Using\n    GenTables(gen)\n    Dbind()\n</code></pre>\n\n<p>I have html markup in the both columns that I need to show up.</p>\n\n<p>Here is my Gridview:</p>\n\n<pre><code>      &lt;asp:GridView ID=\"GridView1\" runat=\"server\" \n        EmptyDataText=\"There are no data records to display.\" \n          BackColor=\"White\" BorderColor=\"#999999\" BorderWidth=\"1px\" \n        CellPadding=\"3\" ForeColor=\"Black\" GridLines=\"Vertical\" BorderStyle=\"Solid\" \n        Visible=\"False\" AutoGenerateEditButton=\"True\"&gt;\n        &lt;AlternatingRowStyle BackColor=\"#CCCCCC\" /&gt;\n        &lt;Columns&gt;\n        &lt;/Columns&gt;\n        &lt;FooterStyle BackColor=\"#CCCCCC\" /&gt;\n        &lt;HeaderStyle BackColor=\"Black\" Font-Bold=\"True\" ForeColor=\"White\" /&gt;\n        &lt;PagerStyle BackColor=\"#999999\" ForeColor=\"Black\" \n            HorizontalAlign=\"Center\" /&gt;\n        &lt;SelectedRowStyle BackColor=\"#000099\" ForeColor=\"White\" Font-Bold=\"True\" /&gt;\n        &lt;SortedAscendingCellStyle BackColor=\"#F1F1F1\" /&gt;\n        &lt;SortedAscendingHeaderStyle BackColor=\"#808080\" /&gt;\n        &lt;SortedDescendingCellStyle BackColor=\"#CAC9C9\" /&gt;\n        &lt;SortedDescendingHeaderStyle BackColor=\"#383838\" /&gt;\n    &lt;/asp:GridView&gt;\n</code></pre>\n\n<p>Does anyone have any idea how to allow the gridview cell to show html after the columns have already been generated?</p>\n\n<p>Thanks,\nZach</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12645035,"title":"Use SELECT results as a variable in a loop","body":"<p>I've searched here and elsewhere, and haven't found an answer yet. Hope I didn't miss it.</p>\n\n<p>Using SQL Server Management Studio 2008 R2.</p>\n\n<p>I have n specific databases on my server (there are other DBs as well, but I'm only interested in some of them)  </p>\n\n<p>Each of these databases has a table within it, which all have the same name. The only difference is the DB name. I want to aggregate these tables together to make one big table on a different database (different to the other DBs).</p>\n\n<p>I can get the db names from the results of a query.</p>\n\n<p>N is unknown.</p>\n\n<p>Is a loop the way to go about this?  </p>\n\n<p>I was thinking something along the lines of the following pseudocode:</p>\n\n<pre><code>Set @dbnames = SELECT DISTINCT dbname FROM MyServer.dbo.MyTable\n\nFor each @name in @dbnames\n    INSERT INTO ADifferentDB.dbo.MyOtherTable\n    SELECT * FROM @name.dbo.table\nNext name\n</code></pre>\n\n<p>(Clearly I'm new to using SQL variable as well, as you can see)</p>\n"},{"tags":["database","sql-server-2008","hibernate","varcharmax"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":235,"score":2,"question_id":11039552,"title":"SQL Server field getting truncated","body":"<p>Ok I'm using SQL Server 2008 and have a table field of type <code>VARCHAR(MAX)</code>.  Problem is that when saving information using <code>Hibernate</code>, the contents of <code>VARCHAR(MAX)</code> field is getting truncated.  I don't see any error messages on either the app server or database server.</p>\n\n<p>The content of this field is just a plain text file.  The size of this text file is 383KB.</p>\n\n<p>This is what I have done so far to troubleshoot this problem:</p>\n\n<ol>\n<li><p>Changed the database field from <code>VARCHAR(MAX)</code> to TEXT and same\nproblem occurs.</p></li>\n<li><p>Used the SQL Server Profiler and I noticed that the full text\ncontent is being<br>\n    received by the database server, but for some reason the profiler freezes when trying \n    to view the SQL with the truncation problem.  Like I said, just before it freezes, I<br>\n    did noticed that the full text file content (383KB) are being received, so it seems\n    that it might be the database problem.</p></li>\n</ol>\n\n<p>Has anyone encountered this problem before? Any ideas what causes this truncation?</p>\n\n<p>NOTE: just want to mention that I'm just going into SQL Studio and just copying the TEXT field content and pasting it to Textpad. That's how I noticed it's getting truncated.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["database","sql-server-2008","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12644506,"title":"How to select entries that are back to back?","body":"<p>How would I select <code>c_user_id</code> who have made back to back entries in a SQL Server 2008 database ?  </p>\n\n<p>Preferably people who have made more than 3 back to back entries like <code>pras.chla@gmail.com</code> below (sorting by <code>c_id desc</code> and <code>c_id</code> is an identity column)</p>\n\n<pre><code>c_id    c_user_id             c_entry\n1427    xermadr.asdf@me.com   155575\n1426    pras.chla@gmail.com   155829\n1425    pras.chla@gmail.com   155826\n1424    pras.chla@gmail.com   155828\n1423    pras.chla@gmail.com   155830\n1422    sdfe.qqol@gmail.com   155559 \n</code></pre>\n\n<p>thanks again ?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12644414,"title":"@@ERROR - How to process / evaluate in TSQL?","body":"<p>This update will fail as ID is Identity </p>\n\n<p>But I am getting direct error message.<br>\nI am getting none of the PRINT statements.</p>\n\n<p>How do I use @@ERROR?<br>\nUsing SSMS.<br>\nWould you call this a script or a query?  </p>\n\n<pre><code>PRINT   'start';\nDECLARE @ErrorVal INT;\nUPDATE IndenText SET ID = 7;\nSELECT @ErrorVal = @@ERROR;\nPRINT @ErrorVal;\nIF @ErrorVal &lt;&gt; 0\nBEGIN\n    PRINT N'A error caught.';\nEND\nPRINT 'done';\n</code></pre>\n\n<p>This also does not work from me</p>\n\n<pre><code>PRINT   'start';\nDECLARE @ErrorVal INT;\nBEGIN TRY\n    UPDATE IndenText SET ID = 7;\n    SELECT @ErrorVal = @@ERROR;\n    PRINT @ErrorVal;\nEND TRY\nBEGIN CATCH\n    IF @@ERROR &lt;&gt; 0\n    BEGIN\n        PRINT N'A error caught.' + @@ERROR;\n    END\nEND CATCH\nPRINT 'done';\n</code></pre>\n\n<p>I get<br>\nMsg 8102, Level 16, State 1, Line 4 \nCannot update identity column 'ID'. </p>\n\n<p>As Martin stated it was a compile error.<br>\nCreated a constraint that would not be a compile error.<br>\nAnd got the @@ERROR to process.</p>\n\n<pre><code>PRINT   'start';\nDECLARE @ErrorVal INT;\nDECLARE @newVal INT;\nselect  @newVal = -1;\nBEGIN TRY\n    update Twaste1 set ID = @newVal ;\n    PRINT 'End Try';\nEND TRY\nBEGIN CATCH\n    Select @ErrorVal = @@ERROR;\n    PRINT 'Begin Catch';\n    IF @ErrorVal &lt;&gt; 0\n    BEGIN\n        PRINT CAST(@ErrorVal as varchar(30));\n        PRINT N'A error caught.';\n    END\nEND CATCH\nPRINT 'done'\n</code></pre>\n\n<p>;</p>\n"},{"tags":["sql-server","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":174,"score":1,"question_id":12561013,"title":"Could not load Microsoft.SqlServer.BatchParser or one of it's dependencies","body":"<p>I know this question was asked for many times and I found many information on google regarding this problem, but I still can't solve the problem that exists on my DEV PC :(<br>\n<img src=\"http://i.stack.imgur.com/yG4NW.png\" alt=\"I have that ugly error message on every page\"> (Could not load file or assembly Microsoft.SqlServer.BatchParser). I installed <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=24793\" rel=\"nofollow\">Microsoft SQL Server 2005 Management Objects Collection</a> as advised in many internet resources, but it not helped. Then I tried to install <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=16177\" rel=\"nofollow\">Microsoft SQL Server 2008 Management Objects</a>, but it says it can not be installed, since newer version exists already (I have SQL Server 2008 installed).<br>\nThen I went to GAC, and found following lines:<br>\nMicrosoft.SqlServer.BatchParser, Version=10.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91, processorArchitecture=AMD64  </p>\n\n<p>Microsoft.SqlServer.BatchParser, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91, processorArchitecture=AMD64  </p>\n\n<p>Microsoft.SqlServer.BatchParser, Version=10.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91, processorArchitecture=x86  </p>\n\n<p>Microsoft.SqlServer.BatchParser, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91, processorArchitecture=x86  </p>\n\n<p><strong>Microsoft.SqlServer.BatchParserClient, Version=10.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91, processorArchitecture=MSIL</strong> &lt;-- Should version 9.0.242.0 exist?  </p>\n\n<p>I already spent about half day to find a solution without a success, and it's very crappy to work with VS when intellisense not works because of that error.  </p>\n\n<p>I have VS 2010 SQL Express 2005 and SQL Server 2008 installed (see configuration screen shot) <img src=\"http://i.stack.imgur.com/548oD.png\" alt=\"enter image description here\">  </p>\n\n<p>Please help me to solve this! Thanks.</p>\n"},{"tags":["sql-server-2008","nhibernate","hql","nhibernate-3"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12643128,"title":"NullReferenceException in query.ExecuteUpdate()","body":"<p>I use NHibernate3 with SQL Server 2008. Now, I am trying to execute the following:</p>\n\n<pre><code>var q = this.Session.CreateQuery(@\"update Contact set Selection = REPLACE(';' + Selection + ';', :fromPara, :toPara) where ';' + Selection + ';' like :fromWhere\");\nq.SetParameter(\"fromPara\", \";\" + from + \";\");\nq.SetParameter(\"toPara\", \";\" + to + \";\");\nq.SetParameter(\"fromWhere\", \"%;\" + from + \";%\");\nq.ExecuteUpdate();\n</code></pre>\n\n<p>On the line with <code>q.ExecuteUpdate()</code> I get the following <code>NullReferenceException</code>:</p>\n\n<blockquote>\n  <p>at NHibernate.Param.ParametersBackTrackExtensions.&lt;>c_<em>DisplayClass14.b</em>_e(IType\n  t) in\n  p:\\nhibernate-core\\src\\NHibernate\\Param\\ParametersBackTrackExtensions.cs:line\n  40<br>\n  at System.Linq.Enumerable.d__14<code>2.MoveNext()<br>\n  at System.Linq.Buffer</code>1..ctor(IEnumerable<code>1 source)<br>\n  at System.Linq.Enumerable.ToArray[TSource](IEnumerable</code>1 source)<br>\n  at NHibernate.Param.ParametersBackTrackExtensions.GetQueryParameterTypes(IEnumerable<code>1\n  parameterSpecs, List</code>1 sqlQueryParametersList, \n  ISessionFactoryImplementor factory) in\n  p:\\nhibernate-core\\src\\NHibernate\\Param\\ParametersBackTrackExtensions.cs:line\n  40<br>\n  at NHibernate.Hql.Ast.ANTLR.Exec.MultiTableUpdateExecutor.Execute(QueryParameters\n  parameters, ISessionImplementor session) in\n  p:\\nhibernate-core\\src\\NHibernate\\Hql\\Ast\\ANTLR\\Exec\\MultiTableUpdateExecutor.cs:line\n  151<br>\n  at NHibernate.Hql.Ast.ANTLR.QueryTranslatorImpl.ExecuteUpdate(QueryParameters\n  queryParameters, ISessionImplementor session) in\n  p:\\nhibernate-core\\src\\NHibernate\\Hql\\Ast\\ANTLR\\QueryTranslatorImpl.cs:line\n  164<br>\n  at NHibernate.Engine.Query.HQLQueryPlan.PerformExecuteUpdate(QueryParameters\n  queryParameters, ISessionImplementor session) in\n  p:\\nhibernate-core\\src\\NHibernate\\Engine\\Query\\HQLQueryPlan.cs:line\n  173<br>\n  at NHibernate.Impl.SessionImpl.ExecuteUpdate(String query, QueryParameters queryParameters) in\n  p:\\nhibernate-core\\src\\NHibernate\\Impl\\SessionImpl.cs:line 2760<br>\n  at NHibernate.Impl.QueryImpl.ExecuteUpdate() in p:\\nhibernate-core\\src\\NHibernate\\Impl\\QueryImpl.cs:line 120  </p>\n</blockquote>\n\n<p>Can someone help me, what is wrong there? - Thanks.</p>\n"},{"tags":["asp.net","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12643345,"title":"Multipart Identifier \"arafa.almahmud08@gmail.com\" couldnot be bound","body":"<p>I have built a custom validator,</p>\n\n<p>I have a sql query like this:</p>\n\n<pre><code>protected void custom_serverValidate(object sender, ServerValidateEventArgs e)\n    {\n        connect();\n        string strSQL = \"select EmailAddress from Accounts_Users where EmailAddress=\" + REmailTextBox.Text;\n        SqlCommand cmd = new SqlCommand(strSQL, objConnection);\n        if (e.Value.ToString() == cmd.ExecuteScalar().ToString())\n        {\n            e.IsValid = false;\n        }\n        else\n            e.IsValid = true;\n        disConnect();\n    }\n</code></pre>\n\n<p>when I execute my code in the browser and an email address and submit it , I get the error mentioned in the title. how to fix it ?</p>\n"},{"tags":["sql-server-2008","delphi","delphi-xe2","sqlclr"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":141,"score":0,"question_id":12637118,"title":"SQL Server: stored procedure and CLR Proc return data differently","body":"<p>I'm using Delphi XE2 to call a stored procedure that returns data. The stored procedure is basically:</p>\n\n<pre><code>set nocount on -- ensures that Delphi will see that dataset\n...\nexec StoredProcThatReturnsData\n...\nupdate [table]\nupdate [another table]\n</code></pre>\n\n<p>When the main procedure is a T-SQL procedure, it finishes executing the main procedure including the last <code>update</code> statements <strong>before it returns the data</strong> to Delphi.</p>\n\n<p>When the main procedure is a CLR procedure, it returns the data at the moment the sub-procedure finishes executing and doesn't run the <code>update</code> statements until I close the <code>TSQLQuery</code> object in Delphi.</p>\n\n<p>The Delphi code looks like this:</p>\n\n<pre><code>rpt := TSQLQuery.Create(nil);\ntry\n  rpt.MaxBlobSize := -1;\n  rpt.SQLConnection := ASqlConnection;\n  rpt.SQL.Text := 'exec RunMainProc';\n  rpt.Open;\n  // do some things that depend on the update statements\n  // process the 'rpt' data\nfinally\n  FreeAndNil(rpt);\nend;\n</code></pre>\n\n<p>The CLR proc looks like this:</p>\n\n<pre><code>[Microsoft.SqlServer.Server.SqlProcedure]\npublic static void RunReport(SqlGuid ReportID, SqlGuid UserID, SqlBoolean ForDownload)\n{\n  using (SqlConnection con = new SqlConnection(\"context connection=true\"))\n  {\n    con.Open();\n    using (SqlCommand cmd = new SqlCommand())\n    {\n      cmd.Connection = con;\n      cmd.CommandText = \"[identical SQL as T-SQL proc]\";\n      SqlContext.Pipe.ExecuteAndSend(cmd);\n    }\n  }\n}\n</code></pre>\n\n<p>Why does the T-SQL procedure finish executing before returning the data while the CLR procedure waits to run the <code>update</code> statements until after Delphi closes/destroys the <code>rpt</code> query?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12642223,"title":"sql server batch database alters, batch database changes - best and safest way","body":"<p>We have a small development team of 5 developers working on a large enterprise level web based asp.net/c# system. </p>\n\n<p>We do a lot of database updates which include stored procedure creations and alters as well as new table creation, column creation, record inserts, record updates and so on and so forth.</p>\n\n<p>Today all of the developers place all change scripts in one large sql change script file that gets ran on our Test and Production environments. So this single file contains stored proc alters and record inserts, updates etc etc.  The file can end up being quite lengthy as we may only do a test or production release every 1 to 2 months.</p>\n\n<p>The problem that I am currently facing is this: </p>\n\n<p>Once in a while there is a script error that may occur at any given location in this large \"batch change script\". Perhaps an insert fails or perhaps an alter fails for a proc for instance.</p>\n\n<p>When this occurs, it is very difficult to tell what changes succeeded and what failed on the database.</p>\n\n<p>Sometimes even if one alter fails for instance code will continue to execute throughout the script and sometimes it will stop execution and nothing further gets ran.</p>\n\n<p>So I end up manually checking procs and records today to see what actually worked and what actually did not and this is a bit painstaking.</p>\n\n<p>I was hoping I could roll up this entire change script into one big transaction so that if any problem occurred I could just roll every change back, but that does not appear to be possible with batch scripts like this in sql server.</p>\n\n<p>So, then I tried to backup the databases before I ran the scripts so that if an error occurred I could simply restore  the db, fix the problem and then re-run the fixed script. However in order to restore a database I have to turn off our database mirroring so this is also not totally ideal.</p>\n\n<p>So my question is, what is the safest way to run batch scripts on a production database? </p>\n\n<p>Is there some way that I can wrap the entire script in a transaction that i can roll back that I am not seeing?</p>\n\n<p>Would it possibly be better for us to track and run separate script files so that if 1 file fails we can just shove it off in a failed directory to be looked at and continue running all other files? </p>\n\n<p>Looking for advice and expertise.</p>\n\n<p>thank you for your time.\nMatt</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1171,"score":1,"question_id":6950401,"title":"What does it mean if the database always keeps going into RECOVERY?","body":"<p>Every time I run a query, my database does not respond to an immediate second query and complains that it is in recovery mode (though it does not show anything beside the database name). This happens for about 5-10 minutes after which everything goes back to being normal.</p>\n\n<p>I am expecting a major crash so I am copying the tables into a different database but anyone knows why this could happen or if there is a permanent fix?</p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12616327,"title":"SSRS 2012 Always prompt for login","body":"<p>I am using SSRS 2012 for Reporting and when i deploy it on production server and try to access the report then it always prompt me for login and if we put the server login details then its working fine.</p>\n\n<p>I want to avoid this login prompt and How can i do this, i did many search on Google and try do implement these but not get any luck.</p>\n\n<p>Please help us.</p>\n\n<p>Thanks\nAtul</p>\n"},{"tags":["sql-server","sql-server-2008","common-table-expression","recursive-query"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12641995,"title":"CTE to return all items in hierarchy","body":"<p>I have a table with a recursive hierarchy (i.e. ID, ParentID). For any item in this hierachy, I want to be able to bring back a list of everything UP AND DOWN the hierarchy along with the level for each row. Assume that a parent can only ever have a single child.</p>\n\n<p>Take for example the following:</p>\n\n<pre><code>ID    ParentID\n--------------\n1     NULL\n2     1\n3     2\n4     NULL\n5     4\n6     5\n</code></pre>\n\n<p>Given ID 1, 2, or 3, I want to return:</p>\n\n<pre><code>ID    ParentID    Level\n-----------------------\n1     NULL        1\n2     1           2\n3     2           3\n</code></pre>\n\n<p>I've done this before, but I can't remember how. I know the solution involves a CTE, I just can't get it right! Any help is appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":12641341,"title":"Why is Count(*) returning unexpected number?","body":"<p>This is my query:</p>\n\n<pre><code>Select COUNT(*) \nFrom \n    Users u\n    Inner Join \n    UsersLoginHistory uh On u.UserID = uh.UserID \nWhere \n    1 = 1   \n    And \n    u.AccountID = 37 \nGroup By u.UserID\n</code></pre>\n\n<p>What I'd like to be able to get is <code>Count(*)</code> should be returning a number after grouping on u.UserId. But it returns the <code>Count(*)</code> before the group by is made.</p>\n\n<p>So I can rewrite the above query as:</p>\n\n<pre><code>Select COUNT(*)\nFrom (\n    Select   u.Username   \n    From \n        Users u\n        Inner Join \n        UsersLoginHistory uh On u.UserID = uh.UserID \n    Where \n        1 = 1   \n        And \n        u.AccountID = 37 \n    Group By u.UserID\n) v\n</code></pre>\n\n<p>But I need to find out why is the <code>Count(*)</code> returning records before a group by is made and how can I fix the 1st query itself.</p>\n\n<p><strong>EDIT:</strong> Sample Records</p>\n\n<p>Users table</p>\n\n<pre><code>UserId     Username\n102        tom.kaufmann\n</code></pre>\n\n<p>UserLoginHistory table</p>\n\n<pre><code>UsersLoginHistoryID UserID  LoginDateTime         LogoutDateTime         IPAddress\n1                    102    2012-09-28 01:16:00 NULL                 115.118.71.248\n2                    102    2012-09-28 01:29:00 2012-09-28 01:29:00  127.0.0.1\n3                    102    2012-09-28 01:32:00 2012-09-28 01:32:00  127.0.0.1\n4                    102    2012-09-28 01:41:00 NULL                 115.118.71.248\n5                    102    2012-09-28 01:43:00 2012-09-28 07:04:00  115.118.71.248  \n</code></pre>\n\n<p>and so on..</p>\n\n<p>Haven't writted every single record in this DB.</p>\n"},{"tags":["sql-server","sql-server-2008","ssis","sql-server-2008-r2","component-services"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12327941,"title":"SSIS Remote connection access","body":"<p>I have <code>Windows server 2008 R2</code> and <code>SQL Server 2008 R2</code> and want to change remote access of <code>SSIS</code>. In windows xp I can use <code>ControlPanel\\Administrative Tools\\Component Service\\My Computer\\DCOM Config\\Microsoft SQL Server Integration Service 11.0(Security Tab)</code> for config remote access to <code>SSIS</code>. but in windows server 2008 R2 I don't know how can active remote access.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["query","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3332,"score":4,"question_id":2997458,"title":"how to show only even or odd rows in sql server 2008?","body":"<p>i have a table MEN in sql server 2008 that contain 150 rows.</p>\n\n<p>how i can show only the even or only the odd rows ?</p>\n\n<p>thank's in advance</p>\n"},{"tags":["sql-server-2008","ssrs-2008","ssas","ssrs-reports","ssas-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12641570,"title":"SSRS 2008 - Object Reference not set to an instance of an object","body":"<p>Issue I get for one of my shared data sets only on certain parameters. If the parameter returns nothing for that dataset then I seem to come across this problem, there is a tablix in this report that uses the shared dataset and if I remove the tablix but keep the shared dataset I still get the error on the report preview. </p>\n\n<p>The dataset uses a MDX query (SSAS) to get its data, if I run the query from the query designer it returns 2 rows but the dates in the rows are outwith the scope of my report so the report would return 0 and I assume thats my issue.</p>\n\n<p>Anyone got any ideas/tips?</p>\n\n<p>Uses SQL Server 2008 R2</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008","ms-access-2007","access-vba","udf"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":117,"score":1,"question_id":12641616,"title":"Using SQL user defined function in MS Access 2007","body":"<p>I am very new to Access and need a bit help over here.\nI was working on MS Access 2007 (in VB) with SQL 2008 Server as my database.</p>\n\n<p>I wanted to show a SQL table in the frontend of Access but faced the problem while using SQL user defined function with my SQL query in Access 2007. I wrote this function and the query in SQL Query design of Access and tried to Run it.. but its showing error (Userdefined \"timepart\" function not recognized) !!</p>\n\n<pre><code>CREATE function  dbo.timepart (@date as SMALLDATETIME) \nRETURNS SMALLDATETIME \nAS \nBEGIN \nRETURN @date - DATEADD(d, DATEDIFF(d,0,@date), 0) \nEND \n\nSELECT * FROM TABLENAME WHERE dbo.timepart(FIELDNAME) Between '9:30' AND '17:30';\n</code></pre>\n\n<p>I guess MS Access doesn't allow to write UDF SQL funtions !! I tried this same query in my local SQL Server 2008 databse (SQL management studio) and is working perfectly fine. </p>\n"},{"tags":["sql-server-2008","visual-studio-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12640715,"title":"How can I make Sql Server accept dd/mm/yyyy format?","body":"<p>So I have an Excel file with values as 19/09/2011 on a column called \"Dates\". I selected the entire column in Excel - Format cells - Location: English(UK) and selected the sample value of \"14/03/2011\" so that the day appears before the month.</p>\n\n<p>Now, using a simple import package in Visual Studio, I imported the data in Sql Server (I used 3 tasks generated by the wizard: Drop table, create table structure in Sql Server, and actual import). </p>\n\n<p>In the create table task, I specified the dates column type as date.\nAfter that, to test the outcome, I selected dates in the Sql Server table ordering it by dates desc.</p>\n\n<p>So I get this, all rumble-jumbled (this is supposed to be only September data, so we should have only \"09\" after the year):</p>\n\n<pre><code>2011-12-09\n2011-11-09\n2011-10-09\n2011-09-30\n2011-09-29\n2011-09-28\n2011-09-27\n2011-09-26\n2011-09-25\n2011-09-24\n2011-09-23\n2011-09-22\n2011-09-21\n2011-09-20\n2011-09-19\n2011-09-18\n2011-09-17\n2011-09-16\n2011-09-15\n2011-09-14\n2011-09-13\n2011-09-09\n2011-08-09\n2011-07-09\n2011-06-09\n2011-05-09\n2011-04-09\n2011-03-09\n2011-02-09\n2011-01-09\n</code></pre>\n"},{"tags":["wcf","sql-server-2008","syncservices"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":11444981,"title":"Error in SQL Server database synchronization using SyncServices and WCF","body":"<p>I have database on the server - Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64).\nConfigured to synchronize with a SQL Server Compact database client through WCF using Microsoft Synchronization Services for ADO.NET.</p>\n\n<p>Sometimes this error began to emerge:</p>\n\n<blockquote>\n  <p>Microsoft.Synchronization.Data.SyncException: Unable to enumerate changes at the DbServerSyncProvider for table 'TABLE NAME' in\n  synchronization group 'GROUP NAME'.</p>\n  \n  <p>---> System.Data.SqlClient.SqlException: A transport-level error has\n  occurred when receiving results from the server (provider: TCP\n  Provider, error: 0 - The semaphore timeout period has expired.)</p>\n  \n  <p>at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)<br>\n  at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject\n  stateObj)<br>\n  at System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject\n  stateObj, UInt32 error)<br>\n  at System.Data.SqlClient.TdsParserStateObject.ReadSni(DbAsyncResult\n  asyncResult, TdsParserStateObject stateObj)<br>\n  at System.Data.SqlClient.TdsParserStateObject.ReadNetworkPacket()<br>\n  at System.Data.SqlClient.TdsParserStateObject.ReadBuffer()<br>\n  at System.Data.SqlClient.TdsParserStateObject.ReadByte()<br>\n  at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream,\n  BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject\n  stateObj)<br>\n  at System.Data.SqlClient.SqlDataReader.ConsumeMetaData()<br>\n  at System.Data.SqlClient.SqlDataReader.get_MetaData()<br>\n  at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds,\n  RunBehavior runBehavior, String resetOptionsString)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean\n  async)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String\n  method, DbAsyncResult result)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String\n  method)<br>\n  at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior\n  behavior, String method)<br>\n  at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior\n  behavior)<br>\n  at System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader()<br>\n  at Microsoft.Synchronization.Data.Server.DbServerSyncProvider.EnumerateChanges(SyncGroupMetadata\n  groupMetadata, SyncSession syncSession, IDbTransaction transaction,\n  EnumerateChangeType changeType, SyncSchema traceSchema)  </p>\n</blockquote>\n\n<p>Table names are different each time.</p>\n\n<p>Tell me please how to solve this problem.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2008","indexing"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1157,"score":3,"question_id":7133761,"title":"SQL Server 2008 index fragmentation problem","body":"<p>Everyday I import 2,000,000 rows from some text files using <code>BULK INSERT</code> into SQL Server 2008 and then I do some post-processing to update the records.</p>\n\n<p>I have some indexes on the table to execute the post-process as fast as possible and in normal situation, the post-processing script takes about 40 seconds to run.</p>\n\n<p>But sometimes (I don't know when) the post-processing does not work. In the situation I've mentioned, it is not done after an hour! After rebuilding indexes, everything is fine and normal.</p>\n\n<p>What should I do to prevent the problem to be happened?</p>\n\n<p>Right now, I have a nightly job to rebuild all indexes. Why the index fragmentation grows up to 90%?</p>\n\n<p>Update: \nHere is my table which I import text file into:</p>\n\n<pre><code>  CREATE TABLE [dbo].[My_Transactions](\n    [My_TransactionId] [bigint] NOT NULL,\n    [FileId] [int] NOT NULL,\n    [RowNo] [int] NOT NULL,\n    [TransactionTypeId] [smallint] NOT NULL,\n    [TransactionDate] [datetime] NOT NULL,\n    [TransactionNumber] [dbo].[TransactionNumber] NOT NULL,\n    [CardNumber] [dbo].[CardNumber] NULL,\n    [AccountNumber] [dbo].[CardNumber] NULL,\n    [BankCardTypeId] [smallint] NOT NULL,\n    [AcqBankId] [smallint] NOT NULL,\n    [DeviceNumber] [dbo].[DeviceNumber] NOT NULL,\n    [Amount] [dbo].[Amount] NOT NULL,\n    [DeviceTypeId] [smallint] NOT NULL,\n    [TransactionFee] [dbo].[Amount] NOT NULL,\n    [AcqSwitchId] [tinyint] NOT NULL\n) ON [PRIMARY]\n\nGO\n\nCREATE NONCLUSTERED INDEX [_dta_index_Jam_Transactions_8_1290487676__K1_K4_K12_K6_K11_5] ON [dbo].[Jam_Transactions] \n(\n    [Jam_TransactionId] ASC,\n    [TransactionTypeId] ASC,\n    [Amount] ASC,\n    [TransactionNumber] ASC,\n    [DeviceNumber] ASC\n)\nINCLUDE ( [TransactionDate]) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\nGO\n\nCREATE NONCLUSTERED INDEX [_dta_index_Jam_Transactions_8_1290487676__K12_K6_K11_K1_5] ON [dbo].[Jam_Transactions] \n(\n    [Amount] ASC,\n    [TransactionNumber] ASC,\n    [DeviceNumber] ASC,\n    [Jam_TransactionId] ASC\n)\nINCLUDE ( [TransactionDate]) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\nGO\n\nCREATE NONCLUSTERED INDEX [IX_Jam_Transactions] ON [dbo].[Jam_Transactions] \n(\n    [Jam_TransactionId] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\nGO\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":93,"score":5,"question_id":12628459,"title":"Group by column A but comparing column B","body":"<p>This one has had me stumped for the last few hours and at this stage I think I need some help...</p>\n\n<p>I need to compare multiple groups from a single table and to identify where items listed in col B match.  For example: -</p>\n\n<pre><code>Col A...............Col B\nJohn................Apple\nJohn................Orange\nJohn................Banana\nMary................Orange\nMary................Strawberry\nDavid...............Apple\nDavid...............Orange\nDavid...............Banana\n</code></pre>\n\n<p>I want 'John' and 'David' returned because their items in col B match.  Hope this makes sense!\nThanks in advance!\nG</p>\n"},{"tags":["sql-server-2008","tsql","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12639301,"title":"Stored procedure table parameter versus xml in SQL Server 2008","body":"<p>I've got two versions of a stored procedure that does basically the same - does a right join query on a largish table and another table that is provided as a parameter. </p>\n\n<ul>\n<li>The first version takes a string with XML and does a select from <code>OPENXML</code>.</li>\n<li>The second takes the provided table variable parameter.</li>\n</ul>\n\n<p>I expected the second/table version to outperform the first/XML version as it doesn't do any parsing, doc object creating and disposing explicitly. My test show, however, that both versions get executed in approx the same time.</p>\n\n<p>What might be the reason? Table parameter serializes worse than string parameter? XML queries are very efficient?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":135,"score":2,"question_id":10820827,"title":"T-SQL Change Data Capture log cleanup","body":"<p>I have enabled CDC on few tables in my SQL server 2008 database. I want to change the number of days I can keep the change history.</p>\n\n<p>I have read that by default change logs are kept for 3 days, before they are deleted by  sys.sp_cdc_cleanup_change_table stored proc.</p>\n\n<p>Does anyone know how I can change this default value, so that I can keep the logs for longer.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12639030,"title":"Get the list of stored procedures created and / or modified on a particular date?","body":"<p>I want to find which stored procedure I've created and also I want to find which stored procedure I've modified in my SQL Server on a particular date like 27 september 2012 (27/09/2012).</p>\n\n<p>Is there any query which will list these procedures that are created and also modified on this date?</p>\n\n<p>Thanks in advance</p>\n\n<p>Regards\nAmit Vyas</p>\n"},{"tags":["sql-server-2008","c#-3.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12638867,"title":"Insert a Page break after specified number of groups","body":"<p>I am creating a report using rdlc files. I want page break  after specified number of group.\nie.break the table rows into Multi columns.\nWe use matrix.</p>\n\n<p>Please let me know , how to proceed.\nThanks in advance .</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":42,"score":-1,"question_id":12638089,"title":"Adding data & time info of the record inserted. NOT BY USING INSERT STATEMENT","body":"<p>I have a table <code>Employee</code> with columns: <code>Id, Name, Address, City, Createddate</code></p>\n\n<p>Now, I have to add this <code>createddate</code> column upon record insertion into the table, but NOT BY USING INSERT STATEMENT.</p>\n\n<p>Is there any default option which adds up the date info when a row is being added to the table?</p>\n\n<p>Suggest me in this regard.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":188,"score":1,"question_id":4379618,"title":"select data from two tables","body":"<p>I have two tables Accountdetails and Accounts</p>\n\n<ul>\n<li>Accountdetails consists of columns AD_ID, AD_Name, AD_AccNo</li>\n<li>Accounts consists of Columns A_Name, A_AccNo, A_AccDate</li>\n</ul>\n\n<p>My question is I wanted to select data based on the AD_AccNo and A_AccNo being equal</p>\n\n<p>I tried using this query</p>\n\n<pre><code>select AD.AD_ID, a.A_Name, a.A_AccNo, a.A_AccDate \nfrom Accountdetails as AD, Accounts as a \nwhere AD.AD_AccNo = a.A_AccNo\n</code></pre>\n\n<p>Can anyone suggest me the place where i am going wrong?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":55,"score":0,"question_id":12637782,"title":"SQL exceeds the maximum allowed error","body":"<p>Hi I'm pulling data within Data Manager and which is coming via Salesforce so the data type and limits are set in Salesforce which I have no control over. I would like to know how I can limit the the amount of data coming in and inserted into the MS SQL. This is the error:</p>\n\n<pre><code>[42000]Microsoft SQL Server Native Client 10.0\nThe size (32000) given to the column 'Description' exceeds the maximum allowed for any data type (8000).\n</code></pre>\n\n<p>And this is my query which pulls the data:</p>\n\n<pre><code>SELECT  \"Id\",\n\"IsDeleted\",\n\"Name\",\n\"ParentId\",\n\"Type\",\n\"Status\",\n\"StartDate\",\n\"EndDate\",\n\"CurrencyIsoCode\",\n\"ExpectedRevenue\",\n\"BudgetedCost\",\n\"ActualCost\",\n\"Description\",\n\"ExpectedResponse\",\n\"NumberSent\",\n\"IsActive\",\n\"NumberOfLeads\",\n\"NumberOfConvertedLeads\",\n\"NumberOfContacts\",\n\"NumberOfResponses\",\n\"NumberOfOpportunities\",\n\"NumberOfWonOpportunities\",\n\"AmountAllOpportunities\",\n\"AmountWonOpportunities\",\n\"OwnerId\",\n\"CreatedDate\",\n\"CreatedById\",\n\"LastModifiedDate\",\n\"LastModifiedById\",\n\"SystemModstamp\",\n\"LastActivityDate\",\n\"CampaignMemberRecordTypeId\",\n\"Date_of_Event__c\",\n\"Venue__c\"\nFROM   \"SF Schema\".\"Campaign\"\n</code></pre>\n\n<p>Is there anyway to set limit on the \"Description\" the max is 8000.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","plsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":126,"score":1,"question_id":12637152,"title":"sql server query order by with union and replacing multiple columns' null value","body":"<p>I have a query to get records from 4 different tables. I am using <code>union</code> to get the final records. My problem is I don't have same number and type of columns in all 4 tables so I am making dummy columns with <code>null</code> value. The problem I am facing is in sorting. I am sorting records using datetime desc, but some times when dates are same then I want the secondry sort column on alerts that can be of High, Medium or Null types. I want Null columns on bottom but I am getting on top. So I tried to use <code>ISNULL(column_name, 'aaaa')</code> in <code>ORDER BY</code> clause, but I am not getting actual result. Can any one help? </p>\n\n<pre><code>SELECT CreatedDt as 'Date/Time' , null AS [Alert_Type] FROM TblA\nunion  \nSELECT CreatedDt as 'Date/Time' , null AS [Alert_Type] FROM TblB\nunion  \nSELECT CreatedDt as 'Date/Time' , null AS [Alert_Type] FROM TblC\nunion\nSELECT CreatedDt as 'Date/Time' , Alert_Type FROM TblD\nORDER BY CreatedDt, ISNULL (Alert_Type,'aa') DESC\n</code></pre>\n\n<p>The error is </p>\n\n<pre><code>ORDER BY items must appear in the select list if the statement contains a UNION, INTERSECT or EXCEPT operator.\n</code></pre>\n\n<p>Thank you..</p>\n"},{"tags":["sql-server-2008","reporting-services","filter","expression","highlight"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12636716,"title":"RS: Year and Month filter - Highlight line","body":"<p>I want to highlight all months that are older than current month. \nBy creating a expression in Reporting Services. \nI have this expression for month, which works:</p>\n\n<pre><code>=IIF(month(Fields!Date.Value) &lt; month(today()), \"Gold\", \"White\")\n</code></pre>\n\n<p>Now I want to add year as a filter just to be safe, not sure how to do this: </p>\n\n<pre><code>=IIF(month(Fields!Date.Value) &lt; month(today()), \"Gold\", \"White\") &amp; IIF year(Fields!Date.Value) &lt;= year(today())\n</code></pre>\n\n<p>Anyone?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":220,"score":-1,"question_id":7896656,"title":"SQL Server - change tracking on Views data","body":"<p>I would like to track changes on views data. I don't think it is possible out of the box with current sql server change tracking. Has anyone come up with a solution to this one?</p>\n\n<p>//edit\nI'm synchronizing data between two databases. Synchronization works mostly on views (some tables too), so I need to track changes that are being made on views data (insert/update/delete). The task is not trivial, because some views are just JOINS and others use PIVOT.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":672,"score":8,"question_id":4230838,"title":"Why are logical reads for windowed aggregate functions so high?","body":"<p>I've found that in execution plans using common subexpression spools that the reported logical reads get quite high for large tables.</p>\n\n<p>After some trial and error I've found a formula that seems to hold for the test script and execution plan below. <code>Worktable logical reads = 1 + NumberOfRows * 2 + NumberOfGroups * 4</code></p>\n\n<p>I don't understand the reason why this formula holds though. It is more than I would have thought was necessary looking at the plan. Can anyone give a blow by blow account of what's going on that accounts for this?</p>\n\n<p>Or failing that is there any way of tracing what page was read in each logical read so I can work it out for myself?</p>\n\n<pre><code>SET STATISTICS IO OFF; SET NOCOUNT ON;\n\nIF Object_id('tempdb..#Orders') IS NOT NULL\n  DROP TABLE #Orders;\n\nCREATE TABLE #Orders\n  (\n     OrderID    INT IDENTITY(1, 1) NOT NULL PRIMARY KEY CLUSTERED,\n     CustomerID NCHAR(5) NULL,\n     Freight    MONEY NULL,\n  );\n\nCREATE NONCLUSTERED INDEX ix\n  ON #Orders (CustomerID)\n  INCLUDE (Freight);\n\nINSERT INTO #Orders\nVALUES (N'ALFKI', 29.46), \n       (N'ALFKI', 61.02), \n       (N'ALFKI', 23.94), \n       (N'ANATR', 39.92), \n       (N'ANTON', 22.00);\n\nSELECT PredictedWorktableLogicalReads = \n        1 + 2 * Count(*) + 4 * Count(DISTINCT CustomerID)\nFROM   #Orders;\n\nSET STATISTICS IO ON;\n\nSELECT OrderID,\n       Freight,\n       Avg(Freight) OVER (PARTITION BY CustomerID) AS Avg_Freight\nFROM   #Orders; \n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>PredictedWorktableLogicalReads\n------------------------------\n23\n</code></pre>\n\n<hr>\n\n<pre><code>Table 'Worktable'. Scan count 3, logical reads 23, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\nTable '#Orders___________000000000002'. Scan count 1, logical reads 2, physical reads 0, read-ahead reads 0, lob logical reads 0, lob physical reads 0, lob read-ahead reads 0.\n</code></pre>\n\n<p><a href=\"http://i.stack.imgur.com/lRJdw.jpg\" rel=\"nofollow\"><img src=\"http://i.stack.imgur.com/lRJdw.jpg\" alt=\"Execution Plan\"></a></p>\n\n<p><strong>Additional Info:</strong> </p>\n\n<p>There is a good explanation of these spools in Chapter 3 of the <a href=\"http://www.microsoft.com/learning/en/us/book.aspx?id=8565&amp;locale=en-us\" rel=\"nofollow\">Query Tuning and Optimization</a> Book and <a href=\"http://sqlblog.com/blogs/paul_white/archive/2010/07/28/partitioning-and-the-common-subexpression-spool.aspx\" rel=\"nofollow\">this blog post by Paul White</a>.</p>\n\n<p>In summary the segment iterator at the top of the plan adds a flag to the rows it sends indicating when it is the start of a new partition. The primary segment spool gets a row at a time from the segment iterator and inserts it into a work table in tempdb. Once it gets the flag saying that a new group has started it returns a row to the top input of the nested loops operator. This causes the stream aggregate to be invoked over the rows in the work table, the average is computed then this value is joined back with the rows in the work table before the work table is truncated ready for the new group. The segment spool emits a dummy row in order to get the final group processed.</p>\n\n<p>As far as I understand the worktable is a heap (or it would be denoted in the plan as an index spool). However when I try and replicate the same process it only needs 11 logical reads.</p>\n\n<pre><code>CREATE TABLE #WorkTable\n  (\n     OrderID    INT,\n     CustomerID NCHAR(5) NULL,\n     Freight    MONEY NULL,\n  )\n\nDECLARE @Average MONEY\n\nPRINT 'Insert 3 Rows'\n\nINSERT INTO #WorkTable\nVALUES      (1, N'ALFKI', 29.46) /*Scan count 0, logical reads 1*/\n\nINSERT INTO #WorkTable\nVALUES      (2, N'ALFKI', 61.02) /*Scan count 0, logical reads 1*/\n\nINSERT INTO #WorkTable\nVALUES      (3, N'ALFKI', 23.94) /*Scan count 0, logical reads 1*/\nPRINT 'Calculate AVG'\n\nSELECT @Average = Avg(Freight)\nFROM   #WorkTable /*Scan count 1, logical reads 1*/\nPRINT 'Return Rows - With the average column included'\n\n/*This convoluted query is just to force a nested loops plan*/\nSELECT *\nFROM   (SELECT @Average AS Avg_Freight) T /*Scan count 1, logical reads 1*/\n       OUTER APPLY #WorkTable\nWHERE  COALESCE(Freight, OrderID) IS NOT NULL\n       AND @Average IS NOT NULL\n\nPRINT 'Clear out work table'\n\nTRUNCATE TABLE #WorkTable\n\nPRINT 'Insert 1 Row'\n\nINSERT INTO #WorkTable\nVALUES      (4, N'ANATR', 39.92) /*Scan count 0, logical reads 1*/\nPRINT 'Calculate AVG'\n\nSELECT @Average = Avg(Freight)\nFROM   #WorkTable /*Scan count 1, logical reads 1*/\nPRINT 'Return Rows - With the average column included'\n\nSELECT *\nFROM   (SELECT @Average AS Avg_Freight) T /*Scan count 1, logical reads 1*/\n       OUTER APPLY #WorkTable\nWHERE  COALESCE(Freight, OrderID) IS NOT NULL\n       AND @Average IS NOT NULL\n\nPRINT 'Clear out work table'\n\nTRUNCATE TABLE #WorkTable\n\nPRINT 'Insert 1 Row'\n\nINSERT INTO #WorkTable\nVALUES      (5, N'ANTON', 22.00) /*Scan count 0, logical reads 1*/\nPRINT 'Calculate AVG'\n\nSELECT @Average = Avg(Freight)\nFROM   #WorkTable /*Scan count 1, logical reads 1*/\nPRINT 'Return Rows - With the average column included'\n\nSELECT *\nFROM   (SELECT @Average AS Avg_Freight) T /*Scan count 1, logical reads 1*/\n       OUTER APPLY #WorkTable\nWHERE  COALESCE(Freight, OrderID) IS NOT NULL\n       AND @Average IS NOT NULL\n\nPRINT 'Clear out work table'\n\nTRUNCATE TABLE #WorkTable\n\nPRINT 'Calculate AVG'\n\nSELECT @Average = Avg(Freight)\nFROM   #WorkTable /*Scan count 1, logical reads 0*/\nPRINT 'Return Rows - With the average column included'\n\nSELECT *\nFROM   (SELECT @Average AS Avg_Freight) T\n       OUTER APPLY #WorkTable\nWHERE  COALESCE(Freight, OrderID) IS NOT NULL\n       AND @Average IS NOT NULL\n\nDROP TABLE #WorkTable \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":71,"score":-2,"question_id":12634629,"title":"Error in creating a function in SQL Server 2008","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12623142/getting-error-in-sql-query-with-function-use\">Getting error in SQL query with function use </a>  </p>\n</blockquote>\n\n\n\n<p>I get this error when attempting to create a function:</p>\n\n<blockquote>\n  <p>'CREATE FUNCTION' must be the first statement in a query batch.</p>\n  \n  <p>Error:</p>\n  \n  <p>Incorrect syntax near the keyword 'with'.</p>\n  \n  <p>If this statement is a common table expression, an xmlnamespaces\n  clause or a change tracking context clause, the previous statement\n  must be terminated with a semicolon. Must declare the scalar variable\n  \"@sep\".</p>\n</blockquote>\n\n<p>This is my T-SQL code:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[fn_Split] (@sep nvarchar(10), @s nvarchar(4000))\nRETURNS table\nAS\nRETURN (\nWITH Pieces(pn, start, stop) AS (\nSELECT 1, 1, CHARINDEX(@sep, @s)\nUNION ALL\nSELECT pn + 1, stop + (datalength(@sep)/2), CHARINDEX(@sep, @s, stop + (datalength(@sep)/2))\nFROM Pieces\nWHERE stop &gt; 0\n)\nSELECT pn,\nSUBSTRING(@s, start, CASE WHEN stop &gt; 0 THEN stop-start ELSE 4000 END) AS value\nFROM Pieces\n)\n;\n</code></pre>\n"},{"tags":["c#","sql-server-2008","entity-framework","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":59,"score":3,"question_id":12626331,"title":"Any way to speed up CreateIfNotExists in Entity Framework?","body":"<p>I'm using EF 4.3 Code First on SQL Server 2008. I run several test suites that delete and recreate the database with CreateIfNotExists. This works fine but is dog slow. It can take up to 15 seconds to create the database on the first call, and typically 3-6 seconds after that. I have several places where this is called. I've already optimized to call this as few times as I can. Is there something I can do to speed up database creation programmatically? I'm willing to go around EF to do this if that helps, but I would like to keep my database build in code and not go back to a SQL script. Thanks!</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12636403,"title":"Calculate an expression stored inside a string variable in SQL Server 2008","body":"<p>I have a conditional expression stored inside a string variable, </p>\n\n<p>For example :</p>\n\n<pre><code>declare @x int=501,@y int=0,@str varchar(max)\n\nset @str='if @x &gt; 500 set @y=1000 else set @y=500'\n</code></pre>\n\n<p>Can anybody anybody tell me how can I calculate this string and get the result in <code>SQL Server 2008</code> from inside a stored procedure.</p>\n\n<p>Thanks in advance</p>\n\n<p>SD</p>\n"},{"tags":["sql-server-2008","database-restore"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":109,"score":0,"question_id":12455495,"title":"Database and log restoration job failed","body":"<p>I've got a daily process that restores a DB from one server to another.\nIt restored the Database backup file of the DB and if it finds TLog backup files, it restores them too.</p>\n\n<p>The process works for some time now with no issues.\nToday it failed \nThe error message:</p>\n\n<pre><code>Message\nExecuted as user: AOI\\sa_SqlAgentSrv_PRD. RegQueryValueEx() returned error 2, 'The system cannot find the file specified.' [SQLSTATE 01000] (Message 22001)  IF EXISTS (select * from sysdatabases where name = 'SiteDbStandby')   ALTER DATABASE SiteDbStandby SET SINGLE_USER WITH ROLLBACK IMMEDIATE  \nRESTORE DATABASE [SiteDbStandby] FROM DISK = '\\\\SqlBackup\\Databases\\SiteDb.bak' WITH NORECOVERY  , REPLACE , MOVE 'SiteDb_data' to 'G:\\MSSQL10.DB2\\MSSQL\\DATA\\SiteDbStandby_SiteDb_data.mdf' , MOVE 'SiteDb_log' to 'J:\\MSSQL10.DB2\\MSSQL\\DATA\\SiteDbStandby_SiteDb_log.ndf' [SQLSTATE 01000] (Message 0)  Processed 191216 pages for database 'SiteDbStandby', file 'SiteDb_data' on file 1. [SQLSTATE 01000] (Message 4035)  Processed 4 pages for database 'SiteDbStandby', file 'SiteDb_log' on file 1. [SQLSTATE 01000] (Message 4035)  \nRESTORE DATABASE successfully processed 191220 pages in 20.366 seconds (73.352 MB/sec). [SQLSTATE 01000] (Message 3014)  \nRESTORE LOG SiteDbStandby FROM DISK = '\\\\SqlBackup\\Logs\\SiteDb_20120916_011017.BAK' WITH NORECOVERY \nRESTORE LOG SiteDbStandby FROM DISK = '\\\\SqlBackup\\Logs\\SiteDb_20120916_021929.BAK' WITH NORECOVERY \nRESTORE LOG SiteDbStandby FROM DISK = '\\\\SqlBackup\\Logs\\SiteDb_20120916_031349.BAK' WITH NORECOVERY \nRESTORE LOG SiteDbStandby FROM DISK = '\\\\SqlBackup\\Logs\\SiteDb_20120915_231017.BAK' WITH NORECOVERY \nRESTORE LOG SiteDbStandby FROM DISK = '\\\\SqlBackup\\Logs\\SiteDb_20120916_001017.BAK' WITH NORECOVERY [SQLSTATE 01000] (Message 0)  The log in this backup set begins at LSN 42459000001303500001, which is too recent to apply to the database. An earlier log backup that includes LSN 42459000001302800001 can be restored. [SQLSTATE 42000] (Error 4305)  RESTORE LOG is terminating abnormally. [SQLSTATE 42000] (Error 3013).  The step failed.\n</code></pre>\n\n<p>You can see that it tries to restore the log file of 16.9 from 1AM, the log file of 16.9 from 2AM, the log file of 16.9 from 3AM, \nand then the log file of 15.9 from 23PM, and the log file of 16.9 from 12AM.</p>\n\n<p>The restore sequence of the logs got messed up.</p>\n\n<p>I've looked back in the job's histoy, we've got history of around 3 weeks of daily executions.\nIn each one of the executions, the sequence is correct.\nFor example:</p>\n\n<pre><code>Executed as user: AOI\\sa_SqlAgentSrv_PRD. RegQueryValueEx() returned error 2, 'The system cannot find the file specified.' [SQLSTATE 01000] (Message 22001)  IF EXISTS (select * from sysdatabases where name = 'SiteDbStandby')   ALTER DATABASE SiteDbStandby SET SINGLE_USER WITH ROLLBACK IMMEDIATE  \nRESTORE DATABASE [SiteDbStandby] FROM DISK = '\\\\SqlBackup\\Databases\\SiteDb.bak' WITH NORECOVERY  , REPLACE , MOVE 'SiteDb_data' to 'G:\\MSSQL10.DB2\\MSSQL\\DATA\\SiteDbStandby_SiteDb_data.mdf' , MOVE 'SiteDb_log' to 'J:\\MSSQL10.DB2\\MSSQL\\DATA\\SiteDbStandby_SiteDb_log.ndf' [SQLSTATE 01000] (Message 0)  Processed 191032 pages for database 'SiteDbStandby', file 'SiteDb_data' on file 1. [SQLSTATE 01000] (Message 4035)  Processed 6 pages for database 'SiteDbStandby', file 'SiteDb_log' on file 1. [SQLSTATE 01000] (Message 4035)  \nRESTORE DATABASE successfully processed 191038 pages in 21.703 seconds (68.768 MB/sec). [SQLSTATE 01000] (Message 3014)  \nRESTORE LOG SiteDbStandby FROM DISK = '\\\\SqlBackup\\Logs\\SiteDb_20120914_231026.BAK' WITH NORECOVERY \nRESTORE LOG SiteDbStandby FROM DISK = '\\\\SqlBackup\\Logs\\SiteDb_20120915_001019.BAK' WITH NORECOVERY \nRESTORE LOG SiteDbStandby FROM DISK = '\\\\SqlBackup\\Logs\\SiteDb_20120915_011032.BAK' WITH NORECOVERY \nRESTORE LOG SiteDbStandby FROM DISK = '\\\\SqlBackup\\Logs\\SiteDb_20120915_021140.BAK' WITH NORECOVERY \nRESTORE LOG SiteDbStandby FROM DISK = '\\\\SqlBackup\\Logs\\SiteDb_20120915_031053.BAK' WITH NORECOVERY [SQLSTATE 01000] (Message 0)  Processed 0 pages for database 'SiteDbStandby', file 'SiteDb_data' on file 1. [SQLSTATE 01000] (Message 4035)  Processed 7 pages for database 'SiteDbStandby', file 'SiteDb_log' on file 1. [SQLSTATE 01000] (Message 4035)  \nRESTORE LOG successfully processed 7 pages in 0.009 seconds (5.588 MB/sec). [SQLSTATE 01000] (Message 3014)  Processed 0 pages for database 'SiteDbStandby', file 'SiteDb_data' on file 1. [SQLSTATE 01000] (Message 4035)  Processed 0 pages for database 'SiteDbStandby', file 'SiteDb_log' on file 1. [SQLSTATE 01000] (Message 4035)  \nRESTORE LOG successfully processed 0 pages in 0.009 seconds (0.000 MB/sec). [SQLSTATE 01000] (Message 3014)  Processed 0 pages for database 'SiteDbStandby', file 'SiteDb_data' on file 1. [SQLSTATE 01000] (Message 4035)  Processed 1229 pages for database 'SiteDbStandby', file 'SiteDb_log' on file 1. [SQLSTATE 01000] (Message 4035)  \nRESTORE LOG successfully processed 1229 pages in 0.196 seconds (48.965 MB/sec). [SQLSTATE 01000] (Message 3014)  Processed 0 pages for database 'SiteDbStandby', file 'SiteDb_data' on file 1. [SQLSTATE 01000] (Message 4035)  Processed 3 pages for database 'SiteDbStandby', file 'SiteDb_log' on file 1. [SQLSTATE 01000] (Message 4035)  \nRESTORE LOG successfully processed 3 pages in 0.013 seconds (1.277 MB/sec). [SQLSTATE 01000] (Message 3014)  Processed 0 pages for database 'SiteDbStandby', file 'SiteDb_data' on file 1. [SQLSTATE 01000] (Message 4035)  Processed 0 pages for database 'SiteDbStandby', file 'SiteDb_log' on file 1. [SQLSTATE 01000] (Message 4035)  \nRESTORE LOG successfully processed 0 pages in 0.009 seconds (0.000 MB/sec). [SQLSTATE 01000] (Message 3014)  \nuse master restore database SiteDbStandby with recovery [SQLSTATE 01000] (Message 0)  \nRESTORE DATABASE successfully processed 0 pages in 4.360 seconds (0.000 MB/sec). [SQLSTATE 01000] (Message 3014)  use SiteDbStandby ALTER AUTHORIZATION ON DATABASE::SiteDbStandby TO sa ALTER DATABASE SiteDbStandby SET COMPATIBILITY_LEVEL = 100 [SQLSTATE 01000] (Message 0).  The step succeeded.\n</code></pre>\n\n<p>So, the correct order is 11PM of the previous day, 12AM of the current day, 1AM, 2AM, and 3AM of the current day.</p>\n\n<p>All the logs exist in their share folder directory.\nEverything looks normal.</p>\n\n<p>Do you happen to think of an idea why did the job fail?</p>\n\n<p>Thanks in advance,</p>\n\n<p>Roni.</p>\n"},{"tags":["sql-server-2008","c#-4.0","dataset"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12635611,"title":"Can we get the Inserted Record ID?","body":"<p>I have a problem like retriving the Inserted Record Identity Value.Here I am inserting the record using DatSet.Suppose I have a table GAME where I have deleted all the records and I am inserting the record using dataset as given below </p>\n\n<pre><code>SqlDataAdapter sqlAdapter = new SqlDataAdapter(\"select * from GAME\", sqlCon);\n            DataSet ds = new DataSet();\n            DataRow dr;\n            sqlAdapter.FillSchema(ds, SchemaType.Source, \"GAME\");\n            sqlAdapter.Fill(ds, \"GAME\");\n            dr = ds.Tables[\"GAME\"].NewRow();\n            SqlCommandBuilder objSqlcmdBuilder = new SqlCommandBuilder(sqlAdapter);\n            dr[\"NAME\"] = \"TABLE TENNIS\";\n            dr[\"PlayedDate\"] = \"01/02/2010\";\n            ds.Tables[\"GAME\"].Rows.Add(dr);\n            sqlAdapter.Update(ds, \"GAME\");\n            MessageBox.Show(Convert.ToString(dr[\"GameId\"]), \"DataSet Demo\");\n</code></pre>\n\n<p>Here always I am getting the GameId as '0'. But I Need to get the Inserted Record Identity Value.Is there any possible way to get using DataSet?I know the process to get inserted record Id value using @@Identity e.t.c.</p>\n"},{"tags":["query","sql-server-2008","datetime"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":789,"score":0,"question_id":2449552,"title":"how to get time (hh:mm:ss) from sql query?","body":"<p>i have Database with date field.</p>\n\n<p>i see the time like: 1900-01-01 13:38:00.000</p>\n\n<p>how i can see it like: 13:38  ?</p>\n\n<p>(i work on sql server 2008)</p>\n\n<p>thank's in advance</p>\n"},{"tags":["sql-server","sql-server-2008","null","where-clause","coalesce"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2534,"score":0,"question_id":4224991,"title":"SQL Server: checking an input param if not Null and using it in where?","body":"<p>what is the best way to include an input param in the <code>WHERE</code> clause but exclude it if it is null?</p>\n\n<p>There are a number of ways I believe but I can't seem to remember then.</p>\n\n<p>Also could I use the <code>COALESCE()</code> ?? But I think this is only for SELECTing values?</p>\n\n<p>Any help really appreciated</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>To clarify</p>\n\n<p>lets say a variable called @code =\"1\" then my where would be \"Where type='B' AND code = @code\" but if @code is null then i only want \"Where type='B'\" - notice the missing code = @code</p>\n"},{"tags":["sql","sql-server","sql-server-2008","backup"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12634168,"title":"How to take table backup in SQL Server Express","body":"<p>I have one SQL Server database table. I need to take backup of my table daily based on the date. For that I need to write a script. But I'm new to SQL Server can any one please help me.</p>\n\n<p>Thanks in advance </p>\n"},{"tags":["sql-server-2008","intellisense"],"answer_count":16,"favorite_count":23,"up_vote_count":97,"down_vote_count":0,"view_count":46680,"score":97,"question_id":552458,"title":"Why is SQL Server 2008 Management Studio Intellisense not working?","body":"<p>I'm being driven to insanity trying to figure out why Intellisense just fails to work at all. The server I'm using is local and is 2008, the database is set to 2008 compatibility, Intellisense is on in every menu I can find, and yet no member list will pop up even with a CTRL-J.</p>\n\n<p>Has anyone experienced something like this and found a way to fix it? I really can't bring myself to start work unless I have Intellisense working.</p>\n"},{"tags":["sql","sql-server-2008","jdbc"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":125,"score":0,"question_id":12581902,"title":"SQL SERVER 2008 GET LAST INSERTED VALUES","body":"<p>This is my table.</p>\n\n<pre><code>Ticket(id int auto_increment,name varchar(50));\n</code></pre>\n\n<p>after inserting into this table i want send id and name to mail..\nhow can i get the last Inserted value.</p>\n\n<p>help to solve this...</p>\n"},{"tags":["sql-server-2008","distinct"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12620842,"title":"How to select distinct on specific columns","body":"<p>I have few columns in a table</p>\n\n<p><strong>Col1</strong>, <strong>Col2</strong>, <strong>Col3</strong>, <strong>Col4</strong></p>\n\n<p>Now I want to select like this</p>\n\n<p><code>SELECT DISTINCT (Col1, Col2, Col3), Col4</code></p>\n\n<p>i.e. get the distinct based on only these three colunms.</p>\n"},{"tags":["sql-server-2008","tsql","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":146,"score":-1,"question_id":12614580,"title":"How to check if a string contains certain characters and split it in SQL Server 2008 R2?","body":"<p>I need to check the existence of following characters in a given string:</p>\n\n<pre><code>characters =('N', 'E', 'M', 'H', 'T', 'V', 'L', 'C' )\nstring = 2449.555N06704.2855EM0701H071T44.098V11.764L0.372C1\n</code></pre>\n\n<p>And if string contains these characters, then need to split them into values as following to insert them in <code>details_Tb</code>:</p>\n\n<pre><code>N = 2449.7183 \nE = 06704.2855 \nT = 0701\nH = 071\nT = 44.098\nV = 11.764\nL = 0.372\nC =  1\n</code></pre>\n\n<p>Any solution to this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":173,"score":0,"question_id":12630385,"title":"NVARCHAR TO DATETIME conversion","body":"<p>I have a parameter that has a value of <code>14-Sep-2012 15:47:27</code> that I would like to update a table column with which is in <code>2012-08-10 05:00:00.000</code> format.</p>\n\n<p>What would be the query needed '</p>\n\n<pre><code>@UpdateTime = '14-Sep-2012 15:47:27'\n\nUpdate tbl \nSet Datetimecol = CONVERT(datetime,@UpdateTime,110) ??\n</code></pre>\n\n<p>I am using SQL Server 2008. Thank you !</p>\n"},{"tags":["sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12614911,"title":"How can I migrate a SQL Server 2005 database to SQL Server 2008?","body":"<p>I am trying to migrate my one SQL Server 2005 database to SQL Server 2008, with various option, like Script Database.</p>\n\n<p>I am able to create table structure but without any objects like data, functions, stored procedure.... </p>\n\n<p>How can I do this? I tried to copy <code>.mdf</code> and <code>.ldf</code> file and put them into 2008 folder, but this is also not working.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":105,"score":3,"question_id":12620996,"title":"Next/previous record based on current","body":"<p>I have a table which is not sorted by any of column. Is there any way to select next/previous record if I know only Id of current? (I'm using mssql)</p>\n\n<pre><code>Id     Label     Date\n---------------------\n1      label1    2011-01-10\n7      label2    2011-01-15 -- how to get previous?\n5      label3    2011-01-12 -- I know id of this record\n10     label10   2011-01-25 -- how to get next?\n12     label8    2011-01-13\n2      label5    2011-01-29\n</code></pre>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server-2008","count"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":137,"score":2,"question_id":12372708,"title":"SQL Count to include zero values","body":"<p>I have created the following stored procedure that is used to count the number of records per day between a specific range for a selected location:</p>\n\n<pre><code>[dbo].[getRecordsCount] \n@LOCATION as INT,\n@BEGIN as datetime,\n@END as datetime\n\nSELECT\nISNULL(COUNT(*), 0) AS counted_leads, \nCONVERT(VARCHAR, DATEADD(dd, 0, DATEDIFF(dd, 0, Time_Stamp)), 3) as TIME_STAMP \nFROM HL_Logs\nWHERE Time_Stamp between @BEGIN and @END and ID_Location = @LOCATION\nGROUP BY DATEADD(dd, 0, DATEDIFF(dd, 0, Time_Stamp))\n</code></pre>\n\n<p>but the problem is that the result does not show the days where there are zero records, I pretty sure that it has something to do with my WHERE statement not allowing the zero values to be shown but I do not know how to over come this issue.</p>\n\n<p>Thanks in advance\nNeil</p>\n"},{"tags":["sql-server-2008","hadoop","hive","sqoop"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":76,"score":2,"question_id":12631239,"title":"sqoop hangs when importing a table from sql server","body":"<p>I am trying to import a simple table into hive from a SQL Server 2008 R2 database.</p>\n\n<pre><code>Hadoop version - CDH3U3\nSqoop version - 1.3.0-cdh3u3\n$SQOOP_HOME/lib - sqljdbc4.jar\n$SQOOP_HOME/lib - sqoop-sqlserver-1.0.jar\n$SQOOP_CONF_DIR/managers.d/mssqoop-sqlserver\n\nWindows firewall - disabled\nLinux IPTables - disabled\n</code></pre>\n\n<p>My import command is -</p>\n\n<pre><code>sqoop import --connect 'jdbc:sqlserver://172.16.1.47;username=sa;password=asdf1234;database=test' --table bruce --hive-import --verbose\n</code></pre>\n\n<p>I don't see any error messages, but it just hangs forever.  If I look in the SQL Server Activity Monitor, I can see that there is a process being created.</p>\n\n<p>Here is the sqoop output -<br></p>\n\n<pre><code>[root@sc-qa-test-01 bruce]# ./sqoop_test_sqlserver.sh&lt;br&gt;\nWarning: /usr/lib/hbase does not exist! HBase imports will fail.&lt;br&gt;\nPlease set $HBASE_HOME to the root of your HBase installation.&lt;br&gt;\n12/09/27 15:37:58 DEBUG tool.BaseSqoopTool: Enabled debug logging.&lt;br&gt;\n12/09/27 15:37:58 INFO tool.BaseSqoopTool: Using Hive-specific delimiters for output. You can override&lt;br&gt;\n12/09/27 15:37:58 INFO tool.BaseSqoopTool: delimiters with --fields-terminated-by, etc.&lt;br&gt;\n12/09/27 15:37:58 DEBUG sqoop.ConnFactory: Added factory com.microsoft.sqoop.SqlServer.MSSQLServerManagerFactory specified by /usr/lib/sqoop/conf/managers.d/mssqoop-sqlserver&lt;br&gt;\n12/09/27 15:37:58 DEBUG sqoop.ConnFactory: Loaded manager factory: com.microsoft.sqoop.SqlServer.MSSQLServerManagerFactory&lt;br&gt;\n12/09/27 15:37:58 DEBUG sqoop.ConnFactory: Loaded manager factory: com.cloudera.sqoop.manager.DefaultManagerFactory&lt;br&gt;\n12/09/27 15:37:58 DEBUG sqoop.ConnFactory: Trying ManagerFactory: com.microsoft.sqoop.SqlServer.MSSQLServerManagerFactory&lt;br&gt;\n12/09/27 15:37:58 INFO SqlServer.MSSQLServerManagerFactory: Using Microsoft's SQL Server - Hadoop Connector&lt;br&gt;\n12/09/27 15:37:58 INFO manager.SqlManager: Using default fetchSize of 1000&lt;br&gt;\n12/09/27 15:37:58 DEBUG sqoop.ConnFactory: Instantiated ConnManager com.microsoft.sqoop.SqlServer.MSSQLServerManager@15aaf0b3&lt;br&gt;\n12/09/27 15:37:58 INFO tool.CodeGenTool: Beginning code generation&lt;br&gt;\n12/09/27 15:37:58 DEBUG manager.SqlManager: No connection paramenters specified. Using regular API for making connection.&lt;br&gt;&lt;br&gt;\n</code></pre>\n\n<p>Any suggestions would be greatly appreciated.</p>\n"}]}
{"total":21074,"page":18,"pagesize":100,"questions":[{"tags":["sql-server-2008","tsql","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12630475,"title":"Full Text Near with Max Distance Syntax in SQL Server 2008","body":"<p>I'm trying to write a full text search using a near proximity term with a max distance.  </p>\n\n<p>From what I can tell of the grammer...</p>\n\n<pre><code>    &lt;custom_proximity_term&gt; ::= \n  NEAR ( \n     {\n        { &lt;simple_term&gt; | &lt;prefix_term&gt; } [ ,…n ]\n     |\n        ( { &lt;simple_term&gt; | &lt;prefix_term&gt; } [ ,…n ] ) \n      [, &lt;maximum_distance&gt; [, &lt;match_order&gt; ] ]\n     }\n       ) \n\n      &lt;maximum_distance&gt; ::= { integer | MAX }\n      &lt;match_order&gt; ::= { TRUE | FALSE } \n</code></pre>\n\n<p>...I should be able to use <code>NEAR</code> like such:</p>\n\n<pre><code>'NEAR(term1,term2,5)'\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>'NEAR((term1,term2),5)'\n</code></pre>\n\n<p>However always throws a syntax error.</p>\n\n<pre><code>Syntax error near '(' in the full-text search condition 'NEAR((term1, term2), 4, TRUE)'.\n</code></pre>\n\n<p>Even when i try to copy the exact search from a microsoft Example it throws an error:</p>\n\n<pre><code>USE AdventureWorks2012\nGO\n\nSELECT DocumentNode, Title, DocumentSummary\nFROM Production.Document AS DocTable \nINNER JOIN CONTAINSTABLE(Production.Document, Document,\n  'NEAR(bracket, reflector)' ) /* doesn't like this */ AS KEY_TBL\n  ON DocTable.DocumentNode = KEY_TBL.[KEY]\nWHERE KEY_TBL.RANK &gt; 50\nORDER BY KEY_TBL.RANK DESC\nGO\n\nSyntax error near '(' in the full-text search condition 'NEAR(bracket, reflector)'.\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12626961,"title":"How to run multiple tasks in single data flow task in SSIS project","body":"<p>i have an issue that , i ran multiple data flow tasks in single control flow, if 5 out of 5 source alive it works fine but any one source is dead, it is not executing remaining 4 source flows,how to run which ever is alive should run smoothly when ever we are executing the job</p>\n"},{"tags":["c#","sql-server-2008","tsql","ado.net","cursor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":396,"score":0,"question_id":11034970,"title":" Cursor as an output parameter","body":"<p>I have a stored procedure in SQL Server 2008 R2 that returns a Cursor as an OUTPUT value. Is it possible to return this Cursor to a C# application using the .NET 4.0 framework?</p>\n\n<p>My Stored procedure has the following signature:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[MyProcedure]\n      @nuserid    int,\n      @nfetchtype int,\n      @returncursor CURSOR VARYING OUTPUT\nAS\n...\n</code></pre>\n\n<p>At the end of the stored procedure I have</p>\n\n<pre><code>...\n    set @returncursor = CURSOR FORWARD_ONLY STATIC for SELECT * FROM MyTable WHERE          column=@Value\n    open @returncursor\nEND\n</code></pre>\n\n<p>In my C# Web Application, I use a wrapper that utilizes System.Data.DbType and I set my return value/parameter as DbType.Object. When I execute the query against the database, I get the following error:</p>\n\n<blockquote>\n  <p>Operand type clash: sql_variant is incompatible with cursor</p>\n</blockquote>\n\n<p>This DbType.Object parameter will work for a REFCURSOR in Oracle but I'm curious to see if there is a way to do the same for SqlServer. My goal is to have stored procedures in both SqlServer and Oracle that have the exact same signature.</p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12606134,"title":"How do I move subreports into their own folder?","body":"<p>SSSRS 2008 R2</p>\n\n<p>My BIDS project has a few reports but those reports reference a large number of subreports. How do I move all the subreports into their own folder and reference them in the body of my main report? </p>\n\n<p>I tried creating a folder and manually moving the subreports into it. That didn't work. BIDS couldn't find the subreports and the folder didn't appear in the project structure.</p>\n"},{"tags":["sql-server-2008","tsql","sql-server-2008-r2","sql-server-2012"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12629092,"title":"Named stored proc parameters and concatenation","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4936180/cast-integer-and-concatenate-to-varchar-in-tsql\">Cast integer and concatenate to varchar in TSQL</a>  </p>\n</blockquote>\n\n\n\n<p>How do you call a stored procedure using named parameters that have more complex values. Here is a somewhat concocted example:</p>\n\n<pre><code>EXEC MyStoredProc @Param1='My name is: '+@Name\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>EXEC MyStoredProc @Param1=CONCAT('My name is: ',@Name)\n</code></pre>\n\n<p>I get an error trying to concatenate the literal string 'My name is: ' with the variable @Name. Parentheses do not help the matter any. Is this a limitation of T-SQL (i.e., when named parameters are used, the expression after the equal sign must be a single literal or variable)?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","django","sql-server-2008","django-models","django-mssql"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":143,"score":0,"question_id":12155540,"title":"Django SQL Server Error: \"Cannot create new connection because in manual or distributed transaction mode.\"","body":"<p>I have some strange issue with querying SQL Server from django.</p>\n\n<p>When I query db twice in single request, I got errors in some cases. Namely when first db query returns big amount of data, we end up with error while querying db second time.</p>\n\n<p><strong>Details:</strong></p>\n\n<p>We're using Microsoft SQL Server backend for Django (https://bitbucket.org/Manfre/django-mssql/src) running on windows. </p>\n\n<p>We want allow user to filter data from some table (\"Activity\") via form, display it on the website's table and then show related data from another table (\"Frames\") on map. </p>\n\n<pre><code>class Frames(models.Model):\n...\n\nclass Activity(models.Model):\nframe_from = models.ForeignKey(Frames, ...)\n...\n</code></pre>\n\n<p>The problem is: when we want to filter larger amount of data from Activity (let's say 200rows x 6 colums), we can not make other queries in the same request on table Frames (MARS is turned on in Django settings.py): </p>\n\n<pre><code>result = Aktywnosci.objects.filter(qset1) \n</code></pre>\n\n<p>is always ok, but </p>\n\n<pre><code>path = Frames.objects.filter(qset2) \n</code></pre>\n\n<p>when the previous query returned larger amount of data, raises OLE DB Error: </p>\n\n<blockquote>\n  <p><em>'Microsoft OLE DB Provider for SQL Server' Error: Cannot\n  create new connection because in manual or distributed transaction mode.</em></p>\n</blockquote>\n\n<p>PS. Database settings from <code>settings.py</code>:</p>\n\n<pre><code># Database for this installation. \nDATABASES = {\n'default':{\n    'ENGINE': 'django.db.backends.sqlserver_ado', \n    'NAME': '***',                      \n    'USER': '***',                      \n    'PASSWORD': '***',                  \n    'HOST': '***',                      \n    'PORT': '',                        \n    'OPTIONS' : {\n        'provider': 'SQLOLEDB',\n        'use_mars': True,                    \n          }\n}\n}\n</code></pre>\n\n<p>PS2. I came across this issue on the google-code page of djang-mssql: <a href=\"http://code.google.com/p/django-mssql/issues/detail?id=79\" rel=\"nofollow\">http://code.google.com/p/django-mssql/issues/detail?id=79</a> - but it seems to be solved in new version of package...</p>\n\n<p>What can I do about it?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["asp.net","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12607270,"title":"SQL column showing -1 if column is nothing inserted","body":"<p>In my SQL Server table, if the column value(integer) is nothing it's inserting value is -1. If i select all column values from table and showing on ASP.net grid it is showing -1 on specified column. I don't want to show it as -1 it need show like some thing like \"null or none\". How can get this?</p>\n"},{"tags":["sql-server-2008","group-by","aggregate-functions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12626465,"title":"SQL Server Split Datetime for Day-Hourly Query?","body":"<p>SQL Server 2008.</p>\n\n<pre><code>declare @pardate table ( pardateid int, pardatewhen datetime2(3) )\ninsert into @pardate values ( 1 , '2011-09-17 12:43' )\ninsert into @pardate values ( 2 , '2011-09-17 12:44' )\ninsert into @pardate values ( 3 , '2011-10-11 12:45' )\ninsert into @pardate values ( 4 , '2011-10-12 12:46' )\ninsert into @pardate values ( 5 , '2011-10-13 12:47' )\ninsert into @pardate values ( 6 , '2011-11-20 12:48' )\ninsert into @pardate values ( 7 , '2011-11-21 12:49' )\ninsert into @pardate values ( 8 , '2011-11-22 12:50' )\ndeclare @child table ( childid int , pardateid int , childvalue char(6) )\ninsert into @child values ( 1 , 1 , 'aaaaaa' )\ninsert into @child values ( 2 , 2 , 'bbbbbb' )\ninsert into @child values ( 3 , 3 , 'cccccc' )\ninsert into @child values ( 4 , 4 , 'dddddd' )\ninsert into @child values ( 5 , 5 , 'cccccc' )\ninsert into @child values ( 6 , 6 , 'cccccc' )\ninsert into @child values ( 7 , 7 , 'eeeeee' )\ninsert into @child values ( 8 , 8 , 'ffffff' )\n\nselect pardatewhen , childvalue , COUNT(childvalue)\nfrom @child childtable join @pardate parenttable on childtable.pardateid=parenttable.pardateid\ngroup by pardatewhen , childvalue\n</code></pre>\n\n<p>I am trying to get a count of @child.childvalue every day, every hour, so there would be 8760 rows in my result.\nFirst pass had a loop and a CONVERT which takes ~5 minutes to run with the actual result set (this is just a sample for illustation). I did create a CTE to make a calendar temp table (using <a href=\"http://www.sqlpointers.com/2006/07/generating-temporary-calendar-tables.html\" rel=\"nofollow\">http://www.sqlpointers.com/2006/07/generating-temporary-calendar-tables.html</a>), and thought it could be joined somehow to add \"empty values\" into the result set.</p>\n\n<p>I need to get a result set that looks like this</p>\n\n<pre><code>date          hour    count\n...\n2011-09-17    0       0\n....\n2011-09-17    12      2\n....\n2011-10-11    12      1\n</code></pre>\n\n<p>How can that be done efficiently?</p>\n\n<p>Thanks.</p>\n"},{"tags":[".net","sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12625775,"title":"How to find all child of a table column in sql server table?","body":"<p>I have a sql database table</p>\n\n<pre><code>CREATE TABLE [dbo].[LedgerGroups](\n    [GroupName] [varchar](50) NOT NULL primary key,\n    [GroupParent] [varchar](50) NULL\n)\n</code></pre>\n\n<p>The records in the table are</p>\n\n<p><em><strong><code>-----GroupName------   ---GroupParent---</code></em></strong></p>\n\n<pre><code>Bangalore Customers    Karnataka Customers\nChennai Customers      Tamilnadu Customers\nCustomers              NULL\nErnakulam Customers    Kerala Customers\nHubli Customers        Karnataka Customers\nKarnataka Customers    Customers\nKerala Customers       Customers\nKollam Customers       Kerala Customers\nNagercoil Customers    Tamilnadu Customers\nSuppliers              NULL\nTamilnadu Customers    Customers\nTirunelveli Customers  Tamilnadu Customers\n</code></pre>\n\n<p>How can i query the table so that i can get all the child of a particular value. For ex, if i give <code>Customers</code> it should return all rows whose parent is Customers and childs of its childs and so on..</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12625592,"title":"SSIS- New Column","body":"<p>I have one text file which have 4 columns and I have to create 9 column from it.</p>\n\n<p>example</p>\n\n<p>Input</p>\n\n<pre><code>id,\nno,\nproduct, \nquantity\n</code></pre>\n\n<p>Derived column</p>\n\n<pre><code>id, \nno,\nproduct, \nquantity,\nid_out,\nno_out,\nproduct_out, \nquantity_out,\nType\n</code></pre>\n\n<p>Here I took all four Out rows form inputs but Type is not related to Input. It will filled by reference text files later on.\nSo could you please tell me how I can add new column?</p>\n\n<p>Appreciate your efforts.</p>\n\n<p>Thank You,</p>\n\n<p>343</p>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":51,"score":-2,"question_id":12590218,"title":"How do I select from a row having the maximum value in Report Builder?","body":"<p>I have a gauge report built in SSRS that shows the weighted average and average of a data set returned from an SP.  In addition, I would like to show which row has the max/min values.  I can easily pull the max/min values but not the description to go along with that value.  Any ideas?</p>\n"},{"tags":["c#",".net","sql-server-2008","entity-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":12625453,"title":"How do SQL Server computed columns work in EntityFramework?","body":"<p>I have a table whose column <code>TotalAmount</code> is a computed column from columns <code>Amount+Extra</code>, so how this computation works, if I use Entity Framework on this table?</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#","sql-server-2008","dll","settings"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":12626838,"title":"Providing Settings for a DLL","body":"<p>All, firstly I am aware of this very useful question and related answers  <a href=\"http://stackoverflow.com/questions/594298/c-sharp-dll-config-file\">C# Dll config file</a>. However, I need some advice on the best way to proceed in my specific case. </p>\n\n<p>I have a large application that uses embedded SQL. To make the burden of writing SQL easier I have developed an SQL Editor facility with a built in snippet library and other such niceties, alleviating users of the burden of launching Management Studio each time they want to test a query and providing a library of common commands. This utility is a good tool I may want to embed in other apps so I have made it a DLL. Now what are my options for storing the setting for this application? </p>\n\n<ol>\n<li><p>Creating the settings using a .config file in the main application and pass a properties object to the DLL; which is saved by the main app on DLL closure. In this case (probably my best option) is there a pattern I can use to handle changes to my editors settings?.</p></li>\n<li><p>Create a .config for the DLL and store the settings in the same place regardless of the calling app. [note, I have seen the problems with doing this in the linked question - I am only likely to ever have the DLL called from a single app].</p></li>\n<li><p>Any other magical ways?</p></li>\n</ol>\n\n<p>Thanks for your time.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":341,"score":1,"question_id":12619014,"title":"Remote Procedure call failed with sql server 2008 R2","body":"<p>I am working with SQL Server 2008 R2. I am unable to connect to my database remotely. I got the following error.</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while establishing a connection \n  to SQL Server. The server was not found or was not accessible. Verify that the instance \n  name is correct and that SQL Server is configured to allow remote connections.<br>\n  (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</em></p>\n</blockquote>\n\n<p>I have checked the SQL Server properties and I enable the <strong>Allow remote connections</strong>.</p>\n\n<p>I have checked the Service manager and <strong>SQL Server service</strong> are running.</p>\n\n<p>I have checked the configuration manager, I can't see any services under SQL Server Services\nand it shows <strong>Remote Procedure call failed</strong> </p>\n\n<p><img src=\"http://i.stack.imgur.com/wuet1.png\" alt=\"enter image description here\"></p>\n\n<p>So please guide me.</p>\n"},{"tags":["sql-server-2008","stored-procedures","database-schema"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":132,"score":0,"question_id":12622920,"title":"List all stored procedures with schema name","body":"<p>Can anyone please advise on a way to retrieve a listing of all stored procedures along with their schema names in a database? Thanks for your input!</p>\n"},{"tags":["sql-server-2008","merge","updates"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12624693,"title":"SQL Server : MERGE  instead of Update","body":"<p>I'm attempting to do an update on a table, which is read-only. I received an error message regarding the use of merge only. Most of the examples online of using merge with a select into, etc. though. I'm looking for the simplest update statement replacement - I don't need to merge an entire table, etc.</p>\n\n<pre><code>update table1 set value = 'asdf' where id = 100`\n</code></pre>\n\n<p>Is the only way to use a merge in this case to create a temp table w/ my 'asdf' value and merge that into my target table?</p>\n\n<p>Another solution might involve removing the read-only attribute for my transaction. I don't know how to do this though.</p>\n\n<p>Thank you in advance for any help!</p>\n"},{"tags":["c#","visual-studio-2010","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":12623274,"title":"Create SQL Server database in Visual Studio for a Winforms app","body":"<p>I need in education to do win-forms app, recently I done project on asp.net, there I created without any problem new SQL Server database and send it to SQL Server, and added it to project.</p>\n\n<p>But how can I do this using simple windows forms? Are there any good tutorials? (also I need something like db designer).</p>\n\n<p>On asp.net mvc I use linq...  But couldn't find good tutorial for create, send and attach SQL Server database on winforms.</p>\n\n<p>I do this with .net 4.0 and SQL Server 2008 and Microsoft Visual Studio 2010</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":66,"score":2,"question_id":12626386,"title":"Stored procedure output parameter returns @Value","body":"<p>I'm struggling with this thing for the past hour and I'm sure I'm missing something small, I have a stored procedure in SQL Server 2008 and C# code that I want to return the output parameters of my stored procedure. </p>\n\n<p>SQL :</p>\n\n<pre><code>Alter Procedure dbo.GetAssessment\n    @UserID int,\n    @AssessmentName varchar(255),\n    @Score varchar(100) output,\n    @Completed varchar(10) output,\n    @DisplayName nvarchar(128) output,\n    @Result varchar(2500) output\nas\nbegin\n        select @Score = A.Score, @Completed = A.Completed, @DisplayName = U.Displayname, @Result = A.Result \n        from Assessment A \n            inner join Users U\n            on U.UserId = A.UserID\n        where U.UserID = @UserId\n        and AssessmentName = @AssessmentName\n\nend\nGO\n</code></pre>\n\n<p>C#</p>\n\n<pre><code>String SScore, SName, SResult, SComp;\n            lblAsse.Text = Request.QueryString[\"AID\"];\n\n            InsertAssessment(lblAsse.Text, \"No\", 2, \"N/A\", \"N/A\");\n\n            using (SqlConnection conn = new SqlConnection(ConfigurationManager.ConnectionStrings[\"SiteSqlServer\"].ConnectionString))\n            {\n                SqlParameter outScore = new SqlParameter(\"@Score\", SqlDbType.VarChar,100){ Direction = ParameterDirection.Output };\n                SqlParameter outComp = new SqlParameter(\"@Completed\", SqlDbType.VarChar,10){ Direction = ParameterDirection.Output };\n                SqlParameter outName = new SqlParameter(\"@DisplayName\", SqlDbType.NVarChar, 128) { Direction = ParameterDirection.Output };\n                SqlParameter outResult = new SqlParameter(\"@Result\", SqlDbType.VarChar,2500){ Direction = ParameterDirection.Output };              \n\n                conn.Open();\n                SqlCommand cmd = new SqlCommand();\n                cmd.Connection = conn;\n                cmd.CommandType = System.Data.CommandType.StoredProcedure;\n                cmd.CommandText = \"GetAssessment\";\n                cmd.Parameters.AddWithValue(\"@AssessmentName\", lblAsse.Text);\n                cmd.Parameters.AddWithValue(\"@UserId\", 2);\n                cmd.Parameters.Add(outScore);\n                cmd.Parameters.Add(outComp);\n                cmd.Parameters.Add(outName);\n                cmd.Parameters.Add(outResult);\n                cmd.ExecuteScalar();\n\n                SScore = outScore.ToString();\n                SName = outName.ToString();\n                SResult = outResult.ToString();\n                SComp = outComp.ToString();\n\n                conn.Close();\n\n                lblAsse.Text = SScore;`\n</code></pre>\n\n<p>Output :</p>\n\n<pre><code>@Score\n</code></pre>\n\n<p>What can possibly be wrong with me or my code. Please help!</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12625938,"title":"Which query has better performance - where clause with case statement?","body":"<p>Cars is a table that has a column CarType. CarType is non-null and can contain 2 values. CarDonated and CarSold.</p>\n\n<p>We pass in a parameter from a report to include either all CarTypes, or a specific CarType (such as CarDonated). </p>\n\n<p>The parameter in scenario 1 passes in either 'Car' (for all CarTypes), 'CarD' for CarDonated, 'CarS' for CarSold.</p>\n\n<pre><code>select *\nfrom Cars c\nwhere c.CarType like @CarTypeParam + '%'\n</code></pre>\n\n<p>OR</p>\n\n<p>The parameter in scenario 2 passes in '0' (for all CarTypes), 'CarDonated', 'CarSold'</p>\n\n<pre><code>select *\nfrom Cars c\nwhere c.CarType = case when @CarTypeParam = '0' \n                   then c.CarType\n                   else @CarTypeParam \n                  end\n</code></pre>\n\n<p>Which scenario/coding method is better? I'm not too familiar with using case statements in where clauses. Is the optimizer still able to use index on the CarType in both scenarios? Which is better coded?</p>\n\n<p>SQL Server 2008 R2 (along with SSRS)</p>\n"},{"tags":["sql-server","sql-server-2008","linked-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":112,"score":1,"question_id":12619314,"title":"SQL Server Insert into linked server","body":"<p>In a procedure I control errors with <code>TRY</code> <code>CATCH</code>, but in an insert into linked server not runs for handling this errors, because try catch not run.</p>\n\n<p>How I can handling this errors?</p>\n\n<p>Example: </p>\n\n<pre><code>insert into linkedserver.database.dbo.table values ('value1','value2')\n</code></pre>\n\n<p>If the server isoffline I have error of connection of the <code>SQLCLI</code> and cannot control this error for insert in local when the linked server are offline for after when the server return to online status put the data in the remote server with another procedure.</p>\n\n<p>Thanks</p>\n\n<p>Jorge</p>\n"},{"tags":["tsql","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":6857024,"title":"How to get days dd in dd/mm/yyyy in a dateime column","body":"<p>I want to get all the <code>dd</code> in <code>dd/mm/yyyy</code> date column. How do I write the query for it? \nFor Example: If I want <code>dd</code> between <code>28/06/2011</code> to <code>02/07/2011</code>, then I should get the output like this:</p>\n\n<pre><code>28\n29\n30\n01\n02\n</code></pre>\n\n<p>Please help me through this</p>\n"},{"tags":["vb.net","sql-server-2008","sql-server-2008-r2","mirroring","database-mirroring"],"answer_count":0,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":158,"score":2,"question_id":11796952,"title":"VB.NET application not using failover partner","body":"<p>I have a VB.NET app that connects to a SQL Server.</p>\n\n<p>We recently added database mirroring in case of a server failure.</p>\n\n<p>Well of course, our SQL Server failed but the VB.NET app is not failing over.</p>\n\n<p>I found that in our code, a failover partner wasn't specified in the connection string so I updated the connection string as follows:</p>\n\n<pre><code>sConnectionString = \"Data Source=PROD-SQL;Failover Partner=FAILOVER-SQL;Initial Catalog=DB;User ID=****;Password=******;\"\n</code></pre>\n\n<p>The <code>SqlClient.SqlConnection</code> object accepts this connection string but when I call its <code>.Open()</code> command it fails with the following error:</p>\n\n<pre><code>\"A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)\"\n</code></pre>\n\n<p>Why is this?  Our intranet apps failed over just fine (Classic ASP using DSN-less connections).</p>\n\n<p>Does the application have to make at least one successful initial connection to the primary server before it can failover successfully?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server-2008","jointable"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":12331457,"title":"Sql server 2008 join query in a view","body":"<p>Please help. I have the below SQL code and it keeps getting errors:</p>\n\n<pre><code>create view vwUpcoming\nas \n    Select a.Auction_ID, b.item_name, b.Item_Description, \n        b.Item_value, a.Expected_Start_time\n    from  Auction_schedule a \n    join Item b \n        on Auction.Item_ID= Item.Item_ID \n    where a.Expected_Start_Time &lt; CURRENT_TIMESTAMP\n</code></pre>\n\n<p>The error message is:</p>\n\n<blockquote>\n  <p>Msg 4104, Level 16, State 1, Line 2<br>\n  The multi-part identifier \"Item.Item_ID\" could not be bound.<br>\n  Msg 4104, Level 16, State 1, Line 2<br>\n  The multi-part identifier \"Auction.Item_ID\" could not be bound.</p>\n</blockquote>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":118,"score":2,"question_id":11841608,"title":"Configuring Report Server for form authentication ","body":"<p>I'm using ReportViewer for connecting to report server. Windows authenticaton works well.. but when I used credentials to authenticate to report server I got the error:</p>\n\n<blockquote>\n  <p>The request failed with HTTP status 401: Unauthorized.</p>\n</blockquote>\n\n<p>I know I need to configure the report server to accept those credentials, but I don't know actually what it is. Yes I have gone through msdn as well as stack questions too. I'm a complete beginner to SSRS and I want to integrate report server into my web application. what I have done in my application page is:</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>protected void Page_Load(object sender, EventArgs e)\n{\n    //    if (!IsPostBack)\n    //    {\n            ReportViewer1.ServerReport.ReportServerCredentials =\n             new MyReportServerCredentials();\n        //    ReportViewer1.ServerReport.Refresh();\n        //}\n    }\n}\n\n[Serializable]\npublic sealed class MyReportServerCredentials : IReportServerCredentials\n{\n    public WindowsIdentity ImpersonationUser\n    {\n        get\n        {\n            // Use the default Windows user.  Credentials will be\n            // provided by the NetworkCredentials property.\n            return null;\n        }\n    }\n\n    public ICredentials NetworkCredentials\n    {\n        get\n        {\n            // Read the user information from the Web.config file.  \n            // By reading the information on demand instead of \n            // storing it, the credentials will not be stored in \n            // session, reducing the vulnerable surface area to the\n            // Web.config file, which can be secured with an ACL.\n\n            // User name\n            string userName =\n                ConfigurationManager.AppSettings\n                    [\"MyReportViewerUser\"];\n\n            if (string.IsNullOrEmpty(userName))\n                throw new Exception(\n                    \"Missing user name from web.config file\");\n\n            // Password\n            string password =\n                ConfigurationManager.AppSettings\n                    [\"MyReportViewerPassword\"];\n\n            if (string.IsNullOrEmpty(password))\n                throw new Exception(\n                    \"Missing password from web.config file\");\n\n            // Domain\n            string domain =\n                ConfigurationManager.AppSettings\n                    [\"MyReportViewerDomain\"];\n\n            if (string.IsNullOrEmpty(domain))\n                throw new Exception(\n                    \"Missing domain from web.config file\");\n\n            return new NetworkCredential(userName, password, domain);\n        }\n    }\n\n    public bool GetFormsCredentials(out Cookie authCookie,\n                out string userName, out string password,\n                out string authority)\n    {\n        // not use FormsCredentials unless you have implements a custom autentication.\n        authCookie = null;\n        userName = null;\n        password = null;\n        authority = null;\n\n        // Not using form credentials\n        return false;\n    }\n}\n</code></pre>\n\n<p>And in the <code>RsReportServer.config</code> file I modified and replaced the <code>&lt;authentication&gt;</code> node with:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;Authentication&gt;\n      &lt;AuthenticationTypes&gt;\n             &lt;Custom /&gt;\n      &lt;/AuthenticationTypes&gt;\n      &lt;EnableAuthPersistence&gt;true&lt;/EnableAuthPersistence&gt;\n&lt;/Authentication&gt;\n</code></pre>\n\n<p>And in <code>web.config</code> file of reportserver I changed authentication to forms and impersonate to false, and I did the same in <code>web.config</code> file of reportmanager .</p>\n\n<p>Anything missing. or am I right?</p>\n\n<p>I also guess I need to do something with CustomSecurity Extension term?</p>\n"},{"tags":["sql","sql-server-2008","date","time"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":120,"score":0,"question_id":12568408,"title":"How to convert an integer (time) to HH:MM:SS::00 in SQL Server 2008?","body":"<p>Here I have a table with a <code>time</code> column (datatype is <code>integer</code>), now I need to convert the integer value to time format <code>HH:MM:SS:00</code> in SQL Server 2008.</p>\n\n<p>Also need clarification in the above <code>time</code> format, whether 00 represents milliseconds?  </p>\n\n<p>Please help on this.</p>\n\n<p>example: 23421155 represents 23:42:11:55; 421151 represents 00:42:11:51</p>\n\n<p>Hope that it is clear now.</p>\n"},{"tags":["sql-server","sql-server-2008","database-design"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12615852,"title":"Table design for Holiday with alternate working day","body":"<p>I have a table design for Holiday list. if any illegal holiday comes (say All India bundh) we need to give altenate working day. how to design the table for alternate working day?</p>\n\n<pre><code>SELECT [HolidayID]\n  ,[HolidayName]\n  ,[HolidayDate]\n   ,[LocationID]\nFROM [Holiday]\n</code></pre>\n"},{"tags":["sql","sql-server-2008","join","sum"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":91,"score":5,"question_id":12620802,"title":"Incorrect sum when I join a second table","body":"<p>This is the first time I ask for your help,</p>\n\n<p>Actually I have to create a query, and did a similar example for it. I have two tables, </p>\n\n<pre><code>Report (ReportID, Date, headCount)\nProduction(ProdID, ReportID, Quantity)\n</code></pre>\n\n<p>My question is using this query, I get a wrong result, </p>\n\n<pre><code>SELECT    \n    Report.date, \n    SUM(Report.HeadCount) AS SumHeadCount, \n    SUM(Production.Quantity) AS SumQuantity\nFROM         \n    Report \nINNER JOIN\n    Production ON Report.ReportID = Production.ReportID\nGROUP BY\n    Date\nORDER BY\n    Date\n</code></pre>\n\n<p>I guess some rows are being counted more than once, could you please give me a hand?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>if i run a query to get a sum of headcount grouped by day, I get:</p>\n\n<pre><code>  date        Headcount\n7/2/2012    1843\n7/3/2012    1802\n7/4/2012    1858\n7/5/2012    1904\n</code></pre>\n\n<p>also for Production Qty I get:</p>\n\n<pre><code>2012-07-02  8362\n2012-07-03  8042\n2012-07-04  8272\n2012-07-05  9227\n</code></pre>\n\n<p>but when i combine the both queries i get i false one, i expect on 2 july 8362 qty against 1843, but i get:</p>\n\n<pre><code> day      TotalHeadcount    totalQty\n7/2/2012    6021    8362\n7/3/2012    7193    8042\n7/4/2012    6988    8272\n7/5/2012    7197    9227\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12620229,"title":"Get the list of tables created on any date?","body":"<p>I stuck in a situation where I want to find which tables I've created on sql server on date 14 september 2012 (14/09/2012).</p>\n\n<p>Is there any query which will list these tables are created on this date.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":113,"score":-2,"question_id":12572674,"title":"An expression of non-boolean type specified in a context where a condition is expected, near... TABLE","body":"<p>What I am trying to do is based on the company_id (@company_id) which has a corresponding database name (@db_name), trying to pull data based on those variables.  I have over 30 tables and need to view data based on which company_id(s) are selected. </p>\n\n<p>i.e. EXEC journal_entries_by_dbase;1'1' </p>\n\n<pre><code>    ALTER PROC esh_journal_entries_by_dbase\n(@company_id varchar(2))\nAS\n-------------------------------------------------------\nBEGIN\nCREATE TABLE ##journal_dbase            \n(company_id varchar(8)\n, journal_description varchar(255)      \n, journal_type varchar(8)\n, date_entered varchar(10)\n, date_applied varchar(10)\n, date_posted varchar(10)\n, hold_flag varchar(8)\n, reversing_flag varchar(9)\n, intercompany_flag varchar(8)\n, domain_username varchar(255)\n, posted_flag varchar(8)\n, multi_currency_flag varchar(8)\n, home_credit decimal(20,2)\n, home_debit decimal(20,2))\n;\n-------------------------------------------------------\nDECLARE --@company_id varchar(8)\n        @db_name varchar(32)\n        , @sql varchar(8000)\n        , @drop_table varchar(200)\n        ;\n-------------------------------------------------------\nSET @db_name = 'select db_name from contrl.dbo.company where company_id = 1' --@company_id';\n\n-------------------------------------------------------\nSET @sql =\n'INSERT INTO ##journal_dbase\n   SELECT '+@company_id+'  \n   , trx.journal_description as [Description]\n   , trx.journal_type as [Journal Code]\n   , convert(varchar(12),dateadd(dd,(trx.date_entered - 639906),''1/1/1753''),101) as [Entry Date]\n   , convert(varchar(12),dateadd(dd,(trx.date_applied - 639906),''1/1/1753''),101) as [Apply Date]\n   , convert(varchar(12),dateadd(dd,(trx.date_posted - 639906),''1/1/1753''),101) as [Post Date]\n   --, trx.date_entered as [Entry Date]\n   --, trx.date_applied as [Apply Date]\n   --, trx.date_posted as [Post Date]\n   , [Hold] = CASE trx.hold_flag  \n        WHEN 0 THEN ''No''  \n        WHEN 1 THEN ''Yes'' \n        END --as hold\n   , [Trans Flag] = CASE trx.reversing_flag  \n        WHEN 0 THEN ''Standard'' \n        WHEN 1 THEN ''Reversing'' \n        END --as trans_flag\n   , [InterCo] = CASE trx.intercompany_flag  \n        WHEN 0 THEN ''No''  \n        WHEN 1 THEN ''Yes''  \n        END \n   , CASE WHEN e.domain_username NOT LIKE ''%\\%''\n        THEN e.domain_username\n        ELSE SUBSTRING(e.domain_username,5,20)  --SELECT DISTINCT domain_username FROM ECTRL..smusers\n        END AS [User Name]\n   , [Posted Flag] = CASE trx.posted_flag  \n        WHEN 0 THEN ''No''  \n        WHEN 1 THEN ''Yes''  \n        END \n   , trx.source_company_code as [Org]\n   --, SUM(bal.home_credit) as [Total Home Credit] \n   --, SUM(bal.home_debit) as [Total Home Debit]    \n   , bal.home_credit as [Total Home Credit]\n   , bal.home_debit as [Total Home Debit]\nFROM '+@db_name+'.dbo.trx trx                       \nLEFT OUTER JOIN '+@db_name+'.dbo.trxdet trxdet\n    ON trx.journal_ctrl_num = trxdet.journal_ctrl_num\nLEFT OUTER JOIN '+@db_name+'.dbo.bal bal\n    ON trxdet.account_code = bal.account_code\n--LEFT OUTER JOIN con.dbo.users e\n--  ON trx.user_id = e.user_id\n--WHERE trx.date_posted &gt; 0\n--  AND trx.date_applied &gt;= ''734503''\n--  AND trx.date_applied &lt;= ''734710'''\n    ;\n-------------------------------------------------------\nSET @company_id = 'select company_id from ewcomp' --where db_name in (@db_name)\n-------------------------------------------------------\nEXEC (@sql);\n-------------------------------------------------------\nSELECT * FROM ##journal_dbase;\n</code></pre>\n\n<p>THis is returning An expression of non-boolean type specified in a context where a condition is expected, near bal and trx and trxdet.  </p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":176,"score":2,"question_id":12621469,"title":"SQL Server : Insert stored procedure results into table based on parameters","body":"<p>I have a stored procedure <code>Test_Sp</code> which returns data in this way:</p>\n\n<pre><code> Id  Name     Age   Address  State  Country\n 1   ManiS    25     aaaa     bbb     ccc\n</code></pre>\n\n<p>This stored procedure is returning 6 columns of data, but I want to insert only the first 2 columns into a temp table..</p>\n\n<p>My temp table variable is:</p>\n\n<pre><code>Declare @testTbl Table (RowId int identity, Name nvarchar(100), Age int);\nINSERT INTO @testTbl(Name,Age) EXEC [Test_Sp] 23;\nSelect * from @testTbl;\n</code></pre>\n\n<p>But I get this error:</p>\n\n<blockquote>\n  <p>Msg 50000, Level 16, State 0, Procedure Test_Sp, Line 16<br>\n  Cannot use the ROLLBACK statement within an INSERT-EXEC statement.</p>\n</blockquote>\n\n<p>I am aware about <code>Select * into</code> &amp; if I create a temp table with same columns as stored procedure output means it will work..</p>\n\n<p>My question: is it possible to insert just two columns into a temp table variable from the stored procedure output based on parameters?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","pivot"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":130,"score":3,"question_id":12619618,"title":"Selecting Values From a table as Column Headers","body":"<p>I have a table 'propertyvalues' as follows:</p>\n\n<pre>\nID  FileID  Property  Value<br/>\n 1   x       Name      1.pdf<br/>\n 2   x       Size      12567<br/>\n 3   x       Type      application/pdf<br/>\n 4   y       Name      2.pdf<br/>\n 5   y       Size      23576<br/>\n 6   y       Type      application/pdf<br/>\n......<br/>\nand so on\n</pre>\n\n<p>How to write a SQL query on the table above to fetch a result like below</p>\n\n<pre> \nFileID  Name     Size      Type<br/>\n  x     1.pdf    12567     application/pdf<br/>\n  y     2.pdf    23576     application/pdf\n</pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1458,"score":3,"question_id":2254897,"title":"Search and replace content in stored procedures","body":"<p>I realy dont know how I could have lived without searching the text of stored procedures <a href=\"http://stackoverflow.com/questions/466130/can-you-search-sql-server-2005-stored-procedure-content\">Can you search SQL Server 2005 Stored Procedure content?</a>.</p>\n\n<p>The next big think for me would be the ability to replace some text in a couple of stored procedures. Is there a way to do this?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I use Red Gate SQL Search for searching now. Its nice but they should give me the update feature! Please!</p>\n"},{"tags":["sql-server-2008","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12620576,"title":"SQL Server trigger insert and update operation not working?","body":"<p>I am using SQL Server 2008. My trigger shown below. And I am inserting the values I didn't get any update in two tables .</p>\n\n<pre><code> CREATE TRIGGER trgAfterInserta ON AMS_33.dbo.access_event_logs\n AFTER INSERT,UPDATE \n AS           \n        declare @idams bigint;  \n        declare @id int; \n        declare @uid nvarchar(20);\n        declare @tentry datetime;\n        declare @tsn nvarchar(20);\n        declare @evtid nvarchar(20);\n        declare @audit_action nvarchar(300);\n\nselect @idams   = i.id from inserted i;\nselect @id      =  max(Rownumber) + 1   from   TAV3.dbo.access_event_logs ;  \nselect @uid    =i.USERID from inserted i;   \nselect @tentry =i.TIMESTAMPS from inserted i;   \nselect @tsn   =i.TERMINALSN from inserted i;\nselect @evtid =i.EVENTID from inserted i;\nset    @audit_action='Inserted Record -- After Insert.';\nset    @tentry = dateadd(hh,3,@tentry); \n\n\ninsert into TAV3.dbo.access_event_logs \n(Rownumber,Userid, Timeentry, Eventid, Terminalsn, Notes)\n values(@id,@uid, @tentry, @evtid, @tsn, @audit_action);\n\nupdate AMS_33.dbo.access_event_logs set Calculated=1 where id= @idams;  \n</code></pre>\n\n<p>GO</p>\n\n<p><strong>Table 1 AMS_33.dbo.access_event_logs</strong></p>\n\n<pre><code>  id    bigint  Unchecked\n  USERID    nvarchar(50)    Unchecked\n  DEPARTMENT    nvarchar(50)    Unchecked\n  TIMESTAMPS    datetime    Unchecked\n  EVENTID   nvarchar(50)    Unchecked\n  TERMINALSN    nvarchar(50)    Unchecked\n  ACCESSMETHOD  nvarchar(255)   Unchecked\n  REMARKS   nvarchar(255)   Unchecked\n  TERMINALIP    nvarchar(50)    Unchecked\n  PHOTO image   Checked\n  PHOTOSIZE int Unchecked\n  RECLOGDTM datetime    Unchecked\n  RECLOGFROMIP  nvarchar(50)    Unchecked\n  LOCALTIMESTAMP    datetime    Unchecked\n  PhotoPath nvarchar(50)    Checked\n  Calculated    int Checked\n</code></pre>\n\n<p><strong>Table 2 TAV3.dbo.access_event_logs</strong> </p>\n\n<pre><code>Rownumber   int Unchecked\nUserid  nvarchar(20)    Unchecked\nTimeentry   datetime    Unchecked\nEventid nvarchar(20)    Checked\nTerminalsn  nvarchar(20)    Unchecked\nCalculated  int Checked\nNotes   nvarchar(300)   Checked\n</code></pre>\n\n<p>Here no insert or update is performing ? </p>\n"},{"tags":["sql-server-2008","user"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":22,"score":-1,"question_id":12615482,"title":"Limited time access user in sql server 2008","body":"<p>I am trying to create a set of users in Sql server 2008 SP1 with access to database for any specific time say 12:00AM to 6:00AM . If that user try to access the database before 12:00AM or after 6:00AM the access shall be denied is there any inbuild feature for user management available.</p>\n\n<p>Thanks,\nAtul</p>\n"},{"tags":["c#","visual-studio-2010","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":66,"score":0,"question_id":12608697,"title":"what is the meaning of A trigger returned a resultset and/or was running with SET NOCOUNT OFF","body":"<p>i am getting this exception \"<strong>A trigger returned a resultset and/or was running with SET NOCOUNT OFF while another outstanding result set was active\"</strong> ,i want to know what is the meaing of that with an example and how to avoid it without set ncount on  as i need to know number of rows affected.</p>\n\n<p>here more explnation of what i am doing?\nLet us say I have a table in my SQL Server DB with the name AccNodesBal and I have 3 triggers on that table, FOR UPDATE, INSERT, and DELETE. I am using ADO.net as data layer and as you know FOR UPDATE, INSERT, and DELETE statements, the return value is the number of rows affected by the command. When a trigger exists on a table being inserted or updated, the return value includes the number of rows affected by both the insert or update operation and the number of rows affected by the trigger or triggers. For all other types of statements, the return value is -1. If a rollback occurs, the return value is also -1.</p>\n\n<p>In my application (code) I am using ExcecuteNonQuery and get the number of rows affected in an int variable and validate that it's 2 to ensure that the trigger is fired and everything is logged.</p>\n\n<p>But I am getting this error:</p>\n\n<pre><code>A trigger returned a resultset and/or was running with SET NOCOUNT OFF\nwhile another outstanding result set was active.\n</code></pre>\n\n<p>After searching I have found that I have to use <code>SET NOCOUNT ON</code> keyword in my triggers, but it will not work with my application as the trigger will not now return any values of affected rows. So does anyone know another approach to get the number of rows affected from updates statement and trigger without using <code>SET NOCOUNT ON</code>?</p>\n\n<p>here is my code</p>\n\n<p>int recCount = adpt.cmdMovementUpdate(amtType == EFG.Acc.AccNodeService.Contracts.Entities.AmountType.Debit ? 0 : Amount, amtType == EFG.Acc.AccNodeService.Contracts.Entities.AmountType.Debit ? Amount : 0, NodeID, PeriodID, Convert.ToInt16(CurrCode), Convert.ToByte(BalCurrType)); </p>\n\n<p>where adpt is tableadpter comtains my sql Update command query and it's implemented in a WCF service which is consumed by a webservice ,and the application consume this webservice .</p>\n\n<p>After searching i c that it is recommended to use set nocount on but that will not work for me as i have validation in my wcf service depeneds on result of row affected from executeNonQuery.</p>\n\n<p>Thanks</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":5,"down_vote_count":1,"view_count":196,"score":4,"question_id":12395551,"title":"Hiding statements from SQL Server Profiler (or other observers)","body":"<p>In SQL Server 2008 R2, I would like to execute a statement that I want to be invisible to the SQL Profiler or other means of observing user queries. Is there a way to control what is displayed by SQL profiler?</p>\n\n<p>I would like to execute something like:</p>\n\n<pre><code>SELECT 'MyPassword' INTO #passwordTable\n</code></pre>\n\n<p>I don't want to show 'MyPassword' through SQL Server Profiler or other means. Any ideas?</p>\n"},{"tags":["java","eclipse","sql-server-2008","database-connection","connection-string"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":12616582,"title":"JDBC connection to SQL Server: login failed for user x","body":"<p>I am trying to set a JDBC connection to Sql Server 2008. I have created a database in Sql Server with this information:</p>\n\n<pre><code>CREATE LOGIN xtest WITH PASSWORD = 'berenjenas7(((';  \nGO  \nCREATE USER samxtest FOR LOGIN xtest;  \nGO  \nGRANT SELECT TO samxtest;\nGO  \nGRANT INSERT TO samxtest;\nGO  \nGRANT UPDATE TO samxtest;\nGO  \nGRANT DELETE TO samxtest;\nGO \n</code></pre>\n\n<p>I installed the JDBC driver from here: <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=11774\" rel=\"nofollow\">http://www.microsoft.com/en-us/download/details.aspx?id=11774</a>\nand <strong>I used the connectURL class from this link: <a href=\"http://msdn.microsoft.com/en-us/library/aa342339.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/aa342339.aspx</a>\nin order to test the connection</strong>.</p>\n\n<p>I left the default port 1433 in the code. The following picture should be proof that this is really the port:\n<img src=\"http://i.stack.imgur.com/pHBLj.jpg\" alt=\"enter image description here\">\nAnd of course I changed the connection string to: </p>\n\n<pre><code>String connectionUrl = \"jdbc:sqlserver://localhost:1433;databaseName=XTest;user=samxtest;password=berenjenas7(((\";\n</code></pre>\n\n<p>I don't understand what is wrong?\nThe error I get is:</p>\n\n<blockquote>\n  <p>com.microsoft.sqlserver.jdbc.SQLServerException: Login failed for user\n  'samxtest'. ClientConnectionId:2344af.....    at\n  com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:216)\n    at\n  com.microsoft.sqlserver.jdbc.TDSTokenHandler.onEOF(tdsparser.java:254)\n    at com.microsoft.sqlserver.jdbc.TDSParser.parse(tdsparser.java:84)\n    at\n  com.microsoft.sqlserver.jdbc.SQLServerConnection.sendLogon(SQLServerConnection.java:2908)\n    at\n  com.microsoft.sqlserver.jdbc.SQLServerConnection.logon(SQLServerConnection.java:2234)\n    at\n  com.microsoft.sqlserver.jdbc.SQLServerConnection.access$000(SQLServerConnection.java:41)\n    at\n  com.microsoft.sqlserver.jdbc.SQLServerConnection$LogonCommand.doExecute(SQLServerConnection.java:2220)\n    at\n  com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:5696)\n    at\n  com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:1715)\n    at\n  com.microsoft.sqlserver.jdbc.SQLServerConnection.connectHelper(SQLServerConnection.java:1326)\n    at\n  com.microsoft.sqlserver.jdbc.SQLServerConnection.login(SQLServerConnection.java:991)\n    at\n  com.microsoft.sqlserver.jdbc.SQLServerConnection.connect(SQLServerConnection.java:827)\n    at\n  com.microsoft.sqlserver.jdbc.SQLServerDriver.connect(SQLServerDriver.java:1012)\n    at java.sql.DriverManager.getConnection(Unknown Source)     at\n  java.sql.DriverManager.getConnection(Unknown Source)  at\n  connectURL.main(connectURL.java:18)</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":12616345,"title":"merge two views","body":"<p>I have two views A and B both with the same columns names <code>StudentID, FeeToBePaid, AmountPaid</code>. In both views <code>StudentID</code> is the same. But columns <code>FeeToBePaid</code> and <code>AmountPaid</code> are different.</p>\n\n<p>I want to replace rows from B with rows from A <code>if A.FeeToBePaid &lt;= A.AmountPaid</code> with same <code>studentID</code>.</p>\n\n<p>View A</p>\n\n<pre><code>SchoolStudentID     sFeeToBePaid     amountpaid\n12-S-3003             1000.00         1000.00   \n</code></pre>\n\n<p>View B</p>\n\n<pre><code>SchoolStudentID   sFeeToBePaid   amountpaid\n  12-S-3003         1000.00        0.00 \n  11-F-2019         NULL           1000.00\n  12-S-3009         NULL           1000.00\n</code></pre>\n\n<p>i need the answer to be</p>\n\n<p><code>SchoolStudentID</code>   <code>sFeeToBePaid</code>   <code>amountpaid</code></p>\n\n<pre><code>  12-S-3003         1000.00        1000.00\n  11-F-2019         NULL           1000.00\n  12-S-3009         NULL           1000.00\n</code></pre>\n"},{"tags":["sql-server","vb.net","sql-server-2008","exchange"],"answer_count":1,"favorite_count":2,"up_vote_count":9,"down_vote_count":0,"view_count":502,"score":9,"question_id":9975410,"title":" Import Email from AD Mailbox","body":"<p>We have an old legacy SQL 2000 server (the last in the farm) – We’ve been unable to get rid of this server as it uses <code>xp_findnextmsg</code>, <code>xp_readmail</code> etc to monitor a mailbox (via mapi) and import all email to that address into a database. The database contains simple tables that store \"from\", \"to\", \"subject\", \"body\", \"Sent Date\" &amp; so on.</p>\n\n<p>As you may know, the procs above are no longer in use in SQL 2005+</p>\n\n<p>This table is read from dozens of internal systems, for instance emails to this mailbox can be automatically picked up by our helpdesk systems &amp; create calls etc.</p>\n\n<p>My question is this: what it the easiest / modern way of doing this in SQL 2008+? Is it going to be a case of writing a .net binary / service that will use smtp or something to connect to a mailbox and insert the data into SQL or is there a simpler way to do it? (SSIS / 3rd party tools / pre-existing code / projects?)</p>\n\n<p>Just thought I’d ask before i start writing something – no point re-inventing the wheel as it were.</p>\n\n<p>PS: The Mailbox in question is an exchange 2010 mailbox.</p>\n\n<p><strong>Edit:</strong> This functionality was hinted to be re-introduced in 2008 &amp; dbmail: <a href=\"http://connect.microsoft.com/SQLServer/feedback/details/126167/xp-readmail-replacement-for-sql-2005\" rel=\"nofollow\">http://connect.microsoft.com/SQLServer/feedback/details/126167/xp-readmail-replacement-for-sql-2005</a> but it looks like it failed to materialise!</p>\n\n<p><strong>Edit 2</strong>: I've just found a decent code sample here that utilises the new web services in exchange 2007+: <a href=\"http://social.msdn.microsoft.com/forums/en-US/sqltools/thread/dd2b465b-b1d2-4c0d-82ec-c36c6c482d5d\" rel=\"nofollow\">http://social.msdn.microsoft.com/forums/en-US/sqltools/thread/dd2b465b-b1d2-4c0d-82ec-c36c6c482d5d</a> - experimenting in progress (has anyone ever worked with SQL and the Exchange web services?)</p>\n\n<p><strong>Edit 3</strong>: All done! I knocked up a .net service that sits on our exchange server and monitors a mailbox &amp; pushes any new mail into SQL. Incase others have a similar question and need some sample code to get started - here is some rough code (chopped out of my service - replaced parameterised SQL with basic dynamic SQL for easy reading): (Note: you’ll need the EWS API 1.1 dll)</p>\n\n<pre><code>Imports Microsoft.Exchange.WebServices.Data\n\nDim ExchangeUrl As String = \"https://DOMAIN.co.uk/ews/exchange.asmx\"\nDim service As New ExchangeService(ExchangeVersion.Exchange2010_SP1)\nservice.Url = New Uri(ExchangeUrl)\nservice.Credentials = New WebCredentials(\"USER@DOMAIN.CO.UK\", \"PASSWORD\")\nDim findResults As FindItemsResults(Of Item) = service.FindItems(WellKnownFolderName.Inbox, New ItemView(1000))\nIf findResults.Count &gt; 0 Then\n    service.LoadPropertiesForItems(findResults.Items, New PropertySet(BasePropertySet.FirstClassProperties))\nEnd If\n\nFor Each item As Item In findResults.Items\n    Dim CurrentEmail As EmailMessage = item\n\n    '#### Grab Email Information\n    E_ID = CurrentEmail.InternetMessageId.ToString()\n    If CurrentEmail.Sender.Address.ToString() &lt;&gt; \"\" Then\n        E_From = Replace(CurrentEmail.Sender.Address, \"'\", \"''\")\n    Else\n        E_From = Replace(CurrentEmail.Sender.Name, \"'\", \"''\")\n    End If\n    E_From = Replace(CurrentEmail.Sender.Address, \"'\", \"''\")\n    E_To = Replace(CurrentEmail.DisplayTo, \"'\", \"''\")\n    E_CC = Replace(CurrentEmail.DisplayCc, \"'\", \"''\")\n    E_Subject = Replace(CurrentEmail.Subject, \"'\", \"''\")\n    E_Body = Replace(CurrentEmail.Body.Text, \"'\", \"''\")\n    E_Received = CurrentEmail.DateTimeReceived.ToString(\"dd/MM/yyyy HH:mm:ss\")\n    E_Sent = CurrentEmail.DateTimeSent.ToString(\"dd/MM/yyyy HH:mm:ss\")\n\n    '#### Save the email into SQL\n    If SqlQuery(\"INSERT INTO tbl_Emails ([MessageID], [From], [To], [CC], [Subject], [Body], [Received], [Sent]) VALUES ('\" &amp; E_ID &amp; \"', '\" &amp; E_From &amp; \"', '\" &amp; E_To &amp; \"', '\" &amp; E_CC &amp; \"', '\" &amp; E_Subject &amp; \"', '\" &amp; E_Body &amp; \"', CONVERT(DATETIME, '\" &amp; E_Received &amp; \"', 103), CONVERT(DATETIME, '\" &amp; E_Sent &amp; \"', 103))\") = True Then\n        item.Delete(DeleteMode.HardDelete)\n    End If\nNext\n</code></pre>\n"},{"tags":["sql-server-2008","service-broker","database-mirroring"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12603168,"title":"DB Mirroring AND Service Broker - Is it possible?","body":"<p>We have a three-server setup where Server1 and Server2 are in a mirror (Server1 being the principal) and Server3 contains some archiving databases that are fed from the mirrored databases by using Service Broker.\nAs long as Server1 is the principal everything works fine but when we fail-over to Server2 the messages just keeps accumulating in the TransmissionQueue with a message that says that Service Broker could not decrypt the message.\nI have tried to rebuild the security on Server2 to make it identical to Server1. From the master databases master key, via the specific database's master keys, to the certificates and users used by Service Broker.\nMy gut feeling tells me that either I have missed the security somewhere high up in the chain or this particular setup is not supported by SQL Server. \nWe are running SQL Server 2008 R2 SP1 on all three machines.</p>\n\n<p>I really hope that someone on this forum can set me on the right path and is willing to help me out.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures","join"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12617880,"title":"Join on everything else value if not in table","body":"<p>I have a dimensions table</p>\n\n<pre><code>@dimensions\nDateid  Rep Mkt Prodgroup\n201111  002 S   001\n201111  002 R   001\n201111  002 S   002\n201111  002 R   002\n201111  002 S   003\n201111  002 R   003\n201111  002 S   004\n201111  002 R   004\n...\n</code></pre>\n\n<p>I want to join it with this table to include the percentage.</p>\n\n<pre><code>@percentageincrease\nProdgroup   Mkt Percent\nALL         S   1.05\nALL         R   1.06\n002         S   1.07\n002         R   1.08\n003         S   1.09\n003         R   1.10\n</code></pre>\n\n<p>I want to join them on <code>Mkt</code> and <code>Prodgroup</code> where <code>@dimensions.Prodgroup IN @percentageincrease.Prodgroup</code> and if <code>not in</code> then to join on the ALL. So the output table would be</p>\n\n<pre><code>Dateid  Rep Mkt Prodgroup   Percent\n201111  002 S   001         1.05 // joined on ALL\n201111  002 R   001         1.06 // joined on ALL\n201111  002 S   002         1.07 // joined on 002\n201111  002 R   002         1.08 // joined on 002\n201111  002 S   003         1.09 // joined on 003\n201111  002 R   003         1.10 // joined on 003\n201111  002 S   004         1.05 // joined on ALL\n201111  002 R   004         1.06 // joined on ALL\n...\n</code></pre>\n\n<p>As my join condition I have tried</p>\n\n<pre><code>on case p.Prodgroup \n    when N'ALL' \n    then d.prodgrpid \n    else p.Prodgrpid = d.prodgrpid\nAND p.Mkt = d.Mkt\n</code></pre>\n\n<p>but it gave me </p>\n\n<pre><code>Dateid  Rep Mkt Prodgroup   Percent\n201111  002 S   001         1.05\n201111  002 R   001         1.06\n201111  002 S   002         1.07\n201111  002 R   002         1.08\n201111  002 S   002         1.05 //Joined on ALL\n201111  002 R   002         1.06 //Joined on ALL\n201111  002 S   003         1.09\n201111  002 R   003         1.10\n201111  002 S   003         1.05 //Joined on ALL\n201111  002 R   003         1.06 //Joined on ALL\n201111  002 S   004         1.05\n201111  002 R   004         1.06\n...\n</code></pre>\n\n<p>where the tuples which were in the @percentageincrease table were also joined on the ALL condition.</p>\n\n<p>This is being run on SQL Server 2008 as a stored procedure as part of a larger query.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":33,"score":-2,"question_id":12617862,"title":"How can I add the columns that I have marked as bold and get the result in total time or in new column","body":"<pre><code>Date          Event   eventid     username       starttime     Endtime   Remark   Totaltime\n----------------------------------------------------------------------------------------\n05/30/2012  Break Out   0      Premnath Nair    **13:06:06**   13:06:06     NULL  00:00:00\n05/30/2012  Break In    1      Premnath Nair    **13:22:24**   13:22:24     NULL  00:00:00\n05/30/2012   NULL   255    Premnath Nair       08:54:49    19:21:02   normal  10:26:13\n05/31/2012   NULL   255    Premnath Nair       07:52:55    18:50:45   normal  10:57:50\n06/01/2012   NULL   NULL       NULL          NULL       NULL        NULL\n06/02/2012   NULL   NULL        NULL         NULL       NULL        NULL\n06/03/2012  Break Out   0      Premnath Nair       13:32:55 13:32:55    NULL  00:00:00\n06/03/2012  Break In    1      Premnath Nair       13:43:11 13:43:11    NULL  00:00:00\n06/03/2012  Out Duty    2   Premnath Nair   12:03:52    12:03:52    NULL  00:00:00\n</code></pre>\n\n<p>This is the data from the database</p>\n\n<p>I have got the total time by this query</p>\n\n<pre><code>convert (varchar(8), convert(datetime, endtime, 8) - convert(datetime, starttime, 8), 108)  as totaltime\n</code></pre>\n\n<p>Need to know how can I get the total break time need to add the break in time and the break out time </p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":12615785,"title":"Inclusion of both inclusive and exclusive range in the same table","body":"<p>i have the following table generated by SQL TABLE A</p>\n\n<pre><code>timeinterval   count(exclusive range)\n0-6             2\n0-12            5\n0-18            10\n</code></pre>\n\n<p>i want a table like this TABLE B</p>\n\n<pre><code>timeinterval   count(exclusive range)  count(inclusive range)\n1-6             2                       2\n1-12            5                       3\n1-18            10                      5\n</code></pre>\n\n<p>i have already generated table A and need table B. can i do something in SQL where i can add a query in the code for table A and do something like this (0-12)-(0-6) for 2nd row in table B.</p>\n\n<p>code used for generating table A is </p>\n\n<pre><code>with ranges as \n  (\n    select 6 as val, 1 as count_all\n union all\n    select 12, 1\n    union all\n    select 18, 1\n    union all\n select 24, 1\n    union all\n select 30, 1\n    union all  \n select 36, 1\n    union all \n select 42, 1\n    union all\n select 48, 1\n    union all   \n select 1, 0\n  )\nselect case when ranges.count_all = 0\n            then 'more'\n            else  convert (varchar(10), ranges.val) \n        end [MetLifeExperienceMonths],\n       sum (case when (ranges.count_all = 0 and GoldListHistogram.MetLifeExperienceMonths&gt;=1)\n                   or\n           (GoldListHistogram.MetLifeExperienceMonths&lt;= ranges.val and  GoldListHistogram.MetLifeExperienceMonths&gt;=1)\n                 then 1 end) [count],\ncount(EmployeeID) as 'Total'\ninto yy\nfrom GoldListHistogram\ncross join ranges\nwhere MetLifeExperienceMonths &gt; 0\ngroup by ranges.val, ranges.count_all\n</code></pre>\n\n<p><em>i need to modify the query such that i can subtract first two rows value for \"count(exclusive range)\" for every row staring from the 2nd row..like for 0-12(time interval) row i need to output a value that is difference of the first two rows..like row(i)=count(i)-count(i-1).</em> </p>\n\n<p>first column gives the time interval in 5 years (in months) second column calculates no. of employees in the exclusive range like (0-6,0-12,0-18)..6 ,12,18 being no. of months third column calculates no. of employees in the exclusive range like (0-6,6-12,12-18) </p>\n"},{"tags":["sql-server-2008","cursor"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":134,"score":3,"question_id":12600265,"title":"Alternative to use cursors in SQL Server stored procedure","body":"<p>It's not like that I am having trouble executing my cursors which are enclosed in a stored procedure. But I want to find more efficient way to achieve the same.</p>\n\n<p>Here it goes.</p>\n\n<p>Stored procedure : <code>RawFeed.sql</code> (runs every 5 minutes)</p>\n\n<pre><code>Set @GetATM = Cursor For\n        Select DeviceCode,ReceivedOn\n        From RawStatusFeed\n        Where CRWR=2 AND Processed=0\n        Order By ReceivedOn Desc\n    Open @GetATM\n    Fetch Next\n    From @GetATM Into @ATM,@ReceivedOn\n    While @@FETCH_STATUS = 0\n        Begin\n            Set @RawFeed=@ATM+' '+Convert(VarChar,@ReceivedOn,121)+' '+'002307'+' '+@ATM+' : Card Reader/Writer - FAULTY '\n            Exec usp_pushRawDataAndProcess 1,@RawFeed\n            Fetch Next\n            From @GetATM Into @ATM,@ReceivedOn\n        End\nSet @GetATM = Cursor For\n        Select DeviceCode,ReceivedOn\n        From RawStatusFeed\n        Where CRWR=0 AND Processed=0\n        Order By ReceivedOn Desc\n    Open @GetATM\n    Fetch Next\n    From @GetATM Into @ATM,@ReceivedOn\n    While @@FETCH_STATUS = 0\n        Begin\n            Set @RawFeed=@ATM+' '+Convert(Varchar,@ReceivedOn,121)+' '+'002222'+' '+@ATM+' : Card Reader/Writer - OK '\n            Exec usp_pushRawDataAndProcess 1,@RawFeed\n            Fetch Next\n            From @GetATM Into @ATM,@ReceivedOn\n        End\n</code></pre>\n\n<p>Likewise I have 10 more <code>SET</code> statements which differ on <code>WHERE</code> condition parameter &amp; string enclosed in <code>@RawFeed</code> variable.</p>\n\n<p>For each row I get I execute another stored procedure on that particular row.</p>\n\n<p>My question is </p>\n\n<blockquote>\n  <p><em>Is there any better way to achieve the same without using cursors?</em></p>\n</blockquote>\n\n<p>Variable @<code>RawFeed</code> Contains following <code>string</code> which is input to <code>usp_pushRawDataAndProcess</code> stored procedure. now this will divide whole string and do some operation like <code>INSERT,UPDATE,DELETE</code> on some tables.</p>\n\n<p>WE JUST CAN NOT PROCESS MORE THAN 1 STRING IN <code>usp_pushRawDataAndProcess</code> </p>\n\n<pre><code>NMAAO226 2012-09-22 16:10:06.123 002073 NMAAO226 : Journal Printer - OK \nWMUAO485 2012-09-22 16:10:06.123 002222 WMUAO485 : Card Reader/Writer - OK \n</code></pre>\n"},{"tags":["sql","sql-server-2008","install"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":68,"score":-1,"question_id":12610304,"title":"SQL Server Management Studio 2008 install - no option","body":"<p>Ok I've searched everywhere for an answer and can't seem to find an answer.</p>\n\n<p>I've installed VS 2010 and with it came SQL Server 2008 Express. I am currently trying to install SQL Server Management Studio 2008 and it won't give me the option to install.</p>\n\n<p>At first, I thought it wanted me to install SP1 first.. but it says there is nothing to patch! </p>\n\n<p>My SQL patch version: 10.1.2531.0</p>\n\n<p><img src=\"http://i.stack.imgur.com/C1C7P.png\" alt=\"SQL Server 2008 Setup\"></p>\n\n<p>EDIT: This is the installer I'm using: \n<a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=7593\" rel=\"nofollow\">http://www.microsoft.com/en-us/download/details.aspx?id=7593</a></p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":118,"score":0,"question_id":12559023,"title":"SQL Server 2008 Subquery with multiple tables","body":"<p>I have 4 tables</p>\n\n<p>Table 1 - DRAWING SUBMISSIONS-DTS</p>\n\n<pre><code>SUBMISSION-ID, \nDRAWING-ID,\nINWARD-ID,\nREVISION NO,\nCOMMENT DATE,\nCOMMENTS FORWARDED TO WED,\nSTATUS OF DRWG,\nRECVD AT FFM,\nREMARKS,\nLast,\nRemarks2,\nDrawing Sheet,\n</code></pre>\n\n<p>Table 2 - DRAWING-MAIN-DTS</p>\n\n<pre><code>DRAWING-ID,\nDRAWING CSD NO,\nDRAWING TITLE,\nENGINEER INCHARGE,\n</code></pre>\n\n<p>Table 3 - LI PROJECTS    </p>\n\n<pre><code>PROJECT TITLE,\nLI PROJECT NO,\n</code></pre>\n\n<p>Table 4 - Inward   </p>\n\n<pre><code>INWARD-ID,\nREFERENCE NO,\nLI PROJECT NO,\nTYPE OF INCOMING DOC,\n</code></pre>\n\n<p>All the tables are related with one field in that table.</p>\n\n<p>Reference No in Table 4, Drawing CSD No in Table 2 and LI Project No in Table 3 are Unique.</p>\n\n<p>When a Drawing CSD No will have a new Revision No, a New Reference No is generated. \nWhether the Drawing CSD No is delayed or not is checked on the Last Reference No for that Particular Drawing CSD No.</p>\n\n<p>I want the last Reference No in Table 4, Status of DRWG and Recvd at FFM in Table 1, Engineer inCharge and Drawing Title in Table 2 as the result. We will give only LI Project No as input.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":128,"score":8,"question_id":12616008,"title":"SELECT TOP N with variable","body":"<p>I have the following data in a SQL table</p>\n\n<p>Temp table variable <code>@RndQuesnCount</code> contains this data, </p>\n\n<pre><code>Recid conceptID MinDisplayCount\n1      3839     2\n2      4802     3\n</code></pre>\n\n<p>Question table : <code>QuesTable</code></p>\n\n<pre><code> QuesCompID     Ques_ConceptDtlID\n  88         4802\n  89         4802\n  90         4802\n  91         4802\n  92         4802\n  93         4802\n</code></pre>\n\n<p>What I would like to show is the min display count for question which is in <code>@RndQuesnCount</code> for the concept id, so now the data should come as below </p>\n\n<pre><code>  QuesCompID    Ques_ConceptDtlID\n  88         4802\n  89         4802\n  90         4802\n</code></pre>\n\n<p>because <code>conceptid</code> (4802) has min display count 3 in <code>@RndQuesnCount</code> table. </p>\n\n<p>Can anyone help me to solve this problem ?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12615972,"title":"Use of value vs variable in performance ","body":"<pre><code>select *\nfrom table1 t1\nwhere\n  t1.somedate between UDF(date1) and UDF(date2)\n</code></pre>\n\n<p>UDF: user defined function</p>\n\n<p>This <code>UDF(date1)</code> and <code>UDF(date2)</code>, will it be evaluated for each and every row of <code>t1</code>.</p>\n\n<p>This degrades performance.</p>\n\n<p>2nd option I tried</p>\n\n<pre><code>declare @a datetime, @b datetime\nset @a=UDF(date1)\nset @b=UDF(date2)\nselect *\n    from table1 t1\n    where\n      t1.somedate between @a and @b\n</code></pre>\n\n<p>Even this is taking a long time.</p>\n\n<p>What could be the reason, and what could be the work around.</p>\n\n<p>if i write </p>\n\n<pre><code>select *\n    from table1 t1\n    where\n      t1.somedate between date1 and date2\n</code></pre>\n\n<p>its very fast. takes around 3 sec. queries above take 2-3 min.</p>\n"},{"tags":["c#",".net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":12615102,"title":"Error: the conversion of a varchar data type to a datetime data type resulted in an out-of-range value","body":"<p>I'm trying to enter data into my SQL Server 2008 using data from a form. I am using a DateTimePicker to select dates from a form and enters this data to the db, however when I try to run the form I'm getting the following error:</p>\n\n<blockquote>\n  <p><em>The conversion of a varchar data type to a datetime data type resulted in an out-of-range value.<br>\n  The statement has been terminated</em></p>\n</blockquote>\n\n<p>This is the code for my form below:</p>\n\n<pre><code>private void btnAddBooking_Click(object sender, EventArgs e)\n{\n            DateTime requested = dtpRequested.Value;\n            DateTime pickup = dtpPickup.Value;\n            DateTime estDropoff = dtpEstimatedDrop.Value;\n\n            SAF.AddNewBooking(requested, pickup, estDropoff, selectedStatus.StatusId, selectedRate.RateId);\n            dtpRequested.CustomFormat = \" \";\n            dtpPickup.CustomFormat = \" \";\n            dtpEstimatedDrop.CustomFormat = \" \";\n\n            cbStatus.SelectedIndex = 0;\n            cbRateOfPayment.SelectedIndex = 0;\n\n            MessageBox.Show(\"Booking Created\");\n            tabControl2.SelectTab(2);\n}\n</code></pre>\n\n<p>Here is code in the facade where I store the method:</p>\n\n<pre><code>public void AddNewBooking(DateTime requestedD, DateTime pickupD, DateTime estDropOff, int statusId, int rateId)\n{\n            dao.AddNewBooking(requestedD, pickupD, estDropOff, statusId, rateId);\n}//end CreateBooking\n</code></pre>\n\n<p>and this is the <code>INSERT</code> statement code in my DAO:</p>\n\n<pre><code>sql = \"INSERT INTO [Transaction] (TransactionId, RequestedDateOfPickup, ActualDateOfPickup, EstimatedDropOffDate, StatusId, RateId)\";\nsql += String.Format(\"VALUES('{0}', '{1}', '{2}', '{3}', {4}, {5})\", transactionId, requestedD, pickupD, estDropOff, statusId, rateId);\n\ncn = new SqlConnection(Properties.Settings.Default.UKRENTALSConnectionString);\ncmd = new SqlCommand(sql, cn);\n\ncn.Open();\ncmd.ExecuteNonQuery();\n</code></pre>\n"},{"tags":["sql-server-2008","excel-2007"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":79,"score":-1,"question_id":12535746,"title":"Importing Excel spreadsheets into SQL Server","body":"<p>see we can import one excel spreat sheet into one tabel in sql server ok? now  I wanna import data of some diffrent spread sheet into one table in sql server. what can I do???</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-ce"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12614551,"title":"Parent Child Reference SQL query","body":"<p>I have Parent + Reference tables  where\nReference table is as follows</p>\n\n<pre><code>Ref_ID    PARENT_ID    \n-------------------\n1           1            \n2           1            \n1           2       \n3           2       \n1           3       \n3           3       \n4           3       \n2           4       \n3           4       \n</code></pre>\n\n<p>Trying to return all distinct parent rows WHERE ref_id in ( 2, 3 ) \nusing a join instead of using a subquery \nbut duplicates are being returned for parent via join query</p>\n\n<p>Any help is appreciated </p>\n\n<p>FYI - there are 4-7 tables in the query ( depending on user selections )so performance is a huge factor</p>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures","time"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":6,"view_count":92,"score":-5,"question_id":12614002,"title":"How to convert the Varchar of sum to time using sql server 2008","body":"<p>i wrote the stored procedure like this</p>\n\n<pre><code>Declare @sum varchar(50)\nSet @sum = (select SUM(ct.WorkingHours) \n            from ConsultantTimeSheet ct \n            where ConsultantID = @Consultantid \n              and ct.Status = @status \n              and ct.StartDate = @StartDate \n              and ct.EndDate = @Enddate \n            group by ConsultantID)\n</code></pre>\n\n<p>Now I got the sum like <code>33.90</code>, but I have to display <code>34.30</code>, how to convert like that format minutes exceed 60 add to hours.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","type-conversion"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":125,"score":-3,"question_id":12614045,"title":"Error converting data type varchar to bigint","body":"<p>I am Trying to to compare <code>BIGINT</code> to <code>VARCHAR</code>:</p>\n\n<pre><code>REQUEST_ID = CAST('%%' AS VARCHAR)\n</code></pre>\n\n<p>Where, <code>REQUEST_ID</code> is <code>BIGINT</code>.</p>\n\n<p>I am getting the error:</p>\n\n<blockquote>\n  <p>Error converting data type varchar to bigint</p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12613514,"title":"What is the \"N\" before a string argument","body":"<p>While reading SQL Server documentation I came across the following statement:</p>\n\n<pre><code>EXEC sp_addlinkedserver   \n   @server=N'S1_instance1', \n   @srvproduct=N'',\n   @provider=N'SQLNCLI', \n   @datasrc=N'S1\\instance1';\n</code></pre>\n\n<p>What is the \"N\" before the string arguments? It seems to be optional as, without them, the statement works well.</p>\n"},{"tags":["string","sql-server-2008","export"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":456,"score":4,"question_id":10489184,"title":"SQL Server Convert Table Contents into Merge Statement?","body":"<p>I have a table of lookup data that was changed in \"location A\" and I need to update the same named table in \"location B\". I am thinking that if I had a way to read the table (80k rows) line by line into a properly formatted string, and create an output file of/with a merge statement (\"converting\" the table into a CTE), then I could have something slick.</p>\n\n<p>All ideas (or pointers from those who have already done something similar) on this idea are appreciated. Thanks. I am using SQL Server Express 2012.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","type-conversion"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12612700,"title":"Convert Hexadecimal to INT and vice versa","body":"<p>I will be creating a sequential Serial Number made from Hexadecimal values</p>\n\n<p>With this Format: </p>\n\n<pre><code>XX-XX-XX-YYYY\nWhich XX-XX-XX is default value\nAnd YYYY is the incrementing hexa decimal value\n</code></pre>\n\n<p>Now to create the serial number based on hex value I need Add 6 to the last generated hex value</p>\n\n<pre><code>MIN: 2D41 + 6 = 2D47    \n     2D47 + 6 ... and so on\nMAX: 4100   generation of serial will stop when I meet the MAX value.\n</code></pre>\n\n<p>I already created it in c# but I need to do it on SQL</p>\n\n\n\n<pre><code>int num1 = int.Parse(\"2D41\", NumberStyles.HexNumber); //Convert hex to int\nint result = num1 + 6; //Add + 6 for increment\nstring myHex = result.ToString(\"X\");  //Convert result to hex\nMessageBox.Show(myHex);  // result 2D47\n</code></pre>\n\n<p>How can this be done in T-SQL?</p>\n"},{"tags":["sql-server-2008","visual-studio-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":12611428,"title":"How to generate test data using Visual Studio 2012?","body":"<p>How do I generate test data using Visual Studio 2012?</p>\n\n<p>I found these 2 articles on how to do it using VS 2010. But what about VS 2012?</p>\n\n<ul>\n<li><a href=\"http://www.jnrit.com.au/2011/05/15/SQL-Server-2008-R2-Test-Data-Load-Using-VS2010.aspx\" rel=\"nofollow\">SQL Server 2008 R2 Test Data Load Using VS2010</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/dd193262%28v=vs.100%29.aspx\" rel=\"nofollow\">Generating Test Data for Databases by Using Data Generators</a></li>\n</ul>\n\n<p>My database is an SQL-Server 2008-R2 database.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12604785,"title":"Stored procedure programming, with lists and loops in SQL Server issue","body":"<p>I have written my own quick comment/programming text, which is far from correct, but will illustrate what I want to do in the database by sql.</p>\n\n<p>The hope is, that anybody with programming skills in SQL Server - stored procedures programming. Could assist me, to find out if this is even possible.</p>\n\n<p>I have a little experience in Oracle´s PLSQL, so I know that its maybe possible.</p>\n\n<p>I hope the example would explain it self, but if it doesn´t, please ask me to give a deep explanation of the sql/c#/comment example I have given below.</p>\n\n<pre><code>storedProcedure(firstWeek, lastWeek)\n{\n\n  Dictornary list = new OrderdDictornary(); //Key is a week, value is a list of tests\n\n  //Run through each week.\n  for(int i = firstWeek; i&lt;=lastWeek; i++)\n  {\n     var queryList = \n     {\n                //All in the database\n            SELECT instrumentID\n            FROM Tests\n            GROUP BY InstrumentID\n\n            EXCEPT\n\n                //All that could be found in this week\n            SELECT InstrumentID\n            FROM Tests\n            WHERE TimeCompleted = // In 'i' week (this week)\n            GROUP BY InstrumentID\n     }\n     list.Add(i, queryList); //Key, Values\n  }\n\n  return list;\n}\n</code></pre>\n\n<p>At last I would have a list of week keys, with values which are the right data sorted in weeks.</p>\n\n<p>Thanks for reading!</p>\n"},{"tags":["database","sql-server-2008","attach","ssms2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12611986,"title":"Why is SSMS 2008 prompting me \"if you are certain that you have added all the necessary full-text catalogs, click OK\"","body":"<p>When I try to attach a database in <code>SQL Server Management Studio 2008</code> (SSMS), I get prompted by this message:</p>\n\n<pre><code>If you are certain that you have added all the \nnecessary full-text catalogs, click OK.\n</code></pre>\n\n<p>Why is this coming up.  It didn't use to.</p>\n\n<p>We did make some schema changes but have done nothing with full-text catalogs.</p>\n\n<p>Is there a way to prevent this coming up?</p>\n"},{"tags":["sql-server","performance","sql-server-2008","indexed-view"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12611194,"title":"Will using an indexed view improve performance of SELECT COUNT queries?","body":"<p>I have a table with that will grow to several million rows over some years.  As part of my web application, I have to query the count on a subset of this table whenever a user accesses a particular page.  Someone with an architecty hat has said that they have a performance concern with that.  Assuming they are correct, will adding an indexed view address this issue?</p>\n\n<p>Sql that I want to be fast:</p>\n\n<pre><code>SELECT COUNT(*) FROM [dbo].[Txxx] WHERE SomeName = 'ZZZZ'\n</code></pre>\n\n<p>OR </p>\n\n<pre><code>SELECT COUNT_BIG(*) FROM [dbo].[Txxx] WHERE SomeName = 'ZZZZ'\n</code></pre>\n\n<p>Table:</p>\n\n<pre><code>CREATE TABLE [dbo].[Txxx](\n    [Id] [uniqueidentifier] ROWGUIDCOL  NOT NULL,\n    [SomeName] [nvarchar](50) NOT NULL,\n    [SomeGuid] [uniqueidentifier] NOT NULL\n CONSTRAINT [PK_Txxx] PRIMARY KEY CLUSTERED \n(\n    [Id] ASC\n)\n</code></pre>\n\n<p>View:</p>\n\n<pre><code>CREATE view dbo.Vxxx\nWITH SCHEMABINDING\nAS\nSELECT     SomeName, COUNT_BIG(*) AS UsedCount\nFROM         dbo.Txxx\nGROUP BY SomeName\n</code></pre>\n\n<p>Index:</p>\n\n<pre><code>CREATE UNIQUE CLUSTERED INDEX [IV_COUNT] ON [dbo].[Vxxx] \n(\n    [SomeName] ASC\n)\n</code></pre>\n"},{"tags":["sql-server-2008","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":12583988,"title":"SSRS Web Edition errors Use Local, but I am","body":"<p>I have searched high and low and don't know what to do.  I am running SQL Server Web Edition on Server 2008, which only supports local databases.  I am trying to connect to localhost, but when I test my connection, I get this error.</p>\n\n<blockquote>\n  <p>The feature: \"The edition of Reporting Services that you are using\n  requires that you use local SQL Server relational databases for report\n  data sources and the report server database.\" is not supported in this\n  edition of Reporting Services.</p>\n</blockquote>\n\n<p>The DB was upgraded from SQL Express and when I select @@version, it says it's Web Edition.  I've tried rebooting and that seemed to fix it, but only for a little while.</p>\n"},{"tags":["sql-server-2008","output-clause"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12601542,"title":"How to get the column from two tables in output clause","body":"<p>I have two tables </p>\n\n<pre><code>TableA (Col1 Pk identity, Col2, Col3)\nTableB (Col2,Col3, Col4)\n</code></pre>\n\n<p>Now, I want to get the the combination of Col1, Col4 .</p>\n\n<p>I am using this</p>\n\n<pre><code>INSERT INTO TableA (Col2, Col3)\nOUTPUT inserted.*\nSELECT DISTINCT Col2,Col3\nFROM TableB\n</code></pre>\n\n<p>But below will give me only Col1, Col2 &amp; Col3 of tableA.. if I am not wrong. Here I want Col1 (TableA) &amp; Col4 (TableB)\nNow, how can I get Col4 and the respected indentity row in TableA.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>Below is a sample scenrio which may help you</p>\n\n<pre><code>    CREATE TABLE [dbo].[A](\n    [Col1] [int] IDENTITY(1,1) NOT NULL,\n    [Col2] [varchar](50) NULL,\n    [Col3] [varchar](50) NULL,\n CONSTRAINT [PK_A] PRIMARY KEY CLUSTERED \n(\n    [Col1] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n\nSET ANSI_PADDING OFF\nGO\n\nCREATE TABLE [dbo].[B](\n    [Col2] [varchar](50) NULL,\n    [Col3] [varchar](50) NULL,\n    [Col4] [varchar](50) NULL\n) ON [PRIMARY]\n\nGO\n\nSET ANSI_PADDING OFF\nGO\n\n\n\nINSERT INTO A (Col2,Col3)\nOUTPUT INSERTED.*\nSELECT COL2, Col3, Col4 \nFROM B\n</code></pre>\n\n<p><em>Can I do it with Checksum?</em> </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12609795,"title":"SQL Server : Distinct + random rows","body":"<p>How do I pick distinct as well as random rows from a SQL Server 2008/2005 table?</p>\n\n<p>I have a list of tips from which I need to pick a few tips <strong>randomly</strong> and they must be <strong>unique</strong> too.</p>\n\n<p>I tried:</p>\n\n<pre><code>Select \n    Distinct Tips \nFrom \n    jfpastrologytips \nWhere \n    GetDate() &lt;= validtill \nOrder by \n    NewId()\n</code></pre>\n\n<p>and got commissioned with exception</p>\n\n<blockquote>\n  <p><em>Msg 145, Level 15, State 1, Line 1<br>\n  ORDER BY items must appear in the select list if SELECT DISTINCT is specified.</em></p>\n</blockquote>\n"},{"tags":["c#","sql-server-2008","stored-procedures","gif"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12609509,"title":"creating .gif file","body":"<p>I have a task to store and retrieve a .gif file in c#. I have successfully stored the gif in the database. I transformed it to binary file and use a store proc to store in db here is my code:</p>\n\n<pre><code>public int Insert(byte[] Byte,string Name,int userid)\n{\n    try\n    {\n        SqlCommand storedProcCommand = new SqlCommand(\"Insert\", con);\n        storedProcCommand.CommandType = CommandType.StoredProcedure;\n        storedProcCommand.Parameters.AddWithValue(\"@Bytes\", banner2Byte);\n        storedProcCommand.Parameters.AddWithValue(\"@name\", bannerName);\n        storedProcCommand.Parameters.AddWithValue(\"@userid\", userid);\n        con.Open();\n        storedProcCommand.ExecuteNonQuery();\n        con.Close();\n    }\n    catch (Exception ex)\n    {\n    }\n}\n</code></pre>\n\n<p>How can I retrieve the byte array from the database and convert into a .gif and create the file I stored at the first place?</p>\n\n<pre><code>public int Retrieve(int id)\n{\n    try\n    {\n        SqlCommand storedProcCommand = new SqlCommand(\"Retrieve\", con);\n        storedProcCommand.CommandType = CommandType.StoredProcedure;\n        storedProcCommand.Parameters.AddWithValue(\"@id\", id);\n        con.Open();\n        SqlDataReader reader = storedProcCommand.ExecuteReader();\n        reader.Read();\n        byte[] arrays= reader.getBytes();             \n        reader.Close();\n        con.Close();\n    }\n    catch (Exception ex)\n    {\n    }\n}\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12608879,"title":"SQL Server merge function - Delete and output deleted not working properly","body":"<p>I have a pretty standard script that uses the merge functionality to insert, update, and delete records. However, I am having a lot of trouble with outputting deleted results to an audit type table. When I run the procedure against a clean target table I somehow end up with all nulls in the audit table, despite the fact nothing has been deleted (only inserts to non-audit table at this point, which does happen as it should). Under the same conditions and against the same clean target table, if I remove the:</p>\n\n<pre><code>OUTPUT deleted.Column1, deleted.Column2 INTO Table_Audit (Column1, Column2)\n</code></pre>\n\n<p>and replace it with:</p>\n\n<pre><code>OUTPUT $action, Inserted.*, Deleted.*\n</code></pre>\n\n<p>I see that nothing has actually been deleted, which is odd considering the source and target tables were the same on both runs and the merge predicate remained the same. All the records in the action column of the second statement are inserts as we would expect. Literally the only thing different is what I just mentioned above. Any ideas as to what could be going on?</p>\n"},{"tags":["sql-server-2008","decimal-point"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":608,"score":1,"question_id":9310007,"title":"Converting float to varchar with correct decimal separator","body":"<p>Hi i'm living in austria and we use the <code>,</code> as decimal separator.</p>\n\n<p>It seems to be impossible to convert the float to varchar with the correct separator according to the language/collation setting?</p>\n\n<p>Is this a bug?</p>\n\n<pre><code>set language german --makes no difference in this case\ndeclare @f float = 4.5\nselect @f --output in my management studio is 4,5 \n          --according to the regional os settings this is correct\n\nselect convert(varchar,@f) -- output: 4.5 not correct\n</code></pre>\n\n<p>one solution, but not ideal I think</p>\n\n<pre><code>select replace(convert(varchar,@f),'.',',')\n</code></pre>\n"},{"tags":["c#","nhibernate","sql-server-2008","fluent-nhibernate"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1272,"score":4,"question_id":2142973,"title":"Fluent NHibernate : How can i use Int64 as ID?","body":"<p>I'm quite new to the whole concept of ORM, NHibernate and FluentNH, and i'm trying to accomplish something that seems so simple...</p>\n\n<p>I'm trying to retrieve an object that has a field defined as Int64 in it's class. This field would be the ID, as defined in the Map file.</p>\n\n<p>When trying to retrieve a record from the DB, NHibernate returns the following error message :  <em>\"Provided id of the wrong type. Expected: System.Int32, got System.Int64\"</em></p>\n\n<p>I have a very simple object :</p>\n\n<pre><code>public class Holiday\n{\n    public virtual Int64 HolidayID { get; set; }\n    public virtual string Name { get; set; }\n    public virtual int Day { get; set; }\n    public virtual int Month { get; set; }\n    public virtual bool IsActive { get; set; }\n    public virtual HolidayGroup Group { get; set; }\n\n    public Holiday() { }\n\n}\n</code></pre>\n\n<p>the Mapping file (for FluentNH) is the following :</p>\n\n<pre><code>public class HolidayMap : ClassMap&lt;Holiday&gt;\n{\n    public HolidayMap()\n    {\n\n        Id(x =&gt; x.HolidayID);\n        Map(x =&gt; x.Name);\n        Map(x =&gt; x.Day);\n        Map(x =&gt; x.Month);\n        Map(x =&gt; x.IsActive);\n        HasOne(x =&gt; x.Group);\n    }\n}\n</code></pre>\n\n<p>the table structure (generated by NH) is the following:</p>\n\n<pre><code>CREATE TABLE [dbo].[Holiday](\n [HolidayID] [bigint] IDENTITY(1,1) NOT NULL,\n [Name] [nvarchar](255) NULL,\n [Day] [int] NULL,\n [Month] [int] NULL,\n [IsActive] [bit] NULL,\n [HolidayGroup_id] [int] NULL,\nPRIMARY KEY CLUSTERED \n(\n [HolidayID] ASC\n)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, \nALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>and finally, i am trying to retrieve the Holiday instance using this:</p>\n\n<pre><code>    public static Holiday Get(Int64 _holidayID)\n    {\n        Holiday _holiday = new Holiday();\n\n        try\n        {\n            using (var session = Global.NHibernate_SessionFactory.OpenSession())\n            {\n                _holiday = session.Get&lt;Holiday&gt;(_holidayID); // EXCEPTION OCCURS HERE\n            }\n        }\n        catch (Exception _ex)\n        {\n            // TODO : Implement proper logging\n        }\n\n        return _holiday;\n    }\n</code></pre>\n\n<p>What am i doing wrong??  What's missing?  When deleting the table and redefining my object using an Int32 for the ID, everything works!  I need use a bigger type! </p>\n\n<p>Many thanks!</p>\n\n<p><strong>EDIT 1 :</strong> As <strong>Aaronaught</strong> mentions, i agree, my need for an Int64 is a bit of overhead for storing holidays...  But for a second, let's forget the \"Holidays\" concept.  What am i going to do with my logging table (5 to 10 events (rows) per seconds!).  Thanks!</p>\n\n<p><strong>EDIT 2 :</strong> @Paco : I'm using NHibernate 2.1.2.4000 and FluentNH 1.0.0.614</p>\n\n<p><strong>EDIT 3 :</strong> After rerading <strong>Daniel Schilling</strong>'s solution, rebuilt a (brand new) simple Holiday object that used an Int64 as an ID.  I was able to retrieve a record from the DB successfully.  As soon as <strong>i added a relationship</strong> to a Group object, when instanciating a Holiday object i received the same error message as earlier...  Here is the HolidayGroup class and mapping, in case you can tell me what i did wrong...</p>\n\n<pre><code>public class HolidayGroup\n{\n    public virtual int HolidayGroupID { get; set;}\n    public virtual string Name { get; set; }\n    public virtual string Notes { get; set; }\n    public virtual bool IsActive { get; set; }\n    public virtual IList&lt;Holiday&gt; Holidays { get; set; }\n\n    public HolidayGroup()\n    {\n        Holidays = new List&lt;Holiday&gt;();\n    }\n}\n</code></pre>\n\n<p>public HolidayGroupMap()\n {\n  Id(x => x.HolidayGroupID);\n  Map(x => x.Name);\n  Map(x => x.Notes);\n  Map(x => x.IsActive);\n  HasMany(x => x.Holidays)\n   .Cascade.All()\n }</p>\n"},{"tags":["java","eclipse","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12604038,"title":"Editor does not contain a main type - messed up Build path config","body":"<p>Does anyone know of any complete guide that shows how to reconfigure from scratch the \"Build Path\" in Eclipse?\nIn the attempt to add a .jar file I messed up the current configuration. Or if you think volunteering pictures of your Eclipse config screen may help, that would be appreciated it too!</p>\n\n<p>I hope I will not have to reinstall Eclipse.</p>\n\n<p>The error I keep getting (for any classes, also those who used to run perfectly) is: \"Editor does not contain a main type.\" (BEFORE any program even LAUNCHES).</p>\n\n<p>I had deleted JRE but then I put JRE back by right clicking the root of \"package explorer\" - Build path - Add libraries - JRE System Library. Still same error. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":12607310,"title":"calculating the size of sql server database","body":"<p>I need to find the size of a sql server 2008 database. I used the following stored procedure</p>\n\n<p>EXEC sp_spaceused</p>\n\n<p>If gave me back the following data, database name, database size, unallocated space, reserved, data, index_size, unused</p>\n\n<p>Is there any way I can get the size of the database, excluding certain tables? </p>\n\n<p>I am able to get the reserved size of each database table using this query</p>\n\n<pre><code>    DECLARE @LOW int\nSELECT @LOW = LOW \nFROM [master].[dbo].[spt_values] (NOLOCK) \nWHERE [number] = 1 AND [type] = 'E'\n\nSELECT TableName,[Row Count],[Size (KB)] FROM \n(\n  SELECT QUOTENAME(USER_NAME(o.uid)) + '.' + \n                 QUOTENAME(OBJECT_NAME(i.id)) \n     AS TableName\n     ,SUM(i.rowcnt) [Row Count]\n     ,CONVERT(numeric(15,2),\n        (((CONVERT(numeric(15,2),SUM(i.reserved)) * @LOW) / 1024))) AS [Size (KB)]\n  FROM sysindexes i (NOLOCK)\n  INNER JOIN sysobjects o (NOLOCK) \n     ON i.id = o.id AND \n     ((o.type IN ('U', 'S')) OR o.type = 'U') \n  WHERE indid IN (0, 1, 255) \n  GROUP BY \n     QUOTENAME(USER_NAME(o.uid)) + '.' + \n     QUOTENAME(OBJECT_NAME(i.id))\n  HAVING SUM(i.rowcnt) &gt; 0\n) AS Z\nORDER BY [Size (KB)] DESC\n</code></pre>\n\n<p>But this confuses me slightly, as this only gives the reserved size per table. What is the reserved size? If I sum the reserved size for each database table, it does not add up to the database size.</p>\n"},{"tags":["sql-server","sql-server-2008","ssis"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":66,"score":1,"question_id":12607742,"title":"Importing Excel sheets in SSIS forces me to keep at least one sheet","body":"<p>When I build an SSIS package to import Excel spreadsheets in a folder by iterating through them, it seems that I have to keep at least one Excel spreadsheet to keep the Excel Source Data Flow Item.</p>\n\n<p>It does not matter that the Foreach Loop Container iterator finds new spreadsheets which fit the schema that the Data Flow Item is aware of, the package simply will not compile in Visual Studio.</p>\n\n<p>I currently find myself keeping a file named \"KeepMe.xlsx\" and use a C# script to pass the list of proper Excel sheets to import (meaning all of them but KeepMe.xlsx) to the Foreach Loop Container as a variable enumerator.</p>\n\n<p>How can I bypass this painstaking step and keep the incoming folder empty, without having any issues running the package?</p>\n\n<p>Also would this be only a compiler issue, meaning that once the package has been deployed, it would not throw the same exception? From what I remember, SSIS packages are always validated at execution time, or can this be overridden?</p>\n\n<p>Thanks in advance for the help!</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":81,"score":2,"question_id":12607134,"title":"SQL - Create \"virtual\" column based on data from other columns","body":"<p>I have a some issues with a SQL query I'm working on, I'm sorry that I don't have any work-in-progress to show because nothing that I have tried until now have worked out too well, so I am hoping that someone will be able to point me in the right direction.</p>\n\n<p><strong>Tables:</strong></p>\n\n<p>Computers:</p>\n\n<pre><code>[SN][PN][ComputerName][Model][OS][Architecture][RAM][CPU]\n</code></pre>\n\n<p>Logons: </p>\n\n<pre><code>[SN][Username][Timestamp]\n</code></pre>\n\n<p><strong>Info:</strong></p>\n\n<p>It works this way, every time a user logs on to a computer the computer info gets updated to the computer table and the username and timestamp gets inserted to the logons table.</p>\n\n<p><strong>Result</strong></p>\n\n<p>The result I am trying to acheive is the following:</p>\n\n<pre><code>[SN][PN][ComputerName][Model][OS][Architecture][RAM][CPU]**[Primary User]**\n</code></pre>\n\n<p>It should be only one row for each computer</p>\n\n<p>The Primary User field should be based from the 5 latest logons and being the username with the most recurrences in those 5.</p>\n\n<p>So I think that wraps It up, I hope someone here is able to at least point me in the right direction as every result google have to offer now show up as red.</p>\n"},{"tags":["asp.net","vb.net","visual-studio-2010","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12518678,"title":"Populating dropboxes with SQL data","body":"<p>I have a few more questions regarding my latest project. Ive felt like I have made some pretty good strides over the last couple days, but I am still struggling on a few of the core concepts of the SQL libraries, namely reading from specific columns and deleting entire rows. </p>\n\n<p>Over the last week I was able to build a webform, save excel files to the server, open those files and export data into specific SQL tables, and bind the data to specific data grids depending on what the user chooses through a dropdown. </p>\n\n<p>What I would like to accomplish is: Dynamic population of another dropdown depending on what the user chooses from the first drop down. More specifically, I have 4 tables, in the first column of each table I have serial numbers, if the user chooses Table2 in the first drop down, I would like the second dropdown to display all the serial numbers from column1 of Table2. Then if the user choose a specific serial number from the second drown down it populates a datagrid with columns 1-5 of that related row.</p>\n\n<p>The second part is to create a delete button that the user can push after the information is displayed in the datagrid, that deletes the entire row of the serial number entry from that table.</p>\n\n<p>This is what I have managed to Frankenstein together from other examples:</p>\n\n<pre><code> Protected Sub DropDownList1_SelectedIndexChanged(sender As Object, e As System.EventArgs)\n    DropDownList2.Enabled = True 'its remains disabled until the user selects something from the first box\n    Using con As New SqlClient.SqlConnection\n        con.ConnectionString = \"Data Source=.\\SQLEXPRESS;AttachDbFilename=\" &amp; AppPath &amp; \"App_Data\\DeviceDatabase.MDF;Integrated Security=True;User Instance=True;\"\n        Using cmd As New SqlClient.SqlCommand\n            cmd.Connection = con\n        End Using\n        Dim cmdSQL As New SqlCommand()\n        cmdSQL.CommandType = Data.CommandType.Text\n        cmdSQL.CommandText = \"SELECT Fieldname1 FROM \" &amp; \"\"\"\" &amp; DropDownList1.SelectedItem.ToString &amp; \"\"\"\" 'Im pretty sure this isnt right, and the reason I use \"\"\"\"\" is because some of the items in the dropdown have spaced words.\n\n        Dim adptSQL As New SqlClient.SqlDataAdapter(cmdSQL)\n        Dim myDataSet As New DataSet()\n        adptSQL.Fill(myDataSet)\n\n        With myDataSet.Tables(DropDownList1.SelectedIndex) 'I think this is right\n            For rowNumber As Integer = 0 To .Rows.Count - 1\n                With .Rows(rowNumber)\n                    DropDownList2.Items.Add(col1.rowNumber) 'This is obviously not working \n                End With\n            Next\n        End With\n    End Using\nEnd Sub\n</code></pre>\n\n<p>Then, Im not quite sure how to populate the data table with the row that was selected, though currently I am able to do the entire table with using:</p>\n\n<pre><code>Private Sub GenTables(ByVal DropList As Object)\n    If DropList.SelectedIndex = 0 Then\n        GridView1.DataSourceID = Nothing\n    ElseIf DropList.SelectedIndex = 1 Then\n        GridView1.DataSourceID = \"SqlDataSource1\"\n    ElseIf DropList.SelectedIndex = 2 Then\n        GridView1.DataSourceID = \"SqlDataSource2\"\n    ElseIf DropList.SelectedIndex = 3 Then\n        GridView1.DataSourceID = \"SqlDataSource3\"\n    ElseIf DropList.SelectedIndex = 4 Then\n        GridView1.DataSourceID = \"SqlDataSource4\"\n    End If\n    GridView1.DataBind()\nEnd Sub\n\n    &lt;asp:SqlDataSource ID=\"SqlDataSource1\" runat=\"server\" \n        ConnectionString=\"&lt;%$ ConnectionStrings:DeviceDatabaseConnectionString1 %&gt;\" \n        ProviderName=\"&lt;%$ ConnectionStrings:DeviceDatabaseConnectionString1.ProviderName %&gt;\" \n        SelectCommand=\"SELECT [Device:] AS column1, [SWversion:] AS column2, [Date:] AS column3, [Tester:] AS column4, [Wifi Preferred InCov:] AS column5 FROM [Galaxy Nexus]\"&gt;\n    &lt;/asp:SqlDataSource&gt;\n\n'there are 3 more of these.\n</code></pre>\n\n<p>But I have these tables \"hard coded\" into the application, I can't obviously do this with every single table row. So how do I populate a datagrid without setting a SQLDataSource ahead of time in asp? </p>\n\n<p>And lastly deleting the row that relates to the information displayed in the datagrid on the click of a button. If if can get a little help with the first part, Im sure I can figure out the second part.</p>\n\n<p>So pretty much what I am asking is: how to populate a drop down with all the items from Coloumn1? and how to populate a datagrid from a specific row?</p>\n\n<p>Any and all help is always greatly appreciated. Thanks Guys</p>\n\n<p>Zach</p>\n\n<h2><em>EDIT</em></h2>\n\n<p>hmm I think I was making this a ton harder then it had to be, right now I am working with this:</p>\n\n<pre><code>      Protected Sub BindDrop_Click(sender As Object, e As System.EventArgs)\n        DropDownList2.DataSourceID = \"SqlDataSource5\"\n        DropDownList2.DataBind()      \n      End Sub\n\n&lt;asp:SqlDataSource ID=\"SqlDataSource5\" runat=\"server\" \n        ConnectionString=\"&lt;%$ ConnectionStrings:DeviceDatabaseConnectionString1 %&gt;\" \n        ProviderName=\"&lt;%$ ConnectionStrings:DeviceDatabaseConnectionString1.ProviderName %&gt;\" \n        SelectCommand=\"SELECT [Device:] AS column1 FROM [Galaxy Nexus]\"&gt;\n</code></pre>\n\n<p></p>\n\n<p>Its not quite right but its closer and in 1/10th the lines</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1090,"score":4,"question_id":5461205,"title":"Converting int primary key to bigint in Sql Server","body":"<p>We have a production table with 770 million rows and change. We want(/need?) to change the Primary ID column from int to bigint to allow for future growth (and to avoid the sudden stop when the 32bit integer space is exhausted)</p>\n\n<p>Experiments in DEV have shown that this is not as simple as altering the column as we would need to drop the index and then re-create it. So far in DEV (which is a bit humbler than PROD) the dropping of the index has not finished after 1 and a half hours. This table is hit 24/7 and having it offline for such a long time is not an option.</p>\n\n<p>Has anyone else had to deal with a similar situation? How did you get it done?</p>\n\n<p>Are there alternatives?</p>\n\n<p><strong>Edit: Additional Info:</strong></p>\n\n<ul>\n<li>The Primary key is clustered.</li>\n</ul>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":12606634,"title":"SQL temptables Loop query","body":"<p>I have a temporary Table which looks like </p>\n\n<p>TmpTable :</p>\n\n<pre><code>          ID(not unique)   Platform Name    OS    version \n\n           13                 UNIX          Ipad     5.1\n           13                 Windows       Windows  2008\n           14                 MAC           Ipad     4.1\n</code></pre>\n\n<p>Look_UP Tbl : for each of the above columns </p>\n\n<pre><code>    PlatformName LookuP Tbl: platform id  desc\n                                 2        Unix\n                                 5        windows\n\n       OS Lookup            :  OS id    OSname\n                                 4       Ipad\n\n    Version Lookup          :  Version id  name\n                                 5         5.1\n</code></pre>\n\n<p>Then Have EmpPlatformID , EmpOSID &amp; EmpVersionID like below ;</p>\n\n<pre><code>       EmpPlatform  - EmpId  PltformNameID\n                       13         1\n                       13         6\n       same for OS &amp; ID \n</code></pre>\n\n<p>I need a query that\n1) uses the lookup tables to get the corresponding ID for each column(PlatformName,OS,Version) for each of the employee id . \n2) Insert the ID for that empid in each of the actual tables .</p>\n\n<p>So , empPlatformTable should look like ;</p>\n\n<pre><code>       EmpPlatform  - EmpId  PltformNameID\n                       13         1\n                       13         6\n                       13         2    - new row added from tmptbl\n                       13         5    - new row added from tmptbl\n The EmpOS &amp; EmpVer also has similar column so the emp id should have corresponding IDs inserted from temptbl . please helps\n</code></pre>\n\n<p>EDIT:\nCode to update PlatformName</p>\n\n<pre><code>Update EmpPN \n    Set EmpN.platform_id = PLookup.platform_id \nfrom #TempTable tmpd (READUNCOMMITTED) \ninner join EmpPlatform EmpPN (READUNCOMMITTED) \n    on EmpPN.emp_id = emp_id collate database_default \ninner join PlatformLookUpTbl PLookup(READUNCOMMITTED)\n    on PLookup.[platform_name] = tmpd.PlatformName collate database_default\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":51,"score":0,"question_id":12602080,"title":"Unable to show report in desire format","body":"<p>I asked this question before and someone vote down myquestion saying that this question is not valid. I have spent three days on this problem. So please if you do not understand it , it does not mean that the question is invalid.  Here it is:</p>\n\n<p>I have created a SSRS report. <strong>I am facing problem with respect to page break and Grouping.</strong> \nHere is the out put of my report.<img src=\"http://i.stack.imgur.com/es8LF.png\" alt=\"enter image description here\"></p>\n\n<p>On each page I want to show record group by Landing Date and Buyer Name.\nThat is on first page following should be shown:<br/>\n<strong>Buyer Name              Landing Date        Actual Price</strong> <br/>\nSHETLAND                  06-Jan-05            100989.754569257\n<br/>\nOn second page:<br/>\n<strong>Buyer Name              Landing Date        Actual Price</strong><br/>\nSHETLAND                  11-Jan-05           1096677.95045137\n<br/>\nOn third page:<br/>\n<strong>Buyer Name               Landing Date        Actual Price</strong><br/>\nFRESH                     14-Jan-05             300080.972657965<br/>\nSHETLAND                  14-Jan-05             157372.157557842 </p>\n\n<p>==========================================================================</p>\n\n<p><strong>I applied Grouping using group properties , but no effect.  Basically I want to show records with same landing date on one page.</strong> </p>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0","entity-framework-4"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":479,"score":1,"question_id":9374842,"title":"Entity Framework 4.0 Attach Object Graph","body":"<p>I am trying to attach and add disconnected entities to an Entity Framework context. For example:</p>\n\n<p>I have a <em>Customer</em> entity and a navigation property to detail <em>Order</em> entity. The idea is to get the <em>Customer</em> entity and make modifications to the entity and then also add new <em>Order</em> entities to the <em>Customer</em> entity.</p>\n\n<p>The problem starts when I try to <strong>Attach</strong> (I assume this is the correct method to use.) the Customer entity. Because the whole object graph is now being attached I get the following error:</p>\n\n<blockquote>\n  <p>\"An object with a temporary EntityKey value cannot be attached to an object context.\"</p>\n</blockquote>\n\n<p>I understand that the error is because of the added <em>Order</em> entities that should be <strong>Added</strong> and not <strong>Attached</strong>.</p>\n\n<p>Is there a way to Attach or Add a existing entity with new child entities to a context?</p>\n"},{"tags":["asp.net","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12605444,"title":"SQL Server stored procedure returning 'fail'","body":"<p>I have a stored procedure in SQL Server 2008 that needs to delete a few rows of data. But when I run it, it returns a fail and a value of -6.</p>\n\n<pre><code>ALTER procedure [dbo].[p_CaseFiles_Exhibits_DeleteExhibits]\n  @ExhibitID int\n, @Message nvarchar(50) output\nas\ndeclare @FileID int\nset @FileID = (select FileID from CaseFileExhibits where ExhibitID = @ExhibitID)\nbegin transaction\n  begin try\n    delete from CaseFileExhibitMovementTracking where ExhibitID = @ExhibitID\n    delete from CaseFileExhibitAttachments where CaseFileExhibitID = @ExhibitID\n    delete from CaseFileExhibits where ExhibitID = @ExhibitID\n    delete from CaseFileExhibitPropertyLink where ExhibitID = @ExhibitID\n    update CaseFileQuickStats set ExhibitCount = ExhibitCount -1 where CaseFileID = @FileID    \n    commit transaction\n  end try\n  begin catch\n    set @Message='Fail'\n    rollback transaction\n  end catch\n</code></pre>\n\n<p>I can't seem to find what's wrong.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12604647,"title":"Split fixed length string","body":"<p>I need to split a string in sql server and insert the data in a table.\nTe string is fixed length, no comma separated. In the string I can have 1 or more records to insert, for example:</p>\n\n<p>id = 2 characters\nname = 4 characters</p>\n\n<p>string: <code>01AAAA02BBBB03CCCC</code>.</p>\n\n<p>In this example I have 3 records to insert (I can have only one record or more in the string)</p>\n\n<p>id  Name\n   01  AAAA\n   02  BBBB\n   03  CCCC</p>\n\n<p>I need a way to split this info in two different columns and in three different rows. I was thinking to use BCP utility but I'm not sure, maybe I need to split and generate a file and then use BCP.</p>\n\n<p>Any idea?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12605144,"title":"SQL is it possible to grant permission to the view and not the user to access other db?","body":"<p>Hello and thank you for your time, </p>\n\n<p>I am using sql 2008\nI created a db that has nothing of relevance in. Here I want to add views that access other databases. I will then add a user to the db with no relevance and give access to the view. </p>\n\n<p>My obvious problem is that when the user tries to run the view, errors occur where they do not have permission to view the information. (when I use the admin type user, i can access the view and see the results no problem)</p>\n\n<p>Can I create permissions to the view to all SELECT on the two seperate db's so the user can see the results. Or does the user require the read permissions on all the tables queried. </p>\n\n<p>Thank you again. </p>\n\n<p>This is what I tried (and many others but it did not work)</p>\n\n<pre><code>USE no-relevance-server\nGRANT REFERENCES ON OBJECT[important-server::dbo.table] TO [the view]\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":59,"score":2,"question_id":12604146,"title":"SQL Join on Table A value within Table B range","body":"<p>I have two tables that can be seen in accompanying image.</p>\n\n<p><em>Table A</em> contains <strong>Department</strong>, <strong>Month</strong> and <strong>Average</strong>.</p>\n\n<p><em>Table B</em> contains <strong>Month</strong>, <strong>Year</strong>, <strong>RangeStart</strong>, <strong>RangeEnd</strong> and <strong>Colour</strong>.</p>\n\n<p>If you look at the screen shot of <em>Table B</em>, you will see for each Month you have a Green, Yellow, Orange and Red value. You also have a range.</p>\n\n<p><strong>What I need.........</strong></p>\n\n<p>I need a new column on <em>Table A</em> named 'Colour'. In this column, I need either Green, Yellow, Orange or Red. The deciding factor on which colour is assigned to the month will be the 'Average' column.</p>\n\n<p>For example:</p>\n\n<p>DepartmentA for May's Average is equal to <code>0.96</code>\nUpon referencing <em>Table B</em>, I can see that line 8, <code>0.75+</code> will be the range this fits into. Therefore Red is the colour I want placed in <em>table A</em> next to Mays average.</p>\n\n<p>I have left RangeEnd for the highest range per month as NULL as it is basically <code>75+</code>, anything greater than <code>0.75</code> slots in here.</p>\n\n<p>Can anyone point me in the right direction that is not too time consuming.</p>\n\n<p><img src=\"http://i.stack.imgur.com/g6zLd.png\" alt=\"enter image description here\"></p>\n"},{"tags":["c#","sql","sql-server","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":45,"score":-1,"question_id":12596751,"title":"How do i only select Cash and remove the cheque option during txt output","body":"<p>Can i get some help please. I have a query as shown below. Right now it shows both cheque and cash. But i want it to show only cash query. Yes, i believe i can edit it(now its vulnerable to SQL Injections)    </p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Drawing;\nusing System.Linq;\nusing System.Text;\nusing System.Windows.Forms;\nusing System.Data.SqlClient;\n\n\nnamespace MyTestData\n{\npublic partial class frmCollection : Form\n{\n    public frmCollection()\n    {\n        InitializeComponent();\n    }\n\n\n    private void dtpFrom_ValueChanged(object sender, EventArgs e)\n    {\n\n    }\n\n    private void btnExtract_Click(object sender, EventArgs e)\n    {\n\n        SqlConnection objConn = new SqlConnection(\"MYCONNECTION STRING ETCETC\");\n\n\n        SqlCommand objCmd = new SqlCommand(\"SELECT CONVERT(char(10),PaidDate,3)\n AS PaidDate,InvoiceNo,PayerCode,CollectedFee,\n( CASE ReceiptTypeID WHEN 'Cash' THEN 'CASH' WHEN 'Check' THEN 'CHEQUE' END ) \nAS ReceiptTypeID FROM InvoicePayment \nWHERE (PaidDate &gt;= CONVERT(datetime, '\" + dtpFrom.Text + \"', 105)) AND (PaidDate &lt;= CONVERT(datetime, '\" + dtpTo.Text + \"', 105))\", objConn);\n\n        SqlDataReader objReader;\n        objReader = objCmd.ExecuteReader();\n\n        System.IO.FileStream fs = new System.IO.FileStream(\"C:\\\\CMSExportedData\\\\Collection-\" + DateTime.Now.ToString(\"dd-MM-yyyy\") + \".txt\", System.IO.FileMode.Create);\n        System.IO.StreamWriter sw = new System.IO.StreamWriter(fs, System.Text.Encoding.Default);\n\n        int count = 0;\n        while (objReader.Read())\n        {\n\n            for (int i = 0; i &lt; 5; i++)\n            {\n                if (!objReader.IsDBNull(i))\n                {\n                    string s;\n                    s = objReader.GetDataTypeName(i);\n                    //MessageBox.Show(s);\n                    if (objReader.GetDataTypeName(i) == \"char\")\n                    {\n                        sw.Write(objReader.GetString(i));\n                    }\n                    else if (objReader.GetDataTypeName(i) == \"money\")\n\n                    {\n                        sw.Write(objReader.GetSqlMoney(i).ToString());\n                    }\n                    else if (objReader.GetDataTypeName(i) == \"nvarchar\")\n                    {\n                        sw.Write(objReader.GetString(i));\n                    }\n                    else if (objReader.GetDataTypeName(i) == \"varchar\")\n                    {\n                        sw.Write(objReader.GetString(i));\n                    }\n\n                }\n                if (i &lt; 4)\n                {\n                    sw.Write(\"\\t\");\n                }\n\n            }\n            count = count + 1;\n            sw.WriteLine();\n\n        }\n        sw.Flush();\n        fs.Close();\n        objReader.Close();\n        objConn.Close();\n        MessageBox.Show(count + \" records exported successfully.\");\n        this.Close();\n\n    }\n\n    private void frmCollection_Load(object sender, EventArgs e)\n    {\n\n    }\n\n    private void dtpFrom_ValueChanged_1(object sender, EventArgs e)\n    {\n\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p><strong>Edit:</strong> Here is the table structure:</p>\n\n<p><img src=\"http://i.stack.imgur.com/CU5rq.png\" alt=\"enter image description here\"></p>\n\n<p>Here is some sample data:</p>\n\n<p><img src=\"http://i.stack.imgur.com/mZnOG.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":1,"view_count":112,"score":0,"question_id":12602276,"title":"SQL - Converting datetime format to 12 hours format with hh:mm:ss","body":"<p>I have a query like,</p>\n\n<pre><code>SELECT CONVERT(VARCHAR, getdate(), 100) AS TwelveHH\n</code></pre>\n\n<p>output of the above query is <code>Sep 26 2012  6:02PM</code> &amp; i want to get the Hours from the above query means, i will use the query like,</p>\n\n<pre><code>SELECT RIGHT(CONVERT(VARCHAR, getdate(), 100), 7) AS getTime\n</code></pre>\n\n<p>output of the above query is <code>6:02PM</code>.</p>\n\n<p>But, i want output with <strong><em>seconds</em></strong> like <code>6:02:19PM</code> - <code>(hh:mm:ss)</code> format.</p>\n\n<p>How to i get <strong><em>hh:mm:ss</em></strong> format?</p>\n"},{"tags":["sql","sql-server-2008","reporting-services","dynamics-crm-2011","ssrs-reports"],"answer_count":1,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12598742,"title":"Report doesn't show data in VS2008 on Server 2008 R2?","body":"<p>I have to build a custom report that takes the orderlines for each order with the client's name,address and username on the report. </p>\n\n<p>When I make a simple query like:</p>\n\n<pre><code>SELECT FilteredSalesOrder.*, FilteredAccount.* \nFROM FilteredSalesOrder INNER JOIN FilteredAccount \nON FilteredSalesOrder.customerid = FilteredAccount.accountid\n</code></pre>\n\n<p>I retrieve data but only for a single line. When there are more, the preview shows nothing.\nwhich is not that big of a problem because I only need it for 1 order at a time.</p>\n\n<p>So for my OrderReport I need all the OrderLines for each order. The report is printed out per Order not for multiple orders at the same time.\nIt will look something like this:\n<img src=\"http://i.stack.imgur.com/a7rTo.jpg\" alt=\"enter image description here\"></p>\n\n<p>I just joined 5 tables from which I need data in my Order Report.</p>\n\n<pre><code>SELECT FilteredSalesOrder.*, FilteredAccount.*, FilteredSalesOrderDetail.*, FilteredSystemUser.*, FilteredProduct.*\nFROM ((((FilteredSalesOrder INNER JOIN FilteredAccount \nON FilteredSalesOrder.customerid = FilteredAccount.accountid) INNER JOIN FilteredSalesOrderDetail \nON FilteredSalesOrderDetail.salesorderid = FilteredSalesOrder.salesorderid) INNER JOIN FilteredProduct\nON FilteredProduct.productid = FilteredSalesOrderDetail.productid) INNER JOIN FilteredSystemUser\nON FilteredSystemUser.systemuserid = FilteredSalesOrder.ownerid)\n</code></pre>\n\n<p>So to summarize: </p>\n\n<ul>\n<li>Is my SQL query correct?</li>\n<li>When I upload a simple report it gives me the error rsInvalidDataSourceReference. I know what this issue means but what do I need to do to solve it.</li>\n<li>How do I make sure that in the report, the orderline table keeps on growing as needed to include all the orderlines?</li>\n</ul>\n"},{"tags":["asp.net","sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12601826,"title":"How to use after insert trigger to send e-mail","body":"<p>I would like to send an e-mail alert after inserting a new data to my sql server data table. How can i do this?</p>\n\n<p>I have tried following trigger, but i'm no pretty sure about the functionality of it. </p>\n\n<pre><code>CREATE TRIGGER dbo.sendMail \n   ON  dbo.staff_leaves\n   AFTER INSERT\nAS \nBEGIN\n\n    SET NOCOUNT ON;\n    EXEC msdb.dbo.sp_send_dbmail\n          @to = 'whoever@yourcompany.com', \n          @profile_name = 'default',\n          @subject = 'New Row', \n          @body = 'Yep, they sure were.';\n\nEND\nGO\n</code></pre>\n\n<p>Anyone please explain me how to do this.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":381,"score":2,"question_id":9349336,"title":"Merge Rows in SQL Server 2008","body":"<p>I have a table like the one below:</p>\n\n<pre>\nCustomer   |Type     |Count\nJoe        |Silver-S |1\nJoe        |Silver   |7\nJoe        |Gold     |3\nJoe        |Gold-S   |2\n</pre>\n\n<p>I need to merge this so that it looks like the following:</p>\n\n<pre>\nCustomer   |Type     |Count\nJoe        |Silver   |8\nJoe        |Gold     |5\n</pre>\n\n<p>Help!</p>\n"},{"tags":["winforms","sql-server-2008","c#-4.0","linq-to-sql","datagridview"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":12601210,"title":"how to make a form with grid view pop out with populated data, appear when a button is pressed in c#.net","body":"<p>I guess I need to write code in this button click event to get my desired output, but unable write down the steps. Any help from you guys would be helpful and will make me learn. Thank you.</p>\n\n<pre><code> private void btnViewAllEntries_Click(object sender, EventArgs e)\n\n    {\n        SqlConnection con = new SqlConnection(Helper.ConnectionString);\n        SqlCommand cmd = new SqlCommand(\"Select * from DirDetails\");\n        con.Open();\n\n\n        con.Close();\n        MessageBox.Show(DetailsView.cs);//DetailsView.cs is winform with gridview\n    }\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql","summary"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":38,"score":4,"question_id":12601708,"title":"Generate summary data based on configuration table in SQL Server","body":"<p>I'm trying to generate a summary from a list of scores in SQL Server 2008.<br>\nI have two tables: <a href=\"http://sqlfiddle.com/#!3/85314\" rel=\"nofollow\"><strong>SQL Fiddle link</strong></a></p>\n\n<p>The <code>ScorePerson</code> table contains people's ID and their score from -5 to 15.  End users of my SQL/Stored Procedure needs to create a summary like this:</p>\n\n<pre><code>Scoreband| TotalNoOfPeople | AvgScore\n--------------------------------\n-5 to 0  | 2               | -2\n0 to 5   | 3               |  2\n5 to 10  | 2               |  8\n10 to 15 | 3               | 13.3\n</code></pre>\n\n<p>The score band i.e. the min and max values should be configurable from the <code>ScoreMinMax</code> table by the end user.</p>\n\n<p>I have tried to achive this using CASE stement, but it generates the summary as columns.  I I would probably need to pivot it or use UNION from multiple select statements.  But this approach doesn't seem scalable if there were new rows added to the <code>ScoreMinMax</code> table.\nSo far I was able to achieve some results similar to the example above using CROSS JOINT, but it doesn't always produces the correct results.</p>\n\n<p>Is anyone able to point me in the right direction on how to achieve this please?</p>\n\n<p><a href=\"http://sqlfiddle.com/#!3/85314\" rel=\"nofollow\"><strong>SQL Fiddle link</strong></a></p>\n\n<pre><code>ScorePerson - contains actual scores\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/rayEl.png\" alt=\"Table screenshot\"></p>\n\n<pre><code>ScoreMinMax - the configuration for min and max score bands\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/IKS7M.png\" alt=\"enter image description here\"></p>\n"},{"tags":["java","eclipse","sql-server-2008","jdbc"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":3,"view_count":146,"score":-2,"question_id":12601895,"title":"JDBC connection failed (java.lang.ClassNotFoundException)","body":"<p>I just installed the JDBC driver from here for Sql Server (http://www.microsoft.com/en-us/download/details.aspx?id=11774) and I tested this sample code to test the connection:</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/aa342339.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/aa342339.aspx</a></p>\n\n<p>The error I get seems to be in line:</p>\n\n<pre><code>Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n\n\n java.lang.ClassNotFoundException:\n com.microsoft.sqlserver.jdbc.SQLServerDriver   \n at java.net.URLClassLoader$1.run(Unknown Source)\n at java.security.AccessController.doPrivileged(Native Method)  \n at java.lang.ClassLoader.loadClass(Unknown Source)     \n at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)  \n at java.lang.ClassLoader.loadClass(Unknown Source)     \n at java.lang.Class.forName0(Native Method)\n</code></pre>\n\n<p>Two notes:</p>\n\n<ul>\n<li>If I remove the try-finally code I get NO error ==> which probably prooves there is nothing wrong with the user &amp; password I created as login information to the database.</li>\n<li>I created a Person table with Contact as a column in my database.</li>\n</ul>\n\n<p>Side questions: </p>\n\n<ul>\n<li>What exactly does this mean: localhost:1433</li>\n<li>How can I set Eclipse to show me what line triggers the error? Thank you very much!</li>\n</ul>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":104,"score":2,"question_id":12585713,"title":"Update value from previous row value using CTE","body":"<p>This question is a variation of my older question <a href=\"http://stackoverflow.com/questions/11785805/update-null-column-value-from-non-null-value-in-previous-row\">here</a>. I hope to explain the problem using an example. So</p>\n\n<p><strong>Sample Data</strong><br>\nHere is sample data to work with:</p>\n\n<pre><code>DECLARE @Test TABLE (GID      int,             Seq     int, \n                     IsLive   bit,             Eff     date, \n                     Name     varchar(50),     Salary  decimal) \n\nINSERT INTO @Test VALUES (1, 1, 1, '01-08-2012', 'RTS', NULL)\nINSERT INTO @Test VALUES (1, 2, 0, '01-09-2012', 'RTA', NULL)\nINSERT INTO @Test VALUES (1, 3, 1, '01-10-2012', 'FSA', NULL)\nINSERT INTO @Test VALUES (1, 4, 0, '01-11-2012',  NULL, NULL)\nINSERT INTO @Test VALUES (1, 5, 1, '01-12-2012', 'FSA', NULL)\nINSERT INTO @Test VALUES (2, 1, 1, '01-08-2012', 'RTS', NULL)\nINSERT INTO @Test VALUES (2, 2, 0, '01-09-2012', 'RTA', NULL)\nINSERT INTO @Test VALUES (2, 3, 1, '01-10-2012', 'FSA', NULL)\nINSERT INTO @Test VALUES (2, 4, 0, '01-11-2012', 'GSM', NULL)\nINSERT INTO @Test VALUES (2, 5, 1, '01-12-2012', 'FSA', NULL)\nINSERT INTO @Test VALUES (3, 1, 1, '01-01-2012', 'FSA', NULL)\nINSERT INTO @Test VALUES (3, 2, 0, '01-02-2012', NULL, NULL)\nINSERT INTO @Test VALUES (4, 1, 1, '01-01-2012', NULL, NULL)\nINSERT INTO @Test VALUES (4, 2, 0, '01-02-2012', 'FSA', NULL)\nINSERT INTO @Test VALUES (4, 3, 0, '01-03-2012', NULL, NULL)\nINSERT INTO @Test VALUES (5, 1, 0, '01-01-2012', NULL, NULL)\nINSERT INTO @Test VALUES (5, 2, 1, '01-02-2012', 'LSI', NULL)\nINSERT INTO @Test VALUES (5, 3, 0, '01-03-2012', NULL, NULL)\nINSERT INTO @Test VALUES (6, 1, 1, '01-01-2012', NULL, NULL)\nINSERT INTO @Test VALUES (6, 2, 0, '01-02-2012', 'LSI', NULL)\nINSERT INTO @Test VALUES (6, 3, 1, '01-03-2012', NULL, NULL)\n\nSELECT * FROM @Test\n</code></pre>\n\n<p><strong>Following, are two <em>sample result sets</em>.  Although the snippet shows <em>inserts</em> the point is to show what acceptable <em>output set</em> would look like:</strong></p>\n\n<p><strong>Sample Output #1</strong><br>\nIn the data set below when a row has <code>IsLive=0</code> then the value from its columns must over write the value of the same columns on the rows where <code>IsLive=1</code> below it skipping NULL values. Ignore any <code>IsLive=1</code> rows before the first <code>IsLive=0</code> row.</p>\n\n<pre><code>    INSERT INTO @Test VALUES (1, 1, 1, '01-08-2012', 'RTS', NULL)\n    INSERT INTO @Test VALUES (1, 2, 0, '01-09-2012', 'RTA', NULL)\n    INSERT INTO @Test VALUES (1, 3, 1, '01-10-2012', 'RTA', NULL)\n    INSERT INTO @Test VALUES (1, 4, 0, '01-11-2012',  NULL, NULL)\n    INSERT INTO @Test VALUES (1, 5, 1, '01-12-2012', 'RTA', NULL)\n    INSERT INTO @Test VALUES (2, 1, 1, '01-08-2012', 'RTS', NULL)\n    INSERT INTO @Test VALUES (2, 2, 0, '01-09-2012', 'RTA', NULL)\n    INSERT INTO @Test VALUES (2, 3, 1, '01-10-2012', 'RTA', NULL)\n    INSERT INTO @Test VALUES (2, 4, 0, '01-11-2012', 'GSM', NULL)\n    INSERT INTO @Test VALUES (2, 5, 1, '01-12-2012', 'GSM', NULL)\n    INSERT INTO @Test VALUES (3, 1, 1, '01-01-2012', 'FSA', NULL)\n    INSERT INTO @Test VALUES (3, 2, 0, '01-02-2012', NULL, NULL)\n    INSERT INTO @Test VALUES (4, 1, 1, '01-01-2012', NULL, NULL)\n    INSERT INTO @Test VALUES (4, 2, 0, '01-02-2012', 'FSA', NULL)\n    INSERT INTO @Test VALUES (4, 3, 0, '01-03-2012', NULL, NULL)\n    INSERT INTO @Test VALUES (5, 1, 0, '01-01-2012', NULL, NULL)\n    INSERT INTO @Test VALUES (5, 2, 1, '01-02-2012', 'LSI', NULL)\n    INSERT INTO @Test VALUES (5, 3, 0, '01-03-2012', NULL, NULL)\n    INSERT INTO @Test VALUES (6, 1, 1, '01-01-2012', NULL, NULL)\n    INSERT INTO @Test VALUES (6, 2, 0, '01-02-2012', 'LSI', NULL)\n    INSERT INTO @Test VALUES (6, 3, 1, '01-03-2012', 'LSI', NULL)\n\n    SELECT * FROM @Test AS FakedOutput_1\n</code></pre>\n\n<p><strong>Sample Output #2</strong><br>\nIn the data set below when a row has <code>IsLive=0</code> then the value from its columns must over write the value of the same columns on the rows where <code>IsLive=1</code> below it. Columns with NULL values take the value from the previous row.</p>\n\n<pre><code>    INSERT INTO @Test VALUES (1, 1, 1, '01-08-2012', 'RTS', NULL)\n    INSERT INTO @Test VALUES (1, 2, 0, '01-09-2012', 'RTA', NULL)\n    INSERT INTO @Test VALUES (1, 3, 1, '01-10-2012', 'RTA', NULL)\n    -- &lt;- the following row is different from prev\n    INSERT INTO @Test VALUES (1, 4, 0, '01-11-2012', 'RTA', NULL) \n    INSERT INTO @Test VALUES (1, 5, 1, '01-12-2012', 'RTA', NULL)\n    INSERT INTO @Test VALUES (2, 1, 1, '01-08-2012', 'RTS', NULL)\n    INSERT INTO @Test VALUES (2, 2, 0, '01-09-2012', 'RTA', NULL)\n    INSERT INTO @Test VALUES (2, 3, 1, '01-10-2012', 'RTA', NULL)\n    INSERT INTO @Test VALUES (2, 4, 0, '01-11-2012', 'GSM', NULL)\n    INSERT INTO @Test VALUES (2, 5, 1, '01-12-2012', 'GSM', NULL)\n    INSERT INTO @Test VALUES (3, 1, 1, '01-01-2012', 'FSA', NULL)\n    INSERT INTO @Test VALUES (3, 2, 0, '01-02-2012', 'FSA', NULL)\n    INSERT INTO @Test VALUES (4, 1, 1, '01-01-2012', NULL, NULL)\n    INSERT INTO @Test VALUES (4, 2, 0, '01-02-2012', 'FSA', NULL)\n    INSERT INTO @Test VALUES (4, 3, 0, '01-03-2012', 'FSA', NULL)\n    INSERT INTO @Test VALUES (5, 1, 0, '01-01-2012', NULL, NULL)\n    INSERT INTO @Test VALUES (5, 2, 1, '01-02-2012', 'LSI', NULL)\n    INSERT INTO @Test VALUES (5, 3, 0, '01-03-2012', 'LSI', NULL)\n    INSERT INTO @Test VALUES (6, 1, 1, '01-01-2012', NULL, NULL)\n    INSERT INTO @Test VALUES (6, 2, 0, '01-02-2012', 'LSI', NULL)\n    INSERT INTO @Test VALUES (6, 3, 1, '01-03-2012', 'LSI', NULL)\n\n    SELECT * FROM @Test AS FakedOutput_2\n</code></pre>\n\n<p><strong>Attempted Solution</strong><br>\nHere is what I have come up with so far, but it fails my first test case (<code>GID=1</code>)</p>\n\n<pre><code>;WITH CTE AS ( \n    -- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \n    SELECT  T.GID, T.SEQ, T.IsLive, NULL cGuid, NULL cSEQ, \n            cast(0 as bit) cIsLive, T.Name, T.Salary \n    FROM    @Test T\n    JOIN    @Test S ON T.GID = S.GID AND T.Seq = S.Seq AND S.IsLive = 0\n    -- - - - - - - \n      UNION ALL \n    -- - - - - - - \n    SELECT  t.GID, t.SEQ, T.IsLive, c.GID cGID, c.Seq cSEQ, \n             c.IsLive cIsLive, ISNULL(C.Name, T.Name), \n             ISNULL(t.Salary, c.Salary) \n    FROM    CTE c \n    JOIN    @Test t ON    t.GID     = c.GID   AND \n                          t.Seq     &gt; c.Seq   AND \n                          t.IsLive  = 1       AND \n                          c.IsLive  = 0\n    -- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \n) \n--SELECT * FROM CTE ORDER BY CTE.GID, CTE.Seq\nUPDATE  t \nSET     Name = c.Name, Salary = c.Salary\nFROM    @Test t \nJOIN    CTE c     ON c.GID = t.GID AND c.Seq = t.SEQ\nWHERE   C.cIsLive IS NOT NULL\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12599167,"title":"Arithmetic overflow error when converting expression to data type datetime","body":"<p>In the following query:</p>\n\n<pre><code>SELECT \n  DU.MESSAGEINSERTDATE \nfrom [MYSMSREPORT].[DBO].[SIXDAYSHISTORY] \nwhere\n  (CONVERT(NVARCHAR, CONVERT(DATETIME, MESSAGEINSERTDATE, 104), 112) \n  BETWEEN \n     CONVERT(NVARCHAR, CONVERT(DATETIME, 01/08/2008, 104), 112) \n  AND CONVERT(NVARCHAR,CONVERT(DATETIME,31/09/2012,104),112))\n</code></pre>\n\n<p>I have this error:</p>\n\n<blockquote>\n  <p>Arithmetic overflow error converting expression to data type datetime</p>\n</blockquote>\n\n<p>What is the problem?</p>\n"},{"tags":["java","sql-server-2008","jdbc"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":80,"score":0,"question_id":12600653,"title":"JDBC connection to Sql Server 2008","body":"<p>I have been writing <strong>Java</strong> applets using Eclipse and now I'd like to try some advanced elements like <strong>JDBC Connection</strong> to <strong>Microsoft SQL Server Management Studio 2008</strong>.\nWhat driver should I install and where can I find it? Thank you!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","function","user-defined-types"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":71,"score":3,"question_id":12600496,"title":"How to make a function that take user defined table type as parameter and return same in sql?","body":"<p>Actually I have created a User defined table type in sql server 2008. Structure is given below.</p>\n\n<p>I am passing it as parameter in function and that function also return that type of table type. I am facing the problem, while I declare a variable of that type in function, inserting some data in it and return that parameter. </p>\n\n<p>Table type structure is:</p>\n\n<pre><code>Create Type OfferWithSubscription  as  Table                                        \n   (                                        \n     OfferID int, \n     OfferUserID  int,                                    \n     OfferImage  varchar(200),                          \n     OfferExactPrice Decimal(18,2),                                \n     OfferContent varchar(max),\n     OfferTitle varchar(100),                                    \n     StartDate datetime,                                    \n     EndDate datetime,                                    \n     StartTime datetime,                                    \n     StopTime datetime,                            \n     ShowToUser bit,    \n     SubID  int,                    \n     SubLevel varchar(100)\n   )\n</code></pre>\n\n<p>And the function, what I am trying to create is:</p>\n\n<pre><code>CREATE FUNCTION FN_ShowOffer\n(   \n    @Gold int,\n    @Silver int,\n    @Bronze int,\n    @table dbo.OfferWithSubscription Readonly )\nRETURNS dbo.OfferWithSubscription \nAS\nBEGIN\n\nDECLARE @ReturnTable AS dbo.OfferWithSubscription;\nDeclare @Case as varchar(20)\n         if(@Gold=0 and @Silver=1 and @Bronze=0 )\n            begin\n            set @Case='1S'\n            end\n           if(@Case='1S')\n           Begin\n                   insert into @ReturnTable                                    \n                   select OfferID, OfferUserID, OfferImage, \n                     OfferExactPrice, OfferContent,\n                     OfferTitle, StartDate, EndDate, \n                     StartTime, StopTime, ShowToUser,\n                     SubID, SubLevel\n                   from @table\n                   where SubID=4 \n           End\n\nRETURN (\n\n@ReturnTable\n)\nEND\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":75,"score":3,"question_id":12597811,"title":"Compare string data between two tables","body":"<p>i have two tables TABLE 1 with columns</p>\n\n<pre><code>ID Text           email ID\n============================\n1  This is Test   123@g.com    \n2  Make my day    1234@g.com\n</code></pre>\n\n<p>TABLE 2 with one column</p>\n\n<pre><code>words(column)\n=============    \nTest    \ntrip    \nday\n</code></pre>\n\n<p>now wat i want to do is compare the text ( each and every word) from <code>Table 1</code> with each row ow word in <code>TABLE 2</code>, if found then the id should be logged on a different table.</p>\n\n<p>example: if from <code>TABLE1</code>  <code>Test</code> is the word which is the row value in the <code>TABLE 2</code> word column. so it should log <code>ID =1</code> in a different table.</p>\n\n<p>also once the word is found it shouldn't go for further iteration.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":95,"score":0,"question_id":12583580,"title":"group by on a range","body":"<p>i have a table with employee names and their vendor experiences.\ni have to create a table with the following data</p>\n\n<p>data given to me is like</p>\n\n<pre><code>empname vendor experience\na        1\nb        2\nc        10\nd        11\ne        20\nf        12\ng        21\nh        22\n</code></pre>\n\n<p>i want to generate a SQL query to display data like this</p>\n\n<pre><code>vendor_experience(months)   count\n0-6                          2\n0-12                         5\n0-18                         5\nmore                         8\n</code></pre>\n\n<p>please help me with the query.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":58,"score":3,"question_id":12599141,"title":"Sql timestamp for created/updated dates","body":"<p>In a few logging tables that are frequently written to, I'd like to be able to store a relative order so that I can union between these tables, and get the order that things actually occurred in. </p>\n\n<p>DateTime2's resolution is lacking. Several rows will get the exact same date, so there is no way to tell which happened first. \nBecause sorting should work across several tables, sorting by Id is out. </p>\n\n<p>Then I started looking at timestamp. This works for updated dates, but it does not work for created dates, because you can only have one timestamp column per table, and it automatically updates. </p>\n\n<p>This is for Microsoft Sql Server 2008. </p>\n\n<p>Any suggestions? </p>\n"},{"tags":["mysql","linux","sql-server-2008","odbc","linktable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12597822,"title":"MySQL as a bridge for SQL Server 2008 in Linux (Ubuntu)","body":"<p>In Windows, there is a link table feature in SQL Server (or MS Access). Basically, if I link SQL-Server and MySQL, then when my apps write something in SQL-Server, the MySQL is also updated via ODBC connection.</p>\n\n<p>Basically the flow is: win-apps -> sql-server 2008 -> (via win-odbc) mysql (linux)</p>\n\n<p>Now I want to reverse the process in Linux environment into:</p>\n\n<p>the flow I want is: nix-apps -> mysql (linux) -> (via nix-odbc?) sql-server 2008...</p>\n\n<p>Is this possible?</p>\n"},{"tags":["sql-server-2008","database-design","primary-key"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12597974,"title":"Using bit datatype as part of composite primary key, good or bad?","body":"<p>I just wanted to check if using column of type of bit (SQL Server 2008) and a guid to form a composite primary keys is bad practise or not. i.e.</p>\n\n<pre><code>id1 (GUID) pk\nid2 (GUID) pk\nid3 (int) pk\nisTrue (bit) pk\ncol1 (int)\ncol2 (datetime) \n...\n</code></pre>\n\n<p>I have 4 cols which makeup my composite pks.</p>\n\n<p>Please advice if its good idea or not.</p>\n"},{"tags":["c#","sql","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12597399,"title":"Sql - Not connecting to local database","body":"<p>I'm working with two databases. From 1st database in the server I'm taking all the tables and inserting in local machine in one empty database using a stored procedure. </p>\n\n<p>This is my stored procedure:</p>\n\n<pre><code>SET ANSI_NULLS ON\n GO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER proc [dbo].[ImportScriptAndData]\n\n@Branch int,\n@MainServer varchar(20),\n@LocalServer varchar(20),\n@LocalDBName varchar(20),\n@AuditType int\n\nAS Begin\n\nset nocount on;\n\n\n-- Delete the master tables\n\n-- dbo.AuditArea\nprint ('delete from ['+ @LocalServer +'].['+ @LocalDBName +'].[dbo].AuditArea')\nexec  ('delete from ['+ @LocalServer +'].['+ @LocalDBName +'].[dbo].AuditArea')\n\n-- Insert data into master tables\n\n-- dbo.AuditArea\nprint ('insert into ['+ @LocalServer +'].[HDFCAudit].dbo.AuditArea\nselect * from ['+ @MainServer +'].[HDFCAudit].dbo.AuditArea')\nexec ('insert into ['+ @LocalServer +'].['+ @LocalDBName +'].dbo.AuditArea\nselect * from ['+ @MainServer +'].['+ @LocalDBName +'].dbo.AuditArea')\n\nEnd\n</code></pre>\n\n<p>This stored procedure is on server database.</p>\n\n<p>I'm connecting two computers on lan. One is server and other is client</p>\n\n<p>On client application I have a button that can be clicked when I want to bring all the tables from server database to local empty database.</p>\n\n<p>My click button code is:</p>\n\n<pre><code>SqlConnection con = new SqlConnection(newConn);  //string newConn = \"Data Source=Servername;Initial Catalog=Audit;uid=sa;pwd=admin@123\";\n            con.Open();\n            SqlConnection conn = new SqlConnection(connectionstringLOCAL); //string connectionstringLOCAL = \"Data Source=Clientname;Initial Catalog=Audit;uid=sa;pwd=admin@123\";\n            conn.Open();\n            BranchCode = Convert.ToInt32(cboBranch.SelectedValue.ToString());\n            MainServer = \"Servername\";\n            LocalServer = \"ClientName\"; //express\n            LocalDatabase = \"Audit\";\n            AuditType = 1;\n            SqlCommand cmd = new SqlCommand(\"dbo.ImportScriptAndData\", con);\n            cmd.CommandType = CommandType.StoredProcedure;\n            cmd.Parameters.Add(new SqlParameter(\"@Branch\", SqlDbType.Int)).Value = BranchCode;\n            cmd.Parameters.Add(new SqlParameter(\"@MainServer\", SqlDbType.VarChar)).Value = MainServer;\n            cmd.Parameters.Add(new SqlParameter(\"@LocalServer\", SqlDbType.VarChar)).Value = LocalServer;\n            cmd.Parameters.Add(new SqlParameter(\"@LocalDBName\", SqlDbType.VarChar)).Value = LocalDatabase;\n            cmd.Parameters.Add(new SqlParameter(\"@AuditType\", SqlDbType.Int)).Value = AuditType;\n            //cmd.Parameters.AddWithValue(\"@Branch\", BranchCode);\n            //cmd.Parameters.AddWithValue(\"@MainServer\", MainServer);\n            //cmd.Parameters.AddWithValue(\"@LocalServer\", LocalServer);\n            //cmd.Parameters.AddWithValue(\"@LocalDBName\", LocalDatabase);\n            cmd.ExecuteNonQuery(); // **error on this line**\n</code></pre>\n\n<p>And I'm getting following error on this line:</p>\n\n<blockquote>\n  <p>Could not find server 'clientname' in sys.servers. Verify that the correct server name   was specified. If necessary, execute the stored procedure sp_addlinkedserver to add the server to sys.servers.</p>\n</blockquote>\n\n<p>What to do now?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":133,"score":1,"question_id":12589785,"title":"Can't install Microsoft SQL Server 2008 (R2) Management Studio","body":"<p>EDIT: solved! read below</p>\n\n<p>When I want to install MS SQL Server 2008 (R2) on my Win7 PC, I keep getting the error that I need to remove my SQL Server 2005 Express. This is, however, no longer installed.\n<img src=\"http://i.stack.imgur.com/NS3zb.png\" alt=\"enter image description here\"></p>\n\n<p>I followed the same routine as here: <a href=\"http://stackoverflow.com/questions/175881/sql-server-express-2008-install-side-by-side-w-sql-2005-express-fails\">SQL Server Express 2008 Install Side-by-side w/ SQL 2005 Express Fails</a> without result.</p>\n\n<p>I deleted everything linking to SQL Server 2005 and tried to install the 2008, same error ...<br>\nReinstalled 2005 and tried to update via the 2008 setup, \"can't find 2005 shared modules to update\"<br>\nDeleted 2005, rebooted, ran 2008 setup, same error: need to remove 2005 Express<br>\nReinstalled 2005, deleted shared modules, tried to install 2008, same error as above<br>\nCompletely deleted 2005, rebooted, ran setup, still 2005 on the system?!</p>\n\n<p>I ran the setup this time again and installed everything except the Menegement Studio.<br>\nToo bad this is the one program I definitly need to follow my classes.</p>\n\n<p>I hope you guy can help me with this!</p>\n\n<p>PS: I've got a lot of SQL programs installed, because I've got Visual Studio, SQLyog, ... installed for my studies</p>\n\n<p><strong>SOLUTION</strong><br>\nFound someone with the same problem: <a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/5fc58507-9f40-4213-acbd-32a57c8822d7/\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlsetupandupgrade/thread/5fc58507-9f40-4213-acbd-32a57c8822d7/</a><br>\nHow I solved my problem: As I have a 64bit system, I had to remove this registerfolder: <em>HKLM\\Software\\Wow6432Node\\Microsoft\\Microsoft SQL Server\\90</em><br>\nFor 32bit systems: remove <em>HKLM\\SOFTWARE\\Microsoft\\Microsoft SQL Server\\90</em></p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":69,"score":4,"question_id":12597143,"title":"Query for how to add the missing dates in sql","body":"<p>need to know how to add the date missing with null data in the corresponding field </p>\n\n<pre><code>**05/28/2012    NULL\n05/29/2012  NULL\n05/30/2012  NULL\n05/30/2012  Break In\n05/30/2012  Break Out\n05/31/2012  NULL**\n\n06/03/2012  NULL\n06/03/2012  Break In\n06/03/2012  Break Out\n06/03/2012  In Duty\n06/03/2012  Out Duty\n06/04/2012  NULL\n06/04/2012  In Duty\n06/04/2012  Out Duty\n06/05/2012  NULL\n06/05/2012  Break In\n06/05/2012  Break Out\n06/06/2012  NULL\n06/06/2012  Break In\n06/06/2012  Break Out\n06/06/2012  In Duty\n06/06/2012  Out Duty\n06/07/2012  NULL\n06/07/2012  In Duty\n06/07/2012  Out Duty\n\n06/10/2012  NULL\n06/10/2012  Break Out\n06/10/2012  In Duty\n06/10/2012  Out Duty\n06/11/2012  NULL\n06/11/2012  In Duty\n06/11/2012  Out Duty\n06/12/2012  NULL\n06/13/2012  NULL\n06/14/2012  NULL\n</code></pre>\n\n<p>The result that I need is like:</p>\n\n<pre><code>05/28/2012  NULL\n05/29/2012  NULL\n05/30/2012  NULL\n05/30/2012  Break In\n05/30/2012  Break Out\n05/31/2012  NULL\n05/01/2012      null\n05/02/2012      null\n06/03/2012  NULL\n06/03/2012  Break In\n06/03/2012  Break Out\n06/03/2012  In Duty\n06/03/2012  Out Duty\n06/04/2012  NULL\n06/04/2012  In Duty\n06/04/2012  Out Duty\n06/05/2012  NULL\n06/05/2012  Break In\n06/05/2012  Break Out\n06/06/2012  NULL\n06/06/2012  Break In\n06/06/2012  Break Out\n06/06/2012  In Duty\n06/06/2012  Out Duty\n06/07/2012  NULL\n06/07/2012  In Duty\n06/07/2012  Out Duty\n06/08/2012      null\n06/09/2012      null\n06/10/2012  NULL\n06/10/2012  Break Out\n06/10/2012  In Duty\n06/10/2012  Out Duty\n06/11/2012  NULL\n06/11/2012  In Duty\n06/11/2012  Out Duty\n06/12/2012  NULL\n06/13/2012  NULL\n06/14/2012  NULL\n</code></pre>\n"}]}
{"total":21074,"page":19,"pagesize":100,"questions":[{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12596522,"title":"How do I get multiple rows when value > 1","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/8679067/select-records-multiple-times-from-table\">Select Records multiple times from table</a>  </p>\n</blockquote>\n\n\n\n<p>I want to have my query return (multiple) rows for the value of TABLE_B.QTY.</p>\n\n<pre><code>TABLE A\nSALESNR  ITEMNR LINENR\n100      B2001  1\n101      B2002  2\n102      A1021  3 \n\nTABLE B \nLINENR   COLOR QTY\n1        WHITE  3  \n2        BLACK  1\n3        BROWN  8\n</code></pre>\n\n<p>For instance, with the following query:</p>\n\n<pre><code>SELECT    TABLE_A.SALESNR, TABLE_A.ITEMNR, TABLE_B.COLOR, TABLE_B.QTY\nFROM       TABLE_A  INNER JOIN TABLE_B ON TABLE_B.LINENR = TABLE_A.LINENR\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>100    B2001   White   3\n</code></pre>\n\n<p>What I need is:</p>\n\n<pre><code>100    B2001   White   3\n100    B2001   White   3\n100    B2001   White   3\n</code></pre>\n\n<p>Is there a way to do this?\nCan't think of the right keywords to Google this...</p>\n\n<p>Thnx,</p>\n\n<p>Mike</p>\n"},{"tags":["c#","database","sql-server-2008","data-binding"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":107,"score":1,"question_id":11723425,"title":"Hints to read and save to database","body":"<p>I'm doing a C# course this summer and in the current task I'm going to work with a database. Very interesting and I'm eager to get working, but I'm totally lost right now(perhaps my blood suger is low)! According to the demands of the task, I must use a disconnected approach using DataSets or dataTables, DataAdapters and CommandBuilders to load the a copy of the database into memory to work with it(open, read and close) and then when I want to update the database, do the opposite(open, save and close)</p>\n\n<p>I have created a SQL Server 2008 database and I have also created a table. Hmmm, now what!? I guess I have to begin to connect to the database and select the table. It's from here and forward that I would apreciate some hints. Looking forward to get starting! Thanks!  </p>\n"},{"tags":["sql","sql-server-2008","obfuscation"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":262,"score":1,"question_id":8835317,"title":"Is there data masker or data obfuscator tool for sql server 2008?","body":"<p>I want to mask my sql server database data. Is there data masker or data obfuscator tool for sql server 2008?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":41,"score":5,"question_id":12581841,"title":"SQL Tree find anscestors at a specific level","body":"<p>Say I have the following tree:</p>\n\n<pre><code>CREATE TABLE Tree(Id int, ParentId int, Name varchar(20), Level int)\n\nINSERT INTO Tree(Id, ParentId, Name, Level)\nSELECT 1, NULL, 'Bob', 0 UNION ALL \nSELECT 2, 1, 'John', 1 UNION ALL\nSELECT 3, 1, 'Bill', 1 UNION ALL\nSELECT 4, 3, 'Peter', 2 UNION ALL\nSELECT 5, 4, 'Sarah', 3\n</code></pre>\n\n<p>I need a script to find the ancestor of a given node at a specific level:</p>\n\n<p>For example the ancestor of Sarah at level 2 is Peter, and the ancestor of Peter at level 0 is Bob. </p>\n\n<p>Is there an easy way to do this using a hierarchical CTE? <a href=\"http://sqlfiddle.com/#!3/b0572\" rel=\"nofollow\">sqlfiddle</a></p>\n"},{"tags":["c#","sql-server-2008","stored-procedures","dbcommand"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12593706,"title":"Handle optional parameters when I call a stored procedure","body":"<p>Problem statement.</p>\n\n<p>Basically I get 3 - 50 parameters that come back from a web service as a NVP array I then need to loop over them create the SQL command parameters for each and call the stored procedure.  Is there a more efficient way to handle it than the approach below?</p>\n\n<pre><code> using (SqlConnection connection = new SqlConnection(connectionString))\n                         {\n                             connection.Open();\n                             using (SqlCommand cm = connection.CreateCommand())\n                             {\n                                 cm.CommandText = \"MySproc\";\n                                 cm.CommandType = CommandType.StoredProcedure;\n                                 foreach (var field in row)\n                                 {\n\n                                     cm.Parameters.AddWithValue(\"@\" + field.Key.ToString(), field.Value.ToString());\n                                 }\n                                 cm.ExecuteNonQuery();\n                             }\n                         }\n</code></pre>\n"},{"tags":["sql-server-2008","jdbctemplate","java-stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12595107,"title":"Sending long value to bigint parameter of stored procedure from java","body":"<p>I am sending long datatype value from java to bigint parameter of  stored procedure of sqlserver. I am using spring for datasource/jdbctemplate.</p>\n\n<pre><code> public ArrayList&lt;SearchResult&gt; getSearchResults(Input in) throws SQLException \n {\n\n   ArrayList&lt;SearchResult&gt; output=new ArrayList&lt;SearchResult&gt;();\n   System.out.println(\"checking value of long: \"+in.getServiceNo());\n   String sql=\"{CALL mo_AdvanceSearch(?, ?)}\";\n   output=(ArrayList&lt;SearchResult&gt;)jdbcTemplate.query(sql, new MasterResultSearchMapper(),in.getServiceNo(), in.getFullname());\n   return output;\n }\n</code></pre>\n\n<p>Console:</p>\n\n<pre><code>INFO: checking value of long: 1231231234560\n</code></pre>\n\n<p>Here is the error i get after printing serviceNo:</p>\n\n<pre><code>org.springframework.dao.DataIntegrityViolationException:PreparedStatementCallback; SQL [{CALL mo_AdvanceSearch(?, ?)}]; Error converting data type varchar to numeric.; nested exception is com.microsoft.sqlserver.jdbc.SQLServerException: Error converting data type varchar to numeric.\n</code></pre>\n\n<p>I do get fine results if i change datatype of serviceNo to integer but it will be retricting since i want search on basis on bigger values also which will exceed the integer limit.</p>\n\n<p>Kindly hep me in here as i am unable to understand why am i getting this error of varchar</p>\n"},{"tags":["sql-server-2008","ssms2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12592124,"title":"Run 3.5 GB .sql file on SQL Server 2008","body":"<p>I'm using SQL Server on Windows 8, 32bit, 2GB memory. I want to execute a <code>.sql</code> file of 3.5 GB size. </p>\n\n<p>Tried doing:</p>\n\n<ol>\n<li>SSMS - Query thr UI - insufficient memory exception - NO LUCK</li>\n<li>sqlcmd - insufficient memory exception - NO LUCK</li>\n<li>split up the file into 18 files of 200 MB. sqlcmd each of them - NO LUCK<br>\n(btw no editor can open up such a huge file. Even 200MB file contains ~18,00,000 line. suggestions are welcome)</li>\n<li>put GO after each DML statement in the <code>.sql</code>, to reduce redo log size - NO LUCK<br>\n(amazingly it did work for my other 280MB file)</li>\n</ol>\n\n<p>Would <code>.bak</code> file help ?</p>\n\n<p>Is there (I hope there is) a way to do what I'm trying to do, in a good way ?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","xml","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":44,"score":0,"question_id":12587466,"title":"How to count occurrences of a node in sql xml","body":"<p>I am trying to do a count on the number of occurrences of the \"Colors\" node but have been so far unsuccessful.</p>\n\n<p>Below is what I have tried so far.</p>\n\n<p>If i have the following logic:</p>\n\n<pre><code>DECLARE @MyXML XML\nSET @MyXML = '&lt;SampleXML&gt;\n&lt;Colors&gt;\n&lt;Color1&gt;White&lt;/Color1&gt;\n&lt;Color2&gt;Blue&lt;/Color2&gt;\n&lt;Color3&gt;Black&lt;/Color3&gt;\n&lt;Color4 Special=\"Light\"&gt;Green&lt;/Color4&gt;\n&lt;Color5&gt;Red&lt;/Color5&gt;\n&lt;/Colors&gt;\n&lt;Fruits&gt;\n&lt;Fruits1&gt;Apple&lt;/Fruits1&gt;\n&lt;Fruits2&gt;Pineapple&lt;/Fruits2&gt;\n&lt;Fruits3&gt;Grapes&lt;/Fruits3&gt;\n&lt;Fruits4&gt;Melon&lt;/Fruits4&gt;\n&lt;/Fruits&gt;\n&lt;/SampleXML&gt;'\n\nSELECT\ncount(a.b.value('Colors','varchar(10)')) AS Color1\nFROM @MyXML.nodes('SampleXML') a(b)\n</code></pre>\n\n<p>I get the following error:</p>\n\n<blockquote>\n  <p>Msg 2389, Level 16, State 1, Line 50<br>\n  XQuery [value()]: 'value()' requires a singleton (or empty sequence), found operand of type 'xdt:untypedAtomic *'</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008","pivot"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":5214,"score":3,"question_id":3241450,"title":"SQL Pivot with multiple columns","body":"<p>Need help with the pivot clause in sql server 2008.\nI have a table with this info:</p>\n\n<p><PRE>\nWeekno    DayOfWeek     FromTime    ToTime\n1         2             10:00       14:00\n1         3             10:00       14:00\n2         3             08:00       13:00\n2         4             09:00       13:00\n2         5             14:00       22:00\n3         1             06:00       13:00\n3         4             06:00       13:00\n3         5             14:00       22:00\n</PRE></p>\n\n<p>I want to convert this into a table that looks like this:\n<PRE>\nWeek    Start1    End1    Start2    End2    Start3    End3    Start4    End4    Start5    End5    Start6    End6    Start7    End7\n1                         10:00     14:00   10:00     14:00\n2                                           08:00     13:00   09:00     13:00   14:00     22:00\n3       06:00     13:00                                       06:00     13:00   14:00     22:00\n</Pre></p>\n\n<p>Is there any way to do with a pivot query?\nPlease write respond with an example on how to do it. </p>\n\n<p>I appreciate any kind of help on this. Thanks in advance. </p>\n"},{"tags":["sql","sql-server-2008","query","sql-server-2005","parameters"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12591872,"title":"Multiple table query not working on certain databases","body":"<p>I have 12 locations each running their own database.  Each database is setup exactly the same, with their own information.  The databases are all SQL2005 or 2008 server.  I wrote a multiple table query to pull information for paying commission on sales.  This query works on 10 of the 12 databases, the other 2 databases do not return any results.  If I run the query with 2 joined tables (on the 2 databases it does not work on) it works, however the other tables in question have nothing to do with the \"where\" statement.  Could anyone shed some light on why it would not work on 2 of the 2005 server databases if it works on all of the others?  My Code is:</p>\n\n<pre><code>SELECT        Customers.sBarcode AS Barcode, Customers.dtCreated AS Created, CustomerUnlimitedTransactions.sCreatedBy AS [Commission pays], \n                         Surcharges.sDescription AS [Unlimited Package], Surcharges.dblCommission AS [Commission Amount], Users.sUserName AS Greeter, @startdate AS Start_Date, \n                         @enddate AS End_Date\nFROM            CustomerUnlimitedTransactions INNER JOIN\n                         Customers ON CustomerUnlimitedTransactions.lCustomerId = Customers.lCustomerID INNER JOIN\n                         VIPAccountTypes ON CustomerUnlimitedTransactions.lMonthlyAccountTypeId = VIPAccountTypes.lAccountType INNER JOIN\n                         Surcharges ON VIPAccountTypes.lSurchargeId = Surcharges.Surcharge_ID INNER JOIN\n                         Users ON Customers.lGreeterID = Users.ID_User\nWHERE        (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102)) AND \n                         (CustomerUnlimitedTransactions.sTransactionType = N'sale') AND (CustomerUnlimitedTransactions.lMonthlyAccountTypeId = '11') OR\n                         (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102)) AND \n                         (CustomerUnlimitedTransactions.sTransactionType = N'sale') AND (CustomerUnlimitedTransactions.lMonthlyAccountTypeId = '12')\nORDER BY Created\n</code></pre>\n\n<p>If I run the query like this I still do not return any results:</p>\n\n<pre><code>SELECT        Customers.sBarcode AS Barcode, Customers.dtCreated AS Created, CustomerUnlimitedTransactions.sCreatedBy AS [Commission pays], \n                             Surcharges.sDescription AS [Unlimited Package], Surcharges.dblCommission AS [Commission Amount], Users.sUserName AS Greeter, @startdate AS Start_Date, \n                             @enddate AS End_Date\n    FROM            CustomerUnlimitedTransactions INNER JOIN\n                             Customers ON CustomerUnlimitedTransactions.lCustomerId = Customers.lCustomerID INNER JOIN\n                             VIPAccountTypes ON CustomerUnlimitedTransactions.lMonthlyAccountTypeId = VIPAccountTypes.lAccountType INNER JOIN\n                             Surcharges ON VIPAccountTypes.lSurchargeId = Surcharges.Surcharge_ID INNER JOIN\n                             Users ON Customers.lGreeterID = Users.ID_User\n    WHERE        (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102))\n    ORDER BY Created\n</code></pre>\n\n<p>If I run the query like this I DO get results:</p>\n\n<pre><code>SELECT        Customers.sBarcode AS Barcode, Customers.dtCreated AS Created, CustomerUnlimitedTransactions.sCreatedBy AS [Commission pays], \n                                 Surcharges.sDescription AS [Unlimited Package], Surcharges.dblCommission AS [Commission Amount], Users.sUserName AS Greeter, @startdate AS Start_Date, \n                                 @enddate AS End_Date\n        FROM            CustomerUnlimitedTransactions INNER JOIN\n                                 Customers ON CustomerUnlimitedTransactions.lCustomerId = Customers.lCustomerID \n        WHERE        (Customers.dtCreated BETWEEN CONVERT(DATETIME, @startdate, 102) AND CONVERT(DATETIME, @enddate, 102))\n        ORDER BY Created\n</code></pre>\n\n<p>There are not any Null's associated with any of the above query's.  Again this works on 10 of 12... and yes the databases are EXACTLY the same.  (if I run this query out for a year date range I get results) however I should show 25 results from last week alone, and I am showing none on each of the 2.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12585091,"title":"SQL Server : execute dynamic sql help please","body":"<pre><code>EXEC SP_EXECUTESQL \n            @DynamicSQL\n        ,   N'@HostIDs VARCHAR(MAX) OUTPUT'\n        ,   @HostIDs OUTPUT;\n\nPRINT @HostIDs;\n\nSELECT @HostIDs AS HostIDs;\nSET @UpdateSQL = '\n            EXECUTE [dbo].[usp_Win7_HostUpdater_NEW]\n            @HostID = ''' + @HostIDs + ''' , \n            @PackageID = ''' + @PackageID  + ''' , \n            @MigrationFlag = ''' + @MigrationFlagID + ''' , \n            @Manufacturer = ' + @Manufacturer + ' , \n            @Product = ' + @Product + ' , \n            @Version = ' + @Version + ' ,\n            @Reason = ' + @Reason + ' ,\n            @Contact = ' + @Contact + '\n        ';\n\n        SELECT @UpdateSQL AS UpdateSQL;\n        PRINT @UpdateSQL;           \n        EXEC( @UpdateSQL )  \n  END  \n</code></pre>\n\n<p>I have a stored procedure on both a SQL Server 2005 and 2008 in which the above code is the last part of </p>\n\n<p>it returns a <code>VARCHAR(MAX)</code> of numbers separated by commas.</p>\n\n<p>Now this returned value is large upwards of 600k characters. If I execute this on a SQL Server 2005 it works like 50% of the time, <code>@HostIDs</code> is populated always and <code>@UpdateSQL</code> gets generated with the correct values and is executed.</p>\n\n<p>On SQL Server 2008, <code>@HostIDs</code> is populated but <code>@UpdateSQL</code> is always NULL</p>\n\n<p>This is weirding me out tremendously</p>\n\n<p>Can anyone maybe shed some light on my odd problem?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":50,"score":-2,"question_id":12576417,"title":"how to restrict access for a particular user or login in sql server","body":"<p>How do I restrict access for CREATE, ALTER, DROP statements to a particular user/login in SQL Server 2008?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":91,"score":0,"question_id":12588865,"title":"simplifying query that has multiple WITH and multiple subqueries","body":"<p>It is bothering me that for a simple query, I have to write out so many sub-selects and WITH statements. </p>\n\n<p>The question is: <strong>are there basic guidelines on how to simplify queries that have subqueries</strong>?</p>\n\n<p>Here's my query:</p>\n\n<pre><code>WITH cte_min\n     AS (SELECT a.client_id,\n                a.specimen_source,\n                a.received_date\n         FROM   f_accession_daily a\n                JOIN (SELECT DISTINCT f.client_id,\n                                      f.received_date,\n                                      f.accession_daily_key\n                      FROM   F_ACCESSION_DAILY f\n                             JOIN (SELECT CLIENT_ID,\n                                          Min(received_date) MinRecDate\n                                   FROM   F_ACCESSION_DAILY\n                                   GROUP  BY CLIENT_ID) i\n                               ON f.CLIENT_ID = i.CLIENT_ID\n                                  AND f.RECEIVED_DATE = i.MinRecDate) b\n                  ON a.ACCESSION_DAILY_KEY = b.ACCESSION_DAILY_KEY),\n     cte_max\n     AS (SELECT a.client_id,\n                a.specimen_source,\n                a.received_date\n         FROM   f_accession_daily a\n                JOIN (SELECT DISTINCT f.client_id,\n                                      f.received_date,\n                                      f.accession_daily_key\n                      FROM   F_ACCESSION_DAILY f\n                             JOIN (SELECT CLIENT_ID,\n                                          Max(received_date) MaxRecDate\n                                   FROM   F_ACCESSION_DAILY\n                                   GROUP  BY CLIENT_ID) i\n                               ON f.CLIENT_ID = i.CLIENT_ID\n                                  AND f.RECEIVED_DATE = i.MaxRecDate) b\n                  ON a.ACCESSION_DAILY_KEY = b.ACCESSION_DAILY_KEY),\n     cte_est\n     AS (SELECT DISTINCT client_id,\n                         MLIS_DATE_ESTABLISHED\n         FROM   D_CLIENT\n         WHERE  REC_ACTIVE_FLG = 1\n                AND MLIS_DATE_ESTABLISHED IS NOT NULL)\nSELECT DISTINCT f.client_id,\n                cmin.specimen_source,\n                cmin.received_date,\n                cmax.specimen_source,\n                cmax.received_date,\n                cest.MLIS_DATE_ESTABLISHED\nFROM   F_ACCESSION_DAILY f\n       LEFT JOIN cte_max cmax\n         ON cmax.CLIENT_ID = f.CLIENT_ID\n       LEFT JOIN cte_min cmin\n         ON cmin.CLIENT_ID = f.CLIENT_ID\n       LEFT JOIN cte_est cest\n         ON cest.CLIENT_ID = f.CLIENT_ID \n</code></pre>\n\n<p>I am not asking necessarily for you to do the simplification yourself (although I would be very grateful for this), rather I am asking for general guidelines/directions on re-writing this query to be more elegant.</p>\n"},{"tags":[".net","sql-server","sql-server-2008","microsoft-sync-framework"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12524459,"title":"Sync Framework unnecessary upload","body":"<p>I have a .NET application using the Microsoft sync framework to synchronise data between a SQL Server 2008 R2 server and a number of SQL Server CE clients.</p>\n\n<p>The initial sync successfully downloads the data on the server, however the sync logging indicates that it then performs an upload of the unchanged data it just completed downloading. This is extending initial sync times greatly.</p>\n\n<p>Extract from the SQL CE Logs below (this is the initial sync for one of the tables):</p>\n\n<pre><code>***** Client Provider Commit Transaction ****\nConnecting to database: Data\\Database.sdf\n**** Client Provider Begin Transaction ****\n----- Client Applying Changes from Server for Group \"Staff\" -----\n----- Applying Deletes for Table Staff-----\nDeletes Applied: 0\n--- End Applying Deletes for Table Staff-----\n----- Applying Upserts for Table Staff-----\n----- Applying Inserts for Table Staff-----\nInserts Applied: 1\n----- Applying Updates for Table Staff-----\nUpdates Applied: 0\n--- End Applying Upserts for Table Staff---\nStaff: Set ReceivedAnchor value: 1832\n--- End Client Applying Changes from Server for Group \"Staff\" ---\n</code></pre>\n\n<p>This is the logs for when changes are uploaded back to the server incorrectly, i.e. flagged as being updated when nothing has changed.</p>\n\n<pre><code>SELECT ut.* FROM    (select ut0.* from [Staff] as ut0 where      (ut0.__sysTrackingContext &lt;&gt;\n@CNTX OR ut0.__sysTrackingContext IS NULL)      AND ut0.__sysChangeTxBsn &gt;= @LBSN    ) as ut  \nLEFT OUTER JOIN   (select txcs0.* from __sysTxCommitSequence as txcs0) as txcsInsert  ON \nut.__sysInsertTxBsn = txcsInsert.__sysTxBsn  LEFT OUTER JOIN   (select txcs0.* from     \n__sysTxCommitSequence as txcs0) as txcsUpdate  ON ut.__sysChangeTxBsn = txcsUpdate.__sysTxBsn \nWHERE    COALESCE(txcsUpdate.__sysTxCsn, ut.__sysChangeTxBsn) &gt; @LCSN AND COALESCE    \n(txcsUpdate.__sysTxCsn, ut.__sysChangeTxBsn) &lt;= @ECSN   AND   (COALESCE(txcsInsert.__sysTxCsn, \nut.__sysInsertTxBsn) &lt;= @LCSN OR    COALESCE(txcsInsert.__sysTxCsn, ut.__sysInsertTxBsn) IS NULL \nOR    ut.__sysInsertTxBsn IN (SELECT SyncBsn FROM __syncTransactions))\nParameter: @LCSN Value: 0\nParameter: @LBSN Value: 0\nParameter: @ECSN Value: 408\nParameter: @CNTX Value: 73c9795b-29e5-49c3-8a66-f99f667225d5\nUpdate for row with PK: StaffId = 1 \n</code></pre>\n\n<p>On the server side, the Tracking Current Version is fine during the initial sync and then is incremented at some point which i am assuming is due to the client thinking the downloaded records are new.</p>\n\n<p>One thing that may be causing this is that Tracking is disabled to setup the SyncScopes and then enabled. This is done after the initial syncs.</p>\n\n<p>Not sure if i have provided enough information to be useful. Happy to provide more.</p>\n\n<p>Any help would be appreciated. Thanks.</p>\n"},{"tags":["database","json","web-services","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12588536,"title":"Create a service that gets data from database, creates json request and sends it?","body":"<p>How do I create a web service that gets data from a database on a server using MS SQL Server Express r2, creates a json request and sends it?</p>\n\n<p>I'm using C# and Microsoft Visual Studio 2010</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12590473,"title":"Is it possible to Send and Receive TCP/Socket messages using SQL","body":"<p>Quick question, is it possible to send and receive TCP/Socket message using SQL? If there is one would you mind providing some examples or maybe direct me to a post/website where I could this information.</p>\n\n<p>thank you</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12585986,"title":"Sql Server error [SQLState 42000] (Error 325)","body":"<p>I have a script that utilizes the new Merge Output clause. I've run it in 3 different instances (all non-Production environments) and it works great. When I tried running it in our production environment, I get the error:</p>\n\n<blockquote>\n  <p>Executed as user: xxx\\xxx. Incorrect syntax near 'Merge'. You\n  may need to set the compatibility level of the current database to a\n  higher value to enable this feature. See help for the SET\n  COMPATIBILITY_LEVEL option of ALTER DATABASE. [SQLSTATE 42000] (Error\n  325)  Incorrect syntax near 'Merge'. You may need to set the\n  compatibility level of the current database to a higher value to\n  enable this feature. See help for the SET COMPATIBILITY_LEVEL option\n  of ALTER DATABASE. [SQLSTATE 42000] (Error 325).  The step failed.</p>\n</blockquote>\n\n<p>I've checked the versions of each instance and they are all 10.0.4000.0. All of the non-system databases are set to compatibility level 90 (2005), and system databases are set to 100 (2008). What else do I need to check to see where my production instance is different from the other non-Production instances?</p>\n\n<p>Here's the query:</p>\n\n<pre><code>Declare @user varchar(20),\n        @message varchar(max)\nSet     @user = 'ISS20120917-144'\n\nCreate Table #data\n(\n    CustomerEventID_Surrogate Int Identity (1,1) Not Null Primary Key,\n    CustomerNumber Int Not Null,\n    ConvictionEventID Int Not Null,\n    CustomerEventHierarchyID Int Not Null,\n    SanctionEventID Int Not Null,\n    ReferenceNumber varchar(40) Null,\n    ConvictionACDID Int Null,\n    State_Code varchar(2) Not Null,\n    County_ID Int Null,\n    CitationCDLHolderValueID Int Null,\n    Hazmat Bit Null,\n    CMV Bit Null,\n    PassengerEndorsement Bit Null,\n    OccurrenceDate DateTime Not Null,\n    ConvictionDate DateTime Not Null,\n    CourtOrder Bit Null\n)\n\nCreate Table #surrogatemap\n(\n    CustomerEventID_Surrogate Int Not Null,\n    NewCustomerEventID Int Not Null\n)\n\nCreate Table #surrogateHIDmap\n(\n    NewCustomerEventID Int Not Null,\n    NewHistoryEventDetailID Int Not Null\n)\n\nBegin Tran\n\nBegin Try\n    Insert Into #data\n    Select  ce.Cust_No,\n            ce.CustomerEventID,\n            ceh.CustomerEventHierarchyID,\n            ceSAN.CustomerEventID,\n            ce.ReferenceNumber,\n            hed.ACDID,\n            hed.State_Code,\n            hed.County_ID,\n            hed.CitationCDLHolderValueID,\n            hed.Hazmat,\n            hed.CMV,\n            hed.PassengerEndorsement,\n            hed.OccurrenceDate,\n            Case    When cd.ConvictionDate IS NOT NULL Then cd.ConvictionDate\n                    Else hed.OccurrenceDate\n            End As [ConvictionDate],\n            hed.CourtOrder\n    From IADS..CustomerEvent ce\n    Inner Join IADS..HistoryEventDetail hed On hed.CustomerEventID = ce.CustomerEventID\n        And hed.EndDate IS NULL\n    Inner Join IADS..CustomerEventCode cec On cec.CustomerEventCodeID = hed.CustomerEventCodeID\n        And cec.CustomerEventCodeID &lt;&gt; -51\n    Left Outer Join IADS..ConvictionDetail cd On cd.HistoryEventDetailID = hed.HistoryEventDetailID\n    Inner Join IADS..CustomerEventHierarchy ceh On ceh.CustomerEventID = ce.CustomerEventID\n        And ceh.EndDate IS NULL\n    Inner Join IADS..CustomerEvent ceSAN On ceSAN.CustomerEventID = ceh.RelatedCustomerEventID\n        And ceSAN.CustomerEventDispositionID IS NULL\n    Inner Join IADS..CustomerSanctionDetail csd On csd.CustomerEventID = ceSAN.CustomerEventID\n        And csd.SanctionDiscardedReasonID IS NULL\n    Inner Join IADS..SanctionReasonCode src On src.SanctionReasonCodeID = csd.SanctionReasonCodeID\n        And src.SanctionReasonCodeID = -320\n    Where ce.CustomerEventDispositionID IS NULL\n\n    Merge Into IADS..CustomerEvent\n        Using #data As src On 1 = 0\n    When Not Matched Then\n    Insert\n    (\n        CustomerEventCategoryID,\n        Cust_No,\n        ReferenceNumber,\n        CreatedBy,\n        CreatedDate,\n        UpdatedBy,\n        UpdatedDate\n    )\n    Values\n    (\n        -2,\n        src.CustomerNumber,\n        src.ReferenceNumber,\n        @user,\n        GetDate(),\n        @user,\n        GetDate()\n    )\n    Output\n        src.CustomerEventID_Surrogate,\n        inserted.CustomerEventID\n    Into #surrogatemap;\n\n    Select  sm.NewCustomerEventID,\n        -8 As [HistoryEventTypeID],\n        -51 As [CustomerEventCodeID],\n        131 As [ACDID],\n        d.State_Code,\n        d.County_ID,\n        d.CitationCDLHolderValueID,\n        d.OccurrenceDate,\n        d.ConvictionDate,\n        d.Hazmat,\n        d.CMV,\n        d.CourtOrder,\n        GETDATE() As [EffectiveDate],\n        @user As [UpdatedBy],\n        GETDATE() As [UpdatedDate],\n        d.ConvictionACDID,\n        d.PassengerEndorsement\n    Into    #hiddata\n    From    #data d\n    Inner Join #surrogatemap sm On sm.CustomerEventID_Surrogate = d.CustomerEventID_Surrogate\n\n    Merge Into IADS..HistoryEventDetail\n        Using #hiddata As src On 1 = 0\n    When Not Matched Then\n    Insert\n    (\n        CustomerEventID,\n        HistoryEventTypeID,\n        CustomerEventCodeID,\n        ACDID,\n        State_Code,\n        County_ID,\n        CitationCDLHolderValueID,\n        OccurrenceDate,\n        Hazmat,\n        CMV,\n        CourtOrder,\n        EffectiveDate,\n        UpdatedBy,\n        UpdatedDate,\n        UnderlyingACDID,\n        PassengerEndorsement\n    )\n    Values\n    (\n        src.NewCustomerEventID,\n        src.HistoryEventTypeID,\n        src.CustomerEventCodeID,\n        src.ACDID,\n        src.State_Code,\n        src.County_ID,\n        src.CitationCDLHolderValueID,\n        src.OccurrenceDate,\n        src.Hazmat,\n        src.CMV,\n        src.CourtOrder,\n        src.EffectiveDate,\n        src.UpdatedBy,\n        src.UpdatedDate,\n        src.ConvictionACDID,\n        src.PassengerEndorsement\n    )\n    Output\n        src.NewCustomerEventID,\n        inserted.HistoryEventDetailID\n    Into #surrogateHIDmap;\n\n    Insert Into IADS..CustomerEventHierarchy\n    (\n        CustomerEventID,\n        RelatedCustomerEventID,\n        EffectiveDate,\n        UpdatedBy,\n        UpdatedDate\n    )\n    Select  sm.NewCustomerEventID,\n            d.SanctionEventID,\n            GETDATE(),\n            @user,\n            GETDATE()\n    From    #data d\n    Inner Join #surrogatemap sm On sm.CustomerEventID_Surrogate = d.CustomerEventID_Surrogate\n\n    Insert Into IADS..CourtFineDetail\n    (\n        HistoryEventDetailID,\n        ConvictionDate\n    )\n    Select  s.NewHistoryEventDetailID,\n            d.ConvictionDate\n    From  #hiddata d\n    Inner Join #surrogateHIDmap s On s.NewCustomerEventID = d.NewCustomerEventID\n\n    -- Remove the tie to the SUS077\n    Update IADS..CustomerEventHierarchy\n    Set     EndDate = GETDATE(),\n            UpdatedBy = @user,\n            UpdatedDate = GETDATE()\n    Where   CustomerEventHierarchyID In (Select CustomerEventHierarchyID From #data)\n\n    -- Build temp table containing the records that have already purged\n    Select  ce.Cust_No,\n            ce.CustomerEventID,\n            ceh.CustomerEventHierarchyID\n    Into    #disposedRecords\n    From    IADS..CustomerEvent ce\n    Inner Join IADS..HistoryEventDetail hed On hed.CustomerEventID = ce.CustomerEventID\n        And hed.EndDate IS NULL\n    Inner Join IADS..CustomerEventCode cec On cec.CustomerEventCodeID = hed.CustomerEventCodeID\n        And hed.CustomerEventCodeID &lt;&gt; -51\n    Inner Join IADS..CustomerEventHierarchy ceh On ceh.CustomerEventID = ce.CustomerEventID\n        And ceh.EndDate IS NULL\n    Inner Join IADS..CustomerEvent ceSAN On ceSAN.CustomerEventID = ceh.RelatedCustomerEventID\n        And ceSAN.CustomerEventDispositionID IS NOT NULL\n    Inner Join IADS..CustomerSanctionDetail csd On csd.CustomerEventID = ceSAN.CustomerEventID\n        And csd.SanctionReasonCodeID = -320\n    Where   ce.CustomerEventDispositionID IS NOT NULL\n    Order By ce.CustomerEventDispositionDate Desc\n\n    -- Un-purge all of the records that were previously tied to a SUS077\n    Update  IADS..CustomerEvent\n    Set     CustomerEventDispositionID = Null,\n            CustomerEventDispositionComment = Null,\n            CustomerEventDispositionDate = Null,\n            UpdatedBy = @user,\n            UpdatedDate = GETDATE()\n    Where   CustomerEventID In (Select CustomerEventID From #disposedRecords)\n\n    -- Remove the records from the PURGEEventsReadyForPurge table\n    Delete\n    From IADS..PURGEEventsReadyForPurge\n    Where CustomerEventID In (Select CustomerEventID From #disposedRecords)\n\n    -- Remove tie of purged records\n    Update  IADS..CustomerEventHierarchy\n            Set EndDate = GETDATE(),\n            UpdatedBy = @user,\n            UpdatedDate = GETDATE()\n    Where   CustomerEventHierarchyID In (Select CustomerEventHierarchyID From #disposedRecords)\n\n    Delete From IADS..PURGEEventsReadyForPurge Where PURGEEventsReadyForPurgeID In\n    (\n        Select  PURGEEventsReadyForPurgeID\n        From    IADS..PURGEEventsReadyForPurge p\n        Inner Join IADS..CustomerEvent ce On ce.CustomerEventID = p.CustomerEventID\n            And ce.CustomerEventDispositionID IS NULL\n        Inner Join IADS..CustomerEventCategory ceg On ceg.CustomerEventCategoryID = ce.CustomerEventCategoryID\n        Left Outer Join IADS..CustomerEventHierarchy ceh On ceh.CustomerEventID = ce.CustomerEventID\n        Left Outer Join IADS..CustomerEventHierarchy ceh2 On ceh2.RelatedCustomerEventID = ce.CustomerEventID\n        Where   p.PurgeDate IS NOT NULL\n    )\n\n    Drop Table #disposedRecords\n    Drop Table #hiddata\n    Drop Table #surrogateHIDmap\n    Drop Table #surrogatemap\n    Drop Table #data\n\n    Commit\nEnd Try\nBegin Catch\n    Drop Table #disposedRecords\n    Drop Table #hiddata\n    Drop Table #surrogateHIDmap\n    Drop Table #surrogatemap\n    Drop Table #data\n\n    Rollback\nEnd Catch\n</code></pre>\n"},{"tags":["sql-server","vb.net","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":419,"score":0,"question_id":11719138,"title":"How to insert data in database, without inserting duplicates? (vb.net)","body":"<p>I've been searching on the net, and this query should work: </p>\n\n<pre><code>INSERT INTO Groep(Naam) SELECT ? WHERE NOT EXISTS (SELECT * FROM Groep Where Naam=?)\n</code></pre>\n\n<p>but it doesn't.. I get an <code>OleDbException</code>: </p>\n\n<blockquote>\n  <p>Incorrect syntax near the keyword 'DEFAULT'</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008","query","duplicates"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":122,"score":2,"question_id":12585550,"title":"SQL Server 2008, how to check if multi records exist in the DB?","body":"<p>I have 3 tables:</p>\n\n<ul>\n<li>recipe:\n<ul>\n<li>id, name</li>\n</ul></li>\n<li>ingredient:\n<ul>\n<li>id, name</li>\n</ul></li>\n<li>recipeingredient:\n<ul>\n<li>id, recipeId, ingredientId, quantity</li>\n</ul></li>\n</ul>\n\n<p>Every time, a customer creates a new recipe, I need to check the <code>recipeingredient</code> table to verify if this recipe exists or not.  If <code>ingredientId</code> and <code>quantity</code> are exactly the same, I will tell the customer the recipe already exists.  Since I need to check multiple rows, need help to write this query.</p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12589672,"title":"How do I fix this expression to hide / show report elements?","body":"<p>I'm using SSRS 2008 R2 to generate a report with subreports. I'm trying to conditionally hide a subreport (embedded inside a rectangle and then hiding the rectangle) using the expression below.</p>\n\n<p>I modeled the expression after various samples I found online but nothing works. The <code>Fields!CountABC.Value</code> portion of the expression is underlined in a red, squiggly line with a tooltip that states \"Unknown collection member\". I know the member exists. I selected it from a list and verified it exists in the dataset.</p>\n\n<pre><code>=IIF(Sum(Fields!CountABC.Value, \"DataSet1\")&gt;= 1, True, False)\n</code></pre>\n\n<p>How do I fix this expression?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12588991,"title":"SQL Server 2008 R2 - Named Pipes Provider, error: 0","body":"<p>It's a WCF service trying to establish a connection to an SQL Server on a network. It works fine when the WCF service is run on the same machine using the following connectionString.</p>\n\n<pre><code>&lt;add connectionString=\"Server=.;Database=mydb;Trusted_Connection=True;\" \n     name=\"myconn\" /&gt;\n</code></pre>\n\n<p>but doesn't work from outside the machine (but within the network)</p>\n\n<pre><code>&lt;add connectionString=\"Server=win2008server;Database=mydb;Trusted_Connection=True;\" \n     name=\"myconn\" /&gt;\n</code></pre>\n\n<p>It keeps throwing this error</p>\n\n<blockquote>\n  <p>A connection was successfully established with the server, but then an error occurred during the login process. (provider: Named Pipes Provider, error: 0 - No process is on the other end of the pipe.)</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2008","join"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":73,"score":-1,"question_id":12588542,"title":"how to fix the Violation of PRIMARY KEY constraint?","body":"<p>I have a few tables, I wrote a sql to join those tables and insert the result to a final table. The final table is tb(account, date), account is a primary key. The problem came from the result of the query, which would look like following:</p>\n\n<pre><code>account     date\n0001        09/01/2012\n0001        09/02/2012\n0002        09/01/2012\n0003        09/03/2012\n</code></pre>\n\n<p>when I insert above those result records, I got Violation of PRIMARY KEY constraint error. How do I fix the query, I could get the result records like following</p>\n\n<pre><code>account     date\n0001        09/02/2012 (get the latest date)\n0002        09/01/2012\n0003        09/03/2012\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql","xml","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12588231,"title":"How to replace a pointer value with a variable in sql xml?","body":"<p>I need to write a WHILE loop and pass a variable to an xml query:</p>\n\n<p>Given this logic:</p>\n\n<pre><code>DECLARE @count INT = 0;\nDECLARE @pointer INT = 0;\nDECLARE @pointer_str varchar(100);\n\nDECLARE @MyXML XML\nSET @MyXML = '&lt;SampleXML&gt;\n                &lt;Colors&gt;\n                &lt;Color1&gt;White&lt;/Color1&gt;\n                &lt;Color2&gt;Blue&lt;/Color2&gt;\n                &lt;Color3&gt;Black&lt;/Color3&gt;\n                &lt;Color4 Special=\"Light\"&gt;Green&lt;/Color4&gt;\n                &lt;Color5&gt;Red&lt;/Color5&gt;\n                &lt;/Colors&gt;\n                &lt;Colors&gt;\n                &lt;Color1&gt;White&lt;/Color1&gt;\n                &lt;Color2&gt;Blue&lt;/Color2&gt;\n                &lt;Color3&gt;Black&lt;/Color3&gt;\n                &lt;Color4 Special=\"Light\"&gt;Green&lt;/Color4&gt;\n                &lt;Color5&gt;Red&lt;/Color5&gt;\n                &lt;/Colors&gt;\n            &lt;/SampleXML&gt;'\n\nSET @count = \n    (\n        SELECT\n            a.b.value('count(/SampleXML/Colors)', 'int')\n        FROM \n            @MyXML.nodes('data') a(b)\n    )\n\nWHILE @count &lt; @pointer\n    BEGIN   \n        SELECT\n            a.b.value('Colors[' + @pointer + ']/Color1[1]','varchar(10)') AS Color1\n        FROM \n            @MyXML.nodes('SampleXML') a(b);\n\n        SELECT @pointer = @pointer + 1;\n    END \n</code></pre>\n\n<p>I am trying to get the following variable in a SELECT statement to parse XML but I receive the following error:</p>\n\n<pre><code>The argument 1 of the XML data type method \"value\" must be a string literal.\n</code></pre>\n\n<p>Also, when I pass it the literal value of '1', I can't see the select being run inside the loop.  can someone please help me?</p>\n"},{"tags":["sql","sql-server-2008","query","tsql","insert"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12587929,"title":"Using Case statement to either Insert into a table or Update an existing row","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/108403/solutions-for-insert-or-update-on-sql-server\">Solutions for INSERT OR UPDATE on SQL Server</a><br>\n  <a href=\"http://stackoverflow.com/questions/3407857/only-inserting-a-row-if-its-not-already-there\">Only inserting a row if it&#39;s not already there</a>  </p>\n</blockquote>\n\n\n\n<p>My title pretty much explains what I'm trying to do, but I'll go into a little more detail. I'm creating a stored procedure when called it first checks to see if the row already exists (by comparing against two parameters) and if it does, it will update a specific column in the row and if the row doesn't exist already it will insert a new row into the table. </p>\n\n<pre><code>BEGIN\nSELECT \n(\nCASE WHEN [Site] = @site and Plant = @plant\nthen \nUPDATE [Status]\nFROM Server_Status\nWHERE [Site] = @site\nELSE\nInsert into Server_Status(Name, [Path], [Site], Plant, [Status])\nValues (@name, @path, @site, @plant, @status)\nend\n)\nFROM Server_Status \nEND\n</code></pre>\n\n<p>Is what I have so far, but doesn't work (obviously). Does anyone with more SQL knowledge than I have any suggestions?</p>\n\n<p>-J</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":97,"score":0,"question_id":11904655,"title":"How to delete only recode from table?","body":"<p>I have one table in my database</p>\n\n<pre><code>              Id        Name\n    -------------------------\n      1        1          a\n      2        1          a\n      3        1          a\n      4        2          b\n      5        2          b\n      6        2          b\n</code></pre>\n\n<p>This my database table it's has 6 rows and 2 columns Id and Name </p>\n\n<p>In this table field <code>Id</code> is not a primary key and i want to delete 2 number row from my by <code>id</code> field table</p>\n\n<p>After Delete 2 row of table i want output like this</p>\n\n<pre><code>               Id        Name\n    -------------------------\n      1        1          a\n      3        1          a\n      4        2          b\n      5        2          b\n      6        2          b  \n</code></pre>\n\n<p>Is it possible?</p>\n"},{"tags":["c#","asp.net-mvc-3","sql-server-2008","iis-7.5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12583867,"title":"User hangs when a second session opens","body":"<p>Here is the problem :</p>\n\n<p>User logs into the site. Opens a second TAB goes of the same site(default login page),he hangs.</p>\n\n<p>Logs out of the first session all is fine.\nSecond site is opened in a different path than the login page, all is fine.</p>\n\n<p><em>Its a internal site, i couls ask them not to open a second TAB but in a situation where the user closes the site without loginout, I am back to the same problem util the session time runs out.</em></p>\n\n<p>How do i fix this or monitor whats going on ?</p>\n\n<p>IIS 7.5 - ASP.net 4 - WS2008R2</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12574016,"title":"tsql best way to merge records with start date and end date when there is no gap in between","body":"<p>I have a mapping table as follows :</p>\n\n<pre><code>FirstEntityID int\nMappedTo int\nBeginDate Date\nEndDate Date\n</code></pre>\n\n<p>and lets say I have following records in the table :</p>\n\n<pre><code>FirstEntityID  MappedTo  BeginDate     EndDate \n     1             2     2012-09-01   2012-10-01\n     2             3     2012-09-01   2012-10-01\n     1             2     2012-10-02   2012-11-24\n     2             3     2012-11-01   2012-11-24\n</code></pre>\n\n<p>I need a script which will get this table and merges records based on the Start and end date to return a result like :</p>\n\n<pre><code>   FirstEntityID  MappedTo  BeginDate     EndDate \n     1             2     2012-09-01   2012-11-24\n     2             3     2012-09-01   2012-10-01\n     2             3     2012-11-01   2012-11-24\n</code></pre>\n"},{"tags":["vb.net","visual-studio-2010","sql-server-2008","web-config"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12573253,"title":"Accessing specific tag in web.config file","body":"<p>I recently started working on an application that was built by several people in the past. I am having problems creating a SQLConnection in VB. My code so far is as follows:</p>\n\n<pre><code>&lt;WebMethod()&gt; _\nPublic Function GetListOfServers() As List(Of Server)\n\n    Dim servers As New List(Of Server)\n\n    Dim conn As New SqlClient.SqlConnection\n    conn.ConnectionString = Company.Configuration.Config.GetHostSetting(\"DatabaseConnectionString\")\n\n    servers.Sort()\n    Return servers\n\nEnd Function\n</code></pre>\n\n<p>Inside the web.Config there are several different servers that are being connected to and i need to set the connection string to a specific one (PBTest). Here is what the config file looks like:</p>\n\n<pre><code>&lt;configuration&gt;\n...\n&lt;companySettings&gt;\n    &lt;EnvironmentSettings defaultDomain=\"company.com\"&gt;\n    &lt;config key=\"DatabaseConnectionString\"&gt;\n      &lt;environmentList&gt;\n        &lt;env host=\"localhost\" name=\"Dev\"/&gt;\n        &lt;env host=\"AppTest\" name=\"Test\"/&gt;\n        &lt;env host=\"AppQual\" name=\"Qual\"/&gt;\n        ...\n      &lt;environmentList&gt;\n      &lt;settingList&gt;\n        &lt;setting name=\"Dev\" value=\"....\"/&gt;\n        &lt;setting name=\"Qual\" value=\"....\"/&gt;\n</code></pre>\n\n<p>how do i go about this?\nThanks in advance, Troy</p>\n"},{"tags":["asp.net-mvc-3","sql-server-2008","unit-testing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12584729,"title":"C# test project Wipe database before the tests are run","body":"<p>I have a ASP.NET MVC3 application, where i need to test a database wrapper class. This is up and running. But i need to recreate the database, when the test starts. I need to wipe all data in database. The database is a test double.</p>\n\n<p>I have the SQL script creating the database. For now im running this manualy in \"SQL Server Manager\" and it works. But I would like to have the script run before a new test run.</p>\n\n<p>Anyone know how to do this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12572174,"title":"Find declare statement SQL Profiler","body":"<p>I have a multiple EXEC statements being run, but the DECLARE is nowhere to be found. Below is what I'm seeing. I'm seeing thousands of these.</p>\n\n<pre><code>RPC:Completed | exec sp_execute 14,69 | TDS0X00000000030000001400730070005F0065007800650063007500740065001400000003000600380069006E0074000E0000001400000003000600380069006E \n</code></pre>\n\n<p>I do see declare statements for other Stored Procedures, just not for a few and they are the ones that I really need to analyze. </p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server-2008","query","constraints"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12583910,"title":"SQL Server constraint check not working ","body":"<p>I'm using <code>constraint</code> to force business rule in sql server 2008 database as,</p>\n\n<pre><code>alter table TableName with check  \nAdd check    \n(\n    (col1 = 1 and col2 &gt; 0)  \n    or   \n    col1 = 0  \n)\n</code></pre>\n\n<p>when i try to execute insert query in Management Studio</p>\n\n<pre><code>update TableName set col1 = 1 where Id = 1; --the col2 =0 so it is not valid according to above constraint\n</code></pre>\n\n<p>after execute, i get the message <code>(1 row(s) affected)</code> without any error message!!</p>\n\n<p>but actually when i check the data in table, it didnt change (which is right action).    </p>\n\n<p>Edit: so the unusual behavior is executed with <code>1 row(s) affected</code> although there is no row effected...</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":47,"score":-1,"question_id":12584865,"title":"Stored Procedure which accepts parameters from users and displays result","body":"<p>I have a database which has two tables. One table contains the information of all the servers in my environment with feilds like server_name, db_name, application, Pri_dba etc. and the other table has contact info for all the DBA like thier phone numbers emails etc. I want to write a stored procedure which accepts 3 values from users that is Server name , Database &amp; Application. It should then uniquely identify the Primary DBA based on this info and display all the contact information for that DBA.\nI figured I can identify the primary DBA from table 1 and display the result from table 2.\nThis might be a very easy task but I am a new DBA so Can any one please help.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12584716,"title":"Using SQL IN statement based on case statement","body":"<p>Is it possible to use <code>in</code> command based on case statement</p>\n\n<p>I have tried something like this</p>\n\n<pre><code>@Id int\n\nSelect * \nFrom Table \nWhere  StatusId in( case when Id =1 then 1 else 1,3 end)\n</code></pre>\n\n<p>and </p>\n\n<pre><code>    Select * \n    From Table \n    Where  StatusId in case when Id =1 then (1) else (1,3) end\n</code></pre>\n\n<p>Any Ideas!! </p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12584693,"title":"Upload a word doc to SQL Server as a byte","body":"<p>I need some help on code to \"Upload a word doc to SQL Server as a byte\" and next criteria is to \"retrieve the same as doc\".How i can do it? Give some suggestions.\nThanks</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":257,"score":1,"question_id":10240582,"title":"Referencing Columns on the Inserted Table T-SQL","body":"<p>So, I'm trying to create a trigger that will throw an error on inserting data if a foreign key code is not valid. I have two tables, Publisher and Title. Title has a publisher code on it, as does Publisher. I have the trigger on my Title for insert, and I am currently doing an if not exists and selecting the Publisher row where the code is equal to the inserted row's publisher code. I don't know if this is the right way to do it, and probably not, as SQL is giving me a \"multi-part identifier Inserted.PublisherCode could not be found\" error. Any help you guys could give would be appreciated. Thanks.</p>\n\n<pre><code>go\ncreate trigger TR_Title_PublisherCode_Insert\non title\nfor Insert\nas\n    if not exists(select * from Publisher where PublisherCode = Inserted.PublisherCode)\n    begin\n        raiserror('Publisher does not exist', 16, 1)\n        rollback tran\n    end\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":4,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":210,"score":1,"question_id":10804675,"title":"Optimizing specific sql query","body":"<p>I am not an SQL expert, please help, how can I optimize this query?</p>\n\n<p>I don't have indexes, only the table called master_table and more tables, I must optimize this query to get the same results, I can create indexes if I have to, but I cannot change the creation table....</p>\n\n<pre><code>select month(date_hour), passenger, nationality, passport, airline,\n   count(*) N_Viagens\nfrom masterTable\ngroup by month(date_hour), passenger, airline, nationality, passport \nhaving count(*) &gt; 10\n</code></pre>\n\n<p>next is the code to create the table but I can't edit that code, only the query or creating indexes:</p>\n\n<pre><code>select\np.birthdate, p.gender, p.passport, p.name + ' ' + p.surname passenger, p.nationality,\n    r.class, r.flightNR, r.payment, r.ticketNR,\n    f.src_AP_ID, f.dest_AP_ID, f.AL_ID, f.date_hour, f.AirCrft_Code,ac.manufacturer, ac.model,\n    SA.City 'Origin City', SA.Country 'Origin Country', SA.Name 'Origin Airport', \n    DA.City 'Dest City', DA.Country 'Dest Country', DA.Name 'Dest Airport',\n    al.Name airline, al.IATA, al.icao\ninto masterTable \nfrom passenger p\njoin reservation r on r.passport = p.passport\njoin flight f on f.flightNR = r.flightNR\njoin airport SA on f.src_AP_ID = SA.AP_Id \njoin airport DA on f.dest_AP_ID = DA.AP_Id \njoin aircraft ac on f.airCrft_Code = ac.code\njoin airline al on f.AL_ID = al.AL_ID \n</code></pre>\n\n<p>without index:</p>\n\n<pre><code>SQL Server Execution Times: CPU time = 10125 ms,  elapsed time = 17052 ms.\n</code></pre>\n\n<p>PEOPLE I THINK I DID IT, THANKS TO ALL OF YOU, THANK YOU AGAIN</p>\n\n<p>I created the index like this:</p>\n\n<pre><code>create index idx_MasterTable_Passenger on masterTable(passport, airline)\n</code></pre>\n\n<p>and the query I changed to this:</p>\n\n<pre><code>select month(date_hour), max(passenger) as passenger, nationality, passport, airline, count(*) N_Viagens\nfrom masterTable\ngroup by airline, nationality, passport, month(date_hour)\nhaving count(*) &gt; 10\n</code></pre>\n\n<p>What you think, is it acceptable?</p>\n\n<pre><code>SQL Server Execution Times: CPU time = 8362 ms,  elapsed time = 5721 ms.\n</code></pre>\n\n<p>I will talk to the teacher if he agrees with this</p>\n\n<p><strong>The teacher did not accepted this changes, we cannot change tables or query, only creating a good index.... suggestions??</strong></p>\n"},{"tags":["c#","sql-server-2008","sql-server-2005","c#-4.0","windowservice"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12583395,"title":"Window Service waiting store procedure to get the results","body":"<p>I am running a stored procedure from <code>C#</code> <code>Window Service</code>. Stored proc is a quite heavy query and it takes quite long time. </p>\n\n<p>I want to wait till the stored proc finish and return the values. </p>\n\n<p>Is there any way to determine that stored proc is finished.</p>\n\n<p>If anyone can provide the sample code that will be a great favour. </p>\n\n<p>Many Thanks</p>\n"},{"tags":["sql","sql-server-2008","ssms"],"answer_count":4,"favorite_count":2,"up_vote_count":24,"down_vote_count":0,"view_count":11988,"score":24,"question_id":1489872,"title":"How do I create a SQL table under a different schema?","body":"<p>This is from SQL Server 2008, ssms</p>\n\n<p>When I create a table, it creates under dbo.</p>\n\n<p>I would like to create it under a different schema, but when I use the 'New Table' dialog, I can never find the field where to specify this.</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":12582615,"title":"How can I know that a Trigger is fired or not?","body":"<p>I am using SQL Server 2008 R2 on a windows 7 machine. I have a trigger that should be fired on an insert but unfortunately it does not. I do not have the SQL Profiler because I have an express edition. Is there any other way to see what is going wrong?. The insert into the table teams is done with the Import Wizard of SQL Server, an i import from .CSV into a table.</p>\n\n<pre><code>CREATE TRIGGER teams.process ON teams\nAFTER INSERT\nAS\nBEGIN\n    DECLARE @homeTeamId INT\n    DECLARE @awayTeamId INT\n    DECLARE @maxTeamId INT\n    DECLARE @matchId INT\n\n    SELECT @maxTeamId = 0\n    SELECT @maxTeamId = ISNULL(MAX(teamId), 0) from tblTeams\n\n    --- Check if home team has already been inserted into the table.\n    SELECT @homeTeamId = -1\n    SELECT \n        @homeTeamId = teamId \n    FROM \n        tblTeams t\n        JOIN inserted i\n        ON t.teamName = i.hometeam\n    IF (@homeTeamId = -1) \n    BEGIN\n        SELECT @homeTeamId = @maxTeamId + 1\n        SELECT @maxTeamId = @maxTeamId + 1\n        INSERT INTO tblTeams SELECT @homeTeamId, i.hometeam FROM inserted i\n    END\n\n    --- Check if away team has already been inserted into the table.\n    SELECT @awayTeamId = -1\n    SELECT \n        @awayTeamId = teamId \n    FROM \n        tblTeams t\n        JOIN inserted i\n        ON t.teamName = i.awayteam\n    IF (@awayTeamId = -1) \n    BEGIN\n        SELECT @awayTeamId = @maxTeamId + 1\n        SELECT @maxTeamId = @maxTeamId + 1\n        INSERT INTO tblTeams SELECT @awayTeamId, i.awayteam FROM inserted i\n    END\n\n    -- insert a record into the matches table with the home team ID and away team ID.\n    SELECT @matchId = 0\n    SELECT @matchId = ISNULL(MAX(MatchId), 0) FROM tblMatches\n    INSERT INTO tblMatches \n    SELECT @matchId + 1, @homeTeamId, @awayTeamId, i.score \n    FROM inserted i\nEND \n</code></pre>\n"},{"tags":["sql-server-2008","transactions"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12542089,"title":"How to close a SQL Server 2008 transaction?","body":"<p>I'm connected to a database in SQL Server 2008, and using a new query window on the database, I run</p>\n\n<pre><code>DBCC OPENTRAN\n</code></pre>\n\n<p>and it shows</p>\n\n<pre><code>Replicated Transaction Information:\n        Oldest distributed LSN     : (0:0:0)\n        Oldest non-distributed LSN : (93627:242:1)\nDBCC execution completed. If DBCC printed error messages, contact your system administrator.\n</code></pre>\n\n<p>Even when I close the query and a few hours later run the same <code>DBCC OPENTRAN</code> command, the results are the same.</p>\n\n<p>I'm assuming that I have an uncommitted transaction. Am I correct? If so, since I am the administrator of this machine, how do I close/commit this transaction?</p>\n\n<p>The log is at 3-4GB and growing by nearly 200MB or more, each day.</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":12583508,"title":"Splitting SQL Data Into Months","body":"<p>I have a Datatable with several hundred rows for this year in it. (MS SqlServer 2k8)</p>\n\n<p>I would like to split this data set out into customer enquiries / Month.</p>\n\n<p>What I have so far is;</p>\n\n<pre><code>Select count(id) As Customers, DatePart(month, enquiryDate) as MonthTotal, productCode From customerEnquiries\nwhere enquiryDate &gt; '2012-01-01 00:00:00'\ngroup by productCode, enquiryDate\n</code></pre>\n\n<p>But this then produces a row for each data item. (Whereas I want a row per month for each data item.)</p>\n\n<p>So how do I change the above query, so that instead of getting</p>\n\n<pre><code>1 1 10\n1 1 10\n1 1 11\n1 2 10\n1 2 10\n</code></pre>\n\n<p>...</p>\n\n<p>I get</p>\n\n<pre><code>2 1 10    &lt;-- 2 enquiries for product code 10 in month 1\n1 1 11    &lt;-- 1 enquiries for product code 11 in month 1\n2 2 10    &lt;-- 2 enquiries for product code 10 in month 2\netc\n</code></pre>\n\n<p>And as a bonus question, is there an easy way of naming each month so the output is Jan, Feb, March instead of 1,2,3 in the month column?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":67,"score":-4,"question_id":12580416,"title":"Getting the Emp_ID","body":"<p>In Table_A I have atrribute \"Verantwortlicher\". This attribute contains the last name and the first name of the person respectively i.e. \"Doe John\"</p>\n\n<p>In Table_B I have two attributes \"Lastname_NAM\" and \"Firstname_NAM\" which of course contain lastnames and firstnames of a person respectively i.e. \n\"Lastname_NAM\" - Doe\n\"Firstname_NAM\" - John</p>\n\n<p>Table_A has a foreign key (Responsible_Emp_ID) which is referencing Table_B´s primary key (Emp_ID)</p>\n\n<p>What I would like is to join these two tables so that beside the strig-type full name in the Table_A I also have a ID of that person (which of course comes from Table_B)</p>\n\n<p>I forgot to mention that I need this data so I can FILL the values in aforeign key. Table_A is EMPTY.</p>\n\n<p>I´m using T-SQL\nPlease help,\nThanks, D.</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12581750,"title":"Inserting from one table to another","body":"<p>I am working on a database that is not normalized and it cannot be normalized as I don't have the permissions. The problem is </p>\n\n<p>I have two tables</p>\n\n<ul>\n<li><strong>Gl_Account</strong></li>\n<li><strong>Trial Balance</strong></li>\n</ul>\n\n<p>the structure of the tables are like </p>\n\n<p><strong>Gl_Account (empty table or with some old data)</strong></p>\n\n<pre><code>loc  |  gl_acct  |  HMISTOTAL\n-------------------------------\n     |           |\n-------------------------------\n</code></pre>\n\n<p><strong>Trial Balance</strong></p>\n\n<pre><code>loc   |    g1101    |   g1102   | g1103\n----------------------------------------\n1400  |     20      |    30     |  0\n----------------------------------------\n1500  |     10      |    0      |  40\n----------------------------------------\n</code></pre>\n\n<p>Now what I want to do is </p>\n\n<p>Fetch the Record that are not in <strong>Gl_Account</strong> Table from the <strong>trialBalance</strong> table with the respective GL_acct Number where the amount under the respective <strong>gXXXX</strong> (in trial balance) is not zero</p>\n\n<p>Let me explain it with an example. Keeping the above table in mind I want to fill the table GL_Account as </p>\n\n<p><strong>GL_Account</strong></p>\n\n<pre><code> loc      |    gl_acct      |  HMISTOTAL\n    ---------------------------------------\n       1400  |      1101       |   20\n    ---------------------------------------\n       1400  |      1102       |   30\n    ---------------------------------------\n       1500  |      1101       |   10\n    ---------------------------------------\n       1500  |      1103       |   40\n    ---------------------------------------\n</code></pre>\n\n<p>i have tried this query but it only the first record captured is entered into the gl_accountt table. I skipped the amount part for now.. but it is required.</p>\n\n<pre><code>insert into Gl_Account (loc,gl_acct,HMISTOTAL)\n  select * from (\n                select a.loc,\n                 CASE\n                 WHEN a.G1101 &lt;&gt; 0 THEN '1101'\n                 WHEN a.G1102 &lt;&gt; 0 THEN '1102'\n                 WHEN a.G1104 &lt;&gt; 0 THEN '1104'\n                 WHEN a.G1151 &lt;&gt; 0 THEN '1151'\n                 END AS gl_Acct\n               '0' as HMISTOTAL\n                  FROM trialBalance a where NOT EXISTS\n                         (SELECT 1 from GL_Account b WHERE b.loc = a.loc)) ab\n</code></pre>\n\n<p>thanks in advance.</p>\n"},{"tags":["sql-server-2008","encoding","windows-server-2003","iconv","magmi"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":124,"score":0,"question_id":12581219,"title":"what type of encoding is this \"Non-ISO extended-ASCII English text, with very long lines, with CRLF line terminators\"?","body":"<p>I am trying to export the out put of <code>mssql</code> query which must use <code>utf</code> (utf-16 I suppose) encoding according to <a href=\"http://msdn.microsoft.com/en-us/library/ms162773.aspx\" rel=\"nofollow\">description</a> I am using <code>-W -u</code>\nfunctions with <code>sqlcmd</code>. \n Ä is converted to character z (with 2 dots or something like ^ inverted) by default, and lists it as <code>ansi</code> character set. \nwhen I try to use notepad++ to convert this <code>utf</code> file to <code>utf-8</code> shows me with some strange highlighted characters <code>(x8E)</code> for <code>Ä</code>, and some other for other characters like <code>x86</code> and <code>x94</code> does not matter what ever encoding I use as default in Nottepad++. </p>\n\n<p>When I transfered the file to a <code>Ubuntu 12.04</code> machine and using <code>file</code> command says that its </p>\n\n<blockquote>\n  <p>user@user:~/Desktop/enc\n  oding/checkencoding$ file\n  convertit4.csv  convertit4.csv: Non-ISO extended-ASCII English\n  text, with very long lines, with CRLF line terminators</p>\n  \n  <p>user@user:~/Desktop/encoding/checkencoding$ chardet\n  convertit4.csv  convertit4.csv: ISO-8859-2 (confidence: 0.77)\n  I am confused what kind of encoding it uses. \n  the purpose is to convert it to <code>utf-8</code> encoding without any errors to upload it to <a href=\"http://sourceforge.net/apps/mediawiki/magmi/index.php?title=Magmi_Wiki\" rel=\"nofollow\"><code>magmi</code> importer</a>. </p>\n</blockquote>\n\n<p>note: I am using this command to remove the underline after the headers <code>type c:\\outfiles\\convertit1.temp | findstr /r /v \"^\\-[;\\-]*$\" &gt; c:\\outfiles\\convertit4.csv</code> hope this line of codes is not the problem. </p>\n\n<p>I hope the information are complete to solve this issue, If any more information needed, please let me know, \nRegards. </p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":161,"score":1,"question_id":12223111,"title":"Selecting more than 5 columns in my SQL query is slowing it down ","body":"<p>I am running a simple SQL query in SQL Server Management Studio (which I am actually executing in my application also) and I found this interesting. I'm hoping someone can explain what is wrong with it.</p>\n\n<p>The database table has 25 columns, 5 columns are indexed and one primary key column exists.\nExcept for one column, all the rest of the columns are of type <code>varchar</code> of lengths &lt;= 50 or <code>datetime</code> or <code>int</code>. That one exception is that the column is of type <code>varchar(512)</code> (let's call this column <code>BigColumn</code>)</p>\n\n<p>My query is this:</p>\n\n<pre><code>Select PKColumn, column1, column2, column3, column4, column5\nfrom database_table\nwhere PKColumn = value\n</code></pre>\n\n<p>The query executes faster (&lt; 1sec) when I select 5 or fewer columns. I can select any 5 columns except the <code>BigColumn</code> (along with PK, of course) and the result comes back in &lt; 1sec. But, if I select more than 5 columns the query slows down considerably (result comes back 6 secs). Also, if I select <code>PKColumn</code> and <code>BigColumn</code> the result comes back in 6 secs.</p>\n\n<p>Does anyone know what the problem might be? I did put in a request for our DBA to look into this, but I want to know if anyone has faced a problem like this and how they resolved it.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["c#","sql","sql-server-2008","dynamic-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12580933,"title":"Strange C# to SQL Dynamic Query Execution","body":"<p>All, I have a dynamic SQL Query that I am executing from a C# application. The problem query is an INSERT statement, which is run from within a C# loop, being executed sequentially on many databases to create a single data warehouse [database]. I have run this code one 100+ databases in a single batch without problem; however, I have just come across one specific database where the query </p>\n\n<pre><code>DECLARE @DbName NVARCHAR(128);\nSET @DbName = (SELECT TOP 1 [DbName] \n               FROM [IPACostAdmin]..[TmpSpecialOptions]);\nDECLARE @FilterSql NVARCHAR(MAX);\nSET @FilterSql = (SELECT TOP 1 [AdditionalSQL] \n                  FROM [IPACostAdmin]..[TmpSpecialOptions]);\nDECLARE @SQL NVARCHAR(MAX);\nDECLARE @SQL1 NVARCHAR(MAX);\nDECLARE @SQL2 NVARCHAR(MAX);\nSET @SQL1 = \n'INSERT INTO [' + @DbName + ']..[Episode] WITH(TABLOCK) \n    ([EstabID],..., [InclFlag]) '; \nSET @SQL2 = \n'SELECT \n     [EstabID],..., [InclFlag] \nFROM [B1A] ' + @FilterSql + ';'; \nSET @SQL = @SQL1 + @SQL2;\nEXEC sp_executesql @SQL;\n</code></pre>\n\n<p>Goes from taking roughly three seconds for an insert of 20,000-30,000 records to 40+ minutes! Now, after long deliberation and experiments, I have just worked out the fix for this; it is to use </p>\n\n<pre><code>EXEC sp_executesql @SQL WITH RECOMPILE; \n</code></pre>\n\n<p>This brings it back down to &lt; 2s for the insert. </p>\n\n<p>This SQL is executed from the application once for each database in the batch, the current execution of this statement <em>should</em> be totally separate from the preceding ones as far as the server is concerned (as I understand it), but it is not; it seems SQL is cashing the dynamic SQL in this case.</p>\n\n<p>I would like to know what is happening here for this single site? Where will I need to ensure I use the <code>RECOMPILE</code> option in future to prevent such issues? </p>\n\n<p>Thanks for your time.</p>\n\n<p>_Note. I appreciate that this recompiles the query, but I am baffelled as to why the server is using the same execution plan in the first place. each time this query is run it is against a different database using a different <code>Initial Catalog</code> using a different <code>SqlConnection</code>.</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":12581132,"title":"how to make transactional replication in sql server 2008 r2 for multiple nodes","body":"<p>I'm newly using sql server 2008 r2. I have 3 different DB server in different location with same user name &amp; password. now i need to replicate data from those 3 DB to one DB which has same user_name &amp; password. Can any one help me......</p>\n"},{"tags":["sql","sql-server-2008","date","range"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":12580029,"title":"Select record value based on date range","body":"<p>I have the following two tables:</p>\n\n<pre><code>ITEM AREA YEAR  MONTH   DAY QTY OL  EXQTY   EXOL    CREATE DATE UPDATE\n------------------------------------------------------------------------    \nABC789  XYZ1234 2012    6   22  0   0   0   0   2012/07/04  2012/09/03\nABC789  XYZ1234 2012    6   23  0   0   0   0   2012/07/04  2012/09/03\nABC789  XYZ1234 2012    6   24  0   0   0   0   2012/07/04  2012/09/03\nABC789  XYZ1234 2012    6   25  0   0   0   0   2012/07/04  2012/09/03\nABC789  XYZ1234 2012    6   26  0   0   0   0   2012/07/04  2012/09/03\nABC789  XYZ1234 2012    6   27  0   0   0   0   2012/07/04  2012/09/03\n</code></pre>\n\n<p>and</p>\n\n<pre><code>STDATE      EDDATE       FYYEAR  FYMONTH\n---------------------------------------\n2012/04/23  2012/05/27   2012      11\n2012/05/28  2012/06/24   2012      12\n2012/06/25  2012/07/22   2013       1\n2012/07/23  2012/08/26   2013       2\n</code></pre>\n\n<p>I need to create a new view with all the data from the first table as well as the <code>FYYEAR</code> and <code>FYMONTH</code> from the second table. The criteria is that if the sale date in the first table (<code>YEAR MONTH DAY</code>) is between the <code>STDATE</code> and <code>EDDATE</code> in the second table, then the correct <code>FYYEAR</code> and <code>FYMONTH</code> should be selected.</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":32,"score":-2,"question_id":12580239,"title":"Get search engine for checking if data is present in database table","body":"<p>I am doing a canteen management system project.</p>\n\n<p>A list of items will be present in the <code>item</code> table in database.</p>\n\n<p>My problem is I have to create a search engine for user for checking whether the item exists in <code>Item</code> table in database, and give the user a friendly message telling them the result. </p>\n\n<p>Can anyone help me get started?</p>\n"},{"tags":["visual-studio-2010","sql-server-2008","gridview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12577833,"title":"GridView Disappear without any error","body":"<p>I have set my Gridview to allow paging.</p>\n\n<pre><code>        try\n        {\n\n            SqlConnection sqlConnection = new SqlConnection(\"Data Source=JACKCONNECTION\\\\SQLEXPRESS;Initial Catalog=testbase;Integrated Security=True\");\n            SqlCommand sqlCommand = new SqlCommand(allitemsselectedsqlsrc, sqlConnection);\n            sqlCommand.CommandType = System.Data.CommandType.Text;\n            sqlConnection.Open();\n\n            SqlDataAdapter da = new SqlDataAdapter(sqlCommand);\n            DataSet ds = new DataSet();\n            da.Fill(ds);\n\n            ArrayList ArrList = new ArrayList();\n\n            foreach (DataRow dr in ds.Tables[0].Rows)\n            {\n                ArrList.Add(dr);\n            }\n            GridViewMass.DataSource = ds;\n            GridViewMass.DataBind();\n\n\n        }\n        catch (Exception err)\n        {\n            LabelSelErr.Text = err.Message;\n        }\n</code></pre>\n\n<p>Also, I have a action <code>PageIndexChanging</code> for GridView as follows:</p>\n\n<pre><code>    protected void gvm_PageIndexChanging(object sender, GridViewPageEventArgs e)\n    {\n        GridViewMass.PageIndex = e.NewPageIndex;\n        GridViewMass.DataBind();\n\n    }\n</code></pre>\n\n<p>Lastly, the aspx file contain the Gridview is as follows:</p>\n\n<pre><code>&lt;asp:GridView ID=\"GridViewMass\" runat=\"server\" AllowPaging=\"True\" \n                            AllowSorting=\"True\" BackColor=\"White\" BorderColor=\"#CCCCCC\" BorderStyle=\"None\" \n                            BorderWidth=\"1px\" CellPadding=\"4\" EnableSortingAndPagingCallbacks=\"True\" \n                            ForeColor=\"Black\" GridLines=\"Horizontal\" \n                            onpageindexchanging=\"gvm_PageIndexChanging\"&gt;\n                            &lt;FooterStyle BackColor=\"#CCCC99\" ForeColor=\"Black\" /&gt;\n                            &lt;HeaderStyle BackColor=\"#333333\" Font-Bold=\"True\" ForeColor=\"White\" /&gt;\n                            &lt;PagerStyle BackColor=\"White\" ForeColor=\"Black\" HorizontalAlign=\"Right\" /&gt;\n                            &lt;SelectedRowStyle BackColor=\"#CC3333\" Font-Bold=\"True\" ForeColor=\"White\" /&gt;\n                            &lt;SortedAscendingCellStyle BackColor=\"#F7F7F7\" /&gt;\n                            &lt;SortedAscendingHeaderStyle BackColor=\"#4B4B4B\" /&gt;\n                            &lt;SortedDescendingCellStyle BackColor=\"#E5E5E5\" /&gt;\n                            &lt;SortedDescendingHeaderStyle BackColor=\"#242121\" /&gt;\n                        &lt;/asp:GridView&gt;\n</code></pre>\n\n<p>The strange thing happen is when I click on the page (be it the 2nd page, 3rd page or whatever page that I could click), the Gridview <code>GridViewMass</code> will just disappear.</p>\n\n<p>Did I code wrongly? Previously, I encountered the following error messages and have solved them but right now, I end up with something that I could not continue anymore.</p>\n\n<ol>\n<li>A first chance exception of type 'System.InvalidOperationException' occurred in System.dll</li>\n<li>there is already an open datareader associated with this command which must be closed first.</li>\n<li>The data source does not support server-side data paging.</li>\n<li>The GridView 'GridView' fired event PageIndexChanging which wasn't handled.</li>\n</ol>\n\n<p>Appreciate any help that can help me get my GridView back. </p>\n"},{"tags":["sql-server","excel","sql-server-2008","etl"],"answer_count":12,"favorite_count":8,"up_vote_count":21,"down_vote_count":0,"view_count":101515,"score":21,"question_id":375991,"title":"Import Excel spreadsheet columns into SQL Server database","body":"<p>I have an Excel spreadsheet that I want to import select columns into my SQL Server 2008 database table. The wiz didn't offer that option.</p>\n\n<p>Any easy code options?</p>\n"},{"tags":["sql-server-2008","stored-procedures","return-value","entity-framework-4"],"answer_count":5,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":2700,"score":4,"question_id":3166952,"title":"How to return values from a dynamic SQL Stored Procedure to the Entity Framework?","body":"<p>I have a Stored Procedure which executes some dynamic SQL. I want to use this Stored Procedure in entity framework 4, but when I try to create a complex type the procedure returns no columns. Is there any way I can force it to return my values and get the entity framework to receive them? Here is a much-simplified example of what I want to do:</p>\n\n<pre><code>CREATE PROCEDURE sp_calculatesalary(@EmployeeId as int)\nbegin\n    declare dynsql as varachar(500)\n    @dynsql='Select @Salary=Salary,@UserName=Username from employee\n            where EmployeeId='+cast(@EmployeeId as varchar)+ ''\n    exec(@dynsql)\n    select @Salary, @UserName\nend\n</code></pre>\n\n<p>But this does not work. Please help me out. Basically, I want to use a Stored Procedure to execute dynamic SQL and return the values to the entity framework.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":2,"view_count":110,"score":2,"question_id":12577319,"title":"SQL Query to filter record for perticular record count","body":"<p>I have a table which have Identity, RecordId, Type, Reading And IsDeleted columns. Identity is primary key that is auto increment, RecordId is integer that can have duplicate values, Type is a type of reading that can be either 'one' or 'average', Reading is integer that contains any integer value, and IsDeleted is bit that can be 0 or 1 i.e. false or true. \nNow, I want the query that contains all the records of table in such a manner that if COUNT(Id) for each RecordId is greater than 2 then display all the records of that RecordId.  </p>\n\n<p>If COUNT(Id) == 2 for that specific RecordId and Reading value of both i.e. 'one' or 'average' type of the records are same then display only average record. </p>\n\n<p>If COUNT(Id) ==1 then display only that record.</p>\n\n<p>For example : </p>\n\n<pre><code>Id          RecordId          Type          Reading       IsDeleted \n1           1                 one             4              0\n2           1                 one             5              0\n3           1                 one             6              0\n4           1                 average         5              0\n5           2                 one             1              0\n6           2                 one             3              0\n7           2                 average         2              0\n8           3                 one             2              0\n9           3                 average         2              0\n10          4                 one             5              0\n11          4                 average         6              0\n12          5                 one             7              0\n</code></pre>\n\n<p>Ans result can be </p>\n\n<pre><code>Id          RecordId          Type          Reading       IsDeleted \n1           1                 one             4              0\n2           1                 one             5              0\n3           1                 one             6              0\n4           1                 average         5              0\n5           2                 one             1              0\n6           2                 one             3              0\n7           2                 average         2              0\n9           3                 average         2              0\n10          4                 one             5              0\n11          4                 average         6              0\n12          5                 one             7              0\n</code></pre>\n\n<p>In short I want to skip the 'one' type reading which have an average reading with same value and its count for 'one' type reading not more than one. Can anyone have idea? </p>\n"},{"tags":["sql","sql-server-2008","decimal","collation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12571549,"title":"Syntax for French_CI_AS when dealing with decimals","body":"<p>I've been doing a lot of Google searches trying to find the exact syntax necessary to INSERT or UPDATE a colum with a decimal value using French (Canadian) localization. <em>I am not a native French speaker, nor do I have any experience with using the French collation.</em> Using Latin_General_CI_AS the query would look like this:</p>\n\n<pre><code>INSERT INTO [dbo].[MyTable] (ID, StringField, DecimalField) VALUES (1, 'Some value', 0.5)\n</code></pre>\n\n<p>But when using the French collation, the decimal number looks like <code>0,5</code> instead of <code>0.5</code> and just a simple translation throw SQL Server into a tizzy.  The INSERT query would look something like this (<em>although, this doesn't work</em>):</p>\n\n<pre><code>INSERT INTO [dbo].[MyTable] (ID, StringField, DecimalField) VALUES (1, 'Some value', 0,5)\n</code></pre>\n\n<p>SQL Server thinks <code>5</code> is an additional value for a column that wasn't specified.  How can I make this work.  Is there some character that I would wrap the number with to make SQL Server see it as the decimal value?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":317,"score":4,"question_id":11721332,"title":"How to get 6 months old data given only month and year from current date?","body":"<p>I have a table that contains only Month and Year field both as int.\nGiven an input say month, 6 months.\nI need to project the data that are 6 months old.</p>\n\n<p>for example I have data from 2001 , 1st Janaury till date. Given input as 6 months , so I have to go back 6 months \nfrom cuurent date to get the result .</p>\n\n<p>Output will be Data From Jan 2001 to Jan 2012.</p>\n\n<p>I have done the program using the right,substring, string comparison.(a nasty hack)</p>\n\n<p>Is there any prominent way of doing so?</p>\n\n<p><strong>DDL</strong></p>\n\n<pre><code>Declare @t table (Mnth int, Yr int)\nInsert Into @t \n\n-- 2011\nSelect 1,2011 Union All select 2,2011 Union All Select 3, 2011 Union ALL Select 4,2011 Union ALL\nSelect 5,2011 Union All select 6,2011 Union All Select 7, 2011 Union ALL Select 8,2011 Union ALL\nSelect 9,2011 Union All select 10,2011 Union All Select 11, 2011 Union ALL Select 12,2011 Union ALL\n\n--2012\nSelect 1,2012 Union All select 2,2012 Union All Select 3, 2012 Union ALL Select 4,2012 Union ALL\nSelect 5,2012 Union All select 6,2012 Union All Select 7, 2012 Union ALL Select 8,2012 Union ALL\nSelect 9,2012 Union All select 10,2012 Union All Select 11, 2012 Union ALL Select 12,2012\n\nDeclare @inputMonth int = 6\n</code></pre>\n\n<p>I am trying without string conversion </p>\n\n<pre><code>Select Mnth,Yr,YEAR(DATEADD(mm,-@inputMonth,getdate())),MONTH(DATEADD(mm,-@inputMonth,getdate()))\nFrom @t\nWHERE   YEAR(DATEADD(mm,-@inputMonth,getdate())) &lt; Yr\nAND MONTH(DATEADD(mm,-@inputMonth,getdate())) &lt; Mnth\n</code></pre>\n\n<p>But it is not working</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","identity-column"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12577411,"title":"How does SQL Server generate values in an identity column?","body":"<p>My question is if I have two batch inserts into one table in parallel, how does SQL Server create identity values? </p>\n\n<p>I mean, if in one session I insert multiple rows (Row1-Row2-Row3) and simultaneously another session inserts multiple rows (Row4-Row5-Row6) at the same time, the result would be like this?</p>\n\n<pre><code>Row1\nRow2\nRow3\nRow4\nRow5\nRow6\n</code></pre>\n\n<p>or maybe something like this?</p>\n\n<pre><code>Row1\nRow6\nRow3\nRow5\nRow4\nRow2\n</code></pre>\n"},{"tags":["sql-server-2008","data","migration","db2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":12574570,"title":"copy tables from sql server to db2","body":"<p>I have a few tables under a sql server database, most of the contents are INT or VARCHAR, two tables have image column. Now i wanted to copy these tables to DB2 10.1 LUW and zseries, and v7r1 on iseries, what is the best way to perform this data migration?</p>\n\n<p>Thanks,</p>\n"},{"tags":["c#","sql-server","sql-server-2008","desktop-application"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":88,"score":0,"question_id":12573894,"title":"Controlling access to SQL server database file with C# desktop application","body":"<p>I am developing an accounting application using C# with SQL Server Express 2008, the application only accesses the database locally. i want the customer to enter a user name and password when he installs the application, that way he is the only one who can run the application, and my question is:<br>\n1. should i store the log in credentials in a local file, or create an sql server user account with those credentials and rely on the database keeping them a secret ?<br>\n2. if the second option is doable, how to do it from the installer package ?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":1,"view_count":95,"score":4,"question_id":12570925,"title":"Iterative query without using CTE (or cursors!)","body":"<p>I have some data in a table that looks similar to this:</p>\n\n<pre>\nItem    Date         Price\nA       8/29/2012    $3\nB       8/29/2012    $23\nC       8/29/2012    $10\nA       8/30/2012    $4\nB       8/30/2012    $25\nC       8/30/2012    $11\nA       8/31/2012    $3\nB       8/31/2012    $22\nC       8/31/2012    $8\nA       9/01/2012    $3\nB       9/01/2012    $26\nC       9/01/2012    $9\nA       9/02/2012    $3\nB       9/02/2012    $24\nC       9/02/2012    $9\n</pre>\n\n<p>I need to write a query that identifies that price for A hasn't changed \nsince 8/30/2012, price for item C hasn't changed since 9/01/2012, and \nto return the number of days elapsed for both (we're looking for items \nwith non-moving prices). I can't use CTE, or cursors, or separately created \ntemp tables (select into, etc) because of the limitations of the web report \ntool this sql needs to run in. I can only use a 'basic' single pass select query \n(subqueries will work though). Does anyone have any cunning ideas on how to \nachieve this??</p>\n\n<p>My first attempt was to group by Item and Price, where price is the same as \nthe latest price, <code>having count &gt; 2</code>, identifying the min date and doing a datediff\nbetween min date and getdate. However this just identifies the first instance of \nthat price, it doesn't take into account any subsequent rows that might have a \ndifferent price. Hope that makes sense.</p>\n"},{"tags":["c#",".net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":61,"score":-1,"question_id":12571135,"title":"Unsure about DatePicker data type format","body":"<p>i'm new to using C# and .NET and SQL Server...i'm doing a form design to allow a staff member to register a customer's details to a database. in the form i have the method to extract the data from the fields in the form, as well as a date picker to enter a customer's date of birth, however i am finding a bit of trouble to enter the format and default data type as i am unsure of how i am to go about doing this...the code for my form is shown below...\"dobTP\" is the name of my date picker box:</p>\n\n<pre><code>        SAF.AddNewCustomer(CustomerFirstName, CustomerLastName, CustomerContactNumber, dobTP, CustomerUsername, CustomerPassword, CustomerAddress, CustomerLicense, CustomerCreditCard);\n        txtCustomerFirst.Text = \"\";\n        txtCustomerLast.Text = \"\";\n        txtCustomerContact.Text = \"\";\n        dobTP ??\n        txtCustomerUsername.Text = \"\";\n        txtCustomerPassword.Text = \"\";\n        txtCustomerAddress.Text = \"\";\n        txtCustomerLicense.Text = \"\";\n        txtCustomerCredit.Text = \"\";\n        MessageBox.Show(\"Customer Created\");\n</code></pre>\n"},{"tags":["sql","sql-server-2008","join"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":41,"score":-1,"question_id":12571857,"title":"how to combine two columns into one","body":"<p>I have two tables, tb1(account, status) and tbl2(account status_ex). For example</p>\n\n<pre><code>account    status\n0001       A\n0002       CD\n0003       AB\n\naccount    status_ex\n0001       78\n0002       NULL\n0003       9\n</code></pre>\n\n<p>I want to write a query to combine the two status columns, the result table should be like</p>\n\n<pre><code>account    status\n0001       A78\n0002       CD\n0003       AB9\n</code></pre>\n\n<p>I tried following query</p>\n\n<pre><code>select tb1.account, \n  stuff(tbl1.status, len(tbl.status)+1, len(tbl.status), tb2.status_ex) as status\nfrom tb1 left join tb2\non tbl.account=tb2.accont\n</code></pre>\n\n<p>But the result is not correct, what did I do is wrong?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":12571442,"title":"How do I build logic into my computed field?","body":"<p>In my database I have a computed column that concatenates two fields to create an onscreen display name. The formula for the computed column is <code>(([LastName]+', ')+[FirstName])</code>.</p>\n\n<p>This formula works fine except for situations where there is a real last name but the first name is \"-\", a hyphen. From a data perspective, this is acceptable in some situations. In this cases, the name displays as \"<code>Smith, -</code> \". In situations like this, where there is no real first name, we don't want the comma and hyphen displayed. It should display as \"<code>Smith</code> \".</p>\n\n<p>In my computed field, how do I build in some logic to test for a hyphen in the first name and, if it exists, build the display name accordingly?</p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12531156,"title":"What do I have to be aware of when installing Reporting Services on a productive SQL Server 2008","body":"<p>I have a running sql server installation on which I would like to install the reporting services module. Now because it is very important that the sql server it self keeps available and running without any interruptions I get a little scary about this step.</p>\n\n<p>Now my question. Are there any pittfalls I have to be aware of before I install the module? E.g. does the server restart during the installation?</p>\n"},{"tags":["sql-server","vb.net","sql-server-2008","mygeneration"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":243,"score":0,"question_id":10302911,"title":"Why is MyGeneration stored procedure generator template not working?","body":"<p>I downloaded the stored procedure generator template from this link:</p>\n\n<p><a href=\"http://www.mygenerationsoftware.com/TemplateLibrary/Template/?id=10998336-5037-496c-a163-050060de065a\" rel=\"nofollow\">http://www.mygenerationsoftware.com/TemplateLibrary/Template/?id=10998336-5037-496c-a163-050060de065a</a></p>\n\n<p>Basically it generates Insert, Update, Delete, Select and LoadByPrimaryKey stored procedures by reading the schema.</p>\n\n<p>However, when I run it is not working. I get error at this line:</p>\n\n<pre><code>For Each objColumn In objTable.PrimaryKeys\n</code></pre>\n\n<p>and the error that I get is: </p>\n\n<blockquote>\n  <p>Object doesn't support this property or method</p>\n</blockquote>\n\n<p>Has anybody faced this problem? How do I resolve this?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12568779,"title":"Transposing columns to rows using UNPIVOT","body":"<p>I have a table that for some reason has hardcoded values like so:</p>\n\n<pre><code>Row ID    QtyC1   QtyC2  QtyC3   QtyC4  QtyN1   QtyN2  QtyN3   QtyN4  \n100       10      5      8       9      11      12     5       6\n101       9       11     12      5      6       10     4       9\n</code></pre>\n\n<p>The table has 35 columns and around 12k records (meaning around 500k values) and is being added to and amended constantly.</p>\n\n<p>I am trying to transpose this in a view into:</p>\n\n<pre><code>Row ID  Year  Period  Val\n100     C     1       10\n100     C     2       5\n100     C     3       8\n100     C     4       9\n100     N     1       11\n100     N     2       12\n100     N     3       5\n100     N     4       6\n</code></pre>\n\n<p>So far I have managed to split it out into single values using this query:</p>\n\n<pre><code>SELECT Row ID, YP, Val\n\nFROM (SELECT Row ID\n    , QtyC1 AS C1\n    , QtyC2 AS C2\n    , QtyC3 AS C3\n    , QtyC4 AS C4\n    , QtyN1 AS N1\n    , QtyN2 AS N2\n    , QtyN3 AS N3\n    , QtyN4 AS N4\n\nFROM MyTable\n) SUB\nUNPIVOT (Val FOR YP IN (C1,C2,C3,C4,N1,N2,N3,N4)) AS PVT\n</code></pre>\n\n<p>This is getting me a single identifying value (eg <code>C1</code>) but how can I split it so I have a numeric period and a single character for the year (<code>1</code> and <code>C</code>)?</p>\n\n<p>I can see it might be possible just splitting up the string into two parts but I was hoping for a cleaner way if possible.</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":111,"score":0,"question_id":12559643,"title":"T-SQL stuff column into another column","body":"<p>I have two columns (<code>A, B</code>)  like this....</p>\n\n<pre><code>A           B\n12_18_19    20\n</code></pre>\n\n<p>I want a 3rd column (C) added within same <code>SELECT</code> statement like this...</p>\n\n<pre><code>C\n12_18_20_19\n</code></pre>\n\n<p>in other words, my column <code>A</code> is delimited by \"_\", so the second last index of column <code>A</code> should be column <code>B</code>.</p>\n\n<p>If possible I would do do all this within same <code>SELECT</code> statement like this...</p>\n\n<pre><code>A         B    C\n12_18_19  20   12_18_20_19\n</code></pre>\n"},{"tags":["c#","sql-server-2008","sqlconnection"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":94,"score":-1,"question_id":12569623,"title":"Correct SqlConnection declaration","body":"<p>The problem is that I have used my <code>SqlConnection</code> as a public static connection, thinking this might be the problem causing form time to time an error :</p>\n\n<blockquote>\n  <p>*the connection is not open or the connection was already open</p>\n</blockquote>\n\n<p>So is it ok to use one statement of <code>SqlConnection</code> in a static class?</p>\n\n<p>So that I could <em>Declare</em> it only once, I know I could use <code>connectionString</code> in <code>web.config</code></p>\n\n<pre><code>ConfigurationManager.ConnectionStrings[\"conn\"].ConnectionString ...\n</code></pre>\n\n<p>but I like it to stay unrelated to <code>web.config</code> settings or servers name.</p>\n\n<ul>\n<li>ReEdit :</li>\n</ul>\n\n<p>as it is realy two methods within same class theres also another class in that main class \nbut this is not what's important rather than using same connection for all \nexecutions ! so you say that even though i re edited with right code of my helprer class \nthis is wrong ?</p>\n\n<pre><code>public static class myDBhelper\n{\n public static SqlConnection Conn = new SqlConnection (\"server=(local);Initial Catalog=dbName;Integrated Security=True\");\n\n        public static int ExecSQLint(string TblintSQL)\n        {\n            int anIntValue=0;\n            SqlCommand TblintCMD = new SqlCommand(TblintSQL, Conn);\n            try\n            {\n                Conn.Open();\n                anIntValue = Convert.ToInt32(TblintCMD.ExecuteScalar());\n            }\n            catch (System.Data.SqlClient.SqlException ex)\n            {\n                throw new Exception(\"No Can Do: \" + ex.Message);\n            }\n            finally\n            {\n                Conn.Close();\n            }\n          return anIntValue;\n        }\n\n\n\n        public static string ExecSQLstring(string TblStrSQL)\n        {\n          string strValue=\"\";\n          SqlCommand TblStrCMD = new SqlCommand(TblStrSQL, Conn);\n            try\n            {\n                Conn.Open();\n                strValue = TblStrCMD.ExecuteScalar().ToString();\n            }\n            catch (System.Data.SqlClient.SqlException ex)\n            {\n                throw new Exception(\"No Can Do: \" + ex.Message);\n            }\n            finally\n            {\n                Conn.Close();\n            }\n\n            return strValue;\n        }\n\n\n}\n</code></pre>\n\n<p>The main issue I suspect is those two options :</p>\n\n<pre><code>SqlConnection Conn = new SqlConnection(\"Data Source=(local);Integrated Security=True;database=dbName\")\n</code></pre>\n\n<p>in my <code>DBhelper</code> class I was using this declaration </p>\n\n<pre><code>SqlConnection Conn = new SqlConnection(\"server=(local);Initial Catalog=dbName;Integrated Security=True\");\n</code></pre>\n\n<p>could that be unstable or error prone ?</p>\n\n<p>p.s.: I am executing commands via try catch</p>\n\n<pre><code>            try\n            {\n                Conn.Open();\n                cmd.ExecuteNonQuery();\n            }\n            catch (System.Data.SqlClient.SqlException ex)\n            {\n                throw new Exception(\"No Can Do: \" + ex.Message);\n            }\n            finally\n            {\n                Conn.Close();\n            }\n</code></pre>\n\n<p>Is <code>Using</code> statement more appropriate? Although it is not my problem I was thinking... if I am already trying to do it 'by the book'...</p>\n\n<p>Is any method here actually <strong>wrong</strong> among those ? </p>\n"},{"tags":["sql-server","sql-server-2008","tempdb"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12569180,"title":"why tempdb is throwing an error but still database having around of 5gb space","body":"<p><img src=\"http://i.stack.imgur.com/eBumj.jpg\" alt=\"enter image description here\"></p>\n\n<p>when we are working on the application, suddenly we got the error as pasted in above screen shot, we cannot able to perform any thing, but if i look into the database still the having 5 gb more space available, what could be the reason? kindly advice </p>\n"},{"tags":["sql-server-2008","matlab"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12569028,"title":"SQL Server XML/STUFF query not working in MATLAB","body":"<p>I'm using a SQL Server query to concatenate nvarchar results from a one-to-many relationship. Using, say, the Northwnd database, this looks like:</p>\n\n<pre><code>    SET ARITHABORT ON\n\n    SELECT DISTINCT Country,\n    (STUFF((SELECT ',' + FirstName FROM Employees E2 WHERE E1.Country = E2.Country ORDER BY FirstName\n    FOR XML PATH(''), TYPE, ROOT).value('root[1]','nvarchar(max)'),1,1,'')) as FirstNames\n\n    FROM Employees E1 ORDER BY Country\n</code></pre>\n\n<p>This works fine, producing a result set with 2 items. Each item contains the country and a concatenation of the first names of the people from that country.</p>\n\n<p>I now want to run this same query inside a MATLAB script. Here's what I have:</p>\n\n<pre><code>    logintimeout(5);\n    conn = database('Northwnd','','', 'Vendor', 'Microsoft SQL Server', 'Server','localhost', 'AuthType','Windows');\n\n    curs = exec(conn, ['SET ARITHABORT ON SELECT DISTINCT Country '...\n        ', (STUFF((SELECT '','' + FirstName FROM Employees E2 WHERE  E1.Country = E2.Country ORDER BY FirstName '...\n        'FOR XML PATH(''), TYPE, ROOT).value(''root[1]'',''nvarchar(max)''),1,1,'''')) as FirstNames '...\n        'FROM Employees E1 ORDER BY Country']);\n\n    setdbprefs('DataReturnFormat', 'Dataset');\n    curs = fetch(curs); data = curs.Data;\n</code></pre>\n\n<p>MATLAB doesn't throw any errors, but the result set is empty. When I remove the second part of the query, and select only the distinct Country fields, it works fine, so I don't think the issue is MATLAB's connection to SQL Server. </p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12569229,"title":"SQL Server : stored procedure IFNULL check","body":"<pre><code>Solution_id (Primary key, Int)\nCol1 (varchar)\nCol2 (varchar)\nCol3 (varchar)\nCol4 (varchar)\nCol5 (varchar)\n</code></pre>\n\n<p>I am writing a stored procedure to update this table. There are 6 input parameters for the above 6 columns.</p>\n\n<pre><code>@Attached_File1 VARCHAR(MAX),\n@Attached_File2 VARCHAR(MAX),\n@Attached_File3 VARCHAR(MAX),\n@Attached_File4 VARCHAR(MAX),\n@Attached_File5 VARCHAR(MAX),\n@Ticket_ID BIGINT\n</code></pre>\n\n<p>I want to write a SQL query which will update the table with the values specified in the input parameters. BUT I must not overwrite the attachment columns with null. I mean I need to use only those parameters which contains data.</p>\n\n<p>For example, if the table has a row</p>\n\n<pre><code>[10, \"aaa\", \"bbb\", \"efg\", null, null] \n</code></pre>\n\n<p>and the input parameters are </p>\n\n<pre><code>(10, null, null, \"mno\", \"ddd\", null) \n</code></pre>\n\n<p>then after the update the row will become </p>\n\n<pre><code>[10, \"aaa\", \"bbb\", \"mno\", \"ddd\", null]\n</code></pre>\n\n<p>How to check for null/empty strings and generate the update query accordingly to achieve this?</p>\n"},{"tags":["c#","linq","sql-server-2008","tsql","whitespace"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12569358,"title":"A sequence of whitespace added to the end of CHAR columns","body":"<p>Today I ran into a weird problem. I have a database in SQL Server which is filled with Linq data access layer. Now I've got some columns that are of datatype <code>CHAR(100)</code> for example . </p>\n\n<p>When I`m inserting everything seems to be working fine but when I retrieve these values there some sequence of whitespace has been added to the end of each value.</p>\n\n<p>Anyone got an idea? </p>\n"},{"tags":["c#","asp.net","sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12567221,"title":"Writing sql data from a procedure to flat file","body":"<p>I am using sql server 2008 and (c#, asp.net). How do I write a select statement result to a text file (table with 5 columns and 30+ rows) in sql server? I have a database with hundreds of tables and stored procedures.</p>\n"},{"tags":["sql-server-2008","timezone","windows-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12569282,"title":"SQL DataTime affected by Server new time","body":"<p>I have a server in production, this is why i want to ask before experimenting, that is set tu -6 GMT. I need to have it configured to -5GMT with Daylight Saving. (which i think automatically makes the GMT go to -4 in summer time).</p>\n\n<p>I have millions of records that were inserted when my server was -6 (which still is). I recall thou that time in SQL is inserted using UTC (which is my understanding is standard to whatever timezone you are working at. SQL would do the calculation for you based on your Console Management time). Correct me if i am wrong.</p>\n\n<p>Would changing my server time would affect in any way my datetimes in sql?</p>\n\n<p>Thanks so much.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":12566293,"title":"Recommended SQL Server Agent account","body":"<p>I've a SQL Server Agent currently running under a LocalSystem account which I'd like to change so the account has least privileges. The instance of SQL Server the Agent is linked to is the Secondary Server in a transaction log shipping setup, with the Primary on another domain, so the Agent will need cross-domain read/write access to a folder on the Primary. I'd like to consider replication in the future, so the SQL Agent Account would need this factored in.</p>\n\n<p>Could anyone provide some straightforward steps to setup a suitable account? Any help would be gratefully appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":12566406,"title":"COUNT select and local variable storage","body":"<p>I need to find the id of the person with the least number of clients associated to them, inorder that the current new client is allocated to this staff member.</p>\n\n<p>I've used the following to establish the id of this staff member as follows;</p>\n\n<pre><code>    SELECT TOP(1) JA.judgeID, COUNT(JA.judgeId) AS COUNT\n    FROM recJudgeAssignment AS JA\n    LEFT JOIN recEntrantStatus AS ES\n    ON JA.bandId = ES.entrantId\n    GROUP BY JA.judgeId, ES.roundId\n    HAVING ES.roundId = @round\n    ORDER BY COUNT\n</code></pre>\n\n<p>But I need to catch this as a local variable to use in the next statement;</p>\n\n<pre><code>    UPDATE recJudgeAssignment\n    SET judgeId = @judge\n    WHERE roundId = @round\n    AND bandId = @entrantId\n</code></pre>\n\n<p>How do I catch the judgeId in the 1st select? Normally I would do something like;</p>\n\n<pre><code>    SELECT @judge =(SELECT TOP(1) JA.judgeID, COUNT(JA.judgeId) AS COUNT\n    FROM recJudgeAssignment AS JA\n    LEFT JOIN recEntrantStatus AS ES\n    ON JA.bandId = ES.entrantId\n    GROUP BY JA.judgeId, ES.roundId\n    HAVING ES.roundId = @round\n    ORDER BY COUNT)\n</code></pre>\n\n<p>This doesn't work of course because the select is returning the judgeId and the COUNT. I would prefer to not have to send the result of the 1st select back to the webpage and then do the subsequent update statement in a seperate web>db transaction.</p>\n\n<p>So... Any help or even remedies anyone can offer, would be greatly appreciated.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12568015,"title":"How do I Iterate through a small set of records and retrieve records that match criteria set in each record","body":"<p>I have a table <code>tblCriteria</code> that contains a small (&lt;20) set of records.  Each record has a field of criteria.</p>\n\n<p>I want SQL to move through these records when requested <code>tblFilterRun</code>, filter the main table <code>tblRecords</code> (~5000 records) and then insert some key fields from the matching records into another table <code>tblFilterResults</code>.</p>\n\n<pre><code>tblCriteria (CriteriaID, CriteriaText)\ntblFilterRun (FilterRunID, FilterRunDate)\ntblFilterResults (FilterResultsID, FilterRunID, RecordID, Ref, CustomerID, SupplierID\ntblRecords (RecordID, CustomerID, SupplierID...)\n</code></pre>\n\n<p>Previously I would have created something in Access to iterate through each tblCriteria record, but I would like a purely server solution.  I've heard cursors mentioned (usually at the same time as a profanity), what are my options?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":159,"score":8,"question_id":12544051,"title":"Randomly assign work location and each location should not exceed the number of designated employees","body":"<p>I am trying to select unique random posting/recruitment places of employees within a list of places, all the employees are already posted at these places, i am trying to generate a new random posting place for them with \"where\" condition that \"employee new random location will not be equal to their home place and randomnly selected Employees with their designation must be less than or equal to Place wise designation numbers from Places table \"</p>\n\n<p>the Employee table is :</p>\n\n<pre><code>EmpNo   EmpName           CurrentPosting    Home        Designation   RandomPosting\n1       Mac               Alabama           Missouri      Manager       \n2       Peter             California        Montana       Manager       \n3       Prasad            Delaware          Nebraska      PO       \n4       Kumar             Indiana           Nevada        PO       \n5       Roy               Iowa              New Jersey    Clerk       \n</code></pre>\n\n<p>And so on...</p>\n\n<p>And the Places table (PlaceNames with number of employees  - designation wise) is :-</p>\n\n<pre><code>PlaceID  PlaceName      Manager     PO    Clerk\n1        Alabama           2        0     1\n2        Alaska            1        1     1\n3        Arizona           1        0     2\n4        Arkansas          2        1     1\n5        California        1        1     1\n6        Colorado          1        1     2\n7        Connecticut       0        2     0\n</code></pre>\n\n<p>and so on...</p>\n\n<p>tried with with newid() like as below and to be able to select Employees with RandomPosting place names,</p>\n\n<pre><code>WITH cteCrossJoin AS (\nSELECT e.*, p.PlaceName AS RandomPosting,\n       ROW_NUMBER() OVER(PARTITION BY e.EmpNo ORDER BY NEWID()) AS RowNum\n    FROM Employee e\n        CROSS JOIN  Place p\n    WHERE e.Home &lt;&gt; p.PlaceName\n)\nSELECT *\nFROM cteCrossJoin\nWHERE RowNum = 1;\n</code></pre>\n\n<p>additionally I need to limit the random selection based upon designation numbers(in Places table)... that is to assign each Employee a PlaceName(from Places) randomly which is not equal to CurrentPosting and Home(in Employee) and Place wise designation will not exceed as given numbers.</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server-2008","windows-firewall"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12568170,"title":"Firewall will not play ball","body":"<p>I'm running SQL Server 2008 Express on a windows 2012... or at least I'm trying to :)</p>\n\n<p>My problem is that I have opened the ports I thought I needed but still I cant manage to connect to the database from Visual Studio. As proof I have a screenshot of my firewall settings:</p>\n\n<p><img src=\"http://i.stack.imgur.com/nE8ws.jpg\" alt=\"enter image description here\"></p>\n\n<p>Everything works fine if I turn the firewall off, but who wants that while connected to the internet?</p>\n\n<p>So I wonder what the heck is wrong? Is that some arbitrary ports that gets blocked? Is that a feature on the server (maybe its the same for 2008?)</p>\n\n<p>Large image: <a href=\"http://bildr.no/view/1280743\" rel=\"nofollow\">http://bildr.no/view/1280743</a></p>\n"},{"tags":["sql","sql-server-2008","sql-server-2008r2-express"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":12566535,"title":"Accessing Server under Window 7 x64","body":"<p>we decided to start a new project using the Microsoft SQL Server R2 under Win7. I insatalled SQLEpress R2 on my system and it was decieded to called it BEACONExpress. At first we could not get it to run, until we had our Domain SysApp come in and set the ownership to my login. Now I was able to use SQL Management Studio to create the Database. I even added some Tables to it. Then I fired up VS 2010 and created a test program. When I try and access the new database, VS returns this error <strong>\"The file can not be opened because it is being used by another process. Please close all applications that might access this file and try again.\"</strong></p>\n\n<p>If I attempt to create a new database under App_Data it returns this error. <strong>A network-related or instance-specific error occurered while establishing a connection to SQL server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified).</strong></p>\n\n<p>The connectionStrings in Web.config says</p>\n\n<pre><code>&lt;connectionStrings&gt;\n  &lt;add name=\"ApplicationServices\"\n       connectionString=\"data source=.\\SQLEXPRESS;Integrated Security=SSPI;AttachDBFilename= |DataDirectory|aspnetdb.mdf;User Instance=true\"\n       provideName=:System.Data.SqlClient\" /&gt;\n&lt;/connectStrings&gt;\n</code></pre>\n\n<p>I found the database at C:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.BEACONEXPRESS\\MSSQL\\DATA\\BeaconDB.mdf</p>\n\n<p>I tried changing SQLEXPRESS to MSSQL10_50.BEACONEXPRESS but it had no affect. I have been reading here and on other forums trying to determine what is wrong but so far have not found an answer.</p>\n"},{"tags":["sql-server","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12563680,"title":"estimated cost of this query exceeds the configured threshold ssis","body":"<p>I have an SSIS package that is failing with the above error.</p>\n\n<blockquote>\n  <p>The database has a query governor limit of 300</p>\n</blockquote>\n\n<p>I have tried adding an 'Execute SQL' task to my package before the data flow task to execute the statement:</p>\n\n<pre><code>SET QUERY_GOVERNOR_COST_LIMIT 0 \n</code></pre>\n\n<p>This shows as success during package execution, but my dataflow task is still failing and reporting the limit to be 300.</p>\n\n<blockquote>\n  <p>Source: \"Microsoft SQL Server Native Client 10.0 \"  Hresult:\n  0x80004005  Description: \"The query has been canceled because the\n  estimated cost of this query (336) exceeds the configured threshold of\n  300. Contact the system administrator.\". End Error</p>\n</blockquote>\n\n<p>How can I override this setting on my data flow task?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-agent-job","maintenance-plan","database-mail"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":61,"score":1,"question_id":12528737,"title":"SQL Maintenance Plan sends mail when no mail configured","body":"<p>I have a Maintenance plan under SQL Server 2008 R2 which runs at midnight. Within this maintenance task, there is no notify operator task. Within the SQL Agent job that executes the maintenance plan, there is no email alert. However, every time this job runs, I receive an email from SQL Server with the subject 'SQL Server Message'. I cannot understand why this mail keeps sending. Here's what the mail body starts with:</p>\n\n<blockquote>\n  <p>Microsoft(R) Server Maintenance Utility (Unicode) Version 10.50.1617\n  Report was generated on \"SERVERNAME\".\n  Maintenance Plan: My Maintenance Plan\n  Duration: 00:01:02\n  Status: Succeeded.\n  Details:</p>\n</blockquote>\n\n<p>Any ideas why this mail is sending, and where I should update the configuration so it only sends on failure or not at all?</p>\n"},{"tags":["sql-server-2008","indexing","clustered-index"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12567235,"title":"No real performance gain after index rebuild on SQL Server 2008","body":"<p>I have a table whose compound clustered index (<code>int, DateTime</code>) was 99% fragmented.</p>\n\n<p>After defragmenting and making sure that statistics were updated, I still  get the same response time when I run this query:</p>\n\n<pre><code>SELECT *\nFROM myTable\nWHERE myIntField = 1000 \nAND myDateTimeField &gt;= '2012-01-01' \nand myDateTimeField &lt;= '2012-12-31 23:59:59.999'\n</code></pre>\n\n<p>Well, I see a small response time improvement (like 5-10%) but I was really expected to burst my queries after that index rebuild and stats update.</p>\n\n<p>The estimated execution plan is:</p>\n\n<ol>\n<li><code>SELECT Cost: 0%</code></li>\n<li><code>Clustered Index Seek (Clustered)[MyTable].[IX_MyCompoundIndex] Cost: 100%</code></li>\n</ol>\n\n<p>Is this because the index is a clustered index? Am I missing something?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12566493,"title":"How can I assign inserted output value to a variable in sql server?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5558582/sql-server-output-clause-into-a-scalar-variable\">SQL Server Output Clause into a scalar variable</a>  </p>\n</blockquote>\n\n\n\n<pre><code>DECLARE @id int\nINSERT INTO MyTable(name)\nOUTPUT @id = Inserted.id\nVALUES('XYZ')\n</code></pre>\n\n<p>I am trying like above. How is it possible?</p>\n"},{"tags":["tsql","sql-server-2008","full-text-search","freetexttable"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":577,"score":3,"question_id":3097166,"title":"FREETEXTTABLE always has a rank of 0","body":"<p>I'm using SQLServer 2008 and if I perform the following query:</p>\n\n<pre><code>SELECT \n  *\nFROM\n  FREETEXTTABLE(SomeTable, Name, 'a name that I know exists')\n</code></pre>\n\n<p>I get the rows back that I would expect, but the rank is always 0.</p>\n\n<p>Searching for a solution to this problem, <a href=\"http://forums.asp.net/t/1206348.aspx\" rel=\"nofollow\">I found this question</a> on the Microsoft ASP.NET forum, and sure enough if I add:</p>\n\n<pre><code>ALTER FULLTEXT CATALOG MyCatalog REBUILD\n</code></pre>\n\n<p>I start to get a rank - but only temporarily.</p>\n\n<p>I don't want to have to rebuild my catalog every time I do a search especially when I have lots of data in my database and if I add it to my Sproc directly before the query, my query returns no results anyway, presumably because the catalog has finished being rebuilt. There seem to be other people having this and similar problems but I have been unable to find a solution. Any ideas?</p>\n"},{"tags":["asp.net","vb.net","sql-server-2008","asp.net-4.0","unc"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":12566036,"title":"An attempt to attach an auto-named database for file ....database1.mdf failed","body":"<p>I am getting the following error while debugging my visual studio 2010 website:</p>\n\n<pre><code>An attempt to attach an auto-named database for file C:\\Users\\...\\Desktop\\Dpp2012New\\App_Data\\dppdatabase.mdf failed. A database with the same name exists, or specified file cannot be opened, or it is located on UNC share.\n\nDescription: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.\n\nException Details: System.Data.SqlClient.SqlException: An attempt to attach an auto-named database for file C:\\Users\\...\\Desktop\\Dpp2012New\\App_Data\\dppdatabase.mdf failed. A database with the same name exists, or specified file cannot be opened, or it is located on UNC share.\n</code></pre>\n\n<p>Here is my connection string from my web.config:</p>\n\n<pre><code>&lt;connectionStrings&gt;\n    &lt;add name=\"ApplicationServices\" connectionString=\"data source=.\\SQLEXPRESS;Integrated Security=SSPI;AttachDBFilename=|DataDirectory|\\aspnetdb.mdf;User Instance=true\" providerName=\"System.Data.SqlClient\"/&gt;\n    &lt;add name=\"ConnectionString\" connectionString=\"Data Source=.\\SQLEXPRESS;AttachDbFilename=|DataDirectory|\\dppdatabase.mdf;Integrated Security=SSPI\" providerName=\"System.Data.SqlClient\"/&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>And I access it from my website as:</p>\n\n<pre><code>Dim connectionString As String = ConfigurationManager.ConnectionStrings(\"ConnectionString\").ConnectionString\n</code></pre>\n\n<p>The stacktrace shows the error line as:</p>\n\n<pre><code> Dim conn As New SqlConnection(connectionString)\n Dim dr As SqlDataReader\n conn.Open() 'This is the error line as per stacktrace\n</code></pre>\n\n<p>I have given the needed permissions to the above folder so it can not be the \" or specified file cannot be opened\" issue. If we look at all the posts related to the same error in this forum, clearly the profoundness of this error can be found out. However, none of the solutions solves my issue.\nSome of the resources which I have tried are: </p>\n\n<ol>\n<li><a href=\"http://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx\" rel=\"nofollow\">http://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx</a></li>\n<li><a href=\"http://blogs.msdn.com/b/webdevelopertips/archive/2010/05/06/tip-106-did-you-know-how-to-create-the-aspnetdb-mdf-file.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/webdevelopertips/archive/2010/05/06/tip-106-did-you-know-how-to-create-the-aspnetdb-mdf-file.aspx</a></li>\n<li><a href=\"http://forums.asp.net/t/1033225.aspx\" rel=\"nofollow\">http://forums.asp.net/t/1033225.aspx</a></li>\n</ol>\n\n<p>I eagerly await a solution.</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":27,"score":-4,"question_id":12565516,"title":"How to Retrieve value of maximum occurance of a char column","body":"<p>i have issues in obtaining the maximum occurance of a column</p>\n\n<pre><code> matnum   uom  amount\n-------------------------------------\n1234    EA   10\n1234    CS   10\n1234    EA    20\n1235    CS   10\n1235    CS    20\n</code></pre>\n\n<hr>\n\n<p>my output selection should be</p>\n\n<pre><code> matnum   uom  SUM(amount)\n-------------------------------------\n1234   EA (because EA occured Twice)    40\n1235   CS                               30\n</code></pre>\n\n<hr>\n\n<p>kindly provide a select query to obtain the desired result</p>\n"},{"tags":["sql","sql-server-2008","set-based"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":12564227,"title":"How to convert cycle to table-based query?","body":"<p>I have a table <code>IDTable</code> with one column <code>ID</code> and also I have one table valued function <code>MyProcedure</code> that takes a parameter. This parameter is my column <code>ID</code>. This function returns a table. I need to call this function for every value in column <code>ID</code>. I have such code:</p>\n\n<pre><code>Declare @ResultTable table(\n  ClientID nvarchar(50) null,\n  [Date] datetime null,\n  Item varchar(100) null\n)\n\nDeclare @IDTable table(\n    id int\n )\n\n declare @counter as int \n set @counter = isnull( (select max(id) from @IDTable),0) \n while @counter&lt;&gt;0 \n begin \n    set @ID = (select id from @IDTable where id=@counter)\n\n    insert into @ResultTable\n       select ClientID\n              [Date],\n              Item\n       from MyProcedure (@ID)\n\n    delete from @IBTable where id=@counter \n    set @counter=isnull((select max(id) from @IBTable),0) \n end\n</code></pre>\n\n<p>I need to remove while cycle and make set-based alternative. How can I do it?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1957,"score":0,"question_id":8938527,"title":"sp_generate_inserts for SQL Server 2008","body":"<p>I've been using Narayana Vyas Kondreddi's excellent stored procedure <code>sp_generate_inserts</code> <a href=\"http://vyaskn.tripod.com/code/generate_inserts.txt\" rel=\"nofollow\">http://vyaskn.tripod.com/code/generate_inserts.txt</a> in a SQL Server 2005 database. </p>\n\n<p>But after moving to SQL Server 2008 I get weird results where a long whitespace is inserted after UNIQUEIDENTIFIER values:</p>\n\n<pre><code>INSERT INTO [BannerGroups]([Id], [DescriptionText], [Width], [Height]) \nVALUES('BFCD0173-9432-47D1-84DF-8AB3FB40BF76                                                                                                                                                                                                                           ', 'Example', 145, NULL)\n</code></pre>\n\n<p>Anyone know how to fix this?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1033,"score":2,"question_id":3808013,"title":"How do I trim out middle initial from a person's full name in SQL?","body":"<p>I'm look for the simplest way to split up first and last name wile trimming out the middle initial.  The current layout of the field is [Last Name], [First Name] [MI].  Also, middle initial is not always there.  My current code is below, I'm just not sure how to trim out the middle initial from first name without writing a case statement.</p>\n\n<pre><code>SELECT SUBSTRING(h.Name, CHARINDEX(',', h.Name, 0) + 2, LEN(h.Name) - CHARINDEX(',', h.Name, 0)), 0 as FirstName\n    ,SUBSTRING(h.Name, 0, CHARINDEX(',', h.Name, 0)) as LastName\nFROM Members\n</code></pre>\n"},{"tags":["c#","sql-server-2008","stored-procedures","parameters","sqlcommand"],"answer_count":2,"favorite_count":1,"up_vote_count":9,"down_vote_count":0,"view_count":11314,"score":9,"question_id":5595353,"title":"How to pass table value parameters to stored procedure from .net code","body":"<p>I have DB on MS SQL Server 2005. In few procedures I have table parameters that I'm passing to sp in nvarchar (separated by coma) and internally divide to  single values. I'm adding it in this way to sql command parameters list:</p>\n\n<pre><code>cmd.Parameters.Add(\"@Logins\", SqlDbType.NVarchar).Value = \"jim18,jenny1975,cosmo\";\n</code></pre>\n\n<p>I have to migrate DB to SQL Server 2008. I know that there are table value parameters, and I know how to use it in stored procedures. But I don't know how to pass it to parameters list in sql command.\nDoes anyone know correct syntax of <code>Parameters.Add</code> procedure? Or there is other way to pass this parameter?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12563522,"title":"How can I insert identity manually?","body":"<pre><code>CREATE TABLE masterTbl (\nid INT IDENTITY(1,1) CONSTRAINT pk_id PRIMARY KEY,\nname VARCHAR(100))\n\nINSERT INTO masterTbl VALUES ('ABC', 'XYZ','PQR')\n</code></pre>\n\n<p>Now</p>\n\n<pre><code>Select * FROM masterTbl\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>id  | name\n---------------------\n1 |  ABC\n2 |  XYZ\n3 |  PQR\n\nDELETE FROM masterTbl WHERE id=1\n</code></pre>\n\n<p>Now</p>\n\n<pre><code>Select * FROM masterTbl\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>id |  name\n---------------------\n2 |  XYZ\n3 |  PQR\n</code></pre>\n\n<p>Now I want to run:</p>\n\n<pre><code>INSERT INTO masterTbl (id, name) VALUES (1, 'MNO')\n</code></pre>\n\n<p>How is this possible?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","triggers","backup"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":12436322,"title":"Delete Database before it is being Backuped","body":"<p>I'm using SQL Server 2008. now I want to create a trigger for capturing Database Backup. I watched to DDL triggers. but did not find anything about backup. </p>\n\n<p><strong>EDIT : Really what i need to do. if someone will backup database i want to drop database. maybe it is not good to do it with trigger or event notification. if so then advise alternative way please</strong></p>\n\n<p>Simply, how drop database when someone will backup database</p>\n"},{"tags":["c#","asp.net","sql-server-2008","gridview"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12465832,"title":"RowUpdate event not actually Upadating Database","body":"<p>My Gridview is a way to get me viewing database table and perform edit and update when needed</p>\n\n<p>the data is actually made of moth , year and DaysPerMonth (workable days count)</p>\n\n<p>all fields are type of <code>Int</code> </p>\n\n<p>so to display the current month instead of the int value /format of a given month i am using \ntranslation with both ways, out of the database -  to display in gridview as month name(string)</p>\n\n<pre><code>   public static CultureInfo ILci = CultureInfo.CreateSpecificCulture(\"he-IL\");\n\n   public static string GetMonthName(int mInt, int mYear=2012)\n   {\n        DateTime fullDate = new DateTime(mYear, mInt, 2);\n        string[] tempDayArray = fullDate.ToString(\"MMMM\", ILci).Split(' ');\n        return ILci.DateTimeFormat.GetMonthName(mInt);\n\n    }\n</code></pre>\n\n<p>and back in to database through the \"translator\" / formatter</p>\n\n<pre><code>    public static int GetMonthAsInt(string mStr)\n    {\n        return DateTime.ParseExact(mStr, \"MMMM\", ILci).Month;\n\n    }\n</code></pre>\n\n<p>all stages are ok from begining - view mode \nthrough Editing - Edit mode \neven when in update mode,</p>\n\n<p>i could check with VS debugger \nthe value of the SQL datasource update command  that is actually \"Good To Go\"\nand executing it's command in SQL server query\nreturns a succcesfull result.</p>\n\n<p>so the problem remains somewhere in end of update or right after the update DataBind();\nline at the end \nthe error / exeption i am getting is :</p>\n\n<p><strong>Input string was not in a correct format.</strong> </p>\n\n<p>this is the GV_DaysPerMonth_RowUpdating event handler Code </p>\n\n<pre><code>    protected void GV_DaysPerMonth_RowUpdating(object sender, GridViewUpdateEventArgs e)\n    {\n\n        // by recived i ment what is taken by sql command from gridview\n\n        string recivedNameMonth=string.Empty;\n        int recivedYears = 0;\n        int recivedDprM = 0;\n        int RowNo = 0;\n\n        GridViewRow CurRow = GV_DaysPerMonth.Rows[e.RowIndex];\n        string[] formValues = new string[CurRow.Cells.Count-1];\n        bool note = ((TextBox)(CurRow.Cells[0].Controls[1])).Text != null;\n        if (note)\n        {\n            for (int i = 0; i &lt; CurRow.Cells.Count-1; i++)\n            {\n                formValues[i] = ((TextBox)(CurRow.Cells[i].Controls[1])).Text;\n            }\n            //recivedNameMonth = ((TextBox)(CurRow.Cells[0].Controls[1])).Text;\n        }\n\n        RowNo = e.RowIndex + 1;\n\n        recivedNameMonth = formValues[0];\n        int Montint = RobCS.RDates.GetMonthAsInt(recivedNameMonth);\n        recivedYears = Convert.ToInt32(formValues[1]);\n        recivedDprM = Convert.ToInt32(formValues[2]);\n\n        dsWorkDayPerMonth.UpdateCommand = \"UPDATE [tblWorkDaysPerMonth] SET [theMonth] = \" + Montint+ \", [theYear] = \"+recivedYears+\",[WorkDaysPerMonth] = \" + recivedDprM + \" WHERE [recordID] = \" + RowNo;\n\n        GV_DaysPerMonth.DataBind();\n\n    } \n</code></pre>\n\n<p>using it on </p>\n\n<p>SqlDataSource </p>\n\n<pre><code>&lt;asp:sqldatasource runat=\"server\" id=\"dsWorkDayPerMonth\" \nConnectionString=\"Data Source=(local);Initial Catalog=hental;Integrated Security=True\" \nProviderName=\"System.Data.SqlClient\" \nSelectCommand=\"SELECT * FROM [tblWorkDaysPerMonth]\"\nUpdateCommand=\"UPDATE [tblWorkDaysPerMonth] SET [theMonth] = @theMonth, [theYear] = @theYear, \n                                    [WorkDaysPerMonth] = @WorkDaysPerMonth WHERE [recordID] = @recordID\" \nDeleteCommand=\"DELETE FROM [tblWorkDaysPerMonth] WHERE [recordID] = @recordID\" \nInsertCommand=\"INSERT INTO [tblWorkDaysPerMonth]\"&gt;\n&lt;UpdateParameters&gt; \n    &lt;asp:Parameter Name=\"theMonth\" Type=\"Int32\" /&gt; \n    &lt;asp:Parameter Name=\"theYear\" Type=\"Int32\" /&gt; \n    &lt;asp:Parameter Name=\"WorkDaysPerMonth\" Type=\"Int32\" /&gt; \n    &lt;asp:Parameter Name=\"recordID\" Type=\"Int32\" /&gt; \n&lt;/UpdateParameters&gt; \n&lt;DeleteParameters&gt; \n    &lt;asp:Parameter Name=\"recordID\" Type=\"Int32\" /&gt; \n&lt;/DeleteParameters&gt; \n&lt;/asp:sqldatasource&gt;\n</code></pre>\n\n<p>with GridView</p>\n\n<p>\n        \n        </p>\n\n<pre><code>                &lt;asp:TemplateField HeaderText=\"Month\" ControlStyle-Width=\"100\" HeaderStyle-Width=\"120\" ItemStyle-HorizontalAlign=\"Center\"&gt; \n                    &lt;ItemTemplate&gt; \n                        &lt;%# Eval(\"theMonth\")%&gt; \n                    &lt;/ItemTemplate&gt; \n                    &lt;EditItemTemplate&gt; \n                        &lt;asp:TextBox ID=\"TBX_theMonth\" runat=\"server\" Text='&lt;%# Bind(\"theMonth\")%&gt;' /&gt; \n                    &lt;/EditItemTemplate&gt; \n</code></pre>\n\n<p></p>\n\n<p></p>\n\n<p>\n                     </p>\n"},{"tags":["c#","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12558078,"title":"SQL Server : stored procedure challenge","body":"<p>Here's the scenario: I have a table for <code>SunflowerSeeds</code> in SQL Server 2008.</p>\n\n<pre><code>CREATE TABLE [dbo].[SunflowerSeeds](\n    [Color] [nvarchar](50) NULL,\n    [SeedType] [nvarchar](50) NULL,\n    [Price] float NULL\n)\n</code></pre>\n\n<p>For simplicity, I haven’t inserted long list of data.</p>\n\n<p>Data insertion into the table looks like this:</p>\n\n<pre><code>Insert into [dbo].[SunflowerSeeds] (Color, SeedType, Price)\nSELECT 'Yellow', 'Dwarf', 20\nUNION ALL\nSELECT 'Brown', 'Garden', 30\nUNION ALL\nSELECT 'Red', 'Garden', 35\n</code></pre>\n\n<p>Now I have been provided various matrices that could raise the price of the seed.</p>\n\n<ol>\n<li>Polenless (YES/NO): If YES, raise the price by 10%</li>\n<li>Height (> 13\"): If YES, raise the price by 8%</li>\n<li>Organic (YES/NO): If Yes, raise the price by 15%</li>\n<li>Lifecycle (Annual- YES/NO): If Yes, raise the price by 12%</li>\n</ol>\n\n<p>Each data insert row could have YES or NO value to each of the matrix listed above. I need to come up with a process to return the new price based on the <code>Price</code> of each seed in the <code>SunFlowerseeds</code> table and taking into a/c the combination of matrices. </p>\n\n<p>For e.g., if Yellow Dwarf is polenless, with height > 13”, Organic YES and having an annual life cycle then the new price has to be computed as</p>\n\n<pre><code>10% + 8%+15%+12% = 45% = 1+ 0.45= 1.45 \n</code></pre>\n\n<p>Then new price is:  <code>1.45 * Original Price= 1.45*20 = 29</code></p>\n\n<p>Likewise for rest of the combination.</p>\n\n<p>I’m thinking of writing a SQL Server stored procedure, so that it could be called in my C# code later. The i/p parameters for the stored procedure will be <code>Color</code> and <code>SeedType</code>. With those two parameters, I could get the <code>Price</code>. </p>\n\n<p>The challenge is how do I compute the new <code>Price</code> for each of the seed with a combination of applicable matrices - Polenless, height, Organic, LifeCycle. Can anyone point me a proper way of doing it. Please kindly help me out. TIA.</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1498,"score":1,"question_id":8725206,"title":"Pivot table in SQL Server 2008 r2","body":"<p><strong>I have a table with Comma Separated values in multiple Columns as</strong></p>\n\n<pre><code>dept_rule  |dept_descr|dept   |dept_pos\n-----------+----------+-------+--------\nfour rules |No descrrr|aaa,bbb|xxx,yyy\n</code></pre>\n\n<p>I want to seperate the values, as the below table</p>\n\n<pre><code>dept_rule |dept_descr|dept|dept_pos\n----------+----------+----+--------\nfour rules|No descrrr|aaa |xxx\nfour rules|No descrrr|aaa |yyy\nfour rules|No descrrr|bbb |xxx\nfour rules|No descrrr|bbb |yyy\n</code></pre>\n\n<p>How to write query to do this.</p>\n\n<p>Thanks in advance...</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","pivot"],"answer_count":5,"favorite_count":2,"up_vote_count":5,"down_vote_count":0,"view_count":11682,"score":5,"question_id":1677645,"title":"Using PIVOT in SQL Server 2008","body":"<p>Let's say I have some data, either in a SQL Server 2008 table or a [table]-typed variable:</p>\n\n<pre><code>author_id     review_id     question_id     answer_id\n88540         99001         1               719\n88540         99001         2               720\n88540         99001         3               721\n88540         99001         4               722\n88540         99001         5               723\n36414         24336         1               302\n36414         24336         2               303\n36414         24336         3               304\n36414         24336         4               305\n36414         24336         5               306\n</code></pre>\n\n<p>I want to retrieve the data as a result set that looks like this:</p>\n\n<pre><code>author_id     review_id     1     2     3     4     5\n88540         99001         719   720   721   722   723\n36414         24336         302   303   304   305   306\n</code></pre>\n\n<p>I suspect the PIVOT operator is what I need (according to <a href=\"http://stackoverflow.com/questions/1461489/best-way-to-flatten-denormalize-sql-lookup-tables\">this post</a>, anyway), but I can't figure out how to get started, especially when the number of <strong>question_id</strong> rows in the table can vary.  In the above example, it's 5, but in another query the table might be populated with 7 distinct questions.</p>\n"},{"tags":["asp.net","sql-server","sql-server-2008","email","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":136,"score":0,"question_id":12559729,"title":"How to send e-mail alert when SQL Server data row equals to specified value","body":"<p>Here i have a sql server data table with date type of column. I want to send an e-mail alert to specified e-mail address when the difference of the stored date and the current date less than five. How can i do this?I'm doing this with ASP.NET and behind code is C#.Please explain me how to do this.\nThanks in advance..</p>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":12462113,"title":"Sending the Sproc results to an Email in SQL Server","body":"<p>I am trying to send an email of the Sproc results. I have tried doing this:</p>\n\n<pre><code>EXEC msdb.dbo.sp_send_dbmail  \n    @recipients = 'Testemail@XYZ.com',\n    @query = 'EXEC test_email' ,\n    @subject = 'Sample Data',\n    @attach_query_result_as_file = 1 ;\n</code></pre>\n\n<p>It gives me the following error:</p>\n\n<blockquote>\n  <p>Msg 15281, Level 16, State 1, Procedure sp_send_dbmail, Line 0<br>\n     SQL Server blocked access to procedure 'dbo.sp_send_dbmail' of component 'Database Mail XPs' because this component is turned off as part of the security configuration for this server. A system administrator can enable the use of 'Database Mail XPs' by using sp_configure. For more information about enabling 'Database Mail XPs', see \"Surface Area Configuration\" in SQL Server Books Online.</p>\n</blockquote>\n\n<p>Is there any other way to do this?</p>\n"},{"tags":["sql-server-2008","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":207,"score":0,"question_id":4587777,"title":"SQL Server 2008: Group Databases","body":"<p>In SQL Server Management Studio is there a property to set so you can group databases? Or can make a folder in SSMS to \"move\" those databases to?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-azure","service-broker"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12541507,"title":"Will SQL Server Service Broker be supported in SQL Azure in future?","body":"<p>I found that SQL Server Service Broker is not supported in SQL Azure. Service Broker is a very attractive choice for our event notification needs. But before committing to it I wanted to make sure it will be supported by Microsoft in the future. The fact that SQL Azure does not support Service Broker worries me. Is it the first step towards retiring Service Broker? We have plans to migrate our application to Azure in the future and I was trying to figure out whether Microsoft would be supporting Service Broker in the future versions of SQL Azure. I tried with lot of googling but I didn't get a definitive answer. Is anyone aware why Microsoft hasn't support Service Broker on SQL Azure and whether it is going to support in the future?</p>\n\n<p>Thanks,\nSathish</p>\n"}]}
{"total":21074,"page":20,"pagesize":100,"questions":[{"tags":["sql","sql-server-2008","tsql","reporting-services"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12557097,"title":"Function is exceeding SQL’s 1024 column limit","body":"<p>Parameters: <code>@Year int, @Month int</code></p>\n\n<p>Environment: SQL Server 2008 R2, Visual Studio</p>\n\n<p>Developing a statistical report to find a 6 month average for each code type (about 50+ types) depending on the selected month and year. </p>\n\n<p>So for example if February 2012 is selected then the query will count every time a code type appears in January 2012, December/November/October/September/August 2011 then divide that sum by 6 to get the past 6 month average. The actual average is calculated in a dataset in Visual Studio.</p>\n\n<p>The SQL code looks something like this:</p>\n\n<pre><code>CASE WHEN TypeCode = \"xyz\" and [Year] = (@Year - 1) and [Month] in (12, 11, 10, \n9, 8, 7) then 1 else 0 end as TypeXYZ_Jan_Avg,\n\nCASE WHEN TypeCode = \"xyz\" and (([Year] = (@Year ) and [Month] = 1) OR \n([Year] = @Year and [Month] in (12, 11, 10, 9, 8)) \nthen 1 else 0 end as TypeXYZ_Feb_Avg,\n\nCASE WHEN TypeCode = \"xyz\" and ([Year] = @Year and [Month] in (11, 10, 9, 8, 7, \n6)) then 1 else 0 end as TypeXYZ_Dec_Avg\n</code></pre>\n\n<p>This is done for each 50+ code types. </p>\n\n<p>There are other fields in this function (not mentioned here) that I need to keep. Anyhow, the final query exceeds the maximum amount of columns permitted. </p>\n\n<p>I tried to minimize the amount of fields by making the code type a parameter. </p>\n\n<p>Something like this:</p>\n\n<pre><code>CASE WHEN TypeCode = @CodeType and ([Year] = @Year and [Month] in (11, 10, 9, \n8, 7, 6)) then 1 else 0 end as Type_Dec_Avg\n</code></pre>\n\n<p>However, this doesn’t work when I declare the <code>@CodeType</code> parameter in the function (because of a multi-valued error I get in VS):</p>\n\n<pre><code> SELECT * FROM CodeTypes(@CodeType, @Year, @Month) \n</code></pre>\n\n<p>Values are passed but the calculations are off:</p>\n\n<pre><code> SELECT * FROM CodeTypes(@Year, @Month) WHERE CodeType in (@CodeType)\n</code></pre>\n\n<p>Any suggestions? Maybe make a temp table? I’m not too familiar with how to do this but I plan to do some research right now.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2008","sql-order-by"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":12559060,"title":"apply order by on data return","body":"<p>i have a stored procedure which return data like this </p>\n\n<pre><code>ReportLabelID   AssessmentLinkId\nTextBox7            10207\nRadioButton2        10207\nTextArea2           10207\nFullName5           10207\nFullName5           10211\nRadioButton2        10211\nTextArea2           10211\nTextBox7            10211\n</code></pre>\n\n<p>now what i want is that to sort the return data in alphabetical order along with their AssessmentLinkId in order also something like this </p>\n\n<pre><code>ReportLabelID   AssessmentLinkId\nFullName5           10207\nRadioButton2        10207\nTextArea2           10207\nTextBox7            10207\nFullName5           10211\nRadioButton2        10211\nTextArea2           10211\nTextBox7            10211\n</code></pre>\n\n<p>please help me out it's really urgent issue</p>\n\n<p>thanks in advance.</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":3,"up_vote_count":15,"down_vote_count":0,"view_count":10820,"score":15,"question_id":1960176,"title":"Cannot register default instance MSSQLSERVER in SQL Server 2008","body":"<p>I have installed SQL Server 2008 Developer on Windows 7 (64 bit). In SQL Management Studio I cannot register the default instance MSSQLSERVER. It cannot find it although the service is running. I get the message:</p>\n\n<blockquote>\n  <p>Cannot connect to PHOENIX\\MSSQLSERVER.</p>\n  \n  <p>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: SQL\n  Network Interfaces, error: 25 - Connection string is not valid)\n  (Microsoft SQL Server, Error: 87)</p>\n</blockquote>\n\n<p>However SQL Server Management Studio does show the SQL Server 2005 Express instance (that was installed with VS 2008 Pro) which appeared as already registered. I am using Windows Authentication as I installed it in mixed mode. </p>\n\n<p>How do I connect to an MSSQLSERVER instance using SQL Server Management Studio?</p>\n"},{"tags":["sql-server","visual-studio-2008","sql-server-2008","database-connection"],"answer_count":8,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16339,"score":1,"question_id":885035,"title":"SQL Server 2008 Express Edition Connection Issue","body":"<p>I have VS 2008 Professional Edition. After the installation (which included SQL Server 2008), I decided to install SQL Server 2008 Express Edition with Advanced Tools (so I could get SQL Server Management Studio on it). So I uninstalled the SQL Express that came with VS 2008, and installed the standalone SQL Server Express 2008 version with advanced tools.</p>\n\n<p>However, When I try to logon onto SQL Server Management Studio using:</p>\n\n<pre><code>.\\SQLEXPRESS\n</code></pre>\n\n<p>as Server name and Windows Authentication as the authentication, I get the following message:</p>\n\n<pre> TITLE: Connect to Server\n ------------------------------\n\n Cannot connect to .\\SQLEXPRESS.\n\n ------------------------------ ADDITIONAL INFORMATION:\n\n A network-related or instance-specific\n error occurred while establishing a\n connection to SQL Server. The server\n was not found or was not accessible.\n Verify that the instance name is\n correct and that SQL Server is\n configured to allow remote\n connections. (provider: SQL Network\n Interfaces, error: 26 - Error Locating\n Server/Instance Specified) (Microsoft\n SQL Server, Error: -1)\n\n For help, click:\n http//go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&EvtSrc=MSSQLServer&EvtID=-1&LinkId=20476\n\n ------------------------------ BUTTONS:\n\n OK\n ------------------------------\n</pre>\n\n<p>Any suggestions on how to get it to work? I have tried disabling Windows Firewall as well and still no luck.\nI am using WIndows Vista and SQL Server 2008 Express SP1 Patch has also been applied recently.</p>\n\n<p><strong>FIX: For those interested:</strong>\nI did not have any of the Instance Based installation installed (i.e. the Database engine). I Installed the instance based stuff and it fixed it!</p>\n"},{"tags":["sql-server-2008","tsql","set-based"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":82,"score":3,"question_id":12542908,"title":"How to find the longest sequence of letter in a string","body":"<p>I want to find out the longest sequence of letter in a string</p>\n\n<p>e.g. in the word <code>Honorificabcdwert</code> , the output will be <code>abcd</code>.</p>\n\n<p>How can I do it? </p>\n\n<p>My idea is to get the Ascii and then count the sequence until it breaks at some point. But I was able to proceed with only</p>\n\n<pre><code>DECLARE @t TABLE(ID INT IDENTITY,String VARCHAR(100))\nINSERT INTO @t SELECT 'Honorificabcdwert'\n\n;with Get_Individual_Chars_Cte AS\n( \n   SELECT \n        ID\n        ,Row_ID =ROW_NUMBER() Over(PARTITION by ID Order by ID) \n        ,SUBSTRING(String,Number,1) AS [Char]\n        ,ASCII(SUBSTRING(String,Number,1)) AS [Ascii Value]\n\nFROM @t  \nINNER JOIN master.dbo.spt_values ON\n Number BETWEEN 1 AND LEN(String)\n AND type='P'\n\n)\n\nSelect * from Get_Individual_Chars_Cte \n</code></pre>\n\n<p>After this I don't know what to do. Help needed for this or any other way of doing so.</p>\n"},{"tags":["sql","sql-server-2008","memory","out-of-memory"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":217,"score":2,"question_id":10253027,"title":"Long SQL file runs SQL Server out of memory (22,000 lines)","body":"<p>I have a file of a <code>.sql</code> file that is about 22,000 lines long. It's generated by something else, but basically just contains one update statement per line.  </p>\n\n<p>I get this error when I run the file in SQL Server Management Studio.</p>\n\n<blockquote>\n  <p>There is insufficient system memory in resource pool 'internal' to\n  run this query</p>\n</blockquote>\n\n<p>I think I just need to split this query file up, but I'm not sure the best way to go about it. I could cut the file into 2000 line chunks or something I suppose.</p>\n\n<p>This seems like a simple problem, and I will be doing this often enough I would like to come up with a good solution. Any ideas?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":146,"score":0,"question_id":12557446,"title":"SQL - SELECT all records for month based on timestamp","body":"<p>I have an SQL query that selects all records within a 24 hour period, however, I need to update it to select all the records within a month (relative to a records timestamp). So for example if I selected any record within the month of Feb, it should return all records from the beginning to the end of the month.</p>\n\n<p>The code I have to the daily query is:</p>\n\n<pre><code>SELECT  Snapshot.xId,  MAX(Snapshot.TimeStamp) AS Timestamp_Actual, \n                dateadd(dd, datediff(dd,0, MAX(Snapshot.TimeStamp)), 0) AS TimestampRange_Start,\n                dateadd(MI, 1439, dateadd(dd, datediff(dd,0, MAX(Snapshot.TimeStamp)), 0)) AS TimestampRange_End\n                FROM Snapshot\n                GROUP BY Snapshot.xId\n</code></pre>\n\n<p>What I have so far is:</p>\n\n<pre><code>SELECT  Snapshot.xId,  MAX(Snapshot.TimeStamp) AS Timestamp_Actual, \n                dateadd(mm, datediff(mm,0, MAX(Snapshot.TimeStamp)), 0) AS TimestampRange_Start,\n                dateadd(dd, 0, dateadd(mm, datediff(mm,0, MAX(Snapshot.TimeStamp)), 0)) AS TimestampRange_End\n                FROM Snapshot\n                GROUP BY Snapshot.xId\n</code></pre>\n\n<p>From the above statement, I can then include a standard WHERE clause to check the values of TimestampRange_Start and TimestampRange_End to see if Timestamp_Actual falls between them.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1605,"score":2,"question_id":4197299,"title":"sql server 2008 - find which tables contain specific text","body":"<p>i have a database that has a few hundred tables</p>\n\n<p>i need to find a specific string in any of the columns in all of the tables.</p>\n\n<p>how would i approach this problem>??</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11175423,"title":"How to search a given text in a table in sql server","body":"<p>I want to search a text in a table without knowing its attributes.\nExample : I have a table Customer,and i want to search a record which contains 'mohit' in any field without knowing its column name.</p>\n"},{"tags":["sql","xml","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12555309,"title":"add attribute and update value XML column sqlserver2008","body":"<p>I have seen several answers here on stackoverflow but I can not find what I'm looking for. I have checked <a href=\"http://stackoverflow.com/questions/7428587/compare-xml-data-in-sql\">this question</a> and <a href=\"http://stackoverflow.com/questions/7194279/add-modify-xml-column-with-attributes-from-another-column-value-return-results?rq=1\">this one</a> and some others pages but can't manage to get to a solution.</p>\n\n<p>This is my test data. Actually this code is inside an XML column in a  table.</p>\n\n<pre><code>&lt;product id=152&gt;\n    &lt;name&gt;tractor&lt;/name&gt;\n    &lt;category weight=5600 invoice=\"A600\"/&gt;\n&lt;/product&gt;\n&lt;product id=731&gt;\n    &lt;name&gt;excavadora&lt;/name&gt;\n    &lt;category weight=12340 invoice=\"B300\"/&gt;\n&lt;/product&gt;\n</code></pre>\n\n<p>What I need is to update the previous XML doing two actions:</p>\n\n<ul>\n<li>add new attribute on the category node</li>\n<li>be able to update that new attribute value, tried modifying weight but can't get to do it</li>\n</ul>\n\n<p>I think the solution should be using .modify and .value keywords in a query but don't know how.</p>\n\n<p>Im using SQL Server 2008 express. I have seen that a query can help to get an answer but I don't really have anything working.</p>\n"},{"tags":["sql-server","sql-server-2008","ssis","ssis-data-transformations","bids"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":496,"score":0,"question_id":11677279,"title":"SSIS Job scheduler failing, but running fine in BIDS and in MSDB integration Services","body":"<p>I have created an SSIS package , that exports that from Oracle 10g server into SQL SERVER 2008. The package runs fine , when I run it through Microsoft BIDS, It run fine , when I create a package of it and runs it in Integration Services. It gets failed only when I schedule it through Jobs scheduler (SQL Server Agent)</p>\n\n<pre><code>Date,Source,Severity,Step ID,Server,Job Name,Step Name,Notifications,Message,Duration,Sql Severity,Sql Message ID,Operator Emailed,Operator Net sent,Operator Paged,Retries Attempted\n07/26/2012 15:20:12,PATH JOB,Error,0,DSSSERVER,PATH JOB,(Job outcome),,The job failed.        \n The Job was invoked by User HHSH\\user7199.  The last step to run was step 1 (PATH JOB).,00:00:01,0,0,,,,0\n07/26/2012 15:20:12,PATH JOB,Error,1,DSSSERVER,PATH JOB,PATH JOB,,Executed as user: HHSH\\DSSSERVER$. Microsoft (R) SQL Server Execute Package Utility  Version 10.50.1600.1 for 64-bit  Copyright (C) Microsoft Corporation 2010. All rights reserved.    Started:  3:20:12 PM  Error: 2012-07-26 15:20:12.93     Code: 0xC0047062     Source: CLINICS ADO NET Source [1]     \nDescription: Microsoft.SqlServer.Dts.Runtime.DtsCouldNotCreateManagedConnectionException: Could not create a managed connection manager.     \nat Microsoft.SqlServer.Dts.Runtime.ManagedHelper.GetManagedConnection(String assemblyQualifiedName&lt;c/&gt; String connStr&lt;c/&gt; Object transaction)     \nat Microsoft.SqlServer.Dts.Runtime.Wrapper.IDTSConnectionManager100.AcquireConnection(Object pTransaction)     \nat Microsoft.SqlServer.Dts.Pipeline.DataReaderSourceAdapter.AcquireConnections(Object transaction)     \nat Microsoft.SqlServer.Dts.Pipeline.ManagedComponentHost.HostAcquireConnections(IDTSManagedComponentWrapper100 wrapper&lt;c/&gt; Object transaction)  End Error  Error: 2012-07-26 15:20:12.93     \nCode: 0xC0047017     Source: CLINICS SSIS.Pipeline     Description: component \"ADO NET Source\" (1) failed validation and returned error code 0x80131500.  End Error  Error: 2012-07-26 15:20:12.93     \nCode: 0xC004700C     Source: CLINICS SSIS.Pipeline     Description: One or more component failed validation.  End Error  Error: 2012-07-26 15:20:12.93     Code: 0xC0024107     Source: CLINICS      \nDescription: There were errors during task validation.  End Error  DTExec: The package execution returned DTSER_FAILURE (1).  Started:  3:20:12 PM  Finished: 3:20:12 PM  Elapsed:  0.624 seconds.  The package execution failed.  \nThe step failed.,00:00:01,0,0,,,,0\n07/26/2012 15:18:21,PATH JOB,Error,0,DSSSERVER,PATH JOB,(Job outcome),,The job failed.  The Job was invoked by User HHSH\\user7199.  The last step to run was step 1 (PATH JOB).,00:00:01,0,0,,,,0\n07/26/2012 15:18:22,PATH JOB,Error,1,DSSSERVER,PATH JOB,PATH JOB,,Executed as user: HHSH\\DSSSERVER$. \nMicrosoft (R) SQL Server Execute Package Utility  Version 10.50.1600.1 for 64-bit  Copyright (C) Microsoft Corporation 2010. All rights reserved.    Started:  3:18:22 PM   \nError: 2012-07-26 15:18:22.76     Code: 0xC0047062     Source: CLINICS ADO NET Source [1]     Description: \nMicrosoft.SqlServer.Dts.Runtime.DtsCouldNotCreateManagedConnectionException: Could not create a managed connection manager.     \nat Microsoft.SqlServer.Dts.Runtime.ManagedHelper.GetManagedConnection(String assemblyQualifiedName&lt;c/&gt; String connStr&lt;c/&gt; Object transaction)     \nat Microsoft.SqlServer.Dts.Runtime.Wrapper.IDTSConnectionManager100.AcquireConnection(Object pTransaction)     \nat Microsoft.SqlServer.Dts.Pipeline.DataReaderSourceAdapter.AcquireConnections(Object transaction)     \nat Microsoft.SqlServer.Dts.Pipeline.ManagedComponentHost.HostAcquireConnections(IDTSManagedComponentWrapper100 wrapper&lt;c/&gt; Object transaction)  End Error  Error: 2012-07-26 15:18:22.76     \nCode: 0xC0047017     Source: CLINICS SSIS.Pipeline     Description: component \"ADO NET Source\" (1) failed validation and returned error code 0x80131500.  End Error  Error: 2012-07-26 15:18:22.76     \nCode: 0xC004700C     Source: CLINICS SSIS.Pipeline     Description: One or more component failed validation.  End Error  Error: 2012-07-26 15:18:22.76     Code: 0xC0024107     \nSource: CLINICS      Description: There were errors during task validation.  End Error  DTExec: The package execution returned DTSER_FAILURE (1).  Started:  3:18:22 PM  Finished: 3:18:22 PM  Elapsed:  0.655 seconds.  The package execution failed.  The step failed.,00:00:00,0,0,,,,0\n07/24/2012 13:48:00,PATH JOB,Error,0,DSSSERVER,PATH JOB,(Job outcome),,The job failed.  \nThe Job was invoked by Schedule 23 (JOb Schedule for LAb PAthology).  The last step to run was step 1 (PATH JOB).,00:00:00,0,0,,,,0\n07/24/2012 13:48:00,PATH JOB,Error,1,DSSSERVER,PATH JOB,PATH JOB,,Executed as user: HHSH\\DSSSERVER$. Microsoft (R) SQL Server Execute Package Utility  Version 10.50.1600.1 for 64-bit  Copyright (C) Microsoft Corporation 2010. All rights reserved.    Started:  1:48:00 PM  Error: 2012-07-24 13:48:00.72     Code: 0xC0047062     Source: CLINICS ADO NET Source [1]     Description: \nMicrosoft.SqlServer.Dts.Runtime.DtsCouldNotCreateManagedConnectionException: Could not create a managed connection manager.     \nat Microsoft.SqlServer.Dts.Runtime.ManagedHelper.GetManagedConnection(String assemblyQualifiedName&lt;c/&gt; String connStr&lt;c/&gt; Object transaction)     at Microsoft.SqlServer.Dts.Runtime.Wrapper.IDTSConnectionManager100.AcquireConnection(Object pTransaction)     at Microsoft.SqlServer.Dts.Pipeline.DataReaderSourceAdapter.AcquireConnections(Object transaction)     at Microsoft.SqlServer.Dts.Pipeline.ManagedComponentHost.HostAcquireConnections(IDTSManagedComponentWrapper100 wrapper&lt;c/&gt; Object transaction)  End Error  Error: 2012-07-24 13:48:00.72     Code: 0xC0047017     Source: CLINICS SSIS.Pipeline     Description: component \"ADO NET Source\" (1) failed validation and returned error code 0x80131500.  End \n Error  Error: 2012-07-24 13:48:00.72     Code: 0xC004700C     Source: CLINICS SSIS.Pipeline     Description: One or more component failed validation.  End Error  Error: 2012-07-24 13:48:00.72     Code: 0xC0024107     Source: CLINICS      Description: There were errors during task validation.  End Error  DTExec: The package execution returned DTSER_FAILURE (1).  Started:  1:48:00 PM  Finished: 1:48:00 PM  Elapsed:  0.639 seconds.  The package execution failed.  The step failed.,00:00:00,0,0,,,,0\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","query","view"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":12553711,"title":"How to create a \"materialized something\" that accesses different tables, depending on a specific setting","body":"<p>I want a program to access a table/view/stored procedure, etc. (<strong>something materialized, let's call it X</strong>)  that abstracts the real location of the data contained in three basic tables (the tables have the same definition in all locations).</p>\n\n<p>I would want <strong>X</strong> to fetch the server name, catalog name and table name from somewhere (a table, probably) and access the specific three basic tables. The caller of <strong>X</strong> would not know which specific tables were being called.</p>\n\n<p>How can I do this in SQL Server (2008)?</p>\n"},{"tags":["sql","xml","sql-server-2008","xquery"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":121,"score":3,"question_id":12545964,"title":"Updating Xml attributes with new values in a SQL Server 2008 table","body":"<p>I have a table in SQL Server 2008 that it has some columns. One of these columns is in Xml format\nand I want to update some attributes.</p>\n\n<p>For example my Xml column's name is <code>XmlText</code> and it's value in 5 first rows is such as:</p>\n\n<pre><code> &lt;Identification Name=\"John\"  Family=\"Brown\"     Age=\"30\" /&gt; \n &lt;Identification Name=\"Smith\" Family=\"Johnson\"   Age=\"35\" /&gt; \n &lt;Identification Name=\"Jessy\" Family=\"Albert\"    Age=\"60\" /&gt;\n &lt;Identification Name=\"Mike\"  Family=\"Brown\"     Age=\"23\" /&gt;\n &lt;Identification Name=\"Sarah\" Family=\"Johnson\"   Age=\"30\" /&gt;\n</code></pre>\n\n<p>and I want to change all <code>Age</code> attributes that are 30 to 40 such as below:</p>\n\n<pre><code> &lt;Identification Name=\"John\"  Family=\"Brown\"     Age=\"40\" /&gt; \n &lt;Identification Name=\"Smith\" Family=\"Johnson\"   Age=\"35\" /&gt; \n &lt;Identification Name=\"Jessy\" Family=\"Albert\"    Age=\"60\" /&gt;\n &lt;Identification Name=\"Mike\"  Family=\"Brown\"     Age=\"23\" /&gt;\n &lt;Identification Name=\"Sarah\" Family=\"Johnson\"   Age=\"40\" /&gt;\n</code></pre>\n"},{"tags":["sql-server-2008","merge"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":12549415,"title":"Using MERGE in SQL Server 2008","body":"<p>I just found out about this nifty little feature. I have a couple questions. consider the statement below.  </p>\n\n<p>This is how interpret how it works. The USING statement is what gets compared to see if there is a match correct? I want to use how it is now, but I want to use 2 other columns from the source table in the MATCH portion. I can't do that. So is there a way that I can use the 2 columns (decesed (I know its spelled wrong :) ) and hicno_enc)?<br>\nAnother thing I would like to do and don't know if it possible, but if the row exists in target but not source, then mark it inactive.</p>\n\n<pre><code>SELECT FIRST_NAME, LAST_NAME, SEX1, BIRTH_DATE\nFROM \n    aco.tmpimport i\n    INNER JOIN aco.patients p \n    ON p.hicnoenc = i.hicno_enc\n    MERGE aco.patients AS target\n    USING (\n            SELECT FIRST_NAME, LAST_NAME, SEX1, BIRTH_DATE \n            FROM aco.tmpimport\n          ) AS source\n    ON target.hicnoenc = source.hicno_enc\n    WHEN MATCHED AND target.isdeceased &lt;&gt; CONVERT(BIT,source.decesed) THEN \n        UPDATE \n            SET \n                target.isdeceased = source.decesed, \n                updatedat = getdate(), \n                updatedby = 0\n    WHEN NOT MATCHED THEN\n        INSERT (firstname, lastname, gender, dob, isdeceased, hicnoenc)\n        VALUES (source.FIRST_NAME, \n                source.LAST_NAME, \n                source.sex1, \n                source.BIRTH_DATE, \n                source.decesed, \n                source.hicno_enc);\n</code></pre>\n"},{"tags":["asp.net","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12553148,"title":"Will Scope_Identity work in different application sessions?","body":"<p>My ASP.NET application is using SQL Server 2008 backend.</p>\n\n<p>I have a Web Form which is used by many users simultaneously to enter records. When user clicks SAVE button, a stored procedure inserts record to the database. After the successful execution of this stored procedure, I want to pick the recent record ID of this user. That is, if I am inserting records, I want to pick only the ID of the last record entered by me and not of other user.</p>\n\n<p>Will Scope_Identity work in this situation?</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":68,"score":5,"question_id":12552062,"title":"SQL select distinct column","body":"<p>I've a query which returns the following data</p>\n\n<p><img src=\"http://i.stack.imgur.com/yYDax.png\" alt=\"enter image description here\"></p>\n\n<p>as you can see in the image the colored groups are similar regarding column \"A\"\ni want to take the first occurrence of these rows regarding column \"A\" and discard the rest.</p>\n\n<p>so i can end up with this result.</p>\n\n<p><img src=\"http://i.stack.imgur.com/xD74n.png\" alt=\"enter image description here\"></p>\n\n<p>any solutions?</p>\n\n<p>Thanks :)</p>\n\n<p><strong>Update:</strong></p>\n\n<p>this is the original query results\n<img src=\"http://i.stack.imgur.com/Np2ry.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008","csv","import"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":12178453,"title":"SQL 2008 Bulk Insert & Variable Length Records","body":"<p>I'm having issues with 2008 and Bulk Insert.  I can't get it to behave with variable length records (specifically headers).</p>\n\n<p>Given the following file lines:</p>\n\n<hr>\n\n<ul>\n<li>1,2,3,4,5,6,7,9,10</li>\n<li>1,2,3,4,5,6,7,9,10,1,2,3,4,5,6,7,9,10</li>\n<li>1,2,3,4,5,6,7,9,10,1,2,3,4,5,6,7,9,10</li>\n<li>1,2,3,4,5,6,7,9,10,1,2,3,4,5,6,7,9,10</li>\n<li>1,2,3,4,5,6,7,9,10,1,2,3,4,5,6,7,9,10</li>\n<li>1,2,3,4,5,6,7,9,10,1,2,3,4,5,6,7,9,10</li>\n<li>1,2,3,4,5,6,7,9,10,1,2,3,4,5,6,7,9,10</li>\n<li>1,2,3,4,5,6,7,9,10,1,2,3,4,5,6,7,9,10</li>\n<li>1,2,3,4,5,6,7,9,10,1,2,3,4,5,6,7,9,10</li>\n<li>1,2,3,4,5,6,7,9,10,1,2,3,4,5,6,7,9,10</li>\n</ul>\n\n<p>Shouldn't the following do something useful like import the data? rather than return an empty table, or error if FirstRow is less than 2?</p>\n\n<p>I can't remember having quite so many issues with importing and SQL 2000.</p>\n\n<hr>\n\n<pre><code>   drop table #data\n\n   create table #data\n   (    \n    a int null, b int null\n    ,c int null, d int null\n    ,e int null, f int null\n    ,g int null, h int null\n    ,i int null, j int null\n    ,k int null, l int null\n    ,m int null, n int null\n    ,o int null, p int null\n    ,q int null, r int null\n    ,s int null, t int null\n   ) \n   truncate table #data\n\n   bulk insert #data \n   from 'd:\\temp\\data.txt'\n   WITH(\n     TABLOCK\n    ,CODEPAGE='RAW'\n    ,DATAFILETYPE='char'\n    ,FIELDTERMINATOR=','\n    ,ROWTERMINATOR='\\r\\n'\n    ,FIRSTROW=2\n    )\n\n   select * from #data\n</code></pre>\n\n<p>Forgot to mention, I have tried SSIS with but no difference...obviously I might have used the wrong component.  </p>\n\n<p>Oh and I can get 99% there, the bulk inserts everything but the 2nd row :(  But that's no use to anyone!</p>\n"},{"tags":[".net","sql-server-2008","c#-4.0","visual-c#-express-2010"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":40,"score":0,"question_id":12551438,"title":"Print window form data on button click","body":"<p>I have a PDF file that have a particular form format for an application. I have to design same format into windows form. After designing when I submit the value and click print it should show all submitted values on the application form and print it.</p>\n"},{"tags":["sql","sql-server-2008","union"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12026555,"title":"How to do a UNION on a single table?","body":"<p>I need to display the name and surname and address and DOB for all customers who reside in 'Peters' or 'Crows' avenue only.</p>\n\n<p>This is fine I did it like so:</p>\n\n<pre><code>SELECT Customers.FirstName, Customers.Surname,\n       Customers.CustomerAddress, Customers.DOB\nFROM Customers\nWHERE \n(  Customers.CustomerAddress LIKE '%'+ 'Peters' + '%' \nor Customers.CustomerAddress LIKE '%'+ 'Crows'+ '%')\n</code></pre>\n\n<p>but then I read a bit harder and it said: </p>\n\n<blockquote>\n  <p>Use a UNION query to produce the results.</p>\n</blockquote>\n\n<p>So I read up a bit on <code>UNION</code>s, but mostly I see that the returned values from both <em>SELECT</em> queries <strong>must be of the same length</strong>, and normally examples are using 2 different tables?</p>\n\n<p>So I need to perform a <code>UNION</code> on the same table such the all the customers with the words <em>Peters</em> and <em>Crows</em> in their address are shown. I tried:</p>\n\n<pre><code>SELECT Customers.CustomerAddress\nFROM Customers\nWHERE \n(  Customers.CustomerAddress LIKE '%'+ 'Peters' + '%'\nor Customers.CustomerAddress LIKE '%'+ 'Crows'+ '%')\nUNION\nSELECT Customers.FirstName, Customers.Surname,\n       Customers.CustomerAddress, Customers.DOB\nFROM Customers\n</code></pre>\n\n<p>But I get the Error:</p>\n\n<blockquote>\n  <p>All queries combined using a UNION, INTERSECT or EXCEPT operator must\n  have an equal number of expressions in their target lists.</p>\n</blockquote>\n\n<p>which is understandable because my first <em>SELECT</em> only returns 3 results (i.e the results I'm looking for) while the other returns all the addressed (including the ones I need).</p>\n\n<p>So my exact problem is, How do I do I perform a <code>UNION</code> on the same table (Customers total of 10 records) so that all the customers with the words <em>Peters</em> and <em>Crows</em> in their address are shown? (3 of the records match the condition the other 7 dont)</p>\n"},{"tags":["asp.net","sql-server-2008","authentication","authorization"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":112,"score":2,"question_id":12550768,"title":"How to restrict unlogged/unauthorized users from viewing web pages in ASP.NET","body":"<p>I have some created web forms and I need to check whether the user is authenticated or not, before displaying the other web forms. All the users can access <code>Default.aspx</code> and <code>About.aspx</code> pages.\nAnd I have three types of users namely- <code>Admin,User and Super User</code>. Also, I keep the authentication details in my own SQL server db. </p>\n\n<p>How can I do this?\nThanks in advance!</p>\n"},{"tags":["sql-server","sql-server-2008","licensing"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3408,"score":1,"question_id":998481,"title":"SQL Server 2008 Licensing when splitting Report Manager and Report Service on different machines","body":"<p>Question:  If I install the Report Server webservice on machine A and I put the Report Manager web application on machine B ... do I need two licenses or just one?</p>\n\n<p>In other words, what constitutes installing SSRS 2008 on a given machine?  Does the Reporting service = SSRS -OR- does any part of an SSRS install = SSRS with regards to licensing?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12549440,"title":"How to find the new entry has been made into the database from c#","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2152516/c-sql-database-listener-help-needed\">C#/SQL Database listener help needed</a>  </p>\n</blockquote>\n\n\n\n<p>I am writing an application to keep on monitoring the database table from the server machines. If the new entry has been made in to the table, then i have to collect the new details using select query and passed to the final builder as a parameter to start the automation.</p>\n\n<p>Question:\nHow can i find the new entry in database table using c#?</p>\n\n<p>i have no idea about this?</p>\n\n<p>can anyone help me out this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":118,"score":4,"question_id":12546369,"title":"View to identify grouped values or object","body":"<blockquote>\n  <p><img src=\"http://i.stack.imgur.com/fQ5ZI.png\" alt=\"enter image description here\"></p>\n</blockquote>\n\n<p>As an example I have 5 objects. An object is the red dots bound together or adjacent to each other. In other words X+1 or X-1 or Y+1 or Y-1.</p>\n\n<p></p>\n\n<blockquote>\n  <p><img src=\"http://i.stack.imgur.com/HujQN.png\" alt=\"enter image description here\"></p>\n</blockquote>\n\n<p>I need to create a MS SQL <strong>VIEW</strong> with will contain the first XY coordinate of each object like:<br></p>\n\n<pre><code>    X,Y\n=======\n1.  1,1\n2.  1,8\n3.  4,3\n4.  5,7\n5.  6,5\n</code></pre>\n\n<p>I can't figure out how to group it in a <strong>VIEW</strong> (NOT using stored procedure). Anybody have any idea would be of great help.\nThanks</p>\n"},{"tags":["c#","asp.net","sql-server-2008","panel","admin"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12550651,"title":"Which is the most efficient and secure way for implementing an admin panel for a website?","body":"<p>I am developing a website in ASP.NET, C# and SQL Server 2008. My colleagues suggest that I should build an admin panel as one of the <strong>secured section of my website in one of my hosting server's directories</strong> that is password locked. But what I think it will be more secure if I built it <strong>as an application on my desktop PC</strong> that don't have access to any outsider by using any scripting language like JavaScript and all. But I am not able to predict what is more efficient and secure way. First one or the second one. Please tell.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12548334,"title":"Application with large images database in SQL Server","body":"<p>We have a big database with articles and images of these articles, stored in SQL Server blob columns.</p>\n\n<p>When we started a few years ago, the main reason to store images in the database was the simplicity: it much easier to manage one large database than a lot of separate files. More than 500 000 images (each image 640x480) stored.</p>\n\n<p>But now, about 100+ users active in our database, and I feel, that our server working slowly.</p>\n\n<p>Is it a good solution to store images in database, or it is better to use separate files? Or maybe there are some secrets of SQL Server 2008 database optimization for such quantity of blobs?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12042396,"title":"Simple Text-Based Report MS SQL Server 2008 using PRINT","body":"<p>I am nearly finished with my first assignment but the last question has me stumped.</p>\n\n<p>It asks:</p>\n\n<blockquote>\n  <p>Produce a faulty product <strong>report</strong> that displays the product returned on the 11/07/2010 due to Damaged Exterior</p>\n</blockquote>\n\n<p>The expected output for this is:</p>\n\n<blockquote>\n  <p>FAULTY PRODUCT REPORT</p>\n  \n  <p>--------------------------------------</p>\n  \n  <p>Product Name: Desk</p>\n  \n  <p>Customer Name: Simon, Kernel</p>\n  \n  <p>Reason: Damaged Exterior</p>\n  \n  <p>(1 rows(s) affected)</p>\n  \n  <p>---END OF REPORT---</p>\n</blockquote>\n\n<p>I found out about SQL <code>PRINT</code> now I seem to nearly have it all down to a T:</p>\n\n<pre><code>DECLARE @ProductName varchar(30)\nSET @ProductName =(SELECT MIN(Products.ProductName) FROM Products)\n\nDECLARE @CustomerName varchar(75)\nSET @CustomerName =(SELECT MIN(Customers.FirstName+', '+Customers.Surname) \nFROM Customers,CustomerReturns,Products\nWHERE CustomerReturns.ReturnDate='2012/07/11'\nAND Products.ProductID=CustomerReturns.ProductID\nAND Customers.CustomerID=CustomerReturns.CustomerID)\n\nDECLARE @Reason varchar(30)\nSET @Reason =(SELECT MIN(CustomerReturns.Reason) \nFROM CustomerReturns,Products,Customers\nWHERE CustomerReturns.Reason='Damaged Exterior')\n\nPRINT 'FAULTY PRODUCT REPORT';\nPRINT '';\nPRINT '---------------------';\nPRINT 'Product Name: '+@ProductName;\nPRINT 'Customer Name: '+@CustomerName;\nPRINT 'Reason: '+@Reason;\nPRINT '';\nPRINT '---END OF REPORT---';\n</code></pre>\n\n<p>And my output:</p>\n\n<blockquote>\n  <p>FAULTY PRODUCT REPORT</p>\n  \n  <p>--------------------------------------</p>\n  \n  <p>Product Name: Desk</p>\n  \n  <p>Customer Name: Simon, Kernel</p>\n  \n  <p>Reason: Damaged Exterior</p>\n  \n  <p>---END OF REPORT---</p>\n</blockquote>\n\n<p>As you can see I am still missing the:</p>\n\n<blockquote>\n  <p>(1 rows(s) affected)</p>\n</blockquote>\n\n<p>How would i make this appear without ofcourse cheating and just printing it? (because then it will stay thay way no matter how many results get returned)</p>\n\n<p>EDIT:</p>\n\n<p>I found doing this: <code>SELECT @ProductName...</code> produces the 1row(s) affected, is this correct?:</p>\n\n<pre><code>PRINT 'FAULTY PRODUCT REPORT';\nPRINT '';\nPRINT '---------------------';\nPRINT 'Product Name: '+@ProductName;\nPRINT 'Customer Name: '+@CustomerName;\nPRINT 'Reason: '+@Reason;\nSELECT @ProductName,@CustomerName,@Reason\nPRINT '';\nPRINT '---END OF REPORT---';\n</code></pre>\n\n<p>EIDT2:</p>\n\n<p>Changed it to this:</p>\n\n<pre><code>DECLARE @PName varchar(35)\nDECLARE @CName varchar(75)\nDECLARE @RName varchar(75)\nSELECT @PName=Products.ProductName,\n @CName=Customers.FirstName+', '+Customers.Surname ,\n @RName=CustomerReturns.Reason\n\nFROM Products,Customers,CustomerReturns\n\nWHERE CustomerReturns.ReturnDate='2012/09/28'\nAND CustomerReturns.Reason='Damaged Exterior'\nAND Products.ProductID=CustomerReturns.ProductID\nAND Customers.CustomerID=CustomerReturns.CustomerID\nPRINT @PName\nPRINT @CName\nPRINT @RName\n</code></pre>\n\n<p>but still not affected rows thingy</p>\n\n<p>Any help  is appreciated thank you</p>\n"},{"tags":["sql-server","performance","sql-server-2008","reporting-services","sql-server-2012"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12512227,"title":"best practice: reportservers and sql servers","body":"<p>we have three SQL servers serving a variety of applications on different webservers.\nEach application is using reporting services functionality.\nThe average load per server per month is about 40.000 reports, taking an average of 3.1 secs to deliver a report.</p>\n\n<p>At this moment the the situation is as follows:</p>\n\n<ul>\n<li>Application A has his database on SQLServer A and is using Reporting\nServices on SQLServer A. (SQL 2008) </li>\n<li>Application B has his database on    SQLServer B and is using\nReporting Services on SQLServer B. (SQL 2008R2)</li>\n<li>Application C has his database on SQLServer C and is using<br>\nReporting Services on SQLServer C.  (SQL 2008R2).</li>\n</ul>\n\n<p>We have just bought a new server, runnning SQL 2012.\nWould it be wise to move all reporting to the Reporting Server 2012?\nMy idea is that there would be a significant performance-gain. Also, There would be only one reporting server to manage. But is that so? Are there penalties when running reports on one server while the database feeding the reports is on another server? Is it a problem if the Reporting Services version is different then that of the database server?</p>\n\n<p>I would like very much to hear your thoughts on this.\nPerformance and manageability are two key-components.</p>\n\n<p>Greetings and thanks for thinking with me,</p>\n\n<p>Henro</p>\n"},{"tags":["sql-server","sql-server-2008","excel","ms-access"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12512796,"title":"SQL Server - Views/Tables Description in Office Import Data Window","body":"<p>i would like to know how, and if its possible to set a description for the views/tables (in a sql server 2008 environment) so that when a user select a database/table to import to access/excel it would show a description i set,</p>\n\n<p>I already tried the MS_Description extended property without success, does anyone know what i need to set in a sql server view/table to show properly show the description?</p>\n\n<p>Thanks!</p>\n\n<p>(just created this account and i cant post images, see here <a href=\"http://i.msdn.microsoft.com/dynimg/IC489090.gif\" rel=\"nofollow\">http://i.msdn.microsoft.com/dynimg/IC489090.gif</a> for what window im talking about)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12543526,"title":"Select Single column value in multiple column?","body":"<p>I have some data in my table as follows:</p>\n\n<pre><code> ID     Name\n  2    219SUN_BV_Secure_Gateway.pdf\n  3    197FDD_BV_Secure_Gateway.pdf\n  5    225RQB_BV_Secure_Gateway.pdf\n  6    A_00025_Q1_2012.pdf         \n  7    A_00025_Q2_2012.pdf         \n  8    A_00025_Q3_2011.pdf         \n  9    C_00025_Q3_2011_PostLLC.pdf\n 10    B_00025_Q3_2011.pdf        \n</code></pre>\n\n<p>I want to fetch the data as per the following requirement:</p>\n\n<ul>\n<li>in first column, I want data whose name starts with A</li>\n<li>in Second column, I want data whose name starts with B</li>\n<li>in Third column, I want data whose name starts with C</li>\n</ul>\n\n<p>I used this query:</p>\n\n<pre><code>SELECT \n    CASE \n        WHEN DocumentFile LIKE 'A%' THEN DocumentFile \n    END as DocFile_A,\n    CASE\n        WHEN DocumentFile LIKE 'B%' THEN DocumentFile \n    END as DocFile_B,\n    CASE \n        WHEN DocumentFile LIKE 'C%' THEN DocumentFile \n    END as DocFile_C \nFROM \n    RFP_DocumentVault \n</code></pre>\n\n<p>This returns me the following results:</p>\n\n<pre><code>DocFile_A              DocFile_B          DocFile_C\n NULL          NULL             NULL\n NULL          NULL             NULL\n NULL          NULL             NULL\n A_00025_Q1_2012.pdf   NULL             NULL\n A_00025_Q2_2012.pdf   NULL             NULL\n A_00025_Q3_2011.pdf   NULL             NULL\n NULL          NULL           C_00025_Q3_2011_Post Partners II, LLC.pdf\n NULL          B_00025_Q3_2011.pdf        NULL\n</code></pre>\n\n<p>But I want results as follows:</p>\n\n<pre><code> DocFile_A            DocFile_B                 DocFile_C\n A_00025_Q1_2012.pdf  B_00025_Q3_2011.pdf     C_00025_Q3_2011_Post Partners II, LLC.pdf\n A_00025_Q2_2012.pdf  NULL                      NULL\n A_00025_Q3_2011.pdf  NULL                      NULL\n</code></pre>\n\n<p>Any idea how I can do this?</p>\n"},{"tags":["sql-server-2008","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1098,"score":0,"question_id":9296299,"title":"How to compare textbox value with the sql database value in c#?","body":"<p>How to compare textbox value with the sql database value in c#?</p>\n\n<p>im a beginner n i have to make a project. i only know how to connect sql database with the c# project.\nand also tell me any tutorial, link or anything that can help me.</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12545171,"title":"How to set a column with varchar data type as unique in SQL Server 2008?","body":"<p>Table <code>ApprovedLeave</code></p>\n\n<p>Column names:</p>\n\n<ul>\n<li><code>EmployeeID (int)</code></li>\n<li><code>Leave(varchar(MAX))</code></li>\n<li><code>Approved(bit)</code></li>\n</ul>\n\n<p>I want to set <code>Leave</code> column unique so that user cannot enter same date twice. I cannot take employee id as primary key because same employee can take leave multiple times</p>\n"},{"tags":["sql-server-2008","select","filter","aggregate-functions","computed-columns"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":84,"score":0,"question_id":12545421,"title":"Retrieving specific columns sum from Table","body":"<p>I have data with several columns in the same table:</p>\n\n<pre><code>Col1    Col2    Col3    Col4    Col5    Col6\n</code></pre>\n\n<p>I want to retrieve the sum from Col1 to Col3, from Col3 to Col6, or from Col1 to Col6 from table, however I can't figure out how to  select these specific columns.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","placeholder"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":140,"score":2,"question_id":12537629,"title":"How to pass a column name value as SQL argument using placeholders","body":"<p>How to pass a column name value as a SQL argument using parameter placeholders ?</p>\n\n<p>The goal is having this working:</p>\n\n<pre><code>var sql = \"SELECT * FROM Condos WHERE @0 LIKE @1\";\nvar sqlData = db.Query(sql,choice,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p><code>choice</code> is a variable that will store the <code>column name</code></p>\n\n<p><code>@0</code> is a <code>column name</code> (and I don't succeed to pass it as an argument)</p>\n\n<p><code>@1</code> is a <code>search string</code> (and I have no problem with it)</p>\n\n<p>Have read and tried a lot of things:</p>\n\n<p>Below one doesn't throw any error but doesn't bring any data</p>\n\n<pre><code>var sql = \"SELECT * FROM Condos WHERE @0 LIKE @1\";\nvar sqlData = db.Query(sql,choice,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p>Below one throws <code>Column name not valid = '@0'</code></p>\n\n<pre><code>var sql = \"SELECT * FROM Condos WHERE [@0] LIKE @1\"\nvar sqlData = db.Query(sql,choice,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p>Below one throws <code>Column name not valid = 'choice'</code></p>\n\n<pre><code>var sql \"SELECT * FROM Condos WHERE choice LIKE @0\");\nvar sqlData = db.Query(sql,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p>Below one throws <code>Must declare scalar variable \"@choice\"</code></p>\n\n<pre><code>var sql \"SELECT * FROM Condos WHERE @choice LIKE @0\");\nvar sqlData = db.Query(sql,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p>Below one doesn't throw any error but doesn't bring any data</p>\n\n<pre><code>var sql = \"SELECT * FROM Condos WHERE '@choice' LIKE @0\";\nvar sqlData = db.Query(sql,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p>Below one doesn't throw any error but doesn't bring any data</p>\n\n<pre><code>var sql = \"SELECT * FROM Condos WHERE '@choice' LIKE @0\";\nvar sqlData = db.Query(sql,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p>Below one doesn't throw any error but doesn't bring any data</p>\n\n<pre><code>var sql = \"SELECT * FROM Condos WHERE '\"+choice+\"' LIKE @0\";\nvar sqlData = db.Query(sql,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p>Below one: BIG CRASH</p>\n\n<pre><code>var sql = \"SELECT * FROM Condos WHERE '\"+@choice+\"' LIKE @0\";\nvar sqlData = db.Query(sql,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p>Below one throws <code>Column name not valid = 'NameShort'</code></p>\n\n<p><strong>This is precisely the correct column name</strong></p>\n\n<pre><code>var sql = \"SELECT * FROM Condos WHERE ['\"+choice+\"'] LIKE @0\";\nvar sqlData = db.Query(sql,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p>Below one: BIG CRASH</p>\n\n<pre><code>var sql = \"SELECT * FROM Condos WHERE ['\"+@choice+\"'] LIKE @0\";\nvar sqlData = db.Query(sql,\"%\"+searchString+\"%\");\n</code></pre>\n\n<p><strong>HELP !!!!!!!!!!!!!!</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":43,"score":3,"question_id":12520515,"title":"Select unique random posting/recruitment places of employees within a list of places","body":"<p>I am trying to select unique random posting/recruitment places of employees within a list of places, all the employees are already posted at the places, i am trying to generate a new random posting place for them with \"where\" condition that \"employee new random location will not be equal to their home place\"\nEmployee table is :</p>\n\n<pre><code>EmpNo   Empname           CurrentPosting    Home        Designation RandomPosting\n1       Satish Kumar      Samastipur        Gazi        Manager     \n2       Anil Kumar Singh  Vaishali          Patna       Manager     \n3       Rajdev Prasad     Nawada            Gaya        PO      \n4       Rajesh Kumar      Sheikhpura        Muzaffarpur PO      \n5       Jitendra Kumar    Banka             Bhagalpur   Clerk       \n</code></pre>\n\n<p>And so on... </p>\n\n<p>And Places table is</p>\n\n<pre><code>PlaceID  PlaceName      Manager     PO    Clerk\n1        Araria            2        0     1\n2        Arwal             1        1     1\n3        Aurangabad        1        0     2\n4        Banka             2        1     1\n5        Begusarai         1        1     1\n6        Bhagalpur         1        1     2\n7        Bhojpur           0        2     0\n</code></pre>\n\n<p>and so on...</p>\n\n<p>i tried with rand() and newid() like as below, </p>\n\n<pre><code>select Employee.*, Place.PlaceName As RandomPosting  from Employee \ninner join Place on Place.PlaceID=Employee.EmpNo order by newid()\n</code></pre>\n\n<p>But unable to select what is required... that is to assign each Employee a PlaceName(from Place) randomly which is not equal to CurrentPosting and Home(in Employee).</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server-2008","ssas","business-intelligence","dimension"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12544323,"title":"ssas dimension processing key not found error","body":"<p>I have this strange case where I am trying to process a dimension, the data source is MSSQL\nand when I try to process this dimension I am getting this error</p>\n\n<blockquote>\n  <p>Errors in the OLAP storage engine: The attribute key cannot be found when processing: Table: 'application', Column: 'Full_Name', Value: 'Mr Peter McDonald'. The attribute is 'Applicant Full Name'.</p>\n</blockquote>\n\n<p>Since I <em>think</em> I know what the problem is, I have set the case sensitive property for this column and I tried processing again and it's giving me the same result.</p>\n\n<p>when I query for the column using like, I get two records</p>\n\n<blockquote>\n  <p>Peter McDonald </p>\n  \n  <p>Peter Mcdonald</p>\n</blockquote>\n\n<p>I would normally assume that setting the case sentivity would solve the problem, but it's not working in  this case, so I was wondering if anyone knows how to resolve this.</p>\n\n<p>Thanks a lot for the help in advance!</p>\n"},{"tags":["c#","sql-server-2008","asp.net-mvc-3-areas"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12543534,"title":"How to know current new object's ID in advance, before saving?","body":"<p>In my ASP.NET MVC3 application (C#, SQL Server) <code>Product</code> has <code>ImagePath</code> as string type. When I save the image, I want to give product's ID value to <code>ImagePath</code>. When I create new product, I don't know what will be the current product's <code>ID</code> before <code>db.SaveChanges();</code></p>\n\n<pre><code> public ActionResult Create( Product product )\n   { \n       .....\n       .....//How to know ID of this product in advance?\n       .....\n       db.Products.AddObject( product );\n       db.SaveChanges();\n   }\n</code></pre>\n\n<p>I can find last item of products and increase it: </p>\n\n<pre><code>currentID = lastID + 1;\n</code></pre>\n\n<p>But, maybe the last ID was deleted. Result will not correct..</p>\n"},{"tags":["sql","sql-server-2008","pivot","pivot-without-aggregate"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":173,"score":0,"question_id":12536470,"title":"SQL Server 2008 Pivot table aggregate function issue","body":"<p>I have this query and I am trying to group by surveyname but im getting this error: </p>\n\n<blockquote>\n  <p>Msg 8120, Level 16, State 1, Line 1<br>\n  Column 'pvt.Follow Up' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</p>\n</blockquote>\n\n<p>This is the query:</p>\n\n<pre><code>SELECT \n   surveyname, [Follow Up] AS Follow_Up, [Ambiance] AS Ambiance, \n   [Consultation] AS Consultation, [Procedure/Service] AS Procedure_Service\nFROM \n   (SELECT\n       s.name surveyname, q.question, subq.answer subquestion,aw.answerweight, \n       aw.score, rc.categoryname, sc.cweight\n    FROM survey.dbo.results r\n    JOIN survey.dbo.questions q ON r.questionidfk = q.id\n    LEFT JOIN survey.dbo.answers subq ON r.itemidfk = subq.id\n    LEFT JOIN survey.dbo.answers a ON r.answeridfk = a.id\n    JOIN survey.dbo.surveys s ON q.surveyidfk = s.id\n    join sigweb.dbo.survey_types_main stm on s.id = stm.surveyidfk\n    join survey.dbo.survey_results sr on r.owneridfk = sr.ownerid\n    join sigweb.dbo.BosleySurvey bs on bs.contactid = sr.contactid and stm.clientsurveytypeid = bs.surveytype\n    join sigweb.dbo.contact c on sr.contactid = c.contactid\n    join sigweb.dbo.patient p on p.contactid = c.contactid\n    join sigweb.dbo.doctor d on p.doctorid = d.doctorid\n    join sigweb.dbo.survey_tracking st on st.contactid = c.contactID and st.surveytypeid = stm.surveytypeid\n    left join survey.dbo.answerweighting aw on isnull(r.itemidfk, r.questionidfk) = aw.questionitemidfk and r.answeridfk = aw.answeridfk\n    left join survey.dbo.rating_categories rc on aw.categoryidfk = rc.id\n    left join survey.dbo.survey_categories sc on aw.categoryidfk = sc.categoryidfk and s.id = sc.surveyidfk\n    where \n       aw.answerWeight is not null) ps\nPIVOT\n(\n   AVG(score)\n   FOR categoryname IN\n    ( [Follow Up], [Ambiance], [Consultation], [Procedure/Service])\n) AS pvt\n</code></pre>\n\n<p>group by surveyname</p>\n\n<p>This is an example of the results im getting</p>\n\n<pre><code>SURVEYNAME      FOLLOW_UP   Ambiance   Consultation   Procedure_Service\nReview             NULL     NULL    NULL          9.81\nReview             9.54     NULL    NULL          NULL\nConsultation       5        NULL    NULL          NULL\nConsultation       NULL     5           NULL          NULL\nConsultation       NULL     5           NULL          NULL\nConsultation       NULL     5           NULL          NULL\nConsultation       NULL     5           NULL          NULL\nConsultation       NULL     5           NULL          NULL\nConsultation       NULL     NULL    5         NULL\nConsultation       5        NULL    NULL          NULL\nConsultation       NULL     NULL    5         NULL\n</code></pre>\n\n<p>This is an example of the data before the pivot:</p>\n\n<pre><code>Review          6   Follow Up\nReview          9   Procedure/Service\nConsultation    5   Ambiance\nConsultation    5   Ambiance\nConsultation    5   Ambiance\nConsultation    5   Ambiance\nConsultation    5   Ambiance\nConsultation    5   Ambiance\nConsultation    5   Consultation\nConsultation    5   Consultation\n</code></pre>\n\n<p>The idea is to group by the <code>surveyname</code> and have only two results in the end.</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":474,"score":0,"question_id":2178963,"title":"SQL Server 2008 Stored Procedure","body":"<p>I cannot store the date data type variables using stored procedure.  My code is:</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[Access1Register] \n -- Add the parameters for the stored procedure here\n @MobileNumber int, \n @CitizenName varchar(50),\n @Dob char(8),\n @VerificationCode int\nAS\nBEGIN\n -- SET NOCOUNT ON added to prevent extra result sets from\n -- interfering with SELECT statements.\n SET NOCOUNT ON;\n\n    -- Insert statements for procedure here\n    select CAST(@dob As DATE)\n Insert Into Access1 (MobileNo,CitizenName,Dob,VerificationCode)\n values(@MobileNumber,@CitizenName,@Dob,@VerificationCode)\ngo\n</code></pre>\n\n<p>If I exec this procedure it is executing, but there is an error occured in the date type variable.  It's raising the error as <code>invalid item '-'</code>.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":170,"score":0,"question_id":12541265,"title":"Using if-else in where clause in SQL Server 2008","body":"<p>I need to implement in the <code>where</code> clause. </p>\n\n<p>I tried in <code>case</code> statement but between cannot be used in <code>case</code> statement</p>\n\n<pre><code>where \n    if  start_mth &lt; end_mth\n        mth_no between start_mth and end_mth\n    else start_mth &gt; end_mth\n        mth_no between start_mth and 12\n                      or\n        mth_no between 1 and end_mth\n</code></pre>\n"},{"tags":["sql-server","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":99,"score":1,"question_id":12541485,"title":"I can't connect to my SQL Server database","body":"<p>I have a 2nd computer that I've installed Microsoft SQL Server 2008 Express on. I got it up and running with SQL Server Management Studio and created some tables and stuff.</p>\n\n<p>But I want to be able to connect to it from my other PC, the one I usually work on in my home. But when I try to make a connection I  get this error:</p>\n\n<p><img src=\"http://i.stack.imgur.com/jhffg.jpg\" alt=\"enter image description here\"></p>\n\n<p>Now, I've checked a couple of things:</p>\n\n<ul>\n<li>doing a <code>\\\\SERVER</code> in explorer from my computer works. So im guessing DNS is ok.</li>\n<li>I've tried to turn the firewall on the server off, connect and back on again with no luck.</li>\n<li>both SQL Server (<code>SQLEXPRESS</code>) and SQL Server Browser services are running (SQL Server Agent is not).</li>\n<li>TCP on port 1433 is turned on.</li>\n</ul>\n\n<p>Server name: <code>SERVER</code> is a result in the dropdown there.</p>\n"},{"tags":["sql","sql-server-2008","sql-date-functions"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":12542227,"title":"Using date functions in SQL Server 2008","body":"<p>I need results where if <code>end_dt</code> is less than the 15th of a month it should consider the previous month date</p>\n\n<p>e.g - if <code>end_dt</code> is <code>08-May-2011</code> than it should consider as <code>30-APR-2011</code></p>\n\n<p>I have used following code but is there any better way of doing it</p>\n\n<pre><code>select\n    id, \n    start_dt, \n    end_dt,\n    End_mth = \n        case\n            when end_dt&lt;=DATEADD(YY,(DATEPART(yy,end_dt))-1900,0) + DATEADD(MM,(DATEPART(MM,end_dt))-1,0)+ 15 then month(DATEADD (mm,-1,end_dt))\n            else month(isnull(end_dt,'31-Mar-2012'))\n        end\nfrom \n    sd_table\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12542617,"title":"How can I use the plus operation for a column in SQL Server with the result in the next row?","body":"<p>I have a table in SQL Server that I want to plus amount of a specific column and have the result <strong>in next row</strong>.</p>\n\n<p>How can I do that?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":79,"score":3,"question_id":12532423,"title":"MS SQL script to return a count of records created per day, when time is included in the DATE field?","body":"<p>I am trying to create a script (using MS SQL Server 2008 R2) that will give me a count of total rows added to a table, per day, during the last week.  I have used the following script to do this:</p>\n\n<pre><code>select date_published, count(customer_id)\nfrom CustomerTable\nWHERE date_published &gt;=dateadd(day,datediff(day,0,GetDate())- 7,0)\nGROUP BY date_published\n</code></pre>\n\n<p>This script works, but the problem I have is that the date_published column in my table needs to contain the time as well, so I need to figure out how to have the script only look at the date portion of the date_published column when it is calculating the totals.  Thanks for any help you can provide!</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12541355,"title":"how to use partition by and order by in over function","body":"<p>i have sql 2008 r2</p>\n\n<p>im trying to write a query showing the following:</p>\n\n<pre><code>select productname, unitprice,categoryid, sum(unitprice) \nover (partition by categoryid order by unitprice desc) As PriceSum\nfrom Products\n</code></pre>\n\n<p>i want the outcome to order products by their unit price, while partitioned the products by their categories. im getting this error: Incorrect syntax near 'order'.\nwhat am i doing wrong?</p>\n"},{"tags":["java","sql-server-2008","birt"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":12534527,"title":"Birt designer throws 'Connection is closed' error while previewing the report","body":"<p>I'm trying to design a report using <code>BIRT</code>. I used the all-in-one <code>eclipse designer 2.3.1</code> using <code>jdk1.6</code>. The database used is a <code>SQL Server 2008</code>. However, it gives me a connection closed error while trying to 'Preview Results' for data set and while previewing the report. The driver used is <code>sqljdbc4.jar</code>. Any help is appreciated.</p>\n\n<p><strong>Exception while previewing the dataset:</strong></p>\n\n<blockquote>\n  <p>A BIRT exception occurred.   Plug-in Provider:Eclipse.org   Plug-in\n  Name:BIRT Data Engine   Plug-in ID:org.eclipse.birt.data<br>\n  Version:2.3.1.v20080829   Error\n  Code:odaconsumer.CannotGetResultSetMetaData   Error Message:Cannot get\n  the result set metadata. SQL statement does not return a ResultSet\n  object. SQL error #1: The connection is closed.</p>\n</blockquote>\n\n<p><strong>Exception while previewing the report:</strong></p>\n\n<blockquote>\n  <p>exception.error ( 1 time(s) ) detail :\n  org.eclipse.birt.report.engine.api.EngineException: An exception\n  occurred during processing. Please see the following message for\n  details:Cannot get the result set metadata.SQL statement does not\n  return a ResultSet object.SQL error #1: The connection is closed. at\n  org.eclipse.birt.report.engine.executor.ExecutionContext.addException(ExecutionContext.java:1109)\n  at\n  org.eclipse.birt.report.engine.executor.ExecutionContext.addException(ExecutionContext.java:1073)\n  ....... Caused by:\n  <strong>org.eclipse.birt.report.data.oda.jdbc.JDBCException: SQL statement\n  does not return a ResultSet object.SQL error #1: The connection is\n  closed. ;    com.microsoft.sqlserver.jdbc.SQLServerException: The\n  connection is closed.</strong> at\n  org.eclipse.birt.report.data.oda.jdbc.Statement.executeQuery(Statement.java:445)\n  at\n  org.eclipse.birt.report.data.oda.jdbc.Statement.getMetaUsingDefaultPolicy(Statement.java:352)\n  at\n  org.eclipse.birt.report.data.oda.jdbc.Statement.getMetaData(Statement.java:294)\n  at\n  org.eclipse.datatools.connectivity.oda.consumer.helper.OdaQuery.doGetMetaData(OdaQuery.java:388)\n  at\n  org.eclipse.datatools.connectivity.oda.consumer.helper.OdaQuery.getMetaData(OdaQuery.java:356)\n  at\n  org.eclipse.birt.data.engine.odaconsumer.PreparedStatement.getRuntimeMetaData(PreparedStatement.java:365)\n  ... 74 more</p>\n  \n  <p><strong>Caused by: com.microsoft.sqlserver.jdbc.SQLServerException: The\n  connection is closed. at\n  com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDriverError(SQLServerException.java:190)</strong>\n  at\n  com.microsoft.sqlserver.jdbc.SQLServerConnection.checkClosed(SQLServerConnection.java:388)\n  at\n  com.microsoft.sqlserver.jdbc.SQLServerStatement.checkClosed(SQLServerStatement.java:978)\n  at\n  com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeQuery(SQLServerPreparedStatement.java:284)\n  at\n  org.eclipse.birt.report.data.oda.jdbc.Statement.executeQuery(Statement.java:441)\n  ... 79 more</p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12535764,"title":"Retrieve records above and below a specific record","body":"<p>I often verify logs in SQLServer and my query usually looks like this (where Type = 0 means error):</p>\n\n<pre><code>SELECT * \nFROM Logs \nWHERE Type = 0 \nORDER BY Timestamp\n</code></pre>\n\n<p>But most of the time, I'm not only interested by the error itself but also at what happened immediately before the error.</p>\n\n<p>Is it possible, with SQLServer, to query n lines above/under (relative to the primary key) each line matching the WHERE clause of the query?</p>\n\n<p>Ex. With my query I would only get lines 125 &amp; 130. I would like [123, 124, 125] and [128, 129, 130].</p>\n\n<pre><code>PrimaryKey  Timestamp             Type  Description\n123         2012-09-17 03:41:46.240 1   Working.\n124         2012-09-17 03:42:46.240 1   Database backup.\n125         2012-09-17 03:43:46.240 0   Access violation.\n126         2012-09-17 03:44:46.240 1   Working.\n127         2012-09-17 03:45:46.240 1   Working.\n128         2012-09-17 03:46:46.240 1   Working.\n129         2012-09-17 03:47:46.240 1   Backup.\n130         2012-09-17 03:48:46.240 0   Corrupted.\n131         2012-09-17 03:49:46.240 1   Working.\n</code></pre>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":1,"view_count":114,"score":3,"question_id":12537968,"title":"Order by only the numeric part of a string","body":"<p>I have a column called <code>Number</code> populated with this data (column is nchar):</p>\n\n<pre><code>1\n2\n1091\n3\n20\n2B\n</code></pre>\n\n<p>I want a select statement that give this order:</p>\n\n<pre><code>1\n2\n2B\n3\n20\n1091\n</code></pre>\n\n<p>How I can accomplish this? Thanks everybody for your help</p>\n\n<p>(EDITED)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12537531,"title":"SQL Server 2008 - need help merging 2 tables (cartesian)","body":"<p>I have 2 tables that are not related at all and I need to put them together - one column per table. When I try the cartesian join, I end up with every combination:</p>\n\n<pre><code>SELECT Field1, Field2 FROM Table1, Table2\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>Table1.Field1 Table2.Field2\n---------------------------\n1             1\n1             2\n1             3 \n2             1\n2             2\n2             3\n3             1\n3             2\n3             3\n</code></pre>\n\n<p>I need it to return side-by-side:</p>\n\n<pre><code>Table1.Field1 Table2.Field2\n---------------------------\n1             1\n2             2\n3             3 \n</code></pre>\n\n<p>is this possible? Thanks in advance</p>\n\n<p><em><strong>EDIT</em></strong></p>\n\n<pre><code>Table1.Table1IDs\n----------------\n1\n2\n3\n4\n5\n\nTable2.Table2IDs\n----------------\n6\n7\n8\n9\n10\n</code></pre>\n\n<p>Desired output (into a temp table/select statement)</p>\n\n<pre><code>Table1.Table1IDs    Table2.Table2IDs\n------------------------------------\n1                   6\n2                   7\n3                   8\n4                   9\n5                   10\n</code></pre>\n\n<p>So that I can then do my insert into the actual table I need to do an insert:</p>\n\n<pre><code>INSERT INTO dbo.MTMObjects\n    SELECT Table1IDs, Table2IDs \n    FROM [temp table or solution]\n</code></pre>\n\n<p><em><strong>ANSWER</em></strong>\nBluefeet gave me the idea to use temp tables with an identity column that i can then use to join.  His is 'safer' because you aren't relying on SQL's good humor to sort both recordsets the same, but this might help the next guy:</p>\n\n<pre><code>DECLARE @tmp_Table1 TABLE(ID int IDENTITY(1,1) NOT NULL, TableID1 int NOT NULL)\nDECLARE @tmp_Table2 TABLE(ID int IDENTITY(1,1) NOT NULL, TableID2 int NOT NULL)\n\nINSERT INTO @tmp_Table1 \n    OUTPUT INSERTED.Field1\nSELECT * FROM Table1\n\nINSERT INTO @tmp_Table2 \n    OUTPUT INSERTED.Field2\nSELECT * FROM Table2\n\nOUTPUT\nSELECT tmp1.Field1, tmp2.Field2 \nFROM @tmp_Table1 tmp1 INNER JOIN @tmp_Table2 tmp2 ON tmp2.ID = tmp1.ID\n</code></pre>\n\n<p>CHEERS!</p>\n"},{"tags":["sql","sql-server-2008","table","union"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":821,"score":2,"question_id":7669276,"title":"combine two tables in sql server 2008","body":"<p>hi i need to ask something is there any way combine two tables different count of columns like </p>\n\n<pre><code>Select a,b,c, from x\n\n union \n\nSelect d, e from y\n</code></pre>\n\n<p>THX</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":100,"score":2,"question_id":12536097,"title":"How to convert military hours to mm/dd/yyyy and time in SQL sever?","body":"<p>I have a simple data set shown in Table 1 below. I would like to produce two new columns (<code>START_SHIFT_DT_TIME</code> and <code>END_SHIFT_DT_TIME</code>) using the columns from Table 1. The desired output is shown in Table 2. </p>\n\n<p>The requirements are:</p>\n\n<ol>\n<li>If the <code>START_SHIFT</code> hours starts on or after 22:00:00 then the actual start date is the previous day.</li>\n<li>If the <code>START_SHIFT</code> hours starts before  22:00:00 then the actual start date is the following day.</li>\n</ol>\n\n<p>Could someone please take a look. Note, I am using SQL server. Thanks a lot!!!</p>\n\n<p><strong>Table 1</strong>:</p>\n\n<pre><code>START_SHIFT END_SHIFT       DATE    \n22:00:00    06:00:00        1/13/2012 12:00:00 AM\n07:00:00    15:00:00        1/13/2012 12:00:00 AM\n23:30:00    07:30:00        2/27/2012 12:00:00 AM\n00:00:00    08:00:00        2/17/2012 12:00:00 AM\n17:00:00    01:00:00        1/1/2012 12:00:00 AM\n</code></pre>\n\n<p><strong>Table 2</strong>:</p>\n\n<pre><code>START_SHIFT END_SHIFT     DATE                  START_SHIFT_DT_TIME     END_SHIFT_DT_TIME\n22:00:00    06:00:00      1/13/2012 12:00:00 AM  1/12/2012 10:00:00 PM  1/13/2012 6:00:00 AM\n07:00:00    15:00:00      1/13/2012 12:00:00 AM  1/13/2012 7:00:00 AM   1/13/2012 3:00:00 PM\n23:30:00    07:30:00      2/27/2012 12:00:00 AM  2/26/2012 11:30:00 PM  2/27/2012 7:30:00 AM\n00:00:00    08:00:00      2/17/2012 12:00:00 AM  2/17/2012 12:00:00 AM  2/17/2012 8:00:00 AM\n17:00:00    01:00:00      1/1/2012 12:00:00 AM   1/1/2012 5:00:00 PM    1/2/2012 1:00:00 AM\n</code></pre>\n"},{"tags":["c#","winforms","visual-studio-2010","sql-server-2008","crystal-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12535762,"title":"How to run Crystal Reports with SQL Database Application on Client Machine","body":"<p>I've a developed a <strong>desktop application</strong> with <strong>SQL Server DB</strong>. In d**evelopment machine, SQL Server was running with (local)<strong>. I need to add **Crystal Reports</strong> in my application which should be working on client. </p>\n\n<p>Here, question is <strong>what is needed to be on client machine to run successfully my application with database</strong>. Remember, <strong>on client side there is no SQL Server installed.</strong></p>\n\n<p>Help me in this regard.</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":67,"score":-1,"question_id":12535400,"title":"Writing a SQL query involving aggregate functions","body":"<p>I have created a the following view in my Database after combining multiple tables. A <code>select * from MYViEW</code> gives the following result below.</p>\n\n<pre><code>ProductID | TechID | ContactID | Priority | FIRSTNAME | MIDDLEINI | LASTNAME | \n1123         2406       1371        1        Pradeep       X          Nayak      \n1123         2406       1368        2        Hello         W          World      \n1123         2406       1363        3        Foo           Y          World    \n1299         2279       1208        2        Some          Z          Dude     \n</code></pre>\n\n<p>And I need the OUTPUT result to below to be displayed:</p>\n\n<pre><code>ProductID | TechID | ContactID | Priority | FIRSTNAME | MIDDLEINI | LASTNAME | Buyers                                        |\n1123         2406       1371        1        Pradeep    X           Nayak      Nayak, Pradeep X; World, Hello W; World, Foo Y  \n1299       2279         1208        2        Some       Z           Dude       Dude, Some Z\n</code></pre>\n\n<p>For every Product ID and Tech ID have a single record, and all the Buyers must be combined in a column in the format <code>LastName, FirstName MiddleIni</code> and each name separated by a space. I have already tried to use the custom aggregate function from <a href=\"http://msdn.microsoft.com/en-us/library/ms131056.aspx\" rel=\"nofollow\">here</a> for combing the results to a single column. Please let me know if you can help me with a query for this.</p>\n"},{"tags":["c#","asp.net","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12523611,"title":"What is more advisable for Ecommerce website when it comes to displaying specific product?","body":"<p><strong>To Query everytime on the Database and use 'WHERE' operator?</strong></p>\n\n<pre><code>SELECT * FROM tblProduct WHERE productID = @productID\n</code></pre>\n\n<p>OR </p>\n\n<p><strong>To Filter the Products List that are put into Cache?</strong></p>\n\n<pre><code>DataTable dtProducts = new DataTable();\ndtProducts = HttpContext.Current.Cache[\"CachedProductList\"] as DataTable;\n\nDataView dvProduct = new DataView();\ndvProduct = dtProducts.DefaultView;\ndvProduct.RowFilter = String.Format(\"[productID] = {0}\", iProductID);\n</code></pre>\n\n<p>Please share your opinion. Thanks in advance.</p>\n"},{"tags":["asp.net-mvc-3","sql-server-2008","entity-framework"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12529086,"title":"Entity Framework multiple parent tables","body":"<p>I have an existing database that I am trying to access via Entity Framework 4.3. Most tables and relationships haven't been a problem, but this set of tables is causing me a few issues which I can't seem to find an answer to.</p>\n\n<p>Here are the (condensed) entities:</p>\n\n<p><strong>Customer</strong></p>\n\n<pre><code>public class Customer\n{\n    public int CustomerID { get; set; }\n    public string Name { get; set; }\n\n    private int addressSourceTypeID = 2;\n    [NotMapped]\n    public int AddressSourceTypeID { \n        get { return addressSourceTypeID; } \n        set { addressSourceTypeID = value; } }\n\n    public virtual ICollection&lt;User&gt; Users { get; set; }\n    public virtual ICollection&lt;Contract&gt; Contracts { get; set; }\n    public virtual ICollection&lt;Address&gt; Addresses { get; set; }\n}\n</code></pre>\n\n<p><strong>Contract</strong></p>\n\n<pre><code>public class Contract\n{\n    public int ContractID { get; set; }\n    public string Name { get; set; }\n\n    private int addressSourceTypeID = 4;\n    [NotMapped]\n    public int AddressSourceTypeID { \n        get { return addressSourceTypeID; } \n        set { addressSourceTypeID = value; } }\n\n    public virtual int CustomerID { get; set; }\n    public virtual Customer Customer { get; set; }\n\n    //public virtual ICollection&lt;Address&gt; Addresses { get; set; }\n}\n</code></pre>\n\n<p><strong>Address</strong></p>\n\n<pre><code>public class Address\n{\n    [Key]\n    public int AddressID { get; set; }\n    public int AddressSourceTypeID { get; set; }\n\n    [ForeignKey(\"Customer\")]\n    public int SourceKey { get; set; }\n\n    public virtual Customer Customer { get; set; }\n    //public virtual Contract Contract { get; set; }\n    public virtual ICollection&lt;Contact&gt; Contacts { get; set; }\n}\n</code></pre>\n\n<p>What I have above is two entities <code>Customer</code> and <code>Contract</code> that both can have child <code>Address</code> entities. Currently the <code>Address</code> entity is set up to be a child of the <code>Customer</code> entity and this works fine as there isn't a link to <code>Contract</code> from <code>Address</code>.</p>\n\n<p>I have tried adding in <code>Contract</code> to the <code>Address</code> entity as I have done with the <code>Customer</code> entity as you can see from the commented out code segments. Unfortunatly this doesn't work, but I'm not surprised due to the reference to <code>Customer</code> in the <code>Address</code> ForeignKey annotation. I even tried to create specific version of the <code>Address</code> entity (i.e. <code>CustomerAddress</code>), but I get an error when more than one entity is attempting to bind to the same table.</p>\n\n<p>I have also tried using <code>ModelBuilder</code> in the EF <code>DBContext</code> however my knowledge here is pretty limited and I'm not sure how to do it in this case.</p>\n\n<p>Overall, what I need is the following:</p>\n\n<ul>\n<li>Customer entity to have a collection of child Addresses.</li>\n<li>Contract entity to have a collection of child Addresses.</li>\n</ul>\n\n<p>The link between these 'parent' tables to the Address table uses the following:</p>\n\n<ul>\n<li>Customer: CustomerID => Address: SourceKey AND Customer: AddressSourceTypeID (always 2) => Address: AddressSourceTypeID.</li>\n<li>Contract: ContractID => Address: SourceKey AND Contract: AddressSourceTypeID (always 4) => Address: AddressSourceTypeID.</li>\n</ul>\n\n<p>If anyone could help me or point me in the correct direction that would be great.</p>\n\n<p>Thanks very much.</p>\n"},{"tags":["sql-server-2008","tsql","parameters","filter","null"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":79,"score":0,"question_id":12533003,"title":"Handling T-SQL Query with null filters as parameters","body":"<p>Suppose I have a stored procedure where I'm passing in 5 filters as parameters.  These parameters are filters to each column in my query.  My query has 5 fields.  What is the best way to prevent my query from throwing an exception/error if I have 1 or more NULL (or '') valued parameters for my filters?</p>\n\n<pre><code>    SELECT \n        [helpings_turkey],\n        [helpings_green_beans],\n        [scoops_squash],\n        [qty_buscuits],\n        [pieces_pie]\n    FROM\n        [thanksgiving_guest]\n    WHERE \n        [helpings_turkey] &gt; @helpings_turkey_filter\n        AND [helpings_green_beans] &gt; @helpings_green_beans_filter\n        AND [scoops_squash] &gt; @scoops_squash_filter\n        AND [qty_buscuits] &gt; @qty_buscuits_filter\n        AND [pieces_pie] &gt; @pieces_pie_filter\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql","datetime"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12509664,"title":"Return only the current and past months of the year","body":"<p>Below is my code that will return all the months in a year.</p>\n\n<pre><code>SELECT TOP 12\nDATENAME(MONTH, DATEADD(MONTH,ROW_NUMBER() OVER (ORDER BY object_id) - 1,0))\nFROM sys.columns\n</code></pre>\n\n<p>What change must I make to only return the months that have passed and the current month?</p>\n"},{"tags":["c#",".net","sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":91,"score":2,"question_id":12531262,"title":"Notification from the db instead of polling. Is it possible?","body":"<p>Hy guys,</p>\n\n<p>to monitor a specified table on db I'm polling this one every few milliseconds (10-20 ms).</p>\n\n<p>Is there any chance to have a notification (avoiding SqlDependency, that in my scenario is too slow) instead polling?</p>\n\n<p>Do you have any idea?</p>\n\n<p>My scenario is .net + Sql Server 2008</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":177,"score":2,"question_id":8576866,"title":"Accidently deleted all data in the 'master' database","body":"<p>I've used this script by accident on the 'master' database instead of a temp database.</p>\n\n<pre><code>sp_msforeachtable 'delete from ?'\n</code></pre>\n\n<p>Has it caused any harm? If so, how can I restore the data?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":12531699,"title":"Update a table in one server when a new job is added to any other server","body":"<p>I have a bunch of servers and one server that keeps the inventory of all these servers.</p>\n\n<p>I want to create a stored procedure which will automaticaly update a table called <code>Job Information</code> in my inventory server, whenever a new job is added to any of the other servers.</p>\n\n<p>The <code>Job Information</code> table has the columns:</p>\n\n<pre><code>Server Name, Job Name, Date Created , Date Modified\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12530974,"title":"SQL Server DB size - why is it so large?","body":"<p>I am building a database which contains about 30 tables:</p>\n\n<ul>\n<li>The largest amount of columns in a table is about 15. </li>\n<li>For datatypes I am mostly using VarChar(50) for text</li>\n<li>and Int og SmallInt for numbers. </li>\n<li>Identity columns is Uniqueidentifiers</li>\n</ul>\n\n<p>I have been testing a bit filling in data and deleting\nagain. I have no deleted all data, so everey table is empty.\nBut, if I look inside the properties of the database in \nManagement Studio, the size says 221,38 MB!</p>\n\n<p>How comes that? Please help, I am getting notifications\nfrom my hosting company that I am exceeding my limits .</p>\n\n<p>Best regards,\n:-)</p>\n"},{"tags":["sql-server-2008","ms-access"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12531526,"title":"Ms Access SQL query for total time calculation","body":"<p>I'm using MS Access database with following query:</p>\n\n<pre><code>SELECT \nSub.EmpID,sub.firstname + sub.lastname as Name,\n (24*Int(Sum(sub.end_time - sub.start_time)) + \n  Format(Sum(sub.end_time - sub.start_time),'h')) \n &amp; Format(Sum(sub.end_time - sub.start_time),':nn:ss') AS duration,\n (24*Int(Sum(sub1.outend_time - sub1.outstart_time))+ \n  Format(Sum(sub1.outend_time - sub1.outstart_time),'h')) &amp;\n  Format(Sum(sub1.outend_time - sub1.outstart_time),':nn:ss') AS outduration\nFROM\n(\n    SELECT\n        o.SNo,\n        o.InTime AS end_time,\n        o.EmpID,\n        o.Type,\n        o.InDate,\n        (\n            SELECT TOP 1 i.InTime\n            FROM EmpLog AS i\n            WHERE\n                i.Type = 'IN'\n                AND i.EmpID = o.EmpID\n                AND i.InTime &lt; o.InTime\n               and i.InDate=o.InDate\n            ORDER BY i.InDate, i.InTime DESC\n        ) AS start_time,e.firstname,e.lastname\n    FROM EmpLog AS o,emp as e \n     WHERE o.Type='OUT'\n       and e.emp_ID=o.EmpID \n       and o.InDate &gt;=#9/3/2012# and o.InDate&lt;=#9/3/2012#\n   ) \n  AS sub,\n (select\n  ot.InTime as outend_time,\n   (\n     SELECT TOP 1 it.InTime\n    FROM EmpLog AS it WHERE it.Type = 'OUT' AND it.EmpID = ot.EmpID\n    AND it.InTime &lt; ot.InTime and it.InDate=ot.InDate \n     ORDER BY it.InDate, it.InTime DESC\n        ) \n     AS outstart_time\n      From EmpLog as  ot, emp as ep where ot.Type='IN' and ep.emp_ID=ot.EmpID \n      and ot.InDate&gt;=#9/3/2012# and ot.InDate&lt;=#9/3/2012#   and\n      Format(ot.InTime - (SELECT TOP 1 it.InTime\n            FROM EmpLog AS it\n            WHERE\n                    it.Type = 'OUT'\n                AND it.EmpID = ot.EmpID\n                AND it.InTime &lt; ot.InTime and it.InDate=ot.InDate\n            ORDER BY it.InDate, it.InTime DESC), 'hh:nn:ss')&lt;=\"00:10:00\"\n            ) as sub1 \n           group by sub.EmpID,sub.lastname,sub.firstname \n           order by sub.firstname asc;\n</code></pre>\n\n<p>The expected output is,</p>\n\n<pre><code>EmpID   Name   Duration    outduration\n----------------------------------------\n25      xyz    4:08:39     0:17:56\n</code></pre>\n\n<p>But the above query returns me</p>\n\n<pre><code>EmpID  Name  Duration   outduration\n----------------------------------------\n25     xyz   20:43:15   0:17:56\n</code></pre>\n\n<p>If I execute sub and sub2 as separate queries. It gives correct answer. But if I group them into 1 the inner query that is sub.duration is wrong. Can any 1 suggest me where is the problem?</p>\n"},{"tags":["sql-server-2008","xsd"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12527183,"title":"method to read data from a xsd and load it into a sql server table","body":"<p>I need to load one of my tables in SQL server database with some data from a xsd provided.</p>\n\n<p>I have my XSD, with a block as below</p>\n\n<pre><code>&lt;xsd:simpleType name=\"States\"&gt;\n&lt;xsd:restriction base=\"xsd:string\"&gt;\n&lt;xsd:enumeration value=\"state1\"/&gt;\n&lt;xsd:enumeration value=\"state2\"/&gt;\n&lt;xsd:enumeration value=\"state3\"/&gt;\n&lt;/xsd:restriction&gt;\n&lt;/xsd:simpleType&gt;\n</code></pre>\n\n<p>In my table - States, I have 2 columns StateId,StateName.</p>\n\n<p>I have to load the data such as state1,state2,..etc into the StateName column of the table.</p>\n\n<p>Can somebody suggest which method should I use to get this done.</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2","driver","time-series"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":9995633,"title":"Low-level time series driver for SQL Server 2008?","body":"<p>Oracle has OTS (Oracle Time Series) oriented tables. This produces lightning-fast queries for data that is naturally ordered by time, e.g. QOS telemetry data.</p>\n\n<p>I've heard of a company that has produced an equivalent plugin for SQL Server 2008 that replaces the low-level database driver with its own, high-performance time-series version. Does anybody know the name?</p>\n"},{"tags":["sql-server-2008","datetime","sql-convert"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12529814,"title":"SQL Server 2008 - CONVERT vs DATE & DATETIME Columns","body":"<p>I store an amendment date field in a lot of my tables. Sometimes I need to use the time portion for my logic and sometimes I just need the date portion. I'm wondering which of the following scenarios is more efficient/best practice:</p>\n\n<ol>\n<li><p>Storing two columns - one of type DATE and one of type DATETIME - which both represent the same instance in time but in which the DATE column obviously only stores the date portion. When I need to do a comparison on date only I use the DATE column and when I need to do a comparison which includes the time I use the DATETIME column.</p></li>\n<li><p>Storing one column of type DATETIME and using CONVERT(DATE, Date_Amended_Col) to retrieve the date portion whenever I need it.</p></li>\n</ol>\n\n<p>Is there a significant overhead using the CONVERT every time? I think the DATE portion is likely to be the one accessed more often so I feel like I would be using CONVERT a lot. </p>\n\n<p>I can't think of any obvious downsides to the second method apart from the fact that both fields need to be updated rather than just one when an amendment is made and I can always use a trigger for that if I feel the need to.</p>\n\n<p>Or is there a better way? Would using a computed column be the same as using the CONVERT every time?</p>\n\n<p>Any thoughts would be appreciated.</p>\n\n<p>Many thanks,</p>\n\n<p>Al</p>\n"},{"tags":["visual-studio-2010","sql-server-2008","firewall","portforwarding","windows-firewall"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12529287,"title":"Adding a connection to a SQL Server 2008, what do I need to open up?","body":"<p>I'm trying to add a Data Connection in Visual Studio 2010 to a SQL Server 2008 database at a given IP (thru internet). What ports do I need to open up and forward to make the magic happen?</p>\n\n<p>Any settings in the SQL Server I need to set to allow external connections?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":53,"score":3,"question_id":12527993,"title":"Are table-scan results held in memory negating the benefit of indexes?","body":"<p>Theoretical SQL Server 2008 question:  </p>\n\n<p>If a table-scan is performed on SQL Server with a significant amount of 'free' memory, will the results of that table scan be held in memory, thereby negating the efficiencies that may be introduced by an index on the table?</p>\n\n<p>Update 1: The tables in question contain reference data with approx. 100 - 200 records per table (I do not know the average size of each row), so we are not talking about massive tables here. </p>\n\n<p>I have spoken to the client about introducing a memcached / AppFabric Cache solution for this reference data, however that is out of scope at the moment and they are looking for a 'quick win' that is minimal risk.</p>\n"},{"tags":["sql","sql-server","linq","sql-server-2008","linq-to-sql"],"answer_count":1,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":77,"score":3,"question_id":12520248,"title":"SQL RANDOM ORDER BY ON JOINED TABLE","body":"<p>I have 2 tables: <code>Persons(idPerson INT)</code>  and <code>Questions(idQuestion INT)</code>.</p>\n\n<p>I want to insert the data into a 3rd table: <code>OrderedQuestions(idPerson INT, idQuestion INT, questionRank INT)</code></p>\n\n<p>I want to assign all the questions to all the persons but in a random order.</p>\n\n<p>I thought of doing a CROSS JOIN but then, I get the same order of questions for every persons.</p>\n\n<pre><code>INSERT INTO OrderedQuestions\n    SELECT idPerson, idQuestion, questionRank FROM Persons \n    CROSS JOIN\n    (SELECT idQuestion,ROW_NUMBER() OVER (ORDER BY NEWID()) as questionRank\n    FROM Questions) as t\n</code></pre>\n\n<p>How can I achieve such a random, distinct ordering for every persons?</p>\n\n<p>Obviously, I want the solution to be as fast as possible.\n(It can be done using TSQL or Linq to SQL)</p>\n\n<hr>\n\n<p>Desired results for 3 persons and 5 questions:</p>\n\n<pre><code>   idPerson         idQuestion         questionRank\n1.  1                18                  1\n2.  1                14                  2\n3.  1                25                  3\n4.  1                31                  4\n5.  1                2                   5\n6.  2                2                   1\n7.  2                25                  2\n8.  2                31                  3\n9.  2                18                  4\n10. 2                14                  5\n11. 3                31                  1\n12. 3                18                  2\n13. 3                14                  3\n14. 3                25                  4\n15. 3                2                   5\n</code></pre>\n\n<p>I just edited the results (Since the IDs are autogenerated, they can't be used to order the questions).</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":57,"score":1,"question_id":12526222,"title":"how to get results with zero values","body":"<p>my query is </p>\n\n<pre><code>select m.year_id,Count(*) as Distinctions from NewTestDB.dbo.[Master_MARKS2005] as m\njoin NewTestDB.dbo.Master_Student as s\non s.Student_id=m.Student_Id\njoin NewTestDB.dbo.Master_School as sc\non sc.school_id=s.school_code\nwhere sc.SCHOOL_CODE= 'an0001' and m.YEAR_ID between 1 and 8 and m.[NRC_CLASS]='D'\ngroup by m.year_id,\n</code></pre>\n\n<p>i want out of all year_id's between 1 to 8 but now i am getting only when m.[NRC_CLASS]='D'\nhow to rewrite this query so that i can get count as '0' when no rows in the m.NRC_CLASS column contains 'D' value</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":33,"score":-2,"question_id":12524091,"title":"how to filter partial data in one column","body":"<p>i hope you guys can help me with my query.  Im using  my sql database 2008.\nI have to get the partial data from one column which contains so many data. This goes like this. \nin finaldiagcode column with so many codes like this (AO9, E86.1 E10.1), i need to get data that matches to E10.1</p>\n\n<p>I have tried to use [] in my query but it does not work.</p>\n\n<p>thank you and hope you can help me.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":12525707,"title":"I want Date Like 21-Sep-12 in Sql","body":"<p>I have searched but i havent get the format like 21-Sep-12 date format in sql.I get every other format but i didnt get this type of Format.so,How can i get the format like this in Date?</p>\n"},{"tags":["sql-server-2008","recursion","add","aggregate","common-table-expression"],"answer_count":1,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":93,"score":4,"question_id":12511746,"title":"CTE in SQL Server 2008: how to calculate subtotals recursively","body":"<p>I've got a table where some parts of a car are related hierarchically and I also have the cost of manufacturing those parts in each one of the rows. This is a simplification of the table:</p>\n\n<pre><code>parentId  Id description qty manufacturingCost costDescripcion\n-------- --- ----------- --- ----------------- ---------------\nNULL      1  Car          1  100               Assembly the car\nNULL      2  Motorcycle   1  100               Assembly the motrocycle\n 1       11  Wheel        4   20               Assembly the wheel\n11      111  Rim          1   50               Manufacture the rim\n11      112  Tire         1   60               Manufacture the tire\n 1       12  Door+Window  4   30               Assembly the door and the window\n12      121  Door         1   30               Manufacture the door\n12      122  Window       2   10               Manufacture the window\n 2       11  Wheel        2   15               Assembly the wheel\n</code></pre>\n\n<p>I need to get the whole family tree starting in 'Car' and showing the total quantities and the total costs for each branch. Better explained: a car has 4 wheels and each wheel has 1 rim and 1 tire, so I should get 1 Car, 4 Wheels, 4 Tires, 4 Rims. A little bit more complicated for the costs: Assembling a car costs 100$, but I have to add to this cost, the one of assembling the 4 wheels (4x20) and the cost of manufacturing the 4 rims (4x50) and the 4 tires (4x60), and the same for the doors and windows.</p>\n\n<p>This is the expected result:</p>\n\n<pre><code>parentId  Id description qty manufacturingCost   recLevel\n-------- --- ----------- --- -----------------   ---------------\nNULL       1  Car          1 940 (100+4*130+4*80) 0\n 1        11  Wheel        4 130 (20+50+60)       1\n 1        12  Door+Window  4 80  (30+30+2*10)     1\n12       121  Door         4 30                   2\n12       122  Window       8 10                   2\n11       111  Rim          4 50                   2\n11       112  Tire         4 60                   2\n</code></pre>\n\n<p>I can easily reach this one using a recursive Function or Stored Procedure but it is very slow with more complex structures, so I am trying to do it using Common Table Expressions. But I didn´t find the way to sum the costs. I use a recursive CTE starting in the top level and going down and I get the sum of the quantities, but I should go from inside to outside in the structure to sum the costs, how can I do that?</p>\n\n<p>This is the code to create the table:</p>\n\n<pre><code>CREATE TABLE #Costs \n(\n  parentId int, \n  Id int, \n  description varchar(50),\n  qty int, \n  manufacturingCost int,\n  costDescripcion varchar(150)\n)\n\nINSERT INTO #Costs VALUES (NULL , 1, 'Car', 1, 100, 'Assembly the car')\nINSERT INTO #Costs VALUES (NULL , 2, 'Motorcycle', 1, 100, 'Assembly the motrocycle')\nINSERT INTO #Costs VALUES (1 , 11, 'Wheel', 4, 20, 'Assembly the wheel')\nINSERT INTO #Costs VALUES (11 , 111, 'Rim', 1, 50, 'Manufacture the rim')\nINSERT INTO #Costs VALUES (11 , 112, 'Tire', 1, 60, 'Manufacture the tire')\nINSERT INTO #Costs VALUES (1 , 12, 'Door+Window', 4, 30, 'Assembly the door and the window')\nINSERT INTO #Costs VALUES (12 , 121, 'Door', 1, 30, 'Manufacture the door')\nINSERT INTO #Costs VALUES (12 , 122, 'Window', 2, 10, 'Manufacture the window')\nINSERT INTO #Costs VALUES (2 , 11, 'Wheel', 2, 15, 'Assembly the wheel')\n</code></pre>\n\n<p>And this is the CTE I wrote:</p>\n\n<pre><code>with CTE(parentId, id, description, totalQty, manufacturingCost, recLevel)\nas\n(\n  select c.parentId, c.id, c.description, c.qty, c.manufacturingCost, 0\n  from #Costs c\n  where c.id = 1\n\n  union all\n\n  select c.parentId, c.id, c.description, c.qty * ct.totalQty, c.manufacturingCost, ct.recLevel + 1\n  from #Costs c\n  inner join CTE ct on ct.id = c.parentId \n)\nselect * from CTE\n</code></pre>\n\n<p>And this is the result I get that, as you can see, is not the expected one (the costs are not being added):</p>\n\n<pre><code>parentId  Id description qty manufacturingCost recLevel\n-------- --- ----------- --- ----------------- ---------------\nNULL       1  Car          1 100                0\n 1        11  Wheel        4 20                 1\n 1        12  Door+Window  4 30                 1\n12       121  Door         4 30                 2\n12       122  Window       8 10                 2\n11       111  Rim          4 50                 2\n11       112  Tire         4 60                 2\n</code></pre>\n\n<p>Is it possible to do what I want using CTE? If so, how can I do it?</p>\n\n<p>Thank you very much,</p>\n\n<p>Antuan</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2008r2-express"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":7317,"score":2,"question_id":6123113,"title":"how to import an excel file into sqlserver 2008","body":"<p>How can i import an excel file into a new table in sqlserver2008 express edition using an sql query without using the import wizard</p>\n\n<p>Thanks\nPrady</p>\n"},{"tags":["sql-server-2008","scope","ssrs-2008","iif"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12428531,"title":"IIF Expression with Scope","body":"<p>I am using <code>SSRS 2008 R2</code> with <code>SQL 2008</code>. I have a report that lists dates that a client uses a service. I have grouped on the client name and the detail section is the dates. I am trying to check if a date for a specific client is duplicated(Has been entered twice). To do that I am using an IIF statement. </p>\n\n<pre><code>=IIF(Fields!SvcDate.Value,\"table1_ClientName\"=Previous(Fields!SvcDate.Value,\"table1_ClientName\", \"Khaki\", \"White\")) \n</code></pre>\n\n<p>If I run this expression without the scope in it, it colors the field correctly, but of course the \"previous\" part of this means that if another client directly above has the same date, this expression thinks that is the \"previous\" date and I get a background color. So I need to make sure that the colors and the \"previous\" criteria are limited to each individual client. The expression above gives an error that says that there is no False part to the statement. So I'm thinking that I have the parentheses wrong somehow, but I can't figure out how to correct it.</p>\n"},{"tags":["xml","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":980,"score":7,"question_id":3026748,"title":"Difference between SQL 2005 and SQL 2008 for inserting multiple rows with XML","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3978807/why-insert-select-to-variable-table-from-xml-variable-so-slow\">Why insert-select to variable table from XML variable so slow?</a>  </p>\n</blockquote>\n\n\n\n<p>I am using the following SQL code for inserting multiple rows of data in a table. The data is passed to the stored procedure using an XML variable :</p>\n\n<pre><code>INSERT INTO MyTable\n   SELECT SampleTime = T.Item.value('SampleTime[1]', 'datetime'),\n          Volume1 = T.Item.value('Volume1[1]', 'float'),\n          Volume2 = T.Item.value('Volume2[1]', 'float')\n   FROM @xml.nodes('//Root/MyRecord') T(item)\n</code></pre>\n\n<p>I have a whole bunch of unit tests to verify that I am inserting the right information, the right number of records, etc.. when I call the stored procedure. </p>\n\n<p>All fine and dandy - that is, until we began to monkey around with the compatibility level of the database.</p>\n\n<p>The code above worked beautifully as long as we kept the compatibility level of the DB at 90 (SQL 2005).\nWhen we set the compatibility level at 100 (SQL 2008), the unit tests failed, because the stored procedure using the code above times out.</p>\n\n<p>The unit tests are dropping the database, re-creating it from scripts, and running the tests on the brand new DB, so it's not - I think - a question of the 'old compatibility level' sticking around.</p>\n\n<p>Using the SQL Management studio, I made up a quick test SQL script. Using the same XML chunk, I alter the DB compat level , truncate the table, then use the code above to insert 650 rows. When the level is 90 (SQL 2005), it runs in milliseconds. When the level is 100 (SQL 2008) it sometimes takes over a minute, sometimes runs in milliseconds.</p>\n\n<p>I'd appreciate any insight anyone might have into that.</p>\n\n<hr>\n\n<h2>EDIT</h2>\n\n<p>The script takes over a minute to run with my actual data, which has more rows than I show here, is a real table, and has an index.\nWith the following example code, the difference goes between milliseconds and around 5 seconds.</p>\n\n<pre><code>--use [master]\n--ALTER DATABASE MyDB SET compatibility_level =100\n\nuse [MyDB]\n\ndeclare @xml xml\n\nset @xml = '&lt;?xml version=\"1.0\"?&gt;\n&lt;Root xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"&gt;\n  &lt;Record&gt;\n    &lt;SampleTime&gt;2009-01-24T00:00:00&lt;/SampleTime&gt;\n    &lt;Volume1&gt;0&lt;/Volume1&gt;\n    &lt;Volume2&gt;0&lt;/Volume2&gt;\n  &lt;/Record&gt;\n..... 653 records, sample time spaced out 4 hours ........\n&lt;/Root&gt;'\n\nDECLARE @myTable TABLE(\nID int IDENTITY(1,1) NOT NULL,\n    [SampleTime] [datetime] NOT NULL,\n    [Volume1] [float] NULL,\n    [Volume2] [float] NULL)\n\nINSERT INTO @myTable\n    select \n        T.Item.value('SampleTime[1]', 'datetime') as SampleTime,\n            Volume1 = T.Item.value('Volume1[1]', 'float'),\n            Volume2 = T.Item.value('Volume2[1]', 'float')\n    FROM @xml.nodes('//Root/Record') T(item)\n</code></pre>\n\n<p>I uncomment the 2 lines at the top, select them and run just that (the ALTER DATABASE statement), then comment the 2 lines, deselect any text and run the whole thing.</p>\n\n<p>When I change from 90 to 100, it runs all the time in 5 seconds (I change the level once, but I run the series several times to see if I have consistent results).\nWhen I change from 100 to 90, it runs in milliseconds all the time.\nJust so you can play with it too.\nI am using SQL Server 2008 R2 standard edition.</p>\n"},{"tags":["performance","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":30,"score":-5,"question_id":12524077,"title":"Can anyone suggest a good website for learning SQL Query Performance tuning","body":"<p>Please suggest a good site to learn sql query performance tuning and query hints , for me to start learning..</p>\n"},{"tags":["sql","performance","sql-server-2008","sql-order-by"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12521902,"title":"Can this ORDER BY on a CASE clause be made faster?","body":"<p>I'm selecting results from a table of ~350 million records, and it's running extremely slowly - around 10 minutes.  The culprit seems to be the <strong>ORDER BY</strong>, as if I remove it the query only takes a moment.  Here's the gist:</p>\n\n<pre><code>SELECT TOP 100\n    (columns snipped)\nFROM (\n    SELECT \n        CASE WHEN (e2.ID IS NULL) THEN\n            CAST(0 AS BIT) ELSE CAST(1 AS BIT) END AS RecordExists,\n        (columns snipped)\n    FROM dbo.Files AS e1\n    LEFT OUTER JOIN dbo.Records AS e2 ON e1.FID = e2.FID\n)  AS p1\nORDER BY p1.RecordExists\n</code></pre>\n\n<p>Basically, I'm ordering the results by whether <em>Files</em> have a corresponding <em>Record</em>, as those without need to be handled first.  I could run two queries with <strong>WHERE</strong> clauses, but I'd rather do it in a single query if possible.</p>\n\n<p>Is there any way to speed this up?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2012"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":183,"score":4,"question_id":12491404,"title":"SQL 2008 VS 2012","body":"<p>My friend sent me the commands that he wrote in server 2008 and they worked with no problems, mine however from a copy and past did not work with 2012. Is there any reason why? Here is the code:</p>\n\n<pre><code>        Use Kudler_Database\n        SELECT  AccountNumber, [Description], ShortDescription,Balance\n        FROM Chart_of_Accounts \n        ORDER BY left (AccountNumber, 2)\n        COMPUTE SUM(Balance) BY left (AccountNumber, 2)\n        COMPUTE SUM(Balance); \n</code></pre>\n\n<p>Here is the error :</p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Line 6 Incorrect syntax near the keyword\n  'COMPUTE'.</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2008"],"answer_count":8,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":154,"score":3,"question_id":12489522,"title":"How to get all the Week End date of Current Year in sql?","body":"<p>I have tried not getting Exact Sql Querry.I want sql Query that List all the week-End date of current year in sql.</p>\n\n<p>I tried this SQL Querry</p>\n\n<pre><code>WITH hier(num, lvl) AS (\n    SELECT  0, 1\n            UNION ALL\n    SELECT  100, 1\n            UNION ALL \n    SELECT  num + 1, lvl + 1\n    FROM    hier\n    WHERE   lvl &lt; 100 \n)\nSELECT lvl [Week], \nconvert(date,DATEADD(dw, -DATEPART(dw, DATEADD(wk,DATEDIFF(wk,0,'12/31/'+convert(nvarchar,YEAR(getdate()))), 0)+6 ),\nDATEADD(wk, DATEDIFF(wk,0,'12/31/'+convert(nvarchar,YEAR(getdate()))), 0)+6 ) - num  * 7,101) [End Date]\nFROM    hier a\nwhere   num &lt; 52\nORDER BY [End Date] asc\n\nSo the Output is like this ...\nWeek  End date\n52  2012-01-14\n51  2012-01-21\n50  2012-01-28\n49  2012-02-04\n</code></pre>\n\n<p>I want date from start so there is still one week there in 2012 and its End date is 2012-07-01 so its not there and also i want to display Week 1,2,3...instead of first Listing 52,51...</p>\n"},{"tags":["sql","sql-server-2008","metadata"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":609,"score":0,"question_id":4630856,"title":"SQL Query to get the table names which use a particular column as a foreign key","body":"<p>What sql query would you write to get the table names which have a particular foreign key.</p>\n\n<pre><code>Eg. Person_Table(person_id,name,address,...)\n    Purchases_Table(purchaseid, purchased_by_id(fkey)....)\n    AccountDetails_Table(AccountId,PersonID,....)\n    Roles_Table(PersonId,RoleID)\n</code></pre>\n\n<p>Now i want to find the table names where Person id is used as a foreign key.\nThe above schema would return me </p>\n\n<pre><code>Purchases_Table,AccountDetails_Table, Roles_Table\n</code></pre>\n\n<p><strong>Database: SQL Server</strong></p>\n"},{"tags":["asp.net-mvc-3","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12522168,"title":"Complex db Queries in MVC","body":"<p>I am trying to do an oddball type of query to a database that I cannot seem to figure out how to do.</p>\n\n<p>I made a sample database, shown below, just for this question, as I cannot display the real database because of its proprietary nature.</p>\n\n<p><a href=\"http://i.stack.imgur.com/DGDaQ.png\" rel=\"nofollow\">http://i.stack.imgur.com/DGDaQ.png</a></p>\n\n<p>My goal is to be able to add an order and order items on the same page, while displaying a list of the products as shown below.</p>\n\n<p><a href=\"http://i.stack.imgur.com/QLMrB.jpg\" rel=\"nofollow\">http://i.stack.imgur.com/QLMrB.jpg</a></p>\n\n<p>Not every order will contain all of the products, but I still need to be able to list all of the products and have the ability to enter a quantity if there is one.  How would I go about laying this out using MVC?  Currently, I am using a ViewModel inside the Create View for the Orders to display the ProductName list. I cannot seem to figure out how to get boxes that would allow me to add in the OrderItems information for each product name.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12521447,"title":"SQL QUERY - distinct rows edit","body":"<p>I m working on a SQL query </p>\n\n<p>Below is the output :</p>\n\n<pre><code>PT_NO          PT_AGE         PT_SEX      DISEASE_CODE    PT_BILL_AMOUNT\n--------     --------       --------     -----------     --------------   \n1               50            M               52.01X         100.00\n1               50            M               52.01X         100.00\n1               50            M               52.01X         100.00\n2               40            F               74.01          300.00\n2               40            F               74.01          300.00\n2               40            F               74.01          300.00\n</code></pre>\n\n<p>Below are the table structure:</p>\n\n<pre><code>PATIENT(pt_no,pt_age,pt_sex,pt_bill_amount)\nPATIENT_DISEASE(pt_no,disease_code)\n\n\nSELECT \n  pt_no,pt_age,pt_sex\n  ,patient_disease.disease_code\n  ,patient.pt_bill_amount\nfrom patient \"patient\"\n    inner join patient_disease \"patient_disease\" \n    on patient.pt_no = patient_disease.pt_no\n</code></pre>\n\n<p>Somehow I m looking for a way to not repeat the Bill amount (100 and 300 only once) , so that when i sum on the above view created , I get the correct the bill amount as </p>\n\n<pre><code>PT_NO          PT_AGE         PT_SEX      DISEASE_CODE    PT_BILL_AMOUNT\n--------     --------       --------     -----------     --------------   \n1               50            M               52.01X         100.00\n1               50            M               52.01X         0.00\n1               50            M               52.01X         0.00\n2               40            F               74.01          300.00\n2               40            F               74.01          0.0\n2               40            F               74.01          0.0\n</code></pre>\n\n<p>Any input on the same would be helpful !!!</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["sql-server-2008","ms-access"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12521601,"title":"sql server import wizard doesnot copy keys","body":"<p>I want to import/copy Microsoft Access Database in SQL Server. This what I have tried.</p>\n\n<pre><code>Created a database using SQL Server Management Studio.\nThen right click on this new database and tasks -&gt; import wizard.\non first screen selected the type as Access and selected the file .mdb\nThen selected SQL Server as destination database.\nand selected the tables which I want to copy.\nI also checked the identity enable to true.\n\n\nThe problem is it copied all the table but the keys are not copied....\n</code></pre>\n\n<p>Can any one please help. I am using sql server 2008.</p>\n\n<p>thanks. </p>\n"},{"tags":["sql-server-2008","powershell"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":90,"score":0,"question_id":12521239,"title":"Powershell does not recognize invoke-sqlcmd","body":"<p>I am unable to use invoke-sqlcmd in powershell. I've loaded the module written by Chad Miller as described here: <a href=\"http://stackoverflow.com/questions/4820591/problems-using-sql-server-2008-r2-powershell-extensions-outside-of-sqlps\">Problems using SQL Server 2008 R2 PowerShell extensions outside of SQLPS</a></p>\n\n<p>The module loads just fine without error, and using get-module shows sqlps as expected. However, using get-pssnapin does not show either SqlServerCmdletSnapin100 or SqlServerProviderSnapin100</p>\n\n<p>When I type invoke-sqlcmd I get the error \"The term 'invoke-sqlcmd' is not recognized as the name of a cmdlet, function, script file, or operable program...\"</p>\n\n<p>Running Windows 7 Pro, have SQL Server Management Studio Express 2008R2, have installed SQL Server 2008R2 Management Objects.</p>\n\n<p>Thanks for any help\nJon</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":101,"score":1,"question_id":12514121,"title":"SQL Server 2008 Replace Unicode Characters","body":"<p>I just completed a project where I aggregated data from 34 un-normalized data sources into one normalized SQL Server 2008 database.</p>\n\n<p>The only problem is...the larger text fields from those data sources have lost some fidelity and are now displaying Unicode control characters throughout (a lot of them).</p>\n\n<p>This is the code I used to import the data from one of the tab-delimited *.txt files:</p>\n\n<pre><code>BULK INSERT MyTabeNameHere\n        FROM 'C:\\FILE\\PATH\\HERE\\FileNameHere.txt'       \n        WITH\n        (\n            FIELDTERMINATOR = '\\t',\n            ROWTERMINATOR = '\\n',\n            FIRSTROW = 2\n        )\n</code></pre>\n\n<p>Example data might be:</p>\n\n<pre><code>Lorem ipsum ò dolor sit amet\nááá Lorem ipsum dolor sit amet\nLorem ipsum dolor sit amet\nLorem ipsumû dolor sit amet\nLorem ipsum dolor sit aÆmet\n</code></pre>\n\n<p>I'd like to run that data through a SQL function and output this...</p>\n\n<p>The desired output would be:</p>\n\n<pre><code>Lorem ipsum dolor sit amet\nLorem ipsum dolor sit amet\nLorem ipsum dolor sit amet    \nLorem ipsum dolor sit amet\nLorem ipsum dolor sit amet\n</code></pre>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server-2008"],"answer_count":6,"favorite_count":9,"up_vote_count":58,"down_vote_count":0,"view_count":170201,"score":58,"question_id":360141,"title":"How to connect to local instance of SQL Server 2008 Express","body":"<p>I just installed SQL Server 2008 Express on my Vista SP1 machine. I previously had 2005 on here and used it just fine with the old SQL Server Management Studio Express. I was able to connect with no problems to my PC-NAME\\SQLEXPRESS instance (no, PC-NAME is not my computer name ;-).</p>\n\n<p>I uninstalled 2005 and SQL Server Management Studio Express. I then installed SQL Server 2008 Express on my machine and elected to have it install SQL Server Management Studio Basic.</p>\n\n<p>Now, when I try to connect to PC-NAME\\SQLEXPRESS (with Windows Authentication, like I always did), I get the following message:</p>\n\n<p><em>Cannot connect to PC-NAME\\SQLEXPRESS.\nA network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified) (Microsoft SQL Server, Error: -1)\nFor help, click: <a href=\"http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;EvtSrc=MSSQLServer&amp;EvtID=-1&amp;LinkId=20476\">http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;EvtSrc=MSSQLServer&amp;EvtID=-1&amp;LinkId=20476</a></em></p>\n\n<p>When I installed SQL Server 2008, I had it use SQLEXPRESS as the local instance name. As far as I can tell, through SQL Server Configuration Manager, SQL Server is configured to allow remote connections.</p>\n\n<p>When I went to the help link it mentions, the help page suggests the following:</p>\n\n<ul>\n<li>Make sure that the SQL Server Browser service is started on the server.</li>\n<li>Use the SQL Server Surface Area Configuration tool to enable SQL Server to accept remote connections. For more information about the SQL Server Surface Area Configuration Tool, see Surface Area Configuration for Services and Connections.</li>\n</ul>\n\n<p>Well, as far as I can tell, there is no SQL Server Browser service on my system (looked in MMC for one, couldn't find one).</p>\n\n<p>And the SQL Server Surface Area Configuration tool doesn't exist in SQL Server 2008. So good job there with your help documentation, Microsoft ;-).</p>\n\n<p>I'm at a loss for what to do right now. I had a lot of work I was hoping to get done today after upgrading to 2008 (the person I'm working with got it up and running with no problem and told me it would be easy - he's also far better with database stuff that I am). Does anyone have any idea what might be wrong? I'd really appreciate it. If I can't get this working in a few hours, I'm going back to SQL Server 2005 (if that will even work, gah...).</p>\n\n<p>Edit: I have tried turning Windows Firewall off, and that did not help. Also, I noticed that I do not have a \"Data\" directory under my SQL Server 2008 install directory tree - could I have possibly set something up wrong when I installed it?</p>\n"},{"tags":["c#","asp.net-mvc-3","sql-server-2008","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":122,"score":0,"question_id":12519160,"title":"MVC Entity Framework get one column as an array","body":"<p>my application is asp.net MVC3 using Entity Framework.  I am trying to get a list of one column from a table as an array using the following:</p>\n\n<pre><code>   public ActionResult Index()\n        {\n            //var list = db.CasesProgresses.ToList();\n            var SeriesList = GetSeriesList(Learner_ID);\n            return View();\n        }\n\n\n\n        public List&lt;string&gt; GetSeriesList(string item)\n        {\n            // get DataTable dt from somewhere.\n            List&lt;string&gt; sList = new List&lt;string&gt;();\n            foreach (CasesProgress row in db.CasesProgresses)\n            {\n                sList.Add(row[0].ToString());\n            }\n            return sList;  \n        }\n</code></pre>\n\n<p>I get two errors:</p>\n\n<pre><code>Cannot apply indexing with [] to an expression of type 'caseprog.Models.CasesProgress' and\nThe name 'Learner_ID' does not exist in the current context\n</code></pre>\n\n<p>Would appreciate your suggestions.</p>\n"},{"tags":["sql","sql-server-2008","join","dynamically-generated"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12519038,"title":"Join 2 queries with equal fields created dynamically","body":"<p>I have a table that i wanted to create some charts.\nBasically i need to know how many registers i have in interval of 10 minutes and how many of them are already pos-processed. With this 2 queries i have the info i need, but i need they 2 in just 1 result table.</p>\n\n<p>First query</p>\n\n<pre><code>SELECT  \n    (\n        CAST(DATEPART(HOUR, m.Ocr_DataHora) AS NVARCHAR) +\n        ':' +\n        CAST((DATEPART(MINUTE, m.Ocr_DataHora) % 6) AS NVARCHAR) +\n        '0'         \n    )                                       AS Hora,\n    COUNT(*)                                AS Movimentações\nFROM\n    Integracao m\nWHERE\n        m.Ocr_DataHora      &gt;=  '2012-09-17 00:00:00.000'\n    AND m.Ocr_DataHora      &lt;   '2012-09-18 00:00:00.000'\nGROUP BY        \n    DATEPART(HOUR, m.Ocr_DataHora),\n    (DATEPART(MINUTE, m.Ocr_DataHora) % 6)\nORDER BY    \n    DATEPART(HOUR, m.Ocr_DataHora),\n    (DATEPART(MINUTE, m.Ocr_DataHora) % 6)\n</code></pre>\n\n<p>Second query</p>\n\n<pre><code>SELECT  \n    (\n        CAST(DATEPART(HOUR, s.Ocr_DataHora) AS NVARCHAR) +\n        ':' +\n        CAST((DATEPART(MINUTE, s.Ocr_DataHora) % 6) AS NVARCHAR) +\n        '0'         \n    )                                       AS Hora,\n    COUNT(*)                                AS Sucesso\nFROM\n    Integracao s\nWHERE\n        s.Veiculo_Modelo    &lt;&gt;  ''\n    AND s.Ocr_DataHora      &gt;=  '2012-09-17 00:00:00.000'\n    AND s.Ocr_DataHora      &lt;   '2012-09-18 00:00:00.000'\nGROUP BY        \n    DATEPART(HOUR, s.Ocr_DataHora),\n    (DATEPART(MINUTE, s.Ocr_DataHora) % 6)\n</code></pre>\n\n<p>How can i join them if my common field is generated dynamically?</p>\n"},{"tags":[".net","entity-framework","sql-server-2008","ef-code-first"],"answer_count":3,"favorite_count":4,"up_vote_count":14,"down_vote_count":0,"view_count":6580,"score":14,"question_id":4653095,"title":"How to store images using Entity Framework Code First CTP 5?","body":"<p>I'm just trying to figure out if there is a simple way to store and retrieve binary (file) data using EF Code First CTP 5? I would really like it to use the FILESTREAM type, but I'm really just looking for some way to make it work.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12518686,"title":"Dynamic SQL statement (unicode encoding needed?)","body":"<p>I have the following dynamic SQL code with 4 columns inserted as parameters as well as the table name.  </p>\n\n<pre><code>set @SQL = 'select EVENTID, RATE,' + @LossColumn + ',' + @ExpColumn + ',' + @StdDevIndep + ',' + @StdDevCorr + ', '''','''', '''','''' \nfrom Catastrophe.dbo.' + @CatTableName \ninsert into AnalyticsV2.dbo.ResultCSVCat\nexecute sp_executesql @SQL\n</code></pre>\n\n<p>I'm not sure if this is correct or whether it needs unicode encoding because of the parameters (N before the 'select statement)?  It works fine if I specify all the columns and table name because then there are no parameters.  I'm not quite sure how to change it around if it does need unicode because I haven't worked with that very much in Microsoft SQL.</p>\n\n<p>Any help will be appreciated!</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":12518294,"title":"SQL Server query to pull a combination values from the table","body":"<p>I have a table T as below. </p>\n\n<p>I would like to pick a client who has their status <code>Processed, InProgress</code> combination.  </p>\n\n<p>Please could you help, how can I do it?  </p>\n\n<p><strong>Table</strong>  </p>\n\n<pre><code>ClientId    ClientName  Status\n1           A           Processed\n1           A           Processed\n2           b           InProgress\n2           b           Processed\n3           c           Processed\n3           c           Processed\n4           d           InProgress\n4           d           Processed\n5           e           InProgress\n5           e           Processed  \n</code></pre>\n\n<p><strong>Result should be</strong>  </p>\n\n<pre><code>ClientId    ClientName  Status\n2           b           InProgress\n2           b           Processed\n4           d           InProgress\n4           d           Processed\n5           e           InProgress\n5           e           Processed  \n</code></pre>\n\n<p>Thank you in advance</p>\n"},{"tags":["sql","sql-server-2008","rollback"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":75,"score":2,"question_id":12516331,"title":"How to rollback without transaction","body":"<p>I made a huge mistake, I executed this query:</p>\n\n<pre><code>update Contact set ContaPassword = '7FD736A3070CB9766'\n</code></pre>\n\n<p>I forgot the <code>WHERE</code> clause, so this way it updated the password for all users. :(</p>\n\n<p>Is there a way I can recover the data before this query?</p>\n"},{"tags":["sql-server","sql-server-2008","primary-key","alter-table"],"answer_count":4,"favorite_count":12,"up_vote_count":34,"down_vote_count":0,"view_count":46391,"score":34,"question_id":4862385,"title":"Sql Server add auto increment primary key to existing table","body":"<p>As the title, I have an existing table which is already populated with 150000 records. I have added an Id column (which is currently null).</p>\n\n<p>I'm assuming I can run a query to fill this column with incremental numbers, and then set as primary key and turn on auto increment. Is this the correct way to procede? And if so, how do I fill the initial numbers?</p>\n"},{"tags":["sql-server","sql-server-2008","replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12511177,"title":"sql replication using remote server","body":"<p>PI'm trying to do replicate two data bases.</p>\n\n<ol>\n<li>DB in LAN network (Publisher)</li>\n<li>DB in virtual dedicated network (Subscriber)</li>\n</ol>\n\n<p>According to my situation, replicate publisher implemented in my server in LAN network.But subscriber is implementing on a virtual dedicated server. i configured router port to my server machine in LAN network.using sql management studio on virtual server, i connected to the db in LAN network.But when i try to create subscriber using virtual server db i can't access to the publisher.(IN LAN network.) it gives errors as below.</p>\n\n<p>\"SQL Server replication requires the actual server name to make a connection to the server. Connections through a server alias, IP address, or any other alternate name are not supported. Specify the actual server name, 'BESTLIFE\\BESTLIFECROWN'. (Replication.Utilities)\"</p>\n\n<p>Please help me to solve this .</p>\n"},{"tags":["sql","sql-server-2008","ms-access"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":3,"view_count":60,"score":0,"question_id":12514265,"title":"SQL how to know the datatype for a column","body":"<p>I'm using MS Access and MS Sql 2008, I need get the DataType for a specific column in a single table.</p>\n\n<p>Could you please post a sample of code?</p>\n"},{"tags":["sql-server-2008","vbscript"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12517276,"title":"Query in insert statement?","body":"<p>I have the following VB statement for inserting text data to a SQL 2008 DB. How can I check if sValueList already exists in sFieldNameList column while doing the insert?</p>\n\n<pre><code>sInsertStatement = \"INSERT \" &amp; sTableName \n                   &amp; \"(\" &amp; sFieldNameList &amp; \") VALUES(\" \n                   &amp; Mid(sValueList , 3) &amp; \")\"\n</code></pre>\n"},{"tags":["sql","sql-server-2008","sql-management-studio"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":8360,"score":4,"question_id":881900,"title":"SQL Server 2008 - Go From Select to Edit Quickly","body":"<p>In server management studio 2008 you can right mouse click on a table and then hit the select the first 1000 rows.  Is there a button or a quick way to edit one of the returned rows instead of having to right mouse click on the table again and click edit first 200 rows.</p>\n"},{"tags":["sql-server","sql-server-2008","hierarchyid"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12516743,"title":"HierarchyID - Get all children of a list of nodes","body":"<p>Two tables:</p>\n\n<pre><code>Team\n----\nTeamID    int\nTeamNode  hierarchyid\n\nTeamUser\n--------\nTeamID    int\nUserID    int\n</code></pre>\n\n<p>And I have a query to get the immediate teams a user belongs to:</p>\n\n<pre><code>SELECT * \nFROM \nTeam INNER JOIN TeamUser\nON Team.TeamID = TeamUser.TeamID\nWHERE\nTeamUser.UserID = 123\n</code></pre>\n\n<p>Next I want to find all child nodes of the nodes from the result set of above query. I know I can use <code>IsDescendantOf()</code> to get all children of one node, but not sure how to use that to get all children of a list of nodes.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12516471,"title":"Show multiple values on same row (group_concat)","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/451415/simulating-group-concat-mysql-function-in-ms-sql-server-2005\">Simulating group_concat MySQL function in MS SQL Server 2005?</a>  </p>\n</blockquote>\n\n\n\n<p>This is my query </p>\n\n<pre><code>select distinct Industry_Group_Rank.NAIC_Group_No, \n  Industry_Group_Rank.Group_Rank,Industry_Group_Rank.SUB_TOI_CODE \nfrom Industry_Group_Rank with(nolock)\nwhere Industry_Group_Rank.StateCode = 'MI' and \nIndustry_Group_Rank.NAIC_Group_No in ('1','2') \nGroup by Industry_Group_Rank.NAIC_Group_No, Industry_Group_Rank.Group_Rank,\n  Industry_Group_Rank.SUB_TOI_CODE\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>GroupNo | Group Rank | SUBTOICode \n111     |  1         |  A \n111     |  2         |  A\n111     |  2         |  B\n111     |  4         |  C\n111     |  4         |  D\n</code></pre>\n\n<p>I want the result set be</p>\n\n<pre><code>GroupNo | Group Rank | SUBTOICode \n111     |  1         |  A \n111     |  2         |  A,B\n111     |  4         |  C,D\n</code></pre>\n\n<p>Can any one help me using the correct syntax please.</p>\n"},{"tags":["sql-server","sql-server-2008","alert","sql-server-agent"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":2398,"score":2,"question_id":7431582,"title":"SQL Server Agent Job Notify multiple operators on failure","body":"<p>I have a Job setup in SQL Server 2008 which sends a notification email to <b>one</b> operator when the job fails.  </p>\n\n<p><b>Question: Is it possible to setup a notification email being sent to multiple operators for that specific job?</b>  </p>\n\n<p>I believe a possible workaround for this is to create lots of alerts for the database for each given severity but I was hoping that there was a more concise way to do this. If I were to go this route, what severity errors would likely be triggered from a failed job? (I don't think I would require all 25 for something like that)  </p>\n\n<p>Can this be done through sql command to add more operators to notify on failure? Through the UI you are only able to choose a single operator it seems.</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12499924,"title":"query in sql server for retrieving rows","body":"<p>I have a table that contains the following 4 columns:</p>\n\n<ul>\n<li>id</li>\n<li>name</li>\n<li>lastname</li>\n<li>phone</li>\n</ul>\n\n<p>I want to write a stored procedure that gets an <code>id</code> as parameter, and then gets the name of that <code>id</code> and then use that <code>name</code> to get all the rows that their name is equal to the names that i found in last step!\nhere it is my query, i know it's wrong but i'm new to sql commands:</p>\n\n<pre><code>ALTER PROCEDURE dbo.GetAllNames\n@id int\nAS\n    select name as Name from Users where id = @id\n    -- i don't how to retrieve the names that are equal to Name\nselect * from Users where name = Name \n</code></pre>\n\n<p>can you correct my query and help me? Thanks.</p>\n"}]}
