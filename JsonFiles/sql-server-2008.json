{"count":21041,"tag":"sql-server-2008","questions":[{"tags":["visual-studio-2010","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":6,"score":0,"question_id":13281434,"title":"SQL Management Studio Server Name only Hostname","body":"<ol>\n<li>What is the problem of my SQL Management Studio 2008 when there are no other items appears in the Server Name selection box? The item only available to select is the Host name: e.g. (JED-PC)</li>\n</ol>\n\n<p>It supposed to show server as name like the image below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/803XT.jpg\" alt=\"enter image description here\"></p>\n\n<p>I installed the sqlexpress2008. When I try to to re-intall the sql express it only suggest to install sqlserver instance. </p>\n\n<p>I need this to solve this so that I can connect the connection string of my VS project setup to the sqlexpress instance.</p>\n\n<p>There is no problem when I login the servername. I can attach a database to it. But I can't connect because the instance needed in connection string is for sqlexpress. </p>\n\n<p>How can I fix this? When i run the application the computer it says cannot access network instance, error - 26.</p>\n"},{"tags":["visual-studio","sql-server-2008","visual-studio-2012","sql-server-2012","downgrade"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13280859,"title":"Cannot open database.mdf after opening in Visual Studio 2012","body":"<p>Ive been working on some stuff with Visual Studio 2008, and SQL 2008 aswell..\nThen i opened the project on another computer with 2012 version.</p>\n\n<p>And now when im trying to work with the files in 2008 again, i cant open my database.mdf, becouse the 2012 sql has upgraded my database file...</p>\n\n<p>Anything i can do to save it?\n(Btw. the data aint that important, but more the whole table setup and relations)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","hierarchical-data"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13280265,"title":"Flattening a SQL hierarchical data structure in SQL without cursors","body":"<p>Let's say I have the following table</p>\n\n<pre><code>SectionID ParentIDSection DatumID\n   1           NULL         1\n   2            1           2\n   3            1           3\n   4            2           4\n</code></pre>\n\n<p>Now, let's  pretend I want to select all DatumIDs under SectionID = 1, even if it is part of its descendants children so that I would get</p>\n\n<pre><code>SectionID DatumID\n  1         1\n  1         2\n  1         3\n  1         4\n</code></pre>\n\n<p>Is it possible to this without explicitly iterating over the first table recursively with a cursor?</p>\n"},{"tags":["php","sql-server","sql-server-2008","doctrine2","freetds"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13280717,"title":"SELECT problems with Doctrine and MS SQL 2008","body":"<p>We have written an application using Doctrine2, which works great when used with a MySQL or Postgres database.</p>\n\n<p>We now connected the application with a SQL Server 2008 database using <a href=\"http://de3.php.net/manual/en/ref.pdo-dblib.php\" rel=\"nofollow\">PDO Driver DBLib</a> which uses the <code>FreeTDS</code> implementation for the Tabular DataStream protocol, which is shared by SQL Server and Sybase.</p>\n\n<p>The initial schema creation, transactions and <code>INSERT</code>s into the tables work fine .. after some tweaking of the Doctrine <code>SQLServerPlatform</code> and our MSSQL Driver package. </p>\n\n<p>But when selecting data, we face the following error:</p>\n\n<pre><code>General error: 20019 Attempt to initiate a new Adaptive Server operation with results pending\n</code></pre>\n\n<p>After plenty of googling I found <a href=\"http://www.freetds.org/faq.html#pending\" rel=\"nofollow\">this detail in the FAQ of FreeTDS</a>:</p>\n\n<blockquote>\n  <p>If you are accustomed to programming with other database servers, you may be surprised when you first encounter this aspect of the TDS protocol.  [...]<br><br>The server requires the client either to read all the results from a query, or to indicate that no further rows are desired i.e., to issue a cancellation. Until one of those two things happens, the server will not accept new queries on that connection. It will complain about \"pending results\".</p>\n</blockquote>\n\n<p>So the cause for the error message is that for some reason, Doctrine (DBAL->PDO->FreeTDS) did not read all the result rows from the connection buffer, and the server / library doesn't allow the application to issue a new <code>exec()</code>/<code>execute()</code> until all rows are read.</p>\n\n<ul>\n<li>Is my understanding right that <code>$doctrinequery-&gt;getResults()</code> fetches all results before it returns?</li>\n<li>Is my understanding right that <code>$entity-&gt;getLinkedEntity()</code> (i.e. <code>$user-&gt;getGroupNames()</code>) fetches all results before it returns?</li>\n<li>How would you tackle down where exactly the problem is? <br>The stacktraces are not helping me and the codebase is already grown.</li>\n<li>Did anybody else already have this problem and can share some insights?</li>\n<li>Is there an alternative we can use to connect Doctrine to MSSQL which does not suffer this problem?</li>\n</ul>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13279770,"title":"Silently corrupted table after power-related shutdowns, records missing, scrambled?","body":"<p>Have a ssvr 2008 db, about 10gb.  About 50 tables, 5 or so are frequent read/write, the rest are weekly write (append only), occasional read.</p>\n\n<p>The server came up and down a couple times over the past week due to Sandy (gracefully, from what I can tell, it's on a UPS).  Today, it was noticed a lot of records in a single table (one of the weekly write ones) were missing (everything from september forward to the first write after the last power issue).  The newest records added after the last restart are fine.  The surviving records before september are mostly correct, except the data in two columns (nvarchar(50) and nvarchar(100)) has been uniformly replaced with dates (YYYY-MM-DD) and bytes (ranging from 0 to 192).  The dates and bytes don't have any particular relation I can see to the data that should be there or the other columns in that table.</p>\n\n<p>I'm fetching backups for before and after each outage so I should be able to recover, but I'm a bit disturbed - how'd this happen without any events in the log or CHECKDB errors?  What could cause this?</p>\n"},{"tags":["sql-server","sql-server-2008","case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13278148,"title":"case statement to select multiple rows at once","body":"<p>I am looking to pull the same columns from two different tables, based on a conditional argument.</p>\n\n<p>So i have stumbled upon the CASE statement which I have not used much before. I have found this will work for me in this mannor, but I would like it if I could do one CASE statement and then select the columns i need, rather then doing it per column.</p>\n\n<p>Here is an example of what I have and working, just seems a little redundant.</p>\n\n<pre><code>SELECT TOP(10)\n    u1.userid as userid,\n    version = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN 3\n        ELSE 4\n    END,\n    nameOrg = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN CONVERT(NVARCHAR, u1.title)\n        ELSE CONVERT(NVARCHAR, u2.title)\n    END,\n    nameContact = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN CONVERT(NVARCHAR, u1.contact)\n        ELSE CONVERT(NVARCHAR, u2.contact)\n    END,\n    pltName = CASE\n        WHEN (u2.userid IS NULL OR u1.enabled = 0)\n        THEN p1.name\n        ELSE p2.name\n    END\nFROM\n    usr1 u1\nLEFT OUTER JOIN\n    usr2 u2\n    ON u1.userid = u2.userid\nLEFT OUTER JOIN\n    plt2 p2\n    ON u2.pltid = p2.pltid\nLEFT OUTER JOIN\n    plt1 p1\n    ON u1.pltid = p1.pltid\n</code></pre>\n\n<p>Any advise?</p>\n\n<ul>\n<li>Edit mov 7, 5:22: added join to plt table and pltName case, to add to required functionality.</li>\n</ul>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":11,"score":-1,"question_id":13273869,"title":"Update sql column by adding two fields together","body":"<p>I have a table with several columns.  I need to add data from one column(money) to another column(money) and then update then table row by row. </p>\n\n<p>I have tried select this creates a tempory column but no data gets saved into database</p>\n\n<p>I have tried insert but I need the new total to update into the field that is calculating</p>\n\n<p>I think my solution is an update but so far this is not working for me.</p>\n\n<p>Before update;</p>\n\n<pre><code>ID  ColumnNameCurrent   ColumnNameYTD\nA               20.20                       89.60 \nb               55.00                       147.38\nc               60.98                       258.46\nd               38.43                     7,894.32\n</code></pre>\n\n<p>After Update (what I hope for)</p>\n\n<pre><code>ID  ColumnNameCurrent   ColumnNameYTD\nA    20.20                    109.80 \nb    55.00                    202.38 \nc    60.98                    319.44 \nd    38.43                   7,932.75 \n</code></pre>\n\n<p>What I think the code should be;</p>\n\n<pre><code>UPDATE TableName\nSET ColumnNameYTD = ColoumNameYTD + ColumnNameCurrent\n</code></pre>\n\n<p>Can you please explain to me what I can change in the above to get the desired results.</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13278669,"title":"Creating Images from SQL Server BLOBs is painfully slow","body":"<p>Has anyone had any issues when converting a BLOB (jpg) from SQL Server 2008 to a file on your file system?  It's taking upward of 5-8 seconds for the blob to be retrieved then file created</p>\n\n<p>ultimately I'm gonna store the filepaths and do quick lookups like that but for the initial hit per jpeg, it takes a long time to create the file and I have to assume there's a way to make it faster or I'm just doing it wrong or in an inefficient way in C#.  I can paste my code but wondering if there's a quick answer for this as it may be a common issue and wanted to know what to check possibly.</p>\n\n<p>If this were a high traffic website it would crash my server.  I assume BLOBs are not the way to go and maybe I should just create a routine to go through that entire SQL Table and create the files on the file system and dump all of them and never go back to SQL Server for each initial creation before I index the filepaths upon creation.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13278147,"title":"Iterate through sql script using different values","body":"<p>Here is part of my script:</p>\n\n<pre><code>DECLARE @dataId int = 123               \n\n-- Here I run more SQL scripts using @dataId\n\nSelect from table A where id = @dataId \n\n-- So on it goes in other tables and delete and update other tables\n</code></pre>\n\n<p>My question is there a way I can enter 100 values in <code>@dataId</code> and it will iterate through the script in an order? Is there a simpler way to do this in SQL Server 2008 rather then manually entering <code>@dataId</code> each time?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":13,"score":0,"question_id":13277056,"title":"How to check SQL Server Performance Tuning for Stored Procedures","body":"<p>I'm creating a stored procedures for an application that will generate some business logic in <a href=\"/questions/tagged/sql-server\" class=\"post-tag\" title=\"show questions tagged 'sql-server'\" rel=\"tag\">sql-server</a>.  How can I check performance of stored procedures like speed,accuracy etc. \nAny ideas or direction will be much appreciated</p>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8,"score":0,"question_id":13276923,"title":"local report server not showing Content and Property tab","body":"<p>I have a serious issue with my report server. </p>\n\n<p>I cannot see the Content,Properties at the Home Page. And if I click on a report, I cannot see the View, Properties, History and Subscriptions tabs.</p>\n\n<p>Below is what I see on the Home page.</p>\n\n<p>Tuesday, November 06, 2012 5:25 PM         Data Sources</p>\n\n<p>Tuesday, November 06, 2012 5:25 PM         Reports\nDoes someone know how I can get the tabs back?</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13275431,"title":"Finding the total amount for my query","body":"<p>I have a query that allows me to retrieve customer orders.</p>\n\n<pre><code>Select ID, OrderID, Item, Price from customerOrders\nWhere Order = 1\n</code></pre>\n\n<p>is there a way of totalling up the final amount to pay and have it visible below, but still be able to view all details needed in the sql query, for example</p>\n\n<pre><code>ID    |  OrderID |  Item  | Price\n1     |   1      |  Book  | 9.99\n2     |   1      |  DVD   | 12.99\n\n                    total = 22.98\n</code></pre>\n\n<p>Many thanks in advance</p>\n"},{"tags":["sql","sql-server-2008","database-design","denormalization"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":55,"score":-1,"question_id":13255736,"title":"Does table size have an effect on a denormalized database?","body":"<p>I am designing a duplicate of an existing database, and moving all the old data to it for reporting purposes. I have to denormalize the tables to improve the reporting performance, so I am trying to figure out which tables to join.</p>\n\n<p>I have examined the table relationships and have made a list of parent/child tables respectively, but I have also found that some of the tables have around 30 columns each. </p>\n\n<p>Will this have a negative effect on the performance if I join these tables in a denormalized database?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13267949,"title":"Update field in Source table with Identity after insert target with merge statement","body":"<p>I have a table Items which should have a corresponding record in the table LanguageText. The ID (Identity) of LanguageText is registered in the Items.LanguageTextId field in my Items table.</p>\n\n<p>What I want to accomplish is a merge between LanguageText and Items for all records with null in Items.LanguageTextId and insert the itemname / text of these Item records in LanguageText plus update the LanguageTextId with the ID value from the newly inserted LanguageText record (SCOPE_IDENTITY()?)</p>\n\n<p>The insert works fine:</p>\n\n<pre><code>MERGE [dbo].[LanguageText] AS target\nUSING (SELECT [Items].* from [dbo].Items ) AS source \nON (TARGET.Id = SOURCE.LanguageTextId) \nWHEN NOT MATCHED By Target THEN \n    INSERT   \n       ([Text])\n VALUES\n       (source.[ItemName]);\n</code></pre>\n\n<p>end</p>\n\n<p>But I don't know how to update my items.Languagetextid, can I do something with:\nOUTPUT $action, INSERTED.ID ?\nOr is there a better way to have this done??</p>\n\n<p>Thanks in advance,</p>\n\n<p>Mike</p>\n"},{"tags":["sql","sql-server","sql-server-2008","version-control"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":38,"score":2,"question_id":13274498,"title":"Add version control to existing SQL Server database","body":"<p>I am part of a development team currently working with a database that does not have any kind of source control. We work with SQL Server 2008 R2 and have always managed the DB directly with SSMS. It now has ~340 tables and ~1600 stored procedures, plus a few triggers and views, so it is not a small DB.</p>\n\n<p>My goal is to have the DB under version control, so I have been reading articles, like <a href=\"http://bitly.com/9cJmGR\" rel=\"nofollow\">Scott Allen's series</a> and many old SO related questions. But I am still unable to decide on how to proceed.</p>\n\n<p>What I'm thinking of is to script the database schema in one file, then procedures, triggers and views in one file each. Then keep everything versioned under Mercurial. But of course, every member of the team can access SSMS and directly change the schema and procedures, with the possibility that any of us can forget to replicate those changes in the versioned files.</p>\n\n<p>What better options are there? And, did I forget any element worth having source control of? My biggest concern is that most of the literature I found explains how to do version control when creating a new database, but not when it is already old and relatively big.</p>\n"},{"tags":["sql-server-2008","cursor","identity-column"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13272108,"title":"Can I use IDENTITY_INSERT in a cursor on SQL Server 2008?","body":"<p>I have the following code: </p>\n\n<pre><code> declare c cursor for\n            select\n                id_user_V3\n                ,device_type\n                ,4\n                ,notfication_mode\n                ,t1.device_token\n                ,registration_date\n                ,rank\n                ,1\n            from audiv2.dbo.mya_webservice_device_token t1\n                join migr.asoc_V2_glb_user t2 on t1.user_id = t2.id_user_V2\n\n        open c\n        fetch next from c into @id_user_v3,@type,@application_id,@notiffication,@device_tooken,@creation_date,@rang,@status\n        while @@FETCH_STATUS=0\n            begin\n\n                set @device_id = (ISNULL((SELECT MAX(id_device) FROM usr_device)+1,1))\n\n                SET IDENTITY_INSERT usr_device ON\n\n                insert into usr_device values\n                (\n                    @device_id\n                    ,@id_user_v3\n                    ,@type\n                    ,@application_id\n                    ,@notiffication\n                    ,@device_tooken\n                    ,@creation_date\n                    ,@rang\n                    ,@status\n                )\n                SET IDENTITY_INSERT usr_device OFF\n\n                fetch next from c into @id_user_v3,@type,@application_id,@notiffication,@device_tooken,@creation_date,@rang,@status\n            end\n\n        close c\n        deallocate c \n</code></pre>\n\n<p>The error I get is :</p>\n\n<blockquote>\n  <p>An explicit value for the identity column in table 'usr_device' can only be specified when a column list is used and IDENTITY_INSERT is ON.</p>\n</blockquote>\n\n<p>How can I solve this?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13274556,"title":"SQL Conversion Error","body":"<p>I really need a second pair of eyes on this... I have a Stored Procedure with a variable:</p>\n\n<pre><code>DECLARE @date_period_end int \n\nIF @date_period_end = '' or @date_period_end is null  \nBEGIN \n    SET @date_period_end = 'DATEDIFF(dd, ''1/1/1753'', CONVERT(datetime,getdate())) + 639906 ' \nEND\n</code></pre>\n\n<p>Here is the error SQL returning when I execute:</p>\n\n<blockquote>\n  <p>Conversion failed when converting the varchar value 'DATEDIFF(dd, '1/1/1753', CONVERT(datetime,getdate())) + 639906 ' to data type int.</p>\n</blockquote>\n\n<p>I'm pretty certain I'm missing or have added an incorrect amount of quotes somewhere.  Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13274296,"title":"Auto Increment feature of SQL Server","body":"<p>I have created a table named as ABC. It has three columns which are as follows:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/3sx3t.png\" alt=\"enter image description here\">              </p>\n\n<p>The column <code>number_pk</code> <code>(int)</code> is the <strong>primary key</strong> of my table in which I have made the <code>auto increment</code> feature on for that column.</p>\n\n<p>Now I have deleted two rows from that table say <code>Number_pk= 5</code> and <code>Number_pk =6</code>.</p>\n\n<p>The table which I get now is like this:-</p>\n\n<p><img src=\"http://i.stack.imgur.com/bTpbm.png\" alt=\"enter image description here\"></p>\n\n<p>Now if I again enter two new rows in this table with the same value I get the two new <code>Number_pk starting from 7 and 8</code> i.e,</p>\n\n<p><img src=\"http://i.stack.imgur.com/Y3fLv.png\" alt=\"enter image description here\"></p>\n\n<p>My question is that what is the logic behind this since I have deleted the two rows from the table. I know that a simple answer is because I have set the auto increment on for the primary key of my table. But I want to know is there any way that I can insert the two new entries starting from the last Number_pk without changing the design of my table?</p>\n\n<p>And how the <strong><em>SQL Server manage this record since I have deleted the rows from the database??</em></strong></p>\n"},{"tags":["sql","sql-server-2008","udf"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13273350,"title":"Splitting long strings in SQL","body":"<p>The inline solution suggested here: <a href=\"http://stackoverflow.com/questions/2647/split-string-in-sql\">Split string in SQL</a> by vzczc only works for strings containing less than 100 elements because of the limit of recursion depth (and you can't change the limit inside a UDF).</p>\n\n<p>Any other ways of splitting long strings with good performance? The UDF I've been using (not inline) has been very slow:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[fn_ParseDelimitedStrings](@String nvarchar(MAX), @Delimiter char(1))\nRETURNS @Values TABLE\n(\n RowId int Not Null IDENTITY(1,1) PRIMARY KEY\n,Value nvarchar(255) Not Null\n)\nAS\nBEGIN\n    DECLARE  @startPos smallint\n        ,@endPos smallint\n\n    IF (@String = '')\n    RETURN\n\n    IF (RIGHT(@String, 1) != @Delimiter)\n        SET @String = @String + @Delimiter\n    SET @startPos = 1\n    SET @endPos = CharIndex(@Delimiter, @String)\n    WHILE @endPos &gt; 0\n    BEGIN\n        INSERT @Values(Value)\n        SELECT LTRIM(RTRIM(SUBSTRING(@String, @startPos, @endPos - @startPos)))\n        -- remove the delimiter just used\n        SET @String = STUFF(@String, @endPos, 1, '')\n        -- move string pointer to next delimiter\n        SET @startPos = @endPos\n        SET @endPos = CHARINDEX(@Delimiter, @String)\n    END\n    RETURN\nEND\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13273885,"title":"How do I fetch only records created in the past year from a table within SSIS package?","body":"<p>I have a column <strong>CT_DT</strong> in a  table. I have to process only transactions created within the past <code>365 days</code>.</p>\n\n<p>For example, suppose the current date is <strong>Nov 7, 2012</strong>, I have to process only those transaction that were created since <strong>Nov 7, 2011</strong>. I am using conditional filter within the SSIS package.</p>\n"},{"tags":["sql","sql-server-2008","query","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":16,"score":1,"question_id":13273705,"title":"SQL to bring back material names","body":"<p>The below code is a result of a query i have created, it all works fine apart from one thing.  I have Material ID's for material names:</p>\n\n<pre><code>1 = bath\n2 = sink\n3 = toilet\n</code></pre>\n\n<p>The below works but displays sink for every material</p>\n\n<pre><code>Select cu.FName + '  ' + cu.SName as 'Name', \ncu.Address1 + ', ' + cu.Address2 + ', ' + cu.Address3 as 'Dispatch Address', \ncu.PostCode, \nco.DateOrdered,\nco.Material1,\nma.MaterialName,\nco.material2, \nma.MaterialName, \nma.Price as 'Item Price' \nfrom Customers cu \nleft join CustomerOrder co on co.CustomerID = cu.CustomerID\nleft join ItemOrder it on it.OrderID = co.OrderID \nleft join Materials ma on ma.MaterialID = co.Material1 \nor co.material2 = ma.MaterialItemID or co.material3 = ma.MaterialItemID\n</code></pre>\n\n<p>it displays as follows (just the materials are listed to stop confusion)</p>\n\n<pre><code>Material1 | MaterialName | Material2 | Material2Name | Material3 | Material3Name\n    1          Sink            2           Sink           3             Sink\n</code></pre>\n\n<p>Can anybody help with this?</p>\n"},{"tags":["sql-server-2008","ssis","ssas","data-warehouse"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13240245,"title":"How do I handle this scenario related to degenerate/fact dimension in SSAS cube?","body":"<p>I have an SQL Server 2008 SSIS/SSAS Datawarehouse cube that I am publishing, in this cube I have the following:</p>\n\n<pre><code>Dimensions\n----------\nCompany\nProduct\nSales Person\nShipped Date (time dimension)\n\nFacts\n-----  \nTotal Income\nTotal Revenue \nGross\n</code></pre>\n\n<p>For the above, I have setup primary (PK) / surrogate (SK) keys for the dimension/fact data referencing.</p>\n\n<p>What I would also like to include is things such as <code>Order Number</code> or <code>Transaction Number</code> which in my mind would fit in a fact table as the order number is different for every record. If I were to create a order number dimension it does not make much sense as I would have as many order numbers as I would facts.</p>\n\n<p>Right now, when I load my fact data I do multiple Lookups on the dimensions to get the surrogate keys, I then pass in the fact data and <strong>also</strong> include these Order Number and Transaction Number <code>varchar</code> columns when I load my fact data but they cannot be used as they are not something you can aggregate on so they don't show up in my SSAS, only columns of numeric data type do for the fact table (total income, total revenue, etc).</p>\n\n<p>Is there something I can do to make these available for anyone using the Cube to filter on?</p>\n"},{"tags":["oracle","sql-server-2008","replication"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":157,"score":1,"question_id":7671474,"title":"publishing(replicating) Oracle to Sql2008r2","body":"<p>Trying to establish transactional replication from oracle server to Sql2008 R2 instance.\nI am able to set up 'Oracle publication' through Replication,New Oracle publication  wizard;every thing seems go fine up to adding articles (oracle table) and able to Map datatypes.\nbut when I choose Transactional Replication, it tells me that the oracle source table I choose do not have a Primary Key. Which is not true.</p>\n\n<p>If choose a snapshot, it goes on a infinite loop.</p>\n\n<p>I noticed that the linked server(to oracle) is using msdaOra provider, Is there a way to force Publication Wizard to use OraOLEDB.Oracle provider when it sets up associated linked server.</p>\n\n<p>any help appreciated</p>\n"},{"tags":["c#","sql-server","sql-server-2005","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2107,"score":1,"question_id":6824188,"title":"SqlDataSourceEnumerator.Instance.GetDataSources() does not locate local SQL server 2008 instance","body":"<p>I use the following code to list all the remote and local SQL Server instances:</p>\n\n<pre><code>public static void LocateSqlInstances()\n  {\n     using( DataTable sqlSources = SqlDataSourceEnumerator.Instance.GetDataSources())\n     {\n        foreach(DataRow source in sqlSources.Rows )\n        {\n           string instanceName = source[\"InstanceName\"].ToString();\n\n           if (!string.IsNullOrEmpty(instanceName))\n           {\n              Console.WriteLine(\" Server Name:{0}\", source[\"ServerName\"]);\n              Console.WriteLine(\"   Instance Name:{0}\", source[\"InstanceName\"]);\n              Console.WriteLine(\"   Version:{0}\", source[\"Version\"]);\n              Console.WriteLine();\n           }\n        }\n        Console.ReadKey();\n     }\n  }\n</code></pre>\n\n<p>running the code on my local machine. The code can find and list a SQL server express instance (version 9.0.5000) installed but failed to list the other SQL server instance (version 10.0.1600).</p>\n\n<p>I've done a lot of research on the Internet and made sure that 1-the Sql Broswer is runing and 2 - the UDP port 1434 is open.</p>\n\n<p>Anybody knows why? Thanks.</p>\n"},{"tags":["asp.net","windows","sql-server-2008","load","bandwidth"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13272585,"title":"Does this website load senario make sense?","body":"<p>I recently build an asp.net website that saw a drastic increase in traffic. Here are the specs for the server it was on:\nWindows 2008 R2 with SQL Server Web Edition 2008\n64 Bit Quad Core AMD Opteron Processor 2374 HE 2.32 GHz\n8GB of RAM\n320GB Hard Drive</p>\n\n<p>I was seeing all 4 processors running around 80-99%, memory around 3-4GB. And the website was taking between 10-30 seconds to pull up. \nThe site was getting approximately 35-200 pageviews a minute with an average page weight of of 600kb.\nThe website code used asp.net 3.5 and hit the database with a linq call for the sitemap to build the navigation, and there were two internal pages where the user could query the database that used an optimized stored procedure. These queries usually returned in .5 seconds.  </p>\n\n<p>I ran Red Gate's asp.net performance profiler and memory profiler and nothing significant was found.  </p>\n\n<p>So overall would you expect this type of load on the server from this configuration and volume of traffic?  In the end I added another server and a load balancer and site returned to responding in 3-5 seconds.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13210454,"title":"sql cte if statement","body":"<p>This might be a bad idea but just wondering?</p>\n\n<pre><code>;with Products\nAS\n(\n/* can you have an if statement in here? */\nselect * from products\n\n/* or */\n\nselect * from products \nwhere condition\n\n)\n</code></pre>\n\n<p>what i'm thinking is what if sometimes you have a search string or not. How do you make that a consideration in cte?</p>\n\n<p>Or maybe it would be a better idea to have 2 cte in one procedure?</p>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13270332,"title":"Report Builder/SSRS and RDLs - HTML <img> support?","body":"<p>I'm completely new to SSRS so apologies if this is a silly question. I have an RDL with a HTML placeholder however if I pass an <code>&lt;img&gt;</code> tag in the dataset this does not render.</p>\n\n<p>I see on <a href=\"http://technet.microsoft.com/en-us/library/ff519562.aspx\" rel=\"nofollow\">this Technet</a> article that there is a list of supported tags, which unfortunately doesn't include <code>&lt;img&gt;</code>. I've been able to add an image with an external source based on an expression which uses a dataset field so it seems a little strange that you can't use images in HTML placeholders. Is there a workaround for this at all?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13271685,"title":"SQL Login notification","body":"<p>I want to be notified of SQL Server logins that has a particular value for the <code>Application Name</code> property of the connection string. Can someone help me to get these type of notifications by email or by any other recommended method?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13255746,"title":"Can Execute Procedure But Job That Runs Procedure Errors?","body":"<p>I have a procedure that pulls data from my database and uses MSDB.DBO.sp_send_dbmail to send out e-mails.  The procedure itself runs without a hitch when I use 'EXEC myprocedure'.  But when I set up a job for the procedure, the job fails with the following error </p>\n\n<blockquote>\n  <p>'Error formating query, probably invalid parameters [SQLState\n  42000](Error 22050).  The step failed'</p>\n</blockquote>\n\n<p>There is one step in the job with the TSQL statement 'EXEC myprocedure', using the database that my procedure is stored on.  Does anyone know what could be causing this error?</p>\n\n<p><strong>Update</strong></p>\n\n<p>I've narrowed the problem down. It's something with the Exchange server I use. I was using a domain address (ie. mail.mycompany.com) as the 'Server name' under Database Mail's account configuration wizard. I was unable to send e-mails to listservs and external users using this domain address. I talked to our Exchange guy and he recommended using the actual IP address of one of the mail servers (ie. 10.123.53.53). That fixed the problem with listservs and external users, but now I am unable to send e-mails when I run my procedure using a job (the procedure itself executes properly when I manually run it). Does anyone know what criteria on our Exchange server I will need to change to fix this? </p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":34,"score":-3,"question_id":13271591,"title":"tsql : Delete query","body":"<pre><code>DELETE abc \nFROM abc INNER JOIN xyz ON \nabc.RECORD_TYPE = xyz.RECORD_TYPE AND \nabc.IN = xyz.IN \nOPTION (MERGE JOIN, LOOP JOIN)\n</code></pre>\n\n<p>can anyone tell me what exactly the query doing ? </p>\n"},{"tags":["sql-server-2008","tsql","if-statement","null"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":27,"score":1,"question_id":13271477,"title":"TSQL parameter with NULL value does not enter IF condition","body":"<p>I have a query that looks like this:</p>\n\n<pre><code>use [dbName]\n\nDECLARE @profile_id int\nSET @profile_id = 18\nDECLARE @test int\n\nSET @test = (SELECT user_profile_id FROM tbl_profiles WHERE id = @profile_id)\n\nSELECT @test as test\n\nif @test = NULL\n    SELECT 1\n\nelse \n    SELECT 2\n</code></pre>\n\n<p>I know that the value in the table is null, and I can see that @test is correctly being set to that value because the first SELECT shows:</p>\n\n<pre><code> |test\n1|NULL\n</code></pre>\n\n<p>However, in the IF condition the variable is not being treated as NULL because only the third SELECT is returned, showing:</p>\n\n<pre><code> |(no column name)\n1| 2\n</code></pre>\n\n<p>Why is that?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13240037,"title":"How to return only a single resultset in a stored procedure","body":"<p>Consider the following stored procedure :</p>\n\n<pre><code>create procedure [dbo].[MyTest] ( @p_SqlStatement nvarchar(max) )\nas\nbegin\n\n    exec sp_executesql @p_SqlStatement\n\n    if @@ROWCOUNT = 1\n    begin\n      select 1;\n    end\n    else if @@ROWCOUNT &lt;&gt; 1\n    begin\n      select 0;\n    end\n\nend\n</code></pre>\n\n<p>This stored procedure currently returns 2 datasets, one with the <code>exec sp_executesql @p_SqlStatement</code> data, and the other one would be either 1 or 0. Is there a way to suppress the first dataset? I mean, would it be possible that this stored procedure returns only 1 or 0 ?</p>\n\n<p>I tried adding a <code>RAISERROR( 'MyError', 18, 1 )</code> right after the <code>exec sp_executesql @p_SqlStatement</code> and then in the catch block select something else, but the first result set is always returned to my stored procedure caller...</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13267862,"title":"Where I can check user-define table type in SQL Server 2008 in SSMS? and how can I insert new column into it?","body":"<p>I need to add some more columns into my current <code>user-define table type in SQL Server 2008</code></p>\n\n<p>But I didn't see any table type in particular database under <code>Tables</code> .</p>\n\n<p>Where exactly I need to check and how can I modify the design of existing <code>user-define table type in SQL Server 2008</code></p>\n\n<p>I'm using <code>SQL SERVER 2008</code> and <code>SSMS</code></p>\n\n<p>Where I can find that table in <code>SSMS</code> , </p>\n\n<p>so that I can go and modify table type.</p>\n\n<p>thanks</p>\n\n<p>for previous question answer </p>\n\n<p>Please can any one help to sql <code>alter type table</code> syntax <code>add column</code> ?\nhow can I insert any new column ... as ALTER is not working.. it is disable </p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":109,"score":-2,"question_id":11665119,"title":"DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()), 0) Can someone explain me this","body":"<pre><code>DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()), 0)\n</code></pre>\n\n<p>Can someone explain me this.</p>\n"},{"tags":["sql","database","sql-server-2008","query"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":13263023,"title":"Need advice to re-create history of a table based on audit tables","body":"<p>OK folks, I have an urgent need. I am tasked with re-creating an accurate history of changes to  multiple fields of an active table retroactively based on individual audit tables for each field.  I have a SQL Server Agent job that does this currently on a daily basis starting 10/16/2012, but need to immediately add records to retrofit the history back to 1/1/2012.</p>\n\n<p>To compound my issue, I need to reflect daily changes to the full hierarchy from the top down based on these audit records.</p>\n\n<p>Here's what I have:</p>\n\n<p>Active Table:</p>\n\n<pre><code>empId varchar(20),\nfirst_name varchar(50),\nlast_name varchar(50),\ncost_center varchar(20), -- need to re-create history\nmgr_empId varchar(20), -- need to re-create history\nstart_dt date, -- starting date range of active record\nend_dt date, -- end of active record - default value of 12/31/2999 = active record\nhierarchy_empId varchar (200), --derived field from a nasty self-referencing function (12x)\nhierarchy_name varchar(1000) -- derived from the same functino as the field above.\n</code></pre>\n\n<p>Example:</p>\n\n<p>Employee A1000, Tim Lee enters the org on 3/1/2012 with manager Bill A with emp Id B1000 into cost center 01552.</p>\n\n<pre>\nA1000  Tim Lee  01552   B1000   3/1/2012   12/31/2999   B1000>A1000   Bill A>Tim Lee\nB1000  Bill A   01552   NULL    1/1/2011   12/31/2999   B1000         Bill A\n</pre>\n\n<p>On 5/1/2012 the nightly job picks up a delta for Tim, and Tim's cost center changes to  31550.  So his current record is updated with an end date of yesterday, and a new \"current\" record is entered, reflected below:</p>\n\n<pre>\nA1000  Tim Lee  01552   B1000   3/1/2012   4/30/2012   B1000>A1000   Bill A>Tim Lee\nB1000  Bill A   01552   NULL    1/1/2011   12/31/2999  B1000         Bill A\nA1000  Tim Lee  31550   B1000   5/1/2012   12/31/2999  B1000>A1000   Bill A>Tim Lee\n</pre>\n\n<p>On 6/15/2012, a new manager Ben C, emp Id C1000, was hired underneath Tim's manager:</p>\n\n<pre>\nA1000  Tim Lee  01552   B1000   3/1/2012    4/30/2012   B1000>A1000         Bill A>Tim Lee\nB1000  Bill A   01552   NULL    1/1/2011    12/31/2999  B1000               Bill A\nA1000  Tim Lee  31550   B1000   5/1/2012    6/14/2012   B1000>A1000         Bill A>Tim Lee\nC1000  Ben C    31550   A1000   6/15/2012   12/31/2999  A1000>C1000         Bill A>Ben C\nA1000  Tim Lee  31550   B1000   6/15/2012   12/31/2999  B1000>C1000>A1000   Bill A>Ben C>Tim Lee\n</pre>\n\n<p>These updates must trickle down the hierarchy.  So, if something changes above Tim, it also must be reflected in his record.   </p>\n\n<p>On 7/15, Tim's original manager Bill A gets a new manager, Mark S, emp Id X3000.</p>\n\n<pre>\nA1000  Tim Lee  01552   B1000   3/1/2012    4/30/2012   B1000>A1000               Bill A>Tim Lee\nB1000  Bill A   01552   NULL    1/1/2011    7/14/2012   B1000                     Bill A\nA1000  Tim Lee  31550   B1000   5/1/2012    6/14/2012   B1000>A1000               Bill A>Tim Lee\nC1000  Ben C    31550   A1000   6/15/2012   7/14/2012   A1000>C1000               Bill A>Ben C\nA1000  Tim Lee  31550   C1000   6/15/2012   7/14/2012   B1000>C1000>A1000         Bill A>Ben C>Tim Lee\nX3000  Mark S   01000   NULL    7/15/2012   12/31/2999  X3000                     Mark S\nA1000  Tim Lee  31550   C1000   7/15/2012   12/31/2999  X3000>B1000>C1000>A1000   Mark S>Bill A>Ben C>Tim Lee\nB1000  Bill A   01552   X3000   7/15/2012   12/31/2999  X3000>B1000               Mark S>Bill A\nC1000  Ben C    31550   B1000   7/15/2012   12/31/2999  X3000>B1000>C1000              Mark S>Bill A>Ben C\n\n</pre>\n\n<p>I have these audit tables:</p>\n\n<p><strong>tblManagerAudit</strong></p>\n\n<pre><code>empId varchar(20),\nchgTimestamp datetime,\noldMgr varchar(20),\nnewMgr varchar(20)\n</code></pre>\n\n<p><strong>tblCostCenterAudit</strong></p>\n\n<pre><code>empId varchar(20),\nchgTimnestamp datetime,\noldCostCenter varchar(20),\nnewCostCenter varchar(20)\n</code></pre>\n\n<p>I have struggled with how to combine the audit records for a very long time and appreciate any input.</p>\n"},{"tags":["php","sql-server-2008","svg"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":7,"score":1,"question_id":13270185,"title":"Connecting SQL Server 2008 Spatial with PHP for SVG Maps on website","body":"<p>I know GIS but I am new to SQL Server 2008 Spatial, SVG or PHP: I am planing to display an SVG map online embedded with 2 other online applications developed using JAVA and other one with .NET. </p>\n\n<p>Beside the map there are other attribute information stored in SQL Server in a different table based on Zipcode, I want to connect those attributes also with each Zipcode based polygon in my SVG Map.</p>\n\n<p>I do not know how to connect SQL Server using PHP/ASP/Java/Java Script or any server side scripting.</p>\n\n<p>I am not a programmer but I have basic idea about JavaScript and little bit of PHP. I am looking for mouse-over, Zoom in Zoom Out, PAN functions.\nAny help about SQL Server 2008 connection, rendering SVG.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13269586,"title":"SQL adding additional columns to a query","body":"<p>I'm trying to create a query that allows me to see all of the customers orders and to add an additional column using sql to view the total amount that the customer owes.</p>\n\n<p>the following code retrieves the correct data:</p>\n\n<pre><code>SELECT\n    cu.FName + '  ' + cu.SName as 'Name', \n    cu.Address1 + ', ' + cu.Address2 + ', ' + cu.Address3 as 'Dispatch Address', \n    cu.PostCode, \n    co.DateOrdered, co.DateDispatched, \n    ma.MaterialName, \n    it.Quantity, \n    ma.Price as 'Total' \nFROM\n    Customers cu \nLEFT JOIN \n    CustomerOrder co ON co.CustomerID = cu.CustomerID \nLEFT JOIN\n    ItemOrder it ON it.OrderID = co.OrderID \nLEFT JOIN \n    Materials ma ON ma.MaterialID = it.MaterialID \n</code></pre>\n\n<p>I now need to add additional code to the above to add a column to show the total amount the customer owes, but I'm stuck, can anybody help?</p>\n\n<pre><code>Date Order   |    Dispatch Date | Item  | QTY  |   Price | TOTAL AMOUNT FOR BOTH ROWS\n2012-10-30   |    2012-11-25    | Bath  | 1    |   49.99 |  \n2012-10-30   |    2012-11-25    | Sink  | 1    |   55.99 |\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":34,"score":0,"question_id":13269638,"title":"Group By and place some records in one group","body":"<p>please consider data:</p>\n\n<pre><code> Id          Group            Value\n -----------------------------------\n 1            1                10\n 2            1                12\n 3            1                10\n 4            2                90\n 5            2                10\n 6            3                30\n 7            4                12\n 8            4                11\n 9            5                10\n 10           5                11\n</code></pre>\n\n<p>I want to do <code>Group By</code> on this data as <code>1,2,3</code> place in one group and <code>4,5</code> place in another group. How I can do this with <code>SQL Server</code>?</p>\n\n<p>thanks</p>\n\n<hr>\n\n<p><strong>Edit 1)</strong></p>\n\n<p>I want this result:</p>\n\n<pre><code>Groups                              Count\n-----------------------------------------\nGroup for 1,2,3                       6\nGroup for 4,5                         4\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","code-reuse"],"answer_count":3,"favorite_count":3,"up_vote_count":17,"down_vote_count":0,"view_count":9712,"score":17,"question_id":3795263,"title":"Errors: \"INSERT EXEC statement cannot be nested.\" and \"Cannot use the ROLLBACK statement within an INSERT-EXEC statement.\" How to solve this?","body":"<p>I have three stored procedures <code>Sp1</code>, <code>Sp2</code> and <code>Sp3</code>.</p>\n\n<p>The first one (<code>Sp1</code>) will execute the second one (<code>Sp2</code>) and save returned data into <code>@tempTB1</code> and the second one will execute the third one (<code>Sp3</code>) and save data into <code>@tempTB2</code>.</p>\n\n<p>If I execute the <code>Sp2</code> it will work and it will return me all my data from the <code>Sp3</code>, but the problem is in the <code>Sp1</code>, when I execute it it will display this error:</p>\n\n<blockquote>\n  <p>INSERT EXEC statement cannot be nested</p>\n</blockquote>\n\n<p>I tried to change the place of <code>execute Sp2</code> and it display me another error:</p>\n\n<blockquote>\n  <p>Cannot use the ROLLBACK statement\n  within an INSERT-EXEC statement.</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13269038,"title":"Mixing update/insert records in a single invocation of \"Instead of insert, update\" - Is that possible?","body":"<p>I would like to know whether an \"instead of insert, update\" trigger can be called to both \"UPDATE\" A records in the table while \"INSERTING\" B records in a <strong>single invocation</strong>?</p>\n\n<p>Actually, I'm just curious to know whether SQL Server could call the mentioned trigger for updating and inserting records, at once? or it just calls the trigger once for updating some records, and once for inserting some others?</p>\n\n<p>Consider this, for example:</p>\n\n<pre><code>ALTER TRIGGER [dbo].[MyTable_DoWhatever] \n   ON  [dbo].[MyTable] \n   INSTEAD OF INSERT, UPDATE\nAS \nBEGIN\n    SET NOCOUNT ON;\n\n    DECLARE @Updating BIT = 0;\n    IF EXISTS(SELECT * FROM INSERTED i INNER JOIN DELETED d ON i.Id = d.Id) SET @Updating = 1\n\nEND\n</code></pre>\n\n<p>Does the above @Updating flag valid to determine whether the trigger is called for \"INSTEAD OF INSERTED\" or \"INSTEAD OF UPDATE\"?</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net","sql","sql-server","sql-server-2005","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":478,"score":0,"question_id":6120957,"title":"SQL Query Problem in Inline Query in Asp.net","body":"<p>My sql table structure is this</p>\n\n<pre><code>ID  DataName\n1   Lipsum lorem \n3   lipsum's lorem\n</code></pre>\n\n<p>My inline query in asp.net is that</p>\n\n<pre><code>select * from table where DataName like 'lipsum's lorem'\n</code></pre>\n\n<p>It gives the following errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 1\nIncorrect syntax near 's'.\nMsg 105, Level 15, State 1, Line 1\nUnclosed quotation mark after the character string ''.\n</code></pre>\n\n<p>I don't want to create a stored procedure to prevent this, I want a solution to this using inline queries.</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":3461,"score":0,"question_id":10110615,"title":"An insert exec statement cannot be nested","body":"<p>Hello I have a proc called <code>Test_ProcA</code> and I want to call <code>Test_ProcB</code>. I created a temp table called <code>#temp</code> with matching names and data types returned by <code>Test_ProcB</code>.</p>\n\n<p>How do I insert the result set returned by <code>Test_ProcB</code> into <code>#temp</code>. When I try doing that I keep getting this error:</p>\n\n<blockquote>\n  <p>An <code>INSERT EXEC</code> statement cannot be nested.</p>\n</blockquote>\n\n<p>Any ideas and suggestions on what needs to be done.</p>\n"},{"tags":["sql-server","sql-server-2008","csv","bulkinsert"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4036,"score":1,"question_id":3756560,"title":"How to Bulk Insert csv with double quotes around all values?","body":"<p>I am trying to insert a .csv file into SQL Server 2008 R2.</p>\n\n<p>The .csv is 300+MB from <a href=\"http://ipinfodb.com/ip_database.php\" rel=\"nofollow\">http://ipinfodb.com/ip_database.php</a> Complete\n(City), 4.0M records.</p>\n\n<p>Here're the top 5 lines, with 1st line = column headers:</p>\n\n<pre><code>\"ip_start\";\"country_code\";\"country_name\";\"region_code\";\"region_name\";\"city\";\"zipcode\";\"latitude\";\"longitude\";\"metrocode\"\n\"0\";\"RD\";\"Reserved\";;;;;\"0\";\"0\";\n\"16777216\";\"AU\";\"Australia\";;;;;\"-27\";\"133\";\n\"17367040\";\"MY\";\"Malaysia\";;;;;\"2.5\";\"112.5\";\n\"17435136\";\"AU\";\"Australia\";;;;;\"-27\";\"133\";\n</code></pre>\n\n<p>I tried Import and Export Data, and BULK INSERT, but haven't been able to import them correctly yet.</p>\n\n<p>Shall I resort to use bcp? can it handle stripping the <code>\"\"</code>? how?</p>\n\n<p>Thank you very much.</p>\n"},{"tags":["sql-server-2008","encryption","certificate","windows-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13117172,"title":"SQL server 2008 encrypted connection","body":"<p>I've created and installed a self-signed certificate <code>test</code> on my Windows 2008 Server. I've set <code>Force Encryption</code> to <code>Yes</code> and set the certificate to <code>test</code>. </p>\n\n<p>I've exported and sent the <code>test</code> certificate to clients. They've installed it to the Trusted Authority store. They've tried to connect to the SQL server through the SQL Management Studio Express, with the <code>Encrypt connection</code> set. They get the following error: </p>\n\n<p><strong>A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: TCP Provider, error: 0 - No such host is known.) (Microsoft SQL Server, Error: 11001)</strong></p>\n\n<p>Note that they can connect to the server just fine through unencrypted connection and settings.</p>\n\n<p>I've tried most solutions thrown out by google about this error, but I don't think any of them dealt with encryption. </p>\n\n<p>I've also tried <a href=\"http://www.sqlservercentral.com/Forums/Topic611829-146-1.aspx\" rel=\"nofollow\">this</a> method, but I still get the same error.</p>\n\n<p>I don't have the <code>Primary DNS Suffix</code> set, if that has any affect on certificates?</p>\n\n<p>EDIT: My goal is to somehow have an encrypted connection from remote computers to my databse, because my clients demand it. We were considering VPN, but there is no need for it, if this can be done on SQL server.</p>\n\n<p>EDIT 2: The certificate \"Issued\" fields are set to local domain name (that's not resolvable by remote computers). Could this be an issue? Can I somehow set the certificate to an external IP address, if that'll fix the issue?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":188,"score":0,"question_id":8731229,"title":"SQL Server string getting truncated","body":"<p>I have a column (<code>col1</code>) with <code>nvarchar(max)</code>.</p>\n\n<p>I am trying to do </p>\n\n<pre><code>DECLARE @my_string NVARCHAR(max)\nset @my_string = N'test'\n\nUPDATE dbo.tab1 \nSET col1 = @my_string + ISNULL(col1, N'')\n</code></pre>\n\n<p>no  luck , I have no idea why it is happening. @marc_s</p>\n\n<p>The string value in <code>col1</code> getting truncated after 250 characters. This happening in both SQL Server 2005 and 2008.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","merge","case"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13268170,"title":"Merge Statement: Don't update blank field","body":"<p>I'm performing a MERGE statement from a temp table <code>t</code> into the main table <code>ts</code>, matching on an ID field. It contains the following:</p>\n\n<pre><code>WHEN MATCHED THEN UPDATE\n   SET ts.username = t.username, ts.password = t.password, ts.title = t.title, ts.firstname = t.firstname, ts.surname = t.surname, ts.email = t.email\n</code></pre>\n\n<p>If the username and password is blank in the temp table <code>t</code>, I don't want to update the main table <code>ts</code>. How can I do this?</p>\n\n<p>EDIT: Seems like a <code>CASE</code> statement or using <code>COALESCE(NULLIF(t.username, ''), ts.username)</code> will work. Which is best?</p>\n"},{"tags":["sql","sql-server","vb.net","sql-server-2008"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3365,"score":1,"question_id":1513438,"title":"How do I return a value to a sqldatareader if value is null?","body":"<p>I am currently using a sql data reader (in vb.net) to extract an article object via a stored proc from a SQL Server 2008 database. Part of this object includes the two properties shown below:</p>\n\n<pre><code>theArticle.Truthfulness = ((myReader.GetInt32(myReader.GetOrdinal(\"Truthfulness\"))))\ntheArticle.Relevance = ((myReader.GetInt32(myReader.GetOrdinal(\"Relevance\"))))\n</code></pre>\n\n<p>My problem is that the Truthfulness and Relevance may return a null value and this is causing the function to fall over.</p>\n\n<p>I think I understand why. I am asking for an integer value (getin32) and because null is returned it fails.</p>\n\n<p>How do I accommodate the null value from the database so it does not fall over?</p>\n"},{"tags":["java","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13267909,"title":"Restore .bak on MS SQL server","body":"<p>We have restore command which we can execute from command line.\nI want to restore backup from Java class.\nHow should I do it?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13266772,"title":"How can I select the latest event for a given user in Microsoft SQL Server 2008?","body":"<p>I have a database in Microsoft SQL Server 2008</p>\n\n<p>I have a table <code>[eventlog].[dbo].[USER_OPERATION]</code> with columns <code>[userID], [event_description], [event_date], [event_type], [eventID]</code></p>\n\n<p><code>eventID</code> is unique for, well, every given event that can happen.</p>\n\n<p>A given <code>UserID</code> is, of course, not unique for events (every user may have a lot of events associated with him) but is associated with a single individual user</p>\n\n<p>What I want is to create a query that would give me a list which only has the <em>latest</em> event for every user (that is to say, every <code>UserID</code>) and its associated info (the <code>event_type</code>, <code>eventID</code> and <code>event_description</code> of a given specific event).</p>\n\n<p>To illustrate:</p>\n\n<p>When performing</p>\n\n<pre><code>SELECT * \nFROM [eventlog].[dbo].[USER_OPERATION] \nORDER BY userID ASC\n</code></pre>\n\n<p>I get something along the lines of </p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   391     |    2     |  USER 2 filed a complaint       |  30.04.10    |  COMPLAINT |\n|   392     |    2     |  USER 2 has bought beer         |  31.10.09    |  PURCHASE  |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   691     |    4     |  USER 4 has bought beer         |  01.12.10    |  PURCHASE  |\n|   81      |    4     |  USER 4 updated personal data   |  17.07.11    |  PDAT_UPD  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   142     |    5     |  USER 5 broke something         |  16.08.11    |   CRASH    |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>As you can see, some users have multiple events with different dates associated with them.</p>\n\n<p>What I want is a query that will show me a list of users and what was the most recent date users had an event on (the output would, essentially, be a table which lists each users once, and shows the most recent event associated with each user, and associated event_description, event_date and event_type info). </p>\n\n<p>Let's call such a query result \"Recent Event Table\".</p>\n\n<p><b>Do note the \"unusual condition\" of User 5 (UserID 5) who broke something and bought beer at the same date. </p>\n\n<p>In such cases, I don't care WHICH of the two same-day events would go into the \"Recent Event Table\"</b>, it can be picked by random or whatever (though I would still would need the associated event_description and event_type info).</p>\n\n<p><b>Ideally</b>, the result would look like this (for same set of users as above):</p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>If there is no way to just <i>\"pick any one of the two randomly or per some rule\"</i> for such \"date-dupes\" as User 5, having two entries in the \"Recent Event Table\" would be acceptable for such special cases, since they are very rare and I can handle them manually.</p>\n\n<p>In such (a little bit less fortunate) case the \"Recent Event Table\" would look like </p>\n\n<pre><code>|====================================================================================|\n|  eventID  |  userID  |        event_description        |  event_date  | event_type |\n|           |          |                                 |              |            |\n|   123     |    2     |  USER 2 broke something         |  03.11.11    |   CRASH    |\n|   32      |    3     |  USER 3 broke something         |  22.10.11    |   CRASH    |\n|   568     |    4     |  USER 4 has requested support   |  05.12.11    |  SUPP_REQ  |\n|   141     |    5     |  USER 5 has bought beer         |  16.08.11    |  PURCHASE  |\n|   142     |    5     |  USER 5 broke something         |  16.08.11    |   CRASH    |\n|   269     |    6     |  USER 6 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|   845     |    7     |  USER 7 updated personal data   |  27.01.12    |  PDAT_UPD  |\n|           |          |                                 |              |            |\n|====================================================================================|\n</code></pre>\n\n<p>Which is also acceptable (but would need a bit additional pruning later).</p>\n\n<p>So, to summarize my question, is it possible to construct such a Microsoft SQL query that would give me a Recent Event Table along the lines of what was described above ?</p>\n\n<p>Thank you very much for your help in advance </p>\n"},{"tags":["sql-server-2008","ssms"],"answer_count":3,"favorite_count":5,"up_vote_count":19,"down_vote_count":0,"view_count":29424,"score":19,"question_id":3359170,"title":"Auto-increment primary key in SQL tables","body":"<p>Using Sql Express Management Studio 2008 GUI (not with coding), how can I make a primary key auto-incremented?</p>\n\n<p>Let me explain: there is a table which has a column named \"id\" and the items of this column are set to be primary keys. I want to make this column auto-incremented, but how?</p>\n\n<p>Cheers</p>\n"},{"tags":["sql","database","sql-server-2008","query","database-design"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":25,"score":-2,"question_id":13261087,"title":"How to generate the mapping table in a many to many insert","body":"<p>I have a table of trades for Companys in an exchange. So for a given day I can have many trades for a company. I now want to take these trades and group them into positions.</p>\n\n<p>A trade can below to many positions depending on its attributes like country, type etc\na position can be made up of many trades.</p>\n\n<p>So I have the following tables</p>\n\n<p><strong>Table Trades</strong><br/></p>\n\n<pre><code>Id   Date      Company   Trade  Type\n1 2012-11-01     IBM     1000    A\n2 2012-11-01     IBM     3000    B\n3 2012-11-01     Dell    1000    A\n4 2012-11-01     HP      5000    A\n5 2012-11-01     HP      6000    A\n6 2012-11-01     HP      7000    B\n</code></pre>\n\n<p><strong>Table TradePositionMapping</strong><br/></p>\n\n<pre><code>PK     TableTradeID      PositionID\n1          1                100      --IBM 1000\n2          1                101      --IBM 1000\n3          2                101      --IBM 3000\n4          3                102      --Dell 1000\n5          4                103      --HP 5000\n6          5                103      --HP 6000\n7          4                104      --Hp 5000\n7          5                104      --Hp 6000\n7          6                104      --Hp 7000\n</code></pre>\n\n<p><strong>Table Position</strong><br/></p>\n\n<pre><code>PK   Company Position\n100   IBM      1000\n101   IBM      4000\n102   Dell     1000\n103   Hp      11000\n104   Hp      18000\n</code></pre>\n\n<p>So in the Positions above the IBM Trade ID 1 went to 2 Positions 100 and 101. Trade Id 2 also went to Position 101 giving a total of 4000</p>\n\n<p>Ok so the idea being that a trade can make up 1 or more positions and a position can have many trades. The business logic will determine what positions the trades flow to, so I have used A and B as flags for now just as an example.</p>\n\n<p>So to the question which is..</p>\n\n<p>When I select and aggregate from the Trades Table, I insert all the new positions that are made up from the various trades into the Positions table. Now what is the best way to create the mapping table.</p>\n\n<p>What I do at the moment is that I store the newly created Position Ids in a tempory table and then repeat the select that I would do to generate the postions in the first place.. and join to the tempory table. THis seems like a lot of duplication of code and I would like to know what the best practice is out there to do such a thing.</p>\n\n<p>best regards Mick</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":9,"score":1,"question_id":13266767,"title":"ALter view after insert by trigger sql server","body":"<p>I create a - view in sql server.\nI want to alter the view every time that a - row is added to my table .\nI create trigger for it :</p>\n\n<pre><code>CREATE TRIGGER Trigger1\nON dbo.Table1\nAFTER INSERT\nAS \nBEGIN\nALTER VIEW VIEW1 as\nSELECT *\nFrom Table1\nEND\n</code></pre>\n\n<p>But I get the error : 'ALTER VIEW' must be the only statement in the batch.</p>\n\n<p>What should I do to correct it error ?</p>\n"},{"tags":["sql-server-2008","dateadd"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13266130,"title":"How to select last one week data from today's date","body":"<p>How to select week data (more precisely, last 7 days data) from the current date in the fastest way as I have millions or rows in the table. I have a time stamp of created_date in sql table. </p>\n\n<p>I have tried this </p>\n\n<pre><code>SELECT Created_Date\nFROM Table_Name\nWHERE Created_Date &gt;= DATEADD(day,-7, GETDATE())\n</code></pre>\n\n<p>I have two question:</p>\n\n<ol>\n<li>Is this query is correct?</li>\n<li>Is this is the fastest way to get the last seven day data from a table having millions of rows ?</li>\n</ol>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":50,"score":0,"question_id":13254052,"title":"Reorder list by column","body":"<p>I have a column \"SortIndex\" in a table, and I would like to add a \"case update\" to reorder that table by passing in ID and the new position of the chosen one.</p>\n\n<p><a href=\"http://sqlfiddle.com/#!3/d41d8/5831\" rel=\"nofollow\">SQL Fiddle</a></p>\n\n<pre><code>DECLARE @T TABLE\n(\n    ID int,\n    Name char(1),\n    SortIndex int\n)\n\nINSERT @T \nSELECT 21, 'A', 1 UNION ALL\nSELECT 23, 'B', 2 UNION ALL\nSELECT 35, 'C', 3 UNION ALL\nSELECT 45, 'D', 4 UNION ALL\nSELECT 55, 'E', 5\n\nSELECT * FROM @T    \n\nDECLARE @SortIndex int\n\n/* MOVE A -&gt; 4 */\n\nSET @SortIndex = (SELECT SortIndex FROM @T WHERE ID = 23)\n\n/*\nUPDATE @T\n    SET \n        SortIndex = CASE ... ??\n*/      \n\n/* MOVE D -&gt; 2 */\n\nSELECT * FROM @T\n</code></pre>\n\n<p>Is this possible to solve this by only using the case statement to rebuild the sortindex'es?</p>\n\n<p><em>UPDATE</em></p>\n\n<p>Desired results</p>\n\n<pre><code>A -&gt; 4\n\n    Name SortIndex\n    B     1 \n    C     2\n    D     3\n    A     4\n    E     5\n\n    D -&gt; 2\n\n    A     1 \n    D     2\n    B     3\n    C     4\n    E     5\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":17470,"score":5,"question_id":5136013,"title":"How to change column datatype in SQL Server database without losing data","body":"<p>I have SQL Server database and I just realized that I can change the type from one of the columns from <code>int</code> to <code>bool</code>. How can I do that without losing the data that is already entered into that table? </p>\n\n<p>PS. I am using SQL Server Server 2008.</p>\n"},{"tags":["sql-server-2008","query","table","select","subquery"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13263699,"title":"Is there any way to send a column value from outer query to inner sub query?","body":"<p>'Discussions' table schema</p>\n\n<pre><code>title      description    desid    replyto    upvote    downvote   views\nbrowser    used           a1        none        1          1       12\n-          bad topic      b2        a1          2          3       14\nsql        database       a3        none        4          5       34\n-          crome          b4        a3          3          4       12\n</code></pre>\n\n<p>The above table has two types of content types Main Topics and Comments. Unique content identifier 'desid' used to identify that its a main topic or a comment. 'desid' starts with 'a' for Main Topic and for comment 'desid' starts with 'b'. For comment 'replyto' is the 'desid' of main topic to which this comment is associated. </p>\n\n<p>I like to find out the list of the top main topics that are arranged on the basis of (upvote+downvote+visits+number of comments to it) addition. The following query gives top topics list in order of  (upvote+downvote+visits)</p>\n\n<p><code>select *</code> with highest number of <code>upvote+downvote+views</code> by query </p>\n\n<pre><code>select * \nfrom [DB_user1212].[dbo].[discussions] \nwhere desid like 'a%'\norder by (upvote+downvote+visited) desc\n</code></pre>\n\n<p>For (comments+upvote+downvote+views ) i tried </p>\n\n<pre><code>select *\nfrom [DB_user1212].[dbo].[discussions]\nwhere desid like 'a%'\norder by (select count(*)\n           from [DB_user1212].[dbo].[discussions]\n           where replyto = desid )+upvote+downvote+visited) desc \n</code></pre>\n\n<p>but it didn't work . Because its not possible to send desid from outer query to innner subquery. Please tell me how to solve this. Please note that I want solution in query language only.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13258755,"title":"How to load image into varbinary column","body":"<p>I have table like this</p>\n\n<pre><code>CREATE TABLE [dbo].[Product](\n    [Id] [int] IDENTITY(1,1) NOT NULL,\n    [Name] [nvarchar](100) NOT NULL,\n    [Description] [nvarchar](max) NOT NULL,\n    [Price] [decimal](16, 3) NOT NULL,\n    [SmallPhoto] [varbinary](max) NULL);\n</code></pre>\n\n<p>I want load image into [SmallPhoto] field</p>\n\n<p>Main script looks like this</p>\n\n<pre><code>declare @filePath varchar(max)\ndeclare @productId int\n\nset @filePath = 'D:\\myfile.png'\nset @productId = 1\n\nupdate Product\nset SmallPhoto = -- some actions\nwhere Id = @productId\n</code></pre>\n\n<p>Expected result</p>\n\n<p>Command(s) completed successfully. :)</p>\n\n<p>UPD:</p>\n\n<p>1) My database located in other machine</p>\n\n<p>2) I do not have opportunity to copy file to remote machine</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":7,"view_count":31,"score":-7,"question_id":13265225,"title":"\"Enumeration yielded no results\" in sqldatareader","body":"<p>I getting this error in my application \n\"Enumeration yielded no results\". I don't know how to solve. can any one please help me</p>\n"},{"tags":["sql-server","sql-server-2008","datetime","truncate"],"answer_count":13,"favorite_count":30,"up_vote_count":61,"down_vote_count":0,"view_count":81809,"score":61,"question_id":923295,"title":"How can I truncate a datetime in SQL Server?","body":"<p>What's the best way to truncate a datetime value (as to remove hours minutes and seconds) in SQL Server 2008?</p>\n\n<p>For example:</p>\n\n<pre><code>declare @SomeDate datetime = '2009-05-28 16:30:22'\nselect trunc_date(@SomeDate)\n\n-----------------------\n2009-05-28 00:00:00.000\n</code></pre>\n"},{"tags":["vb.net","sql-server-2008","import"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13265042,"title":"How to import data from one sql server database to another using VB.NET","body":"<p>I have been developing application using VB.NET and SQL Server 2008. There is one software is already been developed and in running mode, now I have to develop facility that user can add one record on that software and same record will add into my database table also. For that I have to write some code for when I will open particular screen / page in my application it will check the database table on that software and found if any new entry/record than it will apperier in my application screen also.</p>\n\n<p>In short I have to import record from database table from one database to another database using VB.NET code.</p>\n\n<p>Please advice.</p>\n"},{"tags":["c#","winforms","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13264150,"title":"How do I change color of cell which have greater than zero value in datagrid","body":"<p><code>enter code here</code><p> i have two cell in grid i want to chage one cell color and value by zero when i entered in other cell greater then zero value </p></p>\n\n<pre><code>    private void grdDetail_CellBeginEdit(object sender, DataGridViewCellCancelEventArgs e)\n        { \n            if (this.IsLoadComplete) \n              { \n                UpdateValueofQtyCell(e.ColumnIndex); \n              } \n       }\n  private void UpdateValueofQtyCell(int index)\n        {\n            int cur_row = grdDetail.CurrentRow.Index;\n\n            if (index == 1)\n            {\n                grdDetail[1, cur_row].Style.BackColor = Color.White;\n                grdDetail[2, cur_row].Style.BackColor = Color.FromArgb(224, 224, 224);\n                grdDetail[2, cur_row].Value = 0;\n            }\n           else  if (index == 1)\n            {\n                grdDetail[2, cur_row].Style.BackColor = Color.White;\n                grdDetail[1 cur_row].Style.BackColor = Color.FromArgb(224, 224, 224);\n                grdDetail[1, cur_row].Value = 0;\n             }\n        }\n</code></pre>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13258850,"title":"table name of column from view","body":"<p>I have a view which returns 30 columns. The view is created by inner join of three tables. I wish to find out which column was taken from which table using a query rather than going through the view line by line.\nIs there a way to do that in sql server 2008?\nthanks in advance </p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13263497,"title":"SQL compare strings having version as value","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6855588/split-a-string-and-return-greatest-in-mssql\">Split a string and return greatest in mssql</a>  </p>\n</blockquote>\n\n\n\n<p>I need to compare strings which have version value, for example:\nstring1 = 2.3.4\nstring2 = 2.5.6\nNow in the above case i need to check which string version is greater?</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13256597,"title":"Trigger to Only Allow a Single Null Value Per Item ID","body":"<p>I am working on a database for equipment management, where users can sign in and out equipment. I have a table called TBL_Usage which keeps track of this. When an item is signed out, a new record is created in this table with the sign out date, and when it is signed back in, a sign in date is entered in the same record.</p>\n\n<p>For the purposes of this question, the table looks like this:\nTBL_Usage(Date_Out, Date_In, Equipment_ID)</p>\n\n<p>Now an item can't be signed out twice at the same time, therefore for each Equipment_ID, there can only be a maximum of one record where Date_In is null. I want to create a trigger/constraint to deal with this and am not quite sure how to set it up.</p>\n"},{"tags":["sql","sql-server-2008","tsql","subquery","cross-join"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":13263856,"title":"SQL Server subquery in cross join returns error","body":"<p>I have tables <code>A</code>, <code>B</code> and <code>C</code>. Now table <code>A</code> as column <code>A1</code>(Primary Key), table <code>B</code> has column <code>B1</code>(Primary Key) and table <code>C</code> has columns <code>A1</code>(Foreign Key to Table <code>A.A1</code>), <code>B1</code>(Foreign Key to Table <code>B.B1</code>).</p>\n\n<p>Now I'm writing a query which list all rows from <code>A</code> and <code>B</code> and a bit column which will be set to to 1 if a row is found matching in table <code>C</code> otherwise 0.</p>\n\n<pre><code>SELECT \n     ISNULL((SELECT CAST(1 AS BIT) \n             FROM C \n             WHERE C.A1 = A.A1 AND C.B1 = B.B1),0) AS [TAG],\n     A.A1,\n     B.B1\nFROM A CROSS JOIN B\n</code></pre>\n\n<p>This query is producing an <code>Subquery returned more than 1 value.</code> error even though the query has no duplicate rows after combining the <code>A1</code> and <code>B1</code> columns.</p>\n"},{"tags":["asp.net","sql-server-2008","datatable","insertion"],"answer_count":2,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":13252070,"title":"Getting error while inserting table in database?","body":"<p>i am inserting table in database using table datatype with the following code:</p>\n\n<pre><code>CREATE TYPE BackUpDoctorLocationAreaRoom AS TABLE (\n[RoomId] bigint,\n[AreaId] bigint,\n[LocationId] bigint\n);\n\nAlter proc proc_tblBackUpDoctorInsert \n(\n@Id uniqueidentifier='',\n@BackUpDoctorId uniqueidentifier='1323e1f4-7a93-4b45-9a9b-3840c32fd6d8',  \n@StartDate datetime='11/08/2012',  \n@EndDate datetime='11/09/2012',  \n@StartTime datetime='22:22:22',  \n@EndTime datetime='01:11:11',  \n@CreatedBy uniqueidentifier='acf7961c-4111-49ad-a66a-ce7f9ce131bd',  \n@ModifiedBy uniqueidentifier='acf7961c-4111-49ad-a66a-ce7f9ce131bd',  \n@createdDate datetime='11/6/12 3:09:58 AM',  \n@ModifiedDate datetime='11/6/12 3:09:58 AM',\n@tblBackUpDoctorsForRooms BackUpDoctorLocationAreaRoom READONLY\n)    \nas    \nset xact_abort on\ndeclare @newId uniqueidentifier;    \nset @newId = newid(); \ninsert into tblBackUpDoctor (Id,BackUpDoctorId,StartDate,EndDate,StartTime,EndTime,CreatedBy,ModifiedBy,\ncreatedDate,ModifiedDate,IsActive,isdeleted) values \n(@newId,    \n@BackUpDoctorId,    \n@StartDate,    \n@EndDate,    \n@StartTime,    \n@EndTime,    \n@CreatedBy,    \n@ModifiedBy,    \n@createdDate,    \n@ModifiedDate,    \n1,0)    \ndeclare @IdFortblBackUpDoctorsForRooms uniqueidentifier;    \nset @IdFortblBackUpDoctorsForRooms = newid();    \ndelete from tblBackUpDoctorsForRooms where BackUpRecordId=@id and Roomid in (Select roomid from @tblBackUpDoctorsForRooms)\ndelete from tblbackupdoctor where id=@id\ninsert into tblBackUpDoctorsForRooms (BackUpRecordId,Roomid,Araeid,locationid)    \nSelect  @newId,roomid,areaid,locationid from @tblBackUpDoctorsForRooms\nselect @newId\n</code></pre>\n\n<p>This is the sp in which i am using that table.</p>\n\n<p>My class file's code is :</p>\n\n<pre class=\"lang-cs prettyprint-override\"><code>public string InsertBackUpDoctor(ClsBackUpDoctorProp objProp, DataTable dtLocAreaRoom)\n{\n    String ConnectionString = CCMMUtility.GetCacheForWholeApplication();\n    String backUpRecordId = \"\";\n    SqlParameter[] param = new SqlParameter[12];\n    param[0] = new SqlParameter(\"@Id\", objProp.Id);\n    param[1] = new SqlParameter(\"@BackUpDoctorId\", objProp.BackUpDoctorId);\n    param[2] = new SqlParameter(\"@StartDate\", objProp.StartDate);\n    param[3] = new SqlParameter(\"@EndDate\", objProp.EndDate);\n    param[4] = new SqlParameter(\"@StartTime\", objProp.StartTime);\n    param[5] = new SqlParameter(\"@EndTime\", objProp.EndTime);\n    param[6] = new SqlParameter(\"@CreatedBy\", objProp.CreatedBy);\n    param[7] = new SqlParameter(\"@ModifiedBy\", objProp.ModifiedBy);\n    param[8] = new SqlParameter(\"@createdDate\", CCMMUtility.GetCurrentDateTimeByTimeZone(\"US Mountain Standard Time\"));\n    param[9] = new SqlParameter(\"@ModifiedDate\", CCMMUtility.GetCurrentDateTimeByTimeZone(\"US Mountain Standard Time\"));\n    param[10] = new SqlParameter(\"@CurrentDate\", objProp.CurrentDate);\n    param[11] = new SqlParameter(\"@tblBackUpDoctorsForRooms \", dtLocAreaRoom);\n\n\n    backUpRecordId = SqlHelper.ExecuteScalar(ConnectionString, \"proc_tblbackupdoctorInsertBackUpDoctors\", param).ToString();\n    return backUpRecordId;\n}\n</code></pre>\n\n<p>and here is the error which is coming when i tries to insert :</p>\n\n<p><strong>The incoming tabular data stream (TDS) remote procedure call (RPC) protocol stream is incorrect. Table-valued parameter 12 (\"@tblBackUpDoctorsForRooms\"), row 0, column 0: Data type 0xF3 (user-defined table type) has a non-zero length database name specified.  Database name is not allowed with a table-valued parameter, only schema name and type name are valid.</strong>\nI dont know why this coming please help me..</p>\n"},{"tags":["sql-server-2008","asp-classic","whitespace","recordset"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13249950,"title":"how to get the value of a column in recordset with space in the name?","body":"<p>we have change the server of our client, i'm trying to get rid of all the errors i got in the new server, i've got this situation:</p>\n\n<p>yesterday, on the old server this works fine:</p>\n\n<pre><code>sql = \"SELECT * FROM tableName INNER JOIN tableName2 ON tableName.Code = tableName2.[Global dimension 1 code] WHERE [No_]=\"&amp;request(\"aNumber\")\nset rs = conn.execute(sql)\n\nif not rs.EOF then\nsubCat = rs(\"Global dimension 1 code\")\nelse\nsubCat = 0\nend if\n</code></pre>\n\n<p>today, on the new server with IIS6 and same sql server 2008 as the oldone, i get the variable \"subCat\" empty, BUT if i write:</p>\n\n<pre><code>subCat = rs(\"code\")\n</code></pre>\n\n<p>it goes good. Also:</p>\n\n<pre><code>do until rs.EOF\n  for each x in rs.Fields\n    Response.Write(x.name)\n    Response.Write(\" = \")\n    Response.Write(x.value &amp; \"&lt;br&gt;\")\n  next\n  Response.Write(\"&lt;br&gt;\")\n  rs.MoveNext\n  loop\n</code></pre>\n\n<p>gives all the columns, also those with spaces, and things like:</p>\n\n<pre><code>subCat = rs(\"[Global dimension 1 code]\")\nsubCat = rs(\"'Global dimension 1 code'\")\nsubCat = rs(\"[tableName].[Global dimension 1 code]\")\n</code></pre>\n\n<p>rise a 500 server error.</p>\n\n<p>anyone has a hint to point a column in recordset with spaces? i'm usign ASP classic.\nthanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":27,"score":-1,"question_id":13261497,"title":"incorrect syntax near in creating stored procedure on a remote db","body":"<p>I am trying to recreate a stored procedure on a database which is hosted on a remote server.\nWhen creating the same SP locally I don't get any errors but when I am trying to create the SP on the remote server I am getting this errors:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Procedure MySP, Line 26\nIncorrect syntax near 'MERGE'.\nMsg 102, Level 15, State 1, Procedure MySP, Line 27\nIncorrect syntax near 'S'.\n</code></pre>\n\n<p>Those errors are repeating in multiple SP and I didn't get them when I created the SP's on my local server.\nAny idea what can that be?\nHere is a sample SP:</p>\n\n<pre><code>USE [MyDatabase]\nGO\n/****** Object:  StoredProcedure [dbo].[InsertContractorInfo]    Script Date: 11/07/2012 01:08:31 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n-- Author:      &lt;Author,,Name&gt;\n-- Create date: &lt;Create Date,,&gt;\n-- Description: &lt;Description,,&gt;\n-- =============================================\n--exec [dbo].[InsertContractorInfo] \nCREATE PROCEDURE [dbo].[InsertContractorInfo]\n(@CompanyName nvarchar(50), \n @LicenseNumber nvarchar(50),\n @MailingAddress1 nvarchar(200),\n @MailingAddress2 nvarchar(200),\n @Phone nvarchar(10),\n @Fax nvarchar(10),\n @Mobile nvarchar(10),\n @Email nvarchar(200),\n @PercentCommercial int,\n @PercentResidental int,\n @TotalEmployees int,\n @AnnualSales decimal(18,2),\n @InsuranceCompanyContact nvarchar(100)=null,\n @InsuranceCompanyContactEmail nvarchar(100)=null,\n @InsuranceCompanyContactPhone nvarchar(100)=null,\n @ContractorID uniqueidentifier)\nAS\nBEGIN\nMERGE dbo.Contractor con\nUSING(SELECT 1 S) S\nON con.Oid = @ContractorID\nWHEN MATCHED THEN UPDATE \n   SET       \n      [CompanyName] = @CompanyName      \n      ,[LicenseNumber] = @LicenseNumber\n      ,[MailingAddress1] = @MailingAddress1\n      ,[MailingAddress2] = @MailingAddress2\n      ,[Phone] = @Phone\n      ,[Fax] = @Fax\n      ,[EMail] =@Email\n      ,[Mobile] =@Mobile      \n      ,[PercentCommercial] = @PercentCommercial\n      ,[PercentResidental] = @PercentResidental\n      ,[TotalEmployees] = @TotalEmployees\n      ,[ApproximateAnnualSales] = @AnnualSales      \n      ,[InsuranceCompanyContact] = @InsuranceCompanyContact\n      ,[InsuranceCompanyContactPhone] = @InsuranceCompanyContactPhone\n      ,[InsuranceCompanyContactEmail] = @InsuranceCompanyContactEmail      \nWHEN NOT MATCHED THEN\nINSERT \n           ([Oid]       \n           ,[CompanyName]           \n           ,[LicenseNumber]\n           ,[MailingAddress1]\n           ,[MailingAddress2]\n           ,[Phone]\n           ,[Fax]\n           ,[EMail]\n           ,[Mobile]                      \n           ,[PercentCommercial]\n           ,[PercentResidental]\n           ,[TotalEmployees]\n           ,[ApproximateAnnualSales]                      \n           ,[InsuranceCompanyContact]\n           ,[InsuranceCompanyContactPhone]\n           ,[InsuranceCompanyContactEmail])\n     VALUES\n           (@ContractorId           \n           ,@CompanyName           \n           ,@LicenseNumber\n           ,@MailingAddress1\n           ,@MailingAddress2\n           ,@Phone\n           ,@Fax\n           ,@EMail\n           ,@Mobile\n           ,@PercentCommercial\n           ,@PercentResidental\n           ,@TotalEmployees\n           ,@AnnualSales                     \n           ,@InsuranceCompanyContact\n           ,@InsuranceCompanyContactPhone\n           ,@InsuranceCompanyContactEmail\n           );\nEND\nGO\n</code></pre>\n\n<p>Thanks, Laziale</p>\n"},{"tags":["sql","sql-server-2008","query","stored-procedures","triggers"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13193745,"title":"update column1 based on another column2 from same table without using trigger","body":"<p>scenario is :\nThere are many columns in my table like Col1 Col2 Col3 Col4.\nI want to set data of Col4 if VALUE of Col1 is changed. On firing update query value of Col1 may or may not change.</p>\n\n<p>I have implemented it through trigger.</p>\n\n<pre><code>Select @ISTDNotPossibleI = I.ISTDNotPossible From inserted i\nSelect @IsTDCompletedD = D.IsTDCompleted from deleted d\n\nIf (\n  (@IsTDCompletedD != @IsTDCompletedI) Or\n  (@ISTDNotPossibleD != @ISTDNotPossibleI) Or\n  (@IsTDDirectD != @IsTDDirectI) Or (\n    @IsTDCompletedD Is Null And\n    @IsTDCompletedI Is Not Null\n  ) Or (\n    @ISTDNotPossibleD Is Null And\n    @ISTDNotPossibleI Is Not Null\n  ) OR (\n    @IsTDDirectD Is Null And\n    @IsTDDirectI Is Not Null\n  )\n)\nBegin\n  Update \n    CRM_CarTDLog \n  Set\n    TDCompletedEventBy = @UpdatedBy,\n    TDCompletedEventOn = GetDate() \n  Where\n    Id = @UpdateID \nEnd\n</code></pre>\n\n<p>Problem is : this field is not likely to be updated regularly. But Col2 and Col3 are likely to be updated frequently. And since update query is being fired on this table frequently the trigger will be  fired frequently too. And it is increasing the overhead without serving any purpose.</p>\n\n<p>I want to solve this without using trigger. Please help me.</p>\n"},{"tags":[".net","mysql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":42,"score":1,"question_id":11840161,"title":"Efficient way to calculate value mathematical functions on DB data","body":"<p>In .net application, either window or web application, </p>\n\n<p>To perform different mathematical functions like sqrt, maximum,minimum,avg,count on larger amount of data. \nUsing stored procedures or normal program logic using iteration. which is the best way for doing this?</p>\n"},{"tags":["sql","sql-server-2008","locking"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":6745120,"title":"Creation time of a lock in SQL Server 2008","body":"<p>So I'm trying to monitor the longest living lock in my database. The idea is that if a lock has been held for a certain amount of time, I will receive a warning in my application.</p>\n\n<p>But for the life of I can't find the creation time of the locks.</p>\n\n<p>I have used:</p>\n\n<pre><code>exec msdb..sp_lock\nexec msdb..sp_who2\nSELECT * FROM sys.dm_tran_locks\nselect * from sys.syslockinfo\nselect cmd, * from sys.sysprocesses where blocked &gt; 0\n</code></pre>\n\n<p>But none of these seem to have the information I need.</p>\n\n<p>Any ideas?</p>\n\n<p>G</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13259850,"title":"Dynamic SQL and stored procedure optimization","body":"<p>I've read that using Dynamic SQL in a stored procedure can hurt performance of your stored procedures. I guess the theory is that the store procedure won't store an execution plan for SQL executed via EXEC or sp_executesql.</p>\n\n<p>I want to know if this is true. If it is true, do I have the same problem with multiple nested IF blocks, each one with a different \"version\" of my SQL statement?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13260367,"title":"TRIGGER INSERT last row into one of the chosen tables if WHERE conditions are true","body":"<p>I am currentlty using triggers in a table to copy the last row into a designated table based on a WHERE condition and ORDER BY. Using one trigger works fine and copies to the respective table. but both triggers are running causing duplicates of a previous row to appear in the table I dont want inserted. (SQL2008 Management Studio). I have specific tables to send this row too based on the partnumber. Here is the Structure:</p>\n\n<pre><code>ALTER TRIGGER NewT3650 ON JD_Passdata\nFOR INSERT \nAS\nINSERT T3_650_TestData (SerialNumber, Partnumber, etc)\nSELECT TOP 1 SerialNumber, Partnumber, etc\nFROM JD_Passdata\nWHERE partnumber = 'T3_650'\nORDER BY passdata_ndx DESC\n\nALTER TRIGGER NewT4450 ON JD_Passdata\nFOR INSERT \nAS\nINSERT T4_450_TestData (SerialNumber, Partnumber, etc)\nSELECT TOP 1 SerialNumber, Partnumber, etc\nFROM JD_Passdata\nWHERE partnumber = 'T4_450'\nORDER BY passdata_ndx DESC\n</code></pre>\n\n<p>Original PassData Table:</p>\n\n<pre><code>201244999, T4_450\n201245001, T3_650\n201245002, T3_650\n201245003, T3_650\n</code></pre>\n\n<p>Returns Results for table 1</p>\n\n<pre><code>201245001, T3_650\n201245002, T3_650\n201245003, T3_650\n</code></pre>\n\n<p>Returns Results for table 2</p>\n\n<pre><code>201244999, T4_450\n201244999, T4_450\n201244999, T4_450\n</code></pre>\n\n<p>I would like this to be an OR condition or a UNION that only takes the last row and enters it into the correct table and remove the additional trigger if possible. Otherwise a check for duplicate and update may do it too. Also the database is going to get quite large to do a DESC every entry may get slow. A method to remove the order by would be a consideration as well.</p>\n\n<p>Any sugesstions would be greatly appreciated...THX</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":13259913,"title":"Using Sum() with multiple where clauses","body":"<p>I'm pretty new to this, so forgive if this has been posted (I had no idea what to even search on).</p>\n\n<p>I have 2 tables, Accounts and Usage</p>\n\n<pre><code>AccountID  AccountStartDate  AccountEndDate\n-------------------------------------------\n1          12/1/2012         12/1/2013\n2          1/1/2013          1/1/2014\n\n\nUsageId   AccountID EstimatedUsage  StartDate  EndDate\n------------------------------------------------------\n1         1         10              1/1        1/31\n2         1         11              2/1        2/29\n3         1         23              3/1        3/31\n4         1         23              4/1        4/30\n5         1         15              5/1        5/31\n6         1         20              6/1        6/30\n7         1         15              7/1        7/31\n8         1         12              8/1        8/31\n9         1         14              9/1        9/30\n10        1         21             10/1        10/31\n11        1         27             11/1        11/30\n12        1         34             12/1        12/31\n13        2         13              1/1        1/31\n14        2         13              2/1        2/29\n15        2         28              3/1        3/31\n16        2         29              4/1        4/30\n17        2         31              5/1        5/31\n18        2         26              6/1        6/30\n19        2         43              7/1        7/31\n20        2         32              8/1        8/31\n21        2         18              9/1        9/30\n22        2         20             10/1        10/31\n23        2         47             11/1        11/30\n24        2         33             12/1        12/31\n</code></pre>\n\n<p>I'd like to write one query that gives me estimated usage for each month (starting now until the last month that we serve an account) for all accounts being served during that month.</p>\n\n<p>The results would be as follows:</p>\n\n<pre><code>Month-Year     Total Est Usage\n------------------------------\nOct-12            0  (none being served)\nNov-12            0  (none being served)\nDec-12           34  (only accountid 1 being served)\nJan-13           23  (accountid 1 &amp; 2 being served)\nFeb-13           24  (accountid 1 &amp; 2 being served)\nMar-13           51  (accountid 1 &amp; 2 being served)\n...\nDec-13           33  (only accountid 2 being served)\nJan-14           0   (none being served)\nFeb-14           0   (none being served)\n</code></pre>\n\n<p>I'm assuming I need to sum and then do a Group By...but not really sure logically how I'd lay this out.  </p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13252072,"title":"i need an sp to select or update my tables and for that i have to enter multiple values for single variable how can i do that?","body":"<p>desperately need an sp to pass mutiple values for the single variable like <code>@list</code> is a variable and the values I'm putting for it are '<code>1,3,4,5,66</code>' and I need information from the table realated to these id's:</p>\n\n<pre><code>SELECT T.C.value('.', 'NVARCHAR(100)') AS [id]\n    INTO #tblPersons\n    FROM (SELECT CAST ('&lt;Name&gt;' + REPLACE(@empid, ',', '&lt;/Name&gt;&lt;Name&gt;') + '&lt;/Name&gt;' AS XML) AS [Names]) AS A\n    cross APPLY Names.nodes('/Name') as T(C) \n</code></pre>\n\n<p>I'm using this in my sp but I'm getting difficulty for passing this for the mutiple values.</p>\n"},{"tags":["sql","database","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13259028,"title":"SQL Server bulk insert - \"Bulk load data conversion error\"","body":"<pre><code>bulk insert dbo.A\nFROM 'd:\\AData.csv'\nWITH \n(\nFIELDTERMINATOR = ',',\nROWTERMINATOR = '\\n'\n)\n</code></pre>\n\n<p>Inserting bulk data into a database, I approached an unexplainable error after review of the suspect data:</p>\n\n<blockquote>\n  <p><em>Msg 4867, Level 16, State 1, Line 6</em><br>\n  <em>Bulk load data conversion error (overflow) for row 1, column 42 (FES).</em></p>\n</blockquote>\n\n<p>Column FES was <code>tinyint</code>, now <code>smallint</code>. <code>d:\\AData.csv</code> contains a <code>2</code> in row 1, column 42. Are there any other sources for this type of error?</p>\n\n<p>---APPEND---</p>\n\n<p>I'm not sure how to properly post this. </p>\n\n<p>Create Table Script </p>\n\n<pre><code>create table AcsBy320082010Hus(\nserialnoId bigint,\nRT char,\nDIVISION tinyint,\nPUMA int,\nREGION tinyint,\nST tinyint,\nADJHSG int,\nADJINC int,\nWGTP int,\nNP tinyint,\nTYPE tinyint,\nACR tinyint,\nAGS tinyint,\nBDS tinyint,\nBLD tinyint,\nBUS tinyint,\nCONP smallint,\nELEP smallint,\nFS smallint,\nFULP int,\nGASP int,\nHFL tinyint,\nINSP varchar(6),\nKIT tinyint,\nMHP int,\nMRGI tinyint,\nMRGP int,\nMRGT tinyint,\nMRGX tinyint,\nPLM tinyint,\nRMS tinyint,\nRNTM tinyint,\nRNTP int,\nSMP int,\nTEL tinyint,\nTEN tinyint,\nVACS tinyint,\nVAL tinyint,\nVEH tinyint,\nWATP int,\nYBL tinyint,\nFES tinyint,\nFINCP int,\nFPARC tinyint,\nGRNTP int,\nGRPIP tinyint,\nHHL tinyint,\nHHT tinyint,\nHINCP int,\nHUGCL bit,\nHUPAC tinyint,\nHUPAOC tinyint,\nHUPARC tinyint,\nLNGI tinyint,\nMV tinyint,\nNOC tinyint,\nNPF tinyint,\nNPP bit,\nNR bit,\nNRC tinyint,\nOCPIP tinyint,\nPARTNER tinyint,\nPSF bit,\nR18 bit,\nR60 tinyint,\nR65 tinyint,\nRESMODE tinyint,\nSMOCP int,\nSMX tinyint,\nSRNT bit,\nSVAL bit,\nTAXP tinyint,\nWIF tinyint,\nWKEXREL tinyint,\nWORKSTAT tinyint,\nFACRP bit,\nFAGSP bit,\nFBDSP bit,\nFBLDP bit,\nFBUSP bit,\nFCONP bit,\nFELEP bit,\nFFSP bit,\nFFULP bit,\nFGASP bit,\nFHFLP bit,\nFINSP bit,\nFKITP bit,\nFMHP bit,\nFMRGIP bit,\nFMRGP bit,\nFMRGTP bit,\nFMRGXP bit,\nFMVYP bit,\nFPLMP bit,\nFRMSP bit,\nFRNTMP bit,\nFRNTP bit,\nFSMP bit,\nFSMXHP bit,\nFSMXSP bit,\nFTAXP bit,\nFTELP bit,\nFTENP bit,\nFVACSP bit,\nFVALP bit,\nFVEHP bit,\nFWATP bit,\nFYBLP bit,\nWGTP1 int,\nWGTP2 int,\nWGTP3 int,\nWGTP4 int,\nWGTP5 int,\nWGTP6 int,\nWGTP7 int,\nWGTP8 int,\nWGTP9 int,\nWGTP10 int,\nWGTP11 int,\nWGTP12 int,\nWGTP13 int,\nWGTP14 int,\nWGTP15 int,\nWGTP16 int,\nWGTP17 int,\nWGTP18 int,\nWGTP19 int,\nWGTP20 int,\nWGTP21 int,\nWGTP22 int,\nWGTP23 int,\nWGTP24 int,\nWGTP25 int,\nWGTP26 int,\nWGTP27 int,\nWGTP28 int,\nWGTP29 int,\nWGTP30 int,\nWGTP31 int,\nWGTP32 int,\nWGTP33 int,\nWGTP34 int,\nWGTP35 int,\nWGTP36 int,\nWGTP37 int,\nWGTP38 int,\nWGTP39 int,\nWGTP40 int,\nWGTP41 int,\nWGTP42 int,\nWGTP43 int,\nWGTP44 int,\nWGTP45 int,\nWGTP46 int,\nWGTP47 int,\nWGTP48 int,\nWGTP49 int,\nWGTP50 int,\nWGTP51 int,\nWGTP52 int,\nWGTP53 int,\nWGTP54 int,\nWGTP55 int,\nWGTP56 int,\nWGTP57 int,\nWGTP58 int,\nWGTP59 int,\nWGTP60 int,\nWGTP61 int,\nWGTP62 int,\nWGTP63 int,\nWGTP64 int,\nWGTP65 int,\nWGTP66 int,\nWGTP67 int,\nWGTP68 int,\nWGTP69 int,\nWGTP70 int,\nWGTP71 int,\nWGTP72 int,\nWGTP73 int,\nWGTP74 int,\nWGTP75 int,\nWGTP76 int,\nWGTP77 int,\nWGTP78 int,\nWGTP79 int,\nWGTP80 int)\n</code></pre>\n\n<p>Headers row </p>\n\n<blockquote>\n  <p>serialno,RT,DIVISION,PUMA,REGION,ST,ADJHSG,ADJINC,WGTP,NP,TYPE,ACR,AGS,BATH,BDSP,BLD,BUS,CONP,ELEP,FS,FULP,GASP,HFL,INSP,MHP,MRGI,MRGP,MRGT,MRGX,REFR,RMSP,RNTM,RNTP,RWAT,SINK,SMP,STOV,TEL,TEN,TOIL,VACS,VALP,VEH,WATP,YBL,FES,FINCP,FPARC,GRNTP,GRPIP,HHL,HHT,HINCP,HUGCL,HUPAC,HUPAOC,HUPARC,KIT,LNGI,MULTG,MV,NOC,NPF,NPP,NR,NRC,OCPIP,PARTNER,PLM,PSF,R18,R60,R65,RESMODE,SMOCP,SMX,SRNT,SVAL,TAXP,WIF,WKEXREL,WORKSTAT,FACRP,FAGSP,FBATHP,FBDSP,FBLDP,FBUSP,FCONP,FELEP,FFSP,FFULP,FGASP,FHFLP,FINSP,FKITP,FMHP,FMRGIP,FMRGP,FMRGTP,FMRGXP,FMVP,FPLMP,FREFRP,FRMSP,FRNTMP,FRNTP,FRWATP,FSINKP,FSMP,FSMXHP,FSMXSP,FSTOVP,FTAXP,FTELP,FTENP,FTOILP,FVACSP,FVALP,FVEHP,FWATP,FYBLP,WGTP1,WGTP2,WGTP3,WGTP4,WGTP5,WGTP6,WGTP7,WGTP8,WGTP9,WGTP10,WGTP11,WGTP12,WGTP13,WGTP14,WGTP15,WGTP16,WGTP17,WGTP18,WGTP19,WGTP20,WGTP21,WGTP22,WGTP23,WGTP24,WGTP25,WGTP26,WGTP27,WGTP28,WGTP29,WGTP30,WGTP31,WGTP32,WGTP33,WGTP34,WGTP35,WGTP36,WGTP37,WGTP38,WGTP39,WGTP40,WGTP41,WGTP42,WGTP43,WGTP44,WGTP45,WGTP46,WGTP47,WGTP48,WGTP49,WGTP50,WGTP51,WGTP52,WGTP53,WGTP54,WGTP55,WGTP56,WGTP57,WGTP58,WGTP59,WGTP60,WGTP61,WGTP62,WGTP63,WGTP64,WGTP65,WGTP66,WGTP67,WGTP68,WGTP69,WGTP70,WGTP71,WGTP72,WGTP73,WGTP74,WGTP75,WGTP76,WGTP77,WGTP78,WGTP79,WGTP80</p>\n</blockquote>\n\n<p>Row 1</p>\n\n<blockquote>\n  <p>2008000000023,H,6,01300,3,01,1012650,1031272,00043,04,1,1,,1,02,02,2,0000,150,2,0002,020,3,00150,,2,00980,1,1,1,03,,,1,1,,1,1,1,1,,0210000,2,0080,09,2,000058100,2,,,4,1,000058100,0,3,3,3,1,1,1,3,02,04,0,0,02,024,0,1,0,1,0,0,1,01170,3,0,1,19,1,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,00112,00045,00068,00017,00044,00091,00071,00032,00036,00042,00048,00041,00013,00031,00063,00013,00037,00017,00063,00098,00026,00036,00017,00065,00036,00020,00014,00035,00037,00046,00047,00048,00080,00034,00012,00061,00031,00069,00043,00060,00011,00050,00016,00057,00050,00013,00016,00068,00056,00039,00042,00049,00081,00041,00012,00092,00050,00055,00049,00016,00062,00041,00103,00012,00048,00060,00073,00052,00063,00038,00047,00040,00017,00040,00059,00020,00042,00010,00038,00018</p>\n</blockquote>\n\n<p><a href=\"http://www.census.gov/acs/www/Downloads/data_documentation/pums/DataDict/PUMS_Data_Dictionary_2008-2010.pdf\" rel=\"nofollow\">Link to ACS 2008-2010 Data Dictionary</a></p>\n"},{"tags":["sql-server-2008","user"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13258737,"title":"New SQL Server user failed to login","body":"<p>I've created new user in SQL Server Management Studio (SQL Server 2008 Express) in security tab. </p>\n\n<p>Specified the login name, SQL Server authentication, entered a password, assigned server role <code>sysadmin</code>, mapped to my database and there specify it as <code>db_owner</code>. Also in database security is specified in tab Schemas owned by this user is <code>db_owner</code>. </p>\n\n<p>I've checked a lot of tutorials but all of them do the same as me but when I try to login to SQL server (even manually) error message is thrown: </p>\n\n<blockquote>\n  <p><em>Login failed for 'MyUser' (Microsoft SQL Server, Error: 18456)</em></p>\n</blockquote>\n\n<p>Any idea what's wrong?</p>\n\n<p>Thanks a lot.</p>\n\n<p>Peter</p>\n"},{"tags":["c#","sql-server-2008","iis","iis7","iis-7.5"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13154836,"title":"One application pool keeps hanging IIS 7","body":"<p>For some reason my application pool keeps crashing once in a couple of days. The biggest problem is that there are no logs about errors or warnings in my administrative events about this pool. (there are several warnings in other pools, but it is only this pool that keeps crashing). Changes I make can only be tested if they worked if I wait a couple of days.</p>\n\n<p>I tried to bring my code back to the stage where the problems did not occur, but this does not seem to help.</p>\n\n<p>Most crashes happen when the site is not very busy, although not that inactive that IIS shuts it down for inactivity.</p>\n\n<p>Windows server 2008 R2 (SP 1),\nIIS Build 7.5.76,\nUmbraco,\nSql server 2008</p>\n\n<p>IIS logs: only showing some recycling of the pool (once every 3 hours)\nRapid fail detection: disabled</p>\n\n<p>Where should I start with solving this problem?</p>\n"},{"tags":["vb.net","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":36,"score":2,"question_id":13259152,"title":"SQL Update with where clause with variables from VS2010 Winforms","body":"<p>I am trying to do an update query from a winform with two variables without using a dataset.\nI assign both of my variable and then run the query but it keeps giving the error that zcomp is not a valid column name.  Which of course is true but I tell it which column before I say = zcomp.  Below is my code that is running the query.</p>\n\n<pre><code>Dim zamnt As Integer = WopartsDataGridView.Rows(e.RowIndex).Cells(e.ColumnIndex).Value\nDim zcomp As Integer = gridRow.Cells(0).Value\n\nDim con As New SqlConnection\nDim cmd As New SqlCommand\nTry\n  con.ConnectionString = \"Data Source=MNT-MGR-2\\SQLEX;Initial Catalog=MT;Integrated Security=True\"\n  con.Open()\n  cmd.Connection = con\n  cmd.CommandText = \"UPDATE dbo.sparts SET [dbo.sparts.QtyonHand] = [dbo.sparts.QtyonHand] - zamnt WHERE [ComponentID] = zcomp\"\n  cmd.ExecuteNonQuery()\nCatch ex As Exception\n  MessageBox.Show(\"Error while updating record on table...\" &amp; ex.Message, \"Update Records\")\nFinally\n  con.Close()\n  gridRow.Cells(4).Value = \"Yes\"\nEnd Try\n</code></pre>\n\n<p>I have tried it several different ways.  It works just fine if I take out the zamnt and zcomp and put the actual number values that are in the variables.  Please help I've been searching all day for a way to use the variables with this update query.\nThanks,\nStacy</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","geospatial","spatial"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13259215,"title":"STintersects() to find the Intersection point","body":"<p>I have two geometry which I am using to check if they intersect and if they do I need the intersection point.</p>\n\n<p>Currently I can get only Boolean output where if it intersects = 1 and if it does not intersect it will give =0 . Is there any way I can find the intersection of two shapes in geometry?</p>\n\n<p>Cheers,</p>\n"},{"tags":["asp.net","sql","sql-server-2008","compression","sharpziplib"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13202578,"title":"Most Space-Efficient Way to Store a Byte Array in a Database Table - ASP.NET","body":"<p>Right now we have a database table (SQL Server 2008 R2) that stores an uploaded file (PDF, DOC, TXT, etc.) in an image type column. A user uploads this file from an ASP.NET application. My project is to get a handle on the size at which this table is growing, and I've come up with a couple of questions along the way.</p>\n\n<ol>\n<li><p>On the database side, I've discovered the image column type is supposedly somewhat depreciated? Will I gain any benefits to switching over to varbinary(max), or should I say varbinary(5767168) because that is my file size cap, or might as well I just let it stay as an image type as far as space-efficiency is concerned?</p></li>\n<li><p>On the application side, I want to compress the byte array. Microsoft's built in GZip sometimes made the file bigger instead of smaller. I switched over to SharpZipLib, which is much better, but I still occasionally run into the same problem. Is there a way to find out the average file compression savings before I implement it on a wide scale? I'm having a hard time finding out what the underlying algorithm is that they use.</p></li>\n<li><p>Would it be worth writing a Huffman code algorithm of my own, or will that present the same problem where there is occasionally a larger compressed file than original file?</p></li>\n</ol>\n\n<p>For reference, in case it matters, here's the code in my app:</p>\n\n<pre><code>    using ICSharpCode.SharpZipLib.GZip;\n\n    private static byte[] Compress(byte[] data)\n    {\n        MemoryStream output = new MemoryStream();\n\n        using (GZipOutputStream gzip = new GZipOutputStream(output))\n        {\n            gzip.IsStreamOwner = false;\n            gzip.Write(data, 0, data.Length);\n            gzip.Close();\n        }\n        return output.ToArray();\n    }\n\n    private static byte[] Decompress(byte[] data)\n    {\n        MemoryStream output = new MemoryStream();\n        MemoryStream input = new MemoryStream();\n        input.Write(data, 0, data.Length);\n        input.Position = 0;\n\n        using (GZipInputStream gzip = new GZipInputStream(input))\n        {\n            byte[] buff = new byte[64];\n            int read = gzip.Read(buff, 0, buff.Length);\n\n            while (read &gt; 0)\n            {\n                output.Write(buff, 0, read);\n                read = gzip.Read(buff, 0, buff.Length);\n            }\n\n            gzip.Close();\n        }\n        return output.ToArray();\n    }\n</code></pre>\n\n<p>Thanks in advance for any help. :)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":8,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1591,"score":5,"question_id":9740256,"title":"How to compare if two strings contain the same words in T-SQL for SQL Server 2008?","body":"<p>When I compare two strings in SQL Server, there are couple of simple ways with <code>=</code> or <code>LIKE</code>.</p>\n\n<p>I want to redefine equality as:  </p>\n\n<p><em>If two strings contain the same words - no matter in what order - they are equal, otherwise they are not.</em></p>\n\n<p>For example:  </p>\n\n<ul>\n<li><code>'my word'</code> and <code>'word my'</code> are equal</li>\n<li><code>'my word'</code> and <code>'aaamy word'</code> are not</li>\n</ul>\n\n<p>What's the best simple solution for this problem?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13256877,"title":"SQL Server Customize Templates beyond Grid","body":"<p>How can I add custom sql commands to the default templates(used for <code>Script Table as...</code>)?</p>\n\n<p>Instead of:</p>\n\n<pre><code>UPDATE DB.dbo.table SET col1 = 'test'\n</code></pre>\n\n<p>I would like to have:</p>\n\n<pre><code>BEGIN TRANSACTION\n    UPDATE DB.dbo.table SET col1 = 'test'\nROLLBACK TRANSACTION\n</code></pre>\n\n<p>Or any custom code really. </p>\n\n<p>I did look at the <a href=\"http://stackoverflow.com/questions/1681645/change-default-template-in-sql-server-management-studio\">Change default template in SQL Server Management Studio</a> question, but it didn't allow for custom sql. It allowed you to set predefined properties.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13256336,"title":"fill empty column with sequence","body":"<p>Is there any way to fill an empty column with a ascending sequence of numbers starting from 1, without using identity?</p>\n\n<p>I tried the following cursor but it is filling the same value (450) for all rows in the column:</p>\n\n<pre><code>declare cur3 cursor for\nselect new_id from sheet1$\ndeclare @no int\ndeclare @no1 int\nset @no1 = 1\nopen cur3\nfetch next from cur3 into @no\nwhile(@@FETCH_STATUS = 0)\nbegin\nupdate sheet1$ set new_id = @no1\nset @no1 = @no1 + 1\nfetch next from cur3 into @no\nend\nclose cur3\ndeallocate cur3\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13207075,"title":"Format a number with commas but without decimals in SQL Server 2008 R2?","body":"<p>I am using the following to create a comma formatted number in T-SQL. How can I get rid of the decimal point and the digits after decimal. So if I get 1,112.00 after formatting, how would I get only 1,112?</p>\n\n<pre><code>SELECT CONVERT(varchar, CAST(1112 AS money), 1)\n</code></pre>\n"},{"tags":["mysql","sql-server","sql-server-2008","sql-server-2008-r2","mysql-workbench"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":289,"score":0,"question_id":11619177,"title":"SQL Server 2008 R2 to MySQL Migration","body":"<p>Is there a GUI tool out there that will allow me to migrate entire SQL Server 2008 R2 databases to MySQL?  I have MySQL Workbench installed, but it looks like there isn't a feature in it like SSIS to copy and paste entire databases from SQL Server.  I downloaded the MySQL Migration Toolkit, but it is no longer supported and I get a Java error when running it.</p>\n"},{"tags":["sql-server-2008","asp.net-web-api"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13253579,"title":"Connecting Web API to SQL server 2008","body":"<p>I am fairly new to .net MVC 4 and WEB API. I need to connect my web API to SQL server 2008 but I'm not sure how exactly. I'll I have seen is examples using the local DB and I can't seem to find my solution. </p>\n"},{"tags":["sql","xml","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13225424,"title":"Insert elements/values into specific child element of XML column in t-sql","body":"<p>In SQL Server 2008, I would like to insert some elements and values into a specific child element of an xml column based on the value of another of that element's children (ID in this case). The xml currently looks like this: </p>\n\n<pre><code>&lt;Profile&gt;\n  &lt;ID&gt;16&lt;/ID&gt;\n  &lt;User&gt;\n    &lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;\n    &lt;Name&gt;test&lt;/Name&gt;\n    &lt;Activities /&gt;\n  &lt;/User&gt;\n&lt;/Profile&gt;\n</code></pre>\n\n<p>However, there could potentially be multiple <code>&lt;User&gt;</code> elements within the xml, and I need to insert only into the <code>&lt;User&gt;</code> of a specific <code>&lt;ID&gt;</code> value. How can I achieve this in MS SQL Server 2008/ t-sql? Thanks in advance.</p>\n\n<p><strong>Edit:</strong>\nTo simplify, I am grabbing the xml from that column and setting it to a variable:</p>\n\n<pre><code>DECLARE @profiles_xml xml\nDECLARE @profile_id int\nSET @profile_id = 16\nSET @profiles_xml = (SELECT profiles from tbl_applied_profiles WHERE\nprofiles.value('(Profile/ID)[1]','int')= @profile_id)\n</code></pre>\n\n<p>The resulting xml value of @profiles_xml looks like what I have above.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":33,"score":0,"question_id":13237477,"title":"How do I retrieve decimals when rounding an average in SQL","body":"<p>Here is my SQL statement</p>\n\n<pre><code>SELECT ROUND(AVG(column_name), 100) \nFROM [database].[dbo].[table]\n</code></pre>\n\n<p>The answer I retrieve is <code>3</code> with a possible range of numbers between <code>1 - 5</code> in 908 rows.</p>\n\n<p>I need it to say <code>3.0</code> or <code>3.09</code>. Is this possible?</p>\n"},{"tags":["c#","sql-server-2008","loginview"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13254969,"title":"LoginView Password Recovery in Razor View Engine","body":"<p>I have a website I built in MVC4 in razor view engine.  I moved the database tables that were doing the encryption from the local database to our production database and changed the web.config file to adjust for this change.  It now works fine, but I need to recover passwords.  SO I end up having hashed passwords.  Is there any way to translate it to recover the password?</p>\n"},{"tags":["c#","sql-server-2008","paging"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13240121,"title":"What is the equivalent of this code in c# to pass the start and limit variable to query for paging","body":"<pre><code>$result=mysql_query (\"SELECT * FROM strawhats ORDER BY id LIMIT \".$_POST['start'].\", \".$_POST['limit'].\"\") or die (mysql_error ());\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/13235286/how-to-page-data-according-to-pagingtoolbars-request\">This is my original post</a>... basically I am trying to make my pagingtoolbar work in extjs... but can't get it right... please help</p>\n\n<p>this is where I am trying to incorporate that code into c#</p>\n\n<pre><code>string sqlquery = \"SELECT Q1, Q2, Q3, Q4, Improvements, Comments FROM ITable\";\nconn.Open();\nSqlDataAdapter cmd = new SqlDataAdapter(sqlquery, conn);\nSqlCommand comd = new SqlCommand(sqlquery, conn);\nDataSet myData = new DataSet();\ncmd.Fill(myData, \"myTable\");\n\ncomd.CommandText = \"SELECT COUNT(*) FROM ITable\";\nInt32 count = (Int32)comd.ExecuteScalar();\n\ncomd.ExecuteNonQuery();\nconn.Close();\n\n\nvar results = (new\n\n{\n\n    TotalNumber = count,\n\n    myTable = myData\n\n});\n\nreturn JsonConvert.SerializeObject(new { count=count, myTable = myData.Tables[0] }, Formatting.Indented,\n                new JsonSerializerSettings\n                {\n                    ReferenceLoopHandling = ReferenceLoopHandling.Ignore\n                });\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":11110775,"title":"How to generate table name by datetime?","body":"<p>I realize this is syntactically bad but I figure it somewhat explains what I'm trying to do. Essentially, I have a batch job that is going to run each morning on a small table and as a part of the spec I need to create a backup prior to each load that can be accessed by a report.</p>\n\n<p>What I have so far is:</p>\n\n<pre><code>select  *\ninto    report_temp.MSK_Traffic_Backup_ + getdate()\nfrom    property.door_traffic\n</code></pre>\n\n<p>How can I make this function or should I consider doing this a better way?</p>\n"},{"tags":["sql-server-2008","dts"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13237352,"title":"Check and transfer data between two databases in same server using complex conditions","body":"<p>Source DB1.TB1 [<code>ID, EAN, ASIN, NAME, CONDITION</code>]</p>\n\n<pre><code> 1,1001,20001,ps2,COD2,new\n 2,1002,20002,xbox,HOLA,new\n 3,1003,20003,xbox,Spider Man,used\n</code></pre>\n\n<p>and DB1.TB2 [<code>ID, PRICE</code>] </p>\n\n<pre><code> 1,50 \n 2,51\n 3,61\n</code></pre>\n\n<p>Destination DB2.TB1 [<code>ID2, KID, EAN, GROUP, NAME, CONDITION, PRICE, DATE</code>]</p>\n\n<pre><code>         1,0013,10001,ps2,COD2,new\n         2,0015,10002,xbox,HOLA,new\n         3,0016,10003,xbox,Spider Man,used\n</code></pre>\n\n<p>Now I need to transfer the data from source table to destination table with some conditions:</p>\n\n<ul>\n<li><p><code>ID</code>is same for DB1 for both the tables, <code>KID</code> is the actual \"ID\" we refer to in the organization. \neach item without this ID should be updated with <code>kID_max + 1</code>.</p></li>\n<li><p>The shipping price of each item depends upon its <code>KID</code> name. So the products must be \ncategorised according to this as well which are dependent upon the name index such as ps2 or xbox. </p></li>\n</ul>\n\n<p>As a beginner,it seems too complex, I would like to know some information on how shall I approach to solve this issue.</p>\n\n<p>Note: The tables in DB1 are regularly updated so the DB2 table must also be updated accordingly on regular basis.  </p>\n"},{"tags":["asp.net","visual-studio-2010","sql-server-2008","vb.net-2010"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13253952,"title":"Visual Studio 2010 TextBox with TextMode set to 'MultiLine'","body":"<p>I have a series of <code>TextBox</code> controls on a web form that have the <code>TextMode</code> property set to <code>MultiLine</code>.</p>\n\n<p>Within these boxes the users could write a number of paragraphs seperated by line spaces.  </p>\n\n<p>In my database (SQL 2008) this is added to the system as <code>varchar(max)</code> and in turn this adds the data entered as one line of data without the paragraphs separated by line spaces.</p>\n\n<p>The webform also enables the user to send the data from the web page as an email to a number of users.  As the data is stored in SQL as one line of data, this is displayed in the email as one line of data and not separate paragraphs.</p>\n\n<p>Is there something I need to change in VS2010 or in SQL to get the email notification to have separate paragraphs of data instead of just one line of data?</p>\n\n<p>Any help much appreciated.</p>\n"},{"tags":["sql-server-2008","transaction-log","transactional-replication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4,"score":1,"question_id":13253240,"title":"Log Reader Agent in transactional replication scanning large transaction log during recurring job causing latency","body":"<p>We just implemented a new job on a medium traffic database involved in transactional replication, that will process inputs from an Excel spreadsheet and call a stored procedure to create records within various tables in that DB.  </p>\n\n<p>One of the fields involved is a text data type that can range from 10k-30k characters. Within the job, a custom SQL server function parses out a URL from the large HTML body and writes it to a table.  </p>\n\n<p>Due to the intensive nature, or what seems to be that of the process, we only process 35 records or rows from the spreadsheet per job execution every half hour. What we are seeing is that the transaction log is growing at an alarming rate and is thus causing considerable latency from the publisher to the subscriber because the log reader agent scans the entire transaction log and finds 0 records for replication.  </p>\n\n<p>To put it into perspective, the log sits around 30GB in size, and cannot be much smaller because running the job 5-6 times will grow it past that size. We are doing frequent backups of the distribution database (every 5 minutes) and the transaction log every 15.  </p>\n\n<p>We are in dire need of a solution where we can decrease the latency, or decrease the amount of reading (I/O) from the log. I realize that there could be work that needs to be done on the app/job side, but is there anything within the replication configuration that can be done to help with this latency and wasted scanning from the log?  </p>\n\n<p>Any help would be much appreciated.  Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13252987,"title":"Inner Join two table-Valued Parameters doesn't work","body":"<p>I am trying to 'inner join' two table values parameters but when i execute the query it takes for ever and i have to stop debug in ms sql server management studio 2008.</p>\n\n<p>The query:</p>\n\n<pre><code>    @allClients [dbo].[ImportedClients] READONLY,\n    @NewClients [dbo].[ImportedClients] READONLY\n\n--Update Clients table in db with new clients\n\n    UPDATE [dbo].[Clients]\n        SET \n\n            Email = ISNULL(ct.Email, x.Email), \n            FirstName = ISNULL(ct.FirstName, x.FirstName), \n            LastName = ISNULL(ct.LastName, x.LastName), \n            Telephone = ISNULL(ct.Telephone, x.Telephone), \n            Cellphone = ISNULL(ct.Cellphone, x.Cellphone), \n\n\n\n        FROM @NewClients ct\n        inner join @allClients x \n        ON (x.Email = ct.Email)     \n\n        WHERE ct.Status &gt; -1 \n</code></pre>\n\n<p>What i am trying to do is: Update all the clients information for rows that exist in both @NewClients and @allClients so i used inner join. \nIs it possible to JOIN two  table-Valued Parameters?\nThis query doesn't (query doesn't complete without an error) work even with a few rows.</p>\n\n<p>any suggestions?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13253259,"title":"SQL Server Replace Command with WIldcard","body":"<p>I am in need of some help. Thanks to fellow user davids, I was able to get certain things working within SQL Server and am in need of some more help. Here is what I am trying to do:</p>\n\n<pre><code>UPDATE Table1 SET keyfield=(REPLACE(REPLACE(Column1,'http://*/folder/',''),'.avi',''))\nUPDATE Table2 SET keyfield=(REPLACE(REPLACE(Column2,'http://server2/folder/',''),'.mpg',''))\n</code></pre>\n\n<p>Can anyone help me out or point me in the right direction to get the wildcard to work? This particular column, the * is an IP Address and it will change all the time. Granted I will know the IP's ahead of time and can probably do it one by one, but I would prefer to have it automatically replace. Thanks in advance!</p>\n"},{"tags":["sql","sql-server-2008","csv"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13252580,"title":"Importing a CSV into SQL when there is a \",\" in the field","body":"<p>I need to import a CSV into a SQL 2008 database.  One of the fields is a directory, and apparently there are over 1600 rows that have a \",\" in the field name.  This field is now broken out incorrectly in my database.  There are over 100000 rows total.</p>\n\n<p>How can I avoid this and modify my statement?</p>\n\n<p>Here is the creation of the table:</p>\n\n<pre><code>create table tablename\n(\nDirectory       varchar(1000),\nName            varchar(1000),\nSize            varchar(50),\nCreationTime    varchar(100),\nLastAccessTime  varchar(100),\nLastWriteTime   varchar(100)\n)\n</code></pre>\n\n<p>Below is the code I used to import it:</p>\n\n<pre><code>BULK\nINSERT tablename\nFROM 'c:\\EmailCSVs\\myfile.csv'\nWITH\n(\nFIRSTROW = 2,\nFIELDTERMINATOR = ',',\nROWTERMINATOR = '\\n'\n)\nGO\n</code></pre>\n\n<p>An example in the directory field looks like this:</p>\n\n<pre><code>\\\\drive\\share\\nightly.175\\savemail\\user\\(Monday, January 10, 2011, 500 PM)\n</code></pre>\n\n<p>And here is an example row in the CSV:</p>\n\n<pre><code>\"\\\\drive\\share\\nightly.175\\savemail\\user\\(Monday, January 10, 2011, 500 PM)\",\"Archive #1.1.pst\",\"271360\",\"1/14/2011 8:37:05 AM\",\"6/1/2011 12:00:38 AM\",\"1/14/2011 2:45:27 PM\"\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","truncate","transaction-log"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13252899,"title":"Is there a congruent command to truncate for re-filling a table?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/6266450/minimally-logged-insert-into\">Minimally Logged Insert Into</a>  </p>\n</blockquote>\n\n\n\n<p>I have a staging table that I'm going to truncate because a truncate isn't logged. Is there a flag that I can apply to the insert statement (or an alternate statement) so that refilling it will also not be logged in MS SQL Server?</p>\n"},{"tags":["asp.net-mvc","sql-server-2008","entity-framework","entity-framework-4","asp.net-mvc-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13252472,"title":"Entity Framework import and use stored procedure which returns different result sets depending on input","body":"<p>I am working on a migration project, where I am migrating an web forms app to a ASP.NET MVC 4 app.</p>\n\n<p>I have come across this one scenario with which I need a little help.</p>\n\n<p>In the old web form project I have stored proc like...</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[TestMultipleResultSet]\n    @input VARCHAR\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    IF NOT EXISTS\n    (\n        SELECT * FROM Electronics\n        WHERE name = @input\n    )\n    BEGIN\n        SELECT 101 AS errorcode\n        RETURN\n    END\n\n    SELECT * FROM Electronics \n    WHERE name = @input\nEND\n</code></pre>\n\n<p>like the above <code>if not exist</code> check, there are many other checks with gives different <code>select * from</code> as resultset.</p>\n\n<p>Now I want to use Entity framework to execute this stored procedure, so I imported the function and created a complex type using the <code>Get Column Information</code> + <code>Create Complex Type</code> option which EF provides.</p>\n\n<p>Now it runs when I enter a valid @input which executes <code>SELECT * FROM Electronics WHERE name = @input</code> but when I enter an input which is not present instead of returning me a 101 error code it gives me an error. An exception is thrown.</p>\n\n<p>Exception details</p>\n\n<blockquote>\n  <p>The data reader is incompatible with the specified 'testEFModel.GetTestResults_Result1'. A member of the type, 'id', does not have a corresponding column in the data reader with the same name.</p>\n</blockquote>\n\n<p>How should I solve this ?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":2,"view_count":33,"score":1,"question_id":13251309,"title":"I need a detailed step by step method to build a cursor in SQL Server","body":"<p>This is a cursor I am using, but I'd like to understand it and write my own.</p>\n\n<pre><code>ALTER FUNCTION [dbo].[ConvertToTable1] (@list nvarchar(MAX))\n   RETURNS @tbl TABLE (number varchar(1024) NOT NULL) AS\nBEGIN\n   DECLARE @pos        int,\n           @nextpos    int,\n           @valuelen   int\n\n   SELECT @pos = 0, @nextpos = 1\n\n   WHILE @nextpos &gt; 0\n   BEGIN\n      SELECT @nextpos = charindex('.', @list, @pos + 1)\n      SELECT @valuelen = CASE WHEN @nextpos &gt; 0\n                              THEN @nextpos\n                              ELSE len(@list) + 1\n                         END - @pos - 1\n      INSERT @tbl (number)\n         VALUES (convert(int, substring(@list, @pos + 1, @valuelen)))\n      SELECT @pos = @nextpos\n   END\n   return\nend \n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13250660,"title":"query the second table with the result of first","body":"<p>I need to bind two tables into a dataset. I have three table named, Students, StudentMarks.</p>\n\n<p>Here if I know the studentId I can query the student table like</p>\n\n<pre><code>DataSet ds=new DataSet();\n\nSqlCommand cmd=new SqlCommand(\"\nSELECT * \nFROM STUDENTS\nWHERE STUDENTID=1; \nSELECT *\nFROM STUDENTS\nWHERE STUDENTID=1\");\n\nSqlDataAdapter da=new SqlDataAdapter(cmd);\nda.Fill(ds);\n</code></pre>\n\n<p>like this. So that I can access these two tables like ds.Table[0] and ds.Table[1].</p>\n\n<p>But my question is, if I dont know the studentid and if I want to query all the students as well as their marks and I've to get these details in two different tables how can I get?</p>\n\n<p>If I join these two tables, the result will be in a single table, I dunno how to do this, can anyone help me out here? thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","guid","entropy"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":23,"score":-1,"question_id":13251251,"title":"SQL Server 2008 GUID generation","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/3242287/how-are-guids-generated-in-sql-server\">how are GUIDs generated in SQL Server?</a>  </p>\n</blockquote>\n\n\n\n<p>I wonder how SQL Server 2008 GUIDs are generated? Entropy bits</p>\n"},{"tags":["sql","sql-server","sql-server-2008","join","duplicate-removal"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":13250247,"title":"Join Tables SQL Server with duplicates","body":"<p>I have a table </p>\n\n<pre><code>col1\n\n1\n2\n</code></pre>\n\n<p>and other table </p>\n\n<pre><code>col1    col2    col3\n\n1          1    data value one                                    \n1          2    data value one                                    \n2          3    data value two   \n</code></pre>\n\n<p>and I want to join both tables to obtain the following result</p>\n\n<pre><code>col1  col2  col3\n\n1       1    data value one\n2       3    data value two\n</code></pre>\n\n<p>The second table have duplicates but I need to join only one (randomly). I've tried with Inner Join, Left Join, Right Join and always returns all rows. Actually I use <code>SQL Server 2008</code>.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":30,"score":2,"question_id":13249936,"title":"Add a column to a table with a default value equal to the value of an existing column","body":"<p>How to add a column to a SQL Server table with a default value that is equal to value of an existing column?</p>\n\n<p>I tried this but its giving an error </p>\n\n<blockquote>\n  <p><em>The name \"oldcolumn\" is not permitted in this context. Valid\n  expressions are constants, constant expressions, and (in some\n  contexts) variables. Column names are not permitted.</em></p>\n</blockquote>\n\n<p>T-SQL statement:</p>\n\n<pre><code>ALTER TABLE tablename \nADD newcolumn type NOT NULL DEFAULT (oldcolumn) \n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":23,"score":2,"question_id":13248659,"title":"Round the third decimal place up into the second decimal place (e.g. $0.033 becomes $0.04)","body":"<p>When we increased the price with 10%, some products (the ones that have 3 decimal points), got an unwanted price change. For example, an item that had a price of <code>0.03</code> changed to <code>0.033</code>. </p>\n\n<p>Our client doesn't want a three decimal point in the pricing. </p>\n\n<p>We want to round the third decimal place up into the second decimal place (e.g. <code>$0.033</code> becomes <code>$0.04</code>).</p>\n\n<p>If my value is <code>0.033</code>, I want result to be <code>0.04</code>.</p>\n\n<p>Please help me</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["c#","sql-server-2008","excel"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13249804,"title":"import the updated excel value to database","body":"<p>I have a large amount of data in a excel sheet which has about 2000 rows. I have imported the table in sql server with no error. \nI have to modify the excel now and update the same changes in the database also. \nI cant delete the table and import again since i have large amount of data and have extra columns added to it. </p>\n\n<p>So Please help me how to update the new values along with the existing values. I use C#.Net. </p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","c#-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13248143,"title":"C# how to insert null value for foreign key into SQL","body":"<p>I have one table Documentation that has foreign keys to 3 other tables. This table, Documentation, should contain documents for different subjects (glass, aircraft and project). I didn't wan't to create 3 tables (table for documents for glass, another table for aircraft documents etc) so I created just one table that will have a reference(foreign keys) to other tables (Glass, Aircraft and Project tables). First of all, I'm not sure if this is a good solution...</p>\n\n<p>Anyway, problem is the following: I want to insert document that refers to glass. This means that foreign keys for Aircraft and Project will be null. Database columns accept null values.\nIf I try to insert null values for those foreign keys (AircraftFK and ProjectFK) it does not allow me to do that. It's asking me to insert appropriate value for foreign key that already exists as primary key in tabel Aircraft and Project.</p>\n\n<p>These foreign keys (AircraftfK and ProjectFK) HAVE TO BE NULL because the document that I'm inserting has nothing to do with aircraft and project.</p>\n\n<p>I'm programming in c# and using Sql Server 2008.</p>\n\n<p>How can I solve this?</p>\n\n<p>Thank you all</p>\n\n<p>Here are some more info:</p>\n\n<p>this is my sql command:</p>\n\n<pre><code>komanda = new SqlCommand(\"insert into Documentation (GlassFK, FaiFK, ProjectOrderFK, OrderNumberFK, DocPath, DocName, DocSize, DocType, DocumentFile) values (@GlassFK, @FaiFK, @ProjectOrderFK, @OrderNumberFK, @DocPath, @DocName, @DocSize, @DocType, @DocumentFile)\", konekcija);\n\n        for (int i = 0; i &lt; listaDokumenata.Count; i++)\n        {\n            komanda.Parameters.Clear();\n            komanda.Parameters.AddWithValue(\"@GlassFK\", listaDokumenata[i].GlassFK);\n            komanda.Parameters.AddWithValue(\"@FaiFK\", listaDokumenata[i].FaiFK);\n            komanda.Parameters.AddWithValue(\"@ProjectOrderFK\", listaDokumenata[i].ProjectOrderFK);\n            komanda.Parameters.AddWithValue(\"@OrderNumberFK\", listaDokumenata[i].OrderNumberFK);\n            komanda.Parameters.AddWithValue(\"@DocPath\", listaDokumenata[i].PutanjaFajla);\n            komanda.Parameters.AddWithValue(\"@DocName\", listaDokumenata[i].ImeFajla);\n            komanda.Parameters.AddWithValue(\"@DocSize\", listaDokumenata[i].VelicinaFajla);\n            komanda.Parameters.AddWithValue(\"@DocType\", listaDokumenata[i].Ekstenzija);\n            komanda.Parameters.AddWithValue(\"@DocumentFile\", listaDokumenata[i].Fajl);\n</code></pre>\n\n<p>and here is c# code for creating document object:</p>\n\n<pre><code>Document sf = new Document();\n                    sf.PutanjaFajla = putanjaFajla;\n                    sf.ImeFajla = imeFajla;\n                    sf.Ekstenzija = ekstenzija;\n                    sf.VelicinaFajla = velicinaFajla;\n                    sf.Fajl = wordFile;\n                    sf.FaiFK = 5;\n                    sf.GlassFK = 0;\n                    sf.ProjectFK = null;\n                    sf.ProjectOrderFK = 0;\n</code></pre>\n\n<p>This means that this document will refer to Glass. All other foreign keys has to be 0 or null (depends on a attribute type in sql)</p>\n\n<p>So, here is the error that I get:</p>\n\n<p>The parameterized query '(@GlassFK int,@FaiFK int,@ProjectOrderFK int,@OrderNumberFK nvar' expects the parameter '@OrderNumberFK', which was not supplied.</p>\n\n<p>OrderNumberID is the primary key of table Project. Its foreign keys is OrderNumberFK</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13246561,"title":"select data vice versa","body":"<p>I have two table in my database.</p>\n\n<pre><code>1) User Table\n\nid  username    password    logo    email\n1   admin        admin      NULL    1   \n2   support     support     NULL    NULL    \n3   test        test        NULL    NULL    \n\n\n2) Link Account Table\n\nID  AccountID   LinkAccountID\n1       1           2\n</code></pre>\n\n<p>Now if i select username with accountid 1 then it will return me Admin and Support\n    same way if i select username with accountid 2 then also it will return admin and support\n    and if i select username with accountid 3 then it will return only test</p>\n\n<p>something like vice versa if in link account table account id is 1 or linkaccountid is 1 that will return both id</p>\n\n<p>Thanks in advance</p>\n\n<p>Regards</p>\n\n<p>Amit Vyas</p>\n"},{"tags":["sql-server-2008","asp.net-mvc-4","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13245335,"title":"Entity Framework type case generic in predicate","body":"<p>I am working on updating to a more manageable repository pattern in my MVC 4 project that uses Entity Framework code first. I've integrated a generic base repository class that will do basic CRUD operations so I don't have to implement these in each repository I create. I have ran into an issue where my All method needs to filter there query by a deleted flag if the entity is a type of TrackableEntity. Since the Entity is generic in the base repository I am attempting to cast is to a type of TrackableEntity in the where which just results in the following error message.</p>\n\n<blockquote>\n  <p>The 'TypeAs' expression with an input of type 'NameSpace.Models.ClientFormField' and a check of type 'NameSpace.Models.TrackableEntity' is not supported. Only entity types and complex types are supported in LINQ to Entities queries.</p>\n</blockquote>\n\n<p>This error makes complete since and I understand why the code I have is not working but I am trying to find a way to filter out deleted items without having to override this method in all of my repositories. The code I have for my All method is below.</p>\n\n<pre><code>public virtual IEnumerable&lt;T&gt; All()\n{\n    if (typeof(T).IsSubclassOf(typeof(TrackableEntity)))\n        return dbSet.Where(e =&gt; !(e as TrackableEntity).IsDeleted).ToList();\n\n    return dbSet.ToList();\n}\n</code></pre>\n\n<p>I know that I can do the following</p>\n\n<pre><code>public virtual IEnumerable&lt;T&gt; All(Expression&lt;Func&lt;T, bool&gt;&gt; predicate = null)\n{\n    if (predicate != null)\n        return dbSet.Where(predicate).IsDeleted).ToList();\n\n    return dbSet.ToList();\n}\n</code></pre>\n\n<p>And then add this to all of my repositories</p>\n\n<pre><code>public override IEnumerable&lt;CaseType&gt; All(Expression&lt;Func&lt;CaseType,bool&gt;&gt; predicate = null)\n{\n    if (predicate == null)\n        predicate = e =&gt; !e.IsDeleted;\n    return base.All(predicate);\n}\n</code></pre>\n\n<p>The problem I have with this is that I am duplicating code, this is basically a copy and paste into all of my repositories which defeats the purpose of changing to this new repository pattern. I made the switch to end duplicated code in my repositories.</p>\n\n<p>Here is an example of one of my entities.</p>\n\n<pre><code>public class CaseType : TrackableEntity, IValidatableObject\n{\n    public int Id { get; set; }\n    public string Name { get; set; }\n\n    public bool InUse { get; set; }\n\n    public bool IsValid { get { return !this.Validate(null).Any(); } }\n\n    public IEnumerable&lt;ValidationResult&gt; Validate(ValidationContext validationContext)\n    {\n        if (String.IsNullOrEmpty(Name))\n            yield return new ValidationResult(\"Case Type name cannot be blank\", new[] { \"Name\" });\n\n        //Finish Validation Rules\n    }\n}\n</code></pre>\n\n<p>And the TrackableEntity</p>\n\n<pre><code>public abstract class TrackableEntity\n{\n    public bool Active { get; set; }\n    public bool IsDeleted { get; set; }\n    public virtual User CreatedBy { get; set; }\n    public virtual User ModifiedBy { get; set; }\n    public DateTime DateCreated { get; set; }\n    public DateTime DateModified { get; set; }\n}\n</code></pre>\n\n<p>Any help on this would be much appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13245044,"title":"corelated query","body":"<p>I have a table where I have some records as follows <br/></p>\n\n<pre><code>Model            Make            Color\n==================================================\nMaruti 800       2008            Black\nMaruti 800       2009            White\nMaruti Esteem    2000            Yelow\nMaruti Esteem    2010            Red\n</code></pre>\n\n<p>Now I want the Model, Make and Color which has maximum make in the list.<br/>\nI have tried writing query like this<br/></p>\n\n<pre><code>SELECT \n     Model,\n     MAX(Model),\n     Color\nfrom \n     tableName\nGROUP BY \n     Model,\n     Color\n</code></pre>\n\n<p>But the result are not coming which I would like<br/>\nIt should be like</p>\n\n<pre><code>Model            Make            Color\n===================================================\nMaruti 800       2009            White    \nMaruti Esteem    2010            Red\n</code></pre>\n\n<p>But the result is the whole table.</p>\n\n<p>I need only those record which has max Make Model Wise.<br/>\nI have also tried inner Query (co-related query) But in that also it is asking for group by.</p>\n"},{"tags":["sql-server-2008","migration","sql-server-2000"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":7500,"score":2,"question_id":5620269,"title":"Migrate from sql server 2000 to 2008 r2 - how to","body":"<p>I have a database working on SQL Server 2000. We are now migrating to a new server with SQL Server 2008 r2. Can anyone please point me to some resource or howto?\nI'm not really finding my way around SQL 2000.</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","transactions","rollback"],"answer_count":0,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":13246038,"title":"which is better approach for roll back transaction in sql server?","body":"<p>I came to know we can go for roll back transaction using \"<strong>set xact_abort on</strong>\"\ni want to know which is the better way for roll back transaction: use \"set xact_abort on\" or simple the following code</p>\n\n<pre><code>begin try\nbegin tran\n-- statements \ncommit tran\nend try\nbegin catch\nrollback tran\nend catch\n</code></pre>\n\n<p>Please help me to choose which is better approach while inserting number of records one time.</p>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005","c#-4.0","asp.net-webforms"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13245321,"title":"DataTableMapping using adapter.FillSchema method applied on a Stored Procedure","body":"<p>this is a method i was reading about  @MSDN , \nmy question is if for an example i would like to use it on a stored procedure \nwith the fact that the query of that stored procedure is already specifying columns to select from the table like following :</p>\n\n<pre><code>SELECT Columnsome, columnother, , , , ...FROM thisSQLdbTable\n</code></pre>\n\n<p>though i would like to implement the approach of that specific method , it seems very advanced from a little research i have made on \n <strong>\"the best way\"</strong> available to extract data from SQL Server into Asp.net DataTable.</p>\n\n<pre><code>public static DataTable GetCustomerData(string dataSetName,\nstring connectionString)\n{\nDataTable table = new DataTable(dataSetName);\n\nusing (SqlConnection connection = new SqlConnection(connectionString))\n{\n    SqlDataAdapter adapter = new SqlDataAdapter(\n        \"SELECT CustomerID, CompanyName, ContactName FROM dbo.Customers\", connection);\n\n    DataTableMapping mapping = adapter.TableMappings.Add(\"Table\", \"Customers\");\n    mapping.ColumnMappings.Add(\"CompanyName\", \"Name\");\n    mapping.ColumnMappings.Add(\"ContactName\", \"Contact\");\n\n    connection.Open();\n\n    adapter.FillSchema(table, SchemaType.Mapped);\n    adapter.Fill(table);\n    return table;\n}\n</code></pre>\n\n<p>}</p>\n\n<p>or is it not the method to use if i am querying via <code>SP</code> that specifies the selected column</p>\n\n<p>i could actually drop that stored procedure if it is not requiered to select /specify columns </p>\n\n<p>the stored procedure is doing a specific calculation and updates the table with results of calculation then i am switching it's \"MODE\" to select results from the table that was updated.</p>\n\n<p>what i did is recyceling (; giving it a parameter (bit type) \nstored procedure then asks for the value of supplied <code>bool</code> / <code>bit</code> Parameter, \nif its is status true it updates (doing its original task it was made for)</p>\n\n<p>if its false its doing a select oporation so i am using it as i would with 2 separated commands </p>\n\n<p><strong>but now</strong> that i have search for a better way to extract data from db into a Data table </p>\n\n<p>i give up on the two way SP and i will make a selection via the exaple above if they're not intended to be used thogether as with my current SP that does preselection when servs the <code>GetCustomersData()</code> above.</p>\n\n<p>So the question is do i need to let the function to make the selection or can i serve it with my sp ready made selection to implemet it with GetCustomersData() in the way that it will only do rest of task and only mapp the columns that was preselected </p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13245451,"title":"Execute the value of a varchar returned from a \"OUTPUT DELETED.[ColumnName]\" statement","body":"<p>I am trying to use a table as a <a href=\"http://rusanu.com/2010/03/26/using-tables-as-queues/\" rel=\"nofollow\">heap queue</a>. However I am having a little trouble figuring out how to take the text that is generated in the dequeue function and perform a execute on it.</p>\n\n<p>Here is the table storing the queue and the dequeue method.</p>\n\n<pre><code>CREATE TABLE [dbo].[Merge_Queued_Work](Sql_Text varchar(2000) NOT NULL)\nGO\n\ncreate procedure usp_dequeueWork\nas\n  set nocount on;\n  delete top(1) from [Merge_Queued_Work] with (rowlock, readpast)\n      output deleted.[Sql_Text];      \ngo\n</code></pre>\n\n<p>How do I get the varchar from <code>deleted.[Sql_Text]</code> to a <code>execute</code> statement?</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":10,"score":1,"question_id":13244007,"title":"Need to throw exception while joining with two table when there is no data in one table","body":"<p>I have two tables test1 and test2 .</p>\n\n<p>I have selected both the table values by joining the two table.</p>\n\n<p>My requirement is that when I join the two table ,suppose if table test1 have data in it and if there is no corresponding data in the test2 table ,then the query should throw exception.</p>\n\n<p>For this what can i do.Did anyone have any idea.</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008","bulkinsert"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":537,"score":3,"question_id":7937581,"title":"Issue with bulk insert","body":"<p>I am trying to insert the data from this link to my SQL server \n<a href=\"https://www.ian.com/affiliatecenter/include/V2/CityCoordinatesList.zip\" rel=\"nofollow\">https://www.ian.com/affiliatecenter/include/V2/CityCoordinatesList.zip</a></p>\n\n<p>I created the table </p>\n\n<pre><code>CREATE TABLE [dbo].[tblCityCoordinatesList](\n[RegionID] [int] NOT NULL,\n[RegionName] [nvarchar](255) NULL,\n[Coordinates] [nvarchar](4000) NULL\n</code></pre>\n\n<p>) ON [PRIMARY]</p>\n\n<p>And I am running the following script to do the bulk insert</p>\n\n<pre><code>BULK INSERT tblCityCoordinatesList\nFROM 'C:\\data\\CityCoordinatesList.txt' \nWITH \n( \n    FIRSTROW = 2, \n    MAXERRORS = 0, \n    FIELDTERMINATOR = '|', \n    ROWTERMINATOR = '\\n'\n)\n</code></pre>\n\n<p>But the bulk insert fails with following error</p>\n\n<pre><code>Cannot obtain the required interface (\"IID_IColumnsInfo\") from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>When I google, I found several articles which says the issue may be with RowTerminator, but I tried everything like /n/r, /n etc, but nothing is working. </p>\n\n<p>Could anyone please help me to insert this data into my database?</p>\n\n<p>Thank you so much for your help.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":13239530,"title":"Using Excel to create a CSV file with special characters and then Importing it into a db using SSIS","body":"<p>Take this XLS file </p>\n\n<p><img src=\"http://i.stack.imgur.com/JT3Wf.jpg\" alt=\"enter image description here\"></p>\n\n<p>I then save this XLS file as CSV and then open it up with a text editor. This is what I see:</p>\n\n<pre><code>Col1,Col2,Col3,Col4,Col5,Col6,Col7\n1,ABC,\"AB\"\"C\",\"D,E\",F,03,\"3,2\"\n</code></pre>\n\n<p>I see that the double quote character in column C was stored as <code>AB\"\"C</code>, the column value was enclosed with quotations and the double quote character in the data was replaced with 2 double quote characters to indicate that the quote is occurring within the data and not terminating the column value. I also see that the value for column G, <code>3,2</code>, is enclosed in quotes so that it is clear that the comma occurs within the data rather than indicating a new column. So far, so good.</p>\n\n<p>I am a little surprised that all of the column values are not enclosed by quotes but even this seems reasonable OK when I assume that EXCEL only specifies column delimieters when special characters like a commad or a dbl quote character exists in the data.</p>\n\n<p>Now I try to use SQL Server to import the csv file. Note that I specify a double quote character as the Text Qualifier character.</p>\n\n<p><img src=\"http://i.stack.imgur.com/dyYxr.jpg\" alt=\"Insert figure 2\"></p>\n\n<p>And a command char as the Column delimiter character. However, note that SSIS imports column 3 incorrectly,eg, not translating the two consecutive double quote characters as a single occurence of a double quote character.</p>\n\n<p><img src=\"http://i.stack.imgur.com/anU00.jpg\" alt=\"enter image description here\"></p>\n\n<p>What do I have to do to get Excel and SSIS to get along? </p>\n\n<p>Generally people avoid the issue by using column delimiter chactacters that are LESS LIKELY to occur in the data but this is not a real solution. </p>\n\n<p>I find that if I modify the file from this</p>\n\n<pre><code>Col1,Col2,Col3,Col4,Col5,Col6,Col7\n1,ABC,\"AB\"\"C\",\"D,E\",F,03,\"3,2\"\n</code></pre>\n\n<p>...to this:</p>\n\n<pre><code>Col1,Col2,Col3,Col4,Col5,Col6,Col7\n1,ABC,\"AB\"C\",\"D,E\",F,03,\"3,2\"\n</code></pre>\n\n<p>i.e, removing the two consecutive quotes in column C's value, that the data is loaded properly, however, this is a little confusing to me. First of all, how does SSIS determine that the double quote between the B and the C is not terminating that column value? Is it because the following characters are not a comma column delimiter or a row delimiter (CRLF)? And why does Excel export it this way?</p>\n\n<p>According to <a href=\"http://tools.ietf.org/html/rfc4180#page-2\" rel=\"nofollow\">Wikipedia</a>, here are a couple of traits of a CSV file:</p>\n\n<ol>\n<li><p>Fields containing line breaks (CRLF), double quotes, and commas\n   should be enclosed in double-quotes.  For example:</p>\n\n<p>\"aaa\",\"b CRLF\n   bb\",\"ccc\" CRLF\n   zzz,yyy,xxx</p></li>\n<li><p>If double-quotes are used to enclose fields, then a double-quote\n   appearing inside a field must be escaped by preceding it with\n   another double quote.  For example:</p>\n\n<p>\"aaa\",\"b\"\"bb\",\"ccc\"</p></li>\n</ol>\n\n<p>However, it looks like SSIS doesn't like it that way when importing. What can be done to get Excel to create a CSV file that could contain ANY special characters used as column delimiters, text delimiters or row delimiters in the data?  There's no reason that it can't work using the approach specified in Wikipedia,. which is what I thought the old MS DTS packages used to do...</p>\n\n<p><strong>Update:</strong></p>\n\n<p>If I use Notepad change the input file to </p>\n\n<pre><code>Col1,Col2,Col3,Col4,Col5,Col6,Col7,Col8\n\"1\",\"ABC\",\"AB\"\"C\",\"D,E\",\"F\",\"03\",\"3,2\",\"AB\"\"C\"\n</code></pre>\n\n<p>Excel reads it just fine </p>\n\n<p><img src=\"http://i.stack.imgur.com/Jw16G.jpg\" alt=\"enter image description here\"></p>\n\n<p>but SSIS returns</p>\n\n<pre><code>The preview sample contains embedded text qualifiers (\"). The flat file parser does not support embedding text qualifiers in data. Parsing columns that contain data with text qualifiers will fail at run time.\n</code></pre>\n"},{"tags":["c#","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":47,"score":2,"question_id":13165719,"title":"Reliably drop a database on SQL Server 2008 via C#","body":"<p>I am currently trying to drop a database via the following code</p>\n\n<pre><code>using Microsoft.SqlServer.Management.Smo;\n\nvar server = new Server(Server);\nserver.KillAllProcesses(\"Db\");\nserver.KillDatabase(\"Db\");\n</code></pre>\n\n<p>Sometimes it works, but others I get the following exception:</p>\n\n<blockquote>\n  <p>Microsoft.SqlServer.Management.Smo.FailedOperationException: Kill database failed for Server 'Host1'.<br>---> Microsoft.SqlServer.Management.Common.ExecutionFailureException: An exception occurred while executing a Transact-SQL statement or batch. <br>---> System.Data.SqlClient.SqlException: Changes to the state or options of database 'Db' cannot be made at this time. The database is in single-user mode, and a user is currently connected to it.</p>\n</blockquote>\n\n<p>Any ideas of how to reliably drop the database via code?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13242261,"title":"sql server query on condition","body":"<p>There is a table:</p>\n\n<pre><code>ID   Name   Rank\n1    X       Professor\n2    X       Principal\n3    X       Term Prof\n4    X       assistant\n</code></pre>\n\n<p>What I want is want to write the stored procedure to select the last professor rank or assistant rank depending on the input. Here is the format of the stored proc:</p>\n\n<pre><code>create procedure proc_name(@includeassistant varchar(3))\n\nend\n</code></pre>\n\n<p>if includeassistant is \"yes\" then assistant then the last row must be displayed if include assistant is no then Term prof row must be given.\n</p>\n"},{"tags":["sql","sql-server","xml","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13242295,"title":"Add elements and attributes to XML column based on criteria?","body":"<p>With the following, I'd like to add <code>../attrdomv/udom/'some text'</code> within each <code>attr</code> node, of which there are many. However, based on the value of <code>attrlab</code>, 'some text' will be different for each element. I hope that makes sense. I initially considered reconstructing the entire xml column, but <code>'many nodes and elements'</code> contains attributes that are specific to a row, and not easy to reproduce prorgammatically. <code>../attrdomv/udom/'some text'</code> will be the same across each row. Here is a snippet of an existing column:</p>\n\n<pre><code>&lt;metadata xml:lang=\"en\"&gt;\n&lt;many nodes and elements&gt;\n  &lt;eainfo&gt;\n    &lt;detailed Name=\"fire.DBO.labels\"&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;OBJECTID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;OBJECTID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;OID&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdef Sync=\"TRUE\"&gt;Internal feature number.&lt;/attrdef&gt;\n        &lt;attrdefs Sync=\"TRUE\"&gt;Esri&lt;/attrdefs&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique whole numbers that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;FeatureID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;FeatureID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;ZOrder&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;ZOrder&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;SymbolID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;SymbolID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n      &lt;/attr&gt;\n    &lt;/detailed&gt;\n  &lt;/eainfo&gt;\n&lt;/metadata&gt;\n</code></pre>\n\n<p>...and here is my desired result:</p>\n\n<pre><code>&lt;metadata xml:lang=\"en\"&gt;\n&lt;many nodes and elements&gt;\n  &lt;eainfo&gt;\n    &lt;detailed Name=\"fire.DBO.labels\"&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;OBJECTID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;OBJECTID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;OID&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdef Sync=\"TRUE\"&gt;Internal feature number.&lt;/attrdef&gt;\n        &lt;attrdefs Sync=\"TRUE\"&gt;Esri&lt;/attrdefs&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique whole numbers that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;FeatureID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;FeatureID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Sequential unique GUID's that are automatically generated.&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;ZOrder&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;ZOrder&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Order of the Z&lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n      &lt;attr&gt;\n        &lt;attrlabl Sync=\"TRUE\"&gt;SymbolID&lt;/attrlabl&gt;\n        &lt;attalias Sync=\"TRUE\"&gt;SymbolID&lt;/attalias&gt;\n        &lt;attrtype Sync=\"TRUE\"&gt;Integer&lt;/attrtype&gt;\n        &lt;attwidth Sync=\"TRUE\"&gt;4&lt;/attwidth&gt;\n        &lt;atprecis Sync=\"TRUE\"&gt;10&lt;/atprecis&gt;\n        &lt;attscale Sync=\"TRUE\"&gt;0&lt;/attscale&gt;\n        &lt;attrdomv&gt;\n          &lt;udom Sync=\"TRUE\"&gt;Symbol Identifier GUID &lt;/udom&gt;\n        &lt;/attrdomv&gt;\n      &lt;/attr&gt;\n    &lt;/detailed&gt;\n  &lt;/eainfo&gt;\n&lt;/metadata&gt;\n</code></pre>\n"},{"tags":["sql","asp.net-mvc","sql-server-2008","asp.net-mvc-4","getdate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13239675,"title":"Executing table-less SQL in MVC4","body":"<p>What is the best practice for executing a generic, table-less SQL query within an MVC architecture?</p>\n\n<p>I'm trying to use commands such as these:</p>\n\n<pre><code>SELECT getdate();\nSELECT user;\n</code></pre>\n\n<p><strong>Update:</strong>\nThis is actually for part of another project that co-exists alongside the MVC project. All of my tables so far are mapped using edmx from an existing database.</p>\n\n<p>I'd like to use the date from the database in some internal calculations, rather than using the date from the server where the application/site are installed. My formulas go down to the milliseconds, and the time difference between the two servers involved throws off the math.</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13238726,"title":"Time Breaking in SQL Server","body":"<p>I have a fun challenge with some time data in my application. I have a table of start and end times; and need to subtract out shift times keeping the difference to get multiple rows. Im trying to do this on my SQL Server 2008 box at the moment.</p>\n\n<p>The idea is if i have a time row like</p>\n\n<pre><code>Start 09:00 End 19:12\n</code></pre>\n\n<p>And the shift says 09:00 -> 17:00 I need to split / break the data into two rows</p>\n\n<pre><code>Start 09:00 End 17:00\nStart 17:00 End 19:12\n</code></pre>\n\n<p>This needs to work over midnight too; created some scratch data as I have been playing around with some ideas but am wondering if there is a way out of case statement heck.</p>\n\n<pre><code>Create Table dbo.tblClockEvents\n(\nDayOfWeek Int,\nClockOn Time,\nClockOff Time\n)\n\nCreate Table dbo.tblShiftPattern\n(\nDayOfWeek Int,\nStartTime Time,\nEndTime Time\n)\n\ninsert into dbo.tblShiftPattern\nselect 1, '07:30', '17:00'\nunion select 2, '09:30', '18:00'\nunion select 3, '09:30', '18:00'\nunion select 4, '09:30', '18:00'\nunion select 5, '20:30', '04:00'\n\n\ninsert into dbo.tblClockEvents\nselect 1, '07:30', '17:00'\nunion select 2, '09:22', '18:14'\nunion select 3, '09:12', '18:01'\nunion select 4, '09:22', '18:14'\nunion select 5, '20:22', '04:14'\n\nSelect * \nfrom dbo.tblClockEvents aa\ninner join tblShiftPattern bb\non  aa.DayOfWeek = bb.DayOfWeek\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","table-valued-parameters"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13240720,"title":"Doing an existance check using a subquery with 'LIKE' on a table valued parameter","body":"<p>I am doing an import from excel into the database. I am passing a table valued parameter with a bunch of values, one of them being a foreign key. The catch is that in the database the key value is an <code>nvarchar</code> that always will have 2 or 3 zeroes in front of it, however the people that send the excel files did not properly format the column and those leading zeroes are cut off.</p>\n\n<p>The first thing I need to do in the procedure is to check that all these values exist in a parent table using <code>LIKE</code> (since the leading zeroes are missing). If any of the values don't exist in the parent table then the transaction does not proceed.</p>\n\n<p>I need some help with the MS SQL syntax for this.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":48,"score":0,"question_id":13240298,"title":"Remove numbers from string sql server","body":"<p>I have a large database in which I want to do a part string search. The user will enter characters: <code>JoeBloggs.</code></p>\n\n<p>For arguments sake if I had a name <code>Joe 23 Blo Ggs 4</code> in the database. I want to remove everything in the name other than A-Z. </p>\n\n<p>I have the <code>REPLACE(Name, ' ','')</code> function to remove spaces and the <code>UPPER()</code> function to capitalize the name.</p>\n\n<p>Is there a more efficient fast way maybe by terms of regex to replace anything other than A-Z. I cannot change the values in the database.</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2008","user-permissions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2505,"score":0,"question_id":5362206,"title":"SQL Server 2008 user permissions","body":"<p>I am using SQL Server 2008 with SQL authentication... I wanna know permissions given to a particular users.... it should list all the permissions given to a particular user for a particular databases... plz reply fast...</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13239041,"title":"sql server 2008, altering the table layout","body":"<p>Please find the blow table.  </p>\n\n<p><strong>TABLE</strong>  </p>\n\n<pre><code>ClientID    Balance1    Balance2    Balance3    Balance4    Balance5    Balance6    Balance7    Balance8    Balance9\nA           NULL        NULL        NULL        3           Null        Null        Null        Null        Null\nB           10          null        Null        Null        20          Null        Null        Null        NULL\nC           Null        8           Null        10          Null        Null        1           Null        NULL\nD           Null        19          Null        Null        Null        Null        Null        Null        NULL\nE           Null        Null        50          Null        Null        Null        Null        Null        NULL\nF           NULL        NULL        NULL        30          NULL        NULL        NULL        NULL        NULL    \nG           NULL        NULL        NULL        NULL        80          NULL        NULL        NULL        NULL      \n</code></pre>\n\n<p>How can I modify the above table into as shown below by using query, Please help!    </p>\n\n<pre><code>ClientID    Balance1    Balance2    Balance3    Balance4    Balance5    Balance6    Balance7    Balance8    Balance9\nA           NULL        NULL        NULL        3           3           3           3           3           3   \nB           10          10          10          10          20          20          20          20          20\nC           Null        8           8           10          10          10          1           1           1\nD           Null        19          19          19          19          19          19          19          19\nE           Null        Null        50          50          50          50          50          50          50          \nF           NULL        NULL        NULL        30          30          30          30          30          30          \nG           NULL        NULL        NULL        NULL        80          80          80          80          80          \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13238668,"title":"Select into a view","body":"<p>I have a simple CTE <code>x</code> and I wish to select its contents into a view.  Can you select into a view using the same type of syntax that you can for a table? i.e.</p>\n\n<pre><code>SELECT * \nINTO newTable\nFROM OldTable\n</code></pre>\n\n<p>Can new views be created dynamically like this?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":53,"score":3,"question_id":13237736,"title":"How Can we use ISNULL to all Column Names in SQL Server 2008?","body":"<p>I have a question </p>\n\n<p>I tried to <code>google</code> it but looks like they don't like <code>*</code> </p>\n\n<p>I'm using SQL Server 2008.</p>\n\n<p>I have the following database table: </p>\n\n<pre><code> P_Id   ProductName UnitPrice   UnitsInStock    UnitsOnOrder\n------------------------------------------------------------------------\n   1    Jarlsberg   10.45                 16    15\n   2    Mascarpone  Null                  23    NULL \n   3    Gorgonzola  15.67                  9    20\n</code></pre>\n\n<p>If I need to replace the <code>null</code> with a string I know I do :</p>\n\n<pre><code> SELECT ISNULL(UnitsOnOrder,'No Data') FROM tbl\n</code></pre>\n\n<p><strong>Questions</strong> </p>\n\n<ul>\n<li>How can I use <code>ISNULL()</code> with multi column names ?</li>\n<li>is it possible to use it with <code>*</code> </li>\n</ul>\n\n<p><em>Like</em></p>\n\n<pre><code>SELECT ISNULL(* , 'NO data') FROM tbl \n</code></pre>\n\n<p>I think this will be tricky because of the datatype, you can't pass string to <code>INT</code> datatype  so how can I fix this too </p>\n\n<p><strong>Update</strong> </p>\n\n<p>Okay if i use <code>ISNULL(</code>) with a datatype of <code>int</code> it will return <code>0</code> \nwhich will be a value to me , how can i pass empty string instead ? </p>\n\n<p>Thanks </p>\n"},{"tags":["c#","sql-server-2008","entity-framework","entity-framework-4.1","entity-framework-5"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":390,"score":0,"question_id":10153872,"title":"Tables with mapping not being created at the database","body":"<p>I've been trying to implement the Repository pattern using EntityFramework5. I already got the basics to work. My repositories are being loaded only when necessary and the data is being inserted/updated/retrieved in the database as it should.\nThe problem is: I can't get the tables with mapping to be correctly created, or even created at all.\nI've been reading some articles online, even here, talking about ways to work with mapped tables and create them in the database, but I haven't succeed. Hands my question here.</p>\n\n<p>How do I get it to work in my scenario?</p>\n\n<p>I'll explain what I'm doing so far:</p>\n\n<p>This method below is overriden to, supposedly, create the mappings and tables.</p>\n\n<p>PS: <code>Generics.InvokeGenericMethod</code> is a method I created and it's working. It does what it says :)</p>\n\n<pre><code>    protected override void OnModelCreating(DbModelBuilder modelBuilder)\n    {\n        foreach (Type entityType in Repositories.Keys)\n        {\n            //Invokes the Entity method from DbModelBuilder injecting the class type.\n            Generics.InvokeGenericMethod(modelBuilder, typeof(DbModelBuilder), entityType, \"Entity\", null);\n        }\n\n        foreach (GaiaEntityConfiguration config in EntityConfigurations)\n        {\n            //Defines each mapping existing in the context\n            config.SetConfiguration(modelBuilder);\n        }\n    }\n</code></pre>\n\n<p>The part that is not working is where I use SetConfiguration. SetConfiguration is a method I created for each class added to the context that has mapping, have that mapping mirrored to the database.</p>\n\n<p>Here's one example (in this case a recipient has many messages and messages have many recipients / many-to-many association):</p>\n\n<p>PS: I left the commented code so you can see one other approach I tried.</p>\n\n<pre><code>    public RecipientEntityConfiguration()\n    {\n        this.LeftKey = \"RecipientId\";\n        this.RightKey = \"MessageId\";\n        this.Schema = \"Hermes\";\n        this.TableName = \"RecipientMessage\";\n    }\n\n    public override void SetConfiguration(DbModelBuilder modelBuilder)\n    {\n        //EntityTypeConfiguration&lt;Recipient&gt; entityTypeConfiguration = new EntityTypeConfiguration&lt;Recipient&gt;();\n\n        //entityTypeConfiguration\n        //    .HasMany&lt;Message&gt;(r =&gt; r.Messages)\n        //    .WithMany(m =&gt; m.Recipients)\n        //    .Map(mr =&gt;\n        //    {\n        //        mr.MapLeftKey(this.LeftKey);\n        //        mr.MapRightKey(this.RightKey);\n        //        mr.ToTable(this.TableName, this.Schema);\n        //    });\n        modelBuilder.Entity&lt;Recipient&gt;()\n            .HasMany&lt;Message&gt;(r =&gt; r.Messages)\n            .WithMany(m =&gt; m.Recipients)\n            .Map(mr =&gt;\n            {\n                mr.MapLeftKey(this.LeftKey);\n                mr.MapRightKey(this.RightKey);\n                mr.ToTable(this.TableName, this.Schema);\n            });\n        //modelBuilder.Configurations.Add&lt;Recipient&gt;(entityTypeConfiguration);\n    }\n</code></pre>\n\n<p>When <code>this.Database.Initialize(false);</code> is called I get this error:</p>\n\n<pre><code>Value cannot be null.\nParameter name: key\n</code></pre>\n\n<p>StackTrace:</p>\n\n<pre><code>   at System.Collections.Generic.Dictionary`2.FindEntry(TKey key)\n   at System.Collections.Generic.Dictionary`2.TryGetValue(TKey key, TValue&amp; value)\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.SortedEntityTypeIndex.Add(EdmEntitySet entitySet, EdmEntityType entityType)\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.EntityMappingService.Analyze()\n   at System.Data.Entity.ModelConfiguration.Configuration.Mapping.EntityMappingService.Configure()\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.ConfigureEntityTypes(DbDatabaseMapping databaseMapping, DbProviderManifest providerManifest)\n   at System.Data.Entity.ModelConfiguration.Configuration.ModelConfiguration.Configure(DbDatabaseMapping databaseMapping, DbProviderManifest providerManifest)\n   at System.Data.Entity.DbModelBuilder.Build(DbProviderManifest providerManifest, DbProviderInfo providerInfo)\n   at System.Data.Entity.DbModelBuilder.Build(DbConnection providerConnection)\n   at System.Data.Entity.Internal.LazyInternalContext.CreateModel(LazyInternalContext internalContext)\n   at System.Data.Entity.Internal.RetryLazy`2.GetValue(TInput input)\n   at System.Data.Entity.Internal.LazyInternalContext.InitializeContext()\n   at System.Data.Entity.Internal.InternalContext.Initialize()\n   at System.Data.Entity.Database.Initialize(Boolean force)\n   at Gaia.Repository.GaiaContext..ctor(GaiaContextConfiguration config) in E:\\Gaia\\Gaia.Repository\\GaiaContext.cs:line 37\n   at Hermes.HMail.SendMessage(Int64 sender, Int64[] toUsers, String subject, String content, FileStream attachment) in G:\\Gaia\\Hermes\\HMail.cs:line 78\n   at Gaia.Controllers.ApplicationController.Test() in G:\\Gaia\\Gaia\\Controllers\\ApplicationController.cs:line 18\n   at lambda_method(Closure , ControllerBase , Object[] )\n   at System.Web.Mvc.ActionMethodDispatcher.&lt;&gt;c__DisplayClass1.&lt;WrapVoidAction&gt;b__0(ControllerBase controller, Object[] parameters)\n   at System.Web.Mvc.ActionMethodDispatcher.Execute(ControllerBase controller, Object[] parameters)\n   at System.Web.Mvc.ReflectedActionDescriptor.Execute(ControllerContext controllerContext, IDictionary`2 parameters)\n   at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethod(ControllerContext controllerContext, ActionDescriptor actionDescriptor, IDictionary`2 parameters)\n   at System.Web.Mvc.ControllerActionInvoker.&lt;&gt;c__DisplayClass15.&lt;InvokeActionMethodWithFilters&gt;b__12()\n   at System.Web.Mvc.ControllerActionInvoker.InvokeActionMethodFilter(IActionFilter filter, ActionExecutingContext preContext, Func`1 continuation)\n</code></pre>\n\n<p>Any ideas?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13237830,"title":"SQL Server 2008 query to fill the null values","body":"<p>I need a query on below table</p>\n\n<p>TABLE     </p>\n\n<pre><code>ClienName   Bal0    Bal1    Bal2        Bal3        Bal4        Bal5        Bal6    \n--------------------------------------------------------------------------------\nA           600     600     NULL        NULL        NULL        NULL        NULL    \nB           Null    100     NULL        NULL        NULL        NULL        NULL    \nC           NULL    NULL    200          NULL       NULL        NULL        NULL        \nD           NULL    NULL    NULL        NULL        NULL        130         130     \nE           510     510     NULL        510         510         NULL        NULL    \nF           170     170     NULL        170         170         NULL        170 \nG           210     210     NULL        210         210         210         210     \nH           20      20      NULL        20          NULL        NULL        NULL    \n</code></pre>\n\n<p><strong>Result:  I would like to see the above TABLE as below, which query can do it? please help</strong>  </p>\n\n<pre><code>ClienName   Bal0    Bal1    Bal2        Bal3        Bal4        Bal5        Bal6    \n--------------------------------------------------------------------------------\nA           600     600     600         600         600         600         600     \nB           100     100     100         100         100         100         100     \nC           200     200     200         200         200         200         200     \nD           130     130     130         130         130         130         130         \nE           510     510     510         510         510         510         510     \nF           170     170     170         170         170         170         170 \nG           210     210     210         210         210         210         210     \nH           20      20      20          20          20          20          20\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13237853,"title":"SQL Server Procedure Bad Cache Planning","body":"<p>I have some SQL code that uses PetaPoco that executes using sp_executesql. The query has 3 parameters: 2 dates and one string (as varchar(5)).</p>\n\n<p>The query takes 3 minutes to run - from the app or SSMS. If I run the same code in SSMS without sp_executesql (or parameters) it runs in 10 seconds and if I add the OPTION (OPTIMIZE FOR UNKNOWN) hint to the original code (using the sp) it runs in 3 seconds. I have cleared the cache using </p>\n\n<pre><code>  CHECKPOINT;\n  GO\n  DBCC DROPCLEANBUFFERS;\n  GO\n  DBCC FREEPROCCACHE;\n  GO\n</code></pre>\n\n<p>And I still can't get it to run as expected. It seems that adding the option to every query is a hack. Am I missing something?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":34,"score":-2,"question_id":13237623,"title":"Copy data into another table","body":"<p>How to copy (append) data from one table into another table with same schema in SQL Server?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>I mean to say there is query </p>\n\n<pre><code>select * \ninto table1 \nfrom table2 \nwhere 1=1 \n</code></pre>\n\n<p>which creates <code>table2</code> with the same structure as <code>table1</code>. </p>\n\n<p>So is there any short query like this to only copy entire data only into an already existing table?</p>\n"},{"tags":["sql-server-2008","excel-vba"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":38,"score":3,"question_id":13229003,"title":"Connecting VBA to SQL server using ADO - object closed","body":"<p>I have created the object and from which I can tell I have just preformed a query on it, can anyone tell me where my error is?</p>\n\n<p>The error statement is</p>\n\n<pre><code>Run time error 3704 operation is not allowed when the object is closed \n</code></pre>\n\n<p>and it occurs on this line</p>\n\n<pre><code>ActiveWorkbook.Worksheets(\"SQL\").Range(\"A1\").CopyFromRecordset rspubs\n</code></pre>\n\n<p>MY CODE IS</p>\n\n<pre><code>Sub sqlTest()\n\nDim Sqlquery As String\nDim cnpubs As ADODB.Connection\nDim rspubs As ADODB.Recordset\n\n' Create a connection object.\nSet cnpubs = New ADODB.Connection\n' Create a recordset object.\nSet rspubs = New ADODB.Recordset\n' Provide the connection string.\nDim strConn As String\n\n\n'Construct query\nSqlquery = \" sql query;\n\n'Use the SQL Server OLE DB Provider.\n\nstrConn = \"Provider=SQLOLEDB.1;Integrated Security=SSPI;Persist Security Info=True;Data Source=XXXX;Use Procedure for Prepare=1;Auto Translate=True;Packet Size=4096;Workstation ID=XXXX;Use Encryption for Data=False;Tag with column collation when possible=False;Initial Catalog=Prospects\" \n\n'Now open the connection.\ncnpubs.Open strConn\n\nWith rspubs\n' Assign the Connection object.\n.ActiveConnection = cnpubs\n' Extract the required records.\n'.Source = Sqlquery\n.Open Sqlquery\n' Copy the records into cell A1 on Required Sheet\nActiveWorkbook.Worksheets(\"SQL\").Range(\"A1\").CopyFromRecordset rspubs\nEnd With\n\n' Tidy Up\ncnpubs.Close\nrspubs.Close\n\nSet cnpubs = Nothing\n\nSet rspubs = Nothing\n\n\nEnd Sub\n</code></pre>\n"},{"tags":["sql","database","sql-server-2008","query","insert"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13235606,"title":"SQL query :Copy one table to another from different servers","body":"<p>What's wrong with my query, I want to copy three columns to another server\\table if one of the column (ID_DIRCT) is not null :</p>\n\n<pre><code>INSERT INTO  System\\Syst3.Server1.dbo.TABLE_RESRC (NO_EMPLY,PR,NM_FAML,CO_DIRCT)\nSELECT NO_EMPLY, PR_EMPLY, NM_EMPLY, ID_DIRCT \nFROM System\\Syst3.Server2.dbo.RESRC\nWHERE System\\Syst3.Server2.dbo.RESRC.ID_DIRCT IS NOT NULL\n</code></pre>\n\n<p>Using SQL Server 2008 R2.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":10,"down_vote_count":0,"view_count":133,"score":10,"question_id":13235382,"title":"Double IN Statements in SQL","body":"<p>Just curious about the IN statement in SQL.\nI know I can search multiple columns with one value by doing</p>\n\n<pre><code>'val1' IN (col1,col2)\n</code></pre>\n\n<p>And can search a column for multiple values</p>\n\n<pre><code>col1 IN ('val1','val2')   \n</code></pre>\n\n<p>But is there a way to do both of these simultaneously, without restorting to an repeating AND / OR in the SQl? I am looking to do this in the most scalable way, so independent of how many vals / cols i need to search in.\nSo essentially:</p>\n\n<pre><code>('val1','val2') IN (col1,col2)\n</code></pre>\n\n<p>but valid.</p>\n"},{"tags":["sql","sql-server-2008","where-clause"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":33,"score":-1,"question_id":13234075,"title":"Filtering data from 3 tables on 2 columns not giving good result","body":"<p>so i have 3 tables 1 table is used to get all the good numbers from \nthe second table will contain the date thats needs to be between 2 dates \nand the third table has the information numbers i whant so i tryd something like this but getting wrong results.</p>\n\n<pre><code> select columns,\n   (\n     select \n       SUM(column) \n     from \n       table3 \n     where \n       (column is null or column &lt;&gt; 4) \n         and table3nrcolumn = table1nrcolumn \n         and othercolumnnr from table3 in\n           (\n             select \n               column \n             from \n               table2 \n             where \n               (column is null or column &lt;&gt; 4) \n               and (column_datum between '2012-10-29' and '2012-11-04'))) \n                  as result\nfrom \n  table1\n</code></pre>\n\n<p>but i am getting wrong results i think because of the date between but i cant figure out wy hope someone can help</p>\n\n<p>Sorry for the late reaction but i whas working on on something else and Tanx for the fast reaction il try to make it a bit more clear</p>\n\n<p>select id, naam, prijs,\n(select SUM(aantal) from TABLE2 where (nr is null or nr &lt;> 4) and id_TABLE2 = id_TABLE1 and other_nr_TABLE2 in\n(select other_nr from TABLE3 where (nr is null or nr &lt;> 4) and (datum >= '2012-10-29' and datum &lt;= '2012-11-04'))) as resultset\nfrom TABLE1</p>\n\n<p>Table 1 contains writing material Contains All posible rows \nTable 2 contains writing material thats packed togetor under other_nr Can Contain more ROWS\nTable 3 contains packed name under other_nr with a date Contains 1 row</p>\n\n<p>so i need the material from a date range out table 2 that has a connection with table 3 under other_nr And i need to select a date range from table 3 and get the Materials from table 2</p>\n\n<p>hope its a bit more clear now\nVerry srry but i still dont get the tags needed for code</p>\n"},{"tags":["c#","sql-server-2008","gridview","paging","extjs4.1"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13235286,"title":"How to page data according to pagingtoolbar's request","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13240121/what-is-the-equivalent-of-this-code-in-c-sharp-to-pass-the-start-and-limit-varia\">What is the equivalent of this code in c# to pass the start and limit variable to query for paging</a>  </p>\n</blockquote>\n\n\n\n<p><a href=\"http://stackoverflow.com/questions/13202893/extjs-paging-toolbar-in-grid-does-not-work/13202973#13202973\">This question follows from this thread...</a>I am trying to change server code to account for the start and limit http parameters to use pagingtoolbar in extjs...</p>\n\n<p>right now my server code... gets all the data in json and throws everything in my gridview in first page... below is my code... what changes would I need to make... please help...</p>\n\n<pre><code> string sqlquery = \"SELECT Q1, Q2, Q3, Q4, Improvements, Comments FROM ITable\";\n    conn.Open();\n    SqlDataAdapter cmd = new SqlDataAdapter(sqlquery, conn);\n    SqlCommand comd = new SqlCommand(sqlquery, conn);\n    DataSet myData = new DataSet();\n    cmd.Fill(myData, \"myTable\");\n\n    comd.CommandText = \"SELECT COUNT(*) FROM ITable\";\n    Int32 count = (Int32)comd.ExecuteScalar();\n\n    comd.ExecuteNonQuery();\n    conn.Close();\n\n\n    var results = (new\n\n    {\n\n        TotalNumber = count,\n\n        myTable = myData\n\n    });\n\n    return JsonConvert.SerializeObject(new { count=count, myTable = myData.Tables[0] }, Formatting.Indented,\n                    new JsonSerializerSettings\n                    {\n                        ReferenceLoopHandling = ReferenceLoopHandling.Ignore\n                    });\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":43,"score":3,"question_id":13235048,"title":"Multiple Rows in INSERTED table","body":"<p>On a table in MS SQL Server I need to run a CLR Stored Procedure on new rows if those rows meet certain criteria.  I thought that would be more or less straightforward:</p>\n\n<pre><code>if ((SELECT Cabinet FROM INSERTED) = 1 OR (SELECT Cabinet FROM INSERTED) = 3) AND (SELECT Result_02 FROM INSERTED) = 'N'\nBEGIN\n    DECLARE @id int\n    SET @id = (SELECT ID FROM INSERTED)\n    exec PrintLabel\n        @id,\n        N'LP 2844 LGE'\nEND;\n</code></pre>\n\n<p>However, this recently started throwing errors about a subquery returning multiple rows. I learned that INSERT triggers run once for each statement, not necessarily on individual rows. So, that IF statement can be working on multiple rows, and thus the error.</p>\n\n<p>My question is: how can I iterate over each new row if the rows are added in a batch (in this case via a MERGE statement). </p>\n"},{"tags":["html","sql","xml","sql-server-2008","import"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13234725,"title":"Importing XML into SQL Server 2008 including html tags","body":"<p>I need to import an XML file into a SQL Server 2008 table. One of the XML tags contains valid HTML tags which I want also want imported. Below is one of my elements, as you can see the descriptor tag contains HTML tags which I would like included in the import.</p>\n\n<pre><code>&lt;criterionlist&gt;\n    &lt;element&gt;\n         &lt;subjectname&gt;Humanities&lt;/subjectname&gt;\n         &lt;criterion&gt;A&lt;/criterion&gt;\n         &lt;phase&gt;1&lt;/phase&gt;\n         &lt;level&gt;1&lt;/level&gt;\n         &lt;descriptor&gt;The student: &lt;li&gt; makes &lt;b&gt;a limited attempt&lt;/b&gt; to use &lt;b&gt;some&lt;/b&gt; relevant terminology &lt;/li&gt;\n        &lt;li&gt; demonstrates &lt;b&gt;basic&lt;/b&gt; knowledge and understanding of content and concepts through &lt;b&gt;some&lt;/b&gt; descriptions and/or examples.&lt;/li&gt; &lt;/descriptor&gt;\n    &lt;/element&gt;\n</code></pre>\n\n<p>Is this possible? I managed to import the file into a table using <code>OPENROWSET</code>, but it ignores the HTML tags..</p>\n\n<p>Many thanks,\nDave.</p>\n"},{"tags":["c#","sql-server-2008","permissions","database-connection","ssms"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13233715,"title":"Connect to SQL Server 2008 Database via C#","body":"<p>I am attempting to connect to a database I created in SQL Server 2008 on my computer.\nI have a Windows Authentication login which looks like this:</p>\n\n<pre><code>try\n{\n  string sCon = @\"Data Source=David-PC\\SQLEXPRESS; Initial Catalog=ZarTrackDB; Integrated Security = true\";\n   SqlConnection dbConn;\n   dbConn = new SqlConnection(sCon);\n   dbConn.Open();\n}\ncatch (Exception ex)\n{\n    MessageBox.Show(this, \"An error occurd while attemtpting to connect to DB.\\n\" + ex.Message, \"DB Connection Error\", MessageBoxButtons.OK, MessageBoxIcon.Error);\n     return;\n}\n</code></pre>\n\n<p>however it keeps throwing an exception:</p>\n\n<blockquote>\n  <p>Login failed for user David-PC\\David</p>\n</blockquote>\n\n<p>I am able to connect to the Master DB though:</p>\n\n<pre><code> string sCon = @\"Data Source=David-PC\\SQLEXPRESS; Initial Catalog=Master; Integrated Security = true\";\n</code></pre>\n\n<p>So i guess the probelm might be I do not have permissions? How do I go about giving myslef permissions to access this DB though when I login via SQL Server Management Studio I can insert create query etc on the ZarTrackDB perfectly.</p>\n\n<p>I truly dont know what to do anymore please help!</p>\n\n<p>EDIT:</p>\n\n<p>here is a screen shot of my user mappings for the account I am trying to log in with:</p>\n\n<p><strong>User Mappings:</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/pyVC7.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Server Roles</strong>:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Ua5NL.png\" alt=\"enter image description here\"></p>\n\n<p>UPDATE:</p>\n\n<p>If I login to master and attempt to access ZarTrack :</p>\n\n<pre><code>   string sCon = @\"Data Source=David-PC\\SQLEXPRESS; Initial Catalog=Master; Integrated Security = true\";\n                SqlConnection dbConn;\n                dbConn = new SqlConnection(sCon);\n                dbConn.Open();\n\n                string sql = \"USE ZarTrackDB \"+\n\"CREATE TABLE Customers (\"+\n\n\"CustomerID int IDENTITY PRIMARY KEY NOT NULL,\" +\n\"CompanyName varchar(30) NOT NULL,\"+\n\"CompanyAddress varchar(40) NOT NULL,\"+\n\"Email varchar(40) NOT NULL,\"+\n\"PhoneNumber varchar(15) NOT NULL\"+\n\");\";\n                SqlCommand dbCmd = new SqlCommand();\n                dbCmd.CommandText = sql;\n                dbCmd.Connection = dbConn;\n\n                dbCmd.ExecuteNonQuery();\n</code></pre>\n\n<p>I get Exception:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Rxlgn.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","xml","sql-server-2008","tsql","xquery"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13234175,"title":"Use of xml.modify to insert parameters into specific element of an xml column","body":"<p>I would like to use a stored procedure to insert some values passed in as parameters into elements in the xml of a column. I have this so far\nThe following parameters:</p>\n\n<pre><code>@profile_id int,\n@user_id nvarchar(50),\n@activity_name nvarchar(50),\n@display_name nvarchar(50)\n</code></pre>\n\n<p>Retrieve the desired xml:</p>\n\n<pre><code>DECLARE @profiles_xml xml\nSET @profiles_xml = (SELECT profiles from tbl_applied_profiles WHERE profiles.value('(Profile/ID)[1]','int')= @profile_id)\n</code></pre>\n\n<p>The xml from the column inside the @profiles_xml looks like this:</p>\n\n<pre><code>&lt;Profile&gt;\n  &lt;ID&gt;20&lt;/ID&gt;\n  &lt;User&gt;\n    &lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;\n    &lt;Name&gt;somename&lt;/Name&gt;\n    &lt;Activities&gt;\n      &lt;Activity&gt;\n         &lt;Name&gt;activity1&lt;/Name&gt;\n      &lt;/Activity&gt;\n    &lt;/Activities&gt;\n  &lt;/User&gt;\n&lt;/Profile&gt;\n</code></pre>\n\n<p>Attempt to Insert into User with specific ID the activity name and display name:</p>\n\n<pre><code>SET @profiles_xml.modify('\n    insert\n    if(/Profile/User/ID=sql:variable(\"@user_id\"))\n    then Activity[Name=sql:variable(\"@activity_name\")][DisplayName=sql:variable(\"@display_name\")]\n    else()\n    as first\n    into (/Profile/User/Activities)[1]')\n</code></pre>\n\n<p>I have also tried this with no success:</p>\n\n<pre><code> SET @devices_xml.modify('\n    insert /Profile/User[ID=sql:variable(\"@user_id\")]/Activity[Name=sql:variable(\"@activity_name\")][DisplayName=sql:variable(\"@display_name\")]\n    into (/Profile/User/Activities)[1]')\n</code></pre>\n\n<p>And this:</p>\n\n<pre><code> SET @devices_xml.modify('\ninsert\n /Profile/User[ID=sql:variable(\"@user_id\")]/Activities/Activity[Name=sql:variable(\"@activity_name\")][DisplayName=sql:variable(\"@display_name\")]\n    into (/Profile/User/Activities)[1]')\n</code></pre>\n\n<p>What is the correct way to do this?</p>\n"},{"tags":["sql-server-2008","visual-studio-2012","connection-string","localdb"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":13002250,"title":"Running ASP.NET app with VS2012 debugger uses LocalDB despite connection string in web.config","body":"<p>I want to use SQL 2008 R2 on the server where I run VS 2012, so I created the \"membership\" database (using  Aspnet_regsql tool) and configured it to work with IIS7). Then I created ASP.NET Application and modified the web.config so that connection string points to this database.</p>\n\n<p>Running this app with VS 2012 debugger results with my app creating the LocalDB  ASPNETDB.MDF instance in app_data folder. VS ASP.NET Configuration tool when invoked from VS Tools menu shows the LocalDB based data and the running application access this database instead of SQL Server 2008 R2 server - which runs on the same server.</p>\n\n<p>I believe that this is some side-effect of the VS generated web.config file, but despite looking hard, I found nothing suspicious.</p>\n\n<p>Note: this same scenario works just fine with Visual Studio 2010 if I am using it's own generated web.config file.</p>\n\n<p>I would hate to dismiss VS 2012 for this as I am pretty sure that I did something wrong.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13232177,"title":"Getting all related rows that a value is included in, in a mapping table","body":"<p>I don't even know how to start my search on this one.</p>\n\n<p>Let me explain what I'm trying to do :</p>\n\n<p>I have a variable - value mapping table.\n<strong>Several values can be assigned to a variable, and the same value can be assigned to many variables</strong>.</p>\n\n<p>The user is able to delete variables/values.\nHowever, <strong>a value should not be allowed to be deleted if there are any variables that only have this specific value assigned to them</strong>. Otherwise the variables would remain undeleted, but with 0 values assigned, which is wrong.</p>\n\n<p>Now, at the point where the user tries to delete a value from a specific variable, I want to check :</p>\n\n<p><strong>IF for the selected valueID there are any variableIDs that only have one valueID assigned to them, and that valueID is the one the user is trying to delete.</strong>\nIf so, then abort. Otherwise proceed.</p>\n\n<p>Is this possible in any way?</p>\n\n<p>Table Names : </p>\n\n<pre><code>Variable\nValue\nVariable_Value ( mapping table )\n</code></pre>\n\n<p>Field Names ( in all tables ) :</p>\n\n<pre><code>Variable_ID\nValue_ID\n</code></pre>\n\n<p>Example below :</p>\n\n<pre><code>For example Variable_ID 5 only has Value_ID 10 assigned to it. \nIf a user selects a Variable_ID, he sees all assigned Value_IDs \nand is able to select one and try to delete it. So, a user could click \non Variable_ID 3 and try to delete Value_ID 10. That shouldn't \nbe possible if that specific Value_ID is the only assigned \nvalue to any other Variable, because that would leave that \nvariable with no Value_IDs.\n</code></pre>\n\n<p><img src=\"http://i.stack.imgur.com/9ezry.jpg\" alt=\"\"></p>\n"},{"tags":["sql","xml","sql-server-2008","tsql","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13233034,"title":"Use of logical and for an xquery delete in tsql","body":"<p>Is it possible to use a logical and operator with an xquery statement inside a stored procedure to delete an element only if its parent element has a specific value AND it has a specific value? Such as:</p>\n\n<pre><code>SET @profiles_xml = (SELECT profiles from tbl_applied_profiles WHERE profiles.value('(Profile/ID)[1]','int')= @profile_id)\n    SET @profiles_xml.modify('\n    delete\n    if(/Profile/User/ID=sql:variable(\"@user_id\")) and (/Profile/User/Activities/Activity/Name = sql:variable(\"@activity_name\"))\n    then (/Profile/User/Activities/Activity)\n    else()\n    ')\n</code></pre>\n\n<p>I would like to delete the Activity only if the User ID element and Activity Name element match the given parameters.\nThe xml in profiles_xml looks like this:</p>\n\n<pre><code>&lt;Profile&gt;\n  &lt;ID&gt;20&lt;/ID&gt;\n  &lt;User&gt;\n    &lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;\n    &lt;Name&gt;somename&lt;/Name&gt;\n    &lt;Activities&gt;\n      &lt;Activity&gt;\n         &lt;Name&gt;activity1&lt;/Name&gt;\n      &lt;/Activity&gt;\n    &lt;/Activities&gt;\n  &lt;/User&gt;\n&lt;/Profile&gt;\n</code></pre>\n\n<p>But in the future there will potentially be multiple  elements in each  and Multiple  elements as children of the  element.</p>\n"},{"tags":["asp.net","visual-studio","sql-server-2008","visual-studio-2012"],"answer_count":2,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":12782404,"title":"Visual Studio 2012 - Database Publishing Wizard Discontinued?","body":"<p>I'm using VS 2012 and SQL Server 2008 and have just noticed that the \"Publish to Provider\" option is missing in Server Explorer. According to this, Database Publishing Wizard has been discontinued?</p>\n\n<p><a href=\"http://forums.asp.net/post/5122271.aspx\" rel=\"nofollow\">http://forums.asp.net/post/5122271.aspx</a></p>\n\n<p>How can I publish my database to my server now? Is generating scripts the only option instead of doing this from within the VS IDE and if so, can someone provide the steps to generate the DB with stored procedures included?</p>\n\n<p><strong>UPDATE:</strong> </p>\n\n<ul>\n<li><a href=\"http://stackoverflow.com/questions/11538254/how-to-publish-database-to-provider-in-visual-studio-2012-rc\">Similar question</a> but unsatisfactory answer.</li>\n<li><a href=\"http://connect.microsoft.com/VisualStudio/feedback/details/729467/database-publishing\" rel=\"nofollow\">Confirmation</a> that the wizard has indeed been discontinued.</li>\n</ul>\n"},{"tags":["sql-server-2008","certificate","windows-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13231751,"title":"SQL server 2008 encrypted connection confusion","body":"<p>So I've set up a domain name for my server and have created a self-signed cert via IIS. Then I've opened the SQL server configuration manager and have set the the MSSQLSERVER's properties as follows:</p>\n\n<ul>\n<li>Force Encryption = Yes</li>\n<li>Hide Instance = Yes</li>\n<li>Certificate = (set to the just-created self-signed cert)</li>\n</ul>\n\n<p>Then I've created an SQL login and tried to connect (using SQL management studio) via a different computer to the server. And it worked! The following query said <code>TRUE</code>:</p>\n\n<pre><code>SELECT encrypt_option \nFROM sys.dm_exec_connections \nWHERE session_id = @@SPID\n</code></pre>\n\n<p>But the thing is that I haven't installed the cert with the public key on the remote computer yet! So how come that the server allowed and encrypted the connection without the public key cert installed?</p>\n"},{"tags":["visual-studio-2010","sql-server-2008","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":11,"score":0,"question_id":13231314,"title":"Show chart data based on a string in a dataset","body":"<p>I am trying to add a sparkline to show a trend based on 4 years data, this would be the datasource, it is just a single line.</p>\n\n<p>The problem I have is that the years in my dataset are actually column names for a different set of data and I don't have any room to changed this. So in my dataset I have the y1,y2,y3,y4 but they have many rows for each containing separate data.</p>\n\n<p>My idea was to do a sum on each year column, then create a string of the 4 values as a new calculated field and then base the spark line on this somehow.</p>\n\n<p>I am not sure if this is the best way or if there is another method that I am not thinking of, any tips would be appreciated.</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13230813,"title":"Transaction context in use by another session","body":"<p>I have a trigger in my one of the table(tblCustomerContact) like as given below</p>\n\n<pre><code>ALTER TRIGGER [dbo].[tr_UpdateVIEmailFlag]\n    ON  [dbo].[tblCustomerContact]\n   AFTER INSERT , UPDATE , DELETE\nAS \nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    -- Insert statements for trigger here\n\n    DECLARE @isLinkedWithVI varchar(2)\n    DECLARE @pkCustomer int\n    DECLARE @customerCode varchar(8)\n    DECLARE @siteCode varchar(2)\n    DECLARE @sql varchar(200)\n\n    DECLARE @VIConnection varchar(100)\n     DECLARE @serverName varchar(100)\n    DECLARE @dbName varchar(100)\n\n    SET @isLinkedWithVI =  (SELECT ConstantValue From systblBaccusConstants WHERE ConstantName = 'IsLinkedWithVisionInvoicing' )\n    SET  @VIConnection = (SELECT  ConstantValue From systblBaccusConstants WHERE ConstantName = 'VisionInvoicingConnectionString' )\n\n    IF LEN( RTRIM(LTRIM(@VIConnection)) ) &gt; 0\n    BEGIN\n        SET @serverName = REPLACE(REPLACE(SUBSTRING( @VIConnection , 0 , Charindex( ';', @VIConnection,0)) , 'Data Source' , '') , '=','')\n        SET @dbName =  REPLACE( REPLACE(  SUBSTRING( SUBSTRING( @VIConnection , Charindex( ';', @VIConnection,0)+1 ,LEN (@VIConnection) ) ,\n        0 , CHARINDEX(';' , SUBSTRING( @VIConnection , Charindex( ';', @VIConnection,0)+1 ,LEN (@VIConnection) ) , 0))\n        ,'Initial catalog' ,'') , '=','')       \n    END \n\n    IF @isLinkedWithVI = '1'\n    BEGIN\n\n        SELECT \n            @pkCustomer = FKCustomer\n        FROM INSERTED \n\n        IF @pkCustomer IS NULL\n        BEGIN\n            SELECT \n                @pkCustomer = FKCustomer\n                FROM DELETED\n        END     \n\n\n        SELECT     @customerCode = tblCustomer.CustomerCode, \n                    @sitecode = tblSite.SiteCode            \n        FROM    tblCustomer                         \n                        INNER JOIN  tblSite ON tblCustomer.FKSite = tblSite.PKSite\n        WHERE       PKCustomer = @pkCustomer    \n\n\n            IF ( SELECT COUNT(FKCustomer)  \n                    FROM         tblCustomerContact\n                    WHERE FKCustomer =  @pkCustomer \n                    GROUP BY FKCustomer\n                    HAVING  \n                    (MAX(CAST(EmailGoodsInInvoices AS int)) = 1 )\n                    AND (MAX(CAST(EmailGoodsOutInvoices AS int)) = 1) \n                    AND (MAX(CAST(EmailStockStorageInvoices AS int))= 1) \n                    AND (MAX(CAST(EmailTransportInvoices AS int)) = 1)\n                ) &gt; 0\n            BEGIN\n                -- UPDATE VI\n                SET @sql  = 'UPDATE c\n                SET  Email = 1,\n                IsPrint = 0\n                FROM [' + @serverName + '].' + @dbName + '.dbo.tblCustomerReportPrintOption c \n                WHERE CustomerCode =  ' + '''' +  @CustomerCode + '''' + ' AND SiteCode = ' + '''' + @siteCode + ''''   \n\n                EXEC(@sql)\n\n            END \n            ELSE\n            BEGIN\n                -- UPDATE VI\n                SET @sql  = 'UPDATE c\n                SET  Email = 0,\n                IsPrint = 1\n                FROM [' + @serverName + '].' + @dbName + '.dbo.tblCustomerReportPrintOption c \n                WHERE CustomerCode =  ' + '''' +  @CustomerCode + '''' + ' AND SiteCode = ' + '''' + @siteCode + ''''   \n\n                EXEC(@sql)\n            END\n    END\n\n\nEND\n</code></pre>\n\n<p>When I try to update one of the table value using an update query </p>\n\n<p>update tblCustomerContact set lastname='test3'</p>\n\n<p>where PKCustomerContact=3473</p>\n\n<p>I am getting the below error in </p>\n\n<p>Transaction context in use by another session.</p>\n\n<p>Can anyone help me please?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13229558,"title":"An expression of non-boolean type specified in a context where a condition is expected, near ','","body":"<p>I've reviewed other similar questions on this however I do not have a <code>Where</code> clause in my query which leaves me a little confused as to how to resolve it.</p>\n\n<pre><code>INSERT INTO #tmpCombined  \nSELECT A.Region  \n    , 'MyLocation' AS 'Location'  \n    , c.Id AS 'CompID'  \n    , c.Name AS 'CompName'  \n    , 'Cash' AS 'Context'  \n    , isnull( sum( CASE WHEN T.TranAge &gt;= 0 and CASE WHEN T.TranAge &lt; 1 THEN 1 ELSE 0 END,0 )) AS 'ZeroDays0'  \n    , isnull( sum( CASE WHEN T.TranAge &gt;= 1 and CASE WHEN T.TranAge &lt; 8 THEN 1 ELSE 0 END ), 0 ) AS '1to7Days'  \n    , isnull( sum( CASE WHEN T.TranAge &gt;=  8 and CASE WHEN T.TranAge &lt; 16 THEN 1 ELSE 0 END ), 0 ) AS '8to15Days'  \n    , isnull( sum( CASE WHEN T.TranAge &gt;=  16 and CASE WHEN T.TranAge &lt; 20 THEN 1 ELSE 0 END ), 0 ) AS '16to20Days'  \n    , isnull( sum( CASE WHEN T.TranAge &gt;=  20 THEN 1 ELSE 0 END ), 0 ) AS '20DaysPlus'  \n    , COUNT(1) AS 'Total'  \n    , A.Level as 'Level'  \n    , sum(T.USDDifference) AS 'USDRevaluation'  \n    from MyLocation.dbo.Company C  \n    inner join #tmpCashTBResults T on T.CompanyId = C.Id  \n    inner join #tmpCashAccounts A on T.CompanyId = A.CompanyId  \n    group by A.Region, C.Id, C.Name, A.Level  \n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13229808,"title":"Can we realy on DMV Data?","body":"<p>Hi i am using SQL SERVER 2008 R2. i have to capture the details of backend process or execution is going on in sql server. and wanted to figure out the total number of time it got exectuted , cpu utilization, read, writes. To get the exact data from DMV do we really need to flush DMV or not ? </p>\n"},{"tags":["mysql","sql-server-2008","drupal-6","windows-server-2008","database-connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13221245,"title":"Sync SQL Server 2008 with database of a Drupal website","body":"<p>I have a client who's using some custom built progam which uses SQL server 2008 DB and is running on Windows Server 2008.\n On the other hand, the same client has a Drupal 6 website  with a mySQL DB.\nEach DB is stored on a different server, and the DB's have <b> some </b> tables in common but not all of them.\nThat client wants a 2 way synchronization between these DB's, which means the following: <br> <br>\n1. Those tables which are similar in both DB's have to contain the same data. <br>\n2. The client can make changes in both website and the program and the changes in one DB will be mirrored on to the second.<br> <br></p>\n\n<p>How would you approach such problem? <br><br>\nThanks for your time and trouble , any (well, almost any) piece of advice will be appreciated.<br>\nJimbo.</p>\n"},{"tags":["c#","sql-server","database","sql-server-2008","database-administration"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":13227146,"title":"Want an idea in writing a code section","body":"<p>Scenario :\nI am creating a admin tool in C# which will restore a full sql server backup in a server and apply the transaction logs. After db come up. I have run a few scripts shown below. </p>\n\n<pre><code>use master\nEXEC sp_addlogin '&lt;destsid&gt;', '&lt;sidadmpass&gt;','&lt;dbname&gt;'\nuse &lt;dbname&gt;\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nEXEC sp_change_users_login 'Update_One','&lt;destsid&gt;','&lt;destsid&gt;'\nuse master\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse msdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC     sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse model\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse tempdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\ngrant all on xp_cmdshell to &lt;destsid&gt;\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'serveradmin'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'dbcreator'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'bulkadmin'\nuse &lt;dbname&gt;\nif object_id('sp_change_sapuser') is not null\n    drop procedure sp_change_sapuser \ncreate procedure sp_change_sapuser @oldid sysname, @newid sysname\nas begin\ndeclare @oldid_uid  smallint\ndeclare @newid_uid  smallint    \ndeclare @object     sysname\ndeclare @object_full    nvarchar(999)\nset @oldid_uid = user_id(@oldid)\nset @newid_uid = user_id(@newid)\nif @oldid_uid is not null and @newid_uid is not null\nbegin\ndeclare object_cursor cursor local for \nselect name from sysobjects where((xtype='U' and name &lt;&gt; 'dtproperties') or (xtype='V' and name not in ('syssegments','sysconstraints')) or (xtype='P' and name not like 'dt_%') or (xtype='D' and name not like 'DF__dtpropert%') or (xtype in ('FN','TF','IF'))) and @oldid_uid = uid\nopen object_cursor\nfetch next from object_cursor into @object\nwhile @@fetch_status=0\nbegin\nset @object_full = user_name(@oldid_uid) + '.' + @object\nexec sp_changeobjectowner @object_full, @newid\nfetch next from object_cursor into @object\nend\nend\nelse\nif @oldid_uid is null\nbegin\nprint '*** old database user does not exist ***'\nend\nif @newid_uid is null\nbegin\nprint '*** new database user does not exist ***'\nend\nend\nexec sp_change_sapuser '&lt;sourcesid&gt;', '&lt;destsid&gt;'\nuse master\nEXEC sp_grantlogin   'AMR\\&lt;destsid&gt;adm'\nEXEC sp_grantlogin   'AMR\\SAPService&lt;dbname&gt;'\nEXEC sp_defaultdb    'AMR\\&lt;destsid&gt;adm','&lt;dbname&gt;'\nEXEC sp_defaultdb    'AMR\\SAPService&lt;dbname&gt;','&lt;dbname&gt;'\nEXEC sp_addsrvrolemember 'AMR\\&lt;destsid&gt;adm',     'sysadmin'\nEXEC sp_addsrvrolemember 'AMR\\SAPService&lt;dbname&gt;', 'sysadmin'\nEXEC xp_sqlagent_proxy_account 'SET', '&lt;servername&gt;', 'SAPMssXPUser',N'&lt;sidadmpass&gt;'\nuse master\nEXEC sp_addlogin '&lt;destsid&gt;', '&lt;sidadmpass&gt;', &lt;dbname&gt;\nuse &lt;dbname&gt;\nEXEC sp_change_users_login 'Update_One','&lt;destsid&gt;','&lt;destsid&gt;'\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse msdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse model\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse tempdb\nEXEC sp_grantdbaccess '&lt;destsid&gt;'\nEXEC sp_addrolemember 'db_owner', '&lt;destsid&gt;'\nuse master\ngrant all on xp_cmdshell to &lt;destsid&gt;\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'serveradmin'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'dbcreator'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;', 'bulkadmin'\n--EXEC xp_sqlagent_proxy_account 'SET', '&lt;servername&gt;', 'SAPMssXPUser', N'&lt;sidadmpass&gt;'\nEXEC sp_grantlogin   '&lt;destsid&gt;adm'\nEXEC sp_grantlogin   'SAPService&lt;dbname&gt;'\nEXEC sp_defaultdb    '&lt;destsid&gt;adm','&lt;dbname&gt;'\nEXEC sp_defaultdb    'SAPService&lt;dbname&gt;','&lt;dbname&gt;'\nEXEC sp_addsrvrolemember '&lt;destsid&gt;adm',     'sysadmin'\nEXEC sp_addsrvrolemember 'SAPService&lt;dbname&gt;', 'sysadmin'\n</code></pre>\n\n<p>Note : values given  will be replaced with actual values.</p>\n\n<p>While running these scripts few may throw exceptions. But i want to continue even though some scripts throws error. And also i have removed GO(batch terminator) because i cannot add separate dll into server. Please suggest some idea to get this problem solved. </p>\n\n<p>Details :\nProgramming lang : C#\nDb - Sql Server 2005,08</p>\n"},{"tags":["xml","sql-server-2008","asp-classic"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13221383,"title":"How to ignore \"The process cannot access the file because it is being used by another proces\"","body":"<p>The setup is this:</p>\n\n<p>Whenever an error occurs on my website, an error-site is being displayed while an e-mail is being sent to the administrator.</p>\n\n<p>The website show a lot of live statistics automaticly updated every 15 second via AJAX and XML. But the statistics are only calculated once every 15 second, no matter how many users there is.\nThis is done by a timestamp hidden ind the MSSQL database:</p>\n\n<ul>\n<li>The website check if the timestamp is older than 14 seconds</li>\n<li>If it is, then it updates the timestamp and runs the calculation of the stats and saved them to XML</li>\n<li>At last the XML are being looped through and showing the requested stats to the users</li>\n</ul>\n\n<p>IF the timestamp is NOT older than 15 seconds, the second step is being skipped.</p>\n\n<p>Now my problem is, that if 2 users makes the timestamp request at the same time then the system doesn't have the time to update the timestamp before both of the users tries to update the XML document, causing one of them to fail with the error message:</p>\n\n<blockquote>\n<pre><code>msxml3.dll (0x80070020)\nThe process cannot access the file because it is being used by another process.\n/file.asp, line 310\n</code></pre>\n</blockquote>\n\n<p>Is it possible to check if the process is being used BEFORE trying to save the XML document? Or maybe ignoring this explicit kind of error?</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13226450,"title":"Get latest updated records","body":"<p>I have an \"Observation\" table in SQL Server 2008. This table has a locationId column for a bunch of geographic locations, a few columns for observation details and a column for latest updated date.</p>\n\n<p>Every week, a new observation record for each location is appended. So a location has many occurrences in the table.</p>\n\n<p>What I want to achieve is to be able to get the most recent observation record for each location.</p>\n\n<p>Can anyone help with any idea?</p>\n\n<p>Thanks in advance.</p>\n\n<p>Cheers,\nAlex</p>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0","stored-procedures","dataset"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13210110,"title":"Store Procedure Return Data in MS Managment Studio .Not return Any Data When Call Using C#","body":"<p>==========================STORE PROCEDURE===============================</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROC [dbo].[SerachTickets]\n    @StoreID varchar(70),\n    @StatusID varchar(70),\n     @CustomerName varchar(400),\n         @TicketNo varchar(70),\n         @StratDate varchar(100),\n         @ESTDate varchar(100),\n         @StaffID varchar(100),\n         @ServiceItemID varchar(100)\nAS \n    SET NOCOUNT ON \n    SET XACT_ABORT ON  \n    declare @sql nvarchar(MAX)\n\n    Set @sql='SELECT   Ticket.TicketID,Ticket.StaffID,ServiceItemInfo.ServiceItemID,\n    ISNULL(TicketWorkLog.WorkLogDesc,'''') WorkLogDesc,\n     Ticket.SerialNo, Convert(varchar(50),Ticket.CreationDate,101) CreationDate,\nAdmin_ServiceItem.ServiceItem,Convert(varchar(50),Ticket.CompletionDate,101) CompletionDate, Ticket.IsPickedUp, \nTicket.IsPaid, Ticket.IsVoid, Ticket.IsReadyForPayment, ISNULL(Ticket.TicketDetail,'''') TicketDetail,\nAdmin_Staff.StaffFirstName + '' ''+ Admin_Staff.StaffLastName As StaffFullName\nFROM   Ticket \nLEFT JOIN   Admin_Staff ON Ticket.StaffID = Admin_Staff.StaffID \nLEFT JOIN   TicketWorkLog ON Ticket.TicketID = TicketWorkLog.TicketID\nLEFT JOIN   ServiceItemInfo On Ticket.TicketID = ServiceItemInfo.TicketID\nLEFT JOIN   Admin_ServiceItem On ServiceItemInfo.ServiceItemID = Admin_ServiceItem.ServiceItemID  \nLEFT JOIN   Customer On Ticket.CustomerID = Customer.CustomerID\n       WHERE Ticket.StoreID='+@StoreID\n\n       if @StatusID &lt;&gt; '' \n        BEGIN\n        Set @sql =@sql + ' AND TicketWorkLog.StoreWorkLogID = '+@StatusID\n        END \n\n       if @CustomerName &lt;&gt; ''\n        BEGIN\n        Set @sql =@sql + ' AND (Customer.FirstName Like(''%'+@CustomerName+'%'')'\n        END\n\n        if @CustomerName &lt;&gt; ''\n        BEGIN\n        Set @sql =@sql + ' OR Customer.LastName Like(''%'+@CustomerName+'%''))'\n        END\n\n       if @TicketNo &lt;&gt; ''\n        BEGIN\n        Set @sql =@sql + ' AND Ticket.SerialNo Like(''%'+@TicketNo+'%'')'       \n        END\n\n       if @StratDate &lt;&gt; '1900-01-01 00:00:00'\n        BEGIN\n        Set @sql =@sql + ' AND Ticket.CreationDate Between ''' +Convert(varchar(100),Convert(DateTime,@StratDate),101)+ ''' AND '''+Convert(varchar(100),Convert(DateTime,@StratDate),101)+''''     \n        END\n\n       if @ESTDate &lt;&gt; '1900-01-01 00:00:00'\n        BEGIN\n        Set @sql =@sql + ' AND Ticket.CompletionDate Between ''' +Convert(varchar(100),Convert(DateTime,@ESTDate),101)+ ''' AND '''+Convert(varchar(100),Convert(DateTime,@ESTDate),101)+''''       \n        END\n       if @StaffID &lt;&gt; '0'\n        BEGIN\n        Set @sql =@sql + ' AND Ticket.StaffID ='+@StaffID       \n        END\n\n       if @ServiceItemID &lt;&gt; ''\n       BEGIN\n        Set @sql =@sql + ' AND ServiceItemInfo.ServiceItemID ='+@ServiceItemID      \n        END\n\n--print @sql;\n--exec SerachTickets 1,'','','','1900-01-01 00:00:00','1900-01-01 00:00:00',0,''  \nExec (@sql)\n</code></pre>\n\n<p>==============================C# CODE==================================</p>\n\n<pre><code>try\n            {\n                using (SqlConnection sqlCon = new SqlConnection(ConfigurationManager.ConnectionStrings[\"SqlServer\"].ToString()))\n                {\n                    DateTime? dtStart = Convert.ToDateTime(\"01/01/1900\");\n                    DateTime? dtEst = Convert.ToDateTime(\"01/01/1900\");\n                    int intAssign = 0;\n\n                    if (!string.IsNullOrEmpty(Request.QueryString[\"sdate\"]))\n                    {\n                        dtStart = Convert.ToDateTime(Request.QueryString[\"sdate\"]);\n                    }\n\n                    if (!string.IsNullOrEmpty(Request.QueryString[\"estdate\"]))\n                    {\n                        dtEst = Convert.ToDateTime(Request.QueryString[\"estdate\"]);\n                    }\n\n                    if (!string.IsNullOrEmpty(Request.QueryString[\"assign\"]))\n                    {\n                        intAssign = Convert.ToInt32(Request.QueryString[\"assign\"]);\n                    }\n\n\n                    using (SqlCommand cmd =sqlCon.CreateCommand())\n                    {\n                        DataSet dataset = new DataSet();\n\n                        sqlCon.Open();\n\n                        cmd.CommandType = CommandType.StoredProcedure;\n                        cmd.CommandText = \"SerachTickets\";\n\n                        cmd.Parameters.AddWithValue(\"@StoreID\", Session[\"StoreID\"]);\n                        cmd.Parameters.AddWithValue(\"@StatusID\", Request.QueryString[\"sid\"]);\n                        cmd.Parameters.AddWithValue(\"@CustomerName\", Request.QueryString[\"cname\"]);\n                        cmd.Parameters.AddWithValue(\"@TicketNo\", Request.QueryString[\"tno\"]);\n                        cmd.Parameters.AddWithValue(\"@StratDate\", dtStart);\n                        cmd.Parameters.AddWithValue(\"@ESTDate\", dtEst);\n                        cmd.Parameters.AddWithValue(\"@StaffID\", intAssign);\n                        cmd.Parameters.AddWithValue(\"@ServiceItemID\", Request.QueryString[\"itemid\"]);\n                        using (SqlDataAdapter da = new SqlDataAdapter(cmd))\n                        {\n\n                            da.Fill(dataset);\n                            cmd.Connection.Close();\n                            grdTickets.DataSource = dataset.Tables[0];\n                            grdTickets.DataBind();\n\n                        }\n                    }\n                }\n\n            }\n            catch (Exception ee)\n            {\n            }\n</code></pre>\n\n<p>==============================================================================</p>\n\n<p>I have checked using SQL PROILER What Values C# Sending To The SQL Server..</p>\n\n<p>exec SerachTickets @StoreID=1,@StatusID=N'',@CustomerName=N'',@TicketNo=N'',@StratDate='1900-01-01 00:00:00',@ESTDate='1900-01-01 00:00:00',@StaffID=0,@ServiceItemID=N''</p>\n\n<p>When run this query in MS Managment Studio It return the desired result but in C# No Dara return..</p>\n"},{"tags":["sql","xml","sql-server-2008","tsql","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13225619,"title":"Error when using modify and insert on XML data retreived from table: Must be single node","body":"<p>I am attempting to insert into some xml I am retreiving from a column in a table. I retrieve it as follows:</p>\n\n<pre><code>DECLARE @profiles_xml xml\nDECLARE @profile_id int\nSET @profile_id = 16\nSET @profiles_xml = (SELECT profiles from tbl_applied_profiles WHERE\nprofiles.value('(Profile/ID)[1]','int')= @profile_id)\n</code></pre>\n\n<p>The resulting xml looks like this:</p>\n\n<pre><code>&lt;Profile&gt;\n  &lt;ID&gt;16&lt;/ID&gt;\n  &lt;User&gt;\n    &lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;\n    &lt;Name&gt;test&lt;/Name&gt;\n    &lt;Activities /&gt;\n  &lt;/User&gt;\n&lt;/Profile&gt;\n</code></pre>\n\n<p>However when I try and insert an element into it like this:</p>\n\n<pre><code>SET @devices_xml.modify('insert &lt;Activity&gt;&lt;Name&gt;testname&lt;/Name&gt;&lt;/Activity&gt;\n as first into (Profiles/User/Activities[1])')\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>XQuery [modify()]: The target of 'insert' must be a single node, found 'element(Activities,xdt:untyped) *'\n</code></pre>\n\n<p>I don't understand why there is an error, as there is only one Activities element currently. Thanks in advance.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13226276,"title":"How to use result of an SQL select statement in dbo.fnSplit function as input","body":"<p>I have a requirement to use a comma seperated string (which is a value in a table column) \nin 'IN' clause of an SQL statement(SQL server 2008)\nFor this I am using below split function to make the string in a tabular format and use it in the 'IN' clause of an SQL query.</p>\n\n<pre><code>ALTER FUNCTION dbo.fnSplit(\n@sInputList VARCHAR(8000) -- List of delimited items\n , @sDelimiter VARCHAR(8000) = ',' -- delimiter that separates items\n ) RETURNS @List TABLE (item VARCHAR(8000))\n\nBEGIN\n DECLARE @sItem VARCHAR(8000)\n WHILE CHARINDEX(@sDelimiter,@sInputList,0) &lt;&gt; 0\n  BEGIN\n    SELECT\n     @sItem=RTRIM(LTRIM(SUBSTRING(@sInputList,1,CHARINDEX\n      (@sDelimiter,@sInputList,0)-1))),  @sInputList=RTRIM(LTRIM(SUBSTRING(@sInputList,CHARINDEX\n      (@sDelimiter,@sInputList,0)+LEN(@sDelimiter),LEN(@sInputList))))\n\n  IF LEN(@sItem) &gt; 0\n    INSERT INTO @List SELECT @sItem\n  END\n\n IF LEN(@sInputList) &gt; 0\n     INSERT INTO @List SELECT @sInputList -- Put the last item in\n     RETURN\n  END\nGO\n\nselect * from dbo.fnSplit('aaa,bbb,ccc', ',')\n</code></pre>\n\n<p>Above select statement gives result as:</p>\n\n<pre><code>Item\naaa\nbbb\nccc\n</code></pre>\n\n<p>Now I need to use my SQL statement which returns the string aaa,bbb,ccc  in the fnSplit function as below</p>\n\n<pre><code>  select * from dbo.fnSplit((SELECT Prefix2Include FROM dbo.vw_PrefixToInclude), ',')\n</code></pre>\n\n<p><strong>Note:</strong> <code>SELECT Prefix2Include FROM dbo.vw_PrefixToInclude returns aaa,bbb,ccc</code></p>\n\n<p>But this gives me some syntax error as below:</p>\n\n<pre><code>Msg 102, Level 15, State 1, Line 4\n  Incorrect syntax near '('.\n  Msg 102, Level 15, State 1, Line 4\n  Incorrect syntax near ',\n</code></pre>\n\n<p>Please guide me on this.</p>\n\n<p>Thanks,\nSoumya</p>\n"},{"tags":["sql","xml","sql-server-2008","tsql","xquery"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13226336,"title":"Use varchar stored procedure parameter in If condition of xquery insert","body":"<p>Is it possible to use a nvarchar type sproc variable in an xquery insert statement within the stored procedure?\nWhat I mean is something like this, in which an element is inserted only if a child element with the sought for value is present:</p>\n\n<pre><code>DECLARE @profiles_xml xml\nDECLARE @profile_id int\nDECLARE @user_id nvarchar(50)\nSET @profile_id = 20\nSET @user_id ='BC4A18CA-AFB5-4268-BDA9-C990DAFE7783'\nSET @profiles_xml = (SELECT profiles from tbl_applied_profiles WHERE profiles.value('(Profile/ID)[1]','int')= @profile_id)\nSET @profiles_xml.modify('\ninsert\nif(/Profile/User/ID=\"user_id\")\nthen &lt;Activity&gt;activity_name5&lt;/Activity&gt;\nelse()\nas first\ninto (/Profile/User/Activities)[1]')\n</code></pre>\n\n<p>The xml which @profiles_xml contains looks like this:</p>\n\n<pre><code>&lt;Profile&gt;\n  &lt;ID&gt;20&lt;/ID&gt;\n  &lt;User&gt;\n    &lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;\n    &lt;Name&gt;somename&lt;/Name&gt;\n    &lt;Activities&gt;\n      &lt;Activity&gt;activity_name2&lt;/Activity&gt;\n    &lt;/Activities&gt;\n  &lt;/User&gt;\n&lt;/Profile&gt;\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":42,"score":-3,"question_id":13225652,"title":"How to tamper proof file so restrictedly so that even user could not replace it with an initial captured version of the file","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2151222/how-to-make-a-file-tamper-proof\">How to make a file tamper proof?</a>  </p>\n</blockquote>\n\n\n\n<p>The scenario is,In a Asp.net Web application, I have to create a config file which is surly encrypted because I dont want users to change or view the content. \nThe problem is the file is going to change periodically with different data each time.\nWe need it to be so tamper proof so that user could not capture the file (when it is in initial state) and restore it back For instance lets say the information of the file is how many times left for the app to run until it expires in this case if users captures the initial state of the file and restore it all the time, the app will run for ever </p>\n\n<p>Rules:</p>\n\n<ul>\n<li>we dont wanted to have a hash of the file somewhere else because user could find that file and capture that one as well</li>\n<li>we could not rely on internet connection because the user may not\nhave one</li>\n<li>Don't need to worry about the system date time being changed by user(the application is time based so the data they can report will not be accurate if they change the system date time. So they wont)</li>\n</ul>\n\n<p>I'm also happy to put this data in a database if there is any tamper proofing method that,  needs my data to be stored on a SQL database</p>\n\n<p>Thanks </p>\n"},{"tags":["sql","sql-server-2008","ssis","ssis-data-transformations","collate"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13180214,"title":"How can I convert \"SQL_Latin1_ General\" Collate Using an SSIS Package?","body":"<p>We've just noticed 2 of our servers have been set up using <strong>SQL_Latin1_General_CP1_CI_AS</strong> and <strong>Latin1_General_CI_AS</strong>. </p>\n\n<p>I've created a script which compares two sources of data again each other (as it's a simple SELECT statement I haven't included it, it uses the same columns but from different sources) when I tried to union them together I received the collate error.</p>\n\n<blockquote>\n  <p>Msg 468, Level 16, State 9, Line 2\n      Cannot resolve the collation conflict between \n      \"<strong>SQL_Latin1_General_CP1_CI_AS</strong>\" and \"<strong>Latin1_General_CI_AS</strong>\" in the UNION operation.</p>\n</blockquote>\n\n<p>One of the sources is a table which is being populated by an <strong>SSIS</strong> package, is there a way of adapting the SSIS project to convert the \"SQL_Latin1_General_CP1_CI_AS\" format to \"Latin1_General_CI_AS\" before it's sent to the destination table?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13224886,"title":"Why does a left join return differently to a NOT IN?","body":"<p>The following query is behaving somewhat strangely:</p>\n\n<pre><code>SELECT #batches.OutTo, PO_Number, CONVERT(varbinary, #batches.OutTo) , convert     (varbinary, PO_Number), \n    CASE WHEN convert(varbinary, #batches.OutTo) NOT IN (SELECT convert(varbinary,    PO_Number) FROM #pos) \n         THEN 'NOT IN' ELSE 'IN' END\nFROM #batches LEFT JOIN #pos ON \n    convert(varbinary, #batches.OutTo) = CONVERT(varbinary, PO_Number)\nWHERE #batches.OutTo IS NOT NULL\nGROUP BY #batches.OutTo, #pos.PO_Number\n\n\nOutTo       PO_Number   (No column name)    (No column name)    (No column name)\n311117      NULL        0x333131313137      NULL                    IN\n311130      311130      0x333131313330      0x333131313330          IN\n311259      NULL        0x333131323539      NULL                    IN\nL001934     L001934     0x4C303031393334    0x4C303031393334        IN\nL001988     NULL        0x4C303031393838    NULL                    IN\nL002002     NULL        0x4C303032303032    NULL                    IN\n</code></pre>\n\n<p>As you can see, the left join behaves correctly, but the NOT IN does not, returning IN for values that should be NOT IN. Why is this? Is it a bug, or a feature of SQL I don't know about?</p>\n"},{"tags":["sql","xml","sql-server-2008","tsql","insert"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13223781,"title":"XML parsing error: 'A string literal was expected' when inserting values into table","body":"<p>In Microsoft SQL Server 2008 I am attempting to insert values into an sql table with the columns <strong>type_id of datatype int</strong> and <strong>xml_info of datatype XML</strong>. I am using the following query:</p>\n\n<pre><code>INSERT INTO tbl_applied_devices ([type_id],[xml_info])\nVALUES (1,'&lt;Profile ID=99&gt;&lt;Server&gt;&lt;ID&gt;BC4A18CA-AFB5-4268-BDA9-C990DAFE7783&lt;/ID&gt;  &lt;Name&gt;localhost&lt;/Name&gt;&lt;Services&gt;&lt;/Services&gt;&lt;/Server&gt;&lt;/Profile&gt;')\n</code></pre>\n\n<p>But I keep getting this error:</p>\n\n<blockquote>\n  <p>Msg 9413, Level 16, State 1, Line 4<br>\n  XML parsing: line 1, character 13, A string literal was expected  </p>\n</blockquote>\n\n<p>What am I doing incorrectly?</p>\n\n<p><strong>EDIT:</strong>\nI found that the source of the error is the xml element's ID attribute, <code>&lt;Profile ID=99&gt;</code> seems to be what is causing the error. How can I correctly insert xml with an attribute ? Do I need to somehow escape one of the characters?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":61,"score":0,"question_id":13217122,"title":"Comma-separated string in IN clause of SQL query","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4462415/how-to-pass-a-variable-in-where-in-clause-of-oracle-sql\">how to pass a variable in WHERE IN clause of oracle sql?</a>  </p>\n</blockquote>\n\n\n\n<p>I have a column <code>Prefix</code> in my table <code>Tbl_Prefix</code> with value as string separated by comma like this:</p>\n\n<pre><code>'aaa','bbb','ccc'\n</code></pre>\n\n<p>I have an employee table <code>Tbl_Employee</code> like this:</p>\n\n<pre><code>Empno Prefix\n------------\n1000  aaa\n2000  eee\n3000  ccc\n4000  aaa\n5000  ddd\n</code></pre>\n\n<p>I need to use this prefix in the <code>IN</code> portion of my <code>WHERE</code> clause in this query:</p>\n\n<pre><code>Select * \nfrom Tbl_Employee  \nwhere Tbl_Employee.Prefix  in (select  Tbl_Prefix.prefix \n                               from Tbl_Prefix \n                               where Tbl_Prefix.flag = 'y') \n</code></pre>\n\n<p>The inner select query <code>select Tbl_Prefix.prefix from Tbl_Prefix where Tbl_Prefix.flag='y'</code> has the result <code>'aaa','bbb','ccc'</code></p>\n\n<p>How to use this string in the 'IN' clause so that I will get a proper result?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13156617,"title":"SQL query caching","body":"<p>The first run of following query takes about 45 seconds and all the next ones only 1 second. Can you please explain what is the reason and how is it possible to make query run faster on the first execute too?</p>\n\n<pre><code>OPEN SYMMETRIC KEY TEST_KEY DECRYPTION BY PASSWORD='password'\n\nSELECT this.ID FROM SeparationFiles this\nINNER JOIN BarcodeValues b ON this.FIRST_BARCODE_ID = b.ID\nWHERE DecryptByKey(b.ENCRYPTED_VALUE, 0) = 'Peter'\n</code></pre>\n\n<p>Here is execution plan: </p>\n\n<p><img src=\"http://i.stack.imgur.com/u6dJt.png\" alt=\"Execution plan\"></p>\n"},{"tags":["sql","sql-server-2008","datetime"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":13221690,"title":"Can I calculate there's how many weekend days between two dates in SQL Server?","body":"<p>I'm calculating income of hiring equipments for a report. In that, hiring cost in weekend days will be plus 10% more if compare with normal days. So how can I calculate there's how many weekend days between two dates. And in report query, I can't use DECLARE also. Can someone help me to do this. Thank you so much</p>\n"},{"tags":["sql","vb.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2095,"score":0,"question_id":9784301,"title":"Inserting data from a DataGridView to a database","body":"<p>I have a small DataGridView which lets the user enter data.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SljPE.png\" alt=\"Ths is the grid\"></p>\n\n<p>And I'm trying this code to enter the data in the DataGridView to the database.</p>\n\n<pre><code>    strQry = \"INSERT INTO Emp_Fam_Details (empID, famName, famAge, famRelation, famOccup)\" _\n            &amp; \"VALUES (@ID, @Name, @Age, @Rel, @Occ)\"\n    Dim adapFam As New SqlDataAdapter\n    adapFam.InsertCommand = New SqlCommand(strQry, sqlcon)\n\n    For i As Integer = 0 To grdFamily.Rows.Count - 1\n        adapFam.InsertCommand.Parameters.AddWithValue(\"@ID\", txtEmpID.Text.Trim)\n        adapFam.InsertCommand.Parameters.AddWithValue(\"@Name\", grdFamily.Columns(0))\n        adapFam.InsertCommand.Parameters.AddWithValue(\"@Age\", grdFamily.Columns(1))\n        adapFam.InsertCommand.Parameters.AddWithValue(\"@Rel\", grdFamily.Columns(2))\n        adapFam.InsertCommand.Parameters.AddWithValue(\"@Occ\", grdFamily.Columns(3))\n\n        result2 = adapFam.InsertCommand.ExecuteNonQuery()\n    Next\n</code></pre>\n\n<p>When I run this, I come across this error.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Nf1X4.png\" alt=\"This is the error\"> </p>\n\n<p>I found <a href=\"http://stackoverflow.com/a/9391411/1077789\">this</a> solution here on SO but since I'm using Parameters not appended values, I'm having a hard time understanding how to do it with parameters. </p>\n\n<p>Can anyone please show me how to do this? </p>\n\n<p>Thank you all. </p>\n"},{"tags":["sql-server-2008","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12691504,"title":"Compare data against sql column","body":"<p>I have collection of numbers like: 11111, 12345, 12346 stored in a list in c# code. I need to compare this list against sql database column of numbers similar to this and find out if matching numbers exist. Below is what i am doing:</p>\n\n<pre><code>foreach (number in numbers)\n{\n    //get column data through sql reader and iterate through it:\n    foreach(column in columnData)\n    {\n       if(number == column)\n       {\n         // do something\n       }\n}\n</code></pre>\n\n<p>my question is this right approach? Or is there a better way to do this? As it looks like this requires lots of processing.</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":62,"score":0,"question_id":13216924,"title":"How can i update another tables after adding record to a table in sql server 2008","body":"<p>I have two same tables created in SQL Server 2008.</p>\n\n<p>What I need is:</p>\n\n<p><strong>Add the newest data inserted in <code>table1</code> into <code>table2</code>.</strong></p>\n\n<p>Is that possible? </p>\n\n<p>Something like services or triggers or stored procedures?</p>\n\n<p>I think that I have to use triggers, but I don't know how.</p>\n\n<p>I have these two tables:</p>\n\n<pre><code>table1  ( field1,field2,field3 )\ntable2  ( field1,field2,field3 )\n</code></pre>\n\n<p>when i insert into table1 i need table2 to be updated as the procedure below:    </p>\n\n<pre><code>&gt; IF NotExist(field1=value) in table2 THEN INSERT Into table2 ELSE UPDATE table2\n&gt; with new field1 value.\n</code></pre>\n"},{"tags":["visual-studio","sql-server-2008","database-connection","webhost"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3673,"score":1,"question_id":2965994,"title":"Connecting to database on web host in Visual Studio or Sql Server Management Studio","body":"<p>I have a web site developed locally with a local Sql Server database. I also have a web host that provides one Sql Server database for my site. Now I want to deploy the application, and I would like to be able to manage the remote database from the Server Explorer in Visual Studio. I have the connection string used in the application, which works fine for adding, say, a datasource to a control etc. But I don't know if there's any way to use it to connect the database inside the Server Explorer so that I can add tables etc. I have read that you're supposed to be able to this instead of using the Sql Server Management Studio, but I have'nt read anything about how to connect to the remote database in it.</p>\n\n<p>What I have tried so far is this: I have selected Add database in Server Explorer. This brings up first a dialog where I choose Sql Server. And then I get a dialog where I can set Server name (which I tried using the ip address in the connection string below), and Authentication (where I chose Sql Server Authentication, with the user id and password from below). But when I test the connection it fails.</p>\n\n<p>Here's the connection string, which works fine when used for datasources in the application (obviously with different user name and password): </p>\n\n<p></p>\n\n<p>Any help appreciated!</p>\n\n<p>EDIT:</p>\n\n<p>Well, I've done everything suggested by lewiguez below now, but it doesn't make any difference. I can't believe this should be so hard... I keep getting this error message in Sql Server Management Studio:</p>\n\n<p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server) (Microsoft SQL Server, Error: 53)</p>\n\n<p>What is wrong? Please help...!</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13219260,"title":"Determine values that are present in only one of two tables, or in both of them","body":"<p>I have two tables in a SQL Server 2008 database in which I want to find:</p>\n\n<ul>\n<li>values present in both tables (with all columns present in both tables)</li>\n<li>values present in first table but not in second table</li>\n<li>values present in second table but not in first table</li>\n</ul>\n\n<p>Code:</p>\n\n<pre><code>CREATE TABLE #_temp\n(ATM INT, Fault INT)\n\nCREATE TABLE #_temp1\n(ATM INT, Fault INT)\n\nINSERT INTO #_temp  VALUES (10,101), (11,101), (12,101), (12,101), (10,105), (13,101)\nINSERT INTO #_temp1 VALUES (10,102), (11,101), (12,103), (12,100), (10,105), (13,101)\n\n/* My Try\n\nSELECT * FROM #_temp t RIGHT JOIN #_temp1 t1 ON t.ATM=t1.ATM AND t.Fault=t.Fault AND t.ATM IS NULL AND t.Fault IS NULL\n\nSELECT * FROM #_temp t JOIN #_temp1 t1 ON t.ATM=t1.ATM AND t.Fault=t.Fault\n\n*/\n\nDROP Table #_temp\nDROP Table #_temp1 \n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13218892,"title":"SQL Server: +(unary) operator on non-numeric Strings","body":"<p>I am surprised! This statement below is valid in <code>SQL SERVER</code>:</p>\n\n<pre><code>SELECT  +'ABCDEF'\n</code></pre>\n\n<p>Has <code>SQL Server</code> defined <code>+</code> as a <code>Unary</code> operator for string types?</p>\n"},{"tags":["sql-server-2008","iis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13209120,"title":"IIS occasionally no response","body":"<p>I'm facing a problem with a 3-tier application. It uses IIS and SQL Server. And the problem is that sometimes (longer requests cause higher probability) client does not receive response from IIS. It hangs when there is no activity ON SQL Server, and when even when I kill an SQL Process I get no response with an exception. When I examine data after these hangs I find that my SQL requests have succeeded, so the problem appears to be on IIS. Unfotunately I don't have much control over the place where the application is hosted and I cannot reproduce the problem. There can be many answers to this question, but at least I need a hint in what direction I should investigate. <br/>\n<strong>UPDATE</strong>: I also have an app running on the same server that does a small job: it inserts around a 100 lines line-by-line into a database. Artificially I made it run for about 10 minutes (by putting xlock on the table). After removing the xlock the process on IIS continued running and successfully inserted those 100 lines. However, control never returned to the client thereafter, it just waited indefinitely. It looks like this is a problem when returning a response to the client after a long running process.<br/>\nBTW, this is not a website, but a WinForms app that uses Remoting.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","full-text-search"],"answer_count":4,"favorite_count":3,"up_vote_count":10,"down_vote_count":0,"view_count":9906,"score":10,"question_id":6003240,"title":"Cannot use a CONTAINS or FREETEXT predicate on table or indexed view because it is not full-text indexed","body":"<p>I am getting following error in my SQL server 2008 R2 database:</p>\n\n<blockquote>\n  <p>Cannot use a <code>CONTAINS</code> or <code>FREETEXT</code> predicate on table or indexed view 'tblArmy' because it is not full-text indexed.</p>\n</blockquote>\n"},{"tags":["sql-server","sql-server-2008","oracle10g","data-migration"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1968,"score":0,"question_id":3482067,"title":"How to migrate database from Oracle to SQL Server?","body":"<p>I have a database on <strong>Oracle 9i</strong>. Now I want to work on <strong>SQL Server 2008</strong>. I want  to migrate the Oracle database to SQL Server, but how do I do that? Give me some syntax? Thanks for the help.</p>\n"},{"tags":["sql-server-2008","service-broker"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":336,"score":0,"question_id":2815528,"title":"Monolog conversations in SQL Service Broker 2008","body":"<p>I have a scenario in which I need to process(in SQL Server) messages being delivered as .xml files in a folder in real time.</p>\n\n<p>I started investigating SQL Service Broker for my queuing needs.  Basically, I want the Service Broker to pick up my .xml files and place them in a queue as they arrive in the folder.  But, SQL Service Broker does not support \"Monolog\" conversations, at least not in the current version.  It supports only a dialog between an initiator and a target service.</p>\n\n<p>I can use MSMQ but then I will have two things to maintain - the .Net Code for file processing in MSMQ and the SQL Server T-SQL stored procs.  What options do I have left? </p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":13192145,"title":"SQL return both table rows separately","body":"<p>I have two tables and want to return both table's rows. Both tables do not have any relation.</p>\n\n<p><code>Table 1</code> has columns <code>userid, name</code>, and other columns... and <code>Table 2</code> has only two columns <code>id, name</code>.</p>\n\n<p>I want both table results in one query result set.</p>\n\n<p>Table results:</p>\n\n<pre><code>userid name and other columns from Table 1.\nid     name and NULL, NULL should show as Table 2 do not have extra columns.\n</code></pre>\n"},{"tags":["sql","sql-server-2008","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":2579,"score":2,"question_id":1596069,"title":"OnTaskFailed event handler in SSIS","body":"<p>If I use <strong>OnError</strong> event handler in my SSIS package, there are variables <strong>System::ErrorCode</strong> and <strong>System::ErrorDescription</strong> from which I can get the error information if any things fails while execution.</p>\n\n<p>But I cant the find the same for <strong>OnTaskFailed</strong> event handler, i.e. How to get the <strong>ErrorCode</strong> and <strong>ErrorDescription</strong> from the OnTaskFailed event handler when any things fails while execution in case we want to only implement OnTaskFailed event handler for our package?</p>\n"},{"tags":["sql-server-2008","xml-dml"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":779,"score":2,"question_id":3553869,"title":"SQL Server 2008: Rename an element using XML DML?","body":"<p>Is it possible to use an XML DML statement to rename an element in an untyped XML column?</p>\n\n<p>I am in the process of updating an XML Schema Collection on an XML column and need to patch the existing XML instances by renaming one element before I can apply the latest schema.</p>\n\n<p>As far as I can tell from the docs you can only insert / delete nodes or replace their value.</p>\n"},{"tags":["sql","sql-server-2008","database-design","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13211739,"title":"Bug Tracking How to design Project Access in Sql Database schema","body":"<p>I am working on a small open-source project on Bug Tracking.</p>\n\n<p>I am a little confused on something which I need help with.</p>\n\n<p>I have two tables, one is Users and other is Projects.</p>\n\n<p><strong>Users</strong></p>\n\n<ul>\n<li>UserId</li>\n<li>Username</li>\n</ul>\n\n<p><strong>Project</strong></p>\n\n<ul>\n<li>ProjectId</li>\n<li>ProjectName</li>\n<li>ProjectDescription</li>\n</ul>\n\n<p>I have more fields, but I have abstracted them now, to make this question small.</p>\n\n<p><strong>I wanted to know how to create a relationship between Projects and Users ?</strong></p>\n\n<p>Should I have one more table that stores User-Project relationships something like</p>\n\n<p><strong>ProjectAccess</strong></p>\n\n<ul>\n<li>Id</li>\n<li>ProjectId</li>\n<li>UserId</li>\n<li>AccessType (Admin/User)</li>\n</ul>\n\n<p>I am a little new to Database schema designing, so I am not very sure. So I'm here to have a second opinion on this.</p>\n\n<p>Also I would like to know how to provide the option for an admin to add a user and how to handle this at back end.</p>\n\n<p>Any thought, comment or answers will be highly appreciated. Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13211268,"title":"returning total records in cte","body":"<p>With help from <a href=\"http://pratchev.blogspot.com/2008/11/paging-with-ranking-functions.html?m=1\" rel=\"nofollow\">article here</a> and recent answers from SO experts I have arrived with the following which will help me efficiently page through a set of records.</p>\n\n<p>I think my last couple of questions are </p>\n\n<ol>\n<li>See how I include the <code>Total Number of Records</code> in the payload at the end\nof SQL CTE called 'Total'. Is that how you would do this? </li>\n<li>Any other suggestions? Potential areas for being more concise or improvements? <code>Return Total Number of Pages</code></li>\n</ol>\n\n<hr>\n\n<pre><code>DECLARE @page_size INT = 5;\nDECLARE @page_nbr INT = 4;\nDECLARE @search NVARCHAR(MAX) = '';\nDECLARE @sort_order INT = 2;\n\nWITH AllProducts\nAS\n(\nSELECT *, \nCASE @sort_order\n    WHEN 1 THEN ROW_NUMBER() OVER ( ORDER BY ProductID )\n    WHEN 2 THEN ROW_NUMBER() OVER ( ORDER BY ProductName )\nEND AS 'Seq'    \nFROM Products\n),\nFiltered\nAS\n(\nSELECT * FROM AllProducts\nWHERE ProductName like '%'+@search+'%'\nOR\n@search is null\n)\nSELECT (select COUNT(*) from Filtered) as 'Total', * FROM Filtered\nWHERE seq &gt; (@page_nbr - 1) * @page_size\n  AND seq &lt;= @page_nbr * @page_size\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13210915,"title":"dynamic order by conversion error","body":"<p>I'm trying to do a dynamic order by on pubs database and getting the following error\nwhen I try to use <code>@sort_order = 2</code></p>\n\n<p>Msg 245, Level 16, State 1, Line 6\nConversion failed when converting the nvarchar value 'Pavlova' to data type int.</p>\n\n<p><a href=\"http://www.sqlteam.com/article/dynamic-order-by\" rel=\"nofollow\">This is the article</a></p>\n\n<pre><code>SELECT * FROM Paging\nWHERE seq &gt; (@page_nbr - 1) * @page_size\n  AND seq &lt;= @page_nbr * @page_size\nORDER BY CASE\n    WHEN @sort_order = 1 THEN ProductID\n    WHEN @sort_order = 2 THEN ProductName\n    ELSE CategoryID\nEND\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":32,"score":2,"question_id":13162663,"title":"Application vs SQL server 2008 accounts issue","body":"<p>Good day all,</p>\n\n<p>I am studing the following case:</p>\n\n<p><strong>Scenario:</strong> An application connects to the production database(SQL server 2008) using  a generic \"SA\" user instead of the domain user. This is making traces\\logs\\organization harder, because everything is flagged as done by SA user!</p>\n\n<p>NOTE: In the application the domain user/password is used, the generic account is only regarding to the database.</p>\n\n<p><strong>Questions:</strong> What would be the best pratice in this case? every user should have an account to log in the database? (sql using windows authentication) there are +- 500 users is that an issue regarding to database performance? or a generic account is indicated?</p>\n\n<p>Many thanks!</p>\n"},{"tags":["sql","sql-server","performance","sql-server-2008","query"],"answer_count":4,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":35148,"score":7,"question_id":4193705,"title":"SQL Server SELECT LAST N Rows","body":"<p>This is a known question but the best solution I've found is something like:</p>\n\n<pre><code>SELECT TOP N *\nFROM MyTable\nORDER BY Id DESC\n</code></pre>\n\n<p>I've a table with lots of rows. It is not a posibility to use that query because it takes lot of time. So how can I do to select last N rows without using ORDER BY?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Sorry duplicated question of <a href=\"http://stackoverflow.com/questions/311054/how-do-i-select-last-5-rows-in-a-table-without-sorting\">this one</a></p>\n"},{"tags":["sql-server","windows","sql-server-2008","cluster-computing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13209412,"title":"SQL Server 2008 cluster cannot add possible owner to SQL Server/SQL Server Agent Resources","body":"<p>Setting up SQL Server 2008 failover cluster on Windows Server 2008 R2</p>\n\n<p>Created cluster (added 2 nodes <code>Node1</code>, <code>Node2</code>). Installed SQL Server 2008 on <code>Node 1</code>. It installed successfully and service came up. I am able to connect through management tool using virtual IP.</p>\n\n<p>Now when I want to add <code>Node 2</code>, instance name is not displayed during installation.</p>\n\n<p>When I further analyzed, I could see possible owners for both resources SQL Server, SQL Server Agent are just Node 1. Whereas other resources have both Node 1 and Node 2.</p>\n\n<p>I tried the thing below.</p>\n\n<pre><code>C:\\Users\\administrator.GENNEYS&gt;cluster.exe res \"SQL Server\" /addowner:GEN-C7-181\n\nAdding 'GEN-C7-181' to possible owners of 'SQL Server'...\n</code></pre>\n\n<blockquote>\n  <p><em>System error 5079 has occurred (0x000013d7). The specified node does\n  not support a resource of this type. This may be due to version\n  inconsistencies or due to the absence of the resource DLL on this\n  node.</em></p>\n</blockquote>\n\n<p>How should I add another Node to possible owners of SQL Server?</p>\n\n<p>Thanks.</p>\n"},{"tags":["django","sql-server-2008","django-mssql","django-pyodbc"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":13210013,"title":"How can I connect to SQL Server 2008 R2 with django-mssql (or anything else)?","body":"<p>I've been trying walk through the django tutorial for the last few days (I'd really like to learn django), but I cannot get django to connect with sql server 2008 r2. I have administrative privileges on our server and on sql server. I initially tried with a linux box via pyodbc (but could not even connect with SQLAlchemy, which I can use on my personal computer), but now I have constructed a virtual windows box with windows server 2008 sp2 because I thought I might have more luck with django-mssql. I've tried both django-pyodbc and django-mssql on the windows box but have not yet succeeded. Here are my db settings:</p>\n\n<pre><code>DATABASES = {\n    'default': {\n        'ENGINE': 'sqlserver_ado',  # Have also tried sql_server.pyodbc\n        'NAME': 'TMSEPLAY',                      \n        'USER': '***', # Omitted for post\n        'PASSWORD': '*******', # Omitted for post\n        'HOST': '172.16.1.14',                      \n        'PORT': '1434',                   \n        'OPTIONS': {\n            'provider': 'SQLCLI10', # Have also tried 'SQLCLI11' and 'SQLOLEDB'\n            'extra_params': 'DataTypeCompatibility=80'\n            }\n    }\n}\n</code></pre>\n\n<p>The error I get:</p>\n\n<pre><code>C:\\Python27\\CourseData\\mysite&gt;manage.py syncdb\nTraceback (most recent call last):\n  File \"C:\\Python27\\CourseData\\mysite\\manage.py\", line 10, in &lt;module&gt;\n    execute_from_command_line(sys.argv)\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\__init__.py\", line\n443, in execute_from_command_line\n    utility.execute()\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\__init__.py\", line\n382, in execute\n    self.fetch_command(subcommand).run_from_argv(self.argv)\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\base.py\", line 196,\n in run_from_argv\n    self.execute(*args, **options.__dict__)\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\base.py\", line 232,\n in execute\n    output = self.handle(*args, **options)\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\base.py\", line 371,\n in handle\n    return self.handle_noargs(**options)\n  File \"C:\\Python27\\lib\\site-packages\\django\\core\\management\\commands\\syncdb.py\"\n, line 57, in handle_noargs\n    cursor = connection.cursor()\n  File \"C:\\Python27\\lib\\site-packages\\django\\db\\backends\\__init__.py\", line 306,\n in cursor\n    cursor = self.make_debug_cursor(self._cursor())\n  File \"C:\\Python27\\lib\\site-packages\\sqlserver_ado\\base.py\", line 193, in _curs\nor\n    self.__connect()\n  File \"C:\\Python27\\lib\\site-packages\\sqlserver_ado\\base.py\", line 168, in __con\nnect\n    use_transactions=self.use_transactions,\n  File \"C:\\Python27\\lib\\site-packages\\sqlserver_ado\\dbapi.py\", line 151, in conn\nect\n    raise OperationalError(e, \"Error opening connection: \" + connection_string)\nsqlserver_ado.dbapi.OperationalError: (com_error(-2147352567, 'Exception occurre\nd.', (0, u'ADODB.Connection', u'Provider cannot be found. It may not be properly\n installed.', u'C:\\\\Windows\\\\HELP\\\\ADO270.CHM', 1240655, -2146824582), None), 'E\nrror opening connection: DATA SOURCE=172.16.1.14,1434;Network Library=DBMSSOCN;I\nnitial Catalog=TMSEPLAY;UID=***;PWD=********;PROVIDER=SQLCLI10;MARS Connection=Tr\nue;DataTypeCompatibility=80;MARS Connection=True')\n</code></pre>\n\n<p>I'd appreciate any insight at all! I feel like I've searched the web twice over!</p>\n\n<p>Thanks so much!</p>\n"},{"tags":["sql-server-2008","jdbc","sonar","sonar-runner"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13208124,"title":"Sonar + MS SQL database","body":"<p>I'm attempting to initialize sonar with mssql server database, but I can't. With Microsoft SQL Server Management Studio I created the user with username \"sonar\" and password \"sonar\" and granted all the correct privileges to \"sonar\" database, also created. Also configured \"Server Authentication\" to \"SQL Server and Windows Authentication mode\".It works perfectly, but I can't have connection to the database with sonar. Thanks,</p>\n\n<p>sonar.properties;</p>\n\n<pre><code>#----- Credentials\n# Permissions to create tables and indexes must be granted to JDBC user.\n# The schema must be created first.\nsonar.jdbc.username:                       sonar\nsonar.jdbc.password:                       sonar\n\n#----- Microsoft SQLServer\n# The Jtds open source driver is available in extensions/jdbc-driver/mssql. More details on     http://jtds.sourceforge.net\nsonar.jdbc.url:jdbc:sqlserver://localhost:1433;databaseName=SONAR;instanceName=r2;selectMethod=cursor\nsonar.jdbc.driverClassName: com.microsoft.sqlserver.jdbc.SQLServerDriver\nsonar.jdbc.validationQuery: select 1\nsonar.jdbc.dialect: mssql\n\n# Optional properties\n#sonar.jdbc.driverClassName:                net.sourceforge.jtds.jdbc.Driver\n\n#----- Connection pool settings\nsonar.jdbc.maxActive:                      20\nsonar.jdbc.maxIdle:                        5\nsonar.jdbc.minIdle:                        2\nsonar.jdbc.maxWait:                        5000\nsonar.jdbc.minEvictableIdleTimeMillis:     600000\nsonar.jdbc.timeBetweenEvictionRunsMillis:  30000\n...\n</code></pre>\n\n<p>Logs;</p>\n\n<pre><code>INFO   | jvm 1    | 2012/11/02 15:45:31 | JRuby limited openssl loaded. http://jruby.org/openssl\nINFO   | jvm 1    | 2012/11/02 15:45:31 | gem install jruby-openssl for full support.\nINFO   | jvm 1    | 2012/11/02 15:46:31 | 2012-11-02 15:46:31.368:WARN:/:unable to create shared     application instance\nINFO   | jvm 1    | 2012/11/02 15:46:31 | org.jruby.rack.RackInitializationException: no connection available|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-    INF/vendor/gems/activerecord-jdbc-adapter-1.1.3/lib/arjdbc/jdbc/connection.rb:61:in `initialize'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/gems/activerecord-jdbc-adapter-1.1.3/lib/arjdbc/jdbc/adapter.rb:31:in `initialize'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/gems/activerecord-jdbc-adapter-1.1.3/lib/arjdbc/jdbc/connection_methods.rb:6:in `jdbc_connection'|?from org/jruby/RubyKernel.java:2056:in `send'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:223:in `new_connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:245:in `checkout_new_connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:188:in `checkout'|?from org/jruby/RubyKernel.java:1418:in `loop'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:184:in `checkout'|?from file:/C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/lib/jruby-complete-1.6.1.jar!/META-INF/jruby.home/lib/ruby/1.8/monitor.rb:191:in `mon_synchronize'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:183:in `checkout'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:98:in `connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_pool.rb:326:in `retrieve_connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_specification.rb:123:in `retrieve_connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/connection_adapters/abstract/connection_specification.rb:115:in `connection'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/migration.rb:435:in `initialize'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/migration.rb:400:in `up'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/vendor/rails/activerecord/lib/active_record/migration.rb:383:in `migrate'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/config/../lib/database_version.rb:63:in `upgrade_and_start'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/config/../lib/database_version.rb:75:in `automatic_setup'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/config/environment.rb:131:in `(root)'|?from org/jruby/RubyKernel.java:1063:in `load'|?from C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/config/environment.rb:53:in `load_environment'|?from file:/C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/lib/jruby-rack-1.0.0.1.jar!/jruby/rack/rails.rb:46:in `to_app'|?from file:/C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/lib/jruby-rack-1.0.0.1.jar!/jruby/rack/rails.rb:191:in `new'|?from &lt;script&gt;:2:in `(root)'|?from org/jruby/RubyKernel.java:2021:in `instance_eval'|?from file:/C:/Users/eazakli/Desktop/sonar-3.2/sonar-3.2/war/sonar-server/WEB-INF/lib/jruby-rack-1.0.0.1.jar!/vendor/rack-1.2.1/rack/builder.rb:46:in `initialize'|?from &lt;script&gt;:2:in `(root)'|\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.DefaultRackApplicationFactory$4.init(DefaultRackApplicationFactory.java:184)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.DefaultRackApplicationFactory.getApplication(DefaultRackApplicationFactory.java:59)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.SharedRackApplicationFactory.init(SharedRackApplicationFactory.java:27)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.RackServletContextListener.contextInitialized(RackServletContextListener.java:40)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.ContextHandler.startContext(ContextHandler.java:548)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.servlet.Context.startContext(Context.java:136)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1272)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:517)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:489)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.HandlerWrapper.doStart(HandlerWrapper.java:130)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.Server.doStart(Server.java:224)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.sonar.application.JettyEmbedder.start(JettyEmbedder.java:72)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.sonar.application.StartServer.main(StartServer.java:48)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at java.lang.reflect.Method.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.tanukisoftware.wrapper.WrapperSimpleApp.run    (WrapperSimpleApp.java:240)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at java.lang.Thread.run(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 | 2012-11-02 15:46:31.381:WARN:/:Error: application initialization failed\nINFO   | jvm 1    | 2012/11/02 15:46:31 | org.jruby.rack.RackInitializationException: unable to create shared application instance\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.SharedRackApplicationFactory.init(SharedRackApplicationFactory.java:39)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.jruby.rack.RackServletContextListener.contextInitialized(RackServletContextListener.java:40)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.ContextHandler.startContext(ContextHandler.java:548)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.servlet.Context.startContext(Context.java:136)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1272)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:517)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:489)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.handler.HandlerWrapper.doStart(HandlerWrapper.java:130)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.jetty.Server.doStart(Server.java:224)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.sonar.application.JettyEmbedder.start(JettyEmbedder.java:72)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.sonar.application.StartServer.main(StartServer.java:48)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at java.lang.reflect.Method.invoke(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at org.tanukisoftware.wrapper.WrapperSimpleApp.run(WrapperSimpleApp.java:240)\nINFO   | jvm 1    | 2012/11/02 15:46:31 |   at java.lang.Thread.run(Unknown Source)\nINFO   | jvm 1    | 2012/11/02 15:46:31 | 2012-11-02 15:46:31.434:INFO::Started     SelectChannelConnector@127.0.0.1:9000\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":26,"score":1,"question_id":13208411,"title":"Adding Column While Selecting Table in SQl","body":"<p>My First Table is ProjectCustomFields</p>\n\n<pre><code>CustomFieldId   ProjectId   CustomFieldName CustomFieldRequired CustomFieldDataType\n69  1   User Name   1   0\n72  1   City    1   0\n74  1   Email   0   0\n82  1   Salary  1   2\n</code></pre>\n\n<p>My Second Table is ProjectCustomFieldValues</p>\n\n<pre><code>CustomFieldValueId  ProjectId   CustomFieldId   CustomFieldValue    RecordId\n35  1   69  kaliya  1\n36  1   72  Bangalore   1\n37  1   74  mm@gmail.com    1\n41  1   69  Yohesh  2\n42  1   72  Delhi   2\n43  1   74      2\n50  1   69  sss 3\n51  1   72  Delhi   3\n52  1   74  sss@icsportal.in    3\n57  1   69  Sunil   4\n58  1   72  Mumbai  4\n59  1   74  sunil@icsportal.in  4\n60  1   82  20000   4\n</code></pre>\n\n<p>I tried Below Query </p>\n\n<pre><code>Select M.CustomFieldName\n,      N.CustomFieldValue\n,      N.RecordId \nFrom\n(\n    Select G.CustomFieldName\n    ,      H.RecordId \n    From\n    (\n        Select CustomFieldName \n        From ProjectCustomFields \n        Where ProjectId = 1\n    ) G \n    Cross Join\n    (\n        Select Distinct RecordId \n        From ProjectCustomFieldValues\n    ) H\n) M\nLeft Join \n(\n    Select CustFiled.CustomFieldName\n    ,      CustValue.CustomFieldValue\n    ,      CustValue.RecordId \n    From ProjectCustomFieldValues CustValue \n    Left Join ProjectCustomFields CustFiled  \n        On CustValue.CustomFieldId = CustFiled.CustomFieldId \n    Where CustValue.AuctionId = 1\n) N \n    On M.CustomFieldName = N.CustomFieldName \n    And M.RecordId       = N.RecordId\n</code></pre>\n\n<p>But I got the result below</p>\n\n<pre><code>#CustomFieldName#   CustomFieldValue    RecordId\nUser Name   kaliya  1\nCity    Bangalore   1\nEmail   mm@gmail.com    1\nSalary  NULL    **NULL**\nUser Name   Yohesh  2\nCity    Delhi   2\nEmail       2\nSalary  NULL    **NULL**\nUser Name   sss 3\nCity    Delhi   3\nEmail   sss@icsportal.in    3\nSalary  NULL    **NULL**\nUser Name   NULL    **NULL**\nCity    NULL    **NULL**\nEmail   NULL    **NULL**\nSalary  NULL    **NULL**\nUser Name   Sunil   4\nCity    Mumbai  4\nEmail   sunil@icsportal.in  4\nSalary  20000   4\n</code></pre>\n\n<p>But Expected Result is</p>\n\n<pre><code>CustomFieldName CustomFieldValue    RecordId\nUser Name   kaliya  1\nCity    Bangalore   1\nEmail   mm@gmail.com    1\nSalary  NULL    **1**\nUser Name   Yohesh  2\nCity    Delhi   2\nEmail       2\nSalary  NULL    **2**\nUser Name   sss 3\nCity    Delhi   3\nEmail   sss@icsportal.in    3\nSalary  NULL    **3**\nUser Name   Sunil   4\nCity    Mumbai  4\nEmail   sunil@icsportal.in  4\nSalary  20000   4\n</code></pre>\n\n<p>Please guide me some one,I tried so much but i got null value in recordId,So I need same recordId above one..</p>\n"},{"tags":["sql-server","sql-server-2008","visual-studio-2012","constraints","database-project"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":17,"score":1,"question_id":13162538,"title":"Include default constraint names in generation of update script","body":"<p>I'm using a <strong>SQL Server Database Project</strong> with Visual Studio 2012 and have the following problem when comparing and generating an update script:</p>\n\n<p>In Visual Studio, I add a column with a default constraint, for example:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>[NewColumn] NVARCHAR(50) CONSTRAINT [DF_ExistingTable_NewColumn] NOT NULL DEFAULT N''\n</code></pre>\n\n<p>Unfortunately, the name of the default constraint does not appear when:</p>\n\n<ul>\n<li>Comparing (<em>Schema Compare</em>) my project with the actual database</li>\n<li>Generating an update script (from within the <em>Schema Compare</em>)</li>\n</ul>\n\n<p>The created update script contains the following script (no constraint name):</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>ALTER TABLE [dbo].[ExistingTable]\n    ADD [NewColumn] NVARCHAR (50) DEFAULT N'' NOT NULL;\n</code></pre>\n\n<p>This seems like a major oversight, so I'm wondering where to find the magic switch to include the names of default constraints in all database operations.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":28,"score":2,"question_id":13207935,"title":"SQL Merge Statement","body":"<p>I am trying to use the new \"MERGE\" statement in SQL Server 2008. The statement will get records from a temporarty table and update the same in some other table.The statement is as following:</p>\n\n<pre><code>create table #TempTable(ProcPOAmdDel_ProcessAmendmentId bigint,ProcPOAmdDel_SemiFinProdId bigint,ProcPOAmdDel_ChallanQty int)\n\nMERGE PurProcessPOAmendmentDelivery AS pod\nUSING (SELECT ProcPOAmdDel_ProcessAmendmentId,\n       ProcPOAmdDel_SemiFinProdId FROM #TempTable ) AS temp\nON pod.ProcPOAmdDel_ProcessAmendmentId = temp.ProcPOAmdDel_ProcessAmendmentId AND \n   pod.ProcPOAmdDel_SemiFinProdId=temp.ProcPOAmdDel_SemiFinProdId \nWHEN MATCHED THEN UPDATE \n  SET pod.ProcPOAmdDel_ChallanQty = temp.ProcPOAmdDel_ChallanQty;\n</code></pre>\n\n<p>While running the state I encountered an error Invalid column    name'ProcPOAmdDel_ChallanQty'.  </p>\n\n<p>Could anybody help me in resolving the issue?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13207914,"title":"how to delete previously entered records while bulk insert in sql server","body":"<p>i have n number of records in a table named tblUserDiet, this table is having the following columns userid,DietSessionId,CreatedDate</p>\n\n<p>now user will insert some records from page.so now i want to do bulk insert.but before to this i want to delete the existing records.</p>\n\n<p>so my stored procedure query looks like below</p>\n\n<pre><code>DELETE FROM tblUserDiet WHERE UserId = @UserId AND DietSessionId=@DietSessionId \nAND DATEADD(dd, 0, DATEDIFF(dd, 0,))=DATEADD(dd,0,DATEDIFF(dd,0,GETDATE())) \nAND DATEDIFF(S,CreatedDate,GETDATE())&gt;=30 \n</code></pre>\n\n<p>but it seems to be incorrect.</p>\n\n<p>can any one suggest the best answer</p>\n\n<p>Thanks.</p>\n"},{"tags":["c#",".net","sql-server-2008","ado.net","vsts2008"],"answer_count":2,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":1726,"score":1,"question_id":1587036,"title":"SQL Server communication protocol issue","body":"<p>I am using VSTS 2008 + C# + ADO.Net + SQL Server 2008. My questions about what kinds of communication protocols SQL Server 2008 will be using, more details of my questions,</p>\n\n<ol>\n<li><p>If the connection string looks like this, whether Named Pipe or TCP/IP is used? Will different communication protocol being used dependent on whether client and SQL Server on the same machine?</p>\n\n<p>Data Source=labtest1;Initial Catalog=CustomerDB;Trusted_Connection=true;Asynchronous</p></li>\n<li><p>In SQL Server Configuration Manager, there are items called \"SQL Server Network Configuration\" and \"SQL Native Client 10.0 Configuration\". I find both of them has configuration options (for communication protocols) of Named Pipe or TCP/IP, what are the differences between \"SQL Server Network Configuration\" and \"SQL Native Client 10.0 Configuration\"?</p></li>\n</ol>\n\n<p>thanks in advance,\nGeorge</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","error-handling"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13205827,"title":"Msg 203, Level 16, State 2, is not a valid identifier","body":"<p>I'm getting the following error:</p>\n\n<blockquote>\n  <p><em>Msg 203, Level 16, State 2, Procedure getQuestion, Line 18</em><br>\n  The name 'select top(1) * from tlb_Question inner join tlb_options on tlb_options.qID=tlb_Question.id and tlb_Question.qNumber=1 and tlb_Question.id not in (0,1)' is not a valid identifier</p>\n</blockquote>\n\n<p>from the following stored procedure:</p>\n\n<pre><code>ALTER proc getQuestion\n    @qNo bigint,\n    @total bigint,\n    @next nvarchar(max)\nas\nbegin \n    declare @hisa bigint\n    set @hisa=@total/3\n\n    if(@qNo&lt;=@total/3)\n    begin\n    declare @query nvarchar(max)\n    set @query=('select top(1) * from tlb_Question \n        inner join tlb_options on tlb_options.qID=tlb_Question.id and tlb_Question.qNumber=1 and tlb_Question.id not in ('+cast(@next as varchar)+')')\n    print @query\n    execute @query\n    end\nend\n</code></pre>\n"},{"tags":["sql-server-2008","backup"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":15,"score":0,"question_id":13206531,"title":"script to automate the creation of email profile and alert in SQL Server","body":"<p>I have implemented the <a href=\"http://ola.hallengren.com/\" rel=\"nofollow\">http://ola.hallengren.com/</a> backup plan, which is working great.  I'm also setting up an email profile and alert to send when the backup is successful and when it is not.  Since we have multiple servers, I was hoping to create a script that would create the email profile, and the alert, and automatic the creation, so all i have to do is run the script on each machine, and the whole backup process (with email alerts) is created.  Unfortunately when I go into SSMS there's no \"Script Job As -> Create To\" when I right click on \"Database Mail\".  Is there a script out there, or a way to have SSMS create the script to create the email profile and Operator?</p>\n"},{"tags":["sql-server-2008","database-deadlocks"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13200471,"title":"deadlock transaction - communication buffer resources","body":"<p>I would like to get a suggestion on improving my setup that is causing the sql server to return the deadlock message. I have multiple threading application that actually uses the TaskParallel library and each task will use a stored procedure to select an id from a table to use in its processing. I immediately delete that id from the table in the same statement and I think that is what is causing the deadlocks. The table consists of one column of uniques ids with no indexes. I thought of doing a batch delete periodically but that means keeping a tally of used ids across multiple servers.</p>\n\n<p>here is my sql stored procedure:</p>\n\n<pre><code>   CREATE PROCEDURE [dbo].[get_Ids]\n   @id nvarchar(20) OUTPUT\n\n    AS\n\n    BEGIN\n-- SET NOCOUNT ON added to prevent extra result sets from\n-- interfering with SELECT statements.\n   SET NOCOUNT ON;\n\n       Select top 1 @id = siteid from siteids \n       delete siteids where siteid = @id\n\n\n\n   END\n</code></pre>\n\n<p>Is there any better way to do this? My processes work very fast and I used to request this id from a webrequest service but this took 3 seconds.</p>\n"},{"tags":["sql-server-2008","tsql","cursor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13195431,"title":"Update using cursor in SQL Server","body":"<p>I have two tables <code>department</code> and <code>employee</code>. </p>\n\n<p>In the <code>department</code> table I have three columsn: <code>DEP_ID, NAME, HIKEINPERCENT</code></p>\n\n<p>In the <code>employee</code> table I have four columns: <code>EMP_ID, DEP_ID, EMP_NAME, SALARY</code></p>\n\n<p>Now if I update the <code>HIKEINPERCENT</code> in the <code>department</code> table, it should update the <code>SALARY</code> of the employees in the <code>employee</code> table by using CURSOR in SQL Server.</p>\n\n<p>PLS GUIDE WITH EXPLANATION..</p>\n"},{"tags":["sql","sql-server-2008","search"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13205487,"title":"Match \"word\"s or \"word\"(s)","body":"<p>I am query a data set using <code>field like '%search%'</code> in MS-SQL.  My data often times will contain values like <code>words</code> and <code>word(s)</code>.  I would like to be able to allow users to search for either of those values and get both of them back.  So searching for <code>words</code> would return both results containing <code>words</code> and <code>word(s)</code>, and visa-versa.</p>\n\n<p>Is there a good way of doing this?  Or do I just need to detect in code that the search ends in an <code>s</code> or <code>(s)</code> and update the search accordingly?</p>\n"},{"tags":["sql-server-2008","c#-4.0","emgucv"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":15,"score":-1,"question_id":13204974,"title":"C# EmguCV-How to load image from SQL Server into imagebox?","body":"<p>C# EmguCV-How to load image from SQL Server into <strong>imagebox</strong>?</p>\n"},{"tags":["sql-server-2008","ms-office","ssas"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":130,"score":0,"question_id":9948525,"title":"Analysis Services 2008 configuration for OWC 10","body":"<p>We're upgrading a data warehouse from SQL Server 2000 to 2008 R2. A favorite user reporting tool is a web site using OWC 10 (Office Web Components) -- it's basically ASPX pages connected to the Analysis Services 2000 database via the OWC object.</p>\n\n<p>We migrated the warehouse SQL tables and Analysis Services database into 2008. I'm trying to get the OWC10 web site to connect to the 2008 R2 Analysis Services. I changed the ASPX connection definitions to the new server, and can see them in debug messages. However the web page gives me the error \"Cannot connect to the server 'blahblah.blah.com' The server is either not started or too busy.\"</p>\n\n<p>I suspect there are permissions or security setups required to open up Analysis Services 2008 for OWC10 queries. Has anyone done this or similar? Any ideas where to look?</p>\n\n<p>Thanks.</p>\n"},{"tags":["vb.net","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13198932,"title":"What is the proper procedure to rename columns in an MSSQL Database via VB.NET?","body":"<p>I am having an issue with renaming columns. My code is as follows:</p>\n\n<pre><code>Using m_cnInterval\n    Using m_CMDInterval = New SqlCommand()\n        m_CMDInterval.Connection = m_cnInterval\n        m_CMDInterval.CommandText = \"EXEC sp_rename '[\" &amp; strClassColumnName(intClassArrayPosition) &amp; \"]', '[\" &amp; strRenameClassColumn(intClassArrayPosition) &amp; \"]', 'COLUMN'\"\n        m_CMDInterval.CommandType = CommandType.Text\n        m_CMDInterval.ExecuteNonQuery()\n    End Using\nEnd Using\n</code></pre>\n\n<p>I am getting an error message as follows:</p>\n\n<p>\"Either the parameter @objname is ambiguous or the claimed @objtype (column) is wrong\"</p>\n\n<p>I think this error is related to the way I am using my single quotes and brackets. Is there another syntax when using variables for column names?</p>\n\n<p>Thanks</p>\n"},{"tags":[".net","sql-server-2008","ssms","sql-scripts"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":13,"score":1,"question_id":13203420,"title":"executing script in code and management studio different results","body":"<p>I am using the Microsoft Application Block to execute the create db script below. When I execute the script, you can see at the end I also create a schema called sync in this new database(or try to).</p>\n\n<p>My issue is whenever I execute the code, the schema [sync] always gets created in master and <strong>NOT in the newly created database</strong>. However, if I execute the same script in the query editor of management studio the schema [sync] is created under the correct database [4177be6c-d7b4-459b-a87f-912fddfd4cc1].</p>\n\n<p>This is leading to table insertion issues into the new db where the schema [sync] does not exist. </p>\n\n<p><em>note I've removed most of the script for readability</em></p>\n\n<pre><code>USE [master]\nGO\n/****** Object:  Database [4177be6c-d7b4-459b-a87f-912fddfd4cc1]    Script Date:           01/19/2007 14:17:21 ******/\nCREATE DATABASE [4177be6c-d7b4-459b-a87f-912fddfd4cc1] \n//lots of other mumbojumbo\nGO\nUSE [4177be6c-d7b4-459b-a87f-912fddfd4cc1]\nGO\nCREATE SCHEMA [sync] AUTHORIZATION [dbo]\nGO\n</code></pre>\n\n<p>The problem is probably trivial, but I cannot see it.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13201826,"title":"SP_SEND_DBMAIL @QUERY Inserts Line Breaks Into E-mail","body":"<p>I use the @query perimeter in sp_send_dbmail to send out an e-mail with a list of warnings (the warnings are returned by the @query perimeter).  The @query perimeter is listed as text in the e-mail.  All of the records returned from the @query perimeter and displayed in the e-mail has a line break between them.  ie. If I have 4 records, I would have 8 lines because of line breaks.</p>\n\n<p>How do I turn the line breaks off?  I read the the msdn article for sp_send_dbmail, but it didn't mention any attributes that could be changed that would affect the line breaks.</p>\n\n<p>Code:</p>\n\n<pre><code>    BEGIN\n    EXEC MSDB.DBO.sp_send_dbmail \n        @PROFILE_NAME = 'Alerts',\n        @RECIPIENTS = @MAIL,\n        @SUBJECT = @NEWSUBJECT,\n        @BODY = @NEWBODY,\n        @QUERY =\n            'SET NOCOUNT ON\n            DECLARE @HEXSTRING AS VARCHAR(100)\n            SET @HEXSTRING = (SELECT HEXADECIMAL_STRING FROM mydb.dbo.statusupdates\n                WHERE MACHINE_ID = ''1111'' AND DATEDIFF(MI, TIME_DATE_RECEIVED, GETDATE()) &lt;= 60)\n            SELECT [Warning_Description] FROM mydb.DBO.BINARYTOTABLE(mydb.DBO.HEXTOBINARY(@HEXSTRING)) AS ABB1\n            JOIN mydb.DBO.WarningMessages  ON mydb.DBO.WarningMessages.[Bit_Offset] = ABB1.BITPLACE\n            WHERE BITVALUE = 1 AND ALERT_LEVEL = ''WARNING''',\n        @QUERY_RESULT_HEADER = 0,\n        @ATTACH_QUERY_RESULT_AS_FILE = 0;\n    END\n</code></pre>\n"},{"tags":["sql-server-2008","ms-access-2007","data-migration"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13200445,"title":"Reversing Yes/No field during Select in Access","body":"<p>Is there a way to reverse a Yes/No field during a select statement in Access?  I know how to do so during SQL but that does not fly in Access.</p>\n\n<p>Here is the scenario:</p>\n\n<p>I'm migrating data from an Access DB to an SQL DB.  A Yes/No field in said data in Access is obsolete_flag.  In SQL correspondingly, I have IsActive.  The value needs reversed for SQL since IsActive implies it to be true whereas obsolete_flag would show it is false.</p>\n\n<p>Any suggestions would be appreciated.  Thanks.</p>\n\n<p>Kindest Regards,\nChad Johnson</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":37,"score":1,"question_id":13203108,"title":"Conditionally setting variable with case statment","body":"<p>I have the following query. I am trying to only add the values, if the value is not null so the whole variable doesnt end up as a null. Obviously this query below is erroring out, but I do not want to use an ISNULL check on the test column because it puts a comma at the end of the variable text. How would I do this without having the comma at the end of the variable text. Sometimes there will be nulls in the test column, and sometimes there will not be.</p>\n\n<pre><code>DECLARE @Test TABLE\n(\n    test varchar(20)\n)\n\nINSERT INTO @Test\nSELECT 'adfasdfasd'\nUNION ALL\nSELECT NULL\n\n\nDECLARE @DocID varchar(max)\n\nSELECT CASE WHEN test IS NOT NULL THEN @DocID = COALESCE(@DocID + ',' ,'')  + test END\nFROM @Test\n\nSELECT @DocID\n</code></pre>\n"},{"tags":["sql-server-2008","tsql","group-by","nvarchar"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13202691,"title":"group by nvarchar","body":"<p>First of all, sorry for my English I will try to explain in the best way.</p>\n\n<p>Is there a way to group by a column of type <code>nvarchar</code> in SQL Server 2008? </p>\n\n<p>I am going to explain it better: (at least I try)</p>\n\n<p>If I have a table like this:</p>\n\n<pre><code>ID  Quantity   City   Code   WebSiteLink\n__  ________   ____   ____   __________\n1      10      Milan   R2    home/images/1.jpg\n2      20      Milan   R2    home/images/2.jpg\n3      30      Rome    R2    home/images/3.jpg\n4      55      Rome    R2    home/images/4.jpg\n5      4       Naple   R2    home/images/5.jpg\n6      1       London  R2    home/images/6.jpg\n7      30      London  R2    home/images/7.jpg\n8      40      London  R2    home/images/8.jpg\n</code></pre>\n\n<p>I am able to group all columns except <code>WebSitelink</code> because it is an <code>nvarchar</code> type.</p>\n\n<p>My need is to get a random img link, is that possible to do it with a query?</p>\n\n<p>I don't want to use a stored procedure.</p>\n"},{"tags":["c#","sql-server-2008","azure","windows-azure-storage"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13192788,"title":"Storing blobs in windows azure store additional data such as content type in DB","body":"<p>We have a fairly large solution which stores a lot of images, videos, documents in Sql Server 2008 using FileStream.  We have begin migration to using windows azure blob storage to take advantage of geo-replication and what not, this will mean changing the varbinary(max) columns to a relative url we will append with our custome subdomain we have pointing to our storage account.</p>\n\n<p>This all works fine and we are happy in testing however we currently store with the varbinary data the Filename, extension and contentType.  </p>\n\n<p>My question is if we are just going to a relative url which will have the file extension on if needed do we need to store this additional data?  We are debating in the office and the consensus seems to be to keep it simple and just store the Url.</p>\n\n<p>What do most people do in this scenario?  What are the uses/benefits of storing this addiotnal data?</p>\n\n<p>Many thanks for your thoughts on this, an external opinion is probably all that will settle this.</p>\n"},{"tags":["sql-server-2008","sqlprofiler"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13198870,"title":"A couple of basic Sql Profiler questions","body":"<p>(Sorry for the longish question, I'll try to be concise.)</p>\n\n<p>I'm running SQL Server Profiler and I'm chasing down some performance issues. I'm relatively new to what the profiler does and I've exported the traces into a table so I can run queries against the data. </p>\n\n<p>One thing I've been running up against is some seemingly odd behavior doing select queries against the TextData field of the table generated by the trace export. It may have to do with the field's data type (ntext, null). I'm selecting for particular values, but getting unexpected results. For example, if I do this:</p>\n\n<pre><code>select * from [TraceAnalyzer].dbo.TraceTable\n</code></pre>\n\n<p>and I'm interested in values like this:</p>\n\n<pre><code>exec [Sproc_of_interest] @parm1=992\n</code></pre>\n\n<p>I'd do a query like this:</p>\n\n<pre><code>select * from [TraceAnalyzer].dbo.TraceTable\nwhere TextData like '%exec [Sproc_of_interest] @parm1=%'\n</code></pre>\n\n<p>but the return result is empty.</p>\n\n<p>Also, if I do a query like:</p>\n\n<pre><code>select * from [TraceAnalyzer].dbo.TraceTable\nwhere TextData like '%exec [Sproc_of_interest]%'\n</code></pre>\n\n<p>I get unexpected TextData values like <code>exec sp_reset_connection</code></p>\n\n<p>Would the square brackets in the criteria be messing things up? I've tried omitting them, but that just excludes everything. I'm not aware of escape characters in SQL select queries, but when I copy/paste the value from one of the offending records, the pasted value does not appear to contain anything that would meet the original query's criteria.</p>\n\n<p>Any insights would be greatly appreciated. Thanks.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13201715,"title":"Convert only the year part of the datetime in SQL server","body":"<p>Any other easier way to bring the year part of a datetime to current year? If not, which one is better performance wise?</p>\n\n<p>Attempt #1:</p>\n\n<pre><code>CAST(DATEPART(MONTH, mydate) AS VARCHAR) + '/' + \nCAST(DATEPART(DAY, mydate) AS VARCHAR) + '/' +\nCAST(YEAR(GETDATE()) AS VARCHAR) AS DATETIME \n</code></pre>\n\n<p>Attempt #2:</p>\n\n<pre><code>DATEADD(YEAR, DATEDIFF(YEAR,  mydate, GETDATE()), mydate)\n</code></pre>\n"},{"tags":["sql-server-2008","tsql","stored-procedures"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":35,"score":2,"question_id":13201516,"title":"Correct syntax for calling a stored procedure with parameters from within another stored procedure","body":"<p>I am having difficulty establishing the correct syntax for calling a stored procedure within a stored procedure. I thought this syntax was correct:</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROCEDURE [dbo].[newProc](\n    @param1 varchar(50),\n    @param2 nvarchar(2000),\n    @param3 int,\n    @param4 int,\n    @param5 int,\n    @param6 int\n)\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    EXEC [dbo].[externProc1] @param1, @param2;\n    GO\n\n    EXEC [dbo].[externProc2] @param3, @param4;\n    GO\n\n    EXEC [dbo].[insertProc3] @param5, @param6;\n    GO\n\nEND\nGO\n</code></pre>\n\n<p>But when I try this, I keep getting \n\"Incorrect syntax near ';'  Must declare the scalar variable @param3.\nMust declare the scalar variable @param5.\"</p>\n\n<p>What is the correct syntax for calling a stored procedure with parameters from within another stored procedure?</p>\n"},{"tags":["visual-studio-2010","sql-server-2008","windows-authentication","virtual-machine","intranet"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13185478,"title":"How do I authenticate to a SQL Server database on a domain from a virtual machine off the domain?","body":"<p>I am supporting a .NET 4.0 (Visual Studio 2010) web application that authenticates to a SQL Server 2008 database which resides on my work intranet. The application authenticates to the database using windows authentication. Thats all fine and dandy if Im developing on my host, but I am developing on a virtual machine that is not on the work domain. Thus when the project build and runs, it throws a SqlClient.SqlException</p>\n\n<blockquote>\n  <p>\"Login failed. The login is from an untrusted domain and cannot be used with Windows authentication.\"</p>\n</blockquote>\n\n<p>Short of developing on my host and abandoning the VM, what can I do to avoid this error and successfully authenticate to the database so I can build/run the web app? I am willing to store my credentials somewhere locally, though preferably not somewhere that would be under TFS source control (like the web.config) because I couldnt keep the file checked out since there are other developers on the project. </p>\n\n<p>I have tried running Visual Studio as a different user (as the user on my work domain) but I get a \"unknown user name or bad password\" error.</p>\n\n<p>Note, adding the Virtual Machine to the domain (or connecting to it via VPN) are not options. The VM must remain off the domain.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":116,"score":2,"question_id":11858827,"title":"MS SQL Server 2008 script generation creates invalid scripts when using constraints","body":"<p>On an MS SQL Server 2008 (10.50.2811.0) Developer Edition (64-bit), running under Windows 2008 Server 2008 R2 Standard the script generation from within SQL Server Management Studio creates scripts where the same constraint is dropped multiple times. </p>\n\n<p>A simple example includes two tables, tParent and tChild, where tChild's ParentID references tParent's ID. The script (Database context menu => Tasks => Generate Scripts...) being generated (for DROP AND CREATE) looks like this:</p>\n\n<pre><code>USE [TestDb]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] DROP CONSTRAINT [FK_tChild_tParent]\nGO\nDROP TABLE [dbo].[tChild]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nDROP TABLE [dbo].[tParent]\nGO\n/****** Object: Table [dbo].[tParent] Script Date: 08/08/2012 08:11:52 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tParent](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tParent] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: Table [dbo].[tChild] Script Date: 08/08/2012 08:11:51 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nCREATE TABLE [dbo].[tChild](\n[ID] [int] IDENTITY(1,1) NOT NULL,\n[ParentID] [int] NOT NULL,\n[Name] [varchar](50) NOT NULL,\n[Value] [int] NOT NULL,\nCONSTRAINT [PK_tChild] PRIMARY KEY CLUSTERED \n(\n[ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\nGO\n/****** Object: ForeignKey [FK_tChild_tParent] Script Date: 08/08/2012 08:11:51 ******/\nALTER TABLE [dbo].[tChild] WITH CHECK ADD CONSTRAINT [FK_tChild_tParent] FOREIGN KEY([ParentID])\nREFERENCES [dbo].[tParent] ([ID])\nGO\nALTER TABLE [dbo].[tChild] CHECK CONSTRAINT [FK_tChild_tParent]\nGO\n</code></pre>\n\n<p>Why are there two identical lines that both try to drop the FK_tChild_tParent constraint? And why is the comment for both lines different?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13199683,"title":"Save Files to SQL Server Database","body":"<p>i have the table \"tblTransDocs\" with these fields (DocId(pk),TransId(pk),rev,...and for each row of this table i can have file. now my question is i have to make another table with these fields (fileId(int),file name (varchar) , content type (varchar) ,data (var binary) and adding Fileid as a foreign key to \"tblTransDocs\" or i can add columns to \"tblTransDocs\" for saving files to the database like (file name (varchar) , content type (varchar) ,data (var binary) .</p>\n\n<p>which way is correct?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13199290,"title":"Find 2 Business Days","body":"<p>I have a Calendar table. I would like get 2 business before Today's Date while skipping Holidays and weekeends.</p>\n\n<p>For example:</p>\n\n<p>Example 1: New years 2013 falls on a Tuesday. If it was Thursday (1/3), then my starting date would be Monday (12/31).</p>\n\n<p>Example 2: If it was Monday (12/31), then my starting date would be Thursday (12/27).</p>\n\n<p>My Clandar table as been prepopulated with 30 years worth of dates and have flags to determine which ones are weekend and hollidays. The table has these fields:</p>\n\n<p>dt: Date and time for 30 years\nY: year\nD: Day\nM: Month\nIsholiday: (Is a holiday are not, flagged with 0 for \"no\"  and 1 for \"Yes\")\nIsWeekday: (Is a weekday? Flagged with 0 for \"no\"  and 1 for \"Yes\"\nHolidayDescritption: Holiday Names</p>\n\n<p>Please help.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13200627,"title":"sql server external tools logging errorlog","body":"<p>In SQL Server 2008 I installed some external tools and then removed them.  Somehow I am getting this error in the error logs.  How can I remove this queue?</p>\n\n<pre><code>The activated proc '[LakeSideLockLogger].[_LakeSide_DbTools_LockMonitorEvents]' running on queue 'msdb.LakeSideLockLogger._LakeSide_DbTools_LockQueue' output the following:  'Could not find stored procedure 'LakeSideLockLogger._LakeSide_DbTools_LockMonitorEvents'.'\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2000"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13200024,"title":"SQL Server 2008 upgrade advisor tool","body":"<p>We upgraded to SQL Server 2008 from SQL Server 2000. But due to some legacy scripts/queries in our health care application, that run only in 2000, we had to run 2008 version on backwards compatibility mode. </p>\n\n<p>My question is what do I need to be aware of if I have to turn it on to full compatibility mode in terms of potential conflicts/issues etc. Is the Upgrade Advisor tool still useful in my case as we already upgraded but running in backwards compatibility mode. Is there value in running that tool? </p>\n\n<p>Any other information any one can share , will be useful. </p>\n"},{"tags":["sql-server","sql-server-2008","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":2720,"score":4,"question_id":8917315,"title":"How to get Enterprise Manager installed in SQL Server 2008 Express?","body":"<p>I've installed Microsoft SQL Server 2008 Express twice now, and all the services work and I can create databases from Visual Studio 2010, but I don't have the <strong><em>Enterprise Manager</em></strong> (I learned it is now called <strong><em>Management Studio</em></strong>) available in the SQL Server 2008 program menu-- I do have other menu items like configuration manager, etc. but nothing for <em>Management Studio / Enterprise Manager</em>.</p>\n\n<p>Is there a checkbox I've missed during installation?<br>\nI ran a search for all exes in the SQL Server root folder and nothing jumped out as belonging to the Enterprise Manager, but I'm not 100% sure what the executable would be named.</p>\n\n<p>Primary question:<br>\n&nbsp; &nbsp; What is the procedure required to install the Management Studio client [for/with SQL 2008 Express] ?<br>\nSecondary question:<br>\n&nbsp; &nbsp; What is the name of this client's executable file ?</p>\n"},{"tags":["sql","sql-server-2008","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13200511,"title":"How to Generate Scripts For All Triggers in Database Using Microsoft SQL Server Management Studio","body":"<p>I'd like to generate an SQL Script that contains the SQL to create all of the triggers that exist in our database.  The triggers were added directly via the SSMS query pane so, there is currently no source other than the trigger on the database itself.  </p>\n\n<p>I have already tried the method where you right-click the database, select <code>Tasks-&gt;Generate Scripts</code> and used the \"Script Entire Database and All Objects\" option.  While this does create a SQL script for the tables and constraints, it does not generate SQL for the triggers.  </p>\n\n<p>I also understand that I can right click on each trigger in the database and select the Generate SQL Script option but, there is currently 46 tables under audit (For Insert, Update, and Delete).  </p>\n\n<p>Rather manually generate an insert, update, and delete trigger script for each of the 46 tables, is there an easier way to do this?  Or, should I start clicking, copying, and pasting?</p>\n"},{"tags":["sql-server-2008","jobs","xcopy"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13200565,"title":"Copying files between servers SQL Job","body":"<p>I have a SQL job that I would like to copy files in a directory out to a directory on another server. Here is the CMD that I am running</p>\n\n<p>xcopy \\DB1\\TEST*.* \\DB2\\foo /S /Y</p>\n\n<p>And I get this error\nExecuted as user: DOMAIN\\SA$. File not found - <em>.</em>  0 File(s) copied.  Process Exit Code 0.  The step succeeded.</p>\n\n<p>I have also tried the copying to the same server with same results as well as just trying to grab one file and copying</p>\n\n<p>I have added the DOMAIN\\SA account as an admin on the servers and still getting this. Is this just a bug or am I missing some permissions setting?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13199828,"title":"What collation to use for a column that will have both English and Japanese text?","body":"<p>I am using Sql Server 2008 and one of our requirements is to provide multi-lingual support. The main languages are English, German, French and Japanese. </p>\n\n<p>I have a table which has its COLLATION as Latin1_General_CI_AS. The column that will store the text data has this COLLATION 'Japanese_CI_AS'</p>\n\n<p>When I run the following SQL in SQL Server Management Studio (SSMS)</p>\n\n<pre><code>DECLARE @translation nvarchar(max)\nSET @translation = '(Cookie)'\n\nPRINT @translation\n\nUPDATE [ResourceTranslations]\nSET Translation = @translation  \nWHERE Id = 4\n</code></pre>\n\n<p>The value inserted is '????(Cookie)?????????', which is also the value that is printed out.</p>\n\n<p>Is there any chance that SSMS is having problems with the Japanese characters? It seems that the print statement is telling me that the value is being altered to '????(Cookie)?????????'  before it gets inserted in the table.</p>\n\n<p>Any help or advice gratefully accepted.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13199425,"title":"Multiple conditions on select query","body":"<p>I have a select statement and I wish to calculate the cubic volume based on other values within the table. However I want to check that neither pr.Length_mm or pr.Width_mm or pr.Height_mm are NULL prior. I've looked at CASE statements, however it only seems to evaluate one column at a time.</p>\n\n<pre><code>SELECT \n      sa.OrderName,\n      sa.OrderType,\n      pr.Volume_UOM\n ,pr.Length_mm*pr.Width_mm*pr.Height_mm AS Volume_Cubic\n ,pr.Length_mm*pr.Width_mm AS Volume_Floor\n ,pr.Length_mm\n ,pr.Height_mm\n ,pr.Width_mm\nFROM CostToServe_MCB.staging.Sale sa\nLEFT JOIN staging.Product pr\nON sa.ID = pr.ID\n</code></pre>\n"},{"tags":["vb.net","visual-studio-2010","visual-studio","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":13093991,"title":"VB Application connects to server fine on my computer but not on any other computer","body":"<p>I am at my wits end. The application I built works perfectly on my system but not on anyone elses. It is very simple, on load it queries the user for a Batch number and then filters the data to show only items with that batch number in the datagridview. </p>\n\n<p>Here's the code I wrote:</p>\n\n<pre class=\"lang-vb prettyprint-override\"><code>'*******************************************************************************************************************************\n' When the form loads, the following code opens a inputbox that asks the user for a batch number. This number then gets used\n' to filter the data before populating the DataGridView\n'*******************************************************************************************************************************\nPrivate Sub frmAQFilter_Load(sender As System.Object, e As System.EventArgs) Handles MyBase.Load\n    Me.DataTable1TableAdapter.Fill(Me.ElementDataset.qryAQFilterData)\n\n    Dim blnX As Boolean = True\n    Dim msg As Integer\n\n    Do While blnX\n        strBatch = \"\"\n        strBatch = InputBox(\"Batch Number: \")\n\n        If Len(strBatch) &gt; 0 Then\n            DataTable1BindingSource.Filter = String.Format(\"Batch = '\" &amp; strBatch &amp; \"'\")\n            If Not DataTable1BindingSource.Count &gt; 0 Then\n                msg = MsgBox(\"No records found with the batch number: \" + strBatch + Chr(13) _\n                             + \"Do you wish to enter a different batch number\", MsgBoxStyle.YesNo)\n                If msg = vbNo Then\n                    Me.Close()\n                    blnX = False\n                End If\n            Else\n                blnX = False\n            End If\n        Else\n            Me.Close()\n            blnX = False\n        End If\n    Loop\n    Me.WindowState = FormWindowState.Normal\nEnd Sub\n</code></pre>\n\n<p>I don't get any errors, it just doesn't populate the dataset. My first thought was that the connection string was bad. No problems there. Any advice would be greatly appreciated.</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":12,"down_vote_count":0,"view_count":1976,"score":12,"question_id":6376866,"title":"TSQL - How to use GO inside of a BEGIN .. END block?","body":"<p>I am generating a script for automatically migrating changes from multiple development databases to staging/production.  Basically, it takes a bunch of change-scripts, and merges them into a single script, wrapping each script in a <code>IF whatever BEGIN ... END</code> statement.</p>\n\n<p>However, some of the scripts require a <code>GO</code> statement so that, for instance, the SQL parser knows about a new column after it's created.</p>\n\n<pre><code>ALTER TABLE dbo.EMPLOYEE \nADD COLUMN EMP_IS_ADMIN BIT NOT NULL\nGO -- Necessary, or next line will generate \"Unknown column:  EMP_IS_ADMIN\"\nUPDATE dbo.EMPLOYEE SET EMP_IS_ADMIN = whatever\n</code></pre>\n\n<p>However, once I wrap that in an <code>IF</code> block:</p>\n\n<pre><code>IF whatever\nBEGIN\n    ALTER TABLE dbo.EMPLOYEE ADD COLUMN EMP_IS_ADMIN BIT NOT NULL\n    GO\n    UPDATE dbo.EMPLOYEE SET EMP_IS_ADMIN = whatever\nEND\n</code></pre>\n\n<p>It fails because I am sending a <code>BEGIN</code> with no matching <code>END</code>.  However, if I remove the <code>GO</code> it complains again about an unknown column.</p>\n\n<p><strong>Is there any way to create and update the same column within a single <code>IF</code> block?</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13198571,"title":"Restore Backup Fails - File 'Db' cannot be restored to '{...}.mdf'. Use WITH MOVE to identify a valid location for the file","body":"<p>I am getting the following errors trying to do a restore using the restore command on a backup file I recieved from a customer.</p>\n\n<p>RESTORE DATABASE SFDB FROM DISK = N'C:\\Backup\\Backup.bak' </p>\n\n<p>Any thoughts on what I can do to correct this?  It's looking for the mdf, so can I assume that the backup file I have is an incremental backup and not the full backup and that's why it's looking for the mdf?  </p>\n\n<p>I am not sure if 1) they have given all the data (the entire db) or 2) I have the right data - and I can do the restore with the right T-SQL commands - I just don't know how.</p>\n\n<p>Help is appreciated.</p>\n\n<pre><code>Msg 5133, Level 16, State 1, Line 2\nDirectory lookup for the file \"D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf\" failed with the operating system error 21(failed to retrieve text for this error. Reason: 15105).\nMsg 3156, Level 16, State 3, Line 2\nFile 'Db' cannot be restored to 'D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf'. Use WITH MOVE to identify a valid location for the file.\nMsg 5133, Level 16, State 1, Line 2\nDirectory lookup for the file \"D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF\" failed with the operating system error 21(failed to retrieve text for this error. Reason: 15105).\nMsg 3156, Level 16, State 3, Line 2\nFile 'DbDev_log' cannot be restored to 'D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF'. Use WITH MOVE to identify a valid location for the file.\nMsg 3634, Level 16, State 1, Line 2\nThe operating system returned the error '21(failed to retrieve text for this error. Reason: 15105)' while attempting 'GetVolumeInformation' on 'D:\\'.\nMsg 3013, Level 16, State 1, Line 2\nRESTORE DATABASE is terminating abnormally.\n</code></pre>\n\n<p>RESTORE FileListOnly FROM DISK = N'C:\\Backup\\Backup.bak' shows me the following...</p>\n\n<pre><code>LogicalName PhysicalName    Type    FileGroupName   Size    MaxSize FileId  CreateLSN   DropLSN UniqueId    ReadOnlyLSN ReadWriteLSN    BackupSizeInBytes   SourceBlockSize FileGroupId LogGroupGUID    DifferentialBaseLSN DifferentialBaseGUID    IsReadOnly  IsPresent   TDEThumbprint\nDb  D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db.mdf  D   PRIMARY 29622272    35184372080640  1   0   0   02925462-83CC-4222-8966-53229FA25B1C    0   0   29032448    512 1   NULL    269000000146900238  735C7F0E-F63D-4AA1-AC48-505A084AC00B    0   1   NULL\nDb_log  D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db_log.LDF  L   NULL    40239104    2199023255552   2   0   0   71038B04-CBC9-4E4A-93AD-4E1268859CB2    0   0   0   512 0   NULL    0   00000000-0000-0000-0000-000000000000    0   1   NULL\nDbDev_filestream    D:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\\Db  S   PRIMARY_FILESTREAM  4691012 0   65537   18000000011800001   0   627C9AAA-97BD-4991-9C8C-90C400226A9F    0   0   4784128 512 2   NULL    269000000146900238  735C7F0E-F63D-4AA1-AC48-505A084AC00B    0   1   NULL\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13198805,"title":"Remove duplicate batches of data","body":"<p>Due to a bug in my application a table that was built to carry daily records of each delivery period, was populated many times.</p>\n\n<p>Lets say I have a delivery from 1st of June to 5 of June. My table should be populated with 5 records, one for each day. Now, I have havoc because I have many \"batches\" of the same content.</p>\n\n<p>The table layout is as:</p>\n\n<pre><code>dummy_id       -- identity column\ndelivery_id    -- id of the delivery\non_date        -- the day\ncharge         -- the daily cost\n</code></pre>\n\n<p>Is there an elegant way to keep only the first batch of records and delete the batches that were inserted by mistake for all the deliveries?</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13198384,"title":"What does &gt; 0 mean in SQL?","body":"<p>I have the following SQL statement. Please tell me if my translation of it is accurate. I'm using MS SQL Server 2008. Thanks</p>\n\n<pre><code>(bld_sqft &amp;gt; 0 OR bld_area &amp;gt; 0)\n</code></pre>\n\n<p>My translation</p>\n\n<pre><code>bld_sqft &gt; 0 OR bld_area &gt; 0\n</code></pre>\n"},{"tags":["sql-server-2008","port","ssms"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13198148,"title":"Connecting to SQL Server instance without giving port","body":"<p>I have recently added another SQL Server 2008 instance to a server and want to be able to connect to without having to specify the new port number in SSMS. Is this possible?</p>\n\n<p>I can connect if I use <code>MyServer, 2434\\Staging</code></p>\n\n<p>but fails when I use <code>MyServer\\Staging</code></p>\n\n<p>Is there a setting that I need to change or alias to setup?</p>\n\n<p>Thanks for the help</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13197526,"title":"Loop through all records in my SQL Server database","body":"<p>I have the following SQL script. As you can see I manually set the <code>@listingid</code> value to 30653.</p>\n\n<p>But this script should be executed for all records in the <code>[listings]</code> table where <code>@listingid</code> is assigned the value of the <code>[listings].id</code> column.</p>\n\n<pre><code>DECLARE @profname nvarchar(150)\nDECLARE @furl nvarchar(250)\nDECLARE @city nvarchar(250)\nDECLARE @listingid int\n\nset @listingid=30653\n--select the top 1 professionname\nSELECT TOP 1 @profname=REPLACE(LOWER(pn.title),' ','-'),@furl=l.friendlyurl,@city=REPLACE(REPLACE(LOWER(l.city),'''',''),' ','-') FROM healthprof_professionnames hpn\nINNER JOIN professionname pn ON pn.id=hpn.professionnameid\nINNER JOIN listings l on l.id=hpn.healthprofid\nWHERE l.id=@listingid ORDER BY pn.title\n\n--check if current friendlyurl already contains profession\nIF NOT CHARINDEX(@profname,@furl)&gt;0\n    SET @furl = @furl + '-' + @profname\n\nIF NOT CHARINDEX(@city,@furl)&gt;0\nSET @furl = @furl + '-' + @city\n\nSET @furl = @furl + '-3'\n\nUPDATE listings set friendlyurl=@furl WHERE id=@listingid\n</code></pre>\n"},{"tags":["sql","sql-server-2008","ssas","mdx","business-intelligence"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13184139,"title":"SQL Server MDX query parameter","body":"<p>I am very new to MDX query. I am trying to pass a parameter through my query. It is giving me this SQL error:</p>\n\n<blockquote>\n  <p><em>Query preparation failed.</em><br>\n  <em>The function expects a tuple expression for the 5 argument.</em><br>\n  <em>A tuple set expression was used.</em></p>\n</blockquote>\n\n<p>The query is:</p>\n\n<pre><code>SELECT \n{\n[Measures].[DENOMINATOR]\n,[Measures].[NUMERATOR]\n,[Measures].[Goal]\n}\nON COLUMNS,\nNON EMPTY\n(\n [Dim Indicator].[Indicator Set].[Indicator Set].ALLMEMBERS\n ,[Dim Indicator].[Indicator Group].[Indicator Group].ALLMEMBERS\n ,[Dim Indicator].[Indicator Name].[Indicator Name].ALLMEMBERS\n)\nON ROWS\nFROM [Dummy-Dashboard]\n\n--Parameter Queries goes here \n\nWHERE \n(\n    strtoset(@DimGenderGenderID)\n )\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13181245,"title":"What is the default user mapping for a server role in SQL Server 2008","body":"<p>I am learning the relations among authentication-user-role-schema. In my application I am using my Windows authentication which is assigned as sysadmin(as well as public) server role. </p>\n\n<p>After that, when I am executing <code>SELECT CURRENT_USER</code>, I get <code>dbo</code>. However, I can't find the mapping from the server role to the database user. I also tested by creating a login which has the server role as public. Using this login, I got guest when I executed <code>SELECT CURRENT_USER</code>. </p>\n\n<p>So where does this mapping get defined?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":8,"score":1,"question_id":13197035,"title":"reporting services 2005 on sql server 2008","body":"<p>Is it possible to install RS 2005 component alone and then install sql server 2008 R2 engine \nwithout RS option? Is there anything I need  to consider? or Can I upgrade from 2005 to 2008 R2 and leave RS \n2005?</p>\n\n<p>OR reporting services 2005 on sql server 2008?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","tsqlt"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":55,"score":0,"question_id":13196802,"title":"SQL - Foreign Key Constraint Error with Update Statement","body":"<p>I am Trying to update my table (product) columns - ProductID(FK) and ProductType(FK). These two column has relation with MProduct table's column MProductID(PK) and MProductType(PK).</p>\n\n<p>I am trying to update </p>\n\n<pre><code>ProductID       ProductType\n9999            11\n9999            12\n</code></pre>\n\n<p>But I got the following error </p>\n\n<pre><code>The UPDATE statement conflicted with the FOREIGN KEY constraint \"FKHCR_MProduct\".\nThe conflict occurred in database \"XXXX\", table \"dbo.MProduct\".\n</code></pre>\n\n<p>I checked with MProduct table, It has all the valid records for look up. I can not change my Table Structure.</p>\n\n<p>I tried this Query too</p>\n\n<pre><code>Select ProductID,ProductType\nfrom dbo.Product P\nLeft Join dbo.MProduct M on M.ProductID = P.ProductID\n   and M.ProductType = P.ProductType\nwhere M.ProductType is null\n   and M.ProductID is null\n</code></pre>\n\n<p>and there is No Output, means there is No Null Data Inside the Look up table.</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":466,"score":2,"question_id":11307435,"title":"Getting error while running 50 MB script on SQL Server 2008 R2","body":"<p>I am using SQL Server 2008 R2, I have a script to update the DB, that script is approx\n50 MB in size and contains some about 800,000 lines.</p>\n\n<p>Error: </p>\n\n<blockquote>\n  <p>TITLE: Microsoft SQL Server Management Studio</p>\n  \n  <p>Cannot execute script.</p>\n  \n  <p>ADDITIONAL INFORMATION:</p>\n  \n  <p>Insufficient memory to continue the execution of the program.\n  (mscorlib)</p>\n</blockquote>\n\n<p>Can somebody please help me to run this script without getting this error?</p>\n"},{"tags":["xml","sql-server-2008","tsql","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":21,"score":1,"question_id":13195922,"title":"How to query xml column in tsql","body":"<p>I have a table, T1, with a XML column, EventXML, on SQL Server 2008. I want to query all the rows where certain node contains a particular value. Better, I'd like to retrieve the value in a different node. The table T1:</p>\n\n<pre><code>T1:\n   EventID, int\n   EventTime, datetime\n   EventXML, XML\n</code></pre>\n\n<p>Here is an example XML hierarchy:</p>\n\n<pre><code>&lt;Event&gt;\n   &lt;Indicator&gt;\n      &lt;Name&gt;GDP&lt;/Name&gt;\n   &lt;/Indicator&gt;\n   &lt;Announcement&gt;\n      &lt;Value&gt;2.0&lt;/Value&gt;\n      &lt;Date&gt;2012-01-01&lt;/Date&gt;\n   &lt;/Announcement&gt;\n&lt;/Event&gt;\n</code></pre>\n\n<ol>\n<li>How to find all the rows related to \"GDP\" Indicator;</li>\n<li>How to get all values for \"GDP\" Indicator;</li>\n</ol>\n"},{"tags":["sql-server-2008","jdbc","mule"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":996,"score":2,"question_id":10689827,"title":"Mule 3 JDBC endpoint exception with sql server","body":"<p>I am trying to insert a String into a SQL Server database using Mule JDBC outbound endpoint. The query is:</p>\n\n<pre><code>INSERT INTO ife VALUES (#[payload:java.lang.String], 0)\n</code></pre>\n\n<p>The query works when the payload is in a where clause of a select statement and when I hardcode values in place of the payload expression.  However, it fails miserably with insert statements like the one listed above.  I have included the exception below as well as the flow xml configuration.  Any suggestions/help would be greatly appreciated!</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ERROR 2012-05-21 11:37:00,122 [[ife].IFE_InboundFlow1.stage1.02]     org.mule.exception.DefaultMessagingExceptionStrategy: \n********************************************************************************\nMessage               : Failed to route event via endpoint:     DefaultOutboundEndpoint{endpointUri=jdbc://insert, connector=JdbcConnector\n{\n  name=Database__JDBC_\n  lifecycle=start\n  this=11e5f\n  numberOfConcurrentTransactedReceivers=4\n  createMultipleTransactedReceivers=false\n  connected=true\n  supportedProtocols=[jdbc]\n  serviceOverrides=&lt;none&gt;\n}\n,  name='endpoint.jdbc.insert', mep=ONE_WAY, properties={queryTimeout=-1,     queries=merged: {insert=INSERT INTO ife VALUES (#[payload:java.lang.String], 0)}},     transactionConfig=Transaction{factory=null, action=INDIFFERENT, timeout=0},     deleteUnacceptedMessages=false, initialState=started, responseTimeout=10000,     endpointEncoding=UTF-8, disableTransportTransformer=false}. Message payload is of type:     String\nCode                  : MULE_ERROR-42999\n--------------------------------------------------------------------------------\nException stack is:\n1. com.microsoft.sqlserver.jdbc.SQLServerException: Incorrect syntax near '?'.(SQL     Code: 0, SQL State: + null) (com.microsoft.sqlserver.jdbc.SQLServerException)\n  com.microsoft.sqlserver.jdbc.SQLServerException:190 (null)\n2. com.microsoft.sqlserver.jdbc.SQLServerException: Incorrect syntax near '?'. Query:     INSERT INTO ife VALUES (?, 0) Parameters: [30076](SQL Code: 0, SQL State: +     null) (java.sql.SQLException)\n  org.apache.commons.dbutils.QueryRunner:540 (null)\n3. Failed to route event via endpoint:     DefaultOutboundEndpoint{endpointUri=jdbc://insert, connector=JdbcConnector\n{\n  name=Database__JDBC_\n  lifecycle=start\n  this=11e5f\n  numberOfConcurrentTransactedReceivers=4\n  createMultipleTransactedReceivers=false\n  connected=true\n  supportedProtocols=[jdbc]\n  serviceOverrides=&lt;none&gt;\n}\n,  name='endpoint.jdbc.insert', mep=ONE_WAY, properties={queryTimeout=-1, queries=merged: {insert=INSERT INTO ife VALUES (#[payload:java.lang.String], 0)}}, transactionConfig=Transaction{factory=null, action=INDIFFERENT, timeout=0}, deleteUnacceptedMessages=false, initialState=started, responseTimeout=10000, endpointEncoding=UTF-8, disableTransportTransformer=false}. Message payload is of type: String (org.mule.api.transport.DispatchException)\n  org.mule.transport.AbstractMessageDispatcher:107 (http://www.mulesoft.org/docs/site/current3/apidocs/org/mule/api/transport/DispatchException.html)\n--------------------------------------------------------------------------------\nRoot Exception stack trace:\ncom.microsoft.sqlserver.jdbc.SQLServerException: com.microsoft.sqlserver.jdbc.SQLServerException: Incorrect syntax near '?'.\nat com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDriverError(SQLServerException.java:190)\nat com.microsoft.sqlserver.jdbc.SQLServerParameterMetaData.&lt;init&gt;(SQLServerParameterMetaData.java:426)\nat com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.getParameterMetaData(SQLServerPreparedStatement.java:1532)\n+ 3 more (set debug level logging or '-Dmule.verbose.exceptions=true' for everything)\n</code></pre>\n\n<p>Here's the configuration xml:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;spring:beans&gt;\n        &lt;spring:bean id=\"Bean\" name=\"Bean\" class=\"org.enhydra.jdbc.standard.StandardDataSource\" doc:name=\"Bean\"&gt;\n            &lt;spring:property name=\"driverName\" value=\"com.microsoft.sqlserver.jdbc.SQLServerDriver\"/&gt;\n            &lt;spring:property name=\"url\" value=\"jdbc:sqlserver://localhost:1433;instanceName=SQLEXPRESS;databaseName=test;user=test;password=test;\"/&gt;\n        &lt;/spring:bean&gt;\n    &lt;/spring:beans&gt;\n&lt;jdbc:connector name=\"Database__JDBC_\" dataSource-ref=\"Bean\" validateConnections=\"true\" queryTimeout=\"-1\" pollingFrequency=\"0\" doc:name=\"Database (JDBC)\"/&gt;\n&lt;flow name=\"test\"&gt;\n    &lt;jdbc:outbound-endpoint exchange-pattern=\"one-way\" queryKey=\"insert\" responseTimeout=\"10000\" mimeType=\"text/plain\" queryTimeout=\"-1\" connector-ref=\"Database__JDBC_\" doc:name=\"Database (JDBC)\"&gt;\n                                &lt;jdbc:query key=\"insert\" value=\"INSERT INTO ife VALUES (#[payload:java.lang.String], 0)\"/&gt;\n                            &lt;/jdbc:outbound-endpoint&gt;\n&lt;/flow&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":29,"score":0,"question_id":13192667,"title":"Is there a Performance difference when we SET Encryption on Database ON and OFF?","body":"<p>I am just wondering to whether is there any performance difference in sprocs and inline queries when DB encryption is set to ON and OFF?</p>\n\n<p>If yes,could you please explain me in detail when the performance is good and when its bad?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","rollback"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":13188621,"title":"roll back SQL query executed by mistake","body":"<p>I think the question says it all,\nthe following update query has been executed - by mistake - in SQL Server management studio</p>\n\n<pre><code>update kms_students set student_campus='4' where student_campus='KL'\n</code></pre>\n\n<p>The effected rows are more than 1000, and i can't identify it since that table is already have the <code>student_campus='4'</code> for many previous rows.</p>\n\n<p>Is it possible to roll back?</p>\n"},{"tags":["sql-server-2008","full-text-search"],"answer_count":1,"favorite_count":3,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13193914,"title":"Full Text Search with blank spaces in SQL Server 2008","body":"<p>There is a problem occurs when I search data using full-text search with SQL Server 2008.</p>\n\n<p>When I search data with no blank space it works but when I enter data with blank spaces it gives an error.</p>\n\n<p>Like if I search <code>'amit'</code> it works but if data is <code>'amit is working'</code> it gives error.</p>\n\n<p>I am using ASP.NET MVC 4.0 with SQL Server 2008.</p>\n\n<p>Thanks Amit.</p>\n\n<pre><code>Create PROC [usp_Feedback_Search]\n@Word nvarchar(500) ,   \n@CompanyId UNIQUEIDENTIFIER     \n\nAs\nIF ISNULL(@Word,'') = ''\n BEGIN\n Select          \n  [Id] ,\n[Content] ,    \n[UserId],    \n [VoteCount] ,\n [IsOpen],\n [Deleted],\n [RowVersion],    \n [CreatedBy],     \n [CreatedOn],    \n [UpdatedOn],    \n [UpdatedBy],       \n [CompanyId], \n [DisplayId],\n  [Status]\n FROM Feedback         \n  WHERE CompanyId=@CompanyId\n  END\n ELSE\n  BEGIN   \n\nDECLARE @formatedWord varchar(500)='\"'+@word+'\\+\"'\n\n  Select          \n  [Id] ,\n[Content] ,    \n[UserId],    \n [VoteCount],\n [IsOpen],\n [Deleted],\n [RowVersion],    \n [CreatedBy],     \n [CreatedOn],    \n [UpdatedOn],    \n [UpdatedBy],       \n [CompanyId], \n [DisplayId],\n  [Status]    \n  FROM Feedback            \n  Where CONTAINS(*,@Word)     \n  and CompanyId=@CompanyId\n  END\n GO\n</code></pre>\n"},{"tags":["sql","sql-server-2008","insert","numeric","column"],"answer_count":5,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":86,"score":4,"question_id":13189688,"title":"Insert empty string into INT column for SQL Server","body":"<p>A <code>SAMPLE</code> table has only one column <code>ID</code> of type <code>int</code>, default null.</p>\n\n<p>In Oracle when I do:</p>\n\n<pre><code>  insert into SAMPLE (ID) values ('');\n</code></pre>\n\n<p>the new record is added with blank value. But in SQL Server 2008, when I run the same <code>insert</code> statement, the new record has the value of 0. </p>\n\n<p>Is there a way to force SQL Server 2008 to default blank string to NULL instead of 0 (for numerical type of columns)?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":13193627,"title":"SQL - Update causing deadlock error","body":"<p>I'm trying to update a row in a table upon someone viewing the page (it increments the viewed count), however now and then I get a deadlock error, I'm guessing this is due to two or more people trying to update the same row?</p>\n\n<p>The error is:</p>\n\n<pre><code>Transaction (Process ID 60) was deadlocked on lock | communication buffer resources with another process and has been chosen as the deadlock victim. Rerun the transaction.\n</code></pre>\n\n<p>And my SQL is:</p>\n\n<pre><code>UPDATE [ProductDescription] \nSET [ViewCount] = ([ViewCount] + 1) \nWHERE ProductCode = @prodCode \n    AND ApplicationID = @AppID\n</code></pre>\n\n<p>I believe I may need a WITH(NOLOCK)?</p>\n"},{"tags":["sql-server-2008","powershell","smo","database-restore"],"answer_count":3,"favorite_count":3,"up_vote_count":1,"down_vote_count":0,"view_count":903,"score":1,"question_id":4627325,"title":"SMO restore of SQL database doesn't overwrite","body":"<p>I'm trying to restore a database from a backup file using SMO. If the database does not already exist then it works fine. However, if the database already exists then I get no errors, but the database is not overwritten.</p>\n\n<p>The \"restore\" process still takes just as long, so it looks like it's working and doing a restore, but in the end the database has not changed.</p>\n\n<p>I'm doing this in Powershell using SMO. The code is a bit long, but I've included it below. You'll notice that I do set <code>$restore.ReplaceDatabase = $true</code>. Also, I use a try-catch block and report on any errors (I hope), but none are returned.</p>\n\n<p>Any obvious mistakes? Is it possible that I'm not reporting some error and it's being hidden from me?</p>\n\n<p>Thanks for any help or advice that you can give!</p>\n\n<pre><code>function Invoke-SqlRestore {\n    param(\n        [string]$backup_file_name,\n        [string]$server_name,\n        [string]$database_name,\n        [switch]$norecovery=$false\n    )\n\n    # Get a new connection to the server\n    [Microsoft.SqlServer.Management.Smo.Server]$server = New-SMOconnection -server_name $server_name\n    Write-Host \"Starting restore to $database_name on $server_name.\"\n\n    Try {\n        $backup_device = New-Object(\"Microsoft.SqlServer.Management.Smo.BackupDeviceItem\") ($backup_file_name, \"File\")\n\n        # Get local paths to the Database and Log file locations\n        If ($server.Settings.DefaultFile.Length -eq 0) {$database_path = $server.Information.MasterDBPath }\n        Else { $database_path = $server.Settings.DefaultFile}\n        If ($server.Settings.DefaultLog.Length -eq 0 ) {$database_log_path = $server.Information.MasterDBLogPath }\n        Else { $database_log_path = $server.Settings.DefaultLog}\n\n        # Load up the Restore object settings\n        $restore = New-Object Microsoft.SqlServer.Management.Smo.Restore\n        $restore.Action = 'Database'\n        $restore.Database = $database_name\n        $restore.ReplaceDatabase = $true\n\n        if ($norecovery.IsPresent) { $restore.NoRecovery = $true }\n        Else { $restore.Norecovery = $false }\n\n        $restore.Devices.Add($backup_device)\n\n        # Get information from the backup file\n        $restore_details = $restore.ReadBackupHeader($server)\n        $data_files = $restore.ReadFileList($server)\n\n        # Restore all backup files\n        ForEach ($data_row in $data_files) {\n            $logical_name = $data_row.LogicalName\n            $physical_name = Get-FileName -path $data_row.PhysicalName\n\n            $restore_data = New-Object(\"Microsoft.SqlServer.Management.Smo.RelocateFile\")\n            $restore_data.LogicalFileName = $logical_name\n\n            if ($data_row.Type -eq \"D\") {\n                # Restore Data file\n                $restore_data.PhysicalFileName = $database_path + \"\\\" + $physical_name\n            }\n            Else {\n                # Restore Log file\n                $restore_data.PhysicalFileName = $database_log_path + \"\\\" + $physical_name\n            }\n            [Void]$restore.RelocateFiles.Add($restore_data)\n        }\n\n        $restore.SqlRestore($server)\n\n        # If there are two files, assume the next is a Log\n        if ($restore_details.Rows.Count -gt 1) {\n            $restore.Action = [Microsoft.SqlServer.Management.Smo.RestoreActionType]::Log\n            $restore.FileNumber = 2\n            $restore.SqlRestore($server)\n        }\n    }\n    Catch {\n        $ex = $_.Exception\n        Write-Output $ex.message\n        $ex = $ex.InnerException\n        while ($ex.InnerException) {\n            Write-Output $ex.InnerException.message\n            $ex = $ex.InnerException\n        }\n        Throw $ex\n    }\n    Finally {\n        $server.ConnectionContext.Disconnect()\n    }\n    Write-Host \"Restore ended without any errors.\"\n}\n</code></pre>\n"},{"tags":["sql-server-2008","c#-4.0","xml-parsing"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13192852,"title":"How to upload text file data into sqlserver database using c#?","body":"<p>my text file like this.</p>\n\n<pre><code>name :Settings, id :1, preference :Mail\nname:test ,id:2,preference :testMail\n</code></pre>\n\n<p>I need to read that textfile and placed that as records in sqlserver database.</p>\n\n<pre><code>name         id   preference\n settings     1      Mail\n test         2      testMail\n</code></pre>\n\n<p>How to parse that textfile like as above .please tell me </p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13190772,"title":"I want to write a sql query to join between two tables using group by clause with following output","body":"<p>In my database there are two table for orders and orderDetails.</p>\n\n<p>I want to show the column : Custom_Field_CustomerType ,ProductCode,Product Name,order_count,Quantity</p>\n\n<p>I need the \"Total\" quantity summarized for each productcode by Custom_Field_CustomerType</p>\n\n<p>The report will be used to determine the total quantity of each product sold to each custom_field_customertype. Therefore the report will have to add up all the individual quantities sold on each orderid for each individual productid.</p>\n\n<p>I have written following query but not getting proper output    </p>\n\n<pre><code>  SELECT  OrderDetails.productcode,\nOrderDetails.productname,\nSUM(OrderDetails.quantity) as Quantity, \nOrders.Custom_Field_CustomerType ,\nSum (Orders.OrderDetails_Count) as  OrderCount \nFROM \n\nOrderDetails INNER JOIN Orders on OrderDetails.OrderID=Orders.OrderID  \n WHERE Orders.OrderStatus = 'Shipped' AND \n DATEDIFF(dd, Orders.OrderDate, '09/01/2012') &lt;= 0 AND \n DATEDIFF(dd, Orders.OrderDate, '11/01/2012') &gt;= 0  \n  Group by Orders.Custom_Field_CustomerType,OrderDetails.productcode ,\n  OrderDetails.productname\n     ORDER BY Orders.Custom_Field_CustomerType DESC    \n</code></pre>\n"},{"tags":["sql-server-2008","database-backups"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":4153,"score":3,"question_id":2181827,"title":"SQL Server 2008 backup best practices","body":"<p>Without not reason, I lose all my data in my database. Fortunately this is was just test data, but this made me to think what will happen if this was done with a production db. </p>\n\n<p>Ultimately, every developer got a db problem and wan to role-bake the db. We don't do things to protect the db, as we think its a DBA work, but then we got trouble...</p>\n\n<p>What is your backup best practices?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13189760,"title":"Does Sql have any attribute which encrypt while inserting and descrypt while getting data from one column?","body":"<p>I want to know is there any attribute or any way where i want to encrypt one column of my table so whenever i am inserting or updating any row in table the columns encrypt that data automatically and while selecting it decrypt and data and get the value in that column.</p>\n"},{"tags":["sql","sql-server","performance","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":94,"score":0,"question_id":11724333,"title":"SQL Server - joining 4 fast queries gives me one slow query","body":"<p>I have 4 views in my MS Sql Server Database which are all quite fast (less than 2 seconds) and return all less than 50 rows.</p>\n\n<p>BUT when I create a query where I join those 4 views (left outer joins) I get a query which takes almost one minute to finish.</p>\n\n<p>I think the query optimizer is doing a bad job here, is there any way to speed this up. I am tempted to copy each of the 4 views into a table and join them together but this seems like too much of a workaround to me.</p>\n\n<p>(Sidenote: I can't set any indexes on any tables because the views come from a different database and I am not allowed to change anything there, so this is not an option)</p>\n\n<p><strong>EDIT:</strong> I am sorry, but I don't think posting the sql queries will help. They are quite complex and use around 50 different tables. I cannot post an execution plan either because I don't have enought access rights to generate an execution plan on some of the databases.</p>\n\n<p>I guess my best solution right now is to generate temporary tables to store the results of each query.</p>\n"},{"tags":["c#","asp.net","sql-server-2008","ms-word","vsto"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":681,"score":3,"question_id":9875134,"title":"Edit Saved Microsoft Word Document in C#/Asp.net","body":"<p>I am not sure if this is possible and every where I have searched, I cannot find a clear answer.  I am saving a Microsoft Word document to a SQL Server 2008 table.  Basically just converting the file to a <code>Byte[]</code> and writing that to the table.  This word document is a \"template\" file.  The file is a form that the user needs to fill out.  What I am wondering, is after reading that file from SQL Server and before opening it up for the user, is there a way to autopopulate some fields in the form for the user?  For example, if I know the address of the user already, can I autopopulate the address field in the template for them?</p>\n\n<p>I know that using <code>Microsoft.Office.Interop.Word</code>, I can search the document for bookmarks and insert data at the bookmark.  However, as far as I know, you cannot use <code>Microsoft.Office.Interop.Word</code> to open a <code>Byte[].</code></p>\n\n<p>Is there anyway to complete what I was looking for?</p>\n"},{"tags":["database","sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13188121,"title":"Creating a local database SQL Server 2008 R2","body":"<p>I would like to create a local database in SQL Server 2008 R2.</p>\n\n<p>I tried entering in the server name <code>myComputerName\\SQLEXPRESS</code> and also <code>(local)\\SQLEXPRESS</code> (windows authentication) but I keep getting an error that the server is not found.</p>\n\n<p>What is the problem?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13189706,"title":"SQL Server, how to display (square) ^2 as in column heading?","body":"<p>Please guide me how to display m2 (m with 2 as square small on top of m) in column heading ?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008","index","normalization","database-performance"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13189237,"title":"Normalize a database - optimization","body":"<p>I have some kind of project in the university, about sql server.</p>\n\n<p>We need to normalize a database, migrating all data.</p>\n\n<p>The original db is a \"master\" table, with about 39 fields. We need to create all tables, and then scanning this master table (about 700.000 rows) inserting the data where it belongs.</p>\n\n<p>I have a problem of performance. In new machines, it runs fast, but in my case (having ubuntu, using a vm of windows xp, so I have lower recurses than the machines of my team partners) runs much slower.</p>\n\n<p>So, we want to improve performance, because we don't know in which machines will be tested.</p>\n\n<p>We think on indexing master table, but the problem is that almost all fields are nvarchar(255) or numeric(18,2).</p>\n\n<p>Is good to index that fields? We must do inserts in almost 15 tables, so each insert is scanning all master table, getting the information.</p>\n\n<p>Is there any other thing useful instead of index ? We thought also in create different views, for optimize the selects.</p>\n\n<p>it's homework, but the tag says \"Do not use\".</p>\n\n<p>Any orientation will be apreciated</p>\n\n<p><strong>Update 1</strong></p>\n\n<p>this is one of the querys.\nBefore you hate me, I DIDN'T DO THIS, with the old-syntax style. (was one of my parters)</p>\n\n<pre><code>insert into LITTLE_BOBBY_TABLES.Proveedor\nSELECT DISTINCT U.idUsuario, C.idCiudad,R.idRubro, M.Provee_RS,M.Provee_CUIT, '', M.Provee_Telefono, M.Provee_Dom, REPLACE(REPLACE(REPLACE(M.Provee_RS, 'N',''), '.R.L.', ''), ' ', ''), ''   \nFROM gd_esquema.Maestra M, LITTLE_BOBBY_TABLES.Usuario U, LITTLE_BOBBY_TABLES.CIUDAD C, LITTLE_BOBBY_TABLES.Rubro R\nWHERE U.Username=REPLACE(REPLACE(REPLACE(M.Provee_RS, 'N',''), '.R.L.', ''), ' ', '')\nAND C.Nombre=M.Provee_Ciudad\nAND R.Nombre=M.Provee_Rubro;\n</code></pre>\n\n<p>Maestra is the master Table. The another are the tables where it inserts. Inserts the U.idUsuario(created for each person previously), some more id's joined, and  the replace are because we need to create an user Name replacing some strings in the Field Provee_RS. The username is generated before.</p>\n\n<p>I run the Execution plan, the %85 was in the scanning of Master Table</p>\n\n<p><img src=\"http://i.stack.imgur.com/WjO5p.png\" alt=\"enter image description here\"></p>\n\n<p><strong>Update 2</strong></p>\n\n<p>in this query, scanning gd_Esquema.Maestra takes %97 according execution plan.</p>\n\n<pre><code>insert into LITTLE_BOBBY_TABLES.CuponFactura\nselect m.Factura_Nro, cc.IdCompraCupon\nfrom LITTLE_BOBBY_TABLES.CompraCupon cc\njoin LITTLE_BOBBY_TABLES.Cliente c on c.idUsuario = cc.IdCliente\njoin LITTLE_BOBBY_TABLES.Promocion p on p.IdPromocion = cc.IdPromocion\njoin gd_esquema.Maestra m on \n                m.Cli_Nombre = c.Nombre and\n                m.Cli_Apellido = c.Apellido and\n                m.Groupon_Codigo = p.CodigoPromocion and\n                m.Groupon_Fecha_Compra = cc.Fecha and\n                m.Factura_Fecha is not null\n</code></pre>\n\n<p>so, how efficiently could be create index in this type of fields ? Are there any other technique for better optimization that I'm missing?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13186879,"title":"Querying data groups with total row before starting next group?","body":"<p>I need to query some data in the below format in SQL Server:</p>\n\n<ul>\n<li>Id   Group   Price </li>\n<li>1    A   10</li>\n<li>2    A   20 </li>\n<li><p><strong>Sum    30</strong> </p></li>\n<li><p>1    B   6</p></li>\n<li>2    B   4 </li>\n<li><p><strong>Sum    10</strong> </p></li>\n<li><p>1    C   100</p></li>\n<li>2    C   200 </li>\n<li><strong>Sum    300</strong> </li>\n</ul>\n\n<p>I was thinking to do it in the follwoing steps:</p>\n\n<ol>\n<li>Query one group</li>\n<li>In other query do sum</li>\n<li>Use Union operator to combine this result set</li>\n<li>Do step 1-3 for all groups and finally return all sub sets of data using union.</li>\n</ol>\n\n<p>Is there a better way to do this ? May be using some out of box feature ? Please advise.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>As per suggestions and code sample I tried this code:</p>\n\n<pre><code>Select \nCase \nwhen id is null then 'SUM' \nelse CAST(id as Varchar(10)) end as ID,\n\nCase when [group] is null then 'ALL' else CAST([group] as Varchar(50)) end as [group]\n,Price from\n(\nSELECT Id,  [Group],BGAApplicationID,Section, SUM(PrimaryTotalArea) AS price   \nFROM vwFacilityDetails\nwhere bgaapplicationid=1102\nGROUP BY Id,  [Group],BGAApplicationID,Section  WITH ROLLUP\n) a\n</code></pre>\n\n<p>And Even this code as well:</p>\n\n<pre><code>Select Id,  [Group],BGAApplicationID,Section, SUM(PrimaryTotalArea) AS price           \nFrom   vwFacilityDetails\nWhere  Not ([group] Is Null And id Is Null And BGAApplicationId is null and section is null) and BGAApplicationId=1102\nGroup By Id,  [Group],BGAApplicationID,Section \n    With Rollup\n</code></pre>\n\n<p>In results it groups up the data but for every record it shows it 3 times (in both above codes) like:</p>\n\n<ul>\n<li>2879 Existing Facilities Whole School    25.00</li>\n<li>2879 Existing Facilities Whole School    25.00 </li>\n<li>2879 Existing Facilities    Whole School 25.00 </li>\n<li>2879 ALL 25.00</li>\n</ul>\n\n<p>I guess there is some issue in my query, please guide me here as well.\nThanks</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":25,"score":-1,"question_id":13187026,"title":"How can I prevent user from updating a Sql server table","body":"<p>Just encountered an issue today and need urgent help! (sorry about that)\nwe have a table in our database that we dont want user to be able to update its data manually or by running a script, not even an SA user</p>\n\n<p>Is there anyway I can have a specific user that is able to edit the table data but SA users cannot?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","azure","sql-azure","context-info"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":11722846,"title":"Replacement of Context_Info SQL Azure","body":"<p>I am currently using the CONTEXT_INFO property of the Master database for storing the logged in username to use it later in Table Triggers for auditing.</p>\n\n<p>While migrating to SQL Azure, the issue of Cross-Database connections popped and I couldn't find direct solutions to this issue.</p>\n\n<p>Following are the Issue Details:</p>\n\n<ol>\n<li>I call Stored Procedure XXX from Data Access Layer and pass the Username as Parameter</li>\n<li>The username is used to set the CONTEXT_INFO value in XXX</li>\n<li>The CONTEXT_INFO value is then used in Tables Insert/Update/Delete Triggers to Store Username for Application Auditing</li>\n</ol>\n\n<p>Solutions that I found so far:</p>\n\n<ol>\n<li>Create Table In Database to work as CONTEXT_INFO</li>\n<li>Use 2 Connection Strings in Data Access Layer, one for Master Database (to set CONTEXT_INFO) and the other is for the application and execute the SET CONTEXT_INFO each time before opening the connection to my application</li>\n</ol>\n\n<p>But I find both solutions risky, specially when expanding the Database over multiple SQL Azure Databases in the future.</p>\n\n<p>Appreciate your support.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","jobs"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":173,"score":2,"question_id":12249056,"title":"Executing SQL Server Agent Job from a stored procedure and returning job result","body":"<p>Need to have a stored procedure that calls a SQL Server Agent Job and returns whether or not the job ran successfully or not.</p>\n\n<p>So far I have<br></p>\n\n<pre><code>CREATE PROCEDURE MonthlyData\nAS\nEXEC msdb.dbo.sp_start_job N'MonthlyData'\n\nWAITFOR DELAY '000:04:00'\n\nEXEC msdb.dbo.sp_help_jobhistory @job_name = 'MonthlyData'\nGO\n</code></pre>\n\n<p>Which starts the job, whats the best way to get back if the job ran successfully or not?</p>\n\n<p>Ok made an edit and used WAITFOR DELAY as the job normally runs between 3-4 mins never longer than 4. Does the job but is there a more efficient way to do it?</p>\n"},{"tags":["c#","sql-server-2008","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":50,"score":1,"question_id":5842118,"title":"Store dimensions (along with image) in database columns?","body":"<p>I must store my images in varbinary(max) fields in a SQLServer 2008 database (file system is not an option in my environment).</p>\n\n<p>I'd like to be able to set image and height properties on HTML image tags when I serve these up (in my MVC2 app) and do different things in a gallery depending on portrait vs landscape orientation. </p>\n\n<p>So, from your experience, would it be worth the hassle (and de-normalization?) to  store this information in separate columns of the database, or is just cheap enough, performance-wise, to grab height &amp; width &amp; calculate orientation on the fly?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","sql-agent-job"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":677,"score":4,"question_id":10088427,"title":"How to pass a parameter to a SQL Job that will execute a stored procedure","body":"<p>I have the below code (only the portion that is needed)</p>\n\n<pre><code>EXEC @ReturnCode = msdb.dbo.sp_add_jobstep @job_id=@jobId, @step_name=N'SomeStep', \n        @step_id=1, \n        @cmdexec_success_code=0, \n        @on_success_action=1, \n        @on_success_step_id=0, \n        @on_fail_action=2, \n        @on_fail_step_id=0, \n        @retry_attempts=0, \n        @retry_interval=0, \n        @os_run_priority=0, @subsystem=N'TSQL', \n        @command=N'exec [dbo].[PORT_Insert_Record] ''https://localhost''',  \n        @database_name=N'MyDatabase', \n        @flags=0\n</code></pre>\n\n<p>Now, I want to pass the <code>https://localhost</code> value into a variable and pass to the stored procedure (for some reason I cannot pass it inside the SP).</p>\n\n<p>So I tried </p>\n\n<pre><code>DECLARE @domainName varchar(max)\nDECLARE @sp varchar(max)\nSET @domainName ='https://localhost:'\nSET @sp ='exec [dbo].[PORT_Insert_Record]' + @domainName\n\nEXEC @ReturnCode = msdb.dbo.sp_add_jobstep @job_id=@jobId, @step_name=N'InsertRecordIntoResellerOpportunities', \n        @step_id=1, \n        @cmdexec_success_code=0, \n        @on_success_action=1, \n        @on_success_step_id=0, \n        @on_fail_action=2, \n        @on_fail_step_id=0, \n        @retry_attempts=0, \n        @retry_interval=0, \n        @os_run_priority=0, @subsystem=N'TSQL', \n        @command=@sp,  \n        @database_name=N'MyDatabase',  \n        @flags=0\n</code></pre>\n\n<p>but it is not working. I also search in the net for any idea/syntax etc.. but no luck as of now.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server","database","sql-server-2008","schema"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":35,"score":1,"question_id":13184518,"title":"How to implement a schema with primary and foreign keys","body":"<p>I am trying to create relationships for my database tables, I developed a simple airline reservation system but I'm getting confused on how to get it right. My aim is to come up with a schema that shows primary keys and foreign keys.</p>\n\n<p>This is my database below</p>\n\n<p><img src=\"http://i.stack.imgur.com/YhOF6.png\" alt=\"enter image description here\"></p>\n\n<p>What am I missing it seems I do not have many foreign keys and a relationship diagram seems not to have connection because of that</p>\n\n<ul>\n<li>the Plist is a passenger list tables </li>\n<li>canreq is a cancel request table</li>\n<li>reg is the registration table</li>\n<li>fares is the fares table</li>\n<li>pid is a passenger id table</li>\n<li>schedule is a schedule table</li>\n</ul>\n"},{"tags":["visual-studio-2010","linq","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":12,"score":-1,"question_id":13184343,"title":"Weekly Performance Chart - ASP.NET","body":"<p>I'm trying to make a bar chart and using LINQ but I don't have any idea how to get weekly performance percent.</p>\n\n<p>I have a database that keeps daily goals and every mission has its own score(0-10) and start date, finish date also connected with UserID. I have to make a bar chart that displays user, week and week's performance rate (%). But I have no clue how to calculate \"that week's rating\" and bind it to chart. </p>\n\n<p>Any suggestions?</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures","stored-functions","sql-function"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13173989,"title":"Convert stored procedure to table-valued query","body":"<p>I have this procedure</p>\n\n<pre><code>ALTER PROCEDURE [dbo].GetHerdByUserProc(@user int)\nAs \n    begin\n        Declare\n            @GroupId uniqueidentifier,\n            @UserTrade bit\n\n        Set @GroupId = (select tbUser.group_id from tbUser where Userid = @user)\n        Set @UserTrade = (select tbUser.isTrade from tbUser where Userid = @user)\n        if @GroupId IS NOT NULL and @UserTrade = '1'\n        Begin \n            select HerdId from tbUserHerds where tbUserHerds.UserId in (select Userid from tbUser where tbUser.Group_Id = @GroupId)\n            return;\n        END\n        If @GroupId IS NOT NULL\n        Begin   \n            select HerdId from tbUserHerds where tbUserHerds.UserId = @user\n            return;\n        End\n        return;\n    End\n</code></pre>\n\n<p>It returns a list correctly except I would also like to run a query on the list that is returned and as far as I am aware I cannot write a query such as</p>\n\n<pre><code>Select * from GetHerdByUserProc 80\n</code></pre>\n\n<p>So I am looking the best way to convert this to a table-valued query.</p>\n\n<p>I have changed the alter to say <code>'Create Function x(@user int) Returns Table As'</code></p>\n\n<p>But that does not seam to work it starts screaming errors at me.</p>\n\n<p>Any ideas?  The Database Server is MSSQL2008</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13176954,"title":"Sql Server union with If condition","body":"<p>I have a query like:</p>\n\n<pre><code>DECLARE @tmpValue\nSET @tmpValue = 0 -- it will be change \n\nSELECT * FROM Animal WHERE AniActive = 1\nUNION \nIF @tmpValue &gt; 0 \nSELECT * FROM Animal WHERE.Active = 0\n</code></pre>\n\n<p>When I use like this it is giving error because of if condition. I have to use UNION because of our structure. </p>\n\n<p>How can I use it with if condition?</p>\n\n<p>Thanks, <br/>\nJohn</p>\n"},{"tags":["sql-server-2008","toad","redgate"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13183087,"title":"RedGate search for TOAD?","body":"<p>I'm using MS SQL 2008 R2 with RedGate SQL Search. Recently I installed TOAD (free version). It looks okay and I can use it instead MSSMS, but it doesn't have RedGate Search, which I used to use. So now I use MSSMS and TOAD at the same time. I didn't find RedGate Search for TOAD. So it's impossible to use them together?</p>\n\n<p><strong>EDIT:</strong> I mean maybe I can use some other tool for TOAD instead RedGate?</p>\n"},{"tags":["sql-server-2008","ssms2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13183203,"title":"sqlcmd mode from SSMS - setvar assignment to a substitution variable possible?","body":"<p>I'm running this from SSMS 2008R2 with SQLCMD Mode enabled.</p>\n\n<p>With the code below:</p>\n\n<pre><code>:SETVAR GREETING \"HELLO\"\n:SETVAR SALUTATION $(GREETING)\n\nSELECT '$(GREETING)'\nSELECT '$(SALUTATION)'\n</code></pre>\n\n<p>I see the following in the results:</p>\n\n<pre><code>HELLO\n$(GREETING)\n</code></pre>\n\n<p>I was hoping to see:</p>\n\n<pre><code>HELLO\nHELLO\n</code></pre>\n\n<p>Is there a way to have a scripting variable in the assignment of another scripting variable?  If so, what is the syntax?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13183082,"title":"paginating table and getting row count","body":"<p>The query below fetches a subset of rows from a table starting at row 10 and ending at row 20. In addition, to save a query I need to return the total number of rows in the table. This is the best solution that I could think of. Are there any more efficient/elegant ways? In particular, I do not like the <code>partition by 1</code> part.</p>\n\n<pre><code>select *\nfrom (select count(*) over (partition by 1) as [count],\n             row_number() over (order by [Name],[Description]) as [row],\n             *\n      from [Products]) as t\nwhere row between 10 and 20\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":64,"score":0,"question_id":13180086,"title":"Call a SQL function in a query","body":"<p>I have an issue with a function in SQL Server 2008, if I execute a query with a function, it takes like 40 secs, if I remove the function and I add the logic of the function in the query, is 0 secs!</p>\n\n<p>Anybody can explain me the reason of why using a function could be so slow? I really want to use the function to encapsulate the logic but I don't find the way of...</p>\n"},{"tags":["sql-server-2008","powershell","connection","powershell-remoting"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":493,"score":1,"question_id":4913638,"title":"Connect to sql server via transitional computer issue, login failed for NT AUTHORITY\\ANONYMOUS LOGON","body":"<p>I have SQL Server 2008 to which I can connect using domain user credentials. There are many computers in the network and if I login under that domain user I can successfully connect to SQL Server (using Windows Authentication).</p>\n\n<p>The problem is when I use PowerShell remoting and establish remote session from computer A to computer B. When I run our <code>dbtool</code> that tries to connect to SqlServer (in remote session) \"<code>login failed for NT AUTHORITY\\ANONYMOUS LOGON</code>\" error occurs.</p>\n\n<p>It's strange, because I establish remote session under same domain user. Why <code>ANONYMOUS</code> is being passesd to SqlServer?</p>\n\n<p>Thanks for help</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13180231,"title":"Migrating DB from SQL 2005 Enterprise to SQL 2008 Standard","body":"<p>I'm attemtping to migrate a DB from SQL 2005 Enterprise to SQL 2008 Standard.  I've run into an issue because there is a Partition Function defined in the DB of the Enterprise edition.  I know Standard edtiions do not support Partition Functions. Upgrading the version of SQL im migrating to Enterprise isn't an option.</p>\n\n<p>I'm looking for a way to remove the partition function without causing any negative effects to the DB currently so I can migrate it to the 2008 Standard Edition.</p>\n\n<p>Any help would be greatly appreciated. Thanks!</p>\n\n<p>MOVED to dba.stackexchange.com. </p>\n"},{"tags":["sql-server","tsql","sql-server-2008","sqlcompare"],"answer_count":9,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1175,"score":3,"question_id":3012544,"title":"T-SQL - Is there a (free) way to compare data in two tables?","body":"<p>I have <code>table a</code> and <code>table b</code>. (SQL Server 2008)</p>\n\n<p>Both tables have the exact same schema.</p>\n\n<p>For the purposes of this question, consider <code>table a</code> = my local dev table, <code>table b</code> = the live table.</p>\n\n<p>I need to create a SQL script (containing <code>UPDATE/DELETE/INSERT</code> statements) that will update table b to be the same as table a. This script will then be deployed to the live database.</p>\n\n<p>Any free tools out there that can do this, or better yet a way I can do it myself?</p>\n\n<p>I'm thinking I probably need to do some type of a join on all the fields in the tables, then generate dynamic SQL based on that.</p>\n\n<p>Anyone have any ideas?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Okay, thought I'd clarify this question a little.</p>\n\n<p>The table I need to synchronize is a simple look-up table. The data is very simple and straightforward.</p>\n\n<p>Here's an idea of what <code>TABLE A</code> might look like:</p>\n\n<pre><code>IdFoo          Activity      IsFoo\n1              Foo           1\n2              Bar           0\n</code></pre>\n\n<p>Here's an idea of what <code>TABLE B</code> might look like:</p>\n\n<pre><code>IdFoo          Activity      IsFoo\n1              Foo           1\n2              Bar           1\n</code></pre>\n\n<p>Basically, all I want to do is update that <code>BIT</code> column (<code>IsFoo</code>) in <code>TABLE B</code> to match the corresponding value in <code>TABLE A</code> for the same IdFoo.</p>\n\n<p>Keep in mind:</p>\n\n<ul>\n<li><code>TABLE A</code> is on my local machine</li>\n<li><code>TABLE B</code> is on the live server</li>\n</ul>\n\n<p>Obviously I have a (reliable) backup of <code>TABLE B</code> on my local machine which i need to script against, then run the script on the live server.</p>\n\n<p>The table also has referential integrity (other columns I didn't show). Which means I can't just delete everything in <code>TABLE B</code> and do an insert from <code>TABLE A</code>.</p>\n\n<p>This script will be a once off. So no need to do things like linked server, replication, etc. Appreciate the answers though guys. =)</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Ok - so I've gone with Oleg's answer (VS2010 Data Compare). Quick, easy, and works a charm.</p>\n\n<p>Not to say the other answers are incorrect. I appreciate all the answers!</p>\n"},{"tags":["sql-server-2008","tsql","join","rownumber"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13175412,"title":"Return rows around row with a certain value with joins","body":"<p>I have fairly complicated join query from which I want to select a few rows around a result with a certain id.</p>\n\n<p>The query currently looks something like this:</p>\n\n<pre><code>WITH results AS \n  (\n    SELECT t1.id,  t1.position, t1.points, t2.name\n      ROW_NUMBER() OVER(ORDER BY t1.position ASC, t1.points DESC) AS rn\n      FROM Table1 t1\n      JOIN Table2 t2 ON t1.id = t2.Table1id\n      /* Several more joins here, some of which limit the result set */\n  )\nSELECT * FROM results\nWHERE rn &lt; ( SELECT rn+3 FROM results WHERE  id = @someid ) \nAND rn &gt; ( SELECT rn-3 FROM results WHERE id = @someid )\n</code></pre>\n\n<p>Is there a better way to solve this? Most of all I'm worried about performance with these multiple calls to a possibly huge CTE. </p>\n\n<p>The query is run on a <strong>SQL 2008</strong> server.</p>\n"},{"tags":["asp.net","sql-server-2008","iis7"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13180127,"title":"Sql Server Linked Server Issue \"Login failed for user 'NT AUTHORITY\\ANONYMOUS LOGON'","body":"<p>I have a domain user on both linked server and server which is referring the linked server.\nSame domain user is added to the pool identity of web supplication ( asp.net).\nWhat is happening, that application is successfully accessing the local DB and all data is coming fine. But when application try to access the stored procedure which is calling linked server it shows the following error \n\"Login failed for user 'NT AUTHORITY\\ANONYMOUS LOGON\"</p>\n\n<p>But more annoying is that it does not fail always, if someone is logged into SSMS web application can fetch this data but if he log off from the server ,after some time this error start appearing.</p>\n\n<p>It works fine when we have sql server 2008 R2 on both servers (linked and one using the linked  server) and windows 2008.\nBut fails when we have windows 2003 server and sql 2005( db from this is used a linked) , and sql server 2008 on windows server 2008</p>\n"},{"tags":["database","sql-server-2008","datagridview","dataset"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":29,"score":3,"question_id":13157891,"title":"Bit datatype to enum type mapping from database to dataset in SQL Server 2008","body":"<p>I have a table which has a column <code>Xyz</code> and it has <code>bit</code> datatype in SQL Server 2008.</p>\n\n<p>I'm getting the values from the table through data adapter and I'm storing it in a <code>DataSet</code> and a <code>DataGridView</code> will show the contents from the <code>DataSet</code></p>\n\n<p>In the gridview, for column <code>Xyz</code>, a check_box with/without tick is displayed but I want to display it as a buy/sell as a text instead of checkbox.</p>\n"},{"tags":["c#","sql-server-2008","enumerations"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":162,"score":1,"question_id":10132968,"title":"How to Enumerate SQL Server Instances","body":"<p>Id like to have my application return instances of SQL Server 2008 R2 Developer/Express. </p>\n\n<p>Im using:</p>\n\n<pre><code>System.Data.DataTable lokalni_servery = Microsoft.SqlServer.Management.Smo.SmoApplication.EnumAvailableSqlServers();\n\nforeach (System.Data.DataRow row in lokalni_servery.Rows)\n{\n    local_servers.Items.Add(row[\"Server\"].ToString());\n}\n</code></pre>\n\n<p>On my friends notebook with SQL Server 2008 R2 express 32 bit, it doesnt find anything, but on my notebook with SQL Server 2008 R2 Developer 64 bit, it finds it almost everytime. \nI need to be able to find this instance of SQL on both machines.</p>\n\n<p>Does anybody know why the application is behaving like this? </p>\n\n<p>Is there a way to alter the method allowing for both notebooks to find the instance?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":13174399,"title":"Coalesce vs Case","body":"<p>I have 5 fields which are bringing back a mixture of values and NULLS. For reporting purposes I need to replace any potential NULLS with a value. The database that I am interrogating is updated nightly via an SSIS package.</p>\n\n<p>Obviously I will need to alter the .dtsx file to stop NULLS being brought through each day by adding some SQL.</p>\n\n<p>My question is:</p>\n\n<p>What is the most efficient way of dealing with these NULLS in terms of performance. So far ive identified <code>COALESCE</code> and <code>CASE</code> to deal with them and im leaning towards <code>COALESCE</code> because my alternative to <code>NULL</code> is not going to change, but I would be interested to hear if and why this would be the most efficient method.</p>\n"},{"tags":["vb.net","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":56,"score":3,"question_id":13168909,"title":"When inserting new columns in a datatable in VB 2010, how do I update the SQL Server 2008 Database?","body":"<p>Using VB 2010 and SQL Server 2008:</p>\n\n<p>I am able to insert new rows, delete rows, and update data in a datatable, and use a data adapter to update the database without any issues. When I try to add new columns, the column appears in the data table, but it does not update to the database. I currently am using the DataAdapter.Update(DataTable) Method.</p>\n\n<p>My code is as follows:</p>\n\n<pre><code>Dim dcNewColumn As New DataColumn\ndcNewColumn.ColumnName = strClassColumnName\nm_DataTable.Columns.Add(dcNewColumn)\nm_DataTable.Row(intCurrentRow).Item(strClassColumnName) = strClassName\ndcNewColumn = Nothing\n\nm_DA.Update(m_DataTable)\n</code></pre>\n\n<p>Is there a different method to updating the database when inserting new columns?</p>\n"},{"tags":["sql-server-2008","tsql","computed-columns"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13173183,"title":"Find SQL Server 2008 computed column dependency","body":"<p>I want to search whether a columns is participating in a computed column expression. </p>\n\n<p>I came up with this </p>\n\n<pre><code>SELECT \n    (select name \n     from sys.columns \n     where column_id = sys.sql_expression_dependencies.referencing_minor_id \n     and object_id = sys.sql_expression_dependencies.referencing_id) as [dependant_column]\nFROM sys.sql_expression_dependencies\nWHERE referencing_minor_id &gt; 0 \n    and referencing_class = 1 \n    and referenced_class = 1 \n    and object_name(referencing_id) = 'trns1'\n    and referenced_minor_id = (select column_id \n                           from sys.columns \n                           where name = 'class1' \n                           and OBJECT_NAME(object_id) = 'trns1')\n</code></pre>\n\n<p>Please help.</p>\n"},{"tags":["c#","sql","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13177612,"title":"Does select query change column data value if we use \"set\" in it","body":"<p>In reference to my <a href=\"http://stackoverflow.com/questions/13176567/temporary-sql-datafield/13177257#13177257\">Previous Question</a> someone said in select query if I set a column data value for a table it won't going to update columns value in my table within a stored procedure, is that's right?</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13178457,"title":"How to set and return a column Value in SQL Stored Procedure within If else statement","body":"<p>In reference to my <a href=\"http://stackoverflow.com/questions/13176567/temporary-sql-datafield/13177257#13177257\">Previous Question</a> I am not sure how can I set and then return a column data value with out saving it to table.</p>\n\n<pre><code>if @datafield = 1\nset ColumnA.table2=1\nelse if @datafield = 2 AND @datafield2 = 3\nset ColumnA.table2= 0\nelse\nreturn (SELECT ColumnA.table2 FROM table1 INNER JOIN table2 on table1.id and table2.id Where @datafield3 = 0)\n</code></pre>\n\n<p>I am not sure how to return after setting values, I did tried begin and end , not working tho</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13178443,"title":"fileupload value is not saving in database","body":"<pre><code>    SqlConnection con = new SqlConnection();\n    SqlCommand cmd = new SqlCommand(\"insert into Tbl_Videos(VideoName,VideoPath)values(@VideoName,@VideoPath)\");\n\n    string fileExt = System.IO.Path.GetExtension(FileUpload1.FileName);\n\n    if (fileExt == \".avi\")\n    {\n        try\n        {\n            FileUpload1.SaveAs(Server.MapPath(\"~/video/\" +FileUpload1.FileName));\n            Label1.Text = \"File name: \" +\n            FileUpload1.PostedFile.FileName + \"&lt;br&gt;\" +\n            FileUpload1.PostedFile.ContentLength + \" kb&lt;br&gt;\" +\"Content type: \"+FileUpload1.PostedFile.ContentType;\n           cmd.Parameters.AddWithValue(\"@VideoName\",FileUpload1.FileName);\n            cmd.Parameters.AddWithValue(\"@VideoPath\", FileUpload1.FileName);\n            cmd.ExecuteNonQuery();\n        }\n        catch (Exception ex)\n        {\n            Label1.Text = \"ERROR: \" + ex.Message.ToString();\n        }\n    }\n    else\n    {\n        Label1.Text = \"Only .avi files allowed!\";\n    }\n\n}\n</code></pre>\n"},{"tags":["php","sql","sql-server-2008","database-connection","connect"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":68,"score":3,"question_id":13028538,"title":"sqlsrv_connect() keep connection in application pool active","body":"<p>I have a php script that connects to a local SQL server database through sqlsrv_connect.</p>\n\n<pre><code>  $serverName = \"127.0.0.1\\MSSQLSERVER\";\n  $userName = 'username';\n  $userPassword = 'pass';\n  $dbName = \"name\";\n  $connectionInfo = array(\"database\"=&gt;$dbName,\n                              \"UID\"=&gt;$userName,\n                              \"PWD\"=&gt;$userPassword, \n                              \"MultipleActiveResultSets\"=&gt;true,\n                              \"ConnectionPooling\"=&gt;true);\n\n  sqlsrv_configure('WarningsReturnAsErrors', 0);\n\n  $this-&gt;connection = sqlsrv_connect( $serverName, $connectionInfo);\n</code></pre>\n\n<p>The first time that i load the website this code under is executing in about 1.5sec</p>\n\n<pre><code>$this-&gt;connection = sqlsrv_connect( $serverName, $connectionInfo);\n</code></pre>\n\n<p>If i reload the page the execution time for the same line is 0.0012 - 0.0020sec (much faster)</p>\n\n<p>If i wait for lets say for 10 minutes and try to reload the page again the execution time for connect is over 1sec</p>\n\n<p>Is there anything i can do to keep the connection \"active\" so to make the <code>sqlsrv_connect</code> runs faster? </p>\n\n<ol>\n<li>IIS Application pool idle shutdown is disable</li>\n<li>MSSQL Server connection timeout is 0</li>\n</ol>\n\n<p>Thanks in advance</p>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":54,"score":4,"question_id":13177765,"title":"Regarding get automatic columns in sql`","body":"<p>I have basically 50 fields in a table and I want to select this fields from table on a regular basis.</p>\n\n<p><strong>Problem is</strong>: I have to write all this 50 fields manually.</p>\n\n<p>Is there any shortcut in intellisence or any other tool where I can get all fields. automatically by pressing tool.</p>\n\n<p>Also guys if anyone knows here extra addons on sql..then please post it here.</p>\n"},{"tags":["sql-server","sql-server-2008","powershell","powershell-v2.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13152809,"title":"Invoke-SqlCmd QueryTimeout","body":"<p>Does anyone know how to set Invoke-SqlCmd QueryTimeout more than 65535? </p>\n\n<p>Microsoft said that they have fixed it in Denali but we are still using SQL 2008 R2 with latest service packs.</p>\n\n<p><a href=\"http://connect.microsoft.com/SQLServer/feedback/details/551799/invoke-sqlcmd-querytimeout-0-still-times-out\" rel=\"nofollow\">http://connect.microsoft.com/SQLServer/feedback/details/551799/invoke-sqlcmd-querytimeout-0-still-times-out</a></p>\n\n<p>Basically, we are trying to backup or restore the database using powershell. Some of our databases are very large so it takes more than 65535 to complete the job. </p>\n\n<p>Some suggested that we should use ADO.NET with timeout in powershell. But I wonder if we have any workaround for Invoke-SqlCmd...</p>\n"},{"tags":["sql-server-2008","reporting-services","subreports"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1891,"score":1,"question_id":7947454,"title":"Reporting Services: multiple subreports in one report","body":"<p>in my project there are three reports - Main Report and two subreports, each with its own dataset (the only column common to all the datasets is ItemID). The Main Report passes ItemID as parameter to each of its two subreports.</p>\n\n<p>The Main Report is built in a form-like layout, i.e. I use the List control and arrange the Main Report fields inside the List body. (I need to show only one record each time, so I chose List and not Table or Matrix.)</p>\n\n<p>If I add one of the subreports to the Main Report body (i.e. inside the List body), it works just fine. But if I try to add the other subreport to the Main Report, the data is shown only in the subreports while the fields of the Main Reports are empty (no data from the dataset of the Main Report is shown). I can't understand why it happens.</p>\n\n<p>What could be the problem here? </p>\n\n<p>I'll appreciate any help.</p>\n"},{"tags":["vb.net","sql-server-2008","select","if-statement"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":13173909,"title":"Select mysql if true then update, else insert","body":"<p>I Need an check if ID is already in the database, if that is true: Update values Longitude, Latitude, Timestamp. If not then insert all in the database.</p>\n\n<p>My script now is:</p>\n\n<pre><code>&lt;%@ Import Namespace=\"System.Data\"%&gt;   \n&lt;%@ Import Namespace=\"System.Data.SqlClient\"%&gt;   \n&lt;%@ Import Namespace=\"System.Reflection\"%&gt;\n&lt;%@ Page Language=\"VB\" %&gt;  \n&lt;script runat=\"server\"&gt;  \n\n\n    Dim Con As New SqlConnection\n    Dim Cmd As New SqlCommand\n    Dim SQLCommand As String = \"\"\n    Dim Reader As SqlDataReader\n\nProtected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load\n    If Not String.IsNullOrEmpty(Request.QueryString(\"data\")) Then\n        Dim data As String = Request.QueryString(\"data\")\n\n        Dim myObj As New MyObject\n        Dim properties() As PropertyInfo = myObj.GetType().GetProperties()\n        Dim values() As String = Server.UrlDecode(data).Replace(\"{\", \"\").Replace(\"}\", \"\").Replace(\"\"\":\"\"\", \"\"\"=\"\"\").Split(New Char() {\",\"}, StringSplitOptions.RemoveEmptyEntries)\n        For Each value As String In values\n            Dim keyValue() As String = value.Split(New Char() {\"=\"}, StringSplitOptions.RemoveEmptyEntries)\n            For Each prop As PropertyInfo In properties\n                If prop.Name.ToLower = keyValue(0).ToLower.Replace(\"\"\"\", \"\") Then\n                    prop.SetValue(myObj, keyValue(1).Replace(\"\"\"\", \"\"), Nothing)\n                End If\n            Next\n        Next\n\n        myObj.Save()\n        lblText1.Text = String.Format(\"ID: {0}\", myObj.ID)\n        lblText2.Text = String.Format(\"Longitude: {0}\", myObj.Longitude)\n        lblText3.Text = String.Format(\"Latitude: {0}\", myObj.Latitude)\n        lblText4.Text = String.Format(\"Timestamp: {0}\", myObj.Timestamp)\n\n\n'cmd.Parameters.AddWithValue(\"@ID\", ID)\n'cmd.Parameters.AddWithValue(\"@Longitude\", Longitude)\n'cmd.Parameters.AddWithValue(\"@Latitude\", Latitude)\n'cmd.Parameters.AddWithValue(\"@Timestamp\", Timestamp)\n\n'Con.ConnectionString = \"Data Source=sr04011389\\sql02;Initial Catalog=LocatieBepaling_Ontw;Integrated Security=True\"\n    'Cmd.Connection = Con\n    'Con.Open()\n\n   '     Cmd.CommandText = \"INSERT INTO dbo_Locatie(id, Longitude, Latitude, Timestamp) VALUES (1234, 4567, 789, 12-12-2012)\"\n\n\n' Reader = Cmd.ExecuteReader\n\n '        Reader.Close()\n  '       Con.Close()\n '      Con.Dispose()\n\n\n\n    End If\n\nEnd Sub\n'Dim values() As String = Server.UrlDecode(data).Replace(\"{\", \"\").Replace(\"}\", \"\").Replace(\"\"\":\"\"\", \"\"\"=\"\"\").Split(New Char() {\",\"}, StringSplitOptions.RemoveEmptyEntries)  For Each value As String In values \n\n\nPublic Class MyObject\n    Private _ID As String\n    Private _Longitude As String\n    Private _Latitude As String\n    Private _Timestamp As String\n\n\n    Public Property ID As String\n        Get\n            Return _ID\n        End Get\n        Set(value As String)\n            _ID = value\n        End Set\n    End Property\n\n\n    Public Property Longitude As String\n        Get\n            Return _Longitude\n        End Get\n        Set(value As String)\n            _Longitude = value\n        End Set\n    End Property\n\n\n    Public Property Latitude As String\n        Get\n            Return _Latitude\n        End Get\n        Set(value As String)\n            _Latitude = value\n        End Set\n    End Property\n\n\n    Public Property Timestamp As String\n        Get\n            Return _Timestamp\n        End Get\n        Set(value As String)\n            _Timestamp = value\n        End Set\n    End Property\n\n\n    Public Function Save() As Boolean\n Return True\n    Using objConn As New SqlConnection(\"Server=sr04011389\\sql02;database=LocatieBepaling_Ontw;Trusted_Connection=yes;Max Pool Size=400;Connect Timeout=600;\")\n      Try\n\n            Dim cmd As New SqlCommand(\"csp_save_my_object\")\n            cmd.CommandType = CommandType.StoredProcedure\n            cmd.Parameters.AddWithValue(\"@ID\", ID)\n            cmd.Parameters.AddWithValue(\"@Longitude\", Longitude)\n            cmd.Parameters.AddWithValue(\"@Latitude\", Latitude)\n            cmd.Parameters.AddWithValue(\"@Timestamp\", Timestamp)\n           Return cmd.ExecuteNonQuery() &gt; 0\n        Catch ex As Exception\n           Return False\n       End Try\n    End Using\n\n    End Function\n\n\n    Public Function SaveWithoutSP() As Boolean\n       Return True\n        Using Con As New SqlConnection(\"Server=sr04011389\\sql02;database=LocatieBepaling_Ontw;Trusted_Connection=yes;Max Pool Size=400;Connect Timeout=600;\")\n            Try\n               Con.Open()\n               Dim cmd As New SqlCommand(\"UPDATE dbo_Locatie SET (Longitude = @Longitude, Latitude = @Latitude,Timestamp = @Timestamp) WHERE id=@ID IF @@ROWCOUNT=0 INSERT INTO locatie VALUES (@ID, @Longitude, @Latitude, @Timestamp)\")\n              cmd.CommandType = CommandType.Text\n                cmd.Parameters.AddWithValue(\"@ID\", ID)\n                cmd.Parameters.AddWithValue(\"@Longitude\", Longitude)\n                cmd.Parameters.AddWithValue(\"@Latitude\", Latitude)\n                 cmd.Parameters.AddWithValue(\"@Timestamp\", Timestamp)\n                Return cmd.ExecuteNonQuery() &gt; 0\n            Catch ex As Exception\n                Return False\n\n            End Try\n        End Using\n    End Function\nEnd Class\n\n\n\n 'Sub Page_UnLoad()   \n 'objConn.Close()   \n 'objConn = Nothing  \n 'End Sub  \n\n &lt;/script&gt;  \n\n &lt;html&gt;   \n &lt;head&gt;   \n &lt;title&gt;TracknTrace&lt;/title&gt;   \n &lt;/head&gt;   \n &lt;body&gt;   \n &lt;form id=\"form1\" runat=\"server\"&gt;   \n &lt;asp:Label id=\"lblText\" runat=\"server\"&gt;&lt;/asp:Label&gt; \n &lt;br&gt;&lt;asp:Label id=\"lblText1\" runat=\"server\"&gt;&lt;/asp:Label&gt; &lt;/br&gt;\n &lt;br&gt;&lt;asp:Label id=\"lblText2\" runat=\"server\"&gt;&lt;/asp:Label&gt; &lt;/br&gt; \n &lt;br&gt;&lt;asp:Label id=\"lblText3\" runat=\"server\"&gt;&lt;/asp:Label&gt; &lt;/br&gt;\n &lt;br&gt;&lt;asp:Label id=\"lblText4\" runat=\"server\"&gt;&lt;/asp:Label&gt; &lt;/br&gt;\n &lt;/form&gt; \n</code></pre>\n\n<p><br>\n And the PHP code i used before was:</p>\n\n<pre><code> $result = mysql_query(\"SELECT * FROM locatie WHERE id='$id'\");\n if($result &amp;&amp; mysql_num_rows($result)&gt;0){\n {\n $query = \"Update locatie \n SET     longitude = '$longitude',\n latitude = '$latitude',\n timestamp = '$timestamp'\n WHERE id = '$id'\";}\n else\n //Als het nummer bekend is\n\n {\n  //Als het een nieuw nummer is\n $query = sprintf(\"INSERT INTO locatie (id, longitude, latitude, timestamp) VALUES ('% s', '%s', '%s', '%s') \", mysql_real_escape_string($id) , mysql_real_escape_string ($longitude),  mysql_real_escape_string($latitude), mysql_real_escape_string($timestamp));}\n\n\n\n $result = mysql_query($query) or die('Query failed: ' . mysql_error());\n echo \"OK\";\n</code></pre>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13176567,"title":"Temporary SQL datafield","body":"<p>Currently I am returning a boolean value as \"1\" or \"0\" or value of a column let say column A in one of my stored procedure and it works perfectly, however in one of application I am trying to get value like this</p>\n\n<pre><code>string temp = reader.TryGetValue(\"ColumnA\", out licenseStatus) ? temp : string.Empty;\n</code></pre>\n\n<p>Stored procedure is doing something like this,</p>\n\n<pre><code>if @datafield = 1\n    return 1\nelse if @datafield = 2 AND @datafield2 = 3\n    return 0\nelse\n    return (SELECT ColumnA.table2 FROM table1 INNER JOIN table2 on table1.id and table2.id Where @datafield3 = 0)\n</code></pre>\n\n<p>Now I want to return result as value of ColumnA always instead of sending \"0\" or \"1\" as I am not allowed to make changes to code in application.</p>\n\n<p>Is it possible ? I can't make any changes to ColumnA value at all either.</p>\n\n<p><strong>EDIT</strong></p>\n\n<blockquote>\n  <p>I already mentioned in my question that stored procedure is doing what\n  its suppose to do but not working with my code, as I am returning 1 or\n  0 at some point and my code isn't getting it as columnA so its setting\n  it up empty, I want to return 0 or 1 as value of ColumnA but at same\n  time I don't want to change value of columnA in table2..</p>\n  \n  <p>:)</p>\n</blockquote>\n"},{"tags":["c#","sql","sql-server-2008","jquery-ajax"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2231,"score":1,"question_id":2653883,"title":"Easy way to convert data table to hash table or sqldatareader to hashtable","body":"<p>Please tell me if there's an easy way to convert a <code>DataTable</code> to a <code>HashTable</code> or a <code>SQLDataReader</code> to a <code>HashTable</code>. I have to parse it through javascriptserializer. the code i m using, having some problem. please take a look and guide me.</p>\n\n<pre><code>try\n{\n    using (SqlConnection conn = new SqlConnection(ConnectionString))\n    {\n        using (SqlCommand cmd = new SqlCommand(query, conn))\n        {\n            conn.Open();\n            SqlDataReader dr = cmd.ExecuteReader(CommandBehavior.CloseConnection);\n            dt.Load(dr);\n        }\n    }\n\n    Hashtable sendData = new Hashtable();\n\n    foreach (DataRow drIn in dt.Rows)\n    {\n\n        sendData.Add(drIn[\"orderNumber\"].ToString(), drIn[\"customerName\"].ToString());\n\n    }\n\n    sendData.Add(\"orderNum\", order);\n    JavaScriptSerializer jss = new JavaScriptSerializer();\n    string output = jss.Serialize(sendData);\n    return output;\n}\ncatch (Exception ex)\n{\n    return ex.Message + \"-\" + ex.StackTrace;\n}\n</code></pre>\n\n<p>It's giving a correct result when queried from one table in the database but from another table it's having a problem. Is there any other way to do this? </p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":13173372,"title":"How to select one record at a time without using cursor?","body":"<p>I have two tables in SQL SERVER.</p>\n\n<p>DBO.VitalPatientDetails=></p>\n\n<p>| PatientDetailsId | PatientId | PatientName | UnitName | BedName | PatientDOB | LastAlarmReceivedAt |</p>\n\n<p>DBO.VitalAlarmDetails=></p>\n\n<p>| Id | PatientDetailsId (Refers VitalPatientDetails.PatientDetailsId) | VitalGenerationTime | FileName | </p>\n\n<p>I need to retrive all fields of DBO.VitalAlarmDetails grouped by PatientDetailsId ordered by VitalGenerationTime in ascending order.\nI have written cursor for this as below and it is returning multiple result sets. I need to get it in single set without using cursor. I just want to know whether I can do this without cursor.</p>\n\n<pre><code>DECLARE @PatientDetailsId BIGINT\nDECLARE @getAlarmDetails CURSOR\n\nSET @getAlarmDetails = CURSOR FOR SELECT PatientDetailsId FROM VitalPatientDetails\n\nOPEN @getAlarmDetails\n    FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        SELECT * FROM VitalAlarmDetails\n        WHERE PatientDetailsId = @PatientDetailsId\n        ORDER BY VitalGenerationTime ASC\n\n        FETCH NEXT FROM @getAlarmDetails INTO @PatientDetailsId\n    END\nCLOSE @getAlarmDetails\nDEALLOCATE @getAlarmDetails\n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2008","email","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":3807,"score":3,"question_id":1780486,"title":"Can a SQL Server Trigger send me an email?","body":"<p>I wish to send an email from a <code>Trigger</code>, on my SQL Server 2008 machine. The data of the email will be, basically, some of the Trigger information.</p>\n\n<p>Can someone provide some simple/sample code on how to do this, please? E.g. what's the system stored procedure called? Etc.</p>\n\n<p>I've not set up any SQL mail and stuff, so I'm guessing it's built in and I can leverage that. But just to be sure: do I need to install any extra software on the server?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-management-studio"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13175025,"title":"Closing Management Studio Query - Sleeping Process","body":"<p>When I close a query (after running it) in Management Studio SQL2008 R2, the processes remain as \"sleeping\", \"AWAITING COMMAND\". I have to manually kill them to get exclusive access. This is on my dev machine. Any idea why closing the window isn't closing the connection?</p>\n"},{"tags":["sql-server-2008","entity-framework","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13174809,"title":"how do I select from stored procedure","body":"<p>I am trying to work with EF, for the first time ever. I'm not sure I fully understand EF yet.</p>\n\n<p>I already have a database with data in it, so I've generated my models from DB.\nOur current setup runs EVERYTHING through stored procedures, even selects.\nHowever, unless I'm mistaking, the models select directly into the tables, when I have generated them.</p>\n\n<p>Can I change this behaviour, so it calls the select procedure instead?</p>\n"},{"tags":["sql","sql-server-2008","join","subquery","one-to-many"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":69,"score":1,"question_id":13138885,"title":"sql subquery and join on one to many table","body":"<p>This one is causing me too much head scratching!  Basically, I need to show a list of locations, the current item that is stored there and the person who owns it.  I have created 4 tables and have these populated with data.</p>\n\n<p>Setup: MSSQL 2008</p>\n\n<p>What I am looking for is the \"Top(1)\" from tbl_locationHistory for the item and owner as there can only ever be one item or one owner at any one time at each location. Bear in mind that tbl_locationHistory could have multiple bits of data, I just need to pull back the latest ID for each one (e.g. the highest ownerID, the highest itemID thats currently available from the history table).</p>\n\n<h2>tbl_location</h2>\n\n<p>locID\nlocName</p>\n\n<h2>tbl_item</h2>\n\n<p>itemID\nitemName</p>\n\n<h2>tbl_owner</h2>\n\n<p>ownerID\nownerName</p>\n\n<h2>tbl_locationHistory</h2>\n\n<p>locHistID\nlocID\nitemID\nownerID\ndateModified</p>\n\n<p>I tried joining all of these tables together with joins. However I realised that wouldn't work as I wasn't pulling back the top ID for either \"owners\" or \"items\" and therefore the data being displayed would be inaccurate.  </p>\n\n<p>One things I have thought is that I should break up the history table into two parts: 1 x owner to location and 1 x item to location - however I am at my limit of SQL right now so could do with some pointers in the right direction as not sure which way to go with this.</p>\n\n<p>Therefore I would need assistance even if I have to break up the history table.</p>\n\n<p><strong>UPDATED 01/11/12</strong></p>\n\n<p>OK, I am going to paste some code in here.</p>\n\n<p>I am an old school Classic ASP coder.....havent needed to move on yet!  I am using classic asp and MSSQL to create this application. I am also using dreamweaver and therefore want the query to be placed in that so I can use the \"bindings\" function in DW CS6.</p>\n\n<p>Here was my original query:</p>\n\n<pre><code>SELECT DISTINCT p.pID, p.cliID, p.pNo, p.pName, p.dtCommissioned,     \np.description, ps.plotStatus, pt.plotType, o.oSalutation, o.oFname, o.oSname, man.manName, \nmod.model, sl.width, sl.length, sl.yr\nFROM history AS ph INNER JOIN owners AS o ON ph.ownerID   \n= o.ownerID INNER JOIN StockList AS sl ON ph.stockID = sl.stkID   \nINNER JOIN manufacturers AS man ON sl.make = man.manID \nINNER JOIN models AS mod ON sl.model = mod.cID FULL OUTER   \nJOIN plotType AS pt RIGHT OUTER JOIN                       \nplots AS p ON pt.plotTypeID = p.plotType LEFT OUTER JOIN                       \nplotStatus AS ps ON p.pStatus = ps.plotStatusID ON ph.plotID = p.pID\nWHERE (p.cliID = value)\nORDER BY p.pNo\n</code></pre>\n\n<p>Now, when I realised that I wasn't looking in the history table correctly for the highest HistoryID for the \"stockID\" and also the highest plotHistoryID for \"ownerID\" I started looking at how I could perform a \"subquery\" for each ID......this is where I have become stuck.</p>\n\n<p>I have tried  something along the lines of:</p>\n\n<pre><code>Select p.pID, p.cliID, p.pNo, p.pName, p.dtCommissioned,     \np.description, ps.plotStatus, pt.plotType, o.oSalutation, o.oFname, o.oSname, man.manName, \nmod.model, sl.width, sl.length, sl.yr\n(Select top 1 ph.plotHistoryID, ownerID\nFROM History AS ph\norder by ph.plotHistoryID desc)\nTHEN JOINING ETC\nTHEN DO ANOTHER SUBQUERY FOR THE OWNER ETC\n</code></pre>\n\n<p>However I couldn't get that to work, but I am now beyond my level of SQL in relation to Sub Queries and JOINS.</p>\n\n<p>The Output display will be:</p>\n\n<p>Plot No  |  Plot Name  |  plot type  |  Plot status  |  Current Owner  |  Current Stock</p>\n\n<p>Each of the Plot No's/Names/Type/Status will be populated with data as I need to show them. If the owner\\current stock is blank I have an IF statement saying \"no owner\" or \"no stock found\".  </p>\n\n<p>The user will then be able to then click on a \"view\" link at the end of the row and view details of the plot/location and will pass the pID to the next page via QueryString.</p>\n\n<p>Does this help?  I am getting a little desparate now! LOL</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13173615,"title":"Normalizing values in SQL query","body":"<p>I have an data table I wish to perform some numeric analysis on for that I need all the values to be in the same range. 0..1.</p>\n\n<p>I have a somewhat slow and longhanded way of accomplishing this but would like a more straigt forward performant solution to my problem</p>\n\n<p>What I need to do is:</p>\n\n<p>group by projectid\nwith in each project take the average of each of the values and divide by the largest average for the entire set.</p>\n\n<p>currently I have</p>\n\n<pre><code>select avg(foo * 1.0)/ (Select MAX(IL) FROM (select avg(foo * 1.0) as IL from table group by     \n                                             ProjectID) tbl)\nfrom table\n</code></pre>\n\n<p>so if the list is</p>\n\n<pre><code>projectid  | foo\n-----------------\n1          | 1\n1          | 2\n2          | 4\n2          | 2\n</code></pre>\n\n<p>the largest average is 3 and the result should therefor be</p>\n\n<p>0.5,1</p>\n\n<p>where the first is the average for projectId 1 divided by 3 and the second is the average for projectId 2 divided by 3</p>\n"},{"tags":["sql-server","sql-server-2008","unique-constraint"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":13173787,"title":"SQL Server : Unique constraint to verify that data does not exist in another table","body":"<p>Given that I have a table structure where I have a parent that can have \"Roles\" and that parent have children that can have the same \"Roles\", how can I create a constraint on the child table that verifies that the parent does not have the Role that is about to be inserted?</p>\n\n<p>Like this:</p>\n\n<pre><code>Parent\n |\n \\- ParentRoles\n |\n \\- Child\n    |\n    \\- ChildRoles\n</code></pre>\n\n<p>I want the union of the Child and Parent roles to be a list of unique roles (no duplicates).</p>\n\n<p>I have checked <a href=\"http://stackoverflow.com/questions/3200795/sql-server-check-constraint-on-a-column-where-values-come-from-another-table\">Constraint by UserFunction</a> (not recommended but would work) and tried creating a view with an unique index but ran into trouble because I have to use Union in the view and then I cannot index it.</p>\n\n<p>An answer on the <a href=\"http://stackoverflow.com/questions/3200795/sql-server-check-constraint-on-a-column-where-values-come-from-another-table\">Constraint by UserFunction</a> question suggests using Foreign Keys but I do not understand how I could make that work given my table structure.</p>\n"},{"tags":["sql-server-2008","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":13132124,"title":"SQL Server 2008 Full text Search Performance Issue","body":"<p>I recently upgraded from a Win 2003 / SQL Server 2000 (HP ML350 G4p - Dual Xeon with 2GB RAM) to new hardware (IBM x3200 M3 - Single Xeon QC X3450 2.66GHz 10GB RAM) running Win 2008 R2 / SQL Server 2008. We run a classic ASP website and use Full Text Search to enable customers to search our product descriptions.</p>\n\n<p>The search is performed by a stored procedure which builds up a dynamic query to run the search using the <code>contains</code> predicate.  </p>\n\n<p>I have an intermittent problem in that some searches are extremely slow. Sometimes taking over a minute to complete. At other times they will complete in less than a second. Didn't have this problem on the old server at all. </p>\n\n<p>I have replicated this problem by running the stored procedure from the SSMS, and again, this can sometimes take an extremely long time.  </p>\n\n<p>I suspect the new Full Text Search system within SQL Server 2008, but I'm not sure how to pinpoint the issue. When the timeouts are occurring, there doesn't seem to be a big load on the server cpu.  I don't know where else to look. Relatively new to SQL Server 2008.</p>\n\n<p>Change Tracking on the Index if set to Off, and I'm running a job to incrementally update the index each day, as well as optimizing the catalog each day.</p>\n\n<p>Searching around on Google, this seems to be reasonably common a problem, but I haven't found a definitive answer to it yet.  Can someone point me in the right direction?</p>\n\n<p>Thanks in Advance,\nMike.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":48,"score":1,"question_id":13171931,"title":"family tree sql query","body":"<p>I am working on Family tree application in asp.net with sql server 2008.</p>\n\n<p>My main table is like this:-</p>\n\n<pre><code>ID int PK\nName Varchar(50)\nMotherID int\nFatherID int\n\nID  MotherID FatherID   Name\n\n1   NULL    NULL    My Grand Father\n\n2   NULL    NULL    My Grand Mother\n\n3   someid  someid  My Mother\n\n4   2   1   My Father\n\n5   3   4   Me\n\n6   someid  someid  My wife\n\n7   3   4   My Brother\n\n8   6   5   My son.\n</code></pre>\n\n<p>I am looking for output like this</p>\n\n<pre><code>ID  MotherID    FatherID    Name        Level\n\n1   someid  someid  grandfather 0\n\n\n2   someid  someid  Father      1\n\n3   someid  someid  Me      2\n\n\n4   someid  someid  Brother     2\n\n5   someid  someid  My Son      3\n</code></pre>\n\n<p>Thanks in advance.\nKashmir.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":179,"score":2,"question_id":11225491,"title":"Select one row from multiple row in sql depands on condition","body":"<p>I have a table in sql 2008 named tblEmployeeAttendance like \n<img src=\"http://i.stack.imgur.com/cw9SU.jpg\" alt=\"enter image description here\"></p>\n\n<p>Here is some dummy data for a employee's one days attendance like</p>\n\n<p><img src=\"http://i.stack.imgur.com/P6puo.jpg\" alt=\"enter image description here\"></p>\n\n<p>Here AI refers AttendanceIn,AO refers AttendanceOut,BO refers BreakIn and BI refers BreakOut.There can multiple row in a day for a employee.First row should be AI,last row should be AO and others rows will be BreakIn,BreakOut Sequentially(that means BreakIn-BreakOut-BreakIn.....).</p>\n\n<p>My expected output would be like this</p>\n\n<p><img src=\"http://i.stack.imgur.com/SfrKP.jpg\" alt=\"enter image description here\"></p>\n\n<p>I need a sql query that will return one row per date and return data that must contain AttendanceIn and AttendanceOut Time depands on strRemark(AI &amp; AO). Please help me.</p>\n"},{"tags":["c#","sql-server-2008","datetime","datepicker"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13169709,"title":"how to insert a datepicker datetime value into sql database","body":"<p>My SQL Server 2008 database has a table with a column of datatype <code>datetime</code>.</p>\n\n<p>When I try to insert values into the <code>datetime</code> column I am getting error.</p>\n\n<blockquote>\n  <p><em>Incorrect syntax near '-'</em></p>\n</blockquote>\n\n<p>My datetime picker has custom format <code>yyyy-MM-dd</code> e.g (2012-11-01)</p>\n\n<p>Following is the code sample I used to insert <code>datetime</code>.</p>\n\n<pre><code> System.DateTime myDate = default(System.DateTime);\n myDate = DateTimePickerPrint.Value;\n string query = string.Format(\"EXEC Save_Quotation_Bookshop '\" + txt_QutationNo.Text + \"','\" + txt_CusCode.Text + \"',#\" + myDate + \"#,\");\n</code></pre>\n\n<p>Please any one have an idea ?</p>\n"},{"tags":[".net","sql-server-2008","full-text-search"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":16,"score":-1,"question_id":13170778,"title":"Full Text Search SQL Server 2008","body":"<p>I am trying to design a search engine for a website using Visual Studio 2008 and SQL Server 2008. </p>\n\n<p>I have created two full text indexed tables <code>dbo.keyword</code> with columns <code>url</code>, <code>keyword</code> and <code>dbo.urlDetail</code> with columns <code>url</code>, <code>title</code>, <code>metatag</code>, <code>pagetext</code>.</p>\n\n<p>Plz. help me to design search feature from Textbox where users search for any data from from that website.</p>\n"},{"tags":["sql-server-2008","master-detail","cascading-deletes"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13158100,"title":"How do I delete the master record automatically when all detail records are deleted in SQL Server 2008?","body":"<p>Say I have two tables.  <code>Errors</code> and <code>ErrorsDetails</code>.  So I have one Errors record that could contain many ErrorDetails records.</p>\n\n<p>The users will periodically delete the detail records through an application they use.  When all detail records are cleaned up (deleted), I would like to automatically delete the master record too.</p>\n\n<p>What would be cool would be one SQL delete statement that would delete the details and the master if no more details are owned by the master.  But I can't seem to get a clean SQL statement that does that.   I'd rather not poll the master for details after every delete.</p>\n\n<p><strong>Errors</strong></p>\n\n<pre><code>ID        Error\n1         Import Error\n2         Export Error\n</code></pre>\n\n<p><strong>ErrorsDetails</strong></p>\n\n<pre><code>ID        ErrorsID        DetailedInfo\n1         1               Couldn't import file because of FTP error\n2         1               Couldn't import file because of permission error\n3         2               Couldn't export file because of directory doesn't exist\n</code></pre>\n\n<p>I've tried adding a <code>cascade</code> delete constraint like so but it didn't seem to work.</p>\n\n<pre><code>alter table dbo.ErrorsDetails\n    add constraint FK_Delete_Master\n        foreign key (ErrorsID) references dbo.Errors(ErrorsID) on delete cascade\n</code></pre>\n\n<p>Thanks for any suggestions.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>It's been mentioned to use triggers.  I thought about that but didn't mention it.  A trigger would certainly do the job.  Pros/Cons of triggers for this scenario?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13170371,"title":"Easier way to compare a DATE field to the date value of GETDATE?","body":"<p>I have a field in a table <code>Event.EventDate</code> and it's of the data type <code>DATE</code> rather than <code>DATETIME</code> and then I have a view that has the following <code>WHERE</code> clause:</p>\n\n<pre><code>WHERE e.EventDate &gt;= CAST(CONVERT(VARCHAR(MAX), GETDATE(), 101) AS DATETIME)\n</code></pre>\n\n<p>As you can see, I'm just trying to get all events <code>&gt;=</code> today's <strong>date</strong>. The above code works, but it's ugly. I tried this ...</p>\n\n<pre><code>WHERE e.EventDate &gt;= CONVERT(VARCHAR(MAX), GETDATE(), 101)\n</code></pre>\n\n<p>... and this ...</p>\n\n<pre><code>WHERE e.EventDate &gt;= CONVERT(DATETIME, GETDATE(), 101)\n</code></pre>\n\n<p>... but those didn't work, they gave me every event <code>&gt;</code> today's <strong>date</strong>. However, even if the above worked, it's still ugly.</p>\n\n<p>Isn't there a better way?</p>\n"},{"tags":["sql-server","sql-server-2008","windowsdomainaccount"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":4580,"score":1,"question_id":4268100,"title":"How to find loginname, database username, or roles of sqlserver domain user who doesn't have their own login?","body":"<p>I have created a login and database user called \"MYDOMAIN\\Domain Users\". I need to find what roles a logged on domain user has but all the calls to get the current user return the domain username eg. \"MYDOMAIN\\username\" not the database username eg. \"MYDOMAIN\\Domain Users\".</p>\n\n<p>For example, this query returns \"MYDOMAIN\\username\"</p>\n\n<pre><code>select original_login(),suser_name(), suser_sname(), system_user, session_user,  current_user, user_name()\n</code></pre>\n\n<p>And this query returns 0</p>\n\n<pre><code>select USER_ID()\n</code></pre>\n\n<p>I want the username to query database_role_members is there any fuction that will return it or any other way I can get the current users roles?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005","login"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":62,"score":1,"question_id":13168175,"title":"SQL Script to Create Auto-Expiring Login","body":"<p>How can I script the creation of a new SQL Login (whether by Windows\nAuthentication or with SQL password) and have it automatically expire after some\ntime, e.g. 8 hours, 24 hours</p>\n\n<p>I've tried searching here in stackoverflow but I haven't found a solution. If you guys know of one that exists here, please let me know too. Thank you.</p>\n\n<p>I am using SQL Server 2005 and 2008</p>\n"},{"tags":["sql","sql-server-2008","tcp","remote-server"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13161247,"title":"Remote connection to SQL server 2008 sp2","body":"<p>I built a window application in visual studio 2010. It is working fine at my computer. when I trying to run from another computer it gives me an \nError: \n    A network-related or instance-specific error occurred while establishing a connection to     SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. </p>\n\n<p>here some information : \ncomputer ip: 192.168.0.25\nDNS - 192.168.0.12\ninstance - SQLEXPRESS</p>\n\n<p>Connection string : String = \"Data Source=192.168.0.12\\SQLEXPRESS;Initial Catalog=fleetInfo;User ID=user; Password=user123;\"</p>\n\n<p>Im running SQL Server Management Studio 2008 SP2. I checked sql server configuration Manager. Everything is fine.\nIn configuration Manager> protocols for SQLEXPRESS > TCP/IP:\nIP1 \nIP address: 192.168.20.100\nPort : null\nIP ALL\nDynamic port : 1408\nTCP port: null</p>\n\n<p>I'm wondering what is wrong Im doing here.</p>\n\n<p>Thanks guys.</p>\n"},{"tags":["sql-server-2008","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":11934922,"title":"Getting snippets of text searched using FTS in SQL Server","body":"<p>We store one page of text in each sql record as a single NVARCHAR(MAX) column. This column is full text indexed by SQL 2008. We use FREETEXTTABLE to query the full text index to locate documents containing a given keyword or phrase. The end user wants to see a small text snippet for each hit returned by FREETEXTTABLE in grid form. Ideally, this snippet would be the text representing the searched for keyword/phrase along with the word immediately to the left and right of the hit so as to provide context within the larger document text. \nThis is not an out of box feature.</p>\n\n<p>How to do this in SQL Server ??</p>\n\n<p>Thank you, \nMarcus</p>\n"},{"tags":["sql-server-2008","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12119740,"title":"How to find out where the search keyword is found in full-text search","body":"<p>Consider this</p>\n\n<pre><code>SELECT  * \nFROM Publication a          \nINNER JOIN  CONTAINSTABLE(Publication, (Title, Keywords), \n@TitlePartial)TitleSearchPartial ON  a.Id = TitleSearchPartial.[Key]\n</code></pre>\n\n<p>I am searching in (<code>Title</code> and <code>Keyword</code>) columns of the <code>Publication</code> table .\nThe search key word can be found anywhere in 'Title' or 'Keyword'\nHow to find which column the search keyword has been found in? Is there a out-of-box way to do this?</p>\n\n<p>Any ideas...</p>\n"},{"tags":["sql-server-2008","entity-framework","sql-server-express"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13168166,"title":"\"The underlying provider failed on Open\" Entity Framework error","body":"<p>I've been getting the error \"The underlying provider failed on Open.\" recently and I've been pulling my hair out trying to figure out why.  On closer inspection of the error the inner exception is \"The connection was not closed. The connection's current state is connecting.\" and the stack trace is </p>\n\n<pre><code>\"at System.Data.ProviderBase.DbConnectionClosedConnecting.TryOpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)\n   at System.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry)\n   at System.Data.SqlClient.SqlConnection.Open()\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\"\n</code></pre>\n\n<p>As far as I can tell the error seems to happen at random or possibly when making changes to the application.  Any help would be greatly appreciated.</p>\n\n<p>My current setup is</p>\n\n<ul>\n<li>IIS Express</li>\n<li>Microsoft SQL Server Express Edition</li>\n<li>Visual Studio 2012</li>\n<li>MVC Web API \\ Asp.net MVC 4</li>\n<li>Entity Framework 5</li>\n</ul>\n\n<p>My data layer is modeled off the Repository pattern and injected via Structure map.</p>\n\n<p><strong>Repository</strong></p>\n\n<pre><code>public class Repository&lt;T&gt; : IDisposable, IRepository&lt;T&gt; where T : class\n{\n    private readonly DbSet&lt;T&gt; _dbSet;\n    private readonly DbContext _dbContext;\n\n    public Repository(IDbContextFactory&lt;MyContext&gt; dbContextFactory)\n    {\n        _dbContext = dbContextFactory.Create();\n        _dbSet = _dbContext.Set&lt;T&gt;();\n    }\n\n    //removed for brevitity\n\n    public void Dispose()\n    {\n        _dbContext.Dispose();\n    }\n</code></pre>\n\n<p><strong>DbContextFactory</strong></p>\n\n<pre><code>public class MyContextFactor : IDbContextFactory&lt;MyContext&gt;, IDisposable\n{\n    private MyContext _dataContext;\n\n    public MyContextFactor Create()\n    {\n        return _dataContext ?? (_dataContext = new MyContext());\n    }\n\n    public void Dispose()\n    {\n        _dataContext.Dispose();\n    }\n}\n</code></pre>\n\n<p><strong>Structure Map Registry for IOC</strong></p>\n\n<pre><code>For(typeof(IDbContextFactory&lt;MyContext&gt;)).HybridHttpOrThreadLocalScoped().Use(typeof(MyContextFactory));\n</code></pre>\n\n<p><strong>Connection String</strong></p>\n\n<pre><code>&lt;add name=\"MyContextConnectionString\" connectionString=\"metadata=res://*/Model.MyProject.csdl|res://*/Model.MyProject.ssdl|res://*/Model.MyProject.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=(local);initial catalog=MyDB;User Id=SQLUser;Password=****;MultipleActiveResultSets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\"/&gt;\n</code></pre>\n\n<p>Things I've attempted to fix the problem and so far haven't worked</p>\n\n<ul>\n<li>ensure context is per http context via structure map scope</li>\n<li>added dispose to repository</li>\n<li>added dispose to ContextFactory</li>\n<li>switched from Intergrated Sql auth to Sql authentication</li>\n</ul>\n"},{"tags":["sql","sql-server-2008","merge-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":96,"score":5,"question_id":13009812,"title":"Inserts in Merge Replication database are insanely slow","body":"<p>I have a SQL server that is setup with merge replication to 800 mobile clients running SQL CE.</p>\n\n<p>The server has enough resources and the lines in and out of the company are more than adequate, the replication between clients and the server is generally good but we are getting an intermittent error that I just cannot track down.</p>\n\n<p>Yesterday we needed to insert 550 records into one of our main tables, the only triggers that exist are the standard merge replication ones.</p>\n\n<p>This insert took 14 hours due to it continually getting deadlocked with mobile devices trying to synch.</p>\n\n<p>Does anyone have any advice on how we can avoid locks on inserts and how to speed up the entire process?</p>\n\n<p>------ Update -----</p>\n\n<p>Following on from some comments I've run a profiler over a single insert and I'm seeing a lot of this sort of thing</p>\n\n<pre><code>insert into dbo.MSmerge_current_partition_mappings with (rowlock) (publication_number, tablenick, rowguid, partition_id)\n            select distinct 1, mc.tablenick, mc.rowguid, v.partition_id\n            from dbo.MSmerge_contents mc with (rowlock) \n            JOIN dbo.[MSmerge_JEMProjectME_PromotionResource_PARTITION_VIEW] v with (rowlock) \n            ON mc.tablenick = 286358001\n            and mc.rowguid = v.[rowguid]\n            and mc.marker = @child_marker \n            and v.partition_id in (select partition_id from dbo.MSmerge_current_partition_mappings cpm with (rowlock) JOIN\n                dbo.MSmerge_contents mc2 with (rowlock)\n                ON cpm.rowguid = mc2.rowguid\n                and mc2.marker = @marker)\n            where not exists (select * from MSmerge_current_partition_mappings with (readcommitted, rowlock, readpast) where \n                publication_number = 1 and \n                tablenick = 286358001 and\n                rowguid = v.[rowguid] and\n                partition_id = v.partition_id)\n</code></pre>\n\n<p>For many tables that I'm not meant to be inserting into... could this be a clue?</p>\n"},{"tags":["sql","tsql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":557,"score":2,"question_id":5711518,"title":"how to get the max size used by a field in table","body":"<p>I have a field which has been set to max size. How can i find the max size occupied by the field.</p>\n\n<p>For example if the records are for table TableA</p>\n\n<pre><code>FieldA\n\n123\nabcd\n1234567\n</code></pre>\n\n<p>I need to know which row occupied the most size and what the size is</p>\n\n<p>Thanks</p>\n\n<p>Prady</p>\n"},{"tags":["sql","database","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13167182,"title":"How can you define a computed column like this?","body":"<p>I have an <code>Equipment</code> table in SQL Server 2008 like this:</p>\n\n<pre><code>CREATE TABLE [dbo].[Equipment](\n[EquipmentID] [nchar](10) NOT NULL,\n[EquipmentName] [nchar](50) NOT NULL,\n[ProducedDate] [date] NOT NULL,\n[WarrantyPeriod] [int] NOT NULL,\n[SerialNumber] [nchar](20) NOT NULL,\n[BrandID] [tinyint] NOT NULL,\nCONSTRAINT [PK_Equipment] PRIMARY KEY CLUSTERED \n)\n</code></pre>\n\n<p>I want to have a computed column <code>WarrantyStatus</code> that will return either <code>Unexpired</code> or <code>Expired</code> when calculating, based on columns <code>ProducedDate</code> and <code>WarrantyPeriod</code>. </p>\n\n<p>This is wrong, but it's what I want:</p>\n\n<pre><code>ALTER TABLE [dbo].[Equipment]\nADD [WarrantyStatus] AS IIF(DATEDIFF(MONTH, [ProducedDate], GETDATE()) &lt; [WarrantyPeriod], \"Unexpired\", \"Expired\")\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13156038,"title":"Speed up dividing date intervals by minutes in Sql Server","body":"<p>I need to divide some date intervals by minutes. (For example, 2012-01-01 10:00 - 2012-01-01 10:00 interval should be divided into 2012-01-01 10:01, 2012-01-01 10:02, ... 2012-01-01 10:10).\nFor example, there is a table</p>\n\n<pre><code>CREATE TABLE [dbo].[Events](\n    [ID] [int] IDENTITY(1,1) NOT NULL,\n    [EventStart] [datetime] NOT NULL,\n    [EventEnd] [datetime] NOT NULL,\n    [Amount] [float] NOT NULL,\n CONSTRAINT [PK_Events] PRIMARY KEY CLUSTERED \n(\n    [ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\n\nGO\n</code></pre>\n\n<p>This table is filled like</p>\n\n<pre><code>DECLARE @i integer = 0;\nDECLARE @initial_date datetime = '2012-01-01';\n\nWHILE @i &lt; 50000\nBEGIN\n    INSERT INTO [Events] (EventStart, EventEnd, Amount) VALUES (DATEADD(MINUTE, 10*@i, @initial_date), DATEADD(MINUTE, 10*(@i + 1), @initial_date), @i);\n    SET @i = @i + 1;\nEND\n</code></pre>\n\n<p>As a result we have many 10 minutes intervals.</p>\n\n<p>To divide it by minutes I use the following recursive CTE:</p>\n\n<pre><code>DECLARE @start_date datetime = '2012-01-01';\nDECLARE @end_date datetime = '2013-01-02';\n\n\nWITH Date_Ranges (StatDate, Amount, IntervalStart, CurrentMinute) AS (\n  SELECT \n    DATEADD(MINUTE, 0,  ev.EventStart) AS StatDate, ev.Amount, ev.EventStart AS IntervalStart, 1 AS CurrentMinute\n  FROM [Events] ev\n  WHERE ev.EventStart BETWEEN @start_date AND @end_date\n  UNION ALL\n  SELECT \n    DATEADD(MINUTE, CurrentMinute, ev.EventStart), ev.Amount, ev.EventStart AS IntervalStart, CurrentMinute + 1\n  FROM [Events] ev\n  INNER JOIN Date_Ranges ranges ON (ranges.IntervalStart = ev.EventStart AND \n    ranges.StatDate &gt;= ev.EventStart AND \n    ranges.StatDate &lt; ev.EventEnd)\n    WHERE DATEADD(MINUTE, CurrentMinute, ev.EventStart) BETWEEN @start_date AND @end_date AND\n        ev.EventStart BETWEEN @start_date AND @end_date\n) \n\nSELECT *\nFROM Date_Ranges --ORDER BY StatDate\n</code></pre>\n\n<p>The main problem is too slow execution of this recursive CTE on a large data amount.</p>\n\n<p>So, how can I speed up this?</p>\n"},{"tags":["sql-server-2008","insert","identity"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13147227,"title":"Should I use IDENT_CURRENT, @@IDENTITY, or SCOPE_IDENTITY?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1920558/what-is-the-difference-between-scope-identity-identity-identity-and-ide\">What is the difference between Scope_Identity(), Identity(), @@Identity, and Ident_Current?</a>  </p>\n</blockquote>\n\n\n\n<p>I have an INSERT statement that I'm running through Dapper, and I want to append to the INSERT statement so that I can get the identity value inserted and set it on the model. So, let's assume the following INSERT statement.</p>\n\n<pre><code>INSERT INTO Foo (Bar, Comments) VALUES ('Some Bar', 'Some Comments');\n    SELECT @@IDENTITY\n</code></pre>\n\n<p>I then plan to run that through the <code>Query</code> extension in Dapper. However, which one of the three options available in SQL should I use here?</p>\n\n<p>Just and FYI, it <em>seems</em> to me I should use SCOPE_IDENTITY, but I wanted to make sure and also understand <strong><em>why</em></strong> I should use one over the other.</p>\n"},{"tags":["sql-server","sql-server-2008","matlab"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":4383,"score":1,"question_id":6593485,"title":"How to connect to Microsoft SQL Server 2008 (MSSQL) from Matlab?","body":"<p>This is probably a simple question:</p>\n\n<ul>\n<li>How do I connect to Microsoft SQL Server 2008 R2 from Matlab?</li>\n<li>How do I read a table into a matrix given some SQL query?</li>\n</ul>\n\n<p><strong>Update</strong></p>\n\n<p>I'd prefer a method that doesn't require use of manual setup using ODBC.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","cdc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13162619,"title":"Unable to restart CDC after making table changes","body":"<p>I need to add a couple of columns to CDC for a table that is already being tracked. My approach is as follows:</p>\n\n<pre><code>EXEC sys.sp_cdc_drop_job 'capture'\n\nBEGIN TRANSACTION\n\nBEGIN TRY\n    -- Copy existing data of the tracked table into a temporary table\n    SELECT * INTO CDC.dbo_MyTable_Temp FROM CDC.dbo_MyTable_CT\n\n    -- Add the new column to the temp table. This allows us to just use INSERT..SELECT * later\n    ALTER TABLE CDC.dbo_MyTable_Temp ADD MyColumn INT NULL\n\n    -- Disable CDC for the source table temporarily. This will drop the CDC table\n    EXEC sys.sp_cdc_disable_table @source_schema = 'dbo', @source_name = 'MyTable', @capture_instance = 'dbo_MyTable'\n\n    -- Reenable CDC for the source table. This will recreate the table with the new columns\n    EXEC sys.sp_cdc_enable_table @source_schema = 'dbo', @source_name = 'MyTable', @capture_instance = 'dbo_MyTable', @supports_net_changes = 1, @role_name = NULL, @filegroup_name = 'CDCGROUP'\n\n    -- Insert the old values into the CDC table\n    INSERT INTO cdc.dbo_MyTable_CT SELECT * FROM cdc.dbo_MyTable_Temp\n\n    -- Correct the start_lsn in CDC.change_tables. Otherwise all of the CDC stored procedures will be confused\n    -- and although the old data will exist in the table the functions won't return it\n    UPDATE cdc.change_tables SET start_lsn = (SELECT MIN(__$start_lsn) FROM cdc.dbo_MyTable_Temp) WHERE capture_instance = 'dbo_MyTable'\n\n    -- Drop the temp table\n    DROP TABLE cdc.dbo_MyTable_Temp\n\n    COMMIT TRANSACTION\nEND TRY\nBEGIN CATCH\n    ROLLBACK TRANSACTION\n    RAISERROR('Error!', 16, 1)\nEND CATCH\n\nEXEC sys.sp_cdc_add_job 'capture'\n</code></pre>\n\n<p>However, when the job runs again after being re-added it generates an error that there is a violation of the primary key constraint on <code>CDC.lsn_time_mapping</code>.</p>\n\n<p>Any suggestions?</p>\n\n<p>Thanks!</p>\n"},{"tags":[".net","sql-server-2008","reportbuilder3.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13165781,"title":"Can Report Builder 3.0 work if only .NET Framework 4 Client Profile is installed on Windows 7 client PC?","body":"<p>This <a href=\"http://www.microsoft.com/en-us/download/details.aspx?id=6116\" rel=\"nofollow\">page</a> mentions that Report Builder 3.0 system requirements need component Microsoft .NET Framework 3.5 SP1.</p>\n\n<p>Our users don't have the .net 3.5 framework nor the corresponding SP1 installed on their Windows 7s. I have the .NET Framework 4 (Client Profile as well as Extended) installed on my Windows 7.</p>\n\n<p>I'd like to know (or someone can point out) if only having the Framework 4 Client Profile would be enough for our users to create reports in Report Builder 3.0 and be able to connect to our SQL Server 2008 R2.</p>\n"},{"tags":["asp.net","sql","sql-server-2008","c#-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":12526117,"title":"Error showing up Fill: SelectCommand.Connection property has not been initialized","body":"<pre><code>  DataSet ds = new DataSet();\n\n    SqlDataAdapter cmd = new SqlDataAdapter(\"Select * FROM event\", con);\n    cmd.Fill(ds, \"Table\");\n</code></pre>\n\n<p>Getting the same error again and again tried everything</p>\n\n<p>please help</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":48,"score":-2,"question_id":13163955,"title":"Find row which has unique values with respect to some of its columns","body":"<p>My SQL table is something like this:</p>\n\n<pre><code>id, name, value1, value2, value3, value4\n1, xyz, 1, 2, 4, 1\n2, xyz, 4, 2, 4, 1\n3, abc, 4, 2, 4, 1\n4, abc, 4, 2, 2, 1\n5, abc, 4, 2, 2, 1\n</code></pre>\n\n<p>I want to write a Sql query which returns rows which has <strong>any</strong> of their values (read: value1,value2,value3,value4) changed. So the result output would be:</p>\n\n<pre><code>id, name, value1, value2, value3, value4\n1, xyz, 1, 2, 4, 1\n2, xyz, 4, 2, 4, 1\n4, abc, 4, 2, 2, 1\n</code></pre>\n\n<p>I understand, if I just needed values in output I could have used Distinct or Group by like:</p>\n\n<pre><code>select distinct value1,value2,value3,value4 from table;\n</code></pre>\n\n<p>But, here I need id and name columns too in output.</p>\n\n<p>Wondering if I really need to write a subquery or create virtual/inner table to get my result. Or, there is a smarter way?</p>\n\n<p>My question is not similar to <a href=\"http://stackoverflow.com/questions/6941049/how-to-find-out-whether-a-table-has-some-unique-columns\">How to find out whether a table has some unique columns</a>. Let me know if you think otherwise, I can clarify.</p>\n"},{"tags":["sql-server-2008","crystal-reports","sql-server-2008-r2","crystal-reports-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13164231,"title":"cannot connect the report to the stored proc","body":"<p>I have one stored procedure. It is using one table valued function. When I try to point the crystal report to this stored proc, it  is giving me following error:</p>\n\n<p>Database vendor code: 229. Select permission was denied on the function.</p>\n\n<p>I granted the select permission to the function.</p>\n\n<p>What can be the problem?</p>\n"},{"tags":["vb.net","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13163028,"title":"get return value from stored procedure without output parameter","body":"<p>I have a vb.net application that inserts records into a db table using a stored procedure that is supposed to return a value. This stored procedure was setup by someone else and initially was linked to a webservice through which my application made the insert and got the return value in the returned xml. I now have access to the db table and not sure how to receive the return value in my vb.net method.</p>\n\n<p>SQl stored procedure snippet;</p>\n\n<pre><code>     @urlname varchar(500),\n@siteid varchar(16),\n@origin varchar(50),\n@queryid varchar(25)\n  AS\nSET NOCOUNT ON;\ndeclare @cnt int\ndeclare @serverip varchar(16)\ndeclare @mincnt int\ndeclare @siteservercnt int\nselect @cnt=COUNT(*) from sites\n      where urlname=@urlname\nif @cnt = 0\n    begin\n    insert into sites (urlname,siteid,exported,origin,queryid)\n    values(@urlname,@siteid,1,@origin,@queryid)\n    select @siteservercnt = COUNT(*) from siteserverip where siteid=@siteid\n    if @siteservercnt=0\n       begin\n            select top 1 @mincnt=COUNT(*),@serverip=serverip from siteserverip\n        group by serverip\n        order by COUNT(*)\n        select top 1 @mincnt=sitecount,\n                         @serverip=serverip from serveripcounts\n        order by sitecount\n        insert into siteserverip values(@siteid,@serverip)\n        update serveripcounts set sitecount=sitecount+1\n        where serverip=@serverip\n        end\n    end\nSELECT siteid from sites\nwhere urlname=@urlname\nreturn \n</code></pre>\n\n<p>and my vb.net code to do the insert</p>\n\n<pre><code>        CommandObj.CommandText = \"Getsite\"\n        CommandObj.CommandTimeout = 90\n\n        Dim newUrl As String = String.Empty\n\n        CommandObj.Parameters.Clear()\n\n        Dim m_param As SqlParameter\n\n        m_param = CommandObj.Parameters.Add(\"@urlname\", SqlDbType.VarChar, 500)\n        m_param.Direction = ParameterDirection.Input\n        m_param.Value = name\n\n\n        m_param = CommandObj.Parameters.Add(\"@siteid\", SqlDbType.VarChar, 16)\n        m_param.Direction = ParameterDirection.Input\n        m_param.Value = siteid\n\n        m_param = CommandObj.Parameters.Add(\"@origin\", SqlDbType.VarChar, 50)\n        m_param.Direction = ParameterDirection.Input\n        m_param.Value = method\n\n        m_param = CommandObj.Parameters.Add(\"@queryId\", SqlDbType.VarChar, 25)\n        m_param.Direction = ParameterDirection.Input\n        m_param.Value = forumID\n\n\n        Dim recordsAffected As Integer = CommandObj.ExecuteNonQuery\n</code></pre>\n"},{"tags":["sql-server-2008","connection"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13162813,"title":"What IP address should I use in connection string to connect remote database","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/13161247/remote-connection-to-sql-server-2008-sp2\">Remote connection to SQL server 2008 sp2</a>  </p>\n</blockquote>\n\n\n\n<p>I'm fairly new in server field. I have a window application in VB, Im trying to connect database with my application. what live IP should I use in connection string to connect application with database?</p>\n\n<pre><code>String = \"Data Source=***.***.*.***\\SQLEXPRESS;Initial Catalog=StudentInfo;User ID=user; Password=st123;\"\n</code></pre>\n\n<p>Thanks guys.\ncheers</p>\n"},{"tags":["sql","sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":3,"up_vote_count":2,"down_vote_count":0,"view_count":79,"score":2,"question_id":13159526,"title":"Split values over multiple rows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5493510/turning-a-comma-separated-string-into-individual-rows\">Turning a Comma Separated string into individual rows</a>  </p>\n</blockquote>\n\n\n\n<p>I have the following output from a stored procedure and was wondering the best way to split the values into multiple rows.</p>\n\n<pre><code>reference   name                            subjects       subjectstitle\nLL9X81MT    Making and Decorating Pottery   F06,F27,F38       NULL\n</code></pre>\n\n<p>I need to trim the subjects field at the comma's and duplicate the information over three rows so the data would be as follows.</p>\n\n<pre><code>reference   name                            subjects       subjectstitle\nLL9X81MT    Making and Decorating Pottery   F06       NULL\nLL9X81MT    Making and Decorating Pottery   F27       NULL\nLL9X81MT    Making and Decorating Pottery   F38       NULL\n</code></pre>\n\n<p>I'm using MS SQL Server 2008 to setup these SP's and just need some help on how to split the subjects field up.</p>\n\n<p>Thanks,</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":13161044,"title":"Checking if a given date fits between a range of dates","body":"<p>If I have 2 date columns in a table, <code>startDate</code> and <code>endDate</code>.  How do I return rows where a given date fits between those 2 dates?  For example:</p>\n\n<p>If the given date is <code>2012-10-25</code></p>\n\n<p>It should return the following rows</p>\n\n<pre><code>startDate   -   endDate\n2012-10-25  -   2012-10-25\n2011-09-10  -   2013-11-15\n2012-10-20  -   2012-10-25\n2012-10-23  -   2012-10-28\n2012-09-14  -   2012-10-28\n</code></pre>\n\n<p>from the following rows:</p>\n\n<pre><code>startDate   -   endDate\n2012-10-25  -   2012-10-25\n2011-09-10  -   2013-11-15\n2012-01-11  -   2012-10-11\n2012-10-20  -   2012-10-25\n2012-04-15  -   2012-04-16\n2012-05-20  -   2012-05-25\n2012-12-01  -   2012-12-10\n2012-10-23  -   2012-10-28\n2012-09-14  -   2012-10-28\n2012-11-13  -   2012-12-15\n</code></pre>\n\n<p>Is this possible with sql?</p>\n\n<p>I am using sql server 2008.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":77,"score":2,"question_id":13161264,"title":"Arithmetic overflow error converting varchar to data type numeric. '10' <= 9.00","body":"<p>Below is a subset of the kind of table structure and data i'm working with.</p>\n\n<pre><code>CREATE TABLE #Test\n(\n     Val varchar(5)\n    ,Type varchar(5)\n)\n\nINSERT #Test VALUES ('Yes','Text')\nINSERT #Test VALUES ('10','Int')\nINSERT #Test VALUES ('10.00','Float')\nINSERT #Test VALUES ('9.00','Float')\nINSERT #Test VALUES ('9','Int')\n</code></pre>\n\n<p>I want to write a query that will let me know if the column 'Val' is &lt;= 9.00 (must be of numeric data type). I did this by doing the following:</p>\n\n<pre><code>SELECT *\nFROM\n    (\n        SELECT Val\n        FROM #Test\n        WHERE Type = 'Int'\n    ) IntsOnly\nWHERE IntsOnly.Val &lt;= 9.00\n</code></pre>\n\n<p>This gives me an arithmetic overflow error. However, if I exclude the row of data with the value '10':</p>\n\n<pre><code>SELECT *\nFROM\n    (\n        SELECT Val\n        FROM #Test\n        WHERE Type = 'Int'\n        AND Val &lt;&gt; '10'\n    ) IntsOnly\nWHERE IntsOnly.Val &lt;= 9.00\n</code></pre>\n\n<p>It works without any issue. <strong>My question is not how to fix this as I know I can simply convert the data to the format I require.</strong></p>\n\n<p>My question is why the value of '10' in the column 'Val' is returning an error. Surely the logic should just return 'False' and simply exclude the rows because '10' (which I assume is implicitly converted) is greater than 9.00.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sqlperformance"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":19,"score":2,"question_id":13161170,"title":"MSSQL Server 2008 Performance issue with very strange resolution","body":"<p>I'm a long time DBA (12 years in SQL). I'm running sql2008 enterprise in a win 2008 clustered environment. 128gb memory and 32cpu in each cluster node. Not wimpy.</p>\n\n<p>I've got the wierdest performance issue I've seen to date, and its baffling me why it would occur...looking for ideas.</p>\n\n<p>Occasionally, maybe 2-3 times per week, the performance of queries made by the application to the database will come to a crawl. SPs that normally execute in 500ms, suddenly are up arond 50 seconds. Forget about saving data...application .net code will time out before the data even makes the trip.</p>\n\n<p>First time this happened was about 4 weeks ago. I kicked off a profiler so I could see if there were excessive queries or something, and didnt see anything strange. So, I copied one of the batches from the profile and executed it in SSMS. From that moment, the performance was perfect again. Application was snappy and no issues.</p>\n\n<p>Next time it happened, I remembered that just running a batch in ssms seemed to \"fix\" the issue. So I took some benchmarks first and did it again. Same thing. Running ANY batch in SSMS relieves whatever is happening. I have reproduced this about 15-18 times over the past 4 weeks: The application comes to a crawl, and then I run any query in ssms, and all is well.</p>\n\n<p>This is obviously a problem. In order to find out what is running or going on, I have to run a batch--which makes the problem stop. SO the act of trying to observe the issue resolves it. GAH!</p>\n\n<p>Note: There are two clustered instances running on the same node. Only one of the two experiences this issue. And they are roughly the same size in terms of disk space and activity.</p>\n\n<p>Anyone ever seen this?</p>\n"},{"tags":["asp.net","sql","sql-server-2008","c#-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13159468,"title":"Date format Issue in SQL Server or ASP.NET","body":"<p>When I run a stored procedure in SQL Server 2008 CTP I get date <code>\"2012-10-31 00:00:00.000\"</code> with this format. </p>\n\n<p>But when I am converting it using</p>\n\n<pre><code>Convert.ToString(drConversation[\"ConversationDate\"])\n</code></pre>\n\n<p>in C#, I am getting <code>\"10/31/2012 12:00:00 AM\"</code>.</p>\n\n<p>Where should be problem? In C# code or in SQL Server?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","hierarchy"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13158857,"title":"How to query and parse adjacent list hierarchy using cte?","body":"<p>How can I query this parent-child hierarchy to produce a result set in which the levels are in their own columns? Sample data:</p>\n\n<pre><code>SET NOCOUNT ON;\nUSE Tempdb;\n\nIF OBJECT_ID('dbo.Employees', 'U') IS NOT NULL DROP TABLE dbo.Employees;\n\nCREATE TABLE dbo.Employees\n(\n  empid   INT         NOT NULL PRIMARY KEY,\n  mgrid   INT         NULL     REFERENCES dbo.Employees,\n  empname VARCHAR(25) NOT NULL,\n  salary  MONEY       NOT NULL,\n  CHECK (empid &lt;&gt; mgrid),\n  CHECK (empid &gt; 0)\n);\n\nCREATE UNIQUE INDEX idx_unc_mgrid_empid ON dbo.Employees(mgrid, empid);\n\nINSERT INTO dbo.Employees(empid, mgrid, empname, salary) VALUES\n  (1,  NULL, 'David'  , $10000.00),\n  (2,  1,    'Eitan'  ,  $7000.00),\n  (3,  1,    'Ina'    ,  $7500.00),\n  (4,  2,    'Seraph' ,  $5000.00),\n  (5,  2,    'Jiru'   ,  $5500.00),\n  (6,  2,    'Steve'  ,  $4500.00),\n  (7,  3,    'Aaron'  ,  $5000.00),\n  (8,  5,    'Lilach' ,  $3500.00),\n  (9,  7,    'Rita'   ,  $3000.00),\n  (10, 5,    'Sean'   ,  $3000.00),\n  (11, 7,    'Gabriel',  $3000.00),\n  (12, 9,    'Emilia' ,  $2000.00),\n  (13, 9,    'Michael',  $2000.00),\n  (14, 9,    'Didi'   ,  $1500.00);\n\nselect * from dbo.Employees\ngo     \n\n;WITH Tree (empid, mgrid, lv)\nAS (\n\nSELECT empid, mgrid, 1\nFROM Employees\nWHERE mgrid IS NULL \n\nUNION ALL\n\nSELECT E.empid, E.mgrid, lv + 1\nFROM Employees AS E\nJOIN Tree\nON E.mgrid= Tree.empid\n)\nSELECT empid, mgrid, lv\nFROM Tree\nORDER BY Lv, empid\n</code></pre>\n\n<p>The resulting table should have a structure like</p>\n\n<pre><code>+-------+-----+--------+--------+--------+--------+--------+\n| empid | lvl | level1 | level2 | level3 | level4 | level5 |\n+-------+-----+--------+--------+--------+--------+--------+\n|     1 |   1 |      1 | NULL   | NULL   | NULL   | NULL   |\n|     2 |   2 |      1 | 2      | NULL   | NULL   | NULL   |\n|     3 |   2 |      1 | 3      | NULL   | NULL   | NULL   |\n|     4 |   3 |      1 | 2      | 4      | NULL   | NULL   |\n|     5 |   3 |      1 | 2      | 5      | NULL   | NULL   |\n|     6 |   3 |      1 | 2      | 6      | NULL   | NULL   |\n|     7 |   3 |      1 | 3      | 7      | NULL   | NULL   |\n|     8 |   4 |      1 | 2      | 5      | 8      | NULL   |\n|     9 |   4 |      1 | 3      | 7      | 9      | NULL   |\n|    10 |   4 |      1 | 2      | 5      | 10     | NULL   |\n|    11 |   4 |      1 | 3      | 7      | 11     | NULL   |\n|    12 |   5 |      1 | 3      | 7      | 9      | 12     |\n|    13 |   5 |      1 | 3      | 7      | 9      | 13     |\n|    14 |   5 |      1 | 3      | 7      | 9      | 14     |\n+-------+-----+--------+--------+--------+--------+--------+\n</code></pre>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":6,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1252,"score":0,"question_id":11801911,"title":"Insert multiple rows into single column","body":"<p>I'm new to SQL, (using SQL 2008 R2) and I am having trouble inserting multiple rows into a single column.</p>\n\n<p>I have a table named <code>Data</code> and this is what I am trying</p>\n\n<pre><code>INSERT INTO Data ( Col1 ) VALUES\n('Hello', 'World')\n</code></pre>\n\n<p>That code was taken from <a href=\"http://stackoverflow.com/questions/452859/inserting-multiple-rows-in-a-single-sql-query\">this</a> question, but it, like many other examples I have found on the web uses 2 columns, I just want to use 1. What am I doing wrong?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","jquery-ajax","asp-classic"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13145967,"title":"Multiple identical AJAX calls","body":"<p>Sorry if the title is inaccurate, but I can't explain the problem in 1 line.</p>\n\n<p>The scenario is this:\nWe have a website showing live statistics calculated by constantly updated values in our SQL Server database. The website updates the stats every 15 seconds via AJAX, where it recalculates every time.\nNow, the problem is, that when over 200 people whats the real time stats it recalculates every 800 times every minute, which pretty much is unnecessary.</p>\n\n<p>It is possible to do 1 calculation every 15 second, and show this 1 calculation to every user when requested by them?</p>\n\n<p>Bare in mind, that some users can have selected to show the data in 1 way, while other users have selected to show the data in another way.</p>\n"},{"tags":["sql-server-2008","tsql","database-performance"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":42,"score":-1,"question_id":13158751,"title":"When is a database considered a 'large database'?","body":"<p>I have a SQL Server 2008 database, with a single table with apprx 50 columns. Primary key is a datetime. No normalisation further possible, it is simply a table storing values from different sensors every couple of seconds, so ints and decimals. \nSo now, for the past month I have close to 560k rows inserted.\nMy question is, when would I start to see performance problems due to too much data? </p>\n\n<p>To be more specific: \nMy requirement so far is to display(in a chart) the last month(not an issue for this question). If I always get from the DB only the last month, a query filtered by the PK(so indexed), does it matter how big the table gets?</p>\n\n<p>Ups, long rant :) Thanks for the input!</p>\n"},{"tags":["sql-server-2008","reporting-services","reportserver","reportmanager"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5460,"score":0,"question_id":1548719,"title":"SQL Server 2008 - The report manager URL shows a page without Properties tab","body":"<p>I have SQL Server 2008 Developer Edition and I'm facing the following issues with the Reporting Services.</p>\n\n<ol>\n<li><p>When I open the Report Manager URL (I get it from the Reporting Services Configuration Manager) in a browser, it shows me a SQL Server Reporting Services page with a folder icon on top left and links with text 'Home', 'My subscriptions', 'Help' on top right. That's it, I don't get to see anything else. \nI have a virtual directory with the same name as specified for Report Manager in Reporting Services Configuration Manager.</p></li>\n<li><p>Opening the Report Server in the browser gives the following error message-</p>\n\n<p><em>Reporting Services Error\n    The report server cannot open a connection to the report server database. A connection to the database is required for all requests and processing. (rsReportServerDatabaseUnavailable) Get Online Help\n    A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Shared Memory Provider, error: 40 - Could not open a connection to SQL Server)</em></p></li>\n</ol>\n\n<p>I tried the following at the command prompt in order to resolve it-</p>\n\n<pre><code>rsconfig -c -s &lt;SQLSERVERNAME&gt; -d reportserver -a Windows -u &lt;MYDOMAIN\\MYACCOUNT&gt; -p &lt;PASSWORD&gt;\n</code></pre>\n\n<p>but I got another error saying <code>Report Server WMI Provider error: Invalid namespace</code></p>\n\n<p>I would really appreciate any help on this.</p>\n\n<p>cheers</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13158956,"title":"UDF performance suddenly degraded","body":"<p>SQL Server 2008 R2</p>\n\n<p>I know this is a common problem (eg: <a href=\"http://connect.microsoft.com/SQLServer/feedback/details/524983/user-defined-function-performance-is-unacceptable\" rel=\"nofollow\">http://connect.microsoft.com/SQLServer/feedback/details/524983/user-defined-function-performance-is-unacceptable</a>) - but ive only just learned of it.</p>\n\n<p>We have a live production database that has performed fine for months, specifically a stored procedure that contains a large CTE that selects into a table variable. Then, based on a parameter on the procedure - data is selected from the table variable in various ways (column sequence, order by clause etc).</p>\n\n<p>This temporary table only has a few hundred rows inserted into it from the CTE - the source data is huge, but the resulting rows are always low in number)</p>\n\n<p>The select satements used on the table variable use 2 very simple UDF's:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[format_timeV2] ( @Time INT )\nRETURNS VARCHAR(20)\nAS \n    BEGIN\n        DECLARE @Time_Varchar VARCHAR(20)\n        SET @Time_Varchar = CONVERT(VARCHAR, @Time / 3600) + 'h ' + CONVERT(VARCHAR, ROUND(( ( CONVERT(FLOAT, ( @Time % 3600 )) ) / 3600 ) * 60, 0)) + 'm'\n        RETURN @Time_Varchar\n    END\nGO\n</code></pre>\n\n<p>And</p>\n\n<pre><code>CREATE FUNCTION [dbo].[udf_WeekEndDate] ( @Date DATETIME )\nRETURNS DATETIME\nAS \n    BEGIN\n        RETURN DATEADD(DAY, 7, CONVERT(DATETIME, CONVERT(VARCHAR(10), DATEADD(day, -1 - ( DATEPART(dw, @Date) + @@DATEFIRST - 2 ) % 7, @Date), 103) + ' 23:59:59', 103))\n    END\nGO\n</code></pre>\n\n<p>These UDF's have been working fine for months, if not years, the stored procedure in question has ALWAYS ran in under 6 seconds - but as soon as the UDF's above are included on the SELECT statement of the table variable the procedure takes MINUTES!</p>\n\n<p>As soon as we comment out the usage of these functions it returns to executing in 3-6 seconds.</p>\n\n<p>These functions are only being used on the <code>SELECT</code> from <code>@TableVar</code> statement (few hundred rows) - so i dont see why the query optimiser if struggling here?!?!</p>\n\n<p>If we run the following - the UDF's and procedure start to work normally again:</p>\n\n<pre><code>DBCC FreeProcCache\nDBCC DropCleanbuffers\n</code></pre>\n\n<p>So i can only assume the query optimiser is doing something stupid in the background - but it's not clear on the execution plan as to what it is.</p>\n\n<p>I have tried recreating the proc with <code>RECOMPILE</code> - this didnt help, only <code>FreeProcCache</code> &amp; <code>DropCleanbuffers</code> helped.</p>\n\n<p>Any ideas what the root cause of this? we dont really want to go re-writing all the UDFs as table valued function (which i understand is a work around for this problem) as this is a live production database which has been working fine for years.</p>\n\n<p><strong>EDIT 1:</strong> Blam requested detail of the actual query that hangs:</p>\n\n<pre><code>    IF @ModeInt = 2 \n        SELECT  [DET_NUMBERA] ,\n                [Name] ,\n                [Branch] ,\n                COUNT(*) OVER ( PARTITION BY [DET_NUMBERA] ) AS RowsForThisEmployee ,\n                CONVERT(VARCHAR(10), dbo.udf_WeekEndDate([Date]), 103) AS [WeekEnding] ,\n                [Date] ,\n                [Start Time] ,\n                [End Time] ,\n                [Duration] ,\n                dbo.format_timeV2([Duration] * 60) AS [DurationF] ,\n                [EntryCount] ,\n                [EntryColour] ,\n                [DurationColour] ,\n                [DurationComment]\n        FROM    @CompletedData\n        WHERE   [EntryCount] = 0\n        ORDER BY [DET_NUMBERA] ,\n                [Date] ,\n                [Start Time]\n\n    IF @ModeInt = 3 \n        SELECT  [DET_NUMBERA] ,\n                [Name] ,\n                [Branch] ,\n                COUNT(*) OVER ( PARTITION BY [DET_NUMBERA] ) AS RowsForThisEmployee ,\n                CONVERT(VARCHAR(10), dbo.udf_WeekEndDate([Date]), 103) AS [WeekEnding] ,\n                [Date] ,\n                [Start Time] ,\n                [End Time] ,\n                [Duration] ,\n                dbo.format_timeV2([Duration] * 60) AS [DurationF] ,\n                [EntryCount] ,\n                [EntryColour] ,\n                [DurationColour] ,\n                [DurationComment]\n        FROM    @CompletedData\n        WHERE   [EntryCount] &gt; 1\n        ORDER BY [DET_NUMBERA] ,\n                [Date] ,\n                [Start Time]\n</code></pre>\n\n<p>The temp table doesnt have an index (didnt think it was needed as it only ever contains 100 - 200 rows:</p>\n\n<pre><code>    DECLARE @CompletedData TABLE\n        (\n          [DET_NUMBERA] VARCHAR(7) ,\n          [Name] VARCHAR(255) ,\n          [Branch] VARCHAR(3) ,\n          [Date] DATE ,\n          [Start Time] TIME(0) ,\n          [End Time] TIME(0) ,\n          [Duration] INT ,\n          [EntryCount] INT ,\n          [EntryColour] VARCHAR(15) ,\n          [DurationColour] VARCHAR(15) ,\n          [DurationComment] VARCHAR(65)\n        )\n</code></pre>\n\n<p>The CTE populates the table in 3 seconds, its only the above SELETS that make use of UDF's that hang, if i remove the UDF's from the SELECT it works instantly.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13157708,"title":"Parsing error when creating view","body":"<p>I have a view which takes multiple rows and Comma Separated Values (CSV) from table columns with data. </p>\n\n<p>It was working well and I got the results that I needed. Now the view has some parsing error like:</p>\n\n<blockquote>\n  <p>Error in WHERE clause near '('. Unable to parse query text.</p>\n</blockquote>\n\n<p>Can someone help? Here is my code:</p>\n\n<pre><code>SELECT dbo.table1.title,\n       Stuff((SELECT ', ' + CONVERT(NVARCHAR(4000), dbo.table3.uid) AS [text()]\n              FROM   dbo.table2\n                     INNER JOIN dbo.table3\n                       ON dbo.table3.uid = dbo.table2.FK_Group\n              WHERE  dbo.table3.uid = dbo.table2.FK_Group\n                     AND dbo.table3.company = dbo.main.company\n                     AND dbo.table2.FK_Version = dbo.table1.fk_Version\n                     AND dbo.main_version.uid = dbo.table1.fk_Version\n              FOR XML PATH('')), 1, 1, '') AS groupName\nFROM   dbo.main_version\n       INNER JOIN dbo.[main]\n         ON dbo.version.fk_main = dbo.[main].uid\n       INNER JOIN dbo.main_schema\n         ON dbo.[main].fk_SCHEMA = dbo.main_schema.uid\n       INNER JOIN dbo.table1\n         ON dbo.version.uid = dbo.table1.fk_Version\nWHERE  ( dbo.main_version.active = 1 )\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":32,"score":-1,"question_id":13143090,"title":"showing results of multiple queries in one table","body":"<p>In sql, one query gets one column, other query gets another column and so on, I want to show these multiple columns in one table as multiple columns.</p>\n\n<p>For example: \nQuery1 gives column 'EmployeeId' .........\nQuery2 gives column 'EmployeeName' .......\nQuery3 gives column 'EmployeeAddress'</p>\n\n<p>Now I want to show these three columns in one table like\ntable1 has columns 'EmployeeId', 'EmployeeName' and 'EmployeeAddress'</p>\n\n<p>Since in both Queries it is ORDER BY EmployeeId in increasing order, so in final table (table1 here) it gives corresponding Id, name and address.</p>\n"},{"tags":["sql","sql-server-2008","tsql","parsing"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13122997,"title":"T-SQL: Parsing names to ignore spaces and middle initials","body":"<p>I have a poorly maintained database that includes employee information.  Human Resources requested a report that lists instances where the employee name associated with an insurance coverage does not match the name on the insurance policy.  </p>\n\n<p>There are inconsistencies in the formatting of the names in both tables.  It's always last name then first name, but you might see any of the following in either table for a fictional employee named Steven J. Smith:</p>\n\n<ol>\n<li>Smith, Steven</li>\n<li>Smith,Steven</li>\n<li>Smith, Steven J.</li>\n<li>Smith,Steven J.</li>\n</ol>\n\n<p>I need to run a query looking for instances where EMPLOYEE.EMP_NAME &lt;> INSURANCE.SUBSCRIBER_NAME while allowing for differences in name formatting as shown above (i.e. picking up that \"Smith,Steven J.\" and \"Smith, Steven\" are (probably) the same person and igonring them).  </p>\n\n<pre><code>SELECT \n  EMPLOYEE.EMP_NO\n, EMPLOYEE.EMP_NAME\n, INSURANCE.SUBSCRIBER_NAME\n, INSURANCE.PAYOR_NAME\n\nFROM EMPLOYEE\n     INNER JOIN INSURANCE ON EMPLOYEE.EMP_NO = INSURANCE.EMP_NO\n\nWHERE EMPLOYEE.EMP_NAME &lt;&gt; INSURANCE.SUBSCRIBER_NAME\n</code></pre>\n\n<p>I know I want to do a substring to ignore the middle initial, but how do I account for ignoring whether or not there is a space after the comma?  </p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":59,"score":0,"question_id":13157750,"title":"Meaning of ; in queries","body":"<p>What is the meaning of ; at the end of queries?</p>\n\n<p>For example; what is the difference between:</p>\n\n<pre><code>select 1\nselect 2\n</code></pre>\n\n<p>and </p>\n\n<pre><code>select 1;\nselect 2\n</code></pre>\n"},{"tags":["sql-server-2008","table","stored-procedures","sync"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12853897,"title":"how to sync only tables and stored procedures between two sql server 2008 databases (NOT DATA)","body":"<p>I have two instances of my application database, one is on local server for testing purposes with some dummy data and the other is one is on online server. The thing that is common between both is the stored procedures, functions &amp; tables, so very often i have to move stored procedures and tables from my local server database to online server database.</p>\n\n<p>Is there any way to sync the database properly? rather than generating scripts than executing them manually.</p>\n\n<p>I'm using SQL Server 2008.</p>\n"},{"tags":["c#","sql","sql-server-2008","csv","sqlcmd"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13157514,"title":"Split and Export a Database Table Based on Size","body":"<p>All, I have developed an export mechanism to allow the selected tables from a givem database to be exported to .csv files; I can do this using <code>bcp</code> or <code>sqlcmd</code>. For large tables (> 1-2GB), I want to split the tables into serveral .csv files of a predetermined, user specifeid size (say 200MB).</p>\n\n<p>How can I determine the number of rows that make up the users specified size? This is so I can use a <code>sqlcmd</code> command like the following</p>\n\n<pre><code>DECLARE @sql VARCHAR(8000);\nSELECT @sql = 'sqlcmd -S' + @@SERVERNAME + ' -E -Q ' + \n              '\"SELECT * FROM Ia.dbo.[Episode];\" -o \"F:\\aaData\\Test2.csv\" -s\",\" -W';\nEXEC master..xp_cmdshell @sql;\n</code></pre>\n\n<p>with a <code>TOP N</code> clause to get the correct split .csv size. I may have to count the rows using a batch read, or is there a better way to do this?</p>\n\n<p>Thanks for your time.</p>\n"},{"tags":["sql-server-2008","indexing","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13155530,"title":"Optimize query with temp and while loop and lots of select statement within loop","body":"<p>I want to improve the performance of the query which has the records in temp table and am using while loop to access each row from temp table and use it accordingly but there are lots of check in the while loop for which many select statements are there so when there are lots of records say above 300-400, then it takes time as the table for which select statements are used contains records in thousands.</p>\n\n<p>Indexing will slow down the insert DML operations so what all things that can be done here.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","database-backups"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13137815,"title":"SQL Server backup devices","body":"<p>I'm trying to find out how to detect if a backup device exists using T-SQL.</p>\n\n<p>This is how I create my backup device:</p>\n\n<blockquote>\n  <p>EXEC master.dbo.sp_addumpdevice @devtype = N'disk', @logicalname =\n  N'TestTest', @physicalname = N'C:\\Program Files\\Microsoft SQL\n  Server\\MSSQL10_50.PTC_SQLPROD\\MSSQL\\Backup\\TestTest.bak'</p>\n</blockquote>\n\n<p>but I can't find how to detect if it already exists first.</p>\n"},{"tags":[".net","asp.net-mvc","asp.net-mvc-3","sql-server-2008","entity-framework-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13156594,"title":"in MVC3 how to recreate the EdmMetaData Table in Sql Server?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/11215035/mvc3-edmmetadata-table-not-found\">MVC3 EDMmetadata table not found</a>  </p>\n</blockquote>\n\n\n\n<p>I downloaded the MvcMusicStore example from <a href=\"http://mvcmusicstore.codeplex.com\" rel=\"nofollow\">mvcmusicstore.codeplex.com</a> \nand I have deleted the EdmMetaData Table.</p>\n\n<p>Everytime that I run it, I get this error...</p>\n\n<blockquote>\n  <p>\"Model compatibility cannot be checked because the database does not\n  contain model metadata. Ensure that IncludeMetadataConvention has been\n  added to the DbModelBuilder conventions.\"</p>\n</blockquote>\n\n<p>how can I recreate that table?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":25,"score":-1,"question_id":13156295,"title":"Timout when Selecting or Deleting a specific row","body":"<p>When executing a select or delete statement on a specific row in a table I get a timeout exception.</p>\n\n<p>How can I delete said row without using a delete statement?</p>\n"},{"tags":["sql","sql-server-2008","compression"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13155630,"title":"PAGE compression in SQL Server effect on running queries","body":"<p>I am planning to apply PAGE compression to some of the big tables in my database (DW to be precise). These tables are fairly big with over 15 Billion rows. When I applied the compression in test environment, the whole process took around 22 hours.These tables are accessed daily with quite long running queries.  My questions are</p>\n\n<ol>\n<li>While the compression is being applied would there be any affect on the queries that are running? Any lock etc I should be aware of?</li>\n<li>Is there a staggered approach to applying compression? </li>\n</ol>\n\n<p>3.Any other input/feedback you might have?</p>\n\n<p>many thanks</p>\n\n<p>Sean</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13155123,"title":"How skip id's from parent table on base of child table values","body":"<p>I have two tables</p>\n\n<pre><code>table1  \n\nides    name\n\n1001    AA\n1002    BB\n1003    CC\n\n\ntable2      \n\nides    posi    cwawr\n\n1001    2   xyz\n1001    4   lmn\n1001    6   abc\n1002    2   ijk\n1002    4   lmo\n1002    6   pqr\n1003    2   xyz\n1003    4   sfs\n</code></pre>\n\n<p>in both above table i want to select the all ides of table1 where the posi not equal to 2 and cwawr not equal to xyz. for example 1001 posi has 2 and cwawr has xyz so this id should be skip. same 1003 also have posi value 2 and cwawr has xyz so it also should be skip.</p>\n\n<p>so in result it should be </p>\n\n<pre><code>1002 \n</code></pre>\n\n<p>only.</p>\n\n<p>Thanks in advance,\nEshwer</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13075527,"title":"How to display data like Blogspot's BlogArchive in time order using asp.net C#","body":"<p>How can I display data entry on my aspx page like Blogspot's BlogArchive in time order?</p>\n\n<p>I think basically the database including a table with columns: Entry, Year, Month, Day so that we can display data like what I mean.\n(check link: <a href=\"http://i160.photobucket.com/albums/t194/perakit/mess/BlogArchive.jpg\" rel=\"nofollow\">http://i160.photobucket.com/albums/t194/perakit/mess/BlogArchive.jpg</a>)</p>\n\n<p>Note: I use SQL Server 2008 and Visual Studio 2008, asp.net C# for my project.</p>\n\n<p>Best thanks and appreciated for all replies.</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":13150915,"title":"SQL - Average number of records within a time period","body":"<p>I'm trying to compile some lifetime value information for customers within one of our databases.</p>\n\n<p>We have an MS SQL Server database which stores all of our customer/transactional information.</p>\n\n<p>My issue is that I don't have much experience when it comes to MS SQL Server (or SQL in general) - I'd like to be able to run a query against the database that pulls AVG number of loans, and AVG revenue based on three criteria:</p>\n\n<p>1.) Loans be counted if they are 'approved'\n2.) Loans from a customer_id only be counted if the first loan (first identified by date_created field) be on or after a certain 'mm/yyyy'\n3.) I'm able to specify for how many months after the first 'mm/yyyy' to tally the number of loans / revenue to be included within the AVG</p>\n\n<p>Here is what the database would look like:</p>\n\n<pre><code>customer_id   | loan_status | date_created      | revenue\n111       | 'approved'  | 2010-06-20 17:17:09   | 100.00\n222       | 'approved'  | 2010-06-21 09:54:43   | 255.12\n333       | 'denied'    | 2011-06-21 12:47:30   | NULL\n333       | 'approved'  | 2011-06-21 12:47:20   | 56.87\n222       | 'denied'    | 2011-06-21 09:54:48   | NULL\n222       | 'approved'  | 2011-06-21 09:54:18   | 50.00\n111       | 'approved'  | 2011-06-20 17:17:23   | 100.00\n... loads' of records ...\n555       | 'approved'  | 2012-01-02 09:08:42   | 24.70\n111       | 'denied'    | 2012-01-05 02:10:36   | NULL\n666       | 'denied'    | 2012-02-05 03:31:16   | NULL\n555       | 'approved'  | 2012-02-17 09:32:26   | 197.10\n777       | 'approved'  | 2012-04-03 18:28:45   | 300.50\n777       | 'approved'  | 2012-06-28 02:42:01   | 201.80\n555       | 'approved'  | 2012-06-21 22:16:59   | 10.00\n666       | 'approved'  | 2012-09-30 01:17:20   | 50.00\n</code></pre>\n\n<p>If I wanted to find the avg transaction count (approved transactions), and average revenue per approved transaction for all customer's who's <strong>first</strong> loan was in/after 2012-01, and for a period of 4 months after then, how would I go about querying the database?</p>\n\n<p>Any help is greatly appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":20,"score":1,"question_id":13153235,"title":"Dynamic backup file name","body":"<p>I use <code>SQL Server 2008 R2</code> and want to use <code>Backup Devices</code> for create backup of my database in each day. How can I create dynamic file name in `Backup Devices'.</p>\n\n<p>In below code I Create a Backup Devices but want to have Current Date (YYYY-MM-DD) in my backup file.</p>\n\n<pre><code>EXEC master.dbo.sp_addumpdevice  @devtype = N'disk', @logicalname = N'My Database Backup Location', @physicalname = N'D:\\Backup\\Backup YYYY-MM-DD.bak'\n</code></pre>\n\n<p>Thanks in advance</p>\n"},{"tags":["php","android","json","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":67,"score":-1,"question_id":13119310,"title":"Android Error parsing data org.json.JSONException: End of input at character 0 of","body":"<p>i got an error when i stored some parameters to php server. i used mssql server as database storage. here my log when i run my apps.</p>\n\n<pre><code>10-29 16:38:23.523: E/Buffer Error(4721): Error converting result java.lang.NullPointerException\n10-29 16:38:23.523: E/JSON Parser(4721): Error parsing data org.json.JSONException: End of input at character 0 of \n10-29 16:38:23.527: W/dalvikvm(4721): threadid=11: thread exiting with uncaught exception (group=0x40e91300)\n10-29 16:38:23.531: E/AndroidRuntime(4721): FATAL EXCEPTION: AsyncTask #1\n10-29 16:38:23.531: E/AndroidRuntime(4721): java.lang.RuntimeException: An error occured while executing doInBackground()\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at android.os.AsyncTask$3.done(AsyncTask.java:299)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.FutureTask$Sync.innerSetException(FutureTask.java:273)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.FutureTask.setException(FutureTask.java:124)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:307)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.FutureTask.run(FutureTask.java:137)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:230)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1076)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:569)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.lang.Thread.run(Thread.java:856)\n10-29 16:38:23.531: E/AndroidRuntime(4721): Caused by: java.lang.NullPointerException\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at com.example.androidsql.NewProductActivity$CreateNewProduct.doInBackground(NewProductActivity.java:345)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at com.example.androidsql.NewProductActivity$CreateNewProduct.doInBackground(NewProductActivity.java:1)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at android.os.AsyncTask$2.call(AsyncTask.java:287)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:305)\n10-29 16:38:23.531: E/AndroidRuntime(4721):     ... 5 more\n10-29 16:38:23.715: W/IInputConnectionWrapper(4721): showStatusIcon on inactive InputConnection\n10-29 16:38:24.496: E/WindowManager(4721): Activity com.example.androidsql.NewProductActivity has leaked window com.android.internal.policy.impl.PhoneWindow$DecorView@417ebf98 that was originally added here\n10-29 16:38:24.496: E/WindowManager(4721): android.view.WindowLeaked: Activity com.example.androidsql.NewProductActivity has leaked window com.android.internal.policy.impl.PhoneWindow$DecorView@417ebf98 that was originally added here\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.ViewRootImpl.&lt;init&gt;(ViewRootImpl.java:374)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:292)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:224)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.WindowManagerImpl$CompatModeWrapper.addView(WindowManagerImpl.java:149)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.Window$LocalWindowManager.addView(Window.java:547)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.app.Dialog.show(Dialog.java:277)\n10-29 16:38:24.496: E/WindowManager(4721):  at com.example.androidsql.NewProductActivity$CreateNewProduct.onPreExecute(NewProductActivity.java:305)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.os.AsyncTask.executeOnExecutor(AsyncTask.java:586)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.os.AsyncTask.execute(AsyncTask.java:534)\n10-29 16:38:24.496: E/WindowManager(4721):  at com.example.androidsql.NewProductActivity$6.onClick(NewProductActivity.java:186)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.View.performClick(View.java:4084)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.view.View$PerformClick.run(View.java:16966)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.os.Handler.handleCallback(Handler.java:615)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.os.Handler.dispatchMessage(Handler.java:92)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.os.Looper.loop(Looper.java:137)\n10-29 16:38:24.496: E/WindowManager(4721):  at android.app.ActivityThread.main(ActivityThread.java:4745)\n10-29 16:38:24.496: E/WindowManager(4721):  at java.lang.reflect.Method.invokeNative(Native Method)\n10-29 16:38:24.496: E/WindowManager(4721):  at java.lang.reflect.Method.invoke(Method.java:511)\n10-29 16:38:24.496: E/WindowManager(4721):  at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:786)\n10-29 16:38:24.496: E/WindowManager(4721):  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:553)\n10-29 16:38:24.496: E/WindowManager(4721):  at dalvik.system.NativeStart.main(Native Method)\n</code></pre>\n\n<p>and this is my method in android to send the parameters :</p>\n\n<pre><code>    class CreateNewProduct extends AsyncTask&lt;String, String, String&gt; {\n\n        /**\n         * Before starting background thread Show Progress Dialog\n         * */\n        @Override\n        protected void onPreExecute() {\n            super.onPreExecute();\n            pDialog = new ProgressDialog(NewProductActivity.this);\n            pDialog.setMessage(\"Loading, saving data...\");\n            pDialog.setIndeterminate(false);\n            pDialog.setCancelable(true);\n            pDialog.show();\n        }\n\n        /**\n         * Creating data\n         * */\n        protected String doInBackground(String... args) {\n            slongitude = longitude.getText().toString();\n            slatitude = latitude.getText().toString();\n            smerchant = merchant.getText().toString();\n            salamat = alamat.getText().toString();\n            stelp = telp.getText().toString();\n            shp = hp.getText().toString();\n            sbb = bb.getText().toString();\n            semail = email.getText().toString();\n\n            // Building Parameters\n            List&lt;NameValuePair&gt; params = new ArrayList&lt;NameValuePair&gt;(12);\n            params.add(new BasicNameValuePair(\"longitude\", slongitude));\n            params.add(new BasicNameValuePair(\"latitude\", slatitude));\n            params.add(new BasicNameValuePair(\"merchant\", smerchant));\n            params.add(new BasicNameValuePair(\"alamat\", salamat));\n            params.add(new BasicNameValuePair(\"telp\", stelp));\n            params.add(new BasicNameValuePair(\"hp\", shp));\n            params.add(new BasicNameValuePair(\"bb\", sbb));\n            params.add(new BasicNameValuePair(\"email\", semail));\n            params.add(new BasicNameValuePair(\"Fk_Ms_DataLevel2_ID\", \"1\"));\n            params.add(new BasicNameValuePair(\"Fk_Ms_City_ID\", \"2\"));\n            params.add(new BasicNameValuePair(\"Fk_Ms_Sales_ID_CreatedBy\", \"3\"));\n            params.add(new BasicNameValuePair(\"FK_Ms_Sales_ID_LastUpdateBy\", \"4\"));\n\n            // getting JSON Object\n            // Note that create product url accepts POST method\n            JSONObject json = jsonParser.makeHttpRequest(url_create_merchant,\n                    \"POST\", params);\n\n            // check log cat fro response\n            Log.d(\"Create Response\", json.toString());\n\n            // check for success tag\n            try {\n                int success = json.getInt(TAG_SUCCESS);\n\n                if (success == 1) {\n                    // successfully created product\n                    Log.d(\"Berhasil\", \"Good\");\n                    Toast.makeText(ctx, \"Berhasil\", Toast.LENGTH_SHORT).show();\n                    // closing this screen\n                    finish();\n                } else {\n                    // failed to create product\n                }\n            } catch (JSONException e) {\n                e.printStackTrace();\n                Log.d(\"Gagal\", e.toString());\n            }\n            return null;\n        }\n\n        /**\n         * After completing background task Dismiss the progress dialog\n         * **/\n        protected void onPostExecute(String file_url) {\n            // dismiss the dialog once done\n            pDialog.dismiss();\n        }\n    }\n</code></pre>\n\n<p>and this is my php code in server :</p>\n\n<pre><code>    &lt;?php\n\n$response = array();\n\n$dsn='sqlserver';\n$username='street'; \n$password='keymaker';\nprint_r($_POST);\n$koneksi= odbc_connect($dsn,$username,$password);\n\nif (isset($_POST['Fk_Ms_DataLevel2_ID']) &amp;&amp; isset($_POST['Fk_Ms_City_ID']) &amp;&amp; isset($_POST['Fk_Ms_Sales_ID_CreatedBy']) &amp;&amp; isset($_POST['FK_Ms_Sales_ID_LastUpdateBy']) &amp;&amp; isset($_POST['CreatedDated']) &amp;&amp; isset($_POST['LastUpdateDated']) &amp;&amp;\n    isset($_POST['longitude']) &amp;&amp; isset($_POST['latitude']) &amp;&amp; isset($_POST['merchant']) \n    &amp;&amp; isset($_POST['alamat']) &amp;&amp; isset($_POST['telp']) &amp;&amp; isset($_POST['hp']) &amp;&amp; isset($_POST['bb']) &amp;&amp; isset($_POST['email']) &amp;&amp; isset($_POST['Is_Deleted'])) {\n\n    $Fk_Ms_DataLevel2_ID = $_POST['Fk_Ms_DataLevel2_ID'];\n    $Fk_Ms_City_ID = $_POST['Fk_Ms_City_ID'];\n    $Fk_Ms_Sales_ID_CreatedBy = $_POST['Fk_Ms_Sales_ID_CreatedBy'];\n    $FK_Ms_Sales_ID_LastUpdateBy = $_POST['FK_Ms_Sales_ID_LastUpdateBy'];\n    //$CreatedDated = $_POST['CreatedDated'];\n    //$LastUpdateDated = $_POST['LastUpdateDated'];\n    $longitude = $_POST['longitude'];\n    $latitude = $_POST['latitude'];\n    $merchant = $_POST['merchant'];\n    $alamat = $_POST['alamat'];\n    $telp = $_POST['telp'];\n    $hp = $_POST['hp'];\n    $bb = $_POST['bb'];\n    $email = $_POST['email'];\n    //$Is_Deleted = $_POST['Is_Deleted'];\n\n    $query = \"INSERT INTO Ms_Merchant(Fk_Ms_DataLevel2_ID, Fk_Ms_City_ID, Fk_Ms_Sales_ID_CreatedBy, FK_Ms_Sales_ID_LastUpdateBy, Longitude, Latitude, Descriptions, Address, Telpon, Handphone, BB_PIN, email) \n            VALUES('$Fk_Ms_DataLevel2_ID', '$Fk_Ms_City_ID', '$Fk_Ms_Sales_ID_CreatedBy', '$FK_Ms_Sales_ID_LastUpdateBy', '$longitude', '$latitude', '$merchant', '$alamat', '$telp', '$hp', '$bb', '$email')\";\n    $result = odbc_exec($koneksi, $query);\n\n    if ($result) {\n        // successfully inserted into database\n        $response[\"success\"] = 1;\n        $response[\"message\"] = \"Product successfully created.\";\n\n        // echoing JSON response\n        echo json_encode($response);\n    } else {\n        // failed to insert row\n        $response[\"success\"] = 0;\n        $response[\"message\"] = \"Oops! An error occurred.\";\n\n        // echoing JSON response\n        echo json_encode($response);\n    }\n} else {\n    // required field is missing\n    $response[\"success\"] = 0;\n    $response[\"message\"] = \"Required field(s) is missing\";\n\n    // echoing JSON response\n    echo json_encode($response);\n}\n?&gt;\n</code></pre>\n\n<p>beside that error, i got an error <code>android.view.WindowLeaked: Activity has leaked window that was originally added here</code>. i need your opinions, advices, links and all of your helps. thank you very much.</p>\n"},{"tags":["asp.net","sql","sql-server-2008","iis-7.5"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13152746,"title":"How to grant IIS APPPOOL\\DefaultAppPool access to stored procedures in Asp.net using IIS?","body":"<p>Here is the error message I get, \"The EXECUTE permission was denied on the object 'GetDepartments', database 'BalloonShop', schema 'dbo\"</p>\n\n<p>I was able to workaround it by configuring sql server 2008 and making IIS APPPOOL\\DefaultAppPool a dbowner aside from datawriter and datareader, the problem is there are some security issues with it according to some articles that I found online. </p>\n\n<p>How do I allow  IIS APPPOOL\\DefaultAppPool to have access to all stored procs in my current database?(or in any database)</p>\n\n<p>(It would be nice if you could provide links/ script)</p>\n\n<p>Sir/Ma'am your answers would be of great help. Thank you++</p>\n"},{"tags":["sql-server-2008","ssis","unique-constraint"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13152183,"title":"insert data based on existing data","body":"<p>I have a table which has column like (CId, Source). Value for source can be (0,1,2,3). Now Table should have only two records for a CId.</p>\n\n<ol>\n<li>CId = 'X' and Source = 0</li>\n<li>CId = 'X' and Source = 1 (can be 2 or 3 as well)</li>\n</ol>\n\n<p>After this, if any other records comes (X,2) (X,3) should not be inserted.</p>\n\n<p>Keeping in mind the above constraints, I want to insert records into the table from a source file.\nI am using SSIS package to load the file.</p>\n"},{"tags":["c#","winforms","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":105,"score":0,"question_id":11638307,"title":"Single application multiple users through thin client","body":"<p>I have an application built in c# Winforms. In the back end I am using SQL Server 2008 Express. And I am using the application remotely through thin clients. My operating system is Windows server 2008.</p>\n\n<p>My problem is that when one user is using my software, if a 2nd user opens the software and tries to make any operation with the database, the database refuses to connect with the error </p>\n\n<blockquote>\n  <p>Cannot open the database 'database name' specified by login. Login\n  failed. Login failed for user \\windows username`.</p>\n</blockquote>\n\n<p>If the first user closes the application, then the second user can easily operate the database queries.</p>\n\n<p>Please help!!!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13137052,"title":"Error in running scheduled Job. Where to find error details","body":"<p>I want to delete row in SQL database when a column value matches with current date.\nI have created a scheduled job for deletion of data using SQL Server Management Studio. I have followed step as shown in <a href=\"http://www.youtube.com/watch?v=De_GOwnTDjo\" rel=\"nofollow\">Video</a> \nHere Type of script is T-SQL and command I have given is:</p>\n\n<pre><code>Delete from NewDB.dbo.Datetabel where Date=getDate();\nCOMMIT\n</code></pre>\n\n<p>I want to schedule this job on daily basis. But now for testing purpose I have given on hourly basis. But this job is failed.</p>\n\n<p>Where will I get the details of Error. I am working on sql2008 r2</p>\n\n<p>What should be reason for failure?\nEdited:\nNow job is getting success when code is  changed as:</p>\n\n<pre><code>BEGIN TRAN \nDelete from NewDB.dbo.Datetabel where Date=getDate();\nCOMMIT;\n</code></pre>\n\n<p>But Data is not deleted from the tabel.\nWhat may be issue now?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13151782,"title":"A network-related or instance-specific error occurred while establishing a connection to SQL Server","body":"<p>I have 2 applications, one is using Enterprise Library and second is using <code>asp:SqlDataSource</code> control to connect to the database. In the second application I am able to connect to the database. However in the first application where I am using Enterprise Library I am not able to connect to the database and I keep getting the following error</p>\n\n<blockquote>\n  <p><em>A network-related or instance-specific error occurred while establishing a   connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: Named\n  Pipes Provider, error: 40 - Could not open a connection to SQL Server)</em></p>\n</blockquote>\n\n<p>Also I am able to connect to the database using SQL Server 2008 client</p>\n\n<p>Connection string</p>\n\n<pre><code>&lt;add name=\"Connection String\" \n     connectionString=\"Data Source=inblrgescintra\\intranet;Initial Catalog=Intranet1.0;Persist Security Info=True;uid=***;pwd=*****;Integrated Security=False;\" \n     providerName=\"System.Data.SqlClient\"/&gt;\n</code></pre>\n\n<p>Please help me</p>\n"},{"tags":["c#","sql-server-2008","ado.net","transactions"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":13,"score":0,"question_id":13151775,"title":"Do many SavePoints within a SqlTransaction slow the transaction?","body":"<p>I am looping through a batch of records in a single transaction using ADO.Net/C# against SQL Server 2008 R2. By using SavePoints I am able to rollback only a single record inside the batch without affecting other records in this batch. My code is as given below. My question is: There are 2000 savepoints created within the single transaction, and I am not sure whether this large number of savepoints will negatively affect performance of transaction?</p>\n\n<pre><code>        SqlTransaction transaction = null;\n        SqlConnection connection = null;\n        try\n        {\n            connection = new SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings[\"RadControlsWinFormsApp2.Properties.Settings.PracticeConnectionString\"].ConnectionString);\n\n            int i = 0;\n            connection.Open();\n\n            transaction = connection.BeginTransaction(\"SampleTransaction\");\n\n            while (i &lt; 2000)\n            {\n                try\n                {\n                    i++;\n                    transaction.Save(\"DetailSavePoint\" );\n                    SqlCommand cmd1 = new SqlCommand(\"Insert into Persons (FirstName,LastName) values (@firstName, @lastName)\", connection);\n                    cmd1.CommandType = System.Data.CommandType.Text;\n                    cmd1.Transaction = transaction;\n                    cmd1.Parameters.AddWithValue(\"@firstName\", \"Mike\" + i);\n                    cmd1.Parameters.AddWithValue(\"@lastName\", \"Clark\" + i);\n                    cmd1.ExecuteNonQuery();\n\n                    if (i == 4 || i == 7 || i==1000)\n                    {\n                        string x = null;\n                        string y = x.Trim();\n                    }\n                    SqlCommand cmd2 = new SqlCommand(\"Insert into Countries (CountryName,Continent) values (@countryName, @continent)\", connection);\n                    cmd2.CommandType = System.Data.CommandType.Text;\n                    cmd2.Transaction = transaction;\n                    cmd2.Parameters.AddWithValue(\"@countryName\", \"Country\" + i);\n                    cmd2.Parameters.AddWithValue(\"@continent\", \"Continent\" + i);\n                    cmd2.ExecuteNonQuery();\n                }\n                catch (Exception exInner)\n                {\n                    //log the error for this detail record into a text file\n                    //roll back Only this detail record\n                    try\n                    {\n                        transaction.Rollback(\"DetailSavePoint\" );\n\n                        //RadMessageBox.Show(\"We have rolled back detail record for \" + i, \"Transaction Save Point\");\n                    }\n                    catch\n                    {\n                    }\n                }\n            }\n\n            // Attempt to commit the transaction.\n            transaction.Commit();\n            RadMessageBox.Show(\"We have committed the batched transaction.\", \"Transaction Committed\");\n        }\n        catch (Exception ex)\n        {\n\n            // Attempt to roll back the transaction. \n            try\n            {\n                transaction.Rollback();\n                RadMessageBox.Show(\"We have rolledback the batched transaction.\", \"Transaction Rolledback\");\n            }\n            catch (Exception ex2)\n            {\n                // This catch block will handle any errors that may have occurred \n                // on the server that would cause the rollback to fail, such as \n                // a closed connection.\n                // Console.WriteLine(\"Rollback Exception Type: {0}\", ex2.GetType());\n                // Console.WriteLine(\"  Message: {0}\", ex2.Message);\n            }\n        }\n        finally\n        {\n            if (transaction != null)\n            {\n                transaction.Dispose();\n            }\n            if (connection != null)\n            {\n                connection.Close();\n                connection.Dispose();\n            }\n        }\n</code></pre>\n"},{"tags":["sql","sql-server-2008","aggregate-functions"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13143987,"title":"How to select a value based on a count(*) in a subquery","body":"<p>I'm running a query below which won't work as I can't put an aggregate in a where clause, but given that it's in a subquery I'm not entirely sure what the best way forward is from here...!</p>\n\n<p>The line that doesn't work is:</p>\n\n<pre><code>        (select gradeid from commissionconsultants where UserId = ic.primaryconsultantid) \n        and starters = COUNT(*) ) from InvoiceCommissions ic\n</code></pre>\n\n<p>And the full query is as follows:</p>\n\n<pre><code>select u.username + ' ' + u.surname as UserName, \nic.primaryconsultantid, \nCOUNT(ic.invoiceid) as starters, \nDATENAME(mm,ic.invoiceissueddate) AS [month], \nDATEPART(yy,ic.invoiceissueddate) as [year], \ncast(SUM((ic.value / ic.exchangerate) * (ic.primaryconsultantperc / 100)) as numeric(8,2)) AS totalvalue, \n(select threshold from commissiongrades where gradeid = \n    (select gradeid from commissionconsultants where UserId = ic.primaryconsultantid) ) AS Threshold, \n(select percentage from commissiongradevalues where gradeid = \n    (select gradeid from commissionconsultants where UserId = ic.primaryconsultantid) \n        and starters = COUNT(*) ) from InvoiceCommissions ic\ninner join commissionconsultants cc on cc.userid = ic.primaryconsultantid\ninner join Users u on u.UserId = ic.primaryconsultantid\ngroup by primaryconsultantid, DATENAME(mm,invoiceissueddate), DATEPART(yy,invoiceissueddate), u.username + ' ' + u.surname \n</code></pre>\n\n<p>What, in essence, I am trying to do is lookup the commission percentage from a table (commissiongradevalues) based on the grade of the consultant (found in commissionconsultants) and the number of placements made in a given month.</p>\n\n<p>e.g. if a consultant has made one placement in a month, they will have XX commission percentage, and if they have made two placements in a month they will have YY commission percentage.</p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":43,"score":0,"question_id":13149232,"title":"How do I extract a substring from a random position in a string using built-in functions?","body":"<p>I have a series of data stored in the following fashion:</p>\n\n<pre><code>Word of various kinds (ANT\\username1) and even more words\nThis is another row, the words are random (ANT\\username2)\nThankfully the username only ever shows once (ANT\\username1)\n</code></pre>\n\n<p>Above represents three seperate rows. </p>\n\n<p>The general flow of this data is:</p>\n\n<ul>\n<li>Parenthesis can appear anywhere in the text</li>\n<li>The username portion of each string (ANT\\usernamex) will only ever appear once</li>\n<li>The text preceeding and proceeding the username portion is always different lengths.</li>\n<li>The username text may not always be present</li>\n</ul>\n\n<p>As you probably already guessed what I need to do is take the username from each row and where it isn't present return null. Unfortunately I have no idea how to approach this - I've played around with left() and right() functions but don't really know how else to tackle this. Would appreciate if any answers that use a number of functions to accomplish the task have a quick blurb explaining the flow of logic (so I can then read the documentation for the functions to learn).</p>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008","ssrs-reports"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13148997,"title":"SQL Reporting Services Express Edition very slow even with no data","body":"<p>Am trying to figure out why our SSRS execution is so slow.  The home page takes about 10 seconds to load/refresh and reports take 12-15 seconds just to render to the 'Enter Parameter Settings' stage.  </p>\n\n<p>I have created a report with a single text box - no data connections - no data-set - so ZERO database access and yet it still consistently takes 12 seconds to render - A SINGLE TEXT BOX WITH NO DATABASE ACCESS!  Every single click in the report engine takes 12-15 seconds to respond to - which makes it quite painful to work with real data.</p>\n\n<p>The database and an IIS installation is also included on the same machine - but they are only accessed by a couple of users (nothing public) - so the machine isn't under a lot of load.  All other services on this box are responding quickly: The IIS installation is serving up web-service requests quickly and responsively - within a split-second.  And all database queries are running at a very speedy rate - consistent with the generous hardware on this box.</p>\n\n<p>It doesn't seem to be related to 'First Request' spooling up - this is happening on all requests.</p>\n\n<p>All the other answers relating to SSRS speed issues seem to be related to database query tuning and parameter handling - but this 'no-data' test report seems to be pointing to something wrong within the SSRS installation/execution itself.  </p>\n\n<p>Any help?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","pivot","pivot-without-aggregate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":63,"score":-1,"question_id":13142554,"title":"X number of Rows into X number of Columns","body":"<p>I need your help again for the following. Please note that I am using SQL SERVER 2008.\nI have a table (below) where we got Number of jobs done from the \"Pickup\" to the \"Dropoff\".\nThe requirements are (output format mentioned below).\n1) Get all the unique postcodes regardless of them being dropoffs or pickups. This will give us all the postcodes.\n2) Present the count of jobs done from PICKUP to the corresponding DROPOFF. For example, we pick passengers up from SE18 postcode twice and took them to SE18 once and SE19 once. It will be cleared from the REQUIRED OUTPUT table.</p>\n\n<pre><code>TABLE:\nJobID        Pickup       Dropoff\n====================================\n1            SE18         SE18\n2            SE18         SE19\n3            SE2          SE18\n4            SE28         SE2\n5            AL1          SE7\n6            BR1          SE10\n7            NW1          TW16\n8            AL1          SE18\n9            BR6          AL1\n10           E6           BR1\n.            .            .\n.            .            .\n.            .            .\n</code></pre>\n\n<p>The require output is as the following:</p>\n\n<pre><code>REQUIRED OUTPUT\n\n     SE18   SE2   SE28   AL1   BR1   NW1   BR6   E6   SE19  SE7  SE10  TW16 ..\n     =========================================================================\nSE18   1     -      -     -     -     -     -     -     1    0    0     0\nSE2    1     -      -     -     -     -     -     -     -    -    -     -         \nSE28   -     1      -     -     -     -     -     -     -    -    -     -          \nAL1    1     -      -     -     -     -     -     -     -    1    -     -       \nBR1    -     -      -     -     -     -     -     -     -    -    1     -        \nNW1    -     -      -     -     -     -     -     -     -    -    -     1      \nBR6    -     -      -     1     -     -     -     -     -    -    -     -       \nE6     -     -      -     -     1     -     -     -     -    -    -     -       \nSE19   -     -      -     -     -     -     -     -     -    -    -     -        \nSE7    -     -      -     -     -     -     -     -     -    -    -     -       \nSE10   -     -      -     -     -     -     -     -     -    -    -     -      \nTW16   -     -      -     -     -     -     -     -     -    -    -     -      \n.\n.\n.\n</code></pre>\n\n<p>Many thanks in advance.\nKind regards</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":592,"score":1,"question_id":3270779,"title":"SCOPE_IDENTITY() return NULL?","body":"<p>I am using SQL Server 2008 express, below is the SP, who return </p>\n\n<blockquote>\n  <p>(0 row(s) affected)  </p>\n  \n  <p>Msg 515, Level\n  16, State 2, Procedure\n  sp_AddCarrierFees, </p>\n  \n  <p>Line 21 Cannot\n  insert the value NULL into column\n  'attribute_value_id', table\n  'MyDevSystem.dbo.shipping_fees'; </p>\n  \n  <p>column\n  does not allow nulls. INSERT fails.\n  The statement has been terminated.</p>\n  \n  <p>(1 row(s) affected)</p>\n</blockquote>\n\n<p>And this is the SP :</p>\n\n<pre><code>GO\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROCEDURE [dbo].[sp_AddCarrierFees]\n    @carrier_id INT,\n    @zone_id INT,\n    @attribute_value_id INT,\n    @attribute_title varchar(20),\n    @fees decimal(6,2)\nAS\nBEGIN\n    if @attribute_value_id = 0 begin \n        insert into shipping_attribute_value (attribute_id,attribute_value,sort_order) \n        select attribute_id, @fees,0 from shipping_attribute where carrier_id=@carrier_id and attribute_title=@attribute_title; \n\n        declare @NewID int;\n        set @NewID = SCOPE_IDENTITY(); \n        print @NewID;\n\n        insert into shipping_fees (zone_id, attribute_value_id) values (@zone_id, @NewID); \n    end \n    else \n    begin \n        update shipping_attribute_value set attribute_value=@fees where attribute_value_id=@attribute_value_id;\n    end\nEND\n</code></pre>\n\n<p>Any people know why? I have read many post in StackOverFlow, but still not find solution.Somebody say use @@IDENTITY or IDENT_CURRENT instead, but it possible got the identity who made by other users.</p>\n\n<p><strong>FIXED:I found the reason, because the first insert statement is fail, so why return (0 row(s) affected) , after i fix that insert statement,it works now. thanks you for everyone.</strong></p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":32,"score":-1,"question_id":13147661,"title":"Option \"12.0\" is not valid. The command line parameters are invalid","body":"<p>We are trying to import data from Excel to SQL server table, when we are running package in BIDS the package running successfully.</p>\n\n<p>We have created the job and trying to run the same package through job we are getting the below error message.</p>\n\n<p>Microsoft (R) SQL Server Execute Package Utility Version 10.50.2500.0 for 32-bit Copyright (C) Microsoft Corporation 2010. Option \"12.0\" is not valid.  The command line parameters are invalid.</p>\n\n<p>Command Line</p>\n\n<pre><code>DTS \"\\MSDB\\Test\" /SERVER XXXXXX /CONNECTION \"XXXXXX.XXXXX.XXXXX\";\"\\\"Data Source=XXXXX;User ID=XXXXXX;Initial Catalog=XXXXX;Provider=SQLNCLI10.1;Persist Security Info=True;Auto Translate=False;Application Name=SSIS-MondelezSiteSideFTP-{6FE6809C-3E4C-4D2B-B9CF-B72D8E36B99A}SQLServername.XXXXX.XXX;\\\"\" /CONNECTION \"ViewableMedia_xlsm\";\"\\\"Data Source=\\\\XXXXX\\XXXXX\\Data\\Datafeed\\SiteSide\\ViewableMedia\\SiteSideLoadTemplate.xlsm;Provider=Microsoft.ACE.OLEDB.12.0;Extended Properties=\"\"Excel;;;\\\"\" /X86 /CHECKPOINTING OFF /REPORTING E\n</code></pre>\n\n<p>I am running the job in SQL server.</p>\n"},{"tags":["asp.net-mvc","sql-server-2008","connection-string"],"answer_count":2,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":195,"score":0,"question_id":13039540,"title":"Trying to connect ASP.NET MVC to SQL Server 2008 R2 with possible wrong connection string","body":"<p>Running SQL Server 2008 R2 and ASP.NET MVC 2 web application on the Virtual Server of big german hosting-provider.</p>\n\n<p>I have a problem to connect to the SQL Server. </p>\n\n<p>On localhost this connection string works fine: </p>\n\n<pre><code> @\"Data Source=LOCAL-HP;Initial Catalog=OnlineVertrag;Integrated Security=True\";\n</code></pre>\n\n<p>I'm using a similar connection string on the server: </p>\n\n<pre><code>@\"Data Source=MYSERVER\\SQLEXPRESS;Initial Catalog=OnlineVertrag;Integrated Security=True\";\n</code></pre>\n\n<p>but nothing happens over there.</p>\n\n<p>Here is my project which I am trying to connect: <a href=\"http://www.hotcont.eu/OnlineVertrag/Home\" rel=\"nofollow\">http://www.hotcont.eu/OnlineVertrag/Home</a></p>\n"},{"tags":["sql-server","sql-server-2008","deprecated"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":624,"score":3,"question_id":5076791,"title":"How to replace REVOKE ALL in SQL Server 2008 R2","body":"<p>How do I replace the <strong>ALL</strong> permission now that it has been revoked: </p>\n\n<pre><code>REVOKE ALL ON dbo.MyObject TO MyUser\n</code></pre>\n\n<p>I'm looping through all the objects in a database and revoking all permissions for a specific user. So if I had to be specific about which permission to revoke, it would be a real hassle because I would have to find out what object I have and then revoke every possible permission for that type of object. Instead of just REVOKE ALL.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13146304,"title":"How to Select Every Row Where Column Value is NOT Distinct","body":"<p>I need to run a select statement that returns all rows where the value of a column (i.e. EmailAddress) is not distinct.</p>\n\n<p>For example, if the table looks like below:</p>\n\n<pre><code>CustomerName     EmailAddress\nAaron            aaron@gmail.com\nChristy          aaron@gmail.com\nJason            jason@gmail.com\nEric             eric@gmail.com\nJohn             aaron@gmail.com\n</code></pre>\n\n<p>I need the query to return:</p>\n\n<pre><code>Aaron            aaron@gmail.com\nChristy          aaron@gmail.com\nJohn             aaron@gmail.com (peer edited from john@gmail.com)\n</code></pre>\n\n<p>I have read many posts and tried different queries to no avail.  The query that I believe should work is below.  Can someone suggest an alternative or tell me what may be wrong with my query?</p>\n\n<pre><code>select EmailAddress, CustomerName from Customers\ngroup by EmailAddress, CustomerName\nhaving COUNT(distinct(EmailAddress)) &gt; 1\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":13144458,"title":"improving performance of a view that is heavily dependent on dates","body":"<p><strong>This view is taking me HOURS to execute:</strong></p>\n\n<pre><code>USE [SalesDWH]\nGO\n\n/****** Object:  View [dbo].[FirstLastEstablished]    Script Date: 10/29/2012 15:12:47 ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER view [dbo].[FirstLastEstablished] as\n\n\nwith cte_min as(\n\nselect \n      a.client_id\n      ,a.specimen_source\n      ,a.received_date\nfrom\n      millennium_dw_dev..F_ACCESSION_DAILY a\njoin\n            (select distinct\n                  f.client_id\n                  ,f.received_date\n                  ,f.accession_daily_key\n            from \n                  millennium_dw_dev..F_ACCESSION_DAILY f\n            join \n                  (select CLIENT_ID, MIN(received_date) MinRecDate\n                  from millennium_dw_dev..F_ACCESSION_DAILY\n                  group by CLIENT_ID) i\n            on f.CLIENT_ID=i.CLIENT_ID\n            and f.RECEIVED_DATE=i.MinRecDate) b\non    \n      a.ACCESSION_DAILY_KEY=b.ACCESSION_DAILY_KEY \n\n)\n\n,\ncte_max as \n(\n\nselect \n      a.client_id\n      ,a.specimen_source\n      ,a.received_date\nfrom\n      millennium_dw_dev..F_ACCESSION_DAILY a\njoin\n            (select distinct\n                  f.client_id\n                  ,f.received_date\n                  ,f.accession_daily_key\n            from \n                  millennium_dw_dev..F_ACCESSION_DAILY f\n            join \n                  (select CLIENT_ID, max(received_date) MaxRecDate\n                  from millennium_dw_dev..F_ACCESSION_DAILY\n                  group by CLIENT_ID) i\n            on f.CLIENT_ID=i.CLIENT_ID\n            and f.RECEIVED_DATE=i.MaxRecDate) b\non    \n      a.ACCESSION_DAILY_KEY=b.ACCESSION_DAILY_KEY \n\n)\n,\n\n\ncte_est as\n\n(\n\nselect distinct client_id, MLIS_DATE_ESTABLISHED\nfrom millennium_dw_dev..D_CLIENT\nwhere REC_ACTIVE_FLG=1\nand MLIS_DATE_ESTABLISHED is not null\n)\n\n,\n\nmainQuery as(\nselect distinct\n      f.client_id\n      ,cmin.specimen_source first_specimen_source\n      ,cmin.received_date first_received\n      ,cmax.specimen_source last_specimen_source\n      ,cmax.received_date last_received\n      ,cest.MLIS_DATE_ESTABLISHED MLIS_DATE_ESTABLISHED\nfrom millennium_dw_dev..F_ACCESSION_DAILY f\nleft join cte_max cmax\non cmax.CLIENT_ID=f.CLIENT_ID\nleft join cte_min cmin\non cmin.CLIENT_ID=f.CLIENT_ID\nleft join cte_est cest\non cest.CLIENT_ID=f.CLIENT_ID\n)\n,\nDateDifferences\nas\n\n(\nSELECT\nclient_id,\n   (DATEDIFF(dd, MLIS_DATE_ESTABLISHED,first_received) + 1)\n  -(DATEDIFF(wk, MLIS_DATE_ESTABLISHED,first_received) * 2)\n  -(CASE WHEN DATENAME(dw, first_received) = 'Sunday' THEN 1 ELSE 0 END)\n  -(CASE WHEN DATENAME(dw, MLIS_DATE_ESTABLISHED) = 'Saturday' THEN 1 ELSE 0 END)\n -(case when cast('01/01/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/26/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/01/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/27/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2008 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/01/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/25/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/03/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/07/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/26/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2009 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/01/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/31/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/05/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/06/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/25/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/24/2010 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/03/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/30/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/05/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/24/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/26/2011 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('01/02/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('05/28/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('07/04/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('09/03/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('11/22/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n-(case when cast('12/25/2012 ' as date) between MLIS_DATE_ESTABLISHED and first_received then 1 else 0 end)\n\n\n   DifferenceExcludingWeekends\n  from\n  mainQuery\n)\n,\nTerritory \nas\n(\nselect distinct c.client_id,c.MLIS_TERRITORY,s.REGION_NAME\nfrom millennium_dw_dev..D_CLIENT c\nleft join millennium_dw_dev..D_SALES_HIERARCHY s\non s.TERRITORY_NAME=c.MLIS_TERRITORY\nwhere c.REC_ACTIVE_FLG=1\nand s.REC_ACTIVE_FLG=1\n\n)\n\nselect mainQuery.*,d.DifferenceExcludingWeekends,Territory.MLIS_TERRITORY,Territory.REGION_NAME\nfrom mainQuery\nleft join DateDifferences d\non mainQuery.CLIENT_ID=d.CLIENT_ID\nleft join Territory\non mainQuery.CLIENT_ID=Territory.CLIENT_ID\n\nGO\n</code></pre>\n\n<p>I did the sql server database tuning on this, and created all the recommended indexes. After 15min of executing the view again, I stopped it. </p>\n\n<p><strong>Are there obvious things that you could kindly point out to me about my query to optimize it more and improve execution time?</strong></p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13145837,"title":"Getting 0 results when I should not be","body":"<p>I am running this query </p>\n\n<pre><code>select * \nfrom PortalUser \nwhere ID not in (select distinct PortalUserID from LoginHistory where LoginDateTime &gt; '10/1/2012')\n</code></pre>\n\n<p>and getting 0 results. </p>\n\n<p>If I run </p>\n\n<pre><code>select distinct PortalUserID \nfrom LoginHistory \nwhere LoginDateTime &gt; '10/1/2012'\n</code></pre>\n\n<p>I get a result set as expected. Lets say 50 results</p>\n\n<p>If I run </p>\n\n<pre><code>select * \nfrom portalUser\n</code></pre>\n\n<p>I get 200 Results.</p>\n\n<p>Why is this?</p>\n\n<p>Just to be clear. The LoginHistory table has a PortalUserID that does not have to be Unique, however the PortalUser..ID is a unique field.</p>\n\n<p>Running this query </p>\n\n<pre><code>select count(ID) \nfrom PortalUser \nGO\nselect count(Distinct PortalUserID) \nfrom LoginHistory where LoginDateTime &gt; '10/1/2012''\n</code></pre>\n\n<p>returns 119 and 47 rows</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":13134555,"title":"sub query in sql server","body":"<p>I have two tables :</p>\n\n<pre><code>create table sales (\n    unitcode int ,\n    categorycode smallint ,\n    ddate varchar(10) ,\n    price float\n)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>create table timetable (\n    year varchar(4) ,\n    month varchar(11) ,\n    ddate varchar(10)\n)\n</code></pre>\n\n<p>I want to write a subquery to find :\n in each month in each year which 2 products(unitcode , categorycode) have a top of price ?</p>\n"},{"tags":["c#","sql","sql-server-2008","smo"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13144755,"title":"How to enable/disable/get status of extendedProtection for Authentication in SQL Server 2008 using C#?","body":"<p>I need to :</p>\n\n<ol>\n<li>Get the status of <a href=\"http://msdn.microsoft.com/en-us/library/ff487261%28v=sql.105%29.aspx\" rel=\"nofollow\">Extended protection for Authentication</a></li>\n<li>Enable Extended Protection</li>\n<li>Disable Extended Protection </li>\n</ol>\n\n<p>in <strong>SQL Server 2008 and 2008 R2</strong> preferably using SQl Server Management Objects (SMO) API using C#.</p>\n\n<p>Can someone point me to the relevant resource that can help me accomplish the above goals?</p>\n\n<p>A non-SMO approach is also welcome. However, an approach that does not involve SQL queries, and uses C# is highly desired.</p>\n"},{"tags":["sql-server-2008","stored-procedures","common-table-expression"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13143284,"title":"Stored procedure as CTE_query_definition","body":"<p>Can I use a stored procedure as the <code>CTE_query_definition</code> of a CTE?</p>\n\n<p>For example:</p>\n\n<pre><code>WITH  CodesCTE\nAS ( Exec sp_TableReturningProc )\nSELECT * FROM CodesCTE;\n</code></pre>\n\n<p>If not, outside of declaring a batch / global temp table and using a <code>Select</code> statement against the temp table, is there a way around this limitation?</p>\n\n<p>I am in the process of developing the associated stored procedure and would love to simply the use of it for this purpose if possible.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":16,"score":-1,"question_id":13143930,"title":"Checking Specific Row's Value and Merge Values","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/194852/concatenate-many-rows-into-a-single-text-string\">Concatenate many rows into a single text string?</a><br>\n  <a href=\"http://stackoverflow.com/questions/10298805/mimic-group-concat-combined-with-group\">Mimic group_concat() combined with group</a>  </p>\n</blockquote>\n\n\n\n<p>this is the source table that I am currently working on:</p>\n\n<p><img src=\"http://i.stack.imgur.com/HSSbF.png\" alt=\"enter image description here\"></p>\n\n<p>And this is the desired output:</p>\n\n<p><img src=\"http://i.stack.imgur.com/xcnAB.png\" alt=\"enter image description here\"></p>\n\n<p>Can I achieve this by simple MSSQL query? Like just using <strong>GROUP BY or JOIN?</strong></p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":24,"score":1,"question_id":13143367,"title":"Use 'JOIN' to select top five records from a table that match a specific column in table two","body":"<p>I have two table:</p>\n\n<pre><code>Audit\nAUDITID |  CUSTOMER  |  CUSTOMERNUMBER\n001     |    BILLY   |  11111 \n002     |    HOLLY   |  12222 \n003     |    HOLLY   | 12222\n004     |    DON     | 13333\n005     |    DON     | 13333\n\nSummary\nAuditID | Summary | Date\n001     |  1      |   30/1/2012\n001     |  2      | 1/10/2012\n001     | 3       |20/10/2012\n004     | 4       | 2/09/2012\n004     | 5       | 3/01/2012\n</code></pre>\n\n<p>I want to select the top five records table for each different AuditID that matches an Audit ID From the Audit table.</p>\n\n<p>The sql script i have so far is :</p>\n\n<pre><code>    SELECT Auditid, summary, date\n    FROM [Summary] SL1\n    INNER JOIN [Audit] AL1 ON SL1.[AuditID] = AL1.[AuditID]  \n    WHERE AL1.[AuditID] IN (  \n    SELECT TOP 5 AuditID  \n    FROM [Audit] AL2  \n    WHERE AL1.[CustomerNumber] = AL2.[CustomerNumber]   \n    ORDER BY AL2.[AuditID] DESC\n    )  \n</code></pre>\n"},{"tags":["sql-server","security","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2907,"score":3,"question_id":6212598,"title":"Server Role to execute SQL Server Agent Jobs in SQL SERVER 2008","body":"<p>The users from other departments ask me to grant them to execute Schedule Jobs / SSIS in SQL Server Agent.  At present, they cannot see SQL Server Agent tree in their ManagmentStudio.  I think, it's because they don't have the rights to execute them.</p>\n\n<p>So, I would like to know which server role should I give to them.  I only want to give them minimum privileges.  When I check the existing roles in my server, I could only see the following server roles</p>\n\n<ol>\n<li>bulkadmin</li>\n<li>dbcreator</li>\n<li>diskadmin</li>\n<li>processadmin</li>\n<li>public</li>\n<li>securityadmin</li>\n<li>serveradmin</li>\n<li>setupadmin</li>\n<li>sysadmin</li>\n</ol>\n\n<p>Please advise me.</p>\n"},{"tags":["c#",".net","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13136332,"title":"How to do a timed SQL server login?","body":"<p>Here is my problem , I am coding a C#  application that will log in to a remote <strong>SQL server 2008 [Express edition to be precise]</strong> and fetch data from the database table (say foo) periodically[after each fetch the SQL client connection is closed ] .</p>\n\n<p>How can I do this process periodically with a time interval like 60 seconds or so (user definable). ??</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","exists"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13141461,"title":"What can I do to speed up this SQL Query?","body":"<p>I've created this SQL query with the help of @Dems :-)</p>\n\n<p>Here is some detail, I tried to make a SQLFiddle but I kept getting errors with my variables... This works in Sql Server 2008...  My question is, how can I make my query faster? I know I'm doing a number of things wrong here (repeated nester queries), I'm hoping to get one of you SQL gurus to take a look and help me get this down from it's 30 minute execution time! :-S</p>\n\n<p>I'm not sure exactly how much information you need to be able to help me on this one, please fire away with any questions and I'll reply ASAP.  Sorry if the level of detail is lacking a little, I just don't know what you want/need to know!</p>\n\n<p>The basic idea behind the query is that in the game I want to find all players which haven't moved 5 units for a period of time, who have fired whilst stood still and did not fire for 60 minutes before they stopped moving.  The query works, but it's the <code>AND NOT EXISTS</code> clause which is slowing things down to a crawl, before I added that it took 16 seconds to run!  16 seconds is still a looong time, so any other improvements would be appreciated, but for now with this being my own POC game (just throwing bits and pieces together), 16 seconds is acceptable... </p>\n\n<pre><code>DECLARE @n INT , @DistanceLimit INT\nSELECT  @n = 2 , @DistanceLimit = 5;\n\nWITH    partitioned\n          AS ( SELECT   * ,\n                        CASE WHEN Distance &lt; @DistanceLimit THEN 1\n                             ELSE 0\n                        END AS PartitionID\n               FROM     EntityStateEvent\n               WHERE    ExerciseID = '8B50D860-6C4E-11E1-8E70-0025648E65EC'\n             ),\n        sequenced\n          AS ( SELECT   ROW_NUMBER() OVER ( PARTITION BY PlayerID ORDER BY EventTime ) AS MasterSeqID ,\n                        ROW_NUMBER() OVER ( PARTITION BY PlayerID, PartitionID ORDER BY EventTime ) AS PartIDSeqID ,\n                        *\n               FROM     partitioned\n             ),\n        filter\n          AS ( SELECT   MasterSeqID - PartIDSeqID AS GroupID ,\n                        MIN(MasterSeqID) AS GroupFirstMastSeqID ,\n                        MAX(MasterSeqID) AS GroupFinalMastSeqID ,\n                        PlayerID\n               FROM     sequenced\n               WHERE    PartitionID = 1\n               GROUP BY PlayerID ,\n                        MasterSeqID - PartIDSeqID\n               HAVING   COUNT(*) &gt;= @n\n             )\n    SELECT\nDISTINCT    ( sequenced.PlayerID ) ,\n            MIN(sequenced.EventTime) AS StartTime ,\n            MAX(sequenced.EventTime) AS EndTime ,\n            DATEDIFF(minute, MIN(sequenced.EventTime),\n                     MAX(sequenced.EventTime)) AS StaticTime ,\n            Player.Designation AS 'Player'\n    FROM    filter\n            INNER JOIN sequenced ON sequenced.PlayerID = filter.PlayerID\n                                    AND sequenced.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                    AND sequenced.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n            INNER JOIN Events ON Events.FiringPlayerID = sequenced.PlayerID \n            INNER JOIN Player ON Player.PlayerID = sequenced.PlayerID\n                                 AND Player.Force = 'FR'\n                                 AND NOT EXISTS ( SELECT    *\n                                                  FROM      Events\n                                                  WHERE     Events.FiringPlayerID = Player.PlayerID\n                                                  GROUP BY  Events.FiringTime\n                                                  HAVING    Events.FiringTime BETWEEN DATEADD(minute,\n                                                              -60,\n                                                              ( SELECT\n                                                              MIN(s.EventTime)\n                                                              FROM\n                                                              sequenced s\n                                                              WHERE\n                                                              s.PlayerID = filter.PlayerID\n                                                              AND s.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                                              AND s.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n                                                              ))\n                                                              AND\n                                                              ( SELECT\n                                                              MIN(s.EventTime)\n                                                              FROM\n                                                              sequenced s\n                                                              WHERE\n                                                              s.PlayerID = filter.PlayerID\n                                                              AND s.MasterSeqID &gt;= filter.GroupFirstMastSeqID\n                                                              AND s.MasterSeqID &lt;= filter.GroupFinalMastSeqID\n                                                              ) )\n            INNER JOIN Player HitPlayer ON HitPlayer.PlayerID = Events.HitPlayerID\n    WHERE   HitPlayer.[FORCE] = 'HO'\n    GROUP BY GroupID ,\n            sequenced.PlayerID ,\n            Events.FiringPlayerID ,\n            Events.FiringTime ,\n            Player.Designation\n    HAVING  DATEDIFF(minute, MIN(sequenced.EventTime),\n                     MAX(sequenced.EventTime)) &gt; 5\n            AND Events.FiringTime BETWEEN MIN(sequenced.EventTime)\n                                  AND     MAX(sequenced.EventTime)\n    ORDER BY StartTime\n</code></pre>\n"},{"tags":["sql-server-2008","amazon-ec2","database-replication"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13098918,"title":"Setup up Sql Server replication on two EC2 instances","body":"<p>I've looked and looked for nearly a whole day on instructions on how to setup Sql server replication on two EC2 instances, first EC2 as a publisher, second one as both disribution and subscription server..</p>\n\n<p>Trouble is, I'm going around in circles, there are great documentations on how to do it on regular servers, but Replication doesn't support IP address, it needs named instances and I don't have that on Amazon EC2. </p>\n\n<p>RDS provides replication, but only for MySql so I don't want to use that right now..</p>\n\n<p>Has anyone successfully set up any kind of replication for MS Sql Server on EC2 instances? \nIs there any blog / documentation describing the faintest details of how to do this? </p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008","reporting-services","charts","business-intelligence"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":3710,"score":1,"question_id":2580282,"title":"SQL Server 2008 Reporting Services Charting - adding a data table to bottom of a chart","body":"<p>I would like to add a data table to bottom of a (line) chart in a report.  I know I can create a matrix report with the same data source.  I would like to have everything lineup automatically like it does when you add a data table to a chart in Excel (as shown at <a href=\"http://www.tushar-mehta.com/excel/newsgroups/data_table/\" rel=\"nofollow\">http://www.tushar-mehta.com/excel/newsgroups/data_table/</a>). </p>\n\n<p>Example from Excel (from above link)\n<img src=\"http://www.tushar-mehta.com/excel/newsgroups/data_table/index.3.gif\" alt=\"Sample Chart\"></p>\n\n<p>Any ideas?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13135069,"title":"Why calling a function takes much more time than direct execution of function code","body":"<p>In my SQL Server 2008 R2 database, I have a query which calls a function. </p>\n\n<p>Lately this query has started to execute very slowly. I found that the user-defined function is hampering all the query. </p>\n\n<p>I tried to execute this function alone and it took 40 seconds to finish, while previously it executed in 3-4 seconds. So I tried to execute code that is inside of function and executed in this 3-4 seconds. </p>\n\n<p>I cannot understand why executing code of function takes far fewer time than calling function itself. I tried all this in SSMS only.</p>\n\n<p>That's the function itself</p>\n\n<pre><code>ALTER FUNCTION [dbo].[fn_SI_GetMark] (@AREA_ID int, @BD datetime, @ED datetime)  \nRETURNS decimal(24, 2) AS  \nBEGIN \n\n\n\nDeclare @mon int;\nset @Mon = 1;\nif(DateDiff(day, @BD, @ED) &gt; 40)\nbegin\n\ndeclare @q1sb datetime; set @q1sb = Convert(datetime, '01.01.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q1eb datetime; set @q1eb = Convert(datetime, '01.04.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q2sb datetime; set @q2sb = Convert(datetime, '01.04.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q2eb datetime; set @q2eb = Convert(datetime, '01.07.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q3sb datetime; set @q3sb = Convert(datetime, '01.07.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q3eb datetime; set @q3eb = Convert(datetime, '01.10.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q4sb datetime; set @q4sb = Convert(datetime, '01.10.'+Convert(nvarchar(4), Year(@BD)));\ndeclare @q4eb datetime; set @q4eb = Convert(datetime, '01.01.'+(Convert(nvarchar(4), Year(@BD) + 1)));\nif((@BD &gt;= @q1sb) and (@BD &lt; @q1eb))\nbegin\n    set @BD = @q1sb;\nend\nelse if((@BD &gt;= @q2sb) and (@BD &lt; @q2eb))\nbegin\n    set @BD = @q2sb;\nend\nelse if((@BD &gt;= @q3sb) and (@BD &lt; @q3eb))\nbegin\n    set @BD = @q3sb;\nend\nelse if((@BD &gt;= @q4sb) and (@BD &lt; @q4eb))\nbegin\n    set @BD = @q4sb;\nend\n\n\n\ndeclare @q1se datetime; set @q1se = Convert(datetime, '01.01.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q1ee datetime; set @q1ee = Convert(datetime, '01.04.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q2se datetime; set @q2se = Convert(datetime, '01.04.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q2ee datetime; set @q2ee = Convert(datetime, '01.07.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q3se datetime; set @q3se = Convert(datetime, '01.07.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q3ee datetime; set @q3ee = Convert(datetime, '01.10.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q4se datetime; set @q4se = Convert(datetime, '01.10.'+Convert(nvarchar(4), Year(@ED)));\ndeclare @q4ee datetime; set @q4ee = Convert(datetime, '01.01.'+(Convert(nvarchar(4), Year(@ED) + 1)));\nif((@ED &gt;= @q1se) and (@ED &lt;= @q1ee))\nbegin\n    set @ED = @q1ee;\nend\nelse if((@ED &gt;= @q2se) and (@ED &lt;= @q2ee))\nbegin\n    set @ED = @q2ee;\nend\nelse if((@ED &gt;= @q3se) and (@ED &lt;= @q3ee))\nbegin\n    set @ED = @q3ee;\nend\nelse if((@ED &gt;= @q4se) and (@ED &lt;= @q4ee))\nbegin\n    set @ED = @q4ee;\nend\n\n\nset @Mon = datediff(month, @BD, @ED) / 3;\n\nend\n\n\ndeclare @i int;\n\nDECLARE @Mark decimal(24, 2); SET @Mark = 0;\ndeclare @count int; SET @count = 0;\n\nDECLARE @AREA_PATH nvarchar(max), @SI_CheckListId int, @SI_CheckListTitle nvarchar(max), @SI_CheckListCreatedBy int;\n\n\nDECLARE @Mark2 decimal(24, 2); set @Mark2 = 0;\ndeclare @count2 int; SET @count2 = 0;\n\n\n\nDECLARE @areaIdStr nvarchar(max);\nset @areaIdStr = convert(nvarchar(max), @AREA_ID);\n\n\nDECLARE db_cursor_rights2 CURSOR\nfor\nSELECT     tbl_SI_CheckList.SI_CheckListId\nFROM         tblArea INNER JOIN\n                  tbl_SI_CheckList ON tblArea.AREA_ID = tbl_SI_CheckList.AreaId\nWHERE ('%/'+tblArea.AREA_PATH+'/%' like '%/'+@areaIdStr+'/%') \nand (((tbl_SI_CheckList.SI_CheckListIsDeleted &lt;&gt; 1) and (tbl_SI_CheckList.SI_CheckListDateCreated &lt;= @ED))\n    or  \n    ((tbl_SI_CheckList.SI_CheckListIsDeleted = 1) and (tbl_SI_CheckList.SI_CheckListDateDeleted is not null) and (tbl_SI_CheckList.SI_CheckListDateDeleted &gt;= @BD) and (tbl_SI_CheckList.SI_CheckListDateCreated &lt;= @ED)))\n\n\nOPEN db_cursor_rights2;  \nFETCH NEXT FROM db_cursor_rights2\nINTO @SI_CheckListId;\nWHILE @@FETCH_STATUS = 0\nBEGIN   \n\n\n    set @i = 1\n    while @i &lt;= @Mon\n    begin\n        set @Mark2 = 0\n        set @count2 = 0\n\n        SELECT     @Mark2 = @Mark2 + Mark\n        FROM       tbl_SI_CheckListRegistr\n        WHERE     (SI_CheckListId = @SI_CheckListId) and ((tbl_SI_CheckListRegistr.DateCreated &gt;= @BD) and (tbl_SI_CheckListRegistr.DateCreated &lt; @ED) and (tbl_SI_CheckListRegistr.IsDeleted &lt;&gt; 1))\n\n        if(@Mark2 is not null)\n        begin \n            set @Mark = @Mark + @Mark2;\n        end\n        set @i = @i + 1;    \n\n        SELECT     @count2 = count(Mark)\n        FROM       tbl_SI_CheckListRegistr\n        WHERE     (SI_CheckListId = @SI_CheckListId) and ((tbl_SI_CheckListRegistr.DateCreated &gt;= @BD) and (tbl_SI_CheckListRegistr.DateCreated &lt; @ED) and (tbl_SI_CheckListRegistr.IsDeleted &lt;&gt; 1))\n\n        if(@count2 = 0)\n        begin \n            set @count2 = @count2 + 1;\n        end \n\n        set @count = @count + @count2;      \n\n    end\n\n    FETCH NEXT FROM db_cursor_rights2\n    INTO @SI_CheckListId;\n\nEND\nCLOSE db_cursor_rights2;\nDEALLOCATE db_cursor_rights2;\n\nif(@count = 0)\nbegin\nset @count = 1;\nend\n\nset @Mark = round(@Mark/@count, 2)\n\nRETURN (@Mark)\n\n\nEND\n</code></pre>\n\n<p>and this is how i try to call it</p>\n\n<pre><code>DECLARE @AREA_ID int; SET @AREA_ID=1;\nDECLARE @BD datetime, @ED datetime;\nSET @BD=cast('2012-10-01' AS DATETIME);\nSET @ED=cast('2012-11-01' AS DATETIME);\nDECLARE @MArk decimal(24,2);\nset @Mark = (select dbo.fn_SI_GetMark(@AREA_ID, @BD, @ED));\nPRINT @Mark\n</code></pre>\n\n<p>Else one thing, i tried to execute this function on another dbserver (there is replication set up between this two servers) and it executes very fast. And another one observation if i call function without parameters, set them in function directly, it is also executes fast.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":13139189,"title":"SQL set Table 1 COL A = Table 2 COL B if Table 1 COL C = Table 2 COL D","body":"<p>I have two tables</p>\n\n<p><strong>Table1</strong></p>\n\n<pre><code>REF1 REF2\n     A\n     B\n     C\n</code></pre>\n\n<p><strong>Table2</strong></p>\n\n<pre><code>UPN Filename\n1   A\n2   B\n3   C\n</code></pre>\n\n<p>what I want to do in SQL is this</p>\n\n<blockquote>\n  <p>If Table1 REF2 = Table2 Filename then set Table1 REF1 = Table2 UPN</p>\n</blockquote>\n\n<p>this is the sql I did</p>\n\n<pre><code>UPDATE    Table1\nSET       REF1 = Table2.UPN\nFROM      Table1 INNER JOIN Table2 \nON        Table1.REF2 = Table2.FileName \n</code></pre>\n\n<p>all this does is take the first value in row 1 of table2 and put it in every row under table1 in <code>REF1</code></p>\n\n<p>eg this is what I get </p>\n\n<p><strong>TABLE1</strong></p>\n\n<pre><code>REF1 REF2\n1    A\n1    B\n1    C\n</code></pre>\n\n<p>this is what I want</p>\n\n<p><strong>TABLE1</strong></p>\n\n<pre><code>REF1 REF2\n1    A\n2    B\n3    C\n</code></pre>\n\n<p>any help appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13139140,"title":"SQL Server 2008 Calculation Bug","body":"<p>Here is the query i am running</p>\n\n<pre><code>Select (100/18)*18\n</code></pre>\n\n<p>The answer i get is 90. I have tried declaring each of the numbers as decimals also, and i get the value <code>100.0008</code>, but when i calculate with variables as floats the answer is correct at '100' so does anyone have any idea why SQL calculates like this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":13138194,"title":"Dependency on master and child in SQL","body":"<p>I have a master table like this</p>\n\n<pre><code>Product    Status  Product id\nA          True     1\nB          True     2\nC          true     3\nD          True     4\nE          false    5\nF          True     6\n</code></pre>\n\n<p>Now I have other table which is giving me the dependency of the product</p>\n\n<pre><code>Product    DependencyId\nC             2\nC             5\nE             1\nB             4\nB             6\n</code></pre>\n\n<p>Now when I searching for C, I can see that two products are dependent upon C now these two product is dependent upon other products.</p>\n\n<p>And let say I am searching for E, then I there are only one dependency of the product.</p>\n\n<p>Now, I need to check for a product that if any dependency is false or not. If any of the dependency is false then I have to return some text/value.</p>\n\n<p><strong>Result</strong></p>\n\n<pre><code>When product is C then output will be E (because the grand children of C (i.e. E) has false)\n\nWhen product is B then output will be NULL (becuase none of the child of B or their sub childrens has false)\n</code></pre>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":383,"score":0,"question_id":8485209,"title":"How to fillter the database null values of integer column in C# using if condition?","body":"<p>I am passing data value, to a database, using integer data type (accepting <code>null</code>). </p>\n\n<p>If in front-end I do not pass any integer it takes <code>null</code> value in db. While retrieving table data in front-end I am using <code>if</code> condition to filter the integer empty values. I have only integers to display, how to write the if condition?</p>\n\n<pre><code>int x;\nif(x!=(which code this place write)\n{\ntextbox.text=x; //x value not empty working if condition else goto else condition\n}\nelse\n{\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13137246,"title":"Column in table is of a type that is invalid for use as a key column in an index","body":"<p>I have a table where I am storing employee details. I want to alter the table and set one of the column <code>emp_code</code> as primary key. Its datatype is <code>nvarchar(max)</code>, but I am not able to set it as primary key.</p>\n\n<p>I run the following query : </p>\n\n<pre><code>ALTER TABLE user_master\nADD PRIMARY KEY (emp_code)\n</code></pre>\n\n<p>but it gives me an error :</p>\n\n<blockquote>\n  <p><em>Msg 1919, Level 16, State 1, Line 1</em><br>\n  <em>Column <code>emp_code</code> in table <code>user_master</code> is of a type that is invalid for use as a key column in an index.</em><br>\n  <em>Msg 1750, Level 16, State 0, Line 1</em><br>\n  <em>Could not create constraint. See previous errors.</em></p>\n</blockquote>\n\n<p>How can I overcome this?</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":13132526,"title":"Selecting Change_Tracking_Current_Version() in SQL Server 2008 table trigger","body":"<p>I am using SQL Server 2008 and Change tracking is enabled on my Database.\nOn one of my tables in the database, I have created the following Trigger.</p>\n\n<pre><code>CREATE TRIGGER [dbo].[tr_student]\n   ON [dbo].[Student]\n   FOR UPDATE,DELETE\nAS \nBEGIN\n   SET NOCOUNT ON;\n   SELECT CHANGE_TRACKING_CURRENT_VERSION()\nEND\n</code></pre>\n\n<p>The purpose of this Trigger is - when I update or delete a record in table dbo.Student I should get the the Current change Tracking Version Id.</p>\n\n<p>But when I update/delete a record in the table, CHANGE_TRACKING_CURRENT_VERSION() is not giving the current version_id but the previous version_id. After the trigger is fired,if I execute \n    select CHANGE_TRACKING_CURRENT_VERSION()\nI am getting the correct current version id.</p>\n\n<p>So does the Change_Tracking_Current_Version() id change only after the trigger? Is there any method to get correct Change_Tracking_Current_Version() in the Trigger?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":4703,"score":2,"question_id":4655981,"title":"SQL Server - use Exists clause in Where and Select","body":"<p>I have a view that's something like</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n</code></pre>\n\n<p>The intent is to fetch all orders that have at least one line item of type 1 along with their current status.</p>\n\n<p>We're in the process of adding a second type of line item, and I have modified the view such that it will include orders that have at least one line item of type 1 or type 2:</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND (EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n  OR EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.Id))\n</code></pre>\n\n<p>Easy enough, but I've just had a requirement added to show whether an order contains line items of type 1 or type 2 (or both) in the grid where these results are displayed:</p>\n\n<pre>\nOrder ID | T1 | T2 | Last name | Price    | Status\n============================================================\n12345    | x  |    | Smith     | $100.00  | In Production\n12346    | x  | x  | Jones     | $147.23  | Part Dispatched\n12347    |    | x  | Atwood    | $12.50   | Dispatched\n</pre>\n\n<p>The only way I can think of is to do:</p>\n\n<pre><code>CREATE VIEW OrdersView WITH SCHEMABINDING AS\nSELECT o.Id, \n       CASE WHEN EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderID = o.Id) THEN 1 ELSE 0 END AS HasType1,\n       CASE WHEN EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.ID) THEN 1 ELSE 0 END AS HasType2,\n       o.OrderDate, o.LastName, o.TotalPrice, s.Status\nFROM dbo.Orders o INNER JOIN dbo.OrderStatus s on o.Id = s.OrderId\nWHERE NOT EXISTS (SELECT NULL from dbo.OrderStatus where OrderId = s.OrderId and StatusDate &gt; s.StatusDate\nAND (EXISTS (SELECT NULL FROM dbo.OrderLineItemType1 WHERE OrderId = o.Id)\n  OR EXISTS (SELECT NULL FROM dbo.OrderLineItemType2 WHERE OrderId = o.Id))\n</code></pre>\n\n<p>But this smells wrong with the duplication of the <code>EXISTS</code> clauses.  Is there a better qway to write it?  Can I make it perform better?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":16,"score":-1,"question_id":13138279,"title":"How to handle millions of records performance in sql server 2008 r2?","body":"<p>1) Handle millions of records performance when data frequently updated. \n2) Process to Insert millions records with in few seconds.</p>\n"},{"tags":["c#","sql-server-2008","gmail","smtp-auth"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2228,"score":0,"question_id":10699296,"title":"The SMTP server requires a secure connection or the client was not authenticated. The server response was: 5.5.1 Authentication Required.","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10698779/the-smtp-server-requires-a-secure-connection-or-the-client-was-not-authenticated\">The SMTP server requires a secure connection or the client was not authenticated. The server response was: 5.5.1 Authentication Required</a>  </p>\n</blockquote>\n\n\n\n<p>I have a problem when i m run this code then error is occured that \"The SMTP server requires a secure connection or the client was not authenticated. The server response was: 5.5.1 Authentication Required. \"</p>\n\n<p>And my code is:</p>\n\n<p><em>Code</em></p>\n\n<pre><code>protected void ImageButton1_Click(object sender, ImageClickEventArgs e)\n{\n\n    MailMessage mail = new MailMessage();\n    mail.To.Add(\"info@msslindia.com\");\n    mail.From = new MailAddress(\"info@msslindia.com\");\n    string body = \"&lt;table&gt;&lt;tr&gt;&lt;td&gt;Company Name:&lt;/td&gt;&lt;td&gt;\" + txt_cname.Text + \"&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Address With No.:&lt;/td&gt;&lt;td&gt;\" + txt_addwithno.Text + \"&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Contact Person:&lt;/td&gt;&lt;td&gt;\" + txt_conperson.Text + \"&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Email Id&lt;/td&gt;&lt;td&gt;\" + txt_email.Text + \"&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Description&lt;/td&gt;&lt;td&gt;\" + txt_description.Text + \"&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\";\n    mail.Body = body;\n    mail.IsBodyHtml = true;\n    SmtpClient smtp = new SmtpClient();\n    smtp.Host = \"smtp.gmail.com\";\n    smtp.Port = 587;\n\n    smtp.Credentials = new System.Net.NetworkCredential(\"info@msslindia.com\", \"12345\");\n    smtp.EnableSsl = true;\n    smtp.Send(mail);\n\n\n    txt_cname.Focus();\n    txt_cname.Text = \"\";\n    txt_addwithno.Text = \"\";\n    txt_conperson.Text = \"\";\n    txt_email.Text = \"\";\n    txt_description.Text = \"\";\n\n}\n</code></pre>\n"},{"tags":["javascript","html","sql-server-2008","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13136694,"title":"How to Insert Data from Html into Sql database in MVC4?","body":"<p>Hi all i have an application where user can build menu how ever they want using drag and drop...i have all the menus listes at the Bottom of the page and at the top i have an Add Column option\nnow user comes and clicks on add column, based on how many menu column he has and drags and drops menu items from the bottom of the page...now waht i want is i have an save option on click of save the data should be inserted into my DB here is my code how i am </p>\n\n<pre><code>             here is the script for Building the menu\n\n                  var i = 1;\n       var z = 1;\n       $(document).ready(function () {\n           $(\"button[id='columnadd']\").click(function () {\n               // create the element\n               var domElement = $('&lt;div id=\"shoppingCart' + i++ + '\" class=\"shoppingCart\"&gt;&lt;h2 class=\"ui-widget-header\"&gt;Add Menu Items Here &lt;img src=\"../Images/delete.png\" id=\"shoppingCart' + z++ + '\" style=\"float: right; cursor:pointer;\" onclick=\"removecolumn(this.id)\"/&gt;&lt;/h2&gt;&lt;aside class=\"ui-widget-content\" id=\"droppable\"&gt;&lt;ol&gt;&lt;li class=\"placeholder\"&gt;Add your items here&lt;/li&gt;&lt;/ol&gt;&lt;/aside&gt;&lt;/div&gt;');\n               var holder = \"#columnholder\";\n               $(\"#columnholder\").append(domElement);\n               //$(this).after(domElement);\n\n               // at this point you have domElement in your page\n\n               // make it droppable\n               domElement.find(\"ol\").droppable({\n                   activeClass: \"ui-state-default\",\n                   accept: '.small_box li',\n                   greedy: true,\n                   drop: function (event, ui) {                          \n                       makeItDroppableToo(event, ui, this);                                             \n                   }\n               });\n           });          \n           function makeItDroppableToo(e, ui, obj) {                  \n               $(obj).find(\".placeholder\").remove();\n               var placeholder = $(\"&lt;ol&gt;&lt;li&gt;Add Sub Menu here&lt;/li&gt;&lt;/ol&gt;\");\n               $(\"&lt;li&gt;&lt;/li&gt;\").append(ui.draggable.text()).append(placeholder).appendTo($(obj));\n\n               // this is the same as the previous one\n               placeholder.droppable({\n                   greedy: true,\n                   // put options here\n                   drop: function (event, ui) {\n                       makeItDroppableToo(event, ui, this);\n                   }\n               });\n           }\n           $(\".small_box li\" ).draggable({\n               appendTo: \"body\",\n               helper: \"clone\"\n           });\n       });\n       function removecolumn(obj) {              \n           $(\"\" + \"#\" + obj + \"\").remove();\n       }\n</code></pre>\n\n<p>here is my html from where he can drag the Menu Items</p>\n\n<pre><code>           &lt;body&gt;    \n&lt;div class=\"top-header\"&gt;&lt;span class=\"heading\"&gt;Menu Builder&lt;/span&gt;&lt;button id=\"preview\" &gt;Save&lt;/button&gt;&lt;button id=\"columnadd\" &gt;Add Column&lt;/button&gt;&lt;/div&gt;\n&lt;div id=\"columnholder\" class=\"column-holder\"&gt;&lt;/div&gt;\n&lt;div class=\"clear\"&gt;&lt;/div&gt;\n&lt;div class=\"menu-items\"&gt;    \n&lt;aside class=\"small_box\"&gt;\n        &lt;div class=\"menu-item-header\"&gt;&lt;h4&gt;BRANDS&lt;/h4&gt;&lt;/div&gt;\n        &lt;ul&gt;\n            &lt;li id =\"brand1\"&gt;&lt;a class=\"\" href=\"#\"&gt;Brand1&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand2\"&gt;&lt;a href=\"#\"&gt;Brand2&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand3\"&gt;&lt;a href=\"#\"&gt;Brand3&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand4\"&gt;&lt;a href=\"#\"&gt;Brand4&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand5\"&gt;&lt;a class=\"\" href=\"#\"&gt;Brand5&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand6\"&gt;&lt;a href=\"#\"&gt;Brand6&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand7\"&gt;&lt;a href=\"#\"&gt;Brand7&lt;/a&gt;&lt;/li&gt;\n            &lt;li id =\"brand8\"&gt;&lt;a href=\"#\"&gt;Brand8&lt;/a&gt;&lt;/li&gt;\n        &lt;/ul&gt;\n    &lt;/aside&gt;\n\n    &lt;aside class=\"small_box\"&gt;\n        &lt;div class=\"menu-item-header\"&gt;&lt;h4&gt;CATEGORIES&lt;/h4&gt;&lt;/div&gt;\n        &lt;ul&gt;\n        &lt;li id =\"category1\"&gt;&lt;a href=\"#\"&gt;Category1&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category2\"&gt;&lt;a href=\"#\"&gt;Category2&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category3\"&gt;&lt;a href=\"#\"&gt;Category3&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category4\"&gt;&lt;a href=\"#\"&gt;Category4&lt;/a&gt;&lt;/li&gt;\n        &lt;li id =\"category5\"&gt;&lt;a href=\"#\"&gt;Category5&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category6\"&gt;&lt;a href=\"#\"&gt;Category6&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category7\"&gt;&lt;a href=\"#\"&gt;Category7&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"category8\"&gt;&lt;a href=\"#\"&gt;Category8&lt;/a&gt;&lt;/li&gt;\n    &lt;/ul&gt;\n    &lt;/aside&gt;\n\n     &lt;aside class=\"small_box\"&gt;\n        &lt;div class=\"menu-item-header\"&gt;&lt;h4&gt;PRODUCTS&lt;/h4&gt;&lt;/div&gt;\n        &lt;ul&gt;\n        &lt;li id=\"Product1\"&gt;&lt;a href=\"#\"&gt;Product1&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product2\"&gt;&lt;a href=\"#\"&gt;Product2&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product3\"&gt;&lt;a href=\"#\"&gt;Product3&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product4\"&gt;&lt;a href=\"#\"&gt;Product4&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"Product5\"&gt;&lt;a href=\"#\"&gt;Product5&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product6\"&gt;&lt;a href=\"#\"&gt;Product6&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product7\"&gt;&lt;a href=\"#\"&gt;Product7&lt;/a&gt;&lt;/li&gt;\n        &lt;li id=\"product8\"&gt;&lt;a href=\"#\"&gt;Product8&lt;/a&gt;&lt;/li&gt;\n    &lt;/ul&gt;\n    &lt;/aside&gt;\n  &lt;/div&gt;\n &lt;/body&gt;\n</code></pre>\n\n<p>Now i have a Db  Menu</p>\n\n<pre><code>            [MenuId],[MenuName],[ParentID]\n</code></pre>\n\n<p>if an user builds His Menu like this</p>\n\n<pre><code>          [Column1]\n\n           Nike\n                Shoe\n                    Sports Shoe\n                    Casual Shoe\n                shirts\n                    Formal Shirts\n\n         [Column2]\n\n\n           Reebok\n                Shoe\n                    Sports Shoe\n                    Casual Shoe\n                shirts\n                    Formal Shirts\n</code></pre>\n\n<p>i should be able to insert in my DB like this</p>\n\n<pre><code>            [MenuId],[MenuName],[ParentID]\n               1    ,Nike       ,\n               2    ,Shoe       ,1 [Nike(Id of Nike)]\n               3    ,Soprts Shoe,2 [shoe(Id of Shoe)]\n               4    ,Casual Shoe,2 [shoe(Id of Shoe)]\n</code></pre>\n\n<p>in this way i should be able to insert my data,cana ny one help me here please ,i am not getting any idea here from where should i start this,</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":33,"score":1,"question_id":13136022,"title":"select from the result of execute(@query)","body":"<p>I am using this SQL query</p>\n\n<pre><code>DECLARE @cols AS NVARCHAR(MAX),\n    @query  AS NVARCHAR(MAX)\n\nselect @cols = STUFF((SELECT distinct ',' + QUOTENAME(Animal2) \n                    from animals\n            FOR XML PATH(''), TYPE\n            ).value('.', 'NVARCHAR(MAX)') \n        ,1,1,'')\n\nset @query = 'SELECT Animal1, ' + @cols + ' from \n             (\n                select animal1, animal2, Corelation\n                from animals\n            ) x\n            pivot \n            (\n                min(Corelation)\n                for animal2 in (' + @cols + ')\n            ) p '\n\nexecute(@query)\n</code></pre>\n\n<p>See <a href=\"http://sqlfiddle.com/#!3/5b713/6\" rel=\"nofollow\">SQL Fiddle with demo</a></p>\n\n<p>When I execute the query I get a table as a return.</p>\n\n<p>How can I select from that table? I tried to use <code>SELECT * FROM (*past here the script*)</code> but it did not work. I just need to use the result of the execute(@query) as a table and select from it (to put it in a new table). How can I do it?</p>\n\n<p>Thanks</p>\n\n<p>NOTE: that query was an answer of <a href=\"http://stackoverflow.com/questions/13125187/sql-query-to-select-records-in-a-specific-format-using-pivot-or-other/\">this SO question</a></p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":18,"score":-1,"question_id":13135891,"title":"Creating a total row to display the total difference of column items in ms sql","body":"<p>I am trying to create a total row that takes items from a column and displays the difference in the total field as opposed to the sum. Is this even possible in SQL?</p>\n\n<pre><code>SELECT P.Part_Number, P.Units_On_Hand \nFROM Part AS P \nWHERE P.Part_Number IN ('AX12', 'AZ52')\n</code></pre>\n\n<p>This is the query I currently have to display the items I need the processing to be done on. How can I amend it to incorporate a total column to show the difference? </p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":10,"score":0,"question_id":13134380,"title":"How to check cell value in GirdView if value is null then GrieView.Visible.Equals(false)","body":"<p>I want to checked value of Checkbox in GridView if any rows is null then next GridView can't show.</p>\n\n<pre><code>//Checkbox GridView1\n        foreach (GridViewRow rowItem in GridView1.Rows)\n        {\n            CheckBox chk = (CheckBox)(rowItem.Cells[4].FindControl(\"chkSelected1\"));\n            if (chk.Checked == false)\n            {\n                GridView2.Visible.Equals(false);\n                break;\n            }\n            else\n            {\n                GridView2.Visible.Equals(true);\n             }\n        }\n</code></pre>\n"},{"tags":["c#","winforms","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":38,"score":-1,"question_id":13134035,"title":"Saving data into two tables","body":"<p>I have two tables in my SQL Server 2008 database, one contains all the information about employee including image &amp; ID also and in another table having storing the image &amp; ID &amp; Image path....</p>\n\n<p>Can I use </p>\n\n<pre><code>insert into table1(e_imagedata) \nvalues(@ImageData1) \nwhere table2.e_id = table1.e_id\n</code></pre>\n\n<p>In SQL Server this query for inserting image in <code>table2</code> &amp; directly it will considered to <code>table1</code>... it doesn't work for now...</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1218,"score":0,"question_id":6490348,"title":"need to Show time in HH:MM format only","body":"<p>i declare a field as <strong>time</strong> in sql. it is storing the date in the format as <strong>HH:MM:SS</strong>. now i want to retrieve the time value in the format <strong>HH:MM</strong>  and show it on the design view. is it possible to show time only in HH:MM? if so how to cast it as <strong>HH:MM</strong> format?</p>\n"},{"tags":["c#","sql-server-2008","sync","syncframework","sql-server-ce-3.5"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12861769,"title":"Synchronisation SQL Server Compact 3.5 in C#","body":"<p>In my project, I want to sync SQL Server Compact 3.5 with MSSQL Server 2008. I passed all steps in Visual Studio 2010 like adding New Item >> Local Database Cache >> Configure Data Synchronization etc. The connection was complated successfully. But after this stage, I don't know how can i do synchronisation. <br>I have a button named \"Check Updates\". When clicked the update button, synchronisation must start and new datas from the MSSQL Server must add \"data.sdf\". I have no idea about how to be. I am a beginner in C# subjects. Could you help me?<br/>Kind regards.</p>\n"},{"tags":["sql-server","oracle","sql-server-2008","sql-server-2005","oracle11g"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13133378,"title":"Data Migration From Oracle To SQL Server","body":"<p>I have Oracle database in that in one or more table I have blob data also, i.e. images are stored, now I would like to move that data to sql server database, what is the best way to do this ?</p>\n\n<p>I would like to test for one table migration which contains image data in the Oracle database and move into SQL Server table.</p>\n\n<p>How do I test for migrating data from one table from Oracle to SQL Server ?</p>\n\n<p>but first thing I would like to confirm is that whether Image data moving from Oracle DB to SQL Server DB is possible, is there anything has to be taken care while migrating ?</p>\n\n<p>Thanks in advance.</p>\n\n<p>With Best Regards</p>\n"},{"tags":["sql-server-2008","jdbc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":13133628,"title":"SQLException - Connection reset error","body":"<p>I am trying to establish a jdbc connection with SQL Server 2008 R2, using the SQLJDBC4 jar file and JDK 1.6. I am using Netbeans IDE and have added the SQLJDBC4 jar and added the path to the database in the 'databases' section in the services. The code is as below:</p>\n\n<pre><code>package connect2;\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.sql.Statement;\n\npublic class Connect2 {\n\n\n    public static void main(String[] args) throws SQLException {\n\n   Connection conn;\n        conn = null;\n           System.out.println(\"Done....\");\n\n           try\n           {\n\n               Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n\n               conn = DriverManager.getConnection (\"jdbc:sqlserver://172.17.39.13\\\\CRM:1433;databaseName=crm_xchanging\",\"crm_xchanging\",\"Welcome001\");\n               System.out.println (\"Database connection established\");\n\n\n           }\n           catch (ClassNotFoundException e)\n           {\n               System.out.println (e);\n           }\n           catch (SQLException ex)\n           {\n               System.out.println(\" error\");\n           }\n\n\n          finally\n         {\n             if (conn != null)\n              {\n\n                       try{\n\n               Statement st = conn.createStatement();\n                ResultSet res = st.executeQuery(\"SELECT * FROM  usertable\");\n                System.out.println(\"User Name: \" );\n                        while (res.next()) {\n                                String employeeName = res.getString(\"user_name\");\n                                System.out.println(employeeName);\n                                            }\n                    conn.close();\n    }\n                 catch(SQLException ex){\n  System.err.println(\"SQLException information\");\n\n  while(ex!=null) {\n  System.err.println (\"Error msg: \" + ex.getMessage());\n  System.err.println (\"SQLSTATE: \" + ex.getSQLState());\n  System.err.println (\"Error code: \" + ex.getErrorCode());\n  ex = ex.getNextException(); \n// For drivers that support chained exceptions\n  }}\n\n\n\n\n               }\n           }\n\n       }\n\n   }\n</code></pre>\n\n<p>This is the output I'm getting:</p>\n\n<pre><code>run:\nDone....\nDatabase connection established\nSQLException information\nError msg: Connection reset\nSQLSTATE: 08S01\nError code: 0\nBUILD SUCCESSFUL (total time: 1 second)\n</code></pre>\n\n<p>I don't think there is any mistake in the code or the JDK. I have also tried to set the max no. of active connections for SQL Server as 0 (infinite). How do I solve this problem?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":1871,"score":2,"question_id":4875513,"title":"error in Multiple Select statements in Insert statement","body":"<p>I am writing a query which has multiple select statements in an insert statement</p>\n\n<pre><code>    INSERT INTO dbo.Products \n    (ProductName, \n     SupplierID, \n     CategoryID, \n     UnitsInStock, \n     UnitsOnOrder, \n     ReorderLevel, \n     Discontinued)\nVALUES  \n    ('Twinkies' , \n     (SELECT SupplierID FROM dbo.Suppliers WHERE CompanyName = 'Lyngbysild'),\n     (SELECT CategoryID FROM dbo.Categories WHERE CategoryName = 'Confections'), \n     0, \n     0, \n     10, \n     0)\n</code></pre>\n\n<p>Actually it gives error</p>\n\n<pre><code>Msg 1046, Level 15, State 1, Line 4\nSubqueries are not allowed in this context. Only scalar expressions are allowed.\nMsg 102, Level 15, State 1, Line 4\nIncorrect syntax near ','.\n</code></pre>\n\n<p>Where these two select statements returns only one value.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12539681,"title":"Renaming all constraint names with user defined names","body":"<p>How do I query the database for all types of constraints such as Primary Key,Foreign Key, Unique Key, and Default Constraint, and rename its system generate name to a name in following format:</p>\n\n<ul>\n<li>PK_ColumnName1_ColumnName2</li>\n<li>FK_ColumnName1</li>\n<li>UK_ColumnName1_ColumnName2</li>\n<li>DF_ColumnName1</li>\n</ul>\n"},{"tags":["sql-server","sql-server-2008","replication"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":125,"score":1,"question_id":5820706,"title":"Adding foreign key constrain fails on subcriber","body":"<p>I have a replicated database using SQL Server 2008. Here is what I am trying to do.</p>\n\n<ol>\n<li>Create a new table  (MyNewTable)</li>\n<li>Create a column in an existing Table (MyExistingTable)</li>\n<li>Create a FK constraint on this column (in #2) as it points to PK to new table from #1.</li>\n</ol>\n\n<p>However when data get replicated to subscriber, i get following error in replication monitor.</p>\n\n<blockquote>\n  <p>The schema script \"script for adding foreign key constraint\" could not be propagated to the subscriber. (Source: MSSQL_REPL, Error number: MSSQL_REPL-2147201001)\n  Get help: <a href=\"http://help/MSSQL_REPL-2147201001\" rel=\"nofollow\">http://help/MSSQL_REPL-2147201001</a>\n  Foreign key \"MyFKConstraint\" references invalid table \"MyNewTable\" (Source: MSSQLServer, Error number: 1767)</p>\n</blockquote>\n\n<p>This script runs fine on publisher though. Some people seem to suggest that adding foreign key constraint cannot be done in a replicated environment when its created between an existing table and a new table. This is kind of hard to buy for me although I am kind of new to SQL Server replication. Any thoughts?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":88,"score":3,"question_id":13048811,"title":"CTE parent-child showing siblings","body":"<p>I have a CTE-query that displays a tree using recursion. This works great when displaying the whole tree. But I want to pass in ID as a variable and include the siblings for each current node.</p>\n\n<p>Testcode:</p>\n\n<pre><code>DECLARE @TT TABLE \n(\nID int,\nName varchar(25),\nParentID int,\nSortIndex int\n)\n\nINSERT @TT \nSELECT 1, 'A', NULL, 1 UNION ALL\nSELECT 2, 'B_1', 3, 1 UNION ALL\nSELECT 3, 'B', 1, 2 UNION ALL\nSELECT 4, 'B_2', 3, 2 UNION ALL\nSELECT 5, 'C', 1, 3 UNION ALL\nSELECT 6, 'C_2', 5, 2  UNION ALL\nSELECT 7, 'A_1', 1, 1 UNION ALL\nSELECT 8, 'A_2', 1, 2 UNION ALL\nSELECT 9, 'C_1', 5, 1 \n\n\n;WITH CTETree\nAS\n(\n    SELECT *, CAST(NULL AS VARCHAR(25)) AS ParentName, 1 AS Lev,\n    CAST(ROW_NUMBER() OVER(ORDER BY SortIndex) AS VARBINARY(MAX)) AS SortPath\n    FROM @TT\n    WHERE ParentID IS NULL\n\n    UNION ALL\n\n    SELECT F.*, CTETree.Name AS ParentName, Lev + 1,\n    SortPath + CAST(ROW_NUMBER() OVER(ORDER BY F.SortIndex) AS BINARY(32))\n    FROM @TT AS F\n    INNER JOIN CTETree\n    ON F.ParentID = CTETree.ID \n)\n\nSELECT * FROM CTETree\n    ORDER BY SortPath\n\n/*\nDESIRED RESULT:\n\nWHEN ID = 3 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n2   B_1 3   1   B   3\n4   B_2 3   2   B   3\n5   C   1   3   A   2\n\nWHEN ID = 1 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n5   C   1   3   A   2\n\nWHEN ID = 9 PASSED IN:\n\n1   A   NULL    1   NULL    1\n3   B   1   2   A   2\n5   C   1   3   A   2\n9   C_1 5   1   C   3\n6   C_2 5   2   C   3\n\n*/\n</code></pre>\n\n<p>SQL-Fiddle: <a href=\"http://sqlfiddle.com/#!3/d41d8/5526\" rel=\"nofollow\">http://sqlfiddle.com/#!3/d41d8/5526</a></p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":18,"score":1,"question_id":13124280,"title":"SSRS 'rsAccessed Denied' for Users Present in Security","body":"<p>I am having an interesting issue with SSRS and security settings. I have 2008 R2 installed on a Windows Server 2008 box. All users log into their workstations using their active directory credentials, some are local admins, some are just standard users. I have no problem accessing either the management or directory site as DOMAIN\\administrator. </p>\n\n<p>I have all reports, folders and data sources set to inherit the security settings on the server, but when I go to a users machine and type in the server address (host/reportserver), I get rsAccess Denied DOMAIN\\USER user has insufficient permissions. </p>\n\n<p>I have tried a number of different things based on posts I've read. </p>\n\n<ul>\n<li>Added NT Authority\\Authenticated Users and NT Authority\\Network\nService to security permissions </li>\n<li>Gave users 'Administrator' level access on the report server</li>\n<li>Disabled UAC on the workstation   </li>\n</ul>\n\n<p>I read that launching IE as administrator might solve the issue. That would require all users to be local admins, no? I think that is an unacceptable solution.</p>\n\n<p>As always, I appreciate assistance anyone can offer.</p>\n"},{"tags":["sql-server-2008","sql-update","aggregate-functions","common-table-expression"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":46,"score":2,"question_id":12983982,"title":"Aggregate CTE and Update Query","body":"<p>I have studied a number of aggregate and CTE post but have not found a solution for updating a minumum value from a CTE to an additional (non-CTE) outside table.  This is using SQL 2008 (Microsoft managment studio).  I am combining dates from an appointment table, dates for services from a billing table, and then cross checking those with a field in a patient table.  If that field called New Patient Date is blank, I want to update it with the earliest date from the other two tables.  They all joined on a common ID called chart or chart number. Here is the code...Any insights?</p>\n\n<pre><code>WITH New_Patients (chart_nbr, First_Visit)\n  AS\n  ( SELECT A.[Chart], MIN(A.[Appt Date])\n      FROM Appointment AS A, Patient AS P\n      WHERE A.[Chart] = P.[Chart Number]\n        AND A.[Appt Date] IS NOT NULL\n      GROUP BY A.[Chart]\n\n   UNION\n\n   SELECT BD.[Chart], MIN(BD.[Service Date 1])\n    FROM [Billing Detail] AS BD, Patient AS P \n    WHERE BD.[Chart] = P.[Chart Number]\n      AND [Transaction Code] IN \n         ('99201', '99202', '99203', '99204', '99205', '99211', '99212', '99213', \n         '99214', '99215', '99241', '99242', '99243', '99244', '97001', '97002')\n      AND BD.[Service Date 1] IS NOT NULL\n    GROUP BY BD.[Chart]\n\n   UNION\n\n   SELECT P.[Chart Number], P.[New Patient Date]\n     FROM Patient AS P\n     GROUP BY P.[New Patient Date], P.[Chart Number]  )\n\nUPDATE [Patient]    \nSET Patient.[New Patient Date]=MIN(First_Visit)\nFROM Patient AS P, New_Patients AS NP\nWHERE P.[Chart Number] = NP.chart_nbr\n    AND P.[New Patient Date]IS NULL\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13130303,"title":"SQL Server Query with boolean issue","body":"<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nalter PROCEDURE [dbo].[TCCPAUsersAndNamesByJobPosition] @EmpOrfreeLance bit\n\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    SELECT distinct t1.UserId , tblCustomers.name \n    FROM tblTime t1\n    inner join tblCustomers on t1.UserId=tblCustomers.custID\n    where (t1.userid in (select distinct custID from tblCustomers where sectionCat Like '%,35%') )\n    AND (t1.UserId in (select distinct custID from tblCustomers where IsEmployee = @EmpOrfreeLance))\n\nend\n</code></pre>\n\n<p>tried it also with  <code>IsEmployee = CONVERT(bit,@EmpOrfreeLance)</code></p>\n\n<p>and <code>SET @EmpOrfreeLance= CASE @EmpOrfreeLance WHEN 1 THEN 0 ELSE 0 END</code></p>\n\n<p>same all it retuns same list with same results no matter what </p>\n\n<p>Shouldn't it be simple ???</p>\n\n<p><code>IsEmployee</code> col-datatype is <code>(bit,null)</code></p>\n\n<p>my dev SQL server is 2008 ..online server is 2005 should it be a matter ...  </p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13130411,"title":"How to test SQL Server stored procedure with external database reference?","body":"<p>I've inherited a system with the following in a stored procedure.</p>\n\n<pre><code>SELECT blah, bleah FROM ThirdPartyDB.dbo.SomeView\n</code></pre>\n\n<p><code>ThirdPartyDB</code> is a client interface DB which we don't have access to other than the a fore mentioned view. All this works fine in production, but currently I can't test it because I don't have a <code>ThirdPartyDB</code> on the test server.</p>\n\n<p>Obviously I'd like to address this, but I'm wondering what is the best way to go about this?</p>\n\n<p>Is just creating a new DB on the test server with a table named <code>SomeView</code>, which seems the simplest approach the best way, or is there a better way I'm not aware of?</p>\n"},{"tags":["c#","sql-server-2008","date","time"],"answer_count":4,"favorite_count":0,"up_vote_count":7,"down_vote_count":0,"view_count":5993,"score":7,"question_id":655049,"title":"What are equivalent C# datatypes for the new \"date\", \"time\" and \"datetimeoffset\" types?","body":"<p>What are the most suitable equivalent C# datatypes for the new \"date\", \"time\" and \"datetimeoffset\" datatypes in Sql Server 2008?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","bulkinsert"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1356,"score":3,"question_id":10507162,"title":"Determine ROW that caused \"unexpected end of file\" error in BULK INSERT?","body":"<p>i am doing a bulk insert:</p>\n\n<pre><code>DECLARE @row_terminator CHAR;\nSET @row_terminator = CHAR(10); -- or char(10)\n\nDECLARE @stmt NVARCHAR(2000);\nSET @stmt = '\n  BULK INSERT accn_errors\n   FROM ''F:\\FullUnzipped\\accn_errors_201205080105.txt''\n   WITH \n      (\n        firstrow=2,\nFIELDTERMINATOR = ''|''  ,\nROWS_PER_BATCH=10000\n   ,ROWTERMINATOR='''+@row_terminator+'''\n   )'\nexec sp_executesql @stmt;\n</code></pre>\n\n<p>and am getting the following error:</p>\n\n<pre><code>Msg 4832, Level 16, State 1, Line 2\nBulk load: An unexpected end of file was encountered in the data file.\nMsg 7399, Level 16, State 1, Line 2\nThe OLE DB provider \"BULK\" for linked server \"(null)\" reported an error. The provider did not give any information about the error.\nMsg 7330, Level 16, State 2, Line 2\nCannot fetch a row from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>is there a way to know on which ROW this error occurred?</p>\n\n<p>i am able to import 10,000,000 rows without a problem and error occurs after that</p>\n"},{"tags":["asp.net-mvc-3","sql-server-2008","dapper"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13127886,"title":"Dapper returns null for SingleOrDefault(DATEDIFF(...))","body":"<p>I have a SQL statement similar to:</p>\n\n<p><code>SELECT DATEDIFF(Day, startDate, endDate) FROM Data WHERE ProjectId=@id</code></p>\n\n<p>In the case where <code>Data</code> doesn't have any records for <code>ProjectId</code>, SQL Server returns null.</p>\n\n<p>In Dapper, I execute this via:</p>\n\n<p><code>value = conn.Query&lt;int&gt;(\"...\").SingleOrDefault()</code></p>\n\n<p>In this case, I expect the semantics of <code>SingleOrDefault</code> to mean \"if this is null, return zero.\" In fact, my code is even more zero-friendly:</p>\n\n<pre><code>int toReturn = 0;\nusing (var conn = ...) {\n  toReturn = conn.Query&lt;int&gt;(\"SELECT DATEDIFF(...))\");\n}\nreturn toReturn;\n</code></pre>\n\n<p>When I debug and step into this code, I find that the line <code>yield return (T)func(reader)</code> is throwing a null pointer exception.</p>\n\n<p>Am I doing something wrong here, or is this by design?</p>\n\n<p>(FYI, the work-around is to wrap my select in an <code>ISNULL(..., 0)</code>)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":57,"score":-1,"question_id":13127166,"title":"how to get median for every record?","body":"<p>There's no median function in sql server, so I'm using this wonderful suggestion:</p>\n\n<p><a href=\"http://stackoverflow.com/a/2026609/117700\">http://stackoverflow.com/a/2026609/117700</a></p>\n\n<p>this computes the median over an entire dataset, but I need the median per record.</p>\n\n<p>My dataset is:</p>\n\n<pre><code>+-----------+-------------+\n| client_id | TimesTested |\n+-----------+-------------+\n|    214220 |           1 |\n|    215425 |           1 |\n|    212839 |           4 |\n|    215249 |           1 |\n|    210498 |           3 |\n|    110655 |           1 |\n|    110655 |           1 |\n|    110655 |          12 |\n|    215425 |           4 |\n|    100196 |           1 |\n|    110032 |           1 |\n|    110032 |           1 |\n|    101944 |           3 |\n|    101232 |           2 |\n|    101232 |           1 |\n+-----------+-------------+\n</code></pre>\n\n<p>here's the query I am using:</p>\n\n<pre><code>select client_id,  \n    (\n    SELECT\n    (\n     (SELECT MAX(TimesTested ) FROM\n       (SELECT TOP 50 PERCENT t.TimesTested \n       FROM counted3 t \n       where t.timestested&gt;1 \n       and CLIENT_ID=t.CLIENT_ID \n       ORDER BY t.TimesTested ) AS BottomHalf)\n     +\n     (SELECT MIN(TimesTested ) FROM\n       (SELECT TOP 50 PERCENT t.TimesTested \n       FROM counted3 t \n       where t.timestested&gt;1 \n       and CLIENT_ID=t.CLIENT_ID \n       ORDER BY t.TimesTested DESC) AS TopHalf)\n    ) / 2 AS Median\n    ) TotalAvgTestFreq\nfrom counted3 \n\ngroup by client_id\n</code></pre>\n\n<p>but it is giving my funny data:</p>\n\n<pre><code>+-----------+------------------+\n| client_id | median???????????|\n+-----------+------------------+\n|    100007 |               84 |\n|    100008 |               84 |\n|    100011 |               84 |\n|    100014 |               84 |\n|    100026 |               84 |\n|    100027 |               84 |\n|    100028 |               84 |\n|    100029 |               84 |\n|    100042 |               84 |\n|    100043 |               84 |\n|    100071 |               84 |\n|    100072 |               84 |\n|    100074 |               84 |\n+-----------+------------------+\n</code></pre>\n\n<p><strong>i can i get the median for every client_id ?</strong></p>\n\n<p>I am currently trying to use this <strong>awesome</strong> query from Aaron's site:</p>\n\n<pre><code>select c3.client_id,(\n    SELECT AVG(1.0 * TimesTested ) median\n    FROM\n    (\n        SELECT o.TimesTested , \n        rn = ROW_NUMBER() OVER (ORDER BY o.TimesTested ), c.c\n        FROM counted3 AS o\n        CROSS JOIN (SELECT c = COUNT(*) FROM counted3) AS c\n        where count&gt;1\n    ) AS x\n    WHERE rn IN ((c + 1)/2, (c + 2)/2)\n    ) a\n    from counted3 c3\n    group by c3.client_id\n</code></pre>\n\n<p>unfortunately, as Richardthekiwi points out:</p>\n\n<blockquote>\n  <p>it's for a single median whereas this question is about a median\n  per-partition</p>\n</blockquote>\n\n<p>i would like to know how i can join it on <code>counted3</code> to get the median per partition?></p>\n"},{"tags":["sql","sql-server-2008","tsql","sql-order-by"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":60,"score":1,"question_id":13128296,"title":"SQL Query: Need order by count, most must be on top, the rest follows","body":"<p>TABLEA</p>\n\n<pre><code>JobCode Job1 Job2 Job3 zip\n------- ---- ---- ---- ----------\nF       F    S    NULL 90030\nF       F    S    NULL 90031\nF       F    S    NULL 90031\nF       F    S    NULL 90034\nF       F         NULL 90034\nF       F    S    NULL 90034\nF       F    S    NULL 90034\nF       F         NULL 90034\nF       F    S    NULL 90035\nF       F         NULL 90035-4640\n</code></pre>\n\n<p>EXPECTED RESULTS:</p>\n\n<pre><code>JobCode Job1 Job2 Job3 zip\n------- ---- ---- ---- ----------\nF       F    S    NULL 90034\nF       F         NULL 90034\nF       F    S    NULL 90034\nF       F    S    NULL 90034\nF       F         NULL 90034\nF       F    S    NULL 90031\nF       F    S    NULL 90031\nF       F    S    NULL 90030\nF       F    S    NULL 90035\nF       F         NULL 90035-4640\n</code></pre>\n\n<p>Those with the SAME Zip should be ON top, then the rest follows. \nORDER BY Zip does not work because it DOES sort by ZIP, and NOT by number of occurence</p>\n\n<p>Using SQL Server 08</p>\n"},{"tags":["sql-server-2008","table","insert","network-programming","locking"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13128026,"title":"Lock table before inserting into it","body":"<p>I created a C# application that works with network. And I use SQL Server 2008 Express for my application.</p>\n\n<p><strong>My problem is:</strong></p>\n\n<p>When 2 people on 2 computers at exactly the same time click on the <code>Insert</code> button, 2 rows are added into the database with the same number (that is the fault).</p>\n\n<p>If time does not same, my application check some conditions and this problem will not occur.</p>\n\n<p><strong>My question is:</strong></p>\n\n<p>Now I want lock table before insert for 1 person and unlock table after insert.</p>\n\n<p>How to do this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":15,"score":-2,"question_id":13128093,"title":"Master,Child and a link table","body":"<p>I have a two tables (Invoice, Item) and a link or junction table(InvoiceItem)</p>\n\n<p>I enter data in the two tables(Invoice,Item) via seperate forms in vb.net. how to update the link table automatically as it hold the fk of these tables.</p>\n\n<p>Table created in sql server 2008</p>\n\n<p>Table Invoice\nInvNo Pk\nInvDate</p>\n\n<p>Table Item\nItemID Pk\nItemDescription</p>\n\n<p>Table InvoiceItem\nInvNo FK\nItemID FK</p>\n\n<p>Please assist by giving the code for the stored procedure and the vb.net front end coding</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13034169,"title":"how to aggregate values from a pivot?","body":"<p>my query returns a dataset that looks like this:</p>\n\n<pre><code>+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n| CLIENT_ID | count1 | TestFreq1 | stdv1 | count2 | TestFreq2 |  stdv2  | count3 | TestFreq3 |  stdv3  | count4 | TestFreq4 |  stdv4  | count5 | TestFreq5 |  stdv5  | count6 | TestFreq6 |  stdv6  | count7 | TestFreq7 |  stdv7  | count8 | TestFreq8 |  stdv8  | count9 | TestFreq9 |  stdv9  | count10 | TestFreq10 | stdv10 | count11 | TestFreq11 | stdv11  | count12 | TestFreq12 | stdv12 |\n+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n|    210893 |    136 |         0 |     0 |     81 |        41 | 79.2685 |     19 |        63 | 58.321  |     24 |        21 | 20.4896 |      5 |        25 | 8.228   |      6 |        24 | 24.0638 |      4 |        25 | 24.6103 | 2      | 25        | 2.12132 |      2 |        23 | 21.9203 | 1       | 33         | NULL   |       2 |         29 | 7.77817 | 1       | 38         | NULL   |\n|    123321 |     50 |         0 |     0 |      5 |        26 | 7.87401 |     14 |        45 | 51.8002 |      3 |        25 | 14.7422 |      2 |        22 | 17.6777 |      4 |        36 | 21.4942 |      3 |        36 | 22.2711 | NULL   | NULL      | NULL    |      4 |        35 | 9.30949 | NULL    | NULL       | NULL   |       1 |         31 | NULL    | NULL    | NULL       | NULL   |\n|    454322 |    232 |         0 |     0 |    173 |        10 | 33.8487 |     36 |        36 | 36.6602 |     32 |        15 | 17.485  |     10 |        38 | 22.4809 |     13 |        23 | 20.0477 |      7 |        18 | 11.4143 | 3      | 32        | 24.5425 |      6 |        25 | 16.8602 | 3       | 28         | 21.166 |       2 |         25 | 4.94975 | 1       | 34         | NULL   |\n+-----------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+--------+---------+------------+---------+---------+------------+--------+\n</code></pre>\n\n<p><strong>instead of forcing the data to go out to <code>count13, stdv13, testfreq13, ..14..14..14, 15.15.15</code> how can i aggregate all the values 12 and over in the same field?</strong></p>\n\n<p>here's my query, and thank you so much for your guidance:</p>\n\n<pre><code>;WITH counted AS (\n  SELECT\n    client_id,\n    COUNT(*) AS TimesTested,\n    (datediff(day,MIN(received_date),max(received_date)))\n  /COUNT(*) as TestFreq\n  FROM f_accession_daily\n  GROUP BY\n    client_id,\n    patient_id\n),\ncounted2 as (\n  SELECT\n    client_id,\n    TimesTested,\n    CAST(COUNT(*) AS varchar(30)) AS count,\n    CAST(AVG(testfreq) as varchar(30)) as TestFreq,\n    CAST(STDEV(TestFreq) as varchar(30)) Stdv\n  FROM counted\n  GROUP BY\n    client_id,\n    TimesTested\n    )\n    ,\nunpivoted AS (\n  SELECT\n    client_id,\n    ColumnName + CAST(TimesTested AS varchar(10)) AS ColumnName,\n    ColumnValue\n  FROM counted2\n  UNPIVOT (\n    ColumnValue FOR ColumnName IN (count, TestFreq,stdv)\n  ) u\n),\npivoted AS (\n  SELECT\n    client_id clientid,\n    count1, TestFreq1,stdv1,\n    count2, TestFreq2,stdv2,\n    count3, TestFreq3,stdv3,\n    count4, TestFreq4,stdv4,\n    count5, TestFreq5,stdv5,\n    count6, TestFreq6,stdv6,\n    count7, TestFreq7,stdv7,\n    count8, TestFreq8,stdv8,\n    count9, TestFreq9,stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n  FROM unpivoted\n  PIVOT (\n    MAX(ColumnValue) FOR ColumnName IN (\n      count1,TestFreq1,stdv1,\n      count2,TestFreq2,stdv2,\n      count3,TestFreq3,stdv3,\n      count4,TestFreq4,stdv4,\n      count5,TestFreq5,stdv5,\n      count6,TestFreq6,stdv6,\n      count7,TestFreq7,stdv7,\n    count8, TestFreq8,   stdv8,\n    count9, TestFreq9,   stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n    )\n  ) p\n)\nselect * from pivoted\n</code></pre>\n\n<p>just to clarify i want to return the same exact results, it's just that for the last column i want to aggregate all values that fall into the <code>12+ bucket</code>. all the fields are going to be the same except the last three, which are going to be:</p>\n\n<pre><code>+----------+-------------+---------+\n| count12+ | TestFreq12+ | stdv12+ |\n+----------+-------------+---------+\n| 353      | 32423       | NULL    |\n| NULL     | NULL        | NULL    |\n| 342      | 25324       | NULL    |\n+----------+-------------+---------+\n</code></pre>\n\n<p>please note the much greater numbers above compared to the rest because the <strong>12+</strong> have been aggregated.</p>\n\n<p>thank you so much for your guidance!</p>\n"},{"tags":["sql-server-2008","database-design","sql-view"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":116,"score":0,"question_id":12044792,"title":"Column name collision in SQL Server view joining database architecture","body":"<p>First of all, sorry the way I write, bad English here.</p>\n\n<p>Please, consider the following scenario:</p>\n\n<p>I made my database architecture combining views as such:</p>\n\n<ul>\n<li>Entity <code>City</code> has the columns { <code>city_id, city_name, state_name, ...</code> }</li>\n<li>Entity <code>User</code> has the columns { <code>user_id, user_name, user_login, city_id, ...</code> }</li>\n</ul>\n\n<p>Each entity has a view, the <code>city</code> view does not have FK to any other entity, so its a simple select.</p>\n\n<p><code>User</code> entity have one FK to <code>city</code> entity, so it makes a join with the <code>city</code> entity in the view.</p>\n\n<p>As the following example:</p>\n\n<pre><code>create view vw_user as\n    select user.user_id,\n           user.user_name,\n           user.user_login,\n           vw_city.*\n    from user (nolock)\n    inner join vw_city (nolock) on vw_city.city_id = user.city_id\ngo\n</code></pre>\n\n<p>So if you have an entity like user_access with a FK to user, the view of <code>user_access</code> will have an inner join to <code>vw_user</code>, and it will bring up all the columns from <code>user</code> and <code>city</code> entities.</p>\n\n<p>In the end, I just make a query on the view, and it returns the full entity with all the foreign references.</p>\n\n<p>This works great, and make the maintenance procedures very easier, I have a stored procedure that recompile all the views if any change is needed to one of the entities.</p>\n\n<p>But, it has a problem, and I discovered this in a very bad situation, the system that uses this architecture is working very fast and smooth already, and I need to join two entities that share the entity city for example, so it generates a collision of columns, SQL Server does not allow this in views, you can execute a query with collision with no problem, but you can't do it in a view.</p>\n\n<p>So, this is my problem, I need to find a way to fix this, but I can't find an answer to it myself.</p>\n\n<p>The only thing I ended up doing is making a hard-coded view with the columns renamed.</p>\n\n<p>But I want a solution for the entire architecture, something permanent, like an upgrade.</p>\n\n<p>This architecture is followed in code, with C#, so there is a dependence on the column names.</p>\n\n<p>When I read the data from the query, I need to get the data from the column name, so this code can be reused with other classes, doing the same thing that the view does in the query, in the c# code.</p>\n\n<p>So, getting data with ordinal is out of the question.</p>\n\n<p>Any ideas?</p>\n\n<p>Thanks, and sorry, but this is very hard to describe.</p>\n"},{"tags":["java","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":43,"score":-3,"question_id":13126723,"title":"Connect to sql server 2008 using java","body":"<pre><code>    public static String executeDML(String command) \n    {\n        // Create a variable for the connection string.\n        String connectionUrl = \"jdbc:sqlserver://localhost:1433;databaseName=Args\";\n            //\"databaseName=Args;integratedSecurity=true;\";\n        // Declare the JDBC objects.\n        java.sql.Connection con = null;\n        java.sql.Statement stmt = null;\n         java.sql.ResultSet rs = null;\n            try \n            {\n                // Establish the connection.\n                //Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n                    con =  java.sql.DriverManager.getConnection(connectionUrl);\n                    // Create and execute an SQL statement that returns some data.\n                    stmt = con.createStatement();\n                    rs = stmt.executeQuery(command);\n                    // Iterate through the data in the result set and display it.\n                    while (rs.next()) {\n                         return rs.getString(\"ProductNumber\");\n                    }\n                    return \"\";\n            }\n        // Handle any errors that may have occurred.\n        catch (Exception e) {\n            return e.getMessage();\n        }\n        finally {\n            if (rs != null) try { rs.close(); } catch(Exception e) {}\n                if (stmt != null) try { stmt.close(); } catch(Exception e) {}\n                if (con != null) try { con.close(); } catch(Exception e) {}\n        }\n    }\n</code></pre>\n\n<p>this code to connect sql server 2008 using java , but it raised an exception when java.sql.DriverManager.getConnection(connectionUrl) method is called.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13122395,"title":"Removing quotes added to column names from Excel import SQL Server 2008","body":"<p>I've noticed that when I use SSMS to import an Excel spreadsheet into SQL Server quotation marks are added.  I've read somewhere that for whatever reason it's necessary for Excel to do this.  Once in SQL Server, these quotes around the column names are useless and I'd like to have a programmatic way to remove them.  The closest thing, which doesn't work, that I have tried to make is <code>EXEC sp_rename 'Table.[\"withquotes\"]', NewColumnName, 'replace(Table.[\"withquotes\",'\"','']</code>.  I'd like to loop through all of the column names in a table and use the <code>replace</code> function wherever a those column names contain quotation marks.  Is there a typical, idiomatic way to do this?</p>\n"},{"tags":["sql","sql-server-2008","pivot"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":80,"score":0,"question_id":13125187,"title":"sql query to select records in a specific format (using pivot or other)","body":"<p>I have an SQL table like this:</p>\n\n<pre><code>Animal1       Animal2       Corelation\n---------+---------------+--------------\nCat             Cat           1       \nCat             Dog           0.6     \nCat             Mouse         0.8     \nDog             Cat           0.6 \nDog             Dog           1    \nDog             Mouse         0.4      \nMouse           Cat           0.8     \nMouse           Dog           0.4     \nMouse           Mouse         1   \n</code></pre>\n\n<hr>\n\n<p>I'm looking for an SQL query to return the following results:</p>\n\n<pre><code>Animal 1       Cat              Dog               Mouse\n---------+---------------+------------------+---------------+\nCat            1                  0.6               0.8\nDog            6                  1                 0.4\nMouse          0.8                0.4               1\n</code></pre>\n\n<p>Basically i want more readable version of the table.</p>\n\n<p>I tried to use pivot like this:</p>\n\n<pre><code>use SymbolsDB\nselect * from [AnimalsTable]\npivot (\n   [Corelation]\n   for [Animal2] in (select * from [Animal2]\n)\n</code></pre>\n\n<p>But it is not working. i am not sure if I understand how the pivot works and if it can be used in my case. Or is there another way to do it? (I am trying to avoid loops because I have 1 million record)</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13125550,"title":"Drop tables that starts with specific characters","body":"<p>I have multiple table names like g_str_a , g_str_ab , g_str_abc . I would like to drop all those tables that start with g_str on SQL Server 2008.</p>\n\n<p>Will <code>DROP Tables like 'g_str'</code> help?</p>\n\n<p>Please help me with the script. </p>\n"},{"tags":["sql","sql-server","performance","sql-server-2008","ssis"],"answer_count":3,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":497,"score":4,"question_id":9290291,"title":"SQL Script in VM taking long time for execution","body":"<p>I have the Execute SQL Script package that contains the script to insert about 150K records.</p>\n\n<p>Problem in here is when I execute the package in the Virtual machine its taking 25 min's approx and the same package in physical machine its taking 2 min's</p>\n\n<p>Question 1? Why its taking that much time to load the same data in VM.\nQuestion 2? How to solve this performance issue.</p>\n\n<p>Physical machine configuration has 4GB Ram and 250GB HD + Windows server 2008 R2 + SQL server 2008 R2 Standard Edition.\nVirtual machine has the same Configuration</p>\n\n<p><strong>Update: The Problem is with the SQL Server in VM.</strong></p>\n\n<p><strong>Question 1? Why its taking that much time to Run the same script in VM.</strong></p>\n\n<p><strong>Question 2? How to solve this performance issue.</strong></p>\n\n<p>Both the batabases schema in Physical Machine and VM are identical. Other databases are also same. There was no indexing applied for that tables in both machines. Datatypes are same. harddisk as I said has the same configuration.</p>\n\n<p>No RAID is done on both the machines.</p>\n\n<blockquote>\n  <p>Physical machine has the 2.67GHz RAM Quad Core and in the virtual machine has the\n  2.00GHz RAM Quad Core</p>\n</blockquote>\n\n<p>Version of SQL PM:</p>\n\n<p>Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) Apr  2 2010 15:48:46    Copyright (c) Microsoft Corporation Standard Edition (64-bit) on Windows NT 6.1  (Build 7601: Service Pack 1)</p>\n\n<p>Version of SQL PM:</p>\n\n<p>Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) Apr  2 2010 15:48:46    Copyright (c) Microsoft Corporation Standard Edition (64-bit) on Windows NT 6.1  (Build 7601: Service Pack 1) (Hypervisor)</p>\n\n<p>I executed the script Execution plan for both are the same as there is no difference in plan.</p>\n\n<p>Vendor is HP ML350 Machine.</p>\n\n<p>There are almost 20 VM's on the same physical server out of which 7 servers are active.</p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13124897,"title":"Converting the nvarchar to int","body":"<p>I have google online this question and for the life of me couldn't figure out why this kept throwing errors, any help is appreciated.</p>\n\n<blockquote>\n  <p>Conversion failed when converting the nvarchar value 'SELECT @orderid\n  = t.orderid FROM  (SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY creationdatetime DESC) AS row FROM\n  [intranet].[dbo].handbook_appendix_data WHERE id = ' to data type int.</p>\n</blockquote>\n\n<pre><code>DECLARE @sql nvarchar(500)\nDECLARE @table varchar(40)\nSET @table = 'handbook_section_data';\nSET @table = 'handbook_appendix_data';\n\nDECLARE @parentid INT\nDECLARE @id INT\nDECLARE @published INT\nDECLARE @orderid INT\nSET @parentid = 2\nSET @id = -1\nSET @published = 1\n\nSET @sql = N'SELECT @orderid = t.orderid FROM \n(SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY creationdatetime DESC) AS row FROM [intranet].[dbo].'+@table+' WHERE id = '+@id+' AND published = '+@published+') AS t\nWHERE t.published = '+@published+' AND t.row = 1';\nEXEC SP_EXECUTESQL @sql, N'@orderid INT OUTPUT', @orderid = @orderid OUTPUT --Get the OrderID from ID\n\nPRINT @orderid\n</code></pre>\n"},{"tags":["sql-server-2008","c#-4.0","ef-code-first","foreign-keys","data-migration"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13123930,"title":"Error dealing with foreign key constraint","body":"<p>I'm currently having a Foreign Key issue with a project I'm working on.  I'm using Entity Code First to create my DB.  Here is what I have thus far.</p>\n\n<h2>Tables</h2>\n\n<p>Units: Id, ...</p>\n\n<p>Category: Id, ...</p>\n\n<p>CategoryUnits: Id, CategoryId, UnitId</p>\n\n<h2>Code First</h2>\n\n<p>Category.cs</p>\n\n<pre><code>public partial class Category : BaseEntity, ILocalizedEntity\n{\n    private ICollection&lt;CategoryUnits&gt; _categoryUnits;\n\n    ...\n\n    public virtual ICollection&lt;CategoryUnits&gt; CategoryUnits\n    {\n        get { return _categoryUnits ?? (_categoryUnits = new List&lt;CategoryUnits&gt;()); }\n        protected set { _categoryUnits = value; }\n    }\n}\n</code></pre>\n\n<p>Units.cs</p>\n\n<pre><code>public class Units : BaseEntity\n{\n    ...\n}\n</code></pre>\n\n<p>CategoryUnits.cs</p>\n\n<pre><code>public partial class CategoryUnits : BaseEntity, ILocalizedEntity\n{\n    public virtual int UnitId { get; set; }\n    public virtual int CategoryId { get; set; }\n\n    public virtual Units Unit { get; set; }\n    public virtual Category Category { get; set; }\n}\n</code></pre>\n\n<p>CategoryUnitsMap.cs</p>\n\n<pre><code>public partial class CategoryUnitsMap : EntityTypeConfiguration&lt;CategoryUnits&gt;\n{\n    public CategoryUnitsMap()\n    {\n        this.ToTable(\"CategoryUnits\");\n        this.HasKey(cu =&gt; cu.Id);\n\n        this.HasRequired(cu =&gt; cu.Unit)\n            .WithMany()\n            .HasForeignKey(cu =&gt; cu.UnitId);\n\n        this.HasRequired(cu =&gt; cu.Category)\n            .WithMany(c =&gt; c.CategoryUnits)\n            .HasForeignKey(cu =&gt; cu.CategoryId);\n    }\n}\n</code></pre>\n\n<p>Currently what's happening is I get the following message when I try to insert data during a data migration program:</p>\n\n<p>The INSERT statement conflicted with the FOREIGN KEY constraint \"CategoryUnits_Category\". The conflict occurred in database \"NopDB3\", table \"dbo.Category\", column 'Id'.</p>\n\n<p>Here is the code where I'm actually putting data into the table.</p>\n\n<p>Program.cs</p>\n\n<pre><code>private static void AddDefaultOfficeSuppliesUnitRights()\n    {\n        try\n        {\n            var unitIds = new List&lt;int&gt;();\n            var sqlSelectStatement = \"Select * From Units With(NoLock)\";\n            var units = new DataSet();\n\n            using (var sqlCommand = new SqlCommand(sqlSelectStatement, sqlCon))\n            {\n                var sqlAdapter = new SqlDataAdapter();\n                sqlAdapter.SelectCommand = sqlCommand;\n                sqlCon.Open();\n                sqlAdapter.Fill(units);\n                sqlCon.Close();\n            }\n\n            foreach (DataRow dr in units.Tables[0].Rows)\n            {\n                var unitId = Int32.Parse(dr[\"Id\"].ToString());\n                unitIds.Add(unitId);\n            }\n\n            var sqlInsertStatement = GenerateCategoryUnitsForOfficeSupplies(\"Insert Into CategoryUnits (UnitId, CategoryId) Values (cuUnitId, 19)\", unitIds);\n            using (var sqlCommand = new SqlCommand(sqlInsertStatement, sqlCon))\n            {\n                sqlCon.Open();\n                sqlCommand.ExecuteNonQuery();\n                sqlCon.Close();\n            }\n\n            Console.WriteLine(\"Default Office Supply CategoryUnits Added\");\n        }\n        //Something went wrong\n        catch (Exception ex)\n        {\n            Console.WriteLine(\"Error in Add Default Category Units for Office Supplies: \" + ex.Message);\n        }\n        //Close out sql connection\n        finally\n        {\n            if (sqlCon.State != ConnectionState.Closed) sqlCon.Close();\n        }\n    }\n\nprivate static string GenerateCategoryUnitsForOfficeSupplies(string sqlInsertStatement, List&lt;int&gt; unitIds)\n    {\n        var sqlInsertStatements = string.Empty;\n        foreach (var unitId in unitIds)\n        {\n            sqlInsertStatements += sqlInsertStatement.Replace(\"cuUnitId\", unitId.ToString()) + \"; \";\n        }\n\n        return sqlInsertStatements;\n    }\n</code></pre>\n\n<p>The oddest thing about this is when I manually insert the data by sql statement, it works fine and has no errors.  Any suggestions would be helpful.</p>\n"},{"tags":["c#","sql-server-2008","entity-framework","exception-handling","foreign-keys"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":60,"score":0,"question_id":13123397,"title":"Getting INSERT statement conflicted with the FOREIGN KEY on SaveChanges()","body":"<p>I am new to working with the Entity Framework with SQL Server and I am having trouble inserting a record into my database. The problem is with 3 tables that are linked with primary keys and a foreign key and in the past I have not used databases with foreign keys.</p>\n\n<p>I am just trying to get some test data into the database for now but I keep getting the error: </p>\n\n<blockquote>\n  <p><em>INSERT statement conflicted with the FOREIGN KEY</em></p>\n</blockquote>\n\n<p>Can anyone help me get started with inserting into my database please? Here is the code I am using:</p>\n\n<pre><code>private void button3_Click(object sender, EventArgs e)\n{\n    TaxiDBEntities db = new TaxiDBEntities(); //connection to database\n    DriverStatus newDriverStatus = new DriverStatus(); // driver status object\n\n    /*populate the new driver object*/\n    //newDriverStatus.DriverID = Convert.ToInt32(driverComboBox.Text);\n    //newDriverStatus.Status = statusTextBox.Text;\n    //newDriverStatus.Area = areaTextBox.Text;\n\n    Driver driver = new Driver();\n\n    int driverIDInt = Convert.ToInt32(driverComboBox.Text);\n\n    //driver = db.Drivers.SingleOrDefault(p =&gt; p.DriverId == driverIDInt);\n    //if (driver == null)\n    //{\n        driver.DriverId = driverIDInt;\n        driver.Fname = \"test\";\n        driver.Lname = \"test\";\n    //}\n\n    db.DriverStatus.AddObject(newDriverStatus); // add driver object to entity model\n\n    DriverLog driverLog = new DriverLog();\n\n    driverLog.driverLogID = driverIDInt;\n    driverLog.DriverID = driverIDInt;\n    driverLog.date = DateTime.Now;\n\n    db.DriverLog.AddObject(driverLog);\n\n    DriverStatus driverStatus = new DriverStatus();\n\n    driverStatus.DriverID = driverIDInt;\n    driverStatus.Status = \"1\";\n    driverStatus.Area = \"1\";\n\n    db.DriverStatus.AddObject(driverStatus);\n\n    try\n    {\n        db.SaveChanges();\n    }\n    catch (Exception ex)\n    {\n        MessageBox.Show(ex.ToString());\n    }\n}\n</code></pre>\n"},{"tags":["sql-server-2008","user"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13123682,"title":"Create a user for SQL Server 2008?","body":"<p>I'm using this code to create a new user.</p>\n\n<pre><code>/****** Object:  User [primebox] ******/\nIF NOT EXISTS (SELECT * FROM sys.database_principals WHERE name = N'primebox')\nCREATE USER [primebox] FOR LOGIN [primebox] WITH DEFAULT_SCHEMA=[primebox]\nGO\n</code></pre>\n\n<p>and I got the following error when I try to create this specific user.</p>\n\n<blockquote>\n  <p><em>Msg 15007, Level 16, State 1, Line 1</em><br>\n  <em>'primebox' is not a valid login or you do not have permission.</em></p>\n</blockquote>\n\n<p>The part that I don't understand is, I can create others users but this one in particular looks invalid</p>\n\n<p>I tried to rename my database and got this error</p>\n\n<blockquote>\n  <p><em>Unable to rename primeboxs. (ObjectExplorer)</em></p>\n  \n  <p><em>Rename failed for Database 'primebox'.  (Microsoft.SqlServer.Smo)</em></p>\n  \n  <p><em>An exception occurred while executing a Transact-SQL statement or\n  batch. (Microsoft.SqlServer.ConnectionInfo)</em></p>\n  \n  <p><em>The database could not be exclusively locked to perform the operation.\n  (Microsoft SQL Server, Error: 5030)</em></p>\n</blockquote>\n\n<p>My guess is that the problem is the database name... but I got the code from another database (I'm creating a 'wanna be' backup) with the same user and database names. So I'm in a corner here... Any help will be a LOT appreciated =) </p>\n\n<p>PS: My computer name is box, windows 7. Using SQL Server 2008</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","select"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":57,"score":3,"question_id":13121094,"title":"Doing a comparison using the previous row?","body":"<p>I'm trying to work out an efficient way of comparing two rows in SQL Server 2008.  I need to write a query which finds all rows in the <code>Movement</code> table which have <code>Speed &lt; 10</code> N consecutive times.</p>\n\n<p>The structure of the table is:</p>\n\n<p>EventTime\nSpeed </p>\n\n<p>If the data were:</p>\n\n<pre><code>2012-02-05 13:56:36.980, 2\n2012-02-05 13:57:36.980, 11\n2012-02-05 13:57:46.980, 2\n2012-02-05 13:59:36.980, 2\n2012-02-05 14:06:36.980, 22\n2012-02-05 15:56:36.980, 2\n</code></pre>\n\n<p>Then it would return rows 3/4 (13:57:46.980 / 13:59:36.980) if I looked for 2 consecutive rows, and would return nothing if I looked for three consecutive rows.  The order of the data is EventTime/DateTime only.</p>\n\n<p>Any help you could give me would be great.  I'm considering using cursors but they're usually pretty inefficient.  Also, this table is approximately 10m rows in size, so the more efficient the better! :)</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":22,"score":0,"question_id":13123752,"title":"Divide by zero error encountered when using count then divide","body":"<p>I want to do a count on a field and then 1 divide by this number so i get a decimal.\nWhen using the code below I get error 'Divide by zero error encountered.'</p>\n\n<pre><code>COUNT(1/isnull(nullif(current_balance,0),0)) as BALANCE_CURRENT_NU\n</code></pre>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13123224,"title":"SQL Server stored procedure parameters data type error","body":"<p>The following stored procedure in SQL Server 2008 was throwing an error    </p>\n\n<pre><code>/****** Object:  StoredProcedure [dbo].[UpdateCPA]    ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROCEDURE [dbo].[pdateCPA_INT]\n    @CPAColumn_Name nvarchar(100), @value Int, @RecordNum nvarchar(100)\nAS\nBEGIN\n    SET NOCOUNT ON;\n    --declare @CPAColumn_Name nvarchar(100) = 'UsrsID'\n    --declare @value Int = 3575\n    --declare @RecordNum int = 1\n\n    declare @thedate smalldatetime\n    set @thedate = GETDATE()\n    --select @thedate as NOW\n\n    declare @cmd nvarchar(max)\n\n    set @cmd = 'Update tblTimeCPAReport \n    set ' + @CPAColumn_Name + ' = '+@value+' \n    set ReportLastUpdate = ' + @thedate + '\n    where RecordNum='+@RecordNum\n\n    exec sp_executesql @cmd\n    select @cmd\nEND\n</code></pre>\n\n<p>It's throwing this error</p>\n\n<blockquote>\n  <p><em>Conversion failed when converting the nvarchar value 'Update\n  tblTimeCPAReport set UsrsID = ' to data type int.</em></p>\n</blockquote>\n"},{"tags":["c#","asp.net","linq","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13122935,"title":"Filling a Dictionary with large amount of LinqToSql objects fills up memory (IIS7 - W3WP.EXE)","body":"<p>I have a LinqToSQL query that reads large amount of data for a specific ID from a Table called \"Clients\" which contains about 20 rows of data about the client.</p>\n\n<pre><code>  var allClients = from client in context.Clients\n                         where client.ID == ID\n                         select client;\n\n\n  Dictionary&lt;string, Client&gt; existingEmailMap = new Dictionary&lt;string, Client&gt;();\n  Dictionary&lt;string, Client&gt; existingCellphoneMap = new Dictionary&lt;string, Client&gt;();\n\n foreach (Client client in allClients)\n        {\n            if (client.Email != null &amp;&amp; !existingEmailMap.ContainsKey(client.Email.Trim().ToUpper()))\n                existingEmailMap.Add(client.Email.Trim().ToUpper(), client);\n\n\n            if (client.Cellphone != null &amp;&amp; !existingCellphoneMap.ContainsKey(client.Cellphone.Trim().ToUpper()))\n                existingCellphoneMap.Add(client.Cellphone.Trim().ToUpper(), client);\n        }\n</code></pre>\n\n<p>As you can see I loop for each \"Client\" in allClients and check if Email and CellPhone exist, if one of them does exist i place them inside a Dictionary - This action fills IIS memory and if i have 100,000 clients it could take a lot of time and totally fill IIS memory to the maximum the computer can handle.\nI need this Dictionary so i can do some other checks on the clients before doing any update or insert.</p>\n\n<p>I know that Client object contains many other information other than the Client Info which might fill up memory.</p>\n\n<p>Any way to resolve this issue?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","sqlbulkcopy"],"answer_count":6,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":4505,"score":6,"question_id":2593689,"title":"How to prevent duplicate records being inserted with SqlBulkCopy when there is no primary key","body":"<p>I receive a daily XML file that contains thousands of records, each being a business transaction that I need to store in an internal database for use in reporting and billing.\nI was under the impression that each day's file contained only unique records, but have discovered that my definition of unique is not exactly the same as the provider's. </p>\n\n<p>The current application that imports this data is a C#.Net 3.5 console application, it does so using SqlBulkCopy into a MS SQL Server 2008 database table where the columns exactly match the structure of the XML records. Each record has just over 100 fields, and there is no natural key in the data, or rather the fields I can come up with making sense as a composite key end up also having to allow nulls. Currently the table has several indexes, but no primary key.</p>\n\n<p>Basically the entire row needs to be unique. If one field is different, it is valid enough to be inserted. I looked at creating an MD5 hash of the entire row, inserting that into the database and using a constraint to prevent SqlBulkCopy from inserting the row,but I don't see how to get the MD5 Hash into the BulkCopy operation and I'm not sure if the whole operation would fail and roll back if any one record failed, or if it would continue.</p>\n\n<p>The file contains a very large number of records, going row by row in the XML, querying the database for a record that matches all fields, and then deciding to insert is really the only way I can see being able to do this. I was just hoping not to have to rewrite the application entirely, and the bulk copy operation is so much faster.</p>\n\n<p>Does anyone know of a way to use SqlBulkCopy while preventing duplicate rows, without a primary key? Or any suggestion for a different way to do this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2281,"score":1,"question_id":3041325,"title":"Unable to attach \"AdventureWorks2008\" Sample Database to a named Instance in SQL Server 2008","body":"<p>First of all \"Northwind\" and \"AdventureWorksDW2008\" databases attached without problem, but \"AdventureWorks2008\" fails with the following error.</p>\n\n<pre><code>//Msg 5120, Level 16, State 105, Line 1\n Unable to open the physical file \n\"C:\\Program Files\\Microsoft SQL Server\\MSSQL10.MSSQLSERVER\\MSSQL\\DATA\\Documents\".\n Operating system error 2: \"2(The system cannot find the file specified.)\".\n Msg 5105, Level 16, State 14, Line 1\n A file activation error occurred. The physical file name \n 'C:\\Program Files\\Microsoft SQL Server\\MSSQL10.MSSQLSERVER\\MSSQL\\DATA\\Documents' \n may be incorrect. Diagnose and correct additional errors, and retry the operation.\n Msg 1813, Level 16, State 2, Line 1\n Could not open new database 'AdventureWorks2008'. CREATE DATABASE is aborted.\n</code></pre>\n\n<p>I did not use the default database instance \"MSSQLSERVER\" during install.</p>\n\n<p>So where is it finding this path \"C:...\\MSSQL10.MSSQLSERVER...\\Documents\"?</p>\n"},{"tags":["sql-server-2008","asp.net-membership","website-admin-tool"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":114,"score":0,"question_id":12772486,"title":"Web Site Administration Tool: The connection name 'LocalSqlServer' was not found in the applications configuration or the connection string is empty","body":"<p>I'm trying to use the Web Site Administration Tool to configure membership for a web site on my server. I've created an aspnetdb database on my local copy of SQL Server, and through the WSAT, I've managed to add several roles, and to lock down a couple of directories on the server. </p>\n\n<p>However, when I try to manage users, I get the following error:</p>\n\n<blockquote>\n  <p>The connection name 'LocalSqlServer' was not found in the applications configuration or the connection string is empty. at System.Web.Util.SecUtility.GetConnectionString(NameValueCollection config) at System.Web.Security.SqlMembershipProvider.Initialize(String name, NameValueCollection config) at System.Web.Configuration.ProvidersHelper.InstantiateProvider(ProviderSettings providerSettings, Type providerType)</p>\n</blockquote>\n\n<p>Clearly, the LocalSqlServer connection string <em>is</em> OK, otherwise I wouldn't have been able to add the roles, for example.</p>\n\n<p>The relevant parts of web.config are as follows:</p>\n\n<pre><code>  &lt;connectionStrings&gt;\n        &lt;clear /&gt;\n        &lt;remove name=\"LocalSqlServer\"/&gt;\n        &lt;add name=\"LocalSqlServer\" connectionString=\"Data Source=(local);Initial Catalog=aspnetdb;User Id=LoginUser;Password=password;\" providerName=\"System.Data.SqlClient\"/&gt;\n  &lt;/connectionStrings&gt;\n\n  &lt;system.web&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.0\" /&gt;\n    &lt;authentication mode=\"Forms\"&gt;\n      &lt;forms loginUrl=\"~/Account/Login.aspx\" timeout=\"2880\" defaultUrl=\"~/admin/admin.aspx\" /&gt;\n    &lt;/authentication&gt;\n        &lt;membership defaultProvider=\"SqlProvider\" userIsOnlineTimeWindow=\"15\"&gt;\n            &lt;providers&gt;\n                &lt;clear /&gt;\n                &lt;add\n          name=\"SqlProvider\"\n          type=\"System.Web.Security.SqlMembershipProvider\"\n          connectionStringName=\"LocalSqlServer\"\n          applicationName=\"myapp\" /&gt;\n            &lt;/providers&gt;\n        &lt;/membership&gt;\n    &lt;profile&gt;\n      &lt;providers&gt;\n        &lt;clear /&gt;\n                &lt;add name=\"AspNetSqlProfileProvider\" type=\"System.Web.Profile.SqlProfileProvider\" connectionStringName=\"LocalSqlServer\" applicationName=\"myapp\" /&gt;\n      &lt;/providers&gt;\n    &lt;/profile&gt;\n    &lt;roleManager enabled=\"true\"&gt;\n      &lt;providers&gt;\n        &lt;clear /&gt;\n                &lt;add name=\"AspNetSqlRoleProvider\" type=\"System.Web.Security.SqlRoleProvider\" connectionStringName=\"LocalSqlServer\" applicationName=\"myapp\" /&gt;\n      &lt;/providers&gt;\n    &lt;/roleManager&gt;\n  &lt;/system.web&gt;\n</code></pre>\n\n<p>As far I understand it, the Clear/Remove elements should override any other config files, but regardless, I tried adding the same connection string to the relevant machine.config, but to no avail.</p>\n\n<p>Any ideas?</p>\n\n<p>As an alternative, is there any reason why I can't call the Membership DB stored procedures directly? Does anyone know of any supporting documentation?</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":13120634,"title":"Cannot find table 0 in dataset using storeprocedures","body":"<p>I am not getting filled dataset after executing storeprocedure.</p>\n\n<pre><code>protected void btnsub_Click(object sender, EventArgs e)\n{  ArrayList arInsert = ReturnParameter_insert();\n    DataSet dsInsertProfile = objadmin.GetGridData(arInsert, objconstant.sSP_INSERT_PROFILE);\n\n    if(int.Parse(dsInsertProfile.Tables[0].Rows[0].ItemArray[0].ToString())== 0)\n    { lblThank.Text = \"Your profile have been successfully saved.\";\n    }\n    else\n    {\n        lblThank.Text = \"Your profile is not saved, please try again later.\";\n    }\n}\npublic ArrayList ReturnParameter_insert()\n{\n    ArrayList arProfile = new ArrayList();\n    Object[] c_first_name = new object[3] { \"@strFname\", \"Varchar\", (txtfname.Text != \"\") ? txtfname.Text : \"\" };\n    arProfile.Add(c_first_name);\n    return arProfile;\n}\n public DataSet GetGridData(ArrayList dbArray, string sSpName)\n    {\n        DataSet dsDataSet = new DataSet();\n        dsDataSet = datamanager.GetGridData(dbArray, sSpName);\n        return dsDataSet;\n    }\npublic static SqlDbType GetSqlDataType(string sDataType)\n    {\n        return (sDataType == \"Integer\") ? SqlDbType.Int : (sDataType == \"Varchar\") ? SqlDbType.VarChar : (sDataType == \"Date\") ? SqlDbType.Date : SqlDbType.BigInt;\n    }\npublic static DataSet GetGridData(ArrayList dbArray, string sSpName)\n    {\n        DataSet dsDataSet = new DataSet();\n        SqlConnection cn = createConnection();\n        SqlCommand cmd = new SqlCommand();\n        cmd.CommandType = CommandType.StoredProcedure;\n        cmd.CommandText = sSpName;\n\n        object objPrMtrName;\n        object objSqlType;\n        object objPrMtrVal;\n        int i;\n        for (i = 0; i &lt; dbArray.Count; i++)\n        {\n            objPrMtrName = ((object[])(dbArray[i]))[0];\n            objSqlType = ((object[])(dbArray[i]))[1];\n            objPrMtrVal = ((object[])(dbArray[i]))[2];\n            cmd.Parameters.Add(objPrMtrName.ToString(), GetSqlDataType(objSqlType.ToString())).Value = objPrMtrVal;\n        }\n        cmd.Connection = cn;\n        try\n        {\n            SqlDataAdapter adp = new SqlDataAdapter(cmd);\n            adp.Fill(dsDataSet);\n            return dsDataSet;\n        }\n        catch (Exception ex)\n        {\n            throw ex;\n        }\n        finally\n        {\n            cn.Close();\n            cn.Dispose();\n        }\n    }\n</code></pre>\n\n<p>My store procedure:</p>\n\n<pre><code>CREATE Procedure spInsert_profile\n(\n@strFname  varchar(200)\n\n)\nAS\nBEGIN\nInsert into gdt_Users([c_first_name] ,[d_modified_dttm],[d_created_dttm])values(@strFname,GETDATE(),GETDATE())\nEND\n</code></pre>\n\n<p>Here I am using 3 tier , the same methods are working successfully for other pages but not for this particular code.the dataset in GETGRIDDATA method is filling null value.i am not able to find.Pls help me....</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":11,"score":-3,"question_id":13121453,"title":"How to use log shipping in database","body":"<p>we want to take backup of database from one server and restore on other for this we want to use log shipping.\nI don't know how to use it and what access rights user need on the server to do log shipping.\nCould you please let me know what step by step procedure involved to do the same.\nThanks in advance</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13121088,"title":"SQL sub query select doubts","body":"<p>LogTable in SQL Server</p>\n\n<pre><code>timestamp                  user_name     session_id\n2012-10-17 06:30:10        Sanjay        034A955F\n2012-10-17 06:30:20        Sanjay        034A955F\n2012-08-20 13:20:59        John          0547961A \n2012-08-20 13:21:05        John          0547961A \n2012-08-20 13:22:10        John          0547961A \n2012-10-17 04:02:10        John          0977661B \n</code></pre>\n\n<p>Desired output</p>\n\n<pre><code>user       Total_login      This_Month_Login   Recent_Login  \nSanjay     2                2                  2012-10-17 06:30:10 \nJohn       4                1                  2012-10-17 04:02:10 \n</code></pre>\n\n<p>I tried to write SQL SELECT query to get above output but I am not good in SQL so couldn't take it ahead and wrote only for 2 columns. Can you please help me to get above select output?</p>\n\n<pre><code>select user_name as 'User', count (distinct session_id) as 'Total_Login' \nfrom \"LogTable\" \ngroup by user_name\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":13119925,"title":"Find out the number of Days and nights using sql query","body":"<p>I have a situation like find out the number of days and nights in a given Date range in sql can anyone help me..\nthanks in advance </p>\n"},{"tags":["sql-server-2008","database-design","view","database-performance","rdms"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":25,"score":2,"question_id":13113085,"title":"Creating a view that contains a view - performance hit?","body":"<p>When composing a view - should I stick with the base tables or can I feel confident that including a view within a view will not hurt performance.  I want to include the view because it would allow me to change one base view if i have a change to the table design opposed to updating every single view that is dependent on the table changed.  It just seems like the smarter thing to do, but want to make sure I am not doing something considered bad practice or hurts performance. </p>\n"},{"tags":["sql-server-2008","visual-studio-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5,"score":0,"question_id":13120259,"title":"how to move through records retrieved from database without using binding navigator in vb.net?","body":"<p>If i have a different tables in the database and i have to retrieve that data into the different textboxes in visual studio 2008 without using binding navigator?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":481,"score":2,"question_id":2732356,"title":"List of all tables with a relationship to a given table or view","body":"<p>In SQL Server is there a command to return a list of all tables with a relationship to a given table or view?</p>\n\n<p>EDIT: SQL SERVER 2008</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":13116222,"title":"How to get week number of the month from the date in sql server 2008","body":"<p>In SQL Statement in microsoft sql server, there is a built-in function to get week number but it is the week of the year.</p>\n\n<pre><code>Select DatePart(week, '2012/11/30') // **returns 48**\n</code></pre>\n\n<p>The returned value <strong>48</strong> is the week number of the year. </p>\n\n<p>Instead of <strong>48</strong>, I want to get <strong>1, 2, 3 or 4</strong> (week number of the month). I think the week number of the month can be achieved by modules with Month Number of this week. For e.g.</p>\n\n<pre><code>Select DATEPART(week, '2012/11/30')%MONTH('2012/11/30')\n</code></pre>\n\n<p>But I want to know is there other built-in functions to get WeekNumber of the month in MS SQL SERVER.</p>\n"},{"tags":[".net","vb.net","sql-server-2008","excel","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":500,"score":0,"question_id":12404809,"title":"How to import data from Excel into SQL Server 2008 ","body":"<p>I actually want to import data from an Excel file into an existing database (I use SQL Server 2008 and VB.net) using a T-SQL stored procedure called from my VB.NET app.</p>\n\n<p>So is there a possibility to do that just by coding (without using any other tool SSIS or the SS import and export wizard), if yes can somebody give me just a simple sample of code.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["visual-studio-2010","sql-server-2008","firewall"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1297,"score":0,"question_id":8536852,"title":"A network related or instance-specific error occured while establishing a connection to SQL Server, error 40 - Could","body":"<p>Since I re-installed windows7, visual studio and Sql Server 2008 the same, I can't add a connection to a .mdf.\nI have already allowed the 1433 port access in the firewall but the error message remains:</p>\n\n<p><strong>A network related or instance-specific error occured while establishing a connection to SQL Server. The server was not found or is not accessible. Verify the name instance is correct and that the SQL Server is configured to allow remote connections.(provider:Shared Memory Provider, error 40 - Could not open a connection to SQL Server)</strong></p>\n\n<p>can you please help me?</p>\n"},{"tags":["sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":8370,"score":0,"question_id":4197674,"title":"Insert data into a view (SQL Server)","body":"<p>I have the following setup:</p>\n\n<pre><code>CREATE TABLE dbo.Licenses\n(\n Id    int IDENTITY(1,1) PRIMARY KEY,\n Name  varchar(100),\n RUser nvarchar(128) DEFAULT USER_NAME()\n)\n\nGO\n\nCREATE VIEW dbo.rLicenses\nAS\nSELECT Name\nFROM   dbo.Licenses\nWHERE  RUser = USER_NAME()\n\nGO\n</code></pre>\n\n<p>When I try to insert data using the view...</p>\n\n<pre><code>INSERT INTO dbo.rLicenses VALUES ('test')\n</code></pre>\n\n<p>an error arises:</p>\n\n<pre><code>Cannot insert the value NULL into column Id, table master.dbo.Licenses; column does not allow nulls. INSERT fails.\n</code></pre>\n\n<p>Why doesn't the auto increment of the identity column work when trying to insert using the view and how can I fix it?</p>\n\n<p>Scenario is:</p>\n\n<p><strong>The different users of the database should only be able to work with their own rows in that table. Therefore I am trying to use the view as a kind of security by checking the username.</strong> Is there any better solution?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13119639,"title":"Comparing Image Data Types In SQL","body":"<p>How to Compare <code>Image</code> data types?</p>\n\n<p>I need compare a file stored in DB with an uploaded file But it says that comparing <code>Image</code> data type is not possible I even tried to convert to <code>nchar</code> </p>\n\n<pre><code>(CONVERT(char(1000), FileData) \n</code></pre>\n\n<p>Can anyone help me?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":47,"score":3,"question_id":13119350,"title":"using tsql to create a contigious time line set","body":"<p>Long time reader, first time poster. Hoping some SQL guru can lend me some processing power to solve a SQL problem elegantly and without cursors.</p>\n\n<p>I am trying to create a time line type result set from a data set with money and a Date, where the order in which they appear is important. See sample data and expectation below.</p>\n\n<pre><code>DECLARE @OrderData TABLE(\n      ID                      INT IDENTITY,\n      ProductId               INT,\n      WarehouseId             INT,\n      Cost MONEY,\n      SaleDate          DATETIME\n)\n</code></pre>\n\n<p></p>\n\n<pre><code>INSERT INTO @OrderData\nVALUES\n      (1, 1, 2.71, '2012-02-23 10:01')\n      ,(1, 2, 2.71, '2012-02-23 10:02')\n      ,(1, 1, 2.71, '2012-02-23 10:03')\n      ,(1, 1, 2.71, '2012-02-23 10:04')\n      ,(1, 1, 2.71, '2012-02-23 10:05')\n      ,(1, 1, 2.8, '2012-02-23 10:06')\n      ,(1, 1, 2.9, '2012-02-23 10:07')\n      ,(1, 1, 2.71, '2012-02-23 10:08')\n      ,(1, 1, 2.71, '2012-02-23 10:09')\n</code></pre>\n\n<p>The result I am looking for is a time line of sales with from and to dates for a product and warehouse combination within it own set of sales. As soon as the sale price changes in the dataset  this should spawn a new row in the result set.</p>\n\n<p>Result structure for sample data.</p>\n\n<pre><code>Product, warehouse, minsale date, Max sale date\n1,1,2.71, 2012-02-23 10.01, 2012-02-23 10.05\n1,1,2.80, 2012-02-23 10.06, 2012-02-23 10.06\n1,1,2.90, 2012-02-23 10.07, 2012-02-23 10.07\n1,1,2.71, 2012-02-23 10.08, 2012-02-23 10.09\n1,2,2.71, 2012-02-23 10.02, 2012-02-23 10.02\n</code></pre>\n\n<p>Cheers for any help available.</p>\n"},{"tags":["sql-server-2008"],"answer_count":5,"favorite_count":4,"up_vote_count":9,"down_vote_count":0,"view_count":7314,"score":9,"question_id":1878430,"title":"Update Collation of all fields in database on the fly","body":"<p>We recently moved our database from our SQL Server 2005 server to our SQL Server 2008 server.  Everything moved over fine, however now we are finding that we are getting collation conflicts.  The old server had a different collation with the new server.</p>\n\n<p>Now our tables created before the move are one collation, and the ones created after are another collation. </p>\n\n<p>Is there a way to update the tables/columns with the old collation to the new collation?</p>\n\n<p>I understand setting the default database/server collation does not modify any existing tables <a href=\"http://stackoverflow.com/questions/825814/changing-database-collation-doesnt-update-collation-of-varchar-text-fields-in-the\">(link)</a>.  I really don't want to recreate the database if I don't have to.</p>\n\n<p>Any help really appreciated.</p>\n\n<p>Thanks for your help guys, finally got it working. </p>\n\n<p>For future reference, here is my final script:</p>\n\n<pre><code>SELECT 'ALTER TABLE [' + SYSOBJECTS.Name + '] ALTER COLUMN [' + SYSCOLUMNS.Name + '] ' +\nSYSTYPES.name + \n    CASE systypes.NAME\n    WHEN 'text' THEN ' '\n    ELSE\n    '(' + RTRIM(CASE SYSCOLUMNS.length\n    WHEN -1 THEN 'MAX'\n    ELSE CONVERT(CHAR,SYSCOLUMNS.length)\n    END) + ') ' \n    END\n\n    + ' ' + ' COLLATE Latin1_General_CI_AS ' + CASE ISNULLABLE WHEN 0 THEN 'NOT NULL' ELSE 'NULL' END\n    FROM SYSCOLUMNS , SYSOBJECTS , SYSTYPES\n    WHERE SYSCOLUMNS.ID = SYSOBJECTS.ID\n    AND SYSOBJECTS.TYPE = 'U'\n    AND SYSTYPES.Xtype = SYSCOLUMNS.xtype\n    AND SYSCOLUMNS.COLLATION IS NOT NULL\n    AND NOT ( sysobjects.NAME LIKE 'sys%' )\n    AND NOT ( SYSTYPES.name LIKE 'sys%' )\n    GO\n</code></pre>\n\n<p>Here is the <a href=\"http://samsudeenb.blogspot.com/2007/01/changing-database-collation.html\">site</a> that contained the script I based it on. I had to tweak it to get it working correctly.</p>\n"},{"tags":["visual-studio-2008","sql-server-2008","export","publishing","wizard"],"answer_count":3,"favorite_count":3,"up_vote_count":9,"down_vote_count":0,"view_count":21201,"score":9,"question_id":1391013,"title":"SQL Database Publishing wizard with SQL Server 2008","body":"<p>I'm desperately looking for SQL Database Publishing wizard. I've download it but it seems to require SQL Server 2005. According to <a href=\"http://blogs.msdn.com/webdevtools/archive/2007/10/15/sql-database-publishing-wizard-is-now-in-visual-studio-orcas.aspx\">http://blogs.msdn.com/webdevtools/archive/2007/10/15/sql-database-publishing-wizard-is-now-in-visual-studio-orcas.aspx</a> it comes with Visual Studio 2008, but my Visual Studio 2008 Professional doesn't have that menu item.</p>\n\n<p>Any ideas how can I get the SQL Database Publishing wizard working with SQL Server 2008.</p>\n"},{"tags":["sql-server-2008","microsoft-commerce-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":13116923,"title":"ODBC SQL Server Driver: String data, right truncation[22001]","body":"<p>I am using Microsoft commerce server 2002 to store data when I add one more column in SQL Server with <code>varchar(max)</code>. </p>\n\n<p>I am getting this error:</p>\n\n<blockquote>\n  <p>[Microsoft][ODBC SQL Server Driver]String data, right truncation[22001]<br>\n    [Microsoft][ODBC SQL Server Driver]String data, right truncation</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":51,"score":1,"question_id":13116036,"title":"Insert Trigger , Help Please","body":"<p>I have 'Employee Registration' form (Windows Application). When the employee registration is done, at the same time i want to create an user. Taking the 'EmpCode' value from 'Employee Registration' and making it the value of 'UserName'. Please help me to write a trigger for it. </p>\n\n<p>Employee Registration Table\nColumns are</p>\n\n<pre><code>EMPCODE, \nEMPNAME, \nDESIGNATION, \nDEPARTMENT, \nDOJ,  \nEMAILID, \nCATEGORY, \nEMPSTATUS, \nEMPMANAGER etc etc\n</code></pre>\n\n<p>UserCreation Table\nColumns are</p>\n\n<pre><code>USERNAME, \nUSERPASSWORD, \nUSERMAPPINGCODE, \nUSERTYPE, \nUSERACTIVE, \nUSEREMAIL\n</code></pre>\n\n<p>When the insertion for 'employee regstratn' happens, same time the following thngs shud happen in 'UserCreation ' table....,</p>\n\n<p><code>EMPCODE</code>'s value should be saved as <code>USERNAME</code>'s value. \n<code>EMPNAME</code>'s value should be saved as <code>USERPASSWORD</code>'s value.\n<code>USERMAPPINGCODE</code>'s value optional \n<code>CATEGORY</code>'s value should be saved as <code>USERTYPE</code>'s value. \n<code>USERACTIVE</code>'s value is 1\n<code>EMAILID</code>'s value should be saved as <code>USEREMAIL</code>'s value</p>\n\n<p>Please help....</p>\n"},{"tags":["sql-server-2008","ssis","data-migration"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13112548,"title":"Syntax error in migrating from SQL Server 2008 to MySQL using SSIS","body":"<p>This is my first SSIS package and I have followed some tutorials and everything looked good until I ran it. I am trying to sync the data from a SQL Server 2008 database to a MySQL database (only 1 table with 2 columns). After running the package I get the following error.</p>\n\n<blockquote>\n  <p><em>[ADO NET Destination [16]] Error: An exception has occurred during\n  data insertion, the message returned from the provider is: You have an\n  error in your SQL syntax; check the manual that corresponds to your\n  MySQL server version for the right syntax to use near '\"UPC\", \"Model\")\n  VALUES (p1, p2)' at line 1</em></p>\n</blockquote>\n\n<p>And on the next line </p>\n\n<blockquote>\n  <p>[SSIS.Pipeline]<br>\n  Error: SSIS Error Code DTS_E_PROCESSINPUTFAILED.<br>\n  The ProcessInput method on component \"ADO NET Destination\" (16) failed with error code 0xC020844B while processing input \"ADO NET Destination Input\" (19).<br>\n  The identified component returned an error from the ProcessInput method. The error is specific to the component, but the error is fatal and will cause the Data Flow task to stop running.  There may be error messages posted before this with more information about the failure.</p>\n</blockquote>\n\n<p>My questions are:</p>\n\n<ol>\n<li>Why I am getting this error ?</li>\n<li>How to solve it ?</li>\n</ol>\n"},{"tags":["java","sql-server-2008","bigdecimal"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13116730,"title":"does java.math.BigDecimal works with sql server float type","body":"<p>does java.math.BigDecimal works with sql server float type?</p>\n\n<p>my application is not accurate on calculation , what we have decided to do is refactor all the application (over 5 years of development and somthimg like 200 years of development)</p>\n\n<p>my question is if I want touch the application sql does integers who have worked just fine eith an sql type float , would b treated as such when the conversion would b to big decimal and vise versa .</p>\n\n<p>10x !!!!</p>\n"},{"tags":["sql-server-2008","entity-framework","views"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12239833,"title":"entity framework view does not show all rows when selecting","body":"<p>I have a regular view in sql server 2008 and I`m using entity framework generate design from database approach. I already know about the keys issues for views in entity framework but that is not my solution. When I  query select * from view, it brings out 3 rows which is right, but all the rows are the same and are the first row in the database view.</p>\n\n<p>some help would be very appreciated.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":3259,"score":2,"question_id":9393207,"title":"Cannot resolve the collation conflict between \"SQL_Latin1_General_CP1_CI_AS\" and \"Latin1_General_CI_AI\" in the equal to operation","body":"<p>I am getting below said collation error since I have moved from a desktop machine to a laptop. My database has hundreds of stored procedures, so any solution like overriding some queries or fix collation for a column is not possible for me. </p>\n\n<p>\"Cannot resolve the collation conflict between \"SQL_Latin1_General_CP1_CI_AS\" and \"Latin1_General_CI_AI\" in the equal to operation\"</p>\n\n<p>My problem is not unique and I have searched for this quite a lot, but solutions available suggest me to override queries with some code which is not feasible. Please suggest some solution that may avoid this collation thing. </p>\n\n<p>I have tried this to alter my database collation.</p>\n\n<pre><code>ALTER DATABASE testDB  \nCOLLATE French_CI_AI ;  \nGO  \n</code></pre>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","fulltext","fulltext-index"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":316,"score":2,"question_id":3914798,"title":"Can I define which word breakers to use when building a mssql fulltext index?","body":"<p>I have created a fulltext catalog that stores the data from some of the columns in a table, but the contents seem to have been split apart by characters that I don't really want to be considered word delimiters. (\"/\", \"-\", \"_\" etc..)</p>\n\n<p>I know that I can set the language for word breaker, and <a href=\"http://msdn.microsoft.com/en-us/library/ms345188.aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms345188.aspx</a> gives som idea on how to install new languages - but I need more direct control than that, because all of those languages still break on the characters I want to not break on.</p>\n\n<p>Is there a way to define my own language to use for finding word breakers?</p>\n"},{"tags":["sql","sql-server-2008","cube"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":937,"score":1,"question_id":2866022,"title":"Sum and average over null values SQL Server 2008 Analysis Services","body":"<p>I have a simple problem, I think, but I have googled and can't find the solution.  I have a cube that has MeasureA, MeasureB and MeasureC.  Not all three measures have values for each record, sometimes they can be null, it's depending if it was applicable.</p>\n\n<p>Now for my totals, I need to average but the average must not take nulls into account.  Any help will be much appreciated.  When I view the measures, the null values show as zeros.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":431,"score":3,"question_id":6581031,"title":"Update date time column","body":"<p>I want to update a <code>DateTime</code> filed with value like <code>2008-04-22 00:00:00.000</code> and add a fixed time to it + <code>1 Hour</code></p>\n\n<p>example i have the column like <code>2008-04-22 00:00:00.000</code> to be like <code>2008-04-22 01:00:00.000</code></p>\n\n<p>thanks</p>\n"},{"tags":["java","sql","database","sql-server-2008","exception"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13115296,"title":"Best Practice for handling duplicate INSERT statements","body":"<p>I am currently using Java to try to INSERT a customer in my Database:</p>\n\n<pre><code>public void saveCustomer(Customer c)  {\n    getConnection();\n\n try {\n\n     CallableStatement pstmt =  con.prepareCall(\"{call sp_saveCustomer(?,?)}\");\n     pstmt.setString(1, c.getName());\n     pstmt.setString(2, a.getLastName());\n     pstmt.executeUpdate();\n\n     closeConnection();\n    } catch (SQLException e) {\n       // Handle Exception\n    }\n}\n</code></pre>\n\n<p>When a user tries to INSERT a duplicate record, the catch block will trigger. What I'm worried about is that I don't know if this means a performance hit. Isn't a better way to check if a customer already exists? Something like:</p>\n\n<pre><code>public void saveCustomer(Customer c) {\n    getConnection();\n\n boolean exists = false; \n\n\n     CallableStatement pstmt =  con.prepareCall(\"{call sp_checkCustomerExistence(?,?)}\");\n     pstmt.setString(1, c.getName());\n     pstmt.setString(2, a.getLastName());\n     ResultSet rs = pstmt.executeQuery();\n     if (rs.next()) exists = true;\n     if ( exists ){\n     closeConnection(); \n     return;\n     } \n\n     CallableStatement pstmt =  con.prepareCall(\"{call sp_saveCustomer(?,?)}\");\n     pstmt.setString(1, c.getName());\n     pstmt.setString(2, a.getLastName());\n     pstmt.executeUpdate();\n\n     closeConnection();\n\n}\n</code></pre>\n\n<p>What would be the best solution based on the best performance? Should I check myself if the customer exists or should I let the Exception be thrown?</p>\n"},{"tags":["sql","visual-studio-2010","sql-server-2008","visual-studio-2005","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":237,"score":0,"question_id":5488577,"title":"Tableadapter You must have Microsoft SQL 2005 or greater","body":"<p>I just received a project that hasnt been touched in a while. It was written in VS2005 and SQl 2000. I upgraded the project to VS2010 with no problems. However; when I tried to modify the table adapters etc. I get the error \"You must have Microsoft SQL 2005 or greater\".</p>\n\n<p>This project has 100's of datasets and table adapters all referencing SQL 2000.</p>\n\n<p>I guess I have 2 questions:\nShould I takeall these adapters out and make a data layer and connect to the DB that way?</p>\n\n<p>Or can I upgrade the DB to SQL 2008 and it will all work the way it is? Not sure what is the best approach on this one.</p>\n\n<p>And this is a desktop app if it matters.</p>\n\n<p>Any suggestions would be great.</p>\n\n<p>Thanks </p>\n"},{"tags":["sql-server-2008","tsql","geometry","geospatial","spatial"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13114479,"title":"LineString to find Vehicle Passing through my 2 Line (4 Points)","body":"<p>I have got a task where in I have to Draw 2 lines on Google Map (4 Points) and on Submit event I need to display the Vehicle passing through that points. I am able to draw 2 lines on google map which gives me 4 points in Lat/Longitude format.</p>\n\n<p>Now the main questions is how can I query the database to get the Vehicle passing through two lines. I know I might have to use LineString function in T-SQL but how do i get all the vehicle passing through that lines? Any suggestions is welcome.</p>\n"},{"tags":["sql-server-2008","table","stored-procedures","csv"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13088681,"title":"How to update/Edit table through CSVs?","body":"<p>I stored 2 contact numbers in a table corresponding to one companyID in companycontactno. table. I did that using extracting values from CSV in Stored procedure.</p>\n\n<p>If i want to edit those conact numbers Corresponding to company ID how am i going to do that ??</p>\n\n<p>This is the storedProcedure i will use for editing contact numbers .. i am having difficulty in updating it .. plz help</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n\nCREATE PROCEDURE dbo.EditCompanyDetails\n(\n@OldCompanyName varchar(max),\n@NewCompanyName varchar(max),\n@newAddress varchar(max),\n@newMailID varchar(max),\n@Temp varchar(8000)\n)\n\nAS\nBEGIN\nSET NOCOUNT ON;\n\ndeclare @compID int\n\nDECLARE @c int, @a varchar(max), @id int, @variable varchar(8000), @max int\n\nDECLARE @Temp_Table table (serial_no int Identity(1,1), value varchar(max))\n\n--PROCEDURE--\n\n--Editing Company Table--\nset @compID=(Select Company.CompanyID from Company where Company.CompanyName=@OldCompanyName)\n\nupdate Company\nset CompanyName=@NewCompanyName, [Address]=@newAddress, Email=@newMailID\nwhere Company.CompanyID=@compID\n\n--For CONTACT NUMBERS\n\n    --Using Table to store CSV seperately in each row--\nselect @c = CHARINDEX(',', @Temp)\n\nwhile @c &gt; 0\nBEGIN\n    insert into @Temp_Table\n    select LEFT(@Temp, @c - 1)\n\n    select @Temp = right(@Temp, LEN(@Temp) - @c)\n    select @c = CHARINDEX(',', @Temp)\nEND\n\n--Update Table CompanyContactNo\n  --CompanyContactNo have following Columns:\n   --CNoID (PK)\n   --CompanyID (references PK in Company table\n   --ContactNumber\n\nset @max= (select MAX(serial_no) from @Temp_Table)\n\n\nwhile @max &gt; 0\nBEGIN\nset @variable = (select value from @Temp_Table where serial_no=@max)\n\nupdate CompanyContactNo\nset ContactNumber=@variable\nwhere CompanyID=@compID\nset @max = @max-1\nEND\n\nEnd\n\nGO\n</code></pre>\n"},{"tags":[".net","asp.net-mvc","sql-server-2008","ado.net","enterprise-library"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":13112220,"title":"SqlClient login fail when trying to connect to database","body":"<p>This is so weird.  Ok here's my connection string in the web.config of my MVC 4 project:</p>\n\n<p><strong>Here is the connection string in my Unit Test Project's App.Config file:</strong></p>\n\n<pre><code> &lt;add name=\"ConnectionString\" connectionString=\"Data Source=THESERVERNAME;Initial Catalog=THETABLE;Persist Security Info=True;Integrated Security=SSPI\" providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>(I've replaced real names with fakes for this posting privacy only)</p>\n\n<p><strong>My unit test is:</strong></p>\n\n<pre><code>[Test]\npublic void GetMember_ByContractNumber_ReturnsAValidMember()\n{\n    // Arrang\n    const Int64 contractNumber = 2604914977;\n\n    // Act\n    DTO.Member member = MemberCRUD.RetrieveMember(contractNumber);\n\n    //Assert\n    Assert.IsNotNull(member);\n    Assert.IsNotNullOrEmpty(member.FirstName);\n    Assert.IsTrue(member.ContractNumber &gt; 0);\n}\n</code></pre>\n\n<p>It passes just fine!\n  I get a valid member object back from the database CRUD call.</p>\n\n<p><strong>The Problem:</strong></p>\n\n<p>But at the same time, when I try to make essentially the same call and same connection string from an MVC controller, the the same CRUD method in my DL bombs, it out at this point in code:</p>\n\n<p>and I get this exception:</p>\n\n<pre><code>{\"Login failed for user 'OURDOMAIN\\\\MYPCNAMEISHERE$'.\"} System.Data.SqlClient.SqlException\n</code></pre>\n\n<p>This database is <strong>remote</strong>, not on my local system.</p>\n\n<p>So obviously it's permissions but I don't see how to resolve this.  I think the reason my unit test passed is because it was maybe using my windows account as the identity when making the call to the DB whereas IIS for my MVC app was using the AppPoolIdentity.  So not sure how to fix this.  In my web.config I have Authentication set to None but I also tried setting it to Windows auth and enabling windows auth in IIS...no luck.</p>\n\n<p>I'm trying to run through my settings but no combination has worked so far for this permission issue.</p>\n\n<p>Again IIS is setup to use AppPoolIdentity but I also tried Network Service as the identity and added Network Service as a user and gave it permissions to my SQL DB..no luck.  I'm gonna try to add the AppPoolIdentity to my SQL Server DB but I doubt it's gonna work still.  Not sure what to try.\n-------------------------------- SUPPORTING PICS / Very Latest Settings ------------------</p>\n\n<p> in my web.config</p>\n\n<p>(I've got dbo rights on my AD account below)\n<img src=\"http://i.stack.imgur.com/AFx0L.jpg\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/XWEY2.jpg\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/ysEgi.jpg\" alt=\"enter image description here\"></p>\n\n<p>UPDATE:</p>\n\n<p><strong>Here's what I just tried as of the latest:</strong></p>\n\n<p><strong>1) Added the following users to SQL Server Security for my DB and gave them DBO rights:</strong></p>\n\n<ul>\n<li>NT AUTHORITY\\ANONYMOUS LOGON</li>\n<li>DOMAIN\\MYPCNAME$</li>\n<li>NT AUTHORITY\\NETWORK SERVICE</li>\n</ul>\n\n<p><strong>2) Added the following users to the file system security permissions for my app folder:</strong></p>\n\n<ul>\n<li>Authenticated Users</li>\n<li>IUSR</li>\n<li>SYSTEM</li>\n<li>NETWORK SERVICE</li>\n<li>MY AD ACCOUNT (DOMAIN\\MYACCOUNT)</li>\n<li>IIS APPPOOL\\MyAppPoolName</li>\n</ul>\n\n<p><strong>3) Then tried out a few things..all failed with the same error (Login Failed) when I render the MVC View:</strong></p>\n\n<p>changed the app pool identity to use the <strong>Local Service</strong>.  It then tried to connect to the SQL DB using NT AUTHORITY\\ANONYMOUS LOGON - I get login failed for NT AUTHORITY\\ANONYMOUS LOGON</p>\n\n<p>changed the pool identity to use <strong>Local System</strong>.  It tried to auth to SQL using 'DOMAINNAME\\MYPCNAME$' - I get login failed for DOMAINNAME\\MYPCNAME$</p>\n\n<p>changed the app pool identity to use <strong>Network Service</strong>.  It tried connect using 'DOMAINNAME\\MYPCNAME$'. - I get login failed for DOMAINNAME\\MYPCNAME$</p>\n\n<p>changed the app pool identity to use <strong>ApplicationPoolIdentity</strong>.  It tried to connect using 'DOMAIN\\MYPCNAMEN$'. - I get login failed for DOMAINNAME\\MYPCNAME$</p>\n\n<p><img src=\"http://i.stack.imgur.com/p4oQ8.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server-2008","select","increment"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":102,"score":1,"question_id":13055295,"title":"Increment value in SQL SELECT statement","body":"<p>Here is the sample code for what I am trying to do and below is the result:</p>\n\n<pre><code>   CREATE TABLE dbo.#TempDoc_DocContRoles (DocID int null, FullName varchar(500), DocContRole \n     varchar (100), NumRole int null)\n\n   INSERT INTO #TempDoc_DocContRoles(DocID, FullName, DocContRole) \n\n      SELECT \n          d.DocID, c.FirstName + ' ' + c.LastName as FullName, ldcro.DocContRole \n      FROM \n          Document as d \n      JOIN \n          dbo.Split( ',','30,31') AS l ON d.DocID = cast(l.[Value] AS int)\n      JOIN \n          Doc_Contact AS dc ON d.DocID = dc.DocID \n      JOIN \n          Contact AS c ON dc.P_Number = c.P_Number \n      LEFT JOIN \n          lkpDocContactRole AS ldcro ON ldcro.DocContRoleID = dc.DocContRoleID \n      JOIN \n          dbo.Split( ',','1,2,7') AS r ON ldcro.DocContRoleID = cast(r.[Value] AS int)\n\n\n   CREATE TABLE dbo.#MaxNumRoles (DocID int null, DocContRole varchar(100), NumRole int null)\n\n   INSERT INTO  dbo.#MaxNumRoles (DocID,DocContRole,NumRole)\n      SELECT \n          DocID, DocContRole, COUNT(*) \n      FROM \n          dbo.#TempDoc_DocContRoles \n      GROUP BY \n          DocID, DocContRole \n      HAVING \n          Count(*) &gt; 0\n\n   UPDATE td \n   SET td.NumRole = mr.NumRole\n   FROM dbo.#TempDoc_DocContRoles as td\n   INNER JOIN dbo.#MaxNumRoles as mr ON td.DocContRole = mr.docContRole \n\n   SELECT * FROM   dbo.#TempDoc_DocContRoles\n\n   DROP TABLE dbo.#TempDoc_DocContRoles   \n   DROP TABLE dbo.#MaxNumRoles \n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>DocID   FullName    DocContRole NumRole\n30      Smith    Author         3\n30      Daln     Staff          2\n30      Dolby    Author         3\n31      Tammy    Author         3\n30      Barny    Author         3\n30      Sanny    Res Coor       1\n30      Johny    Staff Rev      2\n</code></pre>\n\n<p>I would like to actually get:</p>\n\n<pre><code>DocID   FullName    DocContRole NumRole\n30      Smith    Author         1\n30      Daln     Staff          1\n30      Dolby    Author         2\n31      Tammy    Author         1\n30      Barny    Author         3\n30      Sanny    Res Coor       1\n30      Johny    Staff Rev      2\n</code></pre>\n\n<p>It should increment the number in <code>NumRole</code> per <code>docContRole</code> and <code>docID</code> (ex Author 1, Author 2 etc). Currently it gives the total number of authors per <code>DocID</code>.</p>\n\n<p>My ultimate goal is to get something like</p>\n\n<pre><code>       DocID    Author_1  Author_2 Author_3 Staff_1 Staff_2 ResCoor_1\n30              Smith      Dolby    Barny    Daln    Johny    Sanny \n31              Tammy   \n</code></pre>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":20,"score":-1,"question_id":13110102,"title":"Return a varchar(max) from a stored procedure in SQL Server 2008","body":"<p>I want to return a <code>varchar(max)</code> from a stored procedure in SQL Server 2008.</p>\n\n<p>So I tried:</p>\n\n<pre><code>alter proc SpSignup(\n    @username varchar(max),\n    @email varchar(max),\n    @password varchar(max),\n    @warning varchar(max) output)\nas\n   if exists(select email from [login] where email=@email)\n      return 'email already exists';\n\n   insert into [login](username, email, password) \n   values(@username, @email, @password)\n</code></pre>\n\n<p>I want to return a <code>varchar</code> value (<code>'email already exists'</code>) if the email exists in the table, and don't want to give any <code>@warning</code> as parameter.</p>\n\n<p>But it shows that <code>@warning para is not supplying</code> after exec this proc</p>\n\n<blockquote>\n  <p><em>Msg 201, Level 16, State 4, Procedure SpSignup, Line 0</em><br>\n  <em>Procedure or function 'SpSignup' expects parameter '@warning', which was not supplied.</em></p>\n</blockquote>\n\n<p>and also it doesn't shows the output (<code>'email already exists'</code>)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":58,"score":-1,"question_id":13099038,"title":"Get max of column using sum","body":"<p>I have one table with following data..</p>\n\n<pre><code>saleId amount date\n-------------------------\n  1     2000  10/10/2012\n  2     3000  12/10/2012\n  3     2000  11/12/2012\n  2     3000  12/10/2012\n  1     4000  11/10/2012\n  4     6000  10/10/2012\n</code></pre>\n\n<p>From my table I want result with max of sum amount between dates 10/10/2012 and 12/10/2012 which for the data above will be:</p>\n\n<pre><code>saleId  amount \n---------------\n1       6000\n2       6000\n4       6000\n</code></pre>\n\n<p>Here 6000 is the max of the sums (by saleId) so I want ids 1, 2 and 4.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","delete","delete-row"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":13108778,"title":"Fast deletion of many rows in data warehouse data","body":"<p>In SQL Server 2008 I have some million rows of data which needs be deleted. They are scattered across a handful of tables. Deletion takes up to 20 seconds which I think is way to slow! The data to be deleted is identified by a <code>timestamp</code> column. Here is what I have done so far in order to optimize:</p>\n\n<ul>\n<li>Using isolation level <code>read uncommitted</code>. I don't care about transactions. If we fail the user will issue the delete operation again. And new data is ensured not to have the <code>timestamp</code> we are deleting.</li>\n<li>Deleting leaf tables before parent tables.</li>\n<li>The <code>timestamp</code> column is part of the PK clustered index, in fact its the first position of the PK/index.</li>\n<li>Each table is emptied using a loop which deletes top 200000 entries in order to reduce the transaction log overhead.</li>\n<li>Neither I/O nor CPU is maxed out on the server</li>\n</ul>\n\n<p>What have I overlooked? </p>\n\n<p>Also I am in doubt of the effect of moving the timestamp column to  the first position in the PK. After doing so, must I reorganize the tables or is SQL Server smart enough to do this itself. My understanding of clustered index is that since it defines the physical layout of the rows, it is force into reorganizing the data. But we have no complaints from the customer that the changing clustered index operation took a long time to perform.</p>\n"},{"tags":["sql-server","sql-server-2008","ssms","ssms2008"],"answer_count":4,"favorite_count":3,"up_vote_count":15,"down_vote_count":0,"view_count":6838,"score":15,"question_id":2004789,"title":"How to alter SQL in \"Edit Top 200 Rows\" in SSMS 2008","body":"<p>In SQL Server 2008 Management Studio, when I right click on a database table and choose \"<strong>Select Top 100 Rows</strong>\", I can then e.g. easily add a \"ORDER BY \" statement to the SQL. That works <strong>fine</strong>.</p>\n\n<p>But when I do choose \"<strong>Edit Top 200 Rows</strong>\", I don't have the ability to <strong>alter</strong> the SQL (which makes it hard to find and edit a record just added in the 10,000 that are there.</p>\n\n<p>I am quite sure I was able to do this in <strong>SQL Server 2000</strong>.</p>\n\n<p><strong>Is there any way in SMSS 2008 to alter the way the records are displayed when editing records?</strong></p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":25,"score":0,"question_id":13108219,"title":"How to stop automatic execution of a report?","body":"<p>If all parameters have the default value?</p>\n"},{"tags":["mysql","sql","sql-server","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":655,"score":0,"question_id":6311124,"title":"error 26 on sql server","body":"<p>I have prepared a program with Visual Basic 2010 and am using SQL database. (service based database) it works properly. But sometimes (when i dont use computer for a period like 2 hours) I try to start my program on VB (F5), it waits, and then gives this error:</p>\n\n<blockquote>\n  <p>A network-related or instance-specific error occured while establishing a connection to SQL Server. The server was not found or is not accesible. Verify that the instance name is correct and that SQL Server name is configured to allow remote connections. (provider: SQL Network Interfaces, error: 26 - Error Locating Server/Instance Specified.)</p>\n</blockquote>\n\n<p>However, after restarting my computer one or two times, there is no error: it works well. I have googled it, but nothing helps. I'm afraid this error will be a problem when the user uses the program. How might I solve this?</p>\n"},{"tags":["android","sql-server-2008","ksoap2"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13098333,"title":"Android ksoap2 mssql 2008","body":"<p>I'm trying to pull values off my database msql2008 using  ksoap2. I have a .net webservice setup so that it will ask for a user and then return a string that is contained on the database. But it's not a function it's a procedure and the value is a reference variable. \nHere's my code. I've tried a number of things but nothing seems to work. </p>\n\n<pre><code>package com.example.hellosoap2;\n\nimport org.ksoap2.SoapEnvelope;\nimport org.ksoap2.serialization.PropertyInfo;\nimport org.ksoap2.serialization.SoapObject;\nimport org.ksoap2.serialization.SoapPrimitive;\nimport org.ksoap2.serialization.SoapSerializationEnvelope;\nimport org.ksoap2.transport.HttpTransportSE;\nimport android.app.Activity;\nimport android.os.Bundle;\nimport android.view.View;\nimport android.widget.Button;\nimport android.widget.EditText;\nimport android.widget.TextView;\nimport android.widget.Toast;\n\npublic class MainActivity extends Activity {\n    private static String SOAP_ACTION1 = \"http://tempuri.org/HelloWorld\";\n    private static String NAMESPACE = \"http://tempuri.org/\";\n    private static String METHOD_NAME1 = \"HelloWorldResponse\";\n    private static String URL = \"http://www.letstrend.com/hello.asmx?WSDL\";\n    private static String SOAP_ACTION2 = \"http://tempuri.org/testGoal\";\n    private static String METHOD_NAME2 = \"testGoalResponse\";\n    private static String URL2 = \"http://www.letstrend.com/spurService.asmx?WSDL\";\n\nTextView test1, test2, test3, test4,test5,test6; \n@SuppressWarnings(\"deprecation\")\n@Override\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n    test1 = (TextView)findViewById(R.id.TextView01);\n\n    //Initialize soap request + add parameters\n\n    SoapObject request = new SoapObject(NAMESPACE, METHOD_NAME2);\n    String username = \"dash\";\n    String goalstr = \"\"; \n    request.addProperty(\"user\",username);\n    request.addProperty(\"goal\",goalstr);\n\n    //Declare the version of the SOAP request\n    SoapSerializationEnvelope envelope = new SoapSerializationEnvelope(SoapEnvelope.VER11);\n\n    envelope.setOutputSoapObject(request);\n    envelope.dotNet = true;\n    HttpTransportSE androidHttpTransport = new HttpTransportSE(URL2);\n\n    try {\n            androidHttpTransport.call(SOAP_ACTION2, envelope);\n        SoapPrimitive result=(SoapPrimitive)envelope.getResponse();\n        test1.setText(result.toString());\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n}  \n}\n</code></pre>\n\n<p>I should be sending the function Dash and getting back the value \"Lose 20 pounds\" in goalstr.</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":9,"score":0,"question_id":13107602,"title":"transfer table data from one db to another db based on old 3 months date in sql server 2008 R2","body":"<p>i having database call sampleA table as transaction table, it is keep growing day by day, which is causing an issue while viewing report,thats the reason planing to reduce the volume of records in the table and move to another database, for this to achieve what are the steps to be done,kindly advice</p>\n"},{"tags":["c#","sql-server-2008","view","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":43,"score":0,"question_id":13106836,"title":"Is Entity key is a primary key in entity model","body":"<p>I have added view into entity model. It has 3 entity keys.\nThey are 1.Type 2.No 3.Customer. <img src=\"http://i.stack.imgur.com/d7DqA.png\" alt=\"View data in gridview\"></p>\n\n<p>Doubt:\nIf entity key is primary key then it will never show duplicate value.But in my grid showing duplicate values(see for <strong>Custmor</strong> column and <strong>Type</strong> column But not for <strong>No</strong> column).</p>\n\n<p>this is my SQL Result for view: This is showing duplicate value for No</p>\n\n<p><img src=\"http://i.stack.imgur.com/CLVaW.png\" alt=\"enter image description here\"></p>\n\n<p>Help: I need to show all data from view like SQL Reslut.</p>\n"},{"tags":["c++","sql-server-2008","qt4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12034525,"title":"QSqlDatabase ODBC query speed","body":"<p>I use <code>QSqlDatabase</code> to connect to remote <code>MSSQL Server</code>, but it seem the speed very slow. With a same query (the result is about 20 rows), i tried in <code>MSSQL Management 2008</code> take about 1s but in my application (use <code>QSqlDatabase</code>) it take nearly 8s, Anybody explain me why this happen?</p>\n"},{"tags":["sql-server","tsql","sql-server-2008","ssms2008"],"answer_count":3,"favorite_count":3,"up_vote_count":5,"down_vote_count":0,"view_count":686,"score":5,"question_id":7207779,"title":"Scripts all Sprocs at once with DROP and CREATE","body":"<p>SQL Server 2008</p>\n\n<p><strong>Goal:</strong> To generate scripts for creating sprocs that are already in the DB. Must be one script per file.</p>\n\n<p>I know I can simply right click the database and 'Tasks>Generate Scripts', but that doesn't script the sproc in the template I want.</p>\n\n<p>I need the sproc to be scripted in the same template you get when you right click the sproc from the object explorer and 'Script Stored Procedure As>DROP and CREATE'.</p>\n\n<p>It's true you get a similar version of this through 'Tasks>Generate Scripts' but the main difference is the 'Tasks>Generate Scripts' method creates the script via the <code>dbo.sp_executesql</code> command because you cannot nest a <code>CREATE PROCEDURE</code> inside of an <code>IF</code> block</p>\n\n<p>Tasks>Generate produces this:</p>\n\n<pre><code>USE someDB\nGO\n\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'somesproc') AND type in (N'P', N'PC'))\nDROP PROCEDURE someSproc\nGO\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nIF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'someSproc') AND type in (N'P', N'PC'))\nBEGIN\nEXEC dbo.sp_executesql @statement = N'-- =============================================\nCREATE PROCEDURE \nAS\nBEGIN\n\nEND\n' \nEND\nGO\n</code></pre>\n\n<p>But I require this (as found from right clicking the sproc):</p>\n\n<pre><code>USE someDB\nGO\n\nIF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'someSproc') AND type in (N'P', N'PC'))\nDROP PROCEDURE someSproc\nGO\n\nUSE someDB\nGO\n\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nCREATE PROCEDURE someSproc\n\nAS\nBEGIN\n    SET NOCOUNT ON;\n\nEND\n\nGO\n</code></pre>\n\n<p>Any ideas?</p>\n"},{"tags":["sql-server-2008","xml-parsing","xml-schema"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":23,"score":1,"question_id":13096163,"title":"Shred XML into SQL Server 2008 creates duplicates","body":"<p>I have a XML file that I'm shredding into a table in SQL Server 2008. It goes several nodes deep and this is a first attempt for me to do this so I'm sure I'm missing the point somewhere.</p>\n\n<p>I got it to work, but for a XML with 97 records I get each record 97 times, i.e. a total of 9409 rows in the result set! That takes about 37 seconds. If I use <code>SELECT DISTINCT</code> I get the 97 rows but it (predictably) also takes 37 seconds.  </p>\n\n<p>First row of the XML:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;trmFileDataStream&gt;\n&lt;getTransactionDetails&gt;\n  &lt;getTransactionDetailsResponse&gt;\n    &lt;messages&gt;\n      &lt;resultCode&gt;Ok&lt;/resultCode&gt;\n      &lt;message&gt;\n        &lt;code&gt;I00001&lt;/code&gt;\n        &lt;text&gt;Successful.&lt;/text&gt;\n      &lt;/message&gt;\n    &lt;/messages&gt;\n    &lt;transaction&gt;\n      &lt;transId&gt;4570599999&lt;/transId&gt;\n      &lt;submitTimeUTC&gt;2012-08-12T20:52:05.01Z&lt;/submitTimeUTC&gt;\n      &lt;submitTimeLocal&gt;2012-08-12T15:52:05.01&lt;/submitTimeLocal&gt;\n      &lt;transactionType&gt;authCaptureTransaction&lt;/transactionType&gt;\n      &lt;transactionStatus&gt;pendingSettlement&lt;/transactionStatus&gt;\n      &lt;responseCode&gt;1&lt;/responseCode&gt;\n      &lt;responseReasonCode&gt;1&lt;/responseReasonCode&gt;\n      &lt;responseReasonDescription&gt;Approval&lt;/responseReasonDescription&gt;\n      &lt;AVSResponse&gt;P&lt;/AVSResponse&gt;\n      &lt;batch&gt;\n        &lt;batchId&gt;2007999999&lt;/batchId&gt;\n        &lt;settlementTimeUTC&gt;2012-08-12T21:12:40.193Z&lt;/settlementTimeUTC&gt;\n        &lt;settlementTimeLocal&gt;2012-08-12T16:12:40.193&lt;/settlementTimeLocal&gt;\n        &lt;settlementState&gt;pendingSettlement&lt;/settlementState&gt;\n      &lt;/batch&gt;\n      &lt;authAmount&gt;99.04&lt;/authAmount&gt;\n      &lt;settleAmount&gt;99.04&lt;/settleAmount&gt;\n      &lt;taxExempt&gt;false&lt;/taxExempt&gt;\n      &lt;payment&gt;\n        &lt;bankAccount&gt;\n          &lt;routingNumber&gt;XXXXCCCC&lt;/routingNumber&gt;\n          &lt;accountNumber&gt;XXXXNNNN&lt;/accountNumber&gt;\n          &lt;nameOnAccount&gt;Account Name&lt;/nameOnAccount&gt;\n          &lt;echeckType&gt;WEB&lt;/echeckType&gt;\n        &lt;/bankAccount&gt;\n      &lt;/payment&gt;\n      &lt;customer&gt;\n        &lt;id&gt;UWYN201H7C&lt;/id&gt;\n      &lt;/customer&gt;\n      &lt;billTo&gt;\n        &lt;firstName&gt;FirstName&lt;/firstName&gt;\n        &lt;lastName&gt;LastName&lt;/lastName&gt;\n        &lt;address&gt;123245 Some street.&lt;/address&gt;\n        &lt;city&gt;Some City&lt;/city&gt;\n        &lt;state&gt;WS&lt;/state&gt;\n        &lt;zip&gt;36123&lt;/zip&gt;\n        &lt;country&gt;USA&lt;/country&gt;\n        &lt;phoneNumber&gt;1234567891&lt;/phoneNumber&gt;\n      &lt;/billTo&gt;\n      &lt;recurringBilling&gt;false&lt;/recurringBilling&gt;\n    &lt;/transaction&gt;\n  &lt;/getTransactionDetailsResponse&gt;\n</code></pre>\n\n<p>My <code>SELECT</code> statement:</p>\n\n<pre><code>SELECT distinct\n  transactions.value ('(transId/text())[1]','varchar(100)') AS transID,\n  Replace(Replace(transactions.value ('(submitTimeUTC/text())[1]','varchar(100)'),'T',' '),'Z',' ') AS submitTimeUTC,\n  Replace(transactions.value ('(submitTimeLocal/text())[1]','varchar(100)'),'T',' ') AS submitTimeLocal,\n  transactions.value ('(transactionType/text())[1]','varchar(100)') AS transactionType,\n  transactions.value ('(transactionStatus/text())[1]','varchar(100)') AS transactionStatus,\n  transactions.value ('(responseCode/text())[1]','varchar(100)') AS responseCode,\n  transactions.value ('(responseReasonCode/text())[1]','varchar(100)') AS responseReasonCode,\n  transactions.value ('(responseReasonDescription/text())[1]','varchar(100)') AS responseReasonDescription,\n  transactions.value ('(AVSResponse/text())[1]','varchar(100)') AS AVSResponse,\n  transactions.value ('(authAmount/text())[1]','decimal(10,2)') AS authAmount,\n  transactions.value ('(settleAmount/text())[1]','decimal(10,2)') AS settleAmount,\n  transactions.value ('(taxExempt/text())[1]','varchar(100)') AS taxExempt,\n  transactions.value ('(recurringBilling/text())[1]','varchar(100)') AS recurringBilling,\n  rootb.value        ('(fileInformationLine/text())[1]','varchar(100)') AS FileInfo,\n\n  messagesb.value    ('(resultCode/text())[1]','varchar(100)') AS resultCode,\n  messageb.value     ('(code/text())[1]','varchar(100)') AS MsgCode,\n  messageb.value     ('(text/text())[1]','varchar(100)') AS MsgText,\n\n  batch.value        ('(batchId/text())[1]','varchar(100)') AS batchID,\n  batch.value        ('(settlementTimeUTC/text())[1]','varchar(100)') AS settlementTimeUTC,\n  batch.value        ('(settlementTimeLocal/text())[1]','varchar(100)') AS settlementTimeLocal,\n  batch.value        ('(settlementState/text())[1]','varchar(100)') AS settlementState,\n\n  bankacc.value      ('(routingNumber/text())[1]','varchar(100)') AS routingNumber,\n  bankacc.value      ('(accountNumber/text())[1]','varchar(100)') AS accountNumber,\n  bankacc.value      ('(nameOnAccount/text())[1]','varchar(100)') AS nameOnAccount,\n  bankacc.value      ('(echeckType/text())[1]','varchar(100)') AS echeckType,\n\n  Customer.value     ('(id/text())[1]','varchar(100)') AS customerID,\n\n  billTo.value       ('(firstName/text())[1]','varchar(100)') AS firstName,\n  billTo.value       ('(lastName/text())[1]','varchar(100)') AS lastName,\n  billTo.value       ('(address/text())[1]','varchar(100)') AS address,\n  billTo.value       ('(city/text())[1]','varchar(100)') AS city,\n  billTo.value       ('(state/text())[1]','varchar(100)') AS state,\n  billTo.value       ('(zip/text())[1]','varchar(100)') AS zip,\n  billTo.value       ('(country/text())[1]','varchar(100)') AS country,\n  billTo.value       ('(phoneNumber/text())[1]','varchar(100)') AS phoneNumber\n\nFROM\n   xmlImportTempTable\n\n/* Message branch */\nCROSS APPLY \n   xml_data.nodes('//trmFileDataStream/getTransactionDetails/getTransactionDetailsResponse') AS tMsg(getTD)\n\nOUTER APPLY     getTD.nodes('messages') AS getTD(messagesb)\nOUTER APPLY messagesb.nodes('message')  AS messagesb(messageb)\n\n/* Transaction branches */\nCROSS APPLY xml_data.nodes('//trmFileDataStream') AS Txn(rootb)\n\nOUTER APPLY        rootb.nodes('getTransactionDetails')         AS rootb(getTransDetl)\nOUTER APPLY getTransDetl.nodes('getTransactionDetailsResponse') AS rootc(getTransDtlResp)\nOUTER APPLY getTransDtlResp.nodes('transaction')                AS rootd(transactions)\n\nOUTER APPLY transactions.nodes('batch')       AS btc(batch)\nOUTER APPLY transactions.nodes('payment')     AS pmt(payment)\nOUTER APPLY      payment.nodes('bankAccount') AS bacc(bankacc)\nOUTER APPLY transactions.nodes('customer')    AS cust(customer)\nOUTER APPLY transactions.nodes('billTo')      AS billing(billTo)\n\nORDER BY transID\n</code></pre>\n\n<p>I CAN live with the performance (this will be ongoing imports and the xml files can be 6-7 times bigger than this one ) since I can extract the correct result set.  But I would really like to be able to figure out exactly how to do this right!  I just read here (http://stackoverflow.com/questions/61233/the-best-way-to-shred-xml-data-into-sql-server-database-columns) that adding the schema would help tremendously with the performance and I will try that tomorrow.  The multiple rows are the perplexing issue for me.</p>\n\n<p>Many thanks in advance:)</p>\n\n<p>Arnor Baldvinsson, Icetips Alta LLC</p>\n"},{"tags":["sql","sql-server-2008","tsql","ssis","data-warehouse"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":93,"score":2,"question_id":13061130,"title":"SQL SSIS using Derived Column Transform to deal with null data.. alternatives?","body":"<p>I have a source table that has 200+ columns, I am putting this into SSIS and using \"OLEDB  Source\" component to feed the data in then mapping the flow to a Derived Column Transformation to deal with null numeric/date/text data by replacing it with blank values.</p>\n\n<p>Currently, I am setting in my Derived Column the following expression:</p>\n\n<pre><code>ISNULL([EMPLOYEE ID]) ? \"\" : [EMPLOYEE ID]\n\nISNULL([EMPLOYEE FNAME]) ? \"\" : [EMPLOYEE FNAME]\n</code></pre>\n\n<p>etc...</p>\n\n<p>Since I have 200+ columns, I would have to do this 200 times in the Derived Transform, is there a better way of handling this using SSIS?</p>\n\n<p>Running SQL Server 2008 Standard on Windows 2008R2.</p>\n"},{"tags":["c#","sql-server","database","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":208,"score":3,"question_id":12292644,"title":"Speed up update of 185k rows in SQL Server 2008?","body":"<p>I have a binary file with about <strong>185k</strong> rows in it. <code>C#</code> parses file in seconds. What would be the best way to update <code>MSSQL</code> table with that data?</p>\n\n<p>What I've tried:</p>\n\n<ol>\n<li>Easiest way - read binary row, parse, update table. The whole process takes around 2 days to update all the data.</li>\n<li>Combine 200 update queries and send them at once to the MSSQL. In this case, update takes 8 to 10 hrs.</li>\n<li>Combine 500+ queries into single one. Works faster, but drops timeout exceptions time to time, so some updates are not going through.</li>\n</ol>\n\n<p>Any advice on how to speed up the update process?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13099957,"title":"Dynamic columns SQL Server","body":"<p>I need to come up with an output column based on the following dates entered.</p>\n\n<p>Here is what I have right now </p>\n\n<pre><code>declare @day1 date, @day2 date\n\nset @day1='4/1/2012'\nset @day2='8/31/2012'\n\nSelect * \nfrom\n   (select \n       at.Code, at.Description,\n       case MONTH(jex.Date)\n         when 1 then 'January'\n         when 2 then 'February'\n         when 3 then 'March'\n         when 4 then 'April'\n         when 5 then 'May'\n         when 6 then 'June'\n         when 7 then 'July'\n         when 8 then 'August'\n         when 9 then 'September'\n         when 10 then 'October'\n         when 11 then 'November'\n         when 12 then 'December'\n      end as [Month],\n      jep.Amount [Amount]\n   FROM \n       Journald jep\n   JOIN \n       Journa jex ON jex.JEntryID = jep.JyID\n   WHERE\n       CONVERT(VARCHAR(11), je.Date, 101) BETWEEN @day1 and @day2\n) Tba\nPivot(\nSUM([Amount])\nfor [Month] in ([January],[February],[March],[April],[May],[June],[July],[August],[Septemer],[October],[November],[December])\n)pivotx\n</code></pre>\n\n<p>I have an output where it lists all dates but I only needed to show columns based on the dates entered in this case April, May, June, July, August.</p>\n\n<p>EDIT Here is my output</p>\n\n<p><a href=\"http://i85.photobucket.com/albums/k42/esr0159/output.jpg\" rel=\"nofollow\">http://i85.photobucket.com/albums/k42/esr0159/output.jpg</a></p>\n\n<p>I only need April, May, June,July, August Columns but instead I am still showing all columns.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","csv"],"answer_count":7,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":7798,"score":3,"question_id":5611715,"title":"Where value in column containing comma delimited values","body":"<p>Hi I am wondering how to write an SQL statement for SQL Server 2008 that Selects entry's where a column contains a value, now the value within the column is a comma delimited list (usually - there could only be one entry (and no leading comma)) so what In checking for is \"is this value contained somewhere within the list?\", for instance:</p>\n\n<pre><code>COLUMN = Cat, Dog, Sparrow, Trout, Cow, Seahorse\nDoes COLUMN contain Cat? YES\nDoes COLUMN contain horse? NO\nDoes COLUMN contain Sheep? NO\n</code></pre>\n\n<p>or</p>\n\n<pre><code>COLUMN = Mouse\nDoes COLUMN contain Hare? NO\nDoes COLUMN contain Mouse? YES\n</code></pre>\n\n<p>etc</p>\n\n<p>I was thinking I could use the 'IN' keyword as such</p>\n\n<pre><code>SELECT id_column FROM table_name WHERE 'Cat' IN COLUMN\n</code></pre>\n\n<p>but this does not work as it seems that you can only use that to check if a column contains one of a series of comma delimited values.</p>\n\n<p>I also cannot use CONTAINS() OR 'LIKE' as this, in the above example would return values for 'horse' as the whole string contains horse in 'Seahorse', and I can't search for the needle plus a comma (if I'm looking for 'horse' the search would be 'horse,') as what if the entry is at the end of a the list?  And I can't search for a comma plus a needle (if I'm looking for 'horse' the search would be ',horse')\nas what if the entry is the first in the list? And I can't use both as what if the entry is the only (single) entry?</p>\n\n<p>Thanks for any help anyone can give.</p>\n\n<p>Cheers.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","common-table-expression","nearest-neighbor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13103097,"title":"SQL Server : generating nearest neighbour routes","body":"<p>Having a little trouble with generating routes using a nearest neighbour methodology with SQL Server in T-SQL. </p>\n\n<p><strong>Note:</strong> Using SQL Server 2008, I do not have access to spatial extensions.</p>\n\n<p><strong>Background:</strong></p>\n\n<p>I have a query, which through a series of loops and loops within loops builds routes, however, this query can take in excess of 10 minutes to traverse over 100+ visits.</p>\n\n<p>I have a working system, but I would like to bring the execution time down. Trying to minimise loops as they seem to kill performance. I recently stumbled on CTEs and they have been wonderful for my optimisation so far.</p>\n\n<p>I have the following table populated with all the visits that I have over a given period:</p>\n\n<pre><code>DECLARE @Visits TABLE \n(\n    Unique_ID int identity(1,1), \n    Location_ID int, \n    Day_ID int, \n    Lat float, \n    Long float\n)\n</code></pre>\n\n<p>And I have built a legend of all possible paths per day using:</p>\n\n<pre><code>DECLARE @VisitLegend TABLE  \n(\n    Day_ID int, \n    locationFromId int, \n    locationToId int, \n    distance float\n)\n\nINSERT INTO @VisitLegend (dayId, locationFromId , locationToId , distance)\nSELECT \nv1.Day_ID,\nv1.Unique_ID, \nv2.Unique_ID, \n[dbo].[udf_Distance_Between] (v1.Lat, v1.Long, v2.Lat, v2.Long)\nFROM @Visits v1\nJOIN @Visits v2 on v1.Unique_ID &lt;&gt; v2.Unique_ID \n         AND v1.Current_Day_ID = v2.Current_Day_ID \n         AND NOT (v1.Unique_ID = v2.Unique_ID and v2.Unique_ID = v1.Unique_ID)\n</code></pre>\n\n<p><strong>Question:</strong></p>\n\n<p>Is there a way where I can step through each visit in the <code>@Visits</code> table, traverse the <code>@Visit</code> Legend table by the shortest distance without going to the same visit twice ?</p>\n\n<p>I did make a stab at using a CTE with recursion, however my problem is that I cannot prevent it from selecting a visit again further up the tree, nor can I limit the recursive subset to the smallest distance without trying to use an aggregate or a joined subquery which would only work with references to the parent query.</p>\n\n<p>My current attempt was:</p>\n\n<pre><code>;WITH pathBuilder(dayId, nodeId, distance) AS\n(\n    SELECT Day_ID, Unique_ID, CAST(0.0 as float)\n    FROM @Visits \n        UNION ALL\n    SELECT pb.dayId, vl.locationToId, vl.distance\n    FROM pathBuilder pb\n    JOIN @VisitLegend vl on vl.dayId = pb.dayId \n        and vl.locationFromId = pb.locationId \n)\nSELECT * FROM pathBuilder\n</code></pre>\n\n<p>However I cannot seem to get this to select the locations from the visits table, then step through each in the legend following the shortest and never going back to a <code>visitLocationId</code> that it has already visited.</p>\n\n<p><strong>Intended result:</strong></p>\n\n<p><code>@VisitLegend</code> has the following:</p>\n\n<pre><code>dayId       locationFromId locationToId distance\n----------- -------------- ------------ -----------\n1           1              2            5\n1           1              3            4\n1           2              1            5\n1           2              3            7\n1           3              1            4\n1           3              2            7\n</code></pre>\n\n<p>Which would produce the sequences: </p>\n\n<pre><code>1, 3, 2\n2, 1, 3\n3, 1, 2\n</code></pre>\n\n<p>Any ideas ? Been banging my head against the wall for quite some time on this.</p>\n\n<p>Otherwise is it a case of just using loops and bearing with the execution time?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":70,"score":0,"question_id":13099463,"title":"Query Optimizing Request","body":"<p>I am very sorry if this question is structured in not a very helpful manner or the question itself is not a very good one!</p>\n\n<p>I need to <code>update</code> a <code>MSSQL</code> <code>table</code> call <code>component</code> every 10 minutes based on information from another <code>table</code> call <code>materials_progress</code></p>\n\n<p>I have nearly 60000 records in <code>component</code> and more than 10000 records in <code>materials_progress</code></p>\n\n<p>I wrote an <code>update query</code> to do the job, but it takes longer than 4 minutes to complete execution!\nHere is the <code>query</code> : </p>\n\n<pre><code>UPDATE component \nSET stage_id = \nCASE \n    WHEN t.required_quantity &lt;= t.total_received THEN 27\n    WHEN t.total_ordered &lt; t.total_received THEN 18\n    ELSE 18\nEND\nFROM\n    (\n    SELECT \n        mp.job_id,  \n        mp.line_no,  \n        mp.component,  \n        l.quantity AS line_quantity, \n        CASE WHEN mp.component_name_id = 2 THEN l.quantity*2\n            ELSE l.quantity\n        END AS required_quantity,\n        SUM(ordered) AS total_ordered, SUM(received) AS total_received ,\n        c.component_id \n    FROM line l \n    LEFT JOIN component c ON c.line_id = l.line_id\n    LEFT JOIN materials_progress mp ON l.job_id = mp.job_id AND l.line_no = mp.line_no AND c.component_name_id = mp.component_name_id \n    WHERE \n        mp.job_id IS NOT NULL  \n        AND (mp.cancelled IS NULL OR mp.cancelled = 0)\n        AND (mp.manual_override IS NULL OR mp.manual_override = 0)\n        AND c.stage_id = 18\n    GROUP BY  mp.job_id,  mp.line_no,  mp.component, l.quantity, mp.component_name_id, component_id\n    ) AS t\n\nWHERE \n    component.component_id = t.component_id\n</code></pre>\n\n<p>I am not going to explain the scenario as it too complex.. could somebody please please tell me what makes this query this much expensive and a way to get around it?</p>\n\n<p>Thank you very very much in advance!!!</p>\n\n<p>Edit 1:\nHere is the execution plan;\n<img src=\"http://i.stack.imgur.com/xNgxe.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","sql-server-2008","view","primary-key"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13100088,"title":"How to add a new column (as a primary key column ) to view","body":"<p>Is it possible to add the column (PK) to view. if yes..How can we?</p>\n\n<p>This is my view :</p>\n\n<pre><code>CREATE VIEW [dbo].[SalesDetailView]\nAS\nSELECT\n    DATENAME(yyyy, SH.CreatedDateTime) AS Year,\n    DATENAME(mm, SH.CreatedDateTime) AS Month, SH.CreatedDateTime AS Date,\n    SH.TransactionName AS Type, SH.SalesHeaderID AS No,\n    Customer.CustomerName AS Customer,\n    CustomerGroup.CustomerGroupName AS Customer_Group, SH.Reference AS Memo,\n    Item.ItemName AS Item, SD.LineDescription AS Item_Description,\n    Item.ItemType AS Item_Type, Item.UOM,\n    ItemGroup.ItemGroupName AS Item_Group,\n    CAST (SD.Quantity AS INT) AS Quantity, CAST(SD.Amount AS MONEY) AS Amount,\n    SD.Price, SD.Discount, SH.ExchangeRate AS Exchange_Rate,\n    Currency.CurrencyDescription AS Currency, SD.ClassID AS Class_ID,\n    SD.SalesTaxID AS SalesTax_ID, SalesTaxGroup.SalesTaxGroupName AS Tax_Group,\n    Employee.EmployeeName AS Salesperson,\n    ShippingMethod.ShippingMethodName AS Shipping_Method,\n    PaymentTerm.PaymentTermName AS Payment_Term,\n    PaymentMethod.PaymentMethodName AS Payment_Method\nFROM\n    SalesHeader SH, Customer\nLEFT OUTER JOIN \n    SalesDetail SD ON SH.SalesHeaderID = SD.SalesHeaderID\nLEFT OUTER JOIN \n    Item ON SD.ItemID = Item.ItemID\nLEFT OUTER JOIN \n    ItemGroup ON Item.ItemGroupId = ItemGroup.ItemGroupID\nLEFT OUTER JOIN \n    CustomerGroup ON Customer.CustomerGroupId = CustomerGroup.CustomerGroupID\nLEFT OUTER JOIN \n    Employee ON Customer.EmployeeID = Employee.EmployeeID\nLEFT OUTER JOIN \n    Currency ON Customer.CurrencyID = Currency.CurrencyID\nLEFT OUTER JOIN \n    SalesTaxGroup ON Customer.SalesTaxGroupID = SalesTaxGroup.SalesTaxGroupID\nLEFT OUTER JOIN \n    PaymentTerm ON Customer.PaymentTermID = PaymentTerm.PaymentTermID\nLEFT OUTER JOIN \n    ShippingMethod ON Customer.ShippingMethodID = ShippingMethod.ShippingMethodID\nLEFT OUTER JOIN \n    PaymentMethod ON Customer.PaymentMethodID = PaymentMethod.PaymentMethodID\nWHERE\n    SH.CustomerID = Customer.CustomerID\n    AND SH.TransactionName &lt;&gt; 'SalesOrder'\n    AND Sh.TransactionName &lt;&gt; 'Quote'\n</code></pre>\n"},{"tags":["sql-server-2008","sqlbulkcopy"],"answer_count":6,"favorite_count":5,"up_vote_count":9,"down_vote_count":0,"view_count":1030,"score":9,"question_id":4747126,"title":"Fastest way to insert into a SQL Server table from .NET code?","body":"<p>What is the fastest way to do this:</p>\n\n<ul>\n<li>One table, no references that I cannot prefill (i.e. there is one reference key there, but i have all the data filled in)</li>\n<li>LOTS of data. We talk of hundreds of millions of rows per day, coming in dynamically through an API</li>\n<li>Requests must / should be processed as soon as feasible in a near real time scenario (i.e. no writing out to a file for upload one per day). 2 seconds is the normal maximal delay</li>\n<li>Separate machines for data / application and the SQL Server</li>\n</ul>\n\n<p>What I do now:</p>\n\n<ul>\n<li>Aggregate up to 32*1024 rows into an array, then queue it.</li>\n<li>Read the queue in 2-3 threads. Insert into database using SqlBulkCopy.</li>\n</ul>\n\n<p>I get about 60k-75k rows imported per second, which is not enough, but quite close. I would love to hit 250.000 rows.</p>\n\n<p>So far nothing is really used. I get 20% time \"network I/O\" blocks, have one core 80% loaded CPU side. Discs are writing out 7mb-14mb, mostly idle. Average queue length on a RAID 10 of 6 raptors is.... 0.25.</p>\n\n<p>Anyone any idea how to speed this up? Faster server (so far it is virtual, 8gb ram, 4 cores, physical disc pass through for data).</p>\n\n<hr>\n\n<p>Adding some clarifications:</p>\n\n<ul>\n<li>This is a 2008 R2 Enterprise SQL Server on a 2008 R2 server. machien has 4 cores, 8gb ram. All 64 bit. The 80% load average comes from this machine showing about 20% cpu load.</li>\n<li>The table is simple, has no primary key, only an index on a relational reference (instrument reference) and a unique (within a set of instruments, so this is not enforced) timestamp.</li>\n<li>The fields on the table are: timestamp, instrument reference (no enforced foreign key), data type (char 1, one of a nubmer of characters indicating what data is posted), price (double) and volume (int). As you can see this is a VERY thin table. The data in question is tick data for financial instruments.</li>\n<li>The quesstion is also about hardware etc. - mostly because i see no real bottleneck. I am inserting in multiple transactions and it gives me a benefit, but a small one. Discs, CPU are not showing significant load, network io wait is high (300ms/second, 30% at the moment), but this is on the same virtualization platform which runs JSUT the two serers and has enough cores to run all. I pretty much am open to \"buy anotehr server\", but i want to identify the bottlenech first.... especially given that at the end of the day I am not grabbbing what the bottleneck is. Logging is irrelevant - the bulk inserts do NOT go into the data log as data (no clustered index).</li>\n</ul>\n\n<p>Would vertical partitioning help, for exmaple by a byte (tinyint) that wuold split the instrument universe by for example 16 tables, and me thus doing up to 16 inserts at the same time? As actually the data comes from different exchanges I could make a partition per exchange. This would be a natural split field (which is actualyl in instrument, but I could duplicate this data here).</p>\n\n<hr>\n\n<p>Some more clarifications: Got the speed even higher (90k), now clearlyl mited by network IO between machines, which could be VM switching.</p>\n\n<p>What I do now is do a connetion per 32k rows, put up a temp table, insert into this with SqlBUlkdCopy, THEN use ONE sql statement to copy to main table - minimizes any lock times on the main table.</p>\n\n<p>Most waiting time is now still on network IO. Seems I run into issues where VM wise. wIll move to physicla hardware in the next months ;)</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13095871,"title":"Merge not inserting. No error","body":"<p>Can someone tell me why this insert is failing but not giving me an error either?  How do I fix this?</p>\n\n<pre><code>merge table1 as T1\nusing(select p.1,p.2,p.3,p.4,p.5 from @parameters p\ninner join table1 t2\non p.1 = t2.1\nand p.2 = t2.2\nand p.3 = t2.3\nand p.4 = t2.4) as SRC on SRC.2 = T1.2\nwhen not matched then insert (p.1,p.2,p.3,p.4,p.5) \nvalues (SRC.1,SRC.2,SRC.3,SRC.4,SRC.5)\nwhen matched then update set t1.5 = SRC.5;\n</code></pre>\n\n<p>The T1 table is currently empty so nothing can match.  The parameters table does have data in it.  I simply need to modify this merge so that it checks all 4 fields before deciding what to do.  </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":5,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1391,"score":3,"question_id":2136336,"title":"Sql Server 2008 Cross-database table linking (relationships)","body":"<p>I have a bit of an issue, and to be honest I don't think there's an answer, but I'll give it a try anyway.</p>\n\n<p>So I have two databases [A]->Company and [B]->Product. Both databases have a Country table which is then linked to other tables in each individual database. The problem is that the data between the two Country tables is a complete duplicate. So, I essentially have to duplicate some of the relationships in each database, and maintenance on top of that is just difficult...</p>\n\n<p>So, I'm curious is there a way to create a cross-database relationship between tables so I can have only one set of Country+Helper tables that govern both databases?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13098973,"title":"How To Secure SQL Server Database On Client Machine?","body":"<p>I Just Completed My Window Application,In Which I Use SQL Server 2008 as Back-End.\nI Install My App With Database In Client Machine.\nBut Problem Is That My Client Can Also See My Database Using Sql Server Mangement Studio.\nI Want to Prevent Client To See Database.\nHow can i do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":65,"score":4,"question_id":13093642,"title":"Select rows with same column A but different column B","body":"<pre><code>ID          Zip        Room\n----------- ---------- ------\n317         94087      S105\n318         94087      L603\n1739        94404-1801 L603\n1823        94401-2129 L603\n1824        94401-2129 L603\n2135        94404-1801 L603\n2268        95136-1459 S604\n2269        95136-1459 S604\n3704        92673-6417 L402\n4479        93454-9670 L402\n4480        93454-9670 L402\n4782        92395-4681 L402\n4783        92395-4681 L402\n4852        92886-4411 L402\n4853        92886-4411 L402\n4959        92673-6417 L402\n5153        91773-4028 L402\n5202        91773-4028 L402\n5211        91765-2959 L402\n5212        91765-2959 L402\n5388        92336-0605 L402\n5392        92336-0605 L402\n5727        92870      L402\n5728        92870      L402\n5831        92557      L402\n5916        92557      L402\n</code></pre>\n\n<p>How do I select ID's that has THE SAME zip but different Room ?</p>\n\n<p>In the table above, I want the result to be:</p>\n\n<pre><code>ID          Zip        Room\n----------- ---------- ------\n317         94087      S105\n318         94087      L603\n</code></pre>\n\n<p>Using SQL Server 2008</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":33,"score":2,"question_id":13095216,"title":"SQL no primary or candidate keys in the referenced table","body":"<p>Here's my problem when I write my SQLSever expressions:</p>\n\n<blockquote>\n  <p>There are no primary or candidate keys in the referenced table 'Room'<br>\n  that match the referencing column list in the foreign key 'FK_<em>Booking</em>_RoomNo__4E298478'.</p>\n</blockquote>\n\n<p>And some snapshots to my program:</p>\n\n<pre><code>CREATE TABLE Booking(\n   HotelNo  NVARCHAR(4)     not null,\n   GuestNo      SMALLINT,  \n   DateFrom DATETIME    not null,\n   DateTo       DATETIME,\n   RoomNo       SMALLINT    not null,\n\n   PRIMARY KEY (HotelNo,DateFrom,RoomNo), \n   FOREIGN KEY (HotelNo) REFERENCES Hotel(HotelNo),\n   FOREIGN KEY (GuestNo) REFERENCES Guest(GuestNo),\n   FOREIGN KEY (RoomNo) REFERENCES Room(RoomNo));  &lt;---trouble on this line\n\nCREATE TABLE Room(\n   RoomNo       SMALLINT    not null, \n   HotelNo  NVARCHAR(4)     not null, \n   RoomType     NVARCHAR(25),\n   Price        DECIMAL(5,2),\n\n   PRIMARY KEY (RoomNo,HotelNo), \n   CONSTRAINT fk_Room FOREIGN KEY (HotelNo) REFERENCES Hotel(HotelNo));\n</code></pre>\n\n<p>and here is the Hotel table</p>\n\n<pre><code>CREATE TABLE Hotel(\n   HotelNo  NVARCHAR(4)     not null,\n   HotelName    NVARCHAR(25),\n   City     NVARCHAR(25),\n\n   PRIMARY KEY (HotelNo) );\n</code></pre>\n\n<p>I tried to do some search on this problem, and it says this might be caused when there's no primary key defined in the table Room, but as above, it is defined.</p>\n\n<p>Can someone please help me with this problem? </p>\n\n<p>Thank you in advance.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":2,"up_vote_count":8,"down_vote_count":0,"view_count":31966,"score":8,"question_id":2474839,"title":"Unable to login to SQL Server + SQL Server Authentication + Error: 18456","body":"<p>I have created login account on my localhost\\sql2008 Server (Eg. User123)</p>\n\n<p>Mapped to Database (default)</p>\n\n<p>Authentication Mode on SQL Server is set to both (Windows and SQL)</p>\n\n<p>But login to SQL Server fails with following message (for User123)</p>\n\n<p>Note:  Have checked multiple time that UserName / Password are typed in correctly</p>\n\n<p>Error Details:</p>\n\n<blockquote>\n  <p>Login failed for user 'User123'\n  (Net.SqlClient Data Provider)</p>\n  \n  <p>Server Name : localhost\\sql2008 Error\n  Number: 18456 Severity : 14 State : 1\n  Line Number : 65536</p>\n</blockquote>\n\n<p>any help on this please.</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","jquery","sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":2,"view_count":40,"score":-1,"question_id":13098194,"title":"combine strings and convert to time of sql server using c# or jquery","body":"<p>I have two dropdowns for <code>startHour</code>, <code>startMinute</code>.Now i need to take selected hour and minute from dropdown and save in sql as time(7) datatype. How can i convert data using c# or jquery?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server-2008","log4net","support"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3120,"score":1,"question_id":1210906,"title":"does log4net AdoNetAppender support sql server 2008?","body":"<p>my config file below: very strange, i have spent a day to find out where i am wrong, but still not working, it still not log anything in the databasebut i can output them using RollingFileAppender. Also, the store procedure WriteLog is working well.(I have tested it using sql server studio). I have tried to change the connectionType but not working. \nUnfortunately I dont have sql server 2000/2005 to test, my log4net version should be the latest one: log4net 1.2.10. Any help is appreciated.  </p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;section name=\"log4net\" type=\"log4net.Config.Log4NetConfigurationSectionHandler, log4net\" /&gt;\n  &lt;/configSections&gt;\n  &lt;log4net&gt;\n      &lt;appender name=\"AdoNetAppender_SqlServer\" type=\"log4net.Appender.AdoNetAppender\"&gt;\n        &lt;!--&lt;threshold value=\"OFF\" /&gt;--&gt;\n        &lt;bufferSize value=\"1\" /&gt;\n        &lt;connectionType value=\"System.Data.SqlClient.SqlConnection, System.Data, System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;\n        &lt;!--&lt;connectionType value=\"System.Data.SqlClient.SqlConnection, System.Data, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" /&gt;--&gt;\n        &lt;connectionString value=\"Data Source=.\\MSSQLSERVER2008,2222;Initial Catalog=UnleashedSaaS;User ID=sa;Password=dogblack;\" /&gt;\n        &lt;commandType value=\"StoredProcedure\" /&gt;\n        &lt;commandText value=\"WriteLog\" /&gt;\n        &lt;parameter&gt;\n        &lt;parameterName value=\"@log_date\" /&gt;\n        &lt;dbType value=\"DateTime\" /&gt;\n        &lt;layout type=\"log4net.Layout.PatternLayout\" value=\"%date{yyyy'-'MM'-'dd HH':'mm':'ss'.'fff}\" /&gt;\n            &lt;/parameter&gt;\n      &lt;parameter&gt;\n                &lt;parameterName value=\"@thread\" /&gt;\n                &lt;dbType value=\"String\" /&gt;\n                &lt;size value=\"255\" /&gt;\n                &lt;layout type=\"log4net.Layout.PatternLayout\" value=\"%thread\" /&gt;\n            &lt;/parameter&gt;\n      &lt;parameter&gt;\n                &lt;parameterName value=\"@log_level\" /&gt;\n                &lt;dbType value=\"String\" /&gt;\n                &lt;size value=\"50\" /&gt;\n                &lt;layout type=\"log4net.Layout.PatternLayout\" value=\"%level\" /&gt;\n            &lt;/parameter&gt;\n      &lt;parameter&gt;\n        &lt;parameterName value=\"@logger\" /&gt;\n                  &lt;dbType value=\"String\" /&gt;\n                  &lt;size value=\"255\" /&gt;\n                  &lt;layout type=\"log4net.Layout.PatternLayout\" value=\"%logger\" /&gt;\n            &lt;/parameter&gt;\n      &lt;parameter&gt;\n              &lt;parameterName value=\"@message\" /&gt;\n              &lt;dbType value=\"String\" /&gt;\n              &lt;size value=\"4000\" /&gt;\n              &lt;layout type=\"log4net.Layout.PatternLayout\" value=\"%message\" /&gt;\n            &lt;/parameter&gt;\n         &lt;parameter&gt;\n             &lt;parameterName value=\"@exception\" /&gt;\n             &lt;dbType value=\"String\" /&gt;\n             &lt;size value=\"4000\" /&gt;\n             &lt;layout type=\"log4net.Layout.ExceptionLayout\" /&gt;\n         &lt;/parameter&gt;\n      &lt;/appender&gt;\n      &lt;appender name=\"RollingLogFileAppender\" type=\"log4net.Appender.RollingFileAppender\" &gt;\n        &lt;!--&lt;threshold value=\"OFF\" /&gt;--&gt;\n        &lt;file value=\"LogData\\\\\" /&gt;\n        &lt;appendToFile value=\"true\" /&gt;\n        &lt;datePattern value=\"ul_yyyy-MM-dd.LOG\" /&gt;\n        &lt;maxSizeRollBackups value=\"10\" /&gt;\n        &lt;rollingStyle value=\"Date\" /&gt;\n        &lt;maximumFileSize value=\"2MB\" /&gt;\n        &lt;staticLogFileName value=\"false\" /&gt;\n        &lt;layout type=\"log4net.Layout.PatternLayout\"&gt;\n          &lt;param name=\"ConversionPattern\" value=\"%d{yyyy-MM-dd HH:mm:ss} %p %u %c %l %m %n%n%n\" /&gt;\n        &lt;/layout&gt;\n      &lt;/appender&gt;\n      &lt;root&gt;\n        &lt;level value=\"ALL\"/&gt;\n        &lt;appender-ref ref=\"AdoNetAppender_SqlServer\" /&gt;\n        &lt;appender-ref ref=\"RollingLogFileAppender\" /&gt;\n      &lt;/root&gt;\n    &lt;/log4net&gt;\n&lt;/configuration&gt;\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":13086725,"title":"fetch values of radiobutton list of primary key table to another foreign key table using asp.net","body":"<p>I have created two tables in a SQL Server database and a RadioButtonList in an ASP.NET page. In one table I have stored values for each radio button as primary key. I want that on clicking that radio button, its primary key value in stored another table in a foreign key column.</p>\n\n<p>Here I am using store procedure in MS-SQl. \nprimary key table is gender and foreign key table is user.In aspx page i dm dispalying gender as radiobuttons, now the question is how can i fetch primary id of gender table and fill in users table.My code is as below:</p>\n\n<pre><code>ArrayList arSample = new ArrayList();\nObject[] n_gender_id = new Object[3] { \"@intGender\", \"Int\", (rbtngender.SelectedValue != \"\") ? rbtngender.SelectedValue : \"\" };\n</code></pre>\n\n<p>I am getting values of radiobutton how get ids of particular button.\nhelp out.......</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13095183,"title":"getting cumulative average per client_ID","body":"<p>I have a table called:</p>\n\n<p><strong>F_Accession_Daily</strong></p>\n\n<pre><code>test_id varchar\nreceived_date date\npatient_id varchar\nclient_id varchar\n</code></pre>\n\n<p>There can be multiple test_id's per patient. Every test_id has only one received_date. every client_id can have multiple patient_id's. </p>\n\n<p>right now I am returning the average test frequency of times tested (<strong>TestFreq</strong>) per <code>client_id</code>. I have a column that will return </p>\n\n<blockquote>\n  <p>[test frequency of patients that had 2 and only 2 tests], [test\n  frequency for patients that had 3 and only 3 tests], [test frequency\n  for patients that had 4 and only 4].....[12 and only 12]. (these are labeled below as testfreq1, testfreq2, testfreq3....testfreq12</p>\n</blockquote>\n\n<p>These are only a client_id basis. </p>\n\n<p>example of the returned data:</p>\n\n<pre><code>+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n| client_id | MonthsCustomer | TotalPatients | Totalaccessions | count1 | TestFreq1 | stdv1 | count2 | TestFreq2 |  stdv2  | count3 | TestFreq3 |  stdv3  | count4 | TestFreq4 |  stdv4  | count5 | TestFreq5 |  stdv5  | count6 | TestFreq6 |  stdv6  | count7 | TestFreq7 |  stdv7  | count8 | TestFreq8 |  stdv8  | count9 | TestFreq9 |  stdv9  | count10 | TestFreq10 | stdv10  | count11 | TestFreq11 | stdv11  | count12 | TestFreq12 | stdv12  |\n+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n|    100001 |             42 |          4289 |           15393 |   1976 |         0 |     0 |    719 |       152 | 202.793 |    385 |       140 | 136.356 |    262 |       130 | 99.5561 |    183 |       117 | 81.273  |    136 |       111 | 71.8437 |    112 |       104 | 62.8288 | 87     | 98        | 51.9194 |     75 |        89 | 49.9136 |      63 |         96 | 40.0267 |      57 |         94 | 37.497  | 45      | 102        | 32.6785 |\n|    100003 |             34 |          2098 |           16026 |    509 |         0 |     0 |    303 |        68 | 97.9581 |    190 |        62 | 55.5366 |    137 |        61 | 50.9664 |    101 |        61 | 48.5921 |     89 |        46 | 27.7256 |     62 |        55 | 38.2849 | 77     | 46        | 27.995  |     60 |        49 | 27.8421 |      51 |         47 | 22.2794 |      48 |         42 | 21.0575 | 40      | 46         | 19.9365 |\n|    100004 |             36 |          5841 |           10693 |   3712 |         0 |     0 |   1122 |       223 | 256.033 |    468 |       236 | 157.251 |    211 |       181 | 103.755 |    165 |       175 | 76.5761 |     86 |       161 | 67.6254 |     46 |       151 | 55.4122 | 13     | 121       | 31.1677 |     12 |       104 | 45.7847 |       2 |         88 | 7.77817 |       3 |         92 | 36.2261 | NULL    | NULL       | NULL    |\n|    100008 |             37 |           581 |            1276 |    249 |         0 |     0 |    174 |        96 | 63.7575 |     91 |        72 | 35.5402 |     38 |        60 | 19.4539 |      9 |        59 | 10.2402 |      5 |        25 | 12.6372 |      1 |        43 | NULL    | NULL   | NULL      | NULL    |      2 |        27 | 4.94975 |       3 |         17 | 12.2202 |       1 |         28 | NULL    | 3       | 21         | 4.04145 |\n+-----------+----------------+---------------+-----------------+--------+-----------+-------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+--------+-----------+---------+---------+------------+---------+---------+------------+---------+---------+------------+---------+\n</code></pre>\n\n<p>I need to add another column that gives the <code>TOTAL AVERAGE TEST FREQUENCY</code> per client_id. </p>\n\n<p>Another words, I would like to get the average of all the patients per client. </p>\n\n<p>the formula to get the average test frequency is:</p>\n\n<pre><code>(max(received_date) - min(received_date) )/ (count(distinct test_id)-1)\n</code></pre>\n\n<p>I need to get the average of above per patient per client, how do I do it?</p>\n\n<p>Thank you so much for your guidance.</p>\n\n<p>here's my current query that returned the above dataset:</p>\n\n<pre><code>with counted as(\n SELECT\n    client_id,\n    --case when COUNT(*)&gt;=12 then 12 else COUNT(*) end  TimesTested, \n    COUNT(*) as timestested,\n    case when count(*)&gt;1 then\n    (datediff(day,MIN(received_date),max(received_date)))\n  /(COUNT(*)-1) \n else\n 0\n end as testfreq\n  FROM f_accession_daily\n  GROUP BY\n    client_id,\n    patient_id    \n\n),counted2 as (\n  SELECT\n    client_id,\n   TimesTested,\n    CAST(COUNT(*) AS varchar(30)) AS count,\n    CAST(AVG(testfreq) as varchar(30)) as TestFreq,\n    CAST(STDEV(TestFreq) as varchar(30)) Stdv\n  FROM counted\n  GROUP BY\n    client_id,\n    TimesTested\n    )\n    ,\nunpivoted AS (\n  SELECT\n    client_id,\n    ColumnName + CAST(TimesTested AS varchar(10)) AS ColumnName,\n    ColumnValue\n  FROM counted2\n  UNPIVOT (\n    ColumnValue FOR ColumnName IN (count, TestFreq,stdv)\n  ) u\n),\npivoted AS (\n  SELECT\n    client_id clientid,\n    count1, TestFreq1,stdv1,\n    count2, TestFreq2,stdv2,\n    count3, TestFreq3,stdv3,\n    count4, TestFreq4,stdv4,\n    count5, TestFreq5,stdv5,\n    count6, TestFreq6,stdv6,\n    count7, TestFreq7,stdv7,\n    count8, TestFreq8,stdv8,\n    count9, TestFreq9,stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n  FROM unpivoted\n  PIVOT (\n    MAX(ColumnValue) FOR ColumnName IN (\n      count1,TestFreq1,stdv1,\n      count2,TestFreq2,stdv2,\n      count3,TestFreq3,stdv3,\n      count4,TestFreq4,stdv4,\n      count5,TestFreq5,stdv5,\n      count6,TestFreq6,stdv6,\n      count7,TestFreq7,stdv7,\n    count8, TestFreq8,   stdv8,\n    count9, TestFreq9,   stdv9,\n    count10, TestFreq10,stdv10,\n    count11, TestFreq11,stdv11,\n    count12, TestFreq12,stdv12\n    )\n  ) p\n)\n,\nPatientStats as\n(\n select \n distinct\n f.client_id\n ,datediff(MM,c.mlis_date_established,GETDATE()) MonthsCustomer\n ,count(distinct patient_id) TotalPatients\n ,count(distinct accession_id) Totalaccessions\n from F_ACCESSION_DAILY f\n left join D_CLIENT c\n on f.CLIENT_ID=c.CLIENT_ID\n group by f.client_id,c.mlis_date_established\n)\n,\nOver12\nas\n(\nselect client_id,SUM(c) sumcount from\n(\nselect CLIENT_ID,COUNT(*) c\nfrom F_ACCESSION_DAILY\ngroup by CLIENT_ID,PATIENT_ID\nhaving count(*)&gt;12\n) a\ngroup by client_id\n)\n, final as (\nSELECT p.*,pivoted.*,Over12.sumcount SumofGreaterThan12\nFROM pivoted\nleft join PatientStats p\non p.CLIENT_ID=pivoted.CLIENTID\nleft join Over12\non over12.CLIENT_ID=p.CLIENT_ID\nwhere p.CLIENT_ID not in (select CLIENTid from SalesDWH..TestPractices)\n)\n/* Get the data into a temp table */\nSELECT * INTO #TempTable\nFROM final\n/* Drop the cloumns that are not needed */\nALTER TABLE #TempTable\nDROP COLUMN clientid\n/* Get results and drop temp table */\nSELECT * FROM #TempTable\norder by 1 \nDROP TABLE #TempTable\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13091505,"title":"SQL Server - Reference a column by name in agrregate function","body":"<p>Our application uses a series of tables with many varchar(1000) columns in them. During development of the system, that was considered to be more than enough space for the users to enter text. However, now we're encountering problems with text being cut off, so it seems like some users are entering more text that it can hold. However, I believe that there's rampant misuse of these fields, and I want to see which columns are being used.</p>\n\n<p>From a different question that was answered here on SO, I've come up with the following query to extract the names of the varchar columns in a table:</p>\n\n<pre><code>select\n   syscolumns.name as [Column],\n   syscolumns.length as [MaxLength]\nfrom \n   sysobjects, syscolumns \nwhere sysobjects.id = syscolumns.id\nand   sysobjects.xtype = 'u'\nand   sysobjects.name = 'TableWithTooManyVarcharColumns'\nand syscolumns.xusertype = 167\n</code></pre>\n\n<p>but now I want to use the names of these columns in a new query, and calculate </p>\n\n<pre><code>SELECT \n[Column] as [Name],\n[MaxLength],\nMAX(LEN([Column])) as [MaxUsedLength],\nAVG(LEN([Column])) as [AvgUsedLength],\nSTDEV(LEN([Column])) as [StdDev]\nFROM TableWithTooManyVarcharColumns\nINNER JOIN **{{ reference to table from query above }}**\n</code></pre>\n\n<p>Of course, the first query returns the name of the column, while the second one needs a reference to the column, so I'm not sure how to combine them properly. Any SQL Server gurus able to help?</p>\n"},{"tags":["sql-server","sql-server-2008","indexed-view"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2404,"score":3,"question_id":3501825,"title":"SQL Server Create View Index which contains distinct or group by","body":"<p>I have a table of address data in my SQL server database. This table is not normalized so it contain many addresses the are repeated. Each unique address can be identified by an Id field (these ids repeat often in the table).</p>\n\n<p>So i created a view on the table to extract all the unique addresses, using Select Distinct(AddressId) from the original table.</p>\n\n<p>Now i would like to create an index on this view to increase the speed of searching, but SQL server is not allowing me to create an index on the view as it contains a distinct or group by (i have tried both to see if it would allow me create index)</p>\n\n<p>Has anyone got any solution around this? or any views to an alternate way to do this.</p>\n\n<p>I need to query this view based on address keywords and return the ones based on the matching count, i have this query in place i'm trying to speed it up by indexing fields in the view.</p>\n\n<p>SQL Server 2008</p>\n\n<pre><code>SELECT      \n    AddressId,  \n    AddressNumber,  \n    AddressName, \n    Town, \n        City,\n        Country,\n    COUNT_BIG(*) As AddCount--,\n    --TRIM(AddressNumber + ' ') + LTRIM(AddressName + ' ')  + LTRIM(Town + ' ') + RTRIM(City + ' ') AS AddressLookup\nFROM\n    [Address] A\nGROUP BY\n    AddressId,\n    AddressNumber, \n    AddressName, \n    Town, \n    City, \n    Country\n</code></pre>\n\n<p>is my query....</p>\n\n<p>if i take out the column with AddressLookup i can add the indexes</p>\n\n<p>Cheers</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","null"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":5,"view_count":74,"score":-4,"question_id":13092010,"title":"Alter every column in the database to disallow nulls in a SQL Server database","body":"<p>I've been struggling with the following problem;</p>\n\n<p>We have a large database with 2000+ columns and we have allowed nulls in the majority of them.\nNow I need a script that goes through all the columns and sets all the null values to a default value and alters the column to disallow nulls while setting the default.</p>\n\n<p>I need a script to do this for all the different datatypes (<code>nvarchar</code>, <code>int</code>, <code>smallint</code>, <code>datetime</code> etc).</p>\n\n<p>The reason I'm doing this is that I'm migrating the code to .net and it's a pain to handle all the null values that shouldn't be nulls.</p>\n\n<p>Also: <a href=\"http://www.bennadel.com/blog/85-Why-NULL-Values-Should-Not-Be-Used-in-a-Database-Unless-Required.htm\" rel=\"nofollow\">http://www.bennadel.com/blog/85-Why-NULL-Values-Should-Not-Be-Used-in-a-Database-Unless-Required.htm</a>\nand: <a href=\"http://msdn.microsoft.com/en-us/library/ms189265(v=sql.105).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/ms189265(v=sql.105).aspx</a></p>\n\n<p>Thanks for your time. :)</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":72,"score":1,"question_id":13092682,"title":"SSIS package - loop through different connections for Execute SQL task","body":"<p>I am creating an MSSQL2008 SSIS package to generate and email reports from database tables. It works perfectly on a single database.  The client is running 3 different databases used by 3 different divisions.  The database structure is exactly the same. All three databases are located on the same server, same security / credentials are used.</p>\n\n<p>I created a \"For Each Loop Container\" in my SSIS package that loops through the list of 3 items and populates it into a variable.  How do I now take that and pass it to the \"Execute SQL Task\" to run three times (once for each database)?</p>\n\n<p>Thank you for your time!</p>\n"},{"tags":["mysql","sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":296,"score":3,"question_id":9261205,"title":"The SQL Server equivalent for the MySQL Limit","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2135418/equivalent-of-limit-and-offset-for-sql-server\">Equivalent of LIMIT and OFFSET for SQL Server?</a>  </p>\n</blockquote>\n\n\n\n<p>this is a mysql query</p>\n\n<pre><code>SELECT email FROM emailTable LIMIT 9,20 WHERE id=3\n</code></pre>\n\n<p>how do you write it in SQL Server (2008)?</p>\n\n<p>do I have to write </p>\n\n<pre><code>SELECT TOP 9,20 email FROM emailTable WHERE id=3\n</code></pre>\n\n<p>?\nThank you for your help</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":13088856,"title":"SQL Server : add CSV programmable","body":"<p>I have the following code to insert a CSV file into a temp table:</p>\n\n<pre><code>USE [websitehere.com].[dbo]\nGO\nCREATE TABLE [websitehere.com].[dbo].[tmpTable]\n(ID INT,\n    Caller_Number VARCHAR(100),\n    Caller_Name VARCHAR(100),\n    GroupBy VARCHAR(100),\n    Campaign_Name VARCHAR(100),\n    DateAndTime VARCHAR(100),\n    Duration VARCHAR(100),\n    Call_Status VARCHAR(100))\nGO;\n\nBULK\nINSERT tmpTable \nFROM 'C:\\Users\\namehere\\Documents\\CallLog.csv' \nWITH\n(\n    FIELDTERMINATOR = ',',\n    ROWTERMINATOR = '\\n'\n)\nGO\n</code></pre>\n\n<p>But...</p>\n\n<ol>\n<li><p>It does not seem to add the <code>tmpTable</code>. It gives me an error </p>\n\n<blockquote>\n  <p><em>Msg 102, Level 15, State 1, Line 1<br>\n  Incorrect syntax near '.'.</em></p>\n</blockquote></li>\n<li><p>It won't add the insert command saying that</p>\n\n<blockquote>\n  <p><em>Msg 4834, Level 16, State 4, Line 8<br>\n  You do not have permission to use the bulk load statement.</em></p>\n</blockquote></li>\n</ol>\n\n<p>Any help would be great to take care of these 2 errors!</p>\n\n<p><strong>Update</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/Hxv6A.png\" alt=\"db user secutirys\"></p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":13093585,"title":"When selecting function list from SQL Server 2008, Routine_body=External but all other data NULL","body":"<p>I'm attempting to get a list and definition of user defined functions within 3 different databases to combine into a single database.  </p>\n\n<p>I have the select statement that lists the 3 user defined functions but when I run it the <code>ROUTINE_BODY</code> column shows <code>'EXTERNAL'</code> but <code>EXTERNAL_NAME</code> and <code>EXTERNAL_LANGUAGE</code> is <code>NULL</code> (as well as <code>ROUTINE_DEFINITION</code> which it should be for an <code>EXTERNAL</code> routine).</p>\n\n<pre><code>SELECT * \nFROM INFORMATION_SCHEMA.ROUTINES \nWHERE ROUTINE_TYPE = 'FUNCTION'  \n</code></pre>\n\n<p>This gives me back the database, routine name, everything I need except for the actual definition of the function.  Can anyone help me with where SQL Server may be storing the SQL for the functions?</p>\n"},{"tags":["sql-server-2008","tsql","large-data-volumes"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":42,"score":2,"question_id":13092561,"title":"Inner join and Split on large volume of data","body":"<p>We are working on large volume data (row counts given below) :</p>\n\n<pre><code>Table 1 : 708408568 rows  -- 708 million\nTable 2 : 1416817136 rows -- 1.4 billion\n\nTable 1 Schema:\n----------------\nID -      Int PK\ncolumn2 - Int\n\nTable 2 Schema\n----------------\nTable1ID - Int FK\nSomeColumn - Int\nSomeColumn - Int\n</code></pre>\n\n<p>Table1 has PK1 which servers as FK for Table 2.</p>\n\n<h2>Index details :</h2>\n\n<pre><code>Table1 : \nPK Clustered Index on Id\nNon Clustered (Non Unique) on column2\n\nTable 2 :\nTable1ID (FK) Clustered Index\n</code></pre>\n\n<p>Below is the query which needs to be executed :</p>\n\n<pre><code>SELECT t1.[id]\n      ,t1.[column2]\nFROM  Table1 t1\ninner join Table2 t2\n    on s.id = cs.id\nWHERE t1.[column2] in (select [id] from ConvertCsvToTable('1,2,3,4,5.......10000')) -- 10,000 Comma seperated Ids\n</code></pre>\n\n<p>So to summarize, The inner join on ID should be handled by the clustered index on the same Ids on both PK and FK.\nand as for the \"huge\" Where condition on column2 we have a nonclustered index.</p>\n\n<p>However, the query is taking 4 minutes for a small subset of 100 Ids, we need to pass 10,000 ids.</p>\n\n<p>Is there a better way design wise that we can do this, or possibly does Table Partitioning help?</p>\n\n<p>Just wanted to get some ways of how to solve huge volume Select with Inner Join and Where IN.</p>\n\n<p>Note : ConvertCsvToTable is a Split function which has already been determined to perform optimally.</p>\n\n<p>Thanks !</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","sql-server-2008-r2"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13092702,"title":"How to iterate this SQL Query?","body":"<p>I've got this query: </p>\n\n<pre><code>SELECT TOP 1 A.ExamTemplateId, A.Id AS AnsweredTestId, AVG(B.Score) AS AvgScore, A.[Date]\nFROM AnsweredTest AS A\nINNER JOIN AnsweredWorksheet AS B ON (A.Id = B.AnsweredTestId)\nWHERE A.StudentId = 'OPA-3DKCL2' AND A.ExamTemplateId = 1\nGROUP BY A.Id, A.ExamTemplateId, A.[Date]\nORDER BY AvgScore DESC\n</code></pre>\n\n<p>Please check that I have a <code>WHERE</code> condition which receives a static number. The query result is:</p>\n\n<p>EXAMPLE 1\n<img src=\"http://i.stack.imgur.com/EZqHP.png\" alt=\"\"></p>\n\n<p>EXAMPLE 2\n<img src=\"http://i.stack.imgur.com/mAdO8.png\" alt=\"enter image description here\"></p>\n\n<p>And it is correct! But now, I'd like to show all the records from a ExamTemplate table. But now I don't know how can I accomplish that. I was thinking creating a function but I'm not sure, it's just an idea.</p>\n\n<p>The final output which I'd like to receive is the union of last records:</p>\n\n<pre><code>1   1   0.7 2012-10-21 19:50:11.697\n2   10  0.555555555555556   2012-10-22 18:58:24.163\n</code></pre>\n\n<p>Thanks in advance.</p>\n\n<p>UPDATE:</p>\n\n<p>I've got highlighted with yellow color the rows which I'm interested. I set in the last query <code>TOP 1</code> because I want to get the highest average score by <code>ExamTemplateId</code>. And that's will be all.</p>\n\n<p><img src=\"http://i.stack.imgur.com/VUALu.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server","sql-server-2008","database-design"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12936672,"title":"Table design with joining tables or separate ID in main table","body":"<p>I'm designing a database that has a couple of tables; FAQ's, Bulletins, and Attachments.  Bulletins and FAQ's could have an attachment associated with them, so my initial thought was to create a joining table with the two primary keys as a composite key:</p>\n\n<pre><code>Bulletin\n--------\nBulletinID\nSubject\nDescription\nNotes\n\nAttachment\n-----------\nAttachmentID\nFileName\nFilePath\netc.\n</code></pre>\n\n<p>Joining table:</p>\n\n<pre><code>BulletinAttachments\n-------------------\nBulletinID\nAttachmentID\n</code></pre>\n\n<p>As I design this, I also thought, what if other entities are introduced later (say Newsletter, Email, etc.) that need Attachments as well.  I would have to create a joining table for each of these entities.  Not awful, but it made me think, what if I got rid of the joining tables and put an AttachmentType in the Attachment table and then assigned the type accordingly:</p>\n\n<pre><code>AttachmentType\n--------------\nAttachmentTypeID\nAttachmentType\nDescription\n</code></pre>\n\n<p>The data in that table would be:<br>\n1-Bulletin<br>\n2-FAQ<br>\n3-Newsletter<br>\n4-Email</p>\n\n<p>Then the Attachment table would hold the AttachmentTypeID to identify it:</p>\n\n<pre><code>Attachments\n-----------\nAttachmentID\nAttachmentTypeID\nFileName\nFilePath\netc.\n</code></pre>\n\n<p>So my question is, for performance wise (using SQL 2008 R2), is there a better choice between the two?  Is there a better way to design this?  My concern with using individual joining tables is that we may have more entities come along and to accommodate Attachments, we would have to create a joining table and on our front-end software, we would have to write logic for it whereas the AttachmentTypeID would allow the front-end to insert a new AttachmentType and no db interaction would be needed.</p>\n"},{"tags":["sql-server-2008","geolocation","geocoding"],"answer_count":2,"favorite_count":6,"up_vote_count":17,"down_vote_count":0,"view_count":4580,"score":17,"question_id":7409051,"title":"Why use the SQL Server 2008 geography data type?","body":"<p>I am redesigning a customer database and one of the new pieces of information I would like to store along with the standard address fields (Street, City, etc.) is the geographic location of the address.  The only use case I have in mind is to allow users to map the coordinates on Google maps when the address cannot otherwise be found, which often happens when the area is newly developed, or is in a remote/rural location.</p>\n\n<p>My first inclination was to store latitude and longitude as decimal values, but then I remembered that SQL Server 2008 R2 has a <code>geography</code> data type.  I have absolutely no experience using <code>geography</code>, and from my initial research, it looks to be overkill for my scenario.</p>\n\n<p>For example, to work with latitude and longitude stored as <code>decimal(7,4)</code>, I can do this:</p>\n\n<pre><code>insert into Geotest(Latitude, Longitude) values (47.6475, -122.1393)\nselect Latitude, Longitude from Geotest\n</code></pre>\n\n<p>but with <code>geography</code>, I would do this:</p>\n\n<pre><code>insert into Geotest(Geolocation) values (geography::Point(47.6475, -122.1393, 4326))\nselect Geolocation.Lat, Geolocation.Long from Geotest\n</code></pre>\n\n<p>Although it's not <em>that</em> much more complicated, why add complexity if I don't have to?</p>\n\n<p>Before I abandon the idea of using <code>geography</code>, is there anything I should consider?  Would it be faster to search for a location using a spatial index vs. indexing the Latitude and Longitude fields?  Are there advantages to using <code>geography</code> that I am not aware of?  Or, on the flip side, are there caveats that I should know about which would discourage me from using <code>geography</code>?</p>\n\n<hr>\n\n<h2>Update</h2>\n\n<p>@Erik Philips brought up the ability to do proximity searches with <code>geography</code>, which is very cool.  </p>\n\n<p>On the other hand, a quick test is showing that a simple <code>select</code> to get the latitude and longitude is significantly slower when using <code>geography</code> (details below).  , and a comment on the <a href=\"http://stackoverflow.com/questions/6386577/sql-server-2008-r2-geography-distance/6387558#6387558\">accepted answer</a> to another SO question on <code>geography</code> has me leery:</p>\n\n<blockquote>\n  <p>@SaphuA You're welcome. As a sidenote be VERY carefull of using a\n  spatial index on a nullable GEOGRAPHY datatype column. There are some\n  serious performance issue, so make that GEOGRAPHY column non-nullable\n  even if you have to remodel your schema.  Tomas Jun 18 at 11:18</p>\n</blockquote>\n\n<p>All in all, weighing the likelihood of doing proximity searches vs. the trade-off in performance and complexity, I've decided to forgo the use of <code>geography</code> in this case.</p>\n\n<hr>\n\n<p>Details of the test I ran:</p>\n\n<p>I created two tables, one using <code>geography</code> and another using <code>decimal(9,6)</code> for latitude and longitude:</p>\n\n<pre><code>CREATE TABLE [dbo].[GeographyTest]\n(\n    [RowId] [int] IDENTITY(1,1) NOT NULL,\n    [Location] [geography] NOT NULL,\n    CONSTRAINT [PK_GeographyTest] PRIMARY KEY CLUSTERED ( [RowId] ASC )\n) \n\nCREATE TABLE [dbo].[LatLongTest]\n(\n    [RowId] [int] IDENTITY(1,1) NOT NULL,\n    [Latitude] [decimal](9, 6) NULL,\n    [Longitude] [decimal](9, 6) NULL,\n    CONSTRAINT [PK_LatLongTest] PRIMARY KEY CLUSTERED ([RowId] ASC)\n) \n</code></pre>\n\n<p>and inserted a single row using the same latitude and longitude values into each table:</p>\n\n<pre><code>insert into GeographyTest(Location) values (geography::Point(47.6475, -122.1393, 4326))\ninsert into LatLongTest(Latitude, Longitude) values (47.6475, -122.1393)\n</code></pre>\n\n<p>Finally, running the following code shows that, on my machine, selecting the latitude and longitude is approximately 5 times slower when using <code>geography</code>.</p>\n\n<pre><code>declare @lat float, @long float,\n        @d datetime2, @repCount int, @trialCount int, \n        @geographyDuration int, @latlongDuration int,\n        @trials int = 3, @reps int = 100000\n\ncreate table #results \n(\n    GeographyDuration int,\n    LatLongDuration int\n)\n\nset @trialCount = 0\n\nwhile @trialCount &lt; @trials\nbegin\n\n    set @repCount = 0\n    set @d = sysdatetime()\n\n    while @repCount &lt; @reps\n    begin\n        select @lat = Location.Lat,  @long = Location.Long from GeographyTest where RowId = 1\n        set @repCount = @repCount + 1\n    end\n\n    set @geographyDuration = datediff(ms, @d, sysdatetime())\n\n    set @repCount = 0\n    set @d = sysdatetime()\n\n    while @repCount &lt; @reps\n    begin\n        select @lat = Latitude,  @long = Longitude from LatLongTest where RowId = 1\n        set @repCount = @repCount + 1\n    end\n\n    set @latlongDuration = datediff(ms, @d, sysdatetime())\n\n    insert into #results values(@geographyDuration, @latlongDuration)\n\n    set @trialCount = @trialCount + 1\n\nend\n\nselect * \nfrom #results\n\nselect avg(GeographyDuration) as AvgGeographyDuration, avg(LatLongDuration) as AvgLatLongDuration\nfrom #results\n\ndrop table #results\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>GeographyDuration LatLongDuration\n----------------- ---------------\n5146              1020\n5143              1016\n5169              1030\n\nAvgGeographyDuration AvgLatLongDuration\n-------------------- ------------------\n5152                 1022\n</code></pre>\n\n<p>What was more surprising is that even when no rows are selected, for example selecting where <code>RowId = 2</code>, which doesn't exist, <code>geography</code> was still slower:</p>\n\n<pre><code>GeographyDuration LatLongDuration\n----------------- ---------------\n1607              948\n1610              946\n1607              947\n\nAvgGeographyDuration AvgLatLongDuration\n-------------------- ------------------\n1608                 947\n</code></pre>\n"},{"tags":["sql-server-2008","query","wildcard","like-operator"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13077636,"title":"Parameterizing an SQL query which uses the NOT LIKE, \" ^ \" wildcard?","body":"<p>How can I parameterize the following query? (By the way I'm using a full text indexed table, hence the <code>CONTAINS()</code>)</p>\n\n<pre><code>SELECT * FROM Table WHERE CONTAINS(Column, 'cat OR dog') \nand ((column NOT LIKE '%[^ cat OR dog]%')); \n</code></pre>\n\n<p>This didn't work:</p>\n\n<pre><code> DECLARE @term1 VARCHAR(10);\n\n DECLARE @term2 VARCHAR(10);\n\n SET @term1 = 'cat';\n\n SET @term2 = 'dog';\n\nSET @term3 = @term1 + ' ' + 'OR' + ' ' + @term2;\n\nSET @term4 = '[^ @term1  OR  @term2 ]' ;\n\nSELECT * FROM table WHERE CONTAINS(column, @term3) &lt;--up to this point works\nAND (column NOT LIKE '%[@term4]%'); &lt;--this part doesn't include the second term (@term2)\n</code></pre>\n\n<p>If you'd like to fiddle with this on your end, my Full Text Indexed table looks like:</p>\n\n<pre><code> animalListID     AnimalsList\n       1           cat dog\n       2           cat\n       3           cat dog bird\n</code></pre>\n\n<p>(basically i need the parameterized version of the <code>SELECT</code> statement which returns the rows with 'cat dog' and 'cat' and NOT 'cat dog bird')</p>\n\n<p>**This is a VERY oversimplified version of my data, but the question is an exact match of the concept I'm trying to achieve. The table will have millions of rows, and many terms in each row.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":16,"score":0,"question_id":13091875,"title":"Update Script from Select","body":"<p>I need your support here.I want to change this to an update statement,I want to update all null values of E.Age with Birthage from PersonDeatl .The below script just selects .Table Employee and and PersonDeatl do not have keys to join them nor with EmpRet.Thanks guys</p>\n\n<pre><code>select distinct * from ((Select     \n           E.EmployeeId,E.Address,E.City,E.Zip,E.State,E.Age\n         from Employee E join\n          EmpRet R\n            on E.EmployeeId=R.EmployeeId\n        where R.Dscription='Age not Qualify'  and E.Age is null)Ag inner join\n       (select address,city,zip,state,BirthAge from PersonDeatl)Pd\n\n          on ag.Address=Pd.Address and ag.City=Pd.City and ag.zip=Pd.Zip)\n</code></pre>\n"},{"tags":["database","sql-server-2008","vb.net-2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":13091330,"title":"Creating database tables data type","body":"<p>I am creating Employee table what Data Type I gave to CNIC No means (National Identity Card) No,, for example CNIC No:54400-1566178-1.\n Please tell me anyone what data type i give </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13091072,"title":"How to find the SUM of the Calculated Percentage Column in SQL","body":"<p>I have a Column which calculates the Percentage , like this</p>\n\n<pre><code>Convert(decimal(5,2),(PatCount*100)/@PatientCount) as Per\n</code></pre>\n\n<p>Now i want the Total Sum of the above calculated Percentage. So i tried doing this,</p>\n\n<pre><code>,SUM(Convert(decimal(5,2),(PatCount*100)/@PatientCount)) as pa\n</code></pre>\n\n<p>But i am not geting the Desired Result . For ex </p>\n\n<pre><code>Per %    Total %\n6.00     6.00\n7.00     7.00\n85.00    85.00\n</code></pre>\n\n<p>I want the total Col to print as 98%.  Please can Somebody help me with this.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13090690,"title":"MS SQL REPLACE not showing results","body":"<p>Hey all i have the following query:</p>\n\n<pre><code>SELECT REPLACE(REPLACE(REPLACE(REPLACE(tmpTable.Caller_Number,'-',''),'(',''),')',''),' ','') \nFROM tmpTable \nWHERE EXISTS \n(SELECT REPLACE(REPLACE(REPLACE(REPLACE(OnlineAppDetails.addPhone,'-',''),'(',''),')',''),' ','') \nFROM OnlineAppDetails \nWHERE OnlineAppDetails.addPhone = tmpTable.Caller_Number)\nORDER BY GroupsBy ASC;\n</code></pre>\n\n<p>It returns no records... However, when i do this query:</p>\n\n<pre><code>SELECT * \nFROM tmpTable \nWHERE EXISTS \n(SELECT * FROM OnlineAppDetails \nWHERE SUBSTRING(OnlineAppDetails.addPhone,2,3)+'-'+SUBSTRING(OnlineAppDetails.addPhone,7,4)+SUBSTRING(OnlineAppDetails.addPhone,11,4) = tmpTable.Caller_Number)\nORDER BY GroupsBy ASC;\n</code></pre>\n\n<p>It returns records..</p>\n\n<p>The phome number is formatted like:</p>\n\n<pre><code>for OnlineAppDetails: (xxx) xxx-xxxx\nfor         tmpTable: xxx-xxx-xxxx\n</code></pre>\n\n<p>All i am doing is taking out the <strong>- ( ) and [space]</strong> in the phone number just to be sure i am being returned all the records i should be. I know there are matches in both tables so taking out <strong>- ( ) and [space]</strong> should still result in records returned.</p>\n\n<p><strong>update</strong></p>\n\n<p>Duh.... knew it was going to be simple.</p>\n\n<pre><code>SELECT * \nFROM tmpTable \nWHERE EXISTS \n(SELECT * \nFROM OnlineAppDetails \nWHERE  REPLACE(REPLACE(REPLACE(REPLACE(OnlineAppDetails.addPhone,'-',''),'(',''),')',''),' ','') = REPLACE(REPLACE(REPLACE(REPLACE(tmpTable.Caller_Number,'-',''),'(',''),')',''),' ',''))\nORDER BY GroupsBy ASC;\n</code></pre>\n"},{"tags":["sql-server-2008","iis","connection"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":21,"score":2,"question_id":13090256,"title":"IIS SQL connection fails under heavy load; reset IIS fixes temporarily","body":"<p>Server 1:  SQL Server 2008 Standard Edition\nServer 2:  Windows 2008 Server R2, IIS 7.0</p>\n\n<p>A web-site on Server 2 requires data in SQL Server on Server 1.</p>\n\n<p>Everything works fine for a while (weeks sometimes).  Then, under heavy load, Server 2 reports it cannot connect SQL Server on Server 1.  Once IIS on Server 2 reports it cannot connect to SQL on Server 1, it does not get better until IIS on Server 2 is restarted.  Perhaps restarting the application pool would work as well as a full IIS reset.  I'm not certain.</p>\n\n<p>I've tried changing the connection string to increase the connection pool size to unreasonably large values (1,000).  The failures still happen.</p>\n\n<p>The web-site is written in C#.  The data access layer is NHibernate.</p>\n\n<p>Here is the start of the exception:</p>\n\n<pre><code>[SqlException (0x80131904): A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)]\n   System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject) +428\n   System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection) +65\n   System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory) +117\n   System.Data.SqlClient.SqlConnection.Open() +122\n   NHibernate.Connection.DriverConnectionProvider.GetConnection() +60\n   NHibernate.Impl.SessionFactoryImpl.OpenConnection() +39\n</code></pre>\n\n<p>Any ideas why this is happening?  How to diagnose/fix it?  I'm frustrated and considering ripping out NHibernate, which will take months and probably lead to many other kinds of problems.</p>\n"},{"tags":["sql-server-2008","data-warehouse","business-intelligence","msas"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":13078556,"title":"Multiple kinds of payees","body":"<p>I make payments to various kinds of payees and I'm wondering whether I should create a dimension of each kind of payee and have multiple foreign keys in my fact table, or conflate the various kinds of payees via a type attribute and have a single FK in the PaymentFact table at the expense of having attributes that make no sense in the PayeeDim table for any particular value of PayeeDim.Type...</p>\n\n<p>how are these situations normally handled?</p>\n\n<p>TIA - e</p>\n"},{"tags":["sql-server-2008","excel","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13086976,"title":"SSIS with Excel sheets","body":"<p>I have created ssis package to loda data from excel to database. My problem is Those excel files proteced with password( I know the password) at the minute i am removing password mannually. Is there any way to automate in ssis, Because i have 200 excel files.</p>\n"},{"tags":["sql","sql-server-2008","timeout"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13088501,"title":"SQL Select Query Timing Out","body":"<p>I have a table in my SQL Server 2008 database called <strong>dbo.app_additional_info</strong> which contains approximately 130,000 records. Below shows the structure of the table.</p>\n\n<p><img src=\"http://i.stack.imgur.com/DLmyN.png\" alt=\"enter image description here\"></p>\n\n<p>When I run a query like the one below in SQL Server Management Studio 2008</p>\n\n<pre><code>select app_additional_text\nfrom app_additional_info\nwhere application_id = 2665 --Could be any ID here\n</code></pre>\n\n<p>My query takes a long time to execute (up to 5minutes) and sometimes it times out. This database is also connected to a Web Application and when it runs the above query, I always get a timeout error.</p>\n\n<p>Is there anything I can do to speed up the performance of my query? </p>\n\n<p>Your help with this would be greatly appreciated as this is grinding my web application to a halt.</p>\n\n<p>Thanks.</p>\n\n<p><strong>Update</strong></p>\n\n<p>Below shows my execution plan from SSMS (I apologise for poor quality)</p>\n\n<p><img src=\"http://i.stack.imgur.com/xEnit.png\" alt=\"enter image description here\">\n<img src=\"http://i.stack.imgur.com/iMb8K.jpg\" alt=\"enter image description here\"></p>\n"},{"tags":["multithreading","performance","sql-server-2008","parallel-processing"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":289,"score":0,"question_id":9561903,"title":"The query processor could not start the necessary thread resources","body":"<p>I having this error on my mssql server especially when there are many records inserted at the same time:\n <em>\"100|The query processor could not start the necessary thread resources for parallel query execution.\"</em> </p>\n\n<p>i try google search the problem to upgrade my sql performance so that can avoid this error, and plenty of it suggests to set maxdrop on the query or the max degree of parallelism on the mssql. </p>\n\n<p>But how can i know how many the value of the maxdrop or max degree of parallelism i should set to? \nand how i check the maximum value of max degree of parallelism of my server can run?\nif i change the max degree of parallelism of the server, means all the store proc will run following that setting, so will it affect other performance? or i just need to set the maxdrop on certain store proc?</p>\n"},{"tags":["sql","sql-server-2008","login","active-directory"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1007,"score":0,"question_id":9603405,"title":"Updating SQL Server 2008 LOGIN SID","body":"<p>If an Active Directory SID doesn't match the \n <code>SQL Server 2008</code>\n Login SID (<code>sys.server_principal</code>) there doesnt appear to be a way to ALTER/UPDATE that value.  <code>ALTER USER</code> will allow you to remap a USER to a LOGIN, but <code>ALTER LOGIN</code> will not allow you to remap a LOGIN to Active Directory so to my question</p>\n\n<p>Is there any way, documented or otherwise, to update the LOGIN SID with the AD SID besides dropping and recreating the login?  I am using <code>OPENROWSET</code> to get the AD SID value, but I can't find a way to update the LOGIN SID (mostly because I don't think it can be done)</p>\n\n<p>By the way, I am aware that ad-hoc queries to the system tables are not allowed (because I tried that already).</p>\n"},{"tags":["sql-server-2008","adventureworks"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":8833302,"title":"Unable to find the instance while installing AdventureWorks2008R2_SR1","body":"<p>while installing the AdventureWorks2008R2_SR1 which is downloaded from the codeplex site, the instance value is not showing. How to enable the instance there. i can able lo log in to the sql server with the instance HA-INT2. But while installing AdventureWorks2008R2_SR1 it is not showing the instance. \nI attached the screen shot please find it<img src=\"http://i.stack.imgur.com/NcN50.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13087197,"title":"What happens when multiple simultaneous update requests received for a SQL table?","body":"<p>I have a table in SQL server database in which I am recording the latest activity time of users. Can somebody please confirm me that SQL server will automatically handle the scenario when multiple update requests received simultaneously for different users. I am expecting 25-50 concurrent update request on this table but each request is responsible for updating different rows in the table. Do i need something extra like connection pooling etc..?</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2","profiler","sql-server-profiler"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13087228,"title":"How do I see the final query text for a stored procedure sql query?","body":"<p>I am investigating a single stored procedure that is returning odd results. It dynamically builds sql and uses views and functions. It is difficult to follow what the final sql query applied to the database actually is from the code.</p>\n\n<p>Can I use SQL Server Profiler to see the final query text? </p>\n\n<p>If so, what are the steps? And how do I restrict the Profiler to monitor only a single specific stored procedure? </p>\n"},{"tags":["sql","sql-server","sql-server-2008","reporting-services"],"answer_count":3,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":3985,"score":6,"question_id":947379,"title":"Reporting Services Subscriptions won't allow modification of the To: Field","body":"<p>I have a little issue that is causing me a headache.  Our Report Server is SQL Ent 2008 on a Win 2008 server.  When users that have Report Browser permissions try to set up a report subscription the To: field is grayed out and pre-populated with their username.  They cannot change this and it won't deliver to their email address which would be username@domain.com.  Any leads would be greatly appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":4148,"score":0,"question_id":3011782,"title":"How to solve the sql server 2008 restore error 3203","body":"<p>I am trying to restore the database in SQL Server 2008. The backup file is  SQL Server 2008 from another PC <strong>. When i want to restore show me the error</strong> </p>\n\n<p>TITLE: Microsoft SQL Server Management Studio</p>\n\n<pre><code>------------------------------\n\nAn exception occurred while executing a Transact-SQL statement or batch. (Microsoft.SqlServer.ConnectionInfo)\n\n------------------------------\nADDITIONAL INFORMATION:\n\nRead on \"D:\\New Folder (2)\\mihirreliance.bak\" failed: 38(Reached the end of the file.) (Microsoft SQL Server, Error: 3203)\n\nFor help, click: http://go.microsoft.com/fwlink?ProdName=Microsoft+SQL+Server&amp;ProdVer=10.00.1600&amp;EvtSrc=MSSQLServer&amp;EvtID=3203&amp;LinkId=20476\n\n------------------------------\nBUTTONS:\n\nOK\n------------------------------\n</code></pre>\n\n<p>Why this problem aries .How to solve this error.</p>\n"},{"tags":["sql-server-2008","amazon-web-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13087063,"title":"Microsoft SQL Server backup import to AWS Database","body":"<p>I want to import a .bak file in amazon DB instance (windows server 2008 r2), but this thing is not possible, because of permissions on the AWS.</p>\n\n<p>From Microsoft SQL Management Studio Restored the database from the .bak file to my local instance of SQL server (This worked)</p>\n\n<p>Have tried the following solutions but none of them worked:\n-Exported the tables and views on the AWS, this apparently worked, no problems were displayed,\nbut not exported for ex:Constraints, Triggers, Stored Procedures.</p>\n\n<p>-Generated script file for the Stored Proc., Triggers -> Some of them were working</p>\n\n<p>-Tried to Generate Script file for the whole DB, but it is big ~400mb, and could not execute the script on the AWS.</p>\n\n<p>Any suggestions would be great, regarding how to copy the database to the AWS or, how to restore a .bak file</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server-2008","datetime"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":120,"score":0,"question_id":13086021,"title":"Convert mm/dd/yyyy hh:mm;ss AM/PM to datetime","body":"<p>When I am trying to convert date I am getting below error</p>\n\n<pre><code>DECLARE @MinLogDate AS varchar(100)\nDECLARE @MinDate AS DATETIME\n\nSET @MinLogDate = '10/26/2012 01:23:90 AM'\nSET @MinDate = (SELECT CONVERT(CHAR(10), CONVERT(datetime, @MinLogDate,103),101))\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n  <p><em>The conversion of a varchar data type to a datetime data type resulted in an out-of-range value.</em></p>\n</blockquote>\n\n<p>How can I convert the varchar time to datetime?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>based on the answer i have modified.. below is the actual date time i am getting .. so now I am able to get mindate but max date is not working</p>\n\n<pre><code>    DECLARE @MinDate AS DATETIME\n    DECLARE @MaxDate AS DATETIME\n    DECLARE @MinLogDate AS varchar(100)\n    DECLARE @MaxLogDate AS varchar(100)\n\n    SET @MinLogDate = '8/1/2012 01:00:00 AM'\n    SET @MaxLogDate = '8/31/2012 01:00:00 PM'\n\n    SET @MinDate = CONVERT(datetime, LEFT(@MinLogDate, 10), 101)\n    SET @MaxDate = CONVERT(datetime, LEFT(@MaxLogDate, 10), 101)\n\n    SELECT @MinDate\n    SELECT @MaxDate\n</code></pre>\n"},{"tags":["mysql","sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":13081363,"title":"Load MySQL \".SQL Dump File\" into SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/1770795/convert-mysql-script-to-mssql\">Convert MySQL script to MSSQL</a>  </p>\n</blockquote>\n\n\n\n<p>I have *.sql dump file that generated from the MySQL Server using the SQL Yog tool.Please anyone tell me how to convert the MySQL *.sql dump file in to SQL Script file.</p>\n"},{"tags":["sql-server","sql-server-2008","powershell","smo"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13072207,"title":"Can't get powershell to handle a SQL Server connection failure","body":"<p>I am deliberately trying to log in to a SQL Server where I do not have a login to test some error handling with PowerShell 2.0 and SMO using SQL Server 2008 R2.</p>\n\n<p>Here's my script:</p>\n\n<pre><code>param ([String]$instanceName);\n[System.Reflection.Assembly]::LoadWithPartialName('Microsoft.SqlServer.SMO') | out-null;\n\n$conn = new-object Microsoft.SqlServer.Management.Common.ServerConnection ; \n$conn.LoginSecure = $true; \n$conn.ServerInstance = $instanceName ; \n$conn.NonPooledConnection = $true ;  \n\ntry {\n    $serverInstance = New-Object Microsoft.SqlServer.Management.Smo.Server ($conn) ; \n}\n\ncatch { \n    $err = $Error[0].Exception ; \n    write-host \"Error caught: \"  $err.Message ; \n    continue ; \n} ; \n\nWrite-Output $serverInstance.Version;\n</code></pre>\n\n<p>the catch block does not get executed. Any ideas? I also tried to trap it using the <code>trap</code> function, but got the same result.</p>\n\n<p><strong>UPDATE 1</strong></p>\n\n<p>I have changed my script to the following and have got it to catch an exception on line</p>\n\n<pre><code>foreach($j in $serverInstance.Databases) {\n</code></pre>\n\n<p>If I comment out the foreach loop, <strong>the line below the foreach loop does not raise an exception</strong>, although it should (IMO).</p>\n\n<pre><code>param ([String]$instanceName);\n\n[System.Reflection.Assembly]::LoadWithPartialName('Microsoft.SqlServer.SMO') | out-null; # load the SMO assembly\nclear\n\n $ErrorActionPreference = \"Stop\";\n    $conn = new-object Microsoft.SqlServer.Management.Common.ServerConnection ; \n    $conn.LoginSecure = $false; \n    $conn.Login = \"sa\" ; \n    $conn.Password = \"password\" ; \n    $conn.ServerInstance = $instanceName ; \n    $conn.NonPooledConnection = $true ;  \n\ntry {\n    $serverInstance = New-Object Microsoft.SqlServer.Management.Smo.Server ($conn) ; \n    foreach($j in $serverInstance.Databases) { \n        write-host $j.name ; \n    } ; \n    Write-Output $serverInstance.Databases.Count;\n}\n\ncatch [Microsoft.SqlServer.Management.Common.ConnectionFailureException] {\n    $err = $Error[0].Exception ; \n    write-host \"Error caught: \"  $err.Message ; \n    while ( $err.InnerException )    {\n        $err = $err.InnerException;\n        Write-Host \"Inner exception:\" $err.InnerException.Message;\n        };      \n    return;\n} ; \n</code></pre>\n"},{"tags":["sql-server","visual-studio","sql-server-2008","visual-studio-2010"],"answer_count":3,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":2712,"score":3,"question_id":2419828,"title":"DB Designer in Visual Studio 2010","body":"<p>I need to create an entirely new Sql Server 2008 database and want to use a Database Project in Visual Studio 2010 (Ultimate). I've created the project and added a table under the <em>dbo</em> schema. </p>\n\n<p>The table <em>.sql</em> is shown only as plain text, though with colors. It has no designer, no <em>Add Column</em>, and no autocomplete. Existing column's properties are grayed out. </p>\n\n<p>Usually, I use DB Project for nothing more than storing <em>.sql</em> files for source control purposes, but I'm assuming it can help me with designing the DB. Currently, it offers no such help and I think it's because I'm doing something wrong. Perhaps I need to deploy the DB to server first, or something of the such. I've looked for a Getting Started guide, but all guides I found start from importing an existing database.</p>\n\n<p><strong>Please help my understand what a DB Project can do for me and how.</strong></p>\n\n<p>Thanks,<br>\nAsaf</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":13084902,"title":"SQL: Convert String of MMMDD to Datetime","body":"<p>I have a nvarchar(5) column of data that is formatted MMMDD (for example, OCT26). With my select statement, I'd like to convert it to a datetime data type with the current year, and then save that datetime value as an alias, say, UsefulDate. So something like 10-26-2012.</p>\n\n<p>Something like: SELECT (whatever SQL gets the job done) AS UsefulDate</p>\n\n<p>The exact formatting doesn't matter; I just need to be able to compare two dates together with greater than and less than operators. Also, sometimes the column will be blank. In that case, I'd like to set the alias to blank as well. Is this possible?</p>\n\n<p>Thanks for your help!</p>\n"},{"tags":["sql","sql-server-2008","ssis"],"answer_count":3,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":1650,"score":5,"question_id":10499290,"title":"Is it possible to deploy SSIS 2012 package on SQL Server 2008","body":"<p>I have a package that is developed in SSIS 2012 using Visual Studio 2010. </p>\n\n<ul>\n<li><p>Is it possible to deploy/attach this package on SQL Server 2008 </p></li>\n<li><p>If it is possible, does the licence of the sql server matter</p></li>\n</ul>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008","bids"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13084388,"title":"SSRS BIDS Unexpected end of file has occurred","body":"<p>I have come accross the following error in BIDS whilst working on one of my report parts.</p>\n\n<p>At the time I was playing around with an image that I imported into the project around 6 times, Visual Studio threw up an error about performance or memory, I re-booted and now this is all I see everytime I bring up the report part.</p>\n\n<p>I Have opened up the report that was deployed to the server the last time it was working in report builder 3.0, re-saved it in my project folder and attempted to re-add it to the project but it still throws up the error.</p>\n\n<p>Any suggestions?</p>\n\n<p><img src=\"http://i.stack.imgur.com/ABNw7.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","sql-server-2008","foreign-keys"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13084217,"title":"Sql Server 2008 Create Foreign Key Manually","body":"<p>I have inherited an old database which wasn't designed very well. It is a Sql Server 2008 database which is missing quite a lot of Foreign Key relationships. Below shows two of the tables, and I am trying to manually create a FK relationship between <strong>dbo.app_status.status_id</strong> and <strong>dbo.app_additional_info.application_id</strong></p>\n\n<p><img src=\"http://i.stack.imgur.com/NNaF4.png\" alt=\"enter image description here\"></p>\n\n<p>I am using SQL Server Management Studio when trying to create the relationship using the query below</p>\n\n<pre><code>USE myDatabase; \nGO ALTER TABLE dbo.app_additional_info \nADD CONSTRAINT FK_AddInfo_AppStatus FOREIGN KEY (application_id) \n    REFERENCES dbo.app_status (status_id) \n    ON DELETE CASCADE\n    ON UPDATE CASCADE ; \nGO\n</code></pre>\n\n<p>However, I receive this error when I run the query</p>\n\n<blockquote>\n  <p>The ALTER TABLE statement conflicted with the FOREIGN KEY constraint\n  \"FK_AddInfo_AppStatus\". The conflict occurred in database\n  \"myDatabase\", table \"dbo.app_status\", column 'status_id'.</p>\n</blockquote>\n\n<p>I am wondering if the query is failing because each table already contains approximately 130,000 records?</p>\n\n<p>Please help.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":7,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":543,"score":1,"question_id":4934034,"title":"select specific records with specific ordering without using a common condition","body":"<p>My purpose the following:</p>\n\n<p>I have a list of \"StudentID\"... Let's say: 4, 2, 3, 5, 7 (stored in an array for example),\nand I want to make a select statement that returns StudentID and StudentName of the specified studentID in the list, <strong><em>with the same order of the list</em></strong>.</p>\n\n<p>So the result should be:</p>\n\n<pre><code>StudentID StudentName\n4         Philip\n2         Mary\n3         Tima\n5         Lara\n7         Michel\n</code></pre>\n\n<p>How can I achieve this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13084245,"title":"How to get last record from the latest inserted record","body":"<p>I have a table like this</p>\n\n<pre><code>Col1   Col2  Mindate                        MaxDate \nA       B    12-04-2012 00:12:00:087        31-04-2012 00:00:01:001\nC       D    01-01-2011                     30-01-2011 \nA       B    09-05-2012                     27-05-2012\nA       B    11-07-2012                     21-07-2012\n</code></pre>\n\n<p>I have only inserted datetime in first row but omitied in other rows for brevity, all date columns are datetime.</p>\n\n<p>Assume that I have inserted the last records for A and B (Col1 and Col2 are combined key).\nNow I want last record for A amd B based on the mindate which in above case should be </p>\n\n<pre><code>A       B    09-05-2012                     27-05-2012\n</code></pre>\n\n<p>I am trying the following query:</p>\n\n<pre><code>SELECT * FROM tbl WHERE Col1 ='A' AND Col2='B' AND ....\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13081022,"title":"How to get checkbox value from gridview when checkbox OnCheckedChanged","body":"<p>I want to update data when I checked in gridview. Before I shoude get value from checkbox but my code return data from database only. I want current value after I checked.</p>\n\n<p><strong>CodeBehind:-</strong></p>\n\n<pre><code>protected void chkSelected_CheckedChanged(object sender, EventArgs e)\n{\n    for (int rowIndex = 0; rowIndex &lt; GridView1.Rows.Count; rowIndex++)\n    {\n        if (Convert.ToString(GridView1.Rows[rowIndex].Cells[4].Text) != \"\")\n        {\n            Response.Write(\"true\");\n        }\n        else\n        {\n            Response.Write(\"fasle\");\n        }\n    }\n}\n</code></pre>\n\n<p><strong>Design Code:-</strong></p>\n\n<pre><code>&lt;asp:GridView ID=\"GridView1\" runat=\"server\" DataSourceID=\"SqlDataSource1\"\n              CellPadding=\"4\" GridLines=\"None\" ForeColor=\"#333333\" Font-Size=\"Smaller\" \n              AutoGenerateColumns=\"False\"&gt;\n    &lt;RowStyle BackColor=\"#EFF3FB\" /&gt;\n    &lt;Columns&gt;\n        &lt;asp:BoundField DataField=\"LevelID\" HeaderText=\"\" ReadOnly=\"True\" \n                        ItemStyle-Width=\"50\"  &gt;\n        &lt;/asp:BoundField&gt;\n        &lt;asp:BoundField DataField=\"LevelDesc\" HeaderText=\"\" ReadOnly=\"True\" \n                        ItemStyle-Width=\"250\"  &gt;\n        &lt;/asp:BoundField&gt;\n        &lt;asp:BoundField DataField=\"ChoiceID\" HeaderText=\"\" ReadOnly=\"True\" \n                        ItemStyle-Width=\"50\"  &gt;\n        &lt;/asp:BoundField&gt;\n        &lt;asp:BoundField DataField=\"ChoiceDesc\" HeaderText=\"\" ReadOnly=\"True\" \n                        ItemStyle-Width=\"400\"  &gt;\n        &lt;/asp:BoundField&gt;\n        &lt;asp:TemplateField HeaderText=\"\"&gt;          \n            &lt;ItemTemplate&gt;              \n                &lt;asp:CheckBox ID=\"chkSelected\" runat=\"server\" Checked='&lt;%# Eval(\"Selected\").ToString().Equals(\"True\") %&gt;'\n                     AutoPostBack=\"true\" OnCheckedChanged=\"chkSelected_CheckedChanged\" CssClass=\"chkBox\" /&gt;          \n            &lt;/ItemTemplate&gt;       \n        &lt;/asp:TemplateField&gt; \n    &lt;/Columns&gt;\n    &lt;FooterStyle BackColor=\"#507CD1\" ForeColor=\"White\" Font-Bold=\"True\" /&gt;\n    &lt;PagerStyle BackColor=\"#2461BF\" ForeColor=\"White\" HorizontalAlign=\"Center\" /&gt;\n    &lt;SelectedRowStyle BackColor=\"#D1DDF1\" Font-Bold=\"True\" ForeColor=\"#333333\" /&gt;\n    &lt;HeaderStyle BackColor=\"#0000CD\" Font-Bold=\"True\" ForeColor=\"White\" /&gt;\n    &lt;EditRowStyle BackColor=\"#2461BF\" /&gt;\n    &lt;AlternatingRowStyle BackColor=\"White\" /&gt;\n&lt;/asp:GridView&gt;\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":30,"score":1,"question_id":13083302,"title":"pivot table w/out function","body":"<p>I am trying to write a sql statement that creates a pivot table.</p>\n\n<p>The data is a list of survey responses and is made from a join query involving tables respondent, response and answer.  The answer table is structured as below:</p>\n\n<pre><code>______________________________________________________________\n|AnswerID|ResponseID|QuestionID|AnswerComment                |\n|      1 |        1 |        1 |This is answer 1             |\n|      2 |        1 |        2 |This is answer 2             |\n|      3 |        1 |        3 |This is answer 3             |\n|      4 |        2 |        1 |Answer 1 Respondent 2        |\n|      5 |        2 |        3 |Resp 2, No Q.2               |\n|      6 |        3 |        2 |I answered Q.2 only          |\n|____________________________________________________________|\n</code></pre>\n\n<p>Respondent looks like:</p>\n\n<pre><code>______________________________________________________________\n|RespondentID|GivenName|Surname|age, gender, blah blah       |\n|____________________________________________________________|\n</code></pre>\n\n<p>Response:</p>\n\n<pre><code>______________________________________________________________\n|ResponseID|ResponseDate|RespondentID|Attachment             |\n|____________________________________________________________|\n</code></pre>\n\n<p>and Question:</p>\n\n<pre><code>_____________________________________________________\n|QuestionID|QuestionNumber|QuestionText|            |\n|___________________________________________________|\n</code></pre>\n\n<p>I want my output in the form of:</p>\n\n<pre><code>________________________________________________________________________________________\n|RespondentInfo|ResponseDate|1                     |2                  |3               |\n|Respondent 1  |15/10/2012  |This is answer 1      |This is answer 2   |This is answer 3|\n|Respondent 2  |17/10/2012  |Answer 1 Respondent 2 |                   |Resp 2, No Q.2  |\n|Respondent 3  |19/10/2012  |                      |I answered Q.2 only|                |\n|______________________________________________________________________________________|\n</code></pre>\n\n<p>I want to get one line per respondent with each answer in the corresponding column.  The query I have created - although it pivots the answers to the correct columns - provides a new row for each answer with nulls in all the blank columns.</p>\n\n<p>My sql:</p>\n\n<pre><code>SELECT Respondent, ResponseDate, \n         [1], [2], [3]\nFROM  (\n       SELECT  Respondent.Surname + ', ' + FirstName as RespondentInfo, \n               Response.ResponseDate, \n               isnull(Answer.AnswerComment, '') as Answer, \n               Qustion.QuestionNumber\n       FROM    Answer INNER JOIN\n                Question ON Answer.QuestionID = Question.QuestionID INNER JOIN\n                   Response ON Answer.ResponseID = Response.ResponseID INNER JOIN\n                   Respondent ON Response.RespondentID = Respondent.RespondentID\n       ) as ResponseQuery\nPIVOT (\n    max(Answer)\nFOR ResponseQuery.QuestionNumber in ([1], [2], [3])\n       ) AS OutputTable\n</code></pre>\n\n<p>I think the issue is because I am not using an aggregate function so have defaulted to max().  Can anyone point me in the right direction.  </p>\n\n<p>Apologies if my question is too verbose.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":13083191,"title":"WHERE clause not working, uses ISNULL","body":"<p>Not sure where the problem is, but I've got a function that is returning the wrong total.  I've put the same criteria into a view and it again returns the wrong records.</p>\n\n<pre><code>    FieldsA&lt;&gt;'XYZ' \nAND CustAcc=345 \nAND Supplier&lt;&gt;'FG67FG' \nAND Category='XYZ' \nAND isnull(STATUS,'ZZZ')='READY' \nAND isnull(DESPATCHSTATUS,\"ZZZ\")='APPROVED'\n</code></pre>\n\n<p>It works for most of the records, but one I'm looking at, is coming back and the DESPATCHSTATUS is 'REJECTED'.</p>\n\n<p>Any ideas why this, particularly ISNULL might misbehave?</p>\n"},{"tags":["c#","sql-server-2008","bcp"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":327,"score":1,"question_id":8008757,"title":"SQL Server BCP utility best separator character to use","body":"<p>I am sure many would came across this scenario.</p>\n\n<p>Whenever we use SQL Server BCP utility to import/export data to-from delimited text files, which is the best <code>\"Separator Character\"</code> to use. We have Note-text kind of fields which can have , and now we found | &amp; ~ is also used by our users in those fields.\nWhich character in your opinion has least chances of user ever used. Or you have better alternative to deal with this issue.</p>\n\n<p>Update-\nThis software is being developed in UK-English users.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":99,"score":0,"question_id":13073740,"title":"Need help on following sql query","body":"<p>This is my current SQL query. I need to modify this</p>\n\n<pre><code>SELECT \n    18 BrokerDealerID,\n    5 PortfolioID,\n    PeriodEndDate DATE,\n    SecurityIdentifier_All.SecurityId,\n    MAX(\n    (CASE \n        WHEN Securities.Quantity &lt; 0 THEN\n        100 + (100 - LocalPriceAmount)\n        ELSE\n        LocalPriceAmount\n     END\n        ) /100) Mark\nFROM\n    Fireball_Reporting..StateStreet_DailyPosition_Second StateStreet \nINNER JOIN\n    Fireball_Reporting..SecurityIdentifier_All ON StateStreet.CUSIP = SecurityIdentifier_All.Identifier\nINNER JOIN\n    Fireball..TradeBySecurityType Securities ON\n        Securities.PricingSecurityID = SecurityIdentifier_All.SecurityId AND Securities.Position = 1 AND\n(CASE WHEN StateStreet.SecurityName LIKE '% R V %' THEN StateStreet.SharesParValue * -1 ELSE StateStreet.SharesParValue END) = Securities.Quantity\nWHERE\n    CONVERT(DATETIME, StateStreet.PeriodEndDate) = '2012-10-23' --@PositionDate\nGROUP BY\n    PeriodEndDate,\n    SecurityIdentifier_All.SecurityId\n</code></pre>\n\n<p>I need to do change in 2nd condition i.e </p>\n\n<pre><code>(CASE WHEN StateStreet.SecurityName LIKE '% R V %' THEN StateStreet.SharesParValue * -1 ELSE StateStreet.SharesParValue END) = Securities.Quantity\n</code></pre>\n\n<p>I will give you an example.</p>\n\n<p>my select query giving me following output</p>\n\n<pre><code>securityname date       securityid portfolioid type mark               quantity\n------------ ---------- ---------- ----------- ---- ------------------ -------------\nR V DISH     10/23/2012 4879505    5           CDS  1.0487189900000000 -5000000.0000\nR V DISH      10/23/2012 4879505    5           CDS  1.0487189900000000 -2000000.0000\nR F DISH    10/23/2012 4879505    5           CDS  0.9512810100000000 3000000.0000\n</code></pre>\n\n<p>Here above it is giving me 3 records for same security id \nWhen I do MERGE using above result it is only taking 1st record directly if i don't check that 2nd condition which checks for <code>Quantity</code> but now i want to check only for \nWhen In StateStreet.SecurityName LIKE '% R V %' take the records from above result whose quantity is <code>-</code> if not then take the record whose quantity id <code>+</code> </p>\n\n<p>How could I change that case statement? or directly check for <code>% R V%</code> in select statement where i calculated mark  ?\nNeed technical help.\nI'm new to SQL.</p>\n"},{"tags":["sql","sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":121,"score":0,"question_id":8779837,"title":"SSIS Data Flow Task Source as Tabbed Delimited File not reading last line throws partial data on last line error","body":"<p>Following is sample from my application</p>\n\n<p>Source- Tabbed Delimited file Col1 Col2 Col2 aa a 1 2 da a 1 2 ca a 1 2 ba a 1 2</p>\n\n<p>Destination- OLE DB Table</p>\n\n<p>create table test_data_1 (col1 varchar(100), col2 int, col3 varchar(100))</p>\n\n<p>Issue- all the rows are copied Except the last Row, when check debug file, there is a warning saying last line has Partial data hence ignored.</p>\n\n<p>Any suggestions on how to fix this issue in SSIS?</p>\n\n<p>Data is valid data.</p>\n"},{"tags":["sql-server-2008","table","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13081747,"title":"Find out the stored procedure using the table from all databases available","body":"<p>Please Help me on this issue. I have a specific table from a specific database. I want to find the stored procedure using the table from all databases available. </p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server-2008","filegroup"],"answer_count":3,"favorite_count":4,"up_vote_count":7,"down_vote_count":0,"view_count":16461,"score":7,"question_id":712449,"title":"How do i move a table to a particular FileGroup in MS Sql 2008","body":"<p>i've just created a secondary filegroup and wish to move some tables over to it and then make it read-only.</p>\n\n<p>I'm not sure how to do this?</p>\n\n<p>do i just use the <code>ALTER blah blah TO MyFileGroup</code> ?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":20,"score":-2,"question_id":13081232,"title":"Delete duplicate rows from table","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/841447/delete-duplicate-sql-records\">Delete Duplicate SQL Records</a>  </p>\n</blockquote>\n\n\n\n<p>I want to delete duplicate rows from a table</p>\n\n<pre><code>ID      uID     SID      USID\n------------------------------\n4391    007 Flight  ADM007\n4392    007 Enquiry ADM007\n6723    007 Flight  ADM007\n6724    007 Enquiry ADM007\n6725    008 Flight  ADM008\n6726    008 Enquiry ADM008\n4393    008 Flight  ADM008\n4394    008 Enquiry ADM008\n4395    009 Flight  ADM009\n4396    009 Enquiry ADM009\n6727    009 Flight  ADM009\n6728    009 Enquiry ADM009\n</code></pre>\n\n<p>I want to keep only </p>\n\n<pre><code>4391    007 Flight  ADM007\n4392    007 Enquiry ADM007\n6725    008 Flight  ADM008\n6726    008 Enquiry ADM008\n4395    009 Flight  ADM009\n4396    009 Enquiry ADM009\n</code></pre>\n\n<p>please give me suggestion</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13081347,"title":"Stored procedure to call a different stored procedure based on parameter","body":"<p>I would like to create a stored procedure in Sql Server that calls one of a number of different stored procedures and chooses which one based on the parameter supplied to it, but I can't seem to get the choosing syntax right.</p>\n\n<p>Currently attempting:</p>\n\n<pre><code>Begin\n  Set nocount on;\n  exec iif(param='individual', sp_FindIndividualRespondents, \n      iif(param='org', sp_FindOrgRespondents, sp_FindGroupRespondents))\nEnd\n</code></pre>\n\n<p>This is currently telling me: Incorect syntax near 'param'.</p>\n\n<p>I have looked here: <a href=\"http://stackoverflow.com/questions/4159528/conditional-where-clause-based-on-a-stored-procedure-parameter\">conditional where clause based on a stored procedure parameter?</a>, but I can't work out how to change that code to suit my situation.</p>\n\n<p>How do i provide a parameter to a stored procedure and then use it to choose and run a different stored procedure?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":5,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":90,"score":1,"question_id":13075465,"title":"Is there any alternative of 'like' operators in sql - for searching data","body":"<p>I need some help here, I am fetching data dependent upon the conditions</p>\n\n<p>Here I am using like operators, where client may use search with any word thus I have the below logic but here retrieval time is too high (it's taking 4mins) to get the data which is too slow.</p>\n\n<p>I did all indexing to table but still can't optimize the query.</p>\n\n<p>select * from authors \nwhere (address like '% Walmart %' OR address like 'Walmart %' OR address like '% Walmart' OR address like '% Walmart.com %' OR address like 'Walmart.com %' OR address like '% Walmart.com' OR address like '% Walmarts %' OR address like 'Walmarts %' OR address like '% Walmarts' OR address like '% Walmarts.com %' OR address like 'Walmarts.com %' OR address like '% Walmarts.com') </p>\n\n<p>-- Result is 1 Rows </p>\n\n<p>if i follow this logic</p>\n\n<p>select * from authors \n    where address like '%Walmart%'</p>\n\n<p>-- Result is 44 rows - it is fetching all rows</p>\n\n<p>But I need to get only that one row</p>\n"},{"tags":["mysql","sql","sql-server-2008","sql-server-triggers"],"answer_count":1,"favorite_count":2,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13080765,"title":"Insert Data from MSSQL to MySql using Trigger","body":"<p>I have two database. One is in MSSQL and other is in MySql. I want to insert data into MySQL table while an insertion occurs in the MSSQL table. Is it possible using trigger in MSSQL? Please give me an answer?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":13076890,"title":"Update table with random record in update statment in SQL Server?","body":"<p>I have two tables. <code>Table 1</code> has about 80 rows and <code>Table 2</code> has about 10 million. </p>\n\n<p>I would like to update all the rows in <code>Table 2</code> with a random row from <code>Table 1</code>. I don't want the same row for all the rows. Is it possible to update <code>Table 2</code> and have it randomly select a value for each row it is updating?</p>\n\n<p>This is what I have tried, but it puts the same value in each row.</p>\n\n<pre><code>update member_info_test\nset hostessid = (SELECT TOP 1 hostessId FROM hostess_test ORDER BY NEWID())\n</code></pre>\n\n<p>**Edited</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":2799,"score":3,"question_id":1500290,"title":"How to Script Automatically, the securables assigned to a SQL account","body":"<p>I want to generate script to assign an user account to some securables, e.g. Table:Select.</p>\n\n<p>How to do this?</p>\n"},{"tags":["c#",".net","sql-server-2008",".net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13079439,"title":"location picker for .net 4","body":"<p>I'm developing an app to control onsite projects. I need to let the user specify the project's location from its country down to its address, and latitude/longitude coordinates. </p>\n\n<p>The problem is, location information isn't uniformly described across countries, i.e., countries have different names in their location hierarchy. So if one project is located in the USA, it will have a hierarchy of: </p>\n\n<pre><code>Country / State / City\n</code></pre>\n\n<p>Chile, on the other hand, has a hierarchy of:</p>\n\n<pre><code>Country / Region / County / City / district / neighborhood\n</code></pre>\n\n<p>How should I model this? </p>\n\n<p>Is there a premade <code>.net</code> module I can stick into my project that would work? Should I just simplify the hierarchy into four distinct levels, and let the user deal with the complexity of different hierarchies across countries?</p>\n\n<p>The best solution for me would be to use a premade assembly that I could stick into my code with little effort, but I'm not afraid to code an implementation on my own. </p>\n\n<p>The problem is that every solution I manage to cook seems too complicated to be practical, so any advice is more than welcome.</p>\n"},{"tags":["sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":86,"score":0,"question_id":13072990,"title":"Date Format In SSIS Derived Column","body":"<p>I have 2 questions, I have a text file with all my data, in the text file I have for example <code>Sply_DT</code> and <code>Imprt_DT</code>.</p>\n\n<p>For <code>Sply_Dt</code> I have to create <code>getdate()</code> and I have it formatted as <code>2012-10-25 12:04:16.09900000</code> using <code>(DT_DBTIMESTAMP)(DT_DBDATE)GETDATE()</code> but I want it formatted as <code>MM-DD-YY</code>.</p>\n\n<p>And for <code>Impt_DT</code>, it's in the <code>5/16/2011</code> format in dataviewer but when I placed it into a table it looks like <code>2011-05-16 00:00:00.000</code> and I want it in <code>MM-DD-YY</code> format.</p>\n"},{"tags":["sql-server-2008","optimization","integer","full-text-indexing"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12979996,"title":"How does SQL Server full-text Index actually index the words in a catalog?","body":"<p>I have been searching long and hard for an answer regarding the processes full-text index uses to index the full text catalogs assigned to a document, where the document primary key is included in the indexing. I have not been able to find the MSDN article that describes this in depth.</p>\n\n<p>Why can't I use it for searching int-only strings in the full text search columns?</p>\n\n<p>SEE HERE: (WELL, I'm a new user so I remade the columns myself since I can't post an image)</p>\n\n<pre><code> ID       FIRSTNAME   LASTNAME    ADDRESS            FULLTEXTCOLUMN\n 1         JOHN        DOE        123 Main St.       1  JOHN DOE 123 Main St. \n 2         JANE        DOE        124 Summer St.     2  JANE DOE 124 Summer St.\n                                                     ^ ----------^ --can't search \n</code></pre>\n\n<p>For example, in <a href=\"http://www.codeproject.com/Articles/315101/SQL-Full-Text-Search-Programming\" rel=\"nofollow\">this link</a>, the author of the post shows that he has included the primary key int-only indexes in his full text-indexed column --- but why? After trying a <code>CONTAINS()</code> search on the int values for myself, the search can't find anything without text attached.</p>\n\n<p>So why do so many people show integer-only strings in their catalog if they aren't searchable? I have a huge need for integer-search options in my catalog, and hope I'm just missing something.</p>\n\n<p>Does this mean that the indexes are only assigned to strings that contain at least one letter?</p>\n\n<p>This question <a href=\"http://stackoverflow.com/questions/7394420/best-approach-for-doing-full-text-search-with-list-of-integers-documents\">here</a> describes a catalog format very close to what I'm trying to cheat the system to do in SQL Server (because this is my only database option).</p>\n\n<p>Thanks for your help!</p>\n\n<p>And yes, this is my closed question <a href=\"http://stackoverflow.com/questions/12963490/why-is-there-no-delimited-integer-only-cataloging-option-in-sql-server\">here</a> but I don't care because it is a \"real\" question and important one. I have a team of people behind me wondering this.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","geometry","geospatial"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13077666,"title":"STContains() on Two table to find where my Region lies in Country","body":"<p>I have Two table. 1st Table with column \"Point\" and 2nd Table with column \"NZTM\". Now I want to check where my Point lies in NZTM. Both the columns are converted into geometry. I got 15 million points and 2000 NZTM rows. 1 Point can belong to 0 or 1 or more NZTM.</p>\n\n<p>So for this operation I am using STContains. But this seem to be giving an issue as I am using cross join it joins all the columns in 1st table to all the columns of 2nd table and takes ages to complete this operation. I am using the following query</p>\n\n<pre><code>         Select case when A.points.STContains(B.NZTM) &gt;0\n            then \n                A.MeshBlockIdentifier\n            end val,\n            B.SeqID sid     \n        from dbo.EventConversion B\n        cross join\n        [dbo].[REGC12] A\n</code></pre>\n\n<p>Any one please help me on how do I check or use ST_Contains on my two columns?\nP.S I am using SQL Server 2008 R2</p>\n"},{"tags":["sql-server-2008","full-text-search","indexes"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12943728,"title":"Is Full Text Search just as effecient when indexing integers separated by spaces in the same column?","body":"<p>I.E. Does full text search work just as well/better searching through <em>only</em> integers separated by spaces and indexed using the \"full text index\"?</p>\n\n<p>Thanks!</p>\n"},{"tags":["visual-studio-2010","sql-server-2008","crystal-reports","iis6"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13077615,"title":"Correct configuration for IIS 6.0 Application Pool on a windows 2003 server to access Crystal Reports","body":"<p>I have crystal reports correctly working on my local development machine IIS5.1 and Crystal Reports from VS2010 also works fine.</p>\n\n<p>I have a SQL database and everything is configured and running correctly in my local machine. The ODBC is correctly configured on my local machine and my server.</p>\n\n<p>However, I am getting a connection failed issue on the windows 2003 server for crystal reports. The Application Pool in IIS is configured to run under Network Service. </p>\n\n<p>Is this the correct recommendation? Any other suggestions?</p>\n"},{"tags":["sql-server-2008","table","search","delimiter"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12963072,"title":"Full \"Text\"-type search alternative/solution for catalog of delimited integers?","body":"<p>I am in need of an alternative to the Full Text Catalog/Index for text/character strings, as I am working with integer values. Is there something out there that is faster than using \"like\" to search through some sort of delimited integer catalog? (Each delimited integer should be indexed throughout the entire catalog, not just that values of each cell as a single unit?)</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server","sql-server-2008","security","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":13074704,"title":"SQL Server Activity Monitor Ports","body":"<p>I'm trying to convince my IT department to grant me necessary <a href=\"http://msdn.microsoft.com/en-us/library/ms175518.aspx#Security\" rel=\"nofollow\">permissions</a> on our SQL Server 2012 instance in order to use the Activity Monitor in the Management Studio.  Our lead IT administrator is concerned about granting them because he is unsure what, if any, ports Activity Monitor listens on.  I'd like to add that I currently have access to this SQL Server instance on port 1433.</p>\n\n<p>I'm not very familiar with Activity Monitor's inner workings, are there any specific ports Activity Monitor listens on that should be a security concern?  Does anyone know any resources that may provide this information?  I want to make sure I give an accurate response.</p>\n"},{"tags":["c#","sql-server-2008","nhibernate","asp.net-web-api","autofac"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":78,"score":1,"question_id":13003455,"title":"Why isn't my NHibernate update working?","body":"<p>I'm currently using the ASP.NET Web Api along with NHibernate &amp; Autofac...I'm having an issue where my update is not being committed to the database.  I'm using an ActionFilterAttribute to open and close a transcation every time an action is performed like so:</p>\n\n<pre><code>private ISessionFactory SessionFactory { get; set; }\n\npublic TransactionAttribute()\n{\n    SessionFactory = WebApiApplication.SessionFactory;\n}\n\npublic override void OnActionExecuting(System.Web.Http.Controllers.HttpActionContext actionContext)\n{\n    var session = SessionFactory.OpenSession();\n    CurrentSessionContext.Bind(session);\n    session.BeginTransaction();\n}\n\npublic override void OnActionExecuted(HttpActionExecutedContext actionExecutedContext)\n{\n    var session = SessionFactory.GetCurrentSession();\n    var transcation = session.Transaction;\n    if (transcation != null &amp;&amp; transcation.IsActive)\n    {\n        transcation.Commit();\n    }\n    session = CurrentSessionContext.Unbind(SessionFactory);\n    session.Close();\n}\n</code></pre>\n\n<p>Which works fine for the add, read, and delete functions in my repository.  Unfortunately, my update doesn't seem to be working (though I've tried it several ways):</p>\n\n<pre><code>public bool Update(Client client)\n{\n    var result = Get(client.ClientID);\n\n    if (result == null)\n    {\n        return false;\n    }\n\n    result.Name = client.Name;\n    result.Acronym = client.Acronym;\n    result.Website = client.Website;\n\n    return true;\n}\n</code></pre>\n\n<p>From what I've read if modifying an object during a transaction, there's no need to manually call Update or SaveOrUpdate, as this is tracked by NHibernate &amp; performed when the transaction is committed.</p>\n\n<p>Why would my update function not be working properly?</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2008","tsql","sa"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":94,"score":1,"question_id":8758976,"title":"Is there a T-SQL function to return the name of the 'sa' account?","body":"<p>(I know the question sounds ridiculous, but bear with me ...)</p>\n\n<p>Our DBA changes the 'sa' account name to something else for their own security purposes.  There are business needs to use the account name in script (e.g. sp_add_job), but this will break in this situation.  I'd like to be able to submit a script that doesn't need to be edited to use the new 'sa' username before running.</p>\n\n<p>Is there a function/property similar to @@SERVERNAME that will return the name of this account?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":13075066,"title":"SQL Query results pagination with random Order by in SQL Server 2008","body":"<p>I am trying to implement pagination to a page on my website that returns results from a database table.</p>\n\n<p>Currently, it returns all rows in a random order. However, as my database is growing, I want to paginate these results instead of displaying them all on one page. However, I don't want to return all results just to display 20 records for instance. Depending on the page, I want take just the 20 records from the database that are relevant.</p>\n\n<p>I'm following this tutorial: <a href=\"http://www.mikesdotnetting.com/Article/150/Web-Pages-Efficient-Paging-Without-The-WebGrid\" rel=\"nofollow\" title=\"Tutorial\">Tutorial</a></p>\n\n<p>However, the I cannot use the query with the <code>OFFSET</code> clause, because the hosting uses SQL SERVER 2008. (It is introduced in 2012 i believe).</p>\n\n<p>I tried following the answer to this <a href=\"http://stackoverflow.com/questions/187998/row-offset-in-sql-server\" title=\"Question\">Question</a>, but I want the results in a random order, and I cannot do an <code>ORDER BY</code> on a derived table... so I'm a bit stuck for ideas!</p>\n\n<p>Any help? Thanks!</p>\n\n<p>This is what I currently have:</p>\n\n<pre><code>    SELECT Title, Filename, PhotoURL, Orientation, FolderName, SetURL, RowNum\n      FROM (\n            SELECT  p.Title, p.Filename, p.URL AS PhotoURL, p.Orientation, s.FolderName, s.URL AS SetURL, ROW_NUMBER() OVER (ORDER BY p.PhotoID) AS RowNum\n          FROM  Photos p\n                LEFT OUTER JOIN SetPhotos sp\n                    ON sp.PhotoID = p.PhotoID\n                LEFT OUTER JOIN [Sets] s\n                    ON s.SetID = sp.SetID\n         WHERE  p.Hide = 0\n      ORDER BY  NEWID()\n        ) AS PaginatedPhotos\n WHERE  PaginatedPhotos.RowNum BETWEEN 0 AND 10\n</code></pre>\n"},{"tags":["sql-server-2008","ssis","ssis-data-transformations"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":1121,"score":0,"question_id":3649724,"title":"Learning SSIS 2008","body":"<p>I would like to learn SSIS 2008. can any one guide me to get ebbok to learn SSIS 2008?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":46,"score":0,"question_id":13075079,"title":"Finding a line break in a text string in a SQL table?","body":"<p>I was trying to find line breaks and carriage returns in a column in a SQL table and I am not sure about the syntax.</p>\n\n<p>I tried:</p>\n\n<pre><code>SELECT foo FROM test\nWHERE foo LIKE CHAR(10)\n</code></pre>\n\n<p>I didn't get any results even though I know that the table should return results.  What am I doing wrong?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":52,"score":2,"question_id":13070519,"title":"Should I avoid using sp_getAppLock?","body":"<p>I have a stored procedure, and I want to ensure it cannot be executed concurrently.</p>\n\n<p>My (multi-threaded) application does all necessary work on the underlying table via this stored procedure.</p>\n\n<p>imo, locking the table itself is an unnecessarily drastic action to take, and so when I found out about <code>sp_GetAppLock</code>, which essentially enforces a critical section, this sounded ideal.</p>\n\n<p>My plan was to encase the stored procedure in a transaction and to set up <code>spGetAppLock</code> with transaction scope. The code was written and tested successfully.</p>\n\n<p>The code has now been put forward for review and I have been told that I should not call this function. However when asking the obvious question \"why not?\", the only reasons I am getting are highly subjective, to do with any form of locking being complicated.</p>\n\n<p>I don't necessarily buy this, but I was wondering whether anyone had any <em>objective</em> reasons why I should avoid this constuct. Like I say, given my circumstances a critical section sounds an ideal approach to me.</p>\n\n<p>TIA,\nPete</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":44,"score":0,"question_id":13073459,"title":"get random data from table in sql server?","body":"<pre><code>SELECT TOP 10 * \nFROM Questions TABLESAMPLE (100 ROWS) \norder by NEWID()\n</code></pre>\n\n<p>It returns the same 10 records every time but they are in a different sequence.  How can I get a different set of 10 random values each time?</p>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":552,"score":2,"question_id":5966823,"title":"SSRS Error: No Such Interface Supported","body":"<p>I have a user that cannot export a report from a Sql Server Reporting Services (SSRS) report in any format.  This user is running Windows 7 x86 SP1 with IE8.</p>\n\n<p>The user will bring up any report and it is displayed properly.  Then they will click on the Export button on the report toolbar (to export it to Excel or PDF) and this error is displayed:</p>\n\n<p><strong>No such interface supported</strong> - Reserved.ReportViewerWebControl.axd  URI:http//reportserver...</p>\n\n<p>Other people at this same location and simliar computer configuration have no issues.  The problem user has Office 2007 installed and it opens Excel files without issues.  Again, this user has this problem with ALL reports and no other user has this issue on any report.  Therefore, it is clearly a problem with something on his computer, but I really don't know where to start.</p>\n\n<p>In desperation, I had him click on the \"Print\" button on the Report toolbar, as I know that triggers the download of some MS-required component.  He was able to print from there, but the above error remains.</p>\n\n<p>I would greatly appreciate any suggestions or feedback.  Thank you!</p>\n"},{"tags":["sql","sql-server-2008","bitwise"],"answer_count":8,"favorite_count":1,"up_vote_count":5,"down_vote_count":0,"view_count":1857,"score":5,"question_id":158519,"title":"How to handle a lot of flags for a SQL record","body":"<p>I need advice on how to handle relatively large set of flags in my SQL2k8 table.</p>\n\n<p>Two question, bear with me please :)</p>\n\n<p>Let's say I have 20 flags I'd like to store for one record.</p>\n\n<p>For example:</p>\n\n<p>CanRead = 0x1\nCanWrite = 0x2\nCanModify = 0x4\n...\nand so on to the final flag 2^20</p>\n\n<p>Now, if i set the following combination of one record: Permissions = CanRead | CanWrite</p>\n\n<p>I can easily check whether that record has required permission by doing WHERE (Permissions &amp; CanRead) = CanRead</p>\n\n<p>That works.</p>\n\n<p>But, I would also like to retrieve all records that can either write OR modify.</p>\n\n<p>If I issue WHERE (Permissions &amp; ( CanWrite | CanModify )) = (CanWrite | CanModify) i obviously won't get my record that has permissions set to CanRead | CanWrite</p>\n\n<p>In other words, how can I find records that match ANY of the flags in my mask that i'm sending to the procedure?</p>\n\n<p>Second question, how performant is in in SQL 2008? Would it actually be better to create 20 bit fields?</p>\n\n<p>Thanks for your help</p>\n"},{"tags":["sql","sql-server","database","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":107,"score":1,"question_id":13072992,"title":"Avoid \"SELECT TOP 1\" and \"ORDER BY\" in Queries","body":"<p>I have the very table in sql server 2008 with lot of data</p>\n\n<pre><code>|ID|Name|Column_1|Column_2|\n|..|....|........|........|\n</code></pre>\n\n<p>more than 18,000 records. So i need to the the row with the lowest value of <code>Column_1</code> that is date but could by any data type (that is unsorted) so I use these sentence</p>\n\n<pre><code>SELECT TOP 1 ID, Name from table ORDER BY Column_1 ASC\n</code></pre>\n\n<p>But this is very very slow. And i think that i don't need to to sort the whole table. My question es how to get the same date with out using <code>TOP 1</code> and <code>ORDER BY</code></p>\n"},{"tags":["sql-server-2008","encryption"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13057332,"title":"Linked server requires no encryption","body":"<p>I'm trying to replicate a Linked Server from a Windows 2k3 / SQL Server 2000 to a Windows 2008 / SQL 2008 R2 setup.  </p>\n\n<p>The SQL 2000 Linked server is setup like this:</p>\n\n<pre><code>srvname=blah.blah.com\nsrvproduct=SQL Server\nprovidername=SQLOLEDB\ndatasource=blah.blah.com\nsrvnetname=blah.blah.com\nrpc=1\nrpcout=1\ndataaccess=1\n</code></pre>\n\n<p>The SQL 2008 R2 Linked Server is setup the same way.\nI've copied the remote users, and all seems fine, except when i tried to connect, I get this error:</p>\n\n<pre><code> OLE DB provider \"SQLNCLI10\" for linked server \"blah.blah.com\" returned message \"Client unable to establish connection\". (Microsoft SQL Server, Error: 20)\n Encryption not supported on SQL Server\n</code></pre>\n\n<p>I still have access to the SQL 2000 machine, and can run the query fine.  I'm guessing the issue is that Windows2008 machine is trying to send data encrypted, but the linked server is saying it can't handle encryption.  Something along those lines.  I've played with various different Data Source types, and nothing seems to pan out.  I don't have access to the remote server so I don't know what OS/Database is on it.</p>\n\n<p>Anyone with more SQL knowledge than me can point me in the right direction?\nThanks!</p>\n"},{"tags":["sql-server-2008","tsql","ssis","ssms","osql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":13072607,"title":"Generating a .csv file by running a .sql script with osql.exe","body":"<p>I have a script file in a folder.I want to use TSQL to run this script without opening it in SSMS as I will be using SSIS to run this script to generate CSV.</p>\n\n<p>I have used OSQL to achieve this by using Execute Process Task but it is not giving me exact results I am looking for. It is generating spaces in the csv. A 17 mb file which I exported by rightclick as CSV option turned out to 1gb when I executed using OSQL code.The OSQL I used is:</p>\n\n<p><code>-E -S CCCMSDSQL20,1819 -d SHARE_SCRUB  -q  \"SET NOCOUNT ON\" -i \"C:\\Scripts\\.SQL\" -o \"C:\\Scripts\\.csv\" -n -h-1 -s\",\" -w 700</code></p>\n\n<p>I prefer a TSQL script which can achieve the same,so that I can use it in Execute SQL task and get the results.</p>\n\n<p>EDIT:\nI am working to generate multiple csv's from multiple .sql files in a folder .I am using a for each loop container and execute process task as of now.I want to change the execute process task to execute sql task and use this script to generate multiple files.</p>\n\n<p>If it is possible to write a TSQL code which can do the looping and generation of CSV files in one script I can use it without using the package.</p>\n\n<p>Thanks for your time and help.</p>\n"},{"tags":["sql-server-2008","duplicates","rows","reportbuilder3.0"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":12,"score":1,"question_id":13073826,"title":"How to merge rows in SQL Report Builder when some rows have columns with no values?","body":"<p>I have been given a rather complex report and asked to update it so that a user can enter values for several parameters (some of which then present selections in multi-value paramenters), in order to generate a list of all computer names with one or more specific software packages installed on them. </p>\n\n<p>A \"simplified\" version of the main query (shown below) works, but unfortunately the report sometimes lists nearly duplicate rows for the same software package on the same computer; one with an installation date and the other without an installation. There are also records that have no installation date, but do not have a corresponding record with an installation date. </p>\n\n<p>I am able to eliminate rows without installation dates by adding \"AND arp.InstallationDate0 IS NOT NULL\" to the WHERE clause, but how can I change the query so that if duplicate records exist, only the one with the installation date is displayed, yet if only one record with no installation exists, that record is shown?  </p>\n\n<p>Thanks for any help you can offer.</p>\n\n<pre><code>SELECT DISTINCT sys.Name0 , arp.DisplayName0 , arp.Version0 , arp.InstallDate0 \n\nFROM v_R_System sys \n\nINNER JOIN (SELECT * FROM v_GS_ADD_REMOVE_PROGRAMS UNION SELECT * \n  FROM v_GS_ADD_REMOVE_PROGRAMS_64) arp ON sys.ResourceID = arp.ResourceID \n\nINNER JOIN v_FullCollectionMembership fcm ON sys.ResourceID = fcm.ResourceID \n\nWHERE arp.DisplayName0 IN (@productname) AND COALESCE (arp.Version0, '') LIKE @version  \n  AND fcm.CollectionID IN (@selectcollection) \n\nORDER BY sys.Name0\n</code></pre>\n"},{"tags":["sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":17,"score":-1,"question_id":13073651,"title":"Sql server Query to get the Table Altered Result","body":"<p>I have a table as below  </p>\n\n<pre><code>ClientID        AccountNumber   BalanceOnDay0       BalanceOnDay1   BalanceOnDay2       BalanceOnDay3       BalanceOnDay4       BalanceOnDay5       BalanceOnDay6       BalanceOnDay7\nABC1            123             10                  NULL            NULL                NULL                NULL                NULL                NULL                NULL    \nABC1            123             NULL                NULL            NULL                NULL                NULL                NULL                NULL                3       \n</code></pre>\n\n<p>I would like to see the result as beblow.  </p>\n\n<pre><code>ClientID        AccountNumber   BalanceOnDay0       BalanceOnDay1   BalanceOnDay2       BalanceOnDay3       BalanceOnDay4       BalanceOnDay5       BalanceOnDay6       BalanceOnDay7\nABC1            123             10                  NULL            NULL                NULL                NULL                NULL                NULL                3\n</code></pre>\n\n<p>Please suggest!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","pivot"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":75,"score":3,"question_id":13072744,"title":"SQL Server PIVOT with multiple X-axis columns","body":"<p>Take the following example data:</p>\n\n<pre><code>Payroll Forname Surname Month   Year    Amount\n0000001 James   Bond    3       2011    144.00\n0000001 James   Bond    6       2012    672.00\n0000001 James   Bond    7       2012    240.00\n0000001 James   Bond    8       2012    1744.50\n0000002 Elvis   Presley 3       2011    1491.00\n0000002 Elvis   Presley 6       2012    189.00\n0000002 Elvis   Presley 7       2012    1816.50\n0000002 Elvis   Presley 8       2012    1383.00\n</code></pre>\n\n<p>How would i PIVOT this on the Year + Month (eg: 201210) but preserve Payroll, Forename &amp; Surname as seperate columns, for example, the above would become:</p>\n\n<pre><code>Payroll Forename    Surname 201103  201206  201207  201208\n0000001 James       Bond    144.00  672.00  240.00  1744.50\n0000002 Elvis       Presley 1491.00 189.00  1816.50 1383.00\n</code></pre>\n\n<p>I'm assuming that because the Year + Month names can change then i will need to employ dynamic SQL + PIVOT - i had a go but couldnt even get the code to parse, nevermind run - any help would be most appreciated!</p>\n\n<p>Edit: What i have so far:</p>\n\n<pre><code>    INSERT  INTO #tbl_RawDateBuffer\n            ( PayrollNumber ,\n              Surname ,\n              Forename ,\n              [Month] ,\n              [Year] ,\n              AmountPayable\n            )\n            SELECT  PayrollNumber ,\n                    Surname ,\n                    Forename ,\n                    [Month] ,\n                    [Year] ,\n                    AmountPayable\n            FROM    RawData\n            WHERE   [Max] &gt; 1500\n\n\nDECLARE @Columns AS NVARCHAR(MAX)\nDECLARE @StrSQL AS NVARCHAR(MAX) \n\nSET @Columns = STUFF((SELECT DISTINCT\n                                ',' + QUOTENAME(CONVERT(VARCHAR(4), c.[Year]) + RIGHT('00' + CONVERT(VARCHAR(2), c.[Month]), 2))\n                      FROM      #tbl_RawDateBuffer c\n    FOR              XML PATH('') ,\n                         TYPE \n            ).value('.', 'NVARCHAR(MAX)'), 1, 1, '') \n\nSET @StrSQL = 'SELECT PayrollNumber, ' + @Columns + ' from \n            (\n                select PayrollNumber\n                    , CONVERT(VARCHAR(4), [Year]) + RIGHT(''00'' + CONVERT(VARCHAR(2), [Month]), 2) dt\n                from #tbl_RawDateBuffer\n           ) x\n            pivot \n            (\n                sum(AmountPayable)\n                for dt in (' + @Columns + ')\n            ) p '\n\n\nEXECUTE(@StrSQL)\n\nDROP TABLE #tbl_RawDateBuffer\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":3,"view_count":33,"score":-1,"question_id":13073449,"title":"SQL statement to return attendance data within a given date range","body":"<p>I wanna create a SQL statement that returns the attendance data for employees related to a pre-defined work shift. I have a 2 pre-defined work shifts the first one start at 08:00 AM and ends at 04:00 PM on the same day the other work shift start at 06:30 PM on a day and ends at 08:00 AM on the next day. Here's the structure of the tables from which the attendance data will be returned</p>\n\n<ul>\n<li>HR_Employee_Personal_Info: <code>[Employee ID], [Employee Name]</code></li>\n<li>HR_Employee_Job_Info: <code>[Employee ID], [Job Title], [Shift ID]</code></li>\n<li>HR_Attend_And_Leave_Of_Staff: <code>[Employee ID], [Verify Mode], [In/Out Mode],[Date],[Time]</code>    </li>\n</ul>\n\n<p>The verify mode has only value 1 for fingerprint and value 15 for face, the In/Out Mode only value 0 means attend state or 1 means leave state</p>\n\n<p>I will show with a sample data what exactly what I want</p>\n\n<p>Lets say that I have such data in tables</p>\n\n<ul>\n<li><code>HR_Employee_Personal_Info:</code></li>\n<li><code>[Employee ID]: 1, 2, 3 and 4</code></li>\n<li><p><code>[Employee Name]: Amr Mohammed, Ahmed Nabil, Ahmed Mohammed, Raafat Jodh</code></p></li>\n<li><p><code>HR_Employee_Job_Info</code></p></li>\n<li><code>[Employee ID]: 1, 2, 3 and 4</code></li>\n<li><code>[Job Title]: IT Admin, SW Developer, Accountant, Project Manager</code></li>\n<li><p><code>[Shift ID] 1, 1, 1 and 1</code>(1 for each of the 4 record)</p></li>\n<li><p>`HR_Attend_And_Leave_Of_Staff: [Employee ID], [Verify Mode], [In/Out Mode], [Date],[Time]</p></li>\n<li>`The first record will be: 1, 1, 0, 2012-09-18, 07:00</li>\n<li>The second record will be: 1, 1, 1, 2012-09-18, 16:00</li>\n<li>The third record will be: 2, 1, 0, 2012-09-18, 07:00</li>\n<li>The forth record will be: 3, 1, 1, 2012-09-18, 16:00</li>\n</ul>\n\n<p>NOTE: The 4 employees works in the same work shift, shift 1.</p>\n\n<p>You can see in the above sample data employee number 4 have no records in the table of the attendance. So I want the SQL statements returns me the data in such way</p>\n\n<pre><code>[Employee ID], [Employee Name], [Job tite], [A_Date], [A_time], [L_Date], [L_Time]\n</code></pre>\n\n<p>The first record  returned will be</p>\n\n<pre><code>1, Amr Mohammed, IT Admin, 2012-09-18, 07:00 AM, 2012-09-18, 04:00 PM\n</code></pre>\n\n<p>The second record returned will be</p>\n\n<pre><code>2, Ahmed Nabil, SW Developer, 2012-09-18, 07:00 AM, 2012-09-18, NULL \"He has no leave record \n</code></pre>\n\n<p>that date note the records within the attendance table above\"</p>\n\n<p>The third record returned will be </p>\n\n<pre><code>3, Ahmed Mohmmed, Accountant, 2012-09-18, NULL, 2012-09-18, 04:00 PM \"He has no attend record that date note the records within the attendance table above\"\n</code></pre>\n\n<p>The forth record returned will be</p>\n\n<pre><code>4, Raafat Jodh, Project Manager, 2012-09-18, NULL, 2012-09-18, NULL \"He has no records at all within the attendance table however he is working at the shift 1\".\n</code></pre>\n\n<p>So every one who is working in shift 1 his code, name, job title will be returned in by the desired SQL statements with NULL values at [A_time], [L_time] if has no record in the HR_Attend_And_Leave_Of_Staff</p>\n\n<p>I want to give a range of dates to retrieve all attendance data within that range. The above data only with date 2012-09-18 but if I selected the range starts at 2012-09-18 and ends at 2012-09-20 the data becomes with the dates 2012-09-18, 2012-09-19 and 2012-09-20 respectively.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13071566,"title":"Derived Tables vs. Correlated subquery in HAVING clause SQL Server 2008","body":"<p>In this example I've only got two tables with which I'm working.  I was checking to see which might run faster and the execution plans were identical.  The purpose of these queries is to find the minimum date associated with one record that's larger than the maximum date of another.  The first query is more concise (although it doesn't allow the <code>DATEDIFF</code> column the second one does).  I feel like writing a query the second way will, in the long run, be more costly performance wise, perhaps when I have many joins.  Are there any general rules about which method, or is it a case by case scenario and you let the optimizer work it out?  </p>\n\n<p>first</p>\n\n<pre><code>select c.patid,min(c.admitDate) as minDiabetesDate\n    from clm_extract as c\n    inner join icdClm as ic on ic.clmid=c.clmid\n    where ic.icd like '250%' \n    group by c.patid\n    having min(c.admitdate) &gt; \n    (\n        select MAX(c2.admitDate) as maxPreDiabetesDate\n            from clm_extract as c2\n            inner join icdClm as ic2 on ic2.clmid = c2.clmid\n            where ic2.icd ='79029' and c2.patid=c.patid\n            group by c2.patid\n    )\n</code></pre>\n\n<p>second </p>\n\n<pre><code>select distinct x.patid,x.minDiabetesDate,y.maxPreDiabetesDate \nfrom\n(   \n\nselect c.patid, min(c.admitdate) as minDiabetesDate\n    from clm_extract as c \n    inner join icdClm as ic on ic.clmid=c.clmid\n    where ic.icd like '250%'\n    group by c.patid\n)x\ninner join \n(\nselect c2.patid, MAX(c2.admitdate) as maxPreDiabetesDate\n    from clm_extract as c2\n    inner join icdClm as ic2 on ic2.clmid=c2.clmid\n    where ic2.icd ='79029'\n    group by c2.patid\n)y on x.patid=y.patid\ngroup by x.minDiabetesDate,y.maxPreDiabetesDate,x.patid\nhaving DATEDIFF(dd,y.MaxPreDiabetesDate,x.minDiabetesDate) &gt; 0\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","full-text-search"],"answer_count":2,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":245,"score":3,"question_id":8011044,"title":"Contains() function falters with strings of numbers?","body":"<p>For some background information, I'm creating an application that searches against a couple of indexed tables to retrieve some records. It isn't overtly complex to the point of say Google, but it's good enough for the purpose it serves, barring this strange issue. </p>\n\n<p>I'm using the <code>Contains()</code> function, and it's going very well, except when the search contains strings of numbers. Now, I'm only passing in a string -- nowhere numerical datatypes being passed in -- only characters. We're searching against a collection of emails, each appended with a custom ID when shot off from a workflow. So while testing, we decided to search via number strings. </p>\n\n<p>In our test, we isolated a number <code>0042600006</code>, which belongs to one and only one email subject. However, when using our query we are getting results for <code>0042600001</code>, <code>0042600002</code>, etc. The query is this as follows (with some generic columns standing in):</p>\n\n<p><code>SELECT description, subject FROM tableA WHERE CONTAINS((subject), '0042600006')</code></p>\n\n<p>We've tried every possible combination: <code>'0042600006*'</code>, <code>'\"0042600006\"'</code> and <code>'\"0042600006*\"'</code>. </p>\n\n<p>I think it's just a limitation of the function, but I thought this would probably be the best place for answers. Thanks in advance. </p>\n"},{"tags":["sql","sql-server","database","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":32,"score":3,"question_id":13070992,"title":"inserting into A errors because of a foreign key contraint issue","body":"<p>Can someone help explain this to me and resolve it?</p>\n\n<p><a href=\"http://sqlfiddle.com/#!6/2adc7/9\" rel=\"nofollow\">http://sqlfiddle.com/#!6/2adc7/9</a></p>\n\n<p><strong>The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_tblMobileForms_tblForms\". The conflict occurred in database \"db_6_2adc7\", table \"dbo.tblForms\", column 'fm_id'.: insert into tblMobileForms(fm_name) values ('lol')</strong></p>\n\n<p>My schema has the ID from tblMobileForms be a foreign key to tblForms.fm_id</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":5830,"score":0,"question_id":4659019,"title":"Out of Memory exception in SQL 2008","body":"<p>am getting an exception Out of Memory exception in SQL 2008 when i try to execute large amount of file in sqlserver2008.. its very urgent, is there any solution pls help me..</p>\n\n<p>I am trying to execute a large query in SQL server 2008 which inserts thousands of rows into a table.</p>\n\n<p>The exception which comes when executing this is \"System.OutOfMemoryException\".</p>\n"},{"tags":["sql-server-2008","auto-increment"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":4,"view_count":163,"score":-3,"question_id":9381240,"title":"Identity Increment","body":"<p><strong>I am combining 2 tables into 1, by using the following statements</strong> </p>\n\n<pre><code>Select Calls.*,Patient.*\nINTO Calls2\nFrom Calls,Patient\n</code></pre>\n\n<p>Now, i set one of the column as primary key but I cant get that primary key to have Identity Increment.\nWhat should i do to do this?</p>\n\n<p>Thanks in advance,\nMadhu</p>\n"},{"tags":["sql-server-2008","statistics","sql-server-2008-r2"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":136,"score":0,"question_id":10699239,"title":"Statistical Process Control Charts in SQL Server 2008 R2","body":"<p>I'm hoping you can point me in the right direction.</p>\n\n<p>I'm trying to generate a control chart (<a href=\"http://en.wikipedia.org/wiki/Control_chart\" rel=\"nofollow\">http://en.wikipedia.org/wiki/Control_chart</a>) using SQL Server 2008. Creating a basic control chart is easy enough. I'd just calculate the mean and standard deviations and then plot them.</p>\n\n<p>The complex bit (for me at least) is that I would like the chart to reset the mean and the control limits when a step change is identified.</p>\n\n<p>Currently I'm only interested in a really simple method of identifying a step change, 5 points appearing consecutively above or below the mean. There are more complex ways of identifying them (<a href=\"http://en.wikipedia.org/wiki/Western_Electric_rules\" rel=\"nofollow\">http://en.wikipedia.org/wiki/Western_Electric_rules</a>) but I just want to get this off the ground first.</p>\n\n<p>The process I have sort of worked out is:</p>\n\n<ol>\n<li>Aggregate and order by month and year, apply row numbers.</li>\n<li>Calculate overall mean</li>\n<li>Identify if each data item is higher, lower or the same as the mean, tag with +1, -1 or 0.</li>\n<li>Identify when their are 5 consecutive data items which are above or below the mean (currently using a cursor).</li>\n<li>Recalculate the mean if 5 points are above or 5 points are below the mean.</li>\n<li>Repeat until end of table.</li>\n</ol>\n\n<p>Is this sort of process possible in SQL server? It feels like I maybe need a recursive UDF but recursion is a bit beyond me!</p>\n\n<p>A nudge in the right direction would be much appreciated!</p>\n\n<p>Cheers</p>\n"},{"tags":["c#","sql-server-2008","c#-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":93,"score":2,"question_id":13069338,"title":"DateTimeFormat issue when pass the parameter to MS-Sql stored procedure","body":"<p>I have a stored procedure, which has a parameter like <code>@CurrentDate datetime</code>, when I pass the value <code>DateTime.Now</code> from the front end <em>(C#)</em> to this stored procedure it is working fine.</p>\n\n<p>But when I change the <em>Date Format</em> as <code>English(India)</code> in my system/server, that time <code>DateTime.Now</code> will return a value like <code>25-10-2012 PM 05:23:27</code>. I am passing this value to stored procedure and I'm getting an error message like the following,</p>\n\n<pre><code>Msg 242, Level 16, State 3, Line 10\nThe conversion of a varchar data type to a datetime data type resulted in an out-of-range value.\n</code></pre>\n\n<p>Note : I don't want to use <code>GETDATE()</code> from Sqlserver, I want to pass the parameter from c#.</p>\n\n<p>How can I solve this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":39,"score":2,"question_id":13069084,"title":"How to configure alert and kill longrunning queries in SQL Profiler","body":"<p>is there anyway i can configure alert and kill long running queries using SQL Profiler or someithing in Management Studios ? </p>\n"},{"tags":["c#","sql-server-2008","reporting-services","registry","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13069073,"title":"How to check SQL Server Reporting Services configuration status?","body":"<p>I am writing an installation automation program for SQL Server, while upgrading default instance <code>MSSQLSERVER</code> of SQL Server 2008 to SQL Server 2012, I need to check Reporting Services Configuration status.</p>\n\n<p>Using registry there is possibility to check whether the Reporting Service is instaleld. But I am not getting any clue to check the configuration status of Reporting Services.</p>\n\n<p>Please let me know, if you have any idea on how to check the Configuration Status of Reporting Services.</p>\n"},{"tags":["sql-server-2008","database-backups"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":13066710,"title":"SQL database has very small backup","body":"<p>I have a database of 216 GB. 75% is used by data, the rest is used by Index and Log. When I check free space in the database files I get values around 300 MB. The database is split over 3 data files. When I take a full backup without compression I get a backup of 38 GB. </p>\n\n<p>Can anyone explain this? Can I recover any disk space from the database?</p>\n\n<p>Update: If I try to restore the backup it requires over 200 GB of diskspace.</p>\n"},{"tags":["database","sql-server-2008","stored-procedures","metadata"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":158,"score":3,"question_id":7338418,"title":"How to find stored procedures by name?","body":"<p>I just need to search through all the stored procedures on my database looking for one that contains \"item\" in its name. Any ideas?</p>\n\n<p>I've been tinkering around with this, but it's not quite there yet:</p>\n\n<pre><code>SELECT DISTINCT OBJECT_NAME(ID) FROM SysComments WHERE Text LIKE '%Item%'\n</code></pre>\n"},{"tags":["sql","sql-server-2008","coldfusion","coldfusion-8"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":65,"score":3,"question_id":13066828,"title":"Adding Select All to dropdown","body":"<p>This is my query:</p>\n\n<pre><code> &lt;cfquery name=\"qry\" datasource=\"#variables.staffDs#\"&gt;\n  SELECT\n    firstname + ' ' + surname name, userid, mobileno, extension\n  FROM\n    currentstaff\n  WHERE\n    (mobileno IS NOT NULL OR\n     Left(LTrim(extension), 2) = '07')\n &lt;/cfquery&gt;\n</code></pre>\n\n<p>This is my ColdFusion dropdown box:</p>\n\n<pre><code>  &lt;select name=\"to\" id=\"to\"&gt;\n  &lt;option value=\"\"&gt; -- Select -- &lt;/option&gt;\n  &lt;option style=\"font-weight: bold\" value=\"\"&gt;Send to All&lt;/option&gt;\n  &lt;cfoutput query=\"people\"&gt;\n    &lt;option value=\"#qry.userid#\"&gt;#qry.name#&lt;/option&gt;\n  &lt;/cfoutput&gt;\n  &lt;/select&gt;\n</code></pre>\n\n<p>The names of all people are displayed in the dropdown box list.</p>\n\n<p>What I'd like to do is add an option at the top of the dropdown box to 'Sent to All' to select all users and I'm not sure how to do this.</p>\n\n<p>I'd like to incorporate any extra SQL I might need into my current query, if this is necessary.</p>\n"},{"tags":["php","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":44,"score":-2,"question_id":13065256,"title":"PHP Version 5.3.4 MSSQL 2008 R2 not connecting Warning: mssql_connect() [function.mssql-connect]: Unable to connect to server: 12.1.1.1\\SQLEXPRESS in","body":"<p>PHP Version 5.3.4 (windows)\nMSSQL 2008 R2</p>\n\n<p>Connecting with MSSQL server.</p>\n\n<pre><code>// Connect to MSSQL\n$server = \"12.1.1.1\"; \n$link = mssql_connect($server, 'username', 'password');\nif (!$link) {\n    die('Something went wrong while connecting to MSSQL');\n}\n</code></pre>\n\n<blockquote>\n  <p>Warning: mssql_connect() [function.mssql-connect]: Unable to connect\n  to server: 12.1.1.1\\SQLEXPRESS in.</p>\n</blockquote>\n\n<p>I have enabled php_mssql (thorugh wamp panale), i have cross verified php ext folder, php_mssql.dll available there.</p>\n\n<p>should install any thing other than mentioned above items. </p>\n\n<p><strong>Solution for the above problem:</strong></p>\n\n<p>php connected with mssql.</p>\n\n<p>PHP Version 5.3.4 &amp; MSSQL SQL SERVER 2008 R2</p>\n\n<ul>\n<li>Below steps i followed:\n<ol>\n<li>Enabled php_mssql.dll.</li>\n<li>Download this file <a href=\"http://www.mdome.org/wp-content/uploads/2011/05/ntwdblib.zip\" rel=\"nofollow\">Click here</a> Overrite the ntwdblib.dll into C:\\Documents and Settings\\manikandanj\\wamp\\bin\\php\\php5.3.4</li>\n<li>I have tried below code</li>\n</ol></li>\n</ul>\n\n<blockquote>\n<pre><code>//Connect to MSSQL\n$con = mssql_connect($server, 'uname', 'password');\n\nif (!$con) {\n    die('Something went wrong while connecting to MSSQL');\n}\n</code></pre>\n</blockquote>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":4,"up_vote_count":3,"down_vote_count":0,"view_count":4742,"score":3,"question_id":7670636,"title":"How to decrypt stored procedure in SQL Server 2008","body":"<p>I have one stored procedure which is encrypted using WITH ENCRYPTION option. Now I want to decrypt that procedure. I have already tried SP \"Decryptsp2K\" which is given for SQL 2000 in this forum :</p>\n\n<p><a href=\"http://forums.asp.net/t/1516587.aspx/1\" rel=\"nofollow\">http://forums.asp.net/t/1516587.aspx/1</a></p>\n\n<p>But it deletes my SP, not decrypt. Can any one guide me ?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["c#","sql-server-2008","sqldependency"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":370,"score":1,"question_id":10951645,"title":"SQL Server 2008 R2 DeadLock on query Notification (SqlDependency)","body":"<p>I'm running into a deadlock issue on a SQL Server 2008 R2. When looking at the deadlock graph in the SQL Profiler, the problem seems to stem from query notifications : </p>\n\n<pre><code>  &lt;resource-list&gt;\n   &lt;keylock hobtid=\"72057654759522304\" dbid=\"6\" objectname=\"MyDB.sys.query_notification_814081939\" indexname=\"cidx\" id=\"lock15ab2aa80\" mode=\"RangeX-X\" associatedObjectId=\"72057654759522304\"&gt;\n    &lt;owner-list&gt;\n     &lt;owner id=\"process5c5708\" mode=\"RangeX-X\"/&gt;\n    &lt;/owner-list&gt;\n    &lt;waiter-list&gt;\n     &lt;waiter id=\"process4e9ae08\" mode=\"RangeS-U\" requestType=\"wait\"/&gt;\n    &lt;/waiter-list&gt;\n   &lt;/keylock&gt;\n   &lt;keylock hobtid=\"72057654759522304\" dbid=\"6\" objectname=\"MyDB.sys.query_notification_814081939\" indexname=\"cidx\" id=\"lock15e56a300\" mode=\"RangeS-U\" associatedObjectId=\"72057654759522304\"&gt;\n    &lt;owner-list&gt;\n     &lt;owner id=\"process4e9ae08\" mode=\"RangeS-U\"/&gt;\n    &lt;/owner-list&gt;\n    &lt;waiter-list&gt;\n     &lt;waiter id=\"process5c5708\" mode=\"RangeS-U\" requestType=\"wait\"/&gt;\n    &lt;/waiter-list&gt;\n   &lt;/keylock&gt;\n  &lt;/resource-list&gt;\n</code></pre>\n\n<p>These query notifications are implemented using SQLDependency. \nThe deadlock seems to be occuring when updating a table which is monitored by the SQLDependency.</p>\n\n<p>I don't really understand the deadlock graph syntax..The KeyLock mode is RangeS-U <a href=\"http://msdn.microsoft.com/en-us/library/ms191272%28v=sql.105%29.aspx\" rel=\"nofollow\">only while using the serializable transaction isolation level.</a>, right ? </p>\n\n<p>I've also read this <a href=\"http://stackoverflow.com/questions/446729/sql-server-2005-key-range-locks-in-read-committed-transaction-isolation-level\">question</a>... should i activate READ_COMMITED_SNAPSHOT ?</p>\n\n<p>thx...</p>\n"},{"tags":["xml","sql-server-2008","tsql","xml-parsing"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13065440,"title":"Extract keys and values from XML in a SQL Server stored procedure","body":"<p>I receive XML data like</p>\n\n<pre><code>&lt;t&gt;\n  &lt;ID&gt;8&lt;/ID&gt;\n  &lt;FirstName&gt;name 8&lt;/FirstName&gt;\n  &lt;LastName&gt;surname 8&lt;/LastName&gt;\n  &lt;DateOfBirth&gt;1963-05-23T00:00:00&lt;/DateOfBirth&gt;\n&lt;/t&gt;\n</code></pre>\n\n<p>In a SQL Server stored procedure. There are different xml data formats (the field numbers and field names can differ). Now, I should extract each field and it value and insert each field/value as a separate record in a table. </p>\n\n<p>Are there examples how I can do this with TSQL?</p>\n"},{"tags":["sql-server-2008","datetime"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13065340,"title":"Using a 'date' data type in SQL Server Management Studio 2008","body":"<p>I have a database with existing data that uses the datetime field which is a timestamp that uses date and time.</p>\n\n<p>I want to just store the date, not the time, as the time is never used anyway but due to the way the app works it is causing inconsistencies when reporting on the data.</p>\n\n<p>I believe there is a 'date' data type using the Design view on my table but when I tried to use that it said invalid data type. I also can't do this using the ALTER TABLE syntax in SQL.</p>\n\n<p>Because it's live data, I don't want to make too many changes that might cause problems. We have a demo system that I can play around with though.</p>\n"},{"tags":["c#","asp.net","database","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":57,"score":0,"question_id":13063705,"title":"exception error handling","body":"<p><img src=\"http://i.stack.imgur.com/Tuee5.png\" alt=\"enter image description here\"></p>\n\n<p>i am having this error in the image above whenever i want to book a flight in my airline reservation system project there is an exception error in my code this error message was popping up </p>\n\n<p><code>IndexOutOfRangeException unhandles by user code</code> </p>\n\n<p>...any ideas on how i can go about it my code is written in asp.net using c sharp??</p>\n\n<p>this is code</p>\n\n<pre><code>public partial class TICKET_BOOKING : System.Web.UI.Page\n{\n    protected void Page_Load(object sender, EventArgs e)\n    {\n\n    }\n    int a;\n    String constring = ConfigurationManager.ConnectionStrings[\"conn\"].ConnectionString.ToString();\n    public int Autonumber()\n    {\n        SqlConnection con = new SqlConnection(constring);\n        SqlCommand cmd = new SqlCommand();\n        cmd.CommandType = CommandType.Text;\n        cmd.Connection = con;\n        con.Open();\n        cmd.CommandText = \"select pid from pid\";\n        SqlDataAdapter da = new SqlDataAdapter();\n        DataSet ds = new DataSet();\n        DataTable dt = new DataTable();\n        da.SelectCommand = cmd;\n        da.Fill(dt);\n        a = Convert.ToInt32(dt.Rows[0][0].ToString()) + 1; //this is where its occuring\n        con.Close();\n        return a;\n    }\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":54,"score":2,"question_id":13060782,"title":"SUM() data in a column based on another column data","body":"<p>I have a sql table </p>\n\n<pre><code>Project ID       Employee ID          Total Days\n\n1                   100                   1\n1                  100                   1\n1                  100                   2\n1                   100                   6\n1                   200                   8\n1                   200                   2\n</code></pre>\n\n<p>Now i need this table to look like</p>\n\n<pre><code>Project ID       Employee ID          Total Days\n\n1                   100                   10\n1                   200                   10\n</code></pre>\n\n<p>As iam new to sql,i am little confuse to use SUM() based on above condition.</p>\n"},{"tags":["sql-server","sql-server-2008","maintenance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":22,"score":1,"question_id":13063887,"title":"how to disconnect all logged users in sql server except sa?","body":"<p>speI would like to disconnect all users from sql server except sa.</p>\n\n<p>THe need for this is:</p>\n\n<p>I wrote a dB maintenance utility for my ERP. Before running it I need to ask all users to logoff.\nSo somehow I would like to give them a message (through ERP) \"disconnecting in 5 minutes, please save your work and logoff or you'll be kicked out\" and then after 5 minutes run the command on the server that disconnects all people.\nI want \"sa\" or anyway \"1 specific user\" not to be disconnected, since th dbmaintenance utilty will user that user for db connection.</p>\n\n<p>I found this:</p>\n\n<pre><code>use master\nalter database MyDatabase set offline with rollback immediate\n</code></pre>\n\n<p>but how to say \"one specific user is an exception\"?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","window-functions"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":60,"score":2,"question_id":13061336,"title":"How to calculate the mode for each value in another column in TSQL","body":"<p>I have a table like this:</p>\n\n<pre><code>ID   Group  Gender\n------------------\n1    A      M\n2    A      M\n3    A      F\n4    A      M\n5    A      U\n6    B      F\n7    B      F\n8    B      M\n9    C      U\n10   C      F\n11   C      U\n</code></pre>\n\n<p>I am trying to calculate the <strong>mode group</strong> for each gender. In other words, for each gender, tell me which is the most popular group.  So the results I want would be as follows:</p>\n\n<pre><code>Gender  ModeGroup\n-----------------\nM       A          (because 3 males in group A, 1 in B and 0 in C)\nF       B          (because 2 females in group B, 1 in A and 1 in C)\nU       C          (because 2 unknown in group C, 0 in B and 1 in C)\n</code></pre>\n\n<p>In the case of a tie, I need a record returned for each of the tied groups.</p>\n\n<p>How can I do this elegantly in TSQL?  I think I need to use a window function, but I've  been struggling with how to go about it.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":107,"score":0,"question_id":11869727,"title":"Inner Join Delete in SQL Server 2008?","body":"<p>I am trying to join 2 tables together and do a delete on it.</p>\n\n<pre><code>DELETE TableA \nFROM TableA a\nINNER JOIN\nTableB b on b.Id = a.Id\nwhere title like 'test' \n</code></pre>\n\n<p>The above is what I come up with however I keep getting </p>\n\n<blockquote>\n  <p><em>The DELETE statement conflicted with the REFERENCE constraint</em></p>\n</blockquote>\n\n<p>I thought if I merge the 2 tables together then I will delete both at the same time and no constraints would be conflicted. </p>\n\n<p>Am I missing something in my query?</p>\n"},{"tags":["sql","database","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":91,"score":3,"question_id":11560713,"title":"Generate insert script for selected records?","body":"<p>I have a table with the following data:</p>\n\n<pre><code>Pk_Id  ProductName           Fk_CompanyId       Price\n------------------------------------------------------\n1      AMX                   1                  10.00\n2      ABC                   1                  11.00\n3      APEX                  1                  12.00\n4      AMX                   1                  10.00\n5      ABC                   1                  11.00\n6      APEX                  1                  12.00\n7      AMX                   2                  10.00\n8      ABC                   2                  11.00\n9      APEX                  2                  12.00\n</code></pre>\n\n<p>I want to generate Insert script for migrating records whose Fk_CompanyId is 1.</p>\n\n<p>There is an insert script option to generate script for all records but I want to filter some records to migrate to another database.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":3283,"score":2,"question_id":7515110,"title":"Create SQL INSERT Script with values gathered from table","body":"<p>I need to create a INSERT script in order to insert iin another database the same data.<br/> If in SQL Server I select \"Script table as > INSERT To\" I can easily recreate the skeleton for the INSERT statement. However since I have a several records to migrate, I would prefer to avoid having to insert the values manually.</p>\n\n<p><strong>Therefore is there any way to \"automatically\" get the INSERT script with also the values (coming from the target table) filled in?</strong> <br/>\nI know this could be done with SSIS, but I am wondering whether it would be possible as well with a quicker solution.</p>\n"},{"tags":["sql-server-2008","ssrs-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13060984,"title":"SQL Server Report Services Not Configuring","body":"<p>Ok this is kind of Frustrating... I think/know I am doing everything right... However SQL Server Reporting Services cannot be configured:</p>\n\n<p><strong>To Configure I did these following steps</strong></p>\n\n<ol>\n<li>Opened Reporting Services Configuration Manager</li>\n<li>Click Connect</li>\n<li><p>Clicked Web Services URL <br> </p>\n\n<ul>\n<li>Here (first) I just used the default values (just giving a different Name)</li>\n<li>Then I tried to configure by using the Host Header</li>\n<li>Clicked Advance Gave Host Header a Name from DNS something like (rs.constoso.com)</li>\n<li>Removed \"All assigned listener\"</li>\n</ul></li>\n<li><p>I Change the Database </p>\n\n<ul>\n<li>Created a new report database</li>\n<li>connected to database server</li>\n<li>used both Sharepoint Mode (cause eventually that is what I am trying to do) and the native mode.</li>\n</ul></li>\n<li><p>However no matter what I do the reporting service seems to not respond. When I click the Web Service URL it says the Reporting Service has some Error.</p></li>\n</ol>\n\n<p>I am not sure what am I doing wrong (is there something I am forgetting somewhere?)</p>\n\n<p>My System:</p>\n\n<ol>\n<li>Windows Server 2008 R2</li>\n<li>SQL server 2008</li>\n<li>Has Sharepoint 2010 installed</li>\n</ol>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":1374,"score":3,"question_id":5180256,"title":"Create assembly from System.Web in SQL Server","body":"<p>Hi I have following problem:</p>\n\n<p>I need to create an assembly in SQL Server database from <code>system.web.dll</code> with following script:</p>\n\n<pre><code>CREATE ASSEMBLY SystemWeb \nFROM 'C:\\WINDOWS\\MICROSOFT.NET\\FRAMEWORK\\V2.0.50727\\SYSTEM.WEB.DLL' \nWITH PERMISSION_SET = UNSAFE\n</code></pre>\n\n<p>At fist cannot create because I retrieve some error because don't find some dependencies dll.</p>\n\n<p>I start to install first the dependencies like system.drawing.dll an so on without problem but when I'm trying to install <code>system.web.dll</code> it require <code>System.EnterpriseServices.dll</code> that require <code>System.Runtime.Remoting.dll</code> that require <code>System.Web</code> and here I'm inside a circle and cannot go OUT.</p>\n\n<p>Somebody can help to resolve it?</p>\n\n<p>Windows Server 2008 / SQL Server 2008 Enterprise</p>\n\n<p>Thank you a lot in advance</p>\n"},{"tags":["sql-server","sql-server-2008","memory-consumption"],"answer_count":4,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":16700,"score":1,"question_id":856575,"title":"SQL Server 2008 takes up a lot of memory?","body":"<p>I am conducting stress tests on my database, which is hosted on SQL Server 2008 64-bit running on a 64-bit machine with 10 GB of RAM.</p>\n\n<p>I have 400 threads. Each thread queries the database every second, but the query time does not take time, as the SQL profiler says that, but after 18 hours SQL Server uses up 7.2 GB of RAM and 7.2 GB of virtual memory.</p>\n\n<p>Is this normal behavior? How can I adjust SQL Server to clean up unused memory?</p>\n"},{"tags":["sql-server-2008","tsql","linked-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":13060294,"title":"Pragmatically check for existing login for a linked server","body":"<p>I'm writing an admin script I can use for creating linked servers. The script does a <code>IF EXISTS</code> check on the linked server before creating, this works fine.</p>\n\n<p>I have added the <code>sp_addlinkedsrvlogin</code> details to the script to generate the appropriate permissions to access the linked server.</p>\n\n<p>When I try to re-run thescript again it throws the error:</p>\n\n<blockquote>\n  <p>Msg 15190, Level 16, State 1, Procedure sp_dropserver, Line 56 There\n  are still remote logins or linked logins for the server\n  'LinkedServerName'.</p>\n</blockquote>\n\n<h2>So my question is:</h2>\n\n<p><strong>What is the specific code to check for existence of a login for a linked server?</strong></p>\n\n<p>This will allow me to conditionally <code>EXEC sp_droplinkedsrvlogin</code> before issuing the conditional <code>EXEC sp_dropserver</code></p>\n\n<p><br/></p>\n\n<hr>\n\n<p>Code as it stands now:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>-- Set to master\n    USE master\n    GO\n\n-- Set linked server vars\n    DECLARE\n        @ServerName         varchar(max)    =   'Server Name'       -- Name you wish to give to the Linked Server connection. To remove ambiguity you can name this the same as the Data Source you are connecting to.\n        ,@ProductName       nvarchar(128)   =   'Product Name'      -- Type of OLE DB product you are connecting too, i.e. Oracle or SQL Server, e.g. SQl Server = N'MSSQL'.\n        ,@ProviderName      nvarchar(128)   =   'Provider Name'     -- The OLE DB provider is expected to be registered with the specified PROGID in the registry, e.g. SQL Server = N'SQLNCLI'.\n        ,@DataSource        nvarchar(4000)  =   'Source Name'       -- Is the name of the data source as interpreted by the OLE DB provider, i.e. the actual server name if connecting to MS SQL Server.\n        ,@Location          nvarchar(4000)  =   'Location'          -- Not really worth using, listed for compelteness according to Reference 1 Location.           \n        ,@ProviderString    nvarchar(4000)\n        ,@CatalogName       nvarchar(4000)  =   'Database Name'     -- (Optional) Name of the database/catalog you will connect to. \n    SET\n        @ProviderString =   'PROVIDER=SQLOLEDB; SERVER=' + @ServerName\n\n-- Set linked server login vars\n    DECLARE\n        @Useself            varchar(8)      =   'Option'            -- 'TRUE' or 'FALSE' or NULL. Determines whether to connect to @rmtsrvname\\@ServerName by impersonating local logins or explicitly submitting a login and password.\n        ,@LocalLogin        varchar(100)    =   'Domain\\Login'      -- Domain account.\n        ,@User              varchar(50)     =   'SQL user'          -- Is the remote login used to connect to rmtsrvname when @useself\\@Useself is FALSE.\n        ,@Password          varchar(20)     =   'Password'          -- Is the password associated with @rmtuser\\@User.\n\n-- Drop linked server if already exists to prevent error when creating\n    IF  EXISTS\n        (\n            SELECT  *\n            FROM    sys.servers\n            WHERE   server_id   !=  0\n                    AND name    =   @ServerName\n        )  \n        EXEC    sp_dropserver\n                @ServerName\n\n-- Create linked server         \n    EXEC    sp_addlinkedserver  \n            @server         =   @ServerName\n            ,@srvproduct    =   @ProductName\n            ,@provider      =   @ProviderName\n            ,@datasrc       =   @DataSource\n            ,@location      =   @Location\n            ,@provstr       =   @ProviderString\n            ,@catalog       =   @CatalogName\n\n-- Add permissions for usage            \n    EXEC    sp_addlinkedsrvlogin \n            @rmtsrvname     =   @ServerName\n            ,@useself       =   @Useself\n            ,@locallogin    =   @LocalLogin\n            ,@rmtuser       =   @User\n            ,@rmtpassword   =   @Password\n</code></pre>\n\n<hr>\n\n<p>Answer accepted below. I also found that you can force logins to be dropped when dropping a linked server by passing the argument <code>,@droplogins = 'droplogins'</code> to the <code>EXEC sp_dropserver</code> proc:</p>\n\n<pre><code>IF  EXISTS\n    (\n        SELECT  1\n        FROM    sys.servers\n        WHERE   server_id   !=  0\n                AND name    =   @ServerName\n    )  \n    EXEC    sp_dropserver\n            @server         =   @ServerName\n            ,@droplogins    =   'droplogins'\n</code></pre>\n"},{"tags":["sql","nhibernate","sql-server-2008","fluent-nhibernate","time"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":591,"score":2,"question_id":6751185,"title":"How to deal with TIME datatype from SQL Server 2008 with NHibernate?","body":"<p>I am using the <code>TIME</code> datatype from SQL Server 2008 and I am having some problems getting it to work with NHibernate.</p>\n\n<pre><code>public TimeTableEventMap()\n{\n    Id(x =&gt; x.Id)\n    Map(x =&gt; x.Day).NvarcharWithMaxSize().Not.Nullable();\n    Map(x =&gt; x.StartTime).Length(4).TimeDataType().Not.Nullable();\n    Map(x =&gt; x.Endtime).Length(4).TimeDataType().Not.Nullable();\n    References(x =&gt; x.TimeTable).Not.Nullable().Cascade.All();\n    References(x =&gt; x.RequiredSettings).Not.Nullable().Cascade.All();\n}\n\n/// &lt;summary&gt;\n///  MS Sql 2008 date type.\n/// &lt;/summary&gt;\n/// &lt;param name=\"map\"&gt;&lt;/param&gt;\n/// &lt;returns&gt;&lt;/returns&gt;\npublic static PropertyPart TimeDataType(this PropertyPart map)\n{\n   return map.CustomSqlType(\"time\");\n}\n\npublic class TimeTableEvent\n{\n    public virtual int Id { get; private set; }\n    public virtual DayOfWeek Day { get; set; }\n    public virtual DateTime StartTime { get; set; }\n    public virtual DateTime Endtime { get; set; }\n    public virtual TimeTable TimeTable { get; set; }\n    public virtual RequiredSetting RequiredSettings { get; set; }\n}   \n</code></pre>\n\n<p>I get this error</p>\n\n<blockquote>\n  <p>NHibernate.Exceptions.GenericADOException was caught<br>\n  Message=could not execute query<br>\n  [ SELECT TOP (@p0) this_.TimeTableEventId as TimeTabl1_15_1_,\n  this_.Day as Day15_1_, this_.StartTime as StartTime15_1_,\n  this_.Endtime as Endtime15_1_, this_.TimeTableId as TimeTabl5_15_1_,\n  this_.RequiredSettingsId as Required6_15_1_,\n  requiredse2_.RequiredSettingsId as Required1_10_0_,\n  requiredse2_.BackgroundColor as Backgrou2_10_0_, requiredse2_.Title as\n  Title10_0_ FROM TimeTableEvents this_ inner join RequiredSettings\n  requiredse2_ on\n  this_.RequiredSettingsId=requiredse2_.RequiredSettingsId WHERE\n  this_.TimeTableId in (@p1) ]<br>\n  Positional parameters:  #0>14<br>\n  [SQL: SELECT TOP (@p0) this_.TimeTableEventId as TimeTabl1_15_1_,\n  this_.Day as Day15_1_, this_.StartTime as StartTime15_1_,\n  this_.Endtime as Endtime15_1_, this_.TimeTableId as TimeTabl5_15_1_,\n  this_.RequiredSettingsId as Required6_15_1_,\n  requiredse2_.RequiredSettingsId as Required1_10_0_,\n  requiredse2_.BackgroundColor as Backgrou2_10_0_, requiredse2_.Title as\n  Title10_0_ FROM TimeTableEvents this_ inner join RequiredSettings\n  requiredse2_ on\n  this_.RequiredSettingsId=requiredse2_.RequiredSettingsId WHERE\n  this_.TimeTableId in (@p1)]<br>\n  Source=NHibernate<br>\n  SqlString=SELECT TOP (@p0) this_.TimeTableEventId as\n  TimeTabl1_15_1_, this_.Day as Day15_1_, this_.StartTime as\n  StartTime15_1_, this_.Endtime as Endtime15_1_, this_.TimeTableId as\n  TimeTabl5_15_1_, this_.RequiredSettingsId as Required6_15_1_,\n  requiredse2_.RequiredSettingsId as Required1_10_0_,\n  requiredse2_.BackgroundColor as Backgrou2_10_0_, requiredse2_.Title as\n  Title10_0_ FROM TimeTableEvents this_ inner join RequiredSettings\n  requiredse2_ on\n  this_.RequiredSettingsId=requiredse2_.RequiredSettingsId WHERE\n  this_.TimeTableId in (@p1)</p>\n  \n  <p>StackTrace:<br>\n  at NHibernate.Loader.Loader.DoList(ISessionImplementor\n  session, QueryParameters queryParameters)<br>\n  at NHibernate.Loader.Loader.ListIgnoreQueryCache(ISessionImplementor\n  session, QueryParameters queryParameters)<br>\n  at NHibernate.Loader.Loader.List(ISessionImplementor\n  session, QueryParameters queryParameters, ISet<code>1 querySpaces, IType[]\n  resultTypes)<br>\n  at NHibernate.Loader.Criteria.CriteriaLoader.List(ISessionImplementor\n  session)<br>\n  at NHibernate.Impl.SessionImpl.List(CriteriaImpl criteria,\n  IList results)<br>\n  at NHibernate.Impl.CriteriaImpl.List(IList results)<br>\n  at NHibernate.Impl.CriteriaImpl.List[T]()<br>\n  at NHibernate.Criterion.QueryOver</code>1.ListU<br>\n  at NHibernate.Criterion.QueryOver`1.NHibernate.IQueryOver.ListU<br>\n  at TimeTableRepo.cs:line 47<br>\n  at TimeTableService.cs:line 43<br>\n  InnerException: System.FormatException<br>\n  Message=Input string '16:00:00' was not in the correct\n  format.<br>\n  Source=NHibernate<br>\n  StackTrace:<br>\n  at NHibernate.Type.DateTimeType.Get(IDataReader rs,\n  Int32 index)<br>\n  at NHibernate.Type.NullableType.NullSafeGet(IDataReader rs, String name)<br>\n  at NHibernate.Type.NullableType.NullSafeGet(IDataReader rs, String[]\n  names, ISessionImplementor session, Object owner)<br>\n  at NHibernate.Type.AbstractType.Hydrate(IDataReader\n  rs, String[] names, ISessionImplementor session, Object owner)<br>\n  at NHibernate.Persister.Entity.AbstractEntityPersister.Hydrate(IDataReader\n  rs, Object id, Object obj, ILoadable rootLoadable, String[][]\n  suffixedPropertyColumns, Boolean allProperties, ISessionImplementor\n  session)<br>\n  at NHibernate.Loader.Loader.LoadFromResultSet(IDataReader rs, Int32 i,\n  Object obj, String instanceClass, EntityKey key, String rowIdAlias,\n  LockMode lockMode, ILoadable rootPersister, ISessionImplementor\n  session)<br>\n  at NHibernate.Loader.Loader.InstanceNotYetLoaded(IDataReader dr, Int32 i,\n  ILoadable persister, EntityKey key, LockMode lockMode, String\n  rowIdAlias, EntityKey optionalObjectKey, Object optionalObject, IList\n  hydratedObjects, ISessionImplementor session)<br>\n  at NHibernate.Loader.Loader.GetRow(IDataReader rs,\n  ILoadable[] persisters, EntityKey[] keys, Object optionalObject,\n  EntityKey optionalObjectKey, LockMode[] lockModes, IList\n  hydratedObjects, ISessionImplementor session)<br>\n  at NHibernate.Loader.Loader.GetRowFromResultSet(IDataReader resultSet,\n  ISessionImplementor session, QueryParameters queryParameters,\n  LockMode[] lockModeArray, EntityKey optionalObjectKey, IList\n  hydratedObjects, EntityKey[] keys, Boolean returnProxies)<br>\n  at NHibernate.Loader.Loader.DoQuery(ISessionImplementor session,\n  QueryParameters queryParameters, Boolean returnProxies)<br>\n  at NHibernate.Loader.Loader.DoQueryAndInitializeNonLazyCollections(ISessionImplementor\n  session, QueryParameters queryParameters, Boolean returnProxies)<br>\n  at NHibernate.Loader.Loader.DoList(ISessionImplementor\n  session, QueryParameters queryParameters)<br>\n  InnerException: System.InvalidCastException<br>\n  Message=Unable to cast object of type\n  'System.TimeSpan' to type 'System.IConvertible'.<br>\n  Source=mscorlib  </p>\n</blockquote>\n\n<pre><code>public List&lt;TimeTableEvent&gt; GetTimeTableEvents(Student student, List&lt;int&gt; timeTableIds)\n{\n    TimeTableEvent tAlias = null;\n\n    List&lt;TimeTableEvent&gt; allEvents = session.QueryOver&lt;TimeTableEvent&gt;(() =&gt; tAlias)\n        .Where(Restrictions.In(Projections.Property(() =&gt; tAlias.TimeTable.Id), timeTableIds))\n        .Fetch(r =&gt; r.RequiredSettings).Eager\n        .TransformUsing(Transformers.DistinctRootEntity)\n        .Take(QueryLimits.TimeTableEvents)\n        .List&lt;TimeTableEvent&gt;().ToList();\n\n    return allEvents;\n}\n</code></pre>\n"},{"tags":["sql-server-2008","ssis"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":166,"score":0,"question_id":12127592,"title":"SSIS Package Deployment Fails using Windows Auth across domains","body":"<p>Trying to deploy a package on my local PC and connected to my client's vpn.  </p>\n\n<p>I get the error:</p>\n\n<pre><code>c:\\Program Files\\Microsoft SQL Server\\110\\DTS\\Binn&gt;dtutil /File c:\\www\\clients\\SomeCompany\\ssis\\warehouse\\Warehous\ne_Update_Table1.dtsx /DestServer SomeServerName /Copy sql;Warehouse_Update_Table1\nMicrosoft (R) SQL Server SSIS Package Utilities\nVersion 10.50.1600.1 for 64-bit\n\n\nError (0xC0014014) while checking for the existence of package \"Warehouse_Update_Table1\" on SQL Server.\nCould not save package \"Warehouse_Update_Table1\" because of error 0x80004005.\nDescription: Login failed. The login is from an untrusted domain and cannot be used with Windows authentication.\nSource: Microsoft SQL Server Native Client 10.0\n\n    c:\\Program Files\\Microsoft SQL Server\\110\\DTS\\Binn&gt;dtutil /File c:\\www\\clients\\SomeCompany\\ssis\\warehouse\\Warehouse_Update_Table1.dtsx /DestServer SomeServerName.SomeDomain.net /Copy s\n    ;Warehouse_Update_TestTable1\n    c:\\Program Files\\Microsoft SQL Server\\110\\DTS\\Binn&gt;dtutil /File c:\\www\\clients\\SomeCompany\\ssis\\tmlwarehouse\\Warehouse_Update_Table1.dtsx /DestServer/SomeServerName.SomeDomain.net /Copy sql;Warehouse_Update_Table1\n\n(obviously I have real values for \"SomeCompany\" and SomeServerName.SomeDomain\"\n</code></pre>\n\n<p>is there a way to elevate rights such as what you can do with an .exe to specify the domain of the sender or to elevate this request so this thing works?</p>\n\n<p>we are calling this using windows auth unfortunately because that's what the client ants.</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":13052903,"title":"SQL Server stored procedure, exec from another query","body":"<p>I'm learning SQL and I've got some problems calling a stored procedure from a new/different query. </p>\n\n<p>I has build a <code>installDB.sql</code> file where there are created some tables and additionally filled these with data.  </p>\n\n<p>Furthermore I use a stored procedure as well, to add some functions.  </p>\n\n<p>Example:</p>\n\n<pre><code>CREATE PROCEDURE Add_Book\n    @User CHAR(50),\n    @Book CHAR(50)\n    AS\nINSERT INTO Relationtable(book_id, user_id, current_dato) \n    VALUES(\n        (SELECT book_id FROM Books WHERE book_title = @Book),\n        (SELECT user_id FROM Users WHERE user_name = @User),\n         GETDATE()\n    )\n</code></pre>\n\n<p>In this query (tab) I can <code>exec</code> that procedure (without problems):  </p>\n\n<pre><code>exec Add_Book myUser, myBook\n</code></pre>\n\n<p>But if I try this command in a new query (tab), it doesn't work.  </p>\n\n<p>I want the <code>installDB</code> to build all my functions and be able to call them later from another queries.</p>\n\n<p>Is this possible?</p>\n"},{"tags":["c#","sql-server-2008","datetime","linq-to-entities","equality"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":64,"score":3,"question_id":13057855,"title":"Equality comparison fails between C# datetime and SQL datetime","body":"<p>I am trying to do an equality comparison between a C# datetime and a SQL datetime, which appears to fail due to the precision in which those values are stored. </p>\n\n<p>So say I have a really simple SQL table, with these fields:</p>\n\n<pre><code>ID (PK, int, not null) - identity\nTitle (text, null)\nUpdateTime (datetime, not null)\n</code></pre>\n\n<p>I create a class object via Entity framework, setting its UpdateTime to DateTime.Now like so:</p>\n\n<pre><code>DateTime now = DateTime.Now;\nTitle.UpdateTime = now;\n</code></pre>\n\n<p>When I insert my new object into the table, I see that all the values appear to be stored correctly. Now I want the ID that was created for my object.</p>\n\n<p>This is where things get borked. I try pulling the ID back via LINQ:</p>\n\n<pre><code>Title.ID = context.DBTitles.Where(x=&gt;x.UpdateTime == now).FirstOrDefault().ID;\n</code></pre>\n\n<p>This throws an exception because the query returns null, despite the fact that the 'now' I've inserted is supposedly the same as the 'now' that was inserted into my table.</p>\n\n<p>So my question : How do I ensure that my C# datetime is equivalent to the datetime stored in SQL? What is the best way to get my ID back?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":56,"score":2,"question_id":13057408,"title":"Compare values of two columns then select the larger value","body":"<p>I need to query a table and select 3 of the values of 4 columns. I need to compare the values of the 3rd column and the fourth column and select the larger value.</p>\n\n<p>For example:</p>\n\n<pre><code>column1  column2  column3  column4\n hello    hello      3        5   \n hi       hi         7        1   \n</code></pre>\n\n<p>I need to return:</p>\n\n<pre><code>column1  column2  Hybrid\n hello    hello     5   \n hi       hi        7   \n</code></pre>\n\n<p>I have been trying to use IF/ELSE but I just can't seem to get the syntax correct</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":13057281,"title":"Grouping and Total Issue","body":"<p>I have a table called Phone_Details and the data looks like:</p>\n\n<pre><code>Name            DeviceType  InvoiceDate TotalCharges\nAguilera, Alex  Smart Phone 8/3/2012    606.55\nAguilera, Alex  Data Card   8/3/2012    26.17\n</code></pre>\n\n<p>I want Output as:</p>\n\n<pre><code>Name            Total Spend    # of devices    Avg Spend    # of Bills &gt;300\nAguilera, Alex  632.72              2            316.36            1\n</code></pre>\n\n<p>I tried doing this:</p>\n\n<pre><code>Select Name,Sum(Totalcharges), Count(DeviceType),Sum(Totalcharges)/Count(DeviceType)\nfrom dbo.Phone_Details\ngroup by Name\n</code></pre>\n\n<p>But How can i get the last column this?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":57,"score":2,"question_id":13057176,"title":"Msg 102, Level 15, State 1, Line 24 Incorrect syntax near '.'","body":"<p>All... based on another question I've posted here recently, I built this stored procedure, but when executed, I receive the error in the title. </p>\n\n<p>As you can see, I tried to remove any aliases, but it didn't matter. Not sure how to use PRINT to see the issue on this either. Of course the isolated <code>SELECT</code> statement works on its own.  </p>\n\n<p>I can even pull results from my temp table after the error appears. So is it a problem in this script or the results? Appreciate your assistance. I also only used the WHERE statement to limit the test results.  </p>\n\n<pre><code>    ALTER PROC ap_vhdr_test AS\nSET NOCOUNT ON\nIF OBJECT_ID('temp.dbo.#ap_vend_det') is NOT NULL\nDROP TABLE #ap_vend_det;\n\nCREATE TABLE #ap_vend_det           \n(db_name varchar(32)\n, vendor_name varchar(40)\n, vendor_code varchar(12)\n, voucher_no varchar(16)\n, invoice_num varchar(16)\n, inv_date varchar(16)\n, due_date varchar(16)\n, apply_date varchar(16)\n, total float\n, line_desc varchar(40)\n, company_id smallint\n, gl_num varchar(32)\n, acct_site varchar(32)\n, sort_code varchar(32)\n, nat_gl varchar(32)\n, gl_desc varchar(40)\n, category nvarchar(510)\n, sub_category nvarchar(510)\n, po_num varchar(16)\n, vendor_class varchar(8)\n)\nINSERT INTO #ap_vend_det\nEXEC sp_MSforeachdb N'IF ''?'' NOT IN ( ''model'',''tempdb'',''master'',''msdb'')\nBEGIN SELECT DISTINCT db_name = ''?''\n, amaster.addr1 --as vendor_name\n, amaster.vendor_code --as vendor_code\n, apdet.trx_ctrl_num --as voucher_no\n, aphdr.doc_ctrl_num --as invoice_num\n, CONVERT(varchar(16),dateadd(dd,(aphdr.date_doc - 639906),''1/1/1753''),101) --as inv_date \n, CONVERT(varchar(16),dateadd(dd,(aphdr.date_due - 639906),''1/1/1753''),101) --as due_date\n, CONVERT(varchar(16),dateadd(dd,(aphdr.date_applied - 639906),''1/1/1753''),101) --as apply_date\n, aphdr.amt_net --as total\n, aphdr.doc_desc --as line_desc\n, gldet.company_id --as company_id\n, gldet.account_code --as gl_num\n, gldet.seg2_code --as acct_site\n, gldet.seg3_code --as sort_code\n, gldet.seg1_code --as nat_gl\n, gldet.description --as gl_desc\n, ap_coa.group_header --as category\n, ap_coa.group_label  --as sub_category\n, apdet.po_ctrl_num --as po_num\n, apvend.vend_class_code --as vendor_class\nFROM ?.dbo.amaster --amaster\nJOIN ?.dbo.aphdr --aphdr                        --**\n    ON amaster.vendor_code = aphdr.vendor_code\n    AND amaster.pay_to_code = aphdr.pay_to_code\nJOIN ?.dbo.apdet --apdet\n    ON aphdr.trx_ctrl_num = apdet.trx_ctrl_num\nJOIN ?.dbo.gldet --gldet\n    ON aphdr.journal_ctrl_num = gldet.journal_ctrl_num\nJOIN ?.dbo.glt --glt\n    ON gldet.journal_ctrl_num = glt.journal_ctrl_num\nJOIN ?.dbo.apvend --apvend\n    ON amaster.vendor_code = apvend.vendor_code\nJOIN reps.dbo.ap_coa --ap_coa\n    ON gldet.seg1_code = ap_coa.acct_code\nWHERE aphdr.date_applied &gt;= ''734785''              \nEND';\n\nSELECT * FROM #ap_vend_det;\n</code></pre>\n"},{"tags":["sql","sql-server-2008","query","select"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13057029,"title":"SQL query to filter out match results","body":"<pre><code>        SELECT TOP 92 PERCENT \n        Convert(DateTime,Floor(Cast((DateTime) as Float)*24)/24,0) AS SummaryDateTime,\n        MIN(APM_ApplicationAvailability.PercentAvailability) AS MIN_of_ApplicationAvailability,\n        Nodes.Caption AS NodeName \n\n        FROM \n        (Nodes INNER JOIN APM_AlertsAndReportsData ON (Nodes.NodeID = APM_AlertsAndReportsData.NodeId))  INNER JOIN APM_ApplicationAvailability ON (APM_AlertsAndReportsData.ApplicationId = APM_ApplicationAvailability.ApplicationID)\n\n\n        WHERE \n        ( DateTime BETWEEN 40907 AND 41205 )\n         AND  \n        (\n          (APM_AlertsAndReportsData.ApplicationName LIKE '%HTTP%') AND \n          (Nodes.Caption = 'www.example.com')\n        )\nGROUP BY Convert(DateTime,Floor(Cast((DateTime) as Float)*24)/24,0), \nNodes.Caption\n\n\nORDER BY SummaryDateTime ASC\n</code></pre>\n\n<p>Above query giving me following result, which attached as an image. <img src=\"http://i.stack.imgur.com/zCENr.png\" alt=\"enter image description here\"> </p>\n\n<p>I want to write a query to filter out all <code>0.00%</code> results so it will just gives only <code>0.00%</code> data, because i don't care about <code>100%</code> data. I don't know how to filter data. </p>\n"},{"tags":["sql-server-2008","common-table-expression"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":27,"score":1,"question_id":13055930,"title":"SQL Server CTE implementation","body":"<p>I'm writing a script as below based on my business logic, Please could any one suggest me, how can implement CTE (Common table expression)  </p>\n\n<pre><code>IF OBJECT_ID('tempdb..#tmpFirstTable') IS NOT NULL\nDROP TABLE #tmpFirstTable\n\n;WITH tempCTE AS ( select * from Table1  )      \n\nIF OBJECT_ID('tempdb..#tmpTable') IS NOT NULL\nDROP TABLE #tmpTable\nSELECT  * \ninto #tmpTable\nfrom table2  \n\nSelect * from tempCTE T1,#tmpTable T2 , #tmpFirstTable T3 where T1.ID = T2.ID and T2.ID = T3.ID\n</code></pre>\n\n<p>The above code format is should be as it is.  </p>\n\n<p>The <strong>ERROR</strong> which I'm getting is.  </p>\n\n<blockquote>\n  <p><em>Incorrect syntax near the keyword 'IF'.</em></p>\n</blockquote>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":60,"score":3,"question_id":13055967,"title":"SQL statement selecting most recent date no longer working","body":"<p>I've had a sudden failure in one of my reporting routines and have traced it back to the having portion of my statement. The function this has been serving, up until 2 days ago, was selecting the most recent date from the <code>dbo.data_feed_file</code> table (column name: <code>File_Date</code>). </p>\n\n<p>Statement follows</p>\n\n<pre><code>HAVING (dbo.data_feed_file.file_date = (Select MAX(File_Date) as Expr1\n                                        FROM dbo.data_feed_file AS data_feed_file_1))\n</code></pre>\n\n<p>First: is there an alternative way to write this? I've gotten my report working by removing the statement, it's just 2.5 million more lines than I want. I know I can hard code the date to pull just the specific date I want, but automation is obviously preferred.</p>\n\n<p>Second: Does anyone know what could cause this to spontaneously fail? I'm the only person with access to edit this query so I know nothing was changed (no really, nothing changed).</p>\n\n<p>Thanks in advance.</p>\n\n<p>Edit: To add clarification: There is no error message, the column headers are showing up as anticipated but no data is populated, it's just blank fields (as though nothing met the having criteria). The statement completes as though there is nothing wrong. I've confirmed there are no NULL values in the File_Date column.</p>\n"},{"tags":["sql-server-2008","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":19,"score":0,"question_id":13055425,"title":"SQL Server 2008 FullTextSearch Single Character in Name Missing from Results","body":"<p>I have a full text indexed column in SQL Server 2008 which has the following rows: </p>\n\n<blockquote>\n  <p>W Smithers, Wilda Smithers, W2 Smithers</p>\n</blockquote>\n\n<p>When I run the following query I only get back Wilda Smithers and W2 Smithers.</p>\n\n<pre><code>SELECT  FT_TBL.full_name as results\nFROM dbo.ft_table AS FT_TBL WITH (NOLOCK) \nINNER JOIN CONTAINSTABLE (ft_table , full_name, '(\"w*\" AND \"smither*\")',12) AS KEY_TBL \nON FT_TBL.ft_key_id = KEY_TBL.[KEY]\nORDER BY KEY_TBL.RANK desc\n</code></pre>\n\n<p>Any suggestions on how to tweak this so W Smithers is also in my result set?</p>\n"},{"tags":["mysql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":41,"score":1,"question_id":13055194,"title":"CAST(0x993902CE AS DATETIME) FROM SQL SERVER TO MYSQL","body":"<p>Does anyone knows how to <code>CAST(0x993902CE AS DATETIME)</code> from SQL SERVER (<a href=\"http://msdn.microsoft.com/en-us/library/aa258277%28v=sql.80%29.aspx\" rel=\"nofollow\"><code>smalldatetime</code> binary format</a>) to MYSQL?</p>\n\n<p>I tried <code>CAST(0X993902CE AS DATETIME)</code> in mysql but it returns NULL when it should return '2007-05-25 11:58:00'.</p>\n\n<p>If anyone can tell me a way to do this, I'd be grateful.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":46,"score":-3,"question_id":13055435,"title":"Difference between LIKE and NOT LIKE searching for alpha numeric data","body":"<p>What is the difference between these two statements as far as the results?</p>\n\n<pre><code>SELECT * FROM DTSEARCHER \nWHERE word LIKE '%[^a-zA-Z0-9]%'\n\nSELECT * FROM DTSEARCHER \nWHERE word not LIKE '%[^a-zA-Z0-9]%'\n</code></pre>\n"},{"tags":["sql-server-2008","ssis","mdx"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13052244,"title":"Sort an MDX cross join","body":"<p>I'm new to MDX so bear with me. </p>\n\n<p>I have crossed joined two dimensions so that I can report on Sales &amp; Target (from the sales dimension) with this week and this week last year (from the date dimension) in columns and listed locations in the rows.</p>\n\n<p>Psuedo code..</p>\n\n<pre><code>Select \n    {[DateDim].[ReportingPeriod].[Week].&amp;[2012]&amp;[20],\n     [DateDim].[ReportingPeriod].[Week].&amp;[2013]&amp;[20]}\n    *\n    {[Measures].[Total Sales],[Measures].[Target]} on Columns,\n\n    DrillDownLevel([LocationDim].[LocationName].[All]) on Rows from [MyCube]\n</code></pre>\n\n<p>How do I sort the results by sales this year? (.. <code>[2013].[20]</code>)</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","query-optimization"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":13051942,"title":"Sql Server 2008 Missing Index on TempTable","body":"<p>I have developed a stored procedure with below code , by using the  <strong>#tmpRIStatusReport</strong>  as temp table and inserting the values into <strong>#tmpRIStatusReport</strong>  and for multi usage purpose.  </p>\n\n<p>while I was running the execution plan, It is saying the below message as missing the index on <strong>#tmpRIStatusReport</strong>.  </p>\n\n<pre><code>/*\nMissing Index Details from ~vs4E6E.sql - databaserver.databasename (developerID (113))\nThe Query Processor estimates that implementing the following index could improve the query cost by 18.9401%.\n*/\n\n/*\nUSE [tempdb]\nGO\nCREATE NONCLUSTERED INDEX [&lt;Name of Missing Index, sysname,&gt;]\nON [dbo].[#tmpRIStatusReport__________________________________________________________________________________________________00000000291F] ([SubId])\n\nGO\n*/\n</code></pre>\n\n<p>Please could you any one suggest me what I need to do?</p>\n"},{"tags":["sql-server","tsql","sql-server-2008","stored-procedures"],"answer_count":6,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":3502,"score":3,"question_id":3292531,"title":"t-sql stored procedure create scripts","body":"<p>I have a bunch of stored procedure names. I want to export the create script for each of the stored procedure. What is the best way to do it? </p>\n\n<p>Right now I am manually selecting the stored proc in SSMS and selecting <code>\"Script stored procedure as -&gt; Drop and Create to\"</code>. This seems tedious. I am hoping there is a better way to deal with this. Thanks.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":85,"score":2,"question_id":13053196,"title":"Incorrect syntax error on select statement from SQL Server using table variables","body":"<p>I have a stored procedure where I create a table variable and then try to execute a <code>select</code> against that table variable, but the output throws an incorrect syntax error.</p>\n\n<p>I have my stored procedure (simplified) below :</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[spGetLog] \nAS\n  SET NOCOUNT ON;\n\n  Declare @Table table (ID int identity(1,1), \n                        Node varchar(100)\n                       )\n\n  insert into @Table(Node) values ('employee')\n\n  Declare @sqlquery AS NVARCHAR(1000)\n\n  SET @sqlquery = 'select * from @Table;'\n  EXEC (@sqlquery)\n</code></pre>\n\n<p>Gives an error -- </p>\n\n<blockquote>\n  <p><em>Incorrect syntax near '@Table'</em></p>\n</blockquote>\n\n<p>In reality the <code>@sqlquery</code> variable I have is complex and I need to use a variable and \nexecute the query.</p>\n\n<p>Is there a way I can still execute my stored procedure using a variable? Any other\nsuggestions are welcome.</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13052474,"title":"Compound conditions in SQL Server 2008 stored procedure","body":"<p>Can you please let me know if stored procedure allow to handle compound condition as below:</p>\n\n<pre><code>if(\n    ( (select Count(*) from dbo.Membership where EmailID=@emailID) &gt;0) \n                                  || \n    ((select Count(*) from dbo.Allocation where ResourceEmail=@emailID)&gt;0))\n)\n</code></pre>\n"},{"tags":["sql-server-2008","entity-framework","datetime","compare","entity-framework-5"],"answer_count":0,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":108,"score":4,"question_id":13034266,"title":"Entity Framework and DateTime comparison with millisecond precision","body":"<p>I've got a problem with Entity Framework (Code First) under C# regarding comparison of DateTime values. I use the below defined class Validity (simplified for this example) as a superclass of of other Entities that shall have a defined validity in time.</p>\n\n<pre><code>public abstract partial class Validity {\n    [Key]\n    public int ID { get; set; }\n\n    public DateTime? ValidFrom { get; set; }\n    public DateTime? ValidTo { get; set; }\n\n    /**\n     * @brief This method builds an IQueryable from another IQueryable,\n     * with added restriction on ValidityFrom/To\n     *\n     * An object's validitiy is defined to\n     *   1. start at timestamp ValidFrom (=inclusive) and\n     *   2. to end before ValidTo (=exclusive).\n     *   3. If ValidFrom or ValidTo is NULL, it means to be \"unbounded\"\n     *      in start or end time (respectively)\n     * \n     **/\n    public static IQueryable&lt;T&gt; isValidAt&lt;T&gt;(IQueryable&lt;T&gt; query, DateTime time) where T : Validity\n    {\n        return query.Where&lt;T&gt;(c =&gt; \n               (!c.ValidFrom.HasValue || time &gt;= c.ValidFrom)  // If ValidFrom != NULL, the given timestamp must be equal or \"after\" ValidFrom\n            &amp;&amp; (!c.ValidTo.HasValue || time &lt; c.ValidTo));     // If ValidTo != NULL, the given timestamp must be \"before\" ValidTo\n    }\n\n    /**\n     * @brief Shall invalidate the object at timestamp time (implicitly sets validTo attribute).\n     **/\n    public void inValidate(DateTime time)\n    {\n        ValidTo = time;\n    }\n}\n\npublic class Item : Validity {\n    public string property { get; set; }\n}\n</code></pre>\n\n<p>At the last three lines, you'll find the class \"Item\" which we'll take as an example. Let's have a look at this query:</p>\n\n<pre><code>DateTime requestTime = DateTime.Now;\nvar items = from n in Validity.isValidAt(db.Items, requestTime)\n            select n;\n</code></pre>\n\n<p>This query should return only return Objects of class Item which are \"valid\" at \"requestTime\". Note that for ValidTo == requestTime the Item is to be regarded as \"invalid\" (the timespan ValidFrom to ValidTo is -exclusive- ValidTo; see comments in source code above). </p>\n\n<h2>The Problem</h2>\n\n<p>I actually -have- results in my result set \"items\" having <code>ValidTo == requestTime</code>. \nI just checked this via</p>\n\n<pre><code>Item i= items.FirstOrDefault();\nif ((i.ValidFrom.HasValue &amp;&amp; i.ValidFrom &gt; requestTime)\n || (i.ValidTo.HasValue &amp;&amp; requestTime &gt;= i.ValidTo)) {\n\n   // ... SOME ERROR OUTPUT ...\n\n}\n</code></pre>\n\n<p>** NOTE: This error isn't happening seldom, but nearly all the time in the software as .inValidate(requestTime); is often called to invalidate an object. ** </p>\n\n<p>I manually checked via Microsoft SQL Server Management Studio (Microsoft SQL Server 2008 is used as backend) using the produced SQL query by LinQ. I had to declare/set @p_<em>linq</em>_0, @p_<em>linq</em>_1 myself (which both mean requestTime)...</p>\n\n<pre><code>DECLARE @p__linq__0 DATETIME\nDECLARE @p__linq__1 DATETIME\nSET @p__linq__0 = '2012-10-23 15:15:11.473'\nSET @p__linq__1 = '2012-10-23 15:15:11.473'\n</code></pre>\n\n<p>This actually works as expected. But if I use '2012-10-23 15:15:11' as a value instead, I'll receive wrong results (as expected). They are similiar to those in my program. So I guess that's the problem...</p>\n\n<p>In Database the \"DateTime\" has Milliseconds defined and ValidFrom/ValidTo are stored including Milliseconds. But I assume that the query doesn't include the milliseconds part of the timestamp for any reason... The variable requestTime how ever has the milliseconds value set.</p>\n\n<p>Unfortunately I don't know how to check the actual values sent in a query to verify this. I only know how to use the items.toString()-Method to output the generated SQL, which contains placeholders.</p>\n\n<p>I tried:\n1. <code>db.Log = Console.Out;</code> which didn't compile due to an error that \"db.Log\" would not be defined (also the auto completion didn't suggest \"Log\"). Whereas db is derived from DbContext.\n2. Also casting \"items\" to ObjectQuery and then using .ToTraceString() doesn't work, program crashes at runtime with error message that cast is invalid.</p>\n\n<p>If this is important: I use .NET 4.0 and EntityFramework.5.0.0.</p>\n\n<h2>Questions</h2>\n\n<ol>\n<li>How to Log/Output the complete SQL (including values of placeholders)?</li>\n<li>How to fix that problem in an elegant way? ...I don't mean a hack that just substracts a second from the 'time' which is assigned to \"ValidTo\" in inValidate()!</li>\n</ol>\n\n<p>Best regards,</p>\n\n<p>Stefan</p>\n\n<h2>EDIT (more details found)</h2>\n\n<p>I checked what happens via the SQL profiler, which seems fine. Timestamps with high (7 digits) precisions are supplied correctly when querying. BUT: I don't get the SELECT causing the incorrect result. So I guessed: it must be some caching. So I put a <code>db.SaveChanges();</code> directly before my LINQ query. Now I got all queries in the profiler.</p>\n\n<p>I tried the following code to change the datatype in database. As it was suggested by Slauma (see <a href=\"http://stackoverflow.com/a/8044310/270591\">http://stackoverflow.com/a/8044310/270591</a>).</p>\n\n<pre><code>modelBuilder.Entity&lt;Item&gt;().Property(f =&gt; f.ValidFrom)\n  .HasColumnType(\"datetime2\").HasPrecision(3);\nmodelBuilder.Entity&lt;Item&gt;().Property(f =&gt; f.ValidTo)\n  .HasColumnType(\"datetime2\").HasPrecision(3);\n</code></pre>\n\n<p>I dropped the whole database before restart... </p>\n\n<p><strong>Result:</strong> No success using HasPrecision(x); where x is one of 0, 3; (with or without db.SaveChanges() directly before); BUT: x = 7 fairly works with db.SaveChanges(); directly before the query... </p>\n\n<p>So, unfortunately this problem is still existent... </p>\n\n<h2>Current Workaround</h2>\n\n<p>I apply the following method to any DateTime value before assigning it to a database objects property. It just rounds the DateTime to full seconds precision (which I configured at the DB). Also this is applied to any DateTime used for comparison.</p>\n\n<p>Result: This is more a hack than a solution! I will need to write access functions for all setter methods, so that a direct assignment cannot happen by accident.</p>\n\n<pre><code>    public static DateTime DateTimeDBRound(DateTime time) {\n        DateTime t = time;\n        long fraction = (t.Ticks % TimeSpan.TicksPerSecond);\n        if (fraction &gt;= TimeSpan.TicksPerSecond / 2)\n        {\n            t = t.AddTicks(TimeSpan.TicksPerSecond - fraction);\n        }\n        else\n        {\n            t = t.AddTicks(-fraction);\n        }\n        return t;\n    }\n</code></pre>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13052451,"title":"Stored procedure returning DateTime format","body":"<p>I created a stored procedure as following,</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[Access_GetDate]\n(\n    @Name varchar(255)\n)\nAS\n    SELECT TOP(1) Employee.StartDate \n    FROM Employee \n    WHERE Employee.Name = @Name;\n</code></pre>\n\n<p>its working properly but returning date in this format </p>\n\n<pre><code>2012-10-24 00:00:00.000\n</code></pre>\n\n<p>However I want it in this format,</p>\n\n<pre><code>2012 10 24\n</code></pre>\n\n<p>only</p>\n"},{"tags":["sql-server-2008","xslt-1.0"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":19,"score":1,"question_id":13052333,"title":"Execution breaks in SQL","body":"<p>we are creating a CSV file using a number of stored procedures with in an XSLT. But each time when we run this XSLT the execution breaks in the middle. And the result data varies in the number of records returned..It was working in our local server before but when we moved to a new server this problem started. (and there is no error shown)</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":45,"score":2,"question_id":13051847,"title":"Replacing characters in a string based on rows in a table sql","body":"<p>I need to replace a list of characters in a string with some mapped characters.</p>\n\n<p>I have a table 'dbo.CharacterMappings' with 2 columns: 'CharacterToFilter' and 'ReplacementCharacter'.</p>\n\n<p>Say that there are 3 records in this table: </p>\n\n<pre><code>Filter   Replacement    \n$        s\n@        a\n0        o\n</code></pre>\n\n<p>How would I replace all of the filter characters in a string based on these mappings?</p>\n\n<p>i.e. 'Hell0 c@t$' needs to become 'Hello cats'.</p>\n\n<p>I cant really think of any way of doing this without resorting to a table variable and then looping through it. I.e. have a table variable with a 'count' column then use a loop to select 1 row at a time based on this column. Then I can use the REPLACE function to update the characters one at a time.</p>\n\n<p>Edit: I should note that I always want to strip out these characters (I don't need to worry about $5 -> s5 for example).</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":35,"score":-1,"question_id":13051392,"title":"check constraint for 2 columns","body":"<p>can anybody help me in writing a trigger on a table ,\n the scenario is like this\ni have a table named person with columns col1 and col2 ,</p>\n\n<pre><code>Person\ncol1 |  col2\n0    |  1\n1    |  0\n2    |  3\n3    |  1\n4    |  2\n5    |  3\n</code></pre>\n\n<p>these columns col1,col2  values are dependent on another table employee columns col3 col4</p>\n\n<pre><code>Employee\ncol3 | col4\n0    | 1\n1    | 0\n2    | 1\n3    | 3\n4    | 0\n5    | 3\n6    | 1\n</code></pre>\n\n<p>now if combination of col1 and col2 values (eg 0,1 from person table exists in employee table then do not update the columns col1 and col2 in person table ,if col1 and col2 values are  2,3 value doesn't exists in employee table ,so in this case if there is any update on columns  col1 and col2  just print a message</p>\n"},{"tags":["sql-server-2008"],"answer_count":6,"favorite_count":4,"up_vote_count":35,"down_vote_count":0,"view_count":24457,"score":35,"question_id":2962927,"title":"A transport-level error has occurred when receiving results from the server","body":"<p>I'm getting a SQL Server error:</p>\n\n<blockquote>\n  <p>A transport-level error has occurred\n  when receiving results from the\n  server. (provider: Shared Memory\n  Provider, error: 0 - The handle is\n  invalid.)</p>\n</blockquote>\n\n<p>I'm running Sql Server 2008 SP1, Windows 2008 Standard 64 bit.</p>\n\n<p>It's a .net 4.0 web application. It happens when a request is made the server. It's intermittent. It happens every couple times. </p>\n\n<p>Any idea's?</p>\n"},{"tags":["performance","sql-server-2008","c#-4.0","table","entity-framework-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":32,"score":0,"question_id":13048907,"title":"Sql Server heavily queried Table - should I store secondary info (html text) in another table","body":"<p>The Overview:</p>\n\n<p>I have a table \"category\" that is for the most part used to categorise products and currently looks like this:</p>\n\n<pre><code>CREATE TABLE [dbo].[Category]\n( \nCategoryId int IDENTITY(1,1) NOT NULL, \nCategoryNode hierarchyid NOT NULL UNIQUE,\nCategoryString AS CategoryNode.ToString() PERSISTED,\nCategoryLevel AS CategoryNode.GetLevel() PERSISTED,\nCategoryTitle varchar(50) NOT NULL,\nIsActive bit NOT NULL DEFAULT 1\n)\n</code></pre>\n\n<p>This table is heavily queried to display the category hierarchy on a shopping website (typically every page view) and can have a substantial number of items.</p>\n\n<p>I'm using the Entity Framework in my data layer.</p>\n\n<p>The Question:</p>\n\n<p>I have a need to add what could potentially be a fairly large \"description\" which could come in the form of the entire contents of a web-page and I'm wondering whether I should store this in a related table rather than adding it to the existing category table given that the entity framework will drag the \"description\" column out of the database 100% of the time when 99.5% of the time I'll only want the CategoryTitle and CategoryId.</p>\n\n<p>Typically I wouldn't worry about the overhead of the Entity Framework, but in the case I think it might be important to take it into consideration. I could work around this with a view or a complex type from a stored proc, but this means a lot of refactoring that I'd prefer to avoid.</p>\n\n<p>I'm just interested to know if anyone has any thoughts, suggestions or a desire to slap my wrists in relation to this scenario...</p>\n\n<p>EDIT:</p>\n\n<p>I should add that the reason I'm hesitating to set up a secondary table is because I don't like the idea of adding an additional table that has a 1 to 1 relationship with the Category table - it seems somewhat pointless. But I'm also not a DBA so I'm not sure whether this is an acceptable practice or not.</p>\n"},{"tags":["sql-server","sql-server-2008","triggers","datatrigger"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":13049724,"title":"MS Sql Server Triggers (2) executing at the same time: How do I catch what's causing it?","body":"<p>So I have 2 triggers on a table in my dbase. It's purpose is to log any data manipulation activities done by the user or by a third party import/export. The table where it saves it to have a datestamp which obviously marks when it was executed. For some reason, when this third party SSIS package writes a record to it it would trigger the triggers (as expected) but will have the exact same time. 1 record for inserting the record, and another record for updating the record. The problem is the datestamp is exactly the same up to the millisecond.</p>\n\n<p>Any ideas on how I can track the cause of this? Should I be looking at the SSIS package? I dont think that would cause the 2 triggers tho.</p>\n\n<p>Thanks for your time!</p>\n"},{"tags":["sql","sql-server","sql-server-2008","database-tuning","sql-tuning"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":44,"score":2,"question_id":13049452,"title":"SQL Server audit logout creates huge number of reads","body":"<p>I'm using SQL Server Profiler to figure out what process are consuming SQL process and I found that the event class <code>Audit Logout</code> is causing a huge number of reads and consume cpu process.</p>\n\n<p>Is it normal? Or do I have something wrong in the SQL Server configuration?</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008","sql-execution-plan"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":47,"score":1,"question_id":13047903,"title":"SQL Server : delay before output (a print statement) is produced","body":"<p>I may have a slight feeling as to what is going on, but I thought I'd ask to get confirmation, and potentially look at an alternative.</p>\n\n<p>As a slight background, I've written a C# application that is providing a small front end to a stored procedure. The procedure contains a number of temporary table inserts from other stored procedures (and one table valued udf), and some xml processing.</p>\n\n<p>In order to get a sense of how far along I am in the stored procedure, I'm subscribing to the <code>InfoMessage</code> (using an <code>SqlInfoMessageEventHandler</code>) from an <code>SqlConnection</code>. I've put some informative print statements in various places throughout the SP, so I can get a sense of the processing which has completed and update a status bar accordingly).</p>\n\n<p>The rough structure of the SP is along these lines:</p>\n\n<pre><code>Print 'Beginning processing'\n\nCreate Temp Table\nInsert into Temp Table from Table Valued UDF\n\nPrint 'Creating working Tables'\nCreate more Temp Tables\nInsert into Temp Tables from SPs (each SP contains a print statement e.g 'Starting SP1').\n</code></pre>\n\n<p>All the messages are received and processed successfully, but there is a delay of a few seconds before any messages are returned from the server, then the first few arrive all at once (as though they were all processed but the output was held back for a while).</p>\n\n<p>I had naively assumed (I still have a lot to learn about DB mechanics) that my initial print statement would be returned before any of the other processing instructions within the SP took place.</p>\n\n<p>I assume that the server is doing something regarding fetching execution plans an/or potentially recalculating plans, or is it the case that query optimiser is doing some preprocessing before any results at all are returned?</p>\n\n<p>Hopefully my question is reasonably understandable from that mess of text. Essentially, would the query optimiser make the server perform some of the selects/inserts before the procedure actually begins sequentially encountering my print statements?</p>\n\n<p>I also tried doing some small temp table manipulation before my initial print statement, so some rows would be returned before the slow operations began but the result was much the same.</p>\n\n<p>Thanks for any responses.</p>\n"},{"tags":["python","perl","sql-server-2008","parsing"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":96,"score":1,"question_id":13037343,"title":"Best way to parse a file with columns that randomly change order before importing it into SQL Server 2008?","body":"<p>I have a file that has columns that look like this:</p>\n\n<pre><code>Column1,Column2,Column3,Column4,Column5,Column6\n1,2,3,4,5,6\n1,2,3,4,5,6\n1,2,3,4,5,6\n1,2,3,4,5,6\n1,2,3,4,5,6\n1,2,3,4,5,6\nColumn1,Column3,Column2,Column6,Column5,Column4\n1,3,2,6,5,4\n1,3,2,6,5,4\n1,3,2,6,5,4\nColumn2,Column3,Column4,Column5,Column6,Column1\n2,3,4,5,6,1\n2,3,4,5,6,1\n2,3,4,5,6,1\n</code></pre>\n\n<p>The columns randomly re-order in the middle of the file, and the only way to know the order is to look at the last set of headers right before the data (Column1,Column2, etc.)  (I've also simplified the data so that it's easier to picture.  In real life, there is no way to tell data apart as they are all large integer values that could really go into any column)</p>\n\n<p>Obviously this isn't very SQL Server friendly when it comes to using BULK INSERT, so I need to find a way to arrange all of the columns in a consistent order that matches my table's column order in my SQL database.  What's the best way to do this?  I've heard Python is the language to use, but I have never worked with it. Any suggestions/sample scripts in any language are appreciated.</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":31,"score":1,"question_id":13048141,"title":"Using WildCard for dateTime column in SQL query","body":"<p>I want to look for all records within a table that has date column for a specific date, at the moment I am trying this query,</p>\n\n<pre><code>SELECT     *\nFROM      Table_ABC\nWHERE     DateCreated CONTAINS 24/10/2012\n</code></pre>\n\n<p>But its not working</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13046619,"title":"Query to get list active queries in my SQL Server","body":"<p>I want to get a list of information of active queries that are running in my SQL Server (in order to kill a few of those queries).</p>\n\n<p>I want a query to get this required information:</p>\n\n<pre><code>| query_id (if possible) | query_text | query_start_time | time_elapsed | host_name | user_group | query_status |\n</code></pre>\n\n<p>I am new to SQL Server please suggest....</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":13047746,"title":"Changing column name in a SQL Server table with 1000+ records","body":"<p>I have a column and want to change its name but nothing else using query, what would be the best way of doing it.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12979367,"title":"Date data from Text file to date time in SQL Server","body":"<p>I am using one flat file as source which have couple of columns belong to Date format and I have placed all the data into the SQL Server table which predefined.</p>\n\n<p>Example:-</p>\n\n<p>Flat file</p>\n\n<pre>CaseNO|CaseType|CDate\n1     |ORG     |1\\12\\2012\n2     |PGD     |3\\3\\2011\n</pre>\n\n<p>here when I check it with data viewer, Its looks like 2012-12-1 00:00:00.0000000. but the OLE DB connection creates the following errors.</p>\n\n<pre><code>[OLE DB Destination [7546]] Error: There was an error with input column \n\"CDate\" (8799) on input \"OLE DB Destination Input\" (7559). The column status\nreturned was: \"The value could not be converted because of a potential loss of data.\".\n</code></pre>\n\n<p>Please guide me...Appreciated your help.</p>\n\n<p>343</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13047490,"title":"SQL Server Criteria not working when values are NULL","body":"<p>Is there a way to capture all values that are <code>FieldName &lt;&gt; 'Value'</code>, that will return records where FieldName is NULL, without saying <code>(FieldName &lt;&gt; 'Value' OR FieldName IS NULL</code>) for every criteria field?</p>\n"},{"tags":["c#","database","sql-server-2008","entity-framework","entity-relationship"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":13046375,"title":"Removing Parent with one-to-many EntityFramework","body":"<p>I have this class ( Simplified )</p>\n\n<pre><code>public class User {\n    public string Username { get; set; }\n    public virtual Section Section { get; set; }\n}\n\npublic class Section {\n    public int DepartmentNumber { get; set; }\n    public virtual ICollection&lt;User&gt; DepartmentMembers { get; set; }\n}\n</code></pre>\n\n<p>What i try to achive is to delete a section. All users related to this section shoulde get a null value. This dosent work now because REFERENCE constraint \"FK_Users_Sections_Section\".</p>\n\n<p>What woulde be the correct way to do this? woulde i have to remove all users from this section before deleteing it? Is there a more elegant way to do this? Im using EntityFramework.</p>\n\n<p>My fluent API for this field:</p>\n\n<pre><code>modelBuilder.Entity&lt;User&gt;()\n            .HasOptional(u =&gt; u.Section)\n            .WithMany(s =&gt; s.DepartmentMembers)\n            .Map(m =&gt;\n                m.MapKey(\"Section\")\n            )\n            .WillCascadeOnDelete(false);\n</code></pre>\n\n<p>The WillCascadeOnDelete i have tried it by setting to false, removing the line and also adding the line with no arguments. </p>\n\n<p>I guess the solution is quit simple but i cant find any good explaination ( or mabye i dont understand the explainations i have been looking at. )</p>\n"},{"tags":["sql-server","sql-server-2008","delphi","delphi-xe2","ado"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":138,"score":4,"question_id":13028162,"title":"How to insert a string containing #0 in a NVARCHAR() column in MSSQL?","body":"<p>I'm sure this has a very simple solution, but I've exhausted my resources. I need to insert a bunch of <code>WideString</code> variables which may contain <code>#0</code> into a <code>NVARCHAR(1024)</code> column in MSSQL2k8. <code>#0</code> is treated as the string terminator somewhere in the transition... So, when I store <code>#6'r'#0'abc'</code>, only <code>#6'r'</code> is stored. I'm using <code>TADOQuery</code>. What can I do about this?</p>\n\n<hr>\n\n<p>Here's the code I use:</p>\n\n<pre><code>var\n  S: string;\nbegin\n  S := #6'r'#0'abc';\n  ADOQuery1.Append;\n  ADOQuery1S.Value := S;\n  { At this point, S = #6'r'#0'abc' and ADOQuery1S.Value = #6'r';}\n  ADOQuery1.Post;\nend;\n</code></pre>\n"},{"tags":["c#","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":13046505,"title":"split column value of sql server in C#","body":"<p>There is a column \"AppendedData\" in \"Route\" table . It stores data in this format</p>\n\n<pre><code>-------------\nID |  AppendedData\n1  |  abc : xyz\n2  |  123a : gvk\n--------------\n</code></pre>\n\n<p>What I want is to write a search query over this \"AppendedData\" in where clause by spliting/substring it in two parts . The part before \":\" is to be used in matching the values.</p>\n\n<p>The current application that i am working is an old one so I can't go for writing an stored procedure . So what I am left is writing query in c# and executing it and returning a datable. So how can I do this in c#??</p>\n\n<p>I was trying this in sql server till now it is returning the second part ie, after \":\".</p>\n\n<p>my query:</p>\n\n<pre><code>select SUBSTRING(AppendedData,CHARINDEX(':',AppendedData)+1, 100) from  route\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":70,"score":1,"question_id":13036520,"title":"Why is cross apply making the query slow?","body":"<p>I have a query which is taking about 11 seconds to run for a single date. I want to run the same query for more multiple days. In other words, I want to be able to return snapshots for multiple days. Here is my original query:</p>\n\n<pre><code>SELECT \n    COUNT(*) AS 'Number of Cars',\n    d.ManufacturerName AS 'Make',\n    d.Name AS 'Model', \n    c.name AS 'Car Class'\nFROM CarRating a \n    INNER JOIN OwnedCar b ON a.OwnedCarID = b.OwnedCarID\n    INNER JOIN CarClass c ON a.CarClassID = c.CarClassID\n    INNER JOIN BaseCar d ON b.BaseCarID = d.BaseCarID\n\nWHERE \n    @myDate &lt; a.ExpiredWhen AND @myDate  &gt;= a.EffectiveWhen \nGROUP BY \n    d.Name, c.name,d.ManufacturerName\n</code></pre>\n\n<p>Like I mentioned the query about takes 11 sec. In order to run this query for multiple dates, I am using a date table and cross applying it to the above query:</p>\n\n<pre><code>SELECT [DATE], b.* FROM DimDate \nCROSS APPLY\n    (SELECT \n        COUNT(*) AS 'Number of Cars',\n        d.ManufacturerName AS 'Make',\n        d.Name AS 'Model', \n        c.name AS 'Car Class'\n    FROM CarRating a \n        INNER JOIN OwnedCar b ON a.OwnedCarID = b.OwnedCarID\n        INNER JOIN CarClass c ON a.CarClassID = c.CarClassID\n        INNER JOIN BaseCar d ON b.BaseCarID = d.BaseCarID\n\n    WHERE \n    dimDate.Date &lt; a.ExpiredWhen AND dimDate.Date &gt;= a.EffectiveWhen    \n    GROUP BY \n    d.Name, c.name,d.ManufacturerName) b\n\n WHERE DimDate.Date between @StartDate and @EndDate\n</code></pre>\n\n<p>This query takes 49 sec even for one day. Why is this slow? Is there a better way of doing this?</p>\n"},{"tags":["sql-server-2008","tsql","recursion"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2222,"score":1,"question_id":9004543,"title":"Recursive Child/Parent queries in T/SQL","body":"<p>I am using T/SQL in Microsoft SQL Server 2008</p>\n\n<p>I have a table</p>\n\n<pre><code>CREATE TABLE [TestTable](\n[CHILD] [int] NOT NULL,\n[PARENT] [int] NOT NULL\n) ON [PRIMARY]\n\nGO\n</code></pre>\n\n<p>These are some values which define a parent child hierarchial relationship</p>\n\n<pre><code>CHILD PARENT\n1       2\n2       0\n3       1\n4       2\n5       0\n</code></pre>\n\n<p>Visually, this table looks like this</p>\n\n<pre><code>0\n   2\n      1\n         3\n      4\n   5\n</code></pre>\n\n<p>I would ideally like the values to be shown as follows (where the right hand column indicates the generation)</p>\n\n<pre><code>CHILD    GENERATION\n 0          0\n 2          1\n 1          2\n 3          3\n 4          2\n 5          1\n</code></pre>\n\n<p>My T/SQL code looks like this</p>\n\n<pre><code>with n(CHILD, PARENT, GENERATION) as (\nselect CHILD, PARENT,1 as GENERATION from TestTable\nwhere PARENT=0 \nunion all\nselect nplus1.CHILD, nplus1.PARENT, GENERATION+1 from TestTable as nplus1, n\nwhere nplus1.PARENT=n.CHILD \n)\nselect CHILD,GENERATION from n\n</code></pre>\n\n<p>However it doesn't work!</p>\n\n<p>It returns</p>\n\n<pre><code>CHILD   GENERATION\n2        1\n5        1\n1        2\n4        2\n3        3\n</code></pre>\n\n<p>It has the right generation, but the wrong sort order!\nDoes anyone have any ideas how to solve this?</p>\n\n<p>Thank you!</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":13045069,"title":"What happens first: calculated persisted fields or ON INSERT TRIGGER updates","body":"<p>I have a table with persisted calculated fields.  It has a trigger that updates some fields based upon a number of fields including the persisted fields.</p>\n\n<p>Which is updated first, the persisted fields or the trigger'd update?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13043717,"title":"Determine value/column that caused constraint violation in TSQL?","body":"<pre><code>DECLARE @temp AS TABLE (id INT NOT NULL PRIMARY KEY CLUSTERED, name VARCHAR(10))\nBEGIN TRY\ndeclare @Source table (id int not null, name varchar(10))\ninsert @Source\n    SELECT 11,'ABC' union all\n    SELECT 12,'CDE' union all\n    SELECT 13,'FGH' union all\n    SELECT 11,'IJK'\n\nINSERT INTO @temp\nSELECT * from @Source\nSELECT * FROM @temp\n\nEND TRY\nBEGIN CATCH\n EXEC msdb.dbo.sp_send_dbmail\n @profile_name = 'Profile Name', \n @recipients = 'email@email.com', \n @body = Error_Message, \n @subject = Error_Message ; \nEND CATCH;\nGO\n</code></pre>\n\n<p>This is my code working fine .. But what i want to include in the mail is ID which is causing the error as a reminder to some email id in This case it is \"11\".\nHow i can do this in some smart way ..?</p>\n"},{"tags":["sql-server-2008","syntax","remedy"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13046368,"title":"SQL syntax in openquery - apostrophes inside query","body":"<p>I have the following issue, I trying to obtain data via linked server in sql server 2008  from BMC Remedy </p>\n\n<p>Everything is fine with connection, but when I added <em>WHERE\n \"Assigned Group\" LIKE <strong>'</em>*scri%</strong>'<em>*</em>, I get error in sql server because of apostrophes which I have to use because BMC Remedy demands it. </p>\n\n<p>Do you know how to create correct syntax or force sql server to use quotation marks instead of apostrophes, or disable spell checking</p>\n\n<pre><code>SELECT *\n\nFROM OPENQUERY(Remedy, \n\n**'**\n\nSELECT\n Incident_Number\n FROM\n HPD_Help_Desk\n WHERE\n \"Assigned Group\" LIKE ' scri% '\n\n **'**\n\n)\n</code></pre>\n"},{"tags":["asp.net","sql","sql-server-2008","windows-server-2008","windows-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13045974,"title":"2 applications use the same database","body":"<p>I have two ASP.net websites and each of them has a database.\nAll of them are in one server.\nOne table in both databases should have the same data (should be synchronized)</p>\n\n<p>I used some codes in both websites to insert, update or delete the records of the other Database and it worked fine on my own development studio (my own laptop) </p>\n\n<p>But when I uplaod them on windows server (2008 r2) insert and delete off the other website database doesn't work and when u log in one website u log out from the other website!! :(</p>\n\n<p>could u please help me? :p\nthanks soooo much</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13046020,"title":"How to add ten new columns to SQL table with 1000+ records in it without losing any single record","body":"<p>I am looking for query that I can use to add ten new boolean columns to existing table without effecting anything else in database. Also by default these boolean columns should be set to true as default.</p>\n\n<p>Looking for best practices.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>\"Also by default these boolean columns should be set to true as default.\"</p>\n\n<p>Sorry I meant to say that for records already exists new column should have value set as true, there shouldn't be any default value as I will set it myself.</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2008","oledb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12974119,"title":"SSL Connection to database","body":"<p>My application need to establish secure connection with SQL Server 2008. Having enabled 'Force Encryption' in server side, following is my connection string from my C# application.</p>\n\n<pre><code>Initial Catalog=emp_test;Persist Security Info=True;User ID=sa;Password=***;Data Source=172.21.70.94;Provider=SQLOLEDB;Use Encryption for Data=True;Trust Server Certificate=True;\n</code></pre>\n\n<p>I did not provision any certificate in server - Hence I gave Trust Server Certificate=True, so that self signed server certificate is not validated.</p>\n\n<p>But the connection is not established with following error. </p>\n\n<blockquote>\n  <p><em>Database error: [DBNETLIB][ConnectionOpen (SECDoClientHandshake()).]SSL Security error.</em></p>\n</blockquote>\n\n<p>Without the two attributes related to security, it works fine.</p>\n\n<p>What do I need to change to get this to work?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","database-administration"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":14,"score":0,"question_id":13045496,"title":"Unable to start SQL Server Instance 2008 R2 - DB file corrupt","body":"<p>I was not able to start the SQL Server 2008 R2 production DB instance. After reading the log file error message is</p>\n\n<p>\" The log scan number passed to log scan in database master is not valid. This error may indicate data corruption or that the log file (.ldf) does not match the data file (.mdf). If this error occurred during replication, re-create the publication.\"</p>\n\n<p>After reading several post i realize that my MASTER DB file is corrupted. I have followed the below setup</p>\n\n<pre><code>Copy the Master.mdf and Masterlog.ldf file from Template location to My Database Data folder.\n\nC:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\Binn\\Templates to D:\\MSSQL\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA\n</code></pre>\n\n<p>Note: Same error occur when i copy the all DB file like Master, MasterLog, MSDBData, MSDBlog, Model and ModelLog</p>\n\n<pre><code>When i run my MSSQLSEVER instance different problem occur.\n</code></pre>\n\n<p>In My server i had only C, D- Drive i dont have the E drive. How can i override these below error path.</p>\n\n<p>Error LOG</p>\n\n<pre><code>2012-10-24 02:51:12.79 spid5s Error: 17204, Severity: 16, State: 1.\n\n2012-10-24 02:51:12.79 spid5s FCB::Open failed: Could not open file e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBData.mdf for file number 1. OS error: 3(The system cannot find the path specified.).\n\n2012-10-24 02:51:12.79 spid5s Error: 5120, Severity: 16, State: 101.\n\n2012-10-24 02:51:12.79 spid5s Unable to open the physical file\n\n\"e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBData.mdf\". Operating system error 3: \"3(The system cannot find the path specified.)\".\n\n2012-10-24 02:51:12.79 spid5s Error: 17207, Severity: 16, State: 1.\n\n2012-10-24 02:51:12.79 spid5s FileMgr::StartLogFiles: Operating system error 2(The system cannot find the file specified.) occurred while creating or opening file 'e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBLog.ldf'. Diagnose and correct the operating system error, and retry the operation.\n\n2012-10-24 02:51:12.79 spid5s File activation failure. The physical file name \"e:\\sql10_main_t.obj.x86fre\\sql\\mkmastr\\databases\\objfre\\i386\\MSDBLog.ldf\" may be incorrect.\n</code></pre>\n"},{"tags":["sql-server-2008","tsql","datetime","date-range"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13044565,"title":"How to calculate Maximum incoming Call Peaks?","body":"<p>Here is part of database:</p>\n\n<pre><code>SessionID    SessionStartTime              SessionCloseTime\n24       2012-10-16 01:00:06.000           2012-10-16 01:01:22.000\n24       2012-10-16 01:00:08.000           2012-10-16 01:01:10.000\n24       2012-10-16 01:00:16.000           2012-10-16 01:01:12.000\n24       2012-10-16 01:00:30.000           2012-10-16 01:01:48.000\n24       2012-10-16 01:00:41.000           2012-10-16 01:02:08.000\n24       2012-10-16 01:00:48.000           2012-10-16 01:01:34.000\n24       2012-10-16 01:00:56.000           2012-10-16 01:03:09.000\n24       2012-10-16 01:01:02.000           2012-10-16 01:02:13.000\n24       2012-10-16 01:01:05.000           2012-10-16 01:03:16.000\n24       2012-10-16 01:01:09.000           2012-10-16 01:02:42.000\n24       2012-10-16 01:01:15.000           2012-10-16 01:02:48.000\n24       2012-10-16 01:01:18.000           2012-10-16 01:02:14.000\n24       2012-10-16 01:01:18.000           2012-10-16 01:02:06.000\n24       2012-10-16 01:01:42.000           2012-10-16 01:03:16.000\n24       2012-10-16 01:01:45.000           2012-10-16 01:03:04.000\n</code></pre>\n\n<p>In this db, I want to calculate max callpeaks. In other words, maximum how much calls are happened at the same time. I am working at a call center and I will generate a report with these records.  SessionID = 24 represents incoming calls. Any Suggestions,clues or calculation methods will be useful for me.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":9314,"score":2,"question_id":3922337,"title":"How to create composite primary key in SQL Server 2008","body":"<p>I am new to asp.net. I want to create tables in SQL Server 2008. Actually I don't know how to create composite primary key. Can anybody help me?</p>\n"},{"tags":["sql","sql-server-2008","c#-4.0","stored-procedures","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13044272,"title":"Need solution for transpose of table","body":"<p>I have a table named Sample which looks like.</p>\n\n<p><img src=\"http://i.stack.imgur.com/Hq7Ip.png\" alt=\"enter image description here\"></p>\n\n<p>I want the output as following <img src=\"http://i.stack.imgur.com/GtJn4.png\" alt=\"enter image description here\"></p>\n\n<p>for this I have built the following Query: </p>\n\n<pre><code>SELECT YEAR/MONTH, 1L,3L,4L,6L,8L\n    FROM (\n    SELECT PANEL, LAYERCOUNT, MONTHS\n    FROM Sample) up\n    PIVOT (SUM(Count) FOR CountOFL IN (1L,3L,4L,6L,8L)) AS pvt\n    ORDER BY YEAR/MONTH\n</code></pre>\n\n<p>But it gives error Incorrect syntax near '1'.</p>\n\n<p><img src=\"http://i.stack.imgur.com/GtJn4.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":72,"score":-3,"question_id":13042647,"title":"Stored procedure to format data from temp object and put in grid view","body":"<p>I am new to stored procedure. </p>\n\n<p>I would like to change the format of data that I get from stored procedure. For example, a column returns a string value of <code>20110918190154</code>, I would like to change it to <code>2011/09/18 19:01:54</code>. </p>\n\n<p>This is how I execute the stored procedure and return a <code>DataTable</code>:   </p>\n\n<pre><code>   storedProcCommand = new SqlCommand(\"GetPurchaseHistory\", conn);\n   storedProcCommand.CommandType = CommandType.StoredProcedure;\n   storedProcCommand.Parameters.Add(\"@customerID\", cCustomerID);\n   adapter = new SqlDataAdapter(storedProcCommand);\n   adapter.Fill(allData);\n</code></pre>\n\n<p>Show the data in GridView as below:</p>\n\n<pre><code>   &lt;asp:GridView ID=\"GridView_PurchaseHistory\" runat=\"server\" AutoGenerateColumns=\"False\" &gt;\n   &lt;Columns&gt;    \n   &lt;asp:BoundField DataField=\"cTranDateTime\" HeaderText=\"Latest Purchase Date\" /&gt;\n   &lt;asp:BoundField DataField=\"cItemNo\" HeaderText=\"Item Number\" /&gt;\n   &lt;asp:BoundField DataField=\"cDescDef\" HeaderText=\"Description\" /&gt;\n   &lt;asp:BoundField DataField=\"fQty\" HeaderText=\"Total Quantity\" /&gt;\n   &lt;/Columns&gt; \n   &lt;/asp:GridView&gt;\n</code></pre>\n\n<p>The output would be like:</p>\n\n<pre><code>Latest Purchase Date\n20121007193111\n20120130171010\n20110918190154\n</code></pre>\n\n<p>I have written the code to substring and change the format which takes in 1 string as a time. I would like to know if there is anyway I can store the Date in a temp object and change its format accordingly.. Or if I could change before displaying it. </p>\n\n<p>Thank you so much.. Any advice is appreciated. </p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":5,"favorite_count":2,"up_vote_count":20,"down_vote_count":0,"view_count":12880,"score":20,"question_id":975286,"title":"SqlServer is in script upgrade mode","body":"<p>Vista just finished one of its many updates. After restarting my computer I try connecting to SqlServer2008 instance with Sql Server Management Studio and I get this error:</p>\n\n<p>Error connecting to '...\\MSSQLSERVER2008'.\nAdditional information:\nLogin failed for user '...'. Reason: Server is in script upgrade mode. Only administrator can connect at this time. (Microsoft SQL Server, Error: 18401).</p>\n\n<p>Pressing help gets me to an internet page saying there's no additional information.</p>\n\n<p>Thx Vista &amp; Updates. Anyone an idea because on the internet I can't find anything about this issue.</p>\n"},{"tags":["sql-server-2008","stored-procedures","where-clause"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13041972,"title":"Conditional WHERE clause","body":"<p>Question is simple - I believe answer may be simple too.</p>\n\n<p>System is SQL Server 2008 R2.</p>\n\n<p>There  is a stored procedure <code>sp_WHYWHYWHY</code> which takes 3 parameters - 2 are dates and one is supplier code.</p>\n\n<p>The <code>WHERE</code> clause in the statement looks something like this:</p>\n\n<pre><code>OrderDate BETWEEN @StartDate AND @EndDate\nAND SupplierCode = @SupplierCode\n</code></pre>\n\n<p>The business process has changed - as it always will. So now in the supplier code there is only one supplier (let's say <code>YY</code>)who is now aligned, business-wise, to another supplier (let's say <code>ABC</code>).</p>\n\n<p>Hence the code needs to say when querying for <code>ABC</code> - include <code>YY</code> as well.</p>\n\n<p>Something like</p>\n\n<pre><code>OrderDate BETWEEN @StartDate AND @EndDate\nAND SupplierCode = CASE WHEN @SupplierCode = 'ABC' THEN 'YY','ABC' ELSE @SupplierCode END\n</code></pre>\n\n<p>I know you can't write this like that - but that's just what the end result should be.</p>\n\n<p>How can I do this, really?</p>\n\n<p>Thanks for taking out time to read &amp; answer.</p>\n"},{"tags":["c#","sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":80,"score":2,"question_id":13043002,"title":"How to sort varchar type column that contain both string and numeric values","body":"<p>I have a table that has column name \"BatchNo\" and it contain both string and numeric values together. when i typed a select query i got following results.</p>\n\n<p><img src=\"http://i.stack.imgur.com/VRWHf.jpg\" alt=\"enter image description here\"></p>\n\n<p>i want to sort \"BatchNo\" column in following format</p>\n\n<p><img src=\"http://i.stack.imgur.com/f5Zwo.jpg\" alt=\"enter image description here\"></p>\n\n<p>In my problem future batches may be have a,b,c .... letters with numeric values or only numeric values. how can i sort this column ? Hope you guys can help me to get some solution.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":798,"score":2,"question_id":4052976,"title":"sql-server-2008: how do i sort the results of a procedure?","body":"<p>i am running:</p>\n\n<pre><code>exec sp_who \ngo\n</code></pre>\n\n<p>is it possible for me to sort by a field like:</p>\n\n<pre><code>exec sp_who order by dbname\ngo\n</code></pre>\n\n<p>?</p>\n\n<p>i would i accomplish this?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":178,"score":2,"question_id":11985328,"title":"Prevent the insertion of duplicate rows using SQL Server 2008","body":"<p>I am trying to insert some data from one table into another but I would like to prevent the insertion of duplicate rows.  I have currently the following query:</p>\n\n<pre><code>INSERT INTO Table1\n(\n    Table1Col1,\n    Table1Col2,\n    Table1Col3,\n    Table1Col4,\n    Table1Col5\n)\nSELECT\n    Table2Col1,\n    Table2Col2 = constant1,\n    Table2Col3 = constant2,\n    Table2Col4 = constant3,\n    Table2Col5 = constant4\nFROM Table2\nWHERE\n    Condition1 = constant5\nAND\n    Condition2 = constant6\nAND\n    Condition3 = constant7\nAND\n    Condition4 LIKE '%constant8%'\n</code></pre>\n\n<p>What I do not know is that the row I am trying to insert from Table2 into Table1 might already exist and I would like to prevent this possible duplication from happening and skip the insertion and just move onto inserting the next unique row.  </p>\n\n<p>I have seen that I can use a WHERE NOT EXISTS clause and use of the INTERSECT keyword but I did not fully understand how to apply it to my particular query as I only want to use some of the selected data from Table2 and then some constant values to insert into Table1.</p>\n\n<p>EDIT:</p>\n\n<p>I should add that the columns TableCol2 through to TableCol5 don't actually exist in the result set and I am just populating these columns alongside Table2Col1 that is returned.</p>\n"},{"tags":["sql-server-2008","sql-server-2008-r2","restore","database-backups"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":423,"score":1,"question_id":11877102,"title":"Can we restore database backup of SQL Server 2008 R2 Express to SQL Server 2008 Express ","body":"<p>I have a database backup in \"SQL Server 2008 R2\", Can i store this database backup in \"SQL 2008 Express\" ?</p>\n\n<p>Anyone who have knowledge about SQL-2008 kindly share to me.</p>\n"},{"tags":["visual-studio","sql-server-2008","tfs","tfs2010"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13041672,"title":"thinking of migrating to tfs 2012","body":"<p>I am using tfs 2010 /sql server 2008 r2 with vs.net 2010 at the moment. Thinking of upgrading tfs to 2012. Has anyone tried this? is this relatively easy? Should I upgrade to vs.net 2012 too? does it still work with sql server 2008 r2?</p>\n"},{"tags":["php","sql","sql-server-2008","php-5.4"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":13041623,"title":"PHP MSSQL 2008R2 Help employee attendance faster code needed","body":"<p>i have a Employee database and it has a MSSQL server 2008 R2 and PHP 5.4 on iis7.5 the system all works ok but i have had a request to add and employee attendance system witch i have done but i dont like the code i have used and it is very slow we have 350+ employees current employees on the attendance and it slow to load </p>\n\n<p>This code finds the days in the month selected by default is the current month</p>\n\n<p>Then will get the employees from the database and for each employee it will query the database for each day in the month WITH SQL WHERE PRN = $PRN AND '$date' BETWEEN Sdate AND Edate ORDER BY id DESC</p>\n\n<p>if there is no match it will return NULL</p>\n\n<p>if it finds a record that matches the PRN and day is BETWEEN the start and end dates it will return the leave record found </p>\n\n<p>In the database table attendance leave is set with Pay Roll Number (PRN ) start date ( Sdate ) and End date ( Edate ) </p>\n\n<p>so the code below is what i have written and it is what i am using but i would like it if anyone knows how i could do this better or more efficient also page load time are becoming a problem</p>\n\n<pre><code>$de= date(\"d\");\n    $m= date('m');\n    $y= date('y');\n    if($year) {\n        $m= date('m',mktime(0,0,0,$month,1,$year));\n        $y= date('y',mktime(0,0,0,$month,1,$year));\n    }\n        $start_day = 1;\n        $num = cal_days_in_month(CAL_GREGORIAN, $m, $y);\n\n    for($i=0; $i&lt;$num; $i++){\n    echo '&lt;th class=\"attdate\" scope=\"col\" abbr=\"\"&gt;'.date('d/m',mktime(0,0,0,$m,($start_day+$i),$y)).'&lt;/th&gt;';\n    }\n    echo ' &lt;/tr&gt;';\n    $index=0;\n    foreach ( $search_result as $display_recent_result ) {\n    $prn = $display_recent_result-&gt;PRN;     \n    $index++;\n    echo '&lt;tr&gt;';\n\n    for($i=0; $i&lt;$num; $i++) {      \n    $date = date('Y-m-d',mktime(0,0,0,$m,($start_day+$i),$y));  \n    $state = attendance::find_by_PRN($prn, $date);      \n        if($state) {\n            $cat = attendance_category::find_by_id($state-&gt;CategoryID);\n            echo \"&lt;td height=\\\"32\\\" headers=\\\"$state-&gt;id\\\" class=\\\"$cat-&gt;Code\\\"&gt;\".$cat-&gt;Code.\"&lt;/td&gt;\";\n        } else {\n            echo \"&lt;td&gt;&amp;nbsp;&lt;/td&gt;\";\n        }       \n    }       \n    echo '&lt;/tr&gt;';\n    } \n    echo \"&lt;/table&gt;\";\n</code></pre>\n\n<p>This is the query Function </p>\n\n<pre><code>    public static function find_by_PRN($PRN, $date) {\n    $result_array = self::query(\"SELECT TOP 1 id, CategoryID FROM \".static::$table_name.\" WHERE PRN = $PRN AND '$date' BETWEEN Sdate AND Edate ORDER BY id DESC\");\n    return !empty($result_array) ? array_shift($result_array) : false;\n}\n</code></pre>\n\n<p>This is the Employees query </p>\n\n<pre><code>public static function display_attendance ( $sort=NULL ) {      \n    if($sort==999){ $sortsql=NULL;  }elseif($sort&gt;0){ $sortsql = 'AND AreaPosition = '. \"'$sort'\"; } else {$sortsql =NULL; }        \n    //$sql =\"SELECT * FROM \" . self::$table_name . \" WHERE Attendance = 1 AND CurrentEmployee = 1 $sortsql ORDER BY SURNAME \";\n\n                $sql=\"(SELECT PRN, NAME, SURNAME, Photo FROM \". self::$table_name .\" WHERE Attendance = 1 AND CurrentEmployee = 1 $sortsql )\n                        UNION\n                    (SELECT PRN, NAME, SURNAME, Photo FROM \". self::$table_name2 .\" WHERE Attendance = 1 AND CurrentEmployee = 1 $sortsql )\n                    ORDER BY SURNAME\";\n\n    return self::find_by_sql($sql);\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":13033645,"title":"Archiving Large Table (SQL Server 2008)","body":"<p>I have a very large table being filled with about 100s of million records each quarter.</p>\n\n<p>I manually move data from the existing table to another database using <a href=\"http://sqlserverperformance.wordpress.com/2011/08/13/gradually-deleting-data-in-sql-server/\" rel=\"nofollow\">this script</a>, to minimize the backup size, and to off load the production database when performing queries.</p>\n\n<p>Is there any better way, for example, some scheduled script that will move data from the production database to some other database and then delete the records from the source database every day or week efficiently? </p>\n\n<p>Note that my log file is growing rapidly due to the high number of INSERTs into this table, also when I move data to the archive database, DELETEs will be logged.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","database-restore"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":13039345,"title":"SQL Server 2008 R2: Restore a single filegroup","body":"<p>Not sure if this is a duplicate of <a href=\"http://stackoverflow.com/questions/2951016/sql-server-2005-partial-filegroup-restore-on-qa-database\">SQL Server 2005: Partial Filegroup restore on QA database</a>, but if so then I apologise (even though it was not answered).</p>\n\n<p>I have a database on SQL2008R2 with multiple (3) filegroups. There are production and development copies of this database on separate servers.</p>\n\n<p>I have created a filegroup backup of the PRIMARY filegroup from production and wish to restore it on the development server. I do not want to try and backup/restore the entire database as one of the filegroups contains nearly 1TB of data and the servers are geographically distant.</p>\n\n<p>I have tried restoring the filegroup backup using \"with partial, recovery\" and I now have access to the data in that filegroup, but I have lost access to the data in the other filegroups (I am testing this on a 3rd server for now so I have not really lost anything as such).</p>\n\n<p>I am not even sure that what I am trying to do is possible (and it is starting to look as if it is not), can anybody shed any light on what else I might to to acheive my goal.</p>\n\n<p>Thanks.</p>\n"},{"tags":["java","sql-server-2008","jdbc"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":938,"score":0,"question_id":10928982,"title":"JDBC driver class not supported with sql server 2008","body":"<p>in my java code JDBC driver class is not supported with ms sql server 2008 while it works perfectly with ms sql server 2005</p>\n\n<p>i have put jdbc driver class  \"com.microsoft.sqlserver.jdbc.SQLServerDriver\" </p>\n\n<p>MY CODE IS</p>\n\n<pre><code>import java.sql.*;\n\n  public class MysqlConnect{\n  public static void main(String[] args) {\n  System.out.println(\"MySQL Connect Example.\");\n  Connection conn = null;\n  String url = \"jdbc:sqlserver://SQLSERVERIP:1433;\";\n  String dbName = \"DatabaseName=DBNAME\";\n  String driver = \"com.microsoft.sqlserver.jdbc.SQLServerDriver\";\n  String userName = \"sa\"; \n  String password = \"password\";\n  try {\n  Class.forName(driver).newInstance();\n  conn = DriverManager.getConnection(url+dbName,userName,password);\n  System.out.println(\"Connected to the database\");\n  conn.close();\n  System.out.println(\"Disconnected from database\");\n  } catch (Exception e) {\n  e.printStackTrace();\n  }\n }\n}    \n</code></pre>\n\n<p>while i am trying to connect it gives an error</p>\n\n<pre><code>com.microsoft.sqlserver.jdbc.SQLServerException: Cannot open database \"hj_cnb_ci\n\" requested by the login. The login failed.\n        at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError\n(SQLServerException.java:197)\n        at com.microsoft.sqlserver.jdbc.TDSTokenHandler.onEOF(tdsparser.java:246\n)\n        at com.microsoft.sqlserver.jdbc.TDSParser.parse(tdsparser.java:83)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.sendLogon(SQLServerC\nonnection.java:2529)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.logon(SQLServerConne\nction.java:1905)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.access$000(SQLServer\nConnection.java:41)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection$LogonCommand.doExecu\nte(SQLServerConnection.java:1893)\n        at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:4615)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLSe\nrverConnection.java:1400)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.connectHelper(SQLSer\nverConnection.java:1045)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.login(SQLServerConne\nction.java:817)\n        at com.microsoft.sqlserver.jdbc.SQLServerConnection.connect(SQLServerCon\nnection.java:700)\n        at com.microsoft.sqlserver.jdbc.SQLServerDriver.connect(SQLServerDriver.\njava:842)\n        at java.sql.DriverManager.getConnection(Unknown Source)\n        at java.sql.DriverManager.getConnection(Unknown Source)\n        at MysqlConnect.main(MysqlConnect.java:14)\n</code></pre>\n\n<p>plz help me to sort out this issue..</p>\n"},{"tags":["sql-server-2005","sql-server-2008","database-backups","downgrade"],"answer_count":4,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":15964,"score":4,"question_id":849678,"title":"Downgrading SQL server 2008 to SQL Server 2005","body":"<p>Are there any issues backing up a database from SQL Server 2008, and then importing it into SQL Server 2005? I had upgraded to SQL Server 2008, but 2008 seems to be too problematic so now I want to downgrade. Are there any problems in doing this?</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","sql-server-2008-r2","sql-server-2000"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":13038964,"title":"SQL Server - Select between two number ranges in a varchar field with text and numbers","body":"<p>I have a table with ranges of numbers from 0-2000000. I can use a between statement to get the records of things if I do a BETWEEN 50 AND 100. That works. </p>\n\n<p>But the problem I'm running into is since this column is a varchar if there are any records with a something in the string as \"1FD32\", I can't select between it. SQL server can't convert the \"BETWEEN 50 AND 100\" because it is looking for an int. How can i get all the records between these ranges, and ignore any with letters in them?</p>\n"},{"tags":["sql-server","vb.net","sql-server-2008","query"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":55,"score":1,"question_id":13038389,"title":"Proper way to execute a large SQL query in vb.net","body":"<p>I have a SQL query that I used my vb.net application to run it, but i have a problem when It exceeds to its command timeout property. I set it to 300, any tips or suggestions?</p>\n\n<p>here is the snippet of my code in vb.net</p>\n\n<pre><code>  .ExecuteQuery(\"exec spCentrIX_PracticeSet '\" &amp; oCompany &amp; \"','\" &amp; .SecDatabaseName &amp; \"'\", sDataSet)\n  Application.DoEvents()\n  .ExecuteQuery(\"exec spCentrIX_PracticeSet '\" &amp; oCompany &amp; \"','\" &amp; .SetDatabaseName &amp; \"'\", sDataSet)\n  Application.DoEvents()\n  .ExecuteQuery(\"exec spCentrIX_PracticeSet '\" &amp; oCompany &amp; \"','\" &amp; .TranDatabaseName &amp; \"'\", sDataSet)\n  Application.DoEvents()\n</code></pre>\n\n<p>same script that run three times. this script gets all the data from the 3 databases which runs okie. however, when it is running...it exceeds the connection timeout of my code.</p>\n"},{"tags":["sql-server-2008","spatial","simple.data"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":13035158,"title":"Passing SqlGeometry To Simple.Data Stored Procedure","body":"<p>I am trying to pass a SqlGeometry type to a stored procedure using Simple.Data and SQL Server 2008.  The stored procedure definition looks like this:</p>\n\n<pre><code>CREATE PROCEDURE [dbo].[spUpdateDamLocation]\n(\n  @DamID int,\n  @Shape geometry\n)\n</code></pre>\n\n<p>The call I am using for Simple.Data looks like this:</p>\n\n<pre><code>var db = Simple.Data.Database.OpenConnection(dbConn);\ndb.spUpdateDamLocation(DamID: damLocation.DamID, Shape: damLocation.Shape);\n</code></pre>\n\n<p>Where <em>dbConn</em> is a connection string, <em>damLocation.DamID</em> is an integer and <em>damLocation.Shape</em> is a SqlGeometry object. </p>\n\n<p>The error I am getting is:</p>\n\n<pre><code>System.ArgumentException: UdtTypeName property must be set for UDT parameters.\nat System.Data.SqlClient.SqlParameter.Validate(Int32 index, Boolean isCommandProc)\nat System.Data.SqlClient.SqlCommand.SetUpRPCParameters(_SqlRPC rpc, Int32 startCount,     Boolean inSchema, SqlParameterCollection parameters)\nat System.Data.SqlClient.SqlCommand.BuildRPC(Boolean inSchema, SqlParameterCollection parameters, _SqlRPC&amp; rpc)\nat System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\nat System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\nat System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\nat System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\nat System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\nat System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader()\nat Simple.Data.Ado.DbCommandExtensions.TryExecuteReader(IDbCommand command)\nat Simple.Data.Ado.ProcedureExecutor.ExecuteReader(IDbCommand command)\nat Simple.Data.Ado.ProcedureExecutor.Execute(IDictionary`2 suppliedParameters, IDbTransaction transaction)\nat Simple.Data.Ado.ProcedureExecutor.Execute(IDictionary`2 suppliedParameters)\nat Simple.Data.Ado.AdoAdapter.Execute(String functionName, IDictionary`2 parameters)\nat Simple.Data.Database.ExecuteFunction(Object&amp; result, ExecuteFunctionCommand command)\nat Simple.Data.DataStrategy.TryInvokeFunction(String functionName, Func`1 getFunctionArguments, Object&amp; result)\nat Simple.Data.DataStrategy.TryInvokeMember(InvokeMemberBinder binder, Object[] args, Object&amp; result)\nat CallSite.Target(Closure , CallSite , Object , Int32 , SqlGeometry )\nat System.Dynamic.UpdateDelegates.UpdateAndExecuteVoid3[T0,T1,T2](CallSite site, T0 arg0, T1 arg1, T2 arg2)\n</code></pre>\n\n<p>Is there a way to specify a specific UDT of the parameter in Simple.Data?  If I were just using ADO.NET I would do something like this:</p>\n\n<pre><code>SqlParameter sqlParam = sqlCmd.Parameters.Add(\"@Shape\", SqlDbType.UDT);\nsqlParam.UdtTypeName = \"geometry\";\nsqlParam.Value = myTypeOfSqlGeometry;\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2008-r2","sql-management-studio"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":13037863,"title":"Clarification as to why EXECUTE AS USER/LOGIN is not returning the expected results?","body":"<p>I am running the following query against a database:</p>\n\n<pre><code>execute as user = 'domain\\username'\nselect * from fn_my_permissions(null, 'DATABASE')\norder by subentity_name, permission_name\nrevert;\n</code></pre>\n\n<p>But the following error gets thrown:</p>\n\n<p><code>Cannot execute as the database principal because the principal \"dev\\spadmin\" does not exist, this type of principal cannot be impersonated, or you do not have permission.</code></p>\n\n<p>The user is the dbo of the database, and when I open up the properties in management studio, I can see that it is associated with that login.  Running <code>EXECUTE AS LOGIN = 'domain\\username'</code> does return results, on the other hand.  And if I explicitly run <code>EXECUTE AS USER = 'dbo'</code>, I get results.  I also have a different database where this same scenario returns results with both <code>EXECUTE AS USER</code> and <code>EXECUTE AS LOGIN</code>.</p>\n\n<p>In another scenario with a different user, I have ran <code>EXECUTE AS LOGIN = 'domain\\username'</code> and I do not get results, but I do get results with <code>EXECUTE AS USER = 'domain\\username'</code>.</p>\n\n<p>Both users in these scenarios are associated with logins that are members of <code>db_owner</code> for the database.</p>\n\n<p>Can anybody tell me why these queries are not returning the results that I expect?  And let me know if I am missing any important information.  Thanks!</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":13037205,"title":"SQL to List Common Values of One Column Based on an Input List of Values From Another?","body":"<p>We have an ASP.NET application with SQL Server 2008 back end.\nWe have the following setup in our SpecimenEvents table:</p>\n\n<pre>EventID SpecimenID  EventType\n      1        101        A       \n      2        102        A\n      3        103        A\n      4        101        B\n      5        103        B\n      6        101        C</pre>\n\n<p>Given a list of SpecimenIDs as input -- how would you write a query to return just those EventType(s) COMMON to all SpecimenIDs in the input list?\nFor example: </p>\n\n<p>a SpecimenID input list of (101,102,103) should return 'A'</p>\n\n<p>a SpecimenID input list of (101) should return 'A','B','C'</p>\n\n<p>a SpecimenID input list of (101,103) should return 'A', 'B' ...</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13036717,"title":"multiple keyword search in sql","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/2474229/keyword-to-sql-search\">Keyword to SQL search</a>  </p>\n</blockquote>\n\n\n\n<p>I am using SQL SERVER 2008 &amp; I am given to task to search for specific keywords( close to 100) relating to technical support notes. There are 20 columns and 1 million rows. The keywords I am looking is in 3 specific columns. How can I do it?</p>\n\n<p>Column header : date, week, Qtr, Agent, Manager, Customer,Problem, Description, Solution,Order #, </p>\n\n<p>I have to search for the keywords from Problem, Description, Solution columns. \nProblem : nvarchar\nDescription: nvarchar \nSolution : ntext </p>\n\n<p>Keywords : bluetooth, cd, dvd, hard drive, motherboard, power supply, battery, ac adapter, windows, blue screen. </p>\n\n<p>Sample data:\nProblem :noise from fan Description : noise from fan Solution: noise from fan and system heating up. has A20 BIOS. checked support site and BIOS update available. customer to try that and get back to us with results</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":32,"score":3,"question_id":13036917,"title":"SQL Server Views - Index Usage","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/8700126/index-is-not-getting-applied-on-indexed-view\">Index is not getting applied on Indexed View</a>  </p>\n</blockquote>\n\n\n\n<p>Is there a way to make the views to use only the index that I created on them, and not the ones on the base tables?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13036733,"title":"How to insert muliple rows to an existing table","body":"<p>Hi i am trying to insert 10000 records in to a table, by using this command. </p>\n\n<pre><code>CREATE TABLE mytable(\n    id            INTEGER      PRIMARY KEY,\n    TEXT          INTEGER       NOT NULL,\n    OLDID         iNTEGER       NOT NULL,\n    Firstname      VARCHAR(50)  NOT NULL,\n    Middlename    VARCHAR(50)   NULL,\n    last_name     VARCHAR(75)   NOT NULL,\n    EMAIL         VARCHAR(225)  NOT NULL,\n    STATUS        BOOL          NOT NULL\n);\n\nDECLARE @i int\ndeclare @rows_to_insert int\nSET @i = 6\nset @rows_to_insert = 10000\n\nWHILE @i &lt; @rows_to_insert\n    BEGIN\n        INSERT INTO mytable VALUES (@i, @i,@i,'john'+@i,null,'Test','john'+@i+'@someone.com','Active');\n        set @i = @i+1\n    END\n</code></pre>\n\n<p>But i am getting this Error.</p>\n\n<blockquote>\n  <p>Msg 8101, Level 16, State 1, Line 8\n  An explicit value for the identity column in table 'mytable' can only be specified when a column list is used and IDENTITY_INSERT is ON.</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":86,"score":2,"question_id":13034007,"title":"SQL split a result properly","body":"<p>I have a result from a request that gives me thousands of lines, and i want to split it into little temporary tables of 10k rows each, with an incremental number from 1 up to 10 000. Lets say i have a big query of 25 000 rows, what i want is to split it in 2 tables of 10k and a third table of 5k. Of course I dont know that exact number of pages i will have to split into.</p>\n\n<blockquote>\n  <p>My first query with all the rows is named [#DECLARATION] and have a number NumeroDeclaration that is 0 for page 1, 1 for page 2, etc. to 9. Each 10 000 of rows it is incremented from 0 to 10 000.</p>\n</blockquote>\n\n<p>at this time my request looks like this:</p>\n\n<pre><code>    --Page 1\n    SELECT * INTO [#PAGE1] FROM [#DECLARATION] WHERE NumeroDeclaration =0 ORDER BY NumeroTransaction;\n        --Numerotation\n        WITH upd AS (SELECT NumeroDeclaration, ROW_NUMBER() OVER (ORDER BY NumeroTransaction) AS Numtemp FROM [#PAGE1])\n        UPDATE upd SET NumeroDeclaration = Numtemp\n    --Page 2\n    SELECT * INTO [#PAGE2] FROM [#DECLARATION] WHERE NumeroDeclaration =1 ORDER BY NumeroTransaction;\n        --Numerotation\n        WITH upd AS (SELECT NumeroDeclaration, ROW_NUMBER() OVER (ORDER BY NumeroTransaction) AS Numtemp FROM [#PAGE2])\n        UPDATE upd SET NumeroDeclaration = Numtemp\n    --Page 3\n    --etc.... to Page 10...\n</code></pre>\n\n<p><strong>I have to do this over 10 pages, and it works, but is there another <em>shorter</em>/classier way to do it?</strong></p>\n\n<p>Im using SQL SERVER 2008 Thanks for reading</p>\n"},{"tags":["sql-server-2008","stored-procedures","linked-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13017428,"title":"inserting to a local table from a linked stored procedure","body":"<p>I have a sproc that is called from .net code which does an update on a local table and then is supposed to insert to a different local table values that are obtained from a remote procedure call to a linked server.</p>\n\n<p>I get this error message every time I try to insert the results from the linked server.  If i take out the insert into statement, but leave the remote procedure call in place, it works fine.  Here is the error:</p>\n\n<blockquote>\n  <p>System.Data.SqlClient.SqlException: The operation could not be\n  performed because OLE DB provider \"SQLNCLI10\" for linked server\n  \"MyLinkedServer\" was unable to begin a distributed transaction. OLE DB\n  provider \"SQLNCLI10\" for linked server \"MyLinkedServer\" returned\n  message \"The transaction manager has disabled its support for\n  remote/network transactions.\".</p>\n</blockquote>\n\n<p>this is the simple code I'm using:</p>\n\n<pre><code>INSERT INTO MyLocalTable\nEXEC [MyLinkedServer].[MyRemoteDatabase].[dbo].[usp_MySproc] @MyParam\n</code></pre>\n\n<p>any ideas what's wrong here or any suggestions of how I can insert the results from the remote procedure to a local table?</p>\n"},{"tags":["sql-server-2008","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":13035250,"title":"SET TRANSACTION ISOLATION LEVEL Scope on stored procedure","body":"<p>I am creating a stored procedure and I do not want any locking through out the script. I am sure that I need to state \"SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\" in the beginning of the script. But I am not sure how to start after the statement. One of the example from Microsoft show that start with \"BEGIN TRANSACTION\" and end with \"END TRANSACTION\". There is someone who starts without any  BEGIN and END statement after \"SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\". Please, suggest me for the right way of using \"SET TRANSACTION ISOLATION LEVEL\" statement to achieve my goal.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/aa259216(v=sql.80).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/aa259216(v=sql.80).aspx</a></p>\n\n<pre><code>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\nGO\nBEGIN TRANSACTION\nSELECT * FROM publishers\nSELECT * FROM authors\n...\nCOMMIT TRANSACTION\n</code></pre>\n\n<p><a href=\"http://stackoverflow.com/questions/7975936/sql-server-how-to-set-default-isolation-level-for-the-entire-stored-procedure\">SQL Server: how to set default isolation level for the entire stored procedure?</a></p>\n\n<pre><code>BEGIN\nSET TRANSACTION ISOLATION LEVEL READ COMMITTED\n -- will a transaction level for a atomic transaction created by SQL Server for this statement be READ COMMITTED \nSELECT * FROM T\nEND\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":13034596,"title":"sql insert using charindex","body":"<p>I am using SQL Server 2008</p>\n\n<p>I have this INSERT statement</p>\n\n<pre><code>INSERT INTO [dbo].[TempSequences]\n(Title, Sequence, FileTrackingTag)\nSELECT Title, Sequence, FileTrackingTag\nFROM   [dbo].[MasterSequence]\nWHERE  charindex(',' + FileTrackingTag + ',', ',' + @filetag + ',') &gt; 0;\n</code></pre>\n\n<p>Where FileTrackingTag is the one associated with said title and sequence.  However I am giving it a string of these tags</p>\n\n<p>i.e.</p>\n\n<pre><code> 'tag1,tag2,tag3,tag4'\n</code></pre>\n\n<p>How can I put the correct tag in there?  Thanks</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":13034584,"title":"PATINDEX and CHARINDEX returning different answers SQL Server 2008","body":"<p>I have a single table for which I wish to find all the instances where <code>0</code> is the <strong>last</strong> character in a string field.  I tried this by using two methods and they each returned different results.  </p>\n\n<p>This first query seemed to actually return the correct answer</p>\n\n<pre><code>select * from icd\n    where CHARINDEX('0',icd,LEN(icd)) =LEN(icd) \n</code></pre>\n\n<p>this one does not catch all of the answers</p>\n\n<pre><code>select * from icd\n    where PATINDEX('%0%',icd) = LEN(icd)\n</code></pre>\n\n<p>using </p>\n\n<pre><code>select t.ICD as theCharIndex,x.ICD as thePatIndex from\n(\n\nselect * from icd\n    where CHARINDEX('0',icd,LEN(icd)) =LEN(icd) \n) t\nleft join\n(\nselect * from icd\n    where PATINDEX('%0%',icd) = LEN(icd)\n) x on x.ICD=t.ICD\nwhere x.ICD is null\n</code></pre>\n\n<p>I found the set of data that <code>CHARINDEX</code> picked up that <code>PATINDEX</code> did not. I even did</p>\n\n<pre><code>update icd\nset ICD=RTRIM(icd)\n</code></pre>\n\n<p>Why would <code>PATINDEX</code> indiscriminately leave out some rows?</p>\n"},{"tags":["sql-server","sql-server-2008","primary-key","clustered-index"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":72,"score":0,"question_id":13029413,"title":"Sql Server table structure","body":"<p>I have the following data i want to upload:</p>\n\n<pre><code>(Pair)    (Date)    (Time)       (Bid)   (Ask)\nEurUsd  01/01/2012  18:04:01    1.55037 1.55137\nEurUsd  01/01/2012  18:04:20    1.55018 1.55118\nEurUsd  01/01/2012  18:04:22    1.55031 1.55131\nEurUsd  01/01/2012  18:04:36    1.55045 1.55145\nEurUsd  01/01/2012  18:04:40    1.55058 1.55158\nEurUsd  01/01/2012  18:04:40    1.5508  1.5518\n\nGbpUsd  01/01/2012  18:06:11    1.55097 1.55197\nGbpUsd  01/01/2012  18:06:22    1.55117 1.55217\nGbpUsd  01/01/2012  18:06:24    1.55128 1.55228\nGbpUsd  01/01/2012  18:06:38    1.55098 1.55198\n</code></pre>\n\n<p>The data types are as follows: Nchar(6), Date, Time, Decimal, Decimal.</p>\n\n<p>Unfortunately i cant guarantee that the rows will be unique on a minute basis. I will also be adding data to this table on a Daily basis &amp; other Pairs.</p>\n\n<p>Question 1). What is the best way to set up a PK for the above data. Im assuming i should just set up a new column called \"Id\", of type BigInt, and set its \"Is Identity\" to Yes? Then set the PK to be \"Id\"?</p>\n\n<p>Question 2). Clustered Index, based on \"Pair\",\"Date\", \"Time\"?</p>\n\n<p>Question 3). Im assuming that if i set up an \"Id\" column in the table, i would need to have ColumnMapping on any sqlbulkcopy operation i was using to upload the data? Or is it not possible to load data into the column once its \"Is Identity\" property is set?</p>\n\n<p>Thanks for your time.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","umbraco","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":89,"score":1,"question_id":13031484,"title":"\"Cannot open database - login failed\" . Works in Management Studio, not code","body":"<p>Oh yes, the famous error:</p>\n\n<blockquote>\n  <p>Cannot open database \"MYDBNAME\" requested by the login. The login failed. Login failed for user 'USERNAME'.</p>\n</blockquote>\n\n<p><strong>Let me explain my situation:</strong></p>\n\n<p>I have a database server, which has a SA account and my user account. The user has the correct mappings to my database (dbowner).</p>\n\n<p>I can open the database with this user, using SQL Management Studio 2008 R2, both on the SQL server itself (using localhost), and on my frontend server.</p>\n\n<p>However, when I run my application, I get the login failed error. </p>\n\n<p>Strange thing is I have a test application and a production application on our frontend server. The test application has test databases on the same database server, and there are no login problems here. The only difference between the two, are the prefix which differs from \"TEST\" to \"PROD\". The test application works, the production however, doesn't. The user mappings and seem it should work on both.</p>\n\n<p>Any ideas?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>Our connectionstring:</p>\n\n<pre><code>&lt;add key=\"umbracoDbDSN\" value=\"Server=Websqlsrv01;Database=PROD_Databasename;User ID=umbraco_user;Password=password;Trusted_Connection=False\" /&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2008","sum"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13033455,"title":"Return sum of all sales values and sales value for each product","body":"<p>I have a query that will be like this</p>\n\n<pre><code>SELECT\n    ProductID,\n    ProductSales,\n    ProductLocationName\nFROM\n    ProductLocation\nWHERE\n    ProductLine=@ProductLine\n</code></pre>\n\n<p>So my sample results could be like this</p>\n\n<pre><code>ProductID    ProductSales   ProductLocationName\n1            $2             Boston\n1            $2             Chicago\n2            $8             Boston\n</code></pre>\n\n<p>There are some <code>productID/ProductSales</code> combinations which are repeated if the <code>ProductLocationName</code> is different but what I need to return is the following:</p>\n\n<p>I need to return what I am returning above in my sample results but also in addition to this I need to sum all <code>ProductSales</code> values except for duplicate <code>ProductID/ProductSales</code> combinations.</p>\n\n<p>Example from above:</p>\n\n<pre><code>ProductID 1 + ProductID 2\n$2 + $8 = $10\n</code></pre>\n\n<p>Note that I did not add $2 twice since that <code>prodID/Sales</code> value is repeated in the results, however I still need to return the 3 rows above since I have to show all 3 rows in my repeater.</p>\n\n<p>Hope I am being clear, in addition <code>ProductID</code> &amp; <code>ProductLocation</code> (and there will be other columns included in my query), I need </p>\n\n<ol>\n<li><p><code>ProductSales</code> (as displayed in <code>SampleResults</code> above) for each <code>ProductID</code>. I know that <code>SUM(ProductSales)</code> will get me this.</p></li>\n<li><p><code>SUM</code> of <code>ProductSales</code> for all unique <code>ProductID</code> values ($2 + $8 = $10)</p></li>\n</ol>\n\n<p>I would like to do all of this in the same stored procedure if possible.</p>\n\n<p>My main concern is how to get point 2, meaning SUM all of the <code>ProductSales</code> values, in my example $2+$8</p>\n\n<p>Please let me know if you need any more information, this is  my first post here.</p>\n"},{"tags":["sql-server-2008","permissions","schema","multi-tenant"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":13032818,"title":"SQL Server : View permission to table","body":"<p>Is it possible to grant a user access to a view but restrict the user from accessing the table the view selects from? </p>\n\n<pre><code>CREATE TABLE [dbo].[tUsers](\n    [ID] [int] IDENTITY(1,1) NOT NULL,\n    [Username] [nvarchar](50) NULL,\n    [Password] [nvarchar](50) NULL,\n    [TenantID] int\n) ON [PRIMARY]\n\nCREATE VIEW [scmTenant1].[vUsers]\nAS\nSELECT     ID, Username, Password\nFROM         dbo.tUsers\nWHERE        TenantID = 1\n</code></pre>\n\n<p>The SQL Server user account (<code>usrTenant1</code>) has access to schema <code>scmTenant1</code> but does not have access to the <code>dbo</code> schema. I log into SQL Server Management Studio as <code>usrTenant1</code> and try executing this query:</p>\n\n<pre><code>SELECT * FROM scmTenant1.vUsers\n</code></pre>\n\n<p>Gives me error:</p>\n\n<blockquote>\n  <p><em>The SELECT permission was denied on the object 'tUsers', database 'Sandbox', schema 'dbo'.</em> </p>\n</blockquote>\n\n<p>If I grant this account access to the <code>dbo</code> schema the query executes fine.</p>\n\n<p>I think what I would really like to grant the view permission to the table. But my question is can you grant a user access to a view and restrict that user from accessing the underlying table the view selects from?</p>\n"},{"tags":["c#","sql-server-2008","entity-framework","permissions"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":35,"score":1,"question_id":13033458,"title":"Manage entity access and permissions with Entity Framework","body":"<p>In a web application using Entity Framework 4.1 we use SQL Server Membership to manage user access. However we need to implement a more granular set of roles a permission management.</p>\n\n<p>In the database we have already created the relative tables:</p>\n\n<pre><code>- Roles \n- Permissions \n- UserInRole (roles per user)\n- RolesPermissions (permissions associated to a role) \n</code></pre>\n\n<p>Using attributes on some of the core entities we restrict the access semantically with EF, as example, given a specific user, s/he can see only the relative shipped orders or inherent data.</p>\n\n<p>Now we would like to inject the permissions in it, meaning as example that a <em>customer</em> can see and create orders, while a <em>company</em> (these are two different roles) could only see orders for their products and also print reports.</p>\n\n<p>The idea would be to use attributes also for permissions at entity level and check if the current user owns proper rights when a method is invoked. For instance:</p>\n\n<pre><code>public void BeforeAdd()\n{\n   // Get required permissions for the specific entity (Order as example)\n\n   //Check that current user has permission of creating a new Order \n}\n</code></pre>\n\n<p>Such a method would be called by each entity, allowing to centralize the control over permissions at entity level.</p>\n\n<p>We use MVC as frontend and in there we have already implemented roles and permissions access. We need to make the same with the backend part (containing data layer). These are two separate servers communicating via web services. By implementing permission management on the back end part would strengthen the control over data access.</p>\n\n<p>Is there any pattern or best practice that we could follow (eventually using some built in features of EF) to achieve permissions management?</p>\n"},{"tags":["sql-server-2008","database-design","database-deployment","sparse-columns"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":13030023,"title":"what is the risk of using sparse columns instead of normal relational tables?","body":"<p>I have three table that related to one table,in my new design I want to replace the relationship by using sparse columns.\nyou Can see diagram below.</p>\n\n<p><img src=\"http://i.stack.imgur.com/CtIei.png\" alt=\"enter image description here\"></p>\n\n<p>I know I would have Redundancy.but i want to know what is the other risk of this way of design?\nby this new way my queries would be very easy and fast.what is your idea about it?sorry for my bad english,and thanks.</p>\n"},{"tags":["sql","sql-server-2008","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":208,"score":1,"question_id":13020960,"title":"SSIS Variable SQL command for ADO.net source","body":"<p>While this seems like a basic problem, I've been ripping my hair out FOR DAYS trying to get an efficient solution to this. </p>\n\n<p>I have a lookup table of values on a server that I read from and assemble into a string using a C# Script task. I write this string into a variable that I want to pass in as my WHERE parameters inside a large SQL query on a ADO.NET data source (from a different server which I only have read access to) in my data flow. For example, this string would just be something like</p>\n\n<pre><code>  ('Frank', 'John', 'Markus', 'Tom')\n</code></pre>\n\n<p>and I would append that as my WHERE clause. \n I can't read from a variable directly for an ADO.NET data source AND I can't use the 'Expression' property to set my SQL either as my SQL query is over 4000 characters. I could use an Execute SQL Task to run my query, load the results into a recordset and I assume, then loop through the recordset but that's extremely inefficient. </p>\n\n<p>What would be the best way to do this? My end goal is to put these results inside a table on the first server. </p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":13029418,"title":"Having trouble using a multiple criteria search bar/button in Site.Master from an SQL server (C# / ASP.Net)","body":"<p>Hey people I'm having a little issue regarding a transfer of variables from Site.Master to another window, the purpose is to make a search function accessed from the whole asp.net web application...</p>\n\n<p>The code which is relevant from Site.Master:</p>\n\n<pre><code>&lt;div class=\"search\"&gt;\n        &lt;asp:Label ID=\"LandID\" runat=\"server\" Text=\"LandID\"/&gt;\n        &amp;nbsp;&lt;asp:TextBox ID=\"txtSearch\" runat=\"server\" /&gt;\n        &amp;nbsp;&lt;asp:Label ID=\"CarBrand\" runat=\"server\" Text=\"CarBrand\" /&gt;\n        &amp;nbsp;&lt;asp:TextBox ID=\"txtSearch2\" runat=\"server\" /&gt;\n        &amp;nbsp;&lt;asp:Label ID=\"Model\" runat=\"server\" Text=\"Model\"/&gt;\n        &amp;nbsp;&lt;asp:TextBox ID=\"txtSearch3\" runat=\"server\" /&gt;\n        &amp;nbsp;&lt;asp:Button ID=\"cmdSearch\" runat=\"server\" Text=\"Search\" Style=\"width: 100px\" OnClick=\"cmdSearch_Click\" /&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>The Code from Site.Master.Cs:</p>\n\n<pre><code>public static string Text { get; set; }\npublic static string Text2 { get; set; }\npublic static string Text3 { get; set; }\nprotected void Page_Load(object sender, EventArgs e)\n{\n\n}\nprotected void cmdSearch_Click(object sender, EventArgs e)\n{\n    Text = txtSearch.Text;\n    Text2 = txtSearch2.Text;\n    Text3 = txtSearch3.Text;\n    Response.Redirect(\"search.aspx\");\n}\n</code></pre>\n\n<p>The code from the search.aspx:</p>\n\n<pre><code>   &lt;asp:GridView ID=\"GridView1\" runat=\"server\" AutoGenerateColumns=\"False\" DataSourceID=\"SqlDataSource1\"\n    OnSelectedIndexChanged=\"GridView1_SelectedIndexChanged\" DataKeyNames=\"ID\"&gt;\n    &lt;Columns&gt;\n        &lt;asp:CommandField ShowSelectButton=\"True\" /&gt;\n        &lt;asp:BoundField DataField=\"ID\" HeaderText=\"ID\" SortExpression=\"ID\" InsertVisible=\"False\"\n            ReadOnly=\"True\" /&gt;\n        &lt;asp:BoundField DataField=\"LandID\" HeaderText=\"LandID\" SortExpression=\"LandID\" /&gt;\n        &lt;asp:BoundField DataField=\"Bilmaerk\" HeaderText=\"Bilmaerk\" SortExpression=\"Bilmaerk\" /&gt;\n        &lt;asp:BoundField DataField=\"Model\" HeaderText=\"Model\" SortExpression=\"Model\" /&gt;\n        &lt;asp:BoundField DataField=\"Variant\" HeaderText=\"Variant\" SortExpression=\"Variant\" /&gt;\n        &lt;asp:BoundField DataField=\"StartYear\" HeaderText=\"StartYear\" SortExpression=\"StartYear\" /&gt;\n        &lt;asp:BoundField DataField=\"SlutYear\" HeaderText=\"SlutYear\" SortExpression=\"SlutYear\" /&gt;\n        &lt;asp:BoundField DataField=\"Volumen\" HeaderText=\"Volumen\" SortExpression=\"Volumen\" /&gt;\n        &lt;asp:BoundField DataField=\"MaxDrej\" HeaderText=\"MaxDrej\" SortExpression=\"MaxDrej\" /&gt;\n        &lt;asp:BoundField DataField=\"AntalCylindre\" HeaderText=\"AntalCylindre\" SortExpression=\"AntalCylindre\" /&gt;\n        &lt;asp:BoundField DataField=\"TopHast\" HeaderText=\"TopHast\" SortExpression=\"TopHast\" /&gt;\n        &lt;asp:BoundField DataField=\"Acceleration\" HeaderText=\"Acceleration\" SortExpression=\"Acceleration\" /&gt;\n        &lt;asp:BoundField DataField=\"Beskrivelse\" HeaderText=\"Beskrivelse\" SortExpression=\"Beskrivelse\" /&gt;\n        &lt;asp:BoundField DataField=\"Effekt\" HeaderText=\"Effekt\" SortExpression=\"Effekt\" /&gt;\n        &lt;asp:BoundField DataField=\"Picture\" HeaderText=\"Picture\" SortExpression=\"Picture\" /&gt;\n    &lt;/Columns&gt;\n&lt;/asp:GridView&gt;\n&lt;selectparameters&gt;\n&lt;asp:ControlParameter ControlID=\"&lt;%=Text1 %&gt;\"&gt;&lt;/asp:ControlParameter&gt;\n&lt;asp:ControlParameter ControlID=\"&lt;%=Text2 %&gt;\"&gt;&lt;/asp:ControlParameter&gt;\n&lt;asp:ControlParameter ControlID=\"&lt;%=Text3 %&gt;\"&gt;&lt;/asp:ControlParameter&gt;\n&lt;/selectparameters&gt;\n&lt;asp:SqlDataSource ID=\"SqlDataSource1\" runat=\"server\" ConnectionString=\"&lt;%$ ConnectionStrings:CarConnectionString %&gt;\"\n    SelectCommand=\"SELECT * FROM [Bil] WHERE (([LandID] LIKE '%' +@LandID+ '%') AND ([Bilmaerk] LIKE '%' +@Bilmaerk+ '%') AND ([Model] LIKE '%' +@Model+ '%'))\"&gt;\n    &lt;SelectParameters&gt;\n        &lt;asp:ControlParameter ControlID=\"Text1\" Name=\"LandID\" PropertyName=\"Text\" Type=\"String\"\n            DefaultValue=\"%\" /&gt;\n        &lt;asp:ControlParameter ControlID=\"Text2\" Name=\"Bilmaerk\" PropertyName=\"Text\" Type=\"String\"\n            DefaultValue=\"%\" /&gt;\n        &lt;asp:ControlParameter ControlID=\"Text3\" Name=\"Model\" PropertyName=\"Text\" Type=\"String\"\n            DefaultValue=\"%\" /&gt;\n    &lt;/SelectParameters&gt;\n&lt;/asp:SqlDataSource&gt;\n</code></pre>\n\n<p>the Relevant code from search.aspx.cs:</p>\n\n<pre><code>   public partial class search : System.Web.UI.Page\n   {\nprotected string Text1 { get; set; }\nprotected string Text2 { get; set; }\nprotected string Text3 { get; set; }\n\nprotected void Page_Load(object sender, EventArgs e)\n{\n    Text1 = SiteMaster.Text;\n    Text2 = SiteMaster.Text2;\n    Text3 = SiteMaster.Text3;\n}\nprotected void GridView1_SelectedIndexChanged(object sender, EventArgs e)\n{\n    Constructor.SelectedCar = GridView1.SelectedRow.Cells[1].Text;\n    Response.Redirect(\"Selected.aspx\");\n}\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":12,"favorite_count":2,"up_vote_count":7,"down_vote_count":0,"view_count":21279,"score":7,"question_id":646845,"title":"Sql server 2008 log will not truncate. Driving me CRAZY!","body":"<p>I consider myself a very experienced SQL person. But I'm and failing to do these two things:</p>\n\n<ul>\n<li>Reduce the size of the allocated log.</li>\n<li><p>Truncate the log.</p>\n\n<p>DBCC sqlperf(logspace)</p></li>\n</ul>\n\n<p>returns:</p>\n\n<pre><code>Database Name   Log Size (MB)\tLog Space Used (%)\tStatus\nByBox   \t1964.25\t\t30.0657\t\t\t0\n</code></pre>\n\n<p>The following does not work with SQL 2008</p>\n\n<pre><code>DUMP TRANSACTION ByBox WITH TRUNCATE_ONLY\n</code></pre>\n\n<p>Running the following does nothing either</p>\n\n<pre><code>DBCC SHRINKFILE ('ByBox_1_Log' , 1)\nDBCC shrinkdatabase(N'bybox')\n</code></pre>\n\n<p>I've tried backups. I've also tried setting the properties of the database - 'Recover Model' to both 'FULL' and 'SIMPLE' and a combination of all of the above. Also tried setting the compatibility to SQL 2005 (I use this setting as I want to match our production server) and SQL 2008.</p>\n\n<p>No matter what I try, the log remains at 1964.25Mb, with 30% used, which is still growing.\nI'd like the log to go back down near 0% and reduce the log file size to a say 100Mb which is plenty. My database must hate me, it just ignores everything I ask it to do regarding the log.</p>\n\n<p>One further note, the production database has quite a few replicated tables, which I turn off when I perform a restore on my development box by using the following:</p>\n\n<pre><code>-- Clear out pending replication stuff\nexec sp_removedbreplication\ngo\nEXEC sp_repldone @xactid = NULL, @xact_segno = NULL,\n     @numtrans = 0, @time = 0, @reset = 1\ngo\n</code></pre>\n\n<p>Trying:</p>\n\n<pre><code>SELECT log_reuse_wait, log_reuse_wait_desc\nFROM sys.databases\nWHERE NAME='bybox'\n</code></pre>\n\n<p>Returns</p>\n\n<pre><code>log_reuse_wait  log_reuse_wait_desc\n0   NOTHING\n</code></pre>\n\n<p>Any words of wisdom or things to try are all welcome!</p>\n\n<p><hr /></p>\n\n<p>Looking at <a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqldatabaseengine/thread/9f9ae5c5-3031-4963-bb16-c7ed05d9890a/\">this</a> and setting the recovery model to FULL I have tried the following:</p>\n\n<pre><code>USE master\nGO\n\nEXEC sp_addumpdevice 'disk', 'ByBoxData', N'C:\\&lt;path here&gt;\\bybox.bak'\n\n-- Create a logical backup device, ByBoxLog.\nEXEC sp_addumpdevice 'disk', 'ByBoxLog', N'C:\\&lt;path here&gt;\\bybox_log.bak'\n\n-- Back up the full bybox database.\nBACKUP DATABASE bybox TO ByBoxData\n\n-- Back up the bybox log.\nBACKUP LOG bybox TO ByBoxLog\n</code></pre>\n\n<p>which returned:</p>\n\n<pre><code>Processed 151800 pages for database 'bybox', file 'ByBox_Data' on file 3.\nProcessed 12256 pages for database 'bybox', file 'ByBox_Secondary' on file 3.\nProcessed 1 pages for database 'bybox', file 'ByBox_1_Log' on file 3.\nBACKUP DATABASE successfully processed 164057 pages in 35.456 seconds (36.148 MB/sec).\n\nProcessed 2 pages for database 'bybox', file 'ByBox_1_Log' on file 4.\nBACKUP LOG successfully processed 2 pages in 0.056 seconds (0.252 MB/sec).\n</code></pre>\n\n<p>Perfect! But its not.</p>\n\n<p>And DBCC SHRINKFILE ('ByBox_1_Log' , 1) now returns with</p>\n\n<pre><code>DbId    FileId\tCurrentSize\tMinimumSize\tUsedPages\tEstimatedPages\n7   2\t251425\t251425\t251424\t251424\n</code></pre>\n\n<p>and DBCC SQLPERF(LOGSPACE) still reports 30% usage.\nI think I may have to resign myself to the fact there could well be a bug in SQL Server 2008, or that my log file has been corrupted in some manner. However, my database is in good working order, which leads me to think there is a bug <em>(shudders at the thought)</em>.</p>\n"},{"tags":["sql","sql-server-2008","sql-server-express"],"answer_count":2,"favorite_count":3,"up_vote_count":0,"down_vote_count":0,"view_count":2682,"score":0,"question_id":7313103,"title":"create table permission denied in database 'master'","body":"<p>I have installed the free version of sql server 2008 (sql server management studio express edition) on my PC. After installation I get the following error</p>\n\n<pre><code>create table permission denied in database 'master'\n</code></pre>\n\n<p>I tried reinstalling several times, but I keep getting the same error. When i checked </p>\n\n<pre><code>select user_account();\n</code></pre>\n\n<p>It showed that I was logged in as guest. How do I solve this? since I am not permitted to create a new login. </p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":31,"score":-1,"question_id":13029371,"title":"Creating vintage table sql","body":"<p>This is quite difficult to explain so please bare with me.</p>\n\n<p>I'm creating a vintage table therefore the numbers go up diagonal for example</p>\n\n<pre><code>m1 m2 m3 m4 m5 m6 \n8  8  9  9  10 0\n78 56 6  6  0\n85 56 89 0\n89 86 0 \n56 0 \n</code></pre>\n\n<p>However, I want the numbers to roll over, therefore the top line should look like</p>\n\n<pre><code>m1 m2 m3 m4 m5 m6\n8  16 25 34 54 0\n</code></pre>\n\n<p>(example1)I tried to use some sequel but it didn't give me the right numbers and also on the bottom line it would look like</p>\n\n<pre><code>56 56 \n</code></pre>\n\n<p>This is because it would use the <code>m1+m2</code> sum. (example2) So when I used a case to only <code>m1+m2</code> when <code>m2 = 0</code> it didn't include numbers it should have and my overall number was less.</p>\n\n<p>example1:</p>\n\n<pre><code>select [Month] ,\nSUM(m1) as m1 ,\nsum(m1+m2) as m2,\nSUM(m2+m3) as m3 ,\nSUM(m3+m4) as m4 ,\nSUM(m4+m5) as m5 ,\nSUM(m5+m6) as m6 \nfrom #months\ngroup by [Month]\norder by [Month]\n</code></pre>\n\n<p>example2:\nI also tried </p>\n\n<pre><code>select [Month] ,\nSUM(m1) as m1 ,\nsum(case when m2 &lt;&gt; 0 then(m1+m2) else 0 end) as m2 ,\nSUM(case when m3 &lt;&gt; 0 then m2+m3 else 0 end) as m3 ,\nSUM(case when m4 &lt;&gt; 0 then m3+m4 else 0 end) as m4 ,\nSUM(case when m5 &lt;&gt; 0 then m4+m5 else 0 end) as m5 ,\nSUM(case when m6 &lt;&gt; 0 then m5+m6 else 0 end) as m6 ,\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","pivot"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":92,"score":4,"question_id":13022718,"title":"Return Columns As Rows based on Number of Months","body":"<p>This seems like a simple thing to accomplish but I'm not sure if I am thinking about it correctly to get the desired results. I'm using a pivot but I think I need something else paired with it.</p>\n\n<p>I have an invoice table that contains monthly invoices for each client. At most, a client will have 12 invoices per year, 1 for each month.</p>\n\n<pre><code>+----------+-------+-------+--------------+--------------+--------------+\n| ClientID | Month | Year  | ColumnValue1 | ColumnValue2 | ColumnValue3 |\n+----------+-------+-------+--------------+--------------+--------------+\n|        1 |     1 |  2012 |           20 |           30 |           50 |\n|        1 |     2 |  2012 |           25 |           35 |           40 |\n|        2 |     1 |  2012 |           28 |           38 |           48 |\n+----------+-------+-------+--------------+--------------+--------------+\n</code></pre>\n\n<p>Now, I want to create a list like below based on each client. There would be a column for each month. So Client 1 would look like:</p>\n\n<pre><code>+--------------+----+----+---+---+---+---+---+---+---+----+----+----+-------+\n|  ColumnName  | 1  | 2  | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | Total |\n+--------------+----+----+---+---+---+---+---+---+---+----+----+----+-------+\n| ColumnValue1 | 20 | 25 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  0 |  0 |  0 |   45  |\n| ColumnValue2 | 30 | 35 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  0 |  0 |  0 |   65  |\n| ColumnValue3 | 50 | 40 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |  0 |  0 |  0 |   90  |\n+--------------+----+----+---+---+---+---+---+---+---+----+----+----+-------+\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":21,"score":0,"question_id":13027819,"title":"dynamic sql passing paramter of length > 8000","body":"<p>I am creating a report that may allow for the user to select All Codes in the database.  When this is converted to a string, it passes a string with more than 8000 characters.  Since this is a parameter, I am not sure how to split this.  Does anyone have an idea?  I am using Sql Server 2008 and have tried the varchar(max) as well. Any other ideas?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":13027471,"title":"SQL Server 2008 r2 how to split column values to multiple rows","body":"<p>How to split column values to raw values e.g:</p>\n\n<pre><code>Col1            col2\n1               james\n1               gold\n1               james@gmail.com\n2               john\n2               def\n2               def@gmail.com\n</code></pre>\n\n<p>col1 values keep on changing  to thousands.</p>\n\n<p>results:</p>\n\n<pre><code>col1            col2      col3      col4\n1               james     gold      james@gmail.com \n2               john      def       ef@gmail.com\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":53,"score":2,"question_id":13012902,"title":"SQL Select then Delete","body":"<p>I need to clean out some old data from my database tables. Below shows two tables, <strong>app_status</strong> and <strong>app_personal_details</strong>.</p>\n\n<p><img src=\"http://i.stack.imgur.com/BlqfP.png\" alt=\"enter image description here\"></p>\n\n<p>I have the following query to select all the records (applications) from the <strong>app_status</strong> table which have been created over 12 months from todays date</p>\n\n<pre><code>select status_id  \nfrom dbo.app_status  \nwhere submission_date &lt;= dateadd(month, -12, getdate()) order by 1\n</code></pre>\n\n<p>I then want to delete all the records from the <strong>app_personal_details</strong> table where the application_id exists in the list of retrieved status_id above.</p>\n\n<p>I hope this makes sense. I would like to know a quick way of deleting the data from both tables.</p>\n\n<p>Thanks for your help.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":13027150,"title":"Conversion failed when converting the varchar value '300.00' to data type int","body":"<p>Is there a way to get rid of this error when using the following sql case when query?As some of the fields are varchar due to they way they were imported?</p>\n\n<pre><code>select * ,\ncase when [Month] = '200911' then netpay_nov09\n when [Month] = '200912' then netpay_dec09\n when [Month] = '201001' then netpay_jan10\nend as m1\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":1,"view_count":55,"score":-1,"question_id":13027153,"title":"Function which returns table with two different conditions","body":"<p>I have a sql function which returns table with two different conditions.</p>\n\n<p>Example: I have a @temp Table </p>\n\n<pre><code>@temp\n(\nProject Name,\nProject ID,\nTasks,\nAdhoc Tasks\n)\n</code></pre>\n\n<p>Tasks       has to give the count of Tasks where Duration != 0\nAdhoc Tasks has to give the count of Tasks where Duration = 0</p>\n\n<p>My Result:</p>\n\n<pre><code>P Name   PID   Tasks     AdhocTasks\n  A        1      2          12\n  b        2      3          12\n  c        3      6          12\n  d        4      5          12\n</code></pre>\n\n<p>I have Projects e,f,g which has only Adhoc tasks but not displaying\nExpected Result:</p>\n\n<pre><code>P Name   PID   Tasks     AdhocTasks\n  A        1      2         2\n  b        2      3         3\n  c        3      6         1\n  d        4      5         2\n  e        5      0         1\n  f,       6      0         1 \n  g        7      0         2\n</code></pre>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":25,"score":1,"question_id":13027217,"title":"SQL Server 2008 - Use IDENTITY field when inserting a row","body":"<p>My table has 3 columns <code>ID</code>, <code>ISOCode</code> and <code>CountryName</code>.</p>\n\n<p>Column <code>ID</code> is an IDENTITY column.</p>\n\n<p>When I insert new records into this table, I want to populate the <code>ISOCode</code> field - on occasion - with the same value as the <code>ID</code> field.</p>\n\n<p>I've tried SCOPE_IDENTITY(), @@IDENTITY and IDENT_CURRENT but none of these seems to work.</p>\n\n<p>Is there a way I can do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":13024831,"title":"How to iterate through each row in sql server?","body":"<pre><code>select name from sys.tables where name like '%JPro_VP_Service%'\n</code></pre>\n\n<p>My above query returns 26 table names.</p>\n\n<p>Now I'm trying to write a query to check in every table return from above query.</p>\n\n<pre><code>select * from JPro_VP_Service --consider this is my first table like wise I want to search in 26 tables return from above query\nwhere row_id like '%1-101%' or row_id like '%1-102%'\n</code></pre>\n\n<p>I think I need to write for or cursor to accomplish this can anyone help me how to achieve this?</p>\n"},{"tags":["sql-server-2008","windows-services","arcgis","arcgis-server"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13025824,"title":"cannot create sdeservice at arcgis10.1 with ms sql server 2008","body":"<p>I'm not sure if it is good place to put below my question, if not - please move it to the right place. I've got ArcGis 10.1 server and MSSQLSERVER 2008 and I have installed the ArcSDE. I wanna create windows service using command line and putting the command like below:</p>\n\n<pre><code>sdeservice -o create -p sde -n -d SQLSERVER, MSSQLSERVER -i esri_sde2 -s bgpn\n</code></pre>\n\n<p>the service has created, but if I wanna run the service it's starting and stopping for a short while. The message that i've got:</p>\n\n<pre><code>The esri_sde2 service on Local Computer started and then stopped. Some services stop automatically if they are not in use by other services or programs.\n</code></pre>\n\n<p>Does anyone got any idea why it is not working well? My operating system is Windows 7 64-bits. Thanks for any help.</p>\n"},{"tags":["c#",".net","sql-server","sql-server-2008","ado.net"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":28,"score":1,"question_id":13024952,"title":"Attempt to fetch logical page (5:65424) in database 2 failed","body":"<p>I am getting following <code>SqlException</code> on calling a stored procedure -</p>\n\n<blockquote>\n  <p><em>Attempt to fetch logical page (5:65424) in database 2 failed. It belongs to allocation unit 7349876362857938944 not to 4899918190390149120.</em></p>\n  \n  <p><em>System.Data.SqlClient.SqlException occurred<br>\n  Message=\"Attempt to fetch logical page (5:65424) in database 2 failed. It belongs to allocation unit 7349876362857938944 not to 4899918190390149120.</em>  </p>\n  \n  <p>Source=\".Net SqlClient Data Provider\"<br>\n  ErrorCode=-2146232060<br>\n  Class=21<br>\n  LineNumber=257<br>\n  Number=605<br>\n  Procedure=\"ispDisplayCount\"<br>\n  Server=\"10.10.1.1\"<br>\n  State=3  </p>\n  \n  <p>StackTrace:<br>\n  at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)<br>\n  at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException\n  exception, Boolean breakConnection)<br>\n  at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject\n  stateObj)<br>\n  at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream,\n  BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject\n  stateObj)<br>\n  at System.Data.SqlClient.SqlDataReader.ConsumeMetaData()<br>\n  at System.Data.SqlClient.SqlDataReader.get_MetaData()<br>\n  at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds,\n  RunBehavior runBehavior, String resetOptionsString)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean\n  async)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String\n  method, DbAsyncResult result)<br>\n  at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior\n  cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String\n  method)<br>\n  at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior\n  behavior, String method)<br>\n  at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior\n  behavior)<br>\n  at System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior\n  behavior)<br>\n  at System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords,\n  String srcTable, IDbCommand command, CommandBehavior behavior)<br>\n  at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand\n  command, CommandBehavior behavior)<br>\n  at System.Data.Common.DbDataAdapter.Fill(DataSet dataSet)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.DoLoadDataSet(IDbCommand\n  command, DataSet dataSet, String[] tableNames)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.LoadDataSet(DbCommand\n  command, DataSet dataSet, String[] tableNames)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.LoadDataSet(DbCommand\n  command, DataSet dataSet, String tableName)<br>\n  at Microsoft.Practices.EnterpriseLibrary.Data.Database.ExecuteDataSet(DbCommand\n  command) in D:\\SVN_Workspace\\Login.cs:line 1205  </p>\n</blockquote>\n\n<p>What does this exception mean and any resolution to above issue?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":3,"view_count":41,"score":-3,"question_id":13024244,"title":"Select Male & Female's names from the same table Contacts","body":"<p>This is My 'Contacts' table.</p>\n\n<pre><code>| Names      |   Gender   |\n\n| Mike       | Male       |\n| Steve      | Male       |\n| Kelly      | Female     |\n| Jane       | Female     |\n| Natasha    | Female     |\n| Mathew     | Male       |\n| Jack       | Male       |\n</code></pre>\n\n<p>I want result like that:</p>\n\n<pre><code>|  Male      |   Female   |   \n\n| Mike       | Kelly      |\n| Steve      | Jane       |\n| Mathew     | Natasha    |\n| Jack       |            |\n</code></pre>\n\n<p>please give me solution to achieve this result in SQL Sever...\nAny suggestions are appreciated!</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":13024006,"title":"Scalar-valued function doesn't return expected result","body":"<p>I have created a scalar-valued function in Microsoft SSMS, it is as follows:</p>\n\n<pre><code>CREATE FUNCTION [dbo].[fGetCurrentBalFromName] \n(\n    @Name NVarchar,\n    @CliFl Bit\n)\nRETURNS Money\nAS\nBEGIN\n    DECLARE @CurrentBal Money\n\n    select @CurrentBal=SUM(tt.Debt) from  \n     (select case t.Clientfl when 1 then dbo.fGetClientNameFromId(t.AgentID) \n                    else dbo.fGetSupplierNameFromId(t.AgentID) \n             end as Cli,\n             t.Clientfl,\n         case t.Clientfl when 1 then \n            case t.Incomfl \n                when 1 then t.Amount \n                       else (-1)*t.Amount \n            end\n         else\n            case t.Incomfl\n                when 1 then (-1)*t.Amount\n                        else t.Amount\n            end\n         end as Debt              \n      from [Store].[dbo].[Money] t) tt where tt.Cli=@Name and tt.Clientfl=@CliFl\n      group by tt.Cli\n\n    RETURN @CurrentBal\n\nEND\n</code></pre>\n\n<p>When I execute </p>\n\n<pre><code>Select dbo.fGetCurrentBalFromName('',1)\n</code></pre>\n\n<p>I get no(NULL) result.</p>\n\n<p>But when I try to execute the query alone without parameters</p>\n\n<pre><code>select SUM(tt.Debt) from  \n         (select case t.Clientfl when 1 then dbo.fGetClientNameFromId(t.AgentID) \n                        else dbo.fGetSupplierNameFromId(t.AgentID) \n                 end as Cli,\n                 t.Clientfl,\n             case t.Clientfl when 1 then \n                case t.Incomfl \n                    when 1 then t.Amount \n                           else (-1)*t.Amount \n                end\n             else\n                case t.Incomfl\n                    when 1 then (-1)*t.Amount\n                            else t.Amount\n                end\n             end as Debt              \n          from [Store].[dbo].[Money] t) tt where tt.Cli='' and tt.Clientfl=1\n          group by tt.Cli\n</code></pre>\n\n<p>I get exactly what I want. \n So what is the mistake I had done creating the scalar-valued function. \n Any help will be appreciated!</p>\n"},{"tags":["asp.net",".net","sql-server-2008","windows-services"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":66,"score":1,"question_id":13023727,"title":"Windows Service SQL timeout exception","body":"<p>I have a Windows service which continuously each 10 seconds queries the SQL Server database table, and I also have a web site which also queries the same database table after 25 seconds.</p>\n\n<p>After some time I get exception - <code>server timeout exception has occurred</code>. I went through stack-overflow site and has done the changes to SQL configuration settings but still I got the same exception. What to do?</p>\n\n<p><strong>Stack Trace</strong></p>\n\n<p>at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\n   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\n   at System.Data.SqlClient.SqlDataReader.ConsumeMetaData()\n   at System.Data.SqlClient.SqlDataReader.get_MetaData()\n   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\n   at System.Data.Common.DbCommand.ExecuteReader(CommandBehavior behavior)\n   at Microsoft.Practices.EnterpriseLibrary.Data.Database.DoExecuteReader(DbCommand command, CommandBehavior cmdBehavior)\n   at Microsoft.Practices.EnterpriseLibrary.Data.Database.ExecuteReader(DbCommand command)\n   at Microsoft.Practices.EnterpriseLibrary.Data.CommandAccessor<code>1.&lt;Execute&gt;d__0.MoveNext()\n   at System.Collections.Generic.List</code>1..ctor(IEnumerable<code>1 collection)\n   at System.Linq.Enumerable.ToList[TSource](IEnumerable</code>1 source)</p>\n\n<p>at System.Runtime.Remoting.Messaging.Message.Dispatch(Object target, Boolean fExecuteInContext)\n   at System.Runtime.Remoting.Messaging.StackBuilderSink.SyncProcessMessage(IMessage msg, Int32 methodPtr, Boolean fExecuteInContext)</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":13021252,"title":"Handling partitions when you don't know the tables affected","body":"<p>I have a little problem :(, I have a data base that reached 1000 partitions for one partition_schema, taking a look on the internet I found that it is the top but it can be increased to 15000. I can't increase it to 15000, the solution that I can do is merge some partitions.</p>\n\n<p>I have a partition by day since 20100101 and actually there is 999, it can't increase anymore, so I want to merge the partitions from one month, but before that I want to do a backup of the information that is going to be affected, BUT I don't know which tables are affected by the function that has 999 ranges.</p>\n\n<p>Q. How can I find out wich tables are affected by the function? or which is the best way to asure that merging the partitions I won't lose data?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":13020405,"title":"Flattening XML structure in T-SQL","body":"<p>I have the following XML structure</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;DataItems&gt;\n    &lt;DataItem&gt;\n        &lt;ID&gt;ID1&lt;/ID&gt;\n        &lt;Metric1&gt;Metric11Value&lt;/Metric1&gt;\n        &lt;Metric2&gt;Metric12Value&lt;/Metric2&gt;\n        &lt;OptionalParameters&gt;\n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName1&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue1&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits1&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt; \n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName2&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue2&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits2&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt;\n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName3&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue3&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits3&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt;\n        &lt;/OptionalParamters&gt;\n    &lt;DataItem&gt;\n        &lt;ID&gt;ID2&lt;/ID&gt;\n        &lt;Metric1&gt;Metric21Value&lt;/Metric1&gt;\n        &lt;Metric2&gt;Metric22Value&lt;/Metric2&gt;\n        &lt;OptionalParameters&gt;\n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName1&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue1&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits1&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt; \n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName2&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue2&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits2&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt;\n           &lt;OptionalParameter&gt;\n              &lt;ParameterName&gt;ParamName3&lt;/ParameterName&gt;\n              &lt;ParameterValue&gt;ParamValue3&lt;/ParameterValue&gt;\n              &lt;ParameterUnits&gt;ParamUnits3&lt;/ParameterUnits&gt;\n           &lt;OptionalParamter&gt;\n        &lt;/OptionalParamters&gt;\n    &lt;DataItem&gt;\n&lt;/DataItems&gt;\n</code></pre>\n\n<p>I would like to flatten it in a fashion that will give me a table row like</p>\n\n<pre><code>(ID, Metric1, Metric2, ParamName, ParamValue, ParamUnits)\n</code></pre>\n\n<p>The problem is that I don't know how do peform the dynamic filtering I need in order to eliminate the invalid rows that result during the inner join or cross apply. So what I have essentially a total of (Number of Data Items)^2 of rows with all the permutations of parameters names, values, and units. I want to know how to filter out the invalid rows.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":84,"score":1,"question_id":13019624,"title":"Why do I get these different results from two SQL queries?","body":"<p>This has been killing me all day =D.  Please help!</p>\n\n<p>Scenario 1:  Two DB's on the same server (A, B) and A has three tables.  Query is executed from B.</p>\n\n<p>Scenario 2: Two DB's one server is linked to the other. (B has link A) and A has three tables.  Query is executed from B.</p>\n\n<p>In scenario 1 (non linked server):</p>\n\n<pre><code>SET @val = ''\nSELECT @val = @val + 'Hello, my name is ' + [name] + '!' + CHAR(10) + CHAR(13)\nFROM A.sys.tables\n</code></pre>\n\n<p>Returns:\nHello, my name is Table1!\nHello, my name is Table2!\nHello, my name is Table3!</p>\n\n<p>In scenario 2 (linked server):</p>\n\n<pre><code>SET @val = ''\nSELECT @val = @val + 'Hello, my name is ' + [name] + '!' + CHAR(10) + CHAR(13)\nFROM LINKED.A.sys.tables\n</code></pre>\n\n<p>Returns:\nHello, my name is Table3!</p>\n\n<p>Why are these different?  If I use openquery() on the linked server the results are the same as scenario 1.  I'm trying to avoid using openquery() if possible.  Thanks!</p>\n"},{"tags":["sql-server","sql-server-2008","triggers"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":29053,"score":1,"question_id":5341584,"title":"SQL Server - after insert trigger - update another column in the same table","body":"<p>I've got this database trigger:</p>\n\n<pre><code>CREATE TRIGGER setDescToUpper\nON part_numbers\n AFTER INSERT,UPDATE\nAS\nDECLARE @PnumPkid int, @PDesc nvarchar(128)\n\nSET @PnumPkid = (SELECT pnum_pkid FROM inserted)\nSET @PDesc = (SELECT UPPER(part_description) FROM inserted)\n\nUPDATE part_numbers set part_description_upper = @PDesc WHERE pnum_pkid=@PnumPkid\n\nGO\n</code></pre>\n\n<p><strong>Is this a bad idea?</strong> That is to update a column on the same table. I want it to fire for both insert and update. </p>\n\n<p>It works, I'm just afraid of a cyclical situation. The update, inside the trigger, fires the trigger, and again and again. <strong>Will that happen?</strong></p>\n\n<p>Please, don't nitpick at the upper case thing. Crazy situation.</p>\n"},{"tags":["sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":13019120,"title":"SQL Server 2008 Query to pull the max account date opened","body":"<p>i have the table as below,<br>\n        i would like to find the max(account_opened_date), if there is null date is existing, i have to show null values.</p>\n\n<p><strong>Scenario1</strong>  </p>\n\n<p><strong>Table1</strong>  </p>\n\n<pre><code>CLIENTID            ACCOUNTID           ACCOUNT_OPENED_DATE\n11562               3880                07/05/2012\n11562               3884                08/05/2012\n11562               3885                09/06/2012\n11562               3886                10/06/2012\n11562               3881                NULL\n11562               3882                NULL  \n</code></pre>\n\n<p>the results are as below.  </p>\n\n<pre><code>CLIENTID            ACCOUNTID           ACCOUNT_OPENED_DATE  \n11562               3882                NULL  \n</code></pre>\n\n<p>in the above scenario, i have to take null because, there is null values existing in account opened dates  </p>\n\n<p><strong>Scenario2</strong>  </p>\n\n<p><strong>Table1</strong>  </p>\n\n<pre><code>CLIENTID            ACCOUNTID           ACCOUNT_OPENED_DATE  \n11563               3880                07/05/2012\n11563               3884                08/05/2012\n11563               3885                09/06/2012\n11563               3886                10/06/2012\n11563               3881                11/10/2011\n11563               3882                10/22/2012  \n</code></pre>\n\n<p>The results ARE AS below.  </p>\n\n<pre><code>CLIENTID            ACCOUNTID           ACCOUNT_OPENED_DATE\n11563               3882                10/22/2012  \n</code></pre>\n\n<p>in the above scenario, i have to take 10/22/2012 because, there is no null values existing in account opened dates<br>\nPLEASE HELP!</p>\n"},{"tags":["windows","visual-studio","sql-server-2008","windows-server-2008","remote-debugging"],"answer_count":3,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":5659,"score":8,"question_id":2512244,"title":"Can't step into stored procedure on remote SQL Server 2008","body":"<p>I have a domain controller installed on virtual <code>Windows Server 2008 x64</code>.</p>\n\n<p><code>SQL Server 2008 Express x64</code> is running on <code>Windows Server 2008 x64</code> and client on <code>Windows 7 RTM x86</code>. Both have joined the domain.</p>\n\n<p>I'm starting both <code>Visual Studio 2008</code> and <code>SQL Server Management Studio 2008</code> under domain admin user. This account is a member of group <code>sysadmin</code> on <code>SQL Server</code>.</p>\n\n<p>Server has firewall exceptions for both <code>TCP</code> and <code>UDP</code> on ports <code>135-139</code> and <code>1433-1434</code>.</p>\n\n<p><code>Visual Studio 2008 Remote Debugger</code> services is started on server and <code>Domain Admins</code> group is allowed to debug.</p>\n\n<p>Remote DCOM works: I can attach to remote server and list it's processes, can switch to show only managed code, etc.</p>\n\n<p>When I'm starting debugging of a query in SMS I'm getting this error:</p>\n\n<blockquote>\n  <p>Failed to start debugger Error HRESULT\n  E_FAIL has been returned from a call\n  to a COM component. (mscorlib) Program\n  Location:</p>\n  \n  <p>at System.Runtime.InteropServices.Marshal.ThrowExceptionForHRInternal(Int32\n  errorCode, IntPtr errorInfo)</p>\n  \n  <p>at Microsoft.SqlServer.Management.UI.VSIntegration.DebugSession.DebugCallbacks.OnSqlInitializeDebuggingEvent(ISqlInitializeDebuggingEvent\n  sqlInitializeDebuggingEvent)</p>\n  \n  <p>at Microsoft.SqlServer.Management.UI.VSIntegration.DebugSession.DebugCallbacks.Microsoft.VisualStudio.Debugger.Interop.IDebugEventCallback2.Event(IDebugEngine2\n  debugEngine, IDebugProcess2\n  debugProcess, IDebugProgram2\n  debugProgram, IDebugThread2\n  debugThread, IDebugEvent2 debugEvent,\n  Guid&amp; riidEvent, UInt32 attribute)</p>\n</blockquote>\n\n<p>and </p>\n\n<blockquote>\n  <p>Unable to access the SQL Server\n  debugging interface.  The Visual\n  Studio debugger cannot connect to the\n  remote computer.  A firewall may be\n  preventing communication via DCOM to\n  the remote computer. Please see Help\n  for assistance.</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>Unable to start program MSSSQL://server.mydomain.local/master/sys/=0</p>\n</blockquote>\n\n<p>And  when stepping-in into a stored procedure using VS I'm getting the first one and this:</p>\n\n<blockquote>\n  <p>Exception from HRESULT: 0x89710016</p>\n</blockquote>\n\n<p>What have I do?</p>\n"},{"tags":["sql-server","sql-server-2008","collation"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3780,"score":0,"question_id":1121105,"title":"Changing default collation of a SQL Server 2008 instance","body":"<p>When I try to change the default collation of a SQL Server instance using this commandline:</p>\n\n<pre>setup.exe /QUIET /ACTION=REBUILDDATABASE /INSTANCENAME=MSSQLSERVER /SAPWD=********* /SQLCOLLECTION=SQL_Latin1_General_CP1_CI_AS</pre>\n\n<p>I get the following message:</p>\n\n<pre>Microsoft (R) SQL Server 2008 Setup 10.00.1600.22\nCopyright (c) Microsoft Corporation.  All rights reserved.\n\nThe following error occurred:\nThe setting 'SQLCOLLECTION' specified is not recognized.\n\nError result: -2068578301\nResult facility code: 1204\nResult error code: 3\n\nPlease review the summary.txt log for further details</pre>\n\n<p>Is there anything I'm missing ? Do I need to do something special for the setup.exe to find the <code>SQL_Latin1_General_CP1_CI_AS</code> collation?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server","sql-server-2005","sql-server-2008","reporting-services"],"answer_count":3,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":9312,"score":4,"question_id":1097690,"title":"Converting SQL2008 RDL file to SQL2005","body":"<p>How do I convert a RDL file that was created using the SQL2008 designer to work on SQL2005 Reporting services?</p>\n"},{"tags":["sql-server-2008","search","index","integer","catalog"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":5,"view_count":100,"score":-5,"question_id":12963490,"title":"Why is there no delimited, integer-only cataloging option in SQL Server?","body":"<p>Is there something I'm missing?</p>\n\n<p>What I am trying to create is basically a table of indexes separated by spaces (or whatever type you fancy). I realize that Full Text Search would not be possible on merely int-type data columns because it understands \"spaces\" as the delimiter to separated data to be indexed across the whole catalog. </p>\n\n<p>I do realize that it does allow me to index <code>varbinary</code> type data, but why not just <code>int</code> data separated by spaces, rather than include integer AND text data to search through. IE, a </p>\n\n<pre><code> SEARCH * FROM MyTable\n WHERE CONTAINS(indexedcolumn, '1189')\n</code></pre>\n\n<p>with a full text index/catalog defined for a table that looks like:</p>\n\n<pre><code> indexedColumn      secondDelimitedIntColumn\n 1189               34 34209 1989 3 5\n</code></pre>\n\n<p>is not possible, but</p>\n\n<pre><code> SEARCH * FROM MyTable\n WHERE CONTAINS(uniqueColumn, 'a1189')\n</code></pre>\n\n<p>WOULD work using the full text index on a table with the following columns:</p>\n\n<pre><code> uniqueColumn secondDelimitedIntColumn\n a1189        b34 b34209 b1989 b3 b5  \n</code></pre>\n\n<p>so basically executing a <code>CONTAINS()</code> search on any column with a full text index on it will work only if there is some text attached to the integer string.</p>\n\n<p>But my question is asking \"Why can't I just used strings of integers separated by spaces, which saves me the step of having to add dummy text just to get trick SQL Server into allowing me to execute a full text search on indexed integer strings?\"</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server-2008","query","full-text-search","contains"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12945479,"title":"How to do a CONTAINS() on two columns of Full Text Index Search SQL","body":"<p>I have a table (MyTable) with the following columns:</p>\n\n<p>Col1: NameID VARCHAR(50) PRIMARY KEY NOT NULL\nCol2: Address VARCHAR(255)</p>\n\n<p>Data Example:</p>\n\n<p>Name: '1 24'\nAddress: '1234 Main St.'</p>\n\n<p>and i did a full text index on the table after making the catalog using default params.</p>\n\n<p>How can I achieve the following query:</p>\n\n<pre><code> SELECT * FROM MyTable\n WHERE CONTAINS(NameID, '1')\n AND CONTAINS(Address, 'Main St.');\n</code></pre>\n\n<p>But my query is returning no results, which doesn't make sense because this does work:</p>\n\n<pre><code> SELECT * FROM MyTable\nWHERE CONTAINS(Address, 'Main St.');\n</code></pre>\n\n<p>and so does this:</p>\n\n<pre><code> SELECT * FROM MyTable\n WHERE CONTAINS(Address, 'Main St.')\n AND NameID LIKE '1%'\n</code></pre>\n\n<p>but this also doesn't work:</p>\n\n<pre><code> SELECT * FROM MyTable\n WHERE CONTAINS(NameID, '1');\n</code></pre>\n\n<p>Why can't I query on the indexed, primary key column (Name) when I selected this column to be included with\nthe Address column when setting up the Full Text Index?</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["asp.net-mvc","asp.net-mvc-3","sql-server-2008","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":58,"score":-1,"question_id":12991660,"title":"Unable to find the requested .Net Framework Data Provider. MVC 4 with Entity Framework","body":"<p>Am using the MVC 4 in VS2010 SP1 installed machine. Am getting the following error</p>\n\n<p>Unable to find the requested .Net Framework Data Provider. It may not be installed. </p>\n\n<p>My WebConfig look like this </p>\n\n<pre><code>      &lt;connectionStrings&gt;\n    &lt;add name=\"BuildEntities\" connectionString=\"metadata=res://*/Entity.Build.csdl|res://*/Entity.Build.ssdl|res://*/Entity.Build.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Data Source=www.xxxx.com,8754;Initial Catalog=xxxx;Persist Security Info=True;User ID=xxx;Password=xxxx;MultipleActiveResultSets=True&amp;quot;\"\n         providerName=\"System.Data.EntityClient\" /&gt;\n &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>I had SQL Server 2008 installed in my lap.</p>\n"},{"tags":["asp.net","sql-server-2008","session-state"],"answer_count":2,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":154,"score":3,"question_id":12653708,"title":"SQLServer Session State Management Lost On App Pool Recycle","body":"<p>I have an application that has been having issues with losing session, and I'm almost positive  it has to do with the application pool recycling too often.  </p>\n\n<p>I wanted to try an out of process solution and have configured SQLServer sessionState, but when I recycle the worker process my session is still being blown away.  Here is my web.config</p>\n\n<pre><code>&lt;sessionState cookieless=\"false\" stateConnectionString=\"tcpip=localhost:42424\"  mode=\"SQLServer\" sqlConnectionString=\"Data Source=(local;User ID=user;Password=password\" timeout=\"180\" /&gt;\n</code></pre>\n\n<p>I've ran the appropriate sql scripts to setup the database and I can see that a session is created and stored in the database, but if i change the web.config or manually recycle the worker process my session is lost.  What am I doing wrong??</p>\n\n<p>Side note, I'm receiving the exact same behavior with StateServer mode.  I seemingly configure it properly, I can see the State service memory footprint get bigger when I login ....I tried to push a non serialized object into and received an error....but when I recycle the app pool or change the web.config I lose session....</p>\n\n<p>I've also tried to set up the Memcached session provider (which is what I would really like to use) that can be found here: <a href=\"http://memcachedproviders.codeplex.com/releases/view/10468\" rel=\"nofollow\">http://memcachedproviders.codeplex.com/releases/view/10468</a></p>\n\n<p>and it is also doing the same thing!  I can see the session being created in the database, and I will get an error pertaining to serialization when I try to interact with a non-serialized object....but I lose the session when the app pool is recycled.<br>\nAfter enabling some logging I'm seeing this in the event viewer:\n<strong>Event code: 1003 Event message: Application compilation is starting</strong></p>\n\n<p>Nobody??  I really need to get out of process session state working....help!!</p>\n"},{"tags":["c#","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":13015334,"title":"How can I clone an existing table schema to create a new empty table with the same structure, using C#?","body":"<p>I'm connecting to an SQL Server 2008 database.</p>\n\n<p>Using C#, I'd like to create a new table, with a name specified by me, which looks exactly like an existing table in that database.  There are no foreign keys involved.</p>\n\n<p>I have code like </p>\n\n<pre><code>DataTable table = con.GetSchema(\"Tables\");\nforeach (System.Data.DataRow row in table.Rows)\n{\n    foreach (System.Data.DataColumn col in table.Columns)\n</code></pre>\n\n<p>But it doesn't get me very far.  Do I really need to iterate over all the tables myself?  Even if I identify the <code>DataTable</code> how do I clone it?  I looked at <code>DataTable.Clone</code> but I can't see how to set a new name and create that table on the database.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":13013347,"title":"get data for per year","body":"<p>I have a problem with query so I have two tables : Job and Job answers,so to get number of answers of every job I do like that : </p>\n\n<pre><code>and ((month(a.created_at) = 10 and day(a.created_at) &gt;= 1) \n      or (month(a.created_at) between 11 and 12) \n      or (month(a.created_at) between 1 and 8) \n      or (month(a.created_at) = 9 and day (a.created_at) &lt;= 30))\n</code></pre>\n\n<p>Now I have another modification to do is to get a new number of answers of job by per year and between two date ( 1 september and 30 december for every year) [field : created_at] , </p>\n\n<pre><code>     +----------+-------+---------+------+----- +\n     | year     | job title | number of answers |\n     +----------+-------+---------+------+------+\n     | 2008     | Job1      | 58                | \n     | 2010     | Job2      | 45                | \n     | 2012     | Job3      | 122               |\n     +----------+-------+---------+------+------\n</code></pre>\n\n<p>year and date is in created_at field...</p>\n\n<p>Edit : </p>\n\n<p>for 01/10 to 30/9 I do : </p>\n\n<pre><code>  and ( (month(a.created_at) = 10 and day(a.created_at) &gt;= 1) \n        or month(a.created_at)   between 11 and 12 \n        or month(a.created_at) between 1 and 8 \n        or (month(a.created_at) = 9 and day (a.created_at) &lt;= 30))\n</code></pre>\n\n<p>edit 2 : </p>\n\n<pre><code> delimiter $$\nbegin\n\ndeclare @StartDay INT, @EndDay INT, @StartMonth INT, @EndMonth INT\nSelect @StartDay = 01, @StartMonth = 10, @EndDay = 30, @EndMonth = 09\n\nSelect year(a.created_at) as years , jd.JobDomain, count(a.Id) as nb_answer,   a.Job_id,   j.JobTitle \n from JobAppliance a\n inner join Job j on a.Job_id =  j.PublicId\n inner join JobDestination d on j.Id=d.Job_id\n inner join Jjobdomain jd on  j.Id = jd.Job_id\n\n and \n(\n@StartMonth = @EndMonth And \nMonth(a.created_at) = @StartMonth And \nDay(a.created_at) &gt;= @StartDay And \nDay(a.created_at) &lt;= @EndDay\n) Or (\n@StartMonth != @EndMonth And (\n(\n Month(a.created_at) = @StartMonth And\n  Day(a.created_at) &gt;= @StartDay\n) Or (\n  Month(a.created_at) Between @StartMonth + 1 And @EndMonth - 1\n) Or (\n  Month(a.created_at) = @EndMonth And\n  Day(a.created_at) &lt;= @EndDay\n)\n)\n)\n\ngroup by year(a.created_at) , a.Job_id, j.JobTitle;\n\nend$$\ndelimiter ;\n</code></pre>\n\n<p>I have a syntax error in declare?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","optimization"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":13013126,"title":"What's the most efficient way to write a single record to an MS SQL 2008 Server using .NET?","body":"<p>I'm writing a command-line tool (to run on Windows 7 boxes) that inserts a single record into a table and then exits.  I'm using C# (.NET 4.5) and SQL Server 2008.</p>\n\n<p>The record of data contains a large (up to 6000 bytes) string, a time-stamp and an auto-incrementing integer ID primary key.  There are no foreign keys attached to the table.</p>\n\n<p>Also, since this is the most common usage scenario for this database I'd like to optimise for it.  Are there any tricks with how I set up the database that will help keep individual insert times low?</p>\n\n<p>[EDIT]\nThe code I'm currently using...</p>\n\n<pre><code>SqlConnection con = new SqlConnection(ConnectionString);\ncon.Open();\nSqlTransaction trans = con.BeginTransaction();\n\nSqlCommand cmd = new SqlCommand(\"INSERT INTO [msglog](message,project,username,computername,updated_at) VALUES (@m,@p,@u,@c,@i,@t)\", con, trans);\ncmd.Parameters.AddWithValue(\"@u\", Username);\ncmd.Parameters.AddWithValue(\"@c\", Computername);\ncmd.Parameters.AddWithValue(\"@m\", msg);\ncmd.Parameters.AddWithValue(\"@p\", ProjectName);\ncmd.Parameters.AddWithValue(\"@t\", DateTime.Now);\ncmd.ExecuteNonQuery();\ntrans.Commit();\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","reportingservices-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":337,"score":0,"question_id":7307369,"title":"Opening SSRS 2005 reports in SQL Server 2008","body":"<p>We have some reports created in SQL Server 2005. But Recently we converted them into 2008. But now we are not able to open the same report project in 2008. It is showing an error like this : </p>\n\n<blockquote>\n  <p>E://Projects/...Reporting.rptproj cannot be opened because its project\n  type (.rptproj) is not supported by this version of the application.\n  To open it, please use a version that supports this type of projects.</p>\n</blockquote>\n\n<p>We have SQL Server 2008 with SP1 is installed. we are trying to open the reports using SQL Server 2008 Business Intelligence Development Studio.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":13011810,"title":"Need help in Pivoting","body":"<p>I have the below</p>\n\n<pre><code>Id  names   namevalues\n1   name1   first value1\n1   name2   first value2\n2   name1   second value1\n2   name2   second value2\n</code></pre>\n\n<p>DDL is as under</p>\n\n<pre><code>Declare @t table(Id int, names varchar(50),namevalues varchar(100))\nInsert Into @t select 1,'name1','first value1'\nInsert Into @t select 1,'name2','first value2'\nInsert Into @t select 1,'name1','second value1'\nInsert Into @t select 1,'name2','second value2'\n\nselect * from @t\n</code></pre>\n\n<p><strong>excepted output is</strong> </p>\n\n<pre><code>Id  name1           name2\n1   first value1    first value2\n2   second value1   second value2\n</code></pre>\n\n<p>my try</p>\n\n<pre><code>SELECT *\nFROM  @t AS src \nPIVOT ( \n    MAX(namevalues) FOR namevalues IN ([name1],[name2] ) \n) AS pvt \n</code></pre>\n\n<p>it's wrong....</p>\n\n<p>Please help</p>\n"},{"tags":["sql","sql-server","sql-server-2008","closures"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":67,"score":2,"question_id":13004825,"title":"Calculate number of cluster when i know about point in each cluster in sql","body":"<p>I'm trying to calculate number of cluster when I know all members of each cluster.</p>\n\n<p>I need a function in SqlServer2008 to solve this problem.</p>\n\n<p>My table has more than 14 million distinct records like this:</p>\n\n<pre><code>CREATE TABLE Test\n(\n   F1 varchar(5),\n   F2 varchar(5)\n)\nINSERT INTO TEST ( F1, F2) VALUES ( 'A', 'B')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'A', 'K')\nINSERT INTO TEST ( F1, F2) VALUES ( 'C', 'H')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'D', 'B')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'F', 'I')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'F', 'B')\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'D', 'H' )\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'E', 'G' )\nINSERT INTO TEST (  F1, F2 ) VALUES ( 'G', 'L' )\n</code></pre>\n\n<p>note that:</p>\n\n<pre><code>If A=B AND A=K THEN B=K \nIF E=G AND G=L THEN E=L\n</code></pre>\n\n<p>Now the output of the function should be as below:</p>\n\n<pre><code>ClusterNumber--- point\n1---A\n1---B\n1---k\n1---D\n1---F\n1---I\n1---H\n1---C\n2---E\n2---G\n2---L\n</code></pre>\n\n<p>I guess the solution would be a recursive function, but does not know it!</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":13010013,"title":"Save Images From Ajax Control Toolkit Editor to SQL Database","body":"<p>I am using the default text editor available using the ajax control toolkit and I need to save an image that a user can paste into the editor, into the database. The column in the database is varbinary(MAX) but when I try to save I get the error below</p>\n\n<blockquote>\n  <p>Implicit conversion from data type nvarchar(max) to varbinary(max) is not allowed. Use the CONVERT function to run this query</p>\n</blockquote>\n\n<p>I then later converted the content to byte like so </p>\n\n<pre><code>var subgrantdesc = Convert.ToByte(grantdescription_editor.Content);  \n</code></pre>\n\n<p>Then in the parameter definition I have this</p>\n\n<pre><code>var param0 = new SqlParameter();\nparam0.ParameterName = \"@desc\";\nparam0.SqlDbType = System.Data.SqlDbType.VarBinary;\nparam0.Value = subgrantdesc;\nsql.Parameters.Add(param0); \n</code></pre>\n\n<p>However I get the error:</p>\n\n<blockquote>\n  <p>System.FormatException: Input string was not in a correct format. at System.Number.StringToNumber....  </p>\n</blockquote>\n\n<p>The above error points to the line of code where I am converting to <code>Byte</code>.\nI would like to know how I can save data(images and text) entered through the editor control into the SQL server database. I also would like to know if the HTML formatting will be retained.</p>\n\n<p>Any help will be appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","gis","geospatial"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12965191,"title":"ST_PointN to get Points from Geometry Column","body":"<p>I have a Shapefile from which I am extracting Geometry column and storing it into Table.\nThis is sample data stored in Geometry column which has 432 points.</p>\n\n<blockquote>\n  <p>0x000000000104AC010000AB3E57ABBBC4384127A08938705B57414F401361C3C43841C9E53F846C5B574190A0F8E1F6C438410F0BB5766E....</p>\n</blockquote>\n\n<p>Now I want to extract each and Every point i.e. 432 points from the Geometry column and store it into another table. For that I am using <code>ST_PointN</code> column but it only gives me 1 point at a time. <code>ST_NumPoint</code> will give me 432 number but not all the points.</p>\n\n<p>How do I extract each and every point from Geometry column and store it into DB?</p>\n\n<p>Cheers,</p>\n"},{"tags":["sql-server-2008","ssis","ssis-data-transformations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":418,"score":0,"question_id":10050721,"title":"SSIS Excel -Retrieving minimum date value and storing it into a variable","body":"<p>I have an Excel Source which has got 1000 rows with some 10 columns  and one of the column is a Date Field ,We have to retrieve the minimum date value and assign it to a variable in ssis .Could you guys provide me a script or steps to map that value to the variable...So that i can use it in control flow task to perform truncate operation using the variable value.\nplease adviiiise</p>\n\n<p>your help in this regard is appreciated.\nRosh..</p>\n"},{"tags":["sql-server-2008","locking","deadlock","database-backups"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":12,"score":0,"question_id":13008769,"title":"MS SQL Server 2008, database completely locked","body":"<p>Our database becomes completely locked, and it seems that many tables not related to each other are locked at once. When this happens, it becomes locked for approximately 2 minutes, and when this happens it is not related to the amount of traffic that our application has at that time. </p>\n\n<p>We have tried to replicate the issue on our test servers by </p>\n\n<ul>\n<li>increasing the activity on the database (Inserts, Selects, Updates, Deleting), </li>\n<li>increasing the connections to the database simultaneously, </li>\n<li>increasing latch time, </li>\n<li>generating temporary locks on a particular table</li>\n</ul>\n\n<p>But could not arrive to a conclusion were this is coming from.</p>\n\n<p>Is there any type of configuration, or background running tasks of SQL Server, that may cause this (Backups, Transaction Log related stuff etc)? </p>\n\n<p>Is it possible to trace locks, by a date range (For example : Taking a snapshot of the current locks present in the database for a particular time)?</p>\n"},{"tags":["sql-server-2005","sql-server-2008","maintenance"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":1036,"score":1,"question_id":3184286,"title":"How to create maintenance plan in sql server?","body":"<p>when i m trying to create new maintenance plan in sql server it is popping up this error-</p>\n\n<pre><code>TITLE: Microsoft SQL Server Management Studio\n------------------------------\n\n'Agent XPs' component is turned off as part of the security configuration for \nthis server. A system administrator can enable the use of 'Agent XPs' by using   sp_configure. \nFor more information about enabling 'Agent XPs', see \"Surface Area   Configuration\" in \nSQL Server Books Online. (ObjectExplorer)  \n</code></pre>\n"},{"tags":["asp.net","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":51,"score":-2,"question_id":13007399,"title":"Trying to establish a connection with SQL Server 2008","body":"<pre><code>SqlConnection cnn = new SqlConnection();\ncnn.ConnectionString = \"Data Source=.;Database = deptStore;Integrated Security = true;\";\n\ncnn.Open();\nSqlCommand cmd = new SqlCommand();\ncmd.CommandText = \"insert into Employee values('\" + TextBox1.Text + \"','\" + TextBox2.Text + \"','\" + TextBox3.Text + \"','\" + TextBox4.Text + \"','\" + TextBox5.Text + \"','\" + TextBox6.Text + \"','\" + TextBox7.Text + \"','\" + TextBox8.Text + \"','\" + TextBox9.Text + \"','\" + TextBox10.Text + \"','\" + TextBox11.Text + \"','\" + TextBox12.Text + \"','\" + TextBox13.Text + \"')\";\ncmd.Connection = cnn;\n\ncmd.ExecuteNonQuery();\n\nResponse.Write(\"Record Save\");\ncnn.Close();\n</code></pre>\n\n<p>But I am getting following error:</p>\n\n<blockquote>\n  <p><em>SqlException was unhandled by user code</em></p>\n  \n  <p><em>A network-related or instance-specific error occurred while\n  establishing a connection to SQL Server. The server was not found or\n  was not accessible. Verify that the instance name is correct and that\n  SQL Server is configured to allow remote connections. (provider: Named\n  Pipes Provider, error: 40 - Could not open a connection to SQL Server)</em></p>\n</blockquote>\n\n<p>Kindly help me to understand the error and rectify it.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":13007673,"title":"Why does select @@version gives 2005 when I installed 2008","body":"<p>Apparently I see about in SQL Server Management Studio and I saw 2008 version.</p>\n\n<p>But when I perform </p>\n\n<pre><code>select @@version \n</code></pre>\n\n<p>I am seeing version 2005</p>\n\n<p>I think this explains why my stored procedure could run on another computer whose compatibility level=100</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":54,"score":-1,"question_id":13007830,"title":"How to create a procedure in SQL server that does not allow to alter a particular column of a table?","body":"<p>I want to create a procedure that don't allow me to alter a column of a table.</p>\n\n<p>I have already create a procedure that does not allow me to alter anything in a particular table but now I want to be specific to a particular column.</p>\n\n<p>So now I don't want to be rolling back in case of table alter instead i want to roll back if alter is made to particular column of table.</p>\n"},{"tags":["perl","sql-server-2008","config"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":13006624,"title":"Perl Syntax Error: bareword found where operator expected","body":"<p>This is my perl script code. in this i'm getting error like \"bareword found where operator expected at $cmd\"</p>\n\n<pre><code>my $path = $folder.\"/\".$host.\"_\".$database_name.\".bak\";\n$cmd .= \"-U $user_name -P $password -S $host -d master -Q \"BACKUP DATABASE [$database_name] TO DISK = N'$path'\" \";\n</code></pre>\n\n<p>any one help me?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":13006091,"title":"I need to combine multiple rows from a subquery into a string separated by a space","body":"<p>I'm creating an image gallery with albums. The gallery owner can first create one or more albums, and then create images to add to those albums. I'm having to use multiple view templates to pull this off. Regardless, here's what is hanging me up. Here is the core of my stored procedure:</p>\n\n<pre><code>DECLARE @MyString VARCHAR(MAX)\n\nSELECT @MyString = ISNULL(@MyString + ' ', ' ') + CAST(AlbumID AS VARCHAR(10)) + ' '\nFROM BD_AlbumGallery\nWHERE ImageID = PROBLEM HERE... Dont know what to do &lt;---\nORDER BY AlbumID\n\nSELECT a.[ImageID]\n      ,a.ImageFile\n      ,a.[ImageTitle]\n      ,a.[ImageCaption]\n      ,a.[Description]\n      ,a.[Active]\n      ,b.[AlbumID]\n      ,b.[ImageID]\n      ,c.[ListingID]\n      ,c.[Active]\n      ,c.[LevelID]\n      ,c.[Title]\n\n      ,@MyString AS AlbumClass\n\nFROM BD_Gallery A\nJOIN BD_AlbumGallery B\nON a.ImageID = b.ImageID\nJOIN BD_Listing C\nON a.ListingID = c.ListingID\nWHERE a.ListingID = @passedListingID\n  AND a.Active = 1\n  AND c.Active = 1\n  AND c.LevelID &gt; 5\n</code></pre>\n\n<p>So the problem is, the data is retrieved within a LI\nand one at a time of course... guess that's the obvious... to display properly in my gallery template.</p>\n\n<p>The only issue I'm having is I need the @MyString AS AlbumClass to be tied to a.ImageID, or b.ImageID, as they are the same.</p>\n\n<p>The reason is, the albums in the template are defined by a class.</p>\n\n<pre><code>&lt;li class=\"12 24 15 17\"&gt;Rest of my code for a single image result&lt;/li&gt;\n</code></pre>\n\n<p>So the AlbumID's being utilized as class names allows me to assign them to the jQuery dropdown category/album list that's in a template right before this one. I was thinking of a SubQuery. Ultimately, I need the results (for other reasons) to display in one result set.</p>\n\n<p>Please help.. Still trying to push my way through the learning curves.</p>\n\n<p>Thanks!</p>\n\n<ul>\n<li>Patrick</li>\n</ul>\n"},{"tags":["sql","oracle","sql-server-2008","recursion","common-table-expression"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":63,"score":1,"question_id":12971580,"title":"SYS_CONNECT_BY_PATH in SQL Server","body":"<p>I am working on a migration project and need to convert following Oracle query into it's SQL Server equivalent.</p>\n\n<pre><code>select SYS_CONNECT_BY_PATH (b.actionnr,'/') as FATHER, SYS_CONNECT_BY_PATH (b.actionnr,'     | ') as REFPATH, LEVEL, \n(select count(p.refactionnr) from zisjob.zj_action p where p.refactionnr=b.actionnr)\nChilds, b.* from \n( select NVL(x.ANZFiles,0) ANZFiles, act.actionnr, act.refactionnr, act.lfno, act.jobnr,     act.\"TYPE\", act.actiontype\nfrom zisjob.zj_action act, zisjob.zj_actiontype t, \n( select f.lno, count(f.filenr) as ANZFiles from zisjob.zj_file f where f.lno != f.lfno     Group by f.lno )x\nwhere act.lfno=10 and act.actiontype = t.typeid(+) and act.actionnr = x.lno(+) )\nb start with b.actionnr in \n(select b.actionnr from zisjob.zj_action b where b.lfno = 10 and b.refactionnr is    null)\nconnect by nocycle prior b.actionnr=b.refactionnr order by 1 desc, 2 asc\n</code></pre>\n\n<p>I am using CTEs to do this. So far, I've come up with following :</p>\n\n<pre><code>with h$cte as \n(\n   select\n      cast (convert(varchar,b.actionnr)+'/' as varchar(max)) as FATHER,\n      cast(convert(varchar,b.actionnr)+' | ' as varchar(max)) as REFPATH,\n      1 as LEVEL,\n      --cast (row_number() over (order by @@spid) as varchar(max)) as LEVEL,\n      (select count(p.refactionnr) from zisjob.zj_action p \n       where p.refactionnr = b.actionnr) Childs, \n      b.* \n   from\n     (select \n         isnull(x.ANZFiles, 0) ANZFiles, act.actionnr, act.refactionnr, act.lfno,  \n         act.jobnr, act.\"TYPE\", act.actiontype\n      from zisjob.zj_action act \n      left outer join zisjob.zj_actiontype t on act.actiontype = t.typeid \n      left outer join\n          (select f.lno, count(f.filenr) as ANZFiles \n           from zisjob.zj_file f\n           where f.lno != f.lfno Group by f.lno ) x on act.actionnr = x.lno\n      where act.lfno = 10) b\nwhere \n   b.actionnr in\n       (select b.actionnr from zisjob.zj_action b \n        where b.lfno = 10 and b.refactionnr is null)\n\nUNION ALL\n\nselect\n    CAST(FATHER + '/'+ b.ACTIONNR as varchar(max)) as FATHER,\n    CAST(REFPATH + '|'+b.ACTIONNR AS VARCHAR(MAX)) as REFPATH,\n    h$cte.LEVEL + 1 as LEVEL,\n    (select count(p.refactionnr) from zisjob.zj_action p  \n     where p.refactionnr = b.actionnr) Childs, \n    b.*\nfrom\n   (select isnull(x.ANZFiles, 0) ANZFiles, act.actionnr, act.refactionnr, \n           act.lfno, act.jobnr, act.\"TYPE\", act.actiontype\n    from zisjob.zj_action act \n    left outer join zisjob.zj_actiontype t on act.actiontype = t.typeid \n    left outer join\n        (select f.lno, count(f.filenr) as ANZFiles from zisjob.zj_file f\n         where f.lno != f.lfno Group by f.lno) x on act.actionnr = x.lno\n    where act.lfno = 10) b, \n    h$cte\nwhere \n    b.actionnr in\n        (select b.actionnr from zisjob.zj_action b \n         where b.lfno = 10 and b.refactionnr is null)\n    and h$cte.ACTIONNR = h$cte.REFACTIONNR\n)\nselect &lt;columns&gt; from h$cte\n</code></pre>\n\n<p>The translated query giving following errors:</p>\n\n<blockquote>\n  <p><em>Msg 467, Level 16, State 1, Line 1</em><br>\n  <em>GROUP BY, HAVING, or aggregate functions are not allowed in the recursive part of a     recursive common table expression 'h$cte'.</em></p>\n  \n  <p><em>Msg 462, Level 16, State 1, Line 1</em><br>\n  <em>Outer join is not allowed in the recursive part of a recursive common table expression 'h$cte'</em></p>\n</blockquote>\n\n<p>How can I work around this? Any help in any form is greatly appreciated. Thanks in advance.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":13006399,"title":"SQL Server 2008 trigger error remove","body":"<p>I have created a trigger in SQL Server 2008</p>\n\n<pre><code>CREATE TRIGGER [dbo].[ITEM_UOM_DELETE] ON\n   [dbo].[ITEM_UOM] INSTEAD OF DELETE\n   AS\n      declare @rowc int\n      set @rowc = (select count(*) from stock, deleted where \n      item = deleted.itemcode and uom = DELETED.MAINUNIT AND DOCTYPE &lt;&gt; 'OP')\n         if @rowc &gt; 0\n         begin\n           raiserror('Unit is in Use Cannot Delete', 16, 1)\n           rollback transaction\n         end\n</code></pre>\n\n<p>on execution of this trigger it gives the error output</p>\n\n<blockquote>\n  <p>Msg 50000, Level 16, State 1, Procedure ITEM_UOM_DELETE, Line 11<br>\n  Unit is in Use Cannot Delete<br>\n  Msg 3609, Level 16, State 1, Line 1<br>\n  The transaction ended in the trigger. The batch has been aborted.</p>\n</blockquote>\n\n<p>I want the defined error only</p>\n\n<blockquote>\n  <p><em>Unit is in Use Cannot Delete</em></p>\n</blockquote>\n\n<p>How to remove the error 'The transaction ended in the trigger. The batch has been aborted.' ?</p>\n"},{"tags":["sql-server-2008","bulkinsert"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":89,"score":3,"question_id":12992598,"title":"Bulk Insert into SQL Server 2008","body":"<pre><code>for (int i = 0; i &lt; myClass.Length; i++)\n{\n        string upSql = \"UPDATE CumulativeTable SET EngPosFT = @EngPosFT,EngFTAv=@EngFTAv WHERE RegNumber =@RegNumber AND Session=@Session AND Form=@Form AND Class=@Class\";\n        SqlCommand cmdB = new SqlCommand(upSql, connection);\n\n        cmdB.CommandTimeout = 980000;\n\n        cmdB.Parameters.AddWithValue(\"@EngPosFT\", Convert.ToInt32(Pos.GetValue(i)));\n        cmdB.Parameters.AddWithValue(\"@RegNumber\", myClass.GetValue(i));\n        cmdB.Parameters.AddWithValue(\"@EngFTAv\", Math.Round((engtot / arrayCount), 2));\n        cmdB.Parameters.AddWithValue(\"@Session\", drpSess.SelectedValue);\n        cmdB.Parameters.AddWithValue(\"@Form\", drpForm.SelectedValue);\n        cmdB.Parameters.AddWithValue(\"@Class\", drpClass.SelectedValue);\n\n\n        int idd = Convert.ToInt32(cmdB.ExecuteScalar());\n}\n</code></pre>\n\n<p>assuming <code>myClass.Length</code> is 60. This does 60 update statements. How can I limit it to 1 update statement. Please code example using the above code will be appreciated. Thanks</p>\n\n<p>Tried using this</p>\n\n<p>StringBuilder command = new StringBuilder();</p>\n\n<pre><code>            SqlCommand cmdB = null;\n            for (int i = 0; i &lt; myClass.Length; i++)\n            {\n                command.Append(\"UPDATE CumulativeTable SET\" + \" EngPosFT = \" + Convert.ToInt32(Pos.GetValue(i)) + \",\" + \" EngFTAv = \" + Math.Round((engtot / arrayCount), 2) +\n        \" WHERE RegNumber = \" + myClass.GetValue(i) + \" AND Session= \" + drpSess.SelectedValue + \" AND Form= \" + drpForm.SelectedValue + \" AND Class= \" + drpClass.SelectedValue + \";\");\n\n               //or command.AppendFormat(\"UPDATE CumulativeTable SET EngPosFT = {0},EngFTAv={1} WHERE RegNumber ={2} AND Session={3} AND Form={4} AND Class={5};\", Convert.ToInt32(Pos.GetValue(i)), Math.Round((engtot / arrayCount), 2), myClass.GetValue(i), drpSess.SelectedValue, drpForm.SelectedValue, drpClass.SelectedValue);\n\n\n\n            }//max length is 128 error is encountered\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":37,"score":-1,"question_id":12989275,"title":"How to refactor sql subquery field in sql?","body":"<p>i want to create a sql query which must select sum subquery also make Alacak-Borc process. But i can not.\nhow to make it (Alacak-Borc As BAKIYE) and how to REFACTOR BELOW CODE? thanks...</p>\n"},{"tags":["database","sql-server-2008","query","grails-2.0","grails-controller"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":78,"score":2,"question_id":12967518,"title":"SQL Querying Database","body":"<p>I have this following query\n <code>\"select abc from table where val = 1\"</code><br/>\nThe result i got was </p>\n\n<pre><code> [{abc=5}]\n</code></pre>\n\n<p>However, I <strong>need just the integer value 5</strong> from the result <strong>instead of the array[{abc=5}]</strong>.<br/>\nAnyone have any idea on how to do this? thanks\n*My friend told me that I will need to use substring to get just the 5 out from the [{abc=5}], but i have completely no clue on how to work on it. Any help will be appreciated!</p>\n\n<p>*edited </p>\n"},{"tags":["sql-server-2008","tsql","query-execution-plans","sql-execution-plan"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":1200,"score":4,"question_id":8460416,"title":"query optimizer operator choice - nested loops vs hash match (or merge)","body":"<p>One of my stored procedures was taking too long execute. Taking a look at query execution plan I was able to locate the operation taking too long. It was a nested loop physical operator that had outer table (65991 rows) and inner table (19223 rows). On the nested loop it showed estimated rows = 1,268,544,993 (multiplying 65991 by 19223) as below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/MfaML.png\" alt=\"enter image description here\"></p>\n\n<p>I read a few articles on physical operators used for joins and got a bit confused whether nested loop or hash match would have been better for this case. From what i could gather:</p>\n\n<p>Hash Match - is used by optimizer when no useful indexes are available, one table is substantially smaller than the other, tables are not sorted on the join columns. Also hash match might indicate more efficient join method (nested loops or merge join) could be used.</p>\n\n<p><strong>Question:</strong> Would hash match be better than nested loops in this scenario?</p>\n\n<p>Thanks </p>\n"},{"tags":["vb.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12593695,"title":"Creating a simple CRUD wth VB 2010 ans SQL Server 2008","body":"<p>I'm a VB6.0 and I'm new to VB 2010 since I moved to web development job. </p>\n\n<p>I need your help in connecting vb2010 to sql server in any ways. I also want to know how to make a very simple CRUD in vb2010 and display it's records in a data grid or listview. </p>\n"},{"tags":["sql","sql-server-2008","check-constraints"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":13000698,"title":"Sub queries in check constraint","body":"<p>I have table designed in SQL Server 2008.</p>\n\n<p>I have a column in that table which needs to be checked against another table when data is inserting. </p>\n\n<pre><code>ALTER TABLE Table1\n        WITH CHECK ADD CONSTRAINT CK_Code\n        CHECK (MyField in (Select Field From Table2))\n</code></pre>\n\n<p>This cause an error </p>\n\n<blockquote>\n  <p><em>Sub-queries are not allowed in this context. Only scalar expressions are allowed.</em></p>\n</blockquote>\n\n<p>I have looked at this question about <a href=\"http://stackoverflow.com/questions/9722433/check-constraint-subqueries-are-not-allowed-in-this-context\">Check Constraint - Subqueries are not allowed in this context</a>.</p>\n\n<p>Is there any way of achieving this without using a trigger?</p>\n"},{"tags":["sql","xml","sql-server-2008","xpath","xquery"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":13000743,"title":"Concatenating text of child nodes into a single column","body":"<p>I'm working with an API that returns property information.  Some of the textual information is stored across child nodes and I'd like to concatenate it into a single string (VARCHAR).</p>\n\n<p>My process is that I obtain the xml through a webservice, then pass this through to a proc which extracts the xml values and inserts them into a view, this is a snippet of the xml that I'm getting back:</p>\n\n<pre><code>&lt;properties&gt;\n    &lt;property propertyid=\"1234\"&gt;\n        &lt;bullets&gt;\n            &lt;bullet&gt;nice garden&lt;/bullet&gt;\n            &lt;bullet&gt;it smells a bit&lt;/bullet&gt;\n            &lt;bullet&gt;body under the patio&lt;/bullet&gt;\n        &lt;/bullets&gt;\n    &lt;/property&gt;\n    ...\n&lt;/properties&gt;\n</code></pre>\n\n<p>This is a glimpse into how the xml is being queried to extract values from it:</p>\n\n<pre><code>INSERT        \nINTO          VProperty\n(             PropertyId,\n              Description\n)\nSELECT        P.value('@propertyid', 'INT'),\n              NULL -- extract all the bullet text values into a single string\nFROM          @xml.nodes('/properties/property')\n</code></pre>\n\n<p>In this example, I'd like to be able to extract the information from the xml so it ends up like this:</p>\n\n<pre><code>PropertyId    Description\n1234          'nice garden\\r\\nit smells a bit\\r\\nbody under the patio\n</code></pre>\n\n<p>Is this going to be possible in pure sql/xml or am I going to need to perform some pre-processing on the xml before I enter SQL land?</p>\n\n<p>Any help greatly appreciated (as always).</p>\n"},{"tags":["sql-server-2008","deadlock","database-deadlocks"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":66,"score":2,"question_id":12399401,"title":"deadlock between update on a set of rows and select some of the same rows","body":"<p>I have two SPID's running as transcations and below is what each one does among other things.</p>\n\n<p>SPID A -</p>\n\n<ol>\n<li>Updates rows 1-10 from table 1</li>\n<li>.......</li>\n</ol>\n\n<p>SPID B - </p>\n\n<ol>\n<li>Updates row 5 from table 1</li>\n<li>Selects rows 4,5 &amp; 6 from table 1 and updates a row in table 2.</li>\n<li>......</li>\n<li>......</li>\n</ol>\n\n<p>I'm facing a deadlock scenario where SPID A has updated row 4 and waiting for X lock on the clustered index to update row 5 and SPID B is in step 2 waiting for a S lock on the clustered index for row 4 which is in X lock by SPID A.\nThere is also a non clustered index on table 1 but it does not cover the select query, so it looks up the clustered index. I'm assuming that even if I make it a covering index SPID A will hold a lock on the non clustered index making SPID B to wait on it. \nI'm considering escalating the isolation level to serialization so that SPID A which is more or less updating the whole table will have to wait to acquire its lock if SPID B has already  started on its update to row 5. Also it will prevent SPID B from acquiring the x locks if SPID A has already begun. SPID A currently executes every 20 minutes and holds on to the transaction for about 10 secs.</p>\n\n<p>What other suggestions would any of you have for me to get rid of this deadlock?\nThanks.</p>\n"},{"tags":["sql-server-2008","visual-studio-2010"],"answer_count":6,"favorite_count":9,"up_vote_count":36,"down_vote_count":0,"view_count":107575,"score":36,"question_id":3536023,"title":"How to install sql server management studio 2008 component only","body":"<p>below is a list of the sql components that I installed in the Visual Studio 2010 Professional setup. Sadly, while trying to work I could not find <strong>sql server management studio 2008</strong> . </p>\n\n<p>Is there a way to download the sql server management studio 2008 separately and install only that component ?</p>\n\n<p>Since in the past I installed sql server management studio 2005 with a whole new instance of sql server 2005 and had couple of instances and it was a bit messy.</p>\n\n<p>Thank you</p>\n\n<p><img src=\"http://i.stack.imgur.com/CB0Do.jpg\" alt=\"alt text\"></p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12993853,"title":"Join the table valued function in the query","body":"<p>I have one table vwuser. I want join this table with the table valued function fnuserrank(userID). So I need to cross apply with table valued function:</p>\n\n<pre><code>SELECT *\nFROM vwuser AS a\nCROSS APPLY fnuserrank(a.userid)\n</code></pre>\n\n<p>For each userID it generates multiple records. I only want the last record for each empid that does not have a Rank of Term(inated).  How can I do this?</p>\n\n<p>Data:</p>\n\n<pre>\nHistoryID empid  Rank  MonitorDate\n1          A1     E1    2012-8-9\n2          A1     E2    2012-9-12 \n3          A1     Term  2012-10-13\n4          A2     E3     2011-10-09\n5          A2     TERM   2012-11-9 \n</pre>\n\n<p>From this 2nd record and 4th record must be selected.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":165,"score":2,"question_id":12999631,"title":"Split string by comma in SQL Server 2008","body":"<p>There are two strings <code>a</code> and <code>b</code></p>\n\n<p>The <code>a</code> string contains comma. I would like to split the a string by comma, then go through every element .</p>\n\n<p>IF the <code>b</code> string contains any element which split by comma will return 0</p>\n\n<p>(e.g: a = <code>\"4,6,8\"</code> ; b = <code>\"R3799514\"</code> because the <code>b</code> string contains 4 so return 0)</p>\n\n<p>How to achieve this with a stored procedure? Thanks in advance!</p>\n\n<p>I have seen a split function:</p>\n\n<pre><code>CREATE FUNCTION dbo.Split(@String varchar(8000), @Delimiter char(1))     \nreturns @temptable TABLE (items varchar(8000))     \nas     \nbegin     \ndeclare @idx int     \ndeclare @slice varchar(8000)     \n\nselect @idx = 1     \n    if len(@String)&lt;1 or @String is null  return     \n\nwhile @idx!= 0     \nbegin     \n    set @idx = charindex(@Delimiter,@String)     \n    if @idx!=0     \n        set @slice = left(@String,@idx - 1)     \n    else     \n        set @slice = @String     \n\n    if(len(@slice)&gt;0)\n        insert into @temptable(Items) values(@slice)     \n\n    set @String = right(@String,len(@String) - @idx)     \n    if len(@String) = 0 break     \nend \nreturn     \nend\n\nselect top 10 * from dbo.split('Chennai,Bangalore,Mumbai',',')\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","insert","updates","multilanguage"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12999108,"title":"How to insert multi language data in SQL Server using N?","body":"<p>I know by using <code>N'...'</code> we can insert multi language data into SQL Server. But I don't know how to use it with parameters. Please help me.. </p>\n\n<p>My code is :</p>\n\n<pre><code>Alter proc proc_T_NewsAddUpdate\n(  \n    @Id bigint,  \n    @Title nvarchar(500),\n    @Description nvarchar(1000),  \n    @image nvarchar(200),  \n    @DateOfNews datetime,  \n    @CreatedBy bigint,  \n    @ModifiedBy bigint,  \n    @IsVisible int,  \n    @IsDeleted int  \n)  \nas  \n    if exists(select 1 from T_LatestNews where ID=@Id)  \n    begin  \n        Update t_LatestNews \n        set Titlle = N@Title, \n            DesCription = N@Description,\n            Image = N@image,\n            dateOfnews = @DateOfNews,\n            modifiedDate = GETDATE(),\n            ModifiedBy = @ModifiedBy,\n            Isvisible = @IsVisible,\n            isdeleted = @IsDeleted \n         where \n            ID=@Id  \n\n        select 1  \n    end  \n    else  \n    begin  \n        insert into t_latestnews (Titlle, Description, Image, dateofnews, CreatedDate, ModifiedDate, CreatedBy, ModifiedBy, isvisible, isdeleted) \n        values(@Title, @Description, @image, @DateOfNews, GETDATE(), GETDATE(), @CreatedBy, @ModifiedBy, @IsVisible, @IsDeleted)  \n\n        select 1  \n    end\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","sql-server-2005"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12984088,"title":"sql - max from group flag setter","body":"<p>I m trying to achieve flag setting for the condition in my table below</p>\n\n<pre><code>p_id      mon_year      e_id     flag  \n----      ---------     -----    -----\n 1          2011/11       20       0\n 1          2011/11       21       1\n 1          2012/01       22       1\n 1          2012/02       23       0\n 1          2012/02       24       0\n 1          2012/02       25       1\n 2          2011/11       28       0\n 2          2011/11       29       1\n 2          2012/01       30       1\n</code></pre>\n\n<p>grouping by p_id,e_id and mon_year, the flag is set for the last value in the month.</p>\n\n<p>I m confused how can i achieve this</p>\n\n<p>I tried to achieved this by using row_number and partition to seperate out the value. By still looking for to achieved</p>\n\n<p>Output by using row_number query , i have got is as below:</p>\n\n<p>Grouping by </p>\n\n<pre><code>p_id      mon_year      e_id     row\n----      ---------     -----    -----\n 1          2011/11       20       1\n 1          2011/11       21       2\n 1          2012/01       22       1\n 1          2012/02       23       1\n 1          2012/02       24       2\n 1          2012/02       25       3\n 2          2011/11       28       1\n 2          2011/11       29       2\n 2          2012/01       30       1\n</code></pre>\n\n<p>Max of this value would set the flag column. But i m really bugged how to achieve it. Any help would be useful.</p>\n\n<p>Thanks !!</p>\n"},{"tags":[".net","sql","sql-server","windows","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":74,"score":-2,"question_id":12997384,"title":"SQL Server 2008 R2 in Windows Server 2008 R2","body":"<p>i want to install SQL Server 2008 R2.\nI clicked on the setup.exe and a message box popup:\n\"Microsoft .NET Framework 3.5 installation has failed.\nSQL Server 2008 Setup requires .NET Framework to be installed.\"</p>\n\n<h1>this is the sqlsetup.txt file in %temp%</h1>\n\n<p>setup launched\nAttempting to determine media source\nMedia Source value not specified on command line argument\nSetup is launched from media directly so default the value to the current folder\nMedia Source: S:\\SQL_Svr_Standard_Edtn_2008_R2_English_MLF_X16-29588\\\nAttemp to determine media layout based on file 'S:\\SQL_Svr_Standard_Edtn_2008_R2_English_MLF_X16-29588\\mediainfo.xml'\nMedia layout is detected as: Full\nNot a slip stream media, so continuing to run setup.exe from media\n/? or /HELP or /Action=HELP specified: false\nHelp display: false\nChecking to see if we need to install .net version 3.5\nDetermining the cluster status of the local maschine\nThe local maschine is not configured as a cluster node\nAttempting to find media for .Net version 3.5\nError: Cannot determine file version of .NET redist: 0x80004005\n.Net Version 3.5 installation failed, so setup will close. Error code: 0x80004005</p>\n\n<h1>Setup closed with exit code: 0x80004005</h1>\n\n<p>thank you very much for any help</p>\n"},{"tags":["sql-server","sql-server-2008","database-mail"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12233638,"title":"Database Mail in Sql Server 2008 not working","body":"<p>I am using Database Mail feature of SQL Server 2008 for the first time to send mail.</p>\n\n<p>I followed the steps in <a href=\"http://blog.sqlauthority.com/2008/08/23/sql-server-2008-configure-database-mail-send-email-from-sql-database/\" rel=\"nofollow\">Example</a></p>\n\n<p>All seems good. Send status in </p>\n\n<pre><code>SELECT * FROM sysmail_allitems \n</code></pre>\n\n<p>is sent.</p>\n\n<p>But the recipient hasn't received any mail..</p>\n\n<p>What could be the issue?</p>\n"},{"tags":["php","sql-server-2005","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":927,"score":3,"question_id":1471723,"title":"PHP - SQL Server 2005 express to 2008 standard problem","body":"<p>I have a PHP app running happily on the following system:</p>\n\n<ul>\n<li>web app: PHP version 5.2.3 </li>\n<li>OS: Windows Server 2003 Standard 32 bit </li>\n<li>database: SQL Server 2005 (express)</li>\n<li>web server: IIS 6</li>\n</ul>\n\n<p>I'm trying to get the same thing running on the following:</p>\n\n<ul>\n<li>web app: PHP version 5.2.11</li>\n<li>OS: Windows Server 2008 Standard 64 bit</li>\n<li>database: SQL Server 2008 Standard 64-bit</li>\n<li>web server: IIS 7</li>\n</ul>\n\n<p>After doing the install and setup I usually do, phpinfo() is running but there is no MSSQL section. I've looked around and found some MS documentation to set up the system using a <code>php_sqlsrv.dll</code> and tried that but it seems to use a different interface to connect to the database (no more <code>mssql_connect()</code>, now it's <code>sqlsrv_connect()</code>). Is this the only way to connect php to SQL Server 2008 or do I just have the setup wrong? If I can go back to PHP 5.2.3 and have it work, that will be fine but I didn't want to undo what I have if it won't help.</p>\n\n<p>Thanks,</p>\n"},{"tags":["tsql","sql-server-2008","sorting"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":342,"score":2,"question_id":5417735,"title":"Topological sorting in sql","body":"<p>I am resolving dependency between some objects in a table.\nI have to do something with objects in order their dependency.\nFor example, the first object doesn't depend on any object. The second and third ones depends on first one and so on. I have to use  <a href=\"http://en.wikipedia.org/wiki/Topological_sorting\" rel=\"nofollow\">topological sorting</a>.\nCould someone show the sample of implementation so sorting in t-sql.\nI have a table:</p>\n\n<pre><code>create table dependency\n(\n  DependencyId PK\n  ,ObjectId\n  ,ObjectName\n  ,DependsOnObjectId\n)\n</code></pre>\n\n<p>I want to get</p>\n\n<p>ObjectId\nObjectName\nSortOrder</p>\n\n<p>Thank you.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12994914,"title":"Insert query to import data from other database from another server","body":"<p>Normally the Insert query to import data would be:</p>\n\n<pre><code>Insert Into mytable\nSelect * From otherDB.dbo.Othertable\n</code></pre>\n\n<p>but problem is otherDB is not within my current server. It is on a different machine hosted online. Can you please tell what changes should be there to import it from different DB?</p>\n"},{"tags":["sql-server-2008","tsql","table-valued-parameters"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":294,"score":2,"question_id":8022682,"title":"How can I use a Table-Valued Parameter to insert multiple rows and then return their IDs?","body":"<p>In my application, I have a large of number (100+) of rows that I need to insert into the database.  Once they get inserted into the database, I need to insert their children, which have a foreign key reference back to the children.</p>\n\n<p>I'm wondering if there's a way to write a stored procedure that can insert all of those rows and return their IDs back to my application?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12993149,"title":"SQL Server single stored procedure for insertion","body":"<p>I am trying to create a stored procedure in SQL Server 2008 which can insert data into any table (not table specific). I created one shown below, but during execution of the procedure an exception is thrown i.e. </p>\n\n<blockquote>\n  <p><em>Invalid object name 'dbo.@table'.</em></p>\n</blockquote>\n\n<p>Stored procedure code:</p>\n\n<pre><code>CREATE PROCEDURE dbo.sp_InsertValues\n   @table varchar(15)\n   , @fields varchar(100)\n   , @values varchar(100)   \nAS\nBEGIN\n   INSERT INTO [dbo].[@table] (@fields) VALUES (@values)\nEND\nGO\n</code></pre>\n\n<p>Remember I checked the parameters table, columns and values parameters are not null.</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":569,"score":1,"question_id":6773496,"title":"How to replace clustered index scan with a non-clustered index seek or clustered index seek?","body":"<p>Below is my create table script:-</p>\n\n<pre><code>CREATE TABLE [dbo].[PatientCharts](\n[PatientChartId] [uniqueidentifier] ROWGUIDCOL  NOT NULL,\n[FacilityId] [uniqueidentifier] NOT NULL,\n[VisitNumber] [varchar](200) NOT NULL,\n[MRNNumber] [varchar](100) NULL,\n[TimeIn] [time](7) NULL,\n[TimeOut] [time](7) NULL,\n[DateOfService] [date] NULL,\n[DateOut] [date] NULL),\n</code></pre>\n\n<p>I have one clustered index on PatientChartId and two non-clustered index on VisitNumber and MRNNumber. This table has millions of records.</p>\n\n<p>The following query is doing a clustered index scan:-</p>\n\n<pre><code>SELECT  *\nFROM    dbo.PatientCharts\nINNER JOIN ( SELECT FacilityID\n                 FROM   Facilities\n                 WHERE  RemoteClientDB IN (\n                        SELECT  SiteID\n                        FROM    RemoteClient WITH ( NOLOCK )\n                        WHERE   Code = 'IN-ESXI-EDISC14'\n                                )\n               ) AS Filter ON dbo.PatientCharts.FacilityId = Filter.FacilityID   \n</code></pre>\n\n<p>This clustered index scan is taking a lot of time in production because of data volume.</p>\n\n<p>The execution plan is :-</p>\n\n<p><img src=\"http://i.stack.imgur.com/Qzquj.png\" alt=\"enter image description here\"></p>\n\n<p>I have even tried adding a Non-clusted index on FacilityID and including PatientChartID but still the same execution plan. </p>\n\n<p>I am doing DBCC FREEPROCCACHE  everytime to instruct sql server to use a new plan every time. </p>\n\n<p>Is there anything else which I should do to prevent clusteredindex scan ?</p>\n"},{"tags":["sql-server-2008","ssis","script-component"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":845,"score":0,"question_id":5833511,"title":"SSIS: Remove Empty Row from outputbuffer","body":"<p>I have an error on a data flow task.  </p>\n\n<p>i have an ado.net source going to an async script component.</p>\n\n<p>the problem comes at the very end of the insert from the script component to the destination where it </p>\n\n<p>tries to put the empty row it automatically puts in the output buffer in my table.</p>\n\n<p>Is there a way to prevent this from happening/ how can i manipulate the output buffer so i can remove specific rows from it?</p>\n"},{"tags":["c#","asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":36,"score":0,"question_id":12996142,"title":"Getting SSL Provider Error when using IntegratedSecurity","body":"<pre><code>SqlConnection cnn = new SqlConnection();\ncnn.ConnectionString = \"Data Source=.;Database = deptStore;Integrated Security = true;\";\ncnn.Open();\nSqlCommand cmd = new SqlCommand();\ncmd.CommandText = \"insert into Employee values('\" + TextBox1.Text + \"','\" + TextBox2.Text + \"','\" + TextBox3.Text + \"','\" + TextBox4.Text + \"','\" + TextBox5.Text + \"','\" + TextBox6.Text + \"','\" + TextBox7.Text + \"','\" + TextBox8.Text + \"','\" + TextBox9.Text + \"','\" + TextBox10.Text + \"','\" + TextBox11.Text + \"','\" + TextBox12.Text + \"','\" + TextBox13.Text + \"')\";\ncmd.Connection = cnn;\ncmd.ExecuteNonQuery();\nResponse.Write(\"Record Save\");\ncnn.Close();\n</code></pre>\n\n<p>But I am getting following Error:</p>\n\n<p>SqlConnection cnn = new SqlConnection();\n                cnn.ConnectionString = \"Data Source=.;Database = deptStore;Integrated Security = true;\";</p>\n\n<pre><code>            cnn.Open();\n            SqlCommand cmd = new SqlCommand();\n            cmd.CommandText = \"insert into Employee values('\" + TextBox1.Text + \"','\" + TextBox2.Text + \"','\" + TextBox3.Text + \"','\" + TextBox4.Text + \"','\" + TextBox5.Text + \"','\" + TextBox6.Text + \"','\" + TextBox7.Text + \"','\" + TextBox8.Text + \"','\" + TextBox9.Text + \"','\" + TextBox10.Text + \"','\" + TextBox11.Text + \"','\" + TextBox12.Text + \"','\" + TextBox13.Text + \"')\";\n            cmd.Connection = cnn;\n            cmd.ExecuteNonQuery();\n            Response.Write(\"Record Save\");\n            cnn.Close();\n</code></pre>\n\n<p>But iam getting following Error:\nSqlException was unhandled by user code</p>\n\n<p>A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)</p>\n\n<p>Kindly help me to understand the error and rectify it.</p>\n"},{"tags":["java","sql-server-2008","google-app-engine"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":92,"score":0,"question_id":12953690,"title":"Java GAE :: Error: \"Permission denied: Not allowed to issue a socket connect: permission denied..","body":"<p>I got Error when running application as Web Application but the same file when I'm running as a Java Application it is working fine..\nLet me explain in bit more details \nHere is the code which when I'm running as a Java application it is working perfect</p>\n\n<pre><code> package com.gst.user.dao.impl;\nimport java.sql.CallableStatement;\nimport java.sql.DriverManager;\nimport java.sql.Connection;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\n\npublic class Sqldbconnect {\n\n    public static void main(String[] argv) throws SQLException {\n\n        System.out.println(\"-------- SQL JDBC Connection Testing ------\");\n\n        try {\n\n            Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n\n        } catch (ClassNotFoundException e) {\n\n            System.out.println(\"Where is your mysql jdbc Driver?\");\n            e.printStackTrace();\n            return;\n\n        }\n\n        System.out.println(\"Mysql JDBC Driver Registered!\");\n\n        Connection connection = null;\n\n        try {\n\n            connection = DriverManager.getConnection(\n                    \"jdbc:sqlserver://Idatabase:65535;DatabaseName=Data_Base\", \"DUser\",\"DPass\");\n\n        } catch (SQLException e) {\n\n            System.out.println(\"Connection Failed! Check output console\");\n            e.printStackTrace();\n            return;\n\n        }\n\n        if (connection != null) {\n            System.out.println(\"You made it!\");\n            connection.close();\n        } else {\n            System.out.println(\"Failed to make connection!\");\n        }\n    }\n\n}\n</code></pre>\n\n<p>But almost the same thing and in the same package if I try to run as web application it throws exception..\nHere is the code for that</p>\n\n<pre><code>package com.gst.user.dao.impl;\n\nimport java.sql.CallableStatement;\nimport java.sql.Connection;\nimport java.sql.DriverManager;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\n\nimport com.gst.user.dao.CallSPDao;\n\npublic class CallSPDaoImpl implements CallSPDao {\n\n    @Override\n    public void callSPDao() throws SQLException {\n        // TODO Auto-generated method stub\n        System.out.println(\"Calling Stored processor Begins\");\n\n        System.out.println(\"-------- SQL JDBC Connection Testing ------\");\n\n        try {\n\n            Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n\n        } catch (ClassNotFoundException e) {\n\n            System.out.println(\"Where is your mysql jdbc Driver?\");\n            e.printStackTrace();\n            return;\n\n        }\n\n        System.out.println(\"Mysql JDBC Driver Registered!\");\n\n        Connection connection = null;\n\n        try {\n\n            connection = DriverManager.getConnection(\n                    \"jdbc:sqlserver://Idatabase:65535;DatabaseName=Data_Base\", \"DUser\",\"DPass\");\n                //  \n        } catch (SQLException e) {\n\n            System.out.println(\"Connection Failed! Check output console\");\n            e.printStackTrace();\n            return;\n\n        }\n\n        if (connection != null) {\n            System.out.println(\"You made it!\");\n            connection.close();\n        } else {\n            System.out.println(\"Failed to make connection!\");\n        }\n    }\n\n\n    }\n</code></pre>\n\n<p>And the exception is ::</p>\n\n<pre><code>com.microsoft.sqlserver.jdbc.SQLServerException: The TCP/IP connection to the host IL93SQLF031, port 65535 has failed. Error: \"Permission denied: Not allowed to issue a socket connect: permission denied.. Verify the connection properties, check that an instance of SQL Server is running on the host and accepting TCP/IP connections at the port, and that no firewall is blocking TCP connections to the port.\".\nat com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDriverError(SQLServerException.java:170)\nat com.microsoft.sqlserver.jdbc.SQLServerConnection.connectHelper(SQLServerConnection.java:1049)\nat com.microsoft.sqlserver.jdbc.SQLServerConnection.login(SQLServerConnection.java:833)\nat com.microsoft.sqlserver.jdbc.SQLServerConnection.connect(SQLServerConnection.java:716)\nat com.microsoft.sqlserver.jdbc.SQLServerDriver.connect(SQLServerDriver.java:841)\nat java.sql.DriverManager.getConnection(DriverManager.java:582)\nat java.sql.DriverManager.getConnection(DriverManager.java:185)\nat com.gst.user.dao.impl.CallSPDaoImpl.callSPDao(CallSPDaoImpl.java:38)\nat com.gst.user.action.UnsubscribeAction.unsubscribeUser(UnsubscribeAction.java:39)\nat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\nat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\nat java.lang.reflect.Method.invoke(Method.java:597)\nat com.google.appengine.tools.development.agent.runtime.Runtime.invoke(Runtime.java:115)\nat com.opensymphony.xwork2.DefaultActionInvocation.invokeAction(DefaultActionInvocation.java:453)\nat com.opensymphony.xwork2.DefaultActionInvocation.invokeActionOnly(DefaultActionInvocation.java:292)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:255)\nat org.apache.struts2.interceptor.debugging.DebuggingInterceptor.intercept(DebuggingInterceptor.java:256)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.DefaultWorkflowInterceptor.doIntercept(DefaultWorkflowInterceptor.java:176)\nat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:98)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.validator.ValidationInterceptor.doIntercept(ValidationInterceptor.java:265)\nat org.apache.struts2.interceptor.validation.AnnotationValidationInterceptor.doIntercept(AnnotationValidationInterceptor.java:68)\nat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:98)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ConversionErrorInterceptor.intercept(ConversionErrorInterceptor.java:138)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ParametersInterceptor.doIntercept(ParametersInterceptor.java:236)\nat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:98)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ParametersInterceptor.doIntercept(ParametersInterceptor.java:236)\nat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:98)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.StaticParametersInterceptor.intercept(StaticParametersInterceptor.java:190)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat org.apache.struts2.interceptor.MultiselectInterceptor.intercept(MultiselectInterceptor.java:75)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat org.apache.struts2.interceptor.CheckboxInterceptor.intercept(CheckboxInterceptor.java:90)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat org.apache.struts2.interceptor.FileUploadInterceptor.intercept(FileUploadInterceptor.java:243)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ModelDrivenInterceptor.intercept(ModelDrivenInterceptor.java:100)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ScopedModelDrivenInterceptor.intercept(ScopedModelDrivenInterceptor.java:141)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ChainingInterceptor.intercept(ChainingInterceptor.java:145)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.PrepareInterceptor.doIntercept(PrepareInterceptor.java:171)\nat com.opensymphony.xwork2.interceptor.MethodFilterInterceptor.intercept(MethodFilterInterceptor.java:98)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.I18nInterceptor.intercept(I18nInterceptor.java:176)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat org.apache.struts2.interceptor.ServletConfigInterceptor.intercept(ServletConfigInterceptor.java:164)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.AliasInterceptor.intercept(AliasInterceptor.java:192)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat com.opensymphony.xwork2.interceptor.ExceptionMappingInterceptor.intercept(ExceptionMappingInterceptor.java:187)\nat com.opensymphony.xwork2.DefaultActionInvocation.invoke(DefaultActionInvocation.java:249)\nat org.apache.struts2.impl.StrutsActionProxy.execute(StrutsActionProxy.java:54)\nat org.apache.struts2.dispatcher.Dispatcher.serviceAction(Dispatcher.java:511)\nat org.apache.struts2.dispatcher.ng.ExecuteOperations.executeAction(ExecuteOperations.java:77)\nat org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter.doFilter(StrutsPrepareAndExecuteFilter.java:91)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.api.socket.dev.DevSocketFilter.doFilter(DevSocketFilter.java:74)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.tools.development.ResponseRewriterFilter.doFilter(ResponseRewriterFilter.java:110)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.tools.development.HeaderVerificationFilter.doFilter(HeaderVerificationFilter.java:34)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.api.blobstore.dev.ServeBlobFilter.doFilter(ServeBlobFilter.java:61)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.apphosting.utils.servlet.TransactionCleanupFilter.doFilter(TransactionCleanupFilter.java:43)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.tools.development.StaticFileFilter.doFilter(StaticFileFilter.java:125)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat com.google.appengine.tools.development.BackendServersFilter.doFilter(BackendServersFilter.java:97)\nat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\nat org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:388)\nat org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\nat org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182)\nat org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765)\nat org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:418)\nat com.google.appengine.tools.development.DevAppEngineWebAppContext.handle(DevAppEngineWebAppContext.java:94)\nat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\nat com.google.appengine.tools.development.JettyContainerService$ApiProxyHandler.handle(JettyContainerService.java:380)\nat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\nat org.mortbay.jetty.Server.handle(Server.java:326)\nat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)\nat org.mortbay.jetty.HttpConnection$RequestHandler.content(HttpConnection.java:938)\nat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:755)\nat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:218)\nat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)\nat org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:409)\nat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\n</code></pre>\n\n<p>The SQLSERVER is accepting the TCP/IP connection..\nAnd I'm using GAE 1.7.2,JDK 1.6.0_29, building JAVA application on Windows x64.\nAny Idea how to solve this issue..I think firewall is not an issue</p>\n\n<p>Any help/idea will be appreciated.</p>\n"},{"tags":["asp.net-mvc","sql-server-2008","session-state","session-cookies"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":141,"score":2,"question_id":12994772,"title":"Why Asp.net MVC4 can not use the cookieless of SQL Server Session state storage","body":"<p>ALL, Here is my web config in a Asp.net MVC4 application. I found if I set cookieless false ,everything goes fine. but If I don't want use cookie . then the application can not work.when I debug the application, I found the controller can not receive any request from the view. I think It is because when in the cookie-less mode, Something would be appended to the url before . like http:/ /localhost:8119/(S(3cicpjpagvpunr5he5fnfrj1))/.</p>\n\n<pre><code>&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;sectionGroup name=\"system.web.webPages.razor\" type=\"System.Web.WebPages.Razor.Configuration.RazorWebSectionGroup, System.Web.WebPages.Razor, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"&gt;\n      &lt;section name=\"webAssets\" type=\"Telerik.Web.Mvc.Configuration.WebAssetConfigurationSection, Telerik.Web.Mvc\" requirePermission=\"false\" /&gt;\n      &lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;\n      &lt;section name=\"entityFramework\" type=\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=4.4.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\" requirePermission=\"false\" /&gt;\n    &lt;/sectionGroup&gt;\n  &lt;/configSections&gt;\n\n  &lt;connectionStrings&gt;\n    &lt;add name=\"...\" connectionString=\"...\" providerName=\"System.Data.SqlClient\" /&gt;\n  &lt;/connectionStrings&gt;\n  &lt;appSettings&gt;\n    &lt;add key=\"webpages:Version\" value=\"2.0.0.0\" /&gt;\n    &lt;add key=\"webpages:Enabled\" value=\"true\" /&gt;\n    &lt;add key=\"PreserveLoginUrl\" value=\"true\" /&gt;\n    &lt;add key=\"ClientValidationEnabled\" value=\"true\" /&gt;\n    &lt;add key=\"UnobtrusiveJavaScriptEnabled\" value=\"true\" /&gt;\n  &lt;/appSettings&gt;\n  &lt;system.web&gt;\n    &lt;customErrors mode=\"Off\" /&gt;\n    &lt;httpRuntime executionTimeout=\"14400\" maxRequestLength=\"716800\" /&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.0\" /&gt;\n    &lt;authentication mode=\"Forms\"&gt;\n      &lt;forms loginUrl=\"~/Account/Login\" timeout=\"2880\" /&gt;\n    &lt;/authentication&gt;\n    &lt;pages&gt;\n      &lt;namespaces&gt;\n        &lt;add namespace=\"System.Web.Helpers\" /&gt;\n        &lt;add namespace=\"System.Web.Mvc\" /&gt;\n        &lt;add namespace=\"System.Web.Mvc.Ajax\" /&gt;\n        &lt;add namespace=\"System.Web.Mvc.Html\" /&gt;\n        &lt;add namespace=\"System.Web.Routing\" /&gt;\n        &lt;add namespace=\"System.Web.WebPages\" /&gt;\n        &lt;add namespace=\"Telerik.Web.Mvc.UI\" /&gt;\n      &lt;/namespaces&gt;\n    &lt;/pages&gt;\n    &lt;profile defaultProvider=\"DefaultProfileProvider\"&gt;\n      &lt;providers&gt;\n        &lt;add name=\"DefaultProfileProvider\" type=\"System.Web.Providers.DefaultProfileProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" connectionStringName=\"DefaultConnection\" applicationName=\"/\" /&gt;\n      &lt;/providers&gt;\n    &lt;/profile&gt;\n    &lt;membership defaultProvider=\"DefaultMembershipProvider\"&gt;\n      &lt;providers&gt;\n        &lt;add name=\"DefaultMembershipProvider\" type=\"System.Web.Providers.DefaultMembershipProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" connectionStringName=\"DefaultConnection\" enablePasswordRetrieval=\"false\" enablePasswordReset=\"true\" requiresQuestionAndAnswer=\"false\" requiresUniqueEmail=\"false\" maxInvalidPasswordAttempts=\"5\" minRequiredPasswordLength=\"6\" minRequiredNonalphanumericCharacters=\"0\" passwordAttemptWindow=\"10\" applicationName=\"/\" /&gt;\n      &lt;/providers&gt;\n    &lt;/membership&gt;\n    &lt;roleManager defaultProvider=\"DefaultRoleProvider\"&gt;\n      &lt;providers&gt;\n        &lt;add name=\"DefaultRoleProvider\" type=\"System.Web.Providers.DefaultRoleProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" connectionStringName=\"DefaultConnection\" applicationName=\"/\" /&gt;\n      &lt;/providers&gt;\n    &lt;/roleManager&gt;\n    &lt;!-- &lt;sessionState mode=\"InProc\" timeout=\"30\" customProvider=\"DefaultSessionProvider\"&gt;\n      &lt;providers&gt;\n        &lt;add name=\"DefaultSessionProvider\" type=\"System.Web.Providers.DefaultSessionStateProvider, System.Web.Providers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\" connectionStringName=\"DefaultConnection\" applicationName=\"/\" /&gt;\n      &lt;/providers&gt;\n    &lt;/sessionState&gt; --&gt;\n    &lt;sessionState mode=\"SQLServer\" cookieless=\"true\" sqlConnectionString=\"data source=xxxx; User ID=xxxx; password=xxxx\" timeout=\"300\" sqlCommandTimeout=\"10\" /&gt;\n    &lt;httpHandlers&gt;\n      &lt;add verb=\"GET,HEAD\" path=\"asset.axd\" validate=\"false\" type=\"Telerik.Web.Mvc.WebAssetHttpHandler, Telerik.Web.Mvc\" /&gt;\n    &lt;/httpHandlers&gt;\n  &lt;/system.web&gt;\n  &lt;system.webServer&gt;\n    &lt;security&gt;\n      &lt;requestFiltering&gt;\n        &lt;requestLimits maxAllowedContentLength=\"3000000000\" /&gt;\n      &lt;/requestFiltering&gt;\n    &lt;/security&gt;\n    &lt;validation validateIntegratedModeConfiguration=\"false\" /&gt;\n    &lt;modules runAllManagedModulesForAllRequests=\"true\" /&gt;\n    &lt;directoryBrowse enabled=\"true\" /&gt;\n    &lt;handlers&gt;\n      &lt;remove name=\"asset\" /&gt;\n      &lt;add name=\"asset\" preCondition=\"integratedMode\" verb=\"GET,HEAD\" path=\"asset.axd\" type=\"Telerik.Web.Mvc.WebAssetHttpHandler, Telerik.Web.Mvc\" /&gt;\n    &lt;/handlers&gt;\n  &lt;/system.webServer&gt;\n  &lt;runtime&gt;\n    &lt;assemblyBinding xmlns=\"urn:schemas-microsoft-com:asm.v1\"&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.Helpers\" publicKeyToken=\"31bf3856ad364e35\" /&gt;\n        &lt;bindingRedirect oldVersion=\"1.0.0.0-2.0.0.0\" newVersion=\"2.0.0.0\" /&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.Mvc\" publicKeyToken=\"31bf3856ad364e35\" /&gt;\n        &lt;bindingRedirect oldVersion=\"0.0.0.0-4.0.0.0\" newVersion=\"4.0.0.0\" /&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.WebPages\" publicKeyToken=\"31bf3856ad364e35\" /&gt;\n        &lt;bindingRedirect oldVersion=\"0.0.0.0-2.0.0.0\" newVersion=\"2.0.0.0\" /&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"Microsoft.WindowsAzure.StorageClient\" publicKeyToken=\"31bf3856ad364e35\" culture=\"neutral\" /&gt;\n        &lt;bindingRedirect oldVersion=\"0.0.0.0-1.7.0.0\" newVersion=\"1.7.0.0\" /&gt;\n      &lt;/dependentAssembly&gt;\n    &lt;/assemblyBinding&gt;\n  &lt;/runtime&gt;\n &lt;/configuration&gt;\n</code></pre>\n"},{"tags":["c#","sql-server-2008","triggers"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":102,"score":-2,"question_id":12994694,"title":"Insert update delete trigger in SQL Server","body":"<p>I have a windows application form. The table is called <code>messages</code> and whenever user inserts updates or deletes a message, the date/timestamp is stored in the column <code>UserAction</code>. </p>\n\n<p>This column information should be retrieved and shown in the UI as a link. Clicking that link has an action and the link should be seen as read.</p>\n\n<p>Can someone help me in giving some ideas to achieve this action?</p>\n\n<p>Thanks in advance.</p>\n"},{"tags":["sql-server","performance","sql-server-2008","indexing"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":951,"score":0,"question_id":488258,"title":"Adding a index on my table for this query","body":"<p>This table gets hit with this query the most, so I want add a index to speed things up, this table will have 5 million rows it in.</p>\n\n<p>My query looks like this:</p>\n\n<p>SELECT someID \nFROM someTable \nWHERE \n    myVarChar = @myVarChar AND\n    MyBit = 0 AND MyBit2 = 1 AND MyBit3 = 0</p>\n\n<p>myVarChar is unique also.</p>\n\n<p>What would the best index be for this type of query?</p>\n\n<p>I currently have a single index that covers all of the 4 columns in the above query.</p>\n\n<p>I am using sql server 2008 standard.</p>\n\n<p>Do I have to reindex every so often or its automatic?</p>\n"},{"tags":["sql","tsql","sql-server-2008","combinatorics"],"answer_count":4,"favorite_count":5,"up_vote_count":8,"down_vote_count":0,"view_count":1910,"score":8,"question_id":3686062,"title":"Generate all combinations in SQL","body":"<p>I need to generate all combinations of size <code>@k</code> in a given set of size <code>@n</code>. Can someone please review the following SQL and determine first if the following logic is returning the expected results, and second if is there a better way?</p>\n\n<pre><code>/*CREATE FUNCTION dbo.Factorial ( @x int ) \nRETURNS int \nAS\nBEGIN\n    DECLARE @value int\n\n    IF @x &amp;lt;= 1\n        SET @value = 1\n    ELSE\n        SET @value = @x * dbo.Factorial( @x - 1 )\n\n    RETURN @value\nEND\nGO*/\nSET NOCOUNT ON;\nDECLARE @k int = 5, @n int;\nDECLARE @set table ( [value] varchar(24) );\nDECLARE @com table ( [index] int );\n\nINSERT @set VALUES ('1'),('2'),('3'),('4'),('5'),('6');\n\nSELECT @n = COUNT(*) FROM @set;\n\nDECLARE @combinations int = dbo.Factorial(@n) / (dbo.Factorial(@k) * dbo.Factorial(@n - @k));\n\nPRINT CAST(@combinations as varchar(max)) + ' combinations';\n\nDECLARE @index int = 1;\n\nWHILE @index &amp;lt;= @combinations\nBEGIN\n    INSERT @com VALUES (@index)\n    SET @index = @index + 1\nEND;\n\nWITH [set] as (\n    SELECT \n        [value], \n        ROW_NUMBER() OVER ( ORDER BY [value] ) as [index]\n    FROM @set\n)\nSELECT \n    [values].[value], \n    [index].[index] as [combination]\nFROM [set] [values]\nCROSS JOIN @com [index]\nWHERE ([index].[index] + [values].[index] - 1) % (@n) BETWEEN 1 AND @k\nORDER BY\n    [index].[index];\n</code></pre>\n"},{"tags":["c#","asp.net","sql-server","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12994000,"title":"Connecting to a remote database using Visual studio","body":"<p>I have domain , database name, database user and password </p>\n\n<p>I want to connect to my database remotely using visual studio 2010, How can I do this ? </p>\n\n<p>thanks in advance </p>\n"},{"tags":["sql-server","sql-server-2008","documentation","schema"],"answer_count":6,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":2004,"score":1,"question_id":1732057,"title":"Tool to Document SQL Server Schema","body":"<p>Can anyone recommend a free (or cheap) program out there which allows me to easily document what certain tables and fields are used for in our applications? Ideally, when we update a fields type, it would automagically update in this tool. Also, showing what fields are indexed etc would be beneficial.</p>\n\n<p>What solutions have you guys / gals used to document your database?</p>\n\n<p>We use MS SQL Server 2008</p>\n"},{"tags":["sql-server","sql-server-2008","triggers","dynamic-sql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2369,"score":0,"question_id":940189,"title":"Dynamically finding column values in a trigger from INSERT when the column name is a variable","body":"<p>I have a trigger that gets inserts and updates to a view. I need to find the columns that are being modified and get the value into the correct table.</p>\n\n<pre><code>INSERT INTO TempTableAttr_Lot(ID, [% Num]) VALUES(3, 24.0)\n</code></pre>\n\n<p>I am trying to figure out how, in my trigger, to get the value of ID and [% Num] columns.  The problem is that there can be 32 different columns that are set in the insert or update, so I want to loop through looking to see if that column is in the 'inserted' table.</p>\n\n<p>One problem is that if I use exec or execute, to build a dynamic query, inserted is not in scope for this.</p>\n\n<p>The view is dynamic in that if attributes are added then the view is regenerated by a stored procedure, so I can't assume what column names are in the view at any given time, it can grow and shrink.</p>\n\n<p>Ideally I would like to do <code>SET @Value = (SELECT i.[@Name] FROM inserted i)</code> But @Name is not a column name, but a variable in my trigger, so when I tried </p>\n\n<pre><code>DECLARE @ValueTable TABLE ( value sql_variant)\nINSERT INTO @ValueTable EXECUTE('SELECT i.[' + @Name + '] FROM inserted i')\nSET @Value = CONVERT(nvarchar(128), (SELECT DISTINCT * FROM @ValueTable))\n</code></pre>\n\n<p>this didn't work as inserted appears to not be in scope.</p>\n\n<p>For the first loop @Name = 'ID' and for the second it will be 'Col2' which was not inserted, so the value of @Value should be null, and I continue to loop through the possible column names until I finish, and the trigger is processed.</p>\n\n<p>I am calling it a trigger, it is defined as:</p>\n\n<pre><code>CREATE TRIGGER TempTableAttr_LotTrigger \nON  TempTableAttr_Lot \nINSTEAD OF UPDATE, INSERT\n</code></pre>\n\n<p>I am testing with an INSERT command at the moment. I realize that when doing an update I may need to look at the 'deleted' table.</p>\n\n<p>UPDATE: I am assuming only one row is being inserted at the moment, for my test, to see how to get this to work.  This is for an entity-attribute-value database, but I have a view that makes it look relational. When using Integration Service, when the updating is going on, any inserts or updates to the view will call the trigger. I am just trying to understand how to get the information I need so I can update the correct table, with the correct values.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":7,"favorite_count":2,"up_vote_count":3,"down_vote_count":0,"view_count":15310,"score":3,"question_id":1248423,"title":"how to see active SQL Server connections?","body":"<p>I am using SQL Server 2008 Enterprise. I want to see any active SQL Server connections, and the related information of all the connections, like from which IP address, connect to which DB or something.</p>\n\n<p>Any existing tools to solve this issue?</p>\n\n<p>thanks in advance,\nGeorge</p>\n"},{"tags":["c#","sql-server-2008","transactions","locks"],"answer_count":5,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":100,"score":0,"question_id":12616509,"title":"Transactions and Locks","body":"<p>I am currently working with transactions and getting confused. These transaction are created at the data access layer and not in the stored procedures of the database (SQL Server 2008).\nI understand the normal working of Isolation Levels set for a transaction.\nI am unable to comprehend what should happen in the following scenario.</p>\n\n<ol>\n<li>Initiate a transaction</li>\n<li>Select Employee with ID=1.</li>\n<li>Update Employee with ID=1.</li>\n<li>Commit</li>\n</ol>\n\n<p>There are multiple threads doing the same thing but different ID. But there might be a case where in two threads look up the same ID. Lets call them Thread A and B. The above steps progress in the following manner with respect to the two threads. The Isolation Level is set to Repeatable Read. </p>\n\n<p>A1. Initiate a transaction\nA2. Select Employee with ID=1.\nB1. Initiate a transaction\nB2. Select Employee with ID=1.\nA3. Update Employee with ID=1.\nA4. Commit\nB3. Update Employee with ID=1.\nB4. Commit</p>\n\n<p>What I really want to achieve from the transaction is that when Thread A selects a particular record, Thread B should not even be able to select that record. I don't know if I am thinking on the right track by using transactions and locks for this scenario.</p>\n\n<p>Awaiting replies :)</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":2355602,"title":"how to pass this information to SQL Server 2008?","body":"<p>Please visit <a href=\"http://www.stumbleupon.com/\" rel=\"nofollow\">http://www.stumbleupon.com/</a></p>\n\n<p>It asks you what interests you.</p>\n\n<p>I would have a similar thing on my website except I would need to have 4 of such non-identical blocks. When a user has not selected anything in a section, it means s/he has selected all of them. 1 of these blocks would have around 10 options while the other 3 would have 2-3 options each.</p>\n\n<p>How do I pass what all a user has selected to SQL Server 2008? Please note I would have 4 sets of multiple params, and these 4 sets are basically 4 different columns in the row all containing integer id's. If and only if one param per section was passed, I would have done something like</p>\n\n<p>select * from table where column1 = @param1, column2 = @param2 and so on.</p>\n\n<p>but that is not the case, because a user could pass multiple values for @param1 and so on.</p>\n\n<p>I can get this done, but I want to know the most efficient way.</p>\n\n<p>If my post is not clear, please let me know. </p>\n\n<p>EDIT: \nBasically, if I am storing articles in the database, I have 4 columns in the row, each integer.  And I want to query these articles based on these 4 columns, but the catch is to pass the multiple values for these columns NOT just one value per column.</p>\n"},{"tags":["sql-server","sql-server-2008","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":105,"score":-1,"question_id":12989306,"title":"SQL Server row values as column names Pivot Table?","body":"<p>I have the following view in SQL Server 2008.</p>\n\n<pre><code>DEPT | EMP_ID | EMP_NAME | P_DATE  | HOURS_WORKED\n</code></pre>\n\n<p>I want the view to be this way:</p>\n\n<pre><code>DEPT | EMP_ID | EMP_NAME | 2012-09-28 | 2012-09-29 | 2012-09-30 | 2012-10-01 ...\n</code></pre>\n\n<p>where the above date column header is P_DATE below which is \"Hours_Worked\" values of that employee on that particular date.</p>\n\n<p>Like</p>\n\n<pre><code>2012-09-28\n\n09:00:00\n\n10:00:00\n</code></pre>\n\n<p>I am not sure whether I could achieve it using Pivot.</p>\n\n<p>Please go to this link for clear understanding : <a href=\"http://imgur.com/a/82eSo\" rel=\"nofollow\" title=\"SQL Server view images\">SQL Server View Snapshots</a></p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12984830,"title":"Stored procedure to delete from 3 tables","body":"<p>I'm creating an album and image gallery as a feature for a directory. Basically, a business can create albums, and add images to those albums.</p>\n\n<p>Here are my tables:</p>\n\n<ul>\n<li>BD_Album (AlbumID, OwnerID, AlbumName) </li>\n<li>BD_Image (ImageID, OwnerID, ImageFile, ImageTitle, ImageDescription, Active)</li>\n<li>BD_AlbumImage (EntryID, AlbumID, ImageID)</li>\n</ul>\n\n<p>I want to create a stored procedure that is executed when the owner deletes an album. My goal for this procedure is to clean up the tables.</p>\n\n<pre><code>DELETE FROM BD_Album WHERE AlbumID = @AlbumID --This is the obvious\nDELETE FROM BD_Image WHERE ...\nDELETE FROM BD_AlbumImage WHERE AlbumID = @AlbumID\n</code></pre>\n\n<p>My confusion comes in where I want to also remove any images from the <code>BD_Image</code> table that are associated with that album. (Warning, removing this album will also delete all images from within it. Are you sure?)</p>\n\n<p>The owners are able to create as many albums as they'd like. They can also assign an image to multiple albums via a listbox in the form.</p>\n\n<p>Probably a bit elementary, but any help would be appreciated.</p>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12989312,"title":"how to get data from two tables by passing single id common in both table in efw4.0","body":"<p>I want data of two tables(having foreign key) by passing single id and what should be its return type in efw 4.0?</p>\n"},{"tags":["sql-server","sql-server-2008","linked-server"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12458052,"title":"Linked Server Insert-Select Performance","body":"<p>Assume that I have a table on my local which is <code>Local_Table</code> and I have another server and another db and table, which is <code>Remote_Table</code> (table structures are the same).</p>\n\n<p><code>Local_Table</code> has data, <code>Remote_Table</code> doesn't. I want to transfer data from <code>Local_Table</code> to <code>Remote_Table</code> with this query:</p>\n\n<pre><code>Insert into RemoteServer.RemoteDb..Remote_Table\nselect * from Local_Table (nolock)\n</code></pre>\n\n<p>But the performance is quite slow.</p>\n\n<p>However, when I use SQL Server import-export wizard, transfer is really fast.</p>\n\n<p>What am I doing wrong? Why is it fast with Import-Export wizard and slow with insert-select statement? Any ideas?</p>\n"},{"tags":["asp.net","sql","sql-server","asp.net-mvc","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":7,"down_vote_count":0,"view_count":150,"score":7,"question_id":12983539,"title":"Stored procedures in SQL Server master-child relationships not tables","body":"<p>In college last year I came across something I found very interesting with regard to stored procedures. It was mostly with regard to reducing code repetition for transaction management, error handling, and security. But I have researched it since and cannot find it anywhere. Perhaps I don't know what it is called so I will explain.</p>\n\n<p>Let's say I have a simple table (forget its relationships, just a single table). I have at least 5 possible operations I can do on it namely CRUD, with the R being read the details of one row, or read a list of rows for a given criteria. Again, let's not get into too much detail with complicated stored procedures and let's pretend, for this example, we want nothing but the following 5 operations to be performed:</p>\n\n<ul>\n<li>Create (simple insert)</li>\n<li>Read (one for reading a single row)</li>\n<li>Read multiple (reading a list of rows, simple <code>select * from sometable where some condition</code>, nothing complicated), </li>\n<li>Update (simple update)</li>\n<li>Delete (again, simple delete). </li>\n</ul>\n\n<p>For the purposes of this example, a simple table with 2 or 3 columns, and the most simple procedures you can come up with to do those operations.</p>\n\n<p><strong>The problem</strong>:</p>\n\n<p>My lecturer, when talking to us about transactions, advised us to take these simple procedures, and keep them separate as is normal. But then to write a master procedure which executes each of these. This means we have a master procedure into which we pass a character lets say 'C' for create and so on, and a series of conditions which decide which job to run. Of course, we should pass in the details needed from the master to the child proc which means we need to get them from the user as parameters. This master procedure is already beginning to sound complicated.</p>\n\n<p>His reasoning, do the transaction handling, validation, error handling, and security handling in the master procedure. Then call that master procedure with the required parameters, which does all the checking, and passes the parameters to the child procedure. Below is an example.</p>\n\n<p><img src=\"http://i.stack.imgur.com/nnSly.jpg\" alt=\"enter image description here\"></p>\n\n<p>Simple table, don't go worrying too much about relationships, keys, indexes, constraints, triggers and so on.</p>\n\n<p>For the below two pieces of code, the only real relevant bit is the parts between the try...catch. The rest is boiler plate for the master.</p>\n\n<p>Below is the code for a create procedure:</p>\n\n<pre><code>ALTER proc [Actions].[AreaCreate]\n--External Variables - Input\n@AreaName varchar(50),  @AreaAvailablity bit,   @Description varchar(max),\n\n--External Variables - Output\n@NoOfRecords int output\n\nas\n--Internal Variables\ndeclare @ErrorMessage varchar(max)\n\nBegin try\n    insert  [Tennis3rdYrMVC].[dbo].Areas\n            ([AreaName],    [AreaAvailablity],  [Description])\n    values  (@AreaName,     @AreaAvailablity,   @Description)\n\n    --Show # of records affected so you can detect nulls or empty lists\n    --and handle them as you choose in the code\n    set     @NoOfRecords = @@ROWCOUNT\nEnd try\nBegin Catch\n    set @ErrorMessage = ERROR_MESSAGE()\n    raiserror(@ErrorMessage,16,1)\n    return ERROR_NUMBER()\nEnd Catch\n\n--All Ok\nreturn 0\n</code></pre>\n\n<p>Below is another piece of code for a delete procedure</p>\n\n<pre><code>ALTER proc [Actions].[AreaDelete]\n--External Variables - Input\n@Id int,\n\n--External Variables - Output\n@NoOfRecords int output\n\nas\n--Internal Variables\ndeclare @ErrorMessage varchar(max)\n\nbegin try\n    delete from [Tennis3rdYrMVC].[dbo].Areas\n    where Id = @Id\n\n    --Show # of records affected so you can detect nulls or empty lists\n    --and handle them as you choose in the code\n    set @NoOfRecords=@@ROWCOUNT\nend try\nbegin catch\n    set @ErrorMessage = ERROR_MESSAGE()\n    raiserror(@ErrorMessage,16,1)\n    return ERROR_NUMBER()\nend catch\n\n--All Ok\nreturn 0\n</code></pre>\n\n<p>Finally, the suggested, and complicated master proc.</p>\n\n<pre><code>ALTER proc [Admin].[AreaMaster]\n--External Variables - Input\n@JobType int, -- 1=Create, 2=Read 1, 3=Read Many, 4=Update, 5=Delete\n--Master sprock uses null defaults because not every job requires every field to be present.\n--i.e. We dont need to know the area name of an area we want to delete.\n@Id int                 = null,     @AreaName varchar(50)       = null,\n@AreaAvailablity bit    = null,     @Description varchar(max)   = null,\n\n--External Variables - Output\n@NoOfRecords int = null output --Used to count the number of records affected where needed.\nas\nBEGIN\n    --Internal Variables\n    declare @ErrorMessage varchar(max)\n    declare @return_value int\n\n    -- SET NOCOUNT ON added to reduce network traffic and speed things up a little.\n    SET NOCOUNT ON;\n\n    /*\n    --VALIDATION\n\n    --Logic for ensuring all required values are entered should be done in processing below in\n    --the master sprock, NOT in the children (i.e. why check for valid id in 5 sprocks when you\n    --can do it here in one).\n\n\n    We will do all the processing needed to ensure valid and required values are entered where\n    needed.\n\n    --SECURITY\n    This is also where we put the security code required to stop SQL Injection and other\n    attacks, NOT in the child sprocks. The child sprocks would not be allowed to execute by\n    pages directly.\n\n    */\n\n    --Once all validation is done, call  relevant child sprocks\n\n    --Call AreaCreate Sprock\n    if(@JobType='1')\n    begin\n        exec    @return_value = [Actions].[AreaCreate]\n                @AreaName           = @AreaName,\n                @AreaAvailablity    = @AreaAvailablity,\n                @Description        = @Description,\n                @NoOfRecords        = @NoOfRecords OUTPUT\n\n        --select    @return_value 'Return Value'\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem creating area.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaShowDetail Sprock\n    if(@JobType='2')\n    begin\n        exec    @return_value   = [Actions].[AreaShowDetail]\n                @Id             = @Id,\n                @NoOfRecords    = @NoOfRecords output\n        ----Testing\n        --select    'Return Value' = @return_value\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem reading area details.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaShowList Sprock\n    if(@JobType='3')\n    begin\n        exec    @return_value   = [Actions].[AreasShowList]\n                @NoOfRecords    = @NoOfRecords output\n        ----Testing\n        --select    'Return Value' = @return_value\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem reading areas list.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaUpdate Sprock\n    if(@JobType='4')\n    begin\n        EXEC    @return_value = [Actions].[AreaUpdate]\n                @Id                 = @Id,\n                @AreaName           = @AreaName,\n                @AreaAvailablity    = @AreaAvailablity,\n                @Description        = @Description,\n                @NoOfRecords        = @NoOfRecords OUTPUT\n\n        --select    'Return Value'      = @return_value\n\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem updating area.',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n\n    --Call AreaDelete Sprock\n    if(@JobType='5')\n    begin\n        exec    @return_value   = [Actions].[AreaDelete]\n                @Id             = @Id,\n                @NoOfRecords    = @NoOfRecords output\n\n        --select    'Return Value'  = @return_value\n        if @return_value&lt;&gt;0\n        begin\n            raiserror('Error: Problem deleting area(s).',16,0)\n            --rollback transaction\n            return 99\n        end\n    end\n\n    --All Ok\n    return 0\nEND\n</code></pre>\n\n<p>Is that complicated or what? Now imagine another level which if you have several tables to operate on, will decide which sub master to call, and this MasterMaster for want of a better name must have external parameters for every field in every table. However, the validation, security, and transaction code would be moved up to that level instead.</p>\n\n<p>More importantly, is that the way a professional would do it. And finally, I am using MVC with entity framework. Suppose I have a database like this (I have), and access is only allowed through this master stored procedure (it is). How do I call such a stored procedure from within EF and MVC. Even better, how would I bypass EF all together and get the data into my controller in a way my view will understand. I know how to do this with ASP.Net code behind. But not in MVC.</p>\n\n<p>Any suggestions. Please, feel free to tell me that this is completely crazy as it seems like a hell of a lot of work (what if you have 50 tables (I do). Imagine, 5 simple operations, across 50 tables = 250 child stored procedures + 50 Sub-Sub-Masters, + 5 Sub-Masters + 1 Master. I have my work cut out. Is there a tool that can do this or at least generate a template for me?</p>\n\n<p>So to summarise, My questions are:</p>\n\n<ol>\n<li>Is this overly complicated or is this the professional way to do this?</li>\n<li>What is the term used to describe this Master / child procedural relationship.</li>\n<li>Is there a tool that can automate this process.</li>\n<li>Is there a tool that can help me generate some kind of boilerplate template.</li>\n<li>How can I use this procedure with EF and MVC</li>\n<li>How can I bypass EF altogether and just find a way to call the procedure directly.</li>\n<li>Is there anything like the equivalent of classes, or even methods in T-SQL which can structure this much like a standard piece of code. Meaning that each child procedure is a method, each table has its properties, and the constructor will be the the initial (or altered) representation of the object.</li>\n<li>If 7 does exist, which would be more standard, the way I described (i.e.) splitting everything up, or the idea in 7.</li>\n</ol>\n\n<p>With regard to this point 4 I am talking about something simple, like the one already in SQL Server where you right click a procedure and choose execute and it generates some simple code for testing your procedure, or like the one for making functions.</p>\n\n<p>Thanks for reading this and for any help you can offer.</p>\n"},{"tags":["linq","sql-server-2008","auto-increment"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12980555,"title":"Auto increment in SQL Server while using linq","body":"<p>I want to update three fields/columns in my database table. One of them is primary key  \"id\", I made it autoincrement using visual studio's set column properties:</p>\n\n<pre><code>Identity Specification: Yes\n(Is Identity)         : Yes\nIdentity Seed         :  1\nIdentity Increment    :  1\n</code></pre>\n\n<p>Everything going ok, but after checking for 2 times that every thing is going fine I emptied the contents of the table so that the columns can be newly populated. But first row autoincrement column got the value 3. I deleted the row and tried again but It became 4 after row was updated. I don't know what is happening. My linq code has nothing to do with it I suppose, because its just insertion.</p>\n\n<p>Code behind linq:</p>\n\n<pre><code>//DLCountryies - .dbml filename\n// tblcountry - tablename\n// CountryName and CountryCode are Column names\n//txtCountryName - textbox\n\nusing (DLCountryiesDataContext countries = new DLCountryiesDataContext()) \n{                                                                         \n            tblcountry country = new tblcountry\n            {\n                CountryName = txtCountryName.Text.Trim(),\n                CountryCode = txtCountryCode.Text.Trim()\n            };\n\n            countries.tblcountries.InsertOnSubmit(country);\n            countries.SubmitChanges();\n} \n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","sql-server-express"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1529,"score":0,"question_id":5956807,"title":"sp_dropserver and sp_addserver not working","body":"<p>I am using SQL Server Express 2008 R2 and I wanted to change the instance name from \"machine name\"\\SQLEXPRESS2008R2 to just \"machine name\".  I ran:</p>\n\n<pre><code>sp_dropserver 'old_name'\n\ngo\n\nsp_addserver 'new_name', 'local'\n\ngo\n</code></pre>\n\n<p>Then restarted the SQL Service.  Now when I look at </p>\n\n<pre><code>Select @@SERVERNAME --this is correct\n</code></pre>\n\n<p>But this isn't correct?</p>\n\n<pre><code>Select serverproperty('ServerName') --This still shows old name\n</code></pre>\n\n<p>So when I try to connect to my instance via SSMS I still have to connect using the old instance name isntead of the new on I just applied? What am I doing wrong? Why is the new name not taking?</p>\n\n<p>Thanks,</p>\n\n<p>S</p>\n"},{"tags":["sql","sql-server-2005","sql-server-2008"],"answer_count":3,"favorite_count":6,"up_vote_count":6,"down_vote_count":0,"view_count":2860,"score":6,"question_id":793643,"title":"Auditing SQL Server data changes","body":"<p>I'm looking at changing our Auditing process for our SQL Server 2005 databases and I came across Change Data Capture in SQL Server 2008. </p>\n\n<p>This looks like a good idea, and I'm tempted to try it, but before I do has anyone used it in a commercial environment and what are your thoughts?</p>\n\n<p>I noticed when I was reading about CDC in the MS help, it said that audit data would usually be kept for a couple of days. That's not possible here, I'd like to keep the data indefinitely, does anyone know of problems with this approach?</p>\n\n<p>If this isn't a good solution for reasons I'm unaware of, have you any other solutions for  auditing of data changes. I'm keen to use a system that can be implemented across the board on any tables I desire.</p>\n\n<p>I'm after the basic: \"Before, After, Who By, When\" information for any changes.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12985524,"title":"Merge two database table partitions by their partition number","body":"<p>I have created four partitions in SQL Server using the following functions.</p>\n\n<pre><code>CREATE PARTITION FUNCTION fnYearsRT(DateTime)\nAS RANGE RIGHT FOR VALUES\n('01/01/2005', '01/01/2006', '01/01/2007', '01/01/2008');\n\nCREATE PARTITION SCHEME date_partscheme\n AS PARTITION fnYearsRT\n TO (Filegroup1, Filegroup2, Filegroup3, Filegroup4,Filegroup5)\n\nCREATE TABLE Sales.ReturnsArchive\n  (\n     ReturnID  int  IDENTITY NOT NULL, \n     ProductID  int  NOT NULL, \n     CustomerID  int  NOT NULL, \n     ReturnDate  datetime  NOT NULL,  \n     ReturnReason  char(20)  NULL  \n  ) \n ON date_partscheme (ReturnDate)\n</code></pre>\n\n<p>After inserting data I have the following stats</p>\n\n<pre><code>Partition   COUNT\n2       5151\n3       19353\n4       51237\n5       45576\n</code></pre>\n\n<p>I want to merge partition 2 and 3 but I am unable to decide which range I should give in merge function. </p>\n"},{"tags":["c#","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12986281,"title":"how to change database version from 655 to 612?","body":"<p>Error -</p>\n\n<blockquote>\n  <p><em>mdf file can not be opened because it is version 655, this version\n  support 612 or earlier</em></p>\n</blockquote>\n\n<p>Note :</p>\n\n<p>I am created this database file using SQL Server 2005 and later that file is opened in SQL Server 2008 then automatically change version from 612 to 655.</p>\n\n<p>But I currently want to open that file in SQL Server 2005.</p>\n\n<p>Any solution is possible then help me.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12985795,"title":"How can we retrieve deleted rows in SQL Server 2008?","body":"<p>Can we retrieve back deleted rows of table(s) from a database in SQL Server 2008 ? </p>\n\n<p>If yes please let me know how can we do this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1309,"score":0,"question_id":10156733,"title":"SQL Server Date Formats (YYYY-MM-DD HH:MI:SS.MMM)","body":"<p>Update:\ni am still getting this <code>(4/14/2012 2:44:01 PM)</code>  result after trying this</p>\n\n<pre><code> select convert(varchar(30), '4/14/2012 2:44:01 PM',121) \n</code></pre>\n\n<p><strong>End Update</strong></p>\n\n<p>what format should i use in order to get this result set:</p>\n\n<pre><code>2012-04-14 14:44:01.683\n</code></pre>\n\n<p>i tried using this but does not show the micro/milli seconds</p>\n\n<pre><code>select convert(varchar(23), '4/14/2012 2:44:01 PM',120)\n</code></pre>\n\n<p>gets me this result:</p>\n\n<pre><code>4/14/2012 2:44:01 PM\n</code></pre>\n"},{"tags":["sql-server-2008","replication","database-replication"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":3346,"score":4,"question_id":3441081,"title":"Length of LOB data (78862) to be replicated exceeds configured maximum 65536","body":"<p><a href=\"http://stackoverflow.com/questions/925824/when-insert-length-of-lob-data-to-be-replicated-exceeds-configured-maximum-65536\">Here</a> is a related question.</p>\n\n<p>Why do I get this error even when I have not installed SQL Server replication ? The strangest thing is, when I run the fix</p>\n\n<pre><code>sp_configure 'max text repl size', 2147483647\nGo\nRECONFIGURE\nGO\n</code></pre>\n\n<p>it works and I no longer get this error</p>\n"},{"tags":["sql","sql-server-2008","query","sum","select-case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":63,"score":0,"question_id":12984396,"title":"SQL Sum with conditions in a select case","body":"<p>have the following sql query</p>\n\n<pre><code>select catalogid\n   , sum(numitems) numitems\n   , sum(allitems) - sum(numitems) ignoreditems\nfrom\n(\n   select i.catalogid\n      , case\n           when (ocardtype in ('PayPal','Sofort') OR\n                   ocardtype in ('mastercard','visa') and\n                   odate is not null)\n              AND NOT EXISTS\n              (\n                 select *\n                 FROM bookedordersids b\n                 where b.booked = o.orderid\n              )\n           then numitems\n           else 0\n        end AS numitems\n      , numitems AS allitems\n   from orders AS o\n   join oitems AS i on i.orderid = o.orderid\n) AS X\ngroup by catalogid\n</code></pre>\n\n<p>now i've 2 tables Here\norders and oitems table</p>\n\n<p>the query sums the <code>numitems</code> and <code>ignoreditems</code> based on the conditions you see, now what if i want to find the sum only when the value of a column called <code>oprocessed</code> in <code>oitems</code> table is <code>0</code> ,</p>\n\n<p>do i add the following before <code>X</code></p>\n\n<pre><code>where oprocessed=0\n</code></pre>\n\n<p>or should i add a condition to the SELECT CASE?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":88,"score":2,"question_id":12980578,"title":"How to replace all spaces between a <p> and </p> tag","body":"<p>I am going through about 5000 records and needing to replace all spaces between a <code>&lt;p&gt; &lt;/p&gt;</code> tag with <code>&amp;nbsp;</code></p>\n\n<p>Would this work?</p>\n\n<p>I thought this would work with a SET replace()</p>\n\n<pre><code>SELECT *\nFROM FMS.[AuditItem] ai\nWHERE ai.[NotificationMessage] LIKE '%&lt;p&gt;% %&lt;/p&gt;%'\n</code></pre>\n\n<p>But I still have no way to select only the spaces between the paragraph tags. Right? Is there a better way to go about this? </p>\n"},{"tags":["sql-server-2008","stored-procedures","syntax-error","ssms-2012"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12981182,"title":"SQL Server: stored procedure saves with errors","body":"<p>I am using SQL Server 2008 and SSMS 2012. I have a stored procedure that references a table that does not exist. The editor displays red underlines on the offending table to indicate that something is wrong. </p>\n\n<p>However when I execute the query, I get the message </p>\n\n<blockquote>\n  <p>Command(s) completed successfully.</p>\n</blockquote>\n\n<p>This is extremely annoying. I also connected to the engine from another machine and it experienced the same problem, which implies its on the server, not ssms. Is there some kind of setting on the database that determines whether the database checks the syntax of stored procedures? PLEASE HELP!</p>\n\n<p><strong>Clarification:</strong>\nI know that the syntax is wrong. The problem is that SSMS allows me to execute the CREATE or ALTER statement without error even when it references a table that does not exist. I want it to fail. Usually it does, but for some reason it suddenly stopped giving errors. I want it to give me errors. How do I do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":894,"score":2,"question_id":7475845,"title":"Getting Number of weeks in a Month from a Datetime Column","body":"<p>I have a table called FcData and the data looks like:</p>\n\n<pre><code>Op_Date\n\n2011-02-14 11:53:40.000\n2011-02-17 16:02:19.000\n2010-02-14 12:53:40.000\n2010-02-17 14:02:19.000\n</code></pre>\n\n<p>I am looking to get the Number of weeks in That Month from Op_Date. So I am looking for output like:</p>\n\n<pre><code> Op_Date                       Number of Weeks\n\n    2011-02-14 11:53:40.000       5   \n    2011-02-17 16:02:19.000       5\n    2010-02-14 12:53:40.000       5\n    2010-02-17 14:02:19.000       5\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":6,"down_vote_count":0,"view_count":85,"score":6,"question_id":12979095,"title":"joining a pivot with another complex table","body":"<p>my pivot query generates:</p>\n\n<pre><code>+-----------+----+----+---+---+---+---+---+\n| client_id | 1  | 2  | 3 | 4 | 5 | 6 | 7 |\n+-----------+----+----+---+---+---+---+---+\n|    216436 |  9 |  0 | 0 | 0 | 0 | 0 | 0 |\n|    110522 | 76 |  3 | 0 | 0 | 0 | 0 | 0 |\n|    214981 |  0 |  1 | 0 | 0 | 0 | 0 | 0 |\n|    216360 | 52 |  1 | 0 | 0 | 0 | 0 | 0 |\n|    102574 |  1 |  0 | 0 | 0 | 0 | 0 | 0 |\n|    211754 | 97 | 14 | 2 | 0 | 0 | 0 | 0 |\n|    210734 |  8 |  4 | 0 | 0 | 0 | 0 | 0 |\n|    100123 |  1 |  0 | 0 | 0 | 0 | 0 | 0 |\n|    101840 |  2 |  0 | 0 | 0 | 0 | 0 | 0 |\n+-----------+----+----+---+---+---+---+---+\n</code></pre>\n\n<p>here's the query:</p>\n\n<pre><code>   select client_id,\n   [1],[2],[3],[4],[5],[6],[7] -- these are timestested (the amount of times tested)\n   from\n   (   SELECT DISTINCT CLIENT_ID\n   , PATIENT_ID\n   , count(*) over (partition by client_id, patient_id) AS patientcount\n\n   from f_accession_daily) as SourceTable\n   PIVOT\n   (\n   count(patient_id)\n   for patientcount in ([1],[2],[3],[4],[5],[6],[7])\n   ) as pivottable\n</code></pre>\n\n<p><strong>I need to bring the max/min dates for every time tested, (for [1], [2], [3], etc)</strong> from this table:</p>\n\n<pre><code>+-----------+-------------+-------+------------+------------+\n| client_id | TimesTested | count | maxRecDate | minRecDate |\n+-----------+-------------+-------+------------+------------+\n|    100034 |           2 |     1 | 6/25/2008  | 6/23/2008  |\n|    100034 |           1 |    20 | 6/30/2008  | 6/19/2008  |\n|    100038 |           3 |     1 | 7/25/2008  | 7/23/2008  |\n|    100038 |           1 |     4 | 7/25/2008  | 7/1/2008   |\n|    100050 |           1 |    15 | 8/11/2008  | 7/14/2008  |\n|    100060 |           1 |     2 | 8/12/2008  | 7/29/2008  |\n|    100070 |           1 |     3 | 8/15/2008  | 8/15/2008  |\n|    100049 |           1 |     3 | 8/22/2008  | 7/11/2008  |\n|    100029 |           3 |     2 | 8/25/2008  | 6/18/2008  |\n+-----------+-------------+-------+------------+------------+\n</code></pre>\n\n<p>the above table is generated by:</p>\n\n<pre><code>SELECT a.client_id AS client_id\n,a.patientcount TimesTested\n   , count(a.patientcount)/a.patientcount AS count\n   , max(f.received_date) AS maxRecDate\n   , min(f.received_date) AS minRecDate\nFROM\n(\n   SELECT DISTINCT CLIENT_ID\n   , PATIENT_ID\n   , count(*) over (partition by client_id, patient_id) AS patientcount\n\n   from f_accession_daily\n\n) AS a\nJOIN F_ACCESSION_DAILY AS f ON a.CLIENT_ID = f.CLIENT_ID\n   AND a.PATIENT_ID = f.PATIENT_ID\n\nGROUP BY a.CLIENT_ID, a.patientcount\n</code></pre>\n\n<p><strong>the resulting table that i need to get:</strong></p>\n\n<pre><code>+-----------+----+----------+-----------+----+----------+-----------+---+----------+-----------+---+----------+-----------+-----+\n| client_id | 1  | maxdate1 | mindate1  | 2  | maxdate2 | mindate2  | 3 | maxdate3 | mindate3  | 4 | maxdate4 | mindate4  |  5  |\n+-----------+----+----------+-----------+----+----------+-----------+---+----------+-----------+---+----------+-----------+-----+\n|    216436 |  9 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | etc |\n|    110522 | 76 | 1/1/2011 | 1/23/1984 |  3 | 1/1/2011 | 1/23/1984 | 0 | 1/1/2011 | 1/23/1984 | 0 | 2/1/2011 | 1/23/1984 |     |\n|    214981 |  0 | 1/1/2013 | 1/23/1985 |  1 | 1/1/2013 | 1/23/1985 | 0 | 1/1/2013 | 1/23/1985 | 0 | 1/1/2013 | 1/23/1985 |     |\n|    216360 | 52 | 1/1/2011 | 1/23/1985 |  1 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 |     |\n|    102574 |  1 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2014 | 1/23/1980 | 0 | 2/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 |     |\n|    211754 | 97 | 1/1/2012 | 1/23/1985 | 14 | 1/1/2012 | 1/23/1985 | 2 | 1/1/2012 | 1/23/1985 | 0 | 1/1/2012 | 1/23/1985 |     |\n|    210734 |  8 | 1/1/2011 | 1/23/1984 |  4 | 1/1/2011 | 1/23/1984 | 0 | 1/1/2011 | 1/23/1984 | 0 | 1/1/2011 | 1/23/1984 |     |\n|    100123 |  1 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1987 |     |\n|    101840 |  2 | 1/1/2011 | 1/23/1985 |  0 | 1/1/2011 | 1/23/1980 | 0 | 1/1/2011 | 1/23/1985 | 0 | 1/1/2011 | 1/23/1985 |     |\n+-----------+----+----------+-----------+----+----------+-----------+---+----------+-----------+---+----------+-----------+-----+\n</code></pre>\n\n<p><strong>how do i join the two tables? the speed does not matter! thank you very much for your kind help.</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2005","tsql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":216,"score":0,"question_id":7711336,"title":"SQL Server Rounding Issue","body":"<p>I'm using SQL Server 2005. And I'm using ROUND T-SQL function to round a decimal column value. But it seems that the rounded value is incorrect.</p>\n\n<pre><code>    PRINT ROUND(1890.124854, 2) =&gt; 1890.120000\n</code></pre>\n\n<p>As shown the ROUND function is returning 1890.12 where as it should be 1890.13. Does anyone encountered this and what should be the correct way of rounding so that I get the expected value 1890.13..?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server-2008","migrate"],"answer_count":3,"favorite_count":3,"up_vote_count":3,"down_vote_count":0,"view_count":7053,"score":3,"question_id":1010279,"title":"how to migrate from sql 2000 to sql 2008 via restore?","body":"<p>I'm running this code:</p>\n\n<pre><code>RESTORE DATABASE [MyDB_2009May11] \nFROM  DISK = N'C:\\DB Copy\\MyDB_2009May11.bak' \nWITH  \nMOVE N'Archive_Data' \n    TO N'C:\\Program Files\\Microsoft SQL Server\\MSSQL10.SQL2008\\MSSQL\\DATA\\MyDB_2009May11.mdf',  \nMOVE N'Data' \n    TO N'C:\\Program Files\\Microsoft SQL Server\\MSSQL10.SQL2008\\MSSQL\\DATA\\MyDB_2009May11.mdf',  \nMOVE N'Log' \n    TO N'C:\\Program Files\\Microsoft SQL Server\\MSSQL10.SQL2008\\MSSQL\\DATA\\MyDB_2009May11.ldf',  \nNOUNLOAD,  \nSTATS = 10\nGO\n</code></pre>\n\n<p>I'm getting this error:</p>\n\n<p>Msg 3176, Level 16, State 1, Line 1\nFile 'C:\\Program Files\\Microsoft SQL Server\\MSSQL10.SQL2008\\MSSQL\\DATA\\MyDB_2009May11.mdf' is claimed by 'Archive_Data'(3) and 'Data'(1). The WITH MOVE clause can be used to relocate one or more files.\nMsg 3013, Level 16, State 1, Line 1\nRESTORE DATABASE is terminating abnormally.</p>\n\n<p>How the crap do I migrate from sql server 2000 to 2008 when all I have is the backup file?</p>\n\n<p>:)  Any help is appreciated.  </p>\n"},{"tags":["sql","sql-server-2008","datediff"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":554,"score":0,"question_id":8345282,"title":"SQL Server Group By Month","body":"<p>I have a table which has this schema</p>\n\n<pre><code>ItemID    UserID    Year    IsPaid    PaymentDate  Amount\n1         1         2009    0         2009-11-01  300\n2         1         2009    0         2009-12-01  342\n3         1         2010    0         2010-01-01  243\n4         1         2010    0         2010-02-01  2543\n5         1         2010    0         2010-03-01  475\n</code></pre>\n\n<p>I'm trying to get a query working which shows the totals for each month. So far I've tried DateDiff and nested selects, but neither gives me what I want. This is the closest I have I think:</p>\n\n<pre><code>DECLARE @start [datetime] = 2010/4/1;\nSELECT ItemID, IsPaid,\n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 And DateDiff(m, PaymentDate, @start) = 0 AND UserID = 100) AS \"Apr\",\n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =1 AND UserID = 100) AS \"May\",\n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =2 AND UserID = 100) AS \"Jun\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =3 AND UserID = 100) AS \"Jul\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =4  AND UserID = 100) AS \"Aug\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =5  AND UserID = 100) AS \"Sep\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =6  AND UserID = 100) AS \"Oct\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =7 AND UserID = 100) AS \"Nov\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =8 AND UserID = 100) AS \"Dec\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =9 AND UserID = 100) AS \"Jan\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =10 AND UserID = 100) AS \"Feb\", \n(SELECT SUM(Amount) FROM Payments WHERE Year = 2010 AND DateDiff(m, PaymentDate, @start) =11 AND UserID = 100) AS \"Mar\" \nFROM LIVE L INNER JOIN Payments I ON I.LiveID = L.RECORD_KEY \nWHERE UserID = 16178 \n</code></pre>\n\n<p>But I just get nulls when I should be getting values. Am I missing something?</p>\n"},{"tags":["java","sql","sql-server","sql-server-2008","jdbc"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":5925,"score":0,"question_id":6403636,"title":"Connecting SQL Server 2008 to Java: Login failed for user error","body":"<p>I am trying to connect my Java code to a Microsoft SQL Server 2008 R2 Express database.  I have downloaded the Microsoft SQL Server JDBC Driver 3.0 and added the sqljdbc4.jar to my classpath.  I am using Netbeans and have included the sqljdbc4.jar in my project also.</p>\n\n<p>I created a database in the SQL Server Management Studio called TestDB1 and added some columns and values that I will use for testing.  I changed from Windows Authentication Mode by right clicking on the server JACOB=PC\\SQLEXPRESS->Properties->Secuity and changing from Windows Authentication Mode to SQL Server and Windows Authentication Mode.  </p>\n\n<p>I then created a new login by right clicking on the Login folder in the window explorer under JACOB-PC/SQLEXPRESS->Secuity Folder->Logins Folder and added a new login.  I gave it the name jhaip2, switched to SQL Server authentication and the set the password to jacob.  Enforce password policy and enforce password expiration are unchecked.  The default database is set to TestDB1.  Then under TestDB1->Secuity->Users->jhaip2->Database role membership I set jhaip2 to db_owner (I couldn't log in to the database in the management studio without doing this, probably not the right thing to do?).  I then restarted the server.</p>\n\n<p>Now for my java code, it is basically a direct copy of the JDBC Driver 3.0 Sample code except without windows authentication.</p>\n\n<pre><code>package databasetest1;\n\nimport java.sql.*;\n\npublic class connectURL {\n\n   public static void main(String[] args) {\n\n      // Create a variable for the connection string.\n      String connectionUrl = \"jdbc:sqlserver://localhost:1433;\" + \"databaseName=TestDB1;\";\n\n      // Declare the JDBC objects.\n      Connection con = null;\n      Statement stmt = null;\n      ResultSet rs = null;\n\n      try {\n         // Establish the connection.\n         Class.forName(\"com.microsoft.sqlserver.jdbc.SQLServerDriver\");\n         System.out.println(\"Driver okay\");\n         con = DriverManager.getConnection(connectionUrl,\"jhaip2\",\"jacob\");\n         System.out.println(\"Connection Made\");\n\n      }\n\n      // Handle any errors that may have occurred.\n      catch (Exception e) {\n         e.printStackTrace();\n      }\n      finally {\n         if (rs != null) try { rs.close(); } catch(Exception e) {}\n         if (stmt != null) try { stmt.close(); } catch(Exception e) {}\n         if (con != null) try { con.close(); } catch(Exception e) {}\n      }\n   }\n}\n</code></pre>\n\n<p>When I run, it prints out \"Driver okay\" so I am assuming my driver is set up correctly.  Then it prints the error:</p>\n\n<pre><code>com.microsoft.sqlserver.jdbc.SQLServerException: Login failed for user 'jhaip2'.\n</code></pre>\n\n<p>It does not matter what username I use, it always fails.  I have a feeling I am setting up the user wrong.  If anyone could give me some help on how to properly set up a user or any guidance in how to simply connect to a SQL Server database in Java, I would appreciate it.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12982277,"title":"condensing a dataset on nulls","body":"<p>My query returns a table that looks like this (please note that I am posting a very simplified version of the output):</p>\n\n<pre><code>+-------+------+------+------+------+\n|       |  1   |  2   |  3   |  4   |\n+-------+------+------+------+------+\n| 14234 | 3    | null | null | null |\n| 14234 | null | null | 32   | null |\n| 33334 | 4    | null | null | 5    |\n| 33334 | null | 3    | null | null |\n+-------+------+------+------+------+\n</code></pre>\n\n<p>and i would like to reformat it to look like this:</p>\n\n<pre><code>+-------+---+------+------+------+\n|       | 1 |  2   |  3   |  4   |\n+-------+---+------+------+------+\n| 14234 | 3 | null | 32   | null |\n| 33334 | 4 | 3    | null | 5    |\n+-------+---+------+------+------+\n</code></pre>\n\n<p>as you can see the rows have been put together (condensed), i don't know what the right terminology would be. </p>\n\n<p>is there a quick way to do this with sql server?</p>\n\n<p>here's the original query:</p>\n\n<pre><code>;WITH \nPivotQuery as (\n    select client_id,\n       [1],[2],[3],[4],[5],[6],[7]\n       from\n       (   SELECT DISTINCT CLIENT_ID\n       , PATIENT_ID\n       , count(*) over (partition by client_id, patient_id) AS patientcount\n\n       from f_accession_daily) as SourceTable\n       PIVOT\n       (\n       count(patient_id)\n       for patientcount in ([1],[2],[3],[4],[5],[6],[7])\n       ) as pivottable),\n\nMinMaxTimes as (\n    SELECT a.client_id AS client_id\n    ,a.patientcount TimesTested\n       , count(a.patientcount)/a.patientcount AS count\n       , max(f.received_date) AS maxRecDate\n       , min(f.received_date) AS minRecDate\n    FROM\n    (\n       SELECT DISTINCT CLIENT_ID\n       , PATIENT_ID\n       , count(*) over (partition by client_id, patient_id) AS patientcount\n\n       from f_accession_daily\n\n    ) AS a\n    JOIN F_ACCESSION_DAILY AS f ON a.CLIENT_ID = f.CLIENT_ID\n       AND a.PATIENT_ID = f.PATIENT_ID\n\n    GROUP BY a.CLIENT_ID, a.patientcount),\n\nmaxDates as (\nSELECT client_id, [1] maxdate1, [2] maxdate2, [3] maxdate3, [4] maxdate4, [5] maxdate5, [6] maxdate6, [7] maxdate7\nFROM MinMaxTimes t\nPIVOT (max(maxRecDate)\nfor TimesTested IN ([1], [2], [3], [4], [5], [6], [7])\n) as p),\n\nminDates as (\nSELECT client_id, [1] mindate1, [2] mindate2, [3] mindate3, [4] mindate4, [5] mindate5, [6] mindate6, [7] mindate7\nFROM MinMaxTimes t\nPIVOT (max(minRecDate)\nfor TimesTested IN ([1], [2], [3], [4], [5], [6], [7])\n) as p)\n\nSELECT i.client_id, \n    p.[1], maxdate1, mindate1, \n    p.[2], maxdate2, mindate2, \n    p.[3], maxdate3, mindate3, \n    p.[4], maxdate4, mindate4, \n    p.[5], maxdate5, mindate5, \n    p.[6], maxdate6, mindate6, \n    p.[7], maxdate7, mindate7   \nFROM PivotQuery p\nLEFT OUTER JOIN maxDates a ON p.client_id = a.client_id\nLEFT OUTER JOIN mindates i ON a.client_id = i.client_id\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":67,"score":0,"question_id":12981816,"title":"What does a select statement inside a select statement mean?","body":"<p>What does a Transact SQL statement <code>Select</code> statement inside a <code>from</code> mean? </p>\n\n<p>I mean something like this </p>\n\n<pre><code> .. from ( \n    select .. \n )\n</code></pre>\n\n<p>Also, I need to know if the statement is bad for performance.  Can you provide me a link to the official documentation about this topic in Transact SQL?</p>\n"},{"tags":["c#","asp.net","sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":100,"score":3,"question_id":12981863,"title":"Advantages of a get<object Name> stored procedure architecture in .NET 4+?","body":"<p>I am migrating an existing .NET 2.0, SQL Server codebase to a .NET 4.0, SQL Server 2008 environment. </p>\n\n<p>The design pattern is that all app calls to the database go through a stored procedure. So there's a <code>get[object name]</code> stored procedure that needs to be created or altered for most select statements. </p>\n\n<p>So the disadvantages of this architecture to me are already evident: inconvenience. </p>\n\n<p>What are the advantages of this highly enforced stored procedure design? (now in .NET 4.0 as opposed to using an ORM). </p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12982104,"title":"Silent type conversions in SQL Server 2008","body":"<p>I just recently discovered that SQL Server will return equivalent answers for the following two queries</p>\n\n<pre><code>select * from myTable\n    where column1 in('034','023')\n\nselect * from myTable\n    where column1 in (34,23)\n</code></pre>\n\n<p>The data type in the varchar.  Does anyone have a link or knowledge of other 'silent' datatype conversions in SQL Server (or T-SQL, specifically perhaps)</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12980705,"title":"how to get rows data on the column side","body":"<p>I have a employee table with salary according to number of years as follows:</p>\n\n<pre><code>Employee_table\n-----------------------------------------------------------------------------\nemp_ID -  FirstName- LstName   salary  ...    year -  \n001   -   xx     -     yy   -   03212         2000       \n001   -   xx     -     yy   -   04212         2001        \n002   -   xxx     -    yyy  -   03425         2000         \n002   -   xxx     -    yyy  -   04425         2001          \n003   -   xxxx    -    yyyy  -  03429         2000         \n003   -   xxxx   -     yyyy  -  04429         2001         \n------------------------------------------------------------------------------\n</code></pre>\n\n<p>And I want to write a query which will give me the employee data with year on the column side as:</p>\n\n<pre><code>tblResults\n---------------------------------------------------------------------\nemp_ID   2000       2001          ....     ....            \n---------------------------------------------------------------------\n01        03212     04212   \n02        03425   - 04425    \n03        03429     04429   \n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12977490,"title":"SQL Converting Int to Date or Char","body":"<p>My dbase has date formats in 6 digits with a int datatype ('734503' = 01/01/2012).\nI have been able to successfully convert these to char with:</p>\n\n<pre><code>SELECT CONVERT(char(12),dateadd(dd,(date_paid -    639906),'1/1/1753'),101)  \nFROM   vouchers       \nWHERE date_paid =    '734503'\n</code></pre>\n\n<p>This gives me the output of 01/01/2012.\nBut if I search on the converted date in a query like this:</p>\n\n<pre><code>SELECT CONVERT(char(12),dateadd(dd,(date_paid - 639906),'1/1/1753'),101) \nFROM vouchers    \nWHERE date_paid &gt;= '09/01/2012'  AND date_paid &lt;= '09/30/2012'\n</code></pre>\n\n<p>Why doesn't the conversion take place?  Even if I use a CONVERT in the WHERE statement on the date_paid field, shouldn't it work there?  </p>\n\n<p>I suppose my question is how do I search with the converted character date and not have to use the 6 digit date?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12979798,"title":"Weird SQL Server comparison is always false","body":"<pre><code>declare @test int\ndeclare @test2 int = 3\n\nselect case when @test != @test2 then 1 else 0 end\nselect case when @test = @test2 then 1 else 0 end\n</code></pre>\n\n<p>The result is always 0. Can someone explain this?</p>\n"},{"tags":["sql-server","sql-server-2008","audit"],"answer_count":4,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":231,"score":5,"question_id":3933881,"title":"Is their an elegant way to track the modification of all columns of one table in SQL Server 2008","body":"<p>There is a table in my database containing 100 columns. I want to create a trigger to audit the modification for every update operation. </p>\n\n<p>What I can think is to create the update clause for all columns but they are all similar scripts. So is there any elegant way to do that?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":58,"score":2,"question_id":12962044,"title":"sp_send_dbmail Error In Microsoft SQL Agent Job","body":"<p>Im trying to send an email from a scheduled SQL Agent job using sp_send_dbmail and receive the following error:</p>\n\n<p>Msg 22050, Level 16, State 1, Line 0\nError formatting query, probably invalid parameters\nMsg 14661, Level 16, State 1, Procedure sp_send_dbmail, Line 504\nQuery execution failed: Msg 15404, Level 16, State 19, Server MyServer, Line 1\nCould not obtain information about Windows NT group/user 'MyDomain\\sqlagent', error code 0x5.</p>\n\n<p>Here is the code from the job step:</p>\n\n<pre><code>DECLARE @SQL NVARCHAR(400)\nSELECT @SQL = 'SELECT COUNT(staff_id) FROM Staff'\n\nEXEC msdb.dbo.sp_send_dbmail\n@recipients = 'me@myemail.com',\n@subject = 'Email Alert',\n@body = 'Test',\n@query = @SQL,\n@execute_query_database = 'MyDB'\n</code></pre>\n\n<p>SQL Agent is running under a domain account [MyDomain\\sqlagent].  I granted this user db_owner permission in the MyDB database in addition to adding it as a member of the DatabaseMailUserRole in msdb.  Still no luck.  If I remove the @query and @execute_query_database parameters it will send a test email.  However, I need to attach the results from the query.</p>\n\n<p>Any help is appreciated, thanks.</p>\n"},{"tags":["sql-server","sql-server-2008","logging","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12976938,"title":"Log of stored procedure parameters?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10279470/tracing-a-stored-procedures-parameters-handling\">Tracing a stored procedures parameters handling</a>  </p>\n</blockquote>\n\n\n\n<p>Is there any out-of-the-box functionality within SQL Server 2008 that will allow me to see a log of procedures executed, and the parameters passed?  </p>\n\n<p>We have a stored procedure whose return is used to determine if a user can log in to our application or not, and the stored procedure is returning some unexpected results. I'm trying to troubleshoot by seeing if the user ID is getting garbled as it's passed to the stored procedure, but I can't quite seem to find where I could go to check that.</p>\n\n<p>Does such a log/viewer exist?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":96,"score":1,"question_id":12976538,"title":"Removing duplicate combinations from result set in SQL Server","body":"<p>I have a table with two columns with data like this:</p>\n\n<pre><code>1,2\n1,3\n1,4\n2,1\n2,2\n3,1\n</code></pre>\n\n<p>I want to select just unique combinations, so out of those I would end up with:</p>\n\n<pre><code>1,2\n1,3\n1,4\n2,2\n</code></pre>\n\n<p>because 1,2 is the same combination as 2,1 etc</p>\n\n<p>How would I go about that in a SQL statement?</p>\n\n<p>In reality, my table has a third column and I want to add a where clause based on that third column so that only those rows are considered</p>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":34,"score":1,"question_id":12977862,"title":"Subtract values of same column of a table depending on other column","body":"<p>I have a tabe <code>InvoiceOrderDetails</code>. It has following columns: </p>\n\n<pre><code>InvoiceNumber\nRecType\nAmount\nProjectCode\n</code></pre>\n\n<p>There can be multiple invoice numbers for the same <code>projectCode</code>. The <code>RecType</code> indicates that whether full payment has been made by client or not. </p>\n\n<p>For example: total invoice amount for <code>Project XYZ</code> is 9000$. Client paid the first installment of 3000$. Now the next invoice which will be sent to client is of 6000$. Also, if <code>Rectype</code> is 1 means full payment is done else there's still a balance pending. </p>\n\n<p>Now I have to create a computed column and display it in a grid where I want to show the remaining amount to client. That means, I have to check <code>RECTYPe</code> for all the invoices, grouped by <code>ProjectCode</code> and subtract the amount where with <code>Rectype</code> 1 from the amount with rectype 2.</p>\n\n<p>I am not able to get how to compute the column and display in the grid. I am using Asp.Net (C# 2010) along with SQL Server 2008. </p>\n\n<p>Any suggestions will be appreciated. </p>\n"},{"tags":["sql","sql-server-2008","group-by"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12957446,"title":"SQL How to group a table with special condition and join to another table","body":"<p>i have Table PRICE</p>\n\n<pre><code>CodePrice  CodeClient  TheZone Tempo W_Begin W_End Price\nA_0_49       88989       1       1      0      49   20\nA_50_99      60000       1       1      50     99   10\nB_0_49       88989       2       1      0      49   30\nC_0_49       50000       3       4      0      49   40\n</code></pre>\n\n<p>Table Ordre</p>\n\n<pre><code>  NoID  CodeClient    Cp   Agence  TheZone Tempo Weight \n    01      88989     44   bidon      1      1     12\n    02      60000     49   toto       2      2     10\n    03      60000     49   bigoi      1      1     56\n    04      88989     49   titi       3      3     8\n    05      50000     44   bidon      1      1     5\n</code></pre>\n\n<p>How can i show the result like this:</p>\n\n<pre><code>CodePrice   TheZone Tempo W_Begin W_End  SUm_Weight  SUM_Price  CountIDOrdre  CP   Agence\n  A_0_49        1       1      0      49       17         40          2         44    bidon\n  A_50_99       1       1      50     99       56         10          1         49    bigoi\n  B_0_49        2       1      0      49       0          0           0         null  null\n  C_0_49        3       4      0      49       0          0           0         null  null\n</code></pre>\n\n<p>in 1 SQL Syntax (1 Step).</p>\n\n<p>Nowdays i make it in 2 step</p>\n\n<pre><code>SELECT CodePrice\n      ,CodeClient\n      ,TheZone         \n      ,Tempo   \n      ,W_Begin\n      ,W_End\n      ,Price          \n  FROM PRICE\n  LEFT JOIN T_TARIF_ZONE ON PRICE.ZONE = T_TARIF_ZONE.NO_ID     \n  LEFT JOIN CLIENT ON PRICE.CodeClient= CLIENT.CODE_CL     \n\n  WHERE CodeClient= @NO_CLIENT AND TheZone = @ZONE AND UNITE = @UNITE \n  AND (Tempo   IN (SELECT ParsedString From dbo.ParseStringList(@ModLiv)))\n\n  ORDER BY MONTANT\n</code></pre>\n\n<p>after i select the price, now i can group the ordre on each price depends on Weight, zone, and another variable</p>\n\n<pre><code>SELECT count(NoID) as LVId            \n      ,sum(Weight)as Tot_Poids        \n      ,sum(Price) as Tot_Prix      \n\n  FROM [Ordre]\n  WHERE Weight&gt;= @TR_DEB AND Weight&lt;= @TR_FIN AND LE_ZONE = @LE_ZONE AND ENLEV_UNITE = @ENLEV_UNITE \n        AND DATE_CLOTURE &gt;= @Date_Deb AND DATE_CLOTURE &lt;= @Date_Fin AND STATUT_LV = 2 AND FACTURATION = @FACTURATION\n\n  HAVING count([NOID]) &gt; 0  \n</code></pre>\n"},{"tags":["sql-server-2008","filestream","denied"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":37,"score":2,"question_id":12977452,"title":"SQL Server 2008 filestream access is denied","body":"<p>Can someone help with an <code>Access is denied</code> error message received when attempting to insert FILESTREAM data into SQL Server 2008?</p>\n\n<p>I have an ASP.NET application running within an application pool configured with an application-specific user.  The web.config uses integrated security...</p>\n\n<pre><code>&lt;connectionStrings&gt;\n   &lt;add name=\"MyApp\" \n        connectionString=\"Data Source=localhost;Initial Catalog=MyDatabase;Integrated Security=SSPI;\"\n        providerName=\"System.Data.SqlClient\" /&gt;\n&lt;/connectionStrings&gt;\n</code></pre>\n\n<p>The application's Windows user belongs to a database role, <code>web_app</code>. This role has execute and select permissions. However I receive the following exception...</p>\n\n<pre><code>System.ComponentModel.Win32Exception (0x80004005): Access is denied\n</code></pre>\n\n<p>Thanks in advance for all help.</p>\n"},{"tags":["sql-server-2008","sql-server-agent"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12968295,"title":"Email notification subject changed after sql server agent job migration","body":"<p>I have a job on my server with email notification on success and failure. The mail notification has the subject as </p>\n\n<blockquote>\n  <p>[The job succeeded.] SQL Server Job System: 'XYZ' completed on \\123.</p>\n</blockquote>\n\n<p>or</p>\n\n<blockquote>\n  <p>[The job failed.] SQL Server Job System: 'XYZ' completed on \\123.</p>\n</blockquote>\n\n<p>Now I have migrated the job to another server but the mail notification is like</p>\n\n<blockquote>\n  <p>SQL Server Job System: 'XYZ' completed on \\456.</p>\n</blockquote>\n\n<p>Why does the subject not contain <code>[The job succeeded.]</code> or <code>[The job failed.]</code>? How to get it back in the subject line of email notification?</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12958838,"title":"sql server 2008 filter on big list passed in","body":"<p>I am having a performance issue.  I am trying to select from a table based on a very long list of parameters</p>\n\n<p>Currently am using this stored proc</p>\n\n<pre><code>CREATE PROC [dbo].[GetFileContentsFromTitles]\n@MyTitles varchar(max)\nAS\nSELECT [Title], [Sequence] From [dbo].[MasterSequence]\nWHERE charindex(',' + Title + ',', ',' + @MyTitles + ',') &gt; 0;\n</code></pre>\n\n<p>Where @MyTitles can be a very big number (currently doing a string with 4000 entries seperated by commas).  Any suggestions?  Thanks  </p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12967467,"title":"Using Table valued function the code","body":"<pre><code>&lt;pre&gt;\nI have 3 tables and one table valued function: EmpHistory,EmpRank,Emp and fnEmpRank.\nThe sample data are given as follows:\nEmpHistory\nEmpHistID  EmpID  RankID  MonitorDate  RankName\n1          aba     JPR     2008-10-06   Junior Prof\n2          aba     JPR     2009-11-07   Junior Prof\n3          aba     TERM    2012-2-08    Termoinated Prof\n4          aba     ASST    2012-6-22     lab Assistant\n5          aba     ASST    2012-7-2      Lab Assistant\n6          aba     TSST    2012-8-4      Terminated Assistant\n\nEmpRank\nRankID    RankName\nJPR       Junior Professor\nSPR       Senior Professor\nASST      Junior Assistant\nSASST     Senior Assistant\nPL        Principal\n\nEmployee\nEmpID    EmpStartDate\naba       2008-10-06\nabc01     2007-09-23\nsdh        2009-7-26\nsbs        2012-2-8\n\n\nThe fnEmpRank function takes the emproleID and gives the employee history same as the empHistory Table. There is also empoyeerole table which has employeeroleid column.\n\nNow my problem is: I want the second last professor rank of the employee i.e in this case I want Junior Professor row(i.e) 2nd row from emphistory table). Currntly my code is using emphistory table but now intead of that table I want to use fnEmpRank as it gives the same data. I am also giving the sample code.\n\n\nselect\na.EmpID,\na.StartDate,\nJ.RankID,\nc.MonitorDate,\nfrom dbo.vwEmployee A(nolock)\nINNER join dbo.EmpHistory c(nolock) on c.Empid = a.EmpID\nand c.EmpHistoryID = (select max(c1.EmpHistoryID)\n            from dbo.EmpHistory c1(nolock)\n            where c1.Empid = c.EmpID\n            and c1.MonitorDate = \n                    (\n</code></pre>\n\n<p>I have 3 tables and one table valued function: EmpHistory,EmpRank,Emp and fnEmpRank.\n    The sample data are given as follows:</p>\n\n<p>create table EmpHistory(\nEmpHistID int,\nEmpID varchar,\nRankID varchar,\nMonitordate Date,\nRankname varchar)</p>\n\n<p>insert into EmpHistory\nselect 1,'aba','JPR','2008-10-6','Junior Professor'</p>\n\n<p>insert into EmpHistory\nselect 2,'aba','JPR','2009-11-7','Junior Professor'</p>\n\n<p>insert into EmpHistory\nselect 3,'aba','TERM','2012-2-8','Terminated Prof'</p>\n\n<p>insert into EmpHistory\nselect 4,'aba','ASST','2012-6-22','Lab Assistant'</p>\n\n<p>insert into EmpHistory\nselect 5,'aba','ASST','2012-7-2','Lab Assistant'</p>\n\n<p>insert into EmpHistory\nselect 1,'aba','JPR','2012-8-4','Terminated Assistant'</p>\n\n<p>create table EmpRank(\nRankID varchar,\nRankName varchar\n)</p>\n\n<p>insert into EmpRank\nselect 'JPR','Junior Professor'</p>\n\n<p>insert into EmpRank\nselect 'SPR','Senior Professor'</p>\n\n<p>insert into EmpRank\nselect 'ASST','Junior Assistant'</p>\n\n<p>insert into EmpRank\nselect 'SASST','Senior Assistant'</p>\n\n<p>insert into EmpRank\nselect 'PL','Principal'</p>\n\n<p>create table Employee(\nEmpID varchar,\nEmpStartDate date\n)</p>\n\n<p>insert into Employee\nselect 'aba','2008-10-06'</p>\n\n<p>insert into Employee\nselect 'abc01','2007-9-23'</p>\n\n<p>insert into Employee\nselect 'sdh','2009-7-26'</p>\n\n<p>insert into Employee\nselect 'sbs','2012-2-8'</p>\n\n<pre><code>The fnEmpRank function takes the emproleID and gives the employee history same as the empHistory Table. There is also empoyeerole table which has employeeroleid column.\n\nNow my problem is: I want the second last professor rank of the employee i.e in this case I want Junior Professor row(i.e) 2nd row from emphistory table). Currntly my code is using emphistory table but now intead of that table I want to use fnEmpRank as it gives the same data. I am also giving the sample code.\n\n\nselect\na.EmpID,\na.StartDate,\nJ.RankID,\nc.MonitorDate,\nfrom dbo.vwEmployee A(nolock)\nINNER join dbo.EmpHistory c(nolock) on c.Empid = a.EmpID\nand c.EmpHistoryID = (select max(c1.EmpHistoryID)\n            from dbo.EmpHistory c1(nolock)\n            where c1.Empid = c.EmpID\n            and c1.MonitorDate = \n                    (\n                    SELECT MAX(C2.MonitorDate)\n                    FROM dbo.EmpHistory C2\n                    WHERE C2.EmpID = C1.EmpID\n                    )\n\n                    )\njoin dbo.EmpRank d(nolock) on d.RankID = a.RankID\nleft join dbo.EmpHistory f(nolock) on f.EmpID = a.EmpID\n    and f.EmpHistoryID = (select max(g.EmpHistoryID)\n                from dbo.EmpHistory g(nolock)\n                where g.EmpID = a.EmpID\n                AND G.RankID not like 'T%'\n                and g.EmpHistoryID &amp;lt; c.EmpHistoryID)\nleft join dbo.EmpRank h(nolock) on h.RankID = f.RankID\n\nLEFT JOIN dbo.EmpHistory J(NOLOCK) ON J.EmpID = A.EmpID \n    AND J.EmpHistoryID = (\n        SELECT max(K.EmpHistoryID )\n        FROM dbo.EmpHistory K(NOLOCK) \n        WHERE K.EmpID = J.EmpID\n        AND K.AgentRankID NOT LIKE 'T%'\n        AND K.MonitorDate = (\n            SELECT max(M.MonitorDate )\n            FROM dbo.EmpHistory M(NOLOCK)\n            WHERE M.EmpID = J.EmpID \n            AND M.RankID NOT LIKE 'T%'\n        )\n    )\n\nwhere\nA.Prof=1\n c.RankID like 'T%'\nAND c.RankID &lt;&gt;'TSST'\nAND A.StartDate is not null\n\nHere there is one more problem: Even if the Employee is terminated from professor to Assitant, A.Prof values is still 1 and basically Assistant dont have the start dates but when professor are transformed to Assitant, they still contain the start date. How can I handle this in the code. Basically this code assumes that that if emp has the start date then he is the professor. Can any one help me?\n\n\n                    SELECT MAX(C2.MonitorDate)\n                    FROM dbo.EmpHistory C2\n                    WHERE C2.EmpID = C1.EmpID\n                    )\n\n                    )\njoin dbo.EmpRank d(nolock) on d.RankID = a.RankID\nleft join dbo.EmpHistory f(nolock) on f.EmpID = a.EmpID\n    and f.EmpHistoryID = (select max(g.EmpHistoryID)\n                from dbo.EmpHistory g(nolock)\n                where g.EmpID = a.EmpID\n                AND G.RankID not like 'T%'\n                and g.EmpHistoryID &lt; c.EmpHistoryID)\nleft join dbo.EmpRank h(nolock) on h.RankID = f.RankID\n\nLEFT JOIN dbo.EmpHistory J(NOLOCK) ON J.EmpID = A.EmpID \n    AND J.EmpHistoryID = (\n        SELECT max(K.EmpHistoryID )\n        FROM dbo.EmpHistory K(NOLOCK) \n        WHERE K.EmpID = J.EmpID\n        AND K.AgentRankID NOT LIKE 'T%'\n        AND K.MonitorDate = (\n            SELECT max(M.MonitorDate )\n            FROM dbo.EmpHistory M(NOLOCK)\n            WHERE M.EmpID = J.EmpID \n            AND M.RankID NOT LIKE 'T%'\n        )\n    )\n\nwhere\nA.Prof=1\n c.RankID like 'T%'\nAND c.RankID &lt;&gt;'TSST'\nAND A.StartDate is not null\n\nHere there is one more problem: Even if the Employee is terminated from professor to Assitant, A.Prof values is still 1 and basically Assistant dont have the start dates but when professor are transformed to Assitant, they still contain the start date. How can I handle this in the code. Basically this code assumes that that if emp has the start date then he is the professor. Can any one help me?\n&lt;/pre&gt;\n</code></pre>\n"},{"tags":["sql-server-2008","ms-access","ms-access-2010","double-quotes","datahandler"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":81,"score":1,"question_id":12973211,"title":"SQL Updates/Inserts with data with double quotes","body":"<p>I have a database that collects client information using assessments and other tools. Often in the assessments there are double quotes in the data when - as may be expected - a direct quote is captured. When I run sql updates (Access front end using VBA to SQL Server 2008 R2 backend) it blows up on double quotes in the data. In the interim I've asked staff to use single quotes when they enter data, but that is an unsustainable solution as they forget and the program crashes when it hits the double quotes. The datatype is nvarchar(max). </p>\n\n<p>The current VBA string looks like this:</p>\n\n<p>strInsertSQL = \"INSERT INTO tblIRPDetail(IRPID, SectionID, Challenge, Goal, Objective, Intervention, IntDate) VALUES(\" &amp; intNewID &amp; \", \" &amp; intSection &amp; \", \"\"\" &amp; strChallenge &amp; \"\"\", \"\"\" &amp; strGoal &amp; \"\"\", \"\"\" &amp; strObjective &amp; \"\"\", \"\"\" &amp; strIntervention &amp; \"\"\", \"\"\" &amp; strIntDate &amp; \"\"\");\"</p>\n\n<p>Essentially any of the strVariables could have single or double quotes in any combination. It works for single quotes but not doubles. Surely this is a fairly common issue, I'm hoping someone has a simple solution!</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql","database","sql-server-2008","query"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12975454,"title":"SQL Server 2008: Finding strings within a table which contain the word World","body":"<p>I'm trying to filter my query to show only table entries with the word WORLD and also contains other country codes. </p>\n\n<p>I have used the wildcard function but I am unsure as to how I can have it only return entries with both WORLD and other country codes.</p>\n\n<pre><code>SELECT *\nFROM [****].[dbo].[Titles]\nWHERE Territories LIKE '%world%'\n</code></pre>\n\n<p>Any help is appreciated </p>\n\n<p>EDIT: Expected result would return all rows with both WORLD and one or more country code in the field. The territories column in this table contains both World or country codes and should bot contain both. the reason im running this query is to search for any rows with bad data.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":786,"score":1,"question_id":2548594,"title":"DBCC SHRINKFILE 1 sproc for multiple databases","body":"<p>I have a need to execute DBCC SHRINKFILE for multiple db's within the same sproc.\nI <em>could</em> create multiple sprocs so it runs within the given context, but I was curious if there were alternatives?</p>\n"},{"tags":["sql-server-2008","asp.net-mvc-4"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":17,"score":0,"question_id":12975607,"title":"MVC 4 make a migration to copy database values?","body":"<p>My friend and I are working on an MVC 4 application in visual studio 2010. We have migrations to synchronize the structure of our database, but we'd like to copy all the values from my database to his database. Is there a way to generate a migration that will handle this? or is the best option to make a back up and restore from the back up?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12975252,"title":"Carriage returns in job history message?","body":"<p>Is this at all possible? It would be nice to be able to use carriage returns in the job history message from print/raiseerror statements. I've tried all the usual stuff (CHAR(13) + CHAR(10), \\n\\r, etc...) to no avail, and I can't find anything on google. It would be nice aesthetically more than anything, like say using a print statement in your proc like \"Objects Created: \" and be able to read that in the job history a little more clearly than a giant blob of text, and I don't really want to write the job history to a log file.</p>\n\n<p>It may very well not be possible, but the distribution REPL-LogReader and some other jobs are tantalizingly able to show output with new lines, so the job history GUI must be able to process that somehow right?</p>\n\n<p>I'm using SSMS with SQL Server 2008. Thanks!</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12954143,"title":"Can a stored procedure return more than 1 value?","body":"<p>Is there anyway a stored procedure can return a list of values e.g. a column named as <code>ClientName</code> and returns all client names.</p>\n\n<p>I don't want to create a view or another table, it has to be done in a stored procedure or if there is any other way around.</p>\n"},{"tags":["sql-server","sql-server-2008","powershell","smo"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12971267,"title":"How to set database options using SQL Server SMO and powershell from a hash?","body":"<p>Using SQL Server 2008 R2 and Powershell 2.0</p>\n\n<p>I have created a hash of options that I want to set in a SQL Server database like so:</p>\n\n<pre><code>$dbopts = @{\n    \"AutoCreateStatistics\"=$true;\n    \"AutoUpdateStatistics\"=$true;\n    \"AutoShrink\"=$false;\n    };\n</code></pre>\n\n<p>I want to set these options on a SQL Server database using SMO. I created a function which accepts a SMO Database object and the DatabaseOptions hash as inputs. </p>\n\n<pre><code>function setDatabaseOptions {\n    param ($db, $opts);\n\n    foreach ($opt in $db.DatabaseOptions) {\n        # what to write here?\n\n    }\n\n}\n</code></pre>\n\n<p>I want to set the options in the hash to the database. Not sure the best way to do this. Any suggestions? An example, to set an option explicitly you would do</p>\n\n<p><code>$db.DatabaseOptions.AutoCreateStatistics = $true</code></p>\n"},{"tags":["sql","sql-server-2008","tsql","function","build"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":70,"score":2,"question_id":12969806,"title":"Get sum/average value of records defining equal time periods","body":"<p>I have the following information (return by view):</p>\n\n<pre><code>DateTime   ItemID  UserTyp Seconds\n\n2012-01-01 10      S       12      \n\n2012-01-01 10      S       18  \n\n2012-01-01 11      S       22  \n\n2012-01-02 11      M       52  \n\n2012-01-02 10      S       120  \n\n2012-01-02 11      S       NULL  \n\n2012-01-03 15      M       112  \n\n2012-01-03 12      S       182  \n\n2012-01-04 10      M       NULL  \n</code></pre>\n\n<p>What I need to done is to calculated the sum of all seconds by user types, but for five periods.</p>\n\n<p>The periods are set in the following way:</p>\n\n<ol>\n<li>Get the first and the last date</li>\n<li>Divided all days on five</li>\n<li>The result of the division is the days that one period includes</li>\n</ol>\n\n<p>Then for each period, depending on the DateTime and the UserType of the records, I should come up with this records:</p>\n\n<pre><code>Periods  UserTypeS_SUM(Seconds) UserTypeM_SUM(Seconds)\n1        \n2        \n3\n4\n5\n</code></pre>\n\n<p>Also, I should check if there is at least 5 records, before the division is make - if I have 4 for example, only one period will be used.</p>\n\n<p>I know it does not look so different, I have started to make a solution using function, but it looks kinda ineffective to me. Are there some build-in functions that could do this easy?</p>\n\n<p>EDIT: I am really sorry but  I have forget to mention that the I should this in view or table-valued function. No store procedures are allowed in this case.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12972320,"title":"How to do an inner join on row number in sql server","body":"<p>SQL Server 2008</p>\n\n<p>Two tables:</p>\n\n<p>Table A has following data:</p>\n\n<pre><code>RowA\nRowB\nRowC\nRowD\n</code></pre>\n\n<p>Table B has following data:</p>\n\n<pre><code>Row4\nRow3\nRow2\nRow1\n</code></pre>\n\n<p>I want to get the following output:</p>\n\n<pre><code>RowA Row1\nRowB Row2\nRowC Row3\nRowD Row4\n</code></pre>\n\n<p>The only common value between the two tables is the row number</p>\n\n<p>I can get the data individually of course:</p>\n\n<pre><code>SELECT val\nFROM A\nORDER BY val\n\nSELECT val\nFROM B\nORDER BY val\n</code></pre>\n\n<p>But how do I join on the row number?</p>\n\n<p>And what if I don't have an order-by, but just want the rows in the order they come out?</p>\n\n<pre><code>RowA Row4\nRowB Row3\nRowC Row2\nRowD Row1\n</code></pre>\n\n<p>as in the join of</p>\n\n<pre><code>SELECT val\nFROM A\n\nSELECT val\nFROM B\n</code></pre>\n"},{"tags":["vb.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12974004,"title":"Connection String with Windows Authentication Mode","body":"<p>I'm trying to test a simple connection to my database with VB.NET on my SQL Server 2008. The problem is my login is with Windows Authentication mode and I enter no password for it to connect to my SQL server.</p>\n\n<p>How will a connection string in this case look like? This has blocked my progress for the whole day. </p>\n\n<pre><code>Public Class Form1\n\n    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click\n        Dim connetionString As String\n        Dim connection As SqlConnection\n        Dim i As Integer\n        connetionString = \"Data Source=PEDRAM-PC\\PEDRAM;Initial Catalog=Test;User ID=Pedram-PC\\Pedram;Password=bro\"\n        connection = New SqlConnection(connetionString)\n        Try\n            connection.Open()\n        Catch ex As Exception\n            MsgBox(ex.ToString)\n        End Try\n    End Sub\nEnd Class\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":55,"score":2,"question_id":12973878,"title":"SQL Server 2008, add 'x' to auto increment value","body":"<p>I am using SQL Server 2008 and what I am trying to do is:</p>\n\n<p><code>update Daily set ReferenceNo = ReferenceNo + 100000</code></p>\n\n<p>I can't do this as this is field is as follows: <code>[ReferenceNo] [bigint] IDENTITY(1,1) NOT NULL,</code></p>\n\n<p>If I try to change remove the auto increment and save the table to do what I need to do I get the following error:</p>\n\n<p><img src=\"http://i.stack.imgur.com/GC0GZ.png\" alt=\"enter image description here\"></p>\n\n<p>Is there a way I can do this without dropping the table?</p>\n"},{"tags":["sql-server-2008","index"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12973521,"title":"Use of (INDEX(0)) in sql query","body":"<p>I run this query on SQL Server 2008:</p>\n\n<pre><code>SELECT * \nFROM Dealers WITH (INDEX(0))\nWHERE ID = 'rrsdsd'\n</code></pre>\n\n<p>But the execution plan shows that it used the clustered index of the table.</p>\n\n<p><img src=\"http://i.stack.imgur.com/5CGSr.png\" alt=\"enter image description here\"></p>\n\n<p>Why so?</p>\n"},{"tags":["sql","sql-server-2008","delphi","delphi-2009"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":165,"score":3,"question_id":12970913,"title":"How to fetch record count from ADO Query?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/4237112/how-to-see-progress-of-query-execution-during-handle\">How to see progress of query execution during handle?</a>  </p>\n</blockquote>\n\n\n\n<p>I would like to show a progress bar indicating how much time it would take to fetch the results from database.  </p>\n\n<p>I use <code>TADOQuery</code> and open it in Async mode.  While the query state is <code>stFetching</code>, is there any way to know the [number of records fetched / total records]?</p>\n"},{"tags":["sql-server-2008","identity-column"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12969626,"title":"Alternative to Identity column","body":"<p>we have Orders table with an identity column (OrderID) but our order number is composed by OrderType (2 chars), OrderYear (2 chars) and OrderID (6 chars), totally 10 chars (i.e. XX12123456).\nThis counter has limitations: we can arrive to identity 999999 as OrderID . Next order will have ID composed by 7 chars. Obviously we cannot ave duplicates order ids.</p>\n\n<p>So we have created a table prefilled with progressive OrderID and OrderYear (from 100000 to 999999, order year from 12 to 16, for instance): this stored procedure begins a transacation with SERIALIZABLE isolation level, take first order id not used, update it as used and commit the transaction.</p>\n\n<p>Being our Orders table, i'm worried about deadlocks on executing order id calculation stored procedure or duplicated orderids.</p>\n\n<p>I'll test this with a console application that create multiple concurrency threads and try to extract orderids simulating a production load.</p>\n\n<p>Doubts are:</p>\n\n<ul>\n<li>Exists another method to simulate an identity column safely?</li>\n<li>May consider usage of triggers?</li>\n<li>May consider differente isolation level?</li>\n<li>Other ideas? :D</li>\n</ul>\n\n<p>Thanks!</p>\n\n<p>[EDIT]</p>\n\n<p>After googling and reading a bunch of MSDN documentation, i've found many examples showing how managing errors and dealocks and approaching a type of automatic reply directly from SP, as follow:</p>\n\n<p>CREATE PROCEDURE [dbo].[sp_Ordine_GetOrderID]</p>\n\n<p>@AnnoOrdine AS NVARCHAR(2) = NULL OUTPUT,\n@IdOrdine AS INT = NULL OUTPUT</p>\n\n<p>AS</p>\n\n<p>SET NOCOUNT ON</p>\n\n<p>DECLARE @retry AS INT\nSET @retry = 2</p>\n\n<p>SET TRANSACTION ISOLATION LEVEL SERIALIZABLE</p>\n\n<p>WHILE (@retry > 0)\nBEGIN\n    BEGIN TRY</p>\n\n<pre><code>    BEGIN TRANSACTION OrderID   \n\n    SELECT TOP 1 @AnnoOrdine = AnnoOrdine, @IdOrdine = IdOrdine\n    FROM ORDINI_PROGRESSIVI --WITH (ROWLOCK)\n    WHERE Attivo = 1\n    --ORDER BY AnnoOrdine ASC, IDOrdine ASC \n\n    UPDATE ORDINI_PROGRESSIVI WITH (UPDLOCK)\n    SET Attivo = 0\n    WHERE AnnoOrdine = @AnnoOrdine AND IdOrdine = @IdOrdine\n\n    IF ISNULL(@IdOrdine, '') = '' OR ISNULL(@AnnoOrdine,'') = ''\n    BEGIN\n        RAISERROR('Deadlock', 1, 1205)\n    END\n\n    SET @retry = 0\n\n    COMMIT TRANSACTION OrderID  \n\n    SELECT @AnnoOrdine AS AnnoOrdine, @IdOrdine AS IdOrdine \n\nEND TRY\nBEGIN CATCH\n\n    IF (ERROR_NUMBER() = 1205)\n        SET @retry = @retry - 1;\n    ELSE\n        SET @retry = -1;\n\n    IF XACT_STATE() &lt;&gt; 0\n        ROLLBACK TRANSACTION;       \n\nEND CATCH\n</code></pre>\n\n<p>END</p>\n\n<p>This approach reduce deadlocks (absent at all) but sometimes i got EMPTY output parameter.\nTested with 30 contemporary threads (so, 30 customers processes that insert orders at the same moment)</p>\n\n<p>Here a debug log with query duration, in milliseconds: <a href=\"http://nopaste.info/285f558758.html\" rel=\"nofollow\">http://nopaste.info/285f558758.html</a></p>\n\n<p>Enough robust for production?</p>\n"},{"tags":["sql-server-2008","postgresql","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12966474,"title":"Is there a SSIS-like feature in PostgreSQL?","body":"<p>We are using the <a href=\"http://msdn.microsoft.com/en-us/library/ms141026.aspx\" rel=\"nofollow\">SSIS (SQL Server Integration Services)</a> in SQL 2008 R2 to copy database tables from 30+ databases (running on SQL Server 2000) to a single database for data analysis purposes on a daily basis. Is there a SSIS-like feature in PostgreSQL? As we are thinking to migrate our database to open source database in the future. Thanks!</p>\n"},{"tags":["sql-server-2008","adventureworks"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":2832,"score":0,"question_id":10223664,"title":"Where to download this version of adventureworks database","body":"<p>Hi all, I started studying SQL Server from this book <a href=\"http://rads.stackoverflow.com/amzn/click/1590599802\" rel=\"nofollow\">SQL Server 2008\nTransact-SQL Recipes</a>.</p>\n\n<p>My problem is I can't get this file <code>AdventureWorks2008.msi</code>.</p>\n\n<blockquote>\n  <p>A majority of the examples in this book use the AdventureWorks\n  database (SQL Server 2008 OLTP version), which can be downloaded\n  online from the CodePlex site (www.codeplex.com), under the Microsoft\n  SQL Server Product Samples: Database project. Look for the file named\n  AdventureWorks2008.msi</p>\n</blockquote>\n\n<p>When I searched I get <a href=\"http://msftdbprodsamples.codeplex.com/releases/view/55926\" rel=\"nofollow\">this</a>.</p>\n"},{"tags":["asp.net","database","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":82,"score":0,"question_id":12909335,"title":"<DataBase> is being recovered. Waiting until recovery is finished","body":"<p>I Have Develop an Application using Asp.net sql server and Jquery Ajax It is giving me </p>\n\n<p> is being recovered. Waiting until recovery is finished.</p>\n\n<p>why this message is coming</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12937126,"title":"Join TableA, TableB and TableC to get data from TableA and TableC","body":"<p>Why I am getting so many records for this</p>\n\n<pre><code>SELECT e.OneColumn, fb.OtherColumn\nFROM  dbo.TABLEA FB\nINNER JOIN dbo.TABLEB eo ON Fb.Primary = eo.foregin\nINNER JOIN dbo.TABLEC e ON eo.Primary =e.Foreign\nWHERE FB.SomeOtherColumn = 0\n</code></pre>\n\n<p>When I am running this I am getting Millions of records which is not the correct case, all tables has less number of records.</p>\n\n<p>I need to get the columns from TableA and TableC and because they are not joined logically so I have to use TableB to act as bridge</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Below is the count:</p>\n\n<pre><code>TABLEA = 273551\nTABLEB = 384412\nTABKEC = 13046\n</code></pre>\n\n<p>Above Query = After 2 minutes I have forcefully canceled the query.. till that time the count was <strong>11437613</strong></p>\n\n<p>Any suggestion?</p>\n"},{"tags":["sql-server","wcf","sql-server-2008","iis6","database-connection"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12970916,"title":"Can't connect to SQL Server from WCF service but I can from Management Studio","body":"<p>I'm trying to connect a .NET Framework 4.0 WCF REST service on an IIS6 to a SQL Server 2008 R2 database with this connection string:</p>\n\n<pre><code>&lt;add name=\"EReportEntities\" \n     connectionString=\"metadata=res://*/EReportModel.csdl|res://*/EReportModel.ssdl|res://*/EReportModel.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;Server=localhost;Database=ADM;User Id=sa;Password=XXXXXXXX;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" \n     providerName=\"System.Data.EntityClient\" /&gt;\n</code></pre>\n\n<p>But I can't. I get:</p>\n\n<pre><code>Event Type: Failure Audit\nEvent Source:   MSSQLSERVER\nEvent Category: (4)\nEvent ID:   18456\nDate:       10/19/2012\nTime:       10:47:48 AM\nUser:       N/A\nComputer:   UNILEVER\nDescription:\nLogin failed for user 'sa'. [CLIENT: &lt;local machine&gt;]\n\nFor more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp.\nData:\n0000: 18 48 00 00 0e 00 00 00   .H......\n0008: 09 00 00 00 55 00 4e 00   ....U.N.\n0010: 49 00 4c 00 45 00 56 00   I.L.E.V.\n0018: 45 00 52 00 00 00 07 00   E.R.....\n0020: 00 00 6d 00 61 00 73 00   ..m.a.s.\n0028: 74 00 65 00 72 00 00 00   t.e.r...\n</code></pre>\n\n<p>But, if I use sa user to login on SQL Server Management Studio I can login.</p>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":23,"score":0,"question_id":12970785,"title":"WMI query - Reporting services and Analysis Services","body":"<p>I want to get configuration value of Native XML Web services, reporting services and Analysis Services. That means they are enabled or disabled.. through WMI Query</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12970907,"title":"Backup SQL Server db in a format to open in Microsoft Access","body":"<p>Is there a way to do a backup for SQL Server db in a format that opens in Microsoft Access or Excel for instance?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","query","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":99,"score":0,"question_id":12966848,"title":"getting the minimum and maximum date in the same query","body":"<p>I have a working query that gives me the maxdate:</p>\n\n<pre><code>SELECT a.client_id AS client_id\n   , a.patientcount AS patientcount\n   , received_date AS maxRecDate\nFROM\n(\n   SELECT DISTINCT CLIENT_ID\n   , PATIENT_ID\n   , count(*) over (partition by client_id, patient_id) AS patientcount\n   from f_accession_daily\n) AS a\nJOIN F_ACCESSION_DAILY AS f ON a.CLIENT_ID = f.CLIENT_ID\n   AND a.PATIENT_ID = f.PATIENT_ID\nGROUP BY f.RECEIVED_DATE, a.CLIENT_ID, a.patientcount\nHAVING f.RECEIVED_DATE = MAX(f.received_date)\n</code></pre>\n\n<p>In the same query I would also like to return min(f.received_date).</p>\n\n<p>Is there a way to do this? perhaps with the subquery?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":3,"view_count":47,"score":-3,"question_id":12970585,"title":"How to Rename Column name using DDL Statement in SQL","body":"<p>How to Rename <strong>Column</strong> name using <strong>DDL</strong> Statement in SQL</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":4,"view_count":51,"score":-4,"question_id":12967813,"title":"Find path and height using SQL Server 2008","body":"<p>I need to find the start node and last node, and the height if possible, in the table where null indicates last node.</p>\n\n<pre><code>A       B\n1       2\n2       3\n3       4\n4       5\n5       6\n6       Null\n2       3\n3       4\n4       5\n5       6\n6       7\n7       Null\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","database-replication"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":15,"score":1,"question_id":12968668,"title":"SQL Server merge replication (subscription does not exist)","body":"<p>I have setup a merge replication for almost 21 servers. Everything was OK, but after few days all subscriptions failed.</p>\n\n<p>In the subscription servers, although I have subscription in the subscription menu.</p>\n\n<p>Messages stating <code>the subscription does not exist</code>.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","cursor","odbc"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12965080,"title":"Is there a way to set ODBC Connection options in a DSN?","body":"<p>My application (a testcase automation tool) does not support calling ODBC's <a href=\"http://msdn.microsoft.com/en-us/library/ms130794.aspx\" rel=\"nofollow\">SQLSetStatmentOption</a>. I need to set the cursor option <a href=\"http://msdn.microsoft.com/en-us/library/ms131361.aspx\" rel=\"nofollow\">SQL_SOPT_SS_CURSOR_OPTIONS to SQL_CO_FFO_AF</a>. Right now I connect to the server using a connection string (no DSN). I am using <a href=\"http://msdn.microsoft.com/en-us/library/ms131291.aspx\" rel=\"nofollow\">sqlsrv32.dll or Sqlncl10.dll</a>.</p>\n\n<p>Is there a way to set the cursor option in a DSN (or other layer) between my tool and the MSSQL server?  The tool handles creating the cursor (or results set) and iterating through the result set in a way that seems to obscure any ability to manage it directly. It does allow for calling SQLSetConnectAttr() but as far as I can tell there's no way to set a cursor option in there.</p>\n\n<p>All of this is an attempt to speed up retrieving data over a remote connection. In SQL Management Studio I get comparable response times to the local or remote DB, but in the automation tool the remote queries take hundreds of times longer, probably because it seems to be making a round trip to the sever for every row.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12966509,"title":"converting normal query into fancy or partition/over query","body":"<p>My query:</p>\n\n<pre><code>with cte as (\n        select client_id,COUNT(patient_id) PatientCount from\n        (\n            select client_id,patient_id\n            from F_ACCESSION_DAILY\n            group by CLIENT_ID,PATIENT_ID\n            having COUNT(ACCESSION_ID)=2\n        ) a\n        group by CLIENT_ID\n)\n</code></pre>\n\n<p>works, but is not so useful to me. because although i can JOIN easily on this query, I will actually need to repeat this <code>WITH</code> statement many times because i need to be able to differentiate between:</p>\n\n<pre><code>having count(Accession_id)=2\n</code></pre>\n\n<p>and</p>\n\n<pre><code>having count(Accession_id)=3\n</code></pre>\n\n<p>and</p>\n\n<pre><code>having count(accession_id)=4\n</code></pre>\n\n<p>and so on until around 100</p>\n\n<p>i was thinking to do something more like this:</p>\n\n<pre><code>select distinct client_id, patient_id, count(*) over (partition by client_id, patient_id,accession_id) patientcount\n    from f_accession_daily\n</code></pre>\n\n<p>but i am stuck!</p>\n\n<p>i was wondering if you can point me into the right direction on how to convert the initial query into something <strong>more useable when having count(Accession)=many different values</strong>?</p>\n\n<p>thanks so much for your guidance.</p>\n"},{"tags":["sql-server-2008","replication"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3438,"score":1,"question_id":4123622,"title":"The process could not execute 'sp_replcmds' on <ServerName>","body":"<p>I am having a lot of trouble setting up transactional replication on my test server.  I am running SQL Server 2008 SP2.</p>\n\n<p>I am able to create a transactional publication.  The snapshot agent works fine and subscribing to the publication works fine as well.  The problem that I get is that the log reader agent fails with the error:</p>\n\n<p>The process could not execute 'sp_replcmds' on [ServerName]</p>\n\n<p>The snapshot and log reader agents are run under a windows account with administrator privileges on the domain and sysadmin privileges on the sql server.  I have also tried running the agents under the SQL agent profile.  I have tried executing sp_replflush and restarting the SQL agent.  I have also tried increasing -LoginTimeout to 500 and -ReadBatchSize to 10.</p>\n\n<p>Any help greatly appreciated.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","service-broker"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":29,"score":2,"question_id":12968549,"title":"linking multiple queues to same service in SQL service broker","body":"<p>Hi Everyone,\n            I have just started working with SQL service broker. I was wondering if we can <strong>link two service broker queues to same service</strong> such that when a message is sent using that service, it will be delivered to both queues i.e both the queues will contain same copy of a message. Is there any way like this or there is some other way to do this? </p>\n\n<p>Thanks in advance</p>\n\n<p>Pankaj</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12963480,"title":"Duplicate in SQL Server 2008","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/12904087/delete-script-sql-server-2008\">Delete script SQL Server 2008</a>  </p>\n</blockquote>\n\n\n\n<p>Here is a situation that I am trying to resolve. I have a table that is loaded with duplicates. It happened because similar rows were loaded from two or more different sources. That is being taken care of in the package.</p>\n\n<p>But I want to delete those rows which are duplicates. There is no key attribute here. Example of the sources are <code>Cleveland City</code> and <code>Ohio State</code>. And I have a column that shows from which source the row was loaded from (<code>DataSource</code> column).</p>\n\n<p>Thus in the row it shows as <code>DataSource = 'Cleveland'</code> or <code>DataSource = 'Ohio'</code>.</p>\n\n<p>I want to keep those records that resulted to be duplicates when they got loaded from Ohio. Its 100k records I may have to use joins. And one more thing my main table is joined with other four or five tables with <code>rId</code> which is unique for each row, that's why you see me joining with this tables and I DO NOT think I did it right. </p>\n\n<p>Could you check my work guys? I <strong>really</strong> appreciate it.</p>\n\n<pre><code> --Delete ct from--this is to delete w/c is my main intention\n SELECT * \n FROM\n  (\n     (\n        SELECT Rid,UID,ADDRESS,City,State,Zip,DataSource  \n        FROM F_staRes where dataSource='Ohio'\n     ) O inner join\n     (\n           SELECT Rid,UID,ADDRESS,City,State,Zip,DataSource  \n           FROM F_staRes \n           where DataSource  in   ('Clev','Columbus')\n     ) ct\n          on O.UID=ct.UID and O.ADDRESS=ct.ADDRESS  and O.City=ct.City and   \n          O.State=ct.State  and O.zip=ct.zip\n\n            join dbo.ResOrig ro\n            on ct.rId=ro.rId \n\n            join dbo.ResSta rs\n            on ct.rId=rs.rId\n\n            join dbo.ResDest rd \n            on ct.rId=rd.rId\n\n           where ct.DataSource in ('Clev','Columbus')\n</code></pre>\n"},{"tags":["c#","sql-server-2008","enterprise-library","connection-pooling"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":77,"score":1,"question_id":12908709,"title":"MS Enterprise Library data access - Understanding SQL 'user connections' management","body":"<p>I'm trying to understand how MS Enterprise Library's data access block manages its connections to SQL. The issue I have is that under a steady load (from a load test), at 10 minute intervals the number of connections to SQL increases quickly - which causes noticeable jump in page response times from the website.</p>\n\n<p><em>This is the scenario I'm running:</em></p>\n\n<ul>\n<li>Visual Studio load test tools, running against 3 web servers behind a load balancer\n<ul>\n<li>The tools give full visibility over the performance counters to all web + DB boxes</li>\n</ul></li>\n<li>The tests take ~10 seconds each, and perform 4 inserts (form data), and some trivial selects</li>\n<li>There are 60 tests running concurrently. There is no increase or decrease in load during the entire test.\n<ul>\n<li>The test is run for between 20 minutes and 3 hours, with consistent results.</li>\n</ul></li>\n</ul>\n\n<p><em>And this is the issue we see:</em></p>\n\n<ul>\n<li>Exactly every 10 minutes, the performance counter from SQL for <strong>SQL General: User Connections</strong> increases - by ~20 connections total\n<ul>\n<li>The pages performing the HTTP post / DB insert are the ones most significantly affected. The other pages show moderate, but noticeable rises.</li>\n<li>The CPU/memory load on the web servers is unaffected</li>\n</ul></li>\n<li>This increase corresponds with a notable bump in page response times - E.g. from .3 seconds average to up to 5 seconds</li>\n<li>After ~5 minutes it releases many of the connections, with no affect on web performance\n<ul>\n<li>The following 5 minutes of testing gives the same (normal) web performance</li>\n<li>Ultimately, the graph looks like a <a href=\"http://www.sfu.ca/sonic-studio/handbook/Square_Wave.html\" rel=\"nofollow\">square wave</a> </li>\n</ul></li>\n<li>Happens all over again, 10 minutes after the first rise</li>\n</ul>\n\n<hr>\n\n<p><em>What I've looked at:</em></p>\n\n<p><strong>Database calls:</strong></p>\n\n<p>All calls in the database start with:</p>\n\n<pre><code>SqlDatabase database = new SqlDatabase([...]);\n</code></pre>\n\n<p>And execute either proc with no required output:</p>\n\n<pre><code>return database.ExecuteScalar([...], [...]);\n</code></pre>\n\n<p>Or read wrapped in a using statement:</p>\n\n<pre><code>using (SqlDataReader reader = (SqlDataReader)database.ExecuteReader([...], [...]))\n{\n    [...]\n}\n</code></pre>\n\n<p>There are no direct uses of SqlConnection, no .Open() or .Close() methods, and no exceptions being thrown</p>\n\n<p><strong>Database verification:</strong></p>\n\n<p>We've run SQL profiler over the login / logout events, and taken snapshots with the <a href=\"http://sqlserverplanet.com/dba/using-sp_who2\" rel=\"nofollow\">sp_who2</a> command, showing who owns the connections. The latter shows that indeed the web site (seen by machine + credential) are holding the connections.</p>\n\n<p>There are no scheduled jobs (DB or web server), and the user connection load is stable when there is no load from the web servers.</p>\n\n<p><strong>Connection pool config</strong></p>\n\n<p>I know the min &amp; max size of the connection pool can be altered with the connection string.</p>\n\n<p>E.g.: </p>\n\n<blockquote>\n  <p>\"Data Source=[server];Initial Catalog=[x];Integrated Security=SSPI;<strong>Max\n  Pool Size=75;Min Pool Size=5;</strong>\"</p>\n</blockquote>\n\n<p>A fall back measure may be to set the minimum size to ~10</p>\n\n<p>I understand the default max is 100, and the default min is 0 (<a href=\"http://www.techrepublic.com/article/educate-yourself-about-net-sql-server-connection-string-syntax/6084879\" rel=\"nofollow\">from here</a>)</p>\n\n<p>I'm a little bit lithe to think of connection pooling (specific to this setting) and the User Connections performance counter from SQL. <a href=\"http://msdn.microsoft.com/en-us/library/8xx3tyca%28v=vs.100%29.aspx\" rel=\"nofollow\">This article</a> introduces these connection pools as being used to manage connection string, which seems different to what I assume it does (hold a pool of connections generally available, to avoid the cost of re-opening them on SQL)</p>\n\n<p>I still haven't seen any configuration parameters that are handily defaulting to 5 or 10 minutes, to zero in on...</p>\n\n<hr>\n\n<p>So, any help is appreciated. </p>\n\n<p>I know that 10 minute spikes sounds like a change in load, or new activity is happening - but we've worked quite hard to isolate those &amp; any other factors - and for this question, I am hoping to understand EL scaling its connections up &amp; down.</p>\n\n<p>Thanks.</p>\n"},{"tags":["asp.net","database","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":58,"score":1,"question_id":12957447,"title":"Rules of thumb when storing large amounts of data in a database","body":"<p>I am thinking about creating an online journal that will hold large amounts of text. I am looking at purchasing one of go-daddys packages that comes with a database of 200mb. So are there any rules of thumb when it comes to storing large amounts of text in a database?</p>\n\n<p>Or would it be better if I stored the data in text files and then request the specific file when it is needed?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":43,"score":2,"question_id":12036030,"title":"SQL - find total records that occur before another","body":"<p>I have the following schema and want to find the number of clients that have a typeId of 10 appearing first.  The answer with the following data would be 2 (client id 1000 and 1003 have a 10 on the 1st January and an 11 on 2nd January.</p>\n\n<pre><code>CREATE TABLE Event (ClientId int, TypeId int, Date smalldatetime)\nINSERT Event (ClientId , TypeId, Date) VALUES (1000, 10, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1000, 11, '2 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1001, 11, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1001, 10, '2 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1002, 11, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1003, 10, '1 JAN 12')\nINSERT Event (ClientId , TypeId, Date) VALUES (1003, 11, '2 JAN 12')\n</code></pre>\n\n<p>I have tried a few queries with ROW_NUMBER() but have got a bit lost.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12702524,"title":"unable to drop and create database in sql server","body":"<p>I'm working with SQL Server 2008 and I can't seem to do drop and create a database.</p>\n\n<p>I've tried a few different ways but I always end up failing to drop or trying to \"use\" before it seems to be created.</p>\n\n<p>My current attempt looks like this.</p>\n\n<pre><code>use master;\nGO\nIF EXISTS (SELECT name FROM master.dbo.sysdatabases WHERE name = N'test')\nBEGIN\nDROP DATABASE [test];\nEND\nGO\nCREATE DATABASE [test];\nGO\nuse [test];\nGO\n</code></pre>\n\n<p>The <code>GO</code> were suggested on a MS forum as a way to stop some issues that occur when selecting databases.</p>\n\n<p>With this I currently get the output (with a ore existing database of the same name) of:</p>\n\n<blockquote>\n  <p>Msg 3702, Level 16, State 4, Line 3<br>\n  Cannot drop database \"test\" because it is currently in use.<br>\n  Msg 1801, Level 16, State 3, Line 1<br>\n  Database 'test' already exists. Choose a different database name.<br>\n  Msg 2714, Level 16, State 6, Line 2<br>\n  There is already an object named 'staff_type' in the database.</p>\n</blockquote>\n\n<p>With the last 2 lines repeated for every table in my database.</p>\n\n<p>I'm sure its a simple issues as its only 3 quick lines in MySQL so it cant be that hard in TSQL.</p>\n\n<p>As always, any help or suggestions would be amazing.</p>\n"},{"tags":["sql-server","sql-server-2008","entity-framework"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":44,"score":0,"question_id":12965181,"title":"How to create generic column in database table?","body":"<p>I have a table with a large number of very specific columns which are mostly \"Strings\". I believe this hardcoding of names will give me grief later on when rules changes. I am investigating the option of using a second table where each row is a column from the master table which could each have a lookup key for its name.</p>\n\n<p>I know this may seem anti ER best practice, but it would be flexible. I could use views with subselects ie Select (SQL1), (SQL2) etc from Table1. Not sure if one can update a multitable view though in SQLServer. </p>\n\n<p>Thoughts on the above greatly appreciated.</p>\n\n<p>Thanks,</p>\n\n<p>Ed</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12963698,"title":"How to round a SQL time variable?","body":"<p>I have declared a time variable with value 23:59:59. So, I need to round it to 24:00. Have you any idea?</p>\n\n<pre><code>declare @t1 time = '23:59:59'\n</code></pre>\n\n<p>This is necessary only in the select statement. I know that time cannot be inserted as 24:00.</p>\n\n<p><a href=\"http://msdn.microsoft.com/en-us/library/bb677243(v=sql.105).aspx\" rel=\"nofollow\">http://msdn.microsoft.com/en-us/library/bb677243(v=sql.105).aspx</a></p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12964650,"title":"can you join on a stored procedure?","body":"<p>I have a bunch of <code>WITH</code> statements:</p>\n\n<pre><code>;with OneAccession as (\n        select client_id,COUNT(patient_id) PatientCount from\n        (\n            select client_id,patient_id\n            from F_ACCESSION_DAILY\n            group by CLIENT_ID,PATIENT_ID\n            having COUNT(ACCESSION_ID)=1\n        ) a\n        group by CLIENT_ID\n    )\n    ,\n\n    TwoAccessions as (\n    select client_id,COUNT(patient_id) PatientCount from\n        (\n            select client_id,patient_id\n            from F_ACCESSION_DAILY\n            group by CLIENT_ID,PATIENT_ID\n            having COUNT(ACCESSION_ID)=2\n        ) a\n    group by client_id\n    )\n\n    ,\n\n    ThreeAccessions as (\n    select client_id,COUNT(patient_id) PatientCount from\n    (\n        select client_id,patient_id\n        from F_ACCESSION_DAILY\n        group by CLIENT_ID,PATIENT_ID\n        having COUNT(ACCESSION_ID)=3\n    ) a\n    group by client_id\n    )\netc\n</code></pre>\n\n<p>And I join these statements on </p>\n\n<pre><code>select * from myTable\njoin OneAccession\non...\njoin TwoACcessions\non...\njoin ThreeAccessions\n</code></pre>\n\n<p>Instead of having all those <code>with</code> statements, can i just create a stored proc? I would just pass the value of <code>having count(accession_id)=**@myParam**</code> and do this:</p>\n\n<pre><code>select * from myTable\njoin storedproc(1)\non...\njoin storedproc(2)\non...\netc...\n</code></pre>\n\n<p><strong>Is there an issue on joining on a stored Proc?</strong> Is my methodology OK?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":68,"score":0,"question_id":12944646,"title":"how to create a subquery in sql using count based on outer query","body":"<p>I hope someone can help me with this query. Basically I have two queries that I want to \"combine\". I want the second query as an extra column along with the first query.\nThe first one is this :</p>\n\n<pre><code>SELECT t_Item_Storage_Location.Storage_Loc_Nbr, \nt_Storage_Location.Storage_Loc_Type_Code, \nCount(t_Load.Load_Id) AS CurrentLoadCount,\nt_load.MMM_Id_Nbr\n\nFROM t_Load INNER JOIN (t_Storage_Location INNER JOIN t_Item_Storage_Location ON \nt_Storage_Location.Storage_Loc_Nbr = t_Item_Storage_Location.Storage_Loc_Nbr) ON \n(t_Load.Storage_Loc_Nbr = t_Item_Storage_Location.Storage_Loc_Nbr) \nAND (t_Load.MMM_Id_Nbr = t_Item_Storage_Location.MMM_Id_Nbr)\n\n\nwhere ((((t_Item_Storage_Location.MMM_Id_Nbr) Between '702004%' And '702011%') \nAND ((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%A') \nAND ((t_Storage_Location.Storage_Loc_Type_Code)='CD') \nAND ((t_Load.Active_Status_Ind)='A') \nAND ((t_Load.QC_Status_Code) Like 'R%') \nAND ((t_Load.MMM_Facility_Code)='MC')) \nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%B'))\nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%C')) \nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%D')) \nOR (((t_Item_Storage_Location.Storage_Loc_Nbr) Like '%E'))\n\n)\nGROUP BY t_Item_Storage_Location.MMM_Id_Nbr,\nt_Item_Storage_Location.Storage_Loc_Nbr, \nt_Storage_Location.Storage_Loc_Type_Code,\nt_Load.MMM_Facility_Code,\nt_load.MMM_Id_Nbr\n\nHAVING\nCount(t_Load.Load_Id)&lt;4\n</code></pre>\n\n<p>The second one, is based on the t_load.MMM_Id_Nbr of the first one. Basically I want a count of all the loads with that mmm_id_nbr.</p>\n\n<pre><code>SELECT count(Load_ID) as LoadCount, MMM_Id_Nbr, storage_Loc_Nbr\nFROM t_load \nWHERE QC_Status_Code like 'R%' and mmm_Facility_Code ='MC' and Active_Status_Ind='A'\nGROUP by MMM_Id_Nbr, storage_loc_Nbr\n</code></pre>\n"},{"tags":["algorithm","sql-server-2008","c#-4.0","linq-to-sql"],"answer_count":4,"favorite_count":3,"up_vote_count":8,"down_vote_count":0,"view_count":188,"score":8,"question_id":12866338,"title":"Select distinct groups of rows according to average","body":"<p>I have table <code>t_stats</code> with column <code>id (INT)</code> and column <code>ratio (DECIMAL(8,4))</code>.\n<code>id</code> is unique.</p>\n\n<p>I want to query table <code>t_stats</code> in order to select 3 groups with the same <code>AVG(ratio)</code> (closest possible).</p>\n\n<p>Can be done using temporary tables, as long as I can run it as a script or stored procedure.</p>\n\n<hr>\n\n<p>EDIT: Here is the concrete example:</p>\n\n<p>INPUT:</p>\n\n<pre><code>id    ratio\n--    -----\n24  0.930000\n25  0.390000\n26  0.800000\n27  0.920000\n28  0.550000\n30  0.810000\n31  0.770000\n32  0.800000\n33  0.590000\n36  0.760000\n37  0.910000\n40  0.690000\n43  0.390000\n45  0.310000\n46  0.760000\n47  0.710000\n54  0.710000\n55  0.950000\n57  0.920000\n60  0.890000\n62  0.700000\n66  0.890000\n68  0.950000\n107 0.760000\n559 0.990000\n560 0.540000\n565 0.430000\n566 0.830000\n568 0.590000\n579 0.970000\n599 0.900000\n623 0.450000\n749 0.800000\n750 0.970000\n753 0.820000\n754 0.730000\n766 0.620000\n768 0.430000\n770 0.790000\n838 0.700000\n875 0.835000\n987 0.900000\n988 0.740000\n1157    0.850000\n1250    0.630000\n1328    0.860000\n2171    0.900000\n2176    0.520000\n2177    0.980000\n2178    0.940000\n2180    0.970000\n2184    0.990000\n2187    0.950000\n2188    0.940000\n2189    0.920000\n2195    0.990000\n2233    0.900000\n2234    0.940000\n2235    0.950000\n2240    0.980000\n2243    0.920000\n2253    0.900000\n2266    0.530000\n2269    0.920000\n2270    0.970000\n2271    0.750000\n2272    0.820000\n2275    0.910000\n2277    0.930000\n2281    0.690000\n2282    0.710000\n2288    0.840000\n2528    0.870000\n2778    0.950000\n2814    0.990000\n</code></pre>\n\n<p>OUTPUT:</p>\n\n<pre><code>groupId    id     ratio\n-------    --     -----\n1       24      0.930000\n1       25      0.390000\n1       27      0.920000\n1       30      0.810000\n1       32      0.800000\n1       36      0.760000\n1       54      0.710000\n1       60      0.890000\n1       559     0.990000\n1       560     0.540000\n1       566     0.830000\n1       568     0.590000\n1       623     0.450000\n1       750     0.970000\n1       838     0.700000\n1       987     0.900000\n1       1157        0.850000\n1       2178        0.940000\n1       2180        0.970000\n1       2253        0.900000\n1       2269        0.920000\n1       2271        0.750000\n1       2281        0.690000\n1       2778        0.950000\n1       2814        0.990000\n2       26      0.800000\n2       28      0.550000\n2       31      0.770000\n2       40      0.690000\n2       45      0.310000\n2       55      0.950000\n2       57      0.920000\n2       66      0.890000\n2       107     0.760000\n2       565     0.430000\n2       579     0.970000\n2       753     0.820000\n2       754     0.730000\n2       766     0.620000\n2       875     0.835000\n2       1328        0.860000\n2       2176        0.520000\n2       2177        0.980000\n2       2184        0.990000\n2       2187        0.950000\n2       2189        0.920000\n2       2233        0.900000\n2       2234        0.940000\n2       2275        0.910000\n2       2282        0.710000\n3       33      0.590000\n3       37      0.910000\n3       43      0.390000\n3       46      0.760000\n3       47      0.710000\n3       62      0.700000\n3       68      0.950000\n3       599     0.900000\n3       749     0.800000\n3       768     0.430000\n3       770     0.790000\n3       988     0.740000\n3       1250        0.630000\n3       2171        0.900000\n3       2188        0.940000\n3       2195        0.990000\n3       2235        0.950000\n3       2240        0.980000\n3       2243        0.920000\n3       2266        0.530000\n3       2270        0.970000\n3       2272        0.820000\n3       2277        0.930000\n3       2288        0.840000\n3       2528        0.870000\n</code></pre>\n\n<p>So I want to make 3 groups of <code>n</code> values and aim for a specific average value <code>x</code>. (Exemple with <code>n=30</code> and <code>0.75 &lt; x &lt; 0.85</code> would look like 3 groups of 30 values each where each group has <code>0.75 &lt; AVG(ratio) &lt; 0.85</code> and an <code>id</code> can only belong to 1 group.)</p>\n\n<p>So average is almost same in each group, and close to <code>x</code>:</p>\n\n<pre><code>groupId     avg(ratio)\n-------     ----------\n1           0.805600\n2           0.789000\n3           0.797600\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2005","c#-4.0","dll",".net-assembly"],"answer_count":1,"favorite_count":0,"up_vote_count":5,"down_vote_count":0,"view_count":102,"score":5,"question_id":12130591,"title":"Support multiple assemblies on ASP.NET\\C# projects","body":"<p>We're developing a ASP.NET application and having some problems with integration with a MS dll (Microsoft.AnalysisServices)?</p>\n\n<p>The original project was linked to the dll which came with SQLServer2005 (Version=9.0.242.0). After migrating to SQLServer2008R2 (version=10.0.0.0) we encountered this problem: </p>\n\n<blockquote>\n  <p>Could not load file or assembly 'Microsoft.AnalysisServices,\n  Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91'\n  or one of its dependencies. The system cannot find the file\n  specified.</p>\n</blockquote>\n\n<p>This is understood since we compile the project with one version and then another version is located on the server. After installing SQLServer2008R2 on the development machine the problem was fixed. </p>\n\n<p>However we now have another problem that we need to support both SQLServer2005 and SQLServer2008R2 environments. I know that we can redirect the search path for the dll using a config file (that it will search for a different version that what it was compiled with), but I can't seem to find instructions how to use it for Web Application (on w3wp). We tried to use \"Specific Version\"=false, but since this is a \"Strong Name\" assembly it doesn't work as one would think.</p>\n\n<p>The relevant link which I found is this:<br>\n<a href=\"http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/47d0b992-3c10-4851-b2a5-9f72d2c0976e\" rel=\"nofollow\">http://social.msdn.microsoft.com/Forums/en-US/sqlanalysisservices/thread/47d0b992-3c10-4851-b2a5-9f72d2c0976e</a></p>\n\n<p>Can someone please direct me to a link for solving this issue?</p>\n\n<p>Update: I guess I didn't test it correctly since it doesn't work for other servers in SQLServer2008 R2. I guess you can't use range in the newVersion element. So the question is still opened for everyone! . Bottom line is that I know that I have version 9.0.242.0 but the customers version may be either 9.0.242.0 or 10.0.0.0. Is there a method which I can dynamically choose the correct assembly on the production server</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":41,"score":2,"question_id":12961562,"title":"SQL Server : using elements in a case statement that might be NULL","body":"<p>Okay, so I have a question about using columns in a case statement that might be null.</p>\n\n<p>Again I have two tables the first looks like this <code>UserActivity</code>:</p>\n\n<pre><code>   userID    Action    Time\n     1         25       12:00\n     1         10       12:01\n     1         12       12:35\n     1          6       13:54\n     2         10        6:47\n     2         42        6:48\n     3          8       11:54\n     etc.\n</code></pre>\n\n<p>But the second now looks like this <code>UserSchedule</code>:</p>\n\n<pre><code>   userID      startTime1        stopTime1     startTime2    stoptime2  startTime3    stopTime3\n     1            07:00            09:00         11:00         12:00       14:30         16:30\n     2            11:00            12:30         14:00         15:30       \n     3            14:00            15:00\n    etc.\n</code></pre>\n\n<p>So I need to be able to evaluate when in relation to all of those start and stop times an Action took place. Some users will have up to 5 start/stop times in a day. Some will only have one.</p>\n\n<p>This code was given to me to resolve an earlier issue by @Adam Wengler, and it works great if there is only one start and stop time. I'm unsure how to include the logic to test against each of the 5 potential start/stop columns and ignore them if they are empty.</p>\n\n<pre><code>  UPDATE ua\n  SET ua.TimeStatusId = CASE\n                    WHEN ua.Time &gt;= us.Schedule_Start\n                       AND ua.Time &lt;= us.Schedule_stop THEN 1\n                    WHEN ua.Time &gt;= DATEADD(HOUR, -1, us.Schedule_Start)\n                       AND ua.Time &lt;= us.ScheduleStart THEN 0\n                    WHEN ua.Time &gt;= us.Schedule_Stop\n                       AND ua.Time =&lt; DATEADD(HOUR, 1, us.Schedule_Stop)\n                       THEN 2\n                    ELSE 3\n                  END\n  FROM dbo.UserActivity AS ua\n  INNER JOIN dbo.userSchedule AS us ON ua.UserId = us.UserId\n</code></pre>\n"},{"tags":["sql-server","performance","sql-server-2008","tsql","insert"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":117,"score":1,"question_id":12956286,"title":"Optimal insert/update batch for SQL Server","body":"<p>I'm making frequent inserts and updates in large batches from c# code and I need to do it as fast as possible, please help me find all ways to speed up this process.</p>\n\n<ol>\n<li>Build command text using <code>StringBuilder</code>, separate statements with <code>;</code> </li>\n<li>Don't use <code>String.Format</code> or <code>StringBuilder.AppendFormat</code>, it's slower then multiple <code>StringBuilder.Append</code> calls</li>\n<li>Reuse <code>SqlCommand</code> and <code>SqlConnection</code></li>\n<li>Don't use <code>SqlParameter</code>s (limits batch size)</li>\n<li>Use <code>insert into table values(..),values(..),values(..)</code> syntax (1000 rows per statement)</li>\n<li>Use as few indexes and constraints as possible</li>\n<li>Use simple recovery model if possible</li>\n<li>?</li>\n</ol>\n\n<p>Here are questions to help update the list above</p>\n\n<ol>\n<li>What is optimal number of statements per command (per one <code>ExecuteNonQuery()</code> call)?</li>\n<li>Is it good to have inserts and updates in the same batch, or it is better to execute them separately?</li>\n</ol>\n\n<p>My data is being received by tcp, so please don't suggest any Bulk Insert commands that involve reading data from file or external table. </p>\n\n<p>Insert/Update statements rate is about 10/3.</p>\n"},{"tags":["sql-server-2008","operators","operator-overloading"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":174,"score":0,"question_id":1312588,"title":"Custom datatype operators in Sql Server?","body":"<p>In Sql Server 2008, they added new DATE and TIME datatypes, complementing DATETIME.<br>\nI wanted to combine a DATE and a TIME to a DATETIME, and thought maybe the obvious would work, and I could do  </p>\n\n<pre><code>SELECT DATEFLD + TIMEFLD FROM MYTABLE\n</code></pre>\n\n<p>and DATE + TIME would return the corresponding DATETIME. Unfortunately, that's a little too obvious, and did not work. So I am wondering, does Sql Server have any way to override operators, to create an override for \"+\" to handle DATE + TIME => DATETIME . </p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":10179127,"title":"Non-dynamic approach to do a series of union statements on table value function tvf","body":"<p>I have a table valued function that returns some details about a specific account.  Something like this.  Far more complex but you get the idea.  It's a multi line TVF if that makes a difference (not an inline statement)</p>\n\n<pre><code>select * from dbo.TBFDetailsByAccountKey(1234)\n\n-----------------------------------------------\ndate       |    amount    |     detail        |\n-----------------------------------------------\n4/1/2012   |    10.23     |  payment stuff    |\n4/2/2012   |    12.40     |  other stuff      |\n4/2/2012   |    14.23     |  second pmt today |\n</code></pre>\n\n<p>I now have need to call this same TVF repeatedly in a series of UNION ALL statements in order to return the details for all the account key's contained within a set of deposits.  Is there a way to do this without resorting to dynamic sql?</p>\n\n<p>My current approach is this... but it uses dynamic sql and I keep thinking there should be a better \"non dynamic\" way.</p>\n\n<pre><code>DECLARE @pResult varchar(max)\n\nSELECT @pResult = COALESCE(@pResult + ' UNION ALL ', '') + \n        'SELECT * FROM dbo.TBFDetailsByAccountKey(' + \n        Cast(AccountKey AS VarChar(25)) + ')'\n    FROM Account WHERE DepositKey = @pDepositKey\n\nEXEC(@pResult)  /* execute dynamic sql created above */\n</code></pre>\n"},{"tags":["sql","sql-server-2008","sql-server-2005","data","sqlclient"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":96,"score":2,"question_id":12201943,"title":"SqlDbType.Date SQL Server 2005","body":"<p>I have a property like this:</p>\n\n<pre><code>private SqlParameter DateOfBirthSqlParameter\n{\n    get\n    {\n        return new SqlParameter(\"@date\", SqlDbType.Date)\n            {\n                Value = dateOfBirth.ToString(\"MM/dd/yyyy\");\n            };\n    }\n}\n</code></pre>\n\n<p><code>dateOfBirth</code> is a <code>DataTime</code> C# type. I use this parameter to add to my SQL command, that look like this.</p>\n\n<pre><code>Select * From mytable Where dob_dt = @date\n</code></pre>\n\n<p>The problem is that doesn't work in SQL Server 2005. I got an exception: </p>\n\n<blockquote>\n  <p><em>System.ArgumentException: The version of SQL Server in use does not\n  support datatype 'date'</em></p>\n</blockquote>\n\n<p>This because SQL Server 2005 doesn't support <code>Date</code>, this is a feature of later version (SQL Server <strong>2008</strong>). </p>\n\n<p>There are many solutions to this, for instance change <code>SqlDbType.Date</code> to <code>SqlDbType.DateTime</code></p>\n\n<p>I guess the reference <code>System.Data</code> is a version that provide all features supported for SQL Server 2008. Should I change it to something that only support 2005? that will help to discover other possible mismatches? What is the best way to handle this situation?</p>\n\n<p>Thanks.</p>\n\n<p><strong>Update: 8/31/2012</strong></p>\n\n<p>In the example, I used date of birth but In my application I used something else such as purchase_dt or something like it (with the time on it). My first Select Statement was:</p>\n\n<pre><code>Select * From mytable Where Cast(purchase_dt as Date) = @date\n</code></pre>\n\n<p>and that was fine in my computer with SQL Server <strong>2008</strong> and in another PC with SQL Server <strong>2005</strong> also was fine and just throws an exception when it got to the select. </p>\n\n<p>But, once I fixed that, with:</p>\n\n<pre><code>Select * From mytable Where Cast(DATEDIFF(dd, 0, purchase_dt) as DateTime) = @date\n</code></pre>\n\n<p>This broke the entire web application (in the other PC)... The problem was <code>SqlDbType.Date</code>. but Why it didn't break it before?</p>\n"},{"tags":["sql-server-2008","case"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":44,"score":2,"question_id":12959661,"title":"CASE statement or similar technique","body":"<p>I am trying to use a CASE statement but I don't get the answer that I would like to get.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>DECLARE @Table TABLE (DocID INT, DocNumber VARCHAR(10),DocDevStat INT, MilestoneDate DATETIME,  \n                      MilestoneID INT) \nINSERT INTO @Table VALUES (30, '14-1', 6, '10-01-2001', 10) \nINSERT INTO @Table VALUES (30, '14-1', 6, '10-15-2001', 11) \nINSERT INTO @Table VALUES (30, '14-1', 6, '11-06-2002', 13) \nINSERT INTO @Table VALUES (30, '14-1', 6, '11-01-2003', 27) \nINSERT INTO @Table VALUES (30, '14-1', 6, '11-01-2003', 30) \nINSERT INTO @Table VALUES (30, '14-1', 6, '03-01-2004', 28) \nINSERT INTO @Table VALUES (30, '14-1', 6, '03-01-2004', 35) \nINSERT INTO @Table VALUES (31, '14-3', 2, '06-27-2003', 10) \nINSERT INTO @Table VALUES (31, '14-3', 2, '05-05-2004', 27) \nINSERT INTO @Table VALUES (31, '14-3', 2, '05-05-2004', 30) \nINSERT INTO @Table VALUES (31, '14-3', 2, '07-20-2005', 35) \nINSERT INTO @Table VALUES (31, '14-3', 2, '08-31-2005', 32) \nINSERT INTO @Table VALUES (36, '1-2', 7, '10-01-1996', 10) \nINSERT INTO @Table VALUES (36, '1-2', 7, '10-01-1996', 11) \nINSERT INTO @Table VALUES (36, '1-2', 7, '12-01-1996', 28) \nINSERT INTO @Table VALUES (36, '1-2', 7, '12-01-1996', 35) \n\nSelect distinct t.Docid, t.DocNumber,\n\ncase when t.DocDevStat IN (6,7,8) and t.MilestoneID = 35 then Max(t.Milestonedate)\n     when t.DocDevStat IN (2,3,4) then Convert(date,GETDATE()) end AS LatestDate\n\nFROM @Table t\nGroup By t.DocID, t.DocNumber, t.DocDevStat, t.MilestoneID\n</code></pre>\n\n<p>The result I get is:</p>\n\n<pre><code>Docid      DocNumber    LatestDate\n30         14-1           NULL\n30         14-1           2004-03-01 \n31         14-3           2012-10-17 \n36          1-2           NULL\n36          1-2           1996-12-01 \n</code></pre>\n\n<p>But I would like to get:</p>\n\n<pre><code>Docid      DocNumber    LatestDate\n30         14-1           2004-03-01 \n31         14-3           2012-10-17 \n36          1-2           1996-12-01 \n</code></pre>\n\n<p>Is the CASE statement right technique to be used in this case?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":28,"score":-2,"question_id":12961115,"title":"TVF doesn't give any data","body":"<p>I have one table valued function. It gives no data when executed. But when I execute only the query of that table valued function by giving the same parameter, then I get the data. Why is this?</p>\n\n<p>I am executing TVF as follows:</p>\n\n<pre><code>select *\n  from fn_name(param1,param2,param3)\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","import-from-excel"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":68,"score":2,"question_id":12942687,"title":"Horizontal data into Vertical","body":"<p>I have horizontal table (Table1) and I need it to transform it into (Table2)</p>\n\n<p><strong>Table1:</strong></p>\n\n<pre><code>CEO     SALESMAN    PRODUCT(1)  PRODUCT(2)  PRODUCT(3)  PRODUCT(4)  PRODUCT(5)  ... PRODUCT(N)\n------  ----------  ----------  ----------  ----------  ----------  ----------      ----------\nMIKE    ANDERSON    76787,00    19388,00    0,00        2723,00     217,00          6581,00\nJOHN    ANGELA      0,00        0,00        73088,00    0,00        0,00            0,00\nJACK    JEFF        24716,00    0,00        2995,00     0,00        0,00            0,00\nSTUART  MICHAEL     0,00        23338,00    42656,00    0,00        0,00            0,00\n</code></pre>\n\n<p><strong>Table2:</strong></p>\n\n<pre><code>CEO     SALESMAN    PRODUCTS    VALUE\n------- ----------- ----------  --------\nMIKE    ANDERSON    PRODUCT(1)  76787,00\nJOHN    ANGELA      PRODUCT(1)  0,00\nJACK    JEFF        PRODUCT(1)  24716,00\nSTUART  MICHAEL     PRODUCT(1)  0,00\nMIKE    ANDERSON    PRODUCT(2)  19388,00\nJOHN    ANGELA      PRODUCT(2)  0,00\nJACK    JEFF        PRODUCT(2)  0,00\nSTUART  MICHAEL     PRODUCT(2)  23338,00\nMIKE    ANDERSON    PRODUCT(3)  0,00\nJOHN    ANGELA      PRODUCT(3)  73088,00\nJACK    JEFF        PRODUCT(3)  2995,00\nSTUART  MICHAEL     PRODUCT(3)  42656,00\nMIKE    ANDERSON    PRODUCT(4)  2723,00\nJOHN    ANGELA      PRODUCT(4)  0,00\nJACK    JEFF        PRODUCT(4)  0,00\nSTUART  MICHAEL     PRODUCT(4)  0,00\nMIKE    ANDERSON    PRODUCT(5)  217,00\nJOHN    ANGELA      PRODUCT(5)  0,00\nJACK    JEFF        PRODUCT(5)  0,00\nSTUART  MICHAEL     PRODUCT(5)  0,00\nMIKE    ANDERSON    ...     ...\nJOHN    ANGELA      ...     ...\nJACK    JEFF        ...     ...\nSTUART  MICHAEL     ...     ...\nMIKE    ANDERSON    PRODUCT(N)  6581,00\nJOHN    ANGELA      PRODUCT(N)  0,00\nJACK    JEFF        PRODUCT(N)  0,00\nSTUART  MICHAEL     PRODUCT(N)  0,00\n</code></pre>\n\n<p>What I've tried so far is to BULK INSERT Table1 into a temporary table and then work with this data until I get what I want. The problem is the N in PRODUCT() columns is variable so I can't create a temporary table with fixed columns and I need a dynamic query that somehow can read the quantity of products columns and work with it.</p>\n\n<p><strong>BULK INSERT</strong></p>\n\n<pre><code>BULK INSERT #temp\nFROM '\\\\path\\file.csv'\nWITH\n(\nFIRSTROW = 1,\nFIELDTERMINATOR= ';',\nROWTERMINATOR = '\\n',\nCODEPAGE='RAW'\n);\n</code></pre>\n\n<p><strong>Temporary table:</strong></p>\n\n<pre><code>CREATE TABLE    #temp(\ncol1    varchar(100)    null,\ncol2    varchar(100)    null,\ncol3    varchar(100)    null,\ncol4    varchar(100)    null,\ncol5    varchar(100)    null,\n...\ncol397  varchar(100)    null,\ncol398  varchar(100)    null,\ncol399  varchar(100)    null,\ncol400  varchar(100)    null\n)\n</code></pre>\n\n<p>When I run the BULK INSERT I get this error:</p>\n\n<pre><code>Msg 4832, Level 16, State 1, Line 1\nBulk load: An unexpected end of file was encountered in the data file.\nMsg 7399, Level 16, State 1, Line 1\nThe OLE DB provider \"BULK\" for linked server \"(null)\" reported an error. The provider did not give any information about the error.\nMsg 7330, Level 16, State 2, Line 1\nCannot fetch a row from OLE DB provider \"BULK\" for linked server \"(null)\".\n</code></pre>\n\n<p>This happens because I created a temporary table with fixed 400 columns and there were 127 product columns.</p>\n\n<p>I'm trying to avoid things like these:</p>\n\n<pre><code>DECLARE @NUM_ROWS INT\n\nSET     @NUM_ROWS = 123\n\nIF @NUM_ROWS = 1\nBEGIN\nCREATE TABLE    #temp(\ncol1    varchar(100)    null\n)\nEND\n\nIF @NUM_ROWS = 2\nBEGIN\nCREATE TABLE    #temp(\ncol1    varchar(100)    null,\ncol2    varchar(100)    null,\n)\nEND\n\n...\n\nIF @NUM_ROWS = 400\nBEGIN\nCREATE TABLE    #temp(\ncol1    varchar(100)    null,\ncol2    varchar(100)    null,\n...\ncol4    varchar(100)    null,\n)\nEND\n\nBULK INSERT #temp\nFROM '\\\\path\\file.csv'\nWITH\n(\nFIRSTROW = 1,\nFIELDTERMINATOR= ';',\nROWTERMINATOR = '\\n',\nCODEPAGE='RAW'\n);\n</code></pre>\n\n<p><strong>@NUM_ROWS</strong> would be the number of columns I would create the temp table.</p>\n\n<p>Does anyone know a way I can import this .csv file into SQL Server dynamically? By dynamically I mean creating a temporary table with the number of columns of PRODUCTS I'm bulk inserting. Or a workaround to avoid that error I posted above.</p>\n"},{"tags":["sql-server-2008","cognos-8"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":24,"score":0,"question_id":12960475,"title":"COGNOS error:The correlation name XXXX is specified multiple times in a FROM clause","body":"<p>My COGNOS report gives the error consistently: <code>The correlation name XXXX is specified multiple times in a FROM clause</code> .When I click on the generated SQL, it shows that it is selecting the same db object (sometime a view, other times a table) twice. </p>\n\n<p>In the framework manager model, the object is present only once. Also when i test the query subject from framework manager, it runs fine. How can I debug it?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":58,"score":0,"question_id":12945306,"title":"How to return a sql result based on values in a boolean column","body":"<p>Here's the scenario. I have a single SQL Server 2008 table - Products - with 2 columns: id  and IsNotValid. The data would look something like this:</p>\n\n<pre><code>id     IsNotValid\n1        0\n1        0\n1        1\n2        0\n2        0\n3        1\n3        1\n</code></pre>\n\n<p>I would like a SQL statement that would return a result set that would return all the records (2) for the id=2 - in this case all the IsNotValid values for id=2 is 0. id=1 should not be returned as one of its IsNotValid records is 1. Similar for id=3. The data types are: id (int), IsNotValid (bit).</p>\n"},{"tags":["sql-server","sql-server-2008","ssms","ssms2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12960283,"title":"Command(s) completed successfully but... the tables are not created","body":"<p>I backed up my database table's and entire schema into .sql script using Visual Studio's <a href=\"http://weblogs.asp.net/jgalloway/archive/2006/12/29/tip-use-the-database-publishing-wizard-to-script-your-table-data.aspx\" rel=\"nofollow\">Database Publishing Wizard</a>.</p>\n\n<p>I then tried to re-create those tables on another PC, not before re-creating the database itself, with the same exact name and everything (using a script that I created via SSMS's <code>Script Database as)</code>.</p>\n\n<p>I then open that tables .sql file using SSMS and execute it. </p>\n\n<p>SSMS reports:</p>\n\n<blockquote>\n  <p>Command(s) completed successfully</p>\n</blockquote>\n\n<p>But examining Object Explorer reveals that <strong>no tables were created</strong>.</p>\n\n<p>Why is this happening?</p>\n\n<p>What have I missed?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12959197,"title":"Return n number of rows from SQL Server query","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/187998/row-offset-in-sql-server\">Row Offset in SQL Server</a>  </p>\n</blockquote>\n\n\n\n<p>I have a query which has a like condition and it returns around 1500 rows. Now I want to know how can I get the rows part by part, e.g. return 75 rows, then again the next 75 rows until it reaches the end of the rows. I know I can use something like <code>SELECT TOP 75</code></p>\n\n<p>I tried something like this but it does not return any rows</p>\n\n<pre><code>    SELECT * \n    FROM \n       (SELECT ROW_NUMBER() OVER (ORDER BY WarehouseSubType.id) as row,\n               WarehouseSubType.id, \n               WarehouseType.name as WarehouseTypename,\n               WarehouseType.alternateName AS WarehouseTypealternateName,\n               WarehouseSubType.name AS WarehouseSubTypename,\n               Warehouse.alternateName AS WarehousealternateName,\n               WarehouseSubType.alternateName AS WarehouseSubTypealternateName,\n               WarehouseSubType1.name AS WarehouseSubType1name,\n               WarehouseSubType1.alternateName AS WarehouseSubType1alternateName,\n               Warehouse.alternateName AS Warehousename,\n               Branch.name AS Branchname,\n               Branch.alternateName AS BranchalternateName,\n               WarehouseProductQuantity.actualQuantity,\n               WarehouseProductQuantity.reservedQuantity,\n               Supplier.companyName, \n               Supplier.companyNameAlternate,\n               Tafsil.description,\n               Tafsil.alternateDescription,\n                (WarehouseProductQuantity.actualQuantity - WarehouseProductQuantity.reservedQuantity) AS quantity \n        FROM WarehouseSubType \n        INNER JOIN WarehouseType ON (WarehouseSubType.warehouseTypeId = WarehouseType.id)\n        INNER JOIN WarehouseSubType1 ON (WarehouseSubType.id = WarehouseSubType1.warehouseSubTypeId)\n   ) a \nWHERE \n    warehouseTypename like '%Ve%' \n    AND row &gt; 0 and row &lt; 75\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1873,"score":1,"question_id":3241801,"title":"How to create duplicate table with new name in SQL Server 2008","body":"<p>How do I create a duplicate table with only the structure duplicated with a new name in SQL server 2008?</p>\n\n<p>I have table with 45 fields so I want to create new with same structure but new name.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","freetexttable"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12934983,"title":"Term order in FREETEXTTABLE in SQL Server","body":"<p>From the documentation, it seems that SQL Server's FREETEXTTABLE should treat a search query containing multiple words as a bag-of-words.</p>\n\n<p>If I run:</p>\n\n<pre><code>SELECT *\nFROM FREETEXTTABLE(tblThings, *, 'Cartridge Black')\n</code></pre>\n\n<p>I get results where the word 'Cartridge' is immediately followed by the word 'Black', e.g.:</p>\n\n<pre><code>EPSON STYLUS INKJET CARTRIDGE BLACK\nINKJET CARTRIDGE BLACK 40ML\n</code></pre>\n\n<p>No results have the words in the other order.</p>\n\n<p>If instead I run</p>\n\n<pre><code>SELECT *\nFROM FREETEXTTABLE(tblThings, *, 'Black Cartridge')\n</code></pre>\n\n<p>I get a different set of results:</p>\n\n<pre><code>AD1020BK BLACK CARTRIDGE\nGD230X BLACK CARTRIDGE\n</code></pre>\n\n<p>In neither set of results would I find 'black ink cartridge'.</p>\n\n<p>Is there a way to make SQL Server disregard the order of the words?</p>\n"},{"tags":["sql-server-2008","priority","database-deadlocks","sql-job"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12947789,"title":"sqlserver how to set job priority","body":"<p>Is there any way to set one job priority higher then other,<br>\nIn my case there are two jobs those are working on same set of tables,first <strong><em>JOB-A</em></strong> which is running every 12 hr and other <strong><em>JOB-B</em></strong> is every 10 minutes , i think at some time when they run simultaneously <strong><em>JOB-B</em></strong> is getting in to deadlock and get failed,\ni google the topic and found <strong>sqlgoverner</strong> is helpful in such cases \ndoes anyone know how to resolve?</p>\n"},{"tags":["sql-server","sql-server-2008","ssis"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":124,"score":1,"question_id":11513781,"title":"SSIS - Convert Multiple Column Values To Null","body":"<p>I am using SSIS (SQL Server 2008 R2) to transform an input CSV file into an SQL table.  Five columns in the input file (reals - e.g. 19.54271) occasionally have a bad value (strings - e.g. \"NAN\") that cause the package to fail.</p>\n\n<p>What is the simplest way to check these 5 columns for the bad value \"NAN\", convert that into either a NULL value or known bad numeric (-9999), and write the corrected values into the same final SQL table?</p>\n\n<p>I have the following mess going so far, and finally decided to ask if there is a simpler way...</p>\n\n<p><img src=\"http://i.stack.imgur.com/QU5Oy.png\" alt=\"enter image description here\"></p>\n\n<p>My current conditional logic:<br>\n<img src=\"http://i.stack.imgur.com/zHClt.gif\" alt=\"enter image description here\"></p>\n\n<p>My Case1 Derived Column Conversion:<br>\n<img src=\"http://i.stack.imgur.com/bfkZn.gif\" alt=\"enter image description here\"></p>\n\n<p>Note: Still not sure if I can combine the other derived columns into one instance, but since my destination can have only one input, I suspect I will need to...</p>\n\n<p>TIA</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":41,"score":0,"question_id":12958765,"title":"sql server 2008 statement","body":"<p>I need help with a statement.  I need the statement to select where one ting is true and then a list of other things may or maynot be there.  Here is my example</p>\n\n<pre><code>WHERE\n\n((uw._condition LIKE '11-CHECKLIST REQUESTED BY UW%' AND uw._Status = 'Pending') \n</code></pre>\n\n<p>-- this has to be true, the rest may or may not be true, however when it is not I get blank rows because of the and.  What can I use instead of this code to get the first part because it will always be there and the others might or might not be there.</p>\n\n<pre><code>AND \n(\n(uw._condition LIKE '[1-4]-%' AND uw._Status = '*******')\nOR\n(uw._condition LIKE '[6-7]-%' AND uw._Status = '*******')\nOR\n(uw._condition LIKE '[20-22]-%' AND uw._Status = '*******')\nOR\n(uw._condition LIKE '9[0-9][0-9]-%' AND uw._Status = '*******')\nOR\n(uw._condition LIKE '1[0-9][0-9][0-9]-%' AND uw._Status = '*******')\n))\n</code></pre>\n\n<p>Thanks,</p>\n"},{"tags":["ruby-on-rails","sql-server-2008","activerecord"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12861125,"title":"Errors when trying to prepare testing with Ruby on Rails that uses a SQL Server 2008 R2 database","body":"<p>What do I need to do to be able to run tests with a SQL Server 2008 database server using the gem <code>activerecord-sqlserver-adapter</code>?</p>\n\n<p>I am able to connect to the development database just fine using a 32bit ODBC connection through dev settings in database.yml:</p>\n\n<pre><code>#SQL Server\ndevelopment:\n  adapter: sqlserver\n  mode: odbc\n  dsn: &lt;odbc_name&gt;\n  username: &lt;db_user&gt;\n  password: &lt;db_password&gt;\n  host: &lt;sql host&gt;\n</code></pre>\n\n<p>I have started to setup some testing but run into an error when running:</p>\n\n<pre><code>rake db:test:prepare\n</code></pre>\n\n<p>Here is the error:</p>\n\n<pre><code>rake aborted!\nODBC::Error: 37000 (3708) [Microsoft][SQL Native Client][SQL Server]Cannot drop \nthe database 'master' because it is a system database.: DROP DATABASE [master]\n\nTasks: TOP =&gt; db:test:load =&gt; db:test:purge\n(See full trace by running task with --trace)\n</code></pre>\n\n<p>This error doesn't make sense to me.  Why is it trying to drop the master db?</p>\n\n<p>My test setup in database.yml is exactly the same as my dev above except it points to a different odbc which points to a different database.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I have noticed that when I run <code>rake db:test:prepare</code> the first step must be to delete the test database.  So it knows what database it is supposed to use at first. </p>\n\n<p>Why does it then try to delete the master? </p>\n\n<p>Is this because when sql doesn't find the default database it gives the user master by default and <code>rake db:test:prepare</code> cannot create the users default db so it loops back to the beginning and tries to drop again?</p>\n"},{"tags":["sql","database","sql-server-2008","query"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":102,"score":0,"question_id":12957635,"title":"Sql query to insert datetime in SQL Server","body":"<p>I want to insert a <code>datetime</code> value into a table(SQL Server) using the sql query below</p>\n\n<pre><code>insert into table1(approvaldate)values(18-06-12 10:34:09 AM);\n</code></pre>\n\n<p>But I get this Error msg. <code>Incorrect syntax near '10'.</code></p>\n\n<p>I tried it with the quotes</p>\n\n<pre><code>insert into table1(approvaldate)values('18-06-12 10:34:09 AM');\n</code></pre>\n\n<p>I get this error message <code>Cannot convert varchar to datetime</code></p>\n\n<p>Kindly help! \nThanks.</p>\n"},{"tags":["c#","sql-server-2008","iis","impersonation"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":113,"score":1,"question_id":12957141,"title":"Impersonating IIS DefaultAppPool in standalone application","body":"<p>Description of my problem sounds somewhat complicated, what makes me think that my approach is flawed, so I will also appreciate any better idea.</p>\n\n<p><strong>Short description:</strong></p>\n\n<p>Given connection string to MSSQL 2008 DB and website name deployed on IIS6, I want to verify programatically whether website is able to connect to database.</p>\n\n<p><strong>Long description:</strong></p>\n\n<ol>\n<li>I have MSSQL Server database, let's call it <code>portal_db</code>.</li>\n<li>I have an application deployed on IIS6, called <code>portal</code>. I can access it by url <code>http://localhost/portal</code> . In Web.config file I specified connection string to my database, which look like: <code>\"server=(local)\\SQLEXPRESS;trusted_connection=yes;database=portal_db\"</code></li>\n<li>Web application is accessing database using <code>System.Data.SqlClient.SqlConnection</code>, without any wrappers, ORMs, mappings, anything.</li>\n<li>Website is configured to run in appool <code>PortalAppPool</code>. It's using <code>ApplicationPoolIdentity</code> as a security context.</li>\n<li>It is not possible to easily modify web application code (particularly the way it accesses database)</li>\n</ol>\n\n<p>When my web application tries to connect to database it either succeeds or fails, depending on whether user <code>IIS APPPOOL\\PortalAppPool</code> is configured in MSSQL database. That's a part which I understand, but when deploying my app I often forget to create new user/login in db for apppool virtual account. So what I want to do, is to verify from separate, standalone, console app (preferably written in C#, but not necessarily), whether my web application can access database, in following way:</p>\n\n<ol>\n<li>Read connection string from <code>Web.config</code></li>\n<li>Read app pool identity settings (managed to do this by Directory Services API)</li>\n<li>Impersonate identity with credentials defined on app pool (using impersonation class I found here: <a href=\"http://platinumdogs.me/2008/10/30/net-c-impersonation-with-network-credentials/\" rel=\"nofollow\">http://platinumdogs.me/2008/10/30/net-c-impersonation-with-network-credentials/</a> which uses ideas found in many other places, including MSDN)</li>\n<li>Open <code>SqlConnection</code> with connection string read from <code>Web.config</code></li>\n</ol>\n\n<p>It boils down to following snippet:</p>\n\n<pre><code>using (new Impersonator(\"IIS APPPOOL\\\\PortalAppPool\", \"\", \"\"))\n{\n    SqlConnection conn = new SqlConnection(databaseConnectString);\n    conn.Open();\n}\n</code></pre>\n\n<p>Everything works very well, when my app pool security context is set to any other value than <code>AppPoolIdentity</code> - specific user, local system, etc. When I change credentials passed to <code>Impersonator</code> to my user's name and password, I get desired result (exception when I have no login mapping in database, and everything is OK when I add one). But I just seem to not be able to impersonate <code>IIS APPPOOLS\\PortalAppPool</code> virtual account - just have no idea what parameters should be passed to <code>LogonUser</code> - I would not be surprised if it would not be even possible. Maybe I am focused on impersonation approach too much (I am using it to access registry keys and services of other users and it works good), and maybe there is some better way.</p>\n\n<p>If you have any other, better ideas, or need some more explanation to this problem, please let me know.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12955714,"title":"How to modify an SQL query with sub query to get an extra column","body":"<p>I am trying to modify a user query in order to return an extra column, INV1.WhsCode from the following SQL query:</p>\n\n<pre><code>SELECT  T0.CardCode,\n        T2.CardName,\n        T0.CodeBars,\n        T0.ItemCode,\n        T0.ItemName,\n        T3.Price AS [POS Price],\n        T1.AvgPrice,\n        T1.OnHand,\n        T1.MinStock,\n        T1.MaxStock,\n        T0.NumInBuy AS Packsize,\n        T0.LstSalDate,\n        (\n            SELECT SUM(Quantity) AS Expr1\n            FROM dbo.INV1\n            INNER JOIN OINV\n                    ON INV1.DocEntry = OINV.DocEntry\n            WHERE INV1.ItemCode = T0.ItemCode\n                    AND INV1.WhsCode = [%2]\n                    AND Month(OINV.DocDate) = month(GetDate())\n        ) AS [Current Period],\n        (\n            SELECT SUM(Quantity) AS Expr1\n            FROM dbo.INV1\n            INNER JOIN OINV\n                    ON INV1.DocEntry = OINV.DocEntry\n            WHERE INV1.ItemCode = T0.ItemCode\n                    AND INV1.WhsCode = [%2]\n                    AND Month(OINV.DocDate) = month(GetDate()) - 1\n        ) AS [Previous Period],\n        (\n            SELECT SUM(Quantity) AS Expr1\n            FROM dbo.INV1\n            INNER JOIN OINV\n                    ON INV1.DocEntry = OINV.DocEntry\n            WHERE INV1.ItemCode = T0.ItemCode\n                    AND INV1.WhsCode = [%2]\n                    AND Month(OINV.DocDate) = month(GetDate()) - 2\n        ) AS [60-90],\n        (\n            SELECT TOP 1 OPDN.DocDate AS Expr1\n            FROM dbo.PDN1\n            INNER JOIN OPDN\n                    ON PDN1.DocEntry = OPDN.DocEntry\n            WHERE PDN1.ItemCode = T0.ItemCode\n            ORDER BY OPDN.DocDate DESC\n        ) AS LastGRNDate\nFROM    OITM T0\n        INNER JOIN OITW T1\n            ON T0.ItemCode = T1.ItemCode\n        INNER JOIN OCRD T2\n            ON T0.CardCode = T2.CardCode\n        INNER JOIN ITM1 T3\n            ON T0.ItemCode = T3.ItemCode\n        INNER JOIN OWHS T4\n            ON T1.WhsCode = T4.WhsCode\n        INNER JOIN OITB T5\n            ON T0.ItmsGrpCod = T5.ItmsGrpCod\nWHERE   T3.PriceList = '3'\n        AND T4.WhsName = [%0]\n        AND T5.ItmsGrpNam = [%1]\n</code></pre>\n\n<p>How do I achieve this? (MS SQL Server 2008)</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-job"],"answer_count":4,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":119,"score":2,"question_id":11986611,"title":"What do the Categories in SQL Server Agent Jobs mean?","body":"<p>This is the first time I am trying for the <strong>SQL Job Agent</strong>...I was <strong>trying to create the sample job</strong> and I got struck in between when it came to select the <strong>Category as highlighted</strong> in the below screen shot</p>\n\n<p><img src=\"http://i.stack.imgur.com/nTYYg.png\" alt=\"enter image description here\"></p>\n\n<p>I am new to <strong>SQL Server</strong> can you explain the meanings of categories as mentioned above? or any link will be hightly appreciated.</p>\n"},{"tags":["sql-server-2008","pdf","extraction"],"answer_count":5,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":11667,"score":3,"question_id":1091700,"title":"How to extract data from a PDF?","body":"<p>My company receives data from an external company via Excel.  We export this into SQL Server to run reports on the data.  They are now changing to PDF format, is there a way to reliably port the data from the PDF and insert it into our SQL Server 2008 database?</p>\n\n<p>Would this require writing an app or is there an automated way of doing this?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":94,"score":2,"question_id":12954342,"title":"Set all columns to `null` in a table","body":"<p>Is there a quick way to change all fields in a table that are null to just empty fields. I have many columns so wondered if there was a way to do it by table rather than column by column.</p>\n\n<p>I need something like</p>\n\n<pre><code>update table 1 \nset * = '' \nwhere * is null\n</code></pre>\n\n<p>but obviously this is incorrect syntax</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures","informix","ibm"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":495,"score":1,"question_id":4447737,"title":"Translate stored procedure from MS SQL Server to Informix","body":"<p>I do not know how to write a specific stored procedure in Informix, so I had to write the logic in my mind in SQL Server which I know how to write (Microsoft simplicity)... So I will write my stored procedure in the SQL syntax and please any one who know Informix syntax and how to write tell me the equivalent of my stored procedure in Informix with little hints to learn the techniques used in both...</p>\n\n<p>My stored procedure is:</p>\n\n<pre><code>ALTER PROC [dbo].[DetectFine] @prog_code int\nAS\n---------------------------------\nDECLARE @lect_code int;\nDECLARE @prog_code_temp int;\nDECLARE @confirm_reg int;\nDECLARE @start_date_temp DATE;\n---------------------------------\nDECLARE Mycursor CURSOR FOR\nSELECT l.confirm_reg,p.[start_date],l.lect_code,l.prog_code\nFROM cc1lectprog l INNER JOIN cc1progtimes p\nON l.prog_code = p.prog_code\nWHERE p.prog_code = @prog_code;\n---------------------------------\nOPEN Mycursor ;\n---------------------------------\nFETCH NEXT FROM Mycursor\nINTO @confirm_reg,@start_date_temp,@lect_code,@prog_code_temp;\n---------------------------------\nWHILE @@FETCH_STATUS =0\nBEGIN\nSelect @confirm_reg as Cconfirm_reg, @start_date_temp as Cstart_date ,@lect_code as Clect_code,@prog_code_temp as Cprog_code_temp;\n-- This is executed as long as the previous fetch succeeds.\nIF @confirm_reg = 0 AND GETDATE()&gt;= DATEADD(DD,-3,@start_date_temp)\n-----------------------------------------------------------------------\nUPDATE cc1lectprog \nSET fine = 0\nWHERE lect_code = @lect_code AND prog_code = @prog_code_temp;\n-----------------------------------------------------------------------\nFETCH NEXT FROM Mycursor\nINTO @confirm_reg,@start_date_temp,@lect_code,@prog_code_temp;\n-----------------------------------------------------------------------\nEND\nCLOSE Mycursor\nDEALLOCATE Mycursor\n-----------------------------------------------------------------------\n</code></pre>\n\n<p>Note: this stored procedure is required to be executed every period of time like a job.  Is it possible to execute procedure with parameters every period of time or not? And what are the alternatives if not?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":12955560,"title":"Explicitly constraint drop not using the name","body":"<pre><code>CREATE TABLE [dbo].[tmp_rg_xx_LBJ]\n(\n[ROWVERSION] [bigint] NULL,\n[ROWDATE] [datetime] NULL,\n[SAPNO] [int] NOT NULL DEFAULT 1)\n\n\nIF  EXISTS (SELECT * FROM dbo.sysobjects WHERE id = OBJECT_ID(N'[DF__tmp_rg_xx__SAPNO__1B0907CE]') AND type = 'D')\nBEGIN\nALTER TABLE [dbo].[LBJ] DROP CONSTRAINT [DF__tmp_rg_xx__SAPNO__1B0907CE]\nEND\n\nGO\n</code></pre>\n\n<p>I have a script that creates a table with a default in, but I want to drop the constraint. No problem manually as I know the name, except I want drop the constraint after recreating the table. So I can just re run the drop constraint script. How do you do this without explicitly using the name?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":12954082,"title":"Invalid column name: SQL Server 2008 R2","body":"<p>I have a stored procedure I use to extract binary data from SQL tables to create physical files. I have used it a couple of times on tables with the same structure restored from SQL backups, and it works OK. </p>\n\n<p>Today I wanted to extract some binary data from a new table inside a restored backup. I opened the stored procedure I have been using and set about altering the code. Once I was happy with the changes I tried to execute the 'ALTER' statement. Unfortunetly, both of the column names I have used are 'invalid' despite existing on the the 'Document' table.</p>\n\n<p>I have read a number of other threads regarding 'invalid column name' errors, but the majority of these seem to be typing errors. I've checked my column names numurous times (intelli sense even lets me put in 'Document.Document_ID' and 'Document.Document_Filename' but they still fail).</p>\n\n<p>Any ideas where I am going wrong?</p>\n\n<p>Source:</p>\n\n<pre><code>USE [Example Live]\nGO\n/****** Object:  StoredProcedure [dbo].[FileExport]    Script Date: 10/18/2012 11:42:14 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n-- =============================================\n-- Author:      Chris Murray\n-- Create date: 18/10/2012\n-- Description: Exports binary file data\n-- =============================================\nALTER PROCEDURE [dbo].[FileExport] \n-- Add the parameters for the stored procedure here\n@OutputFilePath VARCHAR(500) = 'C:\\Conv\\Example\\In\\Afiles\\'\nAS\nBEGIN\n\n   DECLARE @totrow int\n   DECLARE @currow int\n   DECLARE @result int\n   DECLARE @nsql nvarchar(4000)\n\n   DECLARE @sqlStatements table (ID int IDENTITY(1, 1),  SqlStatement varchar(max))   \n\n   INSERT\n   INTO @sqlStatements\n   SELECT 'BCP \"SELECT Document_Data FROM [Example Live].[dbo].[Document] WHERE Document_ID = '''\n  + CAST(Document_ID AS VARCHAR(500)) + '''\" queryout ' + @OutputFilePath \n  + CAST(Document_Filename AS VARCHAR(500)) + ' -S localhost\\SQLEXPRESS2008 -T -f C:\\Conv\\Example\\In\\AFiles\\Images.fmt'\n   FROM dbo.Photograph  \n\n   SET @totrow = @@ROWCOUNT\n   SET @currow = 1\n   WHILE @totrow &gt; 0 and @currow &lt;= @totrow\n   BEGIN\n      SELECT @nsql = SqlStatement\n      FROM @sqlStatements\n      WHERE ID = @currow\n      EXEC @result = xp_cmdshell @nsql\n      SET @currow = @currow + 1\n   END\nEND\n</code></pre>\n"},{"tags":["asp.net","sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":11501063,"title":"ASP.NET connections with READ UNCOMMITTED","body":"<p>I have a web application and all of its queries begin with</p>\n\n<pre><code>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\n</code></pre>\n\n<p>Is there any way to create all connections with this isolation level? Can I implement this to connection pool in web.config or somewehere else?</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2005","sql-server-2008-r2"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12954781,"title":"Refactoring T-SQL nested SELECT query to use in a case statement","body":"<p>I have the following table:</p>\n\n<pre><code>maker   model   type\nB   1121    pc\nA   1233    pc\nE   1260    pc\nA   1752    laptop\nA   1276    printer\nD   1288    printer\n</code></pre>\n\n<p>I need to receive a result in the form: maker, pc. If a particular maker has models in a given type, I need to concatenate the word 'yes' with the number of models in parentheses. Ex. yes(1) for maker 'A'. So, how can I avoid the following duplication?</p>\n\n<pre><code>CASE \nWHEN SELECT COUNT(*) WHERE ... &gt; 0\nTHEN 'yes(' + CAST((SELECT COUNT(*) WHERE ...) AS varchar) + ')'\n</code></pre>\n\n<p>This is not a real world problem. I just need to understand how to save a subquery result to use it in a branch statement. The result of this branch statement may contain the subquery result itself.</p>\n"},{"tags":["asp.net-mvc-3","sql-server-2008","entity-framework"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2144,"score":1,"question_id":10408182,"title":"A network-related or instance-specific error occurred while establishing a connection to SQL Server - ASP.NET MVC Entity Framework","body":"<p>I am using ASP.Net MVC 3 (Entity Framework) with Sql server 2008. Connection string is fine in web.config. But sometimes i get the following exception from my application:</p>\n\n<pre><code>    System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)\n\nGenerated: Wed, 02 May 2012 05:05:21 GMT\n\nSystem.Data.EntityException: The underlying provider failed on Open. ---&gt; System.Data.SqlClient.SqlException: A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()\n   at System.Data.SqlClient.TdsParser.Connect(ServerInfo serverInfo, SqlInternalConnectionTds connHandler, Boolean ignoreSniOpenTimeout, Int64 timerExpire, Boolean encrypt, Boolean trustServerCert, Boolean integratedSecurity)\n   at System.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, SqlConnection owningObject)\n   at System.Data.SqlClient.SqlInternalConnectionTds.LoginWithFailover(Boolean useFailoverHost, ServerInfo primaryServerInfo, String failoverHost, String newPassword, Boolean redirectedUserInstance, SqlConnection owningObject, SqlConnectionString connectionOptions, TimeoutTimer timeout)\n   at System.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(SqlConnection owningObject, TimeoutTimer timeout, SqlConnectionString connectionOptions, String newPassword, Boolean redirectedUserInstance)\n   at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, Object providerInfo, String newPassword, SqlConnection owningObject, Boolean redirectedUserInstance)\n   at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection)\n   at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnection owningConnection, DbConnectionPool pool, DbConnectionOptions options)\n   at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject)\n   at System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection)\n   at System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory)\n   at System.Data.SqlClient.SqlConnection.Open()\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\n   --- End of inner exception stack trace ---\n   at System.Data.EntityClient.EntityConnection.OpenStoreConnectionIf(Boolean openCondition, DbConnection storeConnectionToOpen, DbConnection originalConnection, String exceptionCode, String attemptedOperation, Boolean&amp; closeStoreConnectionOnFailure)\n   at System.Data.EntityClient.EntityConnection.Open()\n   at System.Data.Objects.ObjectContext.EnsureConnection()\n   at System.Data.Objects.ObjectQuery`1.GetResults(Nullable`1 forMergeOption)\n   at System.Data.Objects.ObjectQuery`1.System.Collections.Generic.IEnumerable&lt;T&gt;.GetEnumerator()\n   at System.Linq.Enumerable.SingleOrDefault[TSource](IEnumerable`1 source)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.&lt;GetElementFunction&gt;b__2[TResult](IEnumerable`1 sequence)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.ExecuteSingle[TResult](IEnumerable`1 query, Expression queryRoot)\n   at System.Data.Objects.ELinq.ObjectQueryProvider.System.Linq.IQueryProvider.Execute[S](Expression expression)\n   at System.Linq.Queryable.SingleOrDefault[TSource](IQueryable`1 source)\n   at MyApp.Data.UserRepository.GetUserDetails(String username)\n   at MyApp.Core.Services.SiteService.GetUserDetails(String username, Int64 userId)\n   at MyApp.PublicSite.Web.Controllers.BaseController.Initialize(RequestContext requestContext)\n   at System.Web.Mvc.ControllerBase.Execute(RequestContext requestContext)\n   at MyApp.PublicSite.Web.Controllers.BaseController.Execute(RequestContext requestContext)\n   at System.Web.Mvc.ControllerBase.System.Web.Mvc.IController.Execute(RequestContext requestContext)\n   at System.Web.Mvc.MvcHandler.&lt;&gt;c__DisplayClass6.&lt;&gt;c__DisplayClassb.&lt;BeginProcessRequest&gt;b__5()\n   at System.Web.Mvc.Async.AsyncResultWrapper.&lt;&gt;c__DisplayClass1.&lt;MakeVoidDelegate&gt;b__0()\n   at System.Web.Mvc.Async.AsyncResultWrapper.&lt;&gt;c__DisplayClass8`1.&lt;BeginSynchronous&gt;b__7(IAsyncResult _)\n   at System.Web.Mvc.Async.AsyncResultWrapper.WrappedAsyncResult`1.End()\n   at System.Web.Mvc.MvcHandler.&lt;&gt;c__DisplayClasse.&lt;EndProcessRequest&gt;b__d()\n   at System.Web.Mvc.SecurityUtil.&lt;GetCallInAppTrustThunk&gt;b__0(Action f)\n   at System.Web.Mvc.SecurityUtil.ProcessInApplicationTrust(Action action)\n   at System.Web.Mvc.MvcHandler.EndProcessRequest(IAsyncResult asyncResult)\n   at System.Web.Mvc.MvcHandler.System.Web.IHttpAsyncHandler.EndProcessRequest(IAsyncResult result)\n   at System.Web.HttpApplication.CallHandlerExecutionStep.System.Web.HttpApplication.IExecutionStep.Execute()\n   at System.Web.HttpApplication.ExecuteStep(IExecutionStep step, Boolean&amp; completedSynchronously)\n</code></pre>\n\n<p>The Connection string is:</p>\n\n<pre><code>    &lt;connectionStrings&gt;\n    &lt;add name=\"MyAppDBContainer\" connectionString=\"metadata=res://*/MyAppDB.csdl|res://*/MyAppDB.ssdl|res://*/MyAppDB.msl;provider=System.Data.SqlClient;provider connection string=&amp;quot;data source=SERVERNAME;initial catalog=MyAppDB;persist security info=True;user id=USERID;Password=PASSWORD;multipleactiveresultsets=True;App=EntityFramework&amp;quot;\" providerName=\"System.Data.EntityClient\" /&gt;\n  &lt;/connectionStrings&gt;\n</code></pre>\n\n<p>This exception occurs randomly and not able to get/reproduce it everytime. Any possible settings i may be missing here? Please suggest.</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12953671,"title":"How to get and iterate through two dimentional list (using foreach I guess) in SQL stored procedure","body":"<p>I want a stored procedure that will put following results into a list and then I can go through each item of list I declared in stored procedure,</p>\n\n<p>first thing first I will take columns using this statement,</p>\n\n<pre><code>SELECT ColumnA, ColumnB \nFROM MyTable   // Save it into a two dimensional array or dictionary I guess\n</code></pre>\n\n<p>Then need to do another query within stored procedure for each <code>columnA</code> and <code>columnB</code> and get back a list of values for <code>columnC</code></p>\n\n<pre><code>if exists (\n    SELECT ColumnC FROM Table2 \n    Where ColumnA = //@ColumnA[i] or something  \n    AND SchemeID = //@ColumnB[i] or something)\n//then add ColumnC value to a list\nelse\ncontinue\n</code></pre>\n\n<p>I am new to SQL but have been working on C# for a moment so not sure how to make this stored procedure.</p>\n"},{"tags":["sql-server-2008","tsql","cursor"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12953321,"title":"Inconsistent results from TSQL cursor","body":"<p>I've got a query that uses a cursor to insert data into my database. The weird thing is that the query runs the 1st time ( SSMS > Execute ), but if I run it a second time, the part with the cursor does not execute. </p>\n\n<p>However - If i then hit 'debug' I can debug and the whole query executes just fine. Right after that it works just fine once more and then, again, only the first insert script executes.</p>\n\n<p>I tried the FAST_FORWARD as mentioned <a href=\"http://stackoverflow.com/questions/4048147/inconsistent-cursor-results-when-looping-over-databases\">here</a> but that doesn't seem to solve the problem. Any suggestions?</p>\n\n<pre><code>/** Declarations **************************************************/\nDECLARE @TemplateFileName varchar(200)\nDECLARE @TemplatePreviewFileName varchar(200)\nDECLARE @TemplateId int\nDECLARE @CompanyId int\nDECLARE CompanyCursor cursor FAST_FORWARD FOR SELECT [CmpId] from SetCompany\n/******************************************************************/\n\n/** Set template name here ****************************************/\nSET @TemplateFileName           = 'Template_2'\nSET @TemplatePreviewFileName    = 'Template_2'\n/******************************************************************/\n\n/******************************************************************/\nINSERT INTO ... etc\nSET @TemplateId = @@IDENTITY;\nOpen CompanyCursor\n\nWHILE @@FETCH_STATUS = 0\n    BEGIN       \n        IF(@CompanyId IS NOT NULL)\n        BEGIN\n            PRINT 'Adding template ' + @TemplateFileName + ' with id ' + convert(varchar, @TemplateId) + ' to company ' + convert(varchar, @CompanyId);\n            INSERT INTO .... etc\n            PRINT 'OK';\n        END\n        Fetch NEXT FROM CompanyCursor INTO @CompanyId\nEND\nCLOSE CompanyCursor;\nDEALLOCATE CompanyCursor;\n</code></pre>\n\n<p>Running the 'first' time, I get:</p>\n\n<pre><code>(1 row(s) affected)\nAdding template Template_2.frx with id 2272 to company 10\n\n(1 row(s) affected)\nOK\nAdding template Template_2.frx with id 2272 to company 11\n\n(1 row(s) affected)\nOK\nAdding template Template_2.frx with id 2272 to company 12\n\n(1 row(s) affected)\nOK\nAdding template Template_2.frx with id 2272 to company 13\n\n(1 row(s) affected)\nOK\nAdding template Template_2.frx with id 2272 to company 14\n\n(1 row(s) affected)\nOK\n</code></pre>\n\n<p>Second time, only this:</p>\n\n<pre><code>(1 row(s) affected)\n</code></pre>\n\n<p>And indeed, the insert inside the cursor did not run.</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12499428,"title":"Select taking too long. Need advice for a better performance","body":"<p>Ok, here we go. There's this messy <code>SELECT</code> crossing other tables and ordering to get the one desired row. Basically I do the \"math\" inside the <code>ORDER BY</code>.</p>\n\n<p>1 base table.</p>\n\n<p>7 <code>JOINS</code> poiting to local tables.</p>\n\n<p><code>WHERE</code> with 2 clauses and a <code>NOT IN</code> crossing another table.</p>\n\n<p>You'll see in the code the <code>ORDER BY</code> is pretty damn big/ugly, it sums the result of 5 different calculations. I need that result to <code>order by</code> those calculations in order to get the worst row-case. </p>\n\n<p>The problem is once I execute the Stored Procedure it takes up to 8 seconds to run. That's kind of non-acceptable. So, I'm starting to check Indexes. </p>\n\n<p>So, I'm looking for advices on how to make this query run faster.\nI'm indexing the <code>WHERE</code> clauses and the field <code>LINEA</code>, Should I index something else? Like the rows Im crossing for the <code>JOINs</code>? or should I approach the query differently?</p>\n\n<p>Query:</p>\n\n<pre><code>SET @LINEA = (\n    SELECT TOP 1\n        BOA.LIN\n    FROM\n        BAND_BA BOA\n    LEFT JOIN\n        TEL PAR\n        ON REPLACE(BOA.Lin,'-','') = SUBSTRING(PAR.Te,2,10)\n    LEFT JOIN\n        TELP CLP\n        ON REPLACE(BOA.Lin,'-','') = SUBSTRING(CLP.Numtel,2,10)\n    LEFT JOIN\n        CA C\n        ON REPLACE(BOA.Lin,'-','') = C.An\n    LEFT JOIN\n        RE R\n        ON REPLACE(BOA.Lin,'-','') = R.Lin\n    LEFT JOIN\n        PRODUCTOS2 P2\n        ON BOA.PRODUCTO = P2.codigo\n    LEFT JOIN\n        EN \n        ON REPLACE(BOA.Lin,'-','') = EN.G\n    LEFT JOIN\n        TIP ID\n        ON TIPID = ID.ID\n    WHERE \n        BOA.EST = 'C' AND\n        ID.SE =  'boA' AND \n        BOA.LIN NOT IN (\n            SELECT \n                LIN \n            FROM \n                BAN\n\n            )   \n    ORDER BY (EN.VALUE + ANT.VALUE + REIT.VAL + C.VALUE + TEL.VALUE\n\n        ) DESC,             \n</code></pre>\n"},{"tags":["c#","asp.net","sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":65,"score":0,"question_id":12953209,"title":"Retrieve Integer value from string in a Gridview","body":"<p>I have a gridview, when inserting data into the table <code>dept(100, 1, 'IT')</code> and when fetch the data from two tables <code>emp</code> and <code>dept</code> the records look like below grid:</p>\n\n<pre><code>EMpNo    DeptNo  DeptName\nHarshal   1        IT  \n</code></pre>\n\n<p>My problem is that, when I click on a grid view all records shows in respected text boxes\nbut issue is, I got all data except <code>empno</code>. Here I get as Name of employee instead of name  I want to <code>Empno</code>.</p>\n"},{"tags":["c#","sql-server-2008","unit-testing","teamcity","business-intelligence"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":244,"score":0,"question_id":10519736,"title":"Unit test (connect to Analysis Services) fails on TeamCity - but not on VS 2010 on the same machine","body":"<p>I've written some code that runs an MDX query against an SQL Server Analysis services. Unit tests on my dev machine work fine - however the TeamCity installation also runs the unit tests and only the ones connecting to the analysis services give an exception stating:</p>\n\n<pre><code>Test method GetNumCompaniesPerIndustryTest threw exception: \nMicrosoft.AnalysisServices.AdomdClient.AdomdConnectionException: The connection either timed out or was lost. \n---&gt; System.IO.IOException: Unable to read data from the transport connection: An existing connection was forcibly closed by the remote host. \n---&gt; System.Net.Sockets.SocketException: An existing connection was forcibly closed by the remote host\n</code></pre>\n\n<p>This is the error I was getting before when my connection string wasn't right. The weird thing is that the server with TeamCity also has a VS 2010 installation so I can open the solution form the /buildAgent/work folder and run the unit tests. All tests work fine from VS - so there's no connection problem it seems.\nConnection string is in a settings file inside the DLL in application scope.</p>\n"},{"tags":["sql","sql-server-2008","sp-send-dbmail"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12950756,"title":"sp_send_dbmail with Binary Attachment Issue","body":"<p>I am attempting to use sp_send_dbmail to send out an attachment.\nThe attachment is stored in a varbinary(MAX) column in a table. Here is my query:</p>\n\n<pre><code>EXEC msdb.dbo.sp_send_dbmail \n        @recipients='mick.walker@somewhere.com',\n        @subject = 'Test Attachment',\n        @body = 'Test',\n        @body_format = 'HTML',\n        @profile_name = 'intranetadmin',\n        @query = 'Select DocumentData from [myDB].[dbo].[Documents] Where DocumentID = 8',\n        @query_result_header = 0,\n        @attach_query_result_as_file = 1,\n        @query_attachment_filename = 'Test.pdf',\n        @exclude_query_output = 1,\n        @query_no_truncate = 0;\n</code></pre>\n\n<p>The email sends sucessfully with a pdf attachment. However when it comes to opening the attachment, I get an error. I think the size of the file is being truncated, even though I explicitaally state no to in my query.</p>\n\n<p>I have checked the MAX allowed message size in the Database Mail settings and it is currently 104857600 bytes (100mb), the files I am attempting to send, are nowhere near this size - so I am a little puzzled.</p>\n"},{"tags":["sql","sql-server-2008","hierarchy","hierarchyid"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":347,"score":1,"question_id":8899230,"title":"Sql Hierarchy ID Sorting By Level","body":"<p>Is it possible to sort sql data in a hierarchy by it's hierarchy id, and then for each level sort it say alphabetically?</p>\n\n<p>So say we have an Employees Table that lists the organizational hierarchy based on the Employees ID</p>\n\n<p>You have Bob (5) who has Phil (17) and Charlie(28) Reporting to him, and Josie (6) has Tyler (15) and Mike (56) Reporting to her.</p>\n\n<p>If you sort it by HierarchyID it will look like:</p>\n\n<p>Bob (/5/)<br/>\n--Phil (/5/17/)<br/>\n--Charlie (/5/28/)<br/>\nJosie (/6/)<br/>\n--Tyler (/6/15/)<br/>\n--Mike (/6/56/)</p>\n\n<p>But It would probably make more sense to have it look like</p>\n\n<p>Bob<br/>\n--Charlie<br/>\n--Phil<br/>\nJosie<br/>\n--Mike<br/>\n--Tyler</p>\n\n<p>Is this possible without it getting too convoluted?</p>\n"},{"tags":["mysql","sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12949329,"title":"Is it possible to Connecting MYsql with sql server?","body":"<p>I am using an open source software which support mysql and i create application that uses asp.net 4.0 and sql server 2008....</p>\n\n<p>Is it possible to Connecting MYsql with sql server ?</p>\n\n<p>I want every insertion and updating should be made to both database servers as they have same schema of tables but one is mysql and other is sql server 2008 ?</p>\n\n<p>kindly explain step by step if possible</p>\n"},{"tags":["sql-server","sql-server-2008","row"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12950538,"title":"MS SQL 2008 - get all table names and their row counts in a DB","body":"<p>I'm trying to identify which tables are affected by a data update though an application (developed by others). There are more than 200 tables in the DB and I'd like to avoid checking each of them for changes.</p>\n\n<h3>Is there any other way where I can list all table names along with their row count?</h3>\n\n<pre><code>select table_name from information_schema.tables\n</code></pre>\n\n<p>List out all the tables in my DB buy how do I include number of rows as well?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","sybase","sybase-ase"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":38,"score":1,"question_id":12950844,"title":"Converting Sybase ASE-specific *= and =* into LEFT/RIGHT OUTER JOIN","body":"<p>I have some PHP applications running on Sybase ASE 15.0.2, and I need to port them to MicroSoft SQL Server 2008 R2.\nMany of the queries use the Sybase-only syntax with <code>*= and =*</code>\nIs there an automatic way to convert a query from the Sybase syntax to the standard syntax using LEFT/RIGHT OUTER JOIN ?</p>\n"},{"tags":["c#","sql-server-2008","gis","geocoding"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":12949605,"title":"Get all points(circles with radius), that overlap given point","body":"<p>I need to find the best way for a \"circles overlapping given point\" system.</p>\n\n<p>I have a lot of points e.g. restaurants, and every item has a point of the place, and a radius for e.g. \"bringing out food\". The radius differ, some have 3 km, others 10 km.\nI am searching from a point. e.g. \"My position\" latitude/longitude.</p>\n\n<p>I need to find the best way to find all restaurants that overlaps my point. (Will bring food to me). (Not is point in circle, but what circles are overlapping my point.)</p>\n\n<p>I am thinking of storing lat/lng as geography type in SQLServer 2008. Is this the way to do it?</p>\n\n<p>Can I query directly on top of sqlserver? Or do I need to do it in code?\nAnd what is the way to do it?</p>\n"},{"tags":["sql-server-2008"],"answer_count":4,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":18570,"score":6,"question_id":3169220,"title":"How to export query result to .csv file in SQL Server 2008?","body":"<p>How to export query result to .csv file in SQL Server 2008 ?</p>\n\n<p>Thanks in advance</p>\n"},{"tags":["sql-server","sql-server-2008","compilation","real"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":67,"score":4,"question_id":12950174,"title":"SQL REAL 0 division causing interesting error on SQL Server 2008","body":"<p>Found an interesting problem on SQL Server yesterday, try this: </p>\n\n<pre><code>DECLARE @a REAL = 0.0000\nDECLARE @c DECIMAL (18,10) = 20754/3.45 -- this is 6015.6521730000\nDECLARE @b DECIMAL (18,10) = \nCASE \n    WHEN 1 &gt; 2 \n        THEN @a / 100\n    WHEN 1 = 2\n        THEN 56\n    ELSE @c\nEND\n\nSELECT @b\n</code></pre>\n\n<p>It seems to be a problem with precision, and how the case statement is compiled. It can be easily remedied by casting the REAL @a to a decimal in the case statement, but as it's @c we're returning and the other cases should never be hit, it's a strange problem to come across. \nAnyone know enough about SQL compilation to explain this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":59,"score":1,"question_id":12948329,"title":"selecting minimum of multiple columns","body":"<p>I have three decimal columns named list1,list2,list3.\nI want to find the minimum of three in a single query.<br>\nI've tired this:</p>\n\n<pre><code>SELECT Least(list1, list2, list3) \nFROM   table1 \n</code></pre>\n\n<p>It throws an error that <code>least</code> is not recognized function.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12946298,"title":"Best way to get blog post titles along with blog name","body":"<p>Say I have 2 tables:</p>\n\n<blockquote>\n<pre><code>Blog      BlogPosts\nBlogId    BlogPostId\nName      BlogId\n          Title\n</code></pre>\n</blockquote>\n\n<p>When I am retrieving records, I want BlogPosts in CSV format. I've created a user defined function for this and pass in BlogId as a parameter. Is there any better way than this? Making DB requests in user defined functions can often be performance killer. Do you suggest any other way?</p>\n"},{"tags":["asp.net","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12949270,"title":"Updating records one by one","body":"<p>I have 5000 records I am calculating salary of one user and update his data in database. So its taking quit long to update 5000 records. I want to calculate all users salary first and then update to records in db.\n Is there any other way we can update db in single click</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12949804,"title":"Duplicate inserts with scheduled job through sql server Agent","body":"<p>I have a job that is scheduled through SQL Agent. It is scheduled to run every 2 minutes. When I am looking at the job history log I see it has ran once. But when I am looking at the table it has inserted two records and time difference between 2 records is just few milliseconds.</p>\n\n<p>I am trying to find out why it is happening and to looking to prevent this from happening.\nSql server version i'm using is 2008 on Windows server 2008. </p>\n\n<p>The stored procedure is doest not any prolem and before inserting i have a check IF NOT EXISTS (in the table)then insert. And also there is no trigger on that table.</p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server-2008","query","nhibernate"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":38,"score":0,"question_id":12919949,"title":"How to group by SqlFunction with VarArgsSQLFunction in NHibernate","body":"<p>I'm trying to implement the following SQL query with QueryOver:</p>\n\n<pre><code>SELECT [Time]/1000\nFROM TableName\nGROUP BY [Time]/1000\n</code></pre>\n\n<p>Here's my current attempt:</p>\n\n<pre><code>var result = session\n    .QueryOver&lt;TableName&gt;\n    .Select(Projections.GroupProperty(\n        Projections.SqlFunction(\n            new VarArgsSQLFunction(\"(\", \"/\", \")\"),\n            NHibernateUtil.Int64,\n            Projections.Property(\"Time\")\n            Projections.Constant(1000))\n    ))\n    .List&lt;object&gt;();\n</code></pre>\n\n<p>Unfortunately I get the following exception (GenericADOException):</p>\n\n<pre><code>could execute query\n[ SELECT (this_.Time/@p0) as y0_ FROM [TableName] this_ GROUP BY (this_.Time/?) ]\n</code></pre>\n\n<p>And the inner exception:</p>\n\n<pre><code>Incorrect syntax near ?.\n</code></pre>\n\n<p>I can replace the \"GroupProperty\" with a \"Sum\" and it works. Any idea what's missing?</p>\n\n<hr>\n\n<p><strong>Update</strong>:\nApparently it's a bug in NHibernate. See also <a href=\"http://stackoverflow.com/questions/10696539/incorrect-syntax-near-nhibernate-generated-query\">this question</a>.</p>\n"},{"tags":["sql","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":0,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":72,"score":2,"question_id":12948070,"title":"DT_NTEXT columns in an SSIS package and Truncation Warnings","body":"<p>I have 2 questions : </p>\n\n<p>1) I have a DT_NTEXT column whose value I'm extracting from the database and trying to feed into a Test column in Excel. I'm using a data conversion step in between to convert this to DT_TEXT (the unicode text version).</p>\n\n<p>Still, in the end, Excel Connection Manager is writing ZERO rows (it's showing truncation warnings, but executing without error). I've even added a data viewer along the data flow with the following steps :</p>\n\n<p>\"<strong>In the arrows connecting your Source task to Data Conversion, and Data Conversion to Destination task , double click and you'll open the Data Flow Path Editor. Click on Data Viewer, then Add and click OK. That will allow you to see what is moving through the pipeline.</strong>\"</p>\n\n<p>I'm not seeing any difference when I run my package though.</p>\n\n<p>2) Is it possible for me to convert a DT_NTEXT column to a DT_WTSR column. In a perfect scenario, i should get this column into a standard nvarchar column in my Excel. </p>\n"},{"tags":["asp.net","sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12947687,"title":"which system table contains IsReportManagerEnabled parameter","body":"<p>I need to figure out which system table contains the IsReportManagerEnabled option\nfor Report Manager.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12947106,"title":"timeout error for growing database size","body":"<p>We have an application which is running under productive environment.The application has a web service which takes in data and saves the data in MS SQL database for future processing. This web service is used by our client to send the data. We receive around 80 records per seconds. </p>\n\n<p>Initially the application was working fine and the size of the database was 1 GB. The application is in production environment for around 6 months now and the database size has reached to 15 GB. Now all the operations on the database are taking more time. Clients are getting timeout error for the web service due to database slow speed. </p>\n\n<p>Please suggest a solution so that we can handle such a application where database size increases gradually. </p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":44,"score":3,"question_id":12943686,"title":"SQL Server Row based grouping","body":"<p>Given the following setup:</p>\n\n<pre><code>DECLARE @TemplateInfo table (Name varchar(10), aRow int, aCol int, Value  int)\n\ninsert INTO @TemplateInfo (Name, aRow, aCol, Value)\nVALUES ('A', 0,0,1),('B', 0,0,2),('A',1,0,2),('B',1,0,1),('C',0,0,1),('C',1,0,1)\n</code></pre>\n\n<p>How can I select the unique Name name values that have (aRow=0, aCol=0, Value=1) AND (aRow=1, aCol=0, Value=1). </p>\n\n<p>I tried a query like this:</p>\n\n<pre><code>select  Name\nfrom    @TemplateInfo info\nwhere   (info.aRow = 0 and info.aCol = 0 AND Value = 1) \n        or (info.aRow = 1 and info.aCol = 0 AND Value = 1)\nGROUP BY Name\n</code></pre>\n\n<p>But that returns A, B and C.  How can I check to make sure there are matches across rows (only return C)</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":68,"score":1,"question_id":12912363,"title":"Conversion failed when converting date and/or time from character string","body":"<p>Why does this statement succeed?</p>\n\n<pre><code>    SELECT CAST('08:50' as time)\n</code></pre>\n\n<p>But this one fails? <code>tmrec</code> is an nvarchar(6) column and contains the same value <code>'08:50'</code>. This is making me crazy since last 1 hour.</p>\n\n<pre><code>    SELECT   TOP 1 CAST(tmrec as time) \n    FROM     Instr \n    WHERE    igrp = 'JD' \n    ORDER BY ino , smallin\n</code></pre>\n\n<p><a href=\"http://postimage.org/image/f5wtcbr91/\" rel=\"nofollow\">This screenshot</a> shows the 1st query's result. It contains 08:50. Yet the 2nd query throws error.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Even this doesn't work which guarantees that conversion is applied only on fetched records:</p>\n\n<pre><code>    SELECT CAST( tmrec as time)\n    FROM\n         (\n            SELECT TOP 1 tmrec\n            FROM   [ccwise-courts].[dbo].[INSTR]\n            WHERE  igrp = 'JD' \n            ORDER BY ino , smallin\n         ) v\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":82,"score":2,"question_id":12941165,"title":"SQL Server : how to loop through rows and assign value","body":"<p>I have a couple of tables to deal with. One is like this:</p>\n\n<p><strong>dbo.userActivity</strong> </p>\n\n<pre><code> userID    Action    Time\n   1         25       12:00\n   1         10       12:01\n   1         12       12:35\n   1          6       13:54\n   2         10        6:47\n   2         42        6:48\n   3          8       11:54\n   etc.\n</code></pre>\n\n<p>The other table is a schedule that looks like this:</p>\n\n<p><strong>dbo.userSchedule</strong> </p>\n\n<pre><code> userID    schedule_start    schedule_stop\n   1            07:00            09:00\n   2            11:00            12:30\n   3            14:00            15:00\n  etc.\n</code></pre>\n\n<p>What I need to do for each row in <code>dbo.userActivity</code> is determine if each action was an hour before the <code>schedule_start</code>, between the <code>schedule_start</code> and <code>schedule_stop</code> times, an hour after <code>schedule_stop</code>, or any other time. </p>\n\n<p>So I need to append a column to <code>dbo.userActivity</code> with the values 'before', 'during', 'after', 'other' based on the time calculations.</p>\n\n<p>I'm really not sure how to do this and would appreciate any help you all could offer.</p>\n\n<p>EDIT:</p>\n\n<p>Okay, so I have that mostly working. I've just seen some of the real data I'll be working on and noticed that the activity times are full datetime stamps, whereas the activity schedule is just in time. So I need to convert the datetime to something I can compare.</p>\n\n<p>This looks like it works:</p>\n\n<blockquote>\n  <p>SELECT * \n  FROM\n    (\n        SELECT CONVERT(TIME, SCANDATE) as scanTime \n        FROM appData\n    ) st\n  WHERE st.scanTime &lt;= '6:00'\n  ORDER BY st.scanTime</p>\n</blockquote>\n\n<p>Just as an example. But when I try to incorporate that into the case statement below like this, it doesn't work. It applies the same THEN to every row.</p>\n\n<blockquote>\n<pre><code>SELECT\n  CASE\n  WHEN EXISTS\n  (\n  SELECT *\n  FROM\n  (\n  SELECT CONVERT(TIME, SCANDATE) as scanTime \n  FROM appData\n  ) st\n  WHERE st.scanTime &lt;= '6:00'\n  )\n  THEN 'Before 6 am'\n\n  ELSE '6 am or after'\n  END\nFROM appData\n</code></pre>\n</blockquote>\n\n<p>Any further thoughts on this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12943220,"title":"SSIS New Column with Condition","body":"<p>I have Created one new column using Derived column Record_Type as (DT_WSTR,25)\"\" data type, Then I used another derived column to create my condition  for Record_Type is  PRDCT_IND ==  TRUE  ? \"PRIME\" : \"SEC\".</p>\n\n<p>Can it be possible to create both the thing in one derived column?</p>\n\n<p>Appreciate your help.</p>\n\n<p>343</p>\n"},{"tags":["c#","asp.net-mvc","linq","sql-server-2008","entity-framework-4"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":64,"score":1,"question_id":12929610,"title":"How to reset the identity column in C#?","body":"<p>I need to reset my identity field parametrically in MVC.net. I am using Linq and Entity Framework.</p>\n\n<p><strong>Reason:</strong> I am inserting thousands of records in my table by importing. I am importing records again after some period of time, so my id field value increasing so much </p>\n\n<p>For ex. In 100000000 so my field data type is Big int but it is not sufficient for my this value. So I need to reset my identity field. </p>\n"},{"tags":["sql-server-2008","full-text-search","multiple-columns"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":31,"score":2,"question_id":12943199,"title":"Is it possible to create a full text index on two or more columns on the same table in MS SQL?","body":"<p>Is this possible, or by default is this essentially what I'm doing by creating a full text index on the entire table, specifying in my query which column to query using the 'CONTAINS(column, phrase)' function?</p>\n\n<p>Thanks!</p>\n\n<p>If this question has already been asked (was unable to find a match) please feel free to delete.</p>\n"},{"tags":["c#","asp.net","sql-server-2008","c#-4.0","asp.net-4.0"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":54,"score":1,"question_id":12945120,"title":"sql simple Query with dates","body":"<p>i have a time clock application that registers employes Attendance at work,</p>\n\n<p>i was trying to set the visibility of \"Enter\" <code>imageButton</code>\n(entrance e.g \"Timein\" field ) to hidden based on a query </p>\n\n<p>so if there was no <code>timeout</code> in last record that has a <code>TimeIn</code> for the current <code>UserId</code> then the <code>Enter</code> button will be hidden </p>\n\n<p>this is the table : (<code>tId</code> is PK IDENTITY)</p>\n\n<p><img src=\"http://i.stack.imgur.com/k7R6p.png\" alt=\"enter image description here\"></p>\n\n<p>so based on those records for example , the last (top 1) is not signed out so the user will not get to see the <code>Enter button</code>, that allows user to sign in, cause there was no last action of <code>TimeOut</code></p>\n\n<p>working from <code>asp.net</code> <code>C#</code> code behind i was trying to work a solution using <code>datedIff</code> as a query :</p>\n\n<p>but i guess i am missing something here </p>\n\n<p>please don't take it to account if this is the wrong approach i just wanted to show.. i did try though if there's a better way to achive what i need then just disregard that query  </p>\n\n<pre><code>select isnull((SELECT TOP 1 case when [TimeOut] is null then '' else convert(nvarchar,[TimeOut]) end FROM tblTime WHERE datediff(day,TimeOut,getdate())=0 and UserId =3571 ORDER BY tId DESC),'')\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12927861,"title":"Calculating time frames between status using SQL 2008/2012","body":"<p>Calculating time frames between status using SQL 2008/2012</p>\n\n<p>I've the following table who store the status of a student</p>\n\n<pre><code>+----+-----------+------------------+---------+---------+\n| ID | PERSON_ID |    TIMESTAMP     | IN_HOME | STUDYNG |\n+----+-----------+------------------+---------+---------+\n|  1 |         1 | 17/10/2012 19:00 |       0 |       0 |\n|  2 |         1 | 17/10/2012 19:02 |       1 |       0 |\n|  3 |         1 | 17/10/2012 19:03 |       1 |       1 |\n|  4 |         1 | 17/10/2012 19:04 |       1 |       1 |\n|  5 |         1 | 17/10/2012 19:05 |       1 |       0 |\n|  6 |         1 | 17/10/2012 19:10 |       0 |       0 |\n|  7 |         1 | 17/10/2012 19:12 |       0 |       0 |\n|  8 |         1 | 17/10/2012 19:20 |       1 |       0 |\n|  9 |         1 | 17/10/2012 19:25 |       1 |       0 |\n| 10 |         1 | 17/10/2012 19:26 |       1 |       1 |\n| 11 |         1 | 17/10/2012 19:30 |       1 |       0 |\n+----+-----------+------------------+---------+---------+\n</code></pre>\n\n<p>And i would like to produce results in 2 ways to make some reports:</p>\n\n<p>I:</p>\n\n<pre><code>+-----------+------------------+------------------+---------+---------+\n| PERSON_ID |      START       |       END        | IN_HOME | STUDYNG |\n+-----------+------------------+------------------+---------+---------+\n|         1 | 17/10/2012 19:00 | 17/10/2012 19:02 |       0 |       0 |\n|         1 | 17/10/2012 19:02 | 17/10/2012 19:03 |       1 |       0 |\n|         1 | 17/10/2012 19:03 | 17/10/2012 19:05 |       1 |       1 |\n|         1 | 17/10/2012 19:05 | 17/10/2012 19:10 |       1 |       0 |\n|         1 | 17/10/2012 19:10 | 17/10/2012 19:20 |       0 |       0 |\n|         1 | 17/10/2012 19:20 | 17/10/2012 19:26 |       1 |       0 |\n|         1 | 17/10/2012 19:26 | 17/10/2012 19:30 |       1 |       1 |\n+-----------+------------------+------------------+---------+---------+\n</code></pre>\n\n<p>II:</p>\n\n<pre><code>+-----+------------------+------------------+--------+---------+----------+----------+\n| PID |      START       |       END        | InHOME | TotTIME | FreeTIME | StudTIME |\n+-----+------------------+------------------+--------+---------+----------+----------+\n|   1 | 17/10/2012 19:00 | 17/10/2012 19:02 |      0 | 2min    | 2min     | 0min     |\n|   1 | 17/10/2012 19:02 | 17/10/2012 19:10 |      1 | 8min    | 6min     | 2min     |\n|   1 | 17/10/2012 19:10 | 17/10/2012 19:20 |      0 | 10min   | 10min    | 0min     |\n|   1 | 17/10/2012 19:20 | 17/10/2012 19:26 |      1 | 6min    | 6min     | 0min     |\n+-----+------------------+------------------+--------+---------+----------+----------+\n</code></pre>\n\n<p>What's the best solution to solve this problems? </p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12939851,"title":"Query tables across multiple databases","body":"<p>All... I need a way to query identical tables across multiple databases. I have roughly 30+ databases and they all have identical tables.  </p>\n\n<pre><code>    SELECT \n      a.name\n      , a.address\n      , b.company_id\n      , c.part_no\n      , c.cost\n    FROM accounts a\n    JOIN business b on a.whatever = b.whatever\n    JOIN crazy c ON b.things = c.things\n</code></pre>\n\n<p>Something simple like this, but across all databases. The focus isn't joining on multiple databases, that's simple, it's running this across all databases simultaneously. There's got to be a simpler way than creating a long drawn out stored procedure, no?</p>\n"},{"tags":["sql","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":67,"score":-1,"question_id":12806994,"title":"SSIS Conditional Filter split with bit data type","body":"<p>Data -  from table (58 columns), in this table 4 columns will use in conditional filter.</p>\n\n<p>1 column - bit data type(Color_Ind)</p>\n\n<p>1 column -  bit data type(Type_ind)</p>\n\n<p>2 columns - varchar data type(Region,State)</p>\n\n<p>process steps\n1) OLE DB connection to extract all data</p>\n\n<p>2) use Data Conversion to convert bit type columns into string data type.</p>\n\n<p>3) use conditional filter to filter the data into 5 different category.</p>\n\n<p>Probelm:-\n- If I use color_ind and Type_ind it will not create my desired output, but If I use it without these columns and only use Region and state it will create my desired output.</p>\n\n<p>Could you please tell me how to use bit data type into condtional filter in SSIS?</p>\n\n<p>Appreciate your help.</p>\n\n<p>Thanks</p>\n"},{"tags":["asp.net","sql-server-2008","geolocation","geospatial","computational-geometry"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":76,"score":0,"question_id":12061189,"title":"Optimize zipcode distance calculation","body":"<p>Here is the question I have for all</p>\n\n<p>I already have an existing system that does the \"Near By Zipcodes\" search.</p>\n\n<p>The purpose of this post is to see if I can optimize the process.</p>\n\n<p>Currently, I have about 43k zipcode records.</p>\n\n<p>The way my current algorithm works is I select 1 record and do a full table scan of 43k records.</p>\n\n<p>Is there a way to only take a subset (lat range, long range) and do the calculation that way?</p>\n"},{"tags":["sql-server-2008","database-diagram"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":343,"score":0,"question_id":11131528,"title":"SQL Server 2008 Unspecified error (MS Visual Database Tools)","body":"<p>I am a newbie using SQL Server 2008, and I am facing an error message when I try to make database diagram by right clicking on the database in SQL Server Management Studio:</p>\n\n<blockquote>\n  <p>Unspecified error\n  (MS Visual Database Tools)</p>\n  \n  <p>Program Location:</p>\n  \n  <p>at System.Runtime.InteropServices.Marshal.ThrowExceptionForHRInternal(Int32\n  errorCode, IntPtr errorInfo)<br>\n  at Microsoft.SqlServer.Management.UI.VSIntegration.Editors.VirtualProject.CreateDesigner(Urn\n  origUrn, DocumentType editorType, DocumentOptions aeOptions,\n  IManagedConnection con, String fileName)<br>\n  at Microsoft.SqlServer.Management.UI.VSIntegration.Editors.VirtualProject.Microsoft.SqlServer.Management.UI.VSIntegration.Editors.ISqlVirtualProject.CreateDesigner(Urn\n  origUrn, DocumentType editorType, DocumentOptions aeOptions,\n  IManagedConnection con, String fileName)<br>\n  at Microsoft.SqlServer.Management.UI.VSIntegration.Editors.ISqlVirtualProject.CreateDesigner(Urn\n  origUrn, DocumentType editorType, DocumentOptions aeOptions,\n  IManagedConnection con, String fileName)<br>\n  at Microsoft.SqlServer.Management.UI.VSIntegration.Editors.ScriptFactory.CreateDesigner(DocumentType\n  editorType, DocumentOptions aeOptions, Urn parentUrn,\n  IManagedConnection mc, String fileName)<br>\n  at Microsoft.SqlServer.Management.UI.VSIntegration.Editors.VsDocumentMenuItem.CreateDesignerWindow(IManagedConnection\n  mc, DocumentOptions options)  </p>\n</blockquote>\n\n<p>I have searched for this error and most of the responses were about \"common error when upgrading from 2005 to 2008\", which is not my case, because I have only just newly installed SQL Server 2008 4 days ago.</p>\n\n<p>Can someone help me to solve this problem?</p>\n"},{"tags":["sql","sql-server-2008","query"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12921894,"title":"sql server 2008 query inline","body":"<p><code>select devicename, name, value, timestamp from table1</code> gives me the following,</p>\n\n<pre><code>DEVICENAME     NAME     VALUE    TIMESTAMP\n123            CURRENT  130      2012-10-16 13:00:00.000\n123            AVG      140      2012-10-16 13:00:00.000\n123            MIN      100      2012-10-16 13:00:00.000\n123            MAX      160      2012-10-16 13:00:00.000\n</code></pre>\n\n<p>How do i get them like this in sql query,</p>\n\n<pre><code>123, 130, 140, 100, 160 2012-10-16 13:00:00.000\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","ssis","ssis-data-transformations"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12939335,"title":"Execute SSIS Package when SQL and Visual studio is not installed","body":"<p>Is it possible to execute the SSIS package(.dtsx file) into the System when SQL and Visual Studio is not installed into the system.</p>\n\n<p>Minimum Requirement to execute the SSIS Package ?\nKindly Suggest how to proceed in this scenario ?</p>\n\n<p>Thanks</p>\n"},{"tags":["c#","asp.net-mvc","sql-server-2008","linq-to-sql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":51,"score":2,"question_id":12942101,"title":"What's a good way to convert my LINQ-to-SQL objects into my model objects?","body":"<p>I've been noticing when I pull things out of the my MSSQL db using LINQ-to-SQL using something simple like:</p>\n\n<pre><code>    public IEnumerable&lt;Contact&gt; GetAll()\n    {\n        var Contacts = from c in _context.Contacts\n                      select new Models.Contact\n                      {\n                          ContactID = c.ContactID,\n                          FirstName = c.FirstName,\n                          LastName = c.LastName,\n                          Email = c.Email,\n                          Phone = c.Phone,\n                          Address1 = c.Address1,\n                          Address2 = c.Address2,\n                          City = c.City,\n                          State = c.State,\n                          Zip = c.Zip,\n                          HighImportance = (bool)c.HighImportance,\n                          PrimaryContact = (bool)c.PrimaryContact,\n                          OfficeLocation = c.OfficeLocation\n                      };\n        return Contacts;\n    }\n</code></pre>\n\n<p>I have a complex object (foreign key reference) to an OfficeLocations table which I would like to populate.  If I do something like:</p>\n\n<pre><code>_context.OfficeLocations.SingleOrDefault(ol =&gt; ol.OfficeLocationID == c.OfficeLocationID);\n</code></pre>\n\n<p>Then this returns the type which is generated by my DBML.  Up to now I've been using something like:</p>\n\n<pre><code>OfficeLocation = new OfficeLocation\n            {\n                OfficeLocationID = c.OfficeLocationID,\n                Name = c.OfficeLocation.Name,\n                Phone = c.OfficeLocation.Phone\n            }\n</code></pre>\n\n<p>But I feel like there should be a much better way to do it, maybe by using extension methods on my DBML data objects or something?</p>\n\n<p>Any thoughts would be greatly appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql-server-2008","max"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":70,"score":1,"question_id":12865731,"title":"Trouble with SELECT statement - find Min, Max values under different conditions - SQL server 2008","body":"<p>Here is how my selection looks like:</p>\n\n<pre><code>DocID   DocNumber   MilestoneDate   MilestoneID\n30      14-1        2001-10-01  10\n30      14-1        2001-10-15  11\n30      14-1        2002-11-06  13\n30      14-1        2003-11-01  27\n30      14-1        2003-11-01  30\n30      14-1        2004-03-01  28\n30      14-1        2004-03-01  31\n31      14-3        2003-06-27  13\n31      14-3        2004-05-05  27\n31      14-3        2004-05-05  30\n31      14-3        2005-07-20  35\n31      14-3        2005-08-31  23\n36      1-2         1996-10-01  10\n36      1-2         1996-10-01  11\n36      1-2         1996-12-01  28\n36      1-2         1996-12-01  31\n</code></pre>\n\n<p>I need to make a report out of this selection that would have 1 row per DocID.\nIt would have columns \nDocID, \nDocNumber, \nEarliestDate = if MilestoneID 10 or 11 not empty select greater out of these two else\n               the earliest date out of other MilestoneIDs for that DocID (here is my trouble)\nAny help would be appreciated.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","hadoop","hdfs","sqoop"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":154,"score":0,"question_id":9568479,"title":"Sqoop authenticates but fails to start a map reduce job","body":"<p>I am trying to transfer data using sqoop from HDFS to the MSSQL server. But for some reasons, sqoop hangs at </p>\n\n<pre><code>tool.BaseSqoopTool: Enabled debug logging.\nsqoop.ConnFactory: Added factory com.microsoft.sqoop.SqlServer.MSSQLServerManagerFactory specified by /usr/lib/sqoop/conf/managers.d/mssqoop-sqlserver\nDEBUG sqoop.ConnFactory: Loaded manager factory: com.microsoft.sqoop.SqlServer.MSSQLServerManagerFactory\nDEBUG sqoop.ConnFactory: Loaded manager factory: com.cloudera.sqoop.manager.DefaultManagerFactory\nDEBUG sqoop.ConnFactory: Trying ManagerFactory: com.microsoft.sqoop.SqlServer.MSSQLServerManagerFactory\nINFO SqlServer.MSSQLServerManagerFactory: Using Microsoft's SQL Server - Hadoop Connector\nINFO manager.SqlManager: Using default fetchSize of 1000\nDEBUG sqoop.ConnFactory: Instantiated ConnManager com.microsoft.sqoop.SqlServer.MSSQLServerManager@45db05b2\nINFO tool.CodeGenTool: Beginning code generation\nDEBUG manager.SqlManager: No connection paramenters specified. Using regular API for making connection.\n</code></pre>\n\n<p>I check the firewall and it is allowing connections without any restrictions. Sqoop gets authenticated but doesnt initiate a map reduce job after it gets authenticated. Any one has faced similar problems before?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2005"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12461892,"title":"views not refreshing /sp_refreshview taking time for certain views even though there is no data in the view","body":"<p>I have got 2 client's databases(client1 and client 2).As a part of testing, I have restore those 2 databases in my local server.</p>\n\n<p>Views are created in a database called configDB(same server) and are pointing to  tables in a database  called CurrentsourceDB(data of client1).Now I have \nrenamed the CurrentsourceDB to CurrentsourceDB_old and \nsource2db(data of client2) to CurrentsourceDB\n(client1's data db and client2's data db both have same objects, same structure. The only difference is with data ).\nNow when I query the view it has to show data based on source2db(client2's data) But it still shows data based on source1(client1's data).</p>\n\n<p>So I have to either refresh all the view or just alter all the views then I can see the view's data based on present source database,source2db\nWhy does it happen, and is there any way to resolve the problem apart from refreshing?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":43,"score":0,"question_id":12935664,"title":"Get size of a database that is hosted on a linked server?","body":"<p>Does anyone know how to get the size of a dabase that is hosted on a different server? I basicly want to monitor the size of that DB in a Job on my server.\nI tried something like:</p>\n\n<pre><code>select db_name(dbid), str(convert(dec(15),sum(size))* 8192/ 1048576,10) \nfrom [LINKEDSERVER].master.sys.sysaltfiles \ngroup by dbid order by 2 desc\n</code></pre>\n\n<p>For some reason this gives me the data on my current server instead of the remote server.\nAlso, I've read on a forum that the sysaltfiles is only updated at server restarts? This would make it unusable for monitoring, so do you have a better option instead?</p>\n"},{"tags":["sql-server-2008","sql-job"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12940711,"title":"Error Running SQL Server 2008 Job with SQL Server 2000 Linked Server","body":"<p>I have successfully created a linked server to our SQL 2000 server from within SSMS and I am able to query and retrieve data from it. I have a Merge query set up to read in data from this linked server and use it to update/insert into a table on the SQL 2008 server. When I run this query in SSMS it runs fine. As soon as I schedule it as a job it fails with the following error: \"Login failed for user'NT_Authority\\Network Service'. Reason. Failed to open the explicitly specified database. For each step in this job I have selected the \"Run as user\" and input the same credentials as was used to connect to the linked server. Since it is showing up as using NT_Authority I would guess I'm missing something somewhere. This is the first time I've tried to create a SQL job with a linked server so any direction/help would be appreciated.</p>\n\n<p>Edit. The login is using SQL authentication not Windows. </p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":49,"score":1,"question_id":12940511,"title":"tsql coalesce with float and varchar","body":"<p>I have a float field which shows data as such:</p>\n\n<pre><code>1\n1.00\n3.12\n3.00\n</code></pre>\n\n<p>I also have a varchar field that shows as such:</p>\n\n<pre><code>NA\nND \nI\n</code></pre>\n\n<p>Data is as such: Fld_N is a float and Fld_S is varchar</p>\n\n<pre><code>Fld_N   Fld_S\n-----   ------\n1 \n        ND\n1.00    \n3.12\n3\n       NA\n       I\n</code></pre>\n\n<p>Notice that a row can have a value for either the Fld_N or the Fld_S but not both.</p>\n\n<p>What I am doing is using the coalesce as such:</p>\n\n<pre><code>    COALESCE(STR(Fld_N,9,2), Fld_S)  Fld\n</code></pre>\n\n<p>This doesn't quite work well as I have the decimal points always be upto 2 decimal points whereas I need it to support showing 1 as well as 1.00. Is there a way to not specify the decimal points and still accomomdate for showing 1 and 1.00 in my example? </p>\n"},{"tags":["c#","sql-server-2008","linq-to-sql","entity-framework-4"],"answer_count":3,"favorite_count":2,"up_vote_count":17,"down_vote_count":0,"view_count":6097,"score":17,"question_id":6384659,"title":"A dependent property in a ReferentialConstraint is mapped to a store-generated column","body":"<p>I get this error when writing to the database.</p>\n\n<p>A dependent property in a ReferentialConstraint is mapped to a store-generated column. Column: 'PaymentId'.</p>\n\n<pre><code>public bool PayForItem(int terminalId, double paymentAmount, \n      eNums.MasterCategoryEnum  mastercategoryEnum, int CategoryId, int CategoryItemId)\n    {\n\n        using (var dbEntities = new DatabaseAccess.Schema.EntityModel())\n        {\n            int pinnumber = 0;\n            long pinid = 1; //getPinId(terminalId,ref pinnumber) ;\n            var payment = new DatabaseAccess.Schema.Payment();\n            payment.CategoryId = CategoryId;\n            payment.ItemCategoryId = CategoryItemId;\n            payment.PaymentAmount = (decimal)paymentAmount;\n            payment.TerminalId = terminalId;\n            payment.PinId = pinid;\n\n            payment.HSBCResponseCode = \"\";\n            payment.DateActivated = DateTime.Now;\n            payment.PaymentString = \"Payment\";\n            payment.PromotionalOfferId = 1;\n            payment.PaymentStatusId = (int)eNums.PaymentStatus.Paid;\n\n            //payment.PaymentId = 1;\n\n            dbEntities.AddToPayments(payment);\n            dbEntities.SaveChanges();\n        }\n        return true;\n    }\n</code></pre>\n\n<p>I am new to Entity Framework and its driving me nuts</p>\n\n<p>The schema is</p>\n\n<p><img src=\"http://i.stack.imgur.com/ygkYW.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server-2008","ssms"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":1382,"score":0,"question_id":6703368,"title":"sp_attach_single_file_db Error: failed with the operating system error 5(Access is denied.)","body":"<p>I'm  trying to use this DataBase that come with this sample project with from MS:</p>\n\n<p><a href=\"http://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa/sourcecode?fileId=18930&amp;pathId=365206059\" rel=\"nofollow\">http://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa/sourcecode?fileId=18930&amp;pathId=365206059</a></p>\n\n<p>So after I downloaded the files: I need to attach the .mdf DataBase to my Instance of MS SQL 2008.</p>\n\n<p>From Management Studio Attaching DataBase does not work and event using this command i receive the same error:</p>\n\n<blockquote>\n  <p>sp_attach_single_file_db 'School.mdf', 'C:\\School.mdf'</p>\n</blockquote>\n\n<hr>\n\n<p>ERROR:</p>\n\n<pre><code>Msg 5133, Level 16, State 1, Line 1\nDirectory lookup for the file \"C:\\School.mdf\" failed with the operating system error 5(Access is denied.).\n</code></pre>\n\n<p>Any idea what is wrong? Thanks for your help!</p>\n"},{"tags":["sql","sql-server-2008","tsql","pivot","transpose"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":51,"score":0,"question_id":12926901,"title":"Transposing Table","body":"<p>I've looking everywhere and have not finding anything useful.</p>\n\n<p>I have a table the captures assistance for employees.</p>\n\n<p>The  table that looks like this:</p>\n\n<pre><code>ID   | DATE     | ATTENDANCE\n________________\n2524 | 20121001 | ASISTANCE\n2525 | 20121001 | ABSCENCE\n2526 | 20121001 | ASISTANCE\n2527 | 20121001 | ASISTANCE\n2524 | 20121002 | ASISTANCE\n2525 | 20121002 | ABSCENCE\n2526 | 20121002 | ASISTANCE\n2527 | 20121002 | ASISTANCE\n2524 | 20121003 | ASISTANCE\n2525 | 20121003 | DAY OFF\n2526 | 20121003 | DAY OFF\n2527 | 20121003 | ASISTANCE\n</code></pre>\n\n<p>And I want a query that returns a table that will look like this:</p>\n\n<pre><code>ID   | 20121001  | 20121002  | 20121003\n________________\n2524 | ASISTANCE | ASISTANCE | ASISTANCE\n2525 | ABSCENCE  | ABSCENCE  | DAY OFF\n2526 | ASISTANCE | ASISTANCE | ASISTANCE\n2527 | ASISTANCE | ASISTANCE | DAY OFF\n</code></pre>\n\n<p>I tried individual querys and joining them, but since they are to many dates it takes too much to do so.</p>\n\n<p>How can I do it that is efficient and can be stored into a view or function??</p>\n"},{"tags":["xml","sql-server-2008"],"answer_count":5,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":8011,"score":1,"question_id":1803911,"title":"Generating XML file from SQL Server 2008","body":"<p>I am working on an application where I need to get the SQL response as XML into an XML file (and to store it in some physical location, say c:\\xyz.xml).</p>\n\n<p>I am able to generate the XML content using the provisions available in SQL Server as shown below. </p>\n\n<pre><code>    SELECT * FROM @Table FOR XML AUTO, ELEMENTS\n</code></pre>\n\n<p>where: @Table is a table variable. </p>\n\n<p>I want to know how I can store the query output to a XML file from SQL Server itself. </p>\n\n<p>Thank you</p>\n"},{"tags":["sql-server","sql-server-2008","default-value"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":1961,"score":0,"question_id":6791675,"title":"How to set a default value for an existing column","body":"<p>This isn't working in SQL Server 2008:</p>\n\n<pre><code>ALTER TABLE Employee ALTER COLUMN CityBorn SET DEFAULT 'SANDNES'\n</code></pre>\n\n<p>The error is:</p>\n\n<blockquote>\n  <p>Incorrect syntax near the keyword 'SET'.</p>\n</blockquote>\n\n<p>What am I doing wrong?</p>\n"},{"tags":["sql-server","sql-server-2008","tsql","math","arithmetic-expressions"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":51,"score":3,"question_id":12925148,"title":"In T-SQL how can I get a column of 2-decimal points(or percentages)?","body":"<p>In SQL Server 2008, I am running a report where I need to divide two columns (called <code>Completes</code> and <code>Prescreens</code>, whole integers), and then I go to Excel and get the <code>Prescreens</code> divided by the <code>Completes</code>, and turn that into a number with 2 decimal places, then convert that to a percentage. i.e. -> 0.34, then becomes 34%.</p>\n\n<p>In SQL in know I probably can't get the output as \"34%\" but at least I'd like it as 0.34 .  So far I have:</p>\n\n<pre><code>cast((sq.Completes/sq.Screens ) as float ) as 'conv'\n</code></pre>\n\n<p>Completes are the smaller of numbers(usually 27, 38, etc), and Screens are bigger numbers(124, 276, etc.)</p>\n\n<p>But this is outputting my column as all <code>0s</code> . How do I make it show 0.34 , 0.84, etc</p>\n"},{"tags":["sql-server","sql-server-2008","where-clause"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":60,"score":1,"question_id":12936993,"title":"SQL Server and intermediate materialization?","body":"<p><em>After reading <a href=\"http://sqlblog.com/blogs/adam_machanic/archive/2006/10/03/exploring-the-secrets-of-intermediate-materialization.aspx\" rel=\"nofollow\">this interesting article</a> about intermediate materialization - I still have some questions.</em> </p>\n\n<p>I have this query : </p>\n\n<pre><code>SELECT    *\nFROM  ...\nWHERE       isnumeric(MyCol)=1  and ( CAST( MyCol AS int)&gt;1) \n</code></pre>\n\n<p>However, the where clause order is <strong>not</strong> deterministic.</p>\n\n<p>So I <em>might</em> get exception here.( if he first tries to cast <code>\"k1k1\"</code> )</p>\n\n<p>I assume this will solve the problem</p>\n\n<pre><code>SELECT MyCol \nFROM\n    (SELECT TOP 100 PERCENT foo From MyTable WHERE ISNUMERIC (MyCol ) &gt; 1 ORDER BY MyCol ) bar\nWHERE\n    CAST(MyCol AS int) &gt; 100\n</code></pre>\n\n<ul>\n<li>why does putting <code>top 100 + order</code> will change VS my regular query ?</li>\n</ul>\n\n<p>I read in the comments  : </p>\n\n<blockquote>\n  <p>(the \"intermediate\" result -- in other words, a result obtained during\n  the process, that will be used to calculate the final result) will be\n  physically stored (\"materialized\") in TempDB and used from there for\n  the remainder of the user, instead of being queried back from the base\n  tables.</p>\n</blockquote>\n\n<ul>\n<li>what difference does it makes if it is stored in tempDB or queried back from the base tables? it is the <strong>same data</strong> !</li>\n</ul>\n"},{"tags":["database","sql-server-2008","reporting-services"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":25,"score":0,"question_id":12937301,"title":"SQL Server 2008 - DB monitoring requirement , what is the best way to do it","body":"<p>I have a monitoring requirement where I need to keep checking table data every hour and if it reaches certain counts higher then previous hour, I need to notify certain users. I also need to create some kind of user interface so that user can track counts according to day/weekly too .</p>\n\n<p>I am developer and don't know much about DB except basic use like writing stored procedure / creating table etc. and I searched on internet and found so many options but don't know what will be the best option to go through and if it will fulfill my purpose. </p>\n\n<p>First one is to use SQL Server Reporting Services Enterprise edition. I am not sure if there is a way to compare data from previous one, write logic in it and send email notification in this.</p>\n\n<p>Second one is to write trigger on table and write logic in stored procedure and fire this trigger with stored procedure logic if its possible. And trigger will send email. But then I need to create some kind of interface in application level .</p>\n\n<p>Can someone please help if there is any other better way to do this or what is the best approach in between these two.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":71,"score":0,"question_id":12926957,"title":"Ambiguous column name error in order by clause","body":"<p>Why doesn't this query work?</p>\n\n<pre><code>SELECT ROW_NUMBER() OVER (\n        ORDER BY DocumentID\n        ) peta_rn\n    , d.DocumentID\n    , d.IsReEfiled\n    , d.IGroupID\n    , d.ITypeID\n    , d.RecordingDateTime\n    , dbo.GetLatestStatusDateTime(d.DocumentID) AS LatestStatusDatetime\n    , dbo.FnCanChangeDocumentStatus(d.DocumentStatusID, d.DocumentID) AS CanChangeStatus\n    , d.IDate\n    , d.InstrumentID\n    , d.DocumentStatusID\n    , ig.Abbreviation AS IGroupAbbreviation\n    , u.Username\n    , j.JDAbbreviation\n    , inf.DocumentName\n    , it.Abbreviation AS ITypeAbbreviation\n    , d.DocumentDate\n    , ds.Abbreviation AS DocumentStatusAbbreviation\n    , dbo.GetFlatDocumentName(d.DocumentID) AS FlatDocumentName\nFROM Documents d\nINNER JOIN IGroupes ig\n    ON d.IGroupID = ig.IGroupID\nLEFT JOIN ITypes it\n    ON d.ITypeID = it.ITypeID\nLEFT JOIN Users u\n    ON u.UserID = d.UserID\nLEFT JOIN DocumentStatuses ds\n    ON d.DocumentStatusID = ds.DocumentStatusID\nLEFT JOIN InstrumentFiles inf\n    ON d.DocumentID = inf.DocumentID\nINNER JOIN Jurisdictions j\n    ON j.JurisdictionID = d.JurisdictionID\nWHERE 1 = 1\n</code></pre>\n\n<p>whereas this one works:</p>\n\n<pre><code>SELECT ROW_NUMBER() OVER (\n        ORDER BY d.DocumentID\n        ) peta_rn\n    , d.DocumentID\n    , d.IsReEfiled\n    , d.IGroupID\n    , d.ITypeID\n    , d.RecordingDateTime\n    , dbo.GetLatestStatusDateTime(d.DocumentID) AS LatestStatusDatetime\n    , dbo.FnCanChangeDocumentStatus(d.DocumentStatusID, d.DocumentID) AS CanChangeStatus\n    , d.IDate\n    , d.InstrumentID\n    , d.DocumentStatusID\n    , ig.Abbreviation AS IGroupAbbreviation\n    , u.Username\n    , j.JDAbbreviation\n    , inf.DocumentName\n    , it.Abbreviation AS ITypeAbbreviation\n    , d.DocumentDate\n    , ds.Abbreviation AS DocumentStatusAbbreviation\n    , dbo.GetFlatDocumentName(d.DocumentID) AS FlatDocumentName\nFROM Documents d\nINNER JOIN IGroupes ig\n    ON d.IGroupID = ig.IGroupID\nLEFT JOIN ITypes it\n    ON d.ITypeID = it.ITypeID\nLEFT JOIN Users u\n    ON u.UserID = d.UserID\nLEFT JOIN DocumentStatuses ds\n    ON d.DocumentStatusID = ds.DocumentStatusID\nLEFT JOIN InstrumentFiles inf\n    ON d.DocumentID = inf.DocumentID\nINNER JOIN Jurisdictions j\n    ON j.JurisdictionID = d.JurisdictionID\nWHERE 1 = 1\n</code></pre>\n\n<p>As you can see the only difference is I specify d.DocumentID. Is there anyway I can avoid having to specify <code>d.DocumentID</code> and instead specify only <code>DocumentID</code> without using an extra Select?  because after all, all documentID refer to the same value.</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":52,"score":1,"question_id":12934584,"title":"Error when creating stored procedure","body":"<p>I'm noob at stored procedures, I have created a stored procedure that take some parameters from C# page, then send back result as <code>OUTPUT</code> parameter.</p>\n\n<p>I need to do some calculation to get end date, so I end up using a lot of IF statements. However, when I create the stored procedure I get error that I didn't know how to solve, every thing seems correct!.</p>\n\n<p>Here is the stored procedure code:</p>\n\n<pre><code>    CREATE PROCEDURE sp_RenewSubscription \n        -- Add the parameters for the stored procedure here\n        @Reference nvarchar(100),\n        @SubscribtionID nvarchar(100),\n        @Months int,\n        @Result nvarchar(200) OUTPUT\n    AS\n\nBEGIN\n    -- SET NOCOUNT ON added to prevent extra result sets from\n    -- interfering with SELECT statements.\n    SET NOCOUNT ON;\n\n    DECLARE @EndDate as nvarchar;\n    DECLARE @MonthCounts as int;\n\n    IF NOT EXISTS(SELECT [Reference] FROM [Norton].[dbo].[SubscriptionStatus] WHERE [Reference] = @Reference)\n    SET @Result = '0: Reference ID not found'\n    ELSE\n    IF NOT EXISTS(SELECT [Reference] FROM [Norton].[dbo].[SubscriptionStatus] WHERE [Reference] = @Reference AND [SubscribtionID] = @SubscribtionID)\n    SET @Result = '0: Subscribtion ID not found'\n    ELSE\n    BEGIN \n        SELECT TOP 1 @EndDate = [EndDate], @MonthCounts = [SubscriptionMonthCount] FROM [Norton].[dbo].[SubscriptionStatus] WHERE [Reference] = @Reference AND [SubscribtionID] = @SubscribtionID\n        IF @EndDate = '0'\n        BEGIN \n        UPDATE [Norton].[dbo].[SubscriptionStatus]\n        SET [SubscriptionMonthCount] = @Months + @MonthCounts\n        WHERE [Reference] = @Reference AND [SubscribtionID] = @SubscribtionID\n        END\n        ELSE\n        BEGIN \n        UPDATE [Norton].[dbo].[SubscriptionStatus]\n        SET [SubscriptionMonthCount] = @Months\n        WHERE [Reference] = @Reference AND [SubscribtionID] = @SubscribtionID\n        END\n\n    SET @Result = '1: Done Successfully'\n    END\nGO\n\nEND\nGO\n</code></pre>\n\n<p>This is error I got:</p>\n\n<blockquote>\n  <p>Msg 102, Level 15, State 1, Procedure sp_RenewSubscription, Line 44<br>\n  Incorrect syntax near 'END'.<br>\n  Msg 102, Level 15, State 1, Line 2<br>\n  Incorrect syntax near 'END'.*</p>\n</blockquote>\n\n<p>Thanks,</p>\n"},{"tags":["sql-server-2008","ssis","tempdb"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":57,"score":0,"question_id":12933056,"title":"Tempdb filling up","body":"<p>The BI project I'm currently working on receives it's data from a complex processes based in SPs that use (too) many temp tables.  This is something we do not have control over (or I would've changed it).<br>\nOur part in this project is mainly based on SSIS.  </p>\n\n<p>The processes run fine but the tempdb fills up relatively fast and then we start getting errors.</p>\n\n<p>I'm looking for 2 things:</p>\n\n<ol>\n<li>How to prevent the tempdb from \"overflowing\" (or at least slow it down)?</li>\n<li>How to clean up the tempdb when it does overflow? (preferably using SSIS)</li>\n</ol>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":6,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":60,"score":2,"question_id":12935500,"title":"How go group same kind rows in sql","body":"<p>I have a table like:</p>\n\n<pre><code>    Table1\n---------------------\nId |Kind1|Kind2|Kind3|\n---------------------\n1  |  2  |  2  |  3  | *\n---------------------\n2  |  2  |  2  |  2  | +\n---------------------\n3  |  2  |  2  |  1  |\n---------------------\n4  |  2  |  2  |  3  | *\n---------------------\n5  |  2  |  1  |  1  |\n---------------------\n6  |  1  |  1  |  1  |\n---------------------\n7  |  2  |  2  |  2  | +\n----------------------\n</code></pre>\n\n<p>And I want to get that result as shown below Id's have to generate automaticaly\nI have to get count of same row group</p>\n\n<pre><code>Result\n------------------------------\nId |  Count |New1 |New2 |New3 |\n------------------------------\n1  |    2   |  2  |  2  |  2  | \n------------------------------\n2  |    2   |  2  |  2  |  3  |\n------------------------------\n3  |    1   |  2  |  2  |  1  |\n------------------------------\n4  |    1   |  2  |  1  |  1  |\n------------------------------\n5  |    1   |  1  |  1  |  1  |\n------------------------------\n</code></pre>\n\n<p>How can I do that in sql server?</p>\n"},{"tags":["sql","sql-server-2008","reporting-services","ssrs-2008","sql-compare"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":98,"score":0,"question_id":12923611,"title":"SQL Server 2008: If Multiple Values Set In Other Mutliple Values Set","body":"<p>In SQL, is there anyway to accomplish something like this? This is based off a report built in SQL Server Report Builder, where the user can specify multiple text values as a single report parameter. The query for the report grabs all of the values the user selected and stores them in a single variable. I need a way for the query to return only records that have associations to EVERY value the user specified.</p>\n\n<pre><code>-- Assume there's a table of Elements with thousands of entries.  \n-- Now we declare a list of properties for those Elements to be associated with.\n\ncreate table #masterTable (\n    ElementId int, Text varchar(10)\n)\n\ninsert into #masterTable (ElementId, Text) values (1, 'Red');\ninsert into #masterTable (ElementId, Text) values (1, 'Coarse');\ninsert into #masterTable (ElementId, Text) values (1, 'Dense');\ninsert into #masterTable (ElementId, Text) values (2, 'Red');\ninsert into #masterTable (ElementId, Text) values (2, 'Smooth');\ninsert into #masterTable (ElementId, Text) values (2, 'Hollow');\n\n-- Element 1 is Red, Coarse, and Dense.  Element 2 is Red, Smooth, and Hollow.  \n-- The real table is actually much much larger than this; this is just an example.\n\n-- This is me trying to replicate how SQL Server Report Builder treats \n-- report parameters in its queries.  The user selects one, some, all, \n-- or no properties from a list. The written query treats the user's   \n-- selections as a single variable called @Properties.\n-- Example scenario 1: User only wants to see Elements that are BOTH Red and Dense.\nselect e.* \nfrom Elements e \nwhere (@Properties) --ideally a set containing only Red and Dense\nin\n(select Text from #masterTable where ElementId = e.Id) --ideally a set containing only Red, Coarse, and Dense\n--Both Red and Dense are within Element 1's properties (Red, Coarse, Dense), so Element 1 gets returned, but not Element 2.\n\n-- Example scenario 2: User only wants to see Elements that are BOTH Red and Hollow.  \nselect e.* from Elements e where\n(@Properties) --ideally a set containing only Red and Hollow\nin\n(select Text from #masterTable where ElementId = e.Id)\n--Both Red and Hollow are within Element 2's properties (Red, Smooth, Hollow), so Element 2 gets returned, but not Element 1.\n\n\n--Example Scenario 3: User only picked the Red option.\nselect e.* from Elements e where\n(@Properties) --ideally a set containing only Red\nin\n(select Text from #masterTable where ElementId = e.Id)\n--Red is within both Element 1 and Element 2's properties, so both Element 1 and Element 2 get returned.\n</code></pre>\n\n<p>The above syntax doesn't actually work because SQL doesn't seem to allow multiple values on the left side of the \"in\" comparison.  Error that returns:</p>\n\n<pre><code>Subquery returned more than 1 value. This is not permitted when the subquery follows =, !=, &lt;, &lt;= , &gt;, &gt;= or when the subquery is used as an expression.\n</code></pre>\n\n<p>Am I even on the right track here?  Sorry if the example looks long-winded or confusing.</p>\n\n<p>Here's the exact code I'm working with:</p>\n\n<pre><code>select p.*\nfrom Products p\nwhere\n(\n    (\n        --user can search through gloves, bats, or both\n        p.TypeId = 2 and 'Bat' in (@ProductTypes) \n        and \n        (\n            (\n                (@BatProperties) COLLATE DATABASE_DEFAULT in \n                (\n                    select props.Name from PropertyTypes props\n                    inner join ProductProperties pp on props.Id = pp.TypeId\n                    where pp.ProductId = p.Id\n                )\n            --still want query to run when no properties are selected\n            ) or not exists(select * from @BatProperties)\n        )\n    )\n    or\n    (\n        p.TypeId = 1 and 'Glove' in (@ProductTypes) --user can search through gloves, bats, or both\n        and\n        (\n            (\n                (@GloveProperties) COLLATE DATABASE_DEFAULT in \n                (\n                    select props.Name from PropertyTypes props\n                    inner join ProductProperties pp on props.Id = pp.TypeId\n                    where pp.ProductId = p.Id\n                )\n            --still want query to run when no properties are selected\n            ) or not exists(select * from @GloveProperties)\n        )\n    )\n)\n</code></pre>\n"},{"tags":["sql-server-2008","sql-server-2012-express"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":1,"view_count":32,"score":2,"question_id":12933173,"title":"Moving database files created by SQL Server 2012 Express to SQL Standard 2008","body":"<p>I am planing to built database driven website with DotNetNuke and SQL Server Express 2012 on my laptop and than host it on web server that has SQL Server 2008 Standard edition. </p>\n\n<p>Is SQL Server 2008 compatible with database files created by Server 2012? </p>\n\n<p>Because I can install and build website using SQL Server 2008 Express Edition and upload to hosting provider server.</p>\n"},{"tags":["sql","sql-server-2008","query","sorting"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12933514,"title":"Sorting table data issue","body":"<p>I've quite bulky data in a Database table and I want to sort the data based on their ID (Primary Key). The data in the key column could be:</p>\n\n<pre><code>001/2011,\n002/2011,\n001/2012\n</code></pre>\n\n<p>When I use '<code>order by id</code>' it sorts the rows like</p>\n\n<pre><code>001/2011,\n001/2012,\n002/2011\n</code></pre>\n\n<p>However, what I am looking for is </p>\n\n<pre><code>001/2011,\n002/2011,\n001/2012\n</code></pre>\n\n<p>The data type of the id column is <code>varchar(50)</code>. Is there a special SQL function that I should use to sort such type of data?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":115,"score":0,"question_id":9523413,"title":"Trigger nesting level exceeded?","body":"<p>When this trigger fires, which is contained in the below code block</p>\n\n<pre><code>alter TRIGGER [dbo].[locations_update_geometry_After]\nON  dbo.TBL_LOCATIONS   \nfor update   \nAS   \n  INSERT dbo.TBL_LOCATIONS(SHAPE, X_Coord, Y_Coord,objectid) \n  SELECT a.Shape, a.X_Coord, a.Y_Coord, a.objectid\n  FROM  \n  (  \n    SELECT  \n      SHAPE = CASE WHEN SHAPE IS NOT NULL   \n        THEN SHAPE ELSE Geometry::STPointFromText('POINT('  \n          + CAST(X_Coord AS VARCHAR(20)) + ' '   \n          + CAST(Y_Coord AS VARCHAR(20)) + ')', 26917) END,  \n      X_Coord = CASE WHEN SHAPE IS NULL THEN X_Coord ELSE SHAPE.STX END,  \n      Y_Coord = CASE WHEN SHAPE IS NULL THEN Y_Coord ELSE SHAPE.STY END,  \n      objectid  \n     FROM inserted  \n  ) AS a\n</code></pre>\n\n<p>I get the following error message:</p>\n\n<blockquote>\n  <p>Unable to save edits. Underlying DBMS error [Microsoft SQL Server\n  Native Client 10: Maximum stored procedure, function, trigger, or view\n  nesting level exceeded (limit 32).</p>\n</blockquote>\n\n<p>I do not have 32 of anything associated with this table. any ideas?</p>\n"},{"tags":["sql-server-2008","login-control"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":3443,"score":4,"question_id":4085700,"title":"Restrict SQL Server Login access to only one database","body":"<p>I have a SQL Server server which has around 50 databases on it. I wish to create a new Login for a client who wishes to have access to their database. But I don't want to give them access to the other ~49 databases.</p>\n\n<p>How can I do this?</p>\n\n<p>Cheers.</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":36,"score":1,"question_id":12933108,"title":"Retrieving data by date ranges with breaks in SQL Server","body":"<p>I need to retrieve data by selected dates. There is one major detail: user can select two days one after another, and then it can skip some days, and then select another ones.</p>\n\n<p>What is the best way to pass selected dates into a stored procedure and organize filter by such date ranges?</p>\n\n<p>For example, I have the table with the following structure:</p>\n\n<pre><code>CREATE TABLE [dbo].[Events](\n    [ID] [int] IDENTITY(1,1) NOT NULL,\n    [EventDate] [datetime] NOT NULL,\n    [Amount] [float] NOT NULL,\n CONSTRAINT [PK_Events] PRIMARY KEY CLUSTERED \n(\n    [ID] ASC\n)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]\n) ON [PRIMARY]\n</code></pre>\n\n<p>With the following data:</p>\n\n<pre><code>INSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-01-01 10:00', 12)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-01-01 11:00', 154)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-01-01 12:00', 4)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-02-01 10:00', 132)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-02-01 11:00', 212)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-03-01 10:00', 712)\nINSERT [dbo].[Events] ([EventDate], [Amount]) VALUES ('2012-03-01 20:00', 892)\n</code></pre>\n\n<p>User wants to retrieve data with Event Date from 2012-01-01 10:00 and 2012-01-01 11:00,\nfrom 2012-03-01 09:00 to 2012-03-01 19:00, etc.</p>\n\n<p>User can select different count of intervals.</p>\n"},{"tags":["sql-server-2008","triggers"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12933348,"title":"How to alter inserted row in sql server trigger","body":"<p>This gave an error </p>\n\n<blockquote>\n  <p>Msg 156, Level 15, State 1, Procedure Trig_Insert_Serials_Null, Line 30<br>\n  Incorrect syntax near the keyword 'INSERT'.</p>\n</blockquote>\n\n<p>Table structure: </p>\n\n<pre><code>Serials (CurrencyId, DivisionId, BranchId, NewSerialNumber, Display, TypeId)\n</code></pre>\n\n<p>I want to change 0 to null in (<code>CurrencyId, DivisionId, BranchId</code>).  </p>\n\n<pre><code>CREATE TRIGGER Trig_Insert_Serials_Null\n   ON  Serials\n   INSTEAD OF INSERT   \nAS \nBEGIN\n\nDECLARE @currencyId int;\nDECLARE @branchId int;\nDECLARE @divisionId int;\n\nSELECT @currencyId = INSERTED.CurrenceyId FROM INSERTED;\nSELECT @branchId = INSERTED.BranchId FROM INSERTED;\nSELECT @divisionId = INSERTED.DivisionId FROM INSERTED;\n\nIF @currencyId = 0 \n    SET @currencyId = NULL;\nEND\n\nIF @branchId = 0 \n    SET @branchId = NULL;\nEND\n\nIF @divisionId = 0 \n    SET @divisionId = NULL;\nEND\n\n\nINSERT INTO Serials (CurrenceyId,DivisionId,BranchId,NewSerialNumber,\n                         Display, TypeId)\nVALUES (INSERTED.CurrenceyId,INSERTED.DivisionId, INSERTED.BranchId,\n         INSERTED.NewSerialNumber, INSERTED.Display,INSERTED.TypeId)\n\nEND\nGO\n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":2141,"score":1,"question_id":5025388,"title":"SQL problem with error \"Invalid data type\"","body":"<p>Using SQL 2008</p>\n\n<p>So I created a User Defined type:</p>\n\n<pre><code>CREATE TYPE dbo.ServiceType AS TABLE (\n[TO_ZONE] varchar(30) NOT NULL,\n[FROM_ZONE] varchar(30) NOT NULL,\n[RATE] decimal(14,2) NOT NULL,\n[SERVICE_TYPE] varchar(255) NOT NULL\n);\n</code></pre>\n\n<p>And when I try to use it I get the error \"parameter or variable @variableName has an invalid data type\"</p>\n\n<pre><code>ALTER PROCEDURE [dbo].[ImportServiceTypeRates]\n\n(@ServiceTypes dbo.ServiceType)  --I have tried it without the \"dbo.\" as well\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>So I added \"READONLY\" to my variable declaration</p>\n\n<pre><code>@ServiceTypes dbo.ServiceType READONLY\n</code></pre>\n\n<p>And I now get the error \"The parameter @Servicetype cannot be declared READONLY because it is not a table-valued parameter\"  ?WHAT?  </p>\n\n<p>I thought the \"CREATE TYPE ServiceType as TABLE\" was what declared it such???</p>\n\n<p>I also have showing in Types\\User-Defined Table Types\\dbo.ServiceType</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":62,"score":2,"question_id":12931421,"title":"Find the closest number based on the weight of combination for two pairs","body":"<p>This is a continuation of my previous question <a href=\"http://stackoverflow.com/questions/12928718/what-is-the-efficient-way-to-generate-combination-of-items-in-sql-server\">What is the efficient way to generate combination of items in SQL Server?</a> Let me explain the real scenario as what I am looking for and why....</p>\n\n<p>Suppose I have a table as under</p>\n\n<pre><code>Declare @t table(Number Int)\nInsert Into @t Values(10),(20),(30),(40),(18)\n\nNumber\n10\n20\n30\n40\n18\n</code></pre>\n\n<p>and I need to look for a number say 35 (or closest).</p>\n\n<pre><code>Declare @NumberToLookfor = 35\n</code></pre>\n\n<p>Now the search will happen based on the weight of combination for two pairs. Let me explain.</p>\n\n<pre><code>10+20 = 30\n\n10+30 = 40\n\n10+40 = 50\n\n10+18 = 28\n\n20 + 30 = 50\n\n20 + 40 = 60\n\n20 + 18 = 38\n\n30 + 40 = 70\n\n30 + 18 = 48\n\n40 + 18 = 58\n</code></pre>\n\n<p>so we can figure out that the weight of any two numbers are teh candidates here e.g. (10,20), (10,30)...(40,18)</p>\n\n<p>Once we get that, the first 3 closest pairs will be (20,18), (10,20) , (10,30) in this case. Because teh dirtance between 35 and 38 (20+18) is 3 whichle it is 5 for the other pairs  (10,20) , (10,30).</p>\n\n<p>I think that the explanation is clear to understand what I am looking for.(If not please let me know)</p>\n\n<p>What is the most efficient way of doing so?</p>\n\n<p>My attempt</p>\n\n<pre><code>Declare @t table(Number Int)\nInsert Into @t Values(10),(20),(30),(40),(18)\n\n;WITH Cte1 (Number,Ids,TotalWeight) AS \n( \n    SELECT  Number           \n            , ',' + CAST(Number AS VARCHAR(MAX)) \n            ,CAST(Number AS INT) \n    FROM @t \n    UNION ALL \n    SELECT  p.Number \n            ,c.Ids + ',' +  CAST(p.Number AS VARCHAR(MAX)) \n            ,CAST(c.TotalWeight + p.Number AS INT)            \n    FROM @t AS p JOIN Cte1 c ON p.Number &lt; c.Number\n),Cte2 AS( \n    SELECT          \n        *\n        ,DENSE_RANK() OVER(ORDER BY ABS(TotalWeight - 35)) [rank] \n    FROM Cte1 \n    WHERE (LEN(Ids) - LEN(REPLACE(Ids, ',', '')))/LEN(',') = 2 \n)\n\nselect *\nfrom Cte2 where [rank] &lt;= 2\n</code></pre>\n\n<p>It works.</p>\n\n<p><img src=\"http://i.stack.imgur.com/SIrU6.png\" alt=\"enter image description here\"></p>\n\n<p>But if the values grows very big say more than 50 or so, then it becomes very very in efficient. Because in the first CTE , I am finding out the full permutation and in the second Cte choosing those values where only two elements participated.</p>\n\n<p>so when the value grows big, the first Cte behaves very very slowly.</p>\n\n<p>Is there any other way of doing so even for big tables.</p>\n\n<p>DDL provided</p>\n\n<pre><code>Declare @t table(Number Int)\nInsert Into @t Values  \n(1),(2),(3),(4),(5),(6),(7),(8),(9),(10),(11),(12),(13),(14),(15),(16),(17),(18),(19),(20), \n(21),(22),(23),(24),(25),(26),(27),(28),(29),(30),(31),(32),(33),(34),(35),(36),(37),(38),(39),(40), \n(41),(42),(43),(44),(45),(46),(47),(48),(49),(50),(51),(52),(53),(54),(55),(56),(57),(58),(59),(60), \n(61),(62),(63),(64),(65),(66),(67),(68),(69),(70),(71),(72),(73),(74),(75),(76),(77),(78),(79),(80), \n(81),(82),(83),(84),(85),(86),(87),(88),(89),(90),(91),(92),(93),(94),(95),(96),(97),(98),(99),(100) \n</code></pre>\n\n<p>Many thanks in advance</p>\n"},{"tags":["sql","sql-server-2008","distinct"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12931399,"title":"Select distinct on one column","body":"<p>Here is my query:</p>\n\n<pre><code>SELECT DISTINCT TOP 500 \nbk.firstname,\nbk.surname,\nbk.email,\ncounty.region_id,\ninspection.inspection_date\n\nFROM\nbken bk\nLEFT OUTER JOIN county\n  ON bk.county = county.code\nLEFT OUTER JOIN inspection\n  ON bk.inspid = inspection.inspid\n\nWHERE\nbk.firstname IS NOT NULL\nAND bk.surname IS NOT NULL\nAND bk.email IS NOT NULL\nAND county.region_id IS NOT NULL\nAND  county.region_id &lt;&gt; 10  \nAND inspection_date &gt; '04/01/2012 00:00:00.000'\nAND inspection_date &lt; '10/01/2012 00:00:00.000'\n</code></pre>\n\n<p>My goal is to obtain a sample of 500 different people.</p>\n\n<p>Unfortunately this returns duplicate names (though the inspection dates are different) so I am trying to select distinct surnames to see if this will fix my problem. Can anyone help me do this? </p>\n\n<p>I'm using Microsoft SQL Server 2008.</p>\n"},{"tags":["asp.net","sql-server-2008","select","reporting-services"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":29,"score":-1,"question_id":12931107,"title":"Select query to fetch configurations value in reporting services and database engine services","body":"<p>In Reporting Services </p>\n\n<p>I need a select query to fetch the values of </p>\n\n<p>\"Web service requests and HTTP access\",\n\"Scheduled events and report delivery\",\n\"Windows Integrated Security\".</p>\n\n<hr>\n\n<p>In Database Engine services\nand  i need to fetch the value of \n\"Native XML Web services\".</p>\n"},{"tags":["c#",".net","sql-server-2008","datetime","asp.net-mvc-4"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":87,"score":1,"question_id":12930418,"title":"Datetime field automatically converted to local (Can't Edit)","body":"<p>I'm trying to use <a href=\"http://www.asp.net/mvc/tutorials/mvc-4/getting-started-with-aspnet-mvc4/examining-the-edit-methods-and-edit-view\" rel=\"nofollow\">this tutorial</a> to learn a bit more about MvC4 but I'm having some problems with that <code>Datetime</code> field.</p>\n\n<p><strong>First Problem</strong>:<br>\nWhen I try to create an entry with a <code>datetime</code> in this format: <code>DD/MM/YYYY</code> (e.g. <code>20/06/2012</code>), I get an error: </p>\n\n<blockquote>\n  <p><em>The field ReleaseDate must be a date</em></p>\n</blockquote>\n\n<p>So I'm guessing it needs to be in this format (which is default in general): <code>MM/DD/YYYY</code> (e.g. <code>06/20/2012</code>). </p>\n\n<p>When I use the second format, I get a message:  </p>\n\n<blockquote>\n  <p><em>The value '06/20/2012' is not valid for ReleaseDate.</em></p>\n</blockquote>\n\n<p>The only way I can get it to work is when I enter both month and day &lt;= 12. e.g. <code>12/12/2012</code>.</p>\n\n<p><strong>Second Problem</strong>:<br>\nThis one is about the time. Let's say I enter <code>12/12/2012</code> and I get to successfully create an entry. By default it chooses <code>12:00:00 pm</code> as timestamp. The thing is that instead of pm it enters  (which is pm in Greek since clock in my pc is in Greek)</p>\n\n<p>When I try to edit the entry I get an error because of that. If I change  to pm it accepts it. But its weird and kinda annoying to get an error from a valid entry without changing anything.</p>\n\n<p><strong>Third Problem (Bonus)</strong>:<br>\nI have a field that is a number. I enter for example <code>199</code> and it accepts it. But in my list it shows it as <code>199,00</code>. When I try to edit again and I click save, I get this error: </p>\n\n<blockquote>\n  <p><em>The field Price must be a number.</em></p>\n</blockquote>\n\n<p>If I delete the comma and the 00 it accepts it again..</p>\n\n<p>As you can see its a very problematic table :) Any answers helping me out in any of my problems would be more than welcome. </p>\n\n<p>Ideally I would like the datetime in this format: <code>DD/MM/YYYY hh:mm:ss</code> (without pm and am 24 hours)</p>\n\n<p>But I will be happy for now if I can at least edit and save without the errors :)</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":20,"score":0,"question_id":12930547,"title":"Migration of japanese data to Oracle","body":"<p>I am into data migration team, right now we got a project of Japanese database migration. We need to migrate all japanese data to our Oracle database. After which we need to compare Japanese data between source and target database. I just want to know is it possible to write normal SQL queries for Japanese data in SQL server, will it work and What are the risks associated with this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":52,"score":0,"question_id":12929302,"title":"Any way to speed up this CTE?","body":"<p>This query is taking 5 seconds:</p>\n\n<pre><code>With cte as \n(\n    Select  ROW_NUMBER() OVER (Order By dbo.GetLatestStatusDateTime(d.DocumentID)) peta_rn, d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime,\n        d.IDate, d.InstrumentID, d.DocumentStatusID, u.Username, j.JDAbbreviation, inf.DocumentName,  dbo.GetLatestStatusDateTime(d.DocumentID) as LatestStatusDatetime,\n        it.Abbreviation as ITypeAbbreviation, d.DocumentDate, ds.Abbreviation as DocumentStatusAbbreviation \n                From Documents d Left Join IGroupes ig On d.IGroupID = ig.IGroupID \n                Left Join ITypes it On d.ITypeID = it.ITypeID \n                Left Join Users u On u.UserID = d.UserID \n                Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID \n                Left Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID Where 1 = 1  And d.JurisdictionID = 1\n)\nSelect  * from cte\n                Where 1 = 1 \n                And peta_rn&gt;92000 AND peta_rn&lt;=92100\n</code></pre>\n\n<p>Though this is a static query, it will be dynamic in the sense that <code>Order By</code> in <code>Row_Number()</code> would be based on what user selects. Eg. currently it is <code>dbo.GetLatestStatusDateTime(d.DocumentID)</code> but it can be anything else too. Hence this query would be generated in code using if and then. Anyways, can you spot any mistake in my query? Why would it take 5 seconds for mere 100 records? I have seen SQL server scale upto millions of records and this is just 1/10th of million and I am suffering from bottleneck :(</p>\n\n<p><strong>Edit: Massive improvement</strong></p>\n\n<p>Changing the query to this:</p>\n\n<pre><code>With cte as \n(\n\n        Select  ROW_NUMBER() OVER (Order By d.DocumentID) peta_rn, d.DocumentID\n                From Documents d Left Join IGroupes ig On d.IGroupID = ig.IGroupID \n                Left Join ITypes it On d.ITypeID = it.ITypeID \n                Left Join Users u On u.UserID = d.UserID \n                Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID \n                Left Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID Where 1 = 1  And d.JurisdictionID = 1\n)\nSelect  d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime,\n        d.IDate, d.InstrumentID, d.DocumentStatusID, u.Username, j.JDAbbreviation, inf.DocumentName, \n        it.Abbreviation as ITypeAbbreviation, d.DocumentDate, ds.Abbreviation as DocumentStatusAbbreviation \n                From Documents d Left Join IGroupes ig On d.IGroupID = ig.IGroupID \n                Left Join ITypes it On d.ITypeID = it.ITypeID \n                Left Join Users u On u.UserID = d.UserID \n                Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID \n                Left Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID\n                Inner Join cte On cte.DocumentID = d.DocumentID\n                And peta_rn&gt;92000 AND peta_rn&lt;=92100\n</code></pre>\n\n<p>executes the query in 1 second. But I still feel 1 second is too big just for 100 records. Any other optimizations please?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":71,"score":1,"question_id":12928157,"title":"SQL query taking more than 3 minutes to get only 100 records","body":"<p>Can anybody please tell why would this query take minutes to execute?</p>\n\n<pre><code>Select  \n   d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime, \n   d.IDate, d.InstrumentID, d.DocumentStatusID,ig.Abbreviation as IGroupAbbreviation, \n   u.Username, j.JDAbbreviation, inf.DocumentName,\n   it.Abbreviation as ITypeAbbreviation, d.DocumentDate, \n   ds.Abbreviation as DocumentStatusAbbreviation \nFrom Documents d \nInner Join IGroupes ig On d.IGroupID = ig.IGroupID \nLeft Join ITypes it On d.ITypeID = it.ITypeID \nLeft Join Users u On u.UserID = d.UserID \nLeft Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \nLeft Join InstrumentFiles inf On d.DocumentID = inf.DocumentID                         \nInner Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID \nWhere \n    d.DocumentID IN\n      (SELECT DocumentID \n       FROM (SELECT ROW_NUMBER() OVER (Order By DocumentID desc) peta_rn, peta_query.* \n             From (Select d.DocumentID\n                   From Documents d) as peta_query) peta_paged \n       WHERE peta_rn &gt; 92000 AND peta_rn &lt;= 92100)\n</code></pre>\n\n<p>The subquery:</p>\n\n<pre><code>SELECT DocumentID \nFROM (SELECT \n         ROW_NUMBER() OVER (Order By DocumentID desc) peta_rn, peta_query.* \n      FROM\n         (SELECT d.DocumentID\n          FROM Documents d) as peta_query) peta_paged \nWHERE peta_rn &gt; 92000 AND peta_rn &lt;= 92100\n</code></pre>\n\n<p>itself takes 0 seconds but the whole query takes minutes and I don't even have that many Joins. It's hardly 6-7 joins which shouldn't create so much problems in my opinion as these all foreign keys have indexes on them. Can anybody suggest what could be the problem?</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>This is awesome. See this query which executes in 0 seconds:</p>\n\n<pre><code>Select  d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime, \n        d.IDate, d.InstrumentID, d.DocumentStatusID, u.Username, j.JDAbbreviation, inf.DocumentName,\n        it.Abbreviation as ITypeAbbreviation, d.DocumentDate, ds.Abbreviation as DocumentStatusAbbreviation \n            From Documents d \n                Inner Join IGroupes ig On d.IGroupID = ig.IGroupID \n                Left Join ITypes it On d.ITypeID = it.ITypeID \n                Left Join Users u On u.UserID = d.UserID  \n                Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID                         \n                Inner Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID \n                    Where d.DocumentID IN\n                        (\n                            SELECT DocumentID FROM (SELECT \n                                ROW_NUMBER() OVER (Order By DocumentID desc) peta_rn, peta_query.* From \n                                (\n                                        Select   d.DocumentID\n                                                From Documents d \n\n                                ) as peta_query) peta_paged WHERE peta_rn&gt;92000 AND peta_rn&lt;=92100\n                        )\n</code></pre>\n\n<p>As you can see it just removes <code>ig.Abbreviation IGroupAbbreviation,</code> from the query. As soon as I put <code>ig.Abbreviation IGroupAbbreviation,</code> it starts taking minutes. Isn't this the heights of ridiculousness? What do you think would cause this?</p>\n\n<p><strong>Edit 2:</strong></p>\n\n<p>Some more weirdness. Changing <code>Inner Join IGroupes ig</code>  to <code>Left Join  IGroupes ig</code> executes the query in 0 seconds. Can you please suggest why would Inner Join take up minutes? Is this my problem is this some bug in SQL server? Only thing left now is to bang my head against wall. I have wasted more than 4 hours.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":27,"score":-1,"question_id":12929521,"title":"Return Distinct row in resultset in sql server 2008","body":"<p>How to select the distinct row if the particular column have same record multiple times in sql server 2008 and order by datetime.\nI have following column in table:</p>\n\n<ol>\n<li>id</li>\n<li>username</li>\n<li>fileid</li>\n<li>datetime</li>\n</ol>\n\n<p>I have try using following sql:</p>\n\n<pre><code>SELECT DISTINCT(fileid) FROM [DatabaseName].[dbo].[TableName] where usernumber = '015578957'\n</code></pre>\n\n<p>How can I select other column in above sql and order by datetime column and also return result set row where fileid column is distinct.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","date"],"answer_count":1,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12928274,"title":"count records based on group of interval(days) on date column","body":"<p><strong>count data between intervals,interval depends on how much older the record</strong></p>\n\n<p>I have a table called <code>complaint</code> in which I have many columns with <code>ComplaintDate</code>,I want to show <strong>count of records depends on interval</strong>.</p>\n\n<p>Following interval will be used to categorized records:</p>\n\n<ol>\n<li>number of compalaint which is 10 days older.</li>\n<li>number of compalaint which is 10-20 days older.</li>\n<li>number of compalaint which is 20-30 days older.</li>\n<li>number of compalaint which is more than 30 days older.</li>\n</ol>\n\n<p>I have tried something like this </p>\n\n<pre><code>select SUM(CASE WHEN ComplaintDate BETWEEN DATEADD (dd,-10,getdate())AND   GETDATE()  THEN 1 ELSE 0 END) As '0-10',\n       SUM(CASE WHEN ComplaintDate BETWEEN  DATEADD (dd,-20,getdate()) AND DATEADD (dd,-10,getdate()) THEN 1 ELSE 0 END) AS '10-20',\n       SUM(CASE WHEN ComplaintDate BETWEEN DATEADD (dd,-30,getdate()) AND DATEADD (dd,-20,getdate()) THEN 1 ELSE 0 END) AS '20-30'       \n FROM Complaint \n</code></pre>\n\n<p><strong>also i want that day included in 0-10 days interval should not be count in 10-20 or 20-30 days interval and same should apply for other other intervals as well .</strong></p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","cursor"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12929083,"title":"How do I use a simple query to search a list of data from a table and return non-duplicate results in a table?","body":"<p>I am trying to loop through the data in a table, and using the data to search to return the results in another table. </p>\n\n<p>How do I prevent duplicates from adding to the table? Note that the order of the query results adding are very important. So if the results are alr added, I don't want them to be added again. Note that the original ranking done by the full search category is misleading, I don't want to use that.</p>\n\n<p>I am using cursor, but I was told it can be solved using simple query, how do I do that? </p>\n\n<p>Below is the code.</p>\n\n<pre><code> ...\n\n    DECLARE @subQ NVARCHAR(200)\n    SET @subQ = ''\n\n    DECLARE cur1 CURSOR FOR\n    SELECT combination FROM @Subqueries\n\n    OPEN cur1\n    FETCH NEXT FROM cur1 INTO @subQ\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        INSERT INTO @Results (app_id, rank, importance)\n        SELECT app_id, rank, 1\n        FROM CONTAINSTABLE(dbo.Applications, display_name, @subQ) KEY_TBL\n        INNER JOIN Applications App\n        ON KEY_TBL.[KEY] = App.app_id\n\n        FETCH NEXT FROM cur1 INTO @subQ   \n    END   \n\n    CLOSE cur1\n    DEALLOCATE cur1\n\n    ...\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008","pivot","transpose"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":115,"score":2,"question_id":12696225,"title":"SQL: Real Transpose","body":"<p>I know about pivot and unpivot. That is not what I want. Pivot and unpivot aggregate data, but that is not what I want. </p>\n\n<p>Think of a table as a matrix (linear algebra). If I start with an m x n matrix, I want to convert that matrix (table) into an n x m matrix. I want a true <a href=\"http://en.wikipedia.org/wiki/Transpose\" rel=\"nofollow\">TRANSPOSE</a>.</p>\n\n<p>How can I do this in SQL?</p>\n\n<p>For example if I have:</p>\n\n<pre><code>1  2  3\n1  2  4\n6  7  8\n3  2  1\n3  9  1\n</code></pre>\n\n<p>then the result should be:</p>\n\n<pre><code>1  1  6  3  3\n2  2  7  2  9\n3  4  8  1  1\n</code></pre>\n\n<p>Notice that the number of rows becomes the number of columns, and vice versa. Also notice that I have not grouped or aggregated any of the data. Every single value present in the source is present in the result, and their x-y coordinates have been swapped.</p>\n"},{"tags":["java","spring","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":32,"score":1,"question_id":12928528,"title":"code working with sa account but not with other","body":"<p>I have a jdbc properties file with </p>\n\n<pre><code>database.username=mfuser\ndatabase.password=mfuser\n</code></pre>\n\n<p>If I changed this to user/pass --> sa/pass then my web application works perfectly but with mfuser it does. I have create a user in SQL Server Security with name mfsuer and password mfuser but it still not working....</p>\n\n<p>How I need to create the user <code>mfuser</code> so that it works? Any special privileges I need to provide for this user? I want it same like <code>sa</code></p>\n\n<p>Here is the error I am getting with mfuser</p>\n\n<pre><code>org.springframework.dao.PermissionDeniedDataAccessException: PreparedStatementCallback; SQL [select lm.login_id,lm.login_name,lm.login_password,lm.full_name, lm.email_address,lm.phone,lm.notes,lm.delete_status,lm.create_date,lm.create_by,lm.modify_date,lm.modify_by FROM Login_Master lm where lm.login_id=(select lm1.login_id from Login_master lm1 where lm1.login_name=? and lm1.login_password =?) ]; The SELECT permission was denied on the object 'Login_Master', database 'MCData', schema 'dbo'.; nested exception is java.sql.SQLException: The SELECT permission was denied on the object 'Login_Master', database 'MCData', schema 'dbo'.\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":1134,"score":1,"question_id":5964693,"title":"How do I raise an error that SQL will see as a job failure?","body":"<p>I've got a job scheduled through the SQL Server Agent that runs a sproc which runs some other sprocs. Every sproc looks like this:</p>\n\n<pre><code>BEGIN TRY\n    -- do stuff\nEND TRY\nBEGIN CATCH\n    DECLARE @errorMessage varchar(4000)\n    DECLARE @procName varchar(255)\n    SELECT @errorMessage = error_message()\n    SELECT @procName = OBJECT_NAME(@@PROCID)\n\n    RAISERROR('%s threw an exception: %s', 16, 1, @procName, @errorMessage)\nEND CATCH\n</code></pre>\n\n<p>This all works fine - errors are raised and thrown up the stack, life is good. However, my RAISERROR calls don't appear to cause the job to fail - I'm set to receive an e-mail notification \"When the job fails,\" but never receive one. E-mail notifications are working, as I will get emails if I change the notification to \"when the job succeeds\". Is there some other function I should be using here in place of RAISERROR?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":51,"score":1,"question_id":12926836,"title":"Query with row_number() taking too much time","body":"<p>I have around 90k records in my DB and I run this query:</p>\n\n<p>It takes too much time (around 4 seconds):</p>\n\n<pre><code>SELECT * FROM (SELECT \n    ROW_NUMBER() OVER (Order By DocumentID desc) peta_rn, peta_query.* From \n    (\n            Select   d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime, dbo.GetLatestStatusDateTime(d.DocumentID) as LatestStatusDatetime, \n                    dbo.FnCanChangeDocumentStatus(d.DocumentStatusID,d.DocumentID) as CanChangeStatus, d.IDate, d.InstrumentID, d.DocumentStatusID,ig.Abbreviation as IGroupAbbreviation, \n                    u.Username, j.JDAbbreviation, inf.DocumentName,\n                    it.Abbreviation as ITypeAbbreviation, d.DocumentDate, ds.Abbreviation as DocumentStatusAbbreviation,\n                    dbo.GetFlatDocumentName(d.DocumentID) as FlatDocumentName \n                    From Documents d Inner Join IGroupes ig On d.IGroupID = ig.IGroupID \n                            Left Join ITypes it On d.ITypeID = it.ITypeID \n                            Left Join Users u On u.UserID = d.UserID \n                            Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                            Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID \n                            Inner Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID                           \n    ) as peta_query) peta_paged WHERE peta_rn&gt;12000 AND peta_rn&lt;=12100\n</code></pre>\n\n<p>However this 2nd query executes in 1 second:</p>\n\n<pre><code>SELECT * FROM (SELECT \n    peta_query.* From \n    (\n            Select  ROW_NUMBER() OVER (Order By d.DocumentID desc) peta_rn, d.DocumentID, d.IsReEfiled, d.IGroupID, d.ITypeID, d.RecordingDateTime, dbo.GetLatestStatusDateTime(d.DocumentID) as LatestStatusDatetime, \n                    dbo.FnCanChangeDocumentStatus(d.DocumentStatusID,d.DocumentID) as CanChangeStatus, d.IDate, d.InstrumentID, d.DocumentStatusID,ig.Abbreviation as IGroupAbbreviation, \n                    u.Username, j.JDAbbreviation, inf.DocumentName,\n                    it.Abbreviation as ITypeAbbreviation, d.DocumentDate, ds.Abbreviation as DocumentStatusAbbreviation,\n                    dbo.GetFlatDocumentName(d.DocumentID) as FlatDocumentName \n                    From Documents d Inner Join IGroupes ig On d.IGroupID = ig.IGroupID \n                            Left Join ITypes it On d.ITypeID = it.ITypeID \n                            Left Join Users u On u.UserID = d.UserID \n                            Left Join DocumentStatuses ds On d.DocumentStatusID = ds.DocumentStatusID \n                            Left Join InstrumentFiles inf On d.DocumentID = inf.DocumentID \n                            Inner Join Jurisdictions j on j.JurisdictionID = d.JurisdictionID                           \n    ) as peta_query) peta_paged WHERE peta_rn&gt;12000 AND peta_rn&lt;=12100\n</code></pre>\n\n<p>My questions are:</p>\n\n<p><strong>1)</strong> Can you please suggest why would my 1st query take so long to execute? I want to optimize my 1st query because it is generated by one of the automated program (whose source I do have but I can't move the RowNumber inside Select).</p>\n\n<p><strong>2)</strong> The time to execute this is also dependent on the peta_rn. If I give peta_rn > 50000 and peta_rn &lt;= 50100, it takes hopeless amount of time to execute. Can you please also suggest why would the time to execute depend upon the row that I am trying to fetch since ultimately I am only trying to fetch 100 rows at a time.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12921984,"title":"database engine tuning wizard \"apply recommendations\" is disabled","body":"<p>I just forced the database engine tuning wizard in ssms 2008 to analyze a 5mb trace.</p>\n\n<p>I got a list of recommendations returned to me, in terms of indexes to implement; however, I am unable to apply the recommendations because it is greyed out:</p>\n\n<p><img src=\"http://i.stack.imgur.com/7ukPl.png\" alt=\"enter image description here\"></p>\n\n<p>Does anyone know whether this is a bug? How would I manually implement the changes?</p>\n\n<p>Thank you so much for your guidance.</p>\n"},{"tags":["c#","winforms","sql-server-2008","combobox","sqldataadapter"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":40,"score":1,"question_id":12925589,"title":"How to find the index - in DATABASE table - of selected item in connected ComboBox","body":"<p>Finding the selected item <em>string</em> in a combo box is easy:</p>\n\n<pre><code>String selectedString = comboBox1.SelectedItem.ToString();\n</code></pre>\n\n<p>Finding the selected item <em>index</em> in a combo box is also easy:</p>\n\n<pre><code>int selectedIndex = comboBox1.SelectedIndex; \n</code></pre>\n\n<p>But finding the index <strong>in a connected database table</strong> of the selected item in the combo box doesn't seem so trivial:</p>\n\n<pre><code>    DataTable dt = new DataTable();\n    SqlDataAdapter da = new SqlDataAdapter(\"SELECT * FROM tblContacts ORDER BY colFirstname\", sqlConnection);\n    da.Fill(dt);\n    for (int i = 0; i &lt; dt.Rows.Count; i++)\n    {\n        String addressRow = (String)dt.Rows[i][\"colFirstname\"];\n        comboBox1.Items.Add(addressRow);\n    }\n</code></pre>\n\n<p>I could try to somehow derive an index to the DB table from the selected item string, but that doesn't guarantee uniqueness.</p>\n\n<p>What is the proper way of finding the index <strong>in a connected database table</strong> of the selected item in the combo box?</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":23449,"score":1,"question_id":5626344,"title":"How to remove a column from an existing table?","body":"<p>How to remove a column from an existing table?</p>\n\n<p>I have a table <code>MEN</code> with <code>Fname</code> and <code>Lname</code></p>\n\n<p>I need to remove the <code>Lname</code></p>\n\n<p>How to do it?</p>\n"},{"tags":["c#","performance","entity-framework","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":8,"down_vote_count":0,"view_count":1279,"score":8,"question_id":4355474,"title":"How do I speed up DbSet.Add()?","body":"<p>I have to import about 30k rows from a CSV file to my SQL database, this sadly takes 20 minutes.</p>\n\n<p>Troubleshooting with a profiler shows me that <strong>DbSet.Add is taking the most time, but why?</strong></p>\n\n<p>I have these Entity Framework Code-First classes:</p>\n\n<pre><code>public class Article\n{\n    // About 20 properties, each property doesn't store excessive amounts of data\n}\n\npublic class Database : DbContext\n{\n    public DbSet&lt;Article&gt; Articles { get; set; }\n}\n</code></pre>\n\n<p>For each item in my for loop I do:</p>\n\n<pre><code>db.Articles.Add(article);\n</code></pre>\n\n<p>Outside the for loop I do:</p>\n\n<pre><code>db.SaveChanges();\n</code></pre>\n\n<p>It's connected with my local SQLExpress server,   but I guess there isn't anything written till SaveChanges is being called so I guess the server won't be the problem....</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12877303,"title":"Prioritize the records in a table","body":"<p>I have a table which has id and statement columns, statement column contains statement like insert into tablename, update tablename, delete tablename (tablename might be any xxx), I have a scenario where I need to write a stored procedure, if I run SP it should get the insert records in statement column first with parent tablenames first and then child table insert into statement and after inserts update statement should come in any fashion and at last delete statement with child table statement first and then parent. </p>\n\n<p>Output should be like </p>\n\n<pre><code>statements\nINSERT INTO country(parent to state)\nINSERT INTO state(parent to city)\nINSERT INTO city(parent to zipcode)\nINSERT INTO zipcode\n</code></pre>\n"},{"tags":["sql-server-2008","crystal-reports","case","statement"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12921156,"title":"How do SQL sServer and Crystal Reports link together for case...then 0?","body":"<p>I'm new to CR &amp; SQL Server. I'm trying to understand how you can code a select case statement with \"case some-condition then 0\" and \"case some-other-condition then 1\" and have it connect in Crystal reports....if I want a particular year of data to show, how do I use this particular style of case statement in the SQL Server coding and how do I get it to connect to variable names in CR?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12899838,"title":"sql query to find difference in two fields","body":"<p>I have a sql server 2008 db  and focussed on two specific columns in a table of over 300 million records. I wanted to find duplicate records which the table has but disinguish from this result set how many and if any of the duplicates have a different field 2.\neg.</p>\n\n<p>field 1:   idUrl\nfield 2:   assignedId</p>\n\n<p>so for duplicates of course:</p>\n\n<pre><code>SELECT [idUrl]\n       ,[assignedId]\nFROM [Feeds].[dbo].[LogFeed]\ngroup by idUrl, assignedId\nhaving COUNT(entryId) &gt; 1\norder by entryid desc\n</code></pre>\n\n<p>So I want to find records where for any duplicates of idUrl are there any records where assignedId is not the same for the duplicate idUrls.</p>\n\n<p>eg</p>\n\n<pre><code> idUrl            assignedID\n www.google.com       10\n www.google.com       10\n www.google.com       10\n www.google.com        7\n</code></pre>\n"},{"tags":["asp.net","sql-server-2008","sql-server-2005"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":113,"score":0,"question_id":12914959,"title":"Cannot bulk load because the file could not be opened. Operating system error code 21(The device is not ready.)","body":"<p>Cannot bulk load because the file could not be opened. Operating system error code 21(The device is not ready.).</p>\n\n<p>Hi All, </p>\n\n<p>I am a newbie to Image Upload in MS SQL Server using ASP.NET. its cool to upload a image in a query from the same machine as the server but when from a remote machine ASP.NET web application to MS SQL Server, I am getting the above mentioned error. </p>\n\n<p>I don't understand what needs to be done, i have seen several threads and forums but i am not able to understand, can you please help me out on the same. I am looking for some descriptive steps to fix this issue.</p>\n\n<pre><code>Session[\"FileName\"] equals some d drive file\n</code></pre>\n\n<p><strong>Query I use:</strong></p>\n\n<pre><code>command.CommandText = \"UPDATE user_info \"\n                                + \"SET User_Image = (SELECT * FROM Openrowset(Bulk '\" + Session[\"FileName\"] + \"', Single_Blob) AS User_Image) \"\n                                + \"WHERE id =\" + \"22222\";\n</code></pre>\n\n<ul>\n<li><p><strong>I use SQL Authentication</strong></p></li>\n<li><p><strong>I have enabled both named pipes + TCP/IP</strong></p></li>\n<li><p>if <strong>EXECUTE AS</strong> is to be used, can someone explain the query. Is there any setting that need to be enabled. I am desperate :(</p></li>\n</ul>\n\n<p>Thanks in advance !</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12924034,"title":"tsql dynamic sql best approach","body":"<p>The dynamica query I have below works but wondering if what I have below can be optimized or if there is a better way of doing it.</p>\n\n<p>I have a web form where the user enters a location and Date Collected. For the date collected, I have a From Date Collected and To Date Collected. The user an leave the To date collected blank in which case it will do anything greater than the From Date Collected.  </p>\n\n<p>Note how I am doing the IS NOT NULL and 1=1 below.  Also wondering if a dynamic SQL is the best approach or if there is a simpler way of doing this.</p>\n\n<pre><code>    DECLARE @sql varchar(max);\n\n    SET @sql = 'SELECT * from tblProgram WHERE 1=1' \n\n    IF (@Location IS NOT  NULL)\n    BEGIN\n      SET @sql = @sql + ' AND Location = ' +  @Location\n    END      \n\n    IF (@FromDateCollected IS NOT  NULL AND @ToDateCollected IS NOT NULL)\n    BEGIN\n         SET @sql = @sql + ' AND pw.DateCollected &gt;= ' +  QUOTENAME(convert(varchar, @FromDateCollected,101),'''') \n         + ' AND pw.DateCollected &lt;= ' + QUOTENAME(convert(varchar, @ToDateCollected,101),'''')\n\n    END\n    ELSE IF (@FromDateCollected IS NOT  NULL AND @ToDateCollected IS  NULL)\n    BEGIN\n      SET @sql = @sql + ' AND pw.DateCollected &gt;= ' +  QUOTENAME(convert(varchar, @FromDateCollected,101),'''') \n\n    END \n\n   exec(@sql)\n</code></pre>\n"},{"tags":["sql-server-2008","excel","stored-procedures"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12908305,"title":"How to properly align the xls to bind the table data using a stored procedure in SQL Server 2008?","body":"<p>I wrote the stored procedure like this</p>\n\n<pre><code>CREATE Procedure [dbo].[usp_GetTrackAgencyCountReport_Job]\nAS\n   Declare @BodyMessage Varchar(1000),\n        @ToEmail Varchar(254),\n        @sql Varchar(max),\n        @Count int,\n        @intFlag INT,\n        @Agent varchar(200),\n        @From datetime,\n        @To datetime,\n        @DbName varchar(100)\n\n        SET @BodyMessage='Please find attached list of Agency names, for how many accounts rated, how many accounts submitted and how many accounts approved to QMS. '\n        Select @ToEmail='hemanth@zeninfotech.com;'\n        --Select @ToEmail='cpeterson@chris-leef.com; gpeterson@chris-leef.com; info@chris-leef.com'\n        SET @To= (SELECT DATEADD(day, DATEDIFF(day, 0, GETDATE()), 0))\n        SET @From=(SELECT DATEADD(day, DATEDIFF(day, 0, GETDATE()), -7))\n        SET @Agent=''\n        SET @DbName='QMSV3Dev'\n\nBegin   \n--crete temp table to get the details\nCREATE TABLE #tblAgencyCount(AID INT IDENTITY(1,1) NOT NULL,SaveDataCount varchar(50),AgentID varchar(50),GetRateCount varchar(50),ConvertedQuoteCount varchar(50))\nINSERT INTO #tblAgencyCount(SaveDataCount,AgentID) select COUNT(*),AQ.AgentID from Agent_Quote AQ where \n        AQ.CreatedOn between @From and @To\n        and AQ.AgentID like @Agent +'%' and AQ.StatusCode!='C' group by AQ.AgentID  \nSET @intFlag = 1\nset @Count=(select COUNT(*) from #tblAgencyCount)\nWHILE (@intFlag &lt;=@Count)\nBEGIN\ndeclare @Ai int\nset @Ai=(select AgentID from #tblAgencyCount where AID=@intFlag)\nUpdate #tblAgencyCount set GetRateCount=(select COUNT(*) from Agent_Quote AQ where \n        AQ.CreatedOn between @From and @To\n        and AQ.AgentID like @Ai and AQ.StatusCode!='C' and AQ.LowPrice!='' and AQ.HighPrice!=''),\n        ConvertedQuoteCount=(select COUNT(*) from Agent_Quote AQ where \n        AQ.CreatedOn between @From and @To\n        and AQ.AgentID like @Ai and AQ.StatusCode!='C' and AQ.ApproveStatus='Approved')\n         where AID=@intFlag\nSET @intFlag = @intFlag + 1\nEND\n--end \n    Drop Table Temp_AgencyCount\n    Create Table Temp_AgencyCount(AgencyName Varchar(250),SubmittedCount Varchar(50),GetRateCount varchar(50),ApprovedQuoteCount Varchar(50))\n    SET @sql='select A.Name,AC.SaveDataCount as SubmittedCount,AC.GetRateCount,AC.ConvertedQuoteCount as ApprovedQuoteCount from #tblAgencyCount AC Left Join ' + @DbName + '..Agent A On AC.AgentID = A.ID order by A.Name'\n    Insert into Temp_AgencyCount Values('Agency Name','Submitted Count','GetRate Count','Approved QuoteCount')\n    Insert into Temp_AgencyCount Values('------------------------------------','-----------------','---------------','-------------------')\n    Insert into Temp_AgencyCount Exec(@sql)\n    exec master..xp_cmdshell 'bcp \"SELECT AgencyName+Space(40-Len(AgencyName))+ ''-   ''+ SubmittedCount+Space(20-Len(SubmittedCount))+''- ''+GetRateCount+Space(20-Len(GetRateCount))+''- ''+ApprovedQuoteCount FROM AgentPortal_Live_21Sept2012..Temp_AgencyCoun\nt\" queryout C:\\WeeklyOnlineSubmissionReport.xls -c -T'\n    Select @Count=COUNT(*) from Temp_AgencyCount\n    If(@Count!=0)\n    Begin\n        EXEC msdb.dbo.sp_send_dbmail @profile_name='Profile',\n             @recipients=@ToEmail, @subject='Weekly Online Submission Report', \n             @body=@BodyMessage,@file_attachments='C:\\WeeklyOnlineSubmissionReport.xls'\n    End\nEnd\n\n--Exec usp_GetTrackAgencyCountReport_Job\n</code></pre>\n\n<p>It is working fine to create the Excel file and send to mail but I don't get correct format in one column in one line like that to display the Excel, how to align, please give me any idea about that</p>\n\n<p>Thank u\nhemanth</p>\n"},{"tags":["mysql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":50,"score":0,"question_id":12923930,"title":"Why migrate from MySql to sql server","body":"<p>My team has a product that was created using MySQL.  All of our other systems use SQL Server 2008, and I want to investigate migrating to SQL Server.  The person who headed up the MySQL server effort has left the company, so now we don't have anyone familiar with MySQL.  We want to migrate, but I want to be able to present a detailed analysis as to why we want to migrate.  Are there any documented case studies on the advantages/disadvanteges of MySQL, and any compelling reasons to migrate to SQL Server? FYI, the app is still in Beta mode, it would be easier to migrate now than 6 months from now.</p>\n\n<p>The two conversations that I don't want to have with my boss are:\n1) I want to migrate the app to SQL Server, and the reason is \"just because I want to \".\n2) We should have migrated 6 months ago, but we didn't and wish we had.</p>\n"},{"tags":["sql","sql-server-2008","tsql","date","datetime"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":119,"score":0,"question_id":12921808,"title":"Convert to MM/YYYY format","body":"<p>I have some bad data in the database for a varchar field.\nData includes: </p>\n\n<pre><code>10/2012\nMay, 2010\nAugust., 2010\n05/10/2009\n</code></pre>\n\n<p>But now I need to clean up these data &amp; update the column with MM/YYYY format. Anyone has any suggestions for doing this easier?</p>\n"},{"tags":["sql-server","sql-server-2008","reporting-services","ssrs-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12726580,"title":"Show Html entities like &amp; in report parameter as &","body":"<p>Is there an effective and/or fast way to show <code>Html entities</code> like <code>&amp;amp;</code> or <code>&amp;euml;</code> as <code>&amp;</code> and <code></code> in an report viewer's parameter drop down list?</p>\n\n<p>I have <code>html</code> encoded values in the database and now I need to show the original value in parameter drop down list</p>\n\n<p>Or does <code>MSSQL</code> have an equivalent for this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":85,"score":0,"question_id":12908486,"title":"How can I get the average difference between the max and min dates?","body":"<p>I am trying to get the <strong>average</strong> number of months difference between two dates:</p>\n\n<pre><code>select client_id, \n        avg(12*(year(MAX(received_date))-year(min(received_date))) \n        + MONTH(MAX(received_date))-MONTH(min(received_date)))\n        from tmpTwoAccessions\n        group by CLIENT_ID,PATIENT_ID\n</code></pre>\n\n<p>I am getting this message:</p>\n\n<pre><code>Cannot perform an aggregate function on an expression containing an aggregate or a subquery.\n</code></pre>\n\n<p>Can you please advise me on what am I doing incorrectly here?\nThanks so much for your guidance.</p>\n"},{"tags":["sql-server-2008","tsql","table","collation","temp"],"answer_count":1,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":720,"score":3,"question_id":9648987,"title":"T-SQL Default Collation of temporary table","body":"<p>How can I check which is the collation of a temporary table?</p>\n\n<p>I want to do this, because I what to check what happens if I have database with a specific collation, different from the SQL Server instance and create a temporary table.</p>\n\n<p>Let's say we have this scenario:</p>\n\n<p>SQL Server 2008 - Latin1_General_CS_AS</p>\n\n<p>Test Database - Estonian_CS_AS</p>\n\n<p>Then create table #Test without specifying the collation. Which will be the collation of the table?</p>\n\n<p>I think Estonian_CS_AS, but in the test I am doing is said Latin1_General_CS_AS. That's why I need to find a SQL statement to check this.</p>\n\n<p>Note: from what I have read, I think that the collation of a temporary objects is defined by the tempdb collation. But if this is true, what difines its kind?</p>\n"},{"tags":["sql","sql-server","oracle","tsql","sql-server-2008"],"answer_count":3,"favorite_count":10,"up_vote_count":20,"down_vote_count":0,"view_count":9496,"score":20,"question_id":2046037,"title":"SQL Server: Can I Comma Delimit Multiple Rows Into One Column?","body":"<h1>Creating Comma Separated Lists In SQL</h1>\n\n<p><br/>\nHi All,</p>\n\n<p>I am attempting to merge something like this in my SQL Server database:</p>\n\n<pre>[TicketID], [Person]\n T0001       Alice\n T0001       Bob\n T0002       Catherine\n T0002       Doug\n T0003       Elaine</pre>\n\n<p>Into this:</p>\n\n<pre>[TicketID], [People]\n T0001       Alice, Bob\n T0002       Catherine, Doug\n T0003       Elaine</pre>\n\n<p>I need to do this in both SQL Server and Oracle.</p>\n\n<p>I have found the function <code>GROUP_CONCAT</code> for MySQL that does exactly what I need here, but MySQL is not an option here.</p>\n\n<p><strong>EDIT:</strong> Test bench:</p>\n\n<pre><code>DECLARE @Tickets TABLE (\n    [TicketID] char(5) NOT NULL,\n    [Person] nvarchar(15) NOT NULL\n)\n\nINSERT INTO @Tickets\nSELECT 'T0001', 'Alice' UNION ALL\nSELECT 'T0001', 'Bob' UNION ALL\nSELECT 'T0002', 'Catherine' UNION ALL\nSELECT 'T0002', 'Doug' UNION ALL\nSELECT 'T0003', 'Elaine'\n\nSELECT * FROM @Tickets\n</code></pre>\n"},{"tags":["c#",".net","sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12919919,"title":"SQL Data Base Sync","body":"<p>I want to Sync two different SQL Data base which is not in public IP, Is this possible with .Net Sync and WCF ?</p>\n\n<p>Or I Need to add both DB in public IP ?</p>\n"},{"tags":["sql-server-2008","migration","ms-access-2003"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":31,"score":0,"question_id":12921243,"title":"SQL Server Migration Assistant invalid object name?","body":"<p>I'm using the SQL Server Migration Assistant 2008 for Access (SSMA 2008).</p>\n\n<p>I've specified which databases I want to import; and I've also specified which SQL Server data I want to import these files into. When it runs I I end up with alot of Synchronization Errors, with a description of <code>Invalid object name 'TableName'</code></p>\n\n<p>I added the <code>Administer</code> permissions to the <code>Admin</code> user and <code>User</code> group in the workgroup file for the database.</p>\n\n<p>I also <a href=\"http://www.sqlservercentral.com/Forums/Topic546504-131-1.aspx#bm561201\" rel=\"nofollow\">read that</a> that I should try compacting the database first and then try to do the migration again; I've tried that, and can't seem to retrieve the rest of the tables. </p>\n\n<p>The database doesn't appear to be corrupted, many users use it all the time (maybe the permissions are just corrupted).  I can also connect to it with SQuirrel SQL.</p>\n\n<p>Do I have any other options for importing the data into SQL Server 2008 R2?   </p>\n"},{"tags":["sql-server-2008","windows-7"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":46,"score":0,"question_id":12920886,"title":"A network-related or instance-specific error occured","body":"<p>I have installed SQL Server 2008 R2 Developer edition successfully. I have 2 problems</p>\n\n<ol>\n<li><code>Its showing 2 (local) servers in server name</code></li>\n<li><code>A network-related or instance-specific error occured while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Name Pipes Provider, error: 40 - Could not open a connection to SQL Server) (Microsoft SQL Server, Error: 2)</code></li>\n</ol>\n\n<p><img src=\"http://i.stack.imgur.com/Xc5QL.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12863786,"title":"A better solution to replace an old cursor?","body":"<p>I have two tables like this</p>\n\n<p>table1 sorted by paymentid, paydate:</p>\n\n<pre><code> paymentid   paydate   amount\n\n  1         20120101    100\n\n  1         20120101    150\n\n  1         20120101    150\n\n  2         20120115    100\n\n  2         20120115    100\n\n...\n</code></pre>\n\n<p>table2 sorted by paymentid, paydate:</p>\n\n<pre><code>paymentid    paydate   pay1   pay2   pay3....base on the position from table1...up to pay20\n\n1            20120101   null  null    null   \n\n2            20120115   null  null    null\n\n...\n</code></pre>\n\n<p>after update, table2 should be like this</p>\n\n<pre><code>1            20120101   100   100     150   null.....\n\n2            20120115   100   100     null  null    null.....\n</code></pre>\n\n<p>The possible solutions i can come up so far are:</p>\n\n<p>1, a temp table for looping thru table1</p>\n\n<p>2, a cursor...current solution:</p>\n\n<pre><code>declare @paymentid int \n\ndeclare @paydate   char(10)\n\ndeclare @amount    money\n\ndeclare @count int\n\ndeclare @saveid int\n\ndeclare @savedate char(10)\n\ndelcare cur cursor for select paymentid, paydate, amount from table1 order by paymentid, paydate\n\nopen cur\n\n\n\nfetch next from cur into @paymentid,@paydate,@amount\n\nwhile @@fetch_status = 0\n\n  if @saveid &lt;&gt; @paymentid or @savedate &lt;&gt; @paydate\n\n     set @count = 1\n\n     set @saveid = @paymentid\n\n     set @savedate = @paydate\n\n  else set @count = @count + 1\n\n  if @count = 1\n\n  update table2 \n\n  set pay1 = @amount\n\n  where paymentid = @paymentid and paydate = @paydate\n\n  if @count = 2\n\n  update table2 \n\n  set pay2 = @amount\n\n  ...\n\n  fetch next\n\n  ...\n</code></pre>\n\n<p>Any suggestion will be appreciated.</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","sql-server-2012"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":49,"score":0,"question_id":12906543,"title":"Changing the SQL Server Time & Date Comment Stamp at top of query","body":"<p>In SQL Server 2008/12 at the top of my procedures I have the following:</p>\n\n<pre><code>/****** Object:  StoredProcedure [Actions].[InsertArea]    Script Date: 16/10/2012 02:56:08 ******/\n                                 ----------------------                 ---------- --------      \n</code></pre>\n\n<p>It obviously changes depending on the name of the procedure and the date / time it was last modified.</p>\n\n<p>Is there any way to prevent this from changing or to alter it so I have a date created as opposed to a date last modified or am I just stuck with it this way.</p>\n\n<p>Thanks in advance for any help.</p>\n"},{"tags":["sql-server-2008","tsql","csv","aggregation"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":96,"score":0,"question_id":12920013,"title":"T-SQL: split and aggregate comma-separated values","body":"<p>I have the following table with each row having comma-separated values:</p>\n\n<pre><code>ID\n-----------------------------------------------------------------------------\n10031,10042\n10064,10023,10060,10065,10003,10011,10009,10012,10027,10004,10037,10039\n10009\n20011,10027,10032,10063,10023,10033,20060,10012,10020,10031,10011,20036,10041\n</code></pre>\n\n<p>I need to get a count for each <code>ID</code> (a groupby).</p>\n\n<p>I am just trying to avoid cursor implementation and stumped on how to do this without cursors.</p>\n\n<p>Any Help would be appreciated !</p>\n"},{"tags":["sql-server","database","sql-server-2008","check-constraints"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":473,"score":2,"question_id":8321619,"title":"Create custom error message in check constraints in SQL SERVER 2008","body":"<p>I'd like to see the ability to attach custom error messages to CONSTRAINT objects, specifically CHECK constrints. Either directly or via a custom error number in sysmessages.</p>\n\n<p>I've seen developers have to create triggers. I think that's not a good reason to implementing it.</p>\n\n<p>I'm using SQL SERVER 2008.</p>\n"},{"tags":["database","sql-server-2008","linq-to-sql","csv"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":39,"score":1,"question_id":12892395,"title":"Cyrillics in LINQ to SQL database","body":"<p>I have comma separated file with cyrillics characters. When I read from it using StreamReader the characters are OK. I'm writing the file in LINQ to SQL database, however the column with cyrillics is written with ?????? .The column is nvarchar type. Does somebody had the same problem?</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":39,"score":0,"question_id":12920248,"title":"\"Merging\" columns from several tables","body":"<p>Using SQL Server 2008, suppose I have several tables with 3 common columns (not related):</p>\n\n<p>TABLE1</p>\n\n<pre><code>col1 colSomeOther col2 colAnotherOne\n</code></pre>\n\n<p>TABLE2</p>\n\n<pre><code>col1 colSomeOther col2 colAnotherOne\n</code></pre>\n\n<p>TABLE3</p>\n\n<pre><code>col1 colSomeOther col2 colAnotherOne\n</code></pre>\n\n<p>I would like to create a view which merges col1 and 2 for the 3 tables above. Something like:</p>\n\n<p>VIEW</p>\n\n<pre><code>col1   col2\n</code></pre>\n\n<p>where col1 contains <strong>ALL elements</strong> from table 1, 2 and 3, and col2 contains ALL elements from col2 in table 1, 2, 3.</p>\n\n<p>Is this possible?</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":2,"favorite_count":1,"up_vote_count":1,"down_vote_count":2,"view_count":43,"score":-1,"question_id":12919929,"title":"must declare scalar variable error \"@f_ndoganor\"","body":"<p>I get the error <code>must declare scalar variable error \"@f_ndoganor\"</code> at <code>@f_ndoganor</code>... I changed type of <code>@f_ndoganor</code> many types, as numeric, as int, as varchar... but I can't solve the problem ... </p>\n\n<pre><code>SqlConnection conn = new SqlConnection(\"Data Source=MAZI-PC\\\\PROJECTACC;Initial Catalog=programDB;Integrated Security=True\");\nstring sqlIns = \"INSERT INTO table_regjistrimi (f_kodi, f_emertimi,f_emri,f_shteti,f_lloj_kodi,f_vendodhja,f_vitiushtrimor,f_telefoni,f_email,f_web,f_nbiznesit,f_dbiznesit,f_nfiskal,f_dfiskal,f_ntvsh,f_dtvsh,f_ndoganore,f_ddoganore,f_npunes,f_dpunes,f_nlicenca,f_dlicenca,f_drejtori,f_rf,f_kontabilisti,f_konsumatori,f_autorizuari,f_npunesuarve,f_shenime) values (@f_kodi, @f_emertimi, @f_emri, @f_shteti, @f_lloj_kodi, @f_vendodhja, @f_vitiushtrimor, @f_telefoni, @f_email, @f_web, @f_nbiznesit, @f_dbiznesit, @f_nfiskal, @f_dfiskal, @f_ntvsh, @f_dtvsh, @f_ndoganore, @f_ddoganore, @f_npunes, @f_dpunes, @f_nlicenca, @f_dlicenca, @f_drejtori, @f_rf, @f_kontabilisti, @f_konsumatori, @f_autorizuari, @f_npunesuarve, @f_shenime)\";\n\n\nconn.Open();\ntry\n{\n    SqlCommand cmdIns = new SqlCommand(sqlIns,conn);\n\n    cmdIns.Parameters.AddWithValue(\"@f_kodi\", textBox1.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_emertimi\", textBox2.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_emri\", textBox3.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_shteti\", textBox4.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_lloj_kodi\", comboBox1.SelectedText);\n    cmdIns.Parameters.AddWithValue(\"@f_vendodhja\", textBox5.Text);\n    cmdIns.Parameters.AddWithValue(\"@adresa\", textBox6.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_vitiushtrimor\", textBox7.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_telefoni\", textBox8.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_email\", textBox9.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_web\", textBox10.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_nbiznesit\", textBox15.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_dbiznesit\", textBox21.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_nfiskal\", textBox16.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_dfiskal\", textBox22.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_ntvsh\", textBox17.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_dtvsh\", textBox23.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_ndoganor\", textBox18.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_ddoganor\", textBox24.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_npunes\", textBox19.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_dpunes\", textBox25.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_nlicenca\", textBox20.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_dlicenca\", textBox26.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_drejtori\", textBox30.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_rf\", textBox31.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_kontabilisti\", textBox32.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_konsumatori\", textBox33.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_autorizuari\", textBox34.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_npunesuarve\", textBox35.Text);\n    cmdIns.Parameters.AddWithValue(\"@f_shenime\", textBox36.Text);\n    cmdIns.ExecuteNonQuery();\n    //admin\n}\n    catch (Exception ex )\n{\n    MessageBox.Show(ex.Message);\n}\nfinally\n{\n    conn.Close();\n}\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":543,"score":2,"question_id":2870162,"title":"Can SQL Server 2008 use a variable in a WHERE IN clause","body":"<p>Are there any updates in SQL Server 2008 to allow a variable for the <code>IN</code> clause of a <code>WHERE</code> predicate?</p>\n\n<p>Will this code work as expected?</p>\n\n<pre><code>declare @InParams varchar(100) = '1,2';\n\nselect * from Category\nwhere CategoryID in @InParams;\n</code></pre>\n"},{"tags":["c#",".net","sql","sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12918626,"title":"Select distinct values ignoring one field","body":"<p>I have a table similar to this</p>\n\n<pre><code>Table(Id int, PropertyId int, UserId int, AccesedOn datetime)\n</code></pre>\n\n<p>So the table can have value for one property for one user, but different times.</p>\n\n<pre><code>Eg.\n1,100,5, 2012-10-16 16:24:48\n2,100,5, 2012-10-17 11:22:00\n3,100,5, 2012-10-18 17:10:05\n</code></pre>\n\n<p>What I am trying here is to select distinct properties for specific user, but order by most recent access time.</p>\n\n<p>Also I am joining this table to three other tables which result in providing duplicate values. Therefore I have to use <code>DISTINCT</code> command.</p>\n\n<p>Problem I have is since I doing the <code>orderby AccesedOn</code>, it need to appear on select statement which doesnt brings the distinct values since the <strong><em>AccesedOn</em></strong> column have different values.</p>\n\n<p>For above example it should return only <code>3,100,5, 2012-10-18 17:10:05</code></p>\n\n<p>Any suggestions to overcome this?</p>\n"},{"tags":["sql","database","sql-server-2008","query","sql-optimization"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":67,"score":2,"question_id":12918362,"title":"Temporary table vs short-circuit operation for SQL query","body":"<p>Following is my query which I want to optimize, here the bottleneck for the optimization is CONDITION_B. </p>\n\n<pre><code>select @COMPUTE_X = count(distinct TABLEA.COLUMN_T5)\nfrom #TMP_TABLEA TABLEA\ninner join TABLEB on TABLEB.ID = TABLEA.ID\nleft join....\nwhere\n(\n  CONDITION_A --Complex condition\n) and\n(\n  CONDITION_B --Complex condition with some functions returning table\n)\n</code></pre>\n\n<p>If I put my result of above query leaving CONDITION_B to a temporary table and then apply CONDITION_B on that temporary table, I achieve a very good amount of performance gain. I think CONDITION_B always evaluated whether the result for CONDITION_A is false.</p>\n\n<p>Could anyone let me know if there is a better way of doing it. And does short-circuit operations work in SQL query statement, if yes what is the order of their processing.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","select"],"answer_count":4,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":103,"score":0,"question_id":12918061,"title":"Combine 2 SQL SELECT statements","body":"<p>** Evidently some people think my question is not worthy of their time. I whole heartedly appologise for this. However, rather than down voting why not use that time to do something positive and at least tell me what info you would require to make this not be a cr@p question in your eyes. **</p>\n\n<p>I have a list of staff in table <code>tblMembers</code> and a list of clients in table <code>tblClients</code>.</p>\n\n<p>One person may have several client.</p>\n\n<p>The staff member associated with a client is identified by <code>staffId</code> against the client record.</p>\n\n<p>Each staff member has a category Id for the type of clients they have <code>catId</code>.</p>\n\n<p><em><strong>I need to find all of the staff for a given client type and then sort them by the number of clients they have. Staff members without any clients should show a result of 0 rather than not showing.</em></strong></p>\n\n<p>A simplified table structure would be:</p>\n\n<p><code>tblMembers</code>:</p>\n\n<pre><code>Id | catId\n</code></pre>\n\n<p><code>tblClients</code>:</p>\n\n<pre><code>Id | staffId \n</code></pre>\n\n<p>Any help would be greatly appreciated.</p>\n\n<p>Thanks!</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":5,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12917555,"title":"Convert Comma Delimited String to bigint in SQL Server","body":"<p>I have a varchar string of delimited numbers separated by commas that I want to use in my SQL script but I need to compare with a bigint field in the database.  Need to know to convert it:</p>\n\n<pre><code>DECLARE @RegionID varchar(200) = null\nSET @RegionID = '853,834,16,467,841,460,495,44,859,457,437,836,864,434,86,838,458,472,832,433,142,154,159,839,831,469,442,275,840,299,446,220,300,225,227,447,301,450,230,837,441,835,302,477,855,411,395,279,303'\n\nSELECT a.ClassAdID,    -- 1\n        a.AdURL,        -- 2\n        a.AdTitle,      -- 3\n        a.ClassAdCatID, -- 4\n        b.ClassAdCat,   -- 5\n        a.Img1,         -- 6\n        a.AdText,       -- 7\n        a.MemberID,     -- 9\n        a.Viewed,       -- 10\n        c.Domain,       -- 11\n        a.CreateDate    -- 12\n        FROM ClassAd a  \n        INNER JOIN ClassAdCat b ON b.ClassAdCAtID = a.ClassAdCAtID\n        INNER JOIN Region c ON c.RegionID = a.RegionID\n        AND a.PostType = 'CPN'\n        AND DATEDIFF(d, GETDATE(), ExpirationDate) &gt;= 0\n        AND a.RegionID IN (@RegionID)\n        AND Viewable = 'Y'\n</code></pre>\n\n<p>This fails with the following error: </p>\n\n<pre><code>Error converting data type varchar to bigint.\n</code></pre>\n\n<p>RegionID In the database is a bigint field.. need to convert the varchar to bigint.. any ideas..?</p>\n\n<p>Many thanks in advance,</p>\n\n<p>neojakey</p>\n"},{"tags":["sql-server-2008","sql-server-2012"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":29,"score":0,"question_id":12917858,"title":"Execute command when replicating database on publisher and subscriber?","body":"<p>I have two MSSQL 2012 databases.\nI have snapshot replication configured where the first server is a publisher and distributer, and the other is a subscriber.</p>\n\n<p>I would like to be able to execute a command on the publisher just before the replication job occurs, and then another command on the subscriber just after the replication finishes.</p>\n\n<p>I belive this should be a pull snapshot replication, so that the agent is located on the subscriber server.</p>\n\n<p>Is this even possible?</p>\n"},{"tags":["sql-server-2008","query","inner-join","multiple-columns"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":43,"score":1,"question_id":12917711,"title":"In sql 2008 R2, how do i join 2 columns from one table with 2 columns in another table?","body":"<p>I have 2 tables. In table1 I have 2 columns -- cust_npa &amp; cust_nxx. In table2, I have 2 columns -- valid_npa &amp; valid_nxx. Each entry in table2.valid_npa has a corresponding entry in table2.valid_nxx.</p>\n\n<pre><code>valid_npa   valid_nxx\n201         551\n201         552\n201         553\n202         851\n202         852\n</code></pre>\n\n<p>I wish to return all the rows in table1 that have a combination of valid_nap &amp; valid_nxx from table2.</p>\n\n<p>For example, a row in table1 that has cust_npa of 201 and cust_nxx of 852 would not be returned (as this is not a valid combination from table2).</p>\n"},{"tags":["sql-server","sql-server-2008","entity-framework","asp.net-membership","connection-string"],"answer_count":0,"favorite_count":1,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12917410,"title":"Move ASPNETDB.mdf from local machine to SQL Server in production","body":"<p>so I have a problem which destroy my brain since a week. I'll try to be the more specific as possible.</p>\n\n<p>I have an Intranet Web Application in ASP.NET Razor MVC3 with <strong>Entity Framework Membership Provider</strong>. So, my ASPNETDB.mdf appears in my App_Data folder, and I also see it in my Server Explorer tab. Until there, everything is normal and alright. </p>\n\n<p>Now that my app is finish, I would like to move my ASPNETDB database on a distant sql server. So I'll do it, I joined my db in MSQL server management studio, and I changed my connection string from :</p>\n\n<pre><code>&lt;add name=\"ApplicationServices\" \nconnectionString=\"data source=.\\SQLEXPRESS;\n                  Integrated Security=SSPI;\n                  AttachDBFilename=|DataDirectory|FactuADH.dbo;\n                  User Instance=true\"    \nproviderName=\"System.Data.SqlServerCe.4.0\" /&gt;\n</code></pre>\n\n<p>to this one : </p>\n\n<pre><code>&lt;add name=\"ApplicationServices\"\n     connectionString=\"Server=SDCCID01;\n                       Initial Catalog=myDbName;\n                       User ID=myid;\n                       Password=mypswd\"\n     providerName=\"System.Data.SqlClient\" /&gt;\n</code></pre>\n\n<p>So, to test it, I delete my ASPNETDB.mdf from my App_Data, and when I'll try to log on in my app, I can't. Other thing, when I shut down visual studio and re-open it, I have a new ASPNETDB.mdf database which is re-created (empty). It's look like my connection string have no impacte, even when I changed it, without delete my ASPNETDB from my App_Data folder, my application speak with my local aspnetdb, not one on my server. </p>\n\n<p>Any Idea ? </p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":27,"score":0,"question_id":12917409,"title":"Upgraded SS2k5 to SS2k8 but instance still shows SS2k5","body":"<p><img src=\"http://i.stack.imgur.com/eT9Sp.png\" alt=\"enter image description here\">I used the standard MS install process to upgrade my SS2k5 instance to SS2k8R2. Took a long time, and installed programs shows SS2k8R2, but the instance still shows SS2k5. Ideas?</p>\n\n<p>![Here's what it shows:]</p>\n"},{"tags":["sql","sql-server-2008","sql-server-2005"],"answer_count":2,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":73,"score":2,"question_id":12915765,"title":"Continue inserting data in temporary table when met exception in SQL Server 2005 (also for 2008)","body":"<p>I have 2 simple tables</p>\n\n<pre><code>+------|---------|----------+\n+  ID  |  Value  |   Test   +\n+------|---------|----------+\n+  3   |   Test  |   12345  +\n+  4   |  MyVal  |   56789  +\n+  5   |  Another|   101010 +\n+------|---------|----------+\n\n\n\n+------|---------|----------+\n+  ID  |  Value  |   Test   +\n+------|---------|----------+\n+  3   |   Test  |   12345  +\n+  7   |  MyVal12|   56789  +\n+  5   |  Another|   101010 +\n+------|---------|----------+\n</code></pre>\n\n<p>The <code>ID</code> from both tables are primary keys.</p>\n\n<p>In my stored procedure, I create a temporary table like this:</p>\n\n<pre><code>CREATE TABLE #tempTable(\n        ID int NOT NULL PRIMARY KEY NONCLUSTERED,\n        FIELD VARCHAR(255))\n</code></pre>\n\n<p>and the part of my procedure stored with <code>try-catch</code> block:</p>\n\n<pre><code>BEGIN TRY\nINSERT INTO #tempTable(ID, FIELD)\nEXEC sp_executesql @myCustomSql, @paramList, @param1, @param2 ...\nEND TRY\n\nBEGIN CATCH\n      // what to put here ?\nEND CATCH\n</code></pre>\n\n<p>I want to add rows to my temporary table (you'll see the duplicates for ID = 3 and 5) and I want to continue adding. Finally I want to have the following content for table:</p>\n\n<pre><code>+------|---------+\n+  ID  |  FIELD  +\n+------|---------+\n+  3   |   Test  +\n+  4   |  MyVal  +\n+  5   |  Another+ \n+  7   |  MyVal12+\n+------|---------+\n</code></pre>\n\n<p>I gave here a simplified example, in my database I have over one hundred thousand rows and many columns.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008","triggers","project-server"],"answer_count":3,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":73,"score":1,"question_id":12458348,"title":"trigger to stop specific field being set to NULL (single and multi-line updates)","body":"<p>Is it possible to create a trigger that will check if a specific field is being set to NULL (from a single-line or multi-line update), and if it is, to revert that field back to its initial value?</p>\n\n<p>I've searched on the site but not found anything that matches my exact requirements.</p>\n\n<p>A bit of background:</p>\n\n<p>We have two applications (a time management web app and microsoft project server) sending updates to each other about the resources in our organisation. When a change is made in either system, it sends that update to the other system. However, there are certain fields that only exist in the time management web app (table name <code>resource</code>), and MSP server is forcing one of these fields (field name <code>GLMaskingValue</code>) to <code>NULL</code> with some of its updates (not all, as far as I can tell). </p>\n\n<p>I have no access to the code, just the web app database, and I don't want to make the whole update statement fail (which I gather I could do using table constraints) - I just want to revert this one field back when and if someone tries to change it to <code>NULL</code>.</p>\n\n<p>I'm going down the route of triggers but there may well be a much better way of doing this - if so please enlighten me!</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":93,"score":0,"question_id":12916125,"title":"SQL multiple tables into one","body":"<p>I have a table of products and a separate table of images for any particular product.</p>\n\n<p><code>tblProducts</code>:</p>\n\n<ul>\n<li>productID</li>\n<li>productName</li>\n</ul>\n\n<p><code>tblProductImages</code>:</p>\n\n<ul>\n<li>productID</li>\n<li>imageFileName</li>\n</ul>\n\n<p>I can return the product details and then the product images for that product with two separate queries but I'm unsure of how to get it into one query?</p>\n\n<p>So for example I would like to see:</p>\n\n<pre><code>productID productName imageFilename imageFilename imageFilename\n</code></pre>\n\n<p>as my result set (will need to be dynamic because there could be anything from 1 to 10 images uploaded per product).</p>\n\n<p>Is this something I can do with a PIVOT?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","sql-server-2008-r2","checkpoint"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":74,"score":1,"question_id":12916043,"title":"Does checkpoint block every other operation?","body":"<p>When Sql Server issues a checkpoint, does it block every other operation until the checkpoint is completed?</p>\n\n<p>If I understand correctly, when a checkpoint occurs, the server should write all dirty pages.</p>\n\n<p>When it's complete, it will write checkpoint to the transaction log, so in case of any failure it will process only transactions from that point of time (or transactions which already started at time of checkpoint). </p>\n\n<p>How does sql server prevent some non dirty page to become dirty while the checkpoint is in progress?</p>\n\n<p>Does it block all writes until the checkpoint is completed?  </p>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008","bids"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":34,"score":0,"question_id":12916609,"title":"SSRS BIDS changing the meta tag","body":"<p>When developing reports using SSRS BIDS/SQL Server 2008 R2 is there anyway you can alter the metatag or css used for the report.</p>\n\n<p>I want to add this to the header of the report part in question:</p>\n\n<pre><code>&lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=7\"&gt;\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":53,"score":0,"question_id":12915993,"title":"Join on to table with multiple matches but only bring back specified match","body":"<p>I have 3 tables.<br>\nTable A contains the data that my query is going to be based on. It contains id1.\nTable B is my connecting table, it contains 2 columns that I'm concerned with: id1 &amp; id2.  </p>\n\n<p>Table C is my lookup table, it contains id2 and ReasonName. I need the column ReasonName and all the data from table A.</p>\n\n<p>If I do the following SQL:</p>\n\n<pre><code> SELECT NAME, \n       STARTDATE, \n       ENDDATE, \n       REASON, \n       ID1 \nFROM   TABLEA \n       LEFT JOIN TABLEB \n              ON TABLEA.ID1 = TABLEB.ID1\n</code></pre>\n\n<p>I am then able to do a second join on to TableC, however this is where the problem lies.\nThere are multiple matches in TableC so therefore my totalrows increases. I need to avoid this.\nSee image for what TableC looks like:</p>\n\n<p><img src=\"http://i.stack.imgur.com/Ymazn.png\" alt=\"enter image description here\"></p>\n\n<p>If my SQL statement now looks like this:</p>\n\n<pre><code> SELECT TABLEA.NAME, \n       TABLEA.STARTDATE, \n       TABLEA.ENDDATE, \n       TABLEA.REASON, \n       TABLEA.ID1, \n       TABLEC.REASONNAME \nFROM   TABLEA \n       LEFT JOIN TABLEB \n              ON TABLEA.ID1 = TABLEB.ID1 \n       LEFT JOIN TABLEC \n              ON TABLEB.ID2 = TABLEC.ID2 \n</code></pre>\n\n<p>Then my rows increase by around 1000. This is because it is quite possible that TableA.id1 matches multiple id2s found in TableC. It then duplicates rows apart from the different TableC.ReasonName.</p>\n\n<p>In TableC there is one ReasonName that I am concerned with. For this example I will say it is reasonf.</p>\n\n<p>What I need is to bring through ReasonName from TableC, BUT only the ones that contain reasonf, the rest I want to say NULL or to do a COALESCE with No Reason.\nI have tried putting a WHERE clause into the statement. See SQL:</p>\n\n<pre><code> SELECT TABLEA.NAME, \n       TABLEA.STARTDATE, \n       TABLEA.ENDDATE, \n       TABLEA.REASON, \n       TABLEA.ID1, \n       TABLEC.REASONNAME \nFROM   TABLEA \n       LEFT JOIN TABLEB \n              ON TABLEA.ID1 = TABLEB.ID1 \n       LEFT JOIN TABLEC \n              ON TABLEB.ID2 = TABLEC.ID2 \nWHERE  TABLEC.ID2 = 'asd1f5as98a4' \n</code></pre>\n\n<p>But then it will only bring though those records where there is a match with reasonf, I want it to display reasonf people and ignore the rest (leave as null or something) so I have no duplicates but my full result set.</p>\n\n<p>I'm thinking I may need to change to a right join or possibly change the WHERE but I'm not entirely sure.</p>\n"},{"tags":["sql-server-2008","appharbor"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":42,"score":0,"question_id":12915940,"title":"AppHarbor Shared SQL Space Allocation Error","body":"<p>We are running the Shared SQL Server Addon under the 'Nano' Plan with 10GB storage.</p>\n\n<p>We are nowhere near approaching our storage limit yet we are intermittently encountering this SQL error when writing to the database:</p>\n\n<blockquote>\n  <p>Could not allocate space for object 'dbo.<em>MyTable</em>' in database\n  '<em>MyDatabaseId</em>' because the 'PRIMARY' filegroup is full. Create disk\n  space by deleting unneeded files, dropping objects in the filegroup,\n  adding additional files to the filegroup, or setting autogrowth on for\n  existing files in the filegroup.</p>\n</blockquote>\n\n<p>It seems the problem is because we do not have enough unused space at any given time for the tables we are writing to. Here is the output from <code>sp_spaceused</code> on each table:</p>\n\n<pre><code>name             rows      reserved    data        index_size   unused\n---------------- --------- ----------- ----------- ------------ ------\nMyTable1         382862    177608 KB   177536 KB   8 KB         64 KB\n---------------- --------- ----------- ----------- ------------ ------\nMyTable2         137091    34248 KB    34240 KB    8 KB         0 KB\n---------------- --------- ----------- ----------- ------------ ------\n</code></pre>\n\n<p>EDIT: Further inspection shows the physical .mdf file has an Auto-Grow setting of 1024KB, should we expect to see a larger proportion of this as Unused table space?</p>\n\n<p>This is preventing us from creating indexes and worse still causing us to lose data. Is there a way to increase our allocation or another approach to take? Please advise.</p>\n"},{"tags":["sql-server-2008","msdtc","distributed-transactions"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12860738,"title":"MSDTC: TransactionManagerCommunicationException after changing IP address of MSSQL server","body":"<p>after we moved our Win2k8 MSSQL2008 server to different IP address, we have troubles running unit tests against database on that SQL server from out build agent. Everything worked before we moved the database server. Now, unit tests which uses multiple database transactions fails with this error message:</p>\n\n<pre><code>System.Data.EntityException: The underlying provider failed on Open. \n---&gt;   System.Transactions.TransactionManagerCommunicationException: \nCommunication with the underlying transaction manager has failed. \n---&gt; System.Runtime.InteropServices.COMException: The MSDTC transaction manager \nwas unable to pull the transaction from the source transaction manager due to\ncommunication problems. \nPossible causes are: a firewall is present and it doesn't have an exception for the\nMSDTC process, the two machines cannot find each other by their NetBIOS names, or the \nsupport for network transactions is not enabled for one of the two transaction\nmanagers.\n</code></pre>\n\n<p>We checked the firewall settings, and ability to ping from one server to another, without problem. Probably there must be the old IP address of SQL Server stored somewhere, or what else can cause this problem? </p>\n\n<p>Thank you for help!</p>\n"},{"tags":["sql-server-2008","sql-optimization","query-plans"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":50,"score":0,"question_id":12904376,"title":"Execution Plan Optimization when where clause is removed then added back","body":"<p>I have a stored procedure that uses a table valued function which executes in 9 seconds. If I  alter the table valued function and remove the where clause, the stored procedure executes in 3 seconds. If I add the where clause back, the query still executes in 3 seconds. </p>\n\n<p>I took a look at the execution plans and it appears that after I remove the where clause, the execution plan includes parallelism and the scan count for 2 of my tables drops for 50000 and 65000 down to 5 and 3. After I add the where clause back, the optimized execution plan still runs unless I run DBCC FREEPROCCACHE.</p>\n\n<p>Questions\n1. Why would SQL Server start using the optimized execution plan for both queries only when I first remove the where clause?</p>\n\n<ol>\n<li>Is there a way to force SQL Server to use this execution plan?</li>\n</ol>\n\n<p>Also, this is a paramaterized all-in-one query that uses the (Parameter is null or Parameter) in the where clause, which I believe is bad for performance.</p>\n\n<pre><code>RETURNS TABLE \nAS\nRETURN \n(\nSELECT  TOP (@PageNumber * @PageSize)\n                CASE\n                    WHEN @SortOrder = 'Expensive' THEN ROW_NUMBER()     OVER (ORDER BY SellingPrice DESC)\n                WHEN @SortOrder = 'Inexpensive' THEN ROW_NUMBER() OVER (ORDER BY SellingPrice ASC)                  \n                WHEN @SortOrder = 'LowMiles' THEN ROW_NUMBER() OVER (ORDER BY Mileage ASC)\n                WHEN @SortOrder = 'HighMiles' THEN ROW_NUMBER() OVER (ORDER BY Mileage DESC)\n                WHEN @SortOrder = 'Closest' THEN ROW_NUMBER() OVER (ORDER BY P1.Distance ASC)       \n                WHEN @SortOrder = 'Newest' THEN ROW_NUMBER() OVER (ORDER BY [Year] DESC)    \n                WHEN @SortOrder = 'Oldest' THEN ROW_NUMBER() OVER (ORDER BY [Year] ASC)                     \n                ELSE ROW_NUMBER() OVER (ORDER BY InventoryID ASC)\n            END as rn,\n            P1.InventoryID,\n            P1.SellingPrice,\n            P1.Distance,\n            P1.Mileage,\n            Count(*) OVER () RESULT_COUNT,\n            dimCarStatus.[year]\n    FROM    (SELECT InventoryID, SellingPrice, Zip.Distance, Mileage, ColorKey, CarStatusKey, CarKey FROM facInventory\n                JOIN @ZipCodes Zip\n                ON   Zip.DealerKey = facInventory.DealerKey) as P1\n    JOIN    dimColor\n            ON dimColor.ColorKey = P1.ColorKey\n    JOIN    dimCarStatus\n            ON dimCarStatus.CarStatusKey = P1.CarStatusKey  \n    JOIN    dimCar\n            ON dimCar.CarKey = P1.CarKey                        \n    WHERE\n            (@ExteriorColor is NULL OR dimColor.ExteriorColor like @ExteriorColor) AND\n            (@InteriorColor is NULL OR dimColor.InteriorColor like @InteriorColor) AND\n            (@Condition is NULL OR dimCarStatus.Condition like @Condition) AND\n            (@Year is NULL OR dimCarStatus.[Year] like @Year) AND\n            (@Certified is NULL OR dimCarStatus.Certified like @Certified) AND\n            (@Make is NULL OR dimCar.Make like @Make) AND\n            (@ModelCategory is NULL OR dimCar.ModelCategory like @ModelCategory) AND    \n            (@Model is NULL OR dimCar.Model like @Model) AND\n            (@Trim is NULL OR dimCar.Trim like @Trim) AND\n            (@BodyType is NULL OR dimCar.BodyType like @BodyType) AND\n            (@VehicleTypeCode is NULL OR dimCar.VehicleTypeCode like @VehicleTypeCode) AND\n            (@MinPrice is NULL OR P1.SellingPrice &gt;= @MinPrice) AND\n            (@MaxPrice is NULL OR P1.SellingPrice &lt; @MaxPrice) AND\n            (@Mileage is NULL OR P1.Mileage &lt; @Mileage)\n    ORDER   BY\n            CASE\n                WHEN @SortOrder = 'Expensive' THEN -SellingPrice\n                WHEN @SortOrder = 'Inexpensive' THEN SellingPrice \n                WHEN @SortOrder = 'LowMiles' THEN Mileage\n                WHEN @SortOrder = 'HighMiles' THEN -Mileage\n                WHEN @SortOrder = 'Closest' THEN P1.Distance        \n                WHEN @SortOrder = 'Newest' THEN -[YEAR]\n                WHEN @SortOrder = 'Oldest' THEN [YEAR]                  \n                ELSE InventoryID \n            END\n)\n</code></pre>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12915497,"title":"SQL Server Cross-Database, Cross-Server Relationships","body":"<p>In SQL Server are these things possible</p>\n\n<ol>\n<li>Writing a select query which references tables from different databases on the same server?</li>\n<li>Writing a select query which references tables from different databases on different servers?</li>\n<li>Having a primary key, foreign key relationship between tables in different databases on the same server?</li>\n<li>Having a primary key, foreign key relationship between tables in different databases on different servers?</li>\n</ol>\n\n<p>THanks,</p>\n\n<p>Sachin</p>\n"},{"tags":["sql-server-2008","tsql"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":9213375,"title":"T-SQL COUNT of 'A', 'B', and 'A or B'","body":"<p>Conceptually, I have a table with a list of fruit items.  I want, in a single query, to see counts of how many apples, oranges, 'apples or oranges', and 'other fruit' there are.</p>\n\n<p>How can I achieve this in T-SQL?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":80,"score":1,"question_id":12906776,"title":"how to combat horrific performance when joining on WITH(s)","body":"<p>I do not have permissions to set up indexes on these tables unfortunately. </p>\n\n<p>The first two <code>WITH's</code> are causing this query to run for hours:</p>\n\n<pre><code>;with OneAccession as (\nselect client_id,COUNT(patient_id) PatientCount from\n(\nselect client_id,patient_id\nfrom F_ACCESSION_DAILY\ngroup by CLIENT_ID,PATIENT_ID\nhaving COUNT(ACCESSION_ID)=1\n) a\ngroup by CLIENT_ID\n)\n,\n\nTwoAccessions as (\nselect client_id,COUNT(patient_id) PatientCount from\n(\nselect client_id,patient_id\nfrom F_ACCESSION_DAILY\ngroup by CLIENT_ID,PATIENT_ID\nhaving COUNT(ACCESSION_ID)=2\n) a\ngroup by client_id\n)\n\n\n\nselect\nf.client_id\n, 12*(year(getdate())-year(min(f.received_date))) + MONTH(GETDATE())-MONTH(min(f.received_date))\n, COUNT(distinct f.patient_id) TotalPatients\n, COUNT(f.ACCESSION_ID) TotalSpecimens\n, o.PatientCount  TotalPatientsWOneSpec\n, t.PatientCount TotalPatientsWTwoSpec\nfrom F_ACCESSION_DAILY f\njoin\nOneAccession o\non o.CLIENT_ID=f.CLIENT_ID\njoin\nTwoAccessions t\non t.client_id=f.CLIENT_ID\nwhere f.CLIENT_ID not in (select clientid from SalesDWH..TestPractices)\nand f.SPECIMEN_SOURCE in ('Oral Fluid','Urine')\ngroup by f.CLIENT_ID,o.PatientCount,t.PatientCount\n</code></pre>\n\n<p>If I remove <code>OneAccession</code> and <code>TwoAccessions</code>, I can get results in just a few minutes!</p>\n\n<p>I would be very grateful for any guidance on improving my query syntax in order to speed this up!</p>\n\n<p>Thanks so much.</p>\n"},{"tags":["sql-server-2008","tsql","full-text-search"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":11738511,"title":"name search with Full Text search","body":"<p>Table: User</p>\n\n<pre><code>...|Name                  |...|..\n__________________________________\n...|george walker          |...|..\n...|...                   |...|..\n</code></pre>\n\n<p>Now I want to write a query to get the above record for the following inputs:\n<code>george</code>\n<code>george walker</code> \n<code>george walker bush</code> etc.</p>\n\n<p>ie., alteast half of the words in search string should match but not any word match</p>\n\n<p>How can I write a query for this?</p>\n\n<p>Note: I would like to use <code>Full Text Search</code> feature because this table has few millions of records. <br>\nI doubt if I could use <code>SOUNDEX</code> with <code>Full Text</code></p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12914287,"title":"update or insert","body":"<p>I'm trying to update or insert data dependent on whether the account number is already in the existing data.\nFirstly I added the new variables to those with an acocunt number already in the table using this</p>\n\n<pre><code>drop table #test1\nselect a.*, B.Delq_Sep12, b.Bal_Sep12, b.Queue_Sep12\ninto #test1\nfrom  pcd1 a\nleft join #pcd_sep12  b on  (a.ACCOUNT_NUMBER = B.account_number)\n</code></pre>\n\n<p>Then I add all those records whose account number is not in test1 (created above) from #pcd_sep12 into test1</p>\n\n<pre><code>INSERT #test1\nSELECT * FROM #pcd_sep12 WHERE account_number NOT IN(SELECT account_number FROM #test1)\n</code></pre>\n\n<p>I get the error Column name or number of supplied values does not match table definition.</p>\n\n<p>I realise its because theres not the same number of fields but is there a way around this?</p>\n"},{"tags":["sql-server","sql-server-2005","tsql","sql-server-2008","insert"],"answer_count":11,"favorite_count":3,"up_vote_count":17,"down_vote_count":0,"view_count":24711,"score":17,"question_id":2624713,"title":"How do I insert multiple rows WITHOUT repeating the \"INSERT INTO dbo.Blah\" part of the statement?","body":"<p>I know I've done this before years ago, but I can't remember the syntax, and I can't find it anywhere due to pulling up tons of help docs and articles about \"bulk imports\".</p>\n\n<p>Here's what I want to do, but the syntax is not exactly right... please, someone who has done this before, help me out :)</p>\n\n<pre><code>INSERT INTO dbo.MyTable (ID, Name)\nVALUES (123, 'Timmy'),\n    (124, 'Jonny'),\n    (125, 'Sally')\n</code></pre>\n\n<p>I know that this is <em>close</em> to the right syntax. I might need the word \"BULK\" in there, or something, I can't remember. Any idea?</p>\n\n<p>EDIT: Particularly, I need this for a SQL Server 2005 database. I've tried this code, to no avail:</p>\n\n<pre><code>DECLARE @blah TABLE\n(\n    ID INT NOT NULL PRIMARY KEY,\n    Name VARCHAR(100) NOT NULL\n)\n\nINSERT INTO @blah (ID, Name)\n    VALUES (123, 'Timmy')\n    VALUES (124, 'Jonny')\n    VALUES (125, 'Sally')\n\nSELECT * FROM @blah\n</code></pre>\n\n<p>I'm getting <code>Incorrect syntax near the keyword 'VALUES'.</code></p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12913633,"title":"Grouping the rows of a table in sql server","body":"<p>I have the below table which has 2 columns.I need to write a query which will return 3 columns,the first 2 column should match the 2 columns present in the table and the 3rd column should group into n splits.\nfor example in this case I want to split into 4 groups.so 1st 4 rows should return 1 in column 3,2nd 4 rows should return 2, 3rd 4 rows should return 3 and finally last 3 rows(as there are in total 15 rows) should return 4.</p>\n\n<pre><code>DECLARE @NAMES TABLE ( [ID] INT IDENTITY, [NAME] VARCHAR(20) )   \nINSERT INTO @NAMES SELECT 'NAME1' \nUNION ALL \nSELECT 'NAME2' \nUNION ALL \nSELECT 'NAME3' \nUNION ALL \nSELECT 'NAME4' \nUNION ALL \nSELECT 'NAME5' \nUNION ALL \nSELECT 'NAME6' \nUNION ALL \nSELECT 'NAME7' \nUNION ALL \nSELECT 'NAME8' \nUNION ALL \nSELECT 'NAME9' \nUNION ALL \nSELECT 'NAME10' \nUNION ALL \nSELECT 'NAME11' \nUNION ALL \nSELECT 'NAME12' \nUNION ALL \nSELECT 'NAME13' \nUNION ALL \nSELECT 'NAME14' \nUNION ALL \nSELECT 'NAME15' \n</code></pre>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","insert"],"answer_count":5,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":322,"score":0,"question_id":1908825,"title":"Query regarding SQL Insert in SQL Server?","body":"<p>I am using SQL Server 2008 and developing a project which is in maintenance phase. </p>\n\n<p>I want to insert record in a table whose primary key is an Integer but not an identity. e.g. table name is <code>tblFiles</code> and fields are <code>ID, FileName, FileContent</code>. </p>\n\n<p>Actually that table is in use so I dont want to make any schema change in it. And I want the key after row insertion because I have to put that in another table. Existing values in the Id column are different integer, means not in sequence. </p>\n\n<p>So I want the query that also returns me the Id value. So I want to insert only <code>FileName</code> and <code>FileContent</code> and some sort of sql to whom I can embed in my insert query which insert a unique Id and also send me that id </p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":26,"score":0,"question_id":12913474,"title":"Adding into Cumulative Files","body":"<p>I have a cumulative file with 291170 records.  In my new table that needs to be added to the cumulative file there are some account numbers that are already in the cumulative file, and some that are new accounts.</p>\n\n<p>All i want to do is merge these variables on (delqsep12, queuesep12) to those accounts that in there but add all the variables that are originally in there for account numbers that arent already in there, they will just be blank.</p>\n\n<p>so cumulative file (cummu12) has </p>\n\n<pre><code>account_number, netpayjun, netpayjul, netpayaug , delqsep12, queuesep12\n</code></pre>\n\n<p>and the added file I want to merge in just has </p>\n\n<pre><code>delqsep12, queuesep12\n</code></pre>\n\n<p>So at the end I should have 295519 rows, new account_numbers have been added and those already those have just been updated with the new variables.\nAlso these new variables may have something in them for old accounts but some may be empty.</p>\n"},{"tags":["sql-server","sql-server-2008","full-text-search"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":54,"score":0,"question_id":12911101,"title":"Full-Text keywords unicode","body":"<p>I have a very large database with billions of words. I need to search inside these words, and the fastest way I know is using iFTS coming with SQL SERVER 2008.</p>\n\n<p>The data is in Turkish. I mean the language of the data is Turkish. And SQL SERVER 2008 handles Full-Text searches with no problem, even in Turkish.</p>\n\n<p>But the problem happens when I try to list the Full-Text words as described here: <a href=\"http://technet.microsoft.com/en-us/library/cc280900.aspx\" rel=\"nofollow\">http://technet.microsoft.com/en-us/library/cc280900.aspx</a></p>\n\n<p>The word columns returned from <strong>sys.dm_fts_index_keywords</strong> are <strong>keyword</strong> and <strong>display_term</strong>. But these columns are not in correct character set. For example there are both  and i in Turkish charset. Similarly o and , g and . But the words return are ascii encoded. Like <strong>kr</strong> is return as <strong>kor</strong> and <strong>iin</strong> is returned as <strong>icin</strong>.</p>\n\n<p>But when I do a CONTAINS search, SQL Server matches the search words correctly returns true results. I mean searches with <strong>kr</strong> and <strong>kor</strong> return different results, which is the true behavior.</p>\n\n<p>So I need to get the words as they are stored in SQL, not their ascii representations.</p>\n\n<p>I hope I could explain my problem.</p>\n"},{"tags":["sql","sql-server-2008","database-design","localization"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":71,"score":2,"question_id":12911325,"title":"Is it a good idea to add a table with only one column (an auto incremented identity)?","body":"<p>I'm developing a multilingual web application and I'm having some difficulties deciding what would be the best way to handle a particular scenario in the database (SQL Server 2008).</p>\n\n<p>Let's say users can add posts. A post has default data and localized data. A post is also associated with exactly one category. The users can also manage these localized categories.</p>\n\n<p>The part about the posts is pretty clear to me. That will be something like this:</p>\n\n<pre><code>Posts\n-----\nPostId (auto incremented identity)\nCategoryId\nCreationDate\nSortOrder\n\nPostLocalizations\n-----------------\nPostId\nLanguageId\nTitle\nContent\n</code></pre>\n\n<p>The problem I have is that a category has no default data. It's just a textual description and I'm not sure what would be the best way to store the localizations.</p>\n\n<p>I can think of a possible solution, but I don't really like it.</p>\n\n<pre><code>Categories\n----------\nCategoryId (auto incremented identity)\n\nCategoryLocalizations\n---------------------\nCategoryId\nLanguageId\nName\n</code></pre>\n\n<p>I don't like that table with just one column: an auto incremented identity. Of course I can add dummy fields I don't really need like CreationDate or SortOrder, but that just seems silly.</p>\n\n<p>Is there a better way to solve this?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":18,"score":0,"question_id":12911478,"title":"sql query to find out the parent Store proecdure of a child procedure","body":"<p>i want a query to get all the  parent storeprodcedure from where the child storeprodcedure \"CHILDSP\"  is being called across the DB in a particular sql server</p>\n"},{"tags":["sql-server-2008","casting","varchar"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12910643,"title":"Error with casting","body":"<p>I have a query where I have to extract some number fields from varchar column.\nWhen i do some replace and substring in select statement and cast it to bigint everything works fine, but when I use this same cast in join it throws error\n'Error converting data type varchar to bigint'.\nHow is this possible?</p>\n\n<pre><code>select CAST(\n        case when CHARINDEX('/',f.BML,1)&gt;0 \n            then substring(replace(replace(replace(replace(replace(replace(replace(replace(replace(f.BML,'A',''),'B',''),'C',''),'+',''),',',''),'S',''),'H',''),'P',''),'','') ,1,CHARINDEX('/',BML,1)-1)\n        else replace(replace(replace(replace(replace(replace(replace(replace(replace(f.BML,'A',''),'B',''),'C',''),'+',''),',',''),'S',''),'H',''),'P',''),'','') \n        end as bigint)\nfrom TableN n join TableO o  on\n    n.Id=o.Id \n    join TableF f on\n        f.OId=o.OId and\n        substring(cast(n.RJ as varchar(10)),1,3)=substring(CAST(f.MT AS varchar(10)),1,3) and\n    CAST(\n        case when CHARINDEX('/',f.BML,1)&gt;0 then substring(replace(replace(replace(replace(replace(replace(replace(replace(replace(f.BML,'A',''),'B',''),'C',''),'+',''),',',''),'S',''),'H',''),'P',''),'','') ,1,CHARINDEX('/',f.BML,1)-1)\n        else replace(replace(replace(replace(replace(replace(replace(replace(replace(f.BML,'A',''),'B',''),'C',''),'+',''),',',''),'S',''),'H',''),'P',''),'','') \n        end as bigint) =n.mbr\norder by n.Ident\n</code></pre>\n"},{"tags":["sql-server","sql-server-2008","tsql","triggers"],"answer_count":1,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":902,"score":3,"question_id":8136937,"title":"SQL Server: check whether a Trigger is Enabled or Disabled?","body":"<p>How we can see which Trigger is Enabled or Disabled in SQL Server 2008?</p>\n"},{"tags":["c#","performance","entity-framework","sql-server-2008"],"answer_count":7,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":4379,"score":3,"question_id":3890974,"title":"Entity Framework 4 : Bad performance with SQL Server 2008","body":"<p>I'am developing a software based on Entity Framework to handle data in a MS SQL Server 2008 database.</p>\n\n<p><strong>[Trouble 1]</strong></p>\n\n<p>I've just tried to insert some small data (<strong>about 2 Mb</strong>) from my progam to the database : the performance are very bad ! It takes <strong>more than 1 minute</strong> to insert these datas !</p>\n\n<p>I've try to generate pre-compiled views, I've got the same results :-(</p>\n\n<p>All my code use a business layer (automatically generated from .edmx file with T4 template) to manage data in a service layer. It is very pratical to navigate in the relations of objects.</p>\n\n<p><strong>How can I improve the performance of these inserts with Entity Framework ?</strong></p>\n\n<p><strong>[Trouble 2]</strong></p>\n\n<p>Also, before inserting data in database with SaveChanges() method, I fill my object context with AddObject() method. I add about 100 000 small objects (about 2 Mb) to my object context with AddObject() : it takes a very long time (more than 10 minutes) !</p>\n\n<p><strong>How can I decrease this time ?</strong></p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>My program must save more than 50 Mb in database in less than 2-3 minutes ? Do you think it will be possible with EF ?</p>\n"},{"tags":["php","mysql","sql-server-2008","phpfox"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12907832,"title":"sql server unicode data migrating to mysql database","body":"<p>I am migrating a site which was using sql server database to a php/mysql script. I have a table posts with a field data type ntext. This field is holding a lot of unicode data. Now when I migrated this data to mysql table, it got spoiled. When php ui display this data, it shows as ?????. When I see it in phpmyadmin, data looks alright. Can someone help me what should be the field type and Collation. At the moment. The field type is mediumtext and Collation is utf8mb4_unicode_ci.</p>\n\n<p>You can see a <a href=\"http://phpfoxdev.ramtajogi.com/index.php?do=/post/13050/??????%20:%20???%20???%20????%20????%20????%20?????%20/mod_3/\" rel=\"nofollow\">http://phpfoxdev.ramtajogi.com/index.php?do=/post/13050/??????%20:%20???%20???%20????%20????%20????%20?????%20/mod_3/</a></p>\n\n<p>The actual text is         ,   ...    which is an indian language script.</p>\n\n<p>Help will be appreciated. </p>\n\n<p>Regards\nParminder</p>\n"},{"tags":["sql","sql-server-2008","triggers"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":47,"score":-2,"question_id":12908365,"title":"Before update trigger in SQL Server 2008 based on values present in other columns","body":"<p>I need to create a update trigger in SQL Server 2008 which will check 2 other columms for values if they are present then continue with updating else stop that update for each row. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12871329,"title":"SQL query to find out if different rows with same 2nd columns","body":"<p>I have a MessageThread table</p>\n\n<pre><code>UserUid   ThreadUid\n===================\nK1    111\nN1    111\nK1    222\nK1    333\nN1    444\nR1    111\nR1    222\nD1    333\nE1    444\nT1    555\n</code></pre>\n\n<p>One threadUid is only used for a same group of users.</p>\n\n<p>K1 and N1 can on only have same ThreadUid.</p>\n\n<p>if I know UserUid: K1 and N1</p>\n\n<p>How can I know if K1 and N1 has a same ThreadUid?</p>\n\n<p>Is there a way to get ThreadUid based on the provided UserUid? Seems impossible...</p>\n\n<h2>------------</h2>\n\n<p>If the UserUid is K1 and N1\nResult will be 111</p>\n\n<p>If the UserUid is K1 and T1\nResult will be empty</p>\n\n<p>If the UserUid is N1 and E1\nResult will be 444</p>\n"},{"tags":["sql-server-2008","ssrs-2008","bids"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":75,"score":1,"question_id":12890074,"title":"Query not working in SSRS 2008, or BIDS 2008, but does in SSMS","body":"<h1>Environment</h1>\n\n<hr>\n\n<h3>DB Server (DWH prod &amp; dev + SSRS prod)</h3>\n\n<ul>\n<li>Win XP SP3</li>\n<li>SQL Server 2008 Ent</li>\n<li>Corporate LAN</li>\n<li>No remote query timeout restrictions for DWH, i.e. they are set to <code>0</code></li>\n<li><code>600</code> seconds for remote query timeout set for the SSRS DB server</li>\n<li>No restrictions on concurrent connections, i.e. they are set to <code>0</code></li>\n<li>TCP/IP <code>KeepAlive</code> property for the SQL Servers = <code>30000</code></li>\n</ul>\n\n<h3>Dev Box</h3>\n\n<ul>\n<li>Win XP SP3</li>\n<li>BIDS 2008</li>\n</ul>\n\n<h3>Shared Data Source (used by the .rdl)</h3>\n\n<ul>\n<li>Uses the machine name for the server, no aliases</li>\n<li>Permissions are all ok</li>\n</ul>\n\n<p><br/></p>\n\n<h1>Problem</h1>\n\n<hr>\n\n<p>The error returned by BIDS when looking at the 'Preview' tab of the report comes up with this after about 1 minute (the query takes ~1 min 10 seconds in SSMS - <strong>Edit: 2012-10-16</strong> Have now replicated error in SSRS itself by deploying report to Report Manager and attempting to run the report: <em>exception stack trace added below</em>):</p>\n\n<blockquote>\n  <p>An error occurred during local report processing.</p>\n  \n  <p>An error has occurred during report processing.</p>\n  \n  <p>Query execution failed for dataset 'MainData'.</p>\n  \n  <p>A transport-level error has occurred when receiving results from the server. (provider: TCP Provider, error: 0 - The specified network name is no longer available.)</p>\n</blockquote>\n\n<ul>\n<li>The query has been tested, with the end-user account that has <code>db_datareader</code> permissions, against both prod and dev db servers, and works fine in SSMS.</li>\n<li>This account is used for execution of the .rdl at runtime by end-users.</li>\n<li>SSMS was used to verify the queries are syntactically correct, and returned a full and complete result set with no errors and no warnings.</li>\n</ul>\n\n<p><br/></p>\n\n<h1>The Query Structure (listed as such for brevity)</h1>\n\n<hr>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED\nSET NOCOUNT ON\nSET ANSI_WARNINGS OFF\n\n/********************************************************** \n    CTE to be used to clean strings\n***********************************************************/\n;WITH\n    CTE_1           AS  ( SELECT SomeData )\n    ,CTE_2          AS  ( SELECT SomeData )\n    ,Recursive_CTE  AS  ( SELECT SomeData )     -- String cleaning performed here\n    ,CTE_3          AS  ( SELECT SomeData )\n\n/**************************     \n Data set returned here\n***************************/\nSELECT\n    Column_1\n    ,Column_2\n    ,Column_3\n    .\n    .\n    .\n    ,Column_n\nFROM\n    Fact\n    INNER JOIN  Dimension_1     AS 1        ON Fact.Key_1   = 1.Key_1\n    INNER JOIN  Dimension_2     AS 2        ON Fact.Key_2   = 2.Key_2\n    INNER JOIN  Dimension_3     AS 3        ON Fact.Key_4   = 3.Key_3\n    INNER JOIN  Dimension_5     AS 4        ON Fact.Key_4   = 4.Key_4\n    LEFT JOIN   CTE_3           AS clean    ON 4.Key_4      = clean.Key_4   -- Clean names returned in query and used in GROUP BY clause    \nWHERE\n    Condition_1 = Test_1\n    AND Condition_2 = Test_2\n    AND Condition_3 = Test_3\n    .\n    .\n    .\n    AND Condition_n = Test_n\nGROUP BY\n    Group_1 \n    ,Group_2\n    ,Group_3\n    .\n    .\n    .\n    ,Group_n\nORDER BY\n    Group_1 \n    ,Group_2\n    ,Group_3\n    .\n    .\n    .\n    ,Group_n\n</code></pre>\n\n<p><br/></p>\n\n<h3>Notes (not sure if any of this will be helpful or not):</h3>\n\n<ul>\n<li>The recursive CTE only carries out 24 recursions.</li>\n<li>All keys are <code>PRIMARY KEY CLUSTERED INDEXES</code></li>\n</ul>\n\n<p><br/></p>\n\n<h1>Question(s)</h1>\n\n<hr>\n\n<ol>\n<li>Where to look to start diagnosing what the issue actually is?</li>\n<li>How to fix the issue once it is identified?</li>\n</ol>\n\n<p><br/></p>\n\n<h1>What I have done so far...</h1>\n\n<hr>\n\n<p><strong>2012-10-15</strong></p>\n\n<ul>\n<li>Hunted on the Google machine to no avail.</li>\n<li>Spoke with other team members who have seen this occur, and they think it may be performance related, i.e. query is taking too long to run, or they think there may be stricter SQL code validation/syntax checking carried out by SSRS, or the connectors it uses.</li>\n</ul>\n\n<hr>\n\n<p><strong>2012-10-16</strong></p>\n\n<pre><code>ERROR: Throwing Microsoft.ReportingServices.ReportProcessing.ReportProcessingException: Query execution failed for dataset 'DataSet1'., ;\n Info: Microsoft.ReportingServices.ReportProcessing.ReportProcessingException: Query execution failed for dataset 'DataSet1'. ---&gt; System.Data.SqlClient.SqlException: A transport-level error has occurred when receiving results from the server. (provider: TCP Provider, error: 0 - The specified network name is no longer available.)\n   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)\n   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj)\n   at System.Data.SqlClient.TdsParserStateObject.ReadSniError(TdsParserStateObject stateObj, UInt32 error)\n   at System.Data.SqlClient.TdsParserStateObject.ReadSni(DbAsyncResult asyncResult, TdsParserStateObject stateObj)\n   at System.Data.SqlClient.TdsParserStateObject.ReadNetworkPacket()\n   at System.Data.SqlClient.TdsParserStateObject.ReadBuffer()\n   at System.Data.SqlClient.TdsParserStateObject.ReadByte()\n   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)\n   at System.Data.SqlClient.SqlDataReader.ConsumeMetaData()\n   at System.Data.SqlClient.SqlDataReader.get_MetaData()\n   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)\n   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)\n   at System.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)\n   at System.Data.Common.DbCommand.System.Data.IDbCommand.ExecuteReader(CommandBehavior behavior)\n   at Microsoft.ReportingServices.DataExtensions.SqlCommandWrapperExtension.ExecuteReader(CommandBehavior behavior)\n   at Microsoft.ReportingServices.OnDemandProcessing.RuntimeDataSet.RunDataSetQuery()\n   --- End of inner exception stack trace ---\n</code></pre>\n\n<ul>\n<li>The above exception occurs multiple times in the log for the same dataset -> Possible cause could be the recursion in the CTE??</li>\n<li>I've checked TCP/IP settings at the DWH DB Server and SSRS DB Server levels. Both have the <code>KeepAlive</code> property set to <code>30000</code>, i.e. 30 seconds -> Possible cause of dropping the connection?</li>\n<li>Similar issue resolution (based on stack trace) found <a href=\"http://support.microsoft.com/kb/555938\" rel=\"nofollow\">here</a> for queries against Visual Studio 2005. I de-selected <code>Tools &gt; Options &gt; Database Tools &gt; Query and View Designers &gt; Cancel long running query</code> (it was set to 30 seconds). No change (nor would this client setting affect the report once deployed to the SSRS server I believe, but thought I'd give it a shot)</li>\n<li>Found <a href=\"http://blogs.msdn.com/b/sql_protocols/archive/2005/09/28/474698.aspx\" rel=\"nofollow\">this</a> that states <code>OBDC connection attempt when server is not ready to process a new local connection, possibly due to overload</code> -> Could recursive CTE's cause an overload like this when SSRS submits the query to the DWH server (even though I'm not making an ODBC conenction)??</li>\n<li>Found <a href=\"http://www.sqlservercentral.com/Forums/Topic652500-147-1.aspx#bm653337\" rel=\"nofollow\">this</a> that states SSRS doesn't like virtual tables (doesn't mention why, and provides no reference) -> Possible re-write of query required?</li>\n<li>Responded to comments re: network diagnostics</li>\n</ul>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":85,"score":1,"question_id":12904087,"title":"Delete script SQL Server 2008","body":"<p>Here is a situation that I am trying to resolve. I have a table that is loaded with duplicates. It happened because similar rows were loaded from two different sources. That is being taken care of in the package.</p>\n\n<p>But I want to delete those rows which are duplicates. There is no key attribute here (I can't use no PK). The two <strong>sources</strong> are Cleveland City and Ohio State. And I have a column that shows from which source the row was loaded from (<code>DataSource</code> column).</p>\n\n<p>Thus in the row it shows as <code>DataSource = 'Cleveland'</code> or <code>DataSource = 'OhioState'</code>.</p>\n\n<p>Below is a sample which I am stuck with. Could you guys have a different approach to delete those rows mine doesn't seem to be working well? Thanks again guys .. I don't think the way I am trying to approach is even correct...</p>\n\n<pre><code>    IF OBJECT_ID('tempdb..#Ohio') IS NOT NULL \n     BEGIN \n     DROP TABLE #Ohio\n     END \n\n  ;WITH Oh AS \n    ( SELECT ROW_NUMBER()OVER\n      (\n        PARTITION by UID,ADDRESS,CITY,STATE,Zip\n          ORDER BY \n            UID\n       ) AS IA,UID,ADDRESS,City,State,Zip FROM F_staRes\n     ) \n    SELECT * INTO #Ohio   FROM Oh WHERE IA&gt; 1   AND  DataSource='Ohio'  \n\n    IF OBJECT_ID('tempdb..#Clevland') IS NOT NULL \n    BEGIN \n   DROP TABLE #Clevland\n   END \n\n    ;WITH Cle AS \n     ( SELECT ROW_NUMBER()OVER\n      (\n           PARTITION by UID,ADDRESS,CITY,STATE,Zip\n       ORDER BY \n        UID\n         ) AS CE,UID,ADDRESS,City,State,Zip FROM F_staRes\n         ) \n   SELECT * INTO #Clevland   FROM Cle WHERE CE&gt; 1  AND  DataSource!='Ohio' \n\n    select * from #Clevland--I want to delete this records\n     Intersect \n     select * from #Ohio\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":46,"score":1,"question_id":12905699,"title":"SQL Server - Query to return groups with multiple distinct records","body":"<p>My table:</p>\n\n<pre><code>Col1    Col2\n1       xyz\n1       abc\n2       abc\n3       yyy\n4       zzz\n4       zzz\n</code></pre>\n\n<p>I have a table with two columns. I want to query for records where col1 has more than one DISTINCT col2 values. In the example table given above, the query should return records for col1 with value \"1\".</p>\n\n<p>Expected query result: </p>\n\n<pre><code>Col1    Col2 \n1       xyz \n1       abc\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12906949,"title":"How elimate the tab space in the column in SQL Server 2008","body":"<p>I have an column with email in table <code>customer</code> where the data in the column contains special character: TAB</p>\n\n<p>When I do a select, I need to remove the TAB space from that column.</p>\n\n<p>Means there is an empty TAB space followed by the <strong>EmailID:     xyz.com</strong></p>\n\n<p>I tried using the <code>LTRIM</code> and <code>RTRIM</code> but that does not work here</p>\n\n<p>Your help is really appreciated.</p>\n\n<p>Thanks\nPrince</p>\n"},{"tags":["sql-server-2008","ms-access-2007"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":37,"score":0,"question_id":12907007,"title":"How to order by frequency without aggregating?","body":"<p>Overview: <br>Compare day to day trades for produce as agent for various accounts to find difference between agent and company holdings showing only what is new; codes in current trades, but not previous trades.</p>\n\n<p>Objective: <br>Sort the trades by code (i.e. apples) with highest frequency.</p>\n\n<p>Current Code:</p>\n\n<pre><code>SELECT \n    Count(CurrentTrade.Code) AS CountOfCode, \n    CurrentTrade.portfolio_code, \n    CurrentTrade.Type, \n    CurrentTrade.Code, \n    sum(CurrentTrade.Custodian_holding) AS AgentHolding, \n    sum(CurrentTrade.Company_holding) AS CompanyHolding, \n    sum(CurrentTrade.Difference) AS TotalDifference\nFROM \n    CurrentTrade \n    LEFT JOIN PrevTrade \n    ON CurrentTrade.Company_holding = PrevTrade.Company_holding\nWHERE \n    PrevTrade.Company_holding) Is Null\nGROUP BY CurrentTrade.Code, CurrentTrade.portfolio_code, CurrentTrade.Code, CurrentTrade.Type\nORDER BY count(CurrentTrade.Code);\n</code></pre>\n\n<p>Current Results:</p>\n\n<pre><code> CountOfCode        account_code        Type        Code        AgentHodling        CompanyHolding        TotalDifference\n 1                  acc001049        prod        mango        2500                  0        2500\n 1                  acc636903        prod        mango        481081.29        481081.285        0.01\n 1                  acc179186        prod        mango        453639.61        511285.81        -57646.2\n 1                  acc179185        prod        mango        2775               2650        125\n 1                  acc170001        prod        grapes       0                     1500        -1500\n 1                  acc170000        prod        grapes       2500        0        2500\n 1                  acc107104        prod        apple        49797.22        49797.28        -0.06\n 1                  acc107103        prod        apple        0        -0.06        0.06\n 1                  acc107102        prod        apple        2000        500        1500\n 1                  acc107101        prod        apple        0        1500        -1500\n 1                  acc001189        prod        apple        0        1090.513        -1090.513\n</code></pre>\n\n<p>Reference:</p>\n\n<p>I received an answer to this (<a href=\"http://stackoverflow.com/questions/12888829/order-by-count-not-sorting-correctly-sql-ms-access-2007\">Order by count not sorting correctly - SQL (MS Access 2007)</a>) so this is a follow up.</p>\n\n<p>Question:</p>\n\n<p>Is it possible to order by frequency without aggregating all of the the results and still show order by highest frequency (apple, mango, grapes) including the account numbers associated?  <br>If use sum for the order by, Cannot have aggregate function in ORDER BY so I'm not sure I can do this and still keep the account numbers separate?</p>\n"},{"tags":["sql-server-2008","reporting-services"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":115,"score":2,"question_id":12850524,"title":"SSRS - Grand Total of Group Expression Totals","body":"<p>My group total is an expression which subtracts the last <code>[Hours1]</code> value from the first <code>[Hours1]</code> value of the group <code>[EquipmentName1]</code> of the dataset \"dataset1.</p>\n\n<p>I need a Grand Total the group expression totals for each piece of equipment</p>\n\n<p>I am unable to use the same formula of subtracting last [Hours1] value from the first [Hours1] value of the dataset \"dataset1\" because.</p>\n\n<p>If I had 2 pieces of equipment, say Equipment1 and Equipment2:</p>\n\n\n\n<pre class=\"lang-none prettyprint-override\"><code>Equipment1 last [Hours1] = 10000 and first [Hours1] = 9500\nEquipment2 last [Hours1] = 10500 and first [Hours1] = 10000\n</code></pre>\n\n<p>If I used the formula of subtracting last <code>[Hours1]</code> value from the first <code>[Hours1]</code> value of the dataset <code>\"dataset1\"</code> the formula would be 10500 - 9500</p>\n\n<p>However, I want:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>(10000 - 9500) + (10500 - 10000) = Grand Total\n</code></pre>\n\n<p>Below is an attempt to draw part of my table</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>|_[Hours1]_|  =  Fields!Hours1.Value    \n(e.g. 9500)\n\n|___Expr___|  =  Last(Fields!Hours1.Value) - First(Fields!Hours1.Value) \n(e.g. 10000 - 9500 = 500)\n\n|__________|  =  I need to total the value of Expr for all pieces of equipment\n</code></pre>\n"},{"tags":["performance","sql-server-2008","stored-procedures","jdbc","clr"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12869062,"title":"SQL Server 2008 x64 Express Batch Insert Throughput Performance to CLR 'Instead Of Insert' Trigger","body":"<p>I have a simple NO-OP CLR Trigger being fired on a six field table with schema:</p>\n\n<pre><code> datetime (PK)\n char (PK)\n int (PK, FK)\n varchar(1)\n tinyint\n real\n</code></pre>\n\n<p>which should be a total of 19 bytes / row inserted.</p>\n\n<p>The FK in the above points to a table with schema:</p>\n\n<pre><code> int (PK)\n nchar(10)\n ncahr(10)\n nchar(10)\n nchar(10)\n</code></pre>\n\n<p>I am performing batch inserts using a prepared statement every 1000 rows. I am getting for 150K rows inserted an execution time of about 11s. This corresponds to a throughput of ~.24MB/s (150,000*19B / 11s). Why so slow? I am not even talking to the disk?</p>\n\n<p>I know that my client side code doing the sending is much faster. If I comment out the:</p>\n\n<pre><code> executeBatch()\n</code></pre>\n\n<p>method in the client I get upwards of 5MB/s. What else is going on with the JDBC/ODBC connection and processing in SQL Server to make things so slow?</p>\n\n<p>Is this really the throughput one can expect from SQL Server and an JDBC/ODBC connection in this case?</p>\n\n<p>---EDIT---</p>\n\n<p>The actual CLR code is very simple, literally an empty method:</p>\n\n<pre><code> public class Triggers\n {\n     [SqlTrigger(Name = \"InsertHook\", Target = ConfigConstants.TABLE_NAME, Event =   \"INSTEAD OF INSERT\")]\n     public static void InsertHook()\n     {\n       //empty\n     }\n }\n</code></pre>\n\n<blockquote>\n  <p>No-op in T-SQL Stored Procedure Total Measured Time was:3475297036ns\n  or 3.475297036sec INSERT COUNT:150000\n  0.783276657MB/s\n  43165.47 Rows/s</p>\n  \n  <p>INSERTING NORMAL into SQL Server Total Measured Time was:4884190118ns\n  or 4.884190118sec INSERT COUNT:150000 MB Sent:2.7179718017578125\n  0.556MB/s\n  30712.53 Rows/s</p>\n</blockquote>\n\n<p>Sadly, I do not have control over the schemas I am working with here. I guess I am still shocked that even with one FK constraint that this is the best SQL Server can do?</p>\n\n<p>In summary, if I had to rank the performance. It would be:</p>\n\n<blockquote>\n  <p>1) T-SQL NO-OP Instead of Trigger (Fastest) - 0.78MB/s  </p>\n  \n  <p>2) Inserting Normal - 0.56MB/s </p>\n  \n  <p>3) CLR NO-OP Stored Procedure Instead of Trigger - .24MB/s</p>\n</blockquote>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql","pivot"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":607,"score":1,"question_id":8912813,"title":"SQL Server 2008 Pivot Query","body":"<p>I have data in a SQL Server 2008 table that looks like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/bh7TV.png\" alt=\"enter image description here\"></p>\n\n<p>I want to pivot it to look like this:</p>\n\n<p><img src=\"http://i.stack.imgur.com/85Tl2.png\" alt=\"enter image description here\"></p>\n\n<p>Basically I want to group on ReadTime and Coater and then pivot on the DataType column. Could someone help me with the T-SQL to do this?</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":88,"score":1,"question_id":12900658,"title":"How to get level and count for item in recursive query","body":"<pre><code>WITH cte(folder_id, parent_id, folder_name)\nAS\n(\n    select folder.folder_id, folder.parent_id, folder.folder_name\n    FROM Folder_Table [folder] \n        JOIN File_Table [file] on [folder].[folder_id] = [file].[folder_id]\n    union all\n    select Folder_Table.folder_id,Folder_Table.parent_id,Folder_Table.folder_name\n    from cte \n        join Folder_Table on cte.parent_id = Folder_Table.folder_id\n)\nSELECT distinct * FROM cte\n</code></pre>\n\n<p>at this query i need to get the level of items and the count of child at the level \nif have child </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":62,"score":0,"question_id":12905041,"title":"SQL update entry that matches a username and has highest date","body":"<p>I have a table <code>saved_offers</code> in my database. What I want to do is find all of the entires that match a username, and within those results, the one that has the highest <code>date</code> field.</p>\n\n<p>Here's a simpler example: say we have a table <code>baseball_players</code>. I want to find the player who plays for the Yankees with the highest batting average, and update his <code>description</code> field to say \"has the highest batting average\".</p>\n\n<p>I'm not a SQL guru by any means, so I apologize if this is overly easy.</p>\n\n<p>I've tried just about every combination of nested SELECTs and ORDERBY's in my update statement, but so far I'm not able to find a command that works.</p>\n"},{"tags":["asp.net","sql","vb.net","sql-server-2008","charts"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12630951,"title":"Populate new chart on ReportViewer1 with SQL query information","body":"<p>I am completely new to Charts in asp.net so bear with me, I have been reading multiple multiple webpages on how bind data to the charts but I still can not get anything to show up. </p>\n\n<p>I know this probably isnt the first instance of this question, but I cant figure this out to save my life. Im hoping with a little nudge I wont need any help on this topic after this.</p>\n\n<p>Say I have a dropdown and this drop down has two items in it. On Dropdown_IndexChange it will change the data source of chart1 that is located in ReportViewer (The database is going to be local). </p>\n\n<p>Index 0 creates a bar chart with the SQL Command: \n\"SELECT [SWversion:], [Batt_Wifi:], [Batt_Standby:], [Batt_OnCall:] FROM Amaze\"</p>\n\n<p>where SWVersion are the names of the series and the other 3 are the data.</p>\n\n<p>Index 1 creates a line chart with the sql command:\n\"SELECT [SWversion:], [Wifi_Pref_IC:], [Wifi_Pref_NC:], [Wifi_Only_IC:], [Wifi_Only_NC:] FROM Amaze\"</p>\n\n<p>SWVersion works the same way here as well. </p>\n\n<p>How can I get these charts to show up and how can I attach SWVersion names to the series.</p>\n\n<p>The code I am trying to work with is this:</p>\n\n<pre><code>    Chart1.DataSource = Nothing\n    Chart1.Visible = True\n    Dim newsqlcommand As String = \"SELECT [Batt_Wifi:], [Batt_Standby:], [Batt_OnCall:] FROM Amaze\"\n    Using con As New System.Data.SqlClient.SqlConnection(connexstring)\n        con.Open()      \n        Dim myCommand = New SqlDataAdapter(newsqlcommand, con)\n        Dim ds = New DataSet()\n        myCommand.Fill(ds)\n        Chart1.DataSource = myCommand\n        con.Close()\n        con.Dispose()\n    End Using\n    Chart1.DataBind()\n</code></pre>\n\n<p>I know this is only one of the SQL Commands but Im still trying to figure out how it works. I don't recieve an error, but with this I can't even get a chart to draw.</p>\n\n<p>Thanks for any and all help </p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":170,"score":3,"question_id":6796699,"title":"Determine if a couple of zip codes are contiguous","body":"<p>My customer has sales regions where each sales region consists of a list of zip codes.\nThe regions are pretty big and could be easier stored in format like :</p>\n\n<p>Region consists of zip code range from 00602 to 10012 and 20020 to 30020.</p>\n\n<p>How can I get from a list of zip codes to a list of such zip code ranges?</p>\n\n<p><strong>Consider the following data</strong></p>\n\n<pre><code>--This would be my list of all available zip codes in us:\n\nCREATE TABLE [Zip](\n    [Zip] [nvarchar](20) ,\n    [State] [nvarchar](50) ,\n)\n\n--This would be the Sales Region List\n\nCREATE TABLE [dbo].[SalesRegion](\n    [AreaCode] [nvarchar](50) \n) \n\n--This would be the original large list Zip Codes for the SalesRegions\n\nCREATE TABLE [dbo].[EnteredZip](\n    [Zip] [nvarchar](20) ,\n    [AreaCode] [nvarchar](50) \n) \n\n--This is where I would like to store the Zip Code Ranges\n\nCREATE TABLE [dbo].[SearchableZip](\n    [StartZip] [nvarchar](20) ,\n    [EndZip] [nvarchar](20) ,\n    [AreaCode] [nvarchar](50) \n) \n\n--Here is my sample Data:\n\n--Some Zip Codes in US\ninsert into dbo.Zip (Zip,[State]) values ('00501'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00544'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00601'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00602'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00603'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00604'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00605'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00606'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00610'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00611'   ,'PR')\ninsert into dbo.Zip (Zip,[State]) values ('00612'   ,'PR')\n\n\n--Some Sales Regions\n\nInsert Into dbo.SalesRegion ( AreaCode ) values('Area1')\nInsert Into dbo.SalesRegion ( AreaCode ) values('Area2')\nInsert Into dbo.SalesRegion ( AreaCode ) values('Area3')\n\n\n--The zip codes of the Sales Regions\ninsert Into EnteredZip (Zip,AreaCode) values ('00544' , 'Area1')\ninsert Into EnteredZip (Zip,AreaCode) values ('00601' , 'Area1')\ninsert Into EnteredZip (Zip,AreaCode) values ('00602' , 'Area1')\n\ninsert Into EnteredZip (Zip,AreaCode) values ('00604' , 'Area2')\ninsert Into EnteredZip (Zip,AreaCode) values ('00606' , 'Area2')\n\ninsert Into EnteredZip (Zip,AreaCode) values ('00501' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00544' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00601' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00602' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00603' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00604' , 'Area3')\n\ninsert Into EnteredZip (Zip,AreaCode) values ('00610' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00611' , 'Area3')\ninsert Into EnteredZip (Zip,AreaCode) values ('00612' , 'Area3')\n</code></pre>\n\n<p>Would result in this entries in the table SearchableZip</p>\n\n<pre><code>AreaCode             StartZip             EndZip\n-------------------- -------------------- -------------------------\nArea1                00544                00602\nArea2                00604                00604\nArea2                00606                00606\nArea3                00501                00604\nArea3                00610                00612\n</code></pre>\n\n<p>Is it possible to create SearchableZip with a sql script?</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I fixed the table declaration and output data</p>\n"},{"tags":["android","sql-server","web-services","sql-server-2008","sql-server-2008-r2"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":5,"view_count":55,"score":-5,"question_id":12903362,"title":"Andriod connection for SQL Server","body":"<p>I m writing an android application , that should interacts with the SQL server 2008.</p>\n\n<p>I understand in order to get the database connection , I would have to create a webservice.</p>\n\n<p>I m very new to both Android and Web service. Any link or document in this concern would be of great help.</p>\n\n<p>Thanks !!!</p>\n"},{"tags":["sql-server","sql-server-2008","merge","case"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":47,"score":0,"question_id":12903276,"title":"SQL Server Merge with case?","body":"<p>Hello guys here with another question, regarding sql server 2008 r2 this time about the merge, is it possible to have a case inside the update portion of the merge?</p>\n\n<p>Because its telling me</p>\n\n<p>Msg 156, Level 15, State 1, Line 9\nIncorrect syntax near the keyword 'CASE'.</p>\n\n<pre><code>MERGE INTO PERSONAFISICA AS TARGET\nUSING dbo.#temp1 AS SOURCE\nON TARGET.RFC = SOURCE.RFC AND TARGET.APATERNO = SOURCE.APELLIDO_PATERNO AND\nTARGET.AMATERNO = SOURCE.Apellido_Materno\nWHEN MATCHED THEN\nUPDATE SET\nTARGET.NUM_CLIENTE = 0,\nTARGET.NOMBRE1 = LEFT(SOURCE.Nombre,CHARINDEX(' ', SOURCE.NOMBRE + ' ') -1),\nCASE \nWHEN LEN(SOURCE.NOMBRE) - LEN(REPLACE(SOURCE.NOMBRE,' ','')) &gt;= 1\nTHEN \nTARGET.NOMBRE2 = SUBSTRING(SOURCE.NOMBRE, CHARINDEX(' ', SOURCE.NOMBRE)+1, LEN(SOURCE.NOMBRE))\nELSE '' END,\nTARGET.APATERNO = SOURCE.Apellido_Paterno,\nTARGET.AMTERNO = SOURCE.Apellido_Materno,\nCASE \nWHEN SOURCE.SEXO = 'F' \nTHEN TARGET.IDGENERO = 2\nWHEN SOURCE.SEXO = 'M'\nTHEN TARGET.IDGENERO = 1\nELSE TARGET.IDGENERO = 0\nEND,\nCASE\nWHEN SOURCE.ESTADO_CIVIL = '0' \nTHEN TARGET.idestado_civil = 0\nWHEN SOURCE.ESTADO_CIVIL = 'C'\nTHEN TARGET.idestado_civil = 1\nWHEN SOURCE.ESTADO_CIVIL = 'D' \nTHEN TARGET.idestado_civil = 2\nWHEN SOURCE.ESTADO_CIVIL = 'S'\nTHEN TARGET.idestado_civil = 3\nWHEN SOURCE.ESTADO_CIVIL = 'V' \nTHEN TARGET.idestado_civil = 5\nWHEN SOURCE.ESTADO_CIVIL = 'U'\nTHEN TARGET.idestado_civil = 6\nELSE TARGET.idestado_civil = 0\nEND,\nTARGET.idregimen = 0,\nTARGET.saludo = SOURCE.SALUDO,\nTARGET.conyuge_nombre1 = '',\nTARGET.conyuge_nombre2 = '',\nTARGET.conyuge_apaterno = '',\nTARGET.conyuge_nombre2 = '',\nTARGET.dependiente = 0,\nTARGET.edad_dependiente = '',\nTARGET.ididentificacion = 0,\nTARGET.fecha_nacimiento = '1800-01-01',\nTARGET.rfc = SOURCE.RFC,\nTARGET.CURP = '',\nTARGET.idnacionalidad = 0,\nTARGET.email = SOURCE.Email_Personal,\nTARGET.idescolaridad = SOURCE.Escolaridad\nWHEN NOT MATCHED THEN\nINSERT (num_cliente, nombre1, nombre2, apaterno, amaterno, idgenero, idestado_civil,\nidregimen, saludo, conyuge_nombre1, conyuge_nombre2, conyuge_apaterno, conyuge_amaterno, dependiente,\nedad_dependiente, ididentificacion, fecha_nacimiento, rfc, curp, idnacionalidad, email, idescolaridad)\nVALUES (0, LEFT(nombre,CHARINDEX(' ',nombre + ' ')-1) AS [Primer Nombre],\nCASE WHEN LEN(nombre) - LEN(REPLACE(nombre,' ','')) &gt;= 1  THEN SUBSTRING(nombre, CHARINDEX(' ', nombre)+1, LEN(nombre)) ELSE '' END AS [Segundo Nombre],\nApellido_Paterno,Apellido_Materno)\nCASE \nWHEN SEXO = 'F' THEN 2\nWHEN SEXO = 'M' THEN 1\nELSE 0\nEND,\nCASE \nWHEN Estado_Civil = '0' THEN 0\nWHEN Estado_Civil = 'C' THEN 1\nWHEN Estado_Civil = 'D' THEN 2\nWHEN Estado_Civil = 'S' THEN 3\nWHEN Estado_Civil = 'V' THEN 5\nWHEN Estado_Civil = 'U' THEN 6\nELSE 0\nEND, 0, Saludo,'','','','',0,'',0,'1800-01-01',RFC,'',0,Email_Personal,Escolaridad\n</code></pre>\n"},{"tags":["c#","winforms","visual-studio-2010","sql-server-2008","ssms2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":45,"score":1,"question_id":12902919,"title":"Automatically import table columns into form design","body":"<p>So far, I found C# on SQL Server impressively easy to develop with (when relying on the IDEs to walk you through completion).</p>\n\n<p>So it comes as no surprise that I expect a feature that may or may not be available with Visual Studio 2010 &amp; SQL Server 2008 Express:</p>\n\n<p>Instead of manually dragging <code>TextBox</code>es from the ToolBar into the Windows Form, then typing their names, etc. to associate them with a fields/columns in a table... is it possible to tell Visual Studio to automatically populate the form with <strong>all</strong> columns from a particular table?</p>\n\n<p>If so, how does one accomplishes that?</p>\n"},{"tags":["sql-server","sql-server-2008","amazon-ec2","ec2-ami"],"answer_count":6,"favorite_count":3,"up_vote_count":12,"down_vote_count":0,"view_count":4708,"score":12,"question_id":2781128,"title":"Amazon EC2 Instance - How to find SQL Server Password","body":"<p>I have created an Amazon EC2 Instance that provides Windows Server 2008 with SQL Sever 2008 pre-installed. Now in order to use the SQL Server for creating databases, or restoring backups of the databases that I have on my local machine, I need the \"sa\" password for SQL Server 2008.</p>\n\n<p>I have tried using the following but with no luck:</p>\n\n<ol>\n<li>sa</li>\n<li>password</li>\n<li>\"blank password\"</li>\n<li>\"same password as the admin password for my EC2 instance\"</li>\n</ol>\n\n<p>Could someone please guide me as to how to get started with using the Amazon EC2 Datacenter with respect to the \"sa\" password. </p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12902852,"title":"Does Count (*) skew desired results when performing additional join?","body":"<p>My query works fine; however, I need to join another dataset to my query, and I expect that the <code>count(f.*)</code> will break.</p>\n\n<p>Here's the query I start with:</p>\n\n<pre><code>SELECT\n       MIN(received_date) AS FirstVisit\n     , patient_id         AS PatientID\nINTO #LookupTable\nFROM F_ACCESSION_DAILY\n\nSELECT \n       f.doctor           AS Doctor\n     , COUNT(f.*)         AS CountNewPatients\n     , MONTH(firstvisit)  AS Month\n     , YEAR(firstvisit)   AS Year\nFROM F_ACCESSION_DAILY f \nINNER JOIN #LookupTable l ON f.received_date = l.FirstVisit \n                         AND f.patient_id = l.PatientID\nGROUP BY f.doctor\n       , MONTH(firstvisit)\n       , YEAR(firstvisit)\n\nDROP TABLE #LookupTable\n</code></pre>\n\n<p>I would like to Join the above query on another table. </p>\n\n<p>The question is <strong>*<em>will my <code>count(f.*)</code> stay the same or will it change because I've added a new dataset?</em>*</strong></p>\n\n<p>*<strong>*How do I make sure that the <code>count(f.*)</code> will remain the same?</strong></p>\n\n<p>Thank you so much for your guidance.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":11154225,"title":"SQL aggregation functions","body":"<p>Given the following table </p>\n\n<pre>Month        Product  Sales\n---------    -------  -----    \nJanuary         1      10\nJanuary         2      15\nFebruary        3      23\nMarch           1      15</pre>\n\n<p>The query I've used is:</p>\n\n<pre><code>SELECT DISTINCT a.* FROM( -- possibly needed for where clause\n    SELECT dateadd(month, x.MonthOffset,0) AS mes, x.produto, Sum(x.quantidade) AS vendas\n    FROM\n    (\n        SELECT DATEDIFF(month, 0, a.data) AS MonthOffset, a.produto, a.quantidade\n        FROM (\n          SELECT l.*, fc.data FROM LINHAS AS l JOIN FacturaCli AS fc\n              ON fc.codigo = l.codigo \n              UNION ALL\n          SELECT l.*, ff.dataEmisso FROM LINHAS AS l JOIN FacturaForn AS ff\n              ON ff.codigo = l.codigo\n        ) AS a\n    ) AS x\n    GROUP BY MonthOffset, produto\n) AS a\n</code></pre>\n\n<p>I would like to get the product with more sales per month.</p>\n\n<p>I'm having trouble doing query that requires a field that must not be in \"aggregate group\".\nNote that the table I provided is a result from a query.</p>\n\n<p>I'm using SQL Server 2008. I can't use temporary variables or <code>over</code> clause.\n<strong>I wouldn't like to repeat the query that lead me to this table!</strong> But if it is the only way, it's ok.</p>\n\n<p>Expected result:</p>\n\n<pre>Month        Product  Sales\n---------    -------  -----    \nJanuary         2      15\nFebruary        3      23\nMarch           1      15</pre>\n"},{"tags":["sql-server","database","sql-server-2008","data"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":30,"score":0,"question_id":12902001,"title":"Similar feature as virtual private databases for IBM DB2/SQL Server?","body":"<p>is there a similar feature as virtual private database (VPD) for IBM DB2 and SQL Server? (I know VPD is available for Oracle DB) What is the name of the tool/program that is an alternative for VPD for IBM and/or Microsoft? </p>\n"},{"tags":["sql-server-2008","tsql","stored-procedures"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":64,"score":0,"question_id":12899827,"title":"Indenting records with space in a T-SQL stored procedure","body":"<p>I have a stored procedure that returns records based on a <code>Department ID</code>:  </p>\n\n<pre><code>Employee Name                ManagerID         SupervisorID                ID  \n    John Smith                  1                     1                      1  \n    Tom Jones                   1                     2                      2  \n    Robert Thompson             1                     2                      3\n    Jennifer Stevens            1                     4                      4  \n</code></pre>\n\n<p>I want to indent the records that are returned as follows:  </p>\n\n<ul>\n<li>If ManagerID = ID (no indentation)  </li>\n<li>If SupervisorID = ID (2 spaces indented)  </li>\n<li>Else (4 spaces indented)*</li>\n</ul>\n\n<p>Something like:</p>\n\n<pre><code>John Smith  \n   Tom Jones  \n       Robert Thompson  \n   Jennifer Stevens\n</code></pre>\n\n<p>How would I accomplish that?</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":3666,"score":1,"question_id":3159810,"title":"Token-based server access validation failed with an infrastructure error","body":"<p>I would appreciate help with the following issue:</p>\n\n<p>I have created a local group in our SQL 2008 server and added two Windows user accounts \"DOMAIN\\UserName\"  I  then added the local group to the database and granted read only access.</p>\n\n<p>The users are trying to link tables using MS Access using and ODBC connection and getting the following error.\nUsers are not system administrators.</p>\n\n<p>Date 6/30/2010 1:01:54 PM\nLog SQL Server (Current - 6/30/2010 1:10:00 PM)\nSource Logon\nMessage\nLogin failed for user 'DOMAIN\\UserName'. Reason: Token-based server access validation failed with an infrastructure error. Check for previous errors. [CLIENT: 999.99.9.99]\n\nDate        6/30/2010 1:01:54 PM\nLog     SQL Server (Current - 7/1/2010 8:12:00 AM)</p>\n\n<p>Source      Logon</p>\n\n<p>Message\nError: 18456, Severity: 14, State: 11.</p>\n\n<p>Database Server:\nwindows Server 2008 R2 Enterprise \nSystem type: 64-bit Operating System \nSQL Server 2008</p>\n"},{"tags":["oracle","sql-server-2008","oracle10g"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":76,"score":0,"question_id":12863579,"title":"vertical output","body":"<p>I have column name in the table:</p>\n\n<pre><code>select LASTNAME\n  FROM dbo.Employees\n WHERE LASTNAME = 'Smith'\n</code></pre>\n\n<p>and output of the above query is</p>\n\n<pre><code>LASTNAME\nSmith\n</code></pre>\n\n<p>I want output like</p>\n\n<pre><code>   LASTNAME\n      S\n      m\n      i\n      t\n      h\n</code></pre>\n"},{"tags":["sql-server-2008","reporting-services","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":55,"score":0,"question_id":12899215,"title":"SSRS 2008 R2 on Server 2008 XML Data extension error","body":"<p>I have an MVC 3 project that shows soem reports through SSRS.  I have everythign set up on a Windows 7 computer and it works fine.  We just installed Server 2008 on a new computer and I am trygin to get everythign running through IIS.  Everythign works fine except for the Data Source that I use for the reports.  I have it grabbing XML data from a Web Service to show in the report.  When I deploy all the report information to the Server 2008 SQL instance I get the following error when I look at the Data Source.</p>\n\n<p>The data processing extension used for this report is not available. It has either been uninstalled, or it is not configured correctly.</p>\n\n<p>If I lookin the Data Source Type dropdown the only option is SQL Server.  XML is not listed.  What do I need to do.  From what I read XML was supposed to be supported automatically without any setup.</p>\n"},{"tags":["sql","sql-server-2008","stored-procedures","csv"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":59,"score":0,"question_id":12900076,"title":"How to work with CSV values in stored procedure?","body":"<p>I have CSV values stored in string as:</p>\n\n<pre><code>    StringBuilder CSValue = new StringBuilder();\n    for (int i = 0; i &lt; obj._contactNumbers.Count; i++)\n    {\n        CSValue.Append(obj._contactNumbers[i]);\n        if (i != obj._contactNumbers.Count - 1)\n        {\n            CSValue.Append(\",\");\n        }\n    }\n</code></pre>\n\n<p>I have passed it to stored procedure (as CSValue.ToString()), now i have to pick each value and store it in cell. How should i seperate these values?? </p>\n\n<p>Please help me out!</p>\n"},{"tags":["sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":40,"score":2,"question_id":12899635,"title":"SQL server 2008 concatenation","body":"<p>I am concatenating Address fields to put street address together in SELECT statement of  SQL Server 2008 R2. How do I use IIF/CASE statement to add 'Apt#' if apartment field is not null?</p>\n\n<pre><code>SELECT ISNULL(RTRIM(StreetNo),'') + ' ' \n    +  ISNULL(RTRIM(StPfx),'')+ ' ' \n    + ISNULL(RTRIM(Street),'')   + ' ' \n    + ISNULL(Stfx, ' ') + ' ' \n    + ISNULL(RTRIM(Apt),'') HOME_ADDRESS  \n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":69,"score":2,"question_id":12899727,"title":"SQL - Check if all the columns in one table also exist in another","body":"<p>I have 2 tables (say A and B) in a MS SQL DB representing customer transactions. Both share a column (say Column X).</p>\n\n<p>Ideally information in table B is a subset of information in table A.</p>\n\n<p>Can I run a SQL query to check based on Column X if all the values in Table B are present in Table A?</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server-2008","tsql","tags"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12899619,"title":"GUID vs Identity for use with tags","body":"<p>I know this subject has been discussed at length (I have read lots of posts here and all over the web) and I don't like to flog a dead horse but I have a question about a more specific aspect of Integer ID vs GUID:</p>\n\n<p>I am writing out a schema which is going to have a tagging ability similar in use to the stackoverflow tags but it will have the same tags used against 5+ different tables.</p>\n\n<p>The basic tables I will be linking are as follows:</p>\n\n<p><strong>Tag Table</strong></p>\n\n<pre><code>Tag ID    Tag Name      Tag Description\n-------------------------------------------------------------\n     1    Hats          Tag for hats\n     2    Coats         Tag for coats\n     3    Gloves        Gloves tag\n     4    Ladies        Ladies item\n</code></pre>\n\n<p><strong>Items Table 1</strong></p>\n\n<pre><code>Item ID    Item Name    Cost\n------------------------------------------------------------\n      1    Deerstalker  20.00\n      2    Fedora       50.00\n      3    Scarf        15.00\n</code></pre>\n\n<p>The bit I'm having trouble with is the <code>tag_item</code> table.</p>\n\n<p>I will have 5 tables with completely different structures that I want the users to be able to apply tags to so I think I'll need to do one of the following:</p>\n\n<ul>\n<li>Store <code>table name</code>/<code>table number</code> as well as the integer key of the row the tag relates to</li>\n<li>Store a <code>GUID</code> of the row, this will work independent of the table and make it much easier to get all tags for a certain row.</li>\n</ul>\n\n<p>What I'm unsure of is how this will affect performance for:</p>\n\n<ul>\n<li>Searching for all items over 5 tables with a certain tag/tags</li>\n<li>editing the tags for an item</li>\n<li>joins</li>\n</ul>\n\n<p>Is there any clearly better option in this case or anywhere I could read up on the advantages in this particular scenario?</p>\n"},{"tags":["sql-server-2008"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":25,"score":-1,"question_id":12898763,"title":"Transaction Log Dates","body":"<p>I'm noticing that the dates on my MDF files are staying up to date (e.g. the Last Modified Date is current); however, the same date on the LDFs for the same databases have not changed in over a month. I've confirmed that the files are indeed the ones being used but I'm very surprised that the dates are not current. We are doing regualr standard maintenance on all of the databases.</p>\n\n<p>My question is more academic than functional. Why would these dates get out of synch?</p>\n"},{"tags":["sql-server-2008","openrowset"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":49,"score":-1,"question_id":12897096,"title":"Importing dates from Excel 2007 to sql server 2008 is not importing 'seconds' portion into the db table","body":"<p>In Excel, If I keep the cell formatting as 'Text' and import mixed type data (dates,string,int etc) from excel to sql server (I am using OpenDataSource for import), then the 'seconds' portion of the date (02/27/12 07:00:04) gets imported successfully to the database table as the case should be. </p>\n\n<p>However, when I am exporting mixed type data (dates,string,int etc) from Sql Server 2008 to Excel 2007 (I am using OpenRowSet for export), the cell formatting of the cells \nin Excel changes to 'General' automatically after the export. Now when I make any changes to a date in the excel (02/27/12 07:00:04), then the seconds portion disappears \nfrom the excel cell (2/27/2012 7:00) but can be seen in formula bar in the excel (2/27/2012  7:00:04 AM). Also, the cell formatting automatically changes to Custom\n(m/d/yyyy h:mm) on editing the cell. The issue is that when I try to import this modified data to sql server, the seconds portion does not get imported which causes data inconsistancy.</p>\n\n<p>Alternative I have already tried is as follows:\n1) I changed TypeGuessRows = 0 in registry([HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Jet\\4.0\\Engines\\Excel]) and added IMEX=1 to export query (as follows). But this has no \neffect.\n2) I changed Excel 8.0 in query to Excel 12.0 XML. This had no effect.</p>\n\n<p>Queries for Import/Export are as follows:</p>\n\n<p>Import Query is as follows:</p>\n\n<p>INSERT INTO [Fusion].flt_RealTimeValues\nSELECT [DowntimeValues ID],[Asset Name],[Start Date]\nFROM OPENDATASOURCE('Microsoft.ACE.OLEDB.12.0',\n'Data Source=C:\\ImportExport\\50370869_8837_4a79_809e_610aae98d925_import.xlsx;Excel 8.0;IMEX=1;HDR=Yes')...[DowntimeValues$]</p>\n\n<p>Export Query is as follows:\nThis is the dynamic query that gets populated at runtime. If required, I will provide the runtime query. </p>\n\n<p>SET @sql='INSERT INTO OPENROWSET (''Microsoft.ACE.OLEDB.12.0'', ''Excel 8.0;Database='+@FilePath+';HDR=YES'',''SELECT * FROM [' + @SheetName + '$]'''+')' +@StoredQuery  + ''  </p>\n\n<p>I would really appreciate help on this. </p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":1,"view_count":90,"score":0,"question_id":12896147,"title":"Can I pass variable to select statement as column name in SQL Server","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/5637983/sql-select-dynamic-column-name-based-on-variable\">SQL: Select dynamic column name based on variable</a>  </p>\n</blockquote>\n\n\n\n<p>I have the following simple <code>select</code> statement:</p>\n\n<pre><code> DECLARE @value varchar(10) \n SET @value = 'intStep' \n\n SELECT @value FROM dbo.tblBatchDetail \n</code></pre>\n\n<p>I have tried </p>\n\n<pre><code> SELECT CAST(@value AS varchar(10)) FROM dbo.tblBatchDetail \n</code></pre>\n\n<p>and all I get a list of <code>intstep</code> </p>\n\n<p><strong>QUESTION</strong>: can I pass variable as column name to this statement? Or what is the best way of doing this </p>\n\n<p>I'm using SQL Server 2008 (9.0 RTM) </p>\n\n<p>This will be a stored procedure </p>\n\n<p>Thanks in advance </p>\n"},{"tags":["sql-server-2008","cdc"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":28,"score":0,"question_id":12896373,"title":"Creating CDC system table SQL Server 2008","body":"<p>I am facing problem with CDC tables in my database. I think few of these tables are damaged and are not capturing any audit information. I tried to disable CDC on these tables, but that did not work (I didn't even get an error). So I manually dropped a table.</p>\n\n<p>Now I cannot see the table in system tables - but its still not properly deleted. So I cannot re-enable it.</p>\n\n<p>I have got a fix here: <a href=\"http://support.microsoft.com/kb/966306\" rel=\"nofollow\">http://support.microsoft.com/kb/966306</a></p>\n\n<p>which is to manually create the CDC table of the same name in system tables - and retry disabling it.</p>\n\n<p>Now the question is how do I manually create a system table.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":4,"favorite_count":1,"up_vote_count":3,"down_vote_count":0,"view_count":755,"score":3,"question_id":7843399,"title":"Storing just Month and Year in SQL Server 2008?","body":"<p>Is it possible to save the month/year in SQL Server 2008 with a regular datetime?  I don't need a time stamp and the column is going to store unique mo/yr combinations (i.e. 10-11, 11-11, 12-11, etc,.).  </p>\n\n<p>Any recommendations?  </p>\n"},{"tags":["sql","sql-server-2008","stored-procedures"],"answer_count":2,"favorite_count":1,"up_vote_count":4,"down_vote_count":0,"view_count":44,"score":4,"question_id":12895090,"title":"what is the use of PLI keyword?","body":"<p>while writing some stored procedures in ms sql 2008, as I was typing some variable names I noticed that PLI was highlighted as a keyword.</p>\n\n<p>Does anyone have any idea what PLI is used for?</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":40,"score":0,"question_id":12851686,"title":"Who can help me to correct the below code?","body":"<p>I wrote the below code but when I run it the result wont \"Group by\" as I expect to be.could you help me to grouping the result.</p>\n\n<pre><code>select o.OrdId, o.Orddate, ordr.quantity, (ordr.quantity * ord.Iteprice) as price\nfrom Ord o\ninner join Orderrouter ordr on o.OrdId=ordr.OrdID\ninner join OrdItem ord on ordr.OrdItems = ord.ItemId\nwhere o.Paid = 1\nGroup by o.OrdId, o.Orddate, ordr.quantity, ord.Iteprice\norder by o.Orddate DESC\n</code></pre>\n"},{"tags":["c#","wpf","sql-server-2008","ubuntu","ubuntu-12.04"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":104,"score":0,"question_id":12894237,"title":"How to develop a C#.NET application for Ubuntu 12.04","body":"<p>I want to create a desktop application using C#.net (Database - SQL Server ) which is run on Ubuntu 12.04 operating system. </p>\n\n<p>How can I convert my C# .Net code into something compatible with Ubuntu?</p>\n"},{"tags":["sql","sql-server-2008","subquery"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":91,"score":0,"question_id":12893960,"title":"SQL Query - Get Subquery results in Rows rather then Columns","body":"<p>I checked the Search, but none seem to answer this Question.. I expect it to be farely simple though:\nI have a query that results in two columns, but I need it to result in two rows.. Anyone know how?</p>\n\n<p>this is the query:</p>\n\n<pre><code>               SELECT        (SELECT        COUNT(Id) AS Expr1\n                      FROM            Table\n                      WHERE        (Description LIKE 'door%')) AS Door,\n                         (SELECT        COUNT(Id) AS Expr1\n                           FROM            Table AS Table_1\n                           WHERE        (Description LIKE 'window%')) AS Window\n</code></pre>\n\n<p>The result I GET is (of course):</p>\n\n<pre><code>[Door]     [Window]\n56         34\n</code></pre>\n\n<p>The result I'd LIKE to have is the following:</p>\n\n<pre><code>[OPTION]    [NROfRecords]\nDoor        56\nWindow      34\n</code></pre>\n\n<p>Any Ideas? Thanks in advance!  </p>\n"},{"tags":["java","sql","sql-server-2008"],"answer_count":5,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":613,"score":1,"question_id":9208126,"title":"To find the next work day","body":"<p>Let's say I have stored a bunch of holidays in my database.</p>\n\n<p>What I need to do is find out which is next work day excluding Saturdays and the public holidays defined in the database.</p>\n\n<p>eg.</p>\n\n<p>Let's say today is the Friday the 15th Feb and the 17th and the 18th are public holidays as defined in the database as datetime.  So now when I press a button that says next work day, it should return 19th Feb.</p>\n\n<p>Which is the most efficient way to to get it?</p>\n"},{"tags":["asp.net","sql-server-2008","c#-4.0"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":68,"score":0,"question_id":12888165,"title":"Can I retrieve Data from two Databases?","body":"<p>I want to retrieve some data to use it in my grid, but the problem is my database design contains two databases.</p>\n\n<p>So, can I retrieve data from more than database, to use it at one grid ?</p>\n\n<p>I use ASP.Net, C#.Net 4, Microsoft SQL Server 2008 R2</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":74,"score":2,"question_id":12892194,"title":"getting error for if/else in a stored procedure","body":"<p>I am relatively very new to SQL queries but I have this stored procedure where I am trying to get value of a declared variable as mentioned below but getting error,</p>\n\n<p>First line is 20 here,</p>\n\n<pre><code>declare @m_ID_v int\nset @m_ID_v = ( select ID_C from M_T where MName_C = @MName_parameter)\n\ndeclare @g bit\nif (select G_L_Column from G_L_table Where M_ID_Column = @M_ID_variable)\n    set @g_v = 1\nelse\n    set @g_variable = 0\n</code></pre>\n\n<p>Exception I get:</p>\n\n<blockquote>\n  <p><em>Msg 4145, Level 15, State 1, Procedure GetID, Line 20<br>\n  An expression of non-boolean type specified in a context where a\n  condition is expected, near 'set'. Msg 156, Level 15, State 1,\n  Procedure GetID, Line 21 Incorrect syntax near the keyword 'else'.</em></p>\n</blockquote>\n\n<p>Now if I remove <code>declare @g...</code> and try to parse it, no error occurs</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I want my code to check for returned value by my select statement so \"if exists\" is not really what am looking for, sorry.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":65,"score":1,"question_id":12892549,"title":"difference between if and if exists","body":"<p>I have this stored procedure, I was wondering if \"if exists\" will actually compare the value returned by select statement or it will just check if that condition can be executed or not, sorry for such a stupid question but I am new to SQL,</p>\n\n<pre><code>declare @m_ID_v int\nset @m_ID_v = ( select ID_C from M_T where MName_C = @MName_parameter)\n\ndeclare @g bit\nif exists (select G_L_Column from G_L_table Where M_ID_Column = @M_ID_variable)\n    set @g_v = 1\nelse\n    set @g_variable = 0\n</code></pre>\n\n<p>my select statement </p>\n\n<pre><code>select G_L_Column from G_L_table Where M_ID_Column = @M_ID_variable\n</code></pre>\n\n<p>Is returning either true or false, so just wanna make sure if \"if exists\" will work as \"if\"</p>\n"},{"tags":["sql-server-2008","ms-access-2007"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":63,"score":2,"question_id":12888829,"title":"Order by count not sorting correctly - SQL (MS Access 2007)","body":"<p>Overview:\nCompare day to day trades for produce as agent for various accounts to find difference between agent and company holdings showing only what is new; codes in current trades, but not previous trades.</p>\n\n<p>Objective:\nSort the trades by code (i.e. apples) with highest frequency.</p>\n\n<p>Current table:</p>\n\n<pre><code>--------------------------------------------------------------------------------------------------------------\n|        DATE | ACCT_CODE | TYPE | TYPE_DESCRIPTION |    CODE | DIFFERENCE | AGENT_HOLDING | COMPANY_HOLDING |\n--------------------------------------------------------------------------------------------------------------\n| 02 Aug 2012 | acc107101 | prod |          produce |   apple |      -1500 |             0 |            1500 |\n| 02 Aug 2012 | acc107101 | prod |          produce |   apple |       1500 |          2000 |             500 |\n| 02 Aug 2012 | acc107101 | prod |          produce |   apple |          0 |             0 |               0 |\n| 02 Aug 2012 | acc107101 | prod |          produce |   apple |          0 |         49797 |           49797 |\n| 02 Aug 2012 | acc170000 | prod |          produce |  grapes |       2500 |          2500 |               0 |\n| 02 Aug 2012 | acc170000 | prod |          produce |  grapes |      -1500 |             0 |            1500 |\n| 02 Aug 2012 | acc008221 | caus |             cash |    cash |          0 |             0 |               0 |\n| 02 Aug 2012 | acc008221 | caus |             cash | carrots |          0 |         43273 |           43274 |\n| 01 Aug 2012 | acc008221 | caus |             cash |    cash |          0 |             0 |               0 |\n| 01 Aug 2012 | acc008221 | caus |             cash | carrots |          0 |         43273 |           43274 |\n| 02 Aug 2012 | acc179185 | prod |          produce |   mango |        125 |          2775 |            2650 |\n| 02 Aug 2012 | acc179185 | prod |          produce |   mango |     -57646 |        453639 |          511286 |\n| 02 Aug 2012 | acc636903 | prod |          produce |   mango |          0 |        481081 |          481081 |\n| 02 Aug 2012 | acc001049 | prod |          produce |   mango |       2500 |          2500 |               0 |\n| 02 Aug 2012 | acc001189 | prod |          produce |   apple |      -1091 |             0 |            1091 |\n--------------------------------------------------------------------------------------------------------------\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>SELECT \n    Count(CurrentTrade.Code) AS CountOfCode, \n    CurrentTrade.date, \n    CurrentTrade.Acct_Code, \n    CurrentTrade.Type, \n    CurrentTrade.Code, \n    CurrentTrade.Agent_Holding, \n    CurrentTrade.Company_Holding, \n    CurrentTrade.Difference\nFROM CurrentTrade \nLEFT JOIN PrevTrade \n    ON CurrentTrade.Company_Holding=PrevTrade.Company_Holding\nWHERE (((PrevTrade.Company_Holding) Is Null) AND ((CurrentTrade.Code)&lt;&gt;'cash'))\nGROUP BY \n    CurrentTrade.Code,CurrentTrade.date, \n    CurrentTrade.Acct_Code, \n    CurrentTrade.Type, \n    CurrentTrade.Agent_Holding, \n    CurrentTrade.Company_Holding, \n    CurrentTrade.Difference\nORDER BY count(CurrentTrade.Code) ASC;\n</code></pre>\n\n<p>Current results:</p>\n\n<pre><code>---------------------------------------------\n| COUNTOFCODE |        DATE | TYPE |   CODE |\n---------------------------------------------\n|           1 | 02 Aug 2012 | prod | grapes |\n|           1 | 02 Aug 2012 | prod | grapes |\n|           1 | 02 Aug 2012 | prod |  apple |\n|           1 | 02 Aug 2012 | prod |  apple |\n|           1 | 02 Aug 2012 | prod |  apple |\n|           1 | 02 Aug 2012 | prod |  apple |\n|           1 | 02 Aug 2012 | prod |  apple |\n|           1 | 02 Aug 2012 | prod |  mango |\n|           1 | 02 Aug 2012 | prod |  mango |\n|           1 | 02 Aug 2012 | prod |  mango |\n|           1 | 02 Aug 2012 | prod |  mango |\n---------------------------------------------\n</code></pre>\n\n<p>Issue:\nHow to fix to use correct ORDER BY frequency (apples, mango, grapes)?</p>\n"},{"tags":["sql","sql-server-2008","common-table-expression"],"answer_count":1,"favorite_count":1,"up_vote_count":2,"down_vote_count":0,"view_count":56,"score":2,"question_id":12891637,"title":"Unexpected results from CTE","body":"<p>I've created a complex process that uses several CTEs (mainly for recursive hierarchical work).<br>\nOn small sample sets of data everything goes as expected but when I apply the code to large sets of data I received unexpected (and wrong) results.</p>\n\n<p>I think I've narrowed it done to the CTEs. The recursive CTEs are \"fed\" data processed in several earlier CTEs, and that seems to be the problem.</p>\n\n<p>I set up a <a href=\"http://sqlfiddle.com/#!3/c8a47/6\" rel=\"nofollow\">sample data set</a> as follows:</p>\n\n<ul>\n<li>Four rows with unique data</li>\n<li>Each row receives a random row number (this is added in a CTE</li>\n</ul>\n\n<p>I then take the results of the first CTE and perform a self-join in a second CTE.<br>\nI expected all rows to join, each to itself. What actually happens is that unequal rows join up.</p>\n\n<p>Can someone offer up an explanation for this behaviour? </p>\n"},{"tags":["c#","visual-studio-2010","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":132,"score":2,"question_id":12832294,"title":"Output from SQL Server and C# different","body":"<p>I believe something is wrong with my coding. It's not filtering by date I guess. Please help</p>\n\n<p>SQL code:</p>\n\n<pre><code>SELECT\n   CONVERT(char(80), i.InvDate,3) AS InvDate,\n   i.InvoiceNo,\n   i.EmployerCode,\n   i.TaxAmount + i.SubTotal AS Amount,\n   '' AS Payment,\n   pd.GivenName\nFROM\n   dbo.Invoice i\nINNER JOIN \n   dbo.PatientDetails pd ON (pd.MedicalRecordID = i.MedicalRecordID)\n</code></pre>\n\n<p>C# code:</p>\n\n<pre><code>SqlCommand objCmd = new SqlCommand(\"SELECT CONVERT(char(80), i.InvDate,3) AS InvDate, \n    i.InvoiceNo,\n    i.EmployerCode,\n    i.TaxAmount + i.SubTotal AS Amount,\n    '' AS Payment,\n    pd.GivenName \nFROM\n    dbo.Invoice i \nINNER JOIN dbo.PatientDetails pd ON (pd.MedicalRecordID = i.MedicalRecordID) \nWHERE (InvDate &gt;= CONVERT(datetime, '\" + dtpFrom.Text + \"', 105 )) \n    AND (InvDate &lt;= CONVERT(datetime, '\" + dtpTo.Text + \"', 105)),\" , objConn);\n</code></pre>\n\n<p>This is what I want to achieve:</p>\n\n<p><img src=\"http://i47.tinypic.com/167trt3.png\" alt=\"enter image description here\"></p>\n\n<p>This is what I get:</p>\n\n<p><img src=\"http://i50.tinypic.com/28m2z5x.png\" alt=\"enter image description here\"></p>\n\n<p>Before i get kicked from here. I'll make some edits.</p>\n\n<p>EDIT:</p>\n\n<p>DateTime is in a 105 format (dd-mm-yyyy)</p>\n\n<pre><code>WHERE (InvDate &gt;= CONVERT(datetime, '\" + dtpFrom.Text + \"', 105 )) \nAND (InvDate &lt;= CONVERT(datetime, '\" + dtpTo.Text + \"', 105))\n</code></pre>\n\n<p>This is supposed to choose from a particular date. EG: from 11 Oct 2012 to 15 Oct 2012.</p>\n\n<p>Even without DateTimepicker, The output doesn't show me \"GivenName\"</p>\n"},{"tags":["sql-server","sql-server-2008","stored-procedures","sql-server-2008-r2"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":87,"score":0,"question_id":12839273,"title":"How to find the inner SP's taking time","body":"<p>I have 1 main procedure and inside 5 procedure calls and my Main SP taking too much time. I want to find out which is the procedure call taking time to execute amongst inside 5 procedures.</p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":74,"score":-1,"question_id":12888775,"title":"SQL select @variable","body":"<p>I have a simple SQL statement that is to get the first rowid from question, but it gives an error thanks to too many items return. So how can I fix it ?</p>\n\n<pre><code>    DECLARE @first_id int  \n\nselect @first_id = (SELECT row_number() over (order by id) as id FROM question)\n</code></pre>\n\n<p><code>SELECT @first_id = id FROM question</code> >> this syntax works fine but not what I want from query result.</p>\n\n<p>Thanks</p>\n"},{"tags":["sql-server","sql-server-2008","excel","c#-4.0","import-from-excel"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":220,"score":0,"question_id":12889518,"title":"Import data directly from Excel sheet into SQL Server table","body":"<p>I have multiple table's data in single Excel sheet with exact column names, now I want to insert that data into my SQL Server 2008 tables.</p>\n\n<p>For example: I have one table <code>Student</code> which has columns <code>Stud_ID, Stud_Name, Branch, Status</code>.</p>\n\n<p>And same as, I have one Excel sheet <code>Student</code> which has columns <code>Stud_ID, Stud_Name, Branch, Status</code>. Excel sheet has multiple records of data in it.</p>\n\n<p>Now I want to insert that data into the SQL Server table <code>Student</code>.</p>\n\n<p>How can I do that using C# coding and without coding (directly Excel to SQL Server database)? Please guide me its urgent.</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":10,"down_vote_count":0,"view_count":2679,"score":10,"question_id":6054144,"title":"How can I group by date time column without taking time into consideration","body":"<p>I have a bunch of product orders and I'm trying to group by the date and sum the quantity for that date. How can I group by the month/day/year without taking the time part into consideration?</p>\n\n<p><code>3/8/2010 7:42:00</code> should be grouped with <code>3/8/2010 4:15:00</code></p>\n"},{"tags":["sql-server","sql-server-2008","subquery"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":2,"view_count":65,"score":0,"question_id":12889091,"title":"Syntax error on selecting from sub-query","body":"<p>Getting syntax error while executing the following query?</p>\n\n<pre><code>select *\n    from (select row_number() over (order by title) as RowNum  from question)\n    where RowNum&gt;5\n</code></pre>\n\n<p>Anyone knows how to get it fixed?</p>\n"},{"tags":["sql-server-2008","migration","cassandra"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":73,"score":0,"question_id":12867951,"title":"Migrate from MSSQL to Cassandra","body":"<p>I wish to start very quickly with my new project. I have experience in MSSQL, but no experience with Cassandra, so MSSQL would definitely be the fastest. But IF my project would become successful I would like to migrate to Cassandra. Is that even possible and if so a painstaking job or pretty straightforward?</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":74,"score":0,"question_id":12886216,"title":"An expression of non-boolean type specified in a context where a condition is expected, near ')'","body":"<p>I have a script in trigger to insert the audit table if any update happens on T_Referral table and i am using a Decrypt function to Decrypt the data in one of the column. My code in trigger is :</p>\n\n<pre><code>DECLARE @Sql_Insert nvarchar(max)\nSET @Sql_Insert = ''\nSET @Sql_Insert='INSERT INTO [Logg].AuditLogData(TableName, ColumnName, OldValue, OldValue_Decode, NewValue, NewValue_Decode, AuditSubCategoryID,[GuID])\nselect TableName, ColumnName, OldValue_Decode, case when ColumnName = ''BookingUserReferenceValue'' then utl.sfDecrypt(NewValue,0) Else NewValue end, NewValue_Decode, AuditSubCategoryID,[GuID] from #AuditLogData\nwhere ISNULL(OldValue,'') != ISNULL([NewValue],'')'\n\nexec utl.uspOpenOrCloseEncryptionKey 'open'\nexec(@Sql_Insert )\nexec utl.uspOpenOrCloseEncryptionKey 'close'\n</code></pre>\n\n<hr>\n\n<p>My update script is </p>\n\n<pre><code>Update RTS.T_Referral   \nset BookingUserReferenceValue =  cast ('John Wayne' as varbinary(256))\nwhere ReferralId = 20\n</code></pre>\n\n<p>I am Updating the record to <code>John Wayne</code> as varbinary in <code>T_Referral</code> table(record looks like <code>0x4A6F686E205761796E65</code>) and when update trigger is called it would load that record as John Wayne in Audit table. When the record is inserted in BookingUserReferenceValue it will be encrypted. The datatype of column BookingUserReferenceValue is Varbinary(256). when i try to update the record in that column i get error :</p>\n\n<blockquote>\n  <p>An expression of non-boolean type specified in a context where a\n  condition is expected, near ')'.</p>\n</blockquote>\n\n<p>Any Idea whats wrong?\nThanks</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":88,"score":1,"question_id":12885468,"title":"SQL Server : update multiple rows with different values","body":"<p>I am trying to update multiple rows with different values, but don't need to match any specific ID. </p>\n\n<p>Of course, both columns on two different tables will have a same number of records.</p>\n\n<p>Example, I have a table <code>Table1</code> and <code>Column1</code> and a query with list 10 items in that table (<em>the <code>ID</code> is not consecutive</em>).</p>\n\n<pre><code>ID  ItemName\n1    Item1\n2    Item2\n4    Item3\n5    Item4\n6    Item5\n8    Item6\n9    Item7\n14    Item8\n18    Item9\n23    Item10\n</code></pre>\n\n<p>Now, I have another table <code>Table2</code> and <code>Column2</code> that I want to update with those 10 items above.  </p>\n\n<p>This also has different IDs, but <code>ItemName</code> is blank/null value.</p>\n\n<pre><code>ID   ItemName\n301    NULL\n321    NULL\n323    NULL\n331    NULL\n333    NULL\n335    NULL\n336    NULL\n355    NULL\n377    NULL\n388    NULL\n</code></pre>\n\n<p>So, I a looking for a query where I can update the <code>Table2</code> and <code>Column2</code> with those 10 items from <code>Table1</code>, and the result looks like this </p>\n\n<pre><code>ID   ItemName\n301    ITem1\n321    ITem2\n323    ITem3\n331    ITem4\n333    ITem5\n335    ITem6\n336    ITem7\n355    ITem8\n377    ITem9\n388    ITem10\n</code></pre>\n\n<p>Please help.  Thanks in advance.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":75,"score":0,"question_id":12881899,"title":"sql server, get output value sp_executesql","body":"<pre><code>SET ROWCOUNT @startRowIndex\n     SELECT @first_id = id FROM Question q ORDER BY q.id\n</code></pre>\n\n<p>this is straight forward enough to get the first id from a table, however in case the sql statement is in string, how can i get the same result like above</p>\n\n<p>i mean how to get output <code>q.id</code> from <code>EXEC sp_executesql @sql</code>?</p>\n\n<pre><code>IF  @sortCommand like 'sortAsAnswerCount' OR \n    @sortCommand like 'sortAsNonAnswer'\nBEGIN\n\n    set @sql=N'WITH LikeCounts\n        AS\n        (\n        SELECT     TOP (100) PERCENT q.Id, q.Title, c.CustomerId, c.CreatedOnUtc,\n                                  (SELECT     COUNT(*)\n                                    FROM          dbo.CustomerLikeQuestion\n                                    WHERE      (QuestionId = q.Id)) AS LikeCount\n        FROM         dbo.CustomerContent AS c INNER JOIN\n                              dbo.Question AS q ON c.Id = q.Id\n        ORDER BY likecount DESC\n        )\n        SELECT *, row_number() over (order by likecount desc) as RowNum\n        fROM LikeCounts'\n\nEND\n</code></pre>\n"},{"tags":["sql","sql-server-2008","ldf"],"answer_count":0,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":29,"score":1,"question_id":12884559,"title":"Transaction Log file .ldf is too small","body":"<p>Current database is almost 200GB however the transaction log file is only 4.1GB. \nI am worried if this influences the performance of databse and how could it be solved. </p>\n\n<p>When I do this query</p>\n\n<pre><code>DECLARE @DatabaseName VARCHAR(50) ;\n  SET @DatabaseName = 'dbname'\n  SELECT name ,\n    recovery_model_desc ,\n    log_reuse_wait_desc\n  FROM  sys.databases\n  WHERE name = @DatabaseName\n\nShow Recovery Model = Simple, Log Reuse Wait = Nothing. \n</code></pre>\n\n<p>Anyone has a knowledge why the log file is so small, and does this influences on the performance?</p>\n"},{"tags":["sql-server-2008","entity-framework","code-first","sql-server-ce-4"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":51,"score":0,"question_id":12751318,"title":"SQL Server CE identifies a cyclical reference with Entity Framework Code First but SQL Server 2008 does not","body":"<p>I am working on an Entity Framework Code First project that has a fairly complex Data Model which deploys absolutely fine on SQL Server 2008.</p>\n\n<p>However when creating an SQL Server CE database for some local End-To-End testing I get the following error message when EF creates the database:</p>\n\n<p><code>System.Data.SqlServerCe.SqlCeException: The referential relationship will result in a cyclical reference that is not allowed. [ Constraint name = FK_Sites_Persons_PersonId ].</code></p>\n\n<p>I have disabled the <code>ManyToManyCascadeDeleteConvention</code> in my DataContext model creation method, so that isn't the cause of the problem. The trouble I have is that the relationship in question looks fine in the SQL Server 2008 database- it appears to be a normal foreign key from what I can tell and I can't see anything flowing back in the other direction, although it is not impossible that there is a longer-path circular reference. I don't know why CE would fail and 2008 would succeed.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","random"],"answer_count":1,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":74,"score":4,"question_id":12883303,"title":"Select X random users per item","body":"<p>I have 2 tables: <code>Items</code> &amp; <code>Users</code>.</p>\n\n<p><code>Items</code> contains <code>ItemID, and Num_Users</code><br>\n<code>Users</code> contains <code>UserID</code></p>\n\n<p>For each <code>ItemID</code>, I need to randomly select a number of Users according to the value stated in the Num_Users column.</p>\n\n<p>I created a sample set of data on <a href=\"http://sqlfiddle.com/#!3/bdde1\" rel=\"nofollow\">SQL Fiddle</a>.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","rownumber"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":122,"score":0,"question_id":12881648,"title":"SQL Server row_number","body":"<p>I have a problem to create a custom <code>rownumber</code> with an alias column. Here are some sample data:</p>\n\n<p>Table <code>question</code>:</p>\n\n<pre><code>id   title   \n--   --------    \n1     xx\n2     xxx\n</code></pre>\n\n<p>..</p>\n\n<p>Table <code>customerLikeQuestion</code>:</p>\n\n<pre><code>Id   QuestionId CustomerId\n---------------------------\n1       20          xx\n2       100         xx \nxx\n</code></pre>\n\n<p>Query:</p>\n\n<pre><code>SELECT  q.Id,\n        (SELECT     COUNT(*) \n         FROM          dbo.CustomerLikeQuestion\n         WHERE      (QuestionId = q.Id)) AS LikeCount\nFROM dbo.Question AS q\nORDER BY likecount DESC\n</code></pre>\n\n<p>The previous query shows:</p>\n\n<pre><code> id    LikeCount\n2136    6\n2138    5\n2150    5\n</code></pre>\n\n<p>Now I'd like to put a <code>rownumber</code> to count an incremental order of a row. I tried the following query:</p>\n\n<pre><code>SELECT     TOP (100) PERCENT Id,\n           (SELECT     COUNT(*) AS Expr1\n            FROM          dbo.CustomerLikeQuestion\n            WHERE      (QuestionId = q.Id)) AS LikeCount, \n            row_number() over (order by likecount) as RowNum\nFROM         dbo.Question AS q\nORDER BY likecount DESC\n</code></pre>\n\n<p>But it gives me the following error:</p>\n\n<blockquote>\n  <p><em>invalid column Likecount.</em></p>\n</blockquote>\n\n<p>I do know that <code>Over()</code> cannot work with alias, but how can I get around this problem, either with CTE or subquery, I have not yet come up with any idea. please help.</p>\n\n<p>The right result should be like this: </p>\n\n<pre><code>id  likecount, rownum\n----------------------    \nxx     6        1\nxx     5        2 \nxx     4        3\n..     0        xx\n</code></pre>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":1,"view_count":78,"score":1,"question_id":12881735,"title":"Database maximum size in SQL Server 2008","body":"<p>What is the maximum <code>.mdf</code> database size limit in SQL Server 2008 Enterprise ?</p>\n"},{"tags":["sql-server-2008","delphi","tadoquery","rows-affected"],"answer_count":3,"favorite_count":0,"up_vote_count":3,"down_vote_count":0,"view_count":160,"score":3,"question_id":12779534,"title":"Delphi - TADOQuery.RowsAffected always -1 with UPDATE SQL statement","body":"<p>I'm executing a SQL UPDATE statement using a TADOQuery component and want to inspect the number of rows that were updated.  The UPDATE statement is executing fine and the rows are modified accordingly but the .RowsAffected property always returns -1.  The documentation states -1 indicates an error with the statement, but as I say it executes fine.  I've tried prefixing the statement with SET NOCOUNT OFF but this made no difference.  My code is as follows :</p>\n\n<pre><code>var\n  adoUpdateQuery: TADOQuery;\n  blnUpdatedOK: Boolean;\nbegin\n  adoUpdateQuery := TADOQuery.Create(nil);\n  adoUpdateQuery.DisableControls;\n  adoUpdateQuery.Connection := adcMiddleTierDB;\n  adoUpdateQuery.ExecuteOptions := [eoExecuteNoRecords];\n  adoUpdateQuery.SQL.Text := 'UPDATE MyTable SET Status = 1 WHERE Status = 0';\n  try\n    adoUpdateQuery.ExecSQL;\n    blnUpdatedOK := (adoUpdateQuery.RowsAffected &gt; 0);\n</code></pre>\n\n<p>I'm using Delphi XE2, connecting to MS SQL Server 2008R2.</p>\n"},{"tags":["sql","sql-server-2008","tsql"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":64,"score":2,"question_id":12879253,"title":"How to make multiple occurences of the same item have a different value from the first occurence?","body":"<p>I have a database that looks like this:</p>\n\n<pre><code>label_id, scan_type, scan_cost\n</code></pre>\n\n<p>And some rows that look like this:</p>\n\n<pre><code>001, A40, 70\n001, A40, 70\n002, A40, 85\n003, A40, 85\n003, A40, 85\n</code></pre>\n\n<p>I need to produce a result set that looks like this:</p>\n\n<pre><code>001, A40, 70\n001, A40, 0\n002, A40, 85\n003, A40, 85\n003, A40, 0\n</code></pre>\n\n<p>That is, any multiple occurrence of the same <code>label_id</code> then the <code>scan_cost</code> column needs to be set to 0, but the first occurrence of each <code>label_id</code> the value needs to remain untouched.</p>\n\n<p>The <code>label_id</code> are not sequential if that changes anything.</p>\n\n<p>Is it possible to achieve this behaviour in SQL? Note the SQL dialect is T-SQL, Microsoft SQL Server 2008</p>\n"},{"tags":["sql-server","sql-server-2008","tsql"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":60,"score":-2,"question_id":12876626,"title":"Simple compare of datetime in SQL Server 2008","body":"<p>I have a <code>datetime</code> column storing the time of change including date and time parts.</p>\n\n<p>I am trying to return all of the changed rows using my stored procedure, which has one <code>datetime</code> parameter being passing it into </p>\n\n<pre><code>SELECT * FROM TABLE WHERE Changed &gt; @param\n</code></pre>\n\n<p>Surprisingly it returns <strong>no rows</strong>.</p>\n\n<p>I tried to use <code>BETWEEN</code>, time ranges, <code>DATEPART</code>, <code>DATEDIFF</code> but without success. Playing with this issue I found that if I do not compare seconds everything works.</p>\n\n<p>Any ideas, please?</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql-server-2008","containstable","isabout"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":61,"score":2,"question_id":12877852,"title":"Can I use a variable when using ISABOUT?","body":"<p>I'm trying to use a stored procedure to create a table that ranks posts by taking a topic name and using keywords and weights associated with that topic name to determine how they should be ranked. I've been trying to use CONTAINSTABLE and ISABOUT, but I'm having trouble with putting the keywords and weights into the ISABOUT statement. I've tried converting the keywords and weights from the table they're in into a varchar variable, and putting that variable into the ISABOUT statement, but when I run the SP, the resulting table is empty, so I'm assuming the variable isn't working and I'm not sure where to go from here.</p>\n\n<p>Here's what I have so far:</p>\n\n<pre><code>CREATE PROCEDURE rankingSP (@Topic varchar(30))\nAS\nBEGIN\n    --creates table to display when sp is executed  \n    CREATE TABLE #rankingTable(\n    Post_ID     int,\n    Post_cont   varchar(max),\n    [Rank]      decimal(18,2))\n\n    --creates string with keywords and weights\n    DECLARE @keywordString varchar(max)\n    SELECT @keywordString = COALESCE(@keywordString + ',','') \n    + Keyword + ' ' + 'WEIGHT' + '(' + CONVERT(varchar,K_weight) + ')'\n    FROM Keyword\n    PRINT @keywordString\n\n    --inserts rankings into rankingTable\n    INSERT INTO #rankingTable\n    SELECT\n    p.[Post_ID],\n    p.[Post_cont],\n    ct.[RANK]\n    FROM CONTAINSTABLE\n    (\n    Post,\n    Post_cont,\n    N'ISABOUT (@keywordString)'\n    ) ct\n    INNER JOIN Post p\n    ON ct.[KEY] = p.Post_ID\n    ORDER BY ct.[RANK] DESC;\n\n    --displays the ranking table\n    SELECT * FROM #rankingTable\n    ORDER BY [Rank]DESC\nEND\n</code></pre>\n"},{"tags":["sql-server-2008","select","random"],"answer_count":3,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":49,"score":2,"question_id":12879496,"title":"how to pick randome number from the number list","body":"<p>I need to choose one number randomly from the list of bigint in sql server 2008.\nthe number list is not continue</p>\n\n<p>For example : The number list may be like this</p>\n\n<p>1578\n1579\n1580\n1587\n1589\n1590\n1595\n1603</p>\n\n<p>Thanks in Adv.</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":69,"score":0,"question_id":12875396,"title":"How to use use derived table column in sql query?","body":"<p>I have one table mytrade like following</p>\n\n<pre><code>tradeid securityid quantity\n\n111    899    12000\n112    899    1000\n113    788    15000\n114    566    -15000\n115    566    -1000\n</code></pre>\n\n<p>so to gather total quantity for security id i write following query (I tried this into #temptable also create temptable and then select below )</p>\n\n<pre><code>select\ntradeid,\nsecurityid,\nsum(quantity) OVER(Partition by securityid) as total\nfrom mytrade\n</code></pre>\n\n<p>which gives me output like below</p>\n\n<pre><code>tradeid securityid total\n\n114    566    -16000\n115    566    -16000\n113    788    15000\n111    899    13000\n112    899    13000\n</code></pre>\n\n<p>now i want to insert values into secondtable based on \"total\" quantity.</p>\n\n<pre><code>insert secondTable (securityid,quantity,price)\n(\nselect securityid,quantity,101.1 from mydata..mytrade\nwhere #temptable.total = 13000 and securityid = 899\n)\n</code></pre>\n\n<p>but getting error:</p>\n\n<p>The multi-part identifier \"#temptable.total\" could not be bound.</p>\n\n<p>if i put this whole statement into#temptable and then assign as above then also getting this error how should i bound \"total\" column please guide me?</p>\n"},{"tags":["sql","sql-server","sql-server-2008","dynamic-sql"],"answer_count":8,"favorite_count":2,"up_vote_count":6,"down_vote_count":0,"view_count":25876,"score":6,"question_id":4626292,"title":"How to use table variable in a dynamic sql statement?","body":"<p>In my stored procedure I declared two table variables on top of my procedure. Now I am trying to use that table variable within a dynamic sql statement but I get this error at the time of execution of that procedure. I am using Sql Server 2008.</p>\n\n<p>This is how my query looks like, </p>\n\n<pre><code>set @col_name =  'Assoc_Item_' + Convert(nvarchar(2), @curr_row1);\nset @sqlstat = 'update @RelPro set ' + @col_name + ' = (Select relsku From @TSku Where tid = ' + Convert(nvarchar(2), @curr_row1) + ') Where RowID = ' + Convert(nvarchar(2), @curr_row);\nExec(@sqlstat);\n</code></pre>\n\n<p>And I get the following errors, </p>\n\n<p>Must declare the table variable \"@RelPro\".\nMust declare the table variable \"@TSku\".</p>\n\n<p>I have tried to take the table outside of the string block of dynamic query but to no avail... Please help,</p>\n\n<p>Thanks.</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":2,"view_count":95,"score":-2,"question_id":12864467,"title":"How to take sum of column with same id in SQL?","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10142367/sql-query-to-sum-the-data\">sql query to sum the data</a>  </p>\n</blockquote>\n\n\n\n<p>I have following table structure </p>\n\n<pre><code>TradeId     TableName        PricingSecurityID  Quantity    Price   \n2008        Fireball.dbo.Bond    506             50         100.0000    \n2009        Fireball.dbo.Bond    506             50         100.2500    \n2010        Fireball.dbo.Bond    588             50         100.7500    \n2338        Fireball.dbo.Bond    588             100        102.5000    \n</code></pre>\n\n<p>I need to take a sum of <code>Quantity</code> of matching or we can say group by particular <code>PricingSecurityID</code></p>\n\n<p>like for <code>PricingSecurityID=506</code> I should get <code>quantity=100</code> </p>\n\n<p>and for <code>PricingSecurityID=588</code> I should get <code>quantity=150</code> </p>\n\n<p>How can I write this SQL query?</p>\n\n<blockquote>\n  <p>I did try with simple group by statement\n  but as i'm also selecting tradeid i'm getting error :\n  Column 'TradeId' is invalid in the select list because it is not contained in either an aggregate function or the GROUP BY clause.</p>\n</blockquote>\n"},{"tags":["c#","asp.net","sql-server-2008","gridview","filter"],"answer_count":4,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":3213,"score":0,"question_id":6137664,"title":"how to filter a gridview","body":"<p>I have a gridview connected to a database by sqldatasource. I have multiple drop down lists and a table where users can select different data to filter the gridview. </p>\n\n<p>I know how to set this up for one control but have no idea how to do it for multiple ones. Ideally what I would like to do is onfilterButton_Click the code behind connects to a stored procedure in the database. The parameters would depend on the filter options the user has chosen. I just don't know how to write the stored procedure. (I am not the best at SQL)</p>\n\n<p>But I am open to suggestions of better ways to do this. I am using c# visual studios 2010 and sql server 2008.</p>\n\n<p>I have been stuck on this for over a week now so really any practical help would be welcome. </p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":83,"score":0,"question_id":12873118,"title":"Trigger is trying to insert duplicate key","body":"<p>I have a trigger that is fired on Insert. This trigger inserts on another table. here is my code: </p>\n\n<pre><code>    SELECT @maxTeamId = 0\nSELECT @maxTeamId = ISNULL(MAX(teamId), 0) from [dbo].[tblTeamslist]\n\n--- Check if home team has already been inserted into the table.\nSELECT @homeTeamId = -1\nSELECT \n    @homeTeamId = teamId \nFROM \n    [dbo].[tblTeamslist] t\n    JOIN inserted i\n    ON t.teamName = i.hometeam\nIF (@homeTeamId = -1) \nBEGIN\n  SET IDENTITY_INSERT tblteamslist ON\n    SELECT @homeTeamId = @maxTeamId + 1\n    SELECT @maxTeamId = @maxTeamId + 1\n    INSERT INTO [dbo].[tblTeamslist] (teamid,teamname) SELECT @homeTeamId, i.hometeam FROM inserted i\n SET IDENTITY_INSERT tblteamslist off\nEND\n\n--- Check if away team has already been inserted into the table.\nSELECT @awayTeamId = -1\nSELECT \n    @awayTeamId = teamId \nFROM \n    [dbo].[tblTeamslist] t\n    JOIN inserted i\n    ON t.teamName = i.awayteam\nIF (@awayTeamId = -1) \nBEGIN\n  SET IDENTITY_INSERT tblteamslist ON\n    SELECT @awayTeamId = @maxTeamId + 1\n    SELECT @maxTeamId = @maxTeamId + 1\n    INSERT INTO [dbo].[tblTeamslist]  (teamid,teamname) SELECT @awayTeamId, i.awayteam FROM inserted i\n  SET IDENTITY_INSERT tblteamslist off\nEND\n</code></pre>\n\n<p>As you realized I am trying to input a team that if it is not exists on tblTeamsList. Here is the error that i am getting 'Violation of PRIMARY KEY constraint 'PK_tblTeamsList'. Cannot insert duplicate key in object 'dbo.tblTeamsList'. The duplicate key value is (24).'. \nIn the code i am trying to increase the id by +1 each time. What is going wrong ?</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":53,"score":1,"question_id":12871818,"title":"Error in filling a datagrid with a query","body":"<p>I have a <code>DataGridView</code> and I add my query to this, when executed my query throws this error:</p>\n\n<blockquote>\n  <p><em>The schema returned by the new query differs from the base query</em></p>\n</blockquote>\n\n<p>This my query:</p>\n\n<pre><code>        SELECT\n               B.SettingKey, 'SysSettingsDep' AS TableName,\n               B.SettingValue, B.SettingDesc\n        FROM   SysCustomer AS A INNER JOIN\n               SysSettingsDep AS B ON A.SettingKey = B.SettingKey\n        UNION\n        SELECT C.SettingKey, 'SysSettingsMachine' AS TableName,\n               C.SettingValue, C.SettingDesc\n\n        FROM    SysCustomer AS A INNER JOIN\n                SysSettingsMachine AS C ON A.SettingKey = C.SettingKey\n        UNION\n        SELECT  D.SettingKey, 'SysSettings' AS TableName,\n                D.SettingValue, D.SettingDesc\n        FROM    SysCustomer AS A INNER JOIN SysSettings AS D ON\n                A.SettingKey = D.SettingKey\n</code></pre>\n\n<p>help me to solve this,</p>\n\n<p>tnx </p>\n"},{"tags":["sql-server","sql-server-2008","pivot","entity-attribute-value"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":206,"score":2,"question_id":7365742,"title":"Pivot to obtain EAV data","body":"<p>I have an EAV table (simple key/value in every row) and I need to take the 'value' from two of the rows and concat them into a single row with a single column. I can't seem to get through the part where I just have the pivot straight. Can anyone help me figure this out?</p>\n\n<pre><code>Declare @eavHelp Table\n(\n    [Key]         VARCHAR (8)       NOT NULL,\n    [Value]       VARCHAR (8)      NULL\n)\nInsert Into @eavHelp Values ( 'key1' , 'aaa' )    \nInsert Into @eavHelp Values ( 'key2' , 'bbb' )\n\nSelect * From @eavHelp \nPivot\n(   Min( [Value] ) \n    For [Value] in ( hmm1 , hmm2 )\n)\nas Piv Where [Key] = 'key1' or [Key] = 'key2'\n</code></pre>\n\n<p>That makes:</p>\n\n<pre><code>Key      hmm1     hmm2\n-------- -------- --------\nkey1     NULL     NULL\nkey2     NULL     NULL\n</code></pre>\n\n<p>But what I want to make is:</p>\n\n<pre><code>hmmmX\n-----\naaa;bbb\n</code></pre>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":33,"score":0,"question_id":12874392,"title":"SQL subtotaling","body":"<p>I am trying to write a SQL Server 2008 query which will output data into subtotaled columns. My SQL skills are pretty poor still, so I could really use some help.</p>\n\n<p>I have two tables, A and B. </p>\n\n<pre><code>A.user (unique) \nA.answer  &lt;- can only be one of two answers, 'Answer1' or 'Answer2' \nB.user (unique) \nB.zip\n</code></pre>\n\n<p>What I am trying to do is write a SQL statement that generates a four column output that summarizes answer by zip. Like this:</p>\n\n<pre><code>Zip    Answer1    Answer2   Total\n----------------------------------\n12345     25        22        47\n23456     7          0         7\n45678     0         15        15\n</code></pre>\n\n<p>Any sage advice?</p>\n\n<p>Thanks!</p>\n\n<p>-tony</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":1,"view_count":76,"score":0,"question_id":12864934,"title":"Expecting SELECT or '( ' in Sql","body":"<p>Basically when I register (Registration details goes to Login table), then this data goes to 2 tables:</p>\n\n<ol>\n<li>Login table<br></li>\n<li>Registration table(Specific)</li>\n</ol>\n\n<p>Using <code>@Attrib</code> I check which data needs to go to which table.  But here I am getting an error near the first <code>else</code> part.</p>\n\n<p>The error is:</p>\n\n<blockquote>\n  <p>Incorrect syntax near '@Attrib' expecting SELECT or ,'('</p>\n</blockquote>\n\n<p>Here is the code:</p>\n\n<pre><code>ALTER procedure [dbo].[Registration_SP]\n(\n    @Email varchar(50),\n    @Password varchar(50),\n    @Repassword varchar(50),\n    @Attrib varchar(50) \n)\nAS\n\nBEGIN\n\n    Insert into Login (Email,Password,Repassword,Attrib)\n    values(@Email,@Password,@Repassword,@Attrib)\n\n    IF (@Attrib = 'Student')\n    BEGIN\n        Insert into StudentReg\n            (StudentId,FirstName,LastName,Gender,Address1,Address2,Address3,\n             LandPhone,MobilePhone,Budget,IsFinancialSupport,CourseName,\n             IsJobSeeker,Country,Region,IsSupportActive,RegDate,ImagePath,\n             ShortCode)\n        Values(@Email,'','','','','','','','','','','','','','','','','','')\n    END\n    ELSE (@Attrib = 'Financial Supporter')\n    BEGIN\n        Insert into SupporterReg   \n        (SupporterId,SupporterName,University,ContactNo,StudentLocation,RegDate,\n         ImagePath,ShortCode)\n        Values(@Email,'','','','','','','')\n    END\n</code></pre>\n\n<p>Further clarification, I have atttached the image below:</p>\n\n<p><img src=\"http://i.stack.imgur.com/hsqqD.png\" alt=\"enter image description here\"></p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":55,"score":4,"question_id":12867644,"title":"How to retrieve DISTINCT values from this table?","body":"<p>Here goes my table values. ( 7 Records )</p>\n\n<pre><code>SELECT * FROM tbl1\n</code></pre>\n\n<p>I can't post the image as my rep is low. So i am linking it here \n<a href=\"http://i.stack.imgur.com/CFl0u.png\" rel=\"nofollow\">http://i.stack.imgur.com/CFl0u.png</a></p>\n\n<p>I wrote a query to avoid the last record, but i am still getting the last record. (ALL I NEED IS DISTINCT EMAILS)</p>\n\n<pre><code>SELECT DISTINCT CandEmail,CandName,EmployerId,ContNum,IsDeleted,CandPortalId FROM tbl1\nWHERE EmployerId = 7 AND IsDeleted = 0\n</code></pre>\n\n<p>The above query still retrieves the same 7 records with last duplicate email record.</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12871920,"title":"Error on SELECT * INTO statement","body":"<p>I want to transfer all data from one table into another with the following code:</p>\n\n<pre><code>INSERT INTO tblpremier \n   SELECT * INTO #TempTable\n   FROM dbo.IntermediateTable\n\nALTER TABLE #TempTable\nDROP COLUMN id\n\nSELECT * FROM #TempTable\n</code></pre>\n\n<p>And I get an error</p>\n\n<blockquote>\n  <p><em>Incorrect syntax near the keyword 'INTO'</em></p>\n</blockquote>\n\n<p>at the second line of this code. Any help?. </p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":50,"score":2,"question_id":12871174,"title":"What's wrong with this ALTER TABLE statement?`","body":"<p>I wrote a SQL statement to add some columns in my existing table <code>Company</code>, but it's causing an error.</p>\n\n<p>This is my statement:</p>\n\n<pre><code>ALTER TABLE Company add(id3 int , id4 int, id5 int  , pjid int , ssid int , \n    searchkeyword1 nvarchar(max) ,searchkeyword2 nvarchar(max) ,\n    searchkeyword3 nvarchar(max) ,searchkeyword4 nvarchar(max) );\n</code></pre>\n\n<p>Thanks ,</p>\n"},{"tags":["sql","sql-server","silverlight","sql-server-2008","reporting-services"],"answer_count":8,"favorite_count":1,"up_vote_count":6,"down_vote_count":0,"view_count":1449,"score":6,"question_id":1248059,"title":"looking for some cool Silverlight chart Demos","body":"<p>I am currently using Reporting Service of SQL Server 2008, and I think the user interface is not very elegant. And I want to use Silverlight as user interface to render reporting service backend data. Two questions,</p>\n\n<ol>\n<li><p>Is it possible? Reporting Service exposes interface which Silverlight could retrieve data and render?</p></li>\n<li><p>I am looking for some cool Demos, better free with source codes, which could dynamically show different kinds of charts, curves on coordinates based on the data retrieved by some data source (e.g. Reporting Service).</p></li>\n</ol>\n\n<p>thanks in advance,\nGeorge</p>\n"},{"tags":["sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12869048,"title":"hierarchy query sql server 2008","body":"<pre><code>EmployeeId, Name, ManagerId\n1,Mac Manager, null\n2,Sue Supervisor, 1\n3,Earl Employee, 2\n4,Sam Supervisor, 1\n5,Ella Employee, 4\n\nGiven: Employee Id = 3\n</code></pre>\n\n<p>Can you help me with sql to get the employee plus managers up the chain?</p>\n\n<p>In this example the results would be</p>\n\n<pre><code>Earl\nSue\nMac\n</code></pre>\n"},{"tags":["sql-server-2008","database-design","varcharmax"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":58,"score":0,"question_id":12808471,"title":"Storing distance matrix as VarChar(Max) in SQL Server database","body":"<p>I'm developing a fleet scheduling application and look for an effective way to store distances between geographic locations.</p>\n\n<p>The application-code accesses the matrix as a two-dimensional array <em><code>double[,]</code></em>.</p>\n\n<p>In order to make the matrix persistent, I currently serialize the matrix as a string. After serialization it looks like this:</p>\n\n<pre><code>\"1 4 9 8 3 6 \\n\n 5 6 7 9 3 6 \\n\n 34 4 5 6 6 7 \\n\"\n</code></pre>\n\n<p>Then it is stored in a column of type <code>varchar(max)</code> in a SQL Server 2008 database. However, I wonder if this string could get too big. </p>\n\n<p>Assuming that each entry has one digit and neglecting white-spaces and \"\\n\"s, theoretically I could store the distances of around 46000 locations (square-root of 2 147 483 647 - the size of <code>varchar(max)</code>) in one entry. This would be sufficient in my context.</p>\n\n<p>Does this approach have any severe disadvantages? Would it be better to store distances in an extra table, where each row contains one distance between two locations?</p>\n\n<p>If 100 users of our application stored 1000 locations respectively, I would have 100000000 = 100 * 1000 * 1000 rows in such a table....</p>\n"},{"tags":["sql","sql-server-2008","database-design"],"answer_count":6,"favorite_count":3,"up_vote_count":4,"down_vote_count":0,"view_count":1862,"score":4,"question_id":5384183,"title":"Database Design Question - Categories / Subcategories","body":"<p>I have a question for how I would design a few tables in my database. I have a table to track Categories and one for Subcategories:</p>\n\n<pre><code>TABLE Category\n    CategoryID INT\n    Description NVARCHAR(500)\n\nTABLE Subcategory\n    SubcategoryID INT\n    CategoryID INT\n    Description NVARCHAR(500)\n</code></pre>\n\n<p>A category might be something like Electronics, and its Subcategories might be DVD Players, Televisions, etc.</p>\n\n<p>I have another table that is going to be referencing the Category/Subcategory. Does it need to reference the SubcategoryID?</p>\n\n<pre><code>TABLE Product\n    SubcategoryID INT  -- should this be subcategory?\n</code></pre>\n\n<p>Is there a better way to do this or is this the right way? I'm not much of a database design guy. I'm using SQL Server 2008 R2 if that matters.</p>\n"},{"tags":["c#","asp.net",".net","sql-server-2008"],"answer_count":4,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":76,"score":1,"question_id":12870477,"title":"How to rollback transaction at later stage?","body":"<p>I have a data entry ASP.NET application. During a one complete data entry many transactions occur. I would like to keep track of all those transactions so that if the user wants to abandon the data entry, all the transaction of which I have been keeping record can be rolled back.</p>\n\n<p>SQL 2008 ,Framework version is 4.0 and I am using c#.</p>\n"},{"tags":["c#","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":77,"score":0,"question_id":12870657,"title":"Cant find error (Unclosed quotation mark after the character string ''.)","body":"<p>Code snippet:</p>\n\n<pre><code>dbCommand = new SqlCommand(\"sp_EVENT_UPATE '\" \n    + currentEvent.EventID + \"','\" + currentEvent.Description + \"','\" \n    + currentEvent.DisciplineID + \"'\", dbConnection);\n</code></pre>\n\n<p>Where am I missing a quote?</p>\n"},{"tags":["database","sql-server-2008","vmware-workstation"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":54,"score":0,"question_id":12870128,"title":"Access a SQL Server database on localhost from vmware guest os","body":"<p>I am doing a client server project and i needed to test whether client server model is working. I am now trying to use windows xp 32 bit, which is a virtual guest os in vmware workstation, to act as a client by making my physical machine(windows 7 x64 sp1) server.</p>\n\n<p>I am using SQL Server 2008. I need to access the database in the server from my client.\nHow can I do this?Is it possible to do so?... Thanks in advance..</p>\n"},{"tags":["sql","sql-server","sql-server-2008"],"answer_count":0,"favorite_count":1,"up_vote_count":1,"down_vote_count":3,"view_count":44,"score":-2,"question_id":12869831,"title":"Where is Database or Script for (http://www.scribd.com/doc/109623538/SQL-Queires-Asked-in-Interviews)","body":"<p>Where is Database or Script for This Queries In Link.\n(http://www.scribd.com/doc/109623538/SQL-Queires-Asked-in-Interviews)?</p>\n\n<p>-Thank You.</p>\n"},{"tags":["sql-server-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":35,"score":0,"question_id":12868607,"title":"Determining Page count on each Sql Table without using DBCC?","body":"<p>I am trying to compress my largest tables in my db. I will do this by running the SP_ForEachDB stored procedure. However I cannot figure out how to view the total page count. I can get row count with this query...</p>\n\n<p>USE DEVELOP04_HiltonUS</p>\n\n<p>GO</p>\n\n<p>SELECT \n    [TableName] = so.name, \n    [RowCount] = MAX(si.rows) \nFROM \n    sysobjects so, \n    sysindexes si \nWHERE \n    so.xtype = 'U' \n    AND \n    si.id = OBJECT_ID(so.name) \nGROUP BY \n    so.name \nORDER BY \n    2 DESC</p>\n\n<p>Which returns: \n            TABLE NAME   ROW COUNT\n           PlannedShift  38268660\n        BudgetStaffStat  19353104\n          BudgetKBIStat  14142631\nEmployeeShiftAdjustment  13493745\n            Requirement  11020921\n     EmployeeShiftError  6857235\n      JobclassLaborData  5638692</p>\n\n<p>and so on for all my tables.</p>\n\n<p>I am looking for the same thing but returning page Count instead.</p>\n"},{"tags":["c#","visual-studio-2010","sql-server-2008","asp.net-4.0"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":60,"score":0,"question_id":12867998,"title":"sql database interaction from visual studio","body":"<p>I have a helper class in my root <code>AppCode</code> folder that saves me time and coding executing database related tasks</p>\n\n<p>and i am looking for a way to have all tables and columns names into the intelliSense</p>\n\n<p>so for example</p>\n\n<pre><code>public static class GetTableData\n{\n    //base method\n    static int ExecSQLint(string TblintSQL)\n    {\n        int value;\n        SqlConnection myConn = new SqlConnection(\"server=(local);Initial Catalog=dbName;Integrated Security=True\");\n        SqlCommand TblintCMD = new SqlCommand(TblintSQL, myConn);\n\n        try\n        {\n            myConn.Open();\n            value = Convert.ToInt32(TblintCMD.ExecuteScalar());\n        }\n        finally\n        {\n            myConn.Close();\n        }\n\n        return value;\n    }\n\n    //return a Database value as int \n    public static int AsInt(string FieldToSearch, string tblName, string WhereClause, string FLdValue)\n    {\n        string TblintSQL = \"SELECT \" + FieldToSearch + \" FROM \" + tblName + \" WHERE \" + WhereClause + \" ='\" + FLdValue + \"'\";\n        return ExecSQLint(TblintSQL);\n    }\n}\n</code></pre>\n\n<p>so if i need a customer id(int) from  a table for example </p>\n\n<p>some <code>[tblCustomers]</code> i have a column named <code>custID</code> and <code>name</code></p>\n\n<p>i will retrive customer id via following Code </p>\n\n<pre><code>int custId = GetTableData.AsInt(\"custID\", \"tblCustomers\", \"name\", \"warren\");\n</code></pre>\n\n<p>I would like to get available Columns and table names into Visual studio so i will not have to use\nstrings as used in example above \nwhat would be the simplest way to achieve that ?, </p>\n\n<p>is it by generating  a code that will generate a  class with <code>const strings</code> </p>\n\n<p>or is there a utility I don't know about inside the Visual Studio ? (I'm currently using 2010 Pro)</p>\n"},{"tags":["sql-server","sql-server-2008","ms-access","ms-access-2007"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":56,"score":0,"question_id":12867898,"title":"SQL Server Bit Field Sorts Backwards in MS Access Boolean/Checkbox","body":"<p>I've been using SQL Server with ODBC linked tables for quite a long time already. Only today did I discover that SQL Server bit fields are backwards in MS Access. If you right-click on a Datasheet checkbox column and choose \"Sort Cleared to Selected\", it actually sorts Selected to Cleared.</p>\n\n<p>I understand that this comes from the fact that Access/Jet/ACE stores True as -1 whereas the SQL Server bit field stores True as 1.</p>\n\n<p>I'm wondering what the best solution for this is. Can I just use some kind of integer field to get around this problem?</p>\n"},{"tags":["sql","sql-server-2008","record"],"answer_count":1,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":482,"score":2,"question_id":3436611,"title":"Select latest record with some more conditions","body":"<pre><code>ID    Level Effective Date  ExpirationDate\n000012-12     2 12/01/2005  NULL\n000012-12    1    12/01/2005  NULL\n000012-12    2    12/01/2005  01/01/2009\n000012-A12    2 10/01/1994  11/30/2005\n000012-A12    2 01/01/1999  11/30/2005\n000012-A12    2 09/01/2001  11/30/2005\n000012-A12    1 12/01/2005  12/31/2007\n</code></pre>\n\n<p>Only most current Records will be fetched. It means in the above scenario<br>\nExp date - If <code>null</code> the record is still active.<br>\n           If greater then current time stamp, its future exp date , which means still active.<br>\n           If less then current time stamp , then terminated.<br>\nMost current is the most active or latest terminated record. If it has active and terminated then only active will be shown. Else last terminated record.</p>\n\n<p>One ID can have 2 rows for same effective date and exp date but multiple levels. So in that case we would need to select only 1 record for level one.</p>\n\n<p>So as per the data set above below is the intended output</p>\n\n<p>Output          </p>\n\n<pre><code>000012-12    1   12/01/2005  NULL\n000012-A12  2   12/01/2005  01/01/2009\n</code></pre>\n\n<p>Please help</p>\n\n<p>Thomas. Please look into the following data set.</p>\n\n<pre><code>Insert #Test( Id, Level, EffectiveDate, ExpirationDate ) Values ('000872-A24',1,'1994-10-01',NULL); \nInsert #Test( Id, Level, EffectiveDate, ExpirationDate ) Values ('000872-A24',1,'1999-01-01',NULL);  \nInsert #Test( Id, Level, EffectiveDate, ExpirationDate ) Values ('000872-A24',2,'2001-09-01',NULL ); \nInsert #Test( Id, Level, EffectiveDate, ExpirationDate ) Values ('000872-A24',1,'2003-01-01','2007-12-31'); \n</code></pre>\n\n<p>When you run the query it should give</p>\n\n<blockquote>\n  <p>000872-A24    2   09/01/2001  NULL</p>\n</blockquote>\n\n<p>but now it returns </p>\n\n<blockquote>\n  <p>000872-A24    1   01/01/2003  12/31/2007</p>\n</blockquote>\n"},{"tags":["sql","sql-server-2008"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":44,"score":1,"question_id":12867063,"title":"SQL Coalesce STR results in an INT","body":"<p>I have the following:</p>\n\n<pre><code>    Select tp.PH_F pHF, COALESCE(STR(tp.pH_F), tp.pH_S) pH\n     From tblprod tp\n</code></pre>\n\n<p>Note that PH_F is a float</p>\n\n<p>I get the following results</p>\n\n<pre><code>PHF    PH\n---    ---\n7.256   7\n7.59   8\n</code></pre>\n\n<p>Why does the STR convert int the Coalesce result in an INT? What I like happen is have it be the same value.</p>\n\n<p>What I like happen is the following:</p>\n\n<pre><code>PHF    PH\n---    ---\n7.256   7.256\n7.59   7.59\n</code></pre>\n\n<p>How can I have this happen with the Coalesce? </p>\n"},{"tags":["sql-server","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":1,"view_count":68,"score":-1,"question_id":12854817,"title":"Inserting data into one column fails saying values in another column can't be null","body":"<p>I can't understand this misunderstanding by SQL&nbsp;Server.</p>\n\n<p>As you can see, I'm trying to insert into column Ordamount, but SQL&nbsp;Server shows me in its error message that it can't insert null into column UserID?</p>\n\n<pre><code>Declare @variable1 int =( select sum(Orr.quantity *OI.Iteprice)\n                          from Orderrouter Orr\n                          inner join OrdItem OI on Orr.OrdItems =OI.ItemId\n                          where OrdId = 1)\n\n insert into Ord (Ordamount)\n values (@variable1);\n</code></pre>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>Msg 515, Level 16, State 2, Line 6<br/> Cannot insert the value\n  NULL into column 'UserID', table 'Example.dbo.Ord'; column does\n  not allow nulls. INSERT fails.</p>\n  \n  <p>The statement has been terminated.</p>\n</blockquote>\n"},{"tags":["entity-framework","sql-server-2008","connection-string"],"answer_count":2,"favorite_count":0,"up_vote_count":2,"down_vote_count":0,"view_count":1224,"score":2,"question_id":5920765,"title":"Does the Entity Framework use a default intital catalog and what assumptions does it make?","body":"<p>I did (pretty much) everything correct in a new EF project, but I forgot to use the named connection string in the EF context class, so, it used the default.</p>\n\n<p>It created a new database inside the SQL Express default data directory, and it worked perfectly.</p>\n\n<p>When I realised my mistake (After wondering for ages why no files were showing up in the app_data folder), I renamed the class to use the named connection string and then I kept getting the following error:</p>\n\n<blockquote>\n  <p>Unable to complete operation. The\n  supplied SqlConnection does not\n  specify an initial catalog.</p>\n</blockquote>\n\n<p>I know how to fix this, but, EF is like magic to me! I can't believe it works as well as it does and I am just curious as to what it uses by default / is there a list anywhere of \"assumptions\" that EF uses on your behalf if you specify nothing?</p>\n"},{"tags":["sql","sql-server-2008","tsql","pivot"],"answer_count":1,"favorite_count":2,"up_vote_count":1,"down_vote_count":0,"view_count":82,"score":1,"question_id":12865206,"title":"SQL rotate rows to columns...dynamic number of rows","body":"<blockquote>\n  <p><strong>Possible Duplicate:</strong><br>\n  <a href=\"http://stackoverflow.com/questions/10404348/sql-server-dynamic-pivot-query\">SQL Server dynamic PIVOT query?</a>  </p>\n</blockquote>\n\n\n\n<p>I have a dataset that has the below structure.</p>\n\n<pre><code>CREATE TABLE #TempTable\n  (\n     Measure_ID  INT,\n     measurement DECIMAL(18, 4)\n  )\n\nINSERT INTO #TempTable\nVALUES\n(1,2.3)\n,(1,3.4)\n,(1,3.3)\n,(2,3)\n,(2,2.3)\n,(2,4.0)\n,(2,4.5)\n</code></pre>\n\n<p>I need to produce output that will look like this.</p>\n\n<pre><code>1,2.3,3.4,3.3\n2,3,2.3,4.0,4.5\n</code></pre>\n\n<p>Basically its a pivot on Measure_ID.  Unfortunately, there can be an unlimited number of measure_id's.  So Pivot is out.</p>\n\n<p>I'm hoping to avoid CURSORS, but will if that turns out to be the best approach.</p>\n"},{"tags":["sql-server-2008","stored-procedures","views","udf","computed-columns"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12865584,"title":"Multiple SQL Server Computed columns populate using a single UDF possible?","body":"<p>I have to populate two columns(say EmpId and EmpName) as computed in my View. I was using a scalar User Defined Function to get that id from another table. But now, I have to get both the columns. Is there a way I can return two columns from my UDF(which I'm calling using a stored proc.) to populate my View.</p>\n\n<p>Thanks in advance!</p>\n"},{"tags":["sql-server-2008","date","stored-procedures"],"answer_count":0,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":67,"score":0,"question_id":12864759,"title":"Stored procedure in SQL Server 2008 to determine the next two working days are holidays or not ( as per usa holidays)","body":"<p>I need a stored procedure to determine whether the next two working days are holidays or not.</p>\n\n<p>Today is : <code>date.now()</code></p>\n\n<p>Thanks &amp; Regards.</p>\n\n<p>I tried like this :</p>\n\n<pre><code>create procedure holidaysearch\n   @holidaydate varchar(10)\nas\nbegin\n  set nocount on\n\n  select xxxx\nfrom dbsample\n  where hilidaydate = @holidaydate\nend\n</code></pre>\n"},{"tags":["sql","sql-server-2008","reporting-services","charts","ssrs-2008"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":45,"score":0,"question_id":12824063,"title":"SSRS 2008: Expression to determine width of bar in chart?","body":"<p>I have a query which returns a dataset like the one below:</p>\n\n<pre><code>WaitTimeGroup   WaitTimeGroupID     WaitTimeGroupNotify    Count\nupto 1h         1                   0                      0\nupto 2h         2                   0                      5\nupto 3h         3                   0                      15\nupto 3h30m      4                   1                      3\nupto 3h45m      5                   2                      2\nupto 4h         6                   3                      1\nupto 6h         7                   0                      9\nupto 12h        8                   0                      0\nover 12h        9                   0                      0\n</code></pre>\n\n<p>Which is then used to display the following chart using SSRS 2008:</p>\n\n<p><img src=\"http://i.stack.imgur.com/AC9lJ.png\" alt=\"enter image description here\"></p>\n\n<p>What I would like to be able to do is make the non-gray bars wider, in particular the bright red one. The colors are determined by the WaitTimeGroupNotify value.</p>\n\n<p>I've tried setting an expression in the PixelPointWidth CustomAttribute property though this displayed all bars with the same width.</p>\n\n<p>Is this possible using SSRS 2008 or perhaps someway it can be achieved by modifying my dataset?</p>\n"},{"tags":["sql","sql-server-2008","dbf"],"answer_count":4,"favorite_count":2,"up_vote_count":4,"down_vote_count":0,"view_count":5186,"score":4,"question_id":3119868,"title":"How to go from DBF files to SQL Server 2008?","body":"<p>I have an application that uses DBF files and I need to import them to SQL Server 2008. However, I also need to modify some of the data along the way and some columns will be added to tables while others will be deprecated.</p>\n\n<p>So far I'm using DBF -> Access -> MS Migration Assistant -> SQL Server 2008. But I think that there has to be a better way to handle it. I'd like to get away from the Migration Assistant because it doesn't let you modify the data when you import it.</p>\n"},{"tags":["sql","sql-server","tsql","sql-server-2008","database-design"],"answer_count":4,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":399,"score":4,"question_id":6418214,"title":"Table Normalization (Parse comma separated fields into individual records)","body":"<p>I have a table like this:</p>\n\n<p><strong>Device</strong></p>\n\n<pre><code>DeviceId   Parts\n\n1          Part1, Part2, Part3\n2          Part2, Part3, Part4\n3          Part1\n</code></pre>\n\n<p>I would like to create a table 'Parts', export data from Parts column to the new table. I will drop the Parts column after that</p>\n\n<p>Expected result</p>\n\n<p><strong>Parts</strong></p>\n\n<pre><code>PartId PartName\n\n  1      Part1\n  2      Part2\n  3      Part3\n  4      Part4\n</code></pre>\n\n<p><strong>DevicePart</strong></p>\n\n<pre><code>DeviceId PartId\n\n  1      1\n  1      2\n  1      3\n  2      2\n  2      3\n  2      4\n  3      1\n</code></pre>\n\n<p>Can I do this in SQL Server 2008 without using cursors?</p>\n"},{"tags":["php","sql-server-2008","zend-server"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":101,"score":0,"question_id":11135561,"title":"Connecting to MSSQL-Server 2008 under Zend server","body":"<p>Hi I'm currently trying to connect to MSSQL-Server-2008 using php on a Zend (web) server.\nI've tried out a few things now but always end up getting:\nPHP Warning:  PHP Startup: Unable to load dynamic library 'E:\\Zend\\ZendServer\\lib\\phpext\\php_pdo_sqlsrv_53_ts_vc9.dll' - The required module was not found\n<em>(sry if the error message sounds a bit strange I translated it manually into english)</em></p>\n\n<p>First step I did was to download:\nMicrosoft SQL Server 2008 R2 Native Client</p>\n\n<p>2nd step was that I downloaded:\nSQLSRV20.EXE and extracted the files into the phpext directory.</p>\n\n<p>3rd step was that I tried to turn on:\npdo_sqlsrv_53_nts_vc9\nand / or \npdo_sqlsrv_53_ts_vc9\nAnd restarted php.</p>\n\n<p>Regardless of what I did I received the above error message.\nThus every time I try to connect to the mssql server I get an error message:\n*PHP Fatal error:  Call to undefined function sqlsrv_connect()* </p>\n\n<p>Are there any additional steps needed?\n(PHP Version I use is: 5.3.9 with a very new version of the zend server).</p>\n\n<p>thanks</p>\n"},{"tags":["sql","sql-server","sql-server-2008","tsql"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":78,"score":0,"question_id":12863900,"title":"SQL server 2008: Conversion of varchar to datetime failed","body":"<p>I have problems with the following code:</p>\n\n<pre><code>USE [PCIPNY];\n\ninsert into [dbo].[test_Drug_Medication_1]\n(\n       [MedicationID] ,[ClinicID] ,[PatientID] ,[MyDrugID] ,[NDC] ,[DoctorID] ,[DrugID] ,[DrugFullDesc] ,[Generic_Name]\n      ,[Print_Name] ,[Manufacture] ,[Inactive_Date] ,[Strength] ,[Units] ,[Pkg_Size] ,[Pkg_Type] ,[Route] ,[Take]\n      ,[Frequency] ,[Duration] ,[Qualifier] ,[Quantity] ,[Refill] ,[Note] ,[DAW] ,[CreateDate] ,[CreateBy]\n      ,[ModifyBy],[IsControl] ,[UserDefine] ,[scheduleLevel] ,[BeginDate] ,[EndDate] ,[Active] ,[sente]\n      ,[OnCologyCheckStatus] ,[OnCologyCheckStatus1] ,[OnCologyCheckStatus2] ,[SIG] ,[Printed] ,[ICDCode] ,[SendeFaxed] ,[DosageForm] ,[GPI]\n      ,[IsBrand] ,[IsGeneric] ,[GenericAndBrand] ,[SigUnit] ,[IsDrug] ,[Status]\n)\n\nSELECT\n      [MedicationID] ,[ClinicID] ,[PatientID] ,[MyDrugID] ,[NDC] ,[DoctorID] ,[DrugID] ,[DrugFullDesc] ,[Generic_Name]\n      ,[Print_Name] ,[Manufacture] ,[Inactive_Date] ,[Strength] ,[Units] ,[Pkg_Size] ,[Pkg_Type] ,[Route] ,[Take]\n      ,[Frequency] ,[Duration] ,[Qualifier] ,[Quantity] ,[Refill] ,[Note] ,[DAW] ,[CreateDate] ,[CreateBy]\n      ,[ModifyBy] ,[IsControl] ,[UserDefine] ,[scheduleLevel] ,[BeginDate] ,[EndDate] ,[Active] ,[sente]\n      ,[OnCologyCheckStatus] ,[OnCologyCheckStatus1] ,[OnCologyCheckStatus2] ,[SIG] ,[Printed] ,[ICDCode] ,[SendeFaxed] ,[DosageForm] ,[GPI]\n      ,[IsBrand] ,[IsGeneric] ,[GenericAndBrand] ,[SigUnit] ,[IsDrug] ,[Status]\n\n  FROM [ec14].[dbo].[Drug_Medication]\n    where 1=1\n      and clinicid in (select clinicid from [dbo].[clinic] where org_db = 'ec14' and ClinicID=1234);\n</code></pre>\n\n<p>I got this error:</p>\n\n<blockquote>\n  <blockquote>\n    <p>Msg 241, Level 16, State 1, Line 3<br>\n    Conversion failed when converting date and/or time from character string.</p>\n  </blockquote>\n</blockquote>\n\n<p>I found out that the error is in the column <code>begindate</code>. </p>\n\n<p>The column <code>begindate</code> in ec04(origin location) is <code>charvar(16)</code> datatype.<br>\nThe column <code>begindate</code> in PCIPNY(destination location) is <code>datetime</code> datatype.</p>\n\n<p>Is there any solution to make this work?</p>\n"},{"tags":["sql","sql-server-2008"],"answer_count":3,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":48,"score":0,"question_id":12840034,"title":"error in stored procedure variable declaration","body":"<p>I have a query</p>\n\n<pre><code>create procedure pr_InsertFilterOnItemCreation\n@zCategoryId int,\n@zItemId int,\n@zFilterid int\nas\ndeclare @productId int\nset @productId = (SELECT convert(int,IDENT_CURRENT('item')))\nif( @productId&lt;&gt;null)\nbegin\ninsert into t_lnk_cat_product_filter_item set   cde_catid=@zCategoryId,cde_productid=@productId,cde_filterid=@zFilterid,cde_filteritemid=@zItemId\nselect 1\nend\n</code></pre>\n\n<p>I'm getting error </p>\n\n<blockquote>\n  <p>Incorrect syntax near the keyword 'set'</p>\n</blockquote>\n"},{"tags":["c#","sql-server-2008","ibm-midrange"],"answer_count":2,"favorite_count":0,"up_vote_count":1,"down_vote_count":0,"view_count":67,"score":1,"question_id":12861087,"title":"Sql Server isn't closing a connection to linked Server after execution","body":"<p>I am using a linked server to update records in AS/400. It isn't closing the connections properly. On the AS/400 side there are still a number of connections idle. In the sql log it is showing:</p>\n\n<p>EXCEPTION_ACCESS_VIOLATION writing address 0000000000000024 at 0x0000000077BDE4B4</p>\n\n<p>It doesn't appear that it is every time we open a connection and update the file on the AS/400 side. We updated 222 records and there were still 210 connections open. I would expect there to be 222.</p>\n\n<p>We are calling a stored procedure from a .NET app. In the stored procedure we are executing:</p>\n\n<p>EXECUTE (@as400Query) at S100405D</p>\n\n<p>Where the as400Query is a string with the update statement and S100405D is the linked server. The records are getting updated in the AS/400, so that isn't an issue. Just seems that when trying to close the connections, there is an error. Also I checked the settings on the linked server and the connection timeout = 0 (off). Not sure if setting a timeout will close them, or it won't matter because it is throwing an error anyways. </p>\n\n<p>Any help would be greatly appreciated!</p>\n\n<p>Brian </p>\n"},{"tags":["sql","sql-server","sql-server-2008","pivot","pivot-table"],"answer_count":1,"favorite_count":0,"up_vote_count":0,"down_vote_count":0,"view_count":81,"score":0,"question_id":12859871,"title":"How to get the description from the tables?","body":"<p>I got this query with the help of @Blue Feet. But the below query i have the instance type and in addition to that i need the instance type description from another tables.So i need to make a join with extra two tables.</p>\n\n<pre><code>Table - RelationShips:\n------------------------\nTable Name                          Column Name                 Key\nCSPGI50_VALID_INSTANCE_TYPE         CSPGI50_INSTANCE_TYPE_C     Primary\nCSPGJ02_MSG_OBJ                     CSPGJ02_MSG_K               Primary \nCSPGI03_MANUAL_ASN                  CSPGI03_ASN_C                primary\nCSPGJ03_MSG_TRANSLN                 CSPGJ03_LOCALE_C              primary   \n\nColumn Having tables:\n------------------------------\nCSPGI50_VALID_INSTANCE_TYPE(CSPGJ02_MSG_K,CSPGI50_INSTANCE_TYPE_C)\nCSPGJ03_MSG_TRANSLN(CSPGJ02_MSG_K)\nCSPGI03_MANUAL_ASN(CSPGI03_INSTANCE_TYPE_C)\nCSPGJ02_MSG_OBJ(CSPGJ02_MSG_K)\n</code></pre>\n\n<p>i have this below query,</p>\n\n<pre><code>SET DATEFIRST 1  \nSELECT \n    case when InstanceType is not null then InstanceType else 'Sum' End InstanceType , \n    sum([39]) AS FirstWeek, \n    sum([38]) AS SecondWeek,   \n    sum([37]) AS ThirdWeek, \n    sum([36]) AS FourthWeek, \n    sum([35]) AS FifthWeek, \n    sum([34]) AS SixthWeek  \nFROM \n(\n    SELECT [SPGI03_INSTANCE_TYPE_C] AS InstanceType, \n        [39], [38], [37], [36], [35], [34]  \n    FROM \n    ( \n        SELECT I03.[SPGI03_INSTANCE_TYPE_C],  \n            DatePart(wk, I03.[SPGI03_CREATE_S]) WeekNo, \n            DATEADD(DAY, 7 -DATEPART(WEEKDAY,I03.[SPGI03_CREATE_S]),\n            I03.[SPGI03_CREATE_S]) WeekEnd  \n        FROM [SUPER-G].[dbo].[CSPGI03_MANUAL_ASN] I03, [SUPER-G].[dbo].[CSPGI50_VALID_INSTANCE_TYPE] I50  \n        where I50.[SPGI50_INSTANCE_TYPE_C] = I03.[SPGI03_INSTANCE_TYPE_C] \n            and  I50.[SPGA04_RATING_ELEMENT_D] = 2 \n            and I03.[SPGI03_EXCEPTIONED_F] = 'N'  \n            and I03.[SPGI03_DISPUTED_F] != 'Y'  \n            and I03.[SPGI03_CREATE_S] between '08-19-2012 12:00:00.000' AND DATEADD(day , 7, '09-30-2012 11:59:59.000' \n    )) x \n    pivot \n    ( \n        count(WeekEnd) \n        FOR weekno IN ([39], [38], [37], [36], [35], [34])  \n    ) p \n) x1 \nGROUP BY  InstanceType WITH ROLLUP\n</code></pre>\n\n<h2>What i want:</h2>\n\n<p>I want to add the Instance Type Description from the </p>\n\n<pre><code>Table 2-column name([SPGJ03_MSG_TRANSLN_X])\n</code></pre>\n\n<p>If you have doubt please refer my previous query link\n<a href=\"http://stackoverflow.com/questions/12743869/how-to-group-by-the-each-week-upto-last-six-week-sundays-dates-in-sql\">How to group by the each week upto last six week sundays dates in sql?</a></p>\n"},{"tags":["sql","sql-server-2008","enterprise-library","enterprise"],"answer_count":2,"favorite_count":0,"up_vote_count":4,"down_vote_count":0,"view_count":355,"score":4,"question_id":4479574,"title":"How do I pass a table-valued parameter to SQL Server 2008 via EntLib 5.0?","body":"<p>How do I pass a table-valued parameter to SQL Server 2008 via EntLib 5.0?</p>\n"},{"tags":["sql","sql-server","string","sql-server-2008"],"answer_count":3,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":132,"score":1,"question_id":12854674,"title":"sql split string to one row","body":"<pre><code>declare @sqlstr varchar(max);\nselect @sqlstr = 'a,b,c,d,e,f';\n</code></pre>\n\n<p>I want use a sql statement to one row with six columns in sql server2008.</p>\n\n<pre><code>a,b,c,d,e,f\n</code></pre>\n"},{"tags":["sql","sql-server-2008"],"answer_count":1,"favorite_count":1,"up_vote_count":1,"down_vote_count":0,"view_count":90,"score":1,"question_id":12853319,"title":"combine today and total previous from today of that same column results in one sql query","body":"<pre><code>declare @temp table (ddate datetime)\n\ninsert @temp\nselect DATEDIFF(d,0,CONVERT(smalldatetime,'09/30/2012')  -Number)\nfrom master..spt_values\nwhere type='p' and number &lt; DatePart(d,'09/30/2012')\norder by 1\n\nDECLARE @DeptCode int =1 \n</code></pre>\n\n<p><strong>-- to display of particular date data</strong> </p>\n\n<pre><code>select   ComplaintMedia_Abbri,\nddate,COUNT(ComplaintMedia)  as c\nfrom    Complaint \nINNER JOIN @temp \nON convert(datetime,convert(varchar(10),ComplaintDate,101),101)=convert(datetime,convert(varchar(10),ddate,101),101)        \nWHERE isnull(Receivedby_Dept,Relatesto_Dept)=1     \ngroup by ComplaintMedia_Abbri,ddate\norder by ddate,ComplaintMedia_Abbri\n</code></pre>\n\n<p><strong>-- to display till date particular date data running total</strong> </p>\n\n<pre><code>select   ComplaintMedia_Abbri,ddate,\n    COUNT(ComplaintMedia_Abbri)  as c\n    from    Complaint \n\n    INNER JOIN @temp \n    ON convert(datetime,convert(varchar(10),ComplaintDate,101),101)&lt;=convert(datetime,convert(varchar(10),ddate,101),101)       \n\n    WHERE isnull(Receivedby_Dept,Relatesto_Dept)=1     \n    group by ComplaintMedia_Abbri,ddate\n</code></pre>\n\n<p>I want to show running total till date and today (that day ) records in one  sql query results .....</p>\n\n<p>as on join there is two difference conditions. </p>\n\n<p>expected result should be look like this </p>\n\n<p><img src=\"http://i.stack.imgur.com/dxhoz.jpg\" alt=\"expected result for above query \"></p>\n\n<p><strong>Edit :</strong>\nI am able to achive this result by using these queries and joining them but i want to do this task in one single query instead of two queries </p>\n\n<p>my current way can be check here . sorry for such long question but i think its necessary to understand question actually ..</p>\n\n<pre><code>declare @temp table (ddate datetime)\n\ninsert @temp\nselect DATEDIFF(d,0,CONVERT(smalldatetime,'09/30/2012')  -Number)\nfrom master..spt_values\nwhere type='p' and number &lt; DatePart(d,'09/30/2012')\norder by 1\n\n--select * from @temp\n\nSELECT * FROM \n\n        (select ddate,ISNULL(L,0) AS Letter,\n          ISNULL(P,0) AS Phone,\n          ISNULL(E,0) AS Email,\n          ISNULL(W,0) AS WEB \n          FROM \n          (\n            select   ComplaintMedia_Abbri,\n          ddate,COUNT(ComplaintMedia)  as c\n            from    Complaint \n            INNER JOIN @temp \n            ON convert(datetime,convert(varchar(10),ComplaintDate,101),101)=convert(datetime,convert(varchar(10),ddate,101),101)        \n            WHERE isnull(Receivedby_Dept,Relatesto_Dept)=1     \n            group by ComplaintMedia_Abbri,ddate\n    ) p \n\n    pivot (SUM(c) FOR ComplaintMedia_Abbri IN (E,W,L,P)) AS pvt \n\n    ) AS [A]\n\n    INNER JOIN \n\n    (\n    select ddate,ISNULL(L,0) AS LetterTot,\n      ISNULL(P,0) AS PhoneTot,\n      ISNULL(E,0) AS EmailTot,\n      ISNULL(W,0) AS WEBTot\n      FROM \n      (\n\n    select   ComplaintMedia_Abbri,ddate,\n    COUNT(ComplaintMedia_Abbri)  as c\n    from    Complaint \n\n    INNER JOIN @temp \n    ON convert(datetime,convert(varchar(10),ComplaintDate,101),101)&lt;=convert(datetime,convert(varchar(10),ddate,101),101)       \n\n    WHERE isnull(Receivedby_Dept,Relatesto_Dept)=1     \n    group by ComplaintMedia_Abbri,ddate\n    ) p \n\n   pivot (SUM(c) FOR ComplaintMedia_Abbri IN (E,W,L,P)) AS pvt\n\n\n\n    ) AS [B]\n\n   ON A.ddate=B.ddate\n\n   order by A.ddate\n</code></pre>\n"},{"tags":["sql","sql-server-2008","tsql","ssms","sqlcmd"],"answer_count":3,"favorite_count":2,"up_vote_count":2,"down_vote_count":0,"view_count":3251,"score":2,"question_id":9889334,"title":"Windows authenticated SQL Server - need admin privileges","body":"<p>I've managed to install SQL Server 2008 R2, but I fail when trying to create a new database because of rights (or lack of) (\"CREATE DATABASE PERMISSION DENIED\"). So I tried to assign the admin privileges to my current login - \"User does not have permission to perform this action.\" I also tried to create a new login that would have admin privileges but with no luck, obviously.</p>\n\n<p>Can anyone point me in the right direction to granting myself admin rights so that I can create a database? It's a local server. And I can install again if I really need to (takes a while on this machine so it's preferable to somehow make changes to this schema if possible).</p>\n"}]}
